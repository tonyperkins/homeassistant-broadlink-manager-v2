import{g as et,r as y,o as Ae,a as Ge,b as dt,d as ut,c as W,e as a,f as n,h as e,i as R,n as G,u as $e,t as p,j as T,F as ue,k as ke,w as ae,l as J,v as Me,m as de,p as ye,q as qe,s as Ye,T as tt,x as Se,y as De,z as Fe,A as ve,B as ot,C as Ne,D as Pe,E as lt,G as Je,H as ct,I as mt,J as vt,K as ze,L as pt,M as ft}from"./vendor-DGiFqQ_g.js";(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))$(h);new MutationObserver(h=>{for(const r of h)if(r.type==="childList")for(const m of r.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&$(m)}).observe(document,{childList:!0,subtree:!0});function d(h){const r={};return h.integrity&&(r.integrity=h.integrity),h.referrerPolicy&&(r.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?r.credentials="include":h.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function $(h){if(h.ep)return;h.ep=!0;const r=d(h);fetch(h.href,r)}})();let Qe=!1;function He(){const o=et(),c=o==null?void 0:o.appContext.config.globalProperties.$toast;return c||(Qe||(console.warn("Toast notification system not yet initialized - using console fallback"),Qe=!0),{success:d=>console.log("âœ“",d),error:d=>console.error("âœ—",d),warning:d=>console.warn("âš ",d),info:d=>console.info("â„¹",d)})}function Ze(){const o=y(!1),c=y(!1),d=y(!1),$=y(0),h=767,r=768,m=1023,g=1024,I=()=>{const _=window.innerWidth;$.value=_,o.value=_<=h,c.value=_>=r&&_<=m,d.value=_>=g};return Ae(()=>{I(),window.addEventListener("resize",I)}),Ge(()=>{window.removeEventListener("resize",I)}),{isMobile:o,isTablet:c,isDesktop:d,screenWidth:$,isMobileOrTablet:()=>o.value||c.value,isTabletOrDesktop:()=>c.value||d.value}}const Ke="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAHBUlEQVR4nOxZC1BTVxo+9+aNZI2LNsgjWR4hgoIiRVDBslKnIKPbx1jqTrtYoakat1a6dNsdd7t1X8XHyAbEhdUu1u2mXdbasqJbtsaMIqBBECiPBmqEICEBEx4xJLlJ7s6lw6rJDeQ2FzLM+M1kBs7/3+/83zn/Oee/51JRFAXzGbCvA/AWjwX4GvNeANWXnXffHQ4+K6/dYbHeD+IFhjRkb1wn9WPQbEQ4IF/tQlXX2p5+/8OyczY74j/VxuMG3Sh/Oz9jaQDb4CmPT1LIbLXBfzrz0cmHg8fQpx1Yc1Ra+TsiXD4R0PqtRmAyj/LxbJeaujKIcPlEAINOM7vLXBaTZibCRWgRq3WGJZWX63aoNDpB8BJOX/bGlIqwpUv6iXBgWBHG7eUF8urUWvU6Z9sLGxI/IsLl8SJu6u4XigqPXkVspiVTbTQqU1/6Vn7ammh+G5FOMZyqludIKqUVU/9jcaSuTCo/unfHbiad4iBdwMu/P1bV1tO1xbk9NDC0/vwHB1xGcjqYLAh16zsHW3R6XXTu1mfFdAqMrIoSKNbGhLcQ4QGeppDJ7ACtPcqNEI6tT9O3Vqm+tygqNMDjrU9Sef6tIYM2JjUuuXzfC5knCEXsBI8WMZUCAxiCrfhWyMZkMNzYXNHVpwmXXqp5j0Hz0/1m57a3PQ8VHx4JoNMASIl9shLPFsB5ooO7iDXhCY/dAcCvT/79LwC1s/K2bDnAXcQeJRqwMzzeRt/bua0gLChcDsCDNQNBkEU/qot7o6j0kzETQpuJ40ZnT6xSrUoNWhyseHVz2ikv4n4QA5FSArE5IFlTZ0r3XU1MWODib6NCl3a9dkhSYxgbjo4XLq8sL9j7Ip36YEwMRjMNQazMhf7+RgYNnuyo7bY6ArFaWKuXRX495wLwoLk39sO9RaVnM5OTP8zLSjtjsljpp6ovi6pqr706eE8XBwGUSqEy9Guihf/92TMZhetjI5rJCHwKpBRzZqsNYtKp6KD+Pvv1w5ILdzR3UvD8HA4YefOl7N25JKUPIKuUwIJH7A5of/GJf7oLfrIz2EH786fSss+uKFzOk+8L0mqh6rpbmR0q5YyFGAQBSuHHlcUWxEaZyXfMhFD0Rgt9Oh/SBMiam58HAO+oc4XZMsK/1taT6M6uHjJw8w6VSNfvemM8TbzPlFlwsP5KyzfJeL6kCejXDgo894aASqOZ9O/uHwzq6B3ijhitkzOC7XS7j0g+V3S0vQTDDhYEoZSBobvJ+yXFNZ29gy4lOGmvlDBMIfQqSKV8539EWvXHhvbGHBSFrAwGW+vvxzLoR7RxzrNpsyPs0xcv7/lg1/ZfPtKvuw7MVhulUakWdvRq+XY3tWFT90Bk+52BCOzvyOBgjytSFKAgms+b9F/2o+BbKwUrvgjhhjSjKLAPG4YE7lJxfEIf5dyGOwMXrren/eF0RYXRNMrHDt4QbmjDEbHop9F8rqpddZd3sV6R/aWiabtWr41PW534V8m+PFHW+qSPL9TX7oM8WAaBi4IbE4S8yYNs/7asIgBA0ZStRqFM/MXxIzcgHBEBP+C6DJKLgJvK3uXvniitBsDmNzkSEAD9uv5k0aFjXy1gMQ0DQ5p4CAIwNuXLwyL/ExcpqMWeS42NUmxKXFf8VWPdz6cLnkqhGd/Pe+U1Cow/+ekJUYr4qJgvbik7f/Jw+0J/tjpvS3qxs7/LQZZfcrrkUmOdGI/cgUKIkB8pz0xK+CQjKf6z4MWckYftZqsderfsTInsZt0evDRgMRYMHhaLnk+NW1Y/nchxk5lZ+I/Pf/vl9RvbLYiVlSBcJv/VK9sKBCHc3hkF7D12/NzVltZn8YhzNj/3ev6LGeXTdQ6+uzLZ+C+5XNza05Nsd1gXcNgBvekJK/+du3lTUSiXMzzT80TgkkK8wJAGgCMAE5ooFFz3hHTr+lgZ9iMryOngkoi5WZuOc9hPtDu3r4198nTqygjCr3wYmrvVkSerZXljJoT0m0DcYm5g2Mg5WV39zrVWZZofkzaRnhB/bufm9FI/JpXQXj8F8bHyitqWxhzJmwUJT60SNJER+P+BCZjt34lzNbvickRoWVWNmGzuObnYWhER3oAdX41dPbj1jDeYEwGrInltKKCNtatub6hRfJOEnfJkcc+JgE9ltS/DkINuNI3xCo4fbXgm/0CnouvOcjK4Z/16/ZKia+3+kqIrEIQ+sgNx2Jzb5wsPxrD9GBZv+Gd9BqSXr4icg8cwMj4SLmv6+mlv+WddgGlilOPOZkEmFnrLP+sCVgtXyPHaHShkiw0XXPWWf9YF5Gb9uGzp4sCbj7ai4LkNTx2O5nPV3vLPyTeye6P32X+7KNujVKtSYJg+viEu/mx2etJZCgnD57OPfGRh3n8nfizA15j3Av4XAAD//5k1S2w3zfwVAAAAAElFTkSuQmCC",ee=dt.create({baseURL:"./",timeout:3e4,headers:{"Content-Type":"application/json","Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"}});ee.interceptors.request.use(o=>o,o=>Promise.reject(o));ee.interceptors.response.use(o=>o,o=>(console.error("API Error:",o),o.response?console.error("Response error:",o.response.data):o.request?console.error("No response received"):console.error("Request setup error:",o.message),Promise.reject(o)));const gt=ut("devices",{state:()=>({devices:[],loading:!1,error:null,selectedDevice:null}),getters:{deviceById:o=>c=>o.devices.find(d=>d.id===c),devicesByType:o=>c=>o.devices.filter(d=>d.entity_type===c),deviceCount:o=>o.devices.length,hasDevices:o=>o.devices.length>0},actions:{async loadDevices(o=!1){this.loading=!0,this.error=null;try{const c=o?`/api/devices/managed?_t=${Date.now()}`:"/api/devices/managed",d=await ee.get(c);this.devices=d.data.devices||[],console.log("ğŸ“¥ Loaded devices:",this.devices),this.devices.forEach($=>{console.log(`ğŸ“¥ Device "${$.name}":`,{id:$.id,device:$.device,commands:$.commands,commandCount:$.commands?Object.keys($.commands).length:0})})}catch(c){this.error=c.message,console.error("Error loading devices:",c)}finally{this.loading=!1}},async createDevice(o){this.loading=!0,this.error=null;try{console.log("ğŸª Store: Creating device with data:",o),console.log("ğŸª Store: Device commands being sent:",o.commands);const c={device_name:o.name,device:o.device,area_id:o.area||"",area_name:o.area||"",entity_type:o.entity_type,icon:o.icon,broadlink_entity:o.broadlink_entity,device_type:o.device_type||"broadlink",commands:o.commands||{}};o.device_type==="smartir"&&o.smartir_config&&(c.smartir_config=o.smartir_config),console.log("ğŸª Store: Transformed data for backend:",c);const d=await ee.post("/api/devices/managed",c);return console.log("ğŸª Store: Create response:",d.data),await this.loadDevices(),d.data}catch(c){throw console.error("Error creating device:",c),c}finally{this.loading=!1}},async updateDevice(o,c){this.loading=!0,this.error=null;try{const d=await ee.put(`/api/devices/managed/${o}`,c);return await this.loadDevices(),d.data}catch(d){throw console.error("Error updating device:",d),d}finally{this.loading=!1}},async deleteDevice(o,c=!1){this.loading=!0,this.error=null;try{await ee.delete(`/api/devices/managed/${o}`,{data:{delete_commands:c}}),this.devices=this.devices.filter(d=>d.id!==o)}catch(d){throw this.error=d.message,console.error("Error deleting device:",d),d}finally{this.loading=!1}},selectDevice(o){this.selectedDevice=o},clearSelection(){this.selectedDevice=null},clearError(){this.error=null},updateDeviceCommands(o,c){const d=this.devices.findIndex($=>$.id===o);if(d!==-1){const $={...this.devices[d],commands:c};this.devices.splice(d,1,$),console.log(`âœ… Store: Updated commands for ${o}, count: ${Object.keys(c).length}`)}else console.warn(`âš ï¸ Store: Device ${o} not found for command update`)},async syncAllAreas(){if(!this.devices||this.devices.length===0){console.log("âš ï¸ No devices to sync");return}console.log(`ğŸ”„ Syncing areas from Home Assistant for ${this.devices.length} devices...`);try{const o=await Promise.all(this.devices.map($=>(console.log(`ğŸ”„ Syncing device: ${$.id} (${$.name})`),ee.post(`/api/devices/${$.id}/sync-area`).then(h=>h.data.success&&h.data.area?(console.log(`âœ… Synced area for ${$.name}: ${h.data.area}`),{status:"synced",device:$.name}):{status:"no_area"}).catch(h=>{var r;return((r=h.response)==null?void 0:r.status)===404?(console.log(`âŒ Device not found in HA: ${$.id}`),{status:"not_found"}):(console.warn(`âš ï¸ Failed to sync area for ${$.id}:`,h.message),{status:"error",error:h.message})})))),c=o.filter($=>$.status==="synced").length,d=o.filter($=>$.status==="not_found").length;await this.loadDevices(!0),c>0?console.log(`âœ… Area sync complete: ${c} synced, ${d} not found in HA`):d>0&&console.log(`â„¹ï¸ No areas synced - ${d} entities not found in HA registry (generate entities first)`)}catch(o){console.debug("Area sync error:",o)}}}});function nt(o){const c=W(()=>o.value||o),d=W(()=>{switch(c.value){case"climate":return"mdi:air-conditioner";case"fan":return"mdi:fan";case"light":return"mdi:lightbulb";case"media_player":return"mdi:television";case"switch":return"mdi:light-switch";default:return"mdi:devices"}}),$=W(()=>`device-type-${c.value}-color`),h=W(()=>`tag-${c.value}-bg`);return{icon:d,colorClass:$,tagBgClass:h}}const st=""+new URL("broadlink-logo-BDjImjRY.png",import.meta.url).href,we=(o,c)=>{const d=o.__vccOpts||o;for(const[$,h]of c)d[$]=h;return d},yt={class:"device-header"},bt={class:"device-info"},ht=["title"],kt={class:"device-labels"},wt={class:"device-type"},$t=["src","alt","title"],Ct={class:"device-body"},_t={class:"device-stats"},St={class:"stat",title:"Learned command count"},It={class:"stat",title:"HA Assigned Area"},Dt={class:"device-meta"},Tt={class:"device-id",title:"Device ID"},xt={key:0,class:"storage-name"},Rt={key:1,class:"broadlink-entity",title:"Controller Device"},Mt={key:2,class:"controller-device"},At={class:"device-actions"},Ot=["disabled"],Lt=["disabled"],Et=["disabled"],Vt={key:0,class:"disabled-overlay"},Pt={__name:"DeviceCard",props:{device:{type:Object,required:!0},broadlinkDevices:{type:Array,default:()=>[]}},emits:["edit","delete","learn"],setup(o){const c=o,d=W(()=>localStorage.getItem("smartir_simulate_not_installed")==="true"),$=W(()=>c.device.device_type==="smartir"&&d.value),h=y(null),r=nt(W(()=>c.device.entity_type)),m=W(()=>c.device.icon?c.device.icon:r.icon.value),g=s=>s&&s.startsWith("mdi:")?`mdi ${s.replace(":"," mdi-")}`:`mdi mdi-${s}`,I=W(()=>({light:"Light",fan:"Fan",switch:"Switch",media_player:"Media Player",cover:"Cover"})[c.device.entity_type]||c.device.entity_type),_=W(()=>(c.device.device_type||"broadlink")==="smartir"?"SmartIR":"Broadlink"),E=W(()=>(c.device.device_type||"broadlink")==="smartir"?Ke:st),w=W(()=>(c.device.device_type||"broadlink")==="smartir"?h.value!==null?h.value:0:Object.keys(c.device.commands||{}).length),l=s=>{if(!s)return"";const b=c.broadlinkDevices.find(f=>f.entity_id===s);return b&&b.name||s},L=W(()=>{if(!c.device.device)return!1;const s=c.device.id.includes(".")?c.device.id.split(".")[1]:c.device.id;return c.device.device!==s}),q=W(()=>{if(!c.device.broadlink_entity)return"";const s=c.broadlinkDevices.find(b=>b.entity_id===c.device.broadlink_entity);return s&&s.name||c.device.broadlink_entity}),P=s=>{if(!s||typeof s!="object")return 0;let b=0;for(const f of Object.values(s))typeof f=="string"?b++:typeof f=="object"&&(b+=P(f));return b},C=async()=>{if(!(!c.device.device_code||!c.device.entity_type))try{const s=await ee.get("/api/smartir/codes/code",{params:{entity_type:c.device.entity_type,code_id:c.device.device_code}});if(s.data.success&&s.data.code){const b=s.data.code;b.commands&&(h.value=P(b.commands))}}catch(s){console.error("Error fetching SmartIR command count:",s)}};return Ae(async()=>{(c.device.device_type||"broadlink")==="smartir"&&await C()}),(s,b)=>(n(),a("div",{class:G(["device-card",{disabled:$.value}])},[e("div",yt,[e("div",{class:G(["device-icon",$e(r).colorClass.value])},[e("i",{class:G(g(m.value))},null,2)],2),e("div",bt,[e("h3",{title:o.device.name},p(o.device.name),9,ht),e("div",kt,[e("span",wt,p(I.value),1)])]),e("img",{src:E.value,alt:_.value,title:_.value,class:"device-source-logo"},null,8,$t)]),e("div",Ct,[e("div",_t,[e("div",St,[b[3]||(b[3]=e("i",{class:"mdi mdi-remote"},null,-1)),e("span",null,p(w.value)+" command"+p(w.value!==1?"s":""),1)]),e("div",It,[b[4]||(b[4]=e("i",{class:"mdi mdi-map-marker"},null,-1)),e("span",null,p(o.device.area||"No area"),1)])]),e("div",Dt,[e("span",Tt,[b[5]||(b[5]=e("i",{class:"mdi mdi-identifier"},null,-1)),T(" "+p(o.device.id),1)]),L.value?(n(),a("span",xt,[b[6]||(b[6]=e("i",{class:"mdi mdi-code-tags"},null,-1)),T(" "+p(o.device.device),1)])):R("",!0),o.device.broadlink_entity?(n(),a("span",Rt,[b[7]||(b[7]=e("i",{class:"mdi mdi-access-point"},null,-1)),T(" "+p(q.value),1)])):R("",!0),o.device.controller_device?(n(),a("span",Mt,[b[8]||(b[8]=e("i",{class:"mdi mdi-access-point"},null,-1)),T(" "+p(l(o.device.controller_device)),1)])):R("",!0)])]),e("div",At,[e("button",{onClick:b[0]||(b[0]=f=>!$.value&&s.$emit("learn",o.device)),class:"icon-btn",title:"Manage Commands",disabled:$.value},[...b[9]||(b[9]=[e("i",{class:"mdi mdi-remote-tv"},null,-1)])],8,Ot),e("button",{onClick:b[1]||(b[1]=f=>!$.value&&s.$emit("edit",o.device)),class:"icon-btn",title:"Edit",disabled:$.value},[...b[10]||(b[10]=[e("i",{class:"mdi mdi-pencil"},null,-1)])],8,Lt),e("button",{onClick:b[2]||(b[2]=f=>!$.value&&s.$emit("delete",o.device)),class:"icon-btn danger",title:"Delete",disabled:$.value},[...b[11]||(b[11]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,Et)]),$.value?(n(),a("div",Vt,[...b[12]||(b[12]=[e("div",{class:"disabled-message"},[e("i",{class:"mdi mdi-eye-off"}),e("span",null,"SmartIR Not Installed")],-1)])])):R("",!0)],2))}},Ut=we(Pt,[["__scopeId","data-v-7a7f5c18"]]),jt={name:"DeviceListView",props:{devices:{type:Array,required:!0}},methods:{getDeviceSourceLogo(o){return(o.device_type||"broadlink")==="smartir"?Ke:st},getDeviceCommands(o){return o.commands&&typeof o.commands=="object"?Object.keys(o.commands):[]},getCommandType(o,c){return o.commands&&o.commands[c]&&o.commands[c].type||"ir"},getCommandTypeClass(o,c){return this.getCommandType(o,c)==="rf"?"command-rf":"command-ir"},getCommandTypeLabel(o,c){return this.getCommandType(o,c)==="rf"?"RF Command":"IR Command"},sendCommand(o,c){this.$emit("send-command",{device:o,command:c})},openCommands(o){this.$emit("open-commands",o)},editDevice(o){this.$emit("edit-device",o)},deleteDevice(o){this.$emit("delete-device",o)}}},Ft={class:"device-list-view"},Nt={class:"device-table"},Bt={class:"device-info"},Ht={class:"device-name"},qt={class:"device-entity"},zt={class:"device-area"},Jt={class:"device-type"},Wt=["src","alt","title"],Kt={class:"device-commands"},Xt={key:0,class:"command-list"},Gt=["onClick","title"],Yt={key:0,class:"no-commands"},Zt={key:1,class:"smartir-info"},Qt={class:"profile-code"},eo={class:"device-actions"},to=["onClick"],oo=["onClick"],lo=["onClick"];function no(o,c,d,$,h,r){return n(),a("div",Ft,[e("table",Nt,[c[3]||(c[3]=e("thead",null,[e("tr",null,[e("th",null,"Device"),e("th",null,"Room/Area"),e("th",null,"Type"),e("th",null,[e("div",{class:"commands-header"},[e("span",null,"Commands"),e("div",{class:"command-legend"},[e("span",{class:"legend-badge command-rf"},"RF"),e("span",{class:"legend-badge command-ir"},"IR")])])]),e("th",null,"Actions")])],-1)),e("tbody",null,[(n(!0),a(ue,null,ke(d.devices,m=>(n(),a("tr",{key:m.entity_id,class:"device-row"},[e("td",Bt,[e("div",Ht,p(m.friendly_name||m.name),1),e("div",qt,p(m.entity_id),1)]),e("td",zt,p(m.area||"No Area"),1),e("td",Jt,[e("img",{src:r.getDeviceSourceLogo(m),alt:m.device_type==="smartir"?"SmartIR":"Broadlink",title:m.device_type==="smartir"?"SmartIR":"Broadlink",class:"device-source-logo"},null,8,Wt)]),e("td",Kt,[(m.device_type||"broadlink")==="broadlink"?(n(),a("div",Xt,[(n(!0),a(ue,null,ke(r.getDeviceCommands(m),g=>(n(),a("button",{key:g,class:G(["command-btn",r.getCommandTypeClass(m,g)]),onClick:I=>r.sendCommand(m,g),title:r.getCommandTypeLabel(m,g)},p(g),11,Gt))),128)),r.getDeviceCommands(m).length===0?(n(),a("span",Yt," No commands ")):R("",!0)])):m.device_type==="smartir"?(n(),a("div",Zt,[e("span",Qt,"Profile: "+p(m.device_code),1)])):R("",!0)]),e("td",eo,[e("button",{class:"action-btn commands",onClick:g=>r.openCommands(m),title:"Manage Commands"},[...c[0]||(c[0]=[e("i",{class:"mdi mdi-remote-tv"},null,-1)])],8,to),e("button",{class:"action-btn edit",onClick:g=>r.editDevice(m),title:"Edit"},[...c[1]||(c[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})],-1)])],8,oo),e("button",{class:"action-btn delete",onClick:g=>r.deleteDevice(m),title:"Delete"},[...c[2]||(c[2]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"3 6 5 6 21 6"}),e("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})],-1)])],8,lo)])]))),128))])])])}const so=we(jt,[["render",no],["__scopeId","data-v-2895a204"]]),ao={class:"icon-picker"},io={class:"icon-input-wrapper"},ro=["id","placeholder"],uo={key:0,class:"icon-preview"},co={key:0,class:"icon-dropdown"},mo={class:"icon-grid"},vo=["onMousedown","title"],po={__name:"IconPicker",props:{modelValue:{type:String,default:""},inputId:{type:String,default:"icon-input"},placeholder:{type:String,default:"e.g., mdi:television"}},emits:["update:modelValue"],setup(o,{emit:c}){const d=o,$=c,h=y(d.modelValue),r=y(!1),m=["television","speaker","radio","music","video","movie","play","pause","stop","skip-next","skip-previous","volume-high","volume-medium","volume-low","volume-off","remote","remote-tv","cast","chromecast","spotify","netflix","youtube","lightbulb","lightbulb-on","lightbulb-off","lamp","floor-lamp","ceiling-light","light-switch","led-strip","led-strip-variant","wall-sconce","chandelier","spotlight","track-light","vanity-light","desk-lamp","fan","ceiling-fan","air-conditioner","thermometer","thermostat","heat-wave","snowflake","fire","radiator","water-boiler","hvac","blinds","blinds-open","window-shutter","window-shutter-open","curtains","curtains-closed","roller-shade","roller-shade-closed","garage","garage-open","gate","door","door-open","window-open","window-closed","washing-machine","tumble-dryer","dishwasher","refrigerator","stove","microwave","oven","toaster","kettle","coffee","coffee-maker","blender","robot-vacuum","robot-vacuum-variant","vacuum","broom","spray-bottle","lock","lock-open","lock-smart","key","shield","shield-check","alarm-light","bell","doorbell","camera","cctv","motion-sensor","smoke-detector","fire-extinguisher","water-alert","gas-cylinder","sofa","bed","bed-double","desk","chair","table","bookshelf","home","home-outline","home-assistant","floor-plan","room","weather-sunny","weather-night","weather-cloudy","weather-rainy","weather-snowy","weather-lightning","weather-windy","weather-fog","weather-partly-cloudy","umbrella","water","water-percent","phone","cellphone","tablet","laptop","desktop-tower","monitor","keyboard","mouse","printer","router","router-wireless","access-point","wifi","bluetooth","usb","hdmi-port","ethernet","power","power-plug","power-socket","battery","battery-charging","lightning-bolt","flash","solar-panel","solar-power","leaf","tree","flower","sprout","grass","watering-can","shovel","fence","pool","hot-tub","silverware","silverware-fork-knife","food","food-apple","glass-wine","glass-cocktail","bottle-wine","pot","pot-steam","shower","shower-head","bathtub","toilet","sink","faucet","hand-wash","car","car-side","garage-variant","tools","hammer","wrench","screwdriver","toolbox","ladder","heart","heart-pulse","run","walk","bike","dumbbell","yoga","scale-bathroom","thermometer-lines","clock","clock-outline","timer","alarm","calendar","calendar-today","calendar-clock","history","bell-ring","bell-alert","alert","alert-circle","information","help-circle","check","check-circle","close-circle","minus-circle","plus-circle","arrow-up","arrow-down","arrow-left","arrow-right","chevron-up","chevron-down","menu","dots-vertical","dots-horizontal","cog","tune","circle","square","triangle","hexagon","star","star-outline","heart-outline","plus","minus","close","check-bold","eye","eye-off","account","account-group","baby","dog","cat","paw","gift","balloon","party-popper","candle","book","book-open","newspaper","email","message","phone-classic"];ae(()=>d.modelValue,w=>{h.value=w});const g=W(()=>{if(!h.value)return m.slice(0,50);const w=h.value.toLowerCase().replace("mdi:","");return m.filter(l=>l.toLowerCase().includes(w)).slice(0,50)}),I=()=>{r.value=!0,$("update:modelValue",h.value)},_=()=>{setTimeout(()=>{r.value=!1},200)},E=w=>{h.value=`mdi:${w}`,$("update:modelValue",h.value),r.value=!1};return(w,l)=>(n(),a("div",ao,[e("div",io,[J(e("input",{id:o.inputId,"onUpdate:modelValue":l[0]||(l[0]=L=>h.value=L),type:"text",placeholder:o.placeholder,onInput:I,onFocus:l[1]||(l[1]=L=>r.value=!0),onBlur:_},null,40,ro),[[Me,h.value]]),h.value?(n(),a("div",uo,[e("i",{class:G(`mdi mdi-${h.value.replace("mdi:","")}`)},null,2)])):R("",!0)]),r.value&&g.value.length>0?(n(),a("div",co,[e("div",mo,[(n(!0),a(ue,null,ke(g.value,L=>(n(),a("div",{key:L,class:"icon-option",onMousedown:de(q=>E(L),["prevent"]),title:L},[e("i",{class:G(`mdi mdi-${L}`)},null,2),e("span",null,p(L),1)],40,vo))),128))])])):R("",!0)]))}},fo=we(po,[["__scopeId","data-v-a64f5011"]]),go={key:0,class:"dropdown-label"},yo={key:0,class:"required"},bo=["placeholder","disabled","onKeydown"],ho={class:"dropdown-icons"},ko={key:0,class:"mdi mdi-loading mdi-spin"},wo={key:2,class:"mdi mdi-chevron-down"},$o={key:1,class:"error-message"},Co={key:2,class:"hint-message"},_o={key:0,class:"dropdown-menu"},So=["onMousedown","onMouseenter"],Io={class:"option-content"},Do={class:"option-label"},To={key:0,class:"option-description"},xo={key:0,class:"mdi mdi-check selected-icon"},Ro={key:3,class:"dropdown-menu"},Mo={__name:"SearchableDropdown",props:{modelValue:{type:[String,Number,Object],default:null},options:{type:Array,required:!0,default:()=>[]},label:{type:String,default:""},placeholder:{type:String,default:"Search..."},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},error:{type:String,default:""},hint:{type:String,default:""},optionLabel:{type:String,default:"label"},optionValue:{type:String,default:"value"},optionDescription:{type:String,default:"description"},filterMethod:{type:Function,default:null}},emits:["update:modelValue","change","search"],setup(o,{emit:c}){const d=o,$=c,h=y(null),r=y(null),m=y(""),g=y(!1),I=y(0),_=y(!1),E=M=>typeof M=="string"||typeof M=="number"?M:M[d.optionLabel]||M.label||M.name||String(M),w=M=>typeof M=="string"||typeof M=="number"?M:M[d.optionValue]||M.value||M.id||M,l=M=>typeof M=="string"||typeof M=="number"?"":M[d.optionDescription]||M.description||"",L=M=>{const F=w(M);return typeof d.modelValue=="object"?w(d.modelValue)===F:d.modelValue===F},q=W(()=>{if(!m.value)return d.options;if(d.filterMethod)return d.options.filter(F=>d.filterMethod(F,m.value));const M=m.value.toLowerCase();return d.options.filter(F=>{const te=E(F).toLowerCase(),ie=l(F).toLowerCase();return te.includes(M)||ie.includes(M)})}),P=W(()=>{if(!d.modelValue)return"";const M=d.options.find(F=>{const te=w(F);return typeof d.modelValue=="object"?te===w(d.modelValue):te===d.modelValue});return M?E(M):""});ae(()=>d.modelValue,M=>{_.value||(m.value=P.value)}),ae(()=>d.options,()=>{!_.value&&d.modelValue&&(m.value=P.value)},{deep:!0}),ae(m,M=>{$("search",M),I.value=0}),Ae(()=>{m.value=P.value});const C=()=>{var M;_.value=!0,g.value=!0,(M=r.value)==null||M.select()},s=()=>{_.value=!1,setTimeout(()=>{g.value=!1,d.modelValue?m.value=P.value:m.value=""},200)},b=()=>{var M;g.value=!1,(M=r.value)==null||M.blur()},f=M=>{const F=w(M);$("update:modelValue",F),$("change",F,M),m.value=E(M),b()},O=()=>{var M;$("update:modelValue",null),$("change",null,null),m.value="",(M=r.value)==null||M.focus()},z=()=>{if(!g.value){g.value=!0;return}I.value<q.value.length-1&&I.value++},Y=()=>{I.value>0&&I.value--},B=()=>{q.value.length>0&&I.value>=0&&f(q.value[I.value])},le=M=>{h.value&&!h.value.contains(M.target)&&(g.value=!1,d.modelValue?m.value=P.value:m.value="")};return Ae(()=>{document.addEventListener("click",le)}),Ge(()=>{document.removeEventListener("click",le)}),(M,F)=>(n(),a("div",{class:"searchable-dropdown",ref_key:"dropdownRef",ref:h},[o.label?(n(),a("label",go,[T(p(o.label)+" ",1),o.required?(n(),a("span",yo,"*")):R("",!0)])):R("",!0),e("div",{class:G(["dropdown-input-wrapper",{"has-error":o.error,disabled:o.disabled}])},[J(e("input",{ref_key:"inputRef",ref:r,type:"text","onUpdate:modelValue":F[0]||(F[0]=te=>m.value=te),placeholder:o.placeholder,disabled:o.disabled||o.loading,onFocus:C,onBlur:s,onKeydown:[qe(de(z,["prevent"]),["down"]),qe(de(Y,["prevent"]),["up"]),qe(de(B,["prevent"]),["enter"]),qe(b,["escape"])],class:"dropdown-input"},null,40,bo),[[Me,m.value]]),e("div",ho,[o.loading?(n(),a("i",ko)):o.modelValue&&!o.disabled?(n(),a("i",{key:1,class:"mdi mdi-close-circle clear-icon",onClick:O})):(n(),a("i",wo))])],2),o.error?(n(),a("div",$o,p(o.error),1)):R("",!0),o.hint&&!o.error?(n(),a("div",Co,p(o.hint),1)):R("",!0),ye(tt,{name:"dropdown"},{default:Ye(()=>[g.value&&q.value.length>0?(n(),a("div",_o,[(n(!0),a(ue,null,ke(q.value,(te,ie)=>(n(),a("div",{key:w(te),class:G(["dropdown-item",{highlighted:ie===I.value,selected:L(te)}]),onMousedown:de(be=>f(te),["prevent"]),onMouseenter:be=>I.value=ie},[e("div",Io,[e("div",Do,p(E(te)),1),l(te)?(n(),a("div",To,p(l(te)),1)):R("",!0)]),L(te)?(n(),a("i",xo)):R("",!0)],42,So))),128))])):R("",!0)]),_:1}),g.value&&q.value.length===0&&!o.loading?(n(),a("div",Ro,[...F[1]||(F[1]=[e("div",{class:"dropdown-item no-results"},[e("i",{class:"mdi mdi-magnify"}),T(" No results found ")],-1)])])):R("",!0)],512))}},We=we(Mo,[["__scopeId","data-v-679ce35f"]]),Ao={class:"smartir-selector"},Oo={class:"form-group"},Lo={class:"form-group"},Eo={class:"form-group"},Vo=["value"],Po={key:0,class:"error-message"},Uo={class:"form-group"},jo={class:"form-group"},Fo={key:1,class:"code-info"},No={class:"info-content"},Bo={class:"info-row"},Ho={class:"info-value"},qo={class:"info-row"},zo={class:"info-value"},Jo={key:0,class:"info-row"},Wo={class:"info-value"},Ko={class:"info-row"},Xo={class:"info-value"},Go={__name:"SmartIRDeviceSelector",props:{entityType:{type:String,required:!0},modelValue:{type:Object,default:()=>({})},broadlinkDevices:{type:Array,default:()=>[]}},emits:["update:modelValue","change"],setup(o,{expose:c,emit:d}){const $=o,h=d,r=y([]),m=y([]),g=y(""),I=y(""),_=y(""),E=y(""),w=y(""),l=y(null),L=y(!1),q=y(!1),P=y({manufacturer:"",model:"",controller:""});Ae(async()=>{if(await C(),$.modelValue&&(g.value=$.modelValue.manufacturer||"",I.value=$.modelValue.device_code||"",_.value=$.modelValue.controller_device||"",E.value=$.modelValue.temperature_sensor||"",w.value=$.modelValue.humidity_sensor||"",g.value&&(await s(g.value),I.value&&m.value.length>0))){const M=m.value.find(F=>F.code===I.value);M&&(l.value={code:M.code,manufacturer:g.value,models:M.models,controller:M.controller})}}),ae(()=>$.entityType,async M=>{M&&(g.value="",I.value="",m.value=[],l.value=null,await C())});const C=async()=>{if($.entityType){L.value=!0,P.value.manufacturer="";try{const M=await ee.get("/api/smartir/codes/manufacturers",{params:{entity_type:$.entityType}});if(M.data.success)r.value=M.data.manufacturers||[];else throw new Error(M.data.error||"Failed to load manufacturers")}catch(M){console.error("Error loading manufacturers:",M),P.value.manufacturer="Failed to load manufacturers. Please try again.",r.value=[]}finally{L.value=!1}}},s=async M=>{if(!(!M||!$.entityType)){q.value=!0,P.value.model="";try{const F=await ee.get("/api/smartir/codes/models",{params:{entity_type:$.entityType,manufacturer:M}});if(F.data.success){const te=F.data.models||[];m.value=te.map(ie=>{const be=ie.models&&ie.models.length>0?ie.models.join(", "):`Code ${ie.code}`;return{code:ie.code,label:be,description:`Code: ${ie.code}`,models:ie.models,controller:ie.controller}})}else throw new Error(F.data.error||"Failed to load models")}catch(F){console.error("Error loading models:",F),P.value.model="Failed to load models. Please try again.",m.value=[]}finally{q.value=!1}}},b=async M=>{g.value=M,I.value="",l.value=null,m.value=[],M&&await s(M),B()},f=()=>{const M=m.value.find(F=>F.code===I.value);M&&(l.value={code:M.code,manufacturer:g.value,models:M.models,controller:M.controller}),B()},O=()=>{B()},z=()=>{B()},Y=()=>{B()},B=()=>{var F,te;const M={manufacturer:g.value,model:((te=(F=l.value)==null?void 0:F.models)==null?void 0:te[0])||"",device_code:I.value,controller_device:_.value};$.entityType==="climate"&&(E.value&&(M.temperature_sensor=E.value),w.value&&(M.humidity_sensor=w.value)),h("update:modelValue",M),h("change",M)};return c({validate:()=>{let M=!0;return P.value={manufacturer:"",model:"",controller:""},g.value||(P.value.manufacturer="Manufacturer is required",M=!1),I.value||(P.value.model="Model is required",M=!1),_.value||(P.value.controller="Broadlink controller is required",M=!1),M}}),(M,F)=>(n(),a("div",Ao,[e("div",Oo,[ye(We,{modelValue:g.value,"onUpdate:modelValue":F[0]||(F[0]=te=>g.value=te),options:r.value,label:"Manufacturer",placeholder:"Search manufacturers...",required:"",loading:L.value,error:P.value.manufacturer,hint:"Select the device manufacturer",onChange:b},null,8,["modelValue","options","loading","error"])]),e("div",Lo,[ye(We,{modelValue:I.value,"onUpdate:modelValue":F[1]||(F[1]=te=>I.value=te),options:m.value,"option-label":"label","option-value":"code","option-description":"description",label:"Model",placeholder:"Search models...",required:"",disabled:!g.value,loading:q.value,error:P.value.model,hint:"Select the device model",onChange:f},null,8,["modelValue","options","disabled","loading","error"])]),e("div",Eo,[F[6]||(F[6]=e("label",{for:"controller-device"},[e("i",{class:"mdi mdi-remote"}),T(" Controller Device * ")],-1)),J(e("select",{id:"controller-device","onUpdate:modelValue":F[2]||(F[2]=te=>_.value=te),required:"",onChange:O},[F[5]||(F[5]=e("option",{value:""},"-- Select Controller Device --",-1)),(n(!0),a(ue,null,ke(o.broadlinkDevices,te=>(n(),a("option",{key:te.entity_id,value:te.entity_id},[T(p(te.name||te.entity_id)+" ",1),te.area_name?(n(),a(ue,{key:0},[T(" - "+p(te.area_name),1)],64)):R("",!0)],8,Vo))),128))],544),[[Se,_.value]]),F[7]||(F[7]=e("small",null,"Which remote device will send the IR/RF commands",-1)),P.value.controller?(n(),a("div",Po,p(P.value.controller),1)):R("",!0)]),o.entityType==="climate"?(n(),a(ue,{key:0},[e("div",Uo,[F[8]||(F[8]=e("label",{for:"temperature-sensor"},"Temperature Sensor",-1)),J(e("input",{id:"temperature-sensor","onUpdate:modelValue":F[3]||(F[3]=te=>E.value=te),type:"text",placeholder:"e.g., sensor.living_room_temperature",onInput:z},null,544),[[Me,E.value]]),F[9]||(F[9]=e("small",null,"Optional: Temperature sensor entity for current temperature",-1))]),e("div",jo,[F[10]||(F[10]=e("label",{for:"humidity-sensor"},"Humidity Sensor",-1)),J(e("input",{id:"humidity-sensor","onUpdate:modelValue":F[4]||(F[4]=te=>w.value=te),type:"text",placeholder:"e.g., sensor.living_room_humidity",onInput:Y},null,544),[[Me,w.value]]),F[11]||(F[11]=e("small",null,"Optional: Humidity sensor entity for current humidity",-1))])],64)):R("",!0),l.value?(n(),a("div",Fo,[F[16]||(F[16]=e("div",{class:"info-header"},[e("i",{class:"mdi mdi-information"}),e("span",null,"Selected Device Code")],-1)),e("div",No,[e("div",Bo,[F[12]||(F[12]=e("span",{class:"info-label"},"Code ID:",-1)),e("span",Ho,p(l.value.code_id),1)]),e("div",qo,[F[13]||(F[13]=e("span",{class:"info-label"},"Manufacturer:",-1)),e("span",zo,p(l.value.manufacturer),1)]),l.value.models&&l.value.models.length>0?(n(),a("div",Jo,[F[14]||(F[14]=e("span",{class:"info-label"},"Supported Models:",-1)),e("span",Wo,p(l.value.models.join(", ")),1)])):R("",!0),e("div",Ko,[F[15]||(F[15]=e("span",{class:"info-label"},"Controller:",-1)),e("span",Xo,p(l.value.controller||"Broadlink"),1)])])])):R("",!0)]))}},Yo=we(Go,[["__scopeId","data-v-1911c8f6"]]),Zo={class:"modal-content"},Qo={class:"modal-header"},el={class:"input-wrapper"},tl={key:0,class:"validation-tooltip"},ol={class:"input-wrapper"},ll=["disabled"],nl={key:0,class:"validation-tooltip"},sl={key:0,class:"smartir-notice"},al={key:0,class:"notice-success"},il={key:1,class:"notice-warning"},rl={key:1,class:"smartir-notice"},dl={key:2},ul={class:"form-group"},cl=["disabled"],ml=["disabled"],vl={key:0},pl={key:1},fl={key:2},gl={key:3},yl={key:0,class:"form-group"},bl={class:"area-display-readonly"},hl=["value"],kl=["disabled"],wl=["href"],$l={key:1,class:"form-group"},Cl={class:"form-group"},_l={class:"input-wrapper"},Sl=["value"],Il=["value"],Dl={key:2,class:"validation-tooltip"},Tl={key:0},xl={key:1},Rl={key:3,class:"smartir-section"},Ml={class:"modal-footer"},Al={type:"submit",form:"device-form",class:"btn btn-primary"},Ol={__name:"DeviceForm",props:{device:{type:Object,default:null}},emits:["save","cancel"],setup(o,{emit:c}){const d=o,$=c,h=De("smartirStatus"),r=De("smartirEnabled"),m=W(()=>{var v;return localStorage.getItem("smartir_simulate_not_installed")==="true"?!1:((v=h==null?void 0:h.value)==null?void 0:v.installed)||!1}),g=W(()=>!!d.device),I=W(()=>["climate","media_player","fan","light"].includes(l.value.entity_type)),_=W(()=>m.value?!I.value&&l.value.entity_type?"(Not supported for this type)":"(Pre-configured Codes)":"(Requires SmartIR)"),E=W(()=>{var v;const D=((v=d.device)==null?void 0:v.commands)||{};return Object.keys(D).length>0}),w=W(()=>{if(!l.value.broadlink_entity)return"";const D=s.value.find(v=>v.entity_id===l.value.broadlink_entity);return D&&D.name||l.value.broadlink_entity}),l=y({name:"",entity_type:"",device_type:"broadlink",device:"",area:"",icon:"",broadlink_entity:"",enabled:!0,commands:{}}),L=y({name:"",entity_type:"",broadlink_entity:""}),q=y({}),P=y(null),C=y([]),s=y([]),b=y(null),f=y(null),O=y(null),z=y(!1);Ae(async()=>{d.device&&(l.value={...d.device,device_type:d.device.device_type||"broadlink"},l.value.device_type==="smartir"&&(q.value={manufacturer:d.device.manufacturer,model:d.device.model,device_code:d.device.device_code,controller_device:d.device.controller_device,temperature_sensor:d.device.temperature_sensor,humidity_sensor:d.device.humidity_sensor})),await Promise.all([Y(),B()])});const Y=async()=>{try{const D=await ee.get("/api/areas");C.value=D.data.areas||[]}catch(D){console.error("Error loading areas:",D),C.value=[]}},B=async()=>{try{const v=(await ee.get("/api/remote/devices")).data.devices||[];s.value=v,console.log("Loaded remote devices:",v)}catch(D){console.error("Error loading remote devices:",D),s.value=[]}},le=D=>{if(!D)return"";const v=D.toLowerCase();for(const U of C.value){const pe=U.toLowerCase();if(v.includes(pe))return U}return""},M=(D,v="")=>{const U=v.toLowerCase();return U.includes("tv")?"mdi:television":U.includes("lamp")?"mdi:lamp":U.includes("ceiling")?"mdi:ceiling-light":U.includes("floor")?"mdi:floor-lamp":U.includes("desk")?"mdi:desk-lamp":U.includes("fan")?"mdi:fan":U.includes("ac")||U.includes("air con")?"mdi:air-conditioner":U.includes("heater")?"mdi:radiator":U.includes("blind")?"mdi:blinds":U.includes("curtain")?"mdi:curtains":U.includes("garage")?"mdi:garage":U.includes("speaker")||U.includes("stereo")?"mdi:speaker":U.includes("receiver")?"mdi:audio-video":{light:"mdi:lightbulb",fan:"mdi:fan",switch:"mdi:light-switch",media_player:"mdi:television",cover:"mdi:window-shutter",climate:"mdi:thermostat"}[D]||"mdi:devices"};ae(()=>l.value.name,D=>{if(!g.value&&D&&!l.value.area){const v=le(D);v&&(l.value.area=v)}!g.value&&D&&l.value.entity_type&&(z.value||!l.value.icon)&&(l.value.icon=M(l.value.entity_type,D),z.value=!0)}),ae(()=>l.value.entity_type,D=>{!g.value&&D&&(z.value||!l.value.icon)&&(l.value.icon=M(D,l.value.name),z.value=!0)}),ae(()=>l.value.icon,(D,v)=>{v!==void 0&&D!==v&&!z.value&&(z.value=!1),D||(z.value=!1)});const F=y(!1),te=async()=>{var D;if((D=d.device)!=null&&D.id){F.value=!0;try{const v=await ee.post(`/api/devices/${d.device.id}/sync-area`);v.data.success?(l.value.area=v.data.area||"",v.data.area?console.log(`Area synced: ${v.data.area}`):console.log("No area assigned in Home Assistant")):console.warn(v.data.message||"Entity not found in HA")}catch(v){console.error("Failed to sync area:",v)}finally{F.value=!1}}},ie=()=>{var U;return!((U=d.device)!=null&&U.id)||!l.value.entity_type?"#":`/config/entities/entity/${`${l.value.entity_type}.${d.device.id}`}`},be=()=>{L.value={name:"",entity_type:"",broadlink_entity:""};let D=!0;return(!l.value.name||l.value.name.trim()==="")&&(L.value.name="Device name is required",D=!1),l.value.entity_type||(L.value.entity_type="Entity type is required",D=!1),l.value.device_type==="broadlink"&&!l.value.broadlink_entity&&(L.value.broadlink_entity="Broadlink device is required",D=!1),D},_e=D=>{L.value[D]=""},Te=async()=>{if(l.value.device_type==="smartir"){if(P.value&&!P.value.validate())return;const D={...l.value,smartir_config:{manufacturer:q.value.manufacturer,model:q.value.model,code_id:q.value.device_code,controller_device:q.value.controller_device}};$("save",D)}else{if(!be())return;$("save",{...l.value})}},Ie=D=>{q.value=D};return(D,v)=>(n(),a("div",{class:"modal-overlay",onClick:v[11]||(v[11]=de(U=>D.$emit("cancel"),["self"]))},[e("div",Zo,[e("div",Qo,[e("h2",null,p(g.value?"Edit Device":"Add New Device"),1),e("button",{onClick:v[0]||(v[0]=U=>D.$emit("cancel")),class:"close-btn"},[...v[12]||(v[12]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("form",{id:"device-form",onSubmit:de(Te,["prevent"]),class:"modal-body"},[e("div",{class:G(["form-group",{"has-error":L.value.name}])},[v[14]||(v[14]=e("label",{for:"device-name"},"Device Name *",-1)),e("div",el,[J(e("input",{id:"device-name",ref_key:"nameInput",ref:b,"onUpdate:modelValue":v[1]||(v[1]=U=>l.value.name=U),type:"text",placeholder:"e.g., Living Room TV",onInput:v[2]||(v[2]=U=>_e("name"))},null,544),[[Me,l.value.name]]),L.value.name?(n(),a("div",tl,[v[13]||(v[13]=e("i",{class:"mdi mdi-alert"},null,-1)),T(" "+p(L.value.name),1)])):R("",!0)]),v[15]||(v[15]=e("small",null,"Friendly name for this device",-1))],2),e("div",{class:G(["form-group",{"has-error":L.value.entity_type}])},[v[23]||(v[23]=e("label",{for:"entity-type"},"Entity Type *",-1)),e("div",ol,[J(e("select",{id:"entity-type",ref_key:"typeSelect",ref:f,"onUpdate:modelValue":v[3]||(v[3]=U=>l.value.entity_type=U),onChange:v[4]||(v[4]=U=>_e("entity_type"))},[v[16]||(v[16]=Fe('<option value="" data-v-94bc1fe5>-- Select Type --</option><option value="light" data-v-94bc1fe5>ğŸ’¡ Light</option><option value="fan" data-v-94bc1fe5>ğŸŒ€ Fan</option><option value="switch" data-v-94bc1fe5>ğŸ”Œ Switch</option><option value="media_player" data-v-94bc1fe5>ğŸ“º Media Player</option><option value="cover" data-v-94bc1fe5>ğŸªŸ Cover (Blinds/Curtains)</option>',6)),e("option",{value:"climate",disabled:!m.value}," ğŸŒ¡ï¸ Climate "+p(m.value?"":"(Requires SmartIR)"),9,ll)],544),[[Se,l.value.entity_type]]),L.value.entity_type?(n(),a("div",nl,[v[17]||(v[17]=e("i",{class:"mdi mdi-alert"},null,-1)),T(" "+p(L.value.entity_type),1)])):R("",!0)]),l.value.entity_type==="climate"?(n(),a("div",sl,[m.value?(n(),a("div",al,[...v[18]||(v[18]=[e("i",{class:"mdi mdi-check-circle"},null,-1),e("span",null,"SmartIR detected! Climate entities will be created via SmartIR profiles.",-1)])])):(n(),a("div",il,[...v[19]||(v[19]=[e("i",{class:"mdi mdi-alert"},null,-1),e("div",null,[e("strong",null,"SmartIR Required"),e("p",null,"Climate entities (AC, heaters) require SmartIR integration."),e("a",{href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"smartir-link"}," Install SmartIR â†’ ")],-1)])]))])):m.value&&["media_player","fan","light"].includes(l.value.entity_type)?(n(),a("div",rl,[...v[20]||(v[20]=[e("div",{class:"notice-info"},[e("i",{class:"mdi mdi-information"}),e("span",null,"ğŸ’¡ SmartIR available! You can use pre-configured codes or learn your own.")],-1)])])):!m.value&&l.value.entity_type?(n(),a("small",dl,[v[21]||(v[21]=T(" ğŸ’¡ Tip: Install ",-1)),v[22]||(v[22]=e("a",{href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"inline-link"},"SmartIR",-1)),T(" for pre-configured "+p(l.value.entity_type==="climate"?"climate":l.value.entity_type)+" device codes ",1)])):R("",!0)],2),e("div",ul,[v[26]||(v[26]=e("label",{for:"device-type"},"Device Type *",-1)),J(e("select",{id:"device-type","onUpdate:modelValue":v[5]||(v[5]=U=>l.value.device_type=U),required:"",disabled:g.value},[v[24]||(v[24]=e("option",{value:""},"-- Select Device Type --",-1)),v[25]||(v[25]=e("option",{value:"broadlink"},"ğŸ“¡ Broadlink Device (Learn IR Codes)",-1)),$e(r)?(n(),a("option",{key:0,value:"smartir",disabled:!m.value||!I.value}," ğŸŒ SmartIR Device "+p(_.value),9,ml)):R("",!0)],8,cl),[[Se,l.value.device_type]]),g.value?(n(),a("small",vl,"Cannot change device type after creation")):l.value.device_type==="smartir"?(n(),a("small",pl,"Using pre-configured codes from SmartIR repository")):l.value.device_type==="broadlink"?(n(),a("small",fl,"Learn and store your own IR codes")):(n(),a("small",gl,"Choose how to configure this device"))]),g.value?(n(),a("div",yl,[v[29]||(v[29]=e("label",{for:"device-area"},"Area",-1)),e("div",bl,[e("input",{id:"device-area",value:l.value.area||"Not assigned",type:"text",readonly:"",class:"readonly-input"},null,8,hl),e("button",{type:"button",onClick:te,disabled:F.value,class:"sync-area-btn",title:"Sync area from Home Assistant"},[e("i",{class:G(F.value?"mdi mdi-loading mdi-spin":"mdi mdi-refresh")},null,2)],8,kl)]),e("small",null,[v[27]||(v[27]=e("i",{class:"mdi mdi-information-outline"},null,-1)),v[28]||(v[28]=T(" Set area in Home Assistant, then click sync. ",-1)),e("a",{href:ie(),target:"_blank",class:"inline-link"},"Open in HA â†’",8,wl)])])):(n(),a("div",$l,[...v[30]||(v[30]=[e("div",{class:"info-notice"},[e("i",{class:"mdi mdi-information-outline"}),e("span",null,[e("strong",null,"Area Assignment:"),T(" After generating entities and restarting Home Assistant, you can assign areas in HA and sync them here.")])],-1)])])),e("div",Cl,[v[31]||(v[31]=e("label",{for:"device-icon"},"Icon",-1)),ye(fo,{modelValue:l.value.icon,"onUpdate:modelValue":v[6]||(v[6]=U=>l.value.icon=U),inputId:"device-icon",placeholder:"e.g., mdi:television"},null,8,["modelValue"]),v[32]||(v[32]=e("small",null,"Optional: Material Design Icon name",-1))]),l.value.device_type==="broadlink"?(n(),a("div",{key:2,class:G(["form-group",{"has-error":L.value.broadlink_entity}])},[v[35]||(v[35]=e("label",{for:"broadlink-entity"},"Remote Device *",-1)),e("div",_l,[!g.value||!E.value?J((n(),a("select",{key:0,id:"broadlink-entity",ref_key:"broadlinkSelect",ref:O,"onUpdate:modelValue":v[7]||(v[7]=U=>l.value.broadlink_entity=U),onChange:v[8]||(v[8]=U=>_e("broadlink_entity"))},[v[33]||(v[33]=e("option",{value:""},"-- Select Remote Device --",-1)),(n(!0),a(ue,null,ke(s.value,U=>(n(),a("option",{key:U.entity_id,value:U.entity_id},[T(p(U.name||U.entity_id)+" ",1),U.area_name?(n(),a(ue,{key:0},[T(" - "+p(U.area_name),1)],64)):R("",!0)],8,Sl))),128))],544)),[[Se,l.value.broadlink_entity]]):(n(),a("input",{key:1,id:"broadlink-entity",value:w.value,type:"text",readonly:"",disabled:""},null,8,Il)),L.value.broadlink_entity?(n(),a("div",Dl,[v[34]||(v[34]=e("i",{class:"mdi mdi-alert"},null,-1)),T(" "+p(L.value.broadlink_entity),1)])):R("",!0)]),!g.value||!E.value?(n(),a("small",Tl,"Required: Select which remote device to use for sending commands")):(n(),a("small",xl,"Cannot change remote device after commands are learned"))],2)):R("",!0),l.value.device_type==="smartir"?(n(),a("div",Rl,[v[36]||(v[36]=e("div",{class:"section-header"},[e("i",{class:"mdi mdi-cloud-download"}),e("span",null,"SmartIR Device Configuration")],-1)),ye(Yo,{ref_key:"smartirSelector",ref:P,"entity-type":l.value.entity_type,modelValue:q.value,"onUpdate:modelValue":v[9]||(v[9]=U=>q.value=U),"broadlink-devices":s.value,onChange:Ie},null,8,["entity-type","modelValue","broadlink-devices"])])):R("",!0)],32),e("div",Ml,[e("button",{type:"button",onClick:v[10]||(v[10]=U=>D.$emit("cancel")),class:"btn btn-secondary"}," Cancel "),e("button",Al,[v[37]||(v[37]=e("i",{class:"mdi mdi-check"},null,-1)),T(" "+p(g.value?"Update":"Create"),1)])])])]))}},Ll=we(Ol,[["__scopeId","data-v-94bc1fe5"]]),El={class:"modal-header"},Vl={class:"modal-body"},Pl={class:"message-text"},Ul={key:0,class:"checkbox-option"},jl={class:"modal-footer"},Fl=["disabled"],Nl={__name:"ConfirmDialog",props:{isOpen:{type:Boolean,default:!1},title:{type:String,default:"Confirm"},message:{type:String,required:!0},confirmText:{type:String,default:"OK"},cancelText:{type:String,default:"Cancel"},showCancel:{type:Boolean,default:!0},dangerMode:{type:Boolean,default:!1},confirmDisabled:{type:Boolean,default:!1},checkboxLabel:{type:String,default:""}},emits:["confirm","cancel"],setup(o,{emit:c}){const d=o,$=c,h=y(!1);ae(()=>d.isOpen,g=>{g&&(h.value=!1)});const r=()=>{$("confirm",h.value)},m=()=>{$("cancel")};return(g,I)=>o.isOpen?(n(),a("div",{key:0,class:"modal-overlay",onClick:de(m,["self","stop"])},[e("div",{class:"modal-dialog confirm-dialog",onClick:I[1]||(I[1]=de(()=>{},["stop"]))},[e("div",El,[e("h2",null,p(o.title),1)]),e("div",Vl,[e("p",Pl,p(o.message),1),o.checkboxLabel?(n(),a("div",Ul,[e("label",null,[J(e("input",{type:"checkbox","onUpdate:modelValue":I[0]||(I[0]=_=>h.value=_)},null,512),[[ve,h.value]]),e("span",null,p(o.checkboxLabel),1)])])):R("",!0)]),e("div",jl,[o.showCancel?(n(),a("button",{key:0,onClick:de(m,["stop"]),class:"btn btn-secondary"},p(o.cancelText),1)):R("",!0),o.confirmText?(n(),a("button",{key:1,onClick:de(r,["stop"]),class:G(["btn",o.dangerMode?"btn-danger":"btn-primary"]),disabled:o.confirmDisabled},p(o.confirmText),11,Fl)):R("",!0)])])])):R("",!0)}},je=we(Nl,[["__scopeId","data-v-9cea6cb3"]]),Bl={class:"modal-content"},Hl={class:"modal-header"},ql={class:"modal-body"},zl={key:0,class:"smartir-info"},Jl={key:0,class:"climate-note"},Wl={class:"form-group"},Kl=["value"],Xl={class:"form-group"},Gl=["disabled"],Yl={label:"Suggested Commands"},Zl=["value"],Ql=["disabled"],en={class:"form-group"},tn={class:"radio-group"},on={class:"radio-label"},ln=["disabled"],nn={class:"radio-label"},sn=["disabled"],an={class:"form-group"},rn={class:"radio-group"},dn={class:"radio-label"},un=["disabled"],cn={class:"radio-label"},mn=["disabled"],vn={class:"radio-label"},pn=["disabled"],fn={key:0,class:"help-box"},gn={class:"learn-action"},yn=["disabled"],bn={key:0,class:"mdi mdi-loading mdi-spin"},hn={key:1,class:"mdi mdi-remote-tv"},kn={key:0,class:"learning-status"},wn={key:0},$n={key:1},Cn={key:2,class:"rf-instructions"},_n={key:0},Sn={key:1,class:"rf-action"},In={key:2,class:"rf-status"},Dn={key:3,class:"rf-success"},Tn={key:1,class:"result-message success"},xn={key:2,class:"section-divider"},Rn={key:3,class:"loading-commands"},Mn={key:4,class:"learned-commands"},An={class:"command-list"},On={class:"command-info"},Ln={class:"command-name"},En={class:"command-right"},Vn=["title"],Pn={class:"command-actions"},Un=["onClick","disabled"],jn=["onClick"],Fn={key:5,class:"untracked-commands"},Nn={class:"command-list"},Bn={class:"command-name"},Hn={class:"modal-footer"},qn=["disabled"],zn={__name:"CommandLearner",props:{device:{type:Object,required:!0}},emits:["cancel","learned"],setup(o,{emit:c}){const d=o,$=c,h=y([]),r=y(""),m=y(""),g=y(""),I=y("ir"),_=y("manager_only"),E=y(!1),w=y(!1),l=y(""),L=y(""),q=y(""),P=y("success"),C=y([]),s=y([]),b=y(!1),f=y(!1),O=y(""),z=y(!1),Y=y(null),B=y(null),le=y(""),M=y(""),F=W(()=>d.device.device_type==="smartir");W(()=>{if(F.value)return!1;const A=m.value==="__custom__"?g.value:m.value;return r.value&&A.trim()});const te=()=>{Y.value&&Y.value.setCustomValidity("")},ie=()=>{B.value&&B.value.setCustomValidity("")},be=W(()=>{const A=h.value.find(t=>t.entity_id===r.value);return A?A.name||A.entity_id:r.value}),_e={light:["turn_on","turn_off","toggle","brightness_up","brightness_down","dim","bright"],fan:["turn_on","turn_off","toggle","speed_low","speed_medium","speed_high","speed_1","speed_2","speed_3","speed_4","speed_5","oscillate_on","oscillate_off","direction_forward","direction_reverse"],switch:["turn_on","turn_off","toggle"],media_player:["turn_on","turn_off","toggle","volume_up","volume_down","volume_mute","play","pause","stop","play_pause","next_track","previous_track","channel_up","channel_down","source_hdmi1","source_hdmi2","source_hdmi3","source_tv","source_aux","source_bluetooth","menu","home","back","select","arrow_up","arrow_down","arrow_left","arrow_right"],cover:["open","close","stop","open_tilt","close_tilt","position_0","position_25","position_50","position_75","position_100"]},Te=W(()=>{const A=d.device.entity_type||"switch";return _e[A]||_e.switch});ae(()=>d.device,async(A,t)=>{if(A&&t&&A.id===t.id){const u=Object.keys(A.commands||{}).length,V=Object.keys(t.commands||{}).length;u!==V&&(console.log(`ğŸ”„ Device commands changed (${V} -> ${u}), reloading...`),await D(!0))}},{deep:!0}),Ae(async()=>{await Ie(),await D(),Y.value&&(Y.value.setCustomValidity(""),Y.value.oninvalid=()=>{Y.value.setCustomValidity("Command name is required")}),d.device.broadlink_entity&&(r.value=d.device.broadlink_entity)}),ae(m,async A=>{A==="__custom__"&&(await ot(),B.value&&(B.value.setCustomValidity(""),B.value.oninvalid=()=>{B.value.setCustomValidity("Custom command name is required")}))});const Ie=async()=>{try{const A=await ee.get("/api/broadlink/devices");h.value=A.data.devices||[]}catch(A){console.error("Error loading Broadlink devices:",A)}},D=async(A=!1)=>{var t,u;b.value=!0;try{if(F.value){const V=await ee.get("/api/smartir/codes/code",{params:{entity_type:d.device.entity_type,code_id:d.device.device_code}});if(V.data.success&&V.data.code){const X=V.data.code.commands||{},x=V.data.code.commandType||"ir";if(d.device.entity_type==="climate"){const i=[];for(const[j,K]of Object.entries(X))typeof K=="string"?i.push({name:j,type:x}):typeof K=="object"&&K!==null&&Object.keys(K).sort((se,oe)=>parseInt(se)-parseInt(oe)).forEach(se=>{i.push({name:`${j}_${se}`,type:x,label:`${j.charAt(0).toUpperCase()+j.slice(1)} ${se}Â°C`})});C.value=i}else C.value=Object.keys(X).map(i=>({name:i,type:x}))}}else{if(console.log("ğŸ“‹ Loading commands for device:",d.device),console.log("ğŸ“‹ Device ID:",d.device.id),console.log("ğŸ“‹ Force reload:",A),A&&d.device.id){console.log("ğŸ”„ Force reloading commands from API after sync");try{const X=(await ee.get(`/api/commands/${d.device.id}`)).data.commands||{};console.log("ğŸ“¦ Raw commands from API:",X),C.value=Object.entries(X).map(([x,i])=>{console.log(`  Command '${x}':`,i,`(type: ${typeof i})`);const j=typeof i=="object"&&i!==null&&(i.command_type||i.type)||"ir";return{name:x,type:j}}),console.log("ğŸ“‹ Reloaded commands:",C.value)}catch(V){if(console.error("âŒ Error loading commands:",V),((t=V.response)==null?void 0:t.status)===404)console.log("â„¹ï¸ No commands found for device"),C.value=[];else throw V}}else if(d.device.commands&&Object.keys(d.device.commands).length>0)console.log("âœ… Using commands from device object"),C.value=Object.entries(d.device.commands).map(([V,X])=>({name:V,type:X.command_type||X.type||"ir"}));else if(d.device.commands!==void 0)console.log("â„¹ï¸ Device has empty commands object - skipping API call"),C.value=[];else if(d.device.id){console.log("ğŸŒ Fetching commands from API for device ID:",d.device.id);try{const X=(await ee.get(`/api/commands/${d.device.id}`)).data.commands||{};C.value=Object.entries(X).map(([x,i])=>({name:x,type:i.command_type||i.type||"ir"}))}catch(V){if(((u=V.response)==null?void 0:u.status)===404)console.log("â„¹ï¸ No commands found for device (this is normal for new devices)"),C.value=[];else throw V}}else console.log("âš ï¸ No commands found and no device ID");console.log("ğŸ“‹ Final learned commands:",C.value)}}catch(V){console.error("Error loading commands:",V)}finally{b.value=!1}},v=async()=>{q.value="",P.value="",L.value="",w.value=!0,l.value="preparing";try{const A=m.value==="__custom__"?g.value:m.value;l.value="learning";const t=await ee.post("/api/commands/learn",{device_id:d.device.id,entity_id:r.value||d.device.broadlink_entity,device:d.device.device||d.device.id,command:A.trim(),command_type:I.value,save_destination:_.value});if(t.data.success){l.value="complete",q.value=t.data.message||`Command "${A}" learned successfully!`,P.value="success",C.value.find(X=>X.name===A)||C.value.push({name:A,type:I.value});const V=s.value.indexOf(A);V>-1&&s.value.splice(V,1),ge(),m.value="",g.value="",$("learned",{deviceId:d.device.id,commandName:A,commandType:I.value}),w.value=!1,l.value=""}else throw new Error(t.data.error||"Failed to learn command")}catch(A){console.error("Learning error:",A),q.value=A.message||"Error learning command",P.value="error",w.value=!1,l.value=""}},U=async A=>{var t,u;try{M.value=A,le.value="";let V=d.device.id.split(".")[1];d.device.device&&(V=d.device.device);const X=F.value?d.device.controller_device:r.value||d.device.broadlink_entity;if(!X){console.error("Missing entity_id for test command:",{isSmartIR:F.value,controller_device:d.device.controller_device,broadlink_entity:d.device.broadlink_entity,selectedBroadlink:r.value,device:d.device}),q.value="Missing Broadlink remote entity. Please select a Broadlink device.",P.value="error",M.value="";return}const x={device_id:d.device.id,entity_id:X,command:A,device:d.device.device||d.device.id};console.log("ğŸ§ª Testing command:",x),(await ee.post("/api/commands/test",x)).data.success&&(le.value=A,setTimeout(()=>{le.value===A&&(le.value="")},2e3))}catch(V){console.error("âŒ Test command error:",V);const X=((u=(t=V.response)==null?void 0:t.data)==null?void 0:u.error)||V.message||"Unknown error";q.value=`Failed to send command: ${X}`,P.value="error"}finally{M.value=""}},pe=A=>{O.value=A,f.value=!0},Oe=()=>{f.value=!1,O.value=""},fe=async A=>{const t=O.value;f.value=!1;try{if(console.log(`ğŸ—‘ï¸ Deleting command: ${t}, alsoDeleteFromIntegration: ${A}`),await ee.delete(`/api/commands/${d.device.id}/${t}`),A)try{const u=d.device.device||d.device.id;await ee.post("/api/commands/delete-from-storage",{device:u,command:t}),console.log("âœ… Also deleted from Broadlink Integration storage")}catch(u){console.warn("âš ï¸ Failed to delete from Broadlink Integration storage:",u)}await D(!0),await ge(),q.value=`Command "${t}" deleted`,P.value="success",$("learned",{deviceId:d.device.id,commandName:t,action:"deleted"})}catch(u){console.error("âŒ Delete error:",u),q.value=`Failed to delete command: ${u.message}`,P.value="error",await D(!0)}finally{O.value=""}},ge=async()=>{try{let A=d.device.device;A||(A=d.device.id.includes(".")?d.device.id.split(".")[1]:d.device.id),console.log("ğŸ” Looking for untracked commands for device:",A);const u=(await ee.get("/api/commands/untracked")).data.untracked||{};console.log("ğŸ“¦ All untracked commands:",Object.keys(u)),console.log("ğŸ“¦ Untracked for this device:",u[A]),u[A]?s.value=Object.keys(u[A].commands):s.value=[]}catch(A){console.error("Error loading untracked commands:",A),s.value=[]}},xe=()=>{s.value.length!==0&&(z.value=!0)},Le=async()=>{var A;console.log("ğŸ”µ [IMPORT] Starting import process..."),console.log("ğŸ”µ [IMPORT] Current learned commands:",C.value.length),console.log("ğŸ”µ [IMPORT] Current untracked commands:",s.value.length),z.value=!1;try{const t=d.device.device||d.device.id||((A=d.device.id)!=null&&A.includes(".")?d.device.id.split(".")[1]:null);if(console.log("ğŸ”µ [IMPORT] Device object:",d.device),console.log("ğŸ”µ [IMPORT] Extracted device name:",t),!t)throw new Error("Could not determine device name for import");console.log("ğŸ”µ [IMPORT] Calling API to import commands...");const u=await ee.post("/api/commands/import",{device_id:d.device.id,source_device:t,commands:s.value});console.log("ğŸ”µ [IMPORT] API response:",u.data),u.data.success&&(q.value=`Imported ${u.data.imported_count} commands successfully!`,P.value="success",console.log("ğŸ”µ [IMPORT] Import successful, now reloading commands..."),console.log("ğŸ”µ [IMPORT] BEFORE reload - learned:",C.value.length,"untracked:",s.value.length),await D(!0),console.log("ğŸ”µ [IMPORT] AFTER loadLearnedCommands - learned:",C.value.length),await ge(),console.log("ğŸ”µ [IMPORT] AFTER loadUntrackedCommands - untracked:",s.value.length),console.log("ğŸ”µ [IMPORT] Final state - learned:",C.value,"untracked:",s.value),console.log("ğŸ”µ [IMPORT] Emitting learned event to parent..."),$("learned",{deviceId:d.device.id,action:"imported",count:u.data.imported_count}),console.log("ğŸ”µ [IMPORT] âœ… Import process complete!"))}catch(t){console.error("ğŸ”µ [IMPORT] âŒ Import failed:",t),q.value=`Failed to import commands: ${t.message}`,P.value="error"}};return(A,t)=>(n(),a("div",{class:"modal-overlay",onClick:t[11]||(t[11]=de(u=>A.$emit("cancel"),["self"]))},[e("div",Bl,[e("div",Hl,[e("h2",null,p(F.value?"Commands for":"Learn Commands for")+" "+p(o.device.name),1),e("button",{onClick:t[0]||(t[0]=u=>A.$emit("cancel")),class:"close-btn"},[...t[12]||(t[12]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",ql,[F.value?(n(),a("div",zl,[t[17]||(t[17]=e("i",{class:"mdi mdi-information"},null,-1)),e("div",null,[t[16]||(t[16]=e("h3",null,"SmartIR Device",-1)),e("p",null,[t[13]||(t[13]=T("This device uses SmartIR code file ",-1)),e("strong",null,p(o.device.device_code),1),t[14]||(t[14]=T(". Commands are pre-configured and cannot be learned.",-1))]),o.device.entity_type==="climate"?(n(),a("p",Jl,[...t[15]||(t[15]=[e("i",{class:"mdi mdi-alert-circle-outline"},null,-1),e("strong",null,"Note:",-1),T(" Climate device commands are temperature-based. Testing individual modes may not work as expected. Use the Home Assistant climate card to control your device. ",-1)])])):R("",!0)])])):(n(),a("form",{key:1,onSubmit:de(v,["prevent"])},[e("div",Wl,[t[18]||(t[18]=e("label",{for:"broadlink-entity"},"Broadlink Device",-1)),e("input",{id:"broadlink-entity",value:be.value,type:"text",readonly:"",disabled:""},null,8,Kl),t[19]||(t[19]=e("small",null,"Commands will be learned using this device (set when device was created)",-1))]),e("div",Xl,[t[22]||(t[22]=e("label",{for:"command-name"},"Command Name *",-1)),J(e("select",{id:"command-name",ref_key:"commandSelect",ref:Y,"onUpdate:modelValue":t[1]||(t[1]=u=>m.value=u),disabled:w.value,required:"",onChange:te},[t[20]||(t[20]=e("option",{value:""},"-- Select or type command --",-1)),e("optgroup",Yl,[(n(!0),a(ue,null,ke(Te.value,u=>(n(),a("option",{key:u,value:u},p(u),9,Zl))),128))]),t[21]||(t[21]=e("option",{value:"__custom__"},"Custom command...",-1))],40,Gl),[[Se,m.value]]),m.value==="__custom__"?J((n(),a("input",{key:0,ref_key:"customCommandInput",ref:B,"onUpdate:modelValue":t[2]||(t[2]=u=>g.value=u),type:"text",placeholder:"Enter custom command name",disabled:w.value,required:"",class:"custom-command-input",onInput:ie},null,40,Ql)),[[Me,g.value]]):R("",!0),e("small",null,"Select a suggested command for "+p(o.device.entity_type||"this device")+", or enter a custom one.",1)]),e("div",en,[t[25]||(t[25]=e("label",null,"Command Type",-1)),e("div",tn,[e("label",on,[J(e("input",{type:"radio","onUpdate:modelValue":t[3]||(t[3]=u=>I.value=u),value:"ir",disabled:w.value},null,8,ln),[[Ne,I.value]]),t[23]||(t[23]=e("span",null,"IR (Infrared)",-1))]),e("label",nn,[J(e("input",{type:"radio","onUpdate:modelValue":t[4]||(t[4]=u=>I.value=u),value:"rf",disabled:w.value},null,8,sn),[[Ne,I.value]]),t[24]||(t[24]=e("span",null,"RF (Radio Frequency)",-1))])])]),e("div",an,[e("label",null,[t[27]||(t[27]=T(" Save Destination ",-1)),e("button",{type:"button",class:"help-btn",onClick:t[5]||(t[5]=u=>E.value=!E.value),title:"Learn more"},[...t[26]||(t[26]=[e("i",{class:"mdi mdi-help-circle-outline"},null,-1)])])]),e("div",rn,[e("label",dn,[J(e("input",{type:"radio","onUpdate:modelValue":t[6]||(t[6]=u=>_.value=u),value:"manager_only",disabled:w.value},null,8,un),[[Ne,_.value]]),t[28]||(t[28]=e("span",null,"Only Save to Broadlink Manager",-1))]),e("label",cn,[J(e("input",{type:"radio","onUpdate:modelValue":t[7]||(t[7]=u=>_.value=u),value:"integration_only",disabled:w.value},null,8,mn),[[Ne,_.value]]),t[29]||(t[29]=e("span",null,"Only Save to Broadlink Integration",-1))]),e("label",vn,[J(e("input",{type:"radio","onUpdate:modelValue":t[8]||(t[8]=u=>_.value=u),value:"both",disabled:w.value},null,8,pn),[[Ne,_.value]]),t[30]||(t[30]=e("span",null,"Save to Both",-1))])]),E.value?(n(),a("div",fn,[...t[31]||(t[31]=[e("h4",null,"Save Destination Options",-1),e("ul",null,[e("li",null,[e("strong",null,"Only Save to Broadlink Manager (Recommended):"),T(" Commands are saved only in this app's database (devices.json). This gives you full control and makes commands portable. The Broadlink Integration won't see these commands.")]),e("li",null,[e("strong",null,"Only Save to Broadlink Integration:"),T(" Commands are saved only in Home Assistant's Broadlink Integration storage. This app won't track these commands, but they'll be available to the Broadlink Integration's remote.send_command service.")]),e("li",null,[e("strong",null,"Save to Both:"),T(" Commands are saved in both places. Use this if you want commands available in both this app and the Broadlink Integration.")])],-1)])])):R("",!0)]),e("div",gn,[e("button",{type:"submit",class:"btn btn-primary btn-large",disabled:w.value},[w.value?(n(),a("i",bn)):(n(),a("i",hn)),T(" "+p(w.value?"Learning...":"Learn Command"),1)],8,yn)]),w.value?(n(),a("div",kn,[t[37]||(t[37]=e("i",{class:"mdi mdi-loading mdi-spin"},null,-1)),l.value==="preparing"?(n(),a("div",wn,[...t[32]||(t[32]=[e("p",null,[e("strong",null,"Preparing device...")],-1),e("small",null,"Connecting and authenticating with Broadlink device (this takes a few seconds)",-1)])])):I.value==="ir"?(n(),a("div",$n,[...t[33]||(t[33]=[e("p",null,[e("strong",null,"Ready!"),T(" Point your remote at the Broadlink device and press the button...")],-1),e("small",null,"This may take up to 30 seconds",-1)])])):I.value==="rf"?(n(),a("div",Cn,[L.value?R("",!0):(n(),a("p",_n,[...t[34]||(t[34]=[e("strong",null,"RF Learning - Single Action:",-1)])])),L.value?R("",!0):(n(),a("div",Sn,[...t[35]||(t[35]=[e("strong",null,"Press and HOLD the button for 2-3 seconds, then RELEASE",-1)])])),L.value?(n(),a("div",In,[e("strong",null,p(L.value),1)])):R("",!0),l.value==="captured"?(n(),a("div",Dn,[...t[36]||(t[36]=[e("i",{class:"mdi mdi-check-circle"},null,-1),e("span",null,"Signal captured! Saving...",-1)])])):R("",!0)])):R("",!0)])):R("",!0),q.value&&P.value==="success"&&!q.value.includes("sent successfully")?(n(),a("div",Tn,[t[38]||(t[38]=e("i",{class:"mdi mdi-check-circle"},null,-1)),e("p",null,p(q.value),1)])):R("",!0)],32)),C.value.length>0||s.value.length>0?(n(),a("div",xn)):R("",!0),b.value?(n(),a("div",Rn,[...t[39]||(t[39]=[e("div",{class:"loading-spinner"},[e("i",{class:"mdi mdi-loading mdi-spin"}),e("p",null,"Loading commands...")],-1)])])):C.value.length>0?(n(),a("div",Mn,[e("h3",null,"Tracked Commands ("+p(C.value.length)+")",1),e("div",An,[(n(!0),a(ue,null,ke(C.value,u=>(n(),a("div",{key:u.name,class:"command-item"},[e("div",On,[e("span",Ln,p(u.label||u.name),1)]),e("div",En,[e("i",{class:"mdi mdi-check-circle learned-icon",title:`Learned (${(u.type||"ir").toUpperCase()})`},null,8,Vn),e("span",{class:G(["command-type-badge",u.type||"ir"])},p((u.type||"ir").toUpperCase()),3),e("div",Pn,[e("button",{type:"button",onClick:V=>U(u.name),class:"icon-btn",title:"Test command",disabled:M.value===u.name},[e("i",{class:G(["mdi mdi-play",{"mdi-spin":M.value===u.name}])},null,2)],8,Un),e("button",{type:"button",onClick:V=>pe(u.name),class:"icon-btn danger",title:"Delete and re-learn"},[...t[40]||(t[40]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,jn)])])]))),128))])])):R("",!0),s.value.length>0?(n(),a("div",Fn,[e("h3",null,[t[41]||(t[41]=e("i",{class:"mdi mdi-alert"},null,-1)),T(" Untracked Commands ("+p(s.value.length)+") ",1)]),t[44]||(t[44]=e("p",{class:"untracked-info"}," These commands exist in Broadlink storage but are not tracked in this device. ",-1)),e("div",Nn,[(n(!0),a(ue,null,ke(s.value,u=>(n(),a("div",{key:u,class:"command-item untracked"},[e("span",Bn,p(u),1),t[42]||(t[42]=e("span",{class:"untracked-badge"},"Not tracked",-1))]))),128))]),e("button",{type:"button",onClick:xe,class:"btn btn-secondary"},[...t[43]||(t[43]=[e("i",{class:"mdi mdi-import"},null,-1),T(" Import All Untracked Commands ",-1)])])])):R("",!0)]),e("div",Hn,[e("button",{type:"button",onClick:t[9]||(t[9]=u=>A.$emit("cancel")),class:"btn btn-secondary",disabled:w.value}," Close ",8,qn)])]),ye(je,{isOpen:f.value,title:"Delete Command?",message:`Delete command '${O.value}' from Broadlink Manager?`,checkboxLabel:"Also delete from Broadlink Integration storage",confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,onConfirm:fe,onCancel:Oe},null,8,["isOpen","message"]),ye(je,{isOpen:z.value,title:"Import Commands?",message:`Import ${s.value.length} untracked command${s.value.length>1?"s":""} into this device?`,confirmText:"Import",cancelText:"Cancel",onConfirm:Le,onCancel:t[10]||(t[10]=u=>z.value=!1)},null,8,["isOpen","message"])]))}},Jn=we(zn,[["__scopeId","data-v-6e39b7cd"]]),Wn={class:"modal-container error-dialog"},Kn={class:"modal-header"},Xn={class:"modal-body"},Gn={class:"error-message"},Yn={key:0,class:"error-suggestion"},Zn=["open"],Qn={class:"debug-content"},es={class:"debug-info"},ts={key:0,class:"debug-section-title"},os={key:1},ls={__name:"ErrorDialog",props:{isOpen:{type:Boolean,default:!1},title:{type:String,default:"Error"},message:{type:String,required:!0},suggestion:{type:String,default:""},details:{type:String,default:""},error:{type:Object,default:null},context:{type:Object,default:()=>({})}},emits:["close"],setup(o,{emit:c}){const d=o,$=c,h=De("toast"),r=y(!1),m=()=>{$("close")},g=W(()=>{var L,q,P,C,s,b,f,O,z,Y,B;const w=new Date().toISOString(),l=d.error||{};return{error:JSON.stringify({message:d.message,title:d.title,details:d.details,errorObject:l.message||l.toString(),timestamp:w},null,2),request:JSON.stringify({method:((q=(L=l.config)==null?void 0:L.method)==null?void 0:q.toUpperCase())||"N/A",url:((P=l.config)==null?void 0:P.url)||"N/A",baseURL:((C=l.config)==null?void 0:C.baseURL)||"N/A",headers:((s=l.config)==null?void 0:s.headers)||{},data:(b=l.config)!=null&&b.data?JSON.parse(l.config.data):"N/A",params:((f=l.config)==null?void 0:f.params)||{}},null,2),response:JSON.stringify({status:((O=l.response)==null?void 0:O.status)||"N/A",statusText:((z=l.response)==null?void 0:z.statusText)||"N/A",data:((Y=l.response)==null?void 0:Y.data)||"N/A",headers:((B=l.response)==null?void 0:B.headers)||{}},null,2),browser:JSON.stringify({userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language,cookieEnabled:navigator.cookieEnabled,onLine:navigator.onLine,viewport:`${window.innerWidth}x${window.innerHeight}`,screenResolution:`${window.screen.width}x${window.screen.height}`,colorDepth:window.screen.colorDepth,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,timestamp:w},null,2),appState:JSON.stringify({currentRoute:window.location.pathname,currentURL:window.location.href,referrer:document.referrer||"N/A",context:d.context||{},localStorage:{smartir_simulate:localStorage.getItem("smartir_simulate_not_installed"),theme:localStorage.getItem("theme")}},null,2),stackTrace:l.stack||null}}),I=async()=>{const w=E();try{await navigator.clipboard.writeText(w),h==null||h.success("Debug information copied to clipboard","âœ… Copied")}catch(l){console.error("Failed to copy:",l),h==null||h.error("Failed to copy to clipboard","âŒ Copy Failed")}},_=()=>{const w=E(),l=new Blob([w],{type:"text/plain"}),L=URL.createObjectURL(l),q=document.createElement("a");q.href=L;const P=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5);q.download=`broadlink-manager-error-${P}.txt`,document.body.appendChild(q),q.click(),document.body.removeChild(q),URL.revokeObjectURL(L),h==null||h.success("Debug report downloaded","âœ… Downloaded")},E=()=>`Broadlink Manager - Error Report
${"=".repeat(60)}

Generated: ${new Date().toISOString()}
Title: ${d.title}
Message: ${d.message}
${d.suggestion?`Suggestion: ${d.suggestion}
`:""}
${"=".repeat(60)}

ERROR DETAILS
${"-".repeat(60)}
${g.value.error}

REQUEST INFORMATION
${"-".repeat(60)}
${g.value.request}

RESPONSE INFORMATION
${"-".repeat(60)}
${g.value.response}

BROWSER INFORMATION
${"-".repeat(60)}
${g.value.browser}

APPLICATION STATE
${"-".repeat(60)}
${g.value.appState}

${g.value.stackTrace?`STACK TRACE
${"-".repeat(60)}
${g.value.stackTrace}

`:""}
${"=".repeat(60)}
End of Report
`;return ae(()=>d.isOpen,w=>{if(w){const l=L=>{L.key==="Escape"&&m()};return document.addEventListener("keydown",l),()=>document.removeEventListener("keydown",l)}}),(w,l)=>(n(),Pe(lt,{to:"body"},[ye(tt,{name:"modal"},{default:Ye(()=>[o.isOpen?(n(),a("div",{key:0,class:"modal-overlay",onClick:de(m,["self"])},[e("div",Wn,[e("div",Kn,[l[2]||(l[2]=e("div",{class:"header-icon error-icon"},[e("i",{class:"mdi mdi-alert-circle"})],-1)),e("h3",null,p(o.title),1),e("button",{onClick:m,class:"close-button"},[...l[1]||(l[1]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Xn,[e("p",Gn,p(o.message),1),o.suggestion?(n(),a("p",Yn,[l[3]||(l[3]=e("i",{class:"mdi mdi-lightbulb-on"},null,-1)),T(" "+p(o.suggestion),1)])):R("",!0),e("details",{class:"debug-section",open:r.value},[e("summary",{onClick:l[0]||(l[0]=L=>r.value=!r.value)},[e("i",{class:G(["mdi",r.value?"mdi-chevron-down":"mdi-chevron-right"])},null,2),l[4]||(l[4]=T(" Debug Information ",-1))]),e("div",Qn,[e("div",{class:"debug-actions"},[e("button",{onClick:I,class:"btn-debug btn-copy"},[...l[5]||(l[5]=[e("i",{class:"mdi mdi-content-copy"},null,-1),T(" Copy to Clipboard ",-1)])]),e("button",{onClick:_,class:"btn-debug btn-download"},[...l[6]||(l[6]=[e("i",{class:"mdi mdi-download"},null,-1),T(" Download Report ",-1)])])]),e("div",es,[l[7]||(l[7]=e("div",{class:"debug-section-title"},"Error Details",-1)),e("pre",null,p(g.value.error),1),l[8]||(l[8]=e("div",{class:"debug-section-title"},"Request Information",-1)),e("pre",null,p(g.value.request),1),l[9]||(l[9]=e("div",{class:"debug-section-title"},"Response Information",-1)),e("pre",null,p(g.value.response),1),l[10]||(l[10]=e("div",{class:"debug-section-title"},"Browser Information",-1)),e("pre",null,p(g.value.browser),1),l[11]||(l[11]=e("div",{class:"debug-section-title"},"Application State",-1)),e("pre",null,p(g.value.appState),1),g.value.stackTrace?(n(),a("div",ts,"Stack Trace")):R("",!0),g.value.stackTrace?(n(),a("pre",os,p(g.value.stackTrace),1)):R("",!0)])])],8,Zn)]),e("div",{class:"modal-footer"},[e("button",{onClick:m,class:"btn btn-primary"}," OK ")])])])):R("",!0)]),_:1})]))}},ns=we(ls,[["__scopeId","data-v-23858149"]]),ss={key:0,class:"discovery-banner"},as={class:"banner-content"},is={class:"banner-text"},rs={class:"modal-dialog"},ds={class:"modal-header"},us={class:"modal-body"},cs={class:"device-list"},ms={class:"device-info"},vs={class:"device-details"},ps={class:"command-count"},fs={class:"device-actions"},gs=["onClick"],ys=["onClick"],bs={class:"modal-footer"},hs={class:"modal-dialog modal-dialog-small"},ks={class:"modal-header"},ws={class:"modal-body"},$s={class:"warning-message"},Cs={class:"modal-footer"},_s=["disabled"],Ss=["disabled"],Is={__name:"DeviceDiscovery",emits:["adopt"],setup(o,{expose:c,emit:d}){const $=He(),h=d,r=y([]),m=y(!1),g=y(!1),I=y(null),_=y(!1),E=W(()=>r.value.length>0);Ae(async()=>{await w()});const w=async()=>{try{const P=await ee.get("/api/devices/discover");r.value=P.data.untracked_devices||[]}catch(P){console.error("Error loading untracked devices:",P),r.value=[]}},l=P=>{m.value=!1,h("adopt",P)},L=P=>{I.value=P,g.value=!0},q=async()=>{if(!I.value)return;const P=I.value.device_name;_.value=!0;try{const C=await ee.delete(`/api/devices/untracked/${encodeURIComponent(P)}`);if(C.data.success)r.value=r.value.filter(s=>s.device_name!==P),g.value=!1,I.value=null,r.value.length===0&&(m.value=!1),$.success(`Deleted all commands for '${P}'`);else throw new Error(C.data.error||"Failed to delete device")}catch(C){console.error("Error deleting device:",C),$.error(`Failed to delete device: ${C.message}`)}finally{_.value=!1}};return c({refresh:w}),(P,C)=>{var s,b,f;return E.value?(n(),a("div",ss,[e("div",as,[C[9]||(C[9]=e("div",{class:"banner-icon"},[e("i",{class:"mdi mdi-radar"})],-1)),e("div",is,[C[7]||(C[7]=e("h3",null,"Untracked Devices Found",-1)),e("p",null,p(r.value.length)+" device"+p(r.value.length>1?"s":"")+" with learned commands found in Broadlink storage",1)]),e("button",{onClick:C[0]||(C[0]=O=>m.value=!0),class:"btn btn-primary"},[...C[8]||(C[8]=[e("i",{class:"mdi mdi-eye"},null,-1),T(" View Devices ",-1)])])]),m.value?(n(),a("div",{key:0,class:"modal-overlay",onClick:C[3]||(C[3]=de(O=>m.value=!1,["self"]))},[e("div",rs,[e("div",ds,[C[11]||(C[11]=e("h2",null,"Discovered Devices",-1)),e("button",{onClick:C[1]||(C[1]=O=>m.value=!1),class:"close-btn"},[...C[10]||(C[10]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",us,[C[16]||(C[16]=e("p",{class:"info-text"}," These devices have learned commands in Broadlink storage but are not being tracked. Adopt them to manage their commands and generate Home Assistant entities. ",-1)),e("div",cs,[(n(!0),a(ue,null,ke(r.value,O=>(n(),a("div",{key:O.device_name,class:"discovered-device"},[e("div",ms,[C[13]||(C[13]=e("div",{class:"device-icon"},[e("i",{class:"mdi mdi-devices"})],-1)),e("div",vs,[e("h4",null,p(O.device_name),1),e("span",ps,[C[12]||(C[12]=e("i",{class:"mdi mdi-remote"},null,-1)),T(" "+p(O.command_count)+" command"+p(O.command_count>1?"s":""),1)])])]),e("div",fs,[e("button",{onClick:z=>l(O),class:"btn btn-primary"},[...C[14]||(C[14]=[e("i",{class:"mdi mdi-plus"},null,-1),T(" Adopt ",-1)])],8,gs),e("button",{onClick:z=>L(O),class:"btn btn-danger",title:"Delete all commands"},[...C[15]||(C[15]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,ys)])]))),128))])]),e("div",bs,[e("button",{onClick:C[2]||(C[2]=O=>m.value=!1),class:"btn btn-secondary"}," Close ")])])])):R("",!0),g.value?(n(),a("div",{key:1,class:"modal-overlay",onClick:C[6]||(C[6]=de(O=>g.value=!1,["self"]))},[e("div",hs,[e("div",ks,[C[18]||(C[18]=e("h2",null,"Delete Untracked Device",-1)),e("button",{onClick:C[4]||(C[4]=O=>g.value=!1),class:"close-btn"},[...C[17]||(C[17]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",ws,[e("div",$s,[C[20]||(C[20]=e("i",{class:"mdi mdi-alert"},null,-1)),e("div",null,[e("p",null,[e("strong",null,'Are you sure you want to delete "'+p((s=I.value)==null?void 0:s.device_name)+'"?',1)]),e("p",null,"This will permanently delete all "+p((b=I.value)==null?void 0:b.command_count)+" command"+p(((f=I.value)==null?void 0:f.command_count)>1?"s":"")+" from Broadlink storage.",1),C[19]||(C[19]=e("p",{class:"warning-text"},"This action cannot be undone.",-1))])])]),e("div",Cs,[e("button",{onClick:C[5]||(C[5]=O=>g.value=!1),class:"btn btn-secondary",disabled:_.value}," Cancel ",8,_s),e("button",{onClick:q,class:"btn btn-danger",disabled:_.value},[e("i",{class:G(["mdi",_.value?"mdi-loading mdi-spin":"mdi-delete"])},null,2),T(" "+p(_.value?"Deleting...":"Delete"),1)],8,Ss)])])])):R("",!0)])):R("",!0)}}},Ds=we(Is,[["__scopeId","data-v-783e943f"]]),Ts={class:"device-list-card"},xs={class:"card-header"},Rs={class:"header-badges"},Ms={class:"header-info"},As={class:"header-right"},Os={key:0,class:"view-toggle-group header-view-toggle"},Ls={class:"settings-menu-container"},Es=["disabled"],Vs=["disabled"],Ps={class:"card-body"},Us={key:0,class:"filter-bar"},js={class:"filter-search-row"},Fs=["title"],Ns={key:0,class:"filter-badge"},Bs={class:"search-input-wrapper"},Hs={class:"filter-content"},qs={class:"filter-row filter-row-dropdowns"},zs={class:"filter-group"},Js=["value"],Ws={class:"filter-group"},Ks=["value"],Xs={class:"filter-group"},Gs={key:0,class:"filter-group filter-toggle"},Ys={class:"toggle-label"},Zs={class:"filter-results"},Qs={key:1,class:"loading-state"},ea={key:2,class:"error-state"},ta={key:3,class:"empty-state"},oa={key:4,class:"device-grid"},la={key:6,class:"no-results"},na={__name:"DeviceList",setup(o){const c=gt(),d=He(),{isMobile:$}=Ze(),h=y(!1),r=y(!1),m=y(null),g=y(!1),I=y(!1),_=y(null),E=y(null),w=y(!0),l=y(!1),L=y(!1),P=y(window.innerWidth<=767?"grid":localStorage.getItem("device_view_mode")||"grid");ae($,S=>{S&&P.value==="list"&&(P.value="grid")}),ae(P,S=>{localStorage.setItem("device_view_mode",S)});const C=()=>{w.value=!w.value,w.value||(I.value=!1)},s=()=>{w.value||(w.value=!0),I.value=!I.value},b=y(!1),f=y({title:"Error",message:"",suggestion:"",details:"",error:null,context:{}}),O=y(!1),z=y({success:!1,title:"",message:""}),Y=y(!1),B=y({search:"",broadlinkDevice:"",area:"",entityType:"",showSmartIROnly:!1}),le=y([]),M=De("smartirStatus"),F=De("smartirEnabled"),te=W(()=>{var k;return localStorage.getItem("smartir_simulate_not_installed")==="true"?!1:((k=M==null?void 0:M.value)==null?void 0:k.installed)||!1}),ie=W(()=>{const S=new Map;return c.devices.forEach(k=>{if(k.broadlink_entity){const N=le.value.find(Q=>Q.entity_id===k.broadlink_entity),H=N&&N.name||k.broadlink_entity;S.set(k.broadlink_entity,{entity_id:k.broadlink_entity,friendly_name:H})}}),Array.from(S.values()).sort((k,N)=>k.friendly_name.localeCompare(N.friendly_name))}),be=W(()=>{const S=new Set;return c.devices.forEach(k=>{k.area&&S.add(k.area)}),Array.from(S).sort()}),_e=W(()=>{let S=c.devices;if(B.value.search){const N=B.value.search.toLowerCase();S=S.filter(H=>{var me,re,Ce,Ee,Ue;if((me=H.name)!=null&&me.toLowerCase().includes(N)||(re=H.entity_type)!=null&&re.toLowerCase().includes(N)||(Ce=H.area)!=null&&Ce.toLowerCase().includes(N)||(Ee=H.id)!=null&&Ee.toLowerCase().includes(N)||Object.keys(H.commands||{}).some(Ve=>Ve.toLowerCase().includes(N)))return!0;const he=le.value.find(Ve=>Ve.entity_id===H.broadlink_entity);return!!((Ue=he==null?void 0:he.name)!=null&&Ue.toLowerCase().includes(N))})}B.value.broadlinkDevice&&(S=S.filter(N=>N.broadlink_entity===B.value.broadlinkDevice||N.controller_device===B.value.broadlinkDevice)),B.value.area&&(S=S.filter(N=>N.area===B.value.area)),B.value.entityType&&(S=S.filter(N=>N.entity_type===B.value.entityType)),B.value.showSmartIROnly&&(S=S.filter(N=>N.device_type==="smartir"));const k=localStorage.getItem("smartir_simulate_not_installed")==="true";return(!(F!=null&&F.value)||k)&&(S=S.filter(N=>N.device_type!=="smartir")),S}),Te=W(()=>B.value.search||B.value.broadlinkDevice||B.value.area||B.value.entityType||B.value.showSmartIROnly),Ie=W(()=>{let S=0;return B.value.search&&S++,B.value.broadlinkDevice&&S++,B.value.area&&S++,B.value.entityType&&S++,B.value.showSmartIROnly&&S++,S}),D=()=>{B.value.search="",B.value.broadlinkDevice="",B.value.area="",B.value.entityType="",B.value.showSmartIROnly=!1},v=async()=>{try{const S=await ee.get("/api/remote/devices");le.value=S.data.devices||[]}catch(S){console.error("Error loading remote devices:",S)}};ae(P,S=>{localStorage.setItem("device_view_mode",S)}),Ae(async()=>{await Promise.all([c.loadDevices(),v()])});const U=S=>{m.value=S,h.value=!0},pe=W(()=>{if(!_.value)return"";const S=Object.keys(_.value.commands||{}).length;return S===0?"This device has no commands. The device will be removed from tracking.":`This device has ${S} learned command${S>1?"s":""}. What would you like to do?`}),Oe=W(()=>{if(!_.value)return"";const S=Object.keys(_.value.commands||{}).length;return S===0?"":`Also delete all ${S} command${S>1?"s":""} from Broadlink storage`}),fe=S=>{_.value=S,g.value=!0},ge=()=>{g.value=!1,_.value=null},xe=async S=>{var N,H;const k=_.value;g.value=!1;try{await c.deleteDevice(k.id,S),E.value&&await E.value.refresh()}catch(Q){const he=((H=(N=Q.response)==null?void 0:N.data)==null?void 0:H.error)||Q.message||"Unknown error";V("Failed to Delete Device",he)}finally{_.value=null}},Le=async S=>{var k,N,H,Q,he;try{console.log("ğŸ’¾ Saving device data:",S),console.log("ğŸ’¾ Device commands:",S.commands),console.log("ğŸ’¾ Selected device:",m.value),(k=m.value)!=null&&k.id&&m.value.id!==null?await c.updateDevice(m.value.id,S):await c.createDevice(S),A(),E.value&&await E.value.refresh()}catch(me){let re="Failed to save device",Ce="",Ee="";(H=(N=me.response)==null?void 0:N.data)!=null&&H.error?(re=me.response.data.error,Ce=me.response.data.suggestion||""):me.message&&(re=me.message),me.response&&(Ee=`Status: ${me.response.status}
URL: ${((Q=me.config)==null?void 0:Q.url)||"N/A"}`),V("Failed to Save Device",re,Ce,Ee,me,{action:"save_device",deviceData:S,isEdit:!!((he=m.value)!=null&&he.id)})}},A=()=>{h.value=!1,m.value=null},t=S=>{m.value=S,r.value=!0},u=()=>{r.value=!1,m.value=null},V=(S,k,N="",H="",Q=null,he={})=>{f.value={title:S,message:k,suggestion:N,details:H,error:Q,context:he},b.value=!0},X=()=>{b.value=!1},x=()=>{O.value=!1},i=async S=>{var k;if(console.log("ğŸŸ¢ [PARENT] Received learned event:",S),!S||!S.deviceId){console.warn("âš ï¸ [PARENT] Missing required data in learned event");return}if(console.log("ğŸŸ¢ [PARENT] Current selectedDevice commands:",Object.keys(((k=m.value)==null?void 0:k.commands)||{}).length),console.log("ğŸŸ¢ [PARENT] Current store device count:",c.devices.length),console.log("ğŸŸ¢ [PARENT] Force reloading all devices from API with cache bust..."),await c.loadDevices(!0),console.log("ğŸŸ¢ [PARENT] After reload - store device count:",c.devices.length),m.value){console.log("ğŸŸ¢ [PARENT] Looking for device:",S.deviceId);const N=c.devices.find(H=>H.id===S.deviceId);N?(console.log("ğŸŸ¢ [PARENT] Found fresh device with",Object.keys(N.commands||{}).length,"commands"),m.value={...N},console.log("ğŸŸ¢ [PARENT] âœ… Updated selectedDevice - now has",Object.keys(m.value.commands||{}).length,"commands")):console.error("ğŸŸ¢ [PARENT] âŒ Device not found in store after reload!")}E.value&&(console.log("ğŸŸ¢ [PARENT] Refreshing discovery..."),E.value.refresh()),console.log("ğŸŸ¢ [PARENT] âœ… handleCommandLearned complete!")},j=S=>{const k=S.split("_"),N=[];for(let H=0;H<k.length;H++){const Q=k[H],he=k[H+1];Q&&he==="s"&&k[H+2]?(N.push(Q.charAt(0).toUpperCase()+Q.slice(1)+"'s"),H++):Q!=="s"&&N.push(Q.charAt(0).toUpperCase()+Q.slice(1))}return N.join(" ")},K=(S,k)=>{const N=S.toLowerCase(),H=k.map(re=>re.toLowerCase());return N.includes("lamp")||N.includes("light")?"light":N.includes("fan")?"fan":N.includes("tv")||N.includes("stereo")||N.includes("speaker")||N.includes("receiver")?"media_player":N.includes("blind")||N.includes("curtain")||N.includes("shade")||N.includes("garage")?"cover":H.some(re=>re.includes("volume")||re.includes("channel")||re.includes("play")||re.includes("pause")||re.includes("mute"))?"media_player":H.some(re=>re.includes("fan_speed")||re.includes("fan_low")||re.includes("fan_high"))?"fan":H.some(re=>re.includes("open")||re.includes("close")||re.includes("stop"))?"cover":"switch"},ne=(S,k)=>{const N=S.toLowerCase();return N.includes("tv")?"mdi:television":N.includes("stereo")||N.includes("receiver")||N.includes("speaker")?"mdi:speaker":N.includes("lamp")?"mdi:lamp":N.includes("light")?"mdi:lightbulb":N.includes("fan")?"mdi:fan":N.includes("blind")?"mdi:blinds":N.includes("curtain")?"mdi:curtains":N.includes("garage")?"mdi:garage":{light:"mdi:lightbulb",fan:"mdi:fan",switch:"mdi:light-switch",media_player:"mdi:speaker",cover:"mdi:window-shutter"}[k]||"mdi:devices"},se=S=>{const k=S.toLowerCase().split("_");for(let Q=0;Q<k.length-2;Q++)if(k[Q+1]==="s"){const he=k.slice(Q,Q+3),me=j(he.join("_"));return console.log("Detected possessive area:",me,"from",S),me}const N=[["living","room"],["dining","room"],["master","bedroom"],["guest","bedroom"],["family","room"],["laundry","room"],["home","office"]];for(let Q=0;Q<k.length-1;Q++){const he=[k[Q],k[Q+1]],me=N.find(re=>re[0]===he[0]&&re[1]===he[1]);if(me)return j(me.join("_"))}const H=["kitchen","bedroom","bathroom","garage","office","basement","attic","hallway","entryway","patio","deck","yard","garden"];for(const Q of k)if(H.includes(Q))return Q.charAt(0).toUpperCase()+Q.slice(1);return""},oe=async S=>{var k,N;try{const H=j(S.device_name),Q=se(S.device_name),he=K(S.device_name,S.commands),me=ne(S.device_name,he);let re="";try{console.log("Finding Broadlink owner for:",S.device_name);const Ve=await ee.post("/api/devices/find-broadlink-owner",{device_name:S.device_name});console.log("Broadlink owner response:",Ve.data),re=Ve.data.broadlink_entity||"",console.log("Detected Broadlink entity:",re)}catch(Ve){console.error("Error finding Broadlink owner:",Ve)}console.log("Fetching command data from Broadlink storage...");const Ee=(await ee.get(`/api/commands/broadlink/${S.device_name}`)).data.commands||{};console.log("Fetched command data:",Ee);const Ue={};for(const[Ve,Xe]of Object.entries(Ee)){const rt=typeof Xe=="string"&&Xe.length>200;Ue[Ve]={data:Xe,type:rt?"rf":"ir",name:Ve,learned_at:new Date().toISOString()}}console.log("Transformed commands:",Ue),m.value={id:null,device:S.device_name,name:H,entity_type:he,commands:Ue,area:Q,icon:me,broadlink_entity:re,enabled:!0},h.value=!0,d.success(`Imported ${Object.keys(Ue).length} commands from Broadlink storage`)}catch(H){console.error("Error adopting device:",H),d.error("Failed to adopt device: "+(((N=(k=H.response)==null?void 0:k.data)==null?void 0:N.error)||H.message))}},Z=async()=>{L.value=!0;try{await c.syncAllAreas(),d.success("Areas synced from Home Assistant")}catch(S){console.error("Error syncing areas:",S),d.error("Failed to sync areas")}finally{L.value=!1}},ce=async()=>{var S,k;l.value=!0;try{const N=await ee.post("/api/entities/generate",{});if(N.data.success){const H=N.data.broadlink_count||0,Q=N.data.smartir_count||0,he=N.data.total_count||0,me=N.data.errors||[];let re="âœ… Entity Generation Successful",Ce=[];const Ee=[];H>0&&Ee.push(`${H} Broadlink native`),Q>0&&Ee.push(`${Q} SmartIR`),Ee.length>0&&Ce.push(`Generated ${Ee.join(" and ")} entity configuration${he!==1?"s":""}.`),H>0&&(Ce.push(`
ğŸ“ Broadlink entities created in:`),Ce.push("  â€¢ broadlink_manager/entities.yaml"),Ce.push("  â€¢ broadlink_manager/helpers.yaml")),Q>0&&(Ce.push(`
ğŸ“ SmartIR entities created in:`),Ce.push("  â€¢ smartir/climate.yaml"),Ce.push("  â€¢ smartir/media_player.yaml"),Ce.push("  â€¢ smartir/fan.yaml")),Ce.push(`
ğŸ“ Next steps:`),Ce.push("1. Check your configuration.yaml includes the generated files"),Ce.push("2. Restart Home Assistant to load the new entities"),me.length>0&&(re="âš ï¸ Entity Generation Completed with Errors",Ce.push(`
âš ï¸ ${me.length} error${me.length!==1?"s":""} occurred:`),me.forEach(Ue=>{Ce.push(`  â€¢ ${Ue}`)})),z.value={success:!0,title:re,message:Ce.join(`
`)},O.value=!0}else z.value={success:!1,title:"âŒ Entity Generation Failed",message:N.data.message||`Failed to generate entities.

Please check that you have at least one device configured.`},O.value=!0}catch(N){console.error("Error generating entities:",N);const H=((k=(S=N.response)==null?void 0:S.data)==null?void 0:k.error)||N.message||"Unknown error occurred";z.value={success:!1,title:"âŒ Entity Generation Error",message:`Failed to generate entities:

${H}

Please check the logs for more details.`},O.value=!0}finally{l.value=!1}},Re=async({device:S,command:k})=>{var N,H;try{const Q={device_id:S.id,command:k,device:S.device||S.id,entity_id:S.broadlink_entity||S.controller_device};await ee.post("/api/commands/test",Q),d.success(`Sent ${k} to ${S.name}`)}catch(Q){console.error("Error sending command:",Q);const he=((H=(N=Q.response)==null?void 0:N.data)==null?void 0:H.error)||Q.message||"Unknown error";d.error(`Failed to send ${k}: ${he}`)}};return(S,k)=>{var N;return n(),a("div",Ts,[e("div",xs,[e("button",{class:"icon-button chevron-button",onClick:C},[e("i",{class:G(["mdi",w.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2)]),e("div",{class:"header-left",onClick:C},[k[14]||(k[14]=e("div",{class:"header-icon"},[e("i",{class:"mdi mdi-devices"})],-1)),e("h3",null,p($e($)?"Devices":"Managed Devices"),1),e("div",Rs,[e("span",Ms,p($e(c).deviceCount)+" devices",1)])]),e("div",As,[$e($)?R("",!0):(n(),a("div",Os,[e("button",{onClick:k[0]||(k[0]=de(H=>P.value="grid",["stop"])),class:G(["view-toggle-btn",{active:P.value==="grid"}]),title:"Grid View"},[...k[15]||(k[15]=[e("i",{class:"mdi mdi-view-grid"},null,-1)])],2),e("button",{onClick:k[1]||(k[1]=de(H=>P.value="list",["stop"])),class:G(["view-toggle-btn",{active:P.value==="list"}]),title:"List View"},[...k[16]||(k[16]=[e("i",{class:"mdi mdi-view-list"},null,-1)])],2)])),e("button",{onClick:k[2]||(k[2]=de(H=>h.value=!0,["stop"])),class:"btn btn-primary new-button"},[...k[17]||(k[17]=[e("i",{class:"mdi mdi-plus"},null,-1),e("span",null,"New",-1)])]),e("div",Ls,[e("button",{onClick:de(s,["stop"]),class:G(["icon-button settings-button",{active:I.value}]),title:"Settings"},[...k[18]||(k[18]=[e("i",{class:"mdi mdi-cog"},null,-1)])],2),I.value?(n(),a("div",{key:0,class:"settings-dropdown",onClick:k[5]||(k[5]=de(()=>{},["stop"]))},[e("button",{onClick:k[3]||(k[3]=H=>{Z(),I.value=!1}),class:"menu-item",disabled:L.value},[e("i",{class:G(["mdi",L.value?"mdi-loading mdi-spin":"mdi-refresh"])},null,2),e("span",null,p(L.value?"Syncing Areas...":"Sync Areas"),1)],8,Es),e("button",{onClick:k[4]||(k[4]=H=>{ce(),I.value=!1}),class:"menu-item",disabled:l.value},[e("i",{class:G(["mdi",l.value?"mdi-loading mdi-spin":"mdi-file-code"])},null,2),e("span",null,p(l.value?"Generating...":"Generate Entities"),1)],8,Vs)])):R("",!0)])])]),J(e("div",Ps,[ye(Ds,{ref_key:"discoveryRef",ref:E,onAdopt:oe},null,512),$e(c).hasDevices?(n(),a("div",Us,[e("div",js,[e("button",{class:G(["filter-toggle-button",{active:Y.value||Te.value}]),onClick:k[6]||(k[6]=H=>Y.value=!Y.value),title:Y.value?"Hide filters":"Show filters"},[k[19]||(k[19]=e("i",{class:"mdi mdi-filter-variant"},null,-1)),Te.value?(n(),a("span",Ns,p(Ie.value),1)):R("",!0)],10,Fs),e("div",Bs,[k[20]||(k[20]=e("i",{class:"mdi mdi-magnify search-icon"},null,-1)),J(e("input",{"onUpdate:modelValue":k[7]||(k[7]=H=>B.value.search=H),type:"text",placeholder:"Search devices, commands...",class:"search-input"},null,512),[[Me,B.value.search]])])]),J(e("div",Hs,[e("div",qs,[e("div",zs,[e("label",null,[k[22]||(k[22]=e("i",{class:"mdi mdi-access-point"},null,-1)),J(e("select",{"onUpdate:modelValue":k[8]||(k[8]=H=>B.value.broadlinkDevice=H)},[k[21]||(k[21]=e("option",{value:""},"All Controller Devices",-1)),(n(!0),a(ue,null,ke(ie.value,H=>(n(),a("option",{key:H.entity_id,value:H.entity_id},p(H.friendly_name),9,Js))),128))],512),[[Se,B.value.broadlinkDevice]])])]),e("div",Ws,[e("label",null,[k[24]||(k[24]=e("i",{class:"mdi mdi-home-map-marker"},null,-1)),J(e("select",{"onUpdate:modelValue":k[9]||(k[9]=H=>B.value.area=H)},[k[23]||(k[23]=e("option",{value:""},"All Areas",-1)),(n(!0),a(ue,null,ke(be.value,H=>(n(),a("option",{key:H,value:H},p(H),9,Ks))),128))],512),[[Se,B.value.area]])])]),e("div",Xs,[e("label",null,[k[26]||(k[26]=e("i",{class:"mdi mdi-shape"},null,-1)),J(e("select",{"onUpdate:modelValue":k[10]||(k[10]=H=>B.value.entityType=H)},[...k[25]||(k[25]=[Fe('<option value="" data-v-bf03d560>All Types</option><option value="light" data-v-bf03d560>Light</option><option value="fan" data-v-bf03d560>Fan</option><option value="switch" data-v-bf03d560>Switch</option><option value="media_player" data-v-bf03d560>Media Player</option><option value="cover" data-v-bf03d560>Cover</option><option value="climate" data-v-bf03d560>Climate</option>',7)])],512),[[Se,B.value.entityType]])])]),te.value?(n(),a("div",Gs,[e("label",Ys,[k[27]||(k[27]=e("span",{class:"toggle-text"},[e("img",{src:Ke,alt:"SmartIR",class:"smartir-icon"}),T(" SmartIR Only ")],-1)),J(e("input",{type:"checkbox","onUpdate:modelValue":k[11]||(k[11]=H=>B.value.showSmartIROnly=H),class:"toggle-checkbox"},null,512),[[ve,B.value.showSmartIROnly]]),k[28]||(k[28]=e("span",{class:"toggle-slider"},null,-1))])])):R("",!0),Te.value?(n(),a("button",{key:1,onClick:D,class:"btn-clear-filters"},[...k[29]||(k[29]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),T(" Clear ",-1)])])):R("",!0),e("div",Zs,p(_e.value.length)+" of "+p($e(c).deviceCount),1)])],512),[[Je,Y.value]])])):R("",!0),$e(c).loading?(n(),a("div",Qs,[...k[30]||(k[30]=[e("i",{class:"mdi mdi-loading mdi-spin"},null,-1),e("p",null,"Loading devices...",-1)])])):$e(c).error?(n(),a("div",ea,[k[31]||(k[31]=e("i",{class:"mdi mdi-alert-circle"},null,-1)),e("p",null,p($e(c).error),1),e("button",{onClick:k[12]||(k[12]=H=>$e(c).loadDevices()),class:"btn btn-secondary"}," Retry ")])):$e(c).hasDevices?R("",!0):(n(),a("div",ta,[k[33]||(k[33]=e("i",{class:"mdi mdi-devices"},null,-1)),k[34]||(k[34]=e("h3",null,"No Devices Yet",-1)),k[35]||(k[35]=e("p",null,"Get started by adding your first managed device",-1)),e("button",{onClick:k[13]||(k[13]=H=>h.value=!0),class:"btn btn-primary"},[...k[32]||(k[32]=[e("i",{class:"mdi mdi-plus"},null,-1),T(" Add Your First Device ",-1)])])])),P.value==="grid"?(n(),a("div",oa,[(n(!0),a(ue,null,ke(_e.value,H=>(n(),Pe(Ut,{key:H.id,device:H,"broadlink-devices":le.value,onEdit:U,onDelete:fe,onLearn:t},null,8,["device","broadlink-devices"]))),128))])):P.value==="list"&&_e.value.length>0?(n(),Pe(so,{key:5,devices:_e.value,onSendCommand:Re,onOpenCommands:t,onEditDevice:U,onDeleteDevice:fe},null,8,["devices"])):R("",!0),$e(c).hasDevices&&_e.value.length===0?(n(),a("div",la,[...k[36]||(k[36]=[e("i",{class:"mdi mdi-filter-off"},null,-1),e("h3",null,"No devices match your filters",-1),e("p",null,"Try adjusting your search or filter criteria",-1)])])):R("",!0)],512),[[Je,w.value]]),h.value?(n(),Pe(Ll,{key:0,device:m.value,onSave:Le,onCancel:A},null,8,["device"])):R("",!0),r.value?(n(),Pe(Jn,{key:1,device:m.value,onLearned:i,onCancel:u},null,8,["device"])):R("",!0),ye(je,{isOpen:g.value,title:`Delete ${(N=_.value)==null?void 0:N.name}?`,message:pe.value,confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,checkboxLabel:Oe.value,onConfirm:xe,onCancel:ge},null,8,["isOpen","title","message","checkboxLabel"]),ye(ns,{isOpen:b.value,title:f.value.title,message:f.value.message,suggestion:f.value.suggestion,details:f.value.details,error:f.value.error,context:f.value.context,onClose:X},null,8,["isOpen","title","message","suggestion","details","error","context"]),ye(je,{isOpen:O.value,title:z.value.title,message:z.value.message,confirmText:"OK",showCancel:!1,dangerMode:!z.value.success,onConfirm:x,onCancel:x},null,8,["isOpen","title","message","dangerMode"])])}}},sa=we(na,[["__scopeId","data-v-bf03d560"]]),aa={class:"banner-content"},ia={class:"banner-icon"},ra={class:"banner-message"},da={class:"banner-actions"},ua={__name:"SmartIRBanner",setup(o){const c=De("smartirStatus"),d=y(!1),$=W(()=>!(!c.value||d.value||localStorage.getItem("smartir_banner_dismissed")==="true")),h=W(()=>{var E;return(E=c.value)!=null&&E.installed?"banner-success":"banner-info"}),r=W(()=>{var E;return(E=c.value)!=null&&E.installed?"mdi mdi-check-circle":"mdi mdi-information"}),m=W(()=>{var E;return(E=c.value)!=null&&E.installed?`SmartIR Detected (v${c.value.version})`:"Want Climate Device Support?"}),g=W(()=>{var E;return(E=c.value)!=null&&E.installed?"You can now create climate device profiles with full temperature and HVAC mode control.":"Install SmartIR to unlock AC/heater control with temperature settings, HVAC modes, and 120+ pre-configured device profiles."});function I(){window.open("https://github.com/smartHomeHub/SmartIR","_blank")}function _(){var E;if(d.value=!0,(E=c.value)!=null&&E.installed)localStorage.setItem("smartir_banner_dismissed","true");else{const w=parseInt(localStorage.getItem("smartir_banner_dismiss_count")||"0");w>=2?localStorage.setItem("smartir_banner_dismissed","true"):localStorage.setItem("smartir_banner_dismiss_count",String(w+1))}}return Ae(()=>{var l;const E=localStorage.getItem("smartir_last_status"),w=(l=c.value)!=null&&l.installed?"installed":"not_installed";E!==w&&(localStorage.removeItem("smartir_banner_dismissed"),localStorage.removeItem("smartir_banner_dismiss_count"),localStorage.setItem("smartir_last_status",w))}),(E,w)=>{var l,L;return $.value?(n(),a("div",{key:0,class:G(["smartir-banner",h.value])},[e("div",aa,[e("div",ia,[e("i",{class:G(r.value)},null,2)]),e("div",ra,[e("strong",null,p(m.value),1),e("p",null,p(g.value),1)]),e("div",da,[(l=E.status)!=null&&l.installed?R("",!0):(n(),a("button",{key:0,onClick:I,class:"btn-primary"}," Learn More ")),e("button",{onClick:_,class:"btn-text"},p((L=E.status)!=null&&L.installed?"Got it":"Dismiss"),1)])])],2)):R("",!0)}}},ca=we(ua,[["__scopeId","data-v-7bbcbcd7"]]),Be="api/smartir",at={async getStatus(){try{const o=await fetch(`${Be}/status`);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return await o.json()}catch(o){return console.error("Error fetching SmartIR status:",o),{installed:!1,version:null,error:o.message}}},async getInstallInstructions(){try{const o=await fetch(`${Be}/install-instructions`);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return await o.json()}catch(o){throw console.error("Error fetching install instructions:",o),o}},async getPlatforms(){try{const o=await fetch(`${Be}/platforms`);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return await o.json()}catch(o){throw console.error("Error fetching platforms:",o),o}},async getPlatformCodes(o){try{const c=await fetch(`${Be}/platforms/${o}/codes`);if(!c.ok)throw new Error(`HTTP error! status: ${c.status}`);return await c.json()}catch(c){throw console.error(`Error fetching codes for ${o}:`,c),c}},async getNextCode(o){try{const c=await fetch(`${Be}/platforms/${o}/next-code`);if(!c.ok)throw new Error(`HTTP error! status: ${c.status}`);return await c.json()}catch(c){throw console.error(`Error fetching next code for ${o}:`,c),c}},async validateCode(o,c){try{const d=await fetch(`${Be}/validate-code`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({platform:o,code:c})});if(!d.ok)throw new Error(`HTTP error! status: ${d.status}`);return await d.json()}catch(d){throw console.error("Error validating code:",d),d}}},ma={class:"profile-card"},va={class:"profile-card-header"},pa=["title"],fa={class:"profile-details"},ga=["title"],ya={class:"profile-meta"},ba=["title"],ha=["title"],ka=["title"],wa={class:"profile-card-footer"},$a=["title"],Ca={key:0,class:"learned-indicator"},_a={class:"profile-actions"},Sa={__name:"SmartIRProfileCard",props:{profile:{type:Object,required:!0}},emits:["edit","download","delete","commands"],setup(o){const c=o,d=nt(W(()=>c.profile.platform)),$=m=>m.replace(/_/g," ").replace(/\b\w/g,g=>g.toUpperCase()),h=m=>m&&m.startsWith("mdi:")?`mdi ${m.replace(":"," mdi-")}`:`mdi mdi-${m}`,r=m=>{if(!m)return"";const g=m.toLowerCase();return g.includes("broadlink")?"broadlink-tag":g.includes("not set")?"not-set-tag":"default-controller-tag"};return(m,g)=>(n(),a("div",ma,[e("div",va,[e("div",{class:G(["profile-icon",$e(d).colorClass.value]),title:$(o.profile.platform)},[e("i",{class:G(h($e(d).icon.value))},null,2)],10,pa),e("div",fa,[e("h4",{title:`${o.profile.manufacturer} ${o.profile.model}`},p(o.profile.manufacturer)+" "+p(o.profile.model),9,ga),e("div",ya,[e("span",{class:"tag platform-tag",title:$(o.profile.platform)},p($(o.profile.platform)),9,ba),o.profile.controllerBrand?(n(),a("span",{key:0,class:G(["tag controller-tag",r(o.profile.controllerBrand)]),title:"Controller: "+o.profile.controllerBrand},[g[4]||(g[4]=e("i",{class:"mdi mdi-remote-tv"},null,-1)),T(" "+p(o.profile.controllerBrand),1)],10,ha)):R("",!0)])]),e("div",{class:"code-badge",title:"Device Code: "+o.profile.code},p(o.profile.code),9,ka)]),e("div",wa,[e("div",{class:"profile-stats",title:o.profile.commandCount+" total commands"+(o.profile.learnedCount>0?", "+o.profile.learnedCount+" learned":"")},[g[5]||(g[5]=e("i",{class:"mdi mdi-remote"},null,-1)),e("span",null,p(o.profile.commandCount)+" command"+p(o.profile.commandCount!==1?"s":""),1),o.profile.learnedCount>0?(n(),a("span",Ca,"( "+p(o.profile.learnedCount)+" learned )",1)):R("",!0)],8,$a),e("div",_a,[e("button",{onClick:g[0]||(g[0]=I=>m.$emit("commands")),class:"action-btn",title:"Commands"},[...g[6]||(g[6]=[e("i",{class:"mdi mdi-remote"},null,-1)])]),e("button",{onClick:g[1]||(g[1]=I=>m.$emit("edit")),class:"action-btn",title:"Edit Profile"},[...g[7]||(g[7]=[e("i",{class:"mdi mdi-pencil"},null,-1)])]),e("button",{onClick:g[2]||(g[2]=I=>m.$emit("download")),class:"action-btn",title:"Download JSON"},[...g[8]||(g[8]=[e("i",{class:"mdi mdi-download"},null,-1)])]),e("button",{onClick:g[3]||(g[3]=I=>m.$emit("delete")),class:"action-btn delete",title:"Delete Profile"},[...g[9]||(g[9]=[e("i",{class:"mdi mdi-delete"},null,-1)])])])])]))}},Ia=we(Sa,[["__scopeId","data-v-aad9720f"]]),Da={name:"SmartIRProfileListView",props:{profiles:{type:Array,required:!0}},methods:{getPlatformIcon(o){return{climate:"mdi-thermostat",media_player:"mdi-television",fan:"mdi-fan",light:"mdi-lightbulb"}[o]||"mdi-devices"},formatPlatform(o){return{climate:"Climate",media_player:"Media Player",fan:"Fan",light:"Light"}[o]||o},editProfile(o){this.$emit("edit",o)},viewCommands(o){this.$emit("commands",o)},downloadProfile(o){this.$emit("download",o)},deleteProfile(o){this.$emit("delete",o)}}},Ta={class:"profile-list-view"},xa={class:"profile-table"},Ra={class:"profile-code"},Ma={class:"code-badge"},Aa={class:"profile-manufacturer"},Oa={class:"profile-model"},La={class:"model-info"},Ea={class:"model-name"},Va={key:0,class:"model-count"},Pa={class:"profile-platform"},Ua={class:"profile-controller"},ja={class:"profile-commands"},Fa={class:"command-stats"},Na={class:"stat-item"},Ba={key:0,class:"stat-item learned"},Ha={class:"profile-actions"},qa=["onClick"],za=["onClick"],Ja=["onClick"],Wa=["onClick"];function Ka(o,c,d,$,h,r){return n(),a("div",Ta,[e("table",xa,[c[6]||(c[6]=e("thead",null,[e("tr",null,[e("th",null,"Code"),e("th",null,"Manufacturer"),e("th",null,"Model"),e("th",null,"Platform"),e("th",null,"Controller"),e("th",null,"Commands"),e("th",null,"Actions")])],-1)),e("tbody",null,[(n(!0),a(ue,null,ke(d.profiles,m=>(n(),a("tr",{key:`${m.platform}-${m.code}`,class:"profile-row"},[e("td",Ra,[e("span",Ma,p(m.code),1)]),e("td",Aa,p(m.manufacturer||"Unknown"),1),e("td",Oa,[e("div",La,[e("div",Ea,p(m.model||"Unknown"),1),m.models&&m.models.length>1?(n(),a("div",Va," +"+p(m.models.length-1)+" more ",1)):R("",!0)])]),e("td",Pa,[e("span",{class:G(["platform-badge",m.platform])},[e("i",{class:G(["mdi",r.getPlatformIcon(m.platform)])},null,2),T(" "+p(r.formatPlatform(m.platform)),1)],2)]),e("td",Ua,p(m.controller_brand||"N/A"),1),e("td",ja,[e("div",Fa,[e("span",Na,[c[0]||(c[0]=e("i",{class:"mdi mdi-remote"},null,-1)),T(" "+p(m.command_count||0),1)]),m.learned_count>0?(n(),a("span",Ba,[c[1]||(c[1]=e("i",{class:"mdi mdi-school"},null,-1)),T(" "+p(m.learned_count),1)])):R("",!0)])]),e("td",Ha,[e("button",{class:"action-btn edit",onClick:g=>r.editProfile(m),title:"Edit Profile"},[...c[2]||(c[2]=[e("i",{class:"mdi mdi-pencil"},null,-1)])],8,qa),e("button",{class:"action-btn commands",onClick:g=>r.viewCommands(m),title:"View Commands"},[...c[3]||(c[3]=[e("i",{class:"mdi mdi-remote"},null,-1)])],8,za),e("button",{class:"action-btn download",onClick:g=>r.downloadProfile(m),title:"Download"},[...c[4]||(c[4]=[e("i",{class:"mdi mdi-download"},null,-1)])],8,Ja),e("button",{class:"action-btn delete",onClick:g=>r.deleteProfile(m),title:"Delete"},[...c[5]||(c[5]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,Wa)])]))),128))])])])}const Xa=we(Da,[["render",Ka],["__scopeId","data-v-d3773038"]]),Ga={class:"modal-container"},Ya={class:"modal-body"},Za={key:0,class:"selection-section"},Qa={class:"form-group"},ei={class:"form-group"},ti={class:"form-group"},oi={key:0,class:"code-info"},li={class:"form-actions"},ni=["disabled"],si={key:1,class:"testing-section"},ai={class:"code-header"},ii={class:"code-details"},ri={class:"code-badge"},di={class:"device-selector"},ui=["value"],ci={key:0,class:"helper-text"},mi={class:"commands-section"},vi={class:"commands-header"},pi={key:0,class:"tested-count"},fi={key:0,class:"filters-section"},gi={class:"filter-row"},yi={class:"filter-row"},bi={key:1,class:"empty-state"},hi={key:2,class:"empty-state"},ki={key:3,class:"commands-list"},wi={class:"command-name"},$i={class:"command-actions"},Ci={key:0,class:"status-badge success"},_i=["onClick","disabled","title"],Si={__name:"SmartIRCodeTester",props:{isOpen:{type:Boolean,default:!1}},emits:["close","clone"],setup(o,{emit:c}){const d=o,$=c,h=De("toast"),r=y("climate"),m=y(""),g=y([]),I=y(!1),_=y(null),E=y(""),w=y([]),l=y(!1),L=W(()=>w.value.map(A=>({code:A.code,label:`${A.models.join(", ")} (Code: ${A.code})`,value:A.code}))),q=y(null),P=y(null),C=y(!1),s=y([]),b=y(""),f=y([]),O=y(new Set),z=y(null),Y=y(""),B=y(""),le=y(""),M=y(""),F=W(()=>{let A=f.value;if(Y.value){const t=Y.value.toLowerCase();A=A.filter(u=>(u.label||u.name).toLowerCase().includes(t))}return B.value&&(A=A.filter(t=>t.mode===B.value)),le.value&&(A=A.filter(t=>t.fanSpeed===le.value)),M.value&&(A=A.filter(t=>t.swingMode===M.value)),A}),te=W(()=>Y.value||B.value||le.value||M.value);ae(()=>d.isOpen,A=>{A&&(ie(),_e())}),ae(r,()=>{d.isOpen&&(m.value="",_.value=null,w.value=[],ie())});async function ie(){var A;I.value=!0;try{const t=await ee.get("/api/smartir/codes/manufacturers",{params:{entity_type:r.value}});g.value=t.data.manufacturers||[]}catch(t){console.error("Error loading manufacturers:",t),(A=h.value)==null||A.error("Failed to load manufacturers","âŒ Error")}finally{I.value=!1}}async function be(){var A;if(m.value){l.value=!0;try{const t=await ee.get("/api/smartir/codes/models",{params:{entity_type:r.value,manufacturer:m.value}});w.value=t.data.models||[]}catch(t){console.error("Error loading models:",t),(A=h.value)==null||A.error("Failed to load models","âŒ Error")}finally{l.value=!1}}}async function _e(){try{const A=await ee.get("/api/remote/devices");s.value=A.data.devices||[]}catch(A){console.error("Error loading Broadlink devices:",A)}}async function Te(){var A,t;if(_.value){C.value=!0;try{const u=await ee.get("/api/smartir/codes/code",{params:{entity_type:r.value,code_id:_.value.code}});P.value=u.data.code,q.value=_.value.code,Ie(u.data.code),(A=h.value)==null||A.success(`Loaded ${f.value.length} commands`,"âœ… Code Loaded")}catch(u){console.error("Error loading code:",u),(t=h.value)==null||t.error(u.message||"Failed to load code","âŒ Error")}finally{C.value=!1}}}function Ie(A){const t=[];if(!A.commands){f.value=t;return}if(r.value==="climate"){const V=A.commands;for(const[X,x]of Object.entries(V)){if(X==="off"){typeof x=="string"&&t.push({name:"off",label:"OFF",data:x,mode:"off"});continue}if(typeof x=="object"){for(const[i,j]of Object.entries(x))if(typeof j=="object")for(const[K,ne]of Object.entries(j)){if(typeof ne!="object")continue;const se=Object.keys(ne),oe=se.includes("24")?"24":se[0];if(oe&&typeof ne[oe]=="string"){const Z=`${X}_${oe}_${i}_${K}`,ce=`${X.toUpperCase()} ${oe}Â°C ${i} ${K}`;t.push({name:Z,label:ce,data:ne[oe],mode:X,temperature:oe,fanSpeed:i,swingMode:K})}}}}}else for(const[V,X]of Object.entries(A.commands))typeof X=="string"&&t.push({name:V,label:V.toUpperCase().replace(/_/g," "),data:X});f.value=t}async function D(A){var t,u,V;if(!b.value){(t=h.value)==null||t.warning("Please select a Broadlink device first","âš ï¸ No Device");return}z.value=A;try{const X=f.value.find(x=>x.name===A);if(!X||!X.data)throw new Error(`Command "${A}" not found`);await ee.post("/api/commands/send-raw",{entity_id:b.value,command:X.data,command_type:"ir"}),O.value.add(A),(u=h.value)==null||u.success(`Command sent: ${X.label||A}`,"âœ… Tested")}catch(X){console.error("Error testing command:",X),(V=h.value)==null||V.error("Failed to test command","âŒ Error")}finally{z.value=null}}function v(){var A,t,u,V;if(!P.value){(A=h.value)==null||A.error("No profile data to download","âŒ Error");return}try{const X=P.value.manufacturer||"unknown",x=((t=P.value.supportedModels)==null?void 0:t[0])||q.value,i=`${X.toLowerCase().replace(/\s+/g,"_")}_${x.toLowerCase().replace(/\s+/g,"_")}.json`,j=JSON.stringify(P.value,null,2),K=new Blob([j],{type:"application/json"}),ne=URL.createObjectURL(K),se=document.createElement("a");se.href=ne,se.download=i,document.body.appendChild(se),se.click(),document.body.removeChild(se),URL.revokeObjectURL(ne),(u=h.value)==null||u.success(`Downloaded ${i}`,"âœ… Download Complete")}catch(X){console.error("Error downloading JSON:",X),(V=h.value)==null||V.error(X.message||"Failed to download JSON","âŒ Download Error")}}function U(){m.value="",_.value=null,E.value="",w.value=[]}function pe(){_.value=null,E.value="",be()}function Oe(){E.value?_.value=w.value.find(A=>A.code===E.value):_.value=null}function fe(){Y.value="",B.value="",le.value="",M.value=""}function ge(){q.value=null,P.value=null,f.value=[],O.value.clear(),z.value=null,fe()}function xe(A){const t=A.toLowerCase();return t.includes("power")||t.includes("off")||t==="off"?"mdi-power":t.includes("cool")?"mdi-snowflake":t.includes("heat")?"mdi-fire":t.includes("fan")?"mdi-fan":t.includes("auto")?"mdi-auto-fix":t.includes("dry")?"mdi-water-percent":t.includes("temp")?"mdi-thermometer":t.includes("swing")?"mdi-swap-vertical":"mdi-remote"}function Le(){ge(),m.value="",_.value=null,$("close")}return(A,t)=>{var u;return o.isOpen?(n(),a("div",{key:0,class:"modal-overlay",onClick:de(Le,["self"])},[e("div",Ga,[e("div",{class:"modal-header"},[t[9]||(t[9]=e("h3",null,[e("i",{class:"mdi mdi-test-tube"}),T(" Test SmartIR Code ")],-1)),e("button",{onClick:Le,class:"close-btn"},[...t[8]||(t[8]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Ya,[q.value?(n(),a("div",si,[e("div",ai,[e("div",ii,[e("h4",null,p(P.value.manufacturer)+" - "+p(((u=P.value.supportedModels)==null?void 0:u[0])||"Unknown"),1),e("span",ri,"Code: "+p(q.value),1)]),e("button",{onClick:ge,class:"btn-secondary-small"},[...t[14]||(t[14]=[e("i",{class:"mdi mdi-arrow-left"},null,-1),T(" Change Code ",-1)])])]),e("div",di,[t[17]||(t[17]=e("label",null,[e("i",{class:"mdi mdi-remote"}),T(" Broadlink Device ")],-1)),J(e("select",{"onUpdate:modelValue":t[3]||(t[3]=V=>b.value=V),class:"form-select"},[t[15]||(t[15]=e("option",{value:""},"Select device to test with...",-1)),(n(!0),a(ue,null,ke(s.value,V=>(n(),a("option",{key:V.entity_id,value:V.entity_id},p(V.friendly_name||V.entity_id),9,ui))),128))],512),[[Se,b.value]]),b.value?R("",!0):(n(),a("p",ci,[...t[16]||(t[16]=[e("i",{class:"mdi mdi-information-outline"},null,-1),T(" Select a Broadlink device to enable command testing ",-1)])]))]),e("div",mi,[e("div",vi,[e("h5",null,"Sample Commands ("+p(F.value.length)+" / "+p(f.value.length)+")",1),O.value.size>0?(n(),a("span",pi,p(O.value.size)+" tested ",1)):R("",!0)]),r.value==="climate"&&f.value.length>0?(n(),a("div",fi,[e("div",gi,[J(e("input",{"onUpdate:modelValue":t[4]||(t[4]=V=>Y.value=V),type:"text",placeholder:"Search commands...",class:"search-input"},null,512),[[Me,Y.value]])]),e("div",yi,[J(e("select",{"onUpdate:modelValue":t[5]||(t[5]=V=>B.value=V),class:"filter-select"},[...t[18]||(t[18]=[e("option",{value:""},"All Modes",-1),e("option",{value:"cool"},"Cool",-1),e("option",{value:"heat"},"Heat",-1),e("option",{value:"off"},"Off",-1)])],512),[[Se,B.value]]),J(e("select",{"onUpdate:modelValue":t[6]||(t[6]=V=>le.value=V),class:"filter-select"},[...t[19]||(t[19]=[Fe('<option value="" data-v-66569200>All Fan Speeds</option><option value="low" data-v-66569200>Low</option><option value="mid" data-v-66569200>Mid</option><option value="high" data-v-66569200>High</option><option value="auto" data-v-66569200>Auto</option>',5)])],512),[[Se,le.value]]),J(e("select",{"onUpdate:modelValue":t[7]||(t[7]=V=>M.value=V),class:"filter-select"},[...t[20]||(t[20]=[e("option",{value:""},"All Swing",-1),e("option",{value:"stop"},"Stop",-1),e("option",{value:"swing"},"Swing",-1)])],512),[[Se,M.value]]),te.value?(n(),a("button",{key:0,onClick:fe,class:"btn-clear-filters"},[...t[21]||(t[21]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),T(" Clear ",-1)])])):R("",!0)])])):R("",!0),f.value.length===0?(n(),a("div",bi,[...t[22]||(t[22]=[e("i",{class:"mdi mdi-alert-circle"},null,-1),e("p",null,"No commands found in this code",-1)])])):F.value.length===0?(n(),a("div",hi,[t[23]||(t[23]=e("i",{class:"mdi mdi-filter-off"},null,-1)),t[24]||(t[24]=e("p",null,"No commands match your filters",-1)),e("button",{onClick:fe,class:"btn-secondary-small"}," Clear Filters ")])):(n(),a("div",ki,[(n(!0),a(ue,null,ke(F.value,V=>(n(),a("div",{key:V.name,class:G(["command-item",{tested:O.value.has(V.name),testing:z.value===V.name}])},[e("div",wi,[e("i",{class:G(["mdi",xe(V.mode||V.name)])},null,2),e("span",null,p(V.label||V.name),1)]),e("div",$i,[O.value.has(V.name)?(n(),a("span",Ci,[...t[25]||(t[25]=[e("i",{class:"mdi mdi-check"},null,-1),T(" Tested ",-1)])])):R("",!0),e("button",{onClick:X=>D(V.name),disabled:!b.value||z.value===V.name,title:b.value?"Test this command":"Select a Broadlink device first",class:"btn-test"},[e("i",{class:G(["mdi",z.value===V.name?"mdi-loading mdi-spin":"mdi-play"])},null,2),t[26]||(t[26]=T(" Test ",-1))],8,_i)])],2))),128))]))]),e("div",{class:"modal-actions"},[e("button",{onClick:v,class:"btn-primary"},[...t[27]||(t[27]=[e("i",{class:"mdi mdi-download"},null,-1),T(" Download JSON ",-1)])]),e("button",{onClick:Le,class:"btn-secondary"}," Close ")])])):(n(),a("div",Za,[t[13]||(t[13]=e("div",{class:"info-banner"},[e("i",{class:"mdi mdi-information"}),e("p",null,"Select a SmartIR code from the index to test commands with your Broadlink device.")],-1)),e("div",Qa,[t[11]||(t[11]=e("label",null,[e("i",{class:"mdi mdi-shape"}),T(" Platform ")],-1)),J(e("select",{"onUpdate:modelValue":t[0]||(t[0]=V=>r.value=V),onChange:U,class:"form-select"},[...t[10]||(t[10]=[e("option",{value:"climate"},"Climate (AC/Heater)",-1),e("option",{value:"media_player"},"Media Player (TV/Audio)",-1),e("option",{value:"fan"},"Fan",-1),e("option",{value:"light"},"Light",-1)])],544),[[Se,r.value]])]),e("div",ei,[ye(We,{modelValue:m.value,"onUpdate:modelValue":t[1]||(t[1]=V=>m.value=V),options:g.value,label:"Manufacturer",placeholder:"Search manufacturers...",loading:I.value,disabled:I.value,onChange:pe},null,8,["modelValue","options","loading","disabled"])]),e("div",ti,[ye(We,{modelValue:E.value,"onUpdate:modelValue":t[2]||(t[2]=V=>E.value=V),options:L.value,"option-label":"label","option-value":"code",label:"Model",placeholder:"Search models...",loading:l.value,disabled:!m.value||l.value,onChange:Oe},null,8,["modelValue","options","loading","disabled"])]),_.value?(n(),a("div",oi,[t[12]||(t[12]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[e("strong",null,p(m.value)+" - "+p(_.value.models[0]),1),e("p",null,"Code: "+p(_.value.code),1)])])):R("",!0),e("div",li,[e("button",{onClick:Te,disabled:!_.value||C.value,class:"btn-primary"},[e("i",{class:G(["mdi",C.value?"mdi-loading mdi-spin":"mdi-download"])},null,2),T(" "+p(C.value?"Loading...":"Load Commands"),1)],8,ni)])]))])])])):R("",!0)}}},Ii=we(Si,[["__scopeId","data-v-66569200"]]),Di={class:"smartir-status-card"},Ti={class:"card-header"},xi=["src"],Ri={class:"header-badges"},Mi=["title"],Ai={class:"header-info"},Oi={class:"header-info"},Li={class:"header-info"},Ei={class:"header-right"},Vi={key:0,class:"view-toggle-group header-view-toggle"},Pi={key:2,class:"settings-menu-container"},Ui={key:0,class:"card-body loading-state"},ji={key:1,class:"card-body error-state"},Fi={key:2,class:"card-body installed-state"},Ni={key:0,class:"help-panel"},Bi={key:0,class:"recommendation"},Hi={key:0,class:"next-steps"},qi={class:"help-actions"},zi={key:1,class:"filter-bar"},Ji={class:"filter-search-row"},Wi=["title"],Ki={key:0,class:"filter-badge"},Xi={class:"search-input-wrapper"},Gi={class:"filter-content"},Yi={class:"filter-row"},Zi={class:"filter-group"},Qi={class:"filter-results"},er={key:2,class:"loading-state"},tr={key:3,class:"empty-state"},or={key:4,class:"profiles-grid"},lr={key:6,class:"no-results"},nr={key:3,class:"card-body not-installed-state"},sr={class:"benefits-section"},ar={class:"benefits-list"},ir={class:"recommendation"},rr={__name:"SmartIRStatusCard",emits:["create-profile","edit-profile"],setup(o,{expose:c,emit:d}){const $=d,h=De("smartirStatus");De("smartirEnabled");const r=De("refreshSmartIR"),{isMobile:m}=Ze(),g=y(!1),I=y(null),_=y((h==null?void 0:h.value)||null),E=y(localStorage.getItem("smartir_simulate_not_installed")==="true"),w=y(!1),l=y(!1),L=y(!0),q=y([]),P=y(!1),C=y(!1),s=y({search:"",platform:""}),b=y({show:!1,title:"",message:"",platform:null,profile:null}),f=y(!1),z=y(window.innerWidth<=767?"grid":localStorage.getItem("profile_view_mode")||"grid");ae(m,t=>{t&&z.value==="list"&&(z.value="grid")}),ae(z,t=>{localStorage.setItem("profile_view_mode",t)}),ae(L,t=>{t||(l.value=!1)});const Y=["Full climate entity support (AC, heaters)","120+ pre-configured device profiles","Temperature and humidity sensor integration","HVAC mode control (heat, cool, auto, dry, fan)"],B=["climate","media_player","fan","light"],le=W(()=>E.value?{installed:!1,recommendation:{message:"Install SmartIR to unlock climate device support!",benefits:["Full climate entity support (AC, heaters)","120+ pre-configured device profiles","Temperature and humidity sensor integration","HVAC mode control (heat, cool, auto, dry, fan)"]}}:_.value),M=W(()=>{var t,u;return((u=(t=le.value)==null?void 0:t.platforms)==null?void 0:u.length)||0}),F=W(()=>{var t;return(t=le.value)!=null&&t.device_counts?Object.values(le.value.device_counts).reduce((u,V)=>u+V,0):0});function te(){var t;E.value=!E.value,localStorage.setItem("smartir_simulate_not_installed",E.value.toString()),!E.value&&((t=_.value)!=null&&t.installed)&&fe()}const ie=W(()=>{let t=q.value;if(s.value.search){const u=s.value.search.toLowerCase();t=t.filter(V=>{var X,x,i,j;return((X=V.manufacturer)==null?void 0:X.toLowerCase().includes(u))||((x=V.model)==null?void 0:x.toLowerCase().includes(u))||((i=V.code)==null?void 0:i.toString().includes(u))||((j=V.platform)==null?void 0:j.toLowerCase().includes(u))})}return s.value.platform&&(t=t.filter(u=>u.platform===s.value.platform)),t}),be=W(()=>s.value.search||s.value.platform),_e=W(()=>{let t=0;return s.value.search&&t++,s.value.platform&&t++,t});function Te(){s.value.search="",s.value.platform=""}async function Ie(){g.value=!0,I.value=null;try{if(r)await r();else{const t=await at.getStatus();_.value=t}}catch(t){I.value=t.message||"Failed to refresh SmartIR status",console.error("Error refreshing SmartIR status:",t)}finally{g.value=!1}}function D(){$("create-profile")}function v(){w.value=!w.value,l.value=!1}function U(){L.value||(L.value=!0),l.value=!l.value}function pe(){f.value=!0,l.value=!1}function Oe(){window.open("https://github.com/smartHomeHub/SmartIR","_blank")}async function fe(){P.value=!0;const t=[];try{for(const u of B)try{const X=((await ee.get(`/api/smartir/platforms/${u}/profiles`)).data.profiles||[]).map(x=>({...x,platform:u}));t.push(...X)}catch(V){console.warn(`Network error loading ${u} profiles (using bundled index):`,V.message)}q.value=t}catch(u){console.error("Unexpected error loading profiles:",u)}finally{P.value=!1}}function ge(t,u,V){$("edit-profile",{platform:t,profile:u,startStep:V})}async function xe(t,u){var V,X;try{const i=(await ee.get(`/api/smartir/platforms/${t}/profiles/${u.code}`)).data,j=JSON.stringify(i.profile,null,2),K=new Blob([j],{type:"application/json"}),ne=URL.createObjectURL(K),se=document.createElement("a");se.href=ne,se.download=`smartir_${t}_${u.manufacturer}_${u.model}_${u.code}.json`,document.body.appendChild(se),se.click(),document.body.removeChild(se),URL.revokeObjectURL(ne),(V=De("toast").value)==null||V.success(`Downloaded ${u.manufacturer} ${u.model}`,"âœ… Profile Downloaded")}catch(x){console.error("Error downloading profile:",x),(X=De("toast").value)==null||X.error("Failed to download profile","âŒ Download Error")}}async function Le(t,u){De("toast");try{const X=(await ee.post(`/api/smartir/profiles/${u.code}/check-usage`,{platform:t})).data;if(X&&X.in_use){b.value={show:!0,title:`Cannot Delete ${u.manufacturer} ${u.model}`,message:`This profile is currently in use by ${X.device_count} device(s):

${X.devices.join(`
`)}

Please remove or reassign these devices before deleting the profile.`,platform:t,profile:u,canDelete:!1,devices:X.devices};return}}catch(V){console.error("Error checking profile usage:",V)}b.value={show:!0,title:`Delete ${u.manufacturer} ${u.model}?`,message:`Device Code: ${u.code}

This will remove the profile and update your configuration.`,platform:t,profile:u,canDelete:!0}}async function A(){var X,x;const t=De("toast"),{platform:u,profile:V}=b.value;b.value.show=!1;try{await ee.delete(`/api/smartir/profiles/${V.code}`,{data:{platform:u}}),await fe(),await ot(),await Ie(),(X=t.value)==null||X.success(`${V.manufacturer} ${V.model} has been removed`,"âœ… Profile Deleted")}catch(i){console.error("Error deleting profile:",i),(x=t.value)==null||x.error("Failed to delete profile","âŒ Delete Error")}}return ae(h,t=>{t&&(_.value=t)},{immediate:!0}),ae(z,t=>{localStorage.setItem("profile_view_mode",t)}),Ae(async()=>{var t;h!=null&&h.value&&(_.value=h.value),_.value||await Ie(),(t=_.value)!=null&&t.installed&&await fe()}),c({loadAllProfiles:fe,refreshStatus:Ie}),(t,u)=>{var V,X,x,i,j,K,ne,se,oe;return n(),a("div",Di,[e("div",Ti,[e("button",{class:"icon-button chevron-button",onClick:u[0]||(u[0]=Z=>L.value=!L.value)},[e("i",{class:G(["mdi",L.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2)]),e("div",{class:"header-left",onClick:u[1]||(u[1]=Z=>L.value=!L.value)},[e("img",{src:$e(Ke),alt:"SmartIR",class:"smartir-logo"},null,8,xi),e("h3",null,p($e(m)?"SmartIR":"SmartIR Integration"),1),e("div",Ri,[e("div",{class:G(["simulation-toggle-pill",{active:E.value}]),onClick:de(te,["stop"]),title:E.value?"Click to show as installed":"Click to simulate not-installed"},[e("i",{class:G(["mdi",E.value?"mdi-eye-off":"mdi-eye"])},null,2),e("span",null,p(E.value?"Simulating: Not Installed":"Simulation Mode"),1)],10,Mi),(V=le.value)!=null&&V.installed?(n(),a(ue,{key:0},[u[16]||(u[16]=e("div",{class:"status-badge-mini success"},[e("i",{class:"mdi mdi-check-circle"}),e("span",null,"Installed")],-1)),e("span",Ai,"v"+p(le.value.version||"Unknown"),1),e("span",Oi,p(M.value)+" platform"+p(M.value!==1?"s":""),1),e("span",Li,p(F.value)+" device"+p(F.value!==1?"s":""),1)],64)):R("",!0)])]),e("div",Ei,[!$e(m)&&((X=le.value)!=null&&X.installed)?(n(),a("div",Vi,[e("button",{onClick:u[2]||(u[2]=de(Z=>z.value="grid",["stop"])),class:G(["view-toggle-btn",{active:z.value==="grid"}]),title:"Grid View"},[...u[17]||(u[17]=[e("i",{class:"mdi mdi-view-grid"},null,-1)])],2),e("button",{onClick:u[3]||(u[3]=de(Z=>z.value="list",["stop"])),class:G(["view-toggle-btn",{active:z.value==="list"}]),title:"List View"},[...u[18]||(u[18]=[e("i",{class:"mdi mdi-view-list"},null,-1)])],2)])):R("",!0),(x=le.value)!=null&&x.installed?(n(),a("button",{key:1,onClick:de(D,["stop"]),class:"btn btn-primary new-button"},[...u[19]||(u[19]=[e("i",{class:"mdi mdi-plus"},null,-1),e("span",null,"New",-1)])])):R("",!0),(i=le.value)!=null&&i.installed?(n(),a("div",Pi,[e("button",{onClick:de(U,["stop"]),class:G(["icon-button settings-button",{active:l.value}]),title:"Settings"},[...u[20]||(u[20]=[e("i",{class:"mdi mdi-cog"},null,-1)])],2),l.value?(n(),a("div",{key:0,class:"settings-dropdown",onClick:u[5]||(u[5]=de(()=>{},["stop"]))},[e("button",{onClick:v,class:"menu-item"},[u[21]||(u[21]=e("i",{class:"mdi mdi-help-circle"},null,-1)),e("span",null,p(w.value?"Hide Help":"Show Help"),1)]),e("button",{onClick:u[4]||(u[4]=Z=>{l.value=!1,Ie()}),class:"menu-item"},[...u[22]||(u[22]=[e("i",{class:"mdi mdi-refresh"},null,-1),e("span",null,"Refresh Status",-1)])]),e("button",{onClick:pe,class:"menu-item"},[...u[23]||(u[23]=[e("i",{class:"mdi mdi-test-tube"},null,-1),e("span",null,"Test Codes",-1)])])])):R("",!0)])):R("",!0)])]),J(e("div",null,[g.value?(n(),a("div",Ui,[...u[24]||(u[24]=[e("div",{class:"spinner"},null,-1),e("p",null,"Checking SmartIR installation...",-1)])])):I.value?(n(),a("div",ji,[u[25]||(u[25]=e("i",{class:"mdi mdi-alert-circle"},null,-1)),e("p",null,p(I.value),1),e("button",{onClick:Ie,class:"btn-secondary"}," Try Again ")])):(j=le.value)!=null&&j.installed?(n(),a("div",Fi,[w.value?(n(),a("div",Ni,[_.value.recommendation?(n(),a("div",Bi,[e("p",null,p(_.value.recommendation.message),1),_.value.recommendation.next_steps?(n(),a("div",Hi,[u[26]||(u[26]=e("strong",null,"Next Steps:",-1)),e("ul",null,[(n(!0),a(ue,null,ke(_.value.recommendation.next_steps,(Z,ce)=>(n(),a("li",{key:ce},p(Z),1))),128))])])):R("",!0)])):R("",!0),e("div",qi,[e("button",{onClick:u[6]||(u[6]=(...Z)=>t.viewDocumentation&&t.viewDocumentation(...Z)),class:"btn-secondary"},[...u[27]||(u[27]=[e("i",{class:"mdi mdi-book-open-variant"},null,-1),T(" View Documentation ",-1)])])])])):R("",!0),q.value.length>0&&!E.value?(n(),a("div",zi,[e("div",Ji,[e("button",{class:G(["filter-toggle-button",{active:C.value||be.value}]),onClick:u[7]||(u[7]=Z=>C.value=!C.value),title:C.value?"Hide filters":"Show filters"},[u[28]||(u[28]=e("i",{class:"mdi mdi-filter-variant"},null,-1)),be.value?(n(),a("span",Ki,p(_e.value),1)):R("",!0)],10,Wi),e("div",Xi,[u[29]||(u[29]=e("i",{class:"mdi mdi-magnify search-icon"},null,-1)),J(e("input",{"onUpdate:modelValue":u[8]||(u[8]=Z=>s.value.search=Z),type:"text",placeholder:"Search profiles...",class:"search-input"},null,512),[[Me,s.value.search]])])]),J(e("div",Gi,[e("div",Yi,[e("div",Zi,[e("label",null,[u[31]||(u[31]=e("i",{class:"mdi mdi-shape"},null,-1)),J(e("select",{"onUpdate:modelValue":u[9]||(u[9]=Z=>s.value.platform=Z)},[...u[30]||(u[30]=[Fe('<option value="" data-v-4ef33ace>All Platforms</option><option value="climate" data-v-4ef33ace>Climate</option><option value="media_player" data-v-4ef33ace>Media Player</option><option value="fan" data-v-4ef33ace>Fan</option><option value="light" data-v-4ef33ace>Light</option>',5)])],512),[[Se,s.value.platform]])])]),be.value?(n(),a("button",{key:0,onClick:Te,class:"btn-clear-filters"},[...u[32]||(u[32]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),T(" Clear ",-1)])])):R("",!0),e("div",Qi,p(ie.value.length)+" of "+p(q.value.length),1)])],512),[[Je,C.value]])])):R("",!0),P.value?(n(),a("div",er,[...u[33]||(u[33]=[e("i",{class:"mdi mdi-loading mdi-spin"},null,-1),e("p",null,"Loading profiles...",-1)])])):q.value.length===0?(n(),a("div",tr,[...u[34]||(u[34]=[e("i",{class:"mdi mdi-file-document-outline"},null,-1),e("h3",null,"No Profiles Yet",-1),e("p",null,"Create your first SmartIR profile to get started",-1)])])):R("",!0),z.value==="grid"&&!E.value?(n(),a("div",or,[(n(!0),a(ue,null,ke(ie.value,Z=>(n(),Pe(Ia,{key:`${Z.platform}-${Z.code}`,profile:Z,onEdit:ce=>ge(Z.platform,Z),onCommands:ce=>ge(Z.platform,Z,2),onDownload:ce=>xe(Z.platform,Z),onDelete:ce=>Le(Z.platform,Z)},null,8,["profile","onEdit","onCommands","onDownload","onDelete"]))),128))])):z.value==="list"&&!E.value&&ie.value.length>0?(n(),Pe(Xa,{key:5,profiles:ie.value,onEdit:u[10]||(u[10]=Z=>ge(Z.platform,Z)),onCommands:u[11]||(u[11]=Z=>ge(Z.platform,Z,2)),onDownload:u[12]||(u[12]=Z=>xe(Z.platform,Z)),onDelete:u[13]||(u[13]=Z=>Le(Z.platform,Z))},null,8,["profiles"])):R("",!0),q.value.length>0&&ie.value.length===0&&!E.value?(n(),a("div",lr,[...u[35]||(u[35]=[e("i",{class:"mdi mdi-filter-off"},null,-1),e("h3",null,"No profiles match your filters",-1),e("p",null,"Try adjusting your search or filter criteria",-1)])])):R("",!0)])):(n(),a("div",nr,[u[39]||(u[39]=e("div",{class:"status-badge warning"},[e("i",{class:"mdi mdi-information"}),e("span",null,"Not Installed")],-1)),e("div",sr,[u[37]||(u[37]=e("h4",null,"Why Install SmartIR?",-1)),e("ul",ar,[(n(!0),a(ue,null,ke(((ne=(K=_.value)==null?void 0:K.recommendation)==null?void 0:ne.benefits)||Y,(Z,ce)=>(n(),a("li",{key:ce},[u[36]||(u[36]=e("i",{class:"mdi mdi-check"},null,-1)),e("span",null,p(Z),1)]))),128))])]),e("div",ir,[e("p",null,p(((oe=(se=_.value)==null?void 0:se.recommendation)==null?void 0:oe.message)||"Install SmartIR to unlock climate device support!"),1)]),e("div",{class:"card-actions"},[e("button",{onClick:Oe,class:"btn-primary"},[...u[38]||(u[38]=[e("i",{class:"mdi mdi-github"},null,-1),T(" Install SmartIR ",-1)])])])]))],512),[[Je,L.value]]),ye(je,{isOpen:b.value.show,title:b.value.title,message:b.value.message,confirmText:b.value.canDelete===!1?null:"Delete",cancelText:"Close",dangerMode:!0,confirmDisabled:b.value.canDelete===!1,onConfirm:A,onCancel:u[14]||(u[14]=Z=>b.value.show=!1)},null,8,["isOpen","title","message","confirmText","confirmDisabled"]),ye(Ii,{isOpen:f.value,onClose:u[15]||(u[15]=Z=>f.value=!1)},null,8,["isOpen"])])}}},dr=we(rr,[["__scopeId","data-v-4ef33ace"]]),ur={class:"climate-form"},cr={class:"learning-mode-section"},mr={class:"mode-toggle"},vr={class:"mode-content"},pr={class:"mode-stats"},fr={class:"stat-badge"},gr={class:"stat-badge time"},yr={class:"mode-content"},br={class:"mode-stats"},hr={class:"stat-badge"},kr={class:"stat-badge time warning"},wr={key:0,class:"command-breakdown"},$r={class:"warning-text"},Cr={class:"form-section"},_r={key:0,class:"help-text"},Sr={key:1,class:"help-text"},Ir={class:"form-row"},Dr={class:"form-group"},Tr={class:"form-group"},xr={class:"form-group"},Rr={key:2,class:"representative-temp-section"},Mr={class:"form-group"},Ar=["value"],Or={class:"form-section"},Lr={class:"checkbox-grid"},Er={class:"checkbox-item"},Vr={class:"checkbox-item"},Pr={class:"checkbox-item"},Ur={class:"checkbox-item"},jr={class:"checkbox-item"},Fr={class:"checkbox-item"},Nr={class:"form-section"},Br={class:"checkbox-grid"},Hr={class:"checkbox-item"},qr={class:"checkbox-item"},zr={class:"checkbox-item"},Jr={class:"checkbox-item"},Wr={class:"form-section"},Kr={class:"checkbox-grid"},Xr={class:"checkbox-item"},Gr={class:"checkbox-item"},Yr={class:"checkbox-item"},Zr={class:"checkbox-item"},Qr={class:"form-section"},ed={class:"form-group"},td={class:"form-group"},od={class:"form-group"},ld={key:0,class:"validation-summary"},nd={__name:"ClimateProfileForm",props:{modelValue:{type:Object,default:()=>({})}},emits:["update:modelValue"],setup(o,{emit:c}){const d=o,$=c,h=y("quick"),r=y({minTemp:16,maxTemp:30,precision:1,representativeTemp:24,modes:["off","auto","cool","heat"],fanModes:["auto","low","medium","high"],swingModes:[],tempSensor:"",humiditySensor:"",powerSensor:"",learningMode:"quick",...d.modelValue}),m=W(()=>{const C=[],s=r.value.minTemp||16,b=r.value.maxTemp||30,f=r.value.precision||1;for(let O=s;O<=b;O+=f)C.push(O);return C}),g=W(()=>r.value.modes.filter(C=>C!=="off").length),I=W(()=>r.value.fanModes.length||1),_=W(()=>r.value.swingModes.length||1),E=W(()=>{const C=r.value.minTemp||16,s=r.value.maxTemp||30,b=r.value.precision||1;return Math.floor((s-C)/b)+1}),w=W(()=>{const C=r.value.modes.includes("off")?1:0;return g.value*I.value*_.value+C}),l=W(()=>Math.ceil(w.value*30/60)),L=W(()=>{const C=r.value.modes.includes("off")?1:0;return g.value*E.value*I.value*_.value+C}),q=W(()=>Math.ceil(L.value*30/60)),P=W(()=>{const C=[];return(!r.value.minTemp||r.value.minTemp<10||r.value.minTemp>35)&&C.push("Minimum temperature must be between 10Â°C and 35Â°C"),(!r.value.maxTemp||r.value.maxTemp<10||r.value.maxTemp>35)&&C.push("Maximum temperature must be between 10Â°C and 35Â°C"),r.value.minTemp>=r.value.maxTemp&&C.push("Minimum temperature must be less than maximum temperature"),(!r.value.modes||r.value.modes.length===0)&&C.push("At least one HVAC mode must be selected"),C});return ae(h,C=>{r.value.learningMode=C}),ae(r,C=>{$("update:modelValue",C)},{deep:!0,immediate:!0}),(C,s)=>(n(),a("div",ur,[s[63]||(s[63]=e("h3",null,"Climate Device Configuration",-1)),e("div",cr,[e("div",mr,[e("label",{class:G(["mode-option",{active:h.value==="quick"}])},[J(e("input",{type:"radio",value:"quick","onUpdate:modelValue":s[0]||(s[0]=b=>h.value=b)},null,512),[[Ne,h.value]]),e("div",vr,[s[23]||(s[23]=e("div",{class:"mode-header"},[e("i",{class:"mdi mdi-flash"}),e("strong",null,"Quick Mode (Recommended)")],-1)),s[24]||(s[24]=e("p",null,"Learn one temperature per mode combination",-1)),e("div",pr,[e("span",fr,p(w.value)+" commands",1),e("span",gr,"~"+p(l.value)+" min",1)])])],2),e("label",{class:G(["mode-option",{active:h.value==="complete"}])},[J(e("input",{type:"radio",value:"complete","onUpdate:modelValue":s[1]||(s[1]=b=>h.value=b)},null,512),[[Ne,h.value]]),e("div",yr,[s[25]||(s[25]=e("div",{class:"mode-header"},[e("i",{class:"mdi mdi-check-all"}),e("strong",null,"Complete Mode")],-1)),s[26]||(s[26]=e("p",null,"Learn all temperature combinations",-1)),e("div",br,[e("span",hr,p(L.value)+" commands",1),e("span",kr,"~"+p(q.value)+" min",1)])])],2)]),h.value==="complete"?(n(),a("div",wr,[s[27]||(s[27]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[e("strong",null,"Complete mode will require learning "+p(L.value)+" commands",1),e("p",null,"This includes all combinations of modes ("+p(g.value)+"), temperatures ("+p(E.value)+"), fan speeds ("+p(I.value)+"), and swing modes ("+p(_.value)+").",1),e("p",$r,"â±ï¸ Estimated time: "+p(q.value)+" minutes at ~30 seconds per command",1)])])):R("",!0)]),e("div",Cr,[s[33]||(s[33]=e("h4",null,"Temperature Range",-1)),h.value==="quick"?(n(),a("p",_r," Define the full temperature range your device supports. You'll select one temperature to learn below. ")):(n(),a("p",Sr," Define the temperature range. All temperatures in this range will be learned. ")),e("div",Ir,[e("div",Dr,[s[28]||(s[28]=e("label",null,"Minimum Temperature (Â°C) *",-1)),J(e("input",{"onUpdate:modelValue":s[2]||(s[2]=b=>r.value.minTemp=b),type:"number",min:"10",max:"35",placeholder:"16"},null,512),[[Me,r.value.minTemp,void 0,{number:!0}]])]),e("div",Tr,[s[29]||(s[29]=e("label",null,"Maximum Temperature (Â°C) *",-1)),J(e("input",{"onUpdate:modelValue":s[3]||(s[3]=b=>r.value.maxTemp=b),type:"number",min:"10",max:"35",placeholder:"30"},null,512),[[Me,r.value.maxTemp,void 0,{number:!0}]])]),e("div",xr,[s[31]||(s[31]=e("label",null,"Precision",-1)),J(e("select",{"onUpdate:modelValue":s[4]||(s[4]=b=>r.value.precision=b)},[...s[30]||(s[30]=[e("option",{value:1},"1Â°C (Whole degrees)",-1),e("option",{value:.5},"0.5Â°C (Half degrees)",-1)])],512),[[Se,r.value.precision,void 0,{number:!0}]])])]),h.value==="quick"?(n(),a("div",Rr,[e("div",Mr,[s[32]||(s[32]=e("label",null,"Representative Temperature to Learn *",-1)),J(e("select",{"onUpdate:modelValue":s[5]||(s[5]=b=>r.value.representativeTemp=b)},[(n(!0),a(ue,null,ke(m.value,b=>(n(),a("option",{key:b,value:b},p(b)+"Â°C ",9,Ar))),128))],512),[[Se,r.value.representativeTemp,void 0,{number:!0}]]),e("small",null,"This temperature will be learned for all mode combinations. The device profile will still show the full range ("+p(r.value.minTemp)+"Â°C - "+p(r.value.maxTemp)+"Â°C).",1)])])):R("",!0)]),e("div",Or,[s[40]||(s[40]=e("h4",null,"Supported HVAC Modes *",-1)),s[41]||(s[41]=e("p",{class:"help-text"},"Select all modes your device supports",-1)),e("div",Lr,[e("label",Er,[J(e("input",{type:"checkbox",value:"off","onUpdate:modelValue":s[6]||(s[6]=b=>r.value.modes=b)},null,512),[[ve,r.value.modes]]),s[34]||(s[34]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),T(" Off ")],-1))]),e("label",Vr,[J(e("input",{type:"checkbox",value:"auto","onUpdate:modelValue":s[7]||(s[7]=b=>r.value.modes=b)},null,512),[[ve,r.value.modes]]),s[35]||(s[35]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-autorenew"}),T(" Auto ")],-1))]),e("label",Pr,[J(e("input",{type:"checkbox",value:"cool","onUpdate:modelValue":s[8]||(s[8]=b=>r.value.modes=b)},null,512),[[ve,r.value.modes]]),s[36]||(s[36]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-snowflake"}),T(" Cool ")],-1))]),e("label",Ur,[J(e("input",{type:"checkbox",value:"heat","onUpdate:modelValue":s[9]||(s[9]=b=>r.value.modes=b)},null,512),[[ve,r.value.modes]]),s[37]||(s[37]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fire"}),T(" Heat ")],-1))]),e("label",jr,[J(e("input",{type:"checkbox",value:"dry","onUpdate:modelValue":s[10]||(s[10]=b=>r.value.modes=b)},null,512),[[ve,r.value.modes]]),s[38]||(s[38]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-water-percent"}),T(" Dry ")],-1))]),e("label",Fr,[J(e("input",{type:"checkbox",value:"fan_only","onUpdate:modelValue":s[11]||(s[11]=b=>r.value.modes=b)},null,512),[[ve,r.value.modes]]),s[39]||(s[39]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan"}),T(" Fan Only ")],-1))])])]),e("div",Nr,[s[46]||(s[46]=e("h4",null,"Fan Modes",-1)),s[47]||(s[47]=e("p",{class:"help-text"},"Select all fan speeds your device supports",-1)),e("div",Br,[e("label",Hr,[J(e("input",{type:"checkbox",value:"auto","onUpdate:modelValue":s[12]||(s[12]=b=>r.value.fanModes=b)},null,512),[[ve,r.value.fanModes]]),s[42]||(s[42]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-autorenew"}),T(" Auto ")],-1))]),e("label",qr,[J(e("input",{type:"checkbox",value:"low","onUpdate:modelValue":s[13]||(s[13]=b=>r.value.fanModes=b)},null,512),[[ve,r.value.fanModes]]),s[43]||(s[43]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-1"}),T(" Low ")],-1))]),e("label",zr,[J(e("input",{type:"checkbox",value:"medium","onUpdate:modelValue":s[14]||(s[14]=b=>r.value.fanModes=b)},null,512),[[ve,r.value.fanModes]]),s[44]||(s[44]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-2"}),T(" Medium ")],-1))]),e("label",Jr,[J(e("input",{type:"checkbox",value:"high","onUpdate:modelValue":s[15]||(s[15]=b=>r.value.fanModes=b)},null,512),[[ve,r.value.fanModes]]),s[45]||(s[45]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-3"}),T(" High ")],-1))])])]),e("div",Wr,[s[52]||(s[52]=e("h4",null,"Swing Modes (Optional)",-1)),s[53]||(s[53]=e("p",{class:"help-text"},"Select if your device has swing/oscillation",-1)),e("div",Kr,[e("label",Xr,[J(e("input",{type:"checkbox",value:"off","onUpdate:modelValue":s[16]||(s[16]=b=>r.value.swingModes=b)},null,512),[[ve,r.value.swingModes]]),s[48]||(s[48]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-horizontal"}),T(" Off ")],-1))]),e("label",Gr,[J(e("input",{type:"checkbox",value:"vertical","onUpdate:modelValue":s[17]||(s[17]=b=>r.value.swingModes=b)},null,512),[[ve,r.value.swingModes]]),s[49]||(s[49]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-vertical"}),T(" Vertical ")],-1))]),e("label",Yr,[J(e("input",{type:"checkbox",value:"horizontal","onUpdate:modelValue":s[18]||(s[18]=b=>r.value.swingModes=b)},null,512),[[ve,r.value.swingModes]]),s[50]||(s[50]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-horizontal"}),T(" Horizontal ")],-1))]),e("label",Zr,[J(e("input",{type:"checkbox",value:"both","onUpdate:modelValue":s[19]||(s[19]=b=>r.value.swingModes=b)},null,512),[[ve,r.value.swingModes]]),s[51]||(s[51]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-arrow-all"}),T(" Both ")],-1))])])]),e("div",Qr,[s[60]||(s[60]=e("h4",null,"Sensors (Optional)",-1)),s[61]||(s[61]=e("p",{class:"help-text"},"Link external sensors for better climate control",-1)),e("div",ed,[s[54]||(s[54]=e("label",null,"Temperature Sensor",-1)),J(e("input",{"onUpdate:modelValue":s[20]||(s[20]=b=>r.value.tempSensor=b),type:"text",placeholder:"sensor.living_room_temperature"},null,512),[[Me,r.value.tempSensor]]),s[55]||(s[55]=e("small",null,"Entity ID of temperature sensor",-1))]),e("div",td,[s[56]||(s[56]=e("label",null,"Humidity Sensor",-1)),J(e("input",{"onUpdate:modelValue":s[21]||(s[21]=b=>r.value.humiditySensor=b),type:"text",placeholder:"sensor.living_room_humidity"},null,512),[[Me,r.value.humiditySensor]]),s[57]||(s[57]=e("small",null,"Entity ID of humidity sensor",-1))]),e("div",od,[s[58]||(s[58]=e("label",null,"Power Sensor",-1)),J(e("input",{"onUpdate:modelValue":s[22]||(s[22]=b=>r.value.powerSensor=b),type:"text",placeholder:"binary_sensor.ac_power"},null,512),[[Me,r.value.powerSensor]]),s[59]||(s[59]=e("small",null,"Entity ID of power sensor (to detect on/off state)",-1))])]),P.value.length>0?(n(),a("div",ld,[s[62]||(s[62]=e("h4",null,[e("i",{class:"mdi mdi-alert-circle"}),T(" Please fix the following: ")],-1)),e("ul",null,[(n(!0),a(ue,null,ke(P.value,(b,f)=>(n(),a("li",{key:f},p(b),1))),128))])])):R("",!0)]))}},sd=we(nd,[["__scopeId","data-v-c44d7198"]]),ad={class:"command-wizard"},id={class:"device-selection-section"},rd={class:"input-wrapper"},dd=["value"],ud={key:0,class:"validation-tooltip"},cd={class:"form-group"},md=["disabled"],vd={key:0},pd={key:1},fd={key:0,class:"edit-mode-banner"},gd={class:"wizard-info"},yd={key:0},bd={key:1},hd={class:"progress-info"},kd={class:"progress-bar"},wd={class:"progress-text"},$d={class:"commands-grid"},Cd={class:"command-header"},_d={class:"command-icon"},Sd={class:"command-info"},Id={key:0,class:"learning-indicator"},Dd={key:0,class:"ir-learning-steps"},Td={key:1,class:"rf-learning-steps"},xd={class:"command-actions"},Rd=["onClick","disabled"],Md={key:1,class:"learned-status"},Ad=["onClick","disabled"],Od=["onClick"],Ld={class:"quick-actions"},Ed=["disabled"],Vd=["disabled"],Pd={__name:"CommandLearningWizard",props:{modelValue:{type:Object,default:()=>({})},platform:{type:String,required:!0},config:{type:Object,required:!0},broadlinkDevice:{type:String,default:""},manufacturer:{type:String,required:!0},model:{type:String,required:!0},commandType:{type:String,default:"ir"}},emits:["update:modelValue","update:broadlinkDevice","update:commandType"],setup(o,{emit:c}){const d=He(),$=o,h=c,r=y({...$.modelValue}),m=y(null),g=y(null),I=y([]),_=y($.broadlinkDevice),E=y($.commandType),w=y(!1),l=y([]),L=y(!1),q=y(!1),P=y({show:!1,commandKey:null,commandLabel:""}),C=y(!1),s=W(()=>{const D=[];if($.platform==="climate"){const v=$.config.modes||[],U=$.config.fanModes||[],pe=$.config.minTemp||16,Oe=$.config.maxTemp||30;v.forEach(fe=>{if(fe==="off")D.push({key:"off",label:"Power Off",description:"Turn device off",icon:"mdi mdi-power",mode:"off"});else for(let ge=pe;ge<=Oe;ge++)U.forEach(xe=>{const Le=`${fe}_${ge}_${xe}`;D.push({key:Le,label:`${fe.toUpperCase()} ${ge}Â°C ${xe}`,description:`Mode: ${fe}, Temp: ${ge}Â°C, Fan: ${xe}`,icon:z(fe),mode:fe,temp:ge,fanMode:xe})})})}else if($.platform==="media_player"){const v=$.config.features||[];v.includes("turn_on")&&(D.push({key:"turn_on",label:"Power On",description:"Turn on the device",icon:"mdi mdi-power"}),D.push({key:"turn_off",label:"Power Off",description:"Turn off the device",icon:"mdi mdi-power-off"})),v.includes("volume")&&(D.push({key:"volume_up",label:"Volume Up",description:"Increase volume",icon:"mdi mdi-volume-plus"}),D.push({key:"volume_down",label:"Volume Down",description:"Decrease volume",icon:"mdi mdi-volume-minus"})),v.includes("mute")&&D.push({key:"mute",label:"Mute",description:"Toggle mute",icon:"mdi mdi-volume-mute"}),v.includes("source")&&(D.push({key:"source_hdmi1",label:"Source: HDMI 1",description:"Switch to HDMI 1",icon:"mdi mdi-import"}),D.push({key:"source_hdmi2",label:"Source: HDMI 2",description:"Switch to HDMI 2",icon:"mdi mdi-import"}),D.push({key:"source_hdmi3",label:"Source: HDMI 3",description:"Switch to HDMI 3",icon:"mdi mdi-import"})),v.includes("channel")&&(D.push({key:"channel_up",label:"Channel Up",description:"Next channel",icon:"mdi mdi-chevron-up"}),D.push({key:"channel_down",label:"Channel Down",description:"Previous channel",icon:"mdi mdi-chevron-down"}))}else if($.platform==="fan"){const v=$.config.speedLevels||3,U=$.config.features||[];D.push({key:"turn_on",label:"Power On",description:"Turn on the fan",icon:"mdi mdi-power"}),D.push({key:"turn_off",label:"Power Off",description:"Turn off the fan",icon:"mdi mdi-power-off"});for(let pe=1;pe<=v;pe++){const Oe=pe===1?"Low":pe===v?"High":pe===2&&v===3?"Medium":`Speed ${pe}`;D.push({key:`speed_${pe}`,label:`${Oe}`,description:`Set fan to speed level ${pe}`,icon:"mdi mdi-fan"})}U.includes("oscillate")&&(D.push({key:"oscillate_on",label:"Oscillate On",description:"Enable oscillation",icon:"mdi mdi-sync"}),D.push({key:"oscillate_off",label:"Oscillate Off",description:"Disable oscillation",icon:"mdi mdi-sync-off"})),U.includes("direction")&&(D.push({key:"direction_forward",label:"Direction: Forward",description:"Set direction to forward",icon:"mdi mdi-rotate-right"}),D.push({key:"direction_reverse",label:"Direction: Reverse",description:"Set direction to reverse",icon:"mdi mdi-rotate-left"}))}else if($.platform==="light"){const v=$.config.features||[];v.includes("turn_on")&&(D.push({key:"turn_on",label:"Power On",description:"Turn on the light",icon:"mdi mdi-lightbulb-on"}),D.push({key:"turn_off",label:"Power Off",description:"Turn off the light",icon:"mdi mdi-lightbulb-off"})),v.includes("brightness")&&(D.push({key:"brightness_up",label:"Brightness Up",description:"Increase brightness",icon:"mdi mdi-brightness-7"}),D.push({key:"brightness_down",label:"Brightness Down",description:"Decrease brightness",icon:"mdi mdi-brightness-5"})),v.includes("color_temp")&&(D.push({key:"color_temp_warm",label:"Warm White",description:"Set to warm white",icon:"mdi mdi-weather-sunset"}),D.push({key:"color_temp_cool",label:"Cool White",description:"Set to cool white",icon:"mdi mdi-weather-sunny"})),v.includes("rgb")&&(D.push({key:"color_red",label:"Color: Red",description:"Set color to red",icon:"mdi mdi-palette"}),D.push({key:"color_green",label:"Color: Green",description:"Set color to green",icon:"mdi mdi-palette"}),D.push({key:"color_blue",label:"Color: Blue",description:"Set color to blue",icon:"mdi mdi-palette"}))}return D}),b=W(()=>s.value.length),f=W(()=>Object.keys(r.value).length),O=W(()=>b.value===0?0:Math.round(f.value/b.value*100));function z(D){return{off:"mdi mdi-power",auto:"mdi mdi-autorenew",cool:"mdi mdi-snowflake",heat:"mdi mdi-fire",dry:"mdi mdi-water-percent",fan_only:"mdi mdi-fan"}[D]||"mdi mdi-remote"}async function Y(D){if(!m.value){if(!_.value){q.value=!0,window.scrollTo({top:0,behavior:"smooth"});return}q.value=!1,m.value=D.key;try{const v=$.manufacturer.toLowerCase().replace(/[^a-z0-9]+/g,"_"),U=$.model.toLowerCase().replace(/[^a-z0-9]+/g,"_"),pe=`${v}_${U}`,fe=(await ee.post("/api/commands/learn",{entity_id:_.value,device:pe,command:D.key,command_type:E.value})).data;if(fe.success&&fe.code)r.value[D.key]=fe.code,h("update:modelValue",r.value),L.value=!0,fe.code==="pending"&&console.log(`â³ Command '${D.key}' learned, code will be fetched from storage when saving`),w.value&&l.value.length>0&&setTimeout(()=>{const ge=l.value.shift();ge?Y(ge):w.value=!1},1e3);else throw new Error(fe.error||"Failed to learn command")}catch(v){console.error("Error learning command:",v),d.error(`Error learning command: ${v.message}`),w.value=!1,l.value=[]}finally{w.value||(m.value=null)}}}async function B(D){var v;if(!_.value){q.value=!0,window.scrollTo({top:0,behavior:"smooth"});return}if(!r.value[D]){(v=d.value)==null||v.error("Command not learned yet");return}g.value=D;try{const U=r.value[D];await ee.post("/api/commands/send-raw",{entity_id:_.value,command:U,command_type:E.value}),d.success("Command sent successfully")}catch(U){console.error("Error testing command:",U),d.error(`Error testing command: ${U.message}`)}finally{g.value=null}}function le(D){const v=s.value.find(U=>U.key===D);P.value={show:!0,commandKey:D,commandLabel:v?v.label:D}}function M(){const D=P.value.commandKey;delete r.value[D],h("update:modelValue",r.value),P.value.show=!1}function F(){const D=s.value.filter(U=>!r.value[U.key]);if(D.length===0)return;w.value=!0,l.value=[...D];const v=l.value.shift();v&&Y(v)}function te(){C.value=!0}function ie(){r.value={},h("update:modelValue",r.value),C.value=!1}ae(()=>$.modelValue,D=>{r.value={...D}},{deep:!0}),Ae(async()=>{await be()});async function be(){try{console.log("SmartIR device - commands will be loaded from SmartIR JSON file, not Broadlink storage")}catch(D){console.error("Error in loadExistingCommands:",D)}}function _e(){h("update:broadlinkDevice",_.value)}function Te(){h("update:commandType",E.value)}async function Ie(){try{console.log("ğŸ” Loading Broadlink devices from /api/remote/devices");const D=await ee.get("/api/remote/devices");console.log("ğŸ“¦ Response data:",D.data);const v=D.data.devices||[];console.log(`âœ… Found ${v.length} devices:`,v),I.value=v}catch(D){console.error("âŒ Error loading remote devices:",D),I.value=[]}}return ae(()=>$.broadlinkDevice,D=>{_.value=D}),ae(_,D=>{D&&(q.value=!1)}),ae(()=>$.commandType,D=>{E.value=D}),Ae(async()=>{await Ie(),await be()}),(D,v)=>(n(),a("div",ad,[v[22]||(v[22]=e("h3",null,"Learn IR Commands",-1)),e("div",id,[e("div",{class:G(["form-group",{"has-error":q.value}])},[v[6]||(v[6]=e("label",null,"Broadlink Device *",-1)),e("div",rd,[J(e("select",{"onUpdate:modelValue":v[0]||(v[0]=U=>_.value=U),onChange:_e},[v[4]||(v[4]=e("option",{value:""},"Select Broadlink device...",-1)),(n(!0),a(ue,null,ke(I.value,U=>(n(),a("option",{key:U.entity_id,value:U.entity_id},p(U.name||U.entity_id),9,dd))),128))],544),[[Se,_.value]]),q.value?(n(),a("div",ud,[...v[5]||(v[5]=[e("i",{class:"mdi mdi-alert"},null,-1),T(" Device is required ",-1)])])):R("",!0)]),e("small",null,"This device will be used to learn commands ("+p(I.value.length)+" devices found)",1)],2),e("div",cd,[v[8]||(v[8]=e("label",null,"Command Type *",-1)),J(e("select",{"onUpdate:modelValue":v[1]||(v[1]=U=>E.value=U),onChange:Te,disabled:f.value>0},[...v[7]||(v[7]=[e("option",{value:"ir"},"ğŸ“¡ Infrared (IR) - Most common for AC, TV, etc.",-1),e("option",{value:"rf"},"ğŸ“» Radio Frequency (RF) - For RF remotes",-1)])],40,md),[[Se,E.value]]),f.value>0?(n(),a("small",vd,"Command type cannot be changed after learning commands")):(n(),a("small",pd,"Select the type of commands your device uses"))])]),f.value>0&&!L.value?(n(),a("div",fd,[v[10]||(v[10]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[v[9]||(v[9]=e("strong",null,"Editing Existing Profile",-1)),e("p",null,p(f.value)+" command"+p(f.value!==1?"s":"")+' already learned. You can re-learn any command by clicking the delete icon and then "Learn Command".',1)])])):R("",!0),e("div",gd,[v[14]||(v[14]=e("i",{class:"mdi mdi-information"},null,-1)),e("div",null,[v[13]||(v[13]=e("p",null,[e("strong",null,"How it works:")],-1)),o.commandType==="ir"?(n(),a("ol",yd,[...v[11]||(v[11]=[e("li",null,'Click "Learn Command" for each combination',-1),e("li",null,[e("strong",null,"Point your IR remote directly at the Broadlink device")],-1),e("li",null,"Press the button on your remote",-1),e("li",null,"Wait for confirmation (up to 30 seconds)",-1)])])):(n(),a("ol",bd,[...v[12]||(v[12]=[e("li",null,'Click "Learn Command" for each combination',-1),e("li",null,[e("strong",null,"Step 1:"),T(" Hold button on remote - Broadlink scans for RF frequency")],-1),e("li",null,[e("strong",null,"Step 2:"),T(" Watch for Home Assistant notification, then press and release button")],-1),e("li",null,"Keep remote within 5cm of Broadlink (RF doesn't need line-of-sight)",-1),e("li",null,"Wait for confirmation (may take up to 30 seconds)",-1)])]))])]),e("div",hd,[e("div",kd,[e("div",{class:"progress-fill",style:ct({width:O.value+"%"})},null,4)]),e("span",wd,p(f.value)+" / "+p(b.value)+" commands learned ("+p(O.value)+"%) ",1)]),e("div",$d,[(n(!0),a(ue,null,ke(s.value,U=>(n(),a("div",{key:U.key,class:G(["command-card",{learned:r.value[U.key],learning:m.value===U.key}])},[e("div",Cd,[e("div",_d,[e("i",{class:G(U.icon)},null,2)]),e("div",Sd,[e("h4",null,p(U.label),1),e("p",null,p(U.description),1)])]),m.value===U.key?(n(),a("div",Id,[o.commandType==="ir"?(n(),a("div",Dd,[...v[15]||(v[15]=[e("p",null,[e("strong",null,"Point your remote directly at the Broadlink device and press the button.")],-1),e("small",null,"Listening for up to 30 seconds...",-1)])])):(n(),a("div",Td,[...v[16]||(v[16]=[e("p",{class:"rf-title"},[e("strong",null,"Learning request sent to device.")],-1),e("p",{class:"rf-subtitle"},[T("RF learning is a "),e("strong",null,"two-step process"),T(":")],-1),e("ol",null,[e("li",null,[e("strong",null,"Step 1 - Frequency Sweep (~10-15 seconds):"),T(" Press and hold the button on your remote until the notification updates. ")]),e("li",null,[e("strong",null,"Step 2 - Learn Signal:"),T(" Press and release the button once. ")])],-1),e("p",{class:"rf-note"},"Follow the Home Assistant notifications (ğŸ””) for real-time instructions.",-1)])]))])):R("",!0),e("div",xd,[r.value[U.key]?(n(),a("div",Md,[v[18]||(v[18]=e("i",{class:"mdi mdi-check-circle"},null,-1)),v[19]||(v[19]=e("span",null,"Learned",-1)),e("span",{class:G(["command-type-badge",E.value])},p(E.value.toUpperCase()),3),e("button",{onClick:pe=>B(U.key),class:"icon-btn",title:"Test command",disabled:g.value===U.key,style:{"margin-left":"auto"}},[e("i",{class:G(["mdi mdi-play",{"mdi-spin":g.value===U.key}])},null,2)],8,Ad),e("button",{onClick:pe=>le(U.key),class:"icon-btn danger",title:"Delete and re-learn"},[...v[17]||(v[17]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,Od)])):(n(),a("button",{key:0,onClick:pe=>Y(U),class:G(["btn-learn",{learning:m.value===U.key}]),disabled:m.value!==null},[e("i",{class:G(["mdi mdi-radio-tower",{"mdi-spin":m.value===U.key}])},null,2),T(" "+p(m.value===U.key?"Listening...":"Learn Command"),1)],10,Rd))])],2))),128))]),e("div",Ld,[e("button",{onClick:F,class:"btn-secondary",disabled:m.value!==null||f.value===b.value},[...v[20]||(v[20]=[e("i",{class:"mdi mdi-play-circle"},null,-1),T(" Learn All Remaining ",-1)])],8,Ed),e("button",{onClick:te,class:"btn-text",disabled:f.value===0},[...v[21]||(v[21]=[e("i",{class:"mdi mdi-delete-sweep"},null,-1),T(" Clear All ",-1)])],8,Vd)]),ye(je,{isOpen:P.value.show,title:"Delete Learned Command?",message:`Are you sure you want to delete the '${P.value.commandLabel}' command?

You will need to re-learn this command.`,confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,onConfirm:M,onCancel:v[2]||(v[2]=U=>P.value.show=!1)},null,8,["isOpen","message"]),ye(je,{isOpen:C.value,title:"Delete All Learned Commands?",message:"Are you sure you want to delete all learned commands? This cannot be undone.\\n\\nYou will need to re-learn all commands.",confirmText:"Delete All",cancelText:"Cancel",dangerMode:!0,onConfirm:ie,onCancel:v[3]||(v[3]=U=>C.value=!1)},null,8,["isOpen"])]))}},Ud=we(Pd,[["__scopeId","data-v-9a9e9e51"]]),jd={class:"profile-preview"},Fd={class:"preview-summary"},Nd={class:"summary-card"},Bd={class:"stats-grid"},Hd={class:"stat-item"},qd={class:"stat-value"},zd={class:"stat-item"},Jd={class:"stat-value"},Wd={class:"stat-item"},Kd={class:"stat-value"},Xd={class:"preview-tabs"},Gd={class:"preview-content"},Yd={key:0,class:"tab-content"},Zd={class:"code-header"},Qd={class:"code-block"},eu={key:1,class:"tab-content"},tu={class:"code-header"},ou={class:"code-block"},lu={key:2,class:"tab-content"},nu={class:"instructions"},su={class:"step-item"},au={class:"step-content"},iu={class:"code-path"},ru={__name:"ProfilePreview",props:{profile:{type:Object,required:!0},jsonData:{type:Object,required:!0},yamlConfig:{type:String,required:!0}},setup(o){const c=He(),d=o,$=y("json"),h=y(!1),r=y(!1),m=W(()=>Object.keys(d.profile.commands||{}).length),g=W(()=>JSON.stringify(d.jsonData,null,2));async function I(){try{await navigator.clipboard.writeText(g.value),h.value=!0,setTimeout(()=>{h.value=!1},2e3)}catch(E){console.error("Failed to copy JSON:",E),c.error("Failed to copy to clipboard")}}async function _(){try{await navigator.clipboard.writeText(d.yamlConfig),r.value=!0,setTimeout(()=>{r.value=!1},2e3)}catch(E){console.error("Failed to copy YAML:",E),c.error("Failed to copy to clipboard")}}return(E,w)=>{var l;return n(),a("div",jd,[w[22]||(w[22]=e("h3",null,"Preview & Save",-1)),e("div",Fd,[e("div",Nd,[w[4]||(w[4]=e("i",{class:"mdi mdi-check-circle"},null,-1)),e("div",null,[w[3]||(w[3]=e("h4",null,"Profile Ready!",-1)),e("p",null,p(o.profile.manufacturer)+" "+p(o.profile.model),1)])]),e("div",Bd,[e("div",Hd,[e("span",qd,p(m.value),1),w[5]||(w[5]=e("span",{class:"stat-label"},"Commands Learned",-1))]),e("div",zd,[e("span",Jd,p(o.profile.platform),1),w[6]||(w[6]=e("span",{class:"stat-label"},"Platform",-1))]),e("div",Wd,[e("span",Kd,p(((l=o.profile.config.modes)==null?void 0:l.length)||0),1),w[7]||(w[7]=e("span",{class:"stat-label"},"HVAC Modes",-1))])])]),e("div",Xd,[e("button",{onClick:w[0]||(w[0]=L=>$.value="json"),class:G(["tab-button",{active:$.value==="json"}])},[...w[8]||(w[8]=[e("i",{class:"mdi mdi-code-json"},null,-1),T(" SmartIR JSON ",-1)])],2),e("button",{onClick:w[1]||(w[1]=L=>$.value="yaml"),class:G(["tab-button",{active:$.value==="yaml"}])},[...w[9]||(w[9]=[e("i",{class:"mdi mdi-file-code"},null,-1),T(" YAML Config ",-1)])],2),e("button",{onClick:w[2]||(w[2]=L=>$.value="instructions"),class:G(["tab-button",{active:$.value==="instructions"}])},[...w[10]||(w[10]=[e("i",{class:"mdi mdi-information"},null,-1),T(" Instructions ",-1)])],2)]),e("div",Gd,[$.value==="json"?(n(),a("div",Yd,[e("div",Zd,[w[12]||(w[12]=e("h4",null,"SmartIR Device Code JSON",-1)),e("button",{onClick:I,class:"btn-copy"},[w[11]||(w[11]=e("i",{class:"mdi mdi-content-copy"},null,-1)),T(" "+p(h.value?"Copied!":"Copy"),1)])]),e("pre",Qd,[e("code",null,p(g.value),1)]),w[13]||(w[13]=e("p",{class:"code-note"},[e("i",{class:"mdi mdi-information"}),T(" Save this as "),e("code",null,"10000.json"),T(" in your SmartIR codes directory ")],-1))])):R("",!0),$.value==="yaml"?(n(),a("div",eu,[e("div",tu,[w[15]||(w[15]=e("h4",null,"Home Assistant Configuration",-1)),e("button",{onClick:_,class:"btn-copy"},[w[14]||(w[14]=e("i",{class:"mdi mdi-content-copy"},null,-1)),T(" "+p(r.value?"Copied!":"Copy"),1)])]),e("pre",ou,[e("code",null,p(o.yamlConfig),1)]),w[16]||(w[16]=e("p",{class:"code-note"},[e("i",{class:"mdi mdi-information"}),T(" Add this to your "),e("code",null,"configuration.yaml"),T(" file ")],-1))])):R("",!0),$.value==="instructions"?(n(),a("div",lu,[e("div",nu,[w[20]||(w[20]=e("h4",null,"Installation Steps",-1)),e("div",su,[w[19]||(w[19]=e("div",{class:"step-number"},"1",-1)),e("div",au,[w[17]||(w[17]=e("h5",null,"Get Next Code Number",-1)),w[18]||(w[18]=e("p",null,"Custom device codes start at 10000. Check your SmartIR codes directory to find the next available number.",-1)),e("div",iu,[e("code",null,"/config/custom_components/smartir/codes/"+p(o.profile.platform)+"/",1)])])]),w[21]||(w[21]=Fe('<div class="step-item" data-v-e7b997c8><div class="step-number" data-v-e7b997c8>2</div><div class="step-content" data-v-e7b997c8><h5 data-v-e7b997c8>Save JSON File</h5><p data-v-e7b997c8>Copy the JSON from the &quot;SmartIR JSON&quot; tab and save it as <code data-v-e7b997c8>10000.json</code> (or your next available number) in the codes directory.</p></div></div><div class="step-item" data-v-e7b997c8><div class="step-number" data-v-e7b997c8>3</div><div class="step-content" data-v-e7b997c8><h5 data-v-e7b997c8>Update Configuration</h5><p data-v-e7b997c8>Copy the YAML from the &quot;YAML Config&quot; tab and add it to your <code data-v-e7b997c8>configuration.yaml</code> file. Update the <code data-v-e7b997c8>device_code</code> to match your JSON filename.</p></div></div><div class="step-item" data-v-e7b997c8><div class="step-number" data-v-e7b997c8>4</div><div class="step-content" data-v-e7b997c8><h5 data-v-e7b997c8>Restart Home Assistant</h5><p data-v-e7b997c8>Restart Home Assistant to load the new configuration. Your climate entity will appear in the UI.</p></div></div><div class="step-item" data-v-e7b997c8><div class="step-number" data-v-e7b997c8>5</div><div class="step-content" data-v-e7b997c8><h5 data-v-e7b997c8>Test Your Device</h5><p data-v-e7b997c8>Go to your climate entity and test different modes, temperatures, and fan speeds to ensure everything works correctly.</p></div></div><div class="tips-section" data-v-e7b997c8><h4 data-v-e7b997c8><i class="mdi mdi-lightbulb" data-v-e7b997c8></i> Tips </h4><ul data-v-e7b997c8><li data-v-e7b997c8>Keep a backup of your JSON file in case you need to modify it</li><li data-v-e7b997c8>Test all commands to ensure they work as expected</li><li data-v-e7b997c8>You can share your profile with the SmartIR community on GitHub</li><li data-v-e7b997c8>If a command doesn&#39;t work, you can re-learn it and update the JSON</li></ul></div>',5))])])):R("",!0)])])}}},du=we(ru,[["__scopeId","data-v-e7b997c8"]]),uu={class:"wizard-body"},cu={key:0,class:"warning-section"},mu={class:"warning-box"},vu={class:"instructions"},pu={class:"code-block"},fu={class:"steps"},gu={key:0},yu={class:"help-section"},bu={key:0,class:"help-content"},hu={class:"help-step"},ku={key:0,class:"help-step"},wu={class:"help-step"},$u={class:"help-step"},Cu={class:"checklist"},_u={class:"checkbox-label"},Su={key:0,class:"checkbox-label"},Iu={class:"wizard-footer"},Du=["disabled"],Tu={__name:"SmartIRSetupWizard",props:{show:{type:Boolean,default:!1},platform:{type:String,required:!0},warnings:{type:Array,default:()=>[]},configPath:{type:String,default:"/config"}},emits:["close","complete"],setup(o,{emit:c}){const d=o,$=c,h=De("toast"),r=y(!1),m=y(!1),g=y(!1),I=W(()=>d.warnings.length>0?r.value&&m.value:r.value);function _(){const w=`${d.platform}: !include smartir/${d.platform}.yaml`;navigator.clipboard.writeText(w).then(()=>{var l;(l=h.value)==null||l.success("Include line copied to clipboard!","âœ… Copied")}).catch(l=>{var L;console.error("Failed to copy:",l),(L=h.value)==null||L.error("Failed to copy to clipboard","âŒ Copy Failed")})}function E(){$("complete")}return(w,l)=>o.show?(n(),a("div",{key:0,class:"modal-overlay",onClick:l[5]||(l[5]=de(()=>{},["stop"]))},[e("div",{class:"setup-wizard",onClick:l[4]||(l[4]=de(()=>{},["stop"]))},[l[31]||(l[31]=e("div",{class:"wizard-header"},[e("h2",null,[e("i",{class:"mdi mdi-cog"}),T(" SmartIR Configuration Setup ")])],-1)),e("div",uu,[o.warnings.length>0?(n(),a("div",cu,[e("div",mu,[l[11]||(l[11]=e("i",{class:"mdi mdi-alert"},null,-1)),e("div",null,[l[9]||(l[9]=e("h3",null,"âš ï¸ Configuration Migration Needed",-1)),l[10]||(l[10]=e("p",null,"We detected existing platform entries in your configuration.yaml:",-1)),e("ul",null,[(n(!0),a(ue,null,ke(o.warnings,L=>(n(),a("li",{key:L.platform},[e("strong",null,p(L.platform)+":",1),T(" "+p(L.message),1)]))),128))]),e("p",null,[l[6]||(l[6]=e("strong",null,"Action Required:",-1)),l[7]||(l[7]=T(" Move these entries to ",-1)),e("code",null,"smartir/"+p(o.platform)+".yaml",1),l[8]||(l[8]=T(" before continuing.",-1))])])])])):R("",!0),e("div",vu,[l[27]||(l[27]=e("h3",null,"ğŸ“ One-Time Setup",-1)),l[28]||(l[28]=e("p",null,[T("To enable SmartIR device management, add this line to your "),e("code",null,"configuration.yaml"),T(":")],-1)),e("div",pu,[e("code",null,p(o.platform)+": !include smartir/"+p(o.platform)+".yaml",1),e("button",{onClick:_,class:"copy-btn",title:"Copy to clipboard"},[...l[12]||(l[12]=[e("i",{class:"mdi mdi-content-copy"},null,-1)])])]),e("div",fu,[l[19]||(l[19]=e("h4",null,"Steps:",-1)),e("ol",null,[o.warnings.length>0?(n(),a("li",gu,[l[13]||(l[13]=e("strong",null,"Move existing entries:",-1)),l[14]||(l[14]=T(" Copy any existing ",-1)),e("code",null,p(o.platform)+":",1),l[15]||(l[15]=T(" entries from configuration.yaml to ",-1)),e("code",null,"smartir/"+p(o.platform)+".yaml",1)])):R("",!0),l[16]||(l[16]=e("li",null,[e("strong",null,"Add include line:"),T(" Add the line above to your configuration.yaml ")],-1)),l[17]||(l[17]=e("li",null,[e("strong",null,"Save changes:"),T(" Save configuration.yaml ")],-1)),l[18]||(l[18]=e("li",null,[e("strong",null,"Continue here:"),T(` Click "I've Completed Setup" below `)],-1))])]),e("div",yu,[e("button",{onClick:l[0]||(l[0]=L=>g.value=!g.value),class:"help-toggle"},[e("i",{class:G(["mdi",g.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2),T(" "+p(g.value?"Hide":"Show")+" Detailed Instructions ",1)]),g.value?(n(),a("div",bu,[l[26]||(l[26]=e("h4",null,"Detailed Setup Guide:",-1)),e("div",hu,[l[21]||(l[21]=e("h5",null,"1. Open configuration.yaml",-1)),e("p",null,[l[20]||(l[20]=T("Location: ",-1)),e("code",null,p(o.configPath)+"/configuration.yaml",1)])]),o.warnings.length>0?(n(),a("div",ku,[l[22]||(l[22]=e("h5",null,"2. Migrate Existing Entries (If Any)",-1)),e("p",null,"If you have existing "+p(o.platform)+" entries, cut them from configuration.yaml and paste into:",1),e("p",null,[e("code",null,p(o.configPath)+"/smartir/"+p(o.platform)+".yaml",1)]),l[23]||(l[23]=e("p",{class:"note"},"Broadlink Manager will create this file automatically.",-1))])):R("",!0),e("div",wu,[e("h5",null,p(o.warnings.length>0?"3":"2")+". Add Include Line",1),l[24]||(l[24]=e("p",null,"Add this to configuration.yaml:",-1)),e("pre",null,p(o.platform)+": !include smartir/"+p(o.platform)+".yaml",1)]),e("div",$u,[e("h5",null,p(o.warnings.length>0?"4":"3")+". Restart Home Assistant",1),l[25]||(l[25]=e("p",null,"After saving, you'll need to restart HA for changes to take effect.",-1))])])):R("",!0)])]),e("div",Cu,[e("label",_u,[J(e("input",{type:"checkbox","onUpdate:modelValue":l[1]||(l[1]=L=>r.value=L)},null,512),[[ve,r.value]]),l[29]||(l[29]=e("span",null,"I've added the include line to configuration.yaml",-1))]),o.warnings.length>0?(n(),a("label",Su,[J(e("input",{type:"checkbox","onUpdate:modelValue":l[2]||(l[2]=L=>m.value=L)},null,512),[[ve,m.value]]),e("span",null,"I've migrated existing "+p(o.platform)+" entries (if any)",1)])):R("",!0)])]),e("div",Iu,[e("button",{onClick:l[3]||(l[3]=L=>w.$emit("close")),class:"btn-secondary"}," Cancel "),e("button",{onClick:E,class:"btn-primary",disabled:!I.value},[...l[30]||(l[30]=[e("i",{class:"mdi mdi-check"},null,-1),T(" I've Completed Setup ",-1)])],8,Du)])])])):R("",!0)}},xu=we(Tu,[["__scopeId","data-v-f6fe4c03"]]),Ru={class:"modal-header"},Mu={class:"progress-steps"},Au={class:"step-number"},Ou={key:0,class:"mdi mdi-check"},Lu={key:1},Eu={class:"step-label"},Vu={class:"modal-body"},Pu={key:0,class:"step-content"},Uu={class:"form-group"},ju={class:"form-group"},Fu={class:"form-group"},Nu={key:1,class:"step-content"},Bu={key:1,class:"platform-form"},Hu={class:"form-section"},qu={class:"checkbox-grid"},zu={class:"checkbox-item"},Ju={class:"checkbox-item"},Wu={class:"checkbox-item"},Ku={class:"checkbox-item"},Xu={class:"checkbox-item"},Gu={key:2,class:"platform-form"},Yu={class:"form-section"},Zu={class:"form-group"},Qu={class:"form-section"},ec={class:"checkbox-grid"},tc={class:"checkbox-item"},oc={class:"checkbox-item"},lc={key:3,class:"platform-form"},nc={class:"form-section"},sc={class:"checkbox-grid"},ac={class:"checkbox-item"},ic={class:"checkbox-item"},rc={class:"checkbox-item"},dc={class:"checkbox-item"},uc={key:2,class:"step-content"},cc={key:3,class:"step-content"},mc={class:"modal-footer"},vc=["disabled"],pc={key:2,class:"save-buttons"},fc=["disabled"],gc=["disabled"],yc={__name:"SmartIRProfileBuilder",props:{show:{type:Boolean,default:!1},editMode:{type:Boolean,default:!1},editData:{type:Object,default:null},startStep:{type:Number,default:0}},emits:["close","save"],setup(o,{emit:c}){const d=o,$=c,h=De("toast"),r=y(0),m=y(!1),g=y([]),I=y(!1),_=y([]),E=y("/config"),w=y(!1),l=y(null),L=y(!1),q=y(!1),P=y(""),C=y("ir"),s=y(!1),b=[{label:"Device Info",key:"info"},{label:"Configuration",key:"config"},{label:"Learn Commands",key:"commands"},{label:"Preview & Save",key:"preview"}],f=y({platform:"",manufacturer:"",model:"",broadlinkDevice:"",commandType:"ir",config:{},commands:{}}),O=y(["turn_on"]),z=y(3),Y=y([]),B=y(["turn_on"]);ae(()=>f.value.platform,x=>{x==="media_player"?f.value.config={features:O.value}:x==="fan"?f.value.config={speedLevels:z.value,features:Y.value}:x==="light"&&(f.value.config={features:B.value})}),ae(O,x=>{f.value.platform==="media_player"&&(f.value.config={features:x})},{deep:!0}),ae(z,x=>{f.value.platform==="fan"&&(f.value.config={speedLevels:x,features:Y.value})}),ae(Y,x=>{f.value.platform==="fan"&&(f.value.config={speedLevels:z.value,features:x})},{deep:!0}),ae(B,x=>{f.value.platform==="light"&&(f.value.config={features:x})},{deep:!0});function le(x){const i=new Set,j=Object.keys(x);return j.some(K=>K==="off"||K.includes("_off"))&&i.add("off"),j.some(K=>K.includes("auto"))&&i.add("auto"),j.some(K=>K.includes("cool"))&&i.add("cool"),j.some(K=>K.includes("heat"))&&i.add("heat"),j.some(K=>K.includes("dry"))&&i.add("dry"),j.some(K=>K.includes("fan_only"))&&i.add("fan_only"),Array.from(i)}function M(x){const i=new Set,j=Object.keys(x);return j.some(K=>K.includes("auto"))&&i.add("auto"),j.some(K=>K.includes("low"))&&i.add("low"),j.some(K=>K.includes("medium")||K.includes("mid"))&&i.add("medium"),j.some(K=>K.includes("high"))&&i.add("high"),Array.from(i)}function F(x){const i=new Set,j=Object.keys(x);return j.some(K=>K.includes("swing_off")||K.includes("_off"))&&i.add("off"),j.some(K=>K.includes("vertical"))&&i.add("vertical"),j.some(K=>K.includes("horizontal"))&&i.add("horizontal"),j.some(K=>K.includes("both"))&&i.add("both"),Array.from(i)}function te(x){for(const i of Object.values(x))if(typeof i=="string"&&i.startsWith("sc")||Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0].startsWith("sc"))return"rf";return"ir"}ae(()=>f.value.commandType,(x,i)=>{!i||L.value||s.value||(Object.keys(f.value.commands).length>0&&x!==i?(P.value=x,f.value.commandType=i,L.value=!0):x!==i&&(C.value=x))}),ae(()=>d.editData,async x=>{var i,j,K;if(x&&d.editMode){console.log("ğŸ”§ Edit mode activated, loading profile data:",x),s.value=!0,g.value.length===0&&(console.log("ğŸ“¡ Loading Broadlink devices..."),await X(),console.log("ğŸ“¡ Devices loaded:",g.value.length));const ne=x.profile,se=ne.controller_data;console.log("ğŸ® Controller data from profile:",se),console.log("ğŸ® Available devices:",g.value.map(S=>S.entity_id));const oe=ne.commands||{},Z=ne.commandType||te(oe);console.log("ğŸ” Command type (stored):",ne.commandType),console.log("ğŸ” Command type (final):",Z);let ce={};if(x.platform==="climate"){const S=ne.operationModes||le(oe),k=ne.fanModes||M(oe),N=ne.swingModes||F(oe);console.log("ğŸ” Inferred modes:",S),console.log("ğŸ” Inferred fan modes:",k),console.log("ğŸ” Inferred swing modes:",N),ce={minTemp:ne.minTemperature,maxTemp:ne.maxTemperature,precision:ne.precision,modes:S,fanModes:k,swingModes:N}}else if(x.platform==="media_player"){const S=[];(oe.on||oe.off)&&S.push("turn_on"),(oe.volumeUp||oe.volumeDown)&&S.push("volume"),oe.mute&&S.push("mute"),oe.sources&&S.push("source"),(oe.channelUp||oe.channelDown)&&S.push("channel"),ce={features:S},O.value=S,console.log("ğŸ” Inferred media player features:",S)}else if(x.platform==="fan"){const S=((i=ne.speed)==null?void 0:i.length)||Object.keys(oe.default||{}).length||3,k=[];(oe.oscillate_on||oe.oscillate_off)&&k.push("oscillate"),(oe.direction_forward||oe.direction_reverse)&&k.push("direction"),ce={speedLevels:S,features:k},z.value=S,Y.value=k,console.log("ğŸ” Inferred fan config:",ce)}else if(x.platform==="light"){const S=[];ce={features:S},B.value=S,console.log("ğŸ” Inferred light features:",S)}const Re=await t(ne.manufacturer,(j=ne.supportedModels)==null?void 0:j[0],oe);f.value={platform:x.platform,manufacturer:ne.manufacturer||"",model:((K=ne.supportedModels)==null?void 0:K[0])||"",broadlinkDevice:se||"",commandType:Z,config:ce,commands:Re},console.log("âœ… Profile populated:",f.value),console.log("âœ… Selected device:",f.value.broadlinkDevice),console.log("âœ… Command type:",f.value.commandType),console.log("âœ… Commands (with learned codes):",Re),C.value=Z,setTimeout(()=>{s.value=!1},100)}},{immediate:!0});const ie=W(()=>{var x;switch(r.value){case 0:return f.value.platform&&f.value.manufacturer&&f.value.model;case 1:return f.value.platform==="climate"?f.value.config.minTemp&&f.value.config.maxTemp&&((x=f.value.config.modes)==null?void 0:x.length)>0:!0;case 2:return f.value.broadlinkDevice&&f.value.commandType&&Object.keys(f.value.commands).length>0;case 3:return!0;default:return!1}}),be=y(null);async function _e(){if(r.value!==3){be.value=null;return}if(console.log("ğŸ” Generating JSON with commands:",f.value.commands),Object.values(f.value.commands).some(i=>typeof i=="string"?i==="pending":typeof i=="object"?Object.values(i).some(j=>typeof j=="string"?j==="pending":typeof j=="object"?Object.values(j).some(K=>K==="pending"):!1):!1)){console.warn('âš ï¸ Commands still contain "pending" placeholders!'),console.log("ğŸ“¦ Attempting to fetch from Broadlink storage...");const i=await t(f.value.manufacturer,f.value.model,f.value.commands);f.value.commands=i,console.log("âœ… Updated commands:",i)}be.value=u(f.value),console.log("ğŸ“„ Generated JSON:",be.value)}const Te=W(()=>r.value!==3?null:V(f.value));function Ie(){f.value.config={},f.value.commands={}}function D(){L.value=!1,f.value.commandType=P.value,C.value=P.value,f.value.commands={},P.value=""}function v(){L.value=!1,P.value=""}async function U(){r.value<b.length-1&&(r.value++,r.value===3&&await _e())}function pe(){r.value>0&&r.value--}function Oe(){L.value||(q.value=!0)}function fe(){q.value=!1,ge()}function ge(){$("close"),setTimeout(()=>{r.value=0,f.value={platform:"",manufacturer:"",model:"",broadlinkDevice:"",commandType:"ir",config:{},commands:{}},C.value="ir"},300)}async function xe(){var x,i,j,K,ne,se;m.value=!0;try{if(!w.value){const k=(await ee.get("/api/smartir/config/check")).data;if(k&&!((x=k.platforms[f.value.platform])==null?void 0:x.file_exists)){_.value=k.configuration_warnings||[],E.value=k.config_path||"/config",l.value={platform:f.value.platform,json:be.value},I.value=!0,m.value=!1;return}}let oe;d.editMode&&((i=d.editData)!=null&&i.code)?(oe=parseInt(d.editData.code),console.log("ğŸ“ Edit mode: Using existing code",oe)):(oe=(await ee.get(`/api/smartir/platforms/${f.value.platform}/next-code`)).data.next_code,console.log("âœ¨ New profile: Using next code",oe));const ce=(await ee.post("/api/smartir/profiles",{platform:f.value.platform,json:be.value,code_number:oe})).data,Re={platform:"smartir",name:`${f.value.manufacturer} ${f.value.model}`,unique_id:`${f.value.manufacturer.toLowerCase().replace(/[^a-z0-9]+/g,"_")}_${f.value.model.toLowerCase().replace(/[^a-z0-9]+/g,"_")}`,device_code:oe,controller_data:f.value.broadlinkDevice};try{await ee.post("/api/smartir/config/add-device",{platform:f.value.platform,device_config:{platform:"smartir",name:Re.name,unique_id:Re.unique_id,device_code:Re.device_code,controller_data:Re.controller_data}})}catch(S){console.error("Failed to add device to config:",S);const k=((j=S.response)==null?void 0:j.data)||{};let N=k.error||"Unknown error";k.validation_errors&&k.validation_errors.length>0&&(N=`Device configuration validation failed:
`+k.validation_errors.map(H=>`  â€¢ ${H}`).join(`
`)),(K=h.value)==null||K.warning(`Profile saved but failed to add to config file:
${N}`,"âš ï¸ Partial Success")}$("save",{json:be.value,yaml:Te.value,profile:f.value,saved_to:ce.path}),(ne=h.value)==null||ne.success(`File: ${ce.filename}
Device Code: ${oe}
Added to: smartir/${f.value.platform}.yaml

âš ï¸ Restart Home Assistant to activate`,"âœ… Profile Saved Successfully!"),ge()}catch(oe){console.error("Error saving profile:",oe),(se=h.value)==null||se.error(oe.message,"âŒ Error Saving Profile")}finally{m.value=!1}}async function Le(){w.value=!0,I.value=!1,l.value&&(await xe(),l.value=null)}function A(){var x,i;try{const j=JSON.stringify(be.value,null,2),K=new Blob([j],{type:"application/json"}),ne=URL.createObjectURL(K),se=document.createElement("a");se.href=ne;const oe=f.value.manufacturer.toLowerCase().replace(/\s+/g,"_"),Z=f.value.model.toLowerCase().replace(/\s+/g,"_");se.download=`smartir_${f.value.platform}_${oe}_${Z}.json`,document.body.appendChild(se),se.click(),document.body.removeChild(se),URL.revokeObjectURL(ne),(x=h.value)==null||x.success("You can manually upload this file to your SmartIR codes directory.","âœ… Profile Downloaded")}catch(j){console.error("Error downloading profile:",j),(i=h.value)==null||i.error(j.message,"âŒ Error Downloading Profile")}}async function t(x,i,j){const K=x.toLowerCase().replace(/[^a-z0-9]+/g,"_"),ne=i.toLowerCase().replace(/[^a-z0-9]+/g,"_"),se=`${K}_${ne}`;try{const ce=(await ee.get("/api/commands/all")).data[se]||{};console.log(`ğŸ” Fetching learned commands for device: ${se}`),console.log("ğŸ“¦ Device commands from storage:",ce);const Re={...j};for(const[S,k]of Object.entries(Re))if(k==="pending"&&ce[S])Re[S]=ce[S];else if(typeof k=="object"){for(const[N,H]of Object.entries(k))if(typeof H=="object")for(const[Q,he]of Object.entries(H)){const me=`${S}_${N}_${Q}`;he==="pending"&&ce[me]&&(Re[S][N][Q]=ce[me])}else if(H==="pending"){const Q=`${S}_${N}`;ce[Q]&&(Re[S][N]=ce[Q])}}return console.log("âœ… Merged commands:",Re),Re}catch(oe){return console.error("Error fetching learned commands:",oe),j}}function u(x){const i={manufacturer:x.manufacturer,supportedModels:[x.model],supportedController:"Broadlink",commandsEncoding:"Base64",commandType:x.commandType||"ir",commands:{}};return x.platform==="climate"&&(i.minTemperature=x.config.minTemp,i.maxTemperature=x.config.maxTemp,i.precision=x.config.precision||1,i.operationModes=x.config.modes||[],i.fanModes=x.config.fanModes&&x.config.fanModes.length>0?x.config.fanModes:["auto"],x.config.swingModes&&x.config.swingModes.length>0&&(i.swingModes=x.config.swingModes),i.commands=x.commands),i}function V(x){let i=`# SmartIR ${x.platform} configuration
`;return i+=`# Generated by Broadlink Manager v2

`,x.platform==="climate"&&(i+=`climate:
`,i+=`  - platform: smartir
`,i+=`    name: ${x.manufacturer} ${x.model}
`,i+=`    unique_id: ${x.manufacturer.toLowerCase()}_${x.model.toLowerCase().replace(/\s+/g,"_")}
`,i+=`    device_code: 10000  # Change this to your custom code number
`,i+=`    controller_data: ${x.broadlinkDevice}
`,x.config.tempSensor&&(i+=`    temperature_sensor: ${x.config.tempSensor}
`),x.config.humiditySensor&&(i+=`    humidity_sensor: ${x.config.humiditySensor}
`),x.config.powerSensor&&(i+=`    power_sensor: ${x.config.powerSensor}
`)),i}async function X(){try{console.log("Fetching remote devices from /api/remote/devices...");const x=await ee.get("/api/remote/devices");console.log("Loaded remote devices response:",x.data);const i=x.data.devices||[];console.log("Extracted devices array:",i),console.log("Device count:",i.length),g.value=i,console.log("broadlinkDevices.value set to:",g.value),console.log("Final device count:",g.value.length)}catch(x){console.error("Error loading remote devices:",x),g.value=[]}}return ae(()=>d.show,x=>{if(x){const i=Number.isInteger(d.startStep)?d.startStep:0;r.value=Math.min(Math.max(i,0),b.length-1)}}),ae(()=>d.startStep,x=>{if(d.show){const i=Number.isInteger(x)?x:0;r.value=Math.min(Math.max(i,0),b.length-1)}}),Ae(()=>{d.show&&X()}),(x,i)=>o.show?(n(),a("div",{key:0,class:"modal-overlay",onClick:Oe},[e("div",{class:"modal-container",onClick:i[19]||(i[19]=de(()=>{},["stop"]))},[e("div",Ru,[e("h2",null,[i[22]||(i[22]=e("i",{class:"mdi mdi-file-document-edit"},null,-1)),T(" "+p(o.editMode?"Edit SmartIR Profile":"Create SmartIR Profile"),1)]),e("button",{onClick:ge,class:"close-button"},[...i[23]||(i[23]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Mu,[(n(),a(ue,null,ke(b,(j,K)=>e("div",{key:K,class:G(["step",{active:r.value===K,completed:r.value>K}])},[e("div",Au,[r.value>K?(n(),a("i",Ou)):(n(),a("span",Lu,p(K+1),1))]),e("span",Eu,p(j.label),1)],2)),64))]),e("div",Vu,[r.value===0?(n(),a("div",Pu,[i[29]||(i[29]=e("h3",null,"Device Information",-1)),e("div",Uu,[i[25]||(i[25]=e("label",null,"Platform Type *",-1)),J(e("select",{"onUpdate:modelValue":i[0]||(i[0]=j=>f.value.platform=j),onChange:Ie},[...i[24]||(i[24]=[Fe('<option value="" data-v-2e218e9d>Select platform...</option><option value="climate" data-v-2e218e9d>ğŸŒ¡ï¸ Climate (AC, Heater, Heat Pump)</option><option value="media_player" data-v-2e218e9d>ğŸ“º Media Player (TV, Receiver)</option><option value="fan" data-v-2e218e9d>ğŸŒ€ Fan</option><option value="light" data-v-2e218e9d>ğŸ’¡ Light (LED Strip, IR Light)</option>',5)])],544),[[Se,f.value.platform]])]),e("div",ju,[i[26]||(i[26]=e("label",null,"Manufacturer *",-1)),J(e("input",{"onUpdate:modelValue":i[1]||(i[1]=j=>f.value.manufacturer=j),type:"text",placeholder:"e.g., Daikin, LG, Samsung"},null,512),[[Me,f.value.manufacturer]])]),e("div",Fu,[i[27]||(i[27]=e("label",null,"Model(s) *",-1)),J(e("input",{"onUpdate:modelValue":i[2]||(i[2]=j=>f.value.model=j),type:"text",placeholder:"e.g., FTXS35K, Multiple models"},null,512),[[Me,f.value.model]]),i[28]||(i[28]=e("small",null,'Enter model number or "Multiple" if it works with many models',-1))])])):R("",!0),r.value===1?(n(),a("div",Nu,[f.value.platform==="climate"?(n(),Pe(sd,{key:0,modelValue:f.value.config,"onUpdate:modelValue":i[3]||(i[3]=j=>f.value.config=j)},null,8,["modelValue"])):f.value.platform==="media_player"?(n(),a("div",Bu,[i[36]||(i[36]=e("h3",null,"Media Player Configuration",-1)),i[37]||(i[37]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),T(" Configure the features your media player supports. You'll learn the IR commands in the next step. ")],-1)),e("div",Hu,[i[35]||(i[35]=e("h4",null,"Supported Features",-1)),e("div",qu,[e("label",zu,[J(e("input",{type:"checkbox",value:"turn_on","onUpdate:modelValue":i[4]||(i[4]=j=>O.value=j)},null,512),[[ve,O.value]]),i[30]||(i[30]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),T(" Power On/Off ")],-1))]),e("label",Ju,[J(e("input",{type:"checkbox",value:"volume","onUpdate:modelValue":i[5]||(i[5]=j=>O.value=j)},null,512),[[ve,O.value]]),i[31]||(i[31]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-volume-high"}),T(" Volume Control ")],-1))]),e("label",Wu,[J(e("input",{type:"checkbox",value:"mute","onUpdate:modelValue":i[6]||(i[6]=j=>O.value=j)},null,512),[[ve,O.value]]),i[32]||(i[32]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-volume-mute"}),T(" Mute ")],-1))]),e("label",Ku,[J(e("input",{type:"checkbox",value:"source","onUpdate:modelValue":i[7]||(i[7]=j=>O.value=j)},null,512),[[ve,O.value]]),i[33]||(i[33]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-import"}),T(" Source Selection ")],-1))]),e("label",Xu,[J(e("input",{type:"checkbox",value:"channel","onUpdate:modelValue":i[8]||(i[8]=j=>O.value=j)},null,512),[[ve,O.value]]),i[34]||(i[34]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-numeric"}),T(" Channel Control ")],-1))])])])])):f.value.platform==="fan"?(n(),a("div",Gu,[i[44]||(i[44]=e("h3",null,"Fan Configuration",-1)),i[45]||(i[45]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),T(" Configure the features your fan supports. You'll learn the IR commands in the next step. ")],-1)),e("div",Yu,[i[40]||(i[40]=e("h4",null,"Fan Speed Levels",-1)),e("div",Zu,[i[39]||(i[39]=e("label",null,"Number of Speed Levels *",-1)),J(e("select",{"onUpdate:modelValue":i[9]||(i[9]=j=>z.value=j)},[...i[38]||(i[38]=[e("option",{value:1},"1 Speed",-1),e("option",{value:2},"2 Speeds",-1),e("option",{value:3},"3 Speeds (Low/Med/High)",-1),e("option",{value:4},"4 Speeds",-1),e("option",{value:5},"5 Speeds",-1),e("option",{value:6},"6 Speeds",-1)])],512),[[Se,z.value,void 0,{number:!0}]])])]),e("div",Qu,[i[43]||(i[43]=e("h4",null,"Additional Features",-1)),e("div",ec,[e("label",tc,[J(e("input",{type:"checkbox",value:"oscillate","onUpdate:modelValue":i[10]||(i[10]=j=>Y.value=j)},null,512),[[ve,Y.value]]),i[41]||(i[41]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-sync"}),T(" Oscillation ")],-1))]),e("label",oc,[J(e("input",{type:"checkbox",value:"direction","onUpdate:modelValue":i[11]||(i[11]=j=>Y.value=j)},null,512),[[ve,Y.value]]),i[42]||(i[42]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-rotate-3d-variant"}),T(" Direction (Forward/Reverse) ")],-1))])])])])):f.value.platform==="light"?(n(),a("div",lc,[i[51]||(i[51]=e("h3",null,"Light Configuration",-1)),i[52]||(i[52]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),T(" Configure the features your light supports. You'll learn the IR commands in the next step. ")],-1)),e("div",nc,[i[50]||(i[50]=e("h4",null,"Supported Features",-1)),e("div",sc,[e("label",ac,[J(e("input",{type:"checkbox",value:"turn_on","onUpdate:modelValue":i[12]||(i[12]=j=>B.value=j)},null,512),[[ve,B.value]]),i[46]||(i[46]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),T(" Power On/Off ")],-1))]),e("label",ic,[J(e("input",{type:"checkbox",value:"brightness","onUpdate:modelValue":i[13]||(i[13]=j=>B.value=j)},null,512),[[ve,B.value]]),i[47]||(i[47]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-brightness-6"}),T(" Brightness Control ")],-1))]),e("label",rc,[J(e("input",{type:"checkbox",value:"color_temp","onUpdate:modelValue":i[14]||(i[14]=j=>B.value=j)},null,512),[[ve,B.value]]),i[48]||(i[48]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-thermometer"}),T(" Color Temperature ")],-1))]),e("label",dc,[J(e("input",{type:"checkbox",value:"rgb","onUpdate:modelValue":i[15]||(i[15]=j=>B.value=j)},null,512),[[ve,B.value]]),i[49]||(i[49]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-palette"}),T(" RGB Color ")],-1))])])])])):R("",!0)])):R("",!0),r.value===2?(n(),a("div",uc,[ye(Ud,{modelValue:f.value.commands,"onUpdate:modelValue":i[16]||(i[16]=j=>f.value.commands=j),platform:f.value.platform,config:f.value.config,broadlinkDevice:f.value.broadlinkDevice,"onUpdate:broadlinkDevice":i[17]||(i[17]=j=>f.value.broadlinkDevice=j),manufacturer:f.value.manufacturer,model:f.value.model,commandType:f.value.commandType,"onUpdate:commandType":i[18]||(i[18]=j=>f.value.commandType=j)},null,8,["modelValue","platform","config","broadlinkDevice","manufacturer","model","commandType"])])):R("",!0),r.value===3?(n(),a("div",cc,[ye(du,{profile:f.value,"json-data":be.value,"yaml-config":Te.value},null,8,["profile","json-data","yaml-config"])])):R("",!0)]),e("div",mc,[r.value>0?(n(),a("button",{key:0,onClick:pe,class:"btn-secondary"},[...i[53]||(i[53]=[e("i",{class:"mdi mdi-arrow-left"},null,-1),T(" Back ",-1)])])):R("",!0),i[57]||(i[57]=e("div",{class:"spacer"},null,-1)),e("button",{onClick:ge,class:"btn-text"}," Cancel "),r.value<b.length-1?(n(),a("button",{key:1,onClick:U,class:"btn-primary",disabled:!ie.value},[...i[54]||(i[54]=[T(" Next ",-1),e("i",{class:"mdi mdi-arrow-right"},null,-1)])],8,vc)):(n(),a("div",pc,[e("button",{onClick:xe,class:"btn-primary",disabled:m.value},[i[55]||(i[55]=e("i",{class:"mdi mdi-cloud-upload"},null,-1)),T(" "+p(m.value?"Saving...":"Save to SmartIR"),1)],8,fc),e("button",{onClick:A,class:"btn-secondary",disabled:m.value},[...i[56]||(i[56]=[e("i",{class:"mdi mdi-download"},null,-1),T(" Download JSON ",-1)])],8,gc)]))])]),ye(xu,{show:I.value,platform:f.value.platform,warnings:_.value,"config-path":E.value,onClose:i[20]||(i[20]=j=>I.value=!1),onComplete:Le},null,8,["show","platform","warnings","config-path"]),ye(je,{isOpen:L.value,title:"Change Command Type?",message:"Changing the command type will clear all learned commands. Continue?",confirmText:"Continue",cancelText:"Cancel",dangerMode:!0,onConfirm:D,onCancel:v},null,8,["isOpen"]),ye(je,{isOpen:q.value,title:"Close Profile Builder?",message:"Are you sure you want to close? Your progress will be lost.",confirmText:"Close",cancelText:"Keep Editing",dangerMode:!0,onConfirm:fe,onCancel:i[21]||(i[21]=j=>q.value=!1)},null,8,["isOpen"])])):R("",!0)}},bc=we(yc,[["__scopeId","data-v-2e218e9d"]]),hc={class:"dashboard"},kc={key:1,class:"welcome-banner"},wc={__name:"Dashboard",setup(o){const c=He(),d=De("smartirEnabled"),{isMobile:$}=Ze(),h=y(!1),r=y(!1),m=y(null),g=y(0),I=y(null),_=y(localStorage.getItem("welcome_banner_dismissed")==="true");function E(){_.value=!0,localStorage.setItem("welcome_banner_dismissed","true")}function w(){r.value=!1,m.value=null,g.value=0,h.value=!0}async function l({platform:P,profile:C,startStep:s}){g.value=Number.isInteger(s)?s:0;try{const b=await fetch(`api/smartir/platforms/${P}/profiles/${C.code}`);if(!b.ok)throw new Error("Failed to load profile");const f=await b.json();let O="";try{const z=await fetch(`api/smartir/config/get-device?platform=${P}&code=${C.code}`);z.ok?(O=(await z.json()).controller_data||"",console.log("âœ… Found controller_data from YAML:",O)):console.warn("âš ï¸ No YAML entry found for this profile (this is OK for profiles not yet added to config)")}catch(z){console.warn("âš ï¸ Could not fetch controller_data from config:",z)}r.value=!0,m.value={platform:P,code:C.code,profile:{...f.profile,controller_data:O}},h.value=!0}catch(b){console.error("Error loading profile for edit:",b),c.error("Failed to load profile for editing")}}function L(){h.value=!1,r.value=!1,m.value=null}async function q(P){console.log("Profile saved:",P),L(),I.value&&I.value.loadAllProfiles&&(await I.value.loadAllProfiles(),console.log("âœ… Profiles list refreshed"))}return(P,C)=>(n(),a("div",hc,[$e(d)?(n(),Pe(ca,{key:0})):R("",!0),!$e($)&&!_.value?(n(),a("div",kc,[e("button",{class:"dismiss-button",onClick:E,title:"Dismiss"},[...C[0]||(C[0]=[e("i",{class:"mdi mdi-close"},null,-1)])]),C[1]||(C[1]=Fe('<div class="banner-content" data-v-12185d74><div class="banner-icon" data-v-12185d74><i class="mdi mdi-rocket-launch" data-v-12185d74></i></div><div class="banner-text" data-v-12185d74><h2 data-v-12185d74>Welcome to Broadlink Manager v2!</h2><p data-v-12185d74>Manage your IR/RF devices with a modern Vue 3 interface</p></div></div><div class="status-badges" data-v-12185d74><span class="badge success" data-v-12185d74><i class="mdi mdi-check-circle" data-v-12185d74></i> Vue 3 Ready </span><span class="badge warning" data-v-12185d74><i class="mdi mdi-beta" data-v-12185d74></i> Beta </span></div>',2))])):R("",!0),ye(sa),$e(d)?(n(),Pe(dr,{key:2,ref_key:"smartirStatusCard",ref:I,onCreateProfile:w,onEditProfile:l},null,512)):R("",!0),ye(bc,{show:h.value,editMode:r.value,editData:m.value,startStep:g.value,onClose:L,onSave:q},null,8,["show","editMode","editData","startStep"])]))}},$c=we(wc,[["__scopeId","data-v-12185d74"]]),Cc={class:"toast-container"},_c={class:"toast-content"},Sc={key:0,class:"toast-title"},Ic={class:"toast-message"},Dc={key:1,class:"toast-description"},Tc=["onClick","title"],xc={__name:"Toast",setup(o,{expose:c}){const d=y([]);let $=0;function h(g){const I={success:"mdi-check-circle",error:"mdi-alert-circle",warning:"mdi-alert",info:"mdi-information"};return I[g]||I.info}function r({message:g,title:I,description:_,type:E="info",duration:w=5e3}){const l=$++,L={id:l,message:g,title:I,description:_,type:E};return d.value.push(L),w>0&&setTimeout(()=>{m(l)},w),l}function m(g){const I=d.value.findIndex(_=>_.id===g);I>-1&&d.value.splice(I,1)}return c({addToast:r,removeToast:m,show:r,success:(g,I)=>r({message:g,title:I,type:"success"}),error:(g,I)=>r({message:g,title:I,type:"error",duration:0}),warning:(g,I)=>r({message:g,title:I,type:"warning",duration:0}),info:(g,I)=>r({message:g,title:I,type:"info"})}),(g,I)=>(n(),Pe(lt,{to:"body"},[e("div",Cc,[ye(mt,{name:"toast"},{default:Ye(()=>[(n(!0),a(ue,null,ke(d.value,_=>(n(),a("div",{key:_.id,class:G(["toast",[`toast-${_.type}`,{"toast-persistent":_.type==="error"||_.type==="warning"}]])},[e("i",{class:G(["mdi",h(_.type)])},null,2),e("div",_c,[_.title?(n(),a("div",Sc,p(_.title),1)):R("",!0),e("div",Ic,p(_.message),1),_.description?(n(),a("div",Dc,p(_.description),1)):R("",!0)]),e("button",{onClick:E=>m(_.id),class:G(["toast-close",{"toast-close-prominent":_.type==="error"||_.type==="warning"}]),title:_.type==="error"||_.type==="warning"?"Click to dismiss":"Close"},[...I[0]||(I[0]=[e("i",{class:"mdi mdi-close"},null,-1)])],10,Tc)],2))),128))]),_:1})])]))}},Rc=we(xc,[["__scopeId","data-v-3948c088"]]),Mc="0.3.0-alpha.2",Ac={version:Mc},Oc={id:"app",class:"app-container"},Lc={class:"app-header"},Ec={class:"header-content"},Vc={class:"header-right"},Pc=["title"],Uc={class:"settings-menu-container"},jc={key:0,class:"settings-menu"},Fc=["title"],Nc={class:"toggle-content"},Bc={key:0,class:"not-installed-label"},Hc={key:0,href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"menu-item menu-link menu-subitem"},qc=["disabled"],zc=["disabled"],Jc=["disabled"],Wc={class:"app-main"},Kc={class:"app-footer"},Xc={__name:"App",setup(o){const c=y(null),d=Ac.version,$=y("light"),h=y(null),r=y(!1),m=y(!1),g=y(!1),I=y(localStorage.getItem("smartir_enabled")!=="false"),_=W(()=>{var f;return((f=h.value)==null?void 0:f.installed)||!1}),E=W(()=>({light:"mdi mdi-weather-sunny",medium:"mdi mdi-weather-partly-cloudy",dark:"mdi mdi-weather-night"})[$.value]),w=W(()=>({light:"Switch to Medium Theme",medium:"Switch to Dark Theme",dark:"Switch to Light Theme"})[$.value]),l=()=>{const f=["light","medium","dark"],z=(f.indexOf($.value)+1)%f.length;$.value=f[z],document.body.classList.remove("medium-mode","dark-mode"),$.value==="medium"?document.body.classList.add("medium-mode"):$.value==="dark"&&document.body.classList.add("dark-mode"),localStorage.setItem("theme",$.value)},L=async()=>{try{const f=await at.getStatus();h.value=f,f.installed?console.log("âœ… SmartIR detected:",f.version):console.log("â„¹ï¸ SmartIR not detected")}catch(f){console.error("Error checking SmartIR:",f),h.value={installed:!1,error:f.message}}},q=async()=>{var f,O,z;m.value=!0;try{const B=(await ee.get("/api/diagnostics/markdown")).data.markdown;if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(B),(f=c.value)==null||f.success("Diagnostic summary copied to clipboard!");else{const le=document.createElement("textarea");le.value=B,le.style.position="fixed",le.style.left="-999999px",le.style.top="-999999px",document.body.appendChild(le),le.focus(),le.select();try{if(document.execCommand("copy"))(O=c.value)==null||O.success("Diagnostic summary copied to clipboard!");else throw new Error("execCommand failed")}finally{document.body.removeChild(le)}}r.value=!1}catch(Y){console.error("Error copying diagnostics:",Y),(z=c.value)==null||z.error("Failed to copy diagnostics: "+Y.message)}finally{m.value=!1}},P=async()=>{var f,O;m.value=!0;try{const z=await ee.get("/api/diagnostics/download",{responseType:"blob"}),Y=window.URL.createObjectURL(new Blob([z.data])),B=document.createElement("a");B.href=Y;const le=z.headers["content-disposition"];let M="broadlink_manager_diagnostics.zip";if(le){const F=le.match(/filename="?(.+)"?/);F&&(M=F[1])}B.setAttribute("download",M),document.body.appendChild(B),B.click(),B.remove(),window.URL.revokeObjectURL(Y),(f=c.value)==null||f.success("Diagnostic bundle downloaded!"),r.value=!1}catch(z){console.error("Error downloading diagnostics:",z),(O=c.value)==null||O.error("Failed to download diagnostics")}finally{m.value=!1}},C=()=>{_.value&&(I.value=!I.value,localStorage.setItem("smartir_enabled",I.value.toString()),window.location.reload())},s=async()=>{var f,O,z;g.value=!0;try{const Y=await ee.post("/api/smartir/refresh-index");Y.data.success?(f=c.value)==null||f.success(`Updated to v${Y.data.version} (${Y.data.total_devices} devices)`,"âœ… Index Updated"):(O=c.value)==null||O.error(Y.data.error||"Unknown error","âŒ Update Failed")}catch(Y){console.error("Error updating SmartIR index:",Y),(z=c.value)==null||z.error("Failed to update device index","âŒ Update Error")}finally{g.value=!1,r.value=!1}},b=f=>{f.target.closest(".settings-menu-container")||(r.value=!1)};return Ae(async()=>{const f=localStorage.getItem("theme");f&&["light","medium","dark"].includes(f)?($.value=f,f==="medium"?document.body.classList.add("medium-mode"):f==="dark"&&document.body.classList.add("dark-mode")):localStorage.getItem("darkMode")==="true"&&($.value="dark",document.body.classList.add("dark-mode"),localStorage.setItem("theme","dark")),await L();const O=et();O&&c.value&&(O.appContext.config.globalProperties.$toast=c.value),document.addEventListener("click",b)}),Ge(()=>{document.removeEventListener("click",b)}),ze("smartirStatus",h),ze("smartirEnabled",I),ze("refreshSmartIR",L),ze("toast",c),(f,O)=>(n(),a("div",Oc,[e("header",Lc,[e("div",Ec,[O[13]||(O[13]=e("div",{class:"header-left"},[e("i",{class:"mdi mdi-remote"}),e("h1",null,"Broadlink Manager v2"),e("span",{class:"beta-badge"},"BETA")],-1)),e("div",Vc,[e("button",{onClick:l,class:"icon-button",title:w.value},[e("i",{class:G(E.value)},null,2)],8,Pc),e("div",Uc,[e("button",{onClick:O[0]||(O[0]=z=>r.value=!r.value),class:"icon-button",title:"Settings"},[...O[2]||(O[2]=[e("i",{class:"mdi mdi-cog"},null,-1)])]),r.value?(n(),a("div",jc,[O[9]||(O[9]=e("div",{class:"menu-section-title"},"Integration Settings",-1)),e("div",{class:G(["menu-item toggle-item",{disabled:!_.value}]),onClick:O[1]||(O[1]=z=>_.value?C():null),title:_.value?"":"SmartIR is not installed"},[e("div",Nc,[O[3]||(O[3]=e("i",{class:"mdi mdi-air-conditioner"},null,-1)),O[4]||(O[4]=e("span",null,"SmartIR Integration",-1)),_.value?R("",!0):(n(),a("span",Bc,"(Not Installed)"))]),e("div",{class:G(["toggle-switch",{active:I.value&&_.value,disabled:!_.value}])},[...O[5]||(O[5]=[e("div",{class:"toggle-slider"},null,-1)])],2)],10,Fc),I.value?(n(),a("a",Hc,[...O[6]||(O[6]=[e("i",{class:"mdi mdi-github"},null,-1),e("span",null,"SmartIR on GitHub",-1)])])):R("",!0),I.value?(n(),a("button",{key:1,onClick:s,class:"menu-item menu-subitem",disabled:g.value},[e("i",{class:G(["mdi",g.value?"mdi-loading mdi-spin":"mdi-refresh"])},null,2),e("span",null,p(g.value?"Updating...":"Update Device Index"),1)],8,qc)):R("",!0),O[10]||(O[10]=e("div",{class:"menu-divider"},null,-1)),O[11]||(O[11]=e("div",{class:"menu-section-title"},"Diagnostics",-1)),e("button",{onClick:q,class:"menu-item",disabled:m.value},[...O[7]||(O[7]=[e("i",{class:"mdi mdi-content-copy"},null,-1),e("span",null,"Copy Diagnostics",-1)])],8,zc),e("button",{onClick:P,class:"menu-item",disabled:m.value},[...O[8]||(O[8]=[e("i",{class:"mdi mdi-download"},null,-1),e("span",null,"Download Diagnostics",-1)])],8,Jc),O[12]||(O[12]=Fe('<div class="menu-divider" data-v-4bc2c39f></div><div class="menu-section-title" data-v-4bc2c39f>Help &amp; Support</div><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2#readme" target="_blank" class="menu-item menu-link" data-v-4bc2c39f><i class="mdi mdi-book-open-variant" data-v-4bc2c39f></i><span data-v-4bc2c39f>Documentation</span></a><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2/issues" target="_blank" class="menu-item menu-link" data-v-4bc2c39f><i class="mdi mdi-bug" data-v-4bc2c39f></i><span data-v-4bc2c39f>Report Issue</span></a><div class="menu-divider" data-v-4bc2c39f></div><div class="menu-section-title" data-v-4bc2c39f>Community</div><a href="https://community.home-assistant.io/t/broadlink-manager-modern-web-interface-for-broadlink-devices/938473" target="_blank" class="menu-item menu-link" data-v-4bc2c39f><i class="mdi mdi-forum" data-v-4bc2c39f></i><span data-v-4bc2c39f>HA Forum Discussion</span></a><a href="https://www.reddit.com/r/homeassistant/comments/1o1q3kf/release_broadlink_manager_addon_a_modern_web_ui/" target="_blank" class="menu-item menu-link" data-v-4bc2c39f><i class="mdi mdi-reddit" data-v-4bc2c39f></i><span data-v-4bc2c39f>Reddit Discussion</span></a><div class="menu-divider" data-v-4bc2c39f></div><div class="menu-section-title" data-v-4bc2c39f>Project</div><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2" target="_blank" class="menu-item menu-link" data-v-4bc2c39f><i class="mdi mdi-github" data-v-4bc2c39f></i><span data-v-4bc2c39f>GitHub Repository</span></a><a href="https://ko-fi.com/tonyperkins" target="_blank" class="menu-item menu-link menu-item-sponsor" data-v-4bc2c39f><i class="mdi mdi-coffee" data-v-4bc2c39f></i><span data-v-4bc2c39f>Support on Ko-fi</span></a>',12))])):R("",!0)])])])]),e("main",Wc,[ye($c)]),e("footer",Kc,[e("p",null,"Broadlink Manager v"+p($e(d))+" | Built with Vue "+p(vt),1)]),ye(Rc,{ref_key:"toastRef",ref:c},null,512)]))}},Gc=we(Xc,[["__scopeId","data-v-4bc2c39f"]]),it=pt(Gc),Yc=ft();it.use(Yc);it.mount("#app");
