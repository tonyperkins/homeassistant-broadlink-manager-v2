import{g as nt,r as b,o as xe,a as We,b as vt,d as pt,c as W,e as i,f as s,h as e,i as x,n as X,u as _e,t as f,j as T,F as me,k as he,w as se,l as J,v as Le,m as ce,p as ge,q as Ke,s as tt,T as st,x as Ie,y as Me,z as He,A as ve,B as at,C as ze,D as je,E as it,G as Ye,H as ft,I as gt,J as yt,K as Xe,L as bt,M as ht}from"./vendor-DGiFqQ_g.js";(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const w of document.querySelectorAll('link[rel="modulepreload"]'))$(w);new MutationObserver(w=>{for(const r of w)if(r.type==="childList")for(const m of r.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&$(m)}).observe(document,{childList:!0,subtree:!0});function d(w){const r={};return w.integrity&&(r.integrity=w.integrity),w.referrerPolicy&&(r.referrerPolicy=w.referrerPolicy),w.crossOrigin==="use-credentials"?r.credentials="include":w.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function $(w){if(w.ep)return;w.ep=!0;const r=d(w);fetch(w.href,r)}})();let lt=!1;function Ge(){const t=nt(),c=t==null?void 0:t.appContext.config.globalProperties.$toast;return c||(lt||(console.warn("Toast notification system not yet initialized - using console fallback"),lt=!0),{success:d=>console.log("âœ“",d),error:d=>console.error("âœ—",d),warning:d=>console.warn("âš ",d),info:d=>console.info("â„¹",d)})}function ot(){const t=b(!1),c=b(!1),d=b(!1),$=b(0),w=767,r=768,m=1023,y=1024,I=()=>{const _=window.innerWidth;$.value=_,t.value=_<=w,c.value=_>=r&&_<=m,d.value=_>=y};return xe(()=>{I(),window.addEventListener("resize",I)}),We(()=>{window.removeEventListener("resize",I)}),{isMobile:t,isTablet:c,isDesktop:d,screenWidth:$,isMobileOrTablet:()=>t.value||c.value,isTabletOrDesktop:()=>c.value||d.value}}const Qe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAHBUlEQVR4nOxZC1BTVxo+9+aNZI2LNsgjWR4hgoIiRVDBslKnIKPbx1jqTrtYoakat1a6dNsdd7t1X8XHyAbEhdUu1u2mXdbasqJbtsaMIqBBECiPBmqEICEBEx4xJLlJ7s6lw6rJDeQ2FzLM+M1kBs7/3+/83zn/Oee/51JRFAXzGbCvA/AWjwX4GvNeANWXnXffHQ4+K6/dYbHeD+IFhjRkb1wn9WPQbEQ4IF/tQlXX2p5+/8OyczY74j/VxuMG3Sh/Oz9jaQDb4CmPT1LIbLXBfzrz0cmHg8fQpx1Yc1Ra+TsiXD4R0PqtRmAyj/LxbJeaujKIcPlEAINOM7vLXBaTZibCRWgRq3WGJZWX63aoNDpB8BJOX/bGlIqwpUv6iXBgWBHG7eUF8urUWvU6Z9sLGxI/IsLl8SJu6u4XigqPXkVspiVTbTQqU1/6Vn7ammh+G5FOMZyqludIKqUVU/9jcaSuTCo/unfHbiad4iBdwMu/P1bV1tO1xbk9NDC0/vwHB1xGcjqYLAh16zsHW3R6XXTu1mfFdAqMrIoSKNbGhLcQ4QGeppDJ7ACtPcqNEI6tT9O3Vqm+tygqNMDjrU9Sef6tIYM2JjUuuXzfC5knCEXsBI8WMZUCAxiCrfhWyMZkMNzYXNHVpwmXXqp5j0Hz0/1m57a3PQ8VHx4JoNMASIl9shLPFsB5ooO7iDXhCY/dAcCvT/79LwC1s/K2bDnAXcQeJRqwMzzeRt/bua0gLChcDsCDNQNBkEU/qot7o6j0kzETQpuJ40ZnT6xSrUoNWhyseHVz2ikv4n4QA5FSArE5IFlTZ0r3XU1MWODib6NCl3a9dkhSYxgbjo4XLq8sL9j7Ip36YEwMRjMNQazMhf7+RgYNnuyo7bY6ArFaWKuXRX495wLwoLk39sO9RaVnM5OTP8zLSjtjsljpp6ovi6pqr706eE8XBwGUSqEy9Guihf/92TMZhetjI5rJCHwKpBRzZqsNYtKp6KD+Pvv1w5ILdzR3UvD8HA4YefOl7N25JKUPIKuUwIJH7A5of/GJf7oLfrIz2EH786fSss+uKFzOk+8L0mqh6rpbmR0q5YyFGAQBSuHHlcUWxEaZyXfMhFD0Rgt9Oh/SBMiam58HAO+oc4XZMsK/1taT6M6uHjJw8w6VSNfvemM8TbzPlFlwsP5KyzfJeL6kCejXDgo894aASqOZ9O/uHwzq6B3ijhitkzOC7XS7j0g+V3S0vQTDDhYEoZSBobvJ+yXFNZ29gy4lOGmvlDBMIfQqSKV8539EWvXHhvbGHBSFrAwGW+vvxzLoR7RxzrNpsyPs0xcv7/lg1/ZfPtKvuw7MVhulUakWdvRq+XY3tWFT90Bk+52BCOzvyOBgjytSFKAgms+b9F/2o+BbKwUrvgjhhjSjKLAPG4YE7lJxfEIf5dyGOwMXrren/eF0RYXRNMrHDt4QbmjDEbHop9F8rqpddZd3sV6R/aWiabtWr41PW534V8m+PFHW+qSPL9TX7oM8WAaBi4IbE4S8yYNs/7asIgBA0ZStRqFM/MXxIzcgHBEBP+C6DJKLgJvK3uXvniitBsDmNzkSEAD9uv5k0aFjXy1gMQ0DQ5p4CAIwNuXLwyL/ExcpqMWeS42NUmxKXFf8VWPdz6cLnkqhGd/Pe+U1Cow/+ekJUYr4qJgvbik7f/Jw+0J/tjpvS3qxs7/LQZZfcrrkUmOdGI/cgUKIkB8pz0xK+CQjKf6z4MWckYftZqsderfsTInsZt0evDRgMRYMHhaLnk+NW1Y/nchxk5lZ+I/Pf/vl9RvbLYiVlSBcJv/VK9sKBCHc3hkF7D12/NzVltZn8YhzNj/3ev6LGeXTdQ6+uzLZ+C+5XNza05Nsd1gXcNgBvekJK/+du3lTUSiXMzzT80TgkkK8wJAGgCMAE5ooFFz3hHTr+lgZ9iMryOngkoi5WZuOc9hPtDu3r4198nTqygjCr3wYmrvVkSerZXljJoT0m0DcYm5g2Mg5WV39zrVWZZofkzaRnhB/bufm9FI/JpXQXj8F8bHyitqWxhzJmwUJT60SNJER+P+BCZjt34lzNbvickRoWVWNmGzuObnYWhER3oAdX41dPbj1jDeYEwGrInltKKCNtatub6hRfJOEnfJkcc+JgE9ltS/DkINuNI3xCo4fbXgm/0CnouvOcjK4Z/16/ZKia+3+kqIrEIQ+sgNx2Jzb5wsPxrD9GBZv+Gd9BqSXr4icg8cwMj4SLmv6+mlv+WddgGlilOPOZkEmFnrLP+sCVgtXyPHaHShkiw0XXPWWf9YF5Gb9uGzp4sCbj7ai4LkNTx2O5nPV3vLPyTeye6P32X+7KNujVKtSYJg+viEu/mx2etJZCgnD57OPfGRh3n8nfizA15j3Av4XAAD//5k1S2w3zfwVAAAAAElFTkSuQmCC",te=vt.create({baseURL:"./",timeout:3e4,headers:{"Content-Type":"application/json","Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"}});te.interceptors.request.use(t=>t,t=>Promise.reject(t));te.interceptors.response.use(t=>t,t=>(console.error("API Error:",t),t.response?console.error("Response error:",t.response.data):t.request?console.error("No response received"):console.error("Request setup error:",t.message),Promise.reject(t)));const kt=pt("devices",{state:()=>({devices:[],loading:!1,error:null,selectedDevice:null}),getters:{deviceById:t=>c=>t.devices.find(d=>d.id===c),devicesByType:t=>c=>t.devices.filter(d=>d.entity_type===c),deviceCount:t=>t.devices.length,hasDevices:t=>t.devices.length>0},actions:{async loadDevices(t=!1){this.loading=!0,this.error=null;try{const c=t?`/api/devices/managed?_t=${Date.now()}`:"/api/devices/managed",d=await te.get(c);this.devices=d.data.devices||[],console.log("ğŸ“¥ Loaded devices:",this.devices),this.devices.forEach($=>{console.log(`ğŸ“¥ Device "${$.name}":`,{id:$.id,device:$.device,commands:$.commands,commandCount:$.commands?Object.keys($.commands).length:0})})}catch(c){this.error=c.message,console.error("Error loading devices:",c)}finally{this.loading=!1}},async createDevice(t){this.loading=!0,this.error=null;try{console.log("ğŸª Store: Creating device with data:",t),console.log("ğŸª Store: Device commands being sent:",t.commands);const c={device_name:t.name,device:t.device,area_id:t.area||"",area_name:t.area||"",entity_type:t.entity_type,icon:t.icon,broadlink_entity:t.broadlink_entity,device_type:t.device_type||"broadlink",commands:t.commands||{}};t.device_type==="smartir"&&t.smartir_config&&(c.smartir_config=t.smartir_config),console.log("ğŸª Store: Transformed data for backend:",c);const d=await te.post("/api/devices/managed",c);return console.log("ğŸª Store: Create response:",d.data),await this.loadDevices(),d.data}catch(c){throw console.error("Error creating device:",c),c}finally{this.loading=!1}},async updateDevice(t,c){this.loading=!0,this.error=null;try{const d=await te.put(`/api/devices/managed/${t}`,c);return await this.loadDevices(),d.data}catch(d){throw console.error("Error updating device:",d),d}finally{this.loading=!1}},async deleteDevice(t,c=!1){this.loading=!0,this.error=null;try{await te.delete(`/api/devices/managed/${t}`,{data:{delete_commands:c}}),this.devices=this.devices.filter(d=>d.id!==t)}catch(d){throw this.error=d.message,console.error("Error deleting device:",d),d}finally{this.loading=!1}},selectDevice(t){this.selectedDevice=t},clearSelection(){this.selectedDevice=null},clearError(){this.error=null},updateDeviceCommands(t,c){const d=this.devices.findIndex($=>$.id===t);if(d!==-1){const $={...this.devices[d],commands:c};this.devices.splice(d,1,$),console.log(`âœ… Store: Updated commands for ${t}, count: ${Object.keys(c).length}`)}else console.warn(`âš ï¸ Store: Device ${t} not found for command update`)},async syncAllAreas(){if(!this.devices||this.devices.length===0){console.log("âš ï¸ No devices to sync");return}console.log(`ğŸ”„ Syncing areas from Home Assistant for ${this.devices.length} devices...`);try{const t=await Promise.all(this.devices.map($=>(console.log(`ğŸ”„ Syncing device: ${$.id} (${$.name})`),te.post(`/api/devices/${$.id}/sync-area`).then(w=>w.data.success&&w.data.area?(console.log(`âœ… Synced area for ${$.name}: ${w.data.area}`),{status:"synced",device:$.name}):{status:"no_area"}).catch(w=>{var r;return((r=w.response)==null?void 0:r.status)===404?(console.log(`âŒ Device not found in HA: ${$.id}`),{status:"not_found"}):(console.warn(`âš ï¸ Failed to sync area for ${$.id}:`,w.message),{status:"error",error:w.message})})))),c=t.filter($=>$.status==="synced").length,d=t.filter($=>$.status==="not_found").length;await this.loadDevices(!0),c>0?console.log(`âœ… Area sync complete: ${c} synced, ${d} not found in HA`):d>0&&console.log(`â„¹ï¸ No areas synced - ${d} entities not found in HA registry (generate entities first)`)}catch(t){console.debug("Area sync error:",t)}}}});function rt(t){const c=W(()=>t.value||t),d=W(()=>{switch(c.value){case"climate":return"mdi:air-conditioner";case"fan":return"mdi:fan";case"light":return"mdi:lightbulb";case"media_player":return"mdi:television";case"switch":return"mdi:light-switch";default:return"mdi:devices"}}),$=W(()=>`device-type-${c.value}-color`),w=W(()=>`tag-${c.value}-bg`);return{icon:d,colorClass:$,tagBgClass:w}}const dt=""+new URL("broadlink-logo-BDjImjRY.png",import.meta.url).href,$e=(t,c)=>{const d=t.__vccOpts||t;for(const[$,w]of c)d[$]=w;return d},wt={class:"device-header"},$t={class:"device-info"},Ct=["title"],_t={class:"device-labels"},St={class:"device-type"},It=["src","alt","title"],Dt={class:"device-body"},Tt={class:"device-stats"},xt={class:"stat",title:"Learned command count"},Rt={class:"stat",title:"HA Assigned Area"},Mt={class:"device-meta"},Et={class:"device-id",title:"Device ID"},At={key:0,class:"storage-name"},Lt={key:1,class:"broadlink-entity",title:"Controller Device"},Ot={key:2,class:"controller-device"},Pt={class:"device-actions"},Vt=["disabled"],Ut=["disabled"],Ft=["disabled"],jt={key:0,class:"disabled-overlay"},Nt={__name:"DeviceCard",props:{device:{type:Object,required:!0},broadlinkDevices:{type:Array,default:()=>[]}},emits:["edit","delete","learn"],setup(t){const c=t,d=W(()=>localStorage.getItem("smartir_simulate_not_installed")==="true"),$=W(()=>c.device.device_type==="smartir"&&d.value),w=b(null),r=rt(W(()=>c.device.entity_type)),m=W(()=>c.device.icon?c.device.icon:r.icon.value),y=l=>l&&l.startsWith("mdi:")?`mdi ${l.replace(":"," mdi-")}`:`mdi mdi-${l}`,I=W(()=>({light:"Light",fan:"Fan",switch:"Switch",media_player:"Media Player",cover:"Cover"})[c.device.entity_type]||c.device.entity_type),_=W(()=>(c.device.device_type||"broadlink")==="smartir"?"SmartIR":"Broadlink"),E=W(()=>(c.device.device_type||"broadlink")==="smartir"?Qe:dt),k=W(()=>(c.device.device_type||"broadlink")==="smartir"?w.value!==null?w.value:0:Object.keys(c.device.commands||{}).length),o=l=>{if(!l)return"";const p=c.broadlinkDevices.find(g=>g.entity_id===l);return p&&p.name||l},O=W(()=>{if(!c.device.device)return!1;const l=c.device.id.includes(".")?c.device.id.split(".")[1]:c.device.id;return c.device.device!==l}),F=W(()=>{if(!c.device.broadlink_entity)return"";const l=c.broadlinkDevices.find(p=>p.entity_id===c.device.broadlink_entity);return l&&l.name||c.device.broadlink_entity}),N=l=>{if(!l||typeof l!="object")return 0;let p=0;for(const g of Object.values(l))typeof g=="string"?p++:typeof g=="object"&&(p+=N(g));return p},L=async()=>{if(!(!c.device.device_code||!c.device.entity_type))try{const l=await te.get("/api/smartir/codes/code",{params:{entity_type:c.device.entity_type,code_id:c.device.device_code}});if(l.data.success&&l.data.code){const p=l.data.code;p.commands&&(w.value=N(p.commands))}}catch(l){console.error("Error fetching SmartIR command count:",l)}};return xe(async()=>{(c.device.device_type||"broadlink")==="smartir"&&await L()}),(l,p)=>(s(),i("div",{class:X(["device-card",{disabled:$.value}])},[e("div",wt,[e("div",{class:X(["device-icon",_e(r).colorClass.value])},[e("i",{class:X(y(m.value))},null,2)],2),e("div",$t,[e("h3",{title:t.device.name},f(t.device.name),9,Ct),e("div",_t,[e("span",St,f(I.value),1)])]),e("img",{src:E.value,alt:_.value,title:_.value,class:"device-source-logo"},null,8,It)]),e("div",Dt,[e("div",Tt,[e("div",xt,[p[3]||(p[3]=e("i",{class:"mdi mdi-remote"},null,-1)),e("span",null,f(k.value)+" command"+f(k.value!==1?"s":""),1)]),e("div",Rt,[p[4]||(p[4]=e("i",{class:"mdi mdi-map-marker"},null,-1)),e("span",null,f(t.device.area||"No area"),1)])]),e("div",Mt,[e("span",Et,[p[5]||(p[5]=e("i",{class:"mdi mdi-identifier"},null,-1)),T(" "+f(t.device.id),1)]),O.value?(s(),i("span",At,[p[6]||(p[6]=e("i",{class:"mdi mdi-code-tags"},null,-1)),T(" "+f(t.device.device),1)])):x("",!0),t.device.broadlink_entity?(s(),i("span",Lt,[p[7]||(p[7]=e("i",{class:"mdi mdi-access-point"},null,-1)),T(" "+f(F.value),1)])):x("",!0),t.device.controller_device?(s(),i("span",Ot,[p[8]||(p[8]=e("i",{class:"mdi mdi-access-point"},null,-1)),T(" "+f(o(t.device.controller_device)),1)])):x("",!0)])]),e("div",Pt,[e("button",{onClick:p[0]||(p[0]=g=>!$.value&&l.$emit("learn",t.device)),class:"icon-btn",title:"Manage Commands",disabled:$.value},[...p[9]||(p[9]=[e("i",{class:"mdi mdi-remote-tv"},null,-1)])],8,Vt),e("button",{onClick:p[1]||(p[1]=g=>!$.value&&l.$emit("edit",t.device)),class:"icon-btn",title:"Edit",disabled:$.value},[...p[10]||(p[10]=[e("i",{class:"mdi mdi-pencil"},null,-1)])],8,Ut),e("button",{onClick:p[2]||(p[2]=g=>!$.value&&l.$emit("delete",t.device)),class:"icon-btn danger",title:"Delete",disabled:$.value},[...p[11]||(p[11]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,Ft)]),$.value?(s(),i("div",jt,[...p[12]||(p[12]=[e("div",{class:"disabled-message"},[e("i",{class:"mdi mdi-eye-off"}),e("span",null,"SmartIR Not Installed")],-1)])])):x("",!0)],2))}},Bt=$e(Nt,[["__scopeId","data-v-7a7f5c18"]]),Ht={name:"DeviceListView",props:{devices:{type:Array,required:!0}},methods:{getDeviceSourceLogo(t){return(t.device_type||"broadlink")==="smartir"?Qe:dt},getDeviceCommands(t){return t.commands&&typeof t.commands=="object"?Object.keys(t.commands):[]},getCommandType(t,c){return t.commands&&t.commands[c]&&t.commands[c].type||"ir"},getCommandTypeClass(t,c){return this.getCommandType(t,c)==="rf"?"command-rf":"command-ir"},getCommandTypeLabel(t,c){return this.getCommandType(t,c)==="rf"?"RF Command":"IR Command"},sendCommand(t,c){this.$emit("send-command",{device:t,command:c})},openCommands(t){this.$emit("open-commands",t)},editDevice(t){this.$emit("edit-device",t)},deleteDevice(t){this.$emit("delete-device",t)}}},qt={class:"device-list-view"},zt={class:"device-table"},Jt={class:"device-info"},Wt={class:"device-name"},Gt={class:"device-entity"},Kt={class:"device-area"},Xt={class:"device-type"},Yt=["src","alt","title"],Zt={class:"device-commands"},Qt={key:0,class:"command-list"},eo=["onClick","title"],to={key:0,class:"no-commands"},oo={key:1,class:"smartir-info"},lo={class:"profile-code"},no={class:"device-actions"},so=["onClick"],ao=["onClick"],io=["onClick"];function ro(t,c,d,$,w,r){return s(),i("div",qt,[e("table",zt,[c[3]||(c[3]=e("thead",null,[e("tr",null,[e("th",null,"Device"),e("th",null,"Room/Area"),e("th",null,"Type"),e("th",null,[e("div",{class:"commands-header"},[e("span",null,"Commands"),e("div",{class:"command-legend"},[e("span",{class:"legend-badge command-rf"},"RF"),e("span",{class:"legend-badge command-ir"},"IR")])])]),e("th",null,"Actions")])],-1)),e("tbody",null,[(s(!0),i(me,null,he(d.devices,m=>(s(),i("tr",{key:m.entity_id,class:"device-row"},[e("td",Jt,[e("div",Wt,f(m.friendly_name||m.name),1),e("div",Gt,f(m.entity_id),1)]),e("td",Kt,f(m.area||"No Area"),1),e("td",Xt,[e("img",{src:r.getDeviceSourceLogo(m),alt:m.device_type==="smartir"?"SmartIR":"Broadlink",title:m.device_type==="smartir"?"SmartIR":"Broadlink",class:"device-source-logo"},null,8,Yt)]),e("td",Zt,[(m.device_type||"broadlink")==="broadlink"?(s(),i("div",Qt,[(s(!0),i(me,null,he(r.getDeviceCommands(m),y=>(s(),i("button",{key:y,class:X(["command-btn",r.getCommandTypeClass(m,y)]),onClick:I=>r.sendCommand(m,y),title:r.getCommandTypeLabel(m,y)},f(y),11,eo))),128)),r.getDeviceCommands(m).length===0?(s(),i("span",to," No commands ")):x("",!0)])):m.device_type==="smartir"?(s(),i("div",oo,[e("span",lo,"Profile: "+f(m.device_code),1)])):x("",!0)]),e("td",no,[e("button",{class:"action-btn commands",onClick:y=>r.openCommands(m),title:"Manage Commands"},[...c[0]||(c[0]=[e("i",{class:"mdi mdi-remote-tv"},null,-1)])],8,so),e("button",{class:"action-btn edit",onClick:y=>r.editDevice(m),title:"Edit"},[...c[1]||(c[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})],-1)])],8,ao),e("button",{class:"action-btn delete",onClick:y=>r.deleteDevice(m),title:"Delete"},[...c[2]||(c[2]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"3 6 5 6 21 6"}),e("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})],-1)])],8,io)])]))),128))])])])}const uo=$e(Ht,[["render",ro],["__scopeId","data-v-2895a204"]]),co={class:"icon-picker"},mo={class:"icon-input-wrapper"},vo=["id","placeholder"],po={key:0,class:"icon-preview"},fo={key:0,class:"icon-dropdown"},go={class:"icon-grid"},yo=["onMousedown","title"],bo={__name:"IconPicker",props:{modelValue:{type:String,default:""},inputId:{type:String,default:"icon-input"},placeholder:{type:String,default:"e.g., mdi:television"}},emits:["update:modelValue"],setup(t,{emit:c}){const d=t,$=c,w=b(d.modelValue),r=b(!1),m=["television","speaker","radio","music","video","movie","play","pause","stop","skip-next","skip-previous","volume-high","volume-medium","volume-low","volume-off","remote","remote-tv","cast","chromecast","spotify","netflix","youtube","lightbulb","lightbulb-on","lightbulb-off","lamp","floor-lamp","ceiling-light","light-switch","led-strip","led-strip-variant","wall-sconce","chandelier","spotlight","track-light","vanity-light","desk-lamp","fan","ceiling-fan","air-conditioner","thermometer","thermostat","heat-wave","snowflake","fire","radiator","water-boiler","hvac","blinds","blinds-open","window-shutter","window-shutter-open","curtains","curtains-closed","roller-shade","roller-shade-closed","garage","garage-open","gate","door","door-open","window-open","window-closed","washing-machine","tumble-dryer","dishwasher","refrigerator","stove","microwave","oven","toaster","kettle","coffee","coffee-maker","blender","robot-vacuum","robot-vacuum-variant","vacuum","broom","spray-bottle","lock","lock-open","lock-smart","key","shield","shield-check","alarm-light","bell","doorbell","camera","cctv","motion-sensor","smoke-detector","fire-extinguisher","water-alert","gas-cylinder","sofa","bed","bed-double","desk","chair","table","bookshelf","home","home-outline","home-assistant","floor-plan","room","weather-sunny","weather-night","weather-cloudy","weather-rainy","weather-snowy","weather-lightning","weather-windy","weather-fog","weather-partly-cloudy","umbrella","water","water-percent","phone","cellphone","tablet","laptop","desktop-tower","monitor","keyboard","mouse","printer","router","router-wireless","access-point","wifi","bluetooth","usb","hdmi-port","ethernet","power","power-plug","power-socket","battery","battery-charging","lightning-bolt","flash","solar-panel","solar-power","leaf","tree","flower","sprout","grass","watering-can","shovel","fence","pool","hot-tub","silverware","silverware-fork-knife","food","food-apple","glass-wine","glass-cocktail","bottle-wine","pot","pot-steam","shower","shower-head","bathtub","toilet","sink","faucet","hand-wash","car","car-side","garage-variant","tools","hammer","wrench","screwdriver","toolbox","ladder","heart","heart-pulse","run","walk","bike","dumbbell","yoga","scale-bathroom","thermometer-lines","clock","clock-outline","timer","alarm","calendar","calendar-today","calendar-clock","history","bell-ring","bell-alert","alert","alert-circle","information","help-circle","check","check-circle","close-circle","minus-circle","plus-circle","arrow-up","arrow-down","arrow-left","arrow-right","chevron-up","chevron-down","menu","dots-vertical","dots-horizontal","cog","tune","circle","square","triangle","hexagon","star","star-outline","heart-outline","plus","minus","close","check-bold","eye","eye-off","account","account-group","baby","dog","cat","paw","gift","balloon","party-popper","candle","book","book-open","newspaper","email","message","phone-classic"];se(()=>d.modelValue,k=>{w.value=k});const y=W(()=>{if(!w.value)return m.slice(0,50);const k=w.value.toLowerCase().replace("mdi:","");return m.filter(o=>o.toLowerCase().includes(k)).slice(0,50)}),I=()=>{r.value=!0,$("update:modelValue",w.value)},_=()=>{setTimeout(()=>{r.value=!1},200)},E=k=>{w.value=`mdi:${k}`,$("update:modelValue",w.value),r.value=!1};return(k,o)=>(s(),i("div",co,[e("div",mo,[J(e("input",{id:t.inputId,"onUpdate:modelValue":o[0]||(o[0]=O=>w.value=O),type:"text",placeholder:t.placeholder,onInput:I,onFocus:o[1]||(o[1]=O=>r.value=!0),onBlur:_},null,40,vo),[[Le,w.value]]),w.value?(s(),i("div",po,[e("i",{class:X(`mdi mdi-${w.value.replace("mdi:","")}`)},null,2)])):x("",!0)]),r.value&&y.value.length>0?(s(),i("div",fo,[e("div",go,[(s(!0),i(me,null,he(y.value,O=>(s(),i("div",{key:O,class:"icon-option",onMousedown:ce(F=>E(O),["prevent"]),title:O},[e("i",{class:X(`mdi mdi-${O}`)},null,2),e("span",null,f(O),1)],40,yo))),128))])])):x("",!0)]))}},ho=$e(bo,[["__scopeId","data-v-a64f5011"]]),ko={key:0,class:"dropdown-label"},wo={key:0,class:"required"},$o=["placeholder","disabled","onKeydown"],Co={class:"dropdown-icons"},_o={key:0,class:"mdi mdi-loading mdi-spin"},So={key:2,class:"mdi mdi-chevron-down"},Io={key:1,class:"error-message"},Do={key:2,class:"hint-message"},To={key:0,class:"dropdown-menu"},xo=["onMousedown","onMouseenter"],Ro={class:"option-content"},Mo={class:"option-label"},Eo={key:0,class:"option-description"},Ao={key:0,class:"mdi mdi-check selected-icon"},Lo={key:3,class:"dropdown-menu"},Oo={__name:"SearchableDropdown",props:{modelValue:{type:[String,Number,Object],default:null},options:{type:Array,required:!0,default:()=>[]},label:{type:String,default:""},placeholder:{type:String,default:"Search..."},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},error:{type:String,default:""},hint:{type:String,default:""},optionLabel:{type:String,default:"label"},optionValue:{type:String,default:"value"},optionDescription:{type:String,default:"description"},filterMethod:{type:Function,default:null}},emits:["update:modelValue","change","search"],setup(t,{emit:c}){const d=t,$=c,w=b(null),r=b(null),m=b(""),y=b(!1),I=b(0),_=b(!1),E=M=>typeof M=="string"||typeof M=="number"?M:M[d.optionLabel]||M.label||M.name||String(M),k=M=>typeof M=="string"||typeof M=="number"?M:M[d.optionValue]||M.value||M.id||M,o=M=>typeof M=="string"||typeof M=="number"?"":M[d.optionDescription]||M.description||"",O=M=>{const U=k(M);return typeof d.modelValue=="object"?k(d.modelValue)===U:d.modelValue===U},F=W(()=>{if(!m.value)return d.options;if(d.filterMethod)return d.options.filter(U=>d.filterMethod(U,m.value));const M=m.value.toLowerCase();return d.options.filter(U=>{const oe=E(U).toLowerCase(),ie=o(U).toLowerCase();return oe.includes(M)||ie.includes(M)})}),N=W(()=>{if(!d.modelValue)return"";const M=d.options.find(U=>{const oe=k(U);return typeof d.modelValue=="object"?oe===k(d.modelValue):oe===d.modelValue});return M?E(M):""});se(()=>d.modelValue,M=>{_.value||(m.value=N.value)}),se(()=>d.options,()=>{!_.value&&d.modelValue&&(m.value=N.value)},{deep:!0}),se(m,M=>{$("search",M),I.value=0}),xe(()=>{m.value=N.value});const L=()=>{var M;_.value=!0,y.value=!0,(M=r.value)==null||M.select()},l=()=>{_.value=!1,setTimeout(()=>{y.value=!1,d.modelValue?m.value=N.value:m.value=""},200)},p=()=>{var M;y.value=!1,(M=r.value)==null||M.blur()},g=M=>{const U=k(M);$("update:modelValue",U),$("change",U,M),m.value=E(M),p()},P=()=>{var M;$("update:modelValue",null),$("change",null,null),m.value="",(M=r.value)==null||M.focus()},z=()=>{if(!y.value){y.value=!0;return}I.value<F.value.length-1&&I.value++},G=()=>{I.value>0&&I.value--},Z=()=>{F.value.length>0&&I.value>=0&&g(F.value[I.value])},H=M=>{w.value&&!w.value.contains(M.target)&&(y.value=!1,d.modelValue?m.value=N.value:m.value="")};return xe(()=>{document.addEventListener("click",H)}),We(()=>{document.removeEventListener("click",H)}),(M,U)=>(s(),i("div",{class:"searchable-dropdown",ref_key:"dropdownRef",ref:w},[t.label?(s(),i("label",ko,[T(f(t.label)+" ",1),t.required?(s(),i("span",wo,"*")):x("",!0)])):x("",!0),e("div",{class:X(["dropdown-input-wrapper",{"has-error":t.error,disabled:t.disabled}])},[J(e("input",{ref_key:"inputRef",ref:r,type:"text","onUpdate:modelValue":U[0]||(U[0]=oe=>m.value=oe),placeholder:t.placeholder,disabled:t.disabled||t.loading,onFocus:L,onBlur:l,onKeydown:[Ke(ce(z,["prevent"]),["down"]),Ke(ce(G,["prevent"]),["up"]),Ke(ce(Z,["prevent"]),["enter"]),Ke(p,["escape"])],class:"dropdown-input"},null,40,$o),[[Le,m.value]]),e("div",Co,[t.loading?(s(),i("i",_o)):t.modelValue&&!t.disabled?(s(),i("i",{key:1,class:"mdi mdi-close-circle clear-icon",onClick:P})):(s(),i("i",So))])],2),t.error?(s(),i("div",Io,f(t.error),1)):x("",!0),t.hint&&!t.error?(s(),i("div",Do,f(t.hint),1)):x("",!0),ge(st,{name:"dropdown"},{default:tt(()=>[y.value&&F.value.length>0?(s(),i("div",To,[(s(!0),i(me,null,he(F.value,(oe,ie)=>(s(),i("div",{key:k(oe),class:X(["dropdown-item",{highlighted:ie===I.value,selected:O(oe)}]),onMousedown:ce(ye=>g(oe),["prevent"]),onMouseenter:ye=>I.value=ie},[e("div",Ro,[e("div",Mo,f(E(oe)),1),o(oe)?(s(),i("div",Eo,f(o(oe)),1)):x("",!0)]),O(oe)?(s(),i("i",Ao)):x("",!0)],42,xo))),128))])):x("",!0)]),_:1}),y.value&&F.value.length===0&&!t.loading?(s(),i("div",Lo,[...U[1]||(U[1]=[e("div",{class:"dropdown-item no-results"},[e("i",{class:"mdi mdi-magnify"}),T(" No results found ")],-1)])])):x("",!0)],512))}},Ze=$e(Oo,[["__scopeId","data-v-679ce35f"]]),Po={class:"smartir-selector"},Vo={class:"form-group"},Uo={class:"form-group"},Fo={class:"form-group"},jo=["value"],No={key:0,class:"error-message"},Bo={class:"form-group"},Ho={class:"form-group"},qo={key:1,class:"code-info"},zo={class:"info-content"},Jo={class:"info-row"},Wo={class:"info-value"},Go={class:"info-row"},Ko={class:"info-value"},Xo={key:0,class:"info-row"},Yo={class:"info-value"},Zo={class:"info-row"},Qo={class:"info-value"},el={__name:"SmartIRDeviceSelector",props:{entityType:{type:String,required:!0},modelValue:{type:Object,default:()=>({})},broadlinkDevices:{type:Array,default:()=>[]}},emits:["update:modelValue","change"],setup(t,{expose:c,emit:d}){const $=t,w=d,r=b([]),m=b([]),y=b(""),I=b(""),_=b(""),E=b(""),k=b(""),o=b(null),O=b(!1),F=b(!1),N=b({manufacturer:"",model:"",controller:""});xe(async()=>{if(await L(),$.modelValue&&(y.value=$.modelValue.manufacturer||"",I.value=$.modelValue.device_code||"",_.value=$.modelValue.controller_device||"",E.value=$.modelValue.temperature_sensor||"",k.value=$.modelValue.humidity_sensor||"",y.value&&(await l(y.value),I.value&&m.value.length>0))){const M=m.value.find(U=>U.code===I.value);M&&(o.value={code:M.code,manufacturer:y.value,models:M.models,controller:M.controller})}}),se(()=>$.entityType,async M=>{M&&(y.value="",I.value="",m.value=[],o.value=null,await L())});const L=async()=>{if($.entityType){O.value=!0,N.value.manufacturer="";try{const M=await te.get("/api/smartir/codes/manufacturers",{params:{entity_type:$.entityType}});if(M.data.success)r.value=M.data.manufacturers||[];else throw new Error(M.data.error||"Failed to load manufacturers")}catch(M){console.error("Error loading manufacturers:",M),N.value.manufacturer="Failed to load manufacturers. Please try again.",r.value=[]}finally{O.value=!1}}},l=async M=>{if(!(!M||!$.entityType)){F.value=!0,N.value.model="";try{const U=await te.get("/api/smartir/codes/models",{params:{entity_type:$.entityType,manufacturer:M}});if(U.data.success){const oe=U.data.models||[];m.value=oe.map(ie=>{const ye=ie.models&&ie.models.length>0?ie.models.join(", "):`Code ${ie.code}`;return{code:ie.code,label:ye,description:`Code: ${ie.code}`,models:ie.models,controller:ie.controller}})}else throw new Error(U.data.error||"Failed to load models")}catch(U){console.error("Error loading models:",U),N.value.model="Failed to load models. Please try again.",m.value=[]}finally{F.value=!1}}},p=async M=>{y.value=M,I.value="",o.value=null,m.value=[],M&&await l(M),Z()},g=()=>{const M=m.value.find(U=>U.code===I.value);M&&(o.value={code:M.code,manufacturer:y.value,models:M.models,controller:M.controller}),Z()},P=()=>{Z()},z=()=>{Z()},G=()=>{Z()},Z=()=>{var U,oe;const M={manufacturer:y.value,model:((oe=(U=o.value)==null?void 0:U.models)==null?void 0:oe[0])||"",device_code:I.value,controller_device:_.value};$.entityType==="climate"&&(E.value&&(M.temperature_sensor=E.value),k.value&&(M.humidity_sensor=k.value)),w("update:modelValue",M),w("change",M)};return c({validate:()=>{let M=!0;return N.value={manufacturer:"",model:"",controller:""},y.value||(N.value.manufacturer="Manufacturer is required",M=!1),I.value||(N.value.model="Model is required",M=!1),_.value||(N.value.controller="Broadlink controller is required",M=!1),M}}),(M,U)=>(s(),i("div",Po,[e("div",Vo,[ge(Ze,{modelValue:y.value,"onUpdate:modelValue":U[0]||(U[0]=oe=>y.value=oe),options:r.value,label:"Manufacturer",placeholder:"Search manufacturers...",required:"",loading:O.value,error:N.value.manufacturer,hint:"Select the device manufacturer",onChange:p},null,8,["modelValue","options","loading","error"])]),e("div",Uo,[ge(Ze,{modelValue:I.value,"onUpdate:modelValue":U[1]||(U[1]=oe=>I.value=oe),options:m.value,"option-label":"label","option-value":"code","option-description":"description",label:"Model",placeholder:"Search models...",required:"",disabled:!y.value,loading:F.value,error:N.value.model,hint:"Select the device model",onChange:g},null,8,["modelValue","options","disabled","loading","error"])]),e("div",Fo,[U[6]||(U[6]=e("label",{for:"controller-device"},[e("i",{class:"mdi mdi-remote"}),T(" Controller Device * ")],-1)),J(e("select",{id:"controller-device","onUpdate:modelValue":U[2]||(U[2]=oe=>_.value=oe),required:"",onChange:P},[U[5]||(U[5]=e("option",{value:""},"-- Select Controller Device --",-1)),(s(!0),i(me,null,he(t.broadlinkDevices,oe=>(s(),i("option",{key:oe.entity_id,value:oe.entity_id},[T(f(oe.name||oe.entity_id)+" ",1),oe.area_name?(s(),i(me,{key:0},[T(" - "+f(oe.area_name),1)],64)):x("",!0)],8,jo))),128))],544),[[Ie,_.value]]),U[7]||(U[7]=e("small",null,"Which remote device will send the IR/RF commands",-1)),N.value.controller?(s(),i("div",No,f(N.value.controller),1)):x("",!0)]),t.entityType==="climate"?(s(),i(me,{key:0},[e("div",Bo,[U[8]||(U[8]=e("label",{for:"temperature-sensor"},"Temperature Sensor",-1)),J(e("input",{id:"temperature-sensor","onUpdate:modelValue":U[3]||(U[3]=oe=>E.value=oe),type:"text",placeholder:"e.g., sensor.living_room_temperature",onInput:z},null,544),[[Le,E.value]]),U[9]||(U[9]=e("small",null,"Optional: Temperature sensor entity for current temperature",-1))]),e("div",Ho,[U[10]||(U[10]=e("label",{for:"humidity-sensor"},"Humidity Sensor",-1)),J(e("input",{id:"humidity-sensor","onUpdate:modelValue":U[4]||(U[4]=oe=>k.value=oe),type:"text",placeholder:"e.g., sensor.living_room_humidity",onInput:G},null,544),[[Le,k.value]]),U[11]||(U[11]=e("small",null,"Optional: Humidity sensor entity for current humidity",-1))])],64)):x("",!0),o.value?(s(),i("div",qo,[U[16]||(U[16]=e("div",{class:"info-header"},[e("i",{class:"mdi mdi-information"}),e("span",null,"Selected Device Code")],-1)),e("div",zo,[e("div",Jo,[U[12]||(U[12]=e("span",{class:"info-label"},"Code ID:",-1)),e("span",Wo,f(o.value.code_id),1)]),e("div",Go,[U[13]||(U[13]=e("span",{class:"info-label"},"Manufacturer:",-1)),e("span",Ko,f(o.value.manufacturer),1)]),o.value.models&&o.value.models.length>0?(s(),i("div",Xo,[U[14]||(U[14]=e("span",{class:"info-label"},"Supported Models:",-1)),e("span",Yo,f(o.value.models.join(", ")),1)])):x("",!0),e("div",Zo,[U[15]||(U[15]=e("span",{class:"info-label"},"Controller:",-1)),e("span",Qo,f(o.value.controller||"Broadlink"),1)])])])):x("",!0)]))}},tl=$e(el,[["__scopeId","data-v-1911c8f6"]]),ol={class:"modal-content"},ll={class:"modal-header"},nl={class:"input-wrapper"},sl={key:0,class:"validation-tooltip"},al={class:"input-wrapper"},il=["disabled"],rl={key:0,class:"validation-tooltip"},dl={key:0,class:"smartir-notice"},ul={key:0,class:"notice-success"},cl={key:1,class:"notice-warning"},ml={key:1,class:"smartir-notice"},vl={key:2},pl={class:"form-group"},fl=["disabled"],gl=["disabled"],yl={key:0},bl={key:1},hl={key:2},kl={key:3},wl={key:0,class:"form-group"},$l={class:"area-display-readonly"},Cl=["value"],_l=["disabled"],Sl=["href"],Il={key:1,class:"form-group"},Dl={class:"form-group"},Tl={class:"input-wrapper"},xl=["value"],Rl=["value"],Ml={key:2,class:"validation-tooltip"},El={key:0},Al={key:1},Ll={key:3,class:"smartir-section"},Ol={class:"modal-footer"},Pl={type:"submit",form:"device-form",class:"btn btn-primary"},Vl={__name:"DeviceForm",props:{device:{type:Object,default:null}},emits:["save","cancel"],setup(t,{emit:c}){const d=t,$=c,w=Me("smartirStatus"),r=Me("smartirEnabled"),m=W(()=>{var v;return localStorage.getItem("smartir_simulate_not_installed")==="true"?!1:((v=w==null?void 0:w.value)==null?void 0:v.installed)||!1}),y=W(()=>!!d.device),I=W(()=>["climate","media_player","fan","light"].includes(o.value.entity_type)),_=W(()=>m.value?!I.value&&o.value.entity_type?"(Not supported for this type)":"(Pre-configured Codes)":"(Requires SmartIR)"),E=W(()=>{var v;const D=((v=d.device)==null?void 0:v.commands)||{};return Object.keys(D).length>0}),k=W(()=>{if(!o.value.broadlink_entity)return"";const D=l.value.find(v=>v.entity_id===o.value.broadlink_entity);return D&&D.name||o.value.broadlink_entity}),o=b({name:"",entity_type:"",device_type:"broadlink",device:"",area:"",icon:"",broadlink_entity:"",enabled:!0,commands:{}}),O=b({name:"",entity_type:"",broadlink_entity:""}),F=b({}),N=b(null),L=b([]),l=b([]),p=b(null),g=b(null),P=b(null),z=b(!1);xe(async()=>{d.device&&(o.value={...d.device,device_type:d.device.device_type||"broadlink"},o.value.device_type==="smartir"&&(F.value={manufacturer:d.device.manufacturer,model:d.device.model,device_code:d.device.device_code,controller_device:d.device.controller_device,temperature_sensor:d.device.temperature_sensor,humidity_sensor:d.device.humidity_sensor})),await Promise.all([G(),Z()])});const G=async()=>{try{const D=await te.get("/api/areas");L.value=D.data.areas||[]}catch(D){console.error("Error loading areas:",D),L.value=[]}},Z=async()=>{try{const v=(await te.get("/api/remote/devices")).data.devices||[];l.value=v,console.log("Loaded remote devices:",v)}catch(D){console.error("Error loading remote devices:",D),l.value=[]}},H=D=>{if(!D)return"";const v=D.toLowerCase();for(const V of L.value){const pe=V.toLowerCase();if(v.includes(pe))return V}return""},M=(D,v="")=>{const V=v.toLowerCase();return V.includes("tv")?"mdi:television":V.includes("lamp")?"mdi:lamp":V.includes("ceiling")?"mdi:ceiling-light":V.includes("floor")?"mdi:floor-lamp":V.includes("desk")?"mdi:desk-lamp":V.includes("fan")?"mdi:fan":V.includes("ac")||V.includes("air con")?"mdi:air-conditioner":V.includes("heater")?"mdi:radiator":V.includes("blind")?"mdi:blinds":V.includes("curtain")?"mdi:curtains":V.includes("garage")?"mdi:garage":V.includes("speaker")||V.includes("stereo")?"mdi:speaker":V.includes("receiver")?"mdi:audio-video":{light:"mdi:lightbulb",fan:"mdi:fan",switch:"mdi:light-switch",media_player:"mdi:television",cover:"mdi:window-shutter",climate:"mdi:thermostat"}[D]||"mdi:devices"};se(()=>o.value.name,D=>{if(!y.value&&D&&!o.value.area){const v=H(D);v&&(o.value.area=v)}!y.value&&D&&o.value.entity_type&&(z.value||!o.value.icon)&&(o.value.icon=M(o.value.entity_type,D),z.value=!0)}),se(()=>o.value.entity_type,D=>{!y.value&&D&&(z.value||!o.value.icon)&&(o.value.icon=M(D,o.value.name),z.value=!0)}),se(()=>o.value.icon,(D,v)=>{v!==void 0&&D!==v&&!z.value&&(z.value=!1),D||(z.value=!1)});const U=b(!1),oe=async()=>{var D;if((D=d.device)!=null&&D.id){U.value=!0;try{const v=await te.post(`/api/devices/${d.device.id}/sync-area`);v.data.success?(o.value.area=v.data.area||"",v.data.area?console.log(`Area synced: ${v.data.area}`):console.log("No area assigned in Home Assistant")):console.warn(v.data.message||"Entity not found in HA")}catch(v){console.error("Failed to sync area:",v)}finally{U.value=!1}}},ie=()=>{var V;return!((V=d.device)!=null&&V.id)||!o.value.entity_type?"#":`/config/entities/entity/${`${o.value.entity_type}.${d.device.id}`}`},ye=()=>{O.value={name:"",entity_type:"",broadlink_entity:""};let D=!0;return(!o.value.name||o.value.name.trim()==="")&&(O.value.name="Device name is required",D=!1),o.value.entity_type||(O.value.entity_type="Entity type is required",D=!1),o.value.device_type==="broadlink"&&!o.value.broadlink_entity&&(O.value.broadlink_entity="Broadlink device is required",D=!1),D},Ee=D=>{O.value[D]=""},Te=async()=>{if(o.value.device_type==="smartir"){if(N.value&&!N.value.validate())return;const D={...o.value,smartir_config:{manufacturer:F.value.manufacturer,model:F.value.model,code_id:F.value.device_code,controller_device:F.value.controller_device}};$("save",D)}else{if(!ye())return;$("save",{...o.value})}},De=D=>{F.value=D};return(D,v)=>(s(),i("div",{class:"modal-overlay",onClick:v[11]||(v[11]=ce(V=>D.$emit("cancel"),["self"]))},[e("div",ol,[e("div",ll,[e("h2",null,f(y.value?"Edit Device":"Add New Device"),1),e("button",{onClick:v[0]||(v[0]=V=>D.$emit("cancel")),class:"close-btn"},[...v[12]||(v[12]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("form",{id:"device-form",onSubmit:ce(Te,["prevent"]),class:"modal-body"},[e("div",{class:X(["form-group",{"has-error":O.value.name}])},[v[14]||(v[14]=e("label",{for:"device-name"},"Device Name *",-1)),e("div",nl,[J(e("input",{id:"device-name",ref_key:"nameInput",ref:p,"onUpdate:modelValue":v[1]||(v[1]=V=>o.value.name=V),type:"text",placeholder:"e.g., Living Room TV",onInput:v[2]||(v[2]=V=>Ee("name"))},null,544),[[Le,o.value.name]]),O.value.name?(s(),i("div",sl,[v[13]||(v[13]=e("i",{class:"mdi mdi-alert"},null,-1)),T(" "+f(O.value.name),1)])):x("",!0)]),v[15]||(v[15]=e("small",null,"Friendly name for this device",-1))],2),e("div",{class:X(["form-group",{"has-error":O.value.entity_type}])},[v[23]||(v[23]=e("label",{for:"entity-type"},"Entity Type *",-1)),e("div",al,[J(e("select",{id:"entity-type",ref_key:"typeSelect",ref:g,"onUpdate:modelValue":v[3]||(v[3]=V=>o.value.entity_type=V),onChange:v[4]||(v[4]=V=>Ee("entity_type"))},[v[16]||(v[16]=He('<option value="" data-v-94bc1fe5>-- Select Type --</option><option value="light" data-v-94bc1fe5>ğŸ’¡ Light</option><option value="fan" data-v-94bc1fe5>ğŸŒ€ Fan</option><option value="switch" data-v-94bc1fe5>ğŸ”Œ Switch</option><option value="media_player" data-v-94bc1fe5>ğŸ“º Media Player</option><option value="cover" data-v-94bc1fe5>ğŸªŸ Cover (Blinds/Curtains)</option>',6)),e("option",{value:"climate",disabled:!m.value}," ğŸŒ¡ï¸ Climate "+f(m.value?"":"(Requires SmartIR)"),9,il)],544),[[Ie,o.value.entity_type]]),O.value.entity_type?(s(),i("div",rl,[v[17]||(v[17]=e("i",{class:"mdi mdi-alert"},null,-1)),T(" "+f(O.value.entity_type),1)])):x("",!0)]),o.value.entity_type==="climate"?(s(),i("div",dl,[m.value?(s(),i("div",ul,[...v[18]||(v[18]=[e("i",{class:"mdi mdi-check-circle"},null,-1),e("span",null,"SmartIR detected! Climate entities will be created via SmartIR profiles.",-1)])])):(s(),i("div",cl,[...v[19]||(v[19]=[e("i",{class:"mdi mdi-alert"},null,-1),e("div",null,[e("strong",null,"SmartIR Required"),e("p",null,"Climate entities (AC, heaters) require SmartIR integration."),e("a",{href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"smartir-link"}," Install SmartIR â†’ ")],-1)])]))])):m.value&&["media_player","fan","light"].includes(o.value.entity_type)?(s(),i("div",ml,[...v[20]||(v[20]=[e("div",{class:"notice-info"},[e("i",{class:"mdi mdi-information"}),e("span",null,"ğŸ’¡ SmartIR available! You can use pre-configured codes or learn your own.")],-1)])])):!m.value&&o.value.entity_type?(s(),i("small",vl,[v[21]||(v[21]=T(" ğŸ’¡ Tip: Install ",-1)),v[22]||(v[22]=e("a",{href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"inline-link"},"SmartIR",-1)),T(" for pre-configured "+f(o.value.entity_type==="climate"?"climate":o.value.entity_type)+" device codes ",1)])):x("",!0)],2),e("div",pl,[v[26]||(v[26]=e("label",{for:"device-type"},"Device Type *",-1)),J(e("select",{id:"device-type","onUpdate:modelValue":v[5]||(v[5]=V=>o.value.device_type=V),required:"",disabled:y.value},[v[24]||(v[24]=e("option",{value:""},"-- Select Device Type --",-1)),v[25]||(v[25]=e("option",{value:"broadlink"},"ğŸ“¡ Broadlink Device (Learn IR Codes)",-1)),_e(r)?(s(),i("option",{key:0,value:"smartir",disabled:!m.value||!I.value}," ğŸŒ SmartIR Device "+f(_.value),9,gl)):x("",!0)],8,fl),[[Ie,o.value.device_type]]),y.value?(s(),i("small",yl,"Cannot change device type after creation")):o.value.device_type==="smartir"?(s(),i("small",bl,"Using pre-configured codes from SmartIR repository")):o.value.device_type==="broadlink"?(s(),i("small",hl,"Learn and store your own IR codes")):(s(),i("small",kl,"Choose how to configure this device"))]),y.value?(s(),i("div",wl,[v[29]||(v[29]=e("label",{for:"device-area"},"Area",-1)),e("div",$l,[e("input",{id:"device-area",value:o.value.area||"Not assigned",type:"text",readonly:"",class:"readonly-input"},null,8,Cl),e("button",{type:"button",onClick:oe,disabled:U.value,class:"sync-area-btn",title:"Sync area from Home Assistant"},[e("i",{class:X(U.value?"mdi mdi-loading mdi-spin":"mdi mdi-refresh")},null,2)],8,_l)]),e("small",null,[v[27]||(v[27]=e("i",{class:"mdi mdi-information-outline"},null,-1)),v[28]||(v[28]=T(" Set area in Home Assistant, then click sync. ",-1)),e("a",{href:ie(),target:"_blank",class:"inline-link"},"Open in HA â†’",8,Sl)])])):(s(),i("div",Il,[...v[30]||(v[30]=[e("div",{class:"info-notice"},[e("i",{class:"mdi mdi-information-outline"}),e("span",null,[e("strong",null,"Area Assignment:"),T(" After generating entities and restarting Home Assistant, you can assign areas in HA and sync them here.")])],-1)])])),e("div",Dl,[v[31]||(v[31]=e("label",{for:"device-icon"},"Icon",-1)),ge(ho,{modelValue:o.value.icon,"onUpdate:modelValue":v[6]||(v[6]=V=>o.value.icon=V),inputId:"device-icon",placeholder:"e.g., mdi:television"},null,8,["modelValue"]),v[32]||(v[32]=e("small",null,"Optional: Material Design Icon name",-1))]),o.value.device_type==="broadlink"?(s(),i("div",{key:2,class:X(["form-group",{"has-error":O.value.broadlink_entity}])},[v[35]||(v[35]=e("label",{for:"broadlink-entity"},"Remote Device *",-1)),e("div",Tl,[!y.value||!E.value?J((s(),i("select",{key:0,id:"broadlink-entity",ref_key:"broadlinkSelect",ref:P,"onUpdate:modelValue":v[7]||(v[7]=V=>o.value.broadlink_entity=V),onChange:v[8]||(v[8]=V=>Ee("broadlink_entity"))},[v[33]||(v[33]=e("option",{value:""},"-- Select Remote Device --",-1)),(s(!0),i(me,null,he(l.value,V=>(s(),i("option",{key:V.entity_id,value:V.entity_id},[T(f(V.name||V.entity_id)+" ",1),V.area_name?(s(),i(me,{key:0},[T(" - "+f(V.area_name),1)],64)):x("",!0)],8,xl))),128))],544)),[[Ie,o.value.broadlink_entity]]):(s(),i("input",{key:1,id:"broadlink-entity",value:k.value,type:"text",readonly:"",disabled:""},null,8,Rl)),O.value.broadlink_entity?(s(),i("div",Ml,[v[34]||(v[34]=e("i",{class:"mdi mdi-alert"},null,-1)),T(" "+f(O.value.broadlink_entity),1)])):x("",!0)]),!y.value||!E.value?(s(),i("small",El,"Required: Select which remote device to use for sending commands")):(s(),i("small",Al,"Cannot change remote device after commands are learned"))],2)):x("",!0),o.value.device_type==="smartir"?(s(),i("div",Ll,[v[36]||(v[36]=e("div",{class:"section-header"},[e("i",{class:"mdi mdi-cloud-download"}),e("span",null,"SmartIR Device Configuration")],-1)),ge(tl,{ref_key:"smartirSelector",ref:N,"entity-type":o.value.entity_type,modelValue:F.value,"onUpdate:modelValue":v[9]||(v[9]=V=>F.value=V),"broadlink-devices":l.value,onChange:De},null,8,["entity-type","modelValue","broadlink-devices"])])):x("",!0)],32),e("div",Ol,[e("button",{type:"button",onClick:v[10]||(v[10]=V=>D.$emit("cancel")),class:"btn btn-secondary"}," Cancel "),e("button",Pl,[v[37]||(v[37]=e("i",{class:"mdi mdi-check"},null,-1)),T(" "+f(y.value?"Update":"Create"),1)])])])]))}},Ul=$e(Vl,[["__scopeId","data-v-94bc1fe5"]]),Fl={class:"modal-header"},jl={class:"modal-body"},Nl={class:"message-text"},Bl={key:0,class:"checkbox-option"},Hl={class:"modal-footer"},ql=["disabled"],zl={__name:"ConfirmDialog",props:{isOpen:{type:Boolean,default:!1},title:{type:String,default:"Confirm"},message:{type:String,required:!0},confirmText:{type:String,default:"OK"},cancelText:{type:String,default:"Cancel"},showCancel:{type:Boolean,default:!0},dangerMode:{type:Boolean,default:!1},confirmDisabled:{type:Boolean,default:!1},checkboxLabel:{type:String,default:""}},emits:["confirm","cancel"],setup(t,{emit:c}){const d=t,$=c,w=b(!1);se(()=>d.isOpen,y=>{y&&(w.value=!1)});const r=()=>{$("confirm",w.value)},m=()=>{$("cancel")};return(y,I)=>t.isOpen?(s(),i("div",{key:0,class:"modal-overlay",onClick:ce(m,["self","stop"])},[e("div",{class:"modal-dialog confirm-dialog",onClick:I[1]||(I[1]=ce(()=>{},["stop"]))},[e("div",Fl,[e("h2",null,f(t.title),1)]),e("div",jl,[e("p",Nl,f(t.message),1),t.checkboxLabel?(s(),i("div",Bl,[e("label",null,[J(e("input",{type:"checkbox","onUpdate:modelValue":I[0]||(I[0]=_=>w.value=_)},null,512),[[ve,w.value]]),e("span",null,f(t.checkboxLabel),1)])])):x("",!0)]),e("div",Hl,[t.showCancel?(s(),i("button",{key:0,onClick:ce(m,["stop"]),class:"btn btn-secondary"},f(t.cancelText),1)):x("",!0),t.confirmText?(s(),i("button",{key:1,onClick:ce(r,["stop"]),class:X(["btn",t.dangerMode?"btn-danger":"btn-primary"]),disabled:t.confirmDisabled},f(t.confirmText),11,ql)):x("",!0)])])])):x("",!0)}},Be=$e(zl,[["__scopeId","data-v-9cea6cb3"]]),Jl={class:"modal-content"},Wl={class:"modal-header"},Gl={class:"modal-body"},Kl={key:0,class:"smartir-info"},Xl={key:0,class:"climate-note"},Yl={class:"form-group"},Zl=["value"],Ql={class:"form-group"},en=["disabled"],tn={label:"Suggested Commands"},on=["value"],ln=["disabled"],nn={class:"form-group"},sn={class:"radio-card-group"},an=["disabled"],rn=["disabled"],dn={class:"form-group"},un={class:"radio-card-group"},cn=["disabled"],mn=["disabled"],vn=["disabled"],pn={key:0,class:"help-box"},fn={class:"learn-action"},gn=["disabled"],yn={key:0,class:"mdi mdi-loading mdi-spin"},bn={key:1,class:"mdi mdi-remote-tv"},hn={key:0,class:"learning-status"},kn={key:0},wn={key:1},$n={key:2},Cn={key:1,class:"result-message success"},_n={key:2,class:"section-divider"},Sn={key:3,class:"loading-commands"},In={key:4,class:"learned-commands"},Dn={class:"commands-header"},Tn=["disabled"],xn={class:"command-list"},Rn={class:"command-info"},Mn={class:"command-name"},En={class:"command-right"},An={key:0,class:"mdi mdi-alert-circle error-icon",title:"Error: Command failed to learn. Delete and try again."},Ln={key:1,class:"mdi mdi-clock-outline pending-icon",title:"Pending: Waiting for code from storage..."},On=["title"],Pn={class:"command-actions"},Vn=["onClick","title","disabled"],Un=["onClick","title"],Fn={key:5,class:"untracked-commands"},jn={class:"command-list"},Nn={class:"command-name"},Bn=["onClick"],Hn={class:"modal-footer"},qn=["disabled"],zn={__name:"CommandLearner",props:{device:{type:Object,required:!0}},emits:["cancel","learned"],setup(t,{emit:c}){const d=t,$=c,w=b([]),r=b(""),m=b(""),y=b(""),I=b("ir"),_=b("manager_only"),E=b(!1),k=b(!1),o=b(""),O=b(""),F=b(""),N=b("success"),L=b([]),l=b([]),p=b(!1),g=b(!1),P=b(""),z=b(!1),G=b(null),Z=b(null),H=b(""),M=b(""),U=W(()=>d.device.device_type==="smartir");W(()=>{if(U.value)return!1;const h=m.value==="__custom__"?y.value:m.value;return r.value&&h.trim()});const oe=()=>{G.value&&G.value.setCustomValidity("")},ie=()=>{Z.value&&Z.value.setCustomValidity("")},ye=W(()=>{const h=w.value.find(u=>u.entity_id===r.value);return h?h.name||h.entity_id:r.value}),Ee={light:["turn_on","turn_off","toggle","brightness_up","brightness_down","dim","bright"],fan:["turn_on","turn_off","toggle","speed_low","speed_medium","speed_high","speed_1","speed_2","speed_3","speed_4","speed_5","oscillate_on","oscillate_off","direction_forward","direction_reverse"],switch:["turn_on","turn_off","toggle"],media_player:["turn_on","turn_off","toggle","volume_up","volume_down","volume_mute","play","pause","stop","play_pause","next_track","previous_track","channel_up","channel_down","source_hdmi1","source_hdmi2","source_hdmi3","source_tv","source_aux","source_bluetooth","menu","home","back","select","arrow_up","arrow_down","arrow_left","arrow_right"],cover:["open","close","stop","open_tilt","close_tilt","position_0","position_25","position_50","position_75","position_100"]},Te=W(()=>{const h=d.device.entity_type||"switch";return Ee[h]||Ee.switch});se(()=>d.device,async(h,u)=>{if(h&&u&&h.id===u.id){const n=Object.keys(h.commands||{}).length,j=Object.keys(u.commands||{}).length;n!==j&&(console.log(`ğŸ”„ Device commands changed (${j} -> ${n}), reloading...`),await D(!0))}},{deep:!0}),xe(async()=>{await De(),await D(),await ue(),G.value&&(G.value.setCustomValidity(""),G.value.oninvalid=()=>{G.value.setCustomValidity("Command name is required")}),d.device.broadlink_entity&&(r.value=d.device.broadlink_entity)}),se(m,async h=>{h==="__custom__"&&(await at(),Z.value&&(Z.value.setCustomValidity(""),Z.value.oninvalid=()=>{Z.value.setCustomValidity("Custom command name is required")}))});const De=async()=>{try{const h=await te.get("/api/broadlink/devices");w.value=h.data.devices||[]}catch(h){console.error("Error loading Broadlink devices:",h)}},D=async(h=!1)=>{var u,n;p.value=!0;try{if(U.value){const j=await te.get("/api/smartir/codes/code",{params:{entity_type:d.device.entity_type,code_id:d.device.device_code}});if(j.data.success&&j.data.code){const C=j.data.code.commands||{},a=j.data.code.commandType||"ir";if(d.device.entity_type==="climate"){const R=[];for(const[K,le]of Object.entries(C))typeof le=="string"?R.push({name:K,type:a}):typeof le=="object"&&le!==null&&Object.keys(le).sort((Q,Re)=>parseInt(Q)-parseInt(Re)).forEach(Q=>{R.push({name:`${K}_${Q}`,type:a,label:`${K.charAt(0).toUpperCase()+K.slice(1)} ${Q}Â°C`})});L.value=R}else L.value=Object.keys(C).map(R=>({name:R,type:a}))}}else{if(console.log("ğŸ“‹ Loading commands for device:",d.device),console.log("ğŸ“‹ Device ID:",d.device.id),console.log("ğŸ“‹ Force reload:",h),h&&d.device.id){console.log("ğŸ”„ Force reloading commands from API after sync");try{const C=(await te.get(`/api/commands/${d.device.id}`)).data.commands||{};console.log("ğŸ“¦ Raw commands from API:",C),L.value=Object.entries(C).map(([a,R])=>{console.log(`  Command '${a}':`,R,`(type: ${typeof R})`);const K=typeof R=="object"&&R!==null&&(R.command_type||R.type)||"ir",le=typeof R=="object"&&R!==null?R.data:R;return{name:a,type:K,data:le,hasError:le==="error",isPending:le==="pending"}}),console.log("ğŸ“‹ Reloaded commands:",L.value)}catch(j){if(console.error("âŒ Error loading commands:",j),((u=j.response)==null?void 0:u.status)===404)console.log("â„¹ï¸ No commands found for device"),L.value=[];else throw j}}else if(d.device.commands&&Object.keys(d.device.commands).length>0)console.log("âœ… Using commands from device object"),L.value=Object.entries(d.device.commands).map(([j,C])=>{const a=C.data||C;return{name:j,type:C.command_type||C.type||"ir",data:a,hasError:a==="error",isPending:a==="pending"}});else if(d.device.commands!==void 0)console.log("â„¹ï¸ Device has empty commands object - skipping API call"),L.value=[];else if(d.device.id){console.log("ğŸŒ Fetching commands from API for device ID:",d.device.id);try{const C=(await te.get(`/api/commands/${d.device.id}`)).data.commands||{};L.value=Object.entries(C).map(([a,R])=>({name:a,type:R.command_type||R.type||"ir"}))}catch(j){if(((n=j.response)==null?void 0:n.status)===404)console.log("â„¹ï¸ No commands found for device (this is normal for new devices)"),L.value=[];else throw j}}else console.log("âš ï¸ No commands found and no device ID");console.log("ğŸ“‹ Final learned commands:",L.value)}}catch(j){console.error("Error loading commands:",j)}finally{p.value=!1}},v=async()=>{F.value="",N.value="",O.value="",k.value=!0,o.value="preparing";try{const h=m.value==="__custom__"?y.value:m.value;I.value==="rf"?(o.value="learning",F.value="âš ï¸ Learning request sent to device. Check Home Assistant notifications (ğŸ””) for instructions. Note: If the device is offline or times out, you will see a notification but this dialog will still show success.",N.value="warning",await new Promise(n=>setTimeout(n,50))):o.value="learning";const u=await te.post("/api/commands/learn",{device_id:d.device.id,entity_id:r.value||d.device.broadlink_entity,device:d.device.device||d.device.id,command:h.trim(),command_type:I.value,save_destination:_.value});if(u.data.success){if(o.value="complete",F.value="",N.value="",_.value==="manager_only"||_.value==="both"){L.value.find(C=>C.name===h)||L.value.push({name:h,type:I.value});const j=l.value.indexOf(h);j>-1&&l.value.splice(j,1)}await ue(),m.value="",y.value="",$("learned",{deviceId:d.device.id,commandName:h,commandType:I.value}),k.value=!1,o.value=""}else throw new Error(u.data.error||"Failed to learn command")}catch(h){console.error("Learning error:",h),F.value=h.message||"Error learning command",N.value="error",k.value=!1,o.value=""}},V=async h=>{var u,n;try{M.value=h,H.value="";let j=d.device.id.split(".")[1];d.device.device&&(j=d.device.device);const C=U.value?d.device.controller_device:r.value||d.device.broadlink_entity;if(!C){console.error("Missing entity_id for test command:",{isSmartIR:U.value,controller_device:d.device.controller_device,broadlink_entity:d.device.broadlink_entity,selectedBroadlink:r.value,device:d.device}),F.value="Missing Broadlink remote entity. Please select a Broadlink device.",N.value="error",M.value="";return}const a={device_id:d.device.id,entity_id:C,command:h,device:d.device.device||d.device.id};console.log("ğŸ§ª Testing command:",a),(await te.post("/api/commands/test",a)).data.success&&(H.value=h,setTimeout(()=>{H.value===h&&(H.value="")},2e3))}catch(j){console.error("âŒ Test command error:",j);const C=((n=(u=j.response)==null?void 0:u.data)==null?void 0:n.error)||j.message||"Unknown error";F.value=`Failed to send command: ${C}`,N.value="error"}finally{M.value=""}},pe=h=>{P.value=h,g.value=!0},Oe=()=>{g.value=!1,P.value=""},fe=async h=>{const u=P.value;g.value=!1;try{if(console.log(`ğŸ—‘ï¸ Deleting command: ${u}, alsoDeleteFromIntegration: ${h}`),await te.delete(`/api/commands/${d.device.id}/${u}`),h)try{const n=d.device.device||d.device.id;await te.post("/api/commands/delete-from-storage",{device:n,command:u}),console.log("âœ… Also deleted from Broadlink Integration storage")}catch(n){console.warn("âš ï¸ Failed to delete from Broadlink Integration storage:",n)}await D(!0),await ue(),F.value=`Command "${u}" deleted`,N.value="success",$("learned",{deviceId:d.device.id,commandName:u,action:"deleted"})}catch(n){console.error("âŒ Delete error:",n),F.value=`Failed to delete command: ${n.message}`,N.value="error",await D(!0)}finally{P.value=""}},ue=async()=>{try{let h=d.device.device;h||(h=d.device.id.includes(".")?d.device.id.split(".")[1]:d.device.id),console.log("ğŸ” Looking for untracked commands for device:",h);const n=(await te.get("/api/commands/untracked")).data.untracked||{};console.log("ğŸ“¦ All untracked commands:",Object.keys(n)),console.log("ğŸ“¦ Untracked for this device:",n[h]),n[h]?l.value=Object.keys(n[h].commands):l.value=[]}catch(h){console.error("Error loading untracked commands:",h),l.value=[]}},Ae=()=>{l.value.length!==0&&(z.value=!0)},Pe=async h=>{var u,n,j;console.log("ğŸ”µ [IMPORT SINGLE] Importing command:",h);try{const C=d.device.device||d.device.id||((u=d.device.id)!=null&&u.includes(".")?d.device.id.split(".")[1]:null);if(!C)throw new Error("Could not determine device name for import");console.log("ğŸ”µ [IMPORT SINGLE] Calling API to import command...");const a=await te.post("/api/commands/import",{device_id:d.device.id,source_device:C,commands:[h]});console.log("ğŸ”µ [IMPORT SINGLE] API response:",a.data),a.data.success?(F.value=`Imported command '${h}' successfully!`,N.value="success",await D(!0),await ue()):(F.value=a.data.error||"Failed to import command",N.value="error")}catch(C){console.error("ğŸ”´ [IMPORT SINGLE] Error:",C),F.value=((j=(n=C.response)==null?void 0:n.data)==null?void 0:j.error)||C.message||"Failed to import command",N.value="error"}},ee=async()=>{var h;console.log("ğŸ”µ [IMPORT] Starting import process..."),console.log("ğŸ”µ [IMPORT] Current learned commands:",L.value.length),console.log("ğŸ”µ [IMPORT] Current untracked commands:",l.value.length),z.value=!1;try{const u=d.device.device||d.device.id||((h=d.device.id)!=null&&h.includes(".")?d.device.id.split(".")[1]:null);if(console.log("ğŸ”µ [IMPORT] Device object:",d.device),console.log("ğŸ”µ [IMPORT] Extracted device name:",u),!u)throw new Error("Could not determine device name for import");console.log("ğŸ”µ [IMPORT] Calling API to import commands...");const n=await te.post("/api/commands/import",{device_id:d.device.id,source_device:u,commands:l.value});console.log("ğŸ”µ [IMPORT] API response:",n.data),n.data.success&&(F.value=`Imported ${n.data.imported_count} commands successfully!`,N.value="success",console.log("ğŸ”µ [IMPORT] Import successful, now reloading commands..."),console.log("ğŸ”µ [IMPORT] BEFORE reload - learned:",L.value.length,"untracked:",l.value.length),await D(!0),console.log("ğŸ”µ [IMPORT] AFTER loadLearnedCommands - learned:",L.value.length),await ue(),console.log("ğŸ”µ [IMPORT] AFTER loadUntrackedCommands - untracked:",l.value.length),console.log("ğŸ”µ [IMPORT] Final state - learned:",L.value,"untracked:",l.value),console.log("ğŸ”µ [IMPORT] Emitting learned event to parent..."),$("learned",{deviceId:d.device.id,action:"imported",count:n.data.imported_count}),console.log("ğŸ”µ [IMPORT] âœ… Import process complete!"))}catch(u){console.error("ğŸ”µ [IMPORT] âŒ Import failed:",u),F.value=`Failed to import commands: ${u.message}`,N.value="error"}};return(h,u)=>(s(),i("div",{class:"modal-overlay",onClick:u[12]||(u[12]=ce(n=>h.$emit("cancel"),["self"]))},[e("div",Jl,[e("div",Wl,[e("h2",null,f(U.value?"Commands for":"Learn Commands for")+" "+f(t.device.name),1),e("button",{onClick:u[0]||(u[0]=n=>h.$emit("cancel")),class:"close-btn"},[...u[13]||(u[13]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Gl,[U.value?(s(),i("div",Kl,[u[18]||(u[18]=e("i",{class:"mdi mdi-information"},null,-1)),e("div",null,[u[17]||(u[17]=e("h3",null,"SmartIR Device",-1)),e("p",null,[u[14]||(u[14]=T("This device uses SmartIR code file ",-1)),e("strong",null,f(t.device.device_code),1),u[15]||(u[15]=T(". Commands are pre-configured and cannot be learned.",-1))]),t.device.entity_type==="climate"?(s(),i("p",Xl,[...u[16]||(u[16]=[e("i",{class:"mdi mdi-alert-circle-outline"},null,-1),e("strong",null,"Note:",-1),T(" Climate device commands are temperature-based. Testing individual modes may not work as expected. Use the Home Assistant climate card to control your device. ",-1)])])):x("",!0)])])):(s(),i("form",{key:1,onSubmit:ce(v,["prevent"])},[e("div",Yl,[u[19]||(u[19]=e("label",{for:"broadlink-entity"},"Broadlink Device",-1)),e("input",{id:"broadlink-entity",value:ye.value,type:"text",readonly:"",disabled:""},null,8,Zl),u[20]||(u[20]=e("small",null,"Commands will be learned using this device (set when device was created)",-1))]),e("div",Ql,[u[23]||(u[23]=e("label",{for:"command-name"},"Command Name *",-1)),J(e("select",{id:"command-name",ref_key:"commandSelect",ref:G,"onUpdate:modelValue":u[1]||(u[1]=n=>m.value=n),disabled:k.value,required:"",onChange:oe},[u[21]||(u[21]=e("option",{value:""},"-- Select or type command --",-1)),e("optgroup",tn,[(s(!0),i(me,null,he(Te.value,n=>(s(),i("option",{key:n,value:n},f(n),9,on))),128))]),u[22]||(u[22]=e("option",{value:"__custom__"},"Custom command...",-1))],40,en),[[Ie,m.value]]),m.value==="__custom__"?J((s(),i("input",{key:0,ref_key:"customCommandInput",ref:Z,"onUpdate:modelValue":u[2]||(u[2]=n=>y.value=n),type:"text",placeholder:"Enter custom command name",disabled:k.value,required:"",class:"custom-command-input",onInput:ie},null,40,ln)),[[Le,y.value]]):x("",!0),e("small",null,"Select a suggested command for "+f(t.device.entity_type||"this device")+", or enter a custom one.",1)]),e("div",nn,[u[28]||(u[28]=e("label",null,"Command Type",-1)),e("div",sn,[e("label",{class:X(["radio-card",{active:I.value==="ir",disabled:k.value}])},[J(e("input",{type:"radio","onUpdate:modelValue":u[3]||(u[3]=n=>I.value=n),value:"ir",disabled:k.value},null,8,an),[[ze,I.value]]),u[24]||(u[24]=e("i",{class:"mdi mdi-remote"},null,-1)),u[25]||(u[25]=e("span",null,"IR (Infrared)",-1))],2),e("label",{class:X(["radio-card",{active:I.value==="rf",disabled:k.value}])},[J(e("input",{type:"radio","onUpdate:modelValue":u[4]||(u[4]=n=>I.value=n),value:"rf",disabled:k.value},null,8,rn),[[ze,I.value]]),u[26]||(u[26]=e("i",{class:"mdi mdi-radio-tower"},null,-1)),u[27]||(u[27]=e("span",null,"RF (Radio Frequency)",-1))],2)])]),e("div",dn,[e("label",null,[u[30]||(u[30]=T(" Save Destination ",-1)),e("button",{type:"button",class:"help-btn",onClick:u[5]||(u[5]=n=>E.value=!E.value),title:"Learn more"},[...u[29]||(u[29]=[e("i",{class:"mdi mdi-help-circle-outline"},null,-1)])])]),e("div",un,[e("label",{class:X(["radio-card",{active:_.value==="manager_only",disabled:k.value}])},[J(e("input",{type:"radio","onUpdate:modelValue":u[6]||(u[6]=n=>_.value=n),value:"manager_only",disabled:k.value},null,8,cn),[[ze,_.value]]),u[31]||(u[31]=e("i",{class:"mdi mdi-application"},null,-1)),u[32]||(u[32]=e("span",null,"Broadlink Manager",-1))],2),e("label",{class:X(["radio-card",{active:_.value==="integration_only",disabled:k.value}])},[J(e("input",{type:"radio","onUpdate:modelValue":u[7]||(u[7]=n=>_.value=n),value:"integration_only",disabled:k.value},null,8,mn),[[ze,_.value]]),u[33]||(u[33]=e("i",{class:"mdi mdi-home-assistant"},null,-1)),u[34]||(u[34]=e("span",null,"Broadlink Integration",-1))],2),e("label",{class:X(["radio-card",{active:_.value==="both",disabled:k.value}])},[J(e("input",{type:"radio","onUpdate:modelValue":u[8]||(u[8]=n=>_.value=n),value:"both",disabled:k.value},null,8,vn),[[ze,_.value]]),u[35]||(u[35]=e("i",{class:"mdi mdi-swap-horizontal"},null,-1)),u[36]||(u[36]=e("span",null,"Both",-1))],2)]),E.value?(s(),i("div",pn,[...u[37]||(u[37]=[e("h4",null,"Save Destination Options",-1),e("ul",null,[e("li",null,[e("strong",null,"Broadlink Manager (Recommended):"),T(" Commands are saved only in this app's database (devices.json). This gives you full control and makes commands portable. The Broadlink Integration won't see these commands.")]),e("li",null,[e("strong",null,"Broadlink Integration:"),T(" Commands are saved only in Home Assistant's Broadlink Integration storage. This app won't track these commands, but they'll be available to the Broadlink Integration's remote.send_command service.")]),e("li",null,[e("strong",null,"Both:"),T(" Commands are saved in both places. Use this if you want commands available in both this app and the Broadlink Integration.")])],-1)])])):x("",!0)]),e("div",fn,[e("button",{type:"submit",class:"btn btn-primary btn-large",disabled:k.value},[k.value?(s(),i("i",yn)):(s(),i("i",bn)),T(" "+f(k.value?"Learning...":"Learn Command"),1)],8,gn)]),k.value?(s(),i("div",hn,[u[41]||(u[41]=e("i",{class:"mdi mdi-loading mdi-spin"},null,-1)),o.value==="preparing"?(s(),i("div",kn,[...u[38]||(u[38]=[e("p",null,[e("strong",null,"Preparing device...")],-1),e("small",null,"Connecting and authenticating with Broadlink device (this takes a few seconds)",-1)])])):I.value==="ir"?(s(),i("div",wn,[...u[39]||(u[39]=[e("p",null,[e("strong",null,"Ready!"),T(" Point your remote at the Broadlink device and press the button...")],-1),e("small",null,"This may take up to 30 seconds",-1)])])):I.value==="rf"?(s(),i("div",$n,[...u[40]||(u[40]=[e("p",null,[e("strong",null,"Learning RF command...")],-1),e("small",null,"Check Home Assistant notifications (ğŸ””) for instructions",-1)])])):x("",!0)])):x("",!0),F.value&&N.value==="success"&&!F.value.includes("sent successfully")&&!k.value?(s(),i("div",Cn,[u[42]||(u[42]=e("i",{class:"mdi mdi-check-circle"},null,-1)),e("p",null,f(F.value),1)])):x("",!0)],32)),L.value.length>0||l.value.length>0?(s(),i("div",_n)):x("",!0),p.value?(s(),i("div",Sn,[...u[43]||(u[43]=[e("div",{class:"loading-spinner"},[e("i",{class:"mdi mdi-loading mdi-spin"}),e("p",null,"Loading commands...")],-1)])])):L.value.length>0?(s(),i("div",In,[e("div",Dn,[e("h3",null,"Tracked Commands ("+f(L.value.length)+")",1),e("button",{type:"button",onClick:u[9]||(u[9]=n=>D(!0)),class:"icon-btn refresh-btn",title:"Refresh commands",disabled:p.value},[e("i",{class:X(["mdi mdi-refresh",{"mdi-spin":p.value}])},null,2)],8,Tn)]),e("div",xn,[(s(!0),i(me,null,he(L.value,n=>(s(),i("div",{key:n.name,class:X(["command-item",{"error-state":n.hasError,"pending-state":n.isPending}])},[e("div",Rn,[e("span",Mn,f(n.label||n.name),1)]),e("div",En,[n.hasError?(s(),i("i",An)):n.isPending?(s(),i("i",Ln)):(s(),i("i",{key:2,class:"mdi mdi-check-circle learned-icon",title:`Learned (${(n.type||"ir").toUpperCase()})`},null,8,On)),e("span",{class:X(["command-type-badge",n.type||"ir"])},f((n.type||"ir").toUpperCase()),3),e("div",Pn,[e("button",{type:"button",onClick:j=>V(n.name),class:"icon-btn",title:n.hasError?"Cannot test - command failed to learn":n.isPending?"Cannot test - waiting for code":"Test command",disabled:M.value===n.name||n.hasError||n.isPending},[e("i",{class:X(["mdi mdi-play",{"mdi-spin":M.value===n.name}])},null,2)],8,Vn),e("button",{type:"button",onClick:j=>pe(n.name),class:"icon-btn danger",title:n.hasError?"Delete and re-learn":"Delete command"},[...u[44]||(u[44]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,Un)])])],2))),128))])])):x("",!0),l.value.length>0?(s(),i("div",Fn,[e("h3",null,[u[45]||(u[45]=e("i",{class:"mdi mdi-alert"},null,-1)),T(" Untracked Commands ("+f(l.value.length)+") ",1)]),u[48]||(u[48]=e("p",{class:"untracked-info"}," These commands exist in Broadlink storage but are not tracked in this device. ",-1)),e("div",jn,[(s(!0),i(me,null,he(l.value,n=>(s(),i("div",{key:n,class:"command-item untracked"},[e("span",Nn,f(n),1),e("button",{type:"button",onClick:j=>Pe(n),class:"btn-icon",title:"Import this command"},[...u[46]||(u[46]=[e("i",{class:"mdi mdi-import"},null,-1)])],8,Bn)]))),128))]),u[49]||(u[49]=e("br",null,null,-1)),e("button",{type:"button",onClick:Ae,class:"btn btn-secondary"},[...u[47]||(u[47]=[e("i",{class:"mdi mdi-import"},null,-1),T(" Import All Untracked Commands ",-1)])])])):x("",!0)]),e("div",Hn,[e("button",{type:"button",onClick:u[10]||(u[10]=n=>h.$emit("cancel")),class:"btn btn-secondary",disabled:k.value}," Close ",8,qn)])]),ge(Be,{isOpen:g.value,title:"Delete Command?",message:`Delete command '${P.value}' from Broadlink Manager?`,checkboxLabel:"Also delete from Broadlink Integration storage",confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,onConfirm:fe,onCancel:Oe},null,8,["isOpen","message"]),ge(Be,{isOpen:z.value,title:"Import Commands?",message:`Import ${l.value.length} untracked command${l.value.length>1?"s":""} into this device?`,confirmText:"Import",cancelText:"Cancel",onConfirm:ee,onCancel:u[11]||(u[11]=n=>z.value=!1)},null,8,["isOpen","message"])]))}},Jn=$e(zn,[["__scopeId","data-v-9986f7b0"]]),Wn={class:"modal-container error-dialog"},Gn={class:"modal-header"},Kn={class:"modal-body"},Xn={class:"error-message"},Yn={key:0,class:"error-suggestion"},Zn=["open"],Qn={class:"debug-content"},es={class:"debug-info"},ts={key:0,class:"debug-section-title"},os={key:1},ls={__name:"ErrorDialog",props:{isOpen:{type:Boolean,default:!1},title:{type:String,default:"Error"},message:{type:String,required:!0},suggestion:{type:String,default:""},details:{type:String,default:""},error:{type:Object,default:null},context:{type:Object,default:()=>({})}},emits:["close"],setup(t,{emit:c}){const d=t,$=c,w=Me("toast"),r=b(!1),m=()=>{$("close")},y=W(()=>{var O,F,N,L,l,p,g,P,z,G,Z;const k=new Date().toISOString(),o=d.error||{};return{error:JSON.stringify({message:d.message,title:d.title,details:d.details,errorObject:o.message||o.toString(),timestamp:k},null,2),request:JSON.stringify({method:((F=(O=o.config)==null?void 0:O.method)==null?void 0:F.toUpperCase())||"N/A",url:((N=o.config)==null?void 0:N.url)||"N/A",baseURL:((L=o.config)==null?void 0:L.baseURL)||"N/A",headers:((l=o.config)==null?void 0:l.headers)||{},data:(p=o.config)!=null&&p.data?JSON.parse(o.config.data):"N/A",params:((g=o.config)==null?void 0:g.params)||{}},null,2),response:JSON.stringify({status:((P=o.response)==null?void 0:P.status)||"N/A",statusText:((z=o.response)==null?void 0:z.statusText)||"N/A",data:((G=o.response)==null?void 0:G.data)||"N/A",headers:((Z=o.response)==null?void 0:Z.headers)||{}},null,2),browser:JSON.stringify({userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language,cookieEnabled:navigator.cookieEnabled,onLine:navigator.onLine,viewport:`${window.innerWidth}x${window.innerHeight}`,screenResolution:`${window.screen.width}x${window.screen.height}`,colorDepth:window.screen.colorDepth,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,timestamp:k},null,2),appState:JSON.stringify({currentRoute:window.location.pathname,currentURL:window.location.href,referrer:document.referrer||"N/A",context:d.context||{},localStorage:{smartir_simulate:localStorage.getItem("smartir_simulate_not_installed"),theme:localStorage.getItem("theme")}},null,2),stackTrace:o.stack||null}}),I=async()=>{const k=E();try{await navigator.clipboard.writeText(k),w==null||w.success("Debug information copied to clipboard","âœ… Copied")}catch(o){console.error("Failed to copy:",o),w==null||w.error("Failed to copy to clipboard","âŒ Copy Failed")}},_=()=>{const k=E(),o=new Blob([k],{type:"text/plain"}),O=URL.createObjectURL(o),F=document.createElement("a");F.href=O;const N=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5);F.download=`broadlink-manager-error-${N}.txt`,document.body.appendChild(F),F.click(),document.body.removeChild(F),URL.revokeObjectURL(O),w==null||w.success("Debug report downloaded","âœ… Downloaded")},E=()=>`Broadlink Manager - Error Report
${"=".repeat(60)}

Generated: ${new Date().toISOString()}
Title: ${d.title}
Message: ${d.message}
${d.suggestion?`Suggestion: ${d.suggestion}
`:""}
${"=".repeat(60)}

ERROR DETAILS
${"-".repeat(60)}
${y.value.error}

REQUEST INFORMATION
${"-".repeat(60)}
${y.value.request}

RESPONSE INFORMATION
${"-".repeat(60)}
${y.value.response}

BROWSER INFORMATION
${"-".repeat(60)}
${y.value.browser}

APPLICATION STATE
${"-".repeat(60)}
${y.value.appState}

${y.value.stackTrace?`STACK TRACE
${"-".repeat(60)}
${y.value.stackTrace}

`:""}
${"=".repeat(60)}
End of Report
`;return se(()=>d.isOpen,k=>{if(k){const o=O=>{O.key==="Escape"&&m()};return document.addEventListener("keydown",o),()=>document.removeEventListener("keydown",o)}}),(k,o)=>(s(),je(it,{to:"body"},[ge(st,{name:"modal"},{default:tt(()=>[t.isOpen?(s(),i("div",{key:0,class:"modal-overlay",onClick:ce(m,["self"])},[e("div",Wn,[e("div",Gn,[o[2]||(o[2]=e("div",{class:"header-icon error-icon"},[e("i",{class:"mdi mdi-alert-circle"})],-1)),e("h3",null,f(t.title),1),e("button",{onClick:m,class:"close-button"},[...o[1]||(o[1]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Kn,[e("p",Xn,f(t.message),1),t.suggestion?(s(),i("p",Yn,[o[3]||(o[3]=e("i",{class:"mdi mdi-lightbulb-on"},null,-1)),T(" "+f(t.suggestion),1)])):x("",!0),e("details",{class:"debug-section",open:r.value},[e("summary",{onClick:o[0]||(o[0]=O=>r.value=!r.value)},[e("i",{class:X(["mdi",r.value?"mdi-chevron-down":"mdi-chevron-right"])},null,2),o[4]||(o[4]=T(" Debug Information ",-1))]),e("div",Qn,[e("div",{class:"debug-actions"},[e("button",{onClick:I,class:"btn-debug btn-copy"},[...o[5]||(o[5]=[e("i",{class:"mdi mdi-content-copy"},null,-1),T(" Copy to Clipboard ",-1)])]),e("button",{onClick:_,class:"btn-debug btn-download"},[...o[6]||(o[6]=[e("i",{class:"mdi mdi-download"},null,-1),T(" Download Report ",-1)])])]),e("div",es,[o[7]||(o[7]=e("div",{class:"debug-section-title"},"Error Details",-1)),e("pre",null,f(y.value.error),1),o[8]||(o[8]=e("div",{class:"debug-section-title"},"Request Information",-1)),e("pre",null,f(y.value.request),1),o[9]||(o[9]=e("div",{class:"debug-section-title"},"Response Information",-1)),e("pre",null,f(y.value.response),1),o[10]||(o[10]=e("div",{class:"debug-section-title"},"Browser Information",-1)),e("pre",null,f(y.value.browser),1),o[11]||(o[11]=e("div",{class:"debug-section-title"},"Application State",-1)),e("pre",null,f(y.value.appState),1),y.value.stackTrace?(s(),i("div",ts,"Stack Trace")):x("",!0),y.value.stackTrace?(s(),i("pre",os,f(y.value.stackTrace),1)):x("",!0)])])],8,Zn)]),e("div",{class:"modal-footer"},[e("button",{onClick:m,class:"btn btn-primary"}," OK ")])])])):x("",!0)]),_:1})]))}},ns=$e(ls,[["__scopeId","data-v-23858149"]]),ss={class:"modal-dialog"},as={class:"modal-header"},is={class:"modal-body"},rs={class:"device-list"},ds={class:"device-info"},us={class:"device-details"},cs={class:"command-count"},ms={class:"device-actions"},vs=["onClick"],ps=["onClick"],fs={class:"modal-footer"},gs=["disabled"],ys={class:"modal-dialog modal-dialog-small"},bs={class:"modal-header"},hs={class:"modal-body"},ks={class:"warning-message"},ws={class:"modal-footer"},$s=["disabled"],Cs=["disabled"],_s={__name:"DeviceDiscovery",emits:["adopt"],setup(t,{expose:c,emit:d}){const $=Ge(),w=d,r=b([]),m=b(!1),y=b(!1),I=b(null),_=b(!1),E=b(!1);W(()=>r.value.length>0),xe(async()=>{await k()});const k=async()=>{try{const l=await te.get("/api/devices/discover");r.value=l.data.untracked_devices||[]}catch(l){console.error("Error loading untracked devices:",l),r.value=[]}},o=()=>{m.value=!0},O=l=>{m.value=!1,w("adopt",l)},F=async()=>{if(r.value.length===0)return;E.value=!0;const l=r.value.length;try{for(const p of r.value)await new Promise(g=>{w("adopt",p),setTimeout(g,100)});$.success(`Successfully adopted ${l} device${l>1?"s":""}!`),m.value=!1,await k()}catch(p){console.error("Error adopting all devices:",p),$.error("Failed to adopt all devices")}finally{E.value=!1}},N=l=>{I.value=l,y.value=!0},L=async()=>{if(!I.value)return;const l=I.value.device_name;_.value=!0;try{const p=await te.delete(`/api/devices/untracked/${encodeURIComponent(l)}`);if(p.data.success)r.value=r.value.filter(g=>g.device_name!==l),y.value=!1,I.value=null,r.value.length===0&&(m.value=!1),$.success(`Deleted all commands for '${l}'`);else throw new Error(p.data.error||"Failed to delete device")}catch(p){console.error("Error deleting device:",p),$.error(`Failed to delete device: ${p.message}`)}finally{_.value=!1}};return c({refresh:k,openDiscovery:o}),(l,p)=>{var g,P,z;return s(),i("div",null,[x("",!0),m.value?(s(),i("div",{key:1,class:"modal-overlay",onClick:p[2]||(p[2]=ce(G=>m.value=!1,["self"]))},[e("div",ss,[e("div",as,[p[9]||(p[9]=e("h2",null,"Discovered Devices",-1)),e("button",{onClick:p[0]||(p[0]=G=>m.value=!1),class:"close-btn"},[...p[8]||(p[8]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",is,[p[14]||(p[14]=e("p",{class:"info-text"}," These devices have learned commands in Broadlink storage but are not being tracked. Adopt them to manage their commands and generate Home Assistant entities. ",-1)),e("div",rs,[(s(!0),i(me,null,he(r.value,G=>(s(),i("div",{key:G.device_name,class:"discovered-device"},[e("div",ds,[p[11]||(p[11]=e("div",{class:"device-icon"},[e("i",{class:"mdi mdi-devices"})],-1)),e("div",us,[e("h4",null,f(G.device_name),1),e("span",cs,[p[10]||(p[10]=e("i",{class:"mdi mdi-remote"},null,-1)),T(" "+f(G.command_count)+" command"+f(G.command_count>1?"s":""),1)])])]),e("div",ms,[e("button",{onClick:Z=>O(G),class:"btn btn-primary"},[...p[12]||(p[12]=[e("i",{class:"mdi mdi-plus"},null,-1),T(" Adopt ",-1)])],8,vs),e("button",{onClick:Z=>N(G),class:"btn btn-danger",title:"Delete all commands"},[...p[13]||(p[13]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,ps)])]))),128))])]),e("div",fs,[e("button",{onClick:F,class:"btn btn-primary",disabled:E.value||r.value.length===0},[e("i",{class:X(["mdi",E.value?"mdi-loading mdi-spin":"mdi-plus-circle"])},null,2),T(" "+f(E.value?"Adopting...":"Adopt All"),1)],8,gs),e("button",{onClick:p[1]||(p[1]=G=>m.value=!1),class:"btn btn-secondary"}," Close ")])])])):x("",!0),y.value?(s(),i("div",{key:2,class:"modal-overlay",onClick:p[5]||(p[5]=ce(G=>y.value=!1,["self"]))},[e("div",ys,[e("div",bs,[p[16]||(p[16]=e("h2",null,"Delete Untracked Device",-1)),e("button",{onClick:p[3]||(p[3]=G=>y.value=!1),class:"close-btn"},[...p[15]||(p[15]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",hs,[e("div",ks,[p[18]||(p[18]=e("i",{class:"mdi mdi-alert"},null,-1)),e("div",null,[e("p",null,[e("strong",null,'Are you sure you want to delete "'+f((g=I.value)==null?void 0:g.device_name)+'"?',1)]),e("p",null,"This will permanently delete all "+f((P=I.value)==null?void 0:P.command_count)+" command"+f(((z=I.value)==null?void 0:z.command_count)>1?"s":"")+" from Broadlink storage.",1),p[17]||(p[17]=e("p",{class:"warning-text"},"This action cannot be undone.",-1))])])]),e("div",ws,[e("button",{onClick:p[4]||(p[4]=G=>y.value=!1),class:"btn btn-secondary",disabled:_.value}," Cancel ",8,$s),e("button",{onClick:L,class:"btn btn-danger",disabled:_.value},[e("i",{class:X(["mdi",_.value?"mdi-loading mdi-spin":"mdi-delete"])},null,2),T(" "+f(_.value?"Deleting...":"Delete"),1)],8,Cs)])])])):x("",!0)])}}},Ss=$e(_s,[["__scopeId","data-v-3a04622c"]]),Is={class:"device-list-card"},Ds={class:"card-header"},Ts={class:"header-badges"},xs={class:"header-info"},Rs=["title"],Ms={class:"header-right"},Es={key:0,class:"view-toggle-group header-view-toggle"},As={class:"settings-menu-container"},Ls=["disabled"],Os=["disabled"],Ps={class:"card-body"},Vs={key:0,class:"filter-bar"},Us={class:"filter-search-row"},Fs=["title"],js={key:0,class:"filter-badge"},Ns={class:"search-input-wrapper"},Bs={class:"filter-content"},Hs={class:"filter-row filter-row-dropdowns"},qs={class:"filter-group"},zs=["value"],Js={class:"filter-group"},Ws=["value"],Gs={class:"filter-group"},Ks={key:0,class:"filter-group filter-toggle"},Xs={class:"toggle-label"},Ys={class:"filter-results"},Zs={key:1,class:"loading-state"},Qs={key:2,class:"error-state"},ea={key:3,class:"empty-state"},ta={key:4,class:"device-grid"},oa={key:6,class:"no-results"},la={__name:"DeviceList",setup(t){const c=kt(),d=Ge(),{isMobile:$}=ot(),w=b(!1),r=b(!1),m=b(null),y=b(!1),I=b(!1),_=b(null),E=b(null),k=b(!0),o=b(!1),O=b(!1),F=b(0),L=b(window.innerWidth<=767?"grid":localStorage.getItem("device_view_mode")||"grid");se($,A=>{A&&L.value==="list"&&(L.value="grid")}),se(L,A=>{localStorage.setItem("device_view_mode",A)});const l=()=>{k.value=!k.value,k.value||(I.value=!1)},p=()=>{k.value||(k.value=!0),I.value=!I.value},g=b(!1),P=b({title:"Error",message:"",suggestion:"",details:"",error:null,context:{}}),z=b(!1),G=b({success:!1,title:"",message:""}),Z=b(!1),H=b({search:"",broadlinkDevice:"",area:"",entityType:"",showSmartIROnly:!1}),M=b([]),U=Me("smartirStatus"),oe=Me("smartirEnabled"),ie=W(()=>{var S;return localStorage.getItem("smartir_simulate_not_installed")==="true"?!1:((S=U==null?void 0:U.value)==null?void 0:S.installed)||!1}),ye=W(()=>{const A=new Map;return c.devices.forEach(S=>{if(S.broadlink_entity){const B=M.value.find(ne=>ne.entity_id===S.broadlink_entity),q=B&&B.name||S.broadlink_entity;A.set(S.broadlink_entity,{entity_id:S.broadlink_entity,friendly_name:q})}}),Array.from(A.values()).sort((S,B)=>S.friendly_name.localeCompare(B.friendly_name))}),Ee=W(()=>{const A=new Set;return c.devices.forEach(S=>{S.area&&A.add(S.area)}),Array.from(A).sort()}),Te=W(()=>{let A=c.devices;if(H.value.search){const B=H.value.search.toLowerCase();A=A.filter(q=>{var be,de,Se,Ue,Ne;if((be=q.name)!=null&&be.toLowerCase().includes(B)||(de=q.entity_type)!=null&&de.toLowerCase().includes(B)||(Se=q.area)!=null&&Se.toLowerCase().includes(B)||(Ue=q.id)!=null&&Ue.toLowerCase().includes(B)||Object.keys(q.commands||{}).some(Fe=>Fe.toLowerCase().includes(B)))return!0;const ke=M.value.find(Fe=>Fe.entity_id===q.broadlink_entity);return!!((Ne=ke==null?void 0:ke.name)!=null&&Ne.toLowerCase().includes(B))})}H.value.broadlinkDevice&&(A=A.filter(B=>B.broadlink_entity===H.value.broadlinkDevice||B.controller_device===H.value.broadlinkDevice)),H.value.area&&(A=A.filter(B=>B.area===H.value.area)),H.value.entityType&&(A=A.filter(B=>B.entity_type===H.value.entityType)),H.value.showSmartIROnly&&(A=A.filter(B=>B.device_type==="smartir"));const S=localStorage.getItem("smartir_simulate_not_installed")==="true";return(!(oe!=null&&oe.value)||S)&&(A=A.filter(B=>B.device_type!=="smartir")),A}),De=W(()=>H.value.search||H.value.broadlinkDevice||H.value.area||H.value.entityType||H.value.showSmartIROnly),D=W(()=>{let A=0;return H.value.search&&A++,H.value.broadlinkDevice&&A++,H.value.area&&A++,H.value.entityType&&A++,H.value.showSmartIROnly&&A++,A}),v=A=>{A.target.closest(".settings-container")||(I.value=!1)};xe(()=>{document.addEventListener("click",v)}),We(()=>{document.removeEventListener("click",v)});const V=()=>{H.value.search="",H.value.broadlinkDevice="",H.value.area="",H.value.entityType="",H.value.showSmartIROnly=!1},pe=()=>{E.value&&E.value.openDiscovery()},Oe=async()=>{try{const A=await te.get("/api/remote/devices");M.value=A.data.devices||[]}catch(A){console.error("Error loading remote devices:",A)}};se(L,A=>{localStorage.setItem("device_view_mode",A)});const fe=async()=>{var A;try{const S=await te.get("/api/devices/discover");F.value=((A=S.data.untracked_devices)==null?void 0:A.length)||0}catch(S){console.error("Error loading untracked count:",S),F.value=0}};xe(async()=>{await Promise.all([c.loadDevices(),Oe(),fe()])});const ue=A=>{m.value=A,w.value=!0},Ae=W(()=>{if(!_.value)return"";const A=Object.keys(_.value.commands||{}).length;return A===0?"This device has no commands. The device will be removed from tracking.":`This device has ${A} learned command${A>1?"s":""}. What would you like to do?`}),Pe=W(()=>{if(!_.value)return"";const A=Object.keys(_.value.commands||{}).length;return A===0?"":`Also delete all ${A} command${A>1?"s":""} from Broadlink storage`}),ee=A=>{_.value=A,y.value=!0},h=()=>{y.value=!1,_.value=null},u=async A=>{var B,q;const S=_.value;y.value=!1;try{await c.deleteDevice(S.id,A),E.value&&await E.value.refresh()}catch(ne){const ke=((q=(B=ne.response)==null?void 0:B.data)==null?void 0:q.error)||ne.message||"Unknown error";R("Failed to Delete Device",ke)}finally{_.value=null}},n=async A=>{var S,B,q,ne,ke;try{console.log("ğŸ’¾ Saving device data:",A),console.log("ğŸ’¾ Device commands:",A.commands),console.log("ğŸ’¾ Selected device:",m.value),(S=m.value)!=null&&S.id&&m.value.id!==null?await c.updateDevice(m.value.id,A):await c.createDevice(A),j(),E.value&&await E.value.refresh()}catch(be){let de="Failed to save device",Se="",Ue="";(q=(B=be.response)==null?void 0:B.data)!=null&&q.error?(de=be.response.data.error,Se=be.response.data.suggestion||""):be.message&&(de=be.message),be.response&&(Ue=`Status: ${be.response.status}
URL: ${((ne=be.config)==null?void 0:ne.url)||"N/A"}`),R("Failed to Save Device",de,Se,Ue,be,{action:"save_device",deviceData:A,isEdit:!!((ke=m.value)!=null&&ke.id)})}},j=()=>{w.value=!1,m.value=null},C=A=>{m.value=A,r.value=!0},a=()=>{r.value=!1,m.value=null},R=(A,S,B="",q="",ne=null,ke={})=>{P.value={title:A,message:S,suggestion:B,details:q,error:ne,context:ke},g.value=!0},K=()=>{g.value=!1},le=()=>{z.value=!1},re=async A=>{var S;if(console.log("ğŸŸ¢ [PARENT] Received learned event:",A),!A||!A.deviceId){console.warn("âš ï¸ [PARENT] Missing required data in learned event");return}if(console.log("ğŸŸ¢ [PARENT] Current selectedDevice commands:",Object.keys(((S=m.value)==null?void 0:S.commands)||{}).length),console.log("ğŸŸ¢ [PARENT] Current store device count:",c.devices.length),console.log("ğŸŸ¢ [PARENT] Force reloading all devices from API with cache bust..."),await c.loadDevices(!0),console.log("ğŸŸ¢ [PARENT] After reload - store device count:",c.devices.length),m.value){console.log("ğŸŸ¢ [PARENT] Looking for device:",A.deviceId);const B=c.devices.find(q=>q.id===A.deviceId);B?(console.log("ğŸŸ¢ [PARENT] Found fresh device with",Object.keys(B.commands||{}).length,"commands"),m.value={...B},console.log("ğŸŸ¢ [PARENT] âœ… Updated selectedDevice - now has",Object.keys(m.value.commands||{}).length,"commands")):console.error("ğŸŸ¢ [PARENT] âŒ Device not found in store after reload!")}E.value&&(console.log("ğŸŸ¢ [PARENT] Refreshing discovery..."),E.value.refresh()),console.log("ğŸŸ¢ [PARENT] âœ… handleCommandLearned complete!")},Q=A=>{const S=A.split("_"),B=[];for(let q=0;q<S.length;q++){const ne=S[q],ke=S[q+1];ne&&ke==="s"&&S[q+2]?(B.push(ne.charAt(0).toUpperCase()+ne.slice(1)+"'s"),q++):ne!=="s"&&B.push(ne.charAt(0).toUpperCase()+ne.slice(1))}return B.join(" ")},Re=(A,S)=>{const B=A.toLowerCase(),q=S.map(de=>de.toLowerCase());return B.includes("lamp")||B.includes("light")?"light":B.includes("fan")?"fan":B.includes("tv")||B.includes("stereo")||B.includes("speaker")||B.includes("receiver")?"media_player":B.includes("blind")||B.includes("curtain")||B.includes("shade")||B.includes("garage")?"cover":q.some(de=>de.includes("volume")||de.includes("channel")||de.includes("play")||de.includes("pause")||de.includes("mute"))?"media_player":q.some(de=>de.includes("fan_speed")||de.includes("fan_low")||de.includes("fan_high"))?"fan":q.some(de=>de.includes("open")||de.includes("close")||de.includes("stop"))?"cover":"switch"},Y=(A,S)=>{const B=A.toLowerCase();return B.includes("tv")?"mdi:television":B.includes("stereo")||B.includes("receiver")||B.includes("speaker")?"mdi:speaker":B.includes("lamp")?"mdi:lamp":B.includes("light")?"mdi:lightbulb":B.includes("fan")?"mdi:fan":B.includes("blind")?"mdi:blinds":B.includes("curtain")?"mdi:curtains":B.includes("garage")?"mdi:garage":{light:"mdi:lightbulb",fan:"mdi:fan",switch:"mdi:light-switch",media_player:"mdi:speaker",cover:"mdi:window-shutter"}[S]||"mdi:devices"},we=A=>{const S=A.toLowerCase().split("_");for(let ne=0;ne<S.length-2;ne++)if(S[ne+1]==="s"){const ke=S.slice(ne,ne+3),be=Q(ke.join("_"));return console.log("Detected possessive area:",be,"from",A),be}const B=[["living","room"],["dining","room"],["master","bedroom"],["guest","bedroom"],["family","room"],["laundry","room"],["home","office"]];for(let ne=0;ne<S.length-1;ne++){const ke=[S[ne],S[ne+1]],be=B.find(de=>de[0]===ke[0]&&de[1]===ke[1]);if(be)return Q(be.join("_"))}const q=["kitchen","bedroom","bathroom","garage","office","basement","attic","hallway","entryway","patio","deck","yard","garden"];for(const ne of S)if(q.includes(ne))return ne.charAt(0).toUpperCase()+ne.slice(1);return""},ae=async A=>{var S,B;try{const q=Q(A.device_name),ne=we(A.device_name),ke=Re(A.device_name,A.commands),be=Y(A.device_name,ke);let de="";try{console.log("Finding Broadlink owner for:",A.device_name);const Fe=await te.post("/api/devices/find-broadlink-owner",{device_name:A.device_name});console.log("Broadlink owner response:",Fe.data),de=Fe.data.broadlink_entity||"",console.log("Detected Broadlink entity:",de)}catch(Fe){console.error("Error finding Broadlink owner:",Fe)}console.log("Fetching command data from Broadlink storage...");const Ue=(await te.get(`/api/commands/broadlink/${A.device_name}`)).data.commands||{};console.log("Fetched command data:",Ue);const Ne={};for(const[Fe,et]of Object.entries(Ue)){const mt=typeof et=="string"&&et.length>200;Ne[Fe]={data:et,type:mt?"rf":"ir",name:Fe,learned_at:new Date().toISOString()}}console.log("Transformed commands:",Ne),m.value={id:null,device:A.device_name,name:q,entity_type:ke,commands:Ne,area:ne,icon:be,broadlink_entity:de,enabled:!0},w.value=!0,d.success(`Imported ${Object.keys(Ne).length} commands from Broadlink storage`),await fe()}catch(q){console.error("Error adopting device:",q),d.error("Failed to adopt device: "+(((B=(S=q.response)==null?void 0:S.data)==null?void 0:B.error)||q.message))}},Ce=async()=>{O.value=!0;try{await c.syncAllAreas(),d.success("Areas synced from Home Assistant")}catch(A){console.error("Error syncing areas:",A),d.error("Failed to sync areas")}finally{O.value=!1}},Ve=async()=>{var A,S;o.value=!0;try{const B=await te.post("/api/entities/generate",{});if(B.data.success){const q=B.data.broadlink_count||0,ne=B.data.smartir_count||0,ke=B.data.total_count||0,be=B.data.errors||[];let de="âœ… Entity Generation Successful",Se=[];const Ue=[];q>0&&Ue.push(`${q} Broadlink native`),ne>0&&Ue.push(`${ne} SmartIR`),Ue.length>0&&Se.push(`Generated ${Ue.join(" and ")} entity configuration${ke!==1?"s":""}.`),q>0&&(Se.push(`
ğŸ“ Broadlink entities created in:`),Se.push("  â€¢ broadlink_manager/entities.yaml"),Se.push("  â€¢ broadlink_manager/helpers.yaml")),ne>0&&(Se.push(`
ğŸ“ SmartIR entities created in:`),Se.push("  â€¢ smartir/climate.yaml"),Se.push("  â€¢ smartir/media_player.yaml"),Se.push("  â€¢ smartir/fan.yaml")),Se.push(`
ğŸ“ Next steps:`),Se.push("1. Check your configuration.yaml includes the generated files"),Se.push("2. Restart Home Assistant to load the new entities"),be.length>0&&(de="âš ï¸ Entity Generation Completed with Errors",Se.push(`
âš ï¸ ${be.length} error${be.length!==1?"s":""} occurred:`),be.forEach(Ne=>{Se.push(`  â€¢ ${Ne}`)})),G.value={success:!0,title:de,message:Se.join(`
`)},z.value=!0}else G.value={success:!1,title:"âŒ Entity Generation Failed",message:B.data.message||`Failed to generate entities.

Please check that you have at least one device configured.`},z.value=!0}catch(B){console.error("Error generating entities:",B);const q=((S=(A=B.response)==null?void 0:A.data)==null?void 0:S.error)||B.message||"Unknown error occurred";G.value={success:!1,title:"âŒ Entity Generation Error",message:`Failed to generate entities:

${q}

Please check the logs for more details.`},z.value=!0}finally{o.value=!1}},qe=async({device:A,command:S})=>{var B,q;try{const ne={device_id:A.id,command:S,device:A.device||A.id,entity_id:A.broadlink_entity||A.controller_device};await te.post("/api/commands/test",ne),d.success(`Sent ${S} to ${A.name}`)}catch(ne){console.error("Error sending command:",ne);const ke=((q=(B=ne.response)==null?void 0:B.data)==null?void 0:q.error)||ne.message||"Unknown error";d.error(`Failed to send ${S}: ${ke}`)}};return(A,S)=>{var B;return s(),i("div",Is,[e("div",Ds,[e("button",{class:"icon-button chevron-button",onClick:l},[e("i",{class:X(["mdi",k.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2)]),e("div",{class:"header-left",onClick:l},[S[15]||(S[15]=e("div",{class:"header-icon"},[e("i",{class:"mdi mdi-devices"})],-1)),e("h3",null,f(_e($)?"Devices":"Managed Devices"),1),e("div",Ts,[e("span",xs,f(_e(c).deviceCount)+" devices",1),F.value>0?(s(),i("span",{key:0,class:"header-info untracked-badge",title:`${F.value} device${F.value>1?"s":""} with learned commands found in Broadlink storage. Use the settings menu (âš™ï¸) to view and adopt them.`},f(F.value)+" untracked ",9,Rs)):x("",!0)])]),e("div",Ms,[_e($)?x("",!0):(s(),i("div",Es,[e("button",{onClick:S[0]||(S[0]=ce(q=>L.value="grid",["stop"])),class:X(["view-toggle-btn",{active:L.value==="grid"}]),title:"Grid View"},[...S[16]||(S[16]=[e("i",{class:"mdi mdi-view-grid"},null,-1)])],2),e("button",{onClick:S[1]||(S[1]=ce(q=>L.value="list",["stop"])),class:X(["view-toggle-btn",{active:L.value==="list"}]),title:"List View"},[...S[17]||(S[17]=[e("i",{class:"mdi mdi-view-list"},null,-1)])],2)])),e("button",{onClick:S[2]||(S[2]=ce(q=>w.value=!0,["stop"])),class:"btn btn-primary new-button"},[...S[18]||(S[18]=[e("i",{class:"mdi mdi-plus"},null,-1),e("span",null,"New",-1)])]),e("div",As,[e("button",{onClick:ce(p,["stop"]),class:X(["icon-button settings-button",{active:I.value}]),title:"Settings"},[...S[19]||(S[19]=[e("i",{class:"mdi mdi-cog"},null,-1)])],2),I.value?(s(),i("div",{key:0,class:"settings-dropdown",onClick:S[6]||(S[6]=ce(()=>{},["stop"]))},[e("button",{onClick:S[3]||(S[3]=q=>{pe(),I.value=!1}),class:"menu-item"},[...S[20]||(S[20]=[e("i",{class:"mdi mdi-radar"},null,-1),e("span",null,"Untracked Devices",-1)])]),e("button",{onClick:S[4]||(S[4]=q=>{Ce(),I.value=!1}),class:"menu-item",disabled:O.value},[e("i",{class:X(["mdi",O.value?"mdi-loading mdi-spin":"mdi-refresh"])},null,2),e("span",null,f(O.value?"Syncing Areas...":"Sync Areas"),1)],8,Ls),e("button",{onClick:S[5]||(S[5]=q=>{Ve(),I.value=!1}),class:"menu-item",disabled:o.value},[e("i",{class:X(["mdi",o.value?"mdi-loading mdi-spin":"mdi-file-code"])},null,2),e("span",null,f(o.value?"Generating...":"Generate Entities"),1)],8,Os)])):x("",!0)])])]),J(e("div",Ps,[ge(Ss,{ref_key:"discoveryRef",ref:E,onAdopt:ae},null,512),_e(c).hasDevices?(s(),i("div",Vs,[e("div",Us,[e("button",{class:X(["filter-toggle-button",{active:Z.value||De.value}]),onClick:S[7]||(S[7]=q=>Z.value=!Z.value),title:Z.value?"Hide filters":"Show filters"},[S[21]||(S[21]=e("i",{class:"mdi mdi-filter-variant"},null,-1)),De.value?(s(),i("span",js,f(D.value),1)):x("",!0)],10,Fs),e("div",Ns,[S[22]||(S[22]=e("i",{class:"mdi mdi-magnify search-icon"},null,-1)),J(e("input",{"onUpdate:modelValue":S[8]||(S[8]=q=>H.value.search=q),type:"text",placeholder:"Search devices, commands...",class:"search-input"},null,512),[[Le,H.value.search]])])]),J(e("div",Bs,[e("div",Hs,[e("div",qs,[e("label",null,[S[24]||(S[24]=e("i",{class:"mdi mdi-access-point"},null,-1)),J(e("select",{"onUpdate:modelValue":S[9]||(S[9]=q=>H.value.broadlinkDevice=q)},[S[23]||(S[23]=e("option",{value:""},"All Controller Devices",-1)),(s(!0),i(me,null,he(ye.value,q=>(s(),i("option",{key:q.entity_id,value:q.entity_id},f(q.friendly_name),9,zs))),128))],512),[[Ie,H.value.broadlinkDevice]])])]),e("div",Js,[e("label",null,[S[26]||(S[26]=e("i",{class:"mdi mdi-home-map-marker"},null,-1)),J(e("select",{"onUpdate:modelValue":S[10]||(S[10]=q=>H.value.area=q)},[S[25]||(S[25]=e("option",{value:""},"All Areas",-1)),(s(!0),i(me,null,he(Ee.value,q=>(s(),i("option",{key:q,value:q},f(q),9,Ws))),128))],512),[[Ie,H.value.area]])])]),e("div",Gs,[e("label",null,[S[28]||(S[28]=e("i",{class:"mdi mdi-shape"},null,-1)),J(e("select",{"onUpdate:modelValue":S[11]||(S[11]=q=>H.value.entityType=q)},[...S[27]||(S[27]=[He('<option value="" data-v-f2f60df3>All Types</option><option value="light" data-v-f2f60df3>Light</option><option value="fan" data-v-f2f60df3>Fan</option><option value="switch" data-v-f2f60df3>Switch</option><option value="media_player" data-v-f2f60df3>Media Player</option><option value="cover" data-v-f2f60df3>Cover</option><option value="climate" data-v-f2f60df3>Climate</option>',7)])],512),[[Ie,H.value.entityType]])])]),ie.value?(s(),i("div",Ks,[e("label",Xs,[S[29]||(S[29]=e("span",{class:"toggle-text"},[e("img",{src:Qe,alt:"SmartIR",class:"smartir-icon"}),T(" SmartIR Only ")],-1)),J(e("input",{type:"checkbox","onUpdate:modelValue":S[12]||(S[12]=q=>H.value.showSmartIROnly=q),class:"toggle-checkbox"},null,512),[[ve,H.value.showSmartIROnly]]),S[30]||(S[30]=e("span",{class:"toggle-slider"},null,-1))])])):x("",!0),De.value?(s(),i("button",{key:1,onClick:V,class:"btn-clear-filters"},[...S[31]||(S[31]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),T(" Clear ",-1)])])):x("",!0),e("div",Ys,f(Te.value.length)+" of "+f(_e(c).deviceCount),1)])],512),[[Ye,Z.value]])])):x("",!0),_e(c).loading?(s(),i("div",Zs,[...S[32]||(S[32]=[e("i",{class:"mdi mdi-loading mdi-spin"},null,-1),e("p",null,"Loading devices...",-1)])])):_e(c).error?(s(),i("div",Qs,[S[33]||(S[33]=e("i",{class:"mdi mdi-alert-circle"},null,-1)),e("p",null,f(_e(c).error),1),e("button",{onClick:S[13]||(S[13]=q=>_e(c).loadDevices()),class:"btn btn-secondary"}," Retry ")])):_e(c).hasDevices?x("",!0):(s(),i("div",ea,[S[35]||(S[35]=e("i",{class:"mdi mdi-devices"},null,-1)),S[36]||(S[36]=e("h3",null,"No Devices Yet",-1)),S[37]||(S[37]=e("p",null,"Get started by adding your first managed device",-1)),e("button",{onClick:S[14]||(S[14]=q=>w.value=!0),class:"btn btn-primary"},[...S[34]||(S[34]=[e("i",{class:"mdi mdi-plus"},null,-1),T(" Add Your First Device ",-1)])])])),L.value==="grid"?(s(),i("div",ta,[(s(!0),i(me,null,he(Te.value,q=>(s(),je(Bt,{key:q.id,device:q,"broadlink-devices":M.value,onEdit:ue,onDelete:ee,onLearn:C},null,8,["device","broadlink-devices"]))),128))])):L.value==="list"&&Te.value.length>0?(s(),je(uo,{key:5,devices:Te.value,onSendCommand:qe,onOpenCommands:C,onEditDevice:ue,onDeleteDevice:ee},null,8,["devices"])):x("",!0),_e(c).hasDevices&&Te.value.length===0?(s(),i("div",oa,[...S[38]||(S[38]=[e("i",{class:"mdi mdi-filter-off"},null,-1),e("h3",null,"No devices match your filters",-1),e("p",null,"Try adjusting your search or filter criteria",-1)])])):x("",!0)],512),[[Ye,k.value]]),w.value?(s(),je(Ul,{key:0,device:m.value,onSave:n,onCancel:j},null,8,["device"])):x("",!0),r.value?(s(),je(Jn,{key:1,device:m.value,onLearned:re,onCancel:a},null,8,["device"])):x("",!0),ge(Be,{isOpen:y.value,title:`Delete ${(B=_.value)==null?void 0:B.name}?`,message:Ae.value,confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,checkboxLabel:Pe.value,onConfirm:u,onCancel:h},null,8,["isOpen","title","message","checkboxLabel"]),ge(ns,{isOpen:g.value,title:P.value.title,message:P.value.message,suggestion:P.value.suggestion,details:P.value.details,error:P.value.error,context:P.value.context,onClose:K},null,8,["isOpen","title","message","suggestion","details","error","context"]),ge(Be,{isOpen:z.value,title:G.value.title,message:G.value.message,confirmText:"OK",showCancel:!1,dangerMode:!G.value.success,onConfirm:le,onCancel:le},null,8,["isOpen","title","message","dangerMode"])])}}},na=$e(la,[["__scopeId","data-v-f2f60df3"]]),sa={class:"banner-content"},aa={class:"banner-icon"},ia={class:"banner-message"},ra={class:"banner-actions"},da={__name:"SmartIRBanner",setup(t){const c=Me("smartirStatus"),d=b(!1),$=W(()=>!(!c.value||d.value||localStorage.getItem("smartir_banner_dismissed")==="true")),w=W(()=>{var E;return(E=c.value)!=null&&E.installed?"banner-success":"banner-info"}),r=W(()=>{var E;return(E=c.value)!=null&&E.installed?"mdi mdi-check-circle":"mdi mdi-information"}),m=W(()=>{var E;return(E=c.value)!=null&&E.installed?`SmartIR Detected (v${c.value.version})`:"Want Climate Device Support?"}),y=W(()=>{var E;return(E=c.value)!=null&&E.installed?"You can now create climate device profiles with full temperature and HVAC mode control.":"Install SmartIR to unlock AC/heater control with temperature settings, HVAC modes, and 120+ pre-configured device profiles."});function I(){window.open("https://github.com/smartHomeHub/SmartIR","_blank")}function _(){var E;if(d.value=!0,(E=c.value)!=null&&E.installed)localStorage.setItem("smartir_banner_dismissed","true");else{const k=parseInt(localStorage.getItem("smartir_banner_dismiss_count")||"0");k>=2?localStorage.setItem("smartir_banner_dismissed","true"):localStorage.setItem("smartir_banner_dismiss_count",String(k+1))}}return xe(()=>{var o;const E=localStorage.getItem("smartir_last_status"),k=(o=c.value)!=null&&o.installed?"installed":"not_installed";E!==k&&(localStorage.removeItem("smartir_banner_dismissed"),localStorage.removeItem("smartir_banner_dismiss_count"),localStorage.setItem("smartir_last_status",k))}),(E,k)=>{var o,O;return $.value?(s(),i("div",{key:0,class:X(["smartir-banner",w.value])},[e("div",sa,[e("div",aa,[e("i",{class:X(r.value)},null,2)]),e("div",ia,[e("strong",null,f(m.value),1),e("p",null,f(y.value),1)]),e("div",ra,[(o=E.status)!=null&&o.installed?x("",!0):(s(),i("button",{key:0,onClick:I,class:"btn-primary"}," Learn More ")),e("button",{onClick:_,class:"btn-text"},f((O=E.status)!=null&&O.installed?"Got it":"Dismiss"),1)])])],2)):x("",!0)}}},ua=$e(da,[["__scopeId","data-v-7bbcbcd7"]]),Je="api/smartir",ut={async getStatus(){try{const t=await fetch(`${Je}/status`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return await t.json()}catch(t){return console.error("Error fetching SmartIR status:",t),{installed:!1,version:null,error:t.message}}},async getInstallInstructions(){try{const t=await fetch(`${Je}/install-instructions`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return await t.json()}catch(t){throw console.error("Error fetching install instructions:",t),t}},async getPlatforms(){try{const t=await fetch(`${Je}/platforms`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return await t.json()}catch(t){throw console.error("Error fetching platforms:",t),t}},async getPlatformCodes(t){try{const c=await fetch(`${Je}/platforms/${t}/codes`);if(!c.ok)throw new Error(`HTTP error! status: ${c.status}`);return await c.json()}catch(c){throw console.error(`Error fetching codes for ${t}:`,c),c}},async getNextCode(t){try{const c=await fetch(`${Je}/platforms/${t}/next-code`);if(!c.ok)throw new Error(`HTTP error! status: ${c.status}`);return await c.json()}catch(c){throw console.error(`Error fetching next code for ${t}:`,c),c}},async validateCode(t,c){try{const d=await fetch(`${Je}/validate-code`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({platform:t,code:c})});if(!d.ok)throw new Error(`HTTP error! status: ${d.status}`);return await d.json()}catch(d){throw console.error("Error validating code:",d),d}}},ca={class:"profile-card"},ma={class:"profile-card-header"},va=["title"],pa={class:"profile-details"},fa=["title"],ga={class:"profile-meta"},ya=["title"],ba=["title"],ha=["title"],ka={class:"profile-card-footer"},wa=["title"],$a={key:0,class:"learned-indicator"},Ca={class:"profile-actions"},_a={__name:"SmartIRProfileCard",props:{profile:{type:Object,required:!0}},emits:["edit","download","delete","commands"],setup(t){const c=t,d=rt(W(()=>c.profile.platform)),$=m=>m.replace(/_/g," ").replace(/\b\w/g,y=>y.toUpperCase()),w=m=>m&&m.startsWith("mdi:")?`mdi ${m.replace(":"," mdi-")}`:`mdi mdi-${m}`,r=m=>{if(!m)return"";const y=m.toLowerCase();return y.includes("broadlink")?"broadlink-tag":y.includes("not set")?"not-set-tag":"default-controller-tag"};return(m,y)=>(s(),i("div",ca,[e("div",ma,[e("div",{class:X(["profile-icon",_e(d).colorClass.value]),title:$(t.profile.platform)},[e("i",{class:X(w(_e(d).icon.value))},null,2)],10,va),e("div",pa,[e("h4",{title:`${t.profile.manufacturer} ${t.profile.model}`},f(t.profile.manufacturer)+" "+f(t.profile.model),9,fa),e("div",ga,[e("span",{class:"tag platform-tag",title:$(t.profile.platform)},f($(t.profile.platform)),9,ya),t.profile.controllerBrand?(s(),i("span",{key:0,class:X(["tag controller-tag",r(t.profile.controllerBrand)]),title:"Controller: "+t.profile.controllerBrand},[y[4]||(y[4]=e("i",{class:"mdi mdi-remote-tv"},null,-1)),T(" "+f(t.profile.controllerBrand),1)],10,ba)):x("",!0)])]),e("div",{class:"code-badge",title:"Device Code: "+t.profile.code},f(t.profile.code),9,ha)]),e("div",ka,[e("div",{class:"profile-stats",title:t.profile.commandCount+" total commands"+(t.profile.learnedCount>0?", "+t.profile.learnedCount+" learned":"")},[y[5]||(y[5]=e("i",{class:"mdi mdi-remote"},null,-1)),e("span",null,f(t.profile.commandCount)+" command"+f(t.profile.commandCount!==1?"s":""),1),t.profile.learnedCount>0?(s(),i("span",$a,"( "+f(t.profile.learnedCount)+" learned )",1)):x("",!0)],8,wa),e("div",Ca,[e("button",{onClick:y[0]||(y[0]=I=>m.$emit("commands")),class:"action-btn",title:"Commands"},[...y[6]||(y[6]=[e("i",{class:"mdi mdi-remote"},null,-1)])]),e("button",{onClick:y[1]||(y[1]=I=>m.$emit("edit")),class:"action-btn",title:"Edit Profile"},[...y[7]||(y[7]=[e("i",{class:"mdi mdi-pencil"},null,-1)])]),e("button",{onClick:y[2]||(y[2]=I=>m.$emit("download")),class:"action-btn",title:"Download JSON"},[...y[8]||(y[8]=[e("i",{class:"mdi mdi-download"},null,-1)])]),e("button",{onClick:y[3]||(y[3]=I=>m.$emit("delete")),class:"action-btn delete",title:"Delete Profile"},[...y[9]||(y[9]=[e("i",{class:"mdi mdi-delete"},null,-1)])])])])]))}},Sa=$e(_a,[["__scopeId","data-v-aad9720f"]]),Ia={name:"SmartIRProfileListView",props:{profiles:{type:Array,required:!0}},methods:{getPlatformIcon(t){return{climate:"mdi-thermostat",media_player:"mdi-television",fan:"mdi-fan",light:"mdi-lightbulb"}[t]||"mdi-devices"},formatPlatform(t){return{climate:"Climate",media_player:"Media Player",fan:"Fan",light:"Light"}[t]||t},editProfile(t){this.$emit("edit",t)},viewCommands(t){this.$emit("commands",t)},downloadProfile(t){this.$emit("download",t)},deleteProfile(t){this.$emit("delete",t)}}},Da={class:"profile-list-view"},Ta={class:"profile-table"},xa={class:"profile-code"},Ra={class:"code-badge"},Ma={class:"profile-manufacturer"},Ea={class:"profile-model"},Aa={class:"model-info"},La={class:"model-name"},Oa={key:0,class:"model-count"},Pa={class:"profile-platform"},Va={class:"profile-controller"},Ua={class:"profile-commands"},Fa={class:"command-stats"},ja={class:"stat-item"},Na={key:0,class:"stat-item learned"},Ba={class:"profile-actions"},Ha=["onClick"],qa=["onClick"],za=["onClick"],Ja=["onClick"];function Wa(t,c,d,$,w,r){return s(),i("div",Da,[e("table",Ta,[c[6]||(c[6]=e("thead",null,[e("tr",null,[e("th",null,"Code"),e("th",null,"Manufacturer"),e("th",null,"Model"),e("th",null,"Platform"),e("th",null,"Controller"),e("th",null,"Commands"),e("th",null,"Actions")])],-1)),e("tbody",null,[(s(!0),i(me,null,he(d.profiles,m=>(s(),i("tr",{key:`${m.platform}-${m.code}`,class:"profile-row"},[e("td",xa,[e("span",Ra,f(m.code),1)]),e("td",Ma,f(m.manufacturer||"Unknown"),1),e("td",Ea,[e("div",Aa,[e("div",La,f(m.model||"Unknown"),1),m.models&&m.models.length>1?(s(),i("div",Oa," +"+f(m.models.length-1)+" more ",1)):x("",!0)])]),e("td",Pa,[e("span",{class:X(["platform-badge",m.platform])},[e("i",{class:X(["mdi",r.getPlatformIcon(m.platform)])},null,2),T(" "+f(r.formatPlatform(m.platform)),1)],2)]),e("td",Va,f(m.controller_brand||"N/A"),1),e("td",Ua,[e("div",Fa,[e("span",ja,[c[0]||(c[0]=e("i",{class:"mdi mdi-remote"},null,-1)),T(" "+f(m.command_count||0),1)]),m.learned_count>0?(s(),i("span",Na,[c[1]||(c[1]=e("i",{class:"mdi mdi-school"},null,-1)),T(" "+f(m.learned_count),1)])):x("",!0)])]),e("td",Ba,[e("button",{class:"action-btn edit",onClick:y=>r.editProfile(m),title:"Edit Profile"},[...c[2]||(c[2]=[e("i",{class:"mdi mdi-pencil"},null,-1)])],8,Ha),e("button",{class:"action-btn commands",onClick:y=>r.viewCommands(m),title:"View Commands"},[...c[3]||(c[3]=[e("i",{class:"mdi mdi-remote"},null,-1)])],8,qa),e("button",{class:"action-btn download",onClick:y=>r.downloadProfile(m),title:"Download"},[...c[4]||(c[4]=[e("i",{class:"mdi mdi-download"},null,-1)])],8,za),e("button",{class:"action-btn delete",onClick:y=>r.deleteProfile(m),title:"Delete"},[...c[5]||(c[5]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,Ja)])]))),128))])])])}const Ga=$e(Ia,[["render",Wa],["__scopeId","data-v-d3773038"]]),Ka={class:"modal-container"},Xa={class:"modal-body"},Ya={key:0,class:"selection-section"},Za={class:"form-group"},Qa={class:"form-group"},ei={class:"form-group"},ti={key:0,class:"code-info"},oi={class:"form-actions"},li=["disabled"],ni={key:1,class:"testing-section"},si={class:"code-header"},ai={class:"code-details"},ii={class:"code-badge"},ri={class:"device-selector"},di=["value"],ui={key:0,class:"helper-text"},ci={class:"commands-section"},mi={class:"commands-header"},vi={key:0,class:"tested-count"},pi={key:0,class:"filters-section"},fi={class:"filter-row"},gi={class:"filter-row"},yi={key:1,class:"empty-state"},bi={key:2,class:"empty-state"},hi={key:3,class:"commands-list"},ki={class:"command-name"},wi={class:"command-actions"},$i={key:0,class:"status-badge success"},Ci=["onClick","disabled","title"],_i={__name:"SmartIRCodeTester",props:{isOpen:{type:Boolean,default:!1}},emits:["close","clone"],setup(t,{emit:c}){const d=t,$=c,w=Me("toast"),r=b("climate"),m=b(""),y=b([]),I=b(!1),_=b(null),E=b(""),k=b([]),o=b(!1),O=W(()=>k.value.map(ee=>({code:ee.code,label:`${ee.models.join(", ")} (Code: ${ee.code})`,value:ee.code}))),F=b(null),N=b(null),L=b(!1),l=b([]),p=b(""),g=b([]),P=b(new Set),z=b(null),G=b(""),Z=b(""),H=b(""),M=b(""),U=W(()=>{let ee=g.value;if(G.value){const h=G.value.toLowerCase();ee=ee.filter(u=>(u.label||u.name).toLowerCase().includes(h))}return Z.value&&(ee=ee.filter(h=>h.mode===Z.value)),H.value&&(ee=ee.filter(h=>h.fanSpeed===H.value)),M.value&&(ee=ee.filter(h=>h.swingMode===M.value)),ee}),oe=W(()=>G.value||Z.value||H.value||M.value);se(()=>d.isOpen,ee=>{ee&&(ie(),Ee())}),se(r,()=>{d.isOpen&&(m.value="",_.value=null,k.value=[],ie())});async function ie(){var ee;I.value=!0;try{const h=await te.get("/api/smartir/codes/manufacturers",{params:{entity_type:r.value}});y.value=h.data.manufacturers||[]}catch(h){console.error("Error loading manufacturers:",h),(ee=w.value)==null||ee.error("Failed to load manufacturers","âŒ Error")}finally{I.value=!1}}async function ye(){var ee;if(m.value){o.value=!0;try{const h=await te.get("/api/smartir/codes/models",{params:{entity_type:r.value,manufacturer:m.value}});k.value=h.data.models||[]}catch(h){console.error("Error loading models:",h),(ee=w.value)==null||ee.error("Failed to load models","âŒ Error")}finally{o.value=!1}}}async function Ee(){try{const ee=await te.get("/api/remote/devices");l.value=ee.data.devices||[]}catch(ee){console.error("Error loading Broadlink devices:",ee)}}async function Te(){var ee,h;if(_.value){L.value=!0;try{const u=await te.get("/api/smartir/codes/code",{params:{entity_type:r.value,code_id:_.value.code}});N.value=u.data.code,F.value=_.value.code,De(u.data.code),(ee=w.value)==null||ee.success(`Loaded ${g.value.length} commands`,"âœ… Code Loaded")}catch(u){console.error("Error loading code:",u),(h=w.value)==null||h.error(u.message||"Failed to load code","âŒ Error")}finally{L.value=!1}}}function De(ee){const h=[];if(!ee.commands){g.value=h;return}if(r.value==="climate"){const n=ee.commands;for(const[j,C]of Object.entries(n)){if(j==="off"){typeof C=="string"&&h.push({name:"off",label:"OFF",data:C,mode:"off"});continue}if(typeof C=="object"){for(const[a,R]of Object.entries(C))if(typeof R=="object")for(const[K,le]of Object.entries(R)){if(typeof le!="object")continue;const re=Object.keys(le),Q=re.includes("24")?"24":re[0];if(Q&&typeof le[Q]=="string"){const Re=`${j}_${Q}_${a}_${K}`,Y=`${j.toUpperCase()} ${Q}Â°C ${a} ${K}`;h.push({name:Re,label:Y,data:le[Q],mode:j,temperature:Q,fanSpeed:a,swingMode:K})}}}}}else for(const[n,j]of Object.entries(ee.commands))typeof j=="string"&&h.push({name:n,label:n.toUpperCase().replace(/_/g," "),data:j});g.value=h}async function D(ee){var h,u,n;if(!p.value){(h=w.value)==null||h.warning("Please select a Broadlink device first","âš ï¸ No Device");return}z.value=ee;try{const j=g.value.find(C=>C.name===ee);if(!j||!j.data)throw new Error(`Command "${ee}" not found`);await te.post("/api/commands/send-raw",{entity_id:p.value,command:j.data,command_type:"ir"}),P.value.add(ee),(u=w.value)==null||u.success(`Command sent: ${j.label||ee}`,"âœ… Tested")}catch(j){console.error("Error testing command:",j),(n=w.value)==null||n.error("Failed to test command","âŒ Error")}finally{z.value=null}}function v(){var ee,h,u,n;if(!N.value){(ee=w.value)==null||ee.error("No profile data to download","âŒ Error");return}try{const j=N.value.manufacturer||"unknown",C=((h=N.value.supportedModels)==null?void 0:h[0])||F.value,a=`${j.toLowerCase().replace(/\s+/g,"_")}_${C.toLowerCase().replace(/\s+/g,"_")}.json`,R=JSON.stringify(N.value,null,2),K=new Blob([R],{type:"application/json"}),le=URL.createObjectURL(K),re=document.createElement("a");re.href=le,re.download=a,document.body.appendChild(re),re.click(),document.body.removeChild(re),URL.revokeObjectURL(le),(u=w.value)==null||u.success(`Downloaded ${a}`,"âœ… Download Complete")}catch(j){console.error("Error downloading JSON:",j),(n=w.value)==null||n.error(j.message||"Failed to download JSON","âŒ Download Error")}}function V(){m.value="",_.value=null,E.value="",k.value=[]}function pe(){_.value=null,E.value="",ye()}function Oe(){E.value?_.value=k.value.find(ee=>ee.code===E.value):_.value=null}function fe(){G.value="",Z.value="",H.value="",M.value=""}function ue(){F.value=null,N.value=null,g.value=[],P.value.clear(),z.value=null,fe()}function Ae(ee){const h=ee.toLowerCase();return h.includes("power")||h.includes("off")||h==="off"?"mdi-power":h.includes("cool")?"mdi-snowflake":h.includes("heat")?"mdi-fire":h.includes("fan")?"mdi-fan":h.includes("auto")?"mdi-auto-fix":h.includes("dry")?"mdi-water-percent":h.includes("temp")?"mdi-thermometer":h.includes("swing")?"mdi-swap-vertical":"mdi-remote"}function Pe(){ue(),m.value="",_.value=null,$("close")}return(ee,h)=>{var u;return t.isOpen?(s(),i("div",{key:0,class:"modal-overlay",onClick:ce(Pe,["self"])},[e("div",Ka,[e("div",{class:"modal-header"},[h[9]||(h[9]=e("h3",null,[e("i",{class:"mdi mdi-test-tube"}),T(" Test SmartIR Code ")],-1)),e("button",{onClick:Pe,class:"close-btn"},[...h[8]||(h[8]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Xa,[F.value?(s(),i("div",ni,[e("div",si,[e("div",ai,[e("h4",null,f(N.value.manufacturer)+" - "+f(((u=N.value.supportedModels)==null?void 0:u[0])||"Unknown"),1),e("span",ii,"Code: "+f(F.value),1)]),e("button",{onClick:ue,class:"btn-secondary-small"},[...h[14]||(h[14]=[e("i",{class:"mdi mdi-arrow-left"},null,-1),T(" Change Code ",-1)])])]),e("div",ri,[h[17]||(h[17]=e("label",null,[e("i",{class:"mdi mdi-remote"}),T(" Broadlink Device ")],-1)),J(e("select",{"onUpdate:modelValue":h[3]||(h[3]=n=>p.value=n),class:"form-select"},[h[15]||(h[15]=e("option",{value:""},"Select device to test with...",-1)),(s(!0),i(me,null,he(l.value,n=>(s(),i("option",{key:n.entity_id,value:n.entity_id},f(n.friendly_name||n.entity_id),9,di))),128))],512),[[Ie,p.value]]),p.value?x("",!0):(s(),i("p",ui,[...h[16]||(h[16]=[e("i",{class:"mdi mdi-information-outline"},null,-1),T(" Select a Broadlink device to enable command testing ",-1)])]))]),e("div",ci,[e("div",mi,[e("h5",null,"Sample Commands ("+f(U.value.length)+" / "+f(g.value.length)+")",1),P.value.size>0?(s(),i("span",vi,f(P.value.size)+" tested ",1)):x("",!0)]),r.value==="climate"&&g.value.length>0?(s(),i("div",pi,[e("div",fi,[J(e("input",{"onUpdate:modelValue":h[4]||(h[4]=n=>G.value=n),type:"text",placeholder:"Search commands...",class:"search-input"},null,512),[[Le,G.value]])]),e("div",gi,[J(e("select",{"onUpdate:modelValue":h[5]||(h[5]=n=>Z.value=n),class:"filter-select"},[...h[18]||(h[18]=[e("option",{value:""},"All Modes",-1),e("option",{value:"cool"},"Cool",-1),e("option",{value:"heat"},"Heat",-1),e("option",{value:"off"},"Off",-1)])],512),[[Ie,Z.value]]),J(e("select",{"onUpdate:modelValue":h[6]||(h[6]=n=>H.value=n),class:"filter-select"},[...h[19]||(h[19]=[He('<option value="" data-v-66569200>All Fan Speeds</option><option value="low" data-v-66569200>Low</option><option value="mid" data-v-66569200>Mid</option><option value="high" data-v-66569200>High</option><option value="auto" data-v-66569200>Auto</option>',5)])],512),[[Ie,H.value]]),J(e("select",{"onUpdate:modelValue":h[7]||(h[7]=n=>M.value=n),class:"filter-select"},[...h[20]||(h[20]=[e("option",{value:""},"All Swing",-1),e("option",{value:"stop"},"Stop",-1),e("option",{value:"swing"},"Swing",-1)])],512),[[Ie,M.value]]),oe.value?(s(),i("button",{key:0,onClick:fe,class:"btn-clear-filters"},[...h[21]||(h[21]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),T(" Clear ",-1)])])):x("",!0)])])):x("",!0),g.value.length===0?(s(),i("div",yi,[...h[22]||(h[22]=[e("i",{class:"mdi mdi-alert-circle"},null,-1),e("p",null,"No commands found in this code",-1)])])):U.value.length===0?(s(),i("div",bi,[h[23]||(h[23]=e("i",{class:"mdi mdi-filter-off"},null,-1)),h[24]||(h[24]=e("p",null,"No commands match your filters",-1)),e("button",{onClick:fe,class:"btn-secondary-small"}," Clear Filters ")])):(s(),i("div",hi,[(s(!0),i(me,null,he(U.value,n=>(s(),i("div",{key:n.name,class:X(["command-item",{tested:P.value.has(n.name),testing:z.value===n.name}])},[e("div",ki,[e("i",{class:X(["mdi",Ae(n.mode||n.name)])},null,2),e("span",null,f(n.label||n.name),1)]),e("div",wi,[P.value.has(n.name)?(s(),i("span",$i,[...h[25]||(h[25]=[e("i",{class:"mdi mdi-check"},null,-1),T(" Tested ",-1)])])):x("",!0),e("button",{onClick:j=>D(n.name),disabled:!p.value||z.value===n.name,title:p.value?"Test this command":"Select a Broadlink device first",class:"btn-test"},[e("i",{class:X(["mdi",z.value===n.name?"mdi-loading mdi-spin":"mdi-play"])},null,2),h[26]||(h[26]=T(" Test ",-1))],8,Ci)])],2))),128))]))]),e("div",{class:"modal-actions"},[e("button",{onClick:v,class:"btn-primary"},[...h[27]||(h[27]=[e("i",{class:"mdi mdi-download"},null,-1),T(" Download JSON ",-1)])]),e("button",{onClick:Pe,class:"btn-secondary"}," Close ")])])):(s(),i("div",Ya,[h[13]||(h[13]=e("div",{class:"info-banner"},[e("i",{class:"mdi mdi-information"}),e("p",null,"Select a SmartIR code from the index to test commands with your Broadlink device.")],-1)),e("div",Za,[h[11]||(h[11]=e("label",null,[e("i",{class:"mdi mdi-shape"}),T(" Platform ")],-1)),J(e("select",{"onUpdate:modelValue":h[0]||(h[0]=n=>r.value=n),onChange:V,class:"form-select"},[...h[10]||(h[10]=[e("option",{value:"climate"},"Climate (AC/Heater)",-1),e("option",{value:"media_player"},"Media Player (TV/Audio)",-1),e("option",{value:"fan"},"Fan",-1),e("option",{value:"light"},"Light",-1)])],544),[[Ie,r.value]])]),e("div",Qa,[ge(Ze,{modelValue:m.value,"onUpdate:modelValue":h[1]||(h[1]=n=>m.value=n),options:y.value,label:"Manufacturer",placeholder:"Search manufacturers...",loading:I.value,disabled:I.value,onChange:pe},null,8,["modelValue","options","loading","disabled"])]),e("div",ei,[ge(Ze,{modelValue:E.value,"onUpdate:modelValue":h[2]||(h[2]=n=>E.value=n),options:O.value,"option-label":"label","option-value":"code",label:"Model",placeholder:"Search models...",loading:o.value,disabled:!m.value||o.value,onChange:Oe},null,8,["modelValue","options","loading","disabled"])]),_.value?(s(),i("div",ti,[h[12]||(h[12]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[e("strong",null,f(m.value)+" - "+f(_.value.models[0]),1),e("p",null,"Code: "+f(_.value.code),1)])])):x("",!0),e("div",oi,[e("button",{onClick:Te,disabled:!_.value||L.value,class:"btn-primary"},[e("i",{class:X(["mdi",L.value?"mdi-loading mdi-spin":"mdi-download"])},null,2),T(" "+f(L.value?"Loading...":"Load Commands"),1)],8,li)])]))])])])):x("",!0)}}},Si=$e(_i,[["__scopeId","data-v-66569200"]]),Ii={class:"smartir-status-card"},Di={class:"card-header"},Ti=["src"],xi={class:"header-badges"},Ri=["title"],Mi={class:"header-info"},Ei={class:"header-info"},Ai={class:"header-info"},Li={class:"header-right"},Oi={key:0,class:"view-toggle-group header-view-toggle"},Pi={key:2,class:"settings-menu-container"},Vi={key:0,class:"card-body loading-state"},Ui={key:1,class:"card-body error-state"},Fi={key:2,class:"card-body installed-state"},ji={key:0,class:"help-panel"},Ni={key:0,class:"recommendation"},Bi={key:0,class:"next-steps"},Hi={class:"help-actions"},qi={key:1,class:"filter-bar"},zi={class:"filter-search-row"},Ji=["title"],Wi={key:0,class:"filter-badge"},Gi={class:"search-input-wrapper"},Ki={class:"filter-content"},Xi={class:"filter-row"},Yi={class:"filter-group"},Zi={class:"filter-results"},Qi={key:2,class:"loading-state"},er={key:3,class:"empty-state"},tr={key:4,class:"profiles-grid"},or={key:6,class:"no-results"},lr={key:3,class:"card-body not-installed-state"},nr={class:"benefits-section"},sr={class:"benefits-list"},ar={class:"recommendation"},ir={__name:"SmartIRStatusCard",emits:["create-profile","edit-profile"],setup(t,{expose:c,emit:d}){const $=d,w=Me("smartirStatus");Me("smartirEnabled");const r=Me("refreshSmartIR"),{isMobile:m}=ot(),y=b(!1),I=b(null),_=b((w==null?void 0:w.value)||null),E=b(localStorage.getItem("smartir_simulate_not_installed")==="true"),k=b(!1),o=b(!1),O=b(!0),F=b([]),N=b(!1),L=b(!1),l=b({search:"",platform:""}),p=b({show:!1,title:"",message:"",platform:null,profile:null}),g=b(!1),z=b(window.innerWidth<=767?"grid":localStorage.getItem("profile_view_mode")||"grid");se(m,u=>{u&&z.value==="list"&&(z.value="grid")}),se(z,u=>{localStorage.setItem("profile_view_mode",u)}),se(O,u=>{u||(o.value=!1)});const G=["Full climate entity support (AC, heaters)","120+ pre-configured device profiles","Temperature and humidity sensor integration","HVAC mode control (heat, cool, auto, dry, fan)"],Z=["climate","media_player","fan","light"],H=W(()=>E.value?{installed:!1,recommendation:{message:"Install SmartIR to unlock climate device support!",benefits:["Full climate entity support (AC, heaters)","120+ pre-configured device profiles","Temperature and humidity sensor integration","HVAC mode control (heat, cool, auto, dry, fan)"]}}:_.value),M=W(()=>{var u,n;return((n=(u=H.value)==null?void 0:u.platforms)==null?void 0:n.length)||0}),U=W(()=>{var u;return(u=H.value)!=null&&u.device_counts?Object.values(H.value.device_counts).reduce((n,j)=>n+j,0):0});function oe(){var u;E.value=!E.value,localStorage.setItem("smartir_simulate_not_installed",E.value.toString()),!E.value&&((u=_.value)!=null&&u.installed)&&fe()}const ie=W(()=>{let u=F.value;if(l.value.search){const n=l.value.search.toLowerCase();u=u.filter(j=>{var C,a,R,K;return((C=j.manufacturer)==null?void 0:C.toLowerCase().includes(n))||((a=j.model)==null?void 0:a.toLowerCase().includes(n))||((R=j.code)==null?void 0:R.toString().includes(n))||((K=j.platform)==null?void 0:K.toLowerCase().includes(n))})}return l.value.platform&&(u=u.filter(n=>n.platform===l.value.platform)),u}),ye=W(()=>l.value.search||l.value.platform),Ee=W(()=>{let u=0;return l.value.search&&u++,l.value.platform&&u++,u});function Te(){l.value.search="",l.value.platform=""}async function De(){y.value=!0,I.value=null;try{if(r)await r();else{const u=await ut.getStatus();_.value=u}}catch(u){I.value=u.message||"Failed to refresh SmartIR status",console.error("Error refreshing SmartIR status:",u)}finally{y.value=!1}}function D(){$("create-profile")}function v(){k.value=!k.value,o.value=!1}function V(){O.value||(O.value=!0),o.value=!o.value}function pe(){g.value=!0,o.value=!1}function Oe(){window.open("https://github.com/smartHomeHub/SmartIR","_blank")}async function fe(){N.value=!0;const u=[];try{for(const n of Z)try{const C=((await te.get(`/api/smartir/platforms/${n}/profiles`)).data.profiles||[]).map(a=>({...a,platform:n}));u.push(...C)}catch(j){console.warn(`Network error loading ${n} profiles (using bundled index):`,j.message)}F.value=u}catch(n){console.error("Unexpected error loading profiles:",n)}finally{N.value=!1}}function ue(u,n,j){$("edit-profile",{platform:u,profile:n,startStep:j})}async function Ae(u,n){var j,C;try{const R=(await te.get(`/api/smartir/platforms/${u}/profiles/${n.code}`)).data,K=JSON.stringify(R.profile,null,2),le=new Blob([K],{type:"application/json"}),re=URL.createObjectURL(le),Q=document.createElement("a");Q.href=re,Q.download=`smartir_${u}_${n.manufacturer}_${n.model}_${n.code}.json`,document.body.appendChild(Q),Q.click(),document.body.removeChild(Q),URL.revokeObjectURL(re),(j=Me("toast").value)==null||j.success(`Downloaded ${n.manufacturer} ${n.model}`,"âœ… Profile Downloaded")}catch(a){console.error("Error downloading profile:",a),(C=Me("toast").value)==null||C.error("Failed to download profile","âŒ Download Error")}}const Pe=u=>{u.target.closest(".settings-container")||(o.value=!1)};xe(()=>{document.addEventListener("click",Pe)}),We(()=>{document.removeEventListener("click",Pe)});async function ee(u,n){Me("toast");try{const C=(await te.post(`/api/smartir/profiles/${n.code}/check-usage`,{platform:u})).data;if(C&&C.in_use){p.value={show:!0,title:`Cannot Delete ${n.manufacturer} ${n.model}`,message:`This profile is currently in use by ${C.device_count} device(s):

${C.devices.join(`
`)}

Please remove or reassign these devices before deleting the profile.`,platform:u,profile:n,canDelete:!1,devices:C.devices};return}}catch(j){console.error("Error checking profile usage:",j)}p.value={show:!0,title:`Delete ${n.manufacturer} ${n.model}?`,message:`Device Code: ${n.code}

This will remove the profile and update your configuration.`,platform:u,profile:n,canDelete:!0}}async function h(){var C,a;const u=Me("toast"),{platform:n,profile:j}=p.value;p.value.show=!1;try{await te.delete(`/api/smartir/profiles/${j.code}`,{data:{platform:n}}),await fe(),await at(),await De(),(C=u.value)==null||C.success(`${j.manufacturer} ${j.model} has been removed`,"âœ… Profile Deleted")}catch(R){console.error("Error deleting profile:",R),(a=u.value)==null||a.error("Failed to delete profile","âŒ Delete Error")}}return se(w,u=>{u&&(_.value=u)},{immediate:!0}),se(z,u=>{localStorage.setItem("profile_view_mode",u)}),xe(async()=>{var u;w!=null&&w.value&&(_.value=w.value),_.value||await De(),(u=_.value)!=null&&u.installed&&await fe()}),c({loadAllProfiles:fe,refreshStatus:De}),(u,n)=>{var j,C,a,R,K,le,re,Q,Re;return s(),i("div",Ii,[e("div",Di,[e("button",{class:"icon-button chevron-button",onClick:n[0]||(n[0]=Y=>O.value=!O.value)},[e("i",{class:X(["mdi",O.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2)]),e("div",{class:"header-left",onClick:n[1]||(n[1]=Y=>O.value=!O.value)},[e("img",{src:_e(Qe),alt:"SmartIR",class:"smartir-logo"},null,8,Ti),e("h3",null,f(_e(m)?"SmartIR":"SmartIR Integration"),1),e("div",xi,[e("div",{class:X(["simulation-toggle-pill",{active:E.value}]),onClick:ce(oe,["stop"]),title:E.value?"Click to show as installed":"Click to simulate not-installed"},[e("i",{class:X(["mdi",E.value?"mdi-eye-off":"mdi-eye"])},null,2),e("span",null,f(E.value?"Simulating: Not Installed":"Simulation Mode"),1)],10,Ri),(j=H.value)!=null&&j.installed?(s(),i(me,{key:0},[n[16]||(n[16]=e("div",{class:"status-badge-mini success"},[e("i",{class:"mdi mdi-check-circle"}),e("span",null,"Installed")],-1)),e("span",Mi,"v"+f(H.value.version||"Unknown"),1),e("span",Ei,f(M.value)+" platform"+f(M.value!==1?"s":""),1),e("span",Ai,f(U.value)+" device"+f(U.value!==1?"s":""),1)],64)):x("",!0)])]),e("div",Li,[!_e(m)&&((C=H.value)!=null&&C.installed)?(s(),i("div",Oi,[e("button",{onClick:n[2]||(n[2]=ce(Y=>z.value="grid",["stop"])),class:X(["view-toggle-btn",{active:z.value==="grid"}]),title:"Grid View"},[...n[17]||(n[17]=[e("i",{class:"mdi mdi-view-grid"},null,-1)])],2),e("button",{onClick:n[3]||(n[3]=ce(Y=>z.value="list",["stop"])),class:X(["view-toggle-btn",{active:z.value==="list"}]),title:"List View"},[...n[18]||(n[18]=[e("i",{class:"mdi mdi-view-list"},null,-1)])],2)])):x("",!0),(a=H.value)!=null&&a.installed?(s(),i("button",{key:1,onClick:ce(D,["stop"]),class:"btn btn-primary new-button"},[...n[19]||(n[19]=[e("i",{class:"mdi mdi-plus"},null,-1),e("span",null,"New",-1)])])):x("",!0),(R=H.value)!=null&&R.installed?(s(),i("div",Pi,[e("button",{onClick:ce(V,["stop"]),class:X(["icon-button settings-button",{active:o.value}]),title:"Settings"},[...n[20]||(n[20]=[e("i",{class:"mdi mdi-cog"},null,-1)])],2),o.value?(s(),i("div",{key:0,class:"settings-dropdown",onClick:n[5]||(n[5]=ce(()=>{},["stop"]))},[e("button",{onClick:v,class:"menu-item"},[n[21]||(n[21]=e("i",{class:"mdi mdi-help-circle"},null,-1)),e("span",null,f(k.value?"Hide Help":"Show Help"),1)]),e("button",{onClick:n[4]||(n[4]=Y=>{o.value=!1,De()}),class:"menu-item"},[...n[22]||(n[22]=[e("i",{class:"mdi mdi-refresh"},null,-1),e("span",null,"Refresh Status",-1)])]),e("button",{onClick:pe,class:"menu-item"},[...n[23]||(n[23]=[e("i",{class:"mdi mdi-test-tube"},null,-1),e("span",null,"Test Codes",-1)])])])):x("",!0)])):x("",!0)])]),J(e("div",null,[y.value?(s(),i("div",Vi,[...n[24]||(n[24]=[e("div",{class:"spinner"},null,-1),e("p",null,"Checking SmartIR installation...",-1)])])):I.value?(s(),i("div",Ui,[n[25]||(n[25]=e("i",{class:"mdi mdi-alert-circle"},null,-1)),e("p",null,f(I.value),1),e("button",{onClick:De,class:"btn-secondary"}," Try Again ")])):(K=H.value)!=null&&K.installed?(s(),i("div",Fi,[k.value?(s(),i("div",ji,[_.value.recommendation?(s(),i("div",Ni,[e("p",null,f(_.value.recommendation.message),1),_.value.recommendation.next_steps?(s(),i("div",Bi,[n[26]||(n[26]=e("strong",null,"Next Steps:",-1)),e("ul",null,[(s(!0),i(me,null,he(_.value.recommendation.next_steps,(Y,we)=>(s(),i("li",{key:we},f(Y),1))),128))])])):x("",!0)])):x("",!0),e("div",Hi,[e("button",{onClick:n[6]||(n[6]=(...Y)=>u.viewDocumentation&&u.viewDocumentation(...Y)),class:"btn-secondary"},[...n[27]||(n[27]=[e("i",{class:"mdi mdi-book-open-variant"},null,-1),T(" View Documentation ",-1)])])])])):x("",!0),F.value.length>0&&!E.value?(s(),i("div",qi,[e("div",zi,[e("button",{class:X(["filter-toggle-button",{active:L.value||ye.value}]),onClick:n[7]||(n[7]=Y=>L.value=!L.value),title:L.value?"Hide filters":"Show filters"},[n[28]||(n[28]=e("i",{class:"mdi mdi-filter-variant"},null,-1)),ye.value?(s(),i("span",Wi,f(Ee.value),1)):x("",!0)],10,Ji),e("div",Gi,[n[29]||(n[29]=e("i",{class:"mdi mdi-magnify search-icon"},null,-1)),J(e("input",{"onUpdate:modelValue":n[8]||(n[8]=Y=>l.value.search=Y),type:"text",placeholder:"Search profiles...",class:"search-input"},null,512),[[Le,l.value.search]])])]),J(e("div",Ki,[e("div",Xi,[e("div",Yi,[e("label",null,[n[31]||(n[31]=e("i",{class:"mdi mdi-shape"},null,-1)),J(e("select",{"onUpdate:modelValue":n[9]||(n[9]=Y=>l.value.platform=Y)},[...n[30]||(n[30]=[He('<option value="" data-v-b48342da>All Platforms</option><option value="climate" data-v-b48342da>Climate</option><option value="media_player" data-v-b48342da>Media Player</option><option value="fan" data-v-b48342da>Fan</option><option value="light" data-v-b48342da>Light</option>',5)])],512),[[Ie,l.value.platform]])])]),ye.value?(s(),i("button",{key:0,onClick:Te,class:"btn-clear-filters"},[...n[32]||(n[32]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),T(" Clear ",-1)])])):x("",!0),e("div",Zi,f(ie.value.length)+" of "+f(F.value.length),1)])],512),[[Ye,L.value]])])):x("",!0),N.value?(s(),i("div",Qi,[...n[33]||(n[33]=[e("i",{class:"mdi mdi-loading mdi-spin"},null,-1),e("p",null,"Loading profiles...",-1)])])):F.value.length===0?(s(),i("div",er,[...n[34]||(n[34]=[e("i",{class:"mdi mdi-file-document-outline"},null,-1),e("h3",null,"No Profiles Yet",-1),e("p",null,"Create your first SmartIR profile to get started",-1)])])):x("",!0),z.value==="grid"&&!E.value?(s(),i("div",tr,[(s(!0),i(me,null,he(ie.value,Y=>(s(),je(Sa,{key:`${Y.platform}-${Y.code}`,profile:Y,onEdit:we=>ue(Y.platform,Y),onCommands:we=>ue(Y.platform,Y,2),onDownload:we=>Ae(Y.platform,Y),onDelete:we=>ee(Y.platform,Y)},null,8,["profile","onEdit","onCommands","onDownload","onDelete"]))),128))])):z.value==="list"&&!E.value&&ie.value.length>0?(s(),je(Ga,{key:5,profiles:ie.value,onEdit:n[10]||(n[10]=Y=>ue(Y.platform,Y)),onCommands:n[11]||(n[11]=Y=>ue(Y.platform,Y,2)),onDownload:n[12]||(n[12]=Y=>Ae(Y.platform,Y)),onDelete:n[13]||(n[13]=Y=>ee(Y.platform,Y))},null,8,["profiles"])):x("",!0),F.value.length>0&&ie.value.length===0&&!E.value?(s(),i("div",or,[...n[35]||(n[35]=[e("i",{class:"mdi mdi-filter-off"},null,-1),e("h3",null,"No profiles match your filters",-1),e("p",null,"Try adjusting your search or filter criteria",-1)])])):x("",!0)])):(s(),i("div",lr,[n[39]||(n[39]=e("div",{class:"status-badge warning"},[e("i",{class:"mdi mdi-information"}),e("span",null,"Not Installed")],-1)),e("div",nr,[n[37]||(n[37]=e("h4",null,"Why Install SmartIR?",-1)),e("ul",sr,[(s(!0),i(me,null,he(((re=(le=_.value)==null?void 0:le.recommendation)==null?void 0:re.benefits)||G,(Y,we)=>(s(),i("li",{key:we},[n[36]||(n[36]=e("i",{class:"mdi mdi-check"},null,-1)),e("span",null,f(Y),1)]))),128))])]),e("div",ar,[e("p",null,f(((Re=(Q=_.value)==null?void 0:Q.recommendation)==null?void 0:Re.message)||"Install SmartIR to unlock climate device support!"),1)]),e("div",{class:"card-actions"},[e("button",{onClick:Oe,class:"btn-primary"},[...n[38]||(n[38]=[e("i",{class:"mdi mdi-github"},null,-1),T(" Install SmartIR ",-1)])])])]))],512),[[Ye,O.value]]),ge(Be,{isOpen:p.value.show,title:p.value.title,message:p.value.message,confirmText:p.value.canDelete===!1?null:"Delete",cancelText:"Close",dangerMode:!0,confirmDisabled:p.value.canDelete===!1,onConfirm:h,onCancel:n[14]||(n[14]=Y=>p.value.show=!1)},null,8,["isOpen","title","message","confirmText","confirmDisabled"]),ge(Si,{isOpen:g.value,onClose:n[15]||(n[15]=Y=>g.value=!1)},null,8,["isOpen"])])}}},rr=$e(ir,[["__scopeId","data-v-b48342da"]]),dr={class:"climate-form"},ur={class:"learning-mode-section"},cr={class:"mode-toggle"},mr={class:"mode-content"},vr={class:"mode-stats"},pr={class:"stat-badge"},fr={class:"stat-badge time"},gr={class:"mode-content"},yr={class:"mode-stats"},br={class:"stat-badge"},hr={class:"stat-badge time warning"},kr={key:0,class:"command-breakdown"},wr={class:"warning-text"},$r={class:"form-section"},Cr={key:0,class:"help-text"},_r={key:1,class:"help-text"},Sr={class:"form-row"},Ir={class:"form-group"},Dr={class:"form-group"},Tr={class:"form-group"},xr={key:2,class:"representative-temp-section"},Rr={class:"form-group"},Mr=["value"],Er={class:"form-section"},Ar={class:"checkbox-grid"},Lr={class:"checkbox-item"},Or={class:"checkbox-item"},Pr={class:"checkbox-item"},Vr={class:"checkbox-item"},Ur={class:"checkbox-item"},Fr={class:"checkbox-item"},jr={class:"form-section"},Nr={class:"checkbox-grid"},Br={class:"checkbox-item"},Hr={class:"checkbox-item"},qr={class:"checkbox-item"},zr={class:"checkbox-item"},Jr={class:"form-section"},Wr={class:"checkbox-grid"},Gr={class:"checkbox-item"},Kr={class:"checkbox-item"},Xr={class:"checkbox-item"},Yr={class:"checkbox-item"},Zr={class:"form-section"},Qr={class:"form-group"},ed={class:"form-group"},td={class:"form-group"},od={key:0,class:"validation-summary"},ld={__name:"ClimateProfileForm",props:{modelValue:{type:Object,default:()=>({})}},emits:["update:modelValue"],setup(t,{emit:c}){const d=t,$=c,w=b("quick"),r=b({minTemp:16,maxTemp:30,precision:1,representativeTemp:24,modes:["off","auto","cool","heat"],fanModes:["auto","low","medium","high"],swingModes:[],tempSensor:"",humiditySensor:"",powerSensor:"",learningMode:"quick",...d.modelValue}),m=W(()=>{const L=[],l=r.value.minTemp||16,p=r.value.maxTemp||30,g=r.value.precision||1;for(let P=l;P<=p;P+=g)L.push(P);return L}),y=W(()=>r.value.modes.filter(L=>L!=="off").length),I=W(()=>r.value.fanModes.length||1),_=W(()=>r.value.swingModes.length||1),E=W(()=>{const L=r.value.minTemp||16,l=r.value.maxTemp||30,p=r.value.precision||1;return Math.floor((l-L)/p)+1}),k=W(()=>{const L=r.value.modes.includes("off")?1:0;return y.value*I.value*_.value+L}),o=W(()=>Math.ceil(k.value*30/60)),O=W(()=>{const L=r.value.modes.includes("off")?1:0;return y.value*E.value*I.value*_.value+L}),F=W(()=>Math.ceil(O.value*30/60)),N=W(()=>{const L=[];return(!r.value.minTemp||r.value.minTemp<10||r.value.minTemp>35)&&L.push("Minimum temperature must be between 10Â°C and 35Â°C"),(!r.value.maxTemp||r.value.maxTemp<10||r.value.maxTemp>35)&&L.push("Maximum temperature must be between 10Â°C and 35Â°C"),r.value.minTemp>=r.value.maxTemp&&L.push("Minimum temperature must be less than maximum temperature"),(!r.value.modes||r.value.modes.length===0)&&L.push("At least one HVAC mode must be selected"),L});return se(w,L=>{r.value.learningMode=L}),se(r,L=>{$("update:modelValue",L)},{deep:!0,immediate:!0}),(L,l)=>(s(),i("div",dr,[l[63]||(l[63]=e("h3",null,"Climate Device Configuration",-1)),e("div",ur,[e("div",cr,[e("label",{class:X(["mode-option",{active:w.value==="quick"}])},[J(e("input",{type:"radio",value:"quick","onUpdate:modelValue":l[0]||(l[0]=p=>w.value=p)},null,512),[[ze,w.value]]),e("div",mr,[l[23]||(l[23]=e("div",{class:"mode-header"},[e("i",{class:"mdi mdi-flash"}),e("strong",null,"Quick Mode (Recommended)")],-1)),l[24]||(l[24]=e("p",null,"Learn one temperature per mode combination",-1)),e("div",vr,[e("span",pr,f(k.value)+" commands",1),e("span",fr,"~"+f(o.value)+" min",1)])])],2),e("label",{class:X(["mode-option",{active:w.value==="complete"}])},[J(e("input",{type:"radio",value:"complete","onUpdate:modelValue":l[1]||(l[1]=p=>w.value=p)},null,512),[[ze,w.value]]),e("div",gr,[l[25]||(l[25]=e("div",{class:"mode-header"},[e("i",{class:"mdi mdi-check-all"}),e("strong",null,"Complete Mode")],-1)),l[26]||(l[26]=e("p",null,"Learn all temperature combinations",-1)),e("div",yr,[e("span",br,f(O.value)+" commands",1),e("span",hr,"~"+f(F.value)+" min",1)])])],2)]),w.value==="complete"?(s(),i("div",kr,[l[27]||(l[27]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[e("strong",null,"Complete mode will require learning "+f(O.value)+" commands",1),e("p",null,"This includes all combinations of modes ("+f(y.value)+"), temperatures ("+f(E.value)+"), fan speeds ("+f(I.value)+"), and swing modes ("+f(_.value)+").",1),e("p",wr,"â±ï¸ Estimated time: "+f(F.value)+" minutes at ~30 seconds per command",1)])])):x("",!0)]),e("div",$r,[l[33]||(l[33]=e("h4",null,"Temperature Range",-1)),w.value==="quick"?(s(),i("p",Cr," Define the full temperature range your device supports. You'll select one temperature to learn below. ")):(s(),i("p",_r," Define the temperature range. All temperatures in this range will be learned. ")),e("div",Sr,[e("div",Ir,[l[28]||(l[28]=e("label",null,"Minimum Temperature (Â°C) *",-1)),J(e("input",{"onUpdate:modelValue":l[2]||(l[2]=p=>r.value.minTemp=p),type:"number",min:"10",max:"35",placeholder:"16"},null,512),[[Le,r.value.minTemp,void 0,{number:!0}]])]),e("div",Dr,[l[29]||(l[29]=e("label",null,"Maximum Temperature (Â°C) *",-1)),J(e("input",{"onUpdate:modelValue":l[3]||(l[3]=p=>r.value.maxTemp=p),type:"number",min:"10",max:"35",placeholder:"30"},null,512),[[Le,r.value.maxTemp,void 0,{number:!0}]])]),e("div",Tr,[l[31]||(l[31]=e("label",null,"Precision",-1)),J(e("select",{"onUpdate:modelValue":l[4]||(l[4]=p=>r.value.precision=p)},[...l[30]||(l[30]=[e("option",{value:1},"1Â°C (Whole degrees)",-1),e("option",{value:.5},"0.5Â°C (Half degrees)",-1)])],512),[[Ie,r.value.precision,void 0,{number:!0}]])])]),w.value==="quick"?(s(),i("div",xr,[e("div",Rr,[l[32]||(l[32]=e("label",null,"Representative Temperature to Learn *",-1)),J(e("select",{"onUpdate:modelValue":l[5]||(l[5]=p=>r.value.representativeTemp=p)},[(s(!0),i(me,null,he(m.value,p=>(s(),i("option",{key:p,value:p},f(p)+"Â°C ",9,Mr))),128))],512),[[Ie,r.value.representativeTemp,void 0,{number:!0}]]),e("small",null,"This temperature will be learned for all mode combinations. The device profile will still show the full range ("+f(r.value.minTemp)+"Â°C - "+f(r.value.maxTemp)+"Â°C).",1)])])):x("",!0)]),e("div",Er,[l[40]||(l[40]=e("h4",null,"Supported HVAC Modes *",-1)),l[41]||(l[41]=e("p",{class:"help-text"},"Select all modes your device supports",-1)),e("div",Ar,[e("label",Lr,[J(e("input",{type:"checkbox",value:"off","onUpdate:modelValue":l[6]||(l[6]=p=>r.value.modes=p)},null,512),[[ve,r.value.modes]]),l[34]||(l[34]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),T(" Off ")],-1))]),e("label",Or,[J(e("input",{type:"checkbox",value:"auto","onUpdate:modelValue":l[7]||(l[7]=p=>r.value.modes=p)},null,512),[[ve,r.value.modes]]),l[35]||(l[35]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-autorenew"}),T(" Auto ")],-1))]),e("label",Pr,[J(e("input",{type:"checkbox",value:"cool","onUpdate:modelValue":l[8]||(l[8]=p=>r.value.modes=p)},null,512),[[ve,r.value.modes]]),l[36]||(l[36]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-snowflake"}),T(" Cool ")],-1))]),e("label",Vr,[J(e("input",{type:"checkbox",value:"heat","onUpdate:modelValue":l[9]||(l[9]=p=>r.value.modes=p)},null,512),[[ve,r.value.modes]]),l[37]||(l[37]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fire"}),T(" Heat ")],-1))]),e("label",Ur,[J(e("input",{type:"checkbox",value:"dry","onUpdate:modelValue":l[10]||(l[10]=p=>r.value.modes=p)},null,512),[[ve,r.value.modes]]),l[38]||(l[38]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-water-percent"}),T(" Dry ")],-1))]),e("label",Fr,[J(e("input",{type:"checkbox",value:"fan_only","onUpdate:modelValue":l[11]||(l[11]=p=>r.value.modes=p)},null,512),[[ve,r.value.modes]]),l[39]||(l[39]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan"}),T(" Fan Only ")],-1))])])]),e("div",jr,[l[46]||(l[46]=e("h4",null,"Fan Modes",-1)),l[47]||(l[47]=e("p",{class:"help-text"},"Select all fan speeds your device supports",-1)),e("div",Nr,[e("label",Br,[J(e("input",{type:"checkbox",value:"auto","onUpdate:modelValue":l[12]||(l[12]=p=>r.value.fanModes=p)},null,512),[[ve,r.value.fanModes]]),l[42]||(l[42]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-autorenew"}),T(" Auto ")],-1))]),e("label",Hr,[J(e("input",{type:"checkbox",value:"low","onUpdate:modelValue":l[13]||(l[13]=p=>r.value.fanModes=p)},null,512),[[ve,r.value.fanModes]]),l[43]||(l[43]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-1"}),T(" Low ")],-1))]),e("label",qr,[J(e("input",{type:"checkbox",value:"medium","onUpdate:modelValue":l[14]||(l[14]=p=>r.value.fanModes=p)},null,512),[[ve,r.value.fanModes]]),l[44]||(l[44]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-2"}),T(" Medium ")],-1))]),e("label",zr,[J(e("input",{type:"checkbox",value:"high","onUpdate:modelValue":l[15]||(l[15]=p=>r.value.fanModes=p)},null,512),[[ve,r.value.fanModes]]),l[45]||(l[45]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-3"}),T(" High ")],-1))])])]),e("div",Jr,[l[52]||(l[52]=e("h4",null,"Swing Modes (Optional)",-1)),l[53]||(l[53]=e("p",{class:"help-text"},"Select if your device has swing/oscillation",-1)),e("div",Wr,[e("label",Gr,[J(e("input",{type:"checkbox",value:"off","onUpdate:modelValue":l[16]||(l[16]=p=>r.value.swingModes=p)},null,512),[[ve,r.value.swingModes]]),l[48]||(l[48]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-horizontal"}),T(" Off ")],-1))]),e("label",Kr,[J(e("input",{type:"checkbox",value:"vertical","onUpdate:modelValue":l[17]||(l[17]=p=>r.value.swingModes=p)},null,512),[[ve,r.value.swingModes]]),l[49]||(l[49]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-vertical"}),T(" Vertical ")],-1))]),e("label",Xr,[J(e("input",{type:"checkbox",value:"horizontal","onUpdate:modelValue":l[18]||(l[18]=p=>r.value.swingModes=p)},null,512),[[ve,r.value.swingModes]]),l[50]||(l[50]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-horizontal"}),T(" Horizontal ")],-1))]),e("label",Yr,[J(e("input",{type:"checkbox",value:"both","onUpdate:modelValue":l[19]||(l[19]=p=>r.value.swingModes=p)},null,512),[[ve,r.value.swingModes]]),l[51]||(l[51]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-arrow-all"}),T(" Both ")],-1))])])]),e("div",Zr,[l[60]||(l[60]=e("h4",null,"Sensors (Optional)",-1)),l[61]||(l[61]=e("p",{class:"help-text"},"Link external sensors for better climate control",-1)),e("div",Qr,[l[54]||(l[54]=e("label",null,"Temperature Sensor",-1)),J(e("input",{"onUpdate:modelValue":l[20]||(l[20]=p=>r.value.tempSensor=p),type:"text",placeholder:"sensor.living_room_temperature"},null,512),[[Le,r.value.tempSensor]]),l[55]||(l[55]=e("small",null,"Entity ID of temperature sensor",-1))]),e("div",ed,[l[56]||(l[56]=e("label",null,"Humidity Sensor",-1)),J(e("input",{"onUpdate:modelValue":l[21]||(l[21]=p=>r.value.humiditySensor=p),type:"text",placeholder:"sensor.living_room_humidity"},null,512),[[Le,r.value.humiditySensor]]),l[57]||(l[57]=e("small",null,"Entity ID of humidity sensor",-1))]),e("div",td,[l[58]||(l[58]=e("label",null,"Power Sensor",-1)),J(e("input",{"onUpdate:modelValue":l[22]||(l[22]=p=>r.value.powerSensor=p),type:"text",placeholder:"binary_sensor.ac_power"},null,512),[[Le,r.value.powerSensor]]),l[59]||(l[59]=e("small",null,"Entity ID of power sensor (to detect on/off state)",-1))])]),N.value.length>0?(s(),i("div",od,[l[62]||(l[62]=e("h4",null,[e("i",{class:"mdi mdi-alert-circle"}),T(" Please fix the following: ")],-1)),e("ul",null,[(s(!0),i(me,null,he(N.value,(p,g)=>(s(),i("li",{key:g},f(p),1))),128))])])):x("",!0)]))}},nd=$e(ld,[["__scopeId","data-v-c44d7198"]]),sd={class:"command-wizard"},ad={class:"device-selection-section"},id={class:"input-wrapper"},rd=["value"],dd={key:0,class:"validation-tooltip"},ud={class:"form-group"},cd=["disabled"],md={key:0},vd={key:1},pd={key:0,class:"edit-mode-banner"},fd={class:"wizard-info"},gd={key:0},yd={key:1},bd={class:"progress-info"},hd={class:"progress-bar"},kd={class:"progress-text"},wd={class:"commands-grid"},$d={class:"command-header"},Cd={class:"command-icon"},_d={class:"command-info"},Sd={key:0,class:"learning-indicator"},Id={key:0,class:"ir-learning-steps"},Dd={key:1,class:"rf-learning-steps"},Td={class:"command-actions"},xd=["onClick","disabled"],Rd={key:1,class:"learned-status"},Md=["onClick","disabled"],Ed=["onClick"],Ad={class:"quick-actions"},Ld=["disabled"],Od=["disabled"],Pd={__name:"CommandLearningWizard",props:{modelValue:{type:Object,default:()=>({})},platform:{type:String,required:!0},config:{type:Object,required:!0},broadlinkDevice:{type:String,default:""},manufacturer:{type:String,required:!0},model:{type:String,required:!0},commandType:{type:String,default:"ir"}},emits:["update:modelValue","update:broadlinkDevice","update:commandType"],setup(t,{emit:c}){const d=Ge(),$=t,w=c,r=b({...$.modelValue}),m=b(null),y=b(null),I=b([]),_=b($.broadlinkDevice),E=b($.commandType),k=b(!1),o=b([]),O=b(!1),F=b(!1),N=b({show:!1,commandKey:null,commandLabel:""}),L=b(!1),l=W(()=>{const D=[];if($.platform==="climate"){const v=$.config.modes||[],V=$.config.fanModes||[],pe=$.config.minTemp||16,Oe=$.config.maxTemp||30;v.forEach(fe=>{if(fe==="off")D.push({key:"off",label:"Power Off",description:"Turn device off",icon:"mdi mdi-power",mode:"off"});else for(let ue=pe;ue<=Oe;ue++)V.forEach(Ae=>{const Pe=`${fe}_${ue}_${Ae}`;D.push({key:Pe,label:`${fe.toUpperCase()} ${ue}Â°C ${Ae}`,description:`Mode: ${fe}, Temp: ${ue}Â°C, Fan: ${Ae}`,icon:z(fe),mode:fe,temp:ue,fanMode:Ae})})})}else if($.platform==="media_player"){const v=$.config.features||[];v.includes("turn_on")&&(D.push({key:"turn_on",label:"Power On",description:"Turn on the device",icon:"mdi mdi-power"}),D.push({key:"turn_off",label:"Power Off",description:"Turn off the device",icon:"mdi mdi-power-off"})),v.includes("volume")&&(D.push({key:"volume_up",label:"Volume Up",description:"Increase volume",icon:"mdi mdi-volume-plus"}),D.push({key:"volume_down",label:"Volume Down",description:"Decrease volume",icon:"mdi mdi-volume-minus"})),v.includes("mute")&&D.push({key:"mute",label:"Mute",description:"Toggle mute",icon:"mdi mdi-volume-mute"}),v.includes("source")&&(D.push({key:"source_hdmi1",label:"Source: HDMI 1",description:"Switch to HDMI 1",icon:"mdi mdi-import"}),D.push({key:"source_hdmi2",label:"Source: HDMI 2",description:"Switch to HDMI 2",icon:"mdi mdi-import"}),D.push({key:"source_hdmi3",label:"Source: HDMI 3",description:"Switch to HDMI 3",icon:"mdi mdi-import"})),v.includes("channel")&&(D.push({key:"channel_up",label:"Channel Up",description:"Next channel",icon:"mdi mdi-chevron-up"}),D.push({key:"channel_down",label:"Channel Down",description:"Previous channel",icon:"mdi mdi-chevron-down"}))}else if($.platform==="fan"){const v=$.config.speedLevels||3,V=$.config.features||[];D.push({key:"turn_on",label:"Power On",description:"Turn on the fan",icon:"mdi mdi-power"}),D.push({key:"turn_off",label:"Power Off",description:"Turn off the fan",icon:"mdi mdi-power-off"});for(let pe=1;pe<=v;pe++){const Oe=pe===1?"Low":pe===v?"High":pe===2&&v===3?"Medium":`Speed ${pe}`;D.push({key:`speed_${pe}`,label:`${Oe}`,description:`Set fan to speed level ${pe}`,icon:"mdi mdi-fan"})}V.includes("oscillate")&&(D.push({key:"oscillate_on",label:"Oscillate On",description:"Enable oscillation",icon:"mdi mdi-sync"}),D.push({key:"oscillate_off",label:"Oscillate Off",description:"Disable oscillation",icon:"mdi mdi-sync-off"})),V.includes("direction")&&(D.push({key:"direction_forward",label:"Direction: Forward",description:"Set direction to forward",icon:"mdi mdi-rotate-right"}),D.push({key:"direction_reverse",label:"Direction: Reverse",description:"Set direction to reverse",icon:"mdi mdi-rotate-left"}))}else if($.platform==="light"){const v=$.config.features||[];v.includes("turn_on")&&(D.push({key:"turn_on",label:"Power On",description:"Turn on the light",icon:"mdi mdi-lightbulb-on"}),D.push({key:"turn_off",label:"Power Off",description:"Turn off the light",icon:"mdi mdi-lightbulb-off"})),v.includes("brightness")&&(D.push({key:"brightness_up",label:"Brightness Up",description:"Increase brightness",icon:"mdi mdi-brightness-7"}),D.push({key:"brightness_down",label:"Brightness Down",description:"Decrease brightness",icon:"mdi mdi-brightness-5"})),v.includes("color_temp")&&(D.push({key:"color_temp_warm",label:"Warm White",description:"Set to warm white",icon:"mdi mdi-weather-sunset"}),D.push({key:"color_temp_cool",label:"Cool White",description:"Set to cool white",icon:"mdi mdi-weather-sunny"})),v.includes("rgb")&&(D.push({key:"color_red",label:"Color: Red",description:"Set color to red",icon:"mdi mdi-palette"}),D.push({key:"color_green",label:"Color: Green",description:"Set color to green",icon:"mdi mdi-palette"}),D.push({key:"color_blue",label:"Color: Blue",description:"Set color to blue",icon:"mdi mdi-palette"}))}return D}),p=W(()=>l.value.length),g=W(()=>Object.keys(r.value).length),P=W(()=>p.value===0?0:Math.round(g.value/p.value*100));function z(D){return{off:"mdi mdi-power",auto:"mdi mdi-autorenew",cool:"mdi mdi-snowflake",heat:"mdi mdi-fire",dry:"mdi mdi-water-percent",fan_only:"mdi mdi-fan"}[D]||"mdi mdi-remote"}async function G(D){if(!m.value){if(!_.value){F.value=!0,window.scrollTo({top:0,behavior:"smooth"});return}F.value=!1,m.value=D.key;try{const v=$.manufacturer.toLowerCase().replace(/[^a-z0-9]+/g,"_"),V=$.model.toLowerCase().replace(/[^a-z0-9]+/g,"_"),pe=`${v}_${V}`,fe=(await te.post("/api/commands/learn",{entity_id:_.value,device:pe,command:D.key,command_type:E.value})).data;if(fe.success&&fe.code)r.value[D.key]=fe.code,w("update:modelValue",r.value),O.value=!0,fe.code==="pending"&&console.log(`â³ Command '${D.key}' learned, code will be fetched from storage when saving`),k.value&&o.value.length>0&&setTimeout(()=>{const ue=o.value.shift();ue?G(ue):k.value=!1},1e3);else throw new Error(fe.error||"Failed to learn command")}catch(v){console.error("Error learning command:",v),d.error(`Error learning command: ${v.message}`),k.value=!1,o.value=[]}finally{k.value||(m.value=null)}}}async function Z(D){var v;if(!_.value){F.value=!0,window.scrollTo({top:0,behavior:"smooth"});return}if(!r.value[D]){(v=d.value)==null||v.error("Command not learned yet");return}y.value=D;try{const V=r.value[D];await te.post("/api/commands/send-raw",{entity_id:_.value,command:V,command_type:E.value}),d.success("Command sent successfully")}catch(V){console.error("Error testing command:",V),d.error(`Error testing command: ${V.message}`)}finally{y.value=null}}function H(D){const v=l.value.find(V=>V.key===D);N.value={show:!0,commandKey:D,commandLabel:v?v.label:D}}function M(){const D=N.value.commandKey;delete r.value[D],w("update:modelValue",r.value),N.value.show=!1}function U(){const D=l.value.filter(V=>!r.value[V.key]);if(D.length===0)return;k.value=!0,o.value=[...D];const v=o.value.shift();v&&G(v)}function oe(){L.value=!0}function ie(){r.value={},w("update:modelValue",r.value),L.value=!1}se(()=>$.modelValue,D=>{r.value={...D}},{deep:!0}),xe(async()=>{await ye()});async function ye(){try{console.log("SmartIR device - commands will be loaded from SmartIR JSON file, not Broadlink storage")}catch(D){console.error("Error in loadExistingCommands:",D)}}function Ee(){w("update:broadlinkDevice",_.value)}function Te(){w("update:commandType",E.value)}async function De(){try{console.log("ğŸ” Loading Broadlink devices from /api/remote/devices");const D=await te.get("/api/remote/devices");console.log("ğŸ“¦ Response data:",D.data);const v=D.data.devices||[];console.log(`âœ… Found ${v.length} devices:`,v),I.value=v}catch(D){console.error("âŒ Error loading remote devices:",D),I.value=[]}}return se(()=>$.broadlinkDevice,D=>{_.value=D}),se(_,D=>{D&&(F.value=!1)}),se(()=>$.commandType,D=>{E.value=D}),xe(async()=>{await De(),await ye()}),(D,v)=>(s(),i("div",sd,[v[22]||(v[22]=e("h3",null,"Learn IR Commands",-1)),e("div",ad,[e("div",{class:X(["form-group",{"has-error":F.value}])},[v[6]||(v[6]=e("label",null,"Broadlink Device *",-1)),e("div",id,[J(e("select",{"onUpdate:modelValue":v[0]||(v[0]=V=>_.value=V),onChange:Ee},[v[4]||(v[4]=e("option",{value:""},"Select Broadlink device...",-1)),(s(!0),i(me,null,he(I.value,V=>(s(),i("option",{key:V.entity_id,value:V.entity_id},f(V.name||V.entity_id),9,rd))),128))],544),[[Ie,_.value]]),F.value?(s(),i("div",dd,[...v[5]||(v[5]=[e("i",{class:"mdi mdi-alert"},null,-1),T(" Device is required ",-1)])])):x("",!0)]),e("small",null,"This device will be used to learn commands ("+f(I.value.length)+" devices found)",1)],2),e("div",ud,[v[8]||(v[8]=e("label",null,"Command Type *",-1)),J(e("select",{"onUpdate:modelValue":v[1]||(v[1]=V=>E.value=V),onChange:Te,disabled:g.value>0},[...v[7]||(v[7]=[e("option",{value:"ir"},"ğŸ“¡ Infrared (IR) - Most common for AC, TV, etc.",-1),e("option",{value:"rf"},"ğŸ“» Radio Frequency (RF) - For RF remotes",-1)])],40,cd),[[Ie,E.value]]),g.value>0?(s(),i("small",md,"Command type cannot be changed after learning commands")):(s(),i("small",vd,"Select the type of commands your device uses"))])]),g.value>0&&!O.value?(s(),i("div",pd,[v[10]||(v[10]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[v[9]||(v[9]=e("strong",null,"Editing Existing Profile",-1)),e("p",null,f(g.value)+" command"+f(g.value!==1?"s":"")+' already learned. You can re-learn any command by clicking the delete icon and then "Learn Command".',1)])])):x("",!0),e("div",fd,[v[14]||(v[14]=e("i",{class:"mdi mdi-information"},null,-1)),e("div",null,[v[13]||(v[13]=e("p",null,[e("strong",null,"How it works:")],-1)),t.commandType==="ir"?(s(),i("ol",gd,[...v[11]||(v[11]=[e("li",null,'Click "Learn Command" for each combination',-1),e("li",null,[e("strong",null,"Point your IR remote directly at the Broadlink device")],-1),e("li",null,"Press the button on your remote",-1),e("li",null,"Wait for confirmation (up to 30 seconds)",-1)])])):(s(),i("ol",yd,[...v[12]||(v[12]=[e("li",null,'Click "Learn Command" for each combination',-1),e("li",null,[e("strong",null,"Step 1:"),T(" Hold button on remote - Broadlink scans for RF frequency")],-1),e("li",null,[e("strong",null,"Step 2:"),T(" Watch for Home Assistant notification, then press and release button")],-1),e("li",null,"Keep remote within 5cm of Broadlink (RF doesn't need line-of-sight)",-1),e("li",null,"Wait for confirmation (may take up to 30 seconds)",-1)])]))])]),e("div",bd,[e("div",hd,[e("div",{class:"progress-fill",style:ft({width:P.value+"%"})},null,4)]),e("span",kd,f(g.value)+" / "+f(p.value)+" commands learned ("+f(P.value)+"%) ",1)]),e("div",wd,[(s(!0),i(me,null,he(l.value,V=>(s(),i("div",{key:V.key,class:X(["command-card",{learned:r.value[V.key],learning:m.value===V.key}])},[e("div",$d,[e("div",Cd,[e("i",{class:X(V.icon)},null,2)]),e("div",_d,[e("h4",null,f(V.label),1),e("p",null,f(V.description),1)])]),m.value===V.key?(s(),i("div",Sd,[t.commandType==="ir"?(s(),i("div",Id,[...v[15]||(v[15]=[e("p",null,[e("strong",null,"Point your remote directly at the Broadlink device and press the button.")],-1),e("small",null,"Listening for up to 30 seconds...",-1)])])):(s(),i("div",Dd,[...v[16]||(v[16]=[e("p",{class:"rf-title"},[e("strong",null,"Learning request sent to device.")],-1),e("p",{class:"rf-subtitle"},[T("RF learning is a "),e("strong",null,"two-step process"),T(":")],-1),e("ol",null,[e("li",null,[e("strong",null,"Step 1 - Frequency Sweep (~10-15 seconds):"),T(" Press and hold the button on your remote until the notification updates. ")]),e("li",null,[e("strong",null,"Step 2 - Learn Signal:"),T(" Press and release the button once. ")])],-1),e("p",{class:"rf-note"},"Follow the Home Assistant notifications (ğŸ””) for real-time instructions.",-1)])]))])):x("",!0),e("div",Td,[r.value[V.key]?(s(),i("div",Rd,[v[18]||(v[18]=e("i",{class:"mdi mdi-check-circle"},null,-1)),v[19]||(v[19]=e("span",null,"Learned",-1)),e("span",{class:X(["command-type-badge",E.value])},f(E.value.toUpperCase()),3),e("button",{onClick:pe=>Z(V.key),class:"icon-btn",title:"Test command",disabled:y.value===V.key,style:{"margin-left":"auto"}},[e("i",{class:X(["mdi mdi-play",{"mdi-spin":y.value===V.key}])},null,2)],8,Md),e("button",{onClick:pe=>H(V.key),class:"icon-btn danger",title:"Delete and re-learn"},[...v[17]||(v[17]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,Ed)])):(s(),i("button",{key:0,onClick:pe=>G(V),class:X(["btn-learn",{learning:m.value===V.key}]),disabled:m.value!==null},[e("i",{class:X(["mdi mdi-radio-tower",{"mdi-spin":m.value===V.key}])},null,2),T(" "+f(m.value===V.key?"Listening...":"Learn Command"),1)],10,xd))])],2))),128))]),e("div",Ad,[e("button",{onClick:U,class:"btn-secondary",disabled:m.value!==null||g.value===p.value},[...v[20]||(v[20]=[e("i",{class:"mdi mdi-play-circle"},null,-1),T(" Learn All Remaining ",-1)])],8,Ld),e("button",{onClick:oe,class:"btn-text",disabled:g.value===0},[...v[21]||(v[21]=[e("i",{class:"mdi mdi-delete-sweep"},null,-1),T(" Clear All ",-1)])],8,Od)]),ge(Be,{isOpen:N.value.show,title:"Delete Learned Command?",message:`Are you sure you want to delete the '${N.value.commandLabel}' command?

You will need to re-learn this command.`,confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,onConfirm:M,onCancel:v[2]||(v[2]=V=>N.value.show=!1)},null,8,["isOpen","message"]),ge(Be,{isOpen:L.value,title:"Delete All Learned Commands?",message:"Are you sure you want to delete all learned commands? This cannot be undone.\\n\\nYou will need to re-learn all commands.",confirmText:"Delete All",cancelText:"Cancel",dangerMode:!0,onConfirm:ie,onCancel:v[3]||(v[3]=V=>L.value=!1)},null,8,["isOpen"])]))}},Vd=$e(Pd,[["__scopeId","data-v-9a9e9e51"]]),Ud={class:"profile-preview"},Fd={class:"preview-summary"},jd={class:"summary-card"},Nd={class:"stats-grid"},Bd={class:"stat-item"},Hd={class:"stat-value"},qd={class:"stat-item"},zd={class:"stat-value"},Jd={class:"stat-item"},Wd={class:"stat-value"},Gd={class:"preview-tabs"},Kd={class:"preview-content"},Xd={key:0,class:"tab-content"},Yd={class:"code-header"},Zd={class:"code-block"},Qd={key:1,class:"tab-content"},eu={class:"code-header"},tu={class:"code-block"},ou={key:2,class:"tab-content"},lu={class:"instructions"},nu={class:"step-item"},su={class:"step-content"},au={class:"code-path"},iu={__name:"ProfilePreview",props:{profile:{type:Object,required:!0},jsonData:{type:Object,required:!0},yamlConfig:{type:String,required:!0}},setup(t){const c=Ge(),d=t,$=b("json"),w=b(!1),r=b(!1),m=W(()=>Object.keys(d.profile.commands||{}).length),y=W(()=>JSON.stringify(d.jsonData,null,2));async function I(){try{await navigator.clipboard.writeText(y.value),w.value=!0,setTimeout(()=>{w.value=!1},2e3)}catch(E){console.error("Failed to copy JSON:",E),c.error("Failed to copy to clipboard")}}async function _(){try{await navigator.clipboard.writeText(d.yamlConfig),r.value=!0,setTimeout(()=>{r.value=!1},2e3)}catch(E){console.error("Failed to copy YAML:",E),c.error("Failed to copy to clipboard")}}return(E,k)=>{var o;return s(),i("div",Ud,[k[22]||(k[22]=e("h3",null,"Preview & Save",-1)),e("div",Fd,[e("div",jd,[k[4]||(k[4]=e("i",{class:"mdi mdi-check-circle"},null,-1)),e("div",null,[k[3]||(k[3]=e("h4",null,"Profile Ready!",-1)),e("p",null,f(t.profile.manufacturer)+" "+f(t.profile.model),1)])]),e("div",Nd,[e("div",Bd,[e("span",Hd,f(m.value),1),k[5]||(k[5]=e("span",{class:"stat-label"},"Commands Learned",-1))]),e("div",qd,[e("span",zd,f(t.profile.platform),1),k[6]||(k[6]=e("span",{class:"stat-label"},"Platform",-1))]),e("div",Jd,[e("span",Wd,f(((o=t.profile.config.modes)==null?void 0:o.length)||0),1),k[7]||(k[7]=e("span",{class:"stat-label"},"HVAC Modes",-1))])])]),e("div",Gd,[e("button",{onClick:k[0]||(k[0]=O=>$.value="json"),class:X(["tab-button",{active:$.value==="json"}])},[...k[8]||(k[8]=[e("i",{class:"mdi mdi-code-json"},null,-1),T(" SmartIR JSON ",-1)])],2),e("button",{onClick:k[1]||(k[1]=O=>$.value="yaml"),class:X(["tab-button",{active:$.value==="yaml"}])},[...k[9]||(k[9]=[e("i",{class:"mdi mdi-file-code"},null,-1),T(" YAML Config ",-1)])],2),e("button",{onClick:k[2]||(k[2]=O=>$.value="instructions"),class:X(["tab-button",{active:$.value==="instructions"}])},[...k[10]||(k[10]=[e("i",{class:"mdi mdi-information"},null,-1),T(" Instructions ",-1)])],2)]),e("div",Kd,[$.value==="json"?(s(),i("div",Xd,[e("div",Yd,[k[12]||(k[12]=e("h4",null,"SmartIR Device Code JSON",-1)),e("button",{onClick:I,class:"btn-copy"},[k[11]||(k[11]=e("i",{class:"mdi mdi-content-copy"},null,-1)),T(" "+f(w.value?"Copied!":"Copy"),1)])]),e("pre",Zd,[e("code",null,f(y.value),1)]),k[13]||(k[13]=e("p",{class:"code-note"},[e("i",{class:"mdi mdi-information"}),T(" Save this as "),e("code",null,"10000.json"),T(" in your SmartIR codes directory ")],-1))])):x("",!0),$.value==="yaml"?(s(),i("div",Qd,[e("div",eu,[k[15]||(k[15]=e("h4",null,"Home Assistant Configuration",-1)),e("button",{onClick:_,class:"btn-copy"},[k[14]||(k[14]=e("i",{class:"mdi mdi-content-copy"},null,-1)),T(" "+f(r.value?"Copied!":"Copy"),1)])]),e("pre",tu,[e("code",null,f(t.yamlConfig),1)]),k[16]||(k[16]=e("p",{class:"code-note"},[e("i",{class:"mdi mdi-information"}),T(" Add this to your "),e("code",null,"configuration.yaml"),T(" file ")],-1))])):x("",!0),$.value==="instructions"?(s(),i("div",ou,[e("div",lu,[k[20]||(k[20]=e("h4",null,"Installation Steps",-1)),e("div",nu,[k[19]||(k[19]=e("div",{class:"step-number"},"1",-1)),e("div",su,[k[17]||(k[17]=e("h5",null,"Get Next Code Number",-1)),k[18]||(k[18]=e("p",null,"Custom device codes start at 10000. Check your SmartIR codes directory to find the next available number.",-1)),e("div",au,[e("code",null,"/config/custom_components/smartir/codes/"+f(t.profile.platform)+"/",1)])])]),k[21]||(k[21]=He('<div class="step-item" data-v-e7b997c8><div class="step-number" data-v-e7b997c8>2</div><div class="step-content" data-v-e7b997c8><h5 data-v-e7b997c8>Save JSON File</h5><p data-v-e7b997c8>Copy the JSON from the &quot;SmartIR JSON&quot; tab and save it as <code data-v-e7b997c8>10000.json</code> (or your next available number) in the codes directory.</p></div></div><div class="step-item" data-v-e7b997c8><div class="step-number" data-v-e7b997c8>3</div><div class="step-content" data-v-e7b997c8><h5 data-v-e7b997c8>Update Configuration</h5><p data-v-e7b997c8>Copy the YAML from the &quot;YAML Config&quot; tab and add it to your <code data-v-e7b997c8>configuration.yaml</code> file. Update the <code data-v-e7b997c8>device_code</code> to match your JSON filename.</p></div></div><div class="step-item" data-v-e7b997c8><div class="step-number" data-v-e7b997c8>4</div><div class="step-content" data-v-e7b997c8><h5 data-v-e7b997c8>Restart Home Assistant</h5><p data-v-e7b997c8>Restart Home Assistant to load the new configuration. Your climate entity will appear in the UI.</p></div></div><div class="step-item" data-v-e7b997c8><div class="step-number" data-v-e7b997c8>5</div><div class="step-content" data-v-e7b997c8><h5 data-v-e7b997c8>Test Your Device</h5><p data-v-e7b997c8>Go to your climate entity and test different modes, temperatures, and fan speeds to ensure everything works correctly.</p></div></div><div class="tips-section" data-v-e7b997c8><h4 data-v-e7b997c8><i class="mdi mdi-lightbulb" data-v-e7b997c8></i> Tips </h4><ul data-v-e7b997c8><li data-v-e7b997c8>Keep a backup of your JSON file in case you need to modify it</li><li data-v-e7b997c8>Test all commands to ensure they work as expected</li><li data-v-e7b997c8>You can share your profile with the SmartIR community on GitHub</li><li data-v-e7b997c8>If a command doesn&#39;t work, you can re-learn it and update the JSON</li></ul></div>',5))])])):x("",!0)])])}}},ru=$e(iu,[["__scopeId","data-v-e7b997c8"]]),du={class:"wizard-body"},uu={key:0,class:"warning-section"},cu={class:"warning-box"},mu={class:"instructions"},vu={class:"code-block"},pu={class:"steps"},fu={key:0},gu={class:"help-section"},yu={key:0,class:"help-content"},bu={class:"help-step"},hu={key:0,class:"help-step"},ku={class:"help-step"},wu={class:"help-step"},$u={class:"checklist"},Cu={class:"checkbox-label"},_u={key:0,class:"checkbox-label"},Su={class:"wizard-footer"},Iu=["disabled"],Du={__name:"SmartIRSetupWizard",props:{show:{type:Boolean,default:!1},platform:{type:String,required:!0},warnings:{type:Array,default:()=>[]},configPath:{type:String,default:"/config"}},emits:["close","complete"],setup(t,{emit:c}){const d=t,$=c,w=Me("toast"),r=b(!1),m=b(!1),y=b(!1),I=W(()=>d.warnings.length>0?r.value&&m.value:r.value);function _(){const k=`${d.platform}: !include smartir/${d.platform}.yaml`;navigator.clipboard.writeText(k).then(()=>{var o;(o=w.value)==null||o.success("Include line copied to clipboard!","âœ… Copied")}).catch(o=>{var O;console.error("Failed to copy:",o),(O=w.value)==null||O.error("Failed to copy to clipboard","âŒ Copy Failed")})}function E(){$("complete")}return(k,o)=>t.show?(s(),i("div",{key:0,class:"modal-overlay",onClick:o[5]||(o[5]=ce(()=>{},["stop"]))},[e("div",{class:"setup-wizard",onClick:o[4]||(o[4]=ce(()=>{},["stop"]))},[o[31]||(o[31]=e("div",{class:"wizard-header"},[e("h2",null,[e("i",{class:"mdi mdi-cog"}),T(" SmartIR Configuration Setup ")])],-1)),e("div",du,[t.warnings.length>0?(s(),i("div",uu,[e("div",cu,[o[11]||(o[11]=e("i",{class:"mdi mdi-alert"},null,-1)),e("div",null,[o[9]||(o[9]=e("h3",null,"âš ï¸ Configuration Migration Needed",-1)),o[10]||(o[10]=e("p",null,"We detected existing platform entries in your configuration.yaml:",-1)),e("ul",null,[(s(!0),i(me,null,he(t.warnings,O=>(s(),i("li",{key:O.platform},[e("strong",null,f(O.platform)+":",1),T(" "+f(O.message),1)]))),128))]),e("p",null,[o[6]||(o[6]=e("strong",null,"Action Required:",-1)),o[7]||(o[7]=T(" Move these entries to ",-1)),e("code",null,"smartir/"+f(t.platform)+".yaml",1),o[8]||(o[8]=T(" before continuing.",-1))])])])])):x("",!0),e("div",mu,[o[27]||(o[27]=e("h3",null,"ğŸ“ One-Time Setup",-1)),o[28]||(o[28]=e("p",null,[T("To enable SmartIR device management, add this line to your "),e("code",null,"configuration.yaml"),T(":")],-1)),e("div",vu,[e("code",null,f(t.platform)+": !include smartir/"+f(t.platform)+".yaml",1),e("button",{onClick:_,class:"copy-btn",title:"Copy to clipboard"},[...o[12]||(o[12]=[e("i",{class:"mdi mdi-content-copy"},null,-1)])])]),e("div",pu,[o[19]||(o[19]=e("h4",null,"Steps:",-1)),e("ol",null,[t.warnings.length>0?(s(),i("li",fu,[o[13]||(o[13]=e("strong",null,"Move existing entries:",-1)),o[14]||(o[14]=T(" Copy any existing ",-1)),e("code",null,f(t.platform)+":",1),o[15]||(o[15]=T(" entries from configuration.yaml to ",-1)),e("code",null,"smartir/"+f(t.platform)+".yaml",1)])):x("",!0),o[16]||(o[16]=e("li",null,[e("strong",null,"Add include line:"),T(" Add the line above to your configuration.yaml ")],-1)),o[17]||(o[17]=e("li",null,[e("strong",null,"Save changes:"),T(" Save configuration.yaml ")],-1)),o[18]||(o[18]=e("li",null,[e("strong",null,"Continue here:"),T(` Click "I've Completed Setup" below `)],-1))])]),e("div",gu,[e("button",{onClick:o[0]||(o[0]=O=>y.value=!y.value),class:"help-toggle"},[e("i",{class:X(["mdi",y.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2),T(" "+f(y.value?"Hide":"Show")+" Detailed Instructions ",1)]),y.value?(s(),i("div",yu,[o[26]||(o[26]=e("h4",null,"Detailed Setup Guide:",-1)),e("div",bu,[o[21]||(o[21]=e("h5",null,"1. Open configuration.yaml",-1)),e("p",null,[o[20]||(o[20]=T("Location: ",-1)),e("code",null,f(t.configPath)+"/configuration.yaml",1)])]),t.warnings.length>0?(s(),i("div",hu,[o[22]||(o[22]=e("h5",null,"2. Migrate Existing Entries (If Any)",-1)),e("p",null,"If you have existing "+f(t.platform)+" entries, cut them from configuration.yaml and paste into:",1),e("p",null,[e("code",null,f(t.configPath)+"/smartir/"+f(t.platform)+".yaml",1)]),o[23]||(o[23]=e("p",{class:"note"},"Broadlink Manager will create this file automatically.",-1))])):x("",!0),e("div",ku,[e("h5",null,f(t.warnings.length>0?"3":"2")+". Add Include Line",1),o[24]||(o[24]=e("p",null,"Add this to configuration.yaml:",-1)),e("pre",null,f(t.platform)+": !include smartir/"+f(t.platform)+".yaml",1)]),e("div",wu,[e("h5",null,f(t.warnings.length>0?"4":"3")+". Restart Home Assistant",1),o[25]||(o[25]=e("p",null,"After saving, you'll need to restart HA for changes to take effect.",-1))])])):x("",!0)])]),e("div",$u,[e("label",Cu,[J(e("input",{type:"checkbox","onUpdate:modelValue":o[1]||(o[1]=O=>r.value=O)},null,512),[[ve,r.value]]),o[29]||(o[29]=e("span",null,"I've added the include line to configuration.yaml",-1))]),t.warnings.length>0?(s(),i("label",_u,[J(e("input",{type:"checkbox","onUpdate:modelValue":o[2]||(o[2]=O=>m.value=O)},null,512),[[ve,m.value]]),e("span",null,"I've migrated existing "+f(t.platform)+" entries (if any)",1)])):x("",!0)])]),e("div",Su,[e("button",{onClick:o[3]||(o[3]=O=>k.$emit("close")),class:"btn-secondary"}," Cancel "),e("button",{onClick:E,class:"btn-primary",disabled:!I.value},[...o[30]||(o[30]=[e("i",{class:"mdi mdi-check"},null,-1),T(" I've Completed Setup ",-1)])],8,Iu)])])])):x("",!0)}},Tu=$e(Du,[["__scopeId","data-v-f6fe4c03"]]),xu={class:"modal-header"},Ru={class:"progress-steps"},Mu={class:"step-number"},Eu={key:0,class:"mdi mdi-check"},Au={key:1},Lu={class:"step-label"},Ou={class:"modal-body"},Pu={key:0,class:"step-content"},Vu={class:"form-group"},Uu={class:"form-group"},Fu={class:"form-group"},ju={key:1,class:"step-content"},Nu={key:1,class:"platform-form"},Bu={class:"form-section"},Hu={class:"checkbox-grid"},qu={class:"checkbox-item"},zu={class:"checkbox-item"},Ju={class:"checkbox-item"},Wu={class:"checkbox-item"},Gu={class:"checkbox-item"},Ku={key:2,class:"platform-form"},Xu={class:"form-section"},Yu={class:"form-group"},Zu={class:"form-section"},Qu={class:"checkbox-grid"},ec={class:"checkbox-item"},tc={class:"checkbox-item"},oc={key:3,class:"platform-form"},lc={class:"form-section"},nc={class:"checkbox-grid"},sc={class:"checkbox-item"},ac={class:"checkbox-item"},ic={class:"checkbox-item"},rc={class:"checkbox-item"},dc={key:2,class:"step-content"},uc={key:3,class:"step-content"},cc={class:"modal-footer"},mc=["disabled"],vc={key:2,class:"save-buttons"},pc=["disabled"],fc=["disabled"],gc={__name:"SmartIRProfileBuilder",props:{show:{type:Boolean,default:!1},editMode:{type:Boolean,default:!1},editData:{type:Object,default:null},startStep:{type:Number,default:0}},emits:["close","save"],setup(t,{emit:c}){const d=t,$=c,w=Me("toast"),r=b(0),m=b(!1),y=b([]),I=b(!1),_=b([]),E=b("/config"),k=b(!1),o=b(null),O=b(!1),F=b(!1),N=b(""),L=b("ir"),l=b(!1),p=[{label:"Device Info",key:"info"},{label:"Configuration",key:"config"},{label:"Learn Commands",key:"commands"},{label:"Preview & Save",key:"preview"}],g=b({platform:"",manufacturer:"",model:"",broadlinkDevice:"",commandType:"ir",config:{},commands:{}}),P=b(["turn_on"]),z=b(3),G=b([]),Z=b(["turn_on"]);se(()=>g.value.platform,C=>{C==="media_player"?g.value.config={features:P.value}:C==="fan"?g.value.config={speedLevels:z.value,features:G.value}:C==="light"&&(g.value.config={features:Z.value})}),se(P,C=>{g.value.platform==="media_player"&&(g.value.config={features:C})},{deep:!0}),se(z,C=>{g.value.platform==="fan"&&(g.value.config={speedLevels:C,features:G.value})}),se(G,C=>{g.value.platform==="fan"&&(g.value.config={speedLevels:z.value,features:C})},{deep:!0}),se(Z,C=>{g.value.platform==="light"&&(g.value.config={features:C})},{deep:!0});function H(C){const a=new Set,R=Object.keys(C);return R.some(K=>K==="off"||K.includes("_off"))&&a.add("off"),R.some(K=>K.includes("auto"))&&a.add("auto"),R.some(K=>K.includes("cool"))&&a.add("cool"),R.some(K=>K.includes("heat"))&&a.add("heat"),R.some(K=>K.includes("dry"))&&a.add("dry"),R.some(K=>K.includes("fan_only"))&&a.add("fan_only"),Array.from(a)}function M(C){const a=new Set,R=Object.keys(C);return R.some(K=>K.includes("auto"))&&a.add("auto"),R.some(K=>K.includes("low"))&&a.add("low"),R.some(K=>K.includes("medium")||K.includes("mid"))&&a.add("medium"),R.some(K=>K.includes("high"))&&a.add("high"),Array.from(a)}function U(C){const a=new Set,R=Object.keys(C);return R.some(K=>K.includes("swing_off")||K.includes("_off"))&&a.add("off"),R.some(K=>K.includes("vertical"))&&a.add("vertical"),R.some(K=>K.includes("horizontal"))&&a.add("horizontal"),R.some(K=>K.includes("both"))&&a.add("both"),Array.from(a)}function oe(C){for(const a of Object.values(C))if(typeof a=="string"&&a.startsWith("sc")||Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0].startsWith("sc"))return"rf";return"ir"}se(()=>g.value.commandType,(C,a)=>{!a||O.value||l.value||(Object.keys(g.value.commands).length>0&&C!==a?(N.value=C,g.value.commandType=a,O.value=!0):C!==a&&(L.value=C))}),se(()=>d.editData,async C=>{var a,R,K;if(C&&d.editMode){console.log("ğŸ”§ Edit mode activated, loading profile data:",C),l.value=!0,y.value.length===0&&(console.log("ğŸ“¡ Loading Broadlink devices..."),await j(),console.log("ğŸ“¡ Devices loaded:",y.value.length));const le=C.profile,re=le.controller_data;console.log("ğŸ® Controller data from profile:",re),console.log("ğŸ® Available devices:",y.value.map(ae=>ae.entity_id));const Q=le.commands||{},Re=le.commandType||oe(Q);console.log("ğŸ” Command type (stored):",le.commandType),console.log("ğŸ” Command type (final):",Re);let Y={};if(C.platform==="climate"){const ae=le.operationModes||H(Q),Ce=le.fanModes||M(Q),Ve=le.swingModes||U(Q);console.log("ğŸ” Inferred modes:",ae),console.log("ğŸ” Inferred fan modes:",Ce),console.log("ğŸ” Inferred swing modes:",Ve),Y={minTemp:le.minTemperature,maxTemp:le.maxTemperature,precision:le.precision,modes:ae,fanModes:Ce,swingModes:Ve}}else if(C.platform==="media_player"){const ae=[];(Q.on||Q.off)&&ae.push("turn_on"),(Q.volumeUp||Q.volumeDown)&&ae.push("volume"),Q.mute&&ae.push("mute"),Q.sources&&ae.push("source"),(Q.channelUp||Q.channelDown)&&ae.push("channel"),Y={features:ae},P.value=ae,console.log("ğŸ” Inferred media player features:",ae)}else if(C.platform==="fan"){const ae=((a=le.speed)==null?void 0:a.length)||Object.keys(Q.default||{}).length||3,Ce=[];(Q.oscillate_on||Q.oscillate_off)&&Ce.push("oscillate"),(Q.direction_forward||Q.direction_reverse)&&Ce.push("direction"),Y={speedLevels:ae,features:Ce},z.value=ae,G.value=Ce,console.log("ğŸ” Inferred fan config:",Y)}else if(C.platform==="light"){const ae=[];Y={features:ae},Z.value=ae,console.log("ğŸ” Inferred light features:",ae)}const we=await h(le.manufacturer,(R=le.supportedModels)==null?void 0:R[0],Q);g.value={platform:C.platform,manufacturer:le.manufacturer||"",model:((K=le.supportedModels)==null?void 0:K[0])||"",broadlinkDevice:re||"",commandType:Re,config:Y,commands:we},console.log("âœ… Profile populated:",g.value),console.log("âœ… Selected device:",g.value.broadlinkDevice),console.log("âœ… Command type:",g.value.commandType),console.log("âœ… Commands (with learned codes):",we),L.value=Re,setTimeout(()=>{l.value=!1},100)}},{immediate:!0});const ie=W(()=>{var C;switch(r.value){case 0:return g.value.platform&&g.value.manufacturer&&g.value.model;case 1:return g.value.platform==="climate"?g.value.config.minTemp&&g.value.config.maxTemp&&((C=g.value.config.modes)==null?void 0:C.length)>0:!0;case 2:return g.value.broadlinkDevice&&g.value.commandType&&Object.keys(g.value.commands).length>0;case 3:return!0;default:return!1}}),ye=b(null);async function Ee(){if(r.value!==3){ye.value=null;return}if(console.log("ğŸ” Generating JSON with commands:",g.value.commands),Object.values(g.value.commands).some(a=>typeof a=="string"?a==="pending":typeof a=="object"?Object.values(a).some(R=>typeof R=="string"?R==="pending":typeof R=="object"?Object.values(R).some(K=>K==="pending"):!1):!1)){console.warn('âš ï¸ Commands still contain "pending" placeholders!'),console.log("ğŸ“¦ Attempting to fetch from Broadlink storage...");const a=await h(g.value.manufacturer,g.value.model,g.value.commands);g.value.commands=a,console.log("âœ… Updated commands:",a)}ye.value=u(g.value),console.log("ğŸ“„ Generated JSON:",ye.value)}const Te=W(()=>r.value!==3?null:n(g.value));function De(){g.value.config={},g.value.commands={}}function D(){O.value=!1,g.value.commandType=N.value,L.value=N.value,g.value.commands={},N.value=""}function v(){O.value=!1,N.value=""}async function V(){r.value<p.length-1&&(r.value++,r.value===3&&await Ee())}function pe(){r.value>0&&r.value--}function Oe(){O.value||(F.value=!0)}function fe(){F.value=!1,ue()}function ue(){$("close"),setTimeout(()=>{r.value=0,g.value={platform:"",manufacturer:"",model:"",broadlinkDevice:"",commandType:"ir",config:{},commands:{}},L.value="ir"},300)}async function Ae(){var C,a,R,K,le,re;m.value=!0;try{if(!k.value){const Ce=(await te.get("/api/smartir/config/check")).data;if(Ce&&!((C=Ce.platforms[g.value.platform])==null?void 0:C.file_exists)){_.value=Ce.configuration_warnings||[],E.value=Ce.config_path||"/config",o.value={platform:g.value.platform,json:ye.value},I.value=!0,m.value=!1;return}}let Q;d.editMode&&((a=d.editData)!=null&&a.code)?(Q=parseInt(d.editData.code),console.log("ğŸ“ Edit mode: Using existing code",Q)):(Q=(await te.get(`/api/smartir/platforms/${g.value.platform}/next-code`)).data.next_code,console.log("âœ¨ New profile: Using next code",Q));const Y=(await te.post("/api/smartir/profiles",{platform:g.value.platform,json:ye.value,code_number:Q})).data,we={platform:"smartir",name:`${g.value.manufacturer} ${g.value.model}`,unique_id:`${g.value.manufacturer.toLowerCase().replace(/[^a-z0-9]+/g,"_")}_${g.value.model.toLowerCase().replace(/[^a-z0-9]+/g,"_")}`,device_code:Q,controller_data:g.value.broadlinkDevice};try{await te.post("/api/smartir/config/add-device",{platform:g.value.platform,device_config:{platform:"smartir",name:we.name,unique_id:we.unique_id,device_code:we.device_code,controller_data:we.controller_data}})}catch(ae){console.error("Failed to add device to config:",ae);const Ce=((R=ae.response)==null?void 0:R.data)||{};let Ve=Ce.error||"Unknown error";Ce.validation_errors&&Ce.validation_errors.length>0&&(Ve=`Device configuration validation failed:
`+Ce.validation_errors.map(qe=>`  â€¢ ${qe}`).join(`
`)),(K=w.value)==null||K.warning(`Profile saved but failed to add to config file:
${Ve}`,"âš ï¸ Partial Success")}$("save",{json:ye.value,yaml:Te.value,profile:g.value,saved_to:Y.path}),(le=w.value)==null||le.success(`File: ${Y.filename}
Device Code: ${Q}
Added to: smartir/${g.value.platform}.yaml

âš ï¸ Restart Home Assistant to activate`,"âœ… Profile Saved Successfully!"),ue()}catch(Q){console.error("Error saving profile:",Q),(re=w.value)==null||re.error(Q.message,"âŒ Error Saving Profile")}finally{m.value=!1}}async function Pe(){k.value=!0,I.value=!1,o.value&&(await Ae(),o.value=null)}function ee(){var C,a;try{const R=JSON.stringify(ye.value,null,2),K=new Blob([R],{type:"application/json"}),le=URL.createObjectURL(K),re=document.createElement("a");re.href=le;const Q=g.value.manufacturer.toLowerCase().replace(/\s+/g,"_"),Re=g.value.model.toLowerCase().replace(/\s+/g,"_");re.download=`smartir_${g.value.platform}_${Q}_${Re}.json`,document.body.appendChild(re),re.click(),document.body.removeChild(re),URL.revokeObjectURL(le),(C=w.value)==null||C.success("You can manually upload this file to your SmartIR codes directory.","âœ… Profile Downloaded")}catch(R){console.error("Error downloading profile:",R),(a=w.value)==null||a.error(R.message,"âŒ Error Downloading Profile")}}async function h(C,a,R){const K=C.toLowerCase().replace(/[^a-z0-9]+/g,"_"),le=a.toLowerCase().replace(/[^a-z0-9]+/g,"_"),re=`${K}_${le}`;try{const Y=(await te.get("/api/commands/all")).data[re]||{};console.log(`ğŸ” Fetching learned commands for device: ${re}`),console.log("ğŸ“¦ Device commands from storage:",Y);const we={...R};for(const[ae,Ce]of Object.entries(we))if(Ce==="pending"&&Y[ae])we[ae]=Y[ae];else if(typeof Ce=="object"){for(const[Ve,qe]of Object.entries(Ce))if(typeof qe=="object")for(const[A,S]of Object.entries(qe)){const B=`${ae}_${Ve}_${A}`;S==="pending"&&Y[B]&&(we[ae][Ve][A]=Y[B])}else if(qe==="pending"){const A=`${ae}_${Ve}`;Y[A]&&(we[ae][Ve]=Y[A])}}return console.log("âœ… Merged commands:",we),we}catch(Q){return console.error("Error fetching learned commands:",Q),R}}function u(C){const a={manufacturer:C.manufacturer,supportedModels:[C.model],supportedController:"Broadlink",commandsEncoding:"Base64",commandType:C.commandType||"ir",commands:{}};return C.platform==="climate"&&(a.minTemperature=C.config.minTemp,a.maxTemperature=C.config.maxTemp,a.precision=C.config.precision||1,a.operationModes=C.config.modes||[],a.fanModes=C.config.fanModes&&C.config.fanModes.length>0?C.config.fanModes:["auto"],C.config.swingModes&&C.config.swingModes.length>0&&(a.swingModes=C.config.swingModes),a.commands=C.commands),a}function n(C){let a=`# SmartIR ${C.platform} configuration
`;return a+=`# Generated by Broadlink Manager v2

`,C.platform==="climate"&&(a+=`climate:
`,a+=`  - platform: smartir
`,a+=`    name: ${C.manufacturer} ${C.model}
`,a+=`    unique_id: ${C.manufacturer.toLowerCase()}_${C.model.toLowerCase().replace(/\s+/g,"_")}
`,a+=`    device_code: 10000  # Change this to your custom code number
`,a+=`    controller_data: ${C.broadlinkDevice}
`,C.config.tempSensor&&(a+=`    temperature_sensor: ${C.config.tempSensor}
`),C.config.humiditySensor&&(a+=`    humidity_sensor: ${C.config.humiditySensor}
`),C.config.powerSensor&&(a+=`    power_sensor: ${C.config.powerSensor}
`)),a}async function j(){try{console.log("Fetching remote devices from /api/remote/devices...");const C=await te.get("/api/remote/devices");console.log("Loaded remote devices response:",C.data);const a=C.data.devices||[];console.log("Extracted devices array:",a),console.log("Device count:",a.length),y.value=a,console.log("broadlinkDevices.value set to:",y.value),console.log("Final device count:",y.value.length)}catch(C){console.error("Error loading remote devices:",C),y.value=[]}}return se(()=>d.show,C=>{if(C){const a=Number.isInteger(d.startStep)?d.startStep:0;r.value=Math.min(Math.max(a,0),p.length-1)}}),se(()=>d.startStep,C=>{if(d.show){const a=Number.isInteger(C)?C:0;r.value=Math.min(Math.max(a,0),p.length-1)}}),xe(()=>{d.show&&j()}),(C,a)=>t.show?(s(),i("div",{key:0,class:"modal-overlay",onClick:Oe},[e("div",{class:"modal-container",onClick:a[19]||(a[19]=ce(()=>{},["stop"]))},[e("div",xu,[e("h2",null,[a[22]||(a[22]=e("i",{class:"mdi mdi-file-document-edit"},null,-1)),T(" "+f(t.editMode?"Edit SmartIR Profile":"Create SmartIR Profile"),1)]),e("button",{onClick:ue,class:"close-button"},[...a[23]||(a[23]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Ru,[(s(),i(me,null,he(p,(R,K)=>e("div",{key:K,class:X(["step",{active:r.value===K,completed:r.value>K}])},[e("div",Mu,[r.value>K?(s(),i("i",Eu)):(s(),i("span",Au,f(K+1),1))]),e("span",Lu,f(R.label),1)],2)),64))]),e("div",Ou,[r.value===0?(s(),i("div",Pu,[a[29]||(a[29]=e("h3",null,"Device Information",-1)),e("div",Vu,[a[25]||(a[25]=e("label",null,"Platform Type *",-1)),J(e("select",{"onUpdate:modelValue":a[0]||(a[0]=R=>g.value.platform=R),onChange:De},[...a[24]||(a[24]=[He('<option value="" data-v-2e218e9d>Select platform...</option><option value="climate" data-v-2e218e9d>ğŸŒ¡ï¸ Climate (AC, Heater, Heat Pump)</option><option value="media_player" data-v-2e218e9d>ğŸ“º Media Player (TV, Receiver)</option><option value="fan" data-v-2e218e9d>ğŸŒ€ Fan</option><option value="light" data-v-2e218e9d>ğŸ’¡ Light (LED Strip, IR Light)</option>',5)])],544),[[Ie,g.value.platform]])]),e("div",Uu,[a[26]||(a[26]=e("label",null,"Manufacturer *",-1)),J(e("input",{"onUpdate:modelValue":a[1]||(a[1]=R=>g.value.manufacturer=R),type:"text",placeholder:"e.g., Daikin, LG, Samsung"},null,512),[[Le,g.value.manufacturer]])]),e("div",Fu,[a[27]||(a[27]=e("label",null,"Model(s) *",-1)),J(e("input",{"onUpdate:modelValue":a[2]||(a[2]=R=>g.value.model=R),type:"text",placeholder:"e.g., FTXS35K, Multiple models"},null,512),[[Le,g.value.model]]),a[28]||(a[28]=e("small",null,'Enter model number or "Multiple" if it works with many models',-1))])])):x("",!0),r.value===1?(s(),i("div",ju,[g.value.platform==="climate"?(s(),je(nd,{key:0,modelValue:g.value.config,"onUpdate:modelValue":a[3]||(a[3]=R=>g.value.config=R)},null,8,["modelValue"])):g.value.platform==="media_player"?(s(),i("div",Nu,[a[36]||(a[36]=e("h3",null,"Media Player Configuration",-1)),a[37]||(a[37]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),T(" Configure the features your media player supports. You'll learn the IR commands in the next step. ")],-1)),e("div",Bu,[a[35]||(a[35]=e("h4",null,"Supported Features",-1)),e("div",Hu,[e("label",qu,[J(e("input",{type:"checkbox",value:"turn_on","onUpdate:modelValue":a[4]||(a[4]=R=>P.value=R)},null,512),[[ve,P.value]]),a[30]||(a[30]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),T(" Power On/Off ")],-1))]),e("label",zu,[J(e("input",{type:"checkbox",value:"volume","onUpdate:modelValue":a[5]||(a[5]=R=>P.value=R)},null,512),[[ve,P.value]]),a[31]||(a[31]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-volume-high"}),T(" Volume Control ")],-1))]),e("label",Ju,[J(e("input",{type:"checkbox",value:"mute","onUpdate:modelValue":a[6]||(a[6]=R=>P.value=R)},null,512),[[ve,P.value]]),a[32]||(a[32]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-volume-mute"}),T(" Mute ")],-1))]),e("label",Wu,[J(e("input",{type:"checkbox",value:"source","onUpdate:modelValue":a[7]||(a[7]=R=>P.value=R)},null,512),[[ve,P.value]]),a[33]||(a[33]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-import"}),T(" Source Selection ")],-1))]),e("label",Gu,[J(e("input",{type:"checkbox",value:"channel","onUpdate:modelValue":a[8]||(a[8]=R=>P.value=R)},null,512),[[ve,P.value]]),a[34]||(a[34]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-numeric"}),T(" Channel Control ")],-1))])])])])):g.value.platform==="fan"?(s(),i("div",Ku,[a[44]||(a[44]=e("h3",null,"Fan Configuration",-1)),a[45]||(a[45]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),T(" Configure the features your fan supports. You'll learn the IR commands in the next step. ")],-1)),e("div",Xu,[a[40]||(a[40]=e("h4",null,"Fan Speed Levels",-1)),e("div",Yu,[a[39]||(a[39]=e("label",null,"Number of Speed Levels *",-1)),J(e("select",{"onUpdate:modelValue":a[9]||(a[9]=R=>z.value=R)},[...a[38]||(a[38]=[e("option",{value:1},"1 Speed",-1),e("option",{value:2},"2 Speeds",-1),e("option",{value:3},"3 Speeds (Low/Med/High)",-1),e("option",{value:4},"4 Speeds",-1),e("option",{value:5},"5 Speeds",-1),e("option",{value:6},"6 Speeds",-1)])],512),[[Ie,z.value,void 0,{number:!0}]])])]),e("div",Zu,[a[43]||(a[43]=e("h4",null,"Additional Features",-1)),e("div",Qu,[e("label",ec,[J(e("input",{type:"checkbox",value:"oscillate","onUpdate:modelValue":a[10]||(a[10]=R=>G.value=R)},null,512),[[ve,G.value]]),a[41]||(a[41]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-sync"}),T(" Oscillation ")],-1))]),e("label",tc,[J(e("input",{type:"checkbox",value:"direction","onUpdate:modelValue":a[11]||(a[11]=R=>G.value=R)},null,512),[[ve,G.value]]),a[42]||(a[42]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-rotate-3d-variant"}),T(" Direction (Forward/Reverse) ")],-1))])])])])):g.value.platform==="light"?(s(),i("div",oc,[a[51]||(a[51]=e("h3",null,"Light Configuration",-1)),a[52]||(a[52]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),T(" Configure the features your light supports. You'll learn the IR commands in the next step. ")],-1)),e("div",lc,[a[50]||(a[50]=e("h4",null,"Supported Features",-1)),e("div",nc,[e("label",sc,[J(e("input",{type:"checkbox",value:"turn_on","onUpdate:modelValue":a[12]||(a[12]=R=>Z.value=R)},null,512),[[ve,Z.value]]),a[46]||(a[46]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),T(" Power On/Off ")],-1))]),e("label",ac,[J(e("input",{type:"checkbox",value:"brightness","onUpdate:modelValue":a[13]||(a[13]=R=>Z.value=R)},null,512),[[ve,Z.value]]),a[47]||(a[47]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-brightness-6"}),T(" Brightness Control ")],-1))]),e("label",ic,[J(e("input",{type:"checkbox",value:"color_temp","onUpdate:modelValue":a[14]||(a[14]=R=>Z.value=R)},null,512),[[ve,Z.value]]),a[48]||(a[48]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-thermometer"}),T(" Color Temperature ")],-1))]),e("label",rc,[J(e("input",{type:"checkbox",value:"rgb","onUpdate:modelValue":a[15]||(a[15]=R=>Z.value=R)},null,512),[[ve,Z.value]]),a[49]||(a[49]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-palette"}),T(" RGB Color ")],-1))])])])])):x("",!0)])):x("",!0),r.value===2?(s(),i("div",dc,[ge(Vd,{modelValue:g.value.commands,"onUpdate:modelValue":a[16]||(a[16]=R=>g.value.commands=R),platform:g.value.platform,config:g.value.config,broadlinkDevice:g.value.broadlinkDevice,"onUpdate:broadlinkDevice":a[17]||(a[17]=R=>g.value.broadlinkDevice=R),manufacturer:g.value.manufacturer,model:g.value.model,commandType:g.value.commandType,"onUpdate:commandType":a[18]||(a[18]=R=>g.value.commandType=R)},null,8,["modelValue","platform","config","broadlinkDevice","manufacturer","model","commandType"])])):x("",!0),r.value===3?(s(),i("div",uc,[ge(ru,{profile:g.value,"json-data":ye.value,"yaml-config":Te.value},null,8,["profile","json-data","yaml-config"])])):x("",!0)]),e("div",cc,[r.value>0?(s(),i("button",{key:0,onClick:pe,class:"btn-secondary"},[...a[53]||(a[53]=[e("i",{class:"mdi mdi-arrow-left"},null,-1),T(" Back ",-1)])])):x("",!0),a[57]||(a[57]=e("div",{class:"spacer"},null,-1)),e("button",{onClick:ue,class:"btn-text"}," Cancel "),r.value<p.length-1?(s(),i("button",{key:1,onClick:V,class:"btn-primary",disabled:!ie.value},[...a[54]||(a[54]=[T(" Next ",-1),e("i",{class:"mdi mdi-arrow-right"},null,-1)])],8,mc)):(s(),i("div",vc,[e("button",{onClick:Ae,class:"btn-primary",disabled:m.value},[a[55]||(a[55]=e("i",{class:"mdi mdi-cloud-upload"},null,-1)),T(" "+f(m.value?"Saving...":"Save to SmartIR"),1)],8,pc),e("button",{onClick:ee,class:"btn-secondary",disabled:m.value},[...a[56]||(a[56]=[e("i",{class:"mdi mdi-download"},null,-1),T(" Download JSON ",-1)])],8,fc)]))])]),ge(Tu,{show:I.value,platform:g.value.platform,warnings:_.value,"config-path":E.value,onClose:a[20]||(a[20]=R=>I.value=!1),onComplete:Pe},null,8,["show","platform","warnings","config-path"]),ge(Be,{isOpen:O.value,title:"Change Command Type?",message:"Changing the command type will clear all learned commands. Continue?",confirmText:"Continue",cancelText:"Cancel",dangerMode:!0,onConfirm:D,onCancel:v},null,8,["isOpen"]),ge(Be,{isOpen:F.value,title:"Close Profile Builder?",message:"Are you sure you want to close? Your progress will be lost.",confirmText:"Close",cancelText:"Keep Editing",dangerMode:!0,onConfirm:fe,onCancel:a[21]||(a[21]=R=>F.value=!1)},null,8,["isOpen"])])):x("",!0)}},yc=$e(gc,[["__scopeId","data-v-2e218e9d"]]),bc={class:"dashboard"},hc={key:1,class:"welcome-banner"},kc={__name:"Dashboard",setup(t){const c=Ge(),d=Me("smartirEnabled"),{isMobile:$}=ot(),w=b(!1),r=b(!1),m=b(null),y=b(0),I=b(null),_=b(localStorage.getItem("welcome_banner_dismissed")==="true");function E(){_.value=!0,localStorage.setItem("welcome_banner_dismissed","true")}function k(){r.value=!1,m.value=null,y.value=0,w.value=!0}async function o({platform:N,profile:L,startStep:l}){y.value=Number.isInteger(l)?l:0;try{const p=await fetch(`api/smartir/platforms/${N}/profiles/${L.code}`);if(!p.ok)throw new Error("Failed to load profile");const g=await p.json();let P="";try{const z=await fetch(`api/smartir/config/get-device?platform=${N}&code=${L.code}`);z.ok?(P=(await z.json()).controller_data||"",console.log("âœ… Found controller_data from YAML:",P)):console.warn("âš ï¸ No YAML entry found for this profile (this is OK for profiles not yet added to config)")}catch(z){console.warn("âš ï¸ Could not fetch controller_data from config:",z)}r.value=!0,m.value={platform:N,code:L.code,profile:{...g.profile,controller_data:P}},w.value=!0}catch(p){console.error("Error loading profile for edit:",p),c.error("Failed to load profile for editing")}}function O(){w.value=!1,r.value=!1,m.value=null}async function F(N){console.log("Profile saved:",N),O(),I.value&&I.value.loadAllProfiles&&(await I.value.loadAllProfiles(),console.log("âœ… Profiles list refreshed"))}return(N,L)=>(s(),i("div",bc,[_e(d)?(s(),je(ua,{key:0})):x("",!0),!_e($)&&!_.value?(s(),i("div",hc,[e("button",{class:"dismiss-button",onClick:E,title:"Dismiss"},[...L[0]||(L[0]=[e("i",{class:"mdi mdi-close"},null,-1)])]),L[1]||(L[1]=He('<div class="banner-content" data-v-12185d74><div class="banner-icon" data-v-12185d74><i class="mdi mdi-rocket-launch" data-v-12185d74></i></div><div class="banner-text" data-v-12185d74><h2 data-v-12185d74>Welcome to Broadlink Manager v2!</h2><p data-v-12185d74>Manage your IR/RF devices with a modern Vue 3 interface</p></div></div><div class="status-badges" data-v-12185d74><span class="badge success" data-v-12185d74><i class="mdi mdi-check-circle" data-v-12185d74></i> Vue 3 Ready </span><span class="badge warning" data-v-12185d74><i class="mdi mdi-beta" data-v-12185d74></i> Beta </span></div>',2))])):x("",!0),ge(na),_e(d)?(s(),je(rr,{key:2,ref_key:"smartirStatusCard",ref:I,onCreateProfile:k,onEditProfile:o},null,512)):x("",!0),ge(yc,{show:w.value,editMode:r.value,editData:m.value,startStep:y.value,onClose:O,onSave:F},null,8,["show","editMode","editData","startStep"])]))}},wc=$e(kc,[["__scopeId","data-v-12185d74"]]),$c={class:"toast-container"},Cc={class:"toast-content"},_c={key:0,class:"toast-title"},Sc={class:"toast-message"},Ic={key:1,class:"toast-description"},Dc=["onClick","title"],Tc={__name:"Toast",setup(t,{expose:c}){const d=b([]);let $=0;function w(y){const I={success:"mdi-check-circle",error:"mdi-alert-circle",warning:"mdi-alert",info:"mdi-information"};return I[y]||I.info}function r({message:y,title:I,description:_,type:E="info",duration:k=5e3}){const o=$++,O={id:o,message:y,title:I,description:_,type:E};return d.value.push(O),k>0&&setTimeout(()=>{m(o)},k),o}function m(y){const I=d.value.findIndex(_=>_.id===y);I>-1&&d.value.splice(I,1)}return c({addToast:r,removeToast:m,show:r,success:(y,I)=>r({message:y,title:I,type:"success"}),error:(y,I)=>r({message:y,title:I,type:"error",duration:0}),warning:(y,I)=>r({message:y,title:I,type:"warning",duration:0}),info:(y,I)=>r({message:y,title:I,type:"info"})}),(y,I)=>(s(),je(it,{to:"body"},[e("div",$c,[ge(gt,{name:"toast"},{default:tt(()=>[(s(!0),i(me,null,he(d.value,_=>(s(),i("div",{key:_.id,class:X(["toast",[`toast-${_.type}`,{"toast-persistent":_.type==="error"||_.type==="warning"}]])},[e("i",{class:X(["mdi",w(_.type)])},null,2),e("div",Cc,[_.title?(s(),i("div",_c,f(_.title),1)):x("",!0),e("div",Sc,f(_.message),1),_.description?(s(),i("div",Ic,f(_.description),1)):x("",!0)]),e("button",{onClick:E=>m(_.id),class:X(["toast-close",{"toast-close-prominent":_.type==="error"||_.type==="warning"}]),title:_.type==="error"||_.type==="warning"?"Click to dismiss":"Close"},[...I[0]||(I[0]=[e("i",{class:"mdi mdi-close"},null,-1)])],10,Dc)],2))),128))]),_:1})])]))}},xc=$e(Tc,[["__scopeId","data-v-3948c088"]]),Rc="0.3.0-alpha.2",Mc={version:Rc},Ec={id:"app",class:"app-container"},Ac={class:"app-header"},Lc={class:"header-content"},Oc={class:"header-right"},Pc=["title"],Vc={class:"settings-menu-container"},Uc={key:0,class:"settings-menu"},Fc=["title"],jc={class:"toggle-content"},Nc={key:0,class:"not-installed-label"},Bc={key:0,href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"menu-item menu-link menu-subitem"},Hc=["disabled"],qc=["disabled"],zc=["disabled"],Jc={class:"app-main"},Wc={class:"app-footer"},Gc={__name:"App",setup(t){const c=b(null),d=Mc.version,$=b("light"),w=b(null),r=b(!1),m=b(!1),y=b(!1),I=b(localStorage.getItem("smartir_enabled")!=="false"),_=W(()=>{var g;return((g=w.value)==null?void 0:g.installed)||!1}),E=W(()=>({light:"mdi mdi-weather-sunny",medium:"mdi mdi-weather-partly-cloudy",dark:"mdi mdi-weather-night"})[$.value]),k=W(()=>({light:"Switch to Medium Theme",medium:"Switch to Dark Theme",dark:"Switch to Light Theme"})[$.value]),o=()=>{const g=["light","medium","dark"],z=(g.indexOf($.value)+1)%g.length;$.value=g[z],document.body.classList.remove("medium-mode","dark-mode"),$.value==="medium"?document.body.classList.add("medium-mode"):$.value==="dark"&&document.body.classList.add("dark-mode"),localStorage.setItem("theme",$.value)},O=async()=>{try{const g=await ut.getStatus();w.value=g,g.installed?console.log("âœ… SmartIR detected:",g.version):console.log("â„¹ï¸ SmartIR not detected")}catch(g){console.error("Error checking SmartIR:",g),w.value={installed:!1,error:g.message}}},F=async()=>{var g,P,z;m.value=!0;try{const Z=(await te.get("/api/diagnostics/markdown")).data.markdown;if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(Z),(g=c.value)==null||g.success("Diagnostic summary copied to clipboard!");else{const H=document.createElement("textarea");H.value=Z,H.style.position="fixed",H.style.left="-999999px",H.style.top="-999999px",document.body.appendChild(H),H.focus(),H.select();try{if(document.execCommand("copy"))(P=c.value)==null||P.success("Diagnostic summary copied to clipboard!");else throw new Error("execCommand failed")}finally{document.body.removeChild(H)}}r.value=!1}catch(G){console.error("Error copying diagnostics:",G),(z=c.value)==null||z.error("Failed to copy diagnostics: "+G.message)}finally{m.value=!1}},N=async()=>{var g,P;m.value=!0;try{const z=await te.get("/api/diagnostics/download",{responseType:"blob"}),G=window.URL.createObjectURL(new Blob([z.data])),Z=document.createElement("a");Z.href=G;const H=z.headers["content-disposition"];let M="broadlink_manager_diagnostics.zip";if(H){const U=H.match(/filename="?(.+)"?/);U&&(M=U[1])}Z.setAttribute("download",M),document.body.appendChild(Z),Z.click(),Z.remove(),window.URL.revokeObjectURL(G),(g=c.value)==null||g.success("Diagnostic bundle downloaded!"),r.value=!1}catch(z){console.error("Error downloading diagnostics:",z),(P=c.value)==null||P.error("Failed to download diagnostics")}finally{m.value=!1}},L=g=>{g.target.closest(".settings-menu-container")||(r.value=!1)};xe(()=>{document.addEventListener("click",L)}),We(()=>{document.removeEventListener("click",L)});const l=()=>{_.value&&(I.value=!I.value,localStorage.setItem("smartir_enabled",I.value.toString()),window.location.reload())},p=async()=>{var g,P,z;y.value=!0;try{const G=await te.post("/api/smartir/refresh-index");G.data.success?(g=c.value)==null||g.success(`Updated to v${G.data.version} (${G.data.total_devices} devices)`,"âœ… Index Updated"):(P=c.value)==null||P.error(G.data.error||"Unknown error","âŒ Update Failed")}catch(G){console.error("Error updating SmartIR index:",G),(z=c.value)==null||z.error("Failed to update device index","âŒ Update Error")}finally{y.value=!1,r.value=!1}};return xe(async()=>{const g=localStorage.getItem("theme");g&&["light","medium","dark"].includes(g)?($.value=g,g==="medium"?document.body.classList.add("medium-mode"):g==="dark"&&document.body.classList.add("dark-mode")):localStorage.getItem("darkMode")==="true"&&($.value="dark",document.body.classList.add("dark-mode"),localStorage.setItem("theme","dark")),await O();const P=nt();P&&c.value&&(P.appContext.config.globalProperties.$toast=c.value),document.addEventListener("click",L)}),We(()=>{document.removeEventListener("click",L)}),Xe("smartirStatus",w),Xe("smartirEnabled",I),Xe("refreshSmartIR",O),Xe("toast",c),(g,P)=>(s(),i("div",Ec,[e("header",Ac,[e("div",Lc,[P[13]||(P[13]=e("div",{class:"header-left"},[e("i",{class:"mdi mdi-remote"}),e("h1",null,"Broadlink Manager v2"),e("span",{class:"beta-badge"},"BETA")],-1)),e("div",Oc,[e("button",{onClick:o,class:"icon-button",title:k.value},[e("i",{class:X(E.value)},null,2)],8,Pc),e("div",Vc,[e("button",{onClick:P[0]||(P[0]=z=>r.value=!r.value),class:"icon-button",title:"Settings"},[...P[2]||(P[2]=[e("i",{class:"mdi mdi-cog"},null,-1)])]),r.value?(s(),i("div",Uc,[P[9]||(P[9]=e("div",{class:"menu-section-title"},"Integration Settings",-1)),e("div",{class:X(["menu-item toggle-item",{disabled:!_.value}]),onClick:P[1]||(P[1]=z=>_.value?l():null),title:_.value?"":"SmartIR is not installed"},[e("div",jc,[P[3]||(P[3]=e("i",{class:"mdi mdi-air-conditioner"},null,-1)),P[4]||(P[4]=e("span",null,"SmartIR Integration",-1)),_.value?x("",!0):(s(),i("span",Nc,"(Not Installed)"))]),e("div",{class:X(["toggle-switch",{active:I.value&&_.value,disabled:!_.value}])},[...P[5]||(P[5]=[e("div",{class:"toggle-slider"},null,-1)])],2)],10,Fc),I.value?(s(),i("a",Bc,[...P[6]||(P[6]=[e("i",{class:"mdi mdi-github"},null,-1),e("span",null,"SmartIR on GitHub",-1)])])):x("",!0),I.value?(s(),i("button",{key:1,onClick:p,class:"menu-item menu-subitem",disabled:y.value},[e("i",{class:X(["mdi",y.value?"mdi-loading mdi-spin":"mdi-refresh"])},null,2),e("span",null,f(y.value?"Updating...":"Update Device Index"),1)],8,Hc)):x("",!0),P[10]||(P[10]=e("div",{class:"menu-divider"},null,-1)),P[11]||(P[11]=e("div",{class:"menu-section-title"},"Diagnostics",-1)),e("button",{onClick:F,class:"menu-item",disabled:m.value},[...P[7]||(P[7]=[e("i",{class:"mdi mdi-content-copy"},null,-1),e("span",null,"Copy Diagnostics",-1)])],8,qc),e("button",{onClick:N,class:"menu-item",disabled:m.value},[...P[8]||(P[8]=[e("i",{class:"mdi mdi-download"},null,-1),e("span",null,"Download Diagnostics",-1)])],8,zc),P[12]||(P[12]=He('<div class="menu-divider" data-v-96564cf9></div><div class="menu-section-title" data-v-96564cf9>Help &amp; Support</div><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2#readme" target="_blank" class="menu-item menu-link" data-v-96564cf9><i class="mdi mdi-book-open-variant" data-v-96564cf9></i><span data-v-96564cf9>Documentation</span></a><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2/issues" target="_blank" class="menu-item menu-link" data-v-96564cf9><i class="mdi mdi-bug" data-v-96564cf9></i><span data-v-96564cf9>Report Issue</span></a><div class="menu-divider" data-v-96564cf9></div><div class="menu-section-title" data-v-96564cf9>Community</div><a href="https://community.home-assistant.io/t/broadlink-manager-modern-web-interface-for-broadlink-devices/938473" target="_blank" class="menu-item menu-link" data-v-96564cf9><i class="mdi mdi-forum" data-v-96564cf9></i><span data-v-96564cf9>HA Forum Discussion</span></a><a href="https://www.reddit.com/r/homeassistant/comments/1o1q3kf/release_broadlink_manager_addon_a_modern_web_ui/" target="_blank" class="menu-item menu-link" data-v-96564cf9><i class="mdi mdi-reddit" data-v-96564cf9></i><span data-v-96564cf9>Reddit Discussion</span></a><div class="menu-divider" data-v-96564cf9></div><div class="menu-section-title" data-v-96564cf9>Project</div><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2" target="_blank" class="menu-item menu-link" data-v-96564cf9><i class="mdi mdi-github" data-v-96564cf9></i><span data-v-96564cf9>GitHub Repository</span></a><a href="https://ko-fi.com/tonyperkins" target="_blank" class="menu-item menu-link menu-item-sponsor" data-v-96564cf9><i class="mdi mdi-coffee" data-v-96564cf9></i><span data-v-96564cf9>Support on Ko-fi</span></a>',12))])):x("",!0)])])])]),e("main",Jc,[ge(wc)]),e("footer",Wc,[e("p",null,"Broadlink Manager v"+f(_e(d))+" | Built with Vue "+f(yt),1)]),ge(xc,{ref_key:"toastRef",ref:c},null,512)]))}},Kc=$e(Gc,[["__scopeId","data-v-96564cf9"]]),ct=bt(Kc),Xc=ht();ct.use(Xc);ct.mount("#app");
