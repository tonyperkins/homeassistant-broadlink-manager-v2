import{g as qe,a as Qe,d as et,c as J,r as y,o as Te,b as s,e as n,f as e,h as M,n as Z,u as $e,t as u,i as _,F as me,j as he,w as fe,k as z,v as _e,l as ge,m as Je,p as ye,q as je,s as Ne,T as ze,x as we,y as Ce,z as Oe,A as pe,B as Ge,C as Ue,D as Re,E as We,G as Ke,H as tt,I as ot,J as lt,K as Pe,L as nt,M as st}from"./vendor-DHe6d6Ka.js";(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const $ of document.querySelectorAll('link[rel="modulepreload"]'))w($);new MutationObserver($=>{for(const l of $)if(l.type==="childList")for(const m of l.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&w(m)}).observe(document,{childList:!0,subtree:!0});function d($){const l={};return $.integrity&&(l.integrity=$.integrity),$.referrerPolicy&&(l.referrerPolicy=$.referrerPolicy),$.crossOrigin==="use-credentials"?l.credentials="include":$.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function w($){if($.ep)return;$.ep=!0;const l=d($);fetch($.href,l)}})();function Ve(){const o=qe(),c=o==null?void 0:o.appContext.config.globalProperties.$toast;return c||(console.warn("Toast not available"),{success:d=>console.log("Success:",d),error:d=>console.error("Error:",d),warning:d=>console.warn("Warning:",d),info:d=>console.info("Info:",d)})}const Be="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAHBUlEQVR4nOxZC1BTVxo+9+aNZI2LNsgjWR4hgoIiRVDBslKnIKPbx1jqTrtYoakat1a6dNsdd7t1X8XHyAbEhdUu1u2mXdbasqJbtsaMIqBBECiPBmqEICEBEx4xJLlJ7s6lw6rJDeQ2FzLM+M1kBs7/3+/83zn/Oee/51JRFAXzGbCvA/AWjwX4GvNeANWXnXffHQ4+K6/dYbHeD+IFhjRkb1wn9WPQbEQ4IF/tQlXX2p5+/8OyczY74j/VxuMG3Sh/Oz9jaQDb4CmPT1LIbLXBfzrz0cmHg8fQpx1Yc1Ra+TsiXD4R0PqtRmAyj/LxbJeaujKIcPlEAINOM7vLXBaTZibCRWgRq3WGJZWX63aoNDpB8BJOX/bGlIqwpUv6iXBgWBHG7eUF8urUWvU6Z9sLGxI/IsLl8SJu6u4XigqPXkVspiVTbTQqU1/6Vn7ammh+G5FOMZyqludIKqUVU/9jcaSuTCo/unfHbiad4iBdwMu/P1bV1tO1xbk9NDC0/vwHB1xGcjqYLAh16zsHW3R6XXTu1mfFdAqMrIoSKNbGhLcQ4QGeppDJ7ACtPcqNEI6tT9O3Vqm+tygqNMDjrU9Sef6tIYM2JjUuuXzfC5knCEXsBI8WMZUCAxiCrfhWyMZkMNzYXNHVpwmXXqp5j0Hz0/1m57a3PQ8VHx4JoNMASIl9shLPFsB5ooO7iDXhCY/dAcCvT/79LwC1s/K2bDnAXcQeJRqwMzzeRt/bua0gLChcDsCDNQNBkEU/qot7o6j0kzETQpuJ40ZnT6xSrUoNWhyseHVz2ikv4n4QA5FSArE5IFlTZ0r3XU1MWODib6NCl3a9dkhSYxgbjo4XLq8sL9j7Ip36YEwMRjMNQazMhf7+RgYNnuyo7bY6ArFaWKuXRX495wLwoLk39sO9RaVnM5OTP8zLSjtjsljpp6ovi6pqr706eE8XBwGUSqEy9Guihf/92TMZhetjI5rJCHwKpBRzZqsNYtKp6KD+Pvv1w5ILdzR3UvD8HA4YefOl7N25JKUPIKuUwIJH7A5of/GJf7oLfrIz2EH786fSss+uKFzOk+8L0mqh6rpbmR0q5YyFGAQBSuHHlcUWxEaZyXfMhFD0Rgt9Oh/SBMiam58HAO+oc4XZMsK/1taT6M6uHjJw8w6VSNfvemM8TbzPlFlwsP5KyzfJeL6kCejXDgo894aASqOZ9O/uHwzq6B3ijhitkzOC7XS7j0g+V3S0vQTDDhYEoZSBobvJ+yXFNZ29gy4lOGmvlDBMIfQqSKV8539EWvXHhvbGHBSFrAwGW+vvxzLoR7RxzrNpsyPs0xcv7/lg1/ZfPtKvuw7MVhulUakWdvRq+XY3tWFT90Bk+52BCOzvyOBgjytSFKAgms+b9F/2o+BbKwUrvgjhhjSjKLAPG4YE7lJxfEIf5dyGOwMXrren/eF0RYXRNMrHDt4QbmjDEbHop9F8rqpddZd3sV6R/aWiabtWr41PW534V8m+PFHW+qSPL9TX7oM8WAaBi4IbE4S8yYNs/7asIgBA0ZStRqFM/MXxIzcgHBEBP+C6DJKLgJvK3uXvniitBsDmNzkSEAD9uv5k0aFjXy1gMQ0DQ5p4CAIwNuXLwyL/ExcpqMWeS42NUmxKXFf8VWPdz6cLnkqhGd/Pe+U1Cow/+ekJUYr4qJgvbik7f/Jw+0J/tjpvS3qxs7/LQZZfcrrkUmOdGI/cgUKIkB8pz0xK+CQjKf6z4MWckYftZqsderfsTInsZt0evDRgMRYMHhaLnk+NW1Y/nchxk5lZ+I/Pf/vl9RvbLYiVlSBcJv/VK9sKBCHc3hkF7D12/NzVltZn8YhzNj/3ev6LGeXTdQ6+uzLZ+C+5XNza05Nsd1gXcNgBvekJK/+du3lTUSiXMzzT80TgkkK8wJAGgCMAE5ooFFz3hHTr+lgZ9iMryOngkoi5WZuOc9hPtDu3r4198nTqygjCr3wYmrvVkSerZXljJoT0m0DcYm5g2Mg5WV39zrVWZZofkzaRnhB/bufm9FI/JpXQXj8F8bHyitqWxhzJmwUJT60SNJER+P+BCZjt34lzNbvickRoWVWNmGzuObnYWhER3oAdX41dPbj1jDeYEwGrInltKKCNtatub6hRfJOEnfJkcc+JgE9ltS/DkINuNI3xCo4fbXgm/0CnouvOcjK4Z/16/ZKia+3+kqIrEIQ+sgNx2Jzb5wsPxrD9GBZv+Gd9BqSXr4icg8cwMj4SLmv6+mlv+WddgGlilOPOZkEmFnrLP+sCVgtXyPHaHShkiw0XXPWWf9YF5Gb9uGzp4sCbj7ai4LkNTx2O5nPV3vLPyTeye6P32X+7KNujVKtSYJg+viEu/mx2etJZCgnD57OPfGRh3n8nfizA15j3Av4XAAD//5k1S2w3zfwVAAAAAElFTkSuQmCC",ce=Qe.create({baseURL:"./",timeout:3e4,headers:{"Content-Type":"application/json"}});ce.interceptors.request.use(o=>o,o=>Promise.reject(o));ce.interceptors.response.use(o=>o,o=>(console.error("API Error:",o),o.response?console.error("Response error:",o.response.data):o.request?console.error("No response received"):console.error("Request setup error:",o.message),Promise.reject(o)));const at=et("devices",{state:()=>({devices:[],loading:!1,error:null,selectedDevice:null}),getters:{deviceById:o=>c=>o.devices.find(d=>d.id===c),devicesByType:o=>c=>o.devices.filter(d=>d.entity_type===c),deviceCount:o=>o.devices.length,hasDevices:o=>o.devices.length>0},actions:{async loadDevices(o=!1){this.loading=!0,this.error=null;try{const c=o?`/api/devices/managed?_t=${Date.now()}`:"/api/devices/managed",d=await ce.get(c);this.devices=d.data.devices||[],console.log("📥 Loaded devices:",this.devices),this.devices.forEach(w=>{console.log(`📥 Device "${w.name}":`,{id:w.id,device:w.device,commands:w.commands,commandCount:w.commands?Object.keys(w.commands).length:0})})}catch(c){this.error=c.message,console.error("Error loading devices:",c)}finally{this.loading=!1}},async createDevice(o){this.loading=!0,this.error=null;try{console.log("🏪 Store: Creating device with data:",o),console.log("🏪 Store: Device commands being sent:",o.commands);const c={device_name:o.name,device:o.device,area_id:o.area||"",area_name:o.area||"",entity_type:o.entity_type,icon:o.icon,broadlink_entity:o.broadlink_entity,device_type:o.device_type||"broadlink",commands:o.commands||{}};o.device_type==="smartir"&&o.smartir_config&&(c.smartir_config=o.smartir_config),console.log("🏪 Store: Transformed data for backend:",c);const d=await ce.post("/api/devices/managed",c);return console.log("🏪 Store: Create response:",d.data),await this.loadDevices(),d.data}catch(c){throw console.error("Error creating device:",c),c}finally{this.loading=!1}},async updateDevice(o,c){this.loading=!0,this.error=null;try{const d=await ce.put(`/api/devices/managed/${o}`,c);return await this.loadDevices(),d.data}catch(d){throw console.error("Error updating device:",d),d}finally{this.loading=!1}},async deleteDevice(o,c=!1){this.loading=!0,this.error=null;try{await ce.delete(`/api/devices/managed/${o}`,{data:{delete_commands:c}}),this.devices=this.devices.filter(d=>d.id!==o)}catch(d){throw this.error=d.message,console.error("Error deleting device:",d),d}finally{this.loading=!1}},selectDevice(o){this.selectedDevice=o},clearSelection(){this.selectedDevice=null},clearError(){this.error=null},async syncAllAreas(){if(!this.devices||this.devices.length===0){console.log("⚠️ No devices to sync");return}console.log(`🔄 Syncing areas from Home Assistant for ${this.devices.length} devices...`);try{const o=await Promise.all(this.devices.map(w=>(console.log(`🔄 Syncing device: ${w.id} (${w.name})`),ce.post(`/api/devices/${w.id}/sync-area`).then($=>$.data.success&&$.data.area?(console.log(`✅ Synced area for ${w.name}: ${$.data.area}`),{status:"synced",device:w.name}):{status:"no_area"}).catch($=>{var l;return((l=$.response)==null?void 0:l.status)===404?(console.log(`❌ Device not found in HA: ${w.id}`),{status:"not_found"}):(console.warn(`⚠️ Failed to sync area for ${w.id}:`,$.message),{status:"error",error:$.message})})))),c=o.filter(w=>w.status==="synced").length,d=o.filter(w=>w.status==="not_found").length;await this.loadDevices(!0),c>0?console.log(`✅ Area sync complete: ${c} synced, ${d} not found in HA`):d>0&&console.log(`ℹ️ No areas synced - ${d} entities not found in HA registry (generate entities first)`)}catch(o){console.debug("Area sync error:",o)}}}});function Xe(o){const c=J(()=>o.value||o),d=J(()=>{switch(c.value){case"climate":return"mdi:air-conditioner";case"fan":return"mdi:fan";case"light":return"mdi:lightbulb";case"media_player":return"mdi:television";case"switch":return"mdi:light-switch";default:return"mdi:devices"}}),w=J(()=>`device-type-${c.value}-color`),$=J(()=>`tag-${c.value}-bg`);return{icon:d,colorClass:w,tagBgClass:$}}const it=""+new URL("broadlink-logo-BDjImjRY.png",import.meta.url).href,ke=(o,c)=>{const d=o.__vccOpts||o;for(const[w,$]of c)d[w]=$;return d},rt={class:"device-header"},dt={class:"device-info"},ut=["title"],ct={class:"device-labels"},mt={class:"device-type"},vt=["src","alt","title"],pt={class:"device-body"},ft={class:"device-stats"},gt={class:"stat",title:"Learned command count"},yt={class:"stat",title:"HA Assigned Area"},bt={class:"device-meta"},ht={class:"device-id",title:"Device ID"},kt={key:0,class:"storage-name"},wt={key:1,class:"broadlink-entity",title:"Controller Device"},$t={key:2,class:"controller-device"},Ct={class:"device-actions"},_t=["disabled"],St=["disabled"],It=["disabled"],Dt={key:0,class:"disabled-overlay"},xt={__name:"DeviceCard",props:{device:{type:Object,required:!0},broadlinkDevices:{type:Array,default:()=>[]}},emits:["edit","delete","learn"],setup(o){const c=o,d=J(()=>localStorage.getItem("smartir_simulate_not_installed")==="true"),w=J(()=>c.device.device_type==="smartir"&&d.value),$=y(null),l=Xe(J(()=>c.device.entity_type)),m=J(()=>c.device.icon?c.device.icon:l.icon.value),p=a=>a&&a.startsWith("mdi:")?`mdi ${a.replace(":"," mdi-")}`:`mdi mdi-${a}`,C=J(()=>({light:"Light",fan:"Fan",switch:"Switch",media_player:"Media Player",cover:"Cover"})[c.device.entity_type]||c.device.entity_type),S=J(()=>(c.device.device_type||"broadlink")==="smartir"?"SmartIR":"Broadlink"),V=J(()=>(c.device.device_type||"broadlink")==="smartir"?Be:it),h=J(()=>(c.device.device_type||"broadlink")==="smartir"?$.value!==null?$.value:0:Object.keys(c.device.commands||{}).length),t=a=>{if(!a)return"";const g=c.broadlinkDevices.find(f=>f.entity_id===a);return g&&g.name||a},L=J(()=>{if(!c.device.device)return!1;const a=c.device.id.includes(".")?c.device.id.split(".")[1]:c.device.id;return c.device.device!==a}),B=J(()=>{if(!c.device.broadlink_entity)return"";const a=c.broadlinkDevices.find(g=>g.entity_id===c.device.broadlink_entity);return a&&a.name||c.device.broadlink_entity}),P=a=>{if(!a||typeof a!="object")return 0;let g=0;for(const f of Object.values(a))typeof f=="string"?g++:typeof f=="object"&&(g+=P(f));return g},T=async()=>{if(!(!c.device.device_code||!c.device.entity_type))try{const a=await ce.get("/api/smartir/codes/code",{params:{entity_type:c.device.entity_type,code_id:c.device.device_code}});if(a.data.success&&a.data.code){const g=a.data.code;g.commands&&($.value=P(g.commands))}}catch(a){console.error("Error fetching SmartIR command count:",a)}};return Te(async()=>{(c.device.device_type||"broadlink")==="smartir"&&await T()}),(a,g)=>(n(),s("div",{class:Z(["device-card",{disabled:w.value}])},[e("div",rt,[e("div",{class:Z(["device-icon",$e(l).colorClass.value])},[e("i",{class:Z(p(m.value))},null,2)],2),e("div",dt,[e("h3",{title:o.device.name},u(o.device.name),9,ut),e("div",ct,[e("span",mt,u(C.value),1)])]),e("img",{src:V.value,alt:S.value,title:S.value,class:"device-source-logo"},null,8,vt)]),e("div",pt,[e("div",ft,[e("div",gt,[g[3]||(g[3]=e("i",{class:"mdi mdi-remote"},null,-1)),e("span",null,u(h.value)+" command"+u(h.value!==1?"s":""),1)]),e("div",yt,[g[4]||(g[4]=e("i",{class:"mdi mdi-map-marker"},null,-1)),e("span",null,u(o.device.area||"No area"),1)])]),e("div",bt,[e("span",ht,[g[5]||(g[5]=e("i",{class:"mdi mdi-identifier"},null,-1)),_(" "+u(o.device.id),1)]),L.value?(n(),s("span",kt,[g[6]||(g[6]=e("i",{class:"mdi mdi-code-tags"},null,-1)),_(" "+u(o.device.device),1)])):M("",!0),o.device.broadlink_entity?(n(),s("span",wt,[g[7]||(g[7]=e("i",{class:"mdi mdi-access-point"},null,-1)),_(" "+u(B.value),1)])):M("",!0),o.device.controller_device?(n(),s("span",$t,[g[8]||(g[8]=e("i",{class:"mdi mdi-access-point"},null,-1)),_(" "+u(t(o.device.controller_device)),1)])):M("",!0)])]),e("div",Ct,[e("button",{onClick:g[0]||(g[0]=f=>!w.value&&a.$emit("learn",o.device)),class:"icon-btn",title:"Manage Commands",disabled:w.value},[...g[9]||(g[9]=[e("i",{class:"mdi mdi-remote-tv"},null,-1)])],8,_t),e("button",{onClick:g[1]||(g[1]=f=>!w.value&&a.$emit("edit",o.device)),class:"icon-btn",title:"Edit",disabled:w.value},[...g[10]||(g[10]=[e("i",{class:"mdi mdi-pencil"},null,-1)])],8,St),e("button",{onClick:g[2]||(g[2]=f=>!w.value&&a.$emit("delete",o.device)),class:"icon-btn danger",title:"Delete",disabled:w.value},[...g[11]||(g[11]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,It)]),w.value?(n(),s("div",Dt,[...g[12]||(g[12]=[e("div",{class:"disabled-message"},[e("i",{class:"mdi mdi-eye-off"}),e("span",null,"SmartIR Not Installed")],-1)])])):M("",!0)],2))}},Tt=ke(xt,[["__scopeId","data-v-7a7f5c18"]]),Rt={name:"DeviceListView",props:{devices:{type:Array,required:!0}},methods:{getDeviceCommands(o){return o.commands&&typeof o.commands=="object"?Object.keys(o.commands):[]},sendCommand(o,c){this.$emit("send-command",{device:o,command:c})},editDevice(o){this.$emit("edit-device",o)},deleteDevice(o){this.$emit("delete-device",o)}}},Mt={class:"device-list-view"},Lt={class:"device-table"},Ot={class:"device-info"},At={class:"device-name"},Et={class:"device-entity"},Vt={class:"device-area"},jt={class:"device-type"},Pt={class:"device-commands"},Ut={key:0,class:"command-list"},Ft=["onClick"],Nt={key:0,class:"no-commands"},Bt={key:1,class:"smartir-info"},Ht={class:"profile-code"},qt={class:"device-actions"},Jt=["onClick"],zt=["onClick"];function Gt(o,c,d,w,$,l){return n(),s("div",Mt,[e("table",Lt,[c[2]||(c[2]=e("thead",null,[e("tr",null,[e("th",null,"Device"),e("th",null,"Room/Area"),e("th",null,"Type"),e("th",null,"Commands"),e("th",null,"Actions")])],-1)),e("tbody",null,[(n(!0),s(me,null,he(d.devices,m=>(n(),s("tr",{key:m.entity_id,class:"device-row"},[e("td",Ot,[e("div",At,u(m.friendly_name||m.name),1),e("div",Et,u(m.entity_id),1)]),e("td",Vt,u(m.area||"No Area"),1),e("td",jt,[e("span",{class:Z(["type-badge",m.device_type])},u(m.device_type==="smartir"?"SmartIR":"Broadlink"),3)]),e("td",Pt,[m.device_type==="broadlink"?(n(),s("div",Ut,[(n(!0),s(me,null,he(l.getDeviceCommands(m),p=>(n(),s("button",{key:p,class:"command-btn",onClick:C=>l.sendCommand(m,p)},u(p),9,Ft))),128)),l.getDeviceCommands(m).length===0?(n(),s("span",Nt," No commands ")):M("",!0)])):m.device_type==="smartir"?(n(),s("div",Bt,[e("span",Ht,"Profile: "+u(m.device_code),1)])):M("",!0)]),e("td",qt,[e("button",{class:"action-btn edit",onClick:p=>l.editDevice(m),title:"Edit"},[...c[0]||(c[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})],-1)])],8,Jt),e("button",{class:"action-btn delete",onClick:p=>l.deleteDevice(m),title:"Delete"},[...c[1]||(c[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"3 6 5 6 21 6"}),e("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})],-1)])],8,zt)])]))),128))])])])}const Wt=ke(Rt,[["render",Gt],["__scopeId","data-v-34e538b4"]]),Kt={class:"icon-picker"},Xt={class:"icon-input-wrapper"},Yt=["id","placeholder"],Zt={key:0,class:"icon-preview"},Qt={key:0,class:"icon-dropdown"},eo={class:"icon-grid"},to=["onMousedown","title"],oo={__name:"IconPicker",props:{modelValue:{type:String,default:""},inputId:{type:String,default:"icon-input"},placeholder:{type:String,default:"e.g., mdi:television"}},emits:["update:modelValue"],setup(o,{emit:c}){const d=o,w=c,$=y(d.modelValue),l=y(!1),m=["television","speaker","radio","music","video","movie","play","pause","stop","skip-next","skip-previous","volume-high","volume-medium","volume-low","volume-off","remote","remote-tv","cast","chromecast","spotify","netflix","youtube","lightbulb","lightbulb-on","lightbulb-off","lamp","floor-lamp","ceiling-light","light-switch","led-strip","led-strip-variant","wall-sconce","chandelier","spotlight","track-light","vanity-light","desk-lamp","fan","ceiling-fan","air-conditioner","thermometer","thermostat","heat-wave","snowflake","fire","radiator","water-boiler","hvac","blinds","blinds-open","window-shutter","window-shutter-open","curtains","curtains-closed","roller-shade","roller-shade-closed","garage","garage-open","gate","door","door-open","window-open","window-closed","washing-machine","tumble-dryer","dishwasher","refrigerator","stove","microwave","oven","toaster","kettle","coffee","coffee-maker","blender","robot-vacuum","robot-vacuum-variant","vacuum","broom","spray-bottle","lock","lock-open","lock-smart","key","shield","shield-check","alarm-light","bell","doorbell","camera","cctv","motion-sensor","smoke-detector","fire-extinguisher","water-alert","gas-cylinder","sofa","bed","bed-double","desk","chair","table","bookshelf","home","home-outline","home-assistant","floor-plan","room","weather-sunny","weather-night","weather-cloudy","weather-rainy","weather-snowy","weather-lightning","weather-windy","weather-fog","weather-partly-cloudy","umbrella","water","water-percent","phone","cellphone","tablet","laptop","desktop-tower","monitor","keyboard","mouse","printer","router","router-wireless","access-point","wifi","bluetooth","usb","hdmi-port","ethernet","power","power-plug","power-socket","battery","battery-charging","lightning-bolt","flash","solar-panel","solar-power","leaf","tree","flower","sprout","grass","watering-can","shovel","fence","pool","hot-tub","silverware","silverware-fork-knife","food","food-apple","glass-wine","glass-cocktail","bottle-wine","pot","pot-steam","shower","shower-head","bathtub","toilet","sink","faucet","hand-wash","car","car-side","garage-variant","tools","hammer","wrench","screwdriver","toolbox","ladder","heart","heart-pulse","run","walk","bike","dumbbell","yoga","scale-bathroom","thermometer-lines","clock","clock-outline","timer","alarm","calendar","calendar-today","calendar-clock","history","bell-ring","bell-alert","alert","alert-circle","information","help-circle","check","check-circle","close-circle","minus-circle","plus-circle","arrow-up","arrow-down","arrow-left","arrow-right","chevron-up","chevron-down","menu","dots-vertical","dots-horizontal","cog","tune","circle","square","triangle","hexagon","star","star-outline","heart-outline","plus","minus","close","check-bold","eye","eye-off","account","account-group","baby","dog","cat","paw","gift","balloon","party-popper","candle","book","book-open","newspaper","email","message","phone-classic"];fe(()=>d.modelValue,h=>{$.value=h});const p=J(()=>{if(!$.value)return m.slice(0,50);const h=$.value.toLowerCase().replace("mdi:","");return m.filter(t=>t.toLowerCase().includes(h)).slice(0,50)}),C=()=>{l.value=!0,w("update:modelValue",$.value)},S=()=>{setTimeout(()=>{l.value=!1},200)},V=h=>{$.value=`mdi:${h}`,w("update:modelValue",$.value),l.value=!1};return(h,t)=>(n(),s("div",Kt,[e("div",Xt,[z(e("input",{id:o.inputId,"onUpdate:modelValue":t[0]||(t[0]=L=>$.value=L),type:"text",placeholder:o.placeholder,onInput:C,onFocus:t[1]||(t[1]=L=>l.value=!0),onBlur:S},null,40,Yt),[[_e,$.value]]),$.value?(n(),s("div",Zt,[e("i",{class:Z(`mdi mdi-${$.value.replace("mdi:","")}`)},null,2)])):M("",!0)]),l.value&&p.value.length>0?(n(),s("div",Qt,[e("div",eo,[(n(!0),s(me,null,he(p.value,L=>(n(),s("div",{key:L,class:"icon-option",onMousedown:ge(B=>V(L),["prevent"]),title:L},[e("i",{class:Z(`mdi mdi-${L}`)},null,2),e("span",null,u(L),1)],40,to))),128))])])):M("",!0)]))}},lo=ke(oo,[["__scopeId","data-v-a64f5011"]]),no={key:0,class:"dropdown-label"},so={key:0,class:"required"},ao=["placeholder","disabled","onKeydown"],io={class:"dropdown-icons"},ro={key:0,class:"mdi mdi-loading mdi-spin"},uo={key:2,class:"mdi mdi-chevron-down"},co={key:1,class:"error-message"},mo={key:2,class:"hint-message"},vo={key:0,class:"dropdown-menu"},po=["onMousedown","onMouseenter"],fo={class:"option-content"},go={class:"option-label"},yo={key:0,class:"option-description"},bo={key:0,class:"mdi mdi-check selected-icon"},ho={key:3,class:"dropdown-menu"},ko={__name:"SearchableDropdown",props:{modelValue:{type:[String,Number,Object],default:null},options:{type:Array,required:!0,default:()=>[]},label:{type:String,default:""},placeholder:{type:String,default:"Search..."},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},error:{type:String,default:""},hint:{type:String,default:""},optionLabel:{type:String,default:"label"},optionValue:{type:String,default:"value"},optionDescription:{type:String,default:"description"},filterMethod:{type:Function,default:null}},emits:["update:modelValue","change","search"],setup(o,{emit:c}){const d=o,w=c,$=y(null),l=y(null),m=y(""),p=y(!1),C=y(0),S=y(!1),V=O=>typeof O=="string"||typeof O=="number"?O:O[d.optionLabel]||O.label||O.name||String(O),h=O=>typeof O=="string"||typeof O=="number"?O:O[d.optionValue]||O.value||O.id||O,t=O=>typeof O=="string"||typeof O=="number"?"":O[d.optionDescription]||O.description||"",L=O=>{const N=h(O);return typeof d.modelValue=="object"?h(d.modelValue)===N:d.modelValue===N},B=J(()=>{if(!m.value)return d.options;if(d.filterMethod)return d.options.filter(N=>d.filterMethod(N,m.value));const O=m.value.toLowerCase();return d.options.filter(N=>{const te=V(N).toLowerCase(),ue=t(N).toLowerCase();return te.includes(O)||ue.includes(O)})}),P=J(()=>{if(!d.modelValue)return"";const O=d.options.find(N=>{const te=h(N);return typeof d.modelValue=="object"?te===h(d.modelValue):te===d.modelValue});return O?V(O):""});fe(()=>d.modelValue,O=>{S.value||(m.value=P.value)}),fe(()=>d.options,()=>{!S.value&&d.modelValue&&(m.value=P.value)},{deep:!0}),fe(m,O=>{w("search",O),C.value=0}),Te(()=>{m.value=P.value});const T=()=>{var O;S.value=!0,p.value=!0,(O=l.value)==null||O.select()},a=()=>{S.value=!1,setTimeout(()=>{p.value=!1,d.modelValue?m.value=P.value:m.value=""},200)},g=()=>{var O;p.value=!1,(O=l.value)==null||O.blur()},f=O=>{const N=h(O);w("update:modelValue",N),w("change",N,O),m.value=V(O),g()},E=()=>{var O;w("update:modelValue",null),w("change",null,null),m.value="",(O=l.value)==null||O.focus()},X=()=>{if(!p.value){p.value=!0;return}C.value<B.value.length-1&&C.value++},oe=()=>{C.value>0&&C.value--},le=()=>{B.value.length>0&&C.value>=0&&f(B.value[C.value])},ve=O=>{$.value&&!$.value.contains(O.target)&&(p.value=!1,d.modelValue?m.value=P.value:m.value="")};return Te(()=>{document.addEventListener("click",ve)}),Je(()=>{document.removeEventListener("click",ve)}),(O,N)=>(n(),s("div",{class:"searchable-dropdown",ref_key:"dropdownRef",ref:$},[o.label?(n(),s("label",no,[_(u(o.label)+" ",1),o.required?(n(),s("span",so,"*")):M("",!0)])):M("",!0),e("div",{class:Z(["dropdown-input-wrapper",{"has-error":o.error,disabled:o.disabled}])},[z(e("input",{ref_key:"inputRef",ref:l,type:"text","onUpdate:modelValue":N[0]||(N[0]=te=>m.value=te),placeholder:o.placeholder,disabled:o.disabled||o.loading,onFocus:T,onBlur:a,onKeydown:[je(ge(X,["prevent"]),["down"]),je(ge(oe,["prevent"]),["up"]),je(ge(le,["prevent"]),["enter"]),je(g,["escape"])],class:"dropdown-input"},null,40,ao),[[_e,m.value]]),e("div",io,[o.loading?(n(),s("i",ro)):o.modelValue&&!o.disabled?(n(),s("i",{key:1,class:"mdi mdi-close-circle clear-icon",onClick:E})):(n(),s("i",uo))])],2),o.error?(n(),s("div",co,u(o.error),1)):M("",!0),o.hint&&!o.error?(n(),s("div",mo,u(o.hint),1)):M("",!0),ye(ze,{name:"dropdown"},{default:Ne(()=>[p.value&&B.value.length>0?(n(),s("div",vo,[(n(!0),s(me,null,he(B.value,(te,ue)=>(n(),s("div",{key:h(te),class:Z(["dropdown-item",{highlighted:ue===C.value,selected:L(te)}]),onMousedown:ge(be=>f(te),["prevent"]),onMouseenter:be=>C.value=ue},[e("div",fo,[e("div",go,u(V(te)),1),t(te)?(n(),s("div",yo,u(t(te)),1)):M("",!0)]),L(te)?(n(),s("i",bo)):M("",!0)],42,po))),128))])):M("",!0)]),_:1}),p.value&&B.value.length===0&&!o.loading?(n(),s("div",ho,[...N[1]||(N[1]=[e("div",{class:"dropdown-item no-results"},[e("i",{class:"mdi mdi-magnify"}),_(" No results found ")],-1)])])):M("",!0)],512))}},Fe=ke(ko,[["__scopeId","data-v-679ce35f"]]),wo={class:"smartir-selector"},$o={class:"form-group"},Co={class:"form-group"},_o={class:"form-group"},So=["value"],Io={key:0,class:"error-message"},Do={class:"form-group"},xo={class:"form-group"},To={key:1,class:"code-info"},Ro={class:"info-content"},Mo={class:"info-row"},Lo={class:"info-value"},Oo={class:"info-row"},Ao={class:"info-value"},Eo={key:0,class:"info-row"},Vo={class:"info-value"},jo={class:"info-row"},Po={class:"info-value"},Uo={__name:"SmartIRDeviceSelector",props:{entityType:{type:String,required:!0},modelValue:{type:Object,default:()=>({})},broadlinkDevices:{type:Array,default:()=>[]}},emits:["update:modelValue","change"],setup(o,{expose:c,emit:d}){const w=o,$=d,l=y([]),m=y([]),p=y(""),C=y(""),S=y(""),V=y(""),h=y(""),t=y(null),L=y(!1),B=y(!1),P=y({manufacturer:"",model:"",controller:""});Te(async()=>{if(await T(),w.modelValue&&(p.value=w.modelValue.manufacturer||"",C.value=w.modelValue.device_code||"",S.value=w.modelValue.controller_device||"",V.value=w.modelValue.temperature_sensor||"",h.value=w.modelValue.humidity_sensor||"",p.value&&(await a(p.value),C.value&&m.value.length>0))){const O=m.value.find(N=>N.code===C.value);O&&(t.value={code:O.code,manufacturer:p.value,models:O.models,controller:O.controller})}}),fe(()=>w.entityType,async O=>{O&&(p.value="",C.value="",m.value=[],t.value=null,await T())});const T=async()=>{if(w.entityType){L.value=!0,P.value.manufacturer="";try{const O=await ce.get("/api/smartir/codes/manufacturers",{params:{entity_type:w.entityType}});if(O.data.success)l.value=O.data.manufacturers||[];else throw new Error(O.data.error||"Failed to load manufacturers")}catch(O){console.error("Error loading manufacturers:",O),P.value.manufacturer="Failed to load manufacturers. Please try again.",l.value=[]}finally{L.value=!1}}},a=async O=>{if(!(!O||!w.entityType)){B.value=!0,P.value.model="";try{const N=await ce.get("/api/smartir/codes/models",{params:{entity_type:w.entityType,manufacturer:O}});if(N.data.success){const te=N.data.models||[];m.value=te.map(ue=>{const be=ue.models&&ue.models.length>0?ue.models.join(", "):`Code ${ue.code}`;return{code:ue.code,label:be,description:`Code: ${ue.code}`,models:ue.models,controller:ue.controller}})}else throw new Error(N.data.error||"Failed to load models")}catch(N){console.error("Error loading models:",N),P.value.model="Failed to load models. Please try again.",m.value=[]}finally{B.value=!1}}},g=async O=>{p.value=O,C.value="",t.value=null,m.value=[],O&&await a(O),le()},f=()=>{const O=m.value.find(N=>N.code===C.value);O&&(t.value={code:O.code,manufacturer:p.value,models:O.models,controller:O.controller}),le()},E=()=>{le()},X=()=>{le()},oe=()=>{le()},le=()=>{var N,te;const O={manufacturer:p.value,model:((te=(N=t.value)==null?void 0:N.models)==null?void 0:te[0])||"",device_code:C.value,controller_device:S.value};w.entityType==="climate"&&(V.value&&(O.temperature_sensor=V.value),h.value&&(O.humidity_sensor=h.value)),$("update:modelValue",O),$("change",O)};return c({validate:()=>{let O=!0;return P.value={manufacturer:"",model:"",controller:""},p.value||(P.value.manufacturer="Manufacturer is required",O=!1),C.value||(P.value.model="Model is required",O=!1),S.value||(P.value.controller="Broadlink controller is required",O=!1),O}}),(O,N)=>(n(),s("div",wo,[e("div",$o,[ye(Fe,{modelValue:p.value,"onUpdate:modelValue":N[0]||(N[0]=te=>p.value=te),options:l.value,label:"Manufacturer",placeholder:"Search manufacturers...",required:"",loading:L.value,error:P.value.manufacturer,hint:"Select the device manufacturer",onChange:g},null,8,["modelValue","options","loading","error"])]),e("div",Co,[ye(Fe,{modelValue:C.value,"onUpdate:modelValue":N[1]||(N[1]=te=>C.value=te),options:m.value,"option-label":"label","option-value":"code","option-description":"description",label:"Model",placeholder:"Search models...",required:"",disabled:!p.value,loading:B.value,error:P.value.model,hint:"Select the device model",onChange:f},null,8,["modelValue","options","disabled","loading","error"])]),e("div",_o,[N[6]||(N[6]=e("label",{for:"controller-device"},[e("i",{class:"mdi mdi-remote"}),_(" Controller Device * ")],-1)),z(e("select",{id:"controller-device","onUpdate:modelValue":N[2]||(N[2]=te=>S.value=te),required:"",onChange:E},[N[5]||(N[5]=e("option",{value:""},"-- Select Controller Device --",-1)),(n(!0),s(me,null,he(o.broadlinkDevices,te=>(n(),s("option",{key:te.entity_id,value:te.entity_id},[_(u(te.name||te.entity_id)+" ",1),te.area_name?(n(),s(me,{key:0},[_(" - "+u(te.area_name),1)],64)):M("",!0)],8,So))),128))],544),[[we,S.value]]),N[7]||(N[7]=e("small",null,"Which remote device will send the IR/RF commands",-1)),P.value.controller?(n(),s("div",Io,u(P.value.controller),1)):M("",!0)]),o.entityType==="climate"?(n(),s(me,{key:0},[e("div",Do,[N[8]||(N[8]=e("label",{for:"temperature-sensor"},"Temperature Sensor",-1)),z(e("input",{id:"temperature-sensor","onUpdate:modelValue":N[3]||(N[3]=te=>V.value=te),type:"text",placeholder:"e.g., sensor.living_room_temperature",onInput:X},null,544),[[_e,V.value]]),N[9]||(N[9]=e("small",null,"Optional: Temperature sensor entity for current temperature",-1))]),e("div",xo,[N[10]||(N[10]=e("label",{for:"humidity-sensor"},"Humidity Sensor",-1)),z(e("input",{id:"humidity-sensor","onUpdate:modelValue":N[4]||(N[4]=te=>h.value=te),type:"text",placeholder:"e.g., sensor.living_room_humidity",onInput:oe},null,544),[[_e,h.value]]),N[11]||(N[11]=e("small",null,"Optional: Humidity sensor entity for current humidity",-1))])],64)):M("",!0),t.value?(n(),s("div",To,[N[16]||(N[16]=e("div",{class:"info-header"},[e("i",{class:"mdi mdi-information"}),e("span",null,"Selected Device Code")],-1)),e("div",Ro,[e("div",Mo,[N[12]||(N[12]=e("span",{class:"info-label"},"Code ID:",-1)),e("span",Lo,u(t.value.code_id),1)]),e("div",Oo,[N[13]||(N[13]=e("span",{class:"info-label"},"Manufacturer:",-1)),e("span",Ao,u(t.value.manufacturer),1)]),t.value.models&&t.value.models.length>0?(n(),s("div",Eo,[N[14]||(N[14]=e("span",{class:"info-label"},"Supported Models:",-1)),e("span",Vo,u(t.value.models.join(", ")),1)])):M("",!0),e("div",jo,[N[15]||(N[15]=e("span",{class:"info-label"},"Controller:",-1)),e("span",Po,u(t.value.controller||"Broadlink"),1)])])])):M("",!0)]))}},Fo=ke(Uo,[["__scopeId","data-v-1911c8f6"]]),No={class:"modal-content"},Bo={class:"modal-header"},Ho={class:"input-wrapper"},qo={key:0,class:"validation-tooltip"},Jo={class:"input-wrapper"},zo=["disabled"],Go={key:0,class:"validation-tooltip"},Wo={key:0,class:"smartir-notice"},Ko={key:0,class:"notice-success"},Xo={key:1,class:"notice-warning"},Yo={key:1,class:"smartir-notice"},Zo={key:2},Qo={class:"form-group"},el=["disabled"],tl=["disabled"],ol={key:0},ll={key:1},nl={key:2},sl={key:3},al={key:0,class:"form-group"},il={class:"area-display-readonly"},rl=["value"],dl=["disabled"],ul=["href"],cl={key:1,class:"form-group"},ml={class:"form-group"},vl={class:"input-wrapper"},pl=["value"],fl=["value"],gl={key:2,class:"validation-tooltip"},yl={key:0},bl={key:1},hl={key:3,class:"smartir-section"},kl={class:"modal-footer"},wl={type:"submit",form:"device-form",class:"btn btn-primary"},$l={__name:"DeviceForm",props:{device:{type:Object,default:null}},emits:["save","cancel"],setup(o,{emit:c}){const d=o,w=c,$=Ce("smartirStatus"),l=Ce("smartirEnabled"),m=J(()=>{var r;return localStorage.getItem("smartir_simulate_not_installed")==="true"?!1:((r=$==null?void 0:$.value)==null?void 0:r.installed)||!1}),p=J(()=>!!d.device),C=J(()=>["climate","media_player","fan","light"].includes(t.value.entity_type)),S=J(()=>m.value?!C.value&&t.value.entity_type?"(Not supported for this type)":"(Pre-configured Codes)":"(Requires SmartIR)"),V=J(()=>{var r;const I=((r=d.device)==null?void 0:r.commands)||{};return Object.keys(I).length>0}),h=J(()=>{if(!t.value.broadlink_entity)return"";const I=a.value.find(r=>r.entity_id===t.value.broadlink_entity);return I&&I.name||t.value.broadlink_entity}),t=y({name:"",entity_type:"",device_type:"broadlink",device:"",area:"",icon:"",broadlink_entity:"",enabled:!0,commands:{}}),L=y({name:"",entity_type:"",broadlink_entity:""}),B=y({}),P=y(null),T=y([]),a=y([]),g=y(null),f=y(null),E=y(null),X=y(!1);Te(async()=>{d.device&&(t.value={...d.device,device_type:d.device.device_type||"broadlink"},t.value.device_type==="smartir"&&(B.value={manufacturer:d.device.manufacturer,model:d.device.model,device_code:d.device.device_code,controller_device:d.device.controller_device,temperature_sensor:d.device.temperature_sensor,humidity_sensor:d.device.humidity_sensor})),await Promise.all([oe(),le()])});const oe=async()=>{try{const I=await ce.get("/api/areas");T.value=I.data.areas||[]}catch(I){console.error("Error loading areas:",I),T.value=[]}},le=async()=>{try{const r=(await ce.get("/api/remote/devices")).data.devices||[];a.value=r,console.log("Loaded remote devices:",r)}catch(I){console.error("Error loading remote devices:",I),a.value=[]}},ve=I=>{if(!I)return"";const r=I.toLowerCase();for(const j of T.value){const ie=j.toLowerCase();if(r.includes(ie))return j}return""},O=(I,r="")=>{const j=r.toLowerCase();return j.includes("tv")?"mdi:television":j.includes("lamp")?"mdi:lamp":j.includes("ceiling")?"mdi:ceiling-light":j.includes("floor")?"mdi:floor-lamp":j.includes("desk")?"mdi:desk-lamp":j.includes("fan")?"mdi:fan":j.includes("ac")||j.includes("air con")?"mdi:air-conditioner":j.includes("heater")?"mdi:radiator":j.includes("blind")?"mdi:blinds":j.includes("curtain")?"mdi:curtains":j.includes("garage")?"mdi:garage":j.includes("speaker")||j.includes("stereo")?"mdi:speaker":j.includes("receiver")?"mdi:audio-video":{light:"mdi:lightbulb",fan:"mdi:fan",switch:"mdi:light-switch",media_player:"mdi:television",cover:"mdi:window-shutter",climate:"mdi:thermostat"}[I]||"mdi:devices"};fe(()=>t.value.name,I=>{if(!p.value&&I&&!t.value.area){const r=ve(I);r&&(t.value.area=r)}!p.value&&I&&t.value.entity_type&&(X.value||!t.value.icon)&&(t.value.icon=O(t.value.entity_type,I),X.value=!0)}),fe(()=>t.value.entity_type,I=>{!p.value&&I&&(X.value||!t.value.icon)&&(t.value.icon=O(I,t.value.name),X.value=!0)}),fe(()=>t.value.icon,(I,r)=>{r!==void 0&&I!==r&&!X.value&&(X.value=!1),I||(X.value=!1)});const N=y(!1),te=async()=>{var I;if((I=d.device)!=null&&I.id){N.value=!0;try{const r=await ce.post(`/api/devices/${d.device.id}/sync-area`);r.data.success?(t.value.area=r.data.area||"",r.data.area?console.log(`Area synced: ${r.data.area}`):console.log("No area assigned in Home Assistant")):console.warn(r.data.message||"Entity not found in HA")}catch(r){console.error("Failed to sync area:",r)}finally{N.value=!1}}},ue=()=>{var j;return!((j=d.device)!=null&&j.id)||!t.value.entity_type?"#":`/config/entities/entity/${`${t.value.entity_type}.${d.device.id}`}`},be=()=>{L.value={name:"",entity_type:"",broadlink_entity:""};let I=!0;return(!t.value.name||t.value.name.trim()==="")&&(L.value.name="Device name is required",I=!1),t.value.entity_type||(L.value.entity_type="Entity type is required",I=!1),t.value.device_type==="broadlink"&&!t.value.broadlink_entity&&(L.value.broadlink_entity="Broadlink device is required",I=!1),I},Se=I=>{L.value[I]=""},Ie=async()=>{if(t.value.device_type==="smartir"){if(P.value&&!P.value.validate())return;const I={...t.value,smartir_config:{manufacturer:B.value.manufacturer,model:B.value.model,code_id:B.value.device_code,controller_device:B.value.controller_device}};w("save",I)}else{if(!be())return;w("save",{...t.value})}},De=I=>{B.value=I};return(I,r)=>(n(),s("div",{class:"modal-overlay",onClick:r[11]||(r[11]=ge(j=>I.$emit("cancel"),["self"]))},[e("div",No,[e("div",Bo,[e("h2",null,u(p.value?"Edit Device":"Add New Device"),1),e("button",{onClick:r[0]||(r[0]=j=>I.$emit("cancel")),class:"close-btn"},[...r[12]||(r[12]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("form",{id:"device-form",onSubmit:ge(Ie,["prevent"]),class:"modal-body"},[e("div",{class:Z(["form-group",{"has-error":L.value.name}])},[r[14]||(r[14]=e("label",{for:"device-name"},"Device Name *",-1)),e("div",Ho,[z(e("input",{id:"device-name",ref_key:"nameInput",ref:g,"onUpdate:modelValue":r[1]||(r[1]=j=>t.value.name=j),type:"text",placeholder:"e.g., Living Room TV",onInput:r[2]||(r[2]=j=>Se("name"))},null,544),[[_e,t.value.name]]),L.value.name?(n(),s("div",qo,[r[13]||(r[13]=e("i",{class:"mdi mdi-alert"},null,-1)),_(" "+u(L.value.name),1)])):M("",!0)]),r[15]||(r[15]=e("small",null,"Friendly name for this device",-1))],2),e("div",{class:Z(["form-group",{"has-error":L.value.entity_type}])},[r[23]||(r[23]=e("label",{for:"entity-type"},"Entity Type *",-1)),e("div",Jo,[z(e("select",{id:"entity-type",ref_key:"typeSelect",ref:f,"onUpdate:modelValue":r[3]||(r[3]=j=>t.value.entity_type=j),onChange:r[4]||(r[4]=j=>Se("entity_type"))},[r[16]||(r[16]=Oe('<option value="" data-v-94bc1fe5>-- Select Type --</option><option value="light" data-v-94bc1fe5>💡 Light</option><option value="fan" data-v-94bc1fe5>🌀 Fan</option><option value="switch" data-v-94bc1fe5>🔌 Switch</option><option value="media_player" data-v-94bc1fe5>📺 Media Player</option><option value="cover" data-v-94bc1fe5>🪟 Cover (Blinds/Curtains)</option>',6)),e("option",{value:"climate",disabled:!m.value}," 🌡️ Climate "+u(m.value?"":"(Requires SmartIR)"),9,zo)],544),[[we,t.value.entity_type]]),L.value.entity_type?(n(),s("div",Go,[r[17]||(r[17]=e("i",{class:"mdi mdi-alert"},null,-1)),_(" "+u(L.value.entity_type),1)])):M("",!0)]),t.value.entity_type==="climate"?(n(),s("div",Wo,[m.value?(n(),s("div",Ko,[...r[18]||(r[18]=[e("i",{class:"mdi mdi-check-circle"},null,-1),e("span",null,"SmartIR detected! Climate entities will be created via SmartIR profiles.",-1)])])):(n(),s("div",Xo,[...r[19]||(r[19]=[e("i",{class:"mdi mdi-alert"},null,-1),e("div",null,[e("strong",null,"SmartIR Required"),e("p",null,"Climate entities (AC, heaters) require SmartIR integration."),e("a",{href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"smartir-link"}," Install SmartIR → ")],-1)])]))])):m.value&&["media_player","fan","light"].includes(t.value.entity_type)?(n(),s("div",Yo,[...r[20]||(r[20]=[e("div",{class:"notice-info"},[e("i",{class:"mdi mdi-information"}),e("span",null,"💡 SmartIR available! You can use pre-configured codes or learn your own.")],-1)])])):!m.value&&t.value.entity_type?(n(),s("small",Zo,[r[21]||(r[21]=_(" 💡 Tip: Install ",-1)),r[22]||(r[22]=e("a",{href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"inline-link"},"SmartIR",-1)),_(" for pre-configured "+u(t.value.entity_type==="climate"?"climate":t.value.entity_type)+" device codes ",1)])):M("",!0)],2),e("div",Qo,[r[26]||(r[26]=e("label",{for:"device-type"},"Device Type *",-1)),z(e("select",{id:"device-type","onUpdate:modelValue":r[5]||(r[5]=j=>t.value.device_type=j),required:"",disabled:p.value},[r[24]||(r[24]=e("option",{value:""},"-- Select Device Type --",-1)),r[25]||(r[25]=e("option",{value:"broadlink"},"📡 Broadlink Device (Learn IR Codes)",-1)),$e(l)?(n(),s("option",{key:0,value:"smartir",disabled:!m.value||!C.value}," 🌐 SmartIR Device "+u(S.value),9,tl)):M("",!0)],8,el),[[we,t.value.device_type]]),p.value?(n(),s("small",ol,"Cannot change device type after creation")):t.value.device_type==="smartir"?(n(),s("small",ll,"Using pre-configured codes from SmartIR repository")):t.value.device_type==="broadlink"?(n(),s("small",nl,"Learn and store your own IR codes")):(n(),s("small",sl,"Choose how to configure this device"))]),p.value?(n(),s("div",al,[r[29]||(r[29]=e("label",{for:"device-area"},"Area",-1)),e("div",il,[e("input",{id:"device-area",value:t.value.area||"Not assigned",type:"text",readonly:"",class:"readonly-input"},null,8,rl),e("button",{type:"button",onClick:te,disabled:N.value,class:"sync-area-btn",title:"Sync area from Home Assistant"},[e("i",{class:Z(N.value?"mdi mdi-loading mdi-spin":"mdi mdi-refresh")},null,2)],8,dl)]),e("small",null,[r[27]||(r[27]=e("i",{class:"mdi mdi-information-outline"},null,-1)),r[28]||(r[28]=_(" Set area in Home Assistant, then click sync. ",-1)),e("a",{href:ue(),target:"_blank",class:"inline-link"},"Open in HA →",8,ul)])])):(n(),s("div",cl,[...r[30]||(r[30]=[e("div",{class:"info-notice"},[e("i",{class:"mdi mdi-information-outline"}),e("span",null,[e("strong",null,"Area Assignment:"),_(" After generating entities and restarting Home Assistant, you can assign areas in HA and sync them here.")])],-1)])])),e("div",ml,[r[31]||(r[31]=e("label",{for:"device-icon"},"Icon",-1)),ye(lo,{modelValue:t.value.icon,"onUpdate:modelValue":r[6]||(r[6]=j=>t.value.icon=j),inputId:"device-icon",placeholder:"e.g., mdi:television"},null,8,["modelValue"]),r[32]||(r[32]=e("small",null,"Optional: Material Design Icon name",-1))]),t.value.device_type==="broadlink"?(n(),s("div",{key:2,class:Z(["form-group",{"has-error":L.value.broadlink_entity}])},[r[35]||(r[35]=e("label",{for:"broadlink-entity"},"Remote Device *",-1)),e("div",vl,[!p.value||!V.value?z((n(),s("select",{key:0,id:"broadlink-entity",ref_key:"broadlinkSelect",ref:E,"onUpdate:modelValue":r[7]||(r[7]=j=>t.value.broadlink_entity=j),onChange:r[8]||(r[8]=j=>Se("broadlink_entity"))},[r[33]||(r[33]=e("option",{value:""},"-- Select Remote Device --",-1)),(n(!0),s(me,null,he(a.value,j=>(n(),s("option",{key:j.entity_id,value:j.entity_id},[_(u(j.name||j.entity_id)+" ",1),j.area_name?(n(),s(me,{key:0},[_(" - "+u(j.area_name),1)],64)):M("",!0)],8,pl))),128))],544)),[[we,t.value.broadlink_entity]]):(n(),s("input",{key:1,id:"broadlink-entity",value:h.value,type:"text",readonly:"",disabled:""},null,8,fl)),L.value.broadlink_entity?(n(),s("div",gl,[r[34]||(r[34]=e("i",{class:"mdi mdi-alert"},null,-1)),_(" "+u(L.value.broadlink_entity),1)])):M("",!0)]),!p.value||!V.value?(n(),s("small",yl,"Required: Select which remote device to use for sending commands")):(n(),s("small",bl,"Cannot change remote device after commands are learned"))],2)):M("",!0),t.value.device_type==="smartir"?(n(),s("div",hl,[r[36]||(r[36]=e("div",{class:"section-header"},[e("i",{class:"mdi mdi-cloud-download"}),e("span",null,"SmartIR Device Configuration")],-1)),ye(Fo,{ref_key:"smartirSelector",ref:P,"entity-type":t.value.entity_type,modelValue:B.value,"onUpdate:modelValue":r[9]||(r[9]=j=>B.value=j),"broadlink-devices":a.value,onChange:De},null,8,["entity-type","modelValue","broadlink-devices"])])):M("",!0)],32),e("div",kl,[e("button",{type:"button",onClick:r[10]||(r[10]=j=>I.$emit("cancel")),class:"btn btn-secondary"}," Cancel "),e("button",wl,[r[37]||(r[37]=e("i",{class:"mdi mdi-check"},null,-1)),_(" "+u(p.value?"Update":"Create"),1)])])])]))}},Cl=ke($l,[["__scopeId","data-v-94bc1fe5"]]),_l={class:"modal-header"},Sl={class:"modal-body"},Il={class:"message-text"},Dl={key:0,class:"checkbox-option"},xl={class:"modal-footer"},Tl=["disabled"],Rl={__name:"ConfirmDialog",props:{isOpen:{type:Boolean,default:!1},title:{type:String,default:"Confirm"},message:{type:String,required:!0},confirmText:{type:String,default:"OK"},cancelText:{type:String,default:"Cancel"},showCancel:{type:Boolean,default:!0},dangerMode:{type:Boolean,default:!1},confirmDisabled:{type:Boolean,default:!1},checkboxLabel:{type:String,default:""}},emits:["confirm","cancel"],setup(o,{emit:c}){const d=o,w=c,$=y(!1);fe(()=>d.isOpen,p=>{p&&($.value=!1)});const l=()=>{w("confirm",$.value)},m=()=>{w("cancel")};return(p,C)=>o.isOpen?(n(),s("div",{key:0,class:"modal-overlay",onClick:ge(m,["self","stop"])},[e("div",{class:"modal-dialog confirm-dialog",onClick:C[1]||(C[1]=ge(()=>{},["stop"]))},[e("div",_l,[e("h2",null,u(o.title),1)]),e("div",Sl,[e("p",Il,u(o.message),1),o.checkboxLabel?(n(),s("div",Dl,[e("label",null,[z(e("input",{type:"checkbox","onUpdate:modelValue":C[0]||(C[0]=S=>$.value=S)},null,512),[[pe,$.value]]),e("span",null,u(o.checkboxLabel),1)])])):M("",!0)]),e("div",xl,[o.showCancel?(n(),s("button",{key:0,onClick:ge(m,["stop"]),class:"btn btn-secondary"},u(o.cancelText),1)):M("",!0),o.confirmText?(n(),s("button",{key:1,onClick:ge(l,["stop"]),class:Z(["btn",o.dangerMode?"btn-danger":"btn-primary"]),disabled:o.confirmDisabled},u(o.confirmText),11,Tl)):M("",!0)])])])):M("",!0)}},Le=ke(Rl,[["__scopeId","data-v-80a9de08"]]),Ml={class:"modal-content"},Ll={class:"modal-header"},Ol={class:"modal-body"},Al={key:0,class:"smartir-info"},El={key:0,class:"climate-note"},Vl={class:"form-group"},jl=["value"],Pl={class:"form-group"},Ul=["disabled"],Fl={label:"Suggested Commands"},Nl=["value"],Bl=["disabled"],Hl={class:"form-group"},ql={class:"radio-group"},Jl={class:"radio-label"},zl=["disabled"],Gl={class:"radio-label"},Wl=["disabled"],Kl={class:"learn-action"},Xl=["disabled"],Yl={key:0,class:"mdi mdi-loading mdi-spin"},Zl={key:1,class:"mdi mdi-remote-tv"},Ql={key:0,class:"learning-status"},en={key:1,class:"result-message success"},tn={key:2,class:"section-divider"},on={key:3,class:"learned-commands"},ln={class:"command-list"},nn={class:"command-info"},sn={class:"command-name"},an={class:"learned-status"},rn={class:"command-actions"},dn=["onClick","disabled"],un=["onClick"],cn={key:4,class:"untracked-commands"},mn={class:"command-list"},vn={class:"command-name"},pn={class:"modal-footer"},fn=["disabled"],gn={__name:"CommandLearner",props:{device:{type:Object,required:!0}},emits:["cancel","learned"],setup(o,{emit:c}){const d=o,w=c,$=y([]),l=y(""),m=y(""),p=y(""),C=y("ir"),S=y(!1),V=y(""),h=y("success"),t=y([]),L=y([]),B=y(!1),P=y(""),T=y(!1),a=y(null),g=y(null),f=y(""),E=y(""),X=J(()=>d.device.device_type==="smartir");J(()=>{if(X.value)return!1;const W=m.value==="__custom__"?p.value:m.value;return l.value&&W.trim()});const oe=()=>{a.value&&a.value.setCustomValidity("")},le=()=>{g.value&&g.value.setCustomValidity("")},ve=J(()=>{const W=$.value.find(b=>b.entity_id===l.value);return W?W.name||W.entity_id:l.value}),O={light:["turn_on","turn_off","toggle","brightness_up","brightness_down","dim","bright"],fan:["turn_on","turn_off","toggle","speed_low","speed_medium","speed_high","speed_1","speed_2","speed_3","speed_4","speed_5","oscillate_on","oscillate_off","direction_forward","direction_reverse"],switch:["turn_on","turn_off","toggle"],media_player:["turn_on","turn_off","toggle","volume_up","volume_down","volume_mute","play","pause","stop","play_pause","next_track","previous_track","channel_up","channel_down","source_hdmi1","source_hdmi2","source_hdmi3","source_tv","source_aux","source_bluetooth","menu","home","back","select","arrow_up","arrow_down","arrow_left","arrow_right"],cover:["open","close","stop","open_tilt","close_tilt","position_0","position_25","position_50","position_75","position_100"]},N=J(()=>{const W=d.device.entity_type||"switch";return O[W]||O.switch});Te(async()=>{await te(),await ue(),await r(),a.value&&(a.value.setCustomValidity(""),a.value.oninvalid=()=>{a.value.setCustomValidity("Command name is required")}),d.device.broadlink_entity&&(l.value=d.device.broadlink_entity)}),fe(m,async W=>{W==="__custom__"&&(await Ge(),g.value&&(g.value.setCustomValidity(""),g.value.oninvalid=()=>{g.value.setCustomValidity("Custom command name is required")}))});const te=async()=>{try{const W=await ce.get("/api/broadlink/devices");$.value=W.data.devices||[]}catch(W){console.error("Error loading Broadlink devices:",W)}},ue=async()=>{try{if(X.value){const W=await ce.get("/api/smartir/codes/code",{params:{entity_type:d.device.entity_type,code_id:d.device.device_code}});if(W.data.success&&W.data.code){const b=W.data.code.commands||{},v=W.data.code.commandType||"ir";if(d.device.entity_type==="climate"){const Y=[];for(const[ae,q]of Object.entries(b))typeof q=="string"?Y.push({name:ae,type:v}):typeof q=="object"&&q!==null&&Object.keys(q).sort((ne,Q)=>parseInt(ne)-parseInt(Q)).forEach(ne=>{Y.push({name:`${ae}_${ne}`,type:v,label:`${ae.charAt(0).toUpperCase()+ae.slice(1)} ${ne}°C`})});t.value=Y}else t.value=Object.keys(b).map(Y=>({name:Y,type:v}))}}else{if(console.log("📋 Loading commands for device:",d.device),console.log("📋 Device commands:",d.device.commands),console.log("📋 Device ID:",d.device.id),d.device.commands&&Object.keys(d.device.commands).length>0)console.log("✅ Using commands from device object"),t.value=Object.entries(d.device.commands).map(([W,b])=>({name:W,type:b.command_type||b.type||"ir"}));else if(d.device.id){console.log("🌐 Fetching commands from API for device ID:",d.device.id);const b=(await ce.get(`/api/commands/${d.device.id}`)).data.commands||{};t.value=Object.entries(b).map(([v,Y])=>({name:v,type:Y.command_type||Y.type||"ir"}))}else console.log("⚠️ No commands found and no device ID");console.log("📋 Final learned commands:",t.value)}}catch(W){console.error("Error loading commands:",W)}},be=async()=>{var W,b;V.value="",h.value="",S.value=!0;try{let v=d.device.id.split(".")[1];d.device.device&&(v=d.device.device);const Y=m.value==="__custom__"?p.value:m.value,ae=await ce.post("/api/commands/learn",{entity_id:l.value,device:v,device_id:d.device.id,command:Y.trim(),command_type:C.value});if(ae.data.success){V.value=`Command "${Y}" learned successfully!`,h.value="success",t.value.includes(Y)||t.value.push(Y);const q=L.value.indexOf(Y);q>-1&&L.value.splice(q,1);const D={...d.device.commands};D[Y]=!0,m.value="",p.value="",w("learned",{commands:D,commandName:Y})}else V.value=ae.data.error||"Failed to learn command",h.value="error"}catch(v){V.value=((b=(W=v.response)==null?void 0:W.data)==null?void 0:b.error)||"Error learning command",h.value="error"}finally{S.value=!1}},Se=async W=>{try{E.value=W,f.value="";let b=d.device.id.split(".")[1];d.device.device&&(b=d.device.device);const v=X.value?d.device.controller_device:l.value||d.device.broadlink_entity;if(!v){console.error("Missing entity_id for test command:",{isSmartIR:X.value,controller_device:d.device.controller_device,broadlink_entity:d.device.broadlink_entity,selectedBroadlink:l.value,device:d.device}),V.value="Missing Broadlink remote entity. Please select a Broadlink device.",h.value="error",E.value="";return}(await ce.post("/api/commands/test",{entity_id:v,device:b,command:W,device_id:d.device.id})).data.success&&(f.value=W,setTimeout(()=>{f.value===W&&(f.value="")},2e3))}catch(b){V.value=`Failed to send command: ${b.message}`,h.value="error"}finally{E.value=""}},Ie=W=>{P.value=W,B.value=!0},De=()=>{B.value=!1,P.value=""},I=async()=>{const W=P.value;B.value=!1;try{await ce.delete(`/api/commands/${d.device.id}/${W}`),await ue(),await r(),V.value=`Command "${W}" deleted`,h.value="success",w("learned")}catch(b){V.value=`Failed to delete command: ${b.message}`,h.value="error"}finally{P.value=""}},r=async()=>{try{const W=d.device.device||d.device.id.split(".")[1],v=(await ce.get("/api/commands/untracked")).data.untracked||{};v[W]?L.value=Object.keys(v[W].commands):L.value=[]}catch(W){console.error("Error loading untracked commands:",W),L.value=[]}},j=()=>{L.value.length!==0&&(T.value=!0)},ie=async()=>{T.value=!1;try{const W=d.device.device||d.device.id.split(".")[1],b=await ce.post("/api/commands/import",{device_id:d.device.id,source_device:W,commands:L.value});b.data.success&&(V.value=`Imported ${b.data.imported_count} commands successfully!`,h.value="success",await ue(),await r(),w("learned"))}catch(W){V.value=`Failed to import commands: ${W.message}`,h.value="error"}};return(W,b)=>(n(),s("div",{class:"modal-overlay",onClick:b[7]||(b[7]=ge(v=>W.$emit("cancel"),["self"]))},[e("div",Ml,[e("div",Ll,[e("h2",null,u(X.value?"Commands for":"Learn Commands for")+" "+u(o.device.name),1),e("button",{onClick:b[0]||(b[0]=v=>W.$emit("cancel")),class:"close-btn"},[...b[8]||(b[8]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Ol,[X.value?(n(),s("div",Al,[b[13]||(b[13]=e("i",{class:"mdi mdi-information"},null,-1)),e("div",null,[b[12]||(b[12]=e("h3",null,"SmartIR Device",-1)),e("p",null,[b[9]||(b[9]=_("This device uses SmartIR code file ",-1)),e("strong",null,u(o.device.device_code),1),b[10]||(b[10]=_(". Commands are pre-configured and cannot be learned.",-1))]),o.device.entity_type==="climate"?(n(),s("p",El,[...b[11]||(b[11]=[e("i",{class:"mdi mdi-alert-circle-outline"},null,-1),e("strong",null,"Note:",-1),_(" Climate device commands are temperature-based. Testing individual modes may not work as expected. Use the Home Assistant climate card to control your device. ",-1)])])):M("",!0)])])):(n(),s("form",{key:1,onSubmit:ge(be,["prevent"])},[e("div",Vl,[b[14]||(b[14]=e("label",{for:"broadlink-entity"},"Broadlink Device",-1)),e("input",{id:"broadlink-entity",value:ve.value,type:"text",readonly:"",disabled:""},null,8,jl),b[15]||(b[15]=e("small",null,"Commands will be learned using this device (set when device was created)",-1))]),e("div",Pl,[b[18]||(b[18]=e("label",{for:"command-name"},"Command Name *",-1)),z(e("select",{id:"command-name",ref_key:"commandSelect",ref:a,"onUpdate:modelValue":b[1]||(b[1]=v=>m.value=v),disabled:S.value,required:"",onChange:oe},[b[16]||(b[16]=e("option",{value:""},"-- Select or type command --",-1)),e("optgroup",Fl,[(n(!0),s(me,null,he(N.value,v=>(n(),s("option",{key:v,value:v},u(v),9,Nl))),128))]),b[17]||(b[17]=e("option",{value:"__custom__"},"Custom command...",-1))],40,Ul),[[we,m.value]]),m.value==="__custom__"?z((n(),s("input",{key:0,ref_key:"customCommandInput",ref:g,"onUpdate:modelValue":b[2]||(b[2]=v=>p.value=v),type:"text",placeholder:"Enter custom command name",disabled:S.value,required:"",class:"custom-command-input",onInput:le},null,40,Bl)),[[_e,p.value]]):M("",!0),e("small",null,"Select a suggested command for "+u(o.device.entity_type||"this device")+", or enter a custom one.",1)]),e("div",Hl,[b[21]||(b[21]=e("label",null,"Command Type",-1)),e("div",ql,[e("label",Jl,[z(e("input",{type:"radio","onUpdate:modelValue":b[3]||(b[3]=v=>C.value=v),value:"ir",disabled:S.value},null,8,zl),[[Ue,C.value]]),b[19]||(b[19]=e("span",null,"IR (Infrared)",-1))]),e("label",Gl,[z(e("input",{type:"radio","onUpdate:modelValue":b[4]||(b[4]=v=>C.value=v),value:"rf",disabled:S.value},null,8,Wl),[[Ue,C.value]]),b[20]||(b[20]=e("span",null,"RF (Radio Frequency)",-1))])])]),e("div",Kl,[e("button",{type:"submit",class:"btn btn-primary btn-large",disabled:S.value},[S.value?(n(),s("i",Yl)):(n(),s("i",Zl)),_(" "+u(S.value?"Learning...":"Learn Command"),1)],8,Xl)]),S.value?(n(),s("div",Ql,[...b[22]||(b[22]=[e("i",{class:"mdi mdi-loading mdi-spin"},null,-1),e("p",null,"Point your remote at the Broadlink device and press the button...",-1),e("small",null,"This may take up to 30 seconds",-1)])])):M("",!0),V.value&&h.value==="success"&&!V.value.includes("sent successfully")?(n(),s("div",en,[b[23]||(b[23]=e("i",{class:"mdi mdi-check-circle"},null,-1)),e("p",null,u(V.value),1)])):M("",!0)],32)),t.value.length>0||L.value.length>0?(n(),s("div",tn)):M("",!0),t.value.length>0?(n(),s("div",on,[e("h3",null,"Tracked Commands ("+u(t.value.length)+")",1),e("div",ln,[(n(!0),s(me,null,he(t.value,v=>(n(),s("div",{key:v.name,class:"command-item"},[e("div",nn,[e("span",sn,u(v.label||v.name),1)]),e("div",an,[b[24]||(b[24]=e("i",{class:"mdi mdi-check-circle"},null,-1)),b[25]||(b[25]=e("span",null,"Learned",-1)),e("span",{class:Z(["command-type-badge",v.type||"ir"])},u((v.type||"ir").toUpperCase()),3)]),e("div",rn,[e("button",{type:"button",onClick:Y=>Se(v.name),class:"icon-btn",title:"Test command",disabled:E.value===v.name},[e("i",{class:Z(["mdi mdi-play",{"mdi-spin":E.value===v.name}])},null,2)],8,dn),e("button",{type:"button",onClick:Y=>Ie(v.name),class:"icon-btn danger",title:"Delete and re-learn"},[...b[26]||(b[26]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,un)])]))),128))])])):M("",!0),L.value.length>0?(n(),s("div",cn,[e("h3",null,[b[27]||(b[27]=e("i",{class:"mdi mdi-alert"},null,-1)),_(" Untracked Commands ("+u(L.value.length)+") ",1)]),b[30]||(b[30]=e("p",{class:"untracked-info"}," These commands exist in Broadlink storage but are not tracked in this device. ",-1)),e("div",mn,[(n(!0),s(me,null,he(L.value,v=>(n(),s("div",{key:v,class:"command-item untracked"},[e("span",vn,u(v),1),b[28]||(b[28]=e("span",{class:"untracked-badge"},"Not tracked",-1))]))),128))]),e("button",{type:"button",onClick:j,class:"btn btn-secondary"},[...b[29]||(b[29]=[e("i",{class:"mdi mdi-import"},null,-1),_(" Import All Untracked Commands ",-1)])])])):M("",!0)]),e("div",pn,[e("button",{type:"button",onClick:b[5]||(b[5]=v=>W.$emit("cancel")),class:"btn btn-secondary",disabled:S.value}," Close ",8,fn)])]),ye(Le,{isOpen:B.value,title:"Delete Command?",message:`Delete command '${P.value}'? This will remove it from Broadlink storage.`,confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,onConfirm:I,onCancel:De},null,8,["isOpen","message"]),ye(Le,{isOpen:T.value,title:"Import Commands?",message:`Import ${L.value.length} untracked command${L.value.length>1?"s":""} into this device?`,confirmText:"Import",cancelText:"Cancel",onConfirm:ie,onCancel:b[6]||(b[6]=v=>T.value=!1)},null,8,["isOpen","message"])]))}},yn=ke(gn,[["__scopeId","data-v-6fd4627e"]]),bn={class:"modal-container error-dialog"},hn={class:"modal-header"},kn={class:"modal-body"},wn={class:"error-message"},$n={key:0,class:"error-suggestion"},Cn=["open"],_n={class:"debug-content"},Sn={class:"debug-info"},In={key:0,class:"debug-section-title"},Dn={key:1},xn={__name:"ErrorDialog",props:{isOpen:{type:Boolean,default:!1},title:{type:String,default:"Error"},message:{type:String,required:!0},suggestion:{type:String,default:""},details:{type:String,default:""},error:{type:Object,default:null},context:{type:Object,default:()=>({})}},emits:["close"],setup(o,{emit:c}){const d=o,w=c,$=Ce("toast"),l=y(!1),m=()=>{w("close")},p=J(()=>{var L,B,P,T,a,g,f,E,X,oe,le;const h=new Date().toISOString(),t=d.error||{};return{error:JSON.stringify({message:d.message,title:d.title,details:d.details,errorObject:t.message||t.toString(),timestamp:h},null,2),request:JSON.stringify({method:((B=(L=t.config)==null?void 0:L.method)==null?void 0:B.toUpperCase())||"N/A",url:((P=t.config)==null?void 0:P.url)||"N/A",baseURL:((T=t.config)==null?void 0:T.baseURL)||"N/A",headers:((a=t.config)==null?void 0:a.headers)||{},data:(g=t.config)!=null&&g.data?JSON.parse(t.config.data):"N/A",params:((f=t.config)==null?void 0:f.params)||{}},null,2),response:JSON.stringify({status:((E=t.response)==null?void 0:E.status)||"N/A",statusText:((X=t.response)==null?void 0:X.statusText)||"N/A",data:((oe=t.response)==null?void 0:oe.data)||"N/A",headers:((le=t.response)==null?void 0:le.headers)||{}},null,2),browser:JSON.stringify({userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language,cookieEnabled:navigator.cookieEnabled,onLine:navigator.onLine,viewport:`${window.innerWidth}x${window.innerHeight}`,screenResolution:`${window.screen.width}x${window.screen.height}`,colorDepth:window.screen.colorDepth,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,timestamp:h},null,2),appState:JSON.stringify({currentRoute:window.location.pathname,currentURL:window.location.href,referrer:document.referrer||"N/A",context:d.context||{},localStorage:{smartir_simulate:localStorage.getItem("smartir_simulate_not_installed"),theme:localStorage.getItem("theme")}},null,2),stackTrace:t.stack||null}}),C=async()=>{const h=V();try{await navigator.clipboard.writeText(h),$==null||$.success("Debug information copied to clipboard","✅ Copied")}catch(t){console.error("Failed to copy:",t),$==null||$.error("Failed to copy to clipboard","❌ Copy Failed")}},S=()=>{const h=V(),t=new Blob([h],{type:"text/plain"}),L=URL.createObjectURL(t),B=document.createElement("a");B.href=L;const P=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5);B.download=`broadlink-manager-error-${P}.txt`,document.body.appendChild(B),B.click(),document.body.removeChild(B),URL.revokeObjectURL(L),$==null||$.success("Debug report downloaded","✅ Downloaded")},V=()=>`Broadlink Manager - Error Report
${"=".repeat(60)}

Generated: ${new Date().toISOString()}
Title: ${d.title}
Message: ${d.message}
${d.suggestion?`Suggestion: ${d.suggestion}
`:""}
${"=".repeat(60)}

ERROR DETAILS
${"-".repeat(60)}
${p.value.error}

REQUEST INFORMATION
${"-".repeat(60)}
${p.value.request}

RESPONSE INFORMATION
${"-".repeat(60)}
${p.value.response}

BROWSER INFORMATION
${"-".repeat(60)}
${p.value.browser}

APPLICATION STATE
${"-".repeat(60)}
${p.value.appState}

${p.value.stackTrace?`STACK TRACE
${"-".repeat(60)}
${p.value.stackTrace}

`:""}
${"=".repeat(60)}
End of Report
`;return fe(()=>d.isOpen,h=>{if(h){const t=L=>{L.key==="Escape"&&m()};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)}}),(h,t)=>(n(),Re(We,{to:"body"},[ye(ze,{name:"modal"},{default:Ne(()=>[o.isOpen?(n(),s("div",{key:0,class:"modal-overlay",onClick:ge(m,["self"])},[e("div",bn,[e("div",hn,[t[2]||(t[2]=e("div",{class:"header-icon error-icon"},[e("i",{class:"mdi mdi-alert-circle"})],-1)),e("h3",null,u(o.title),1),e("button",{onClick:m,class:"close-button"},[...t[1]||(t[1]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",kn,[e("p",wn,u(o.message),1),o.suggestion?(n(),s("p",$n,[t[3]||(t[3]=e("i",{class:"mdi mdi-lightbulb-on"},null,-1)),_(" "+u(o.suggestion),1)])):M("",!0),e("details",{class:"debug-section",open:l.value},[e("summary",{onClick:t[0]||(t[0]=L=>l.value=!l.value)},[e("i",{class:Z(["mdi",l.value?"mdi-chevron-down":"mdi-chevron-right"])},null,2),t[4]||(t[4]=_(" Debug Information ",-1))]),e("div",_n,[e("div",{class:"debug-actions"},[e("button",{onClick:C,class:"btn-debug btn-copy"},[...t[5]||(t[5]=[e("i",{class:"mdi mdi-content-copy"},null,-1),_(" Copy to Clipboard ",-1)])]),e("button",{onClick:S,class:"btn-debug btn-download"},[...t[6]||(t[6]=[e("i",{class:"mdi mdi-download"},null,-1),_(" Download Report ",-1)])])]),e("div",Sn,[t[7]||(t[7]=e("div",{class:"debug-section-title"},"Error Details",-1)),e("pre",null,u(p.value.error),1),t[8]||(t[8]=e("div",{class:"debug-section-title"},"Request Information",-1)),e("pre",null,u(p.value.request),1),t[9]||(t[9]=e("div",{class:"debug-section-title"},"Response Information",-1)),e("pre",null,u(p.value.response),1),t[10]||(t[10]=e("div",{class:"debug-section-title"},"Browser Information",-1)),e("pre",null,u(p.value.browser),1),t[11]||(t[11]=e("div",{class:"debug-section-title"},"Application State",-1)),e("pre",null,u(p.value.appState),1),p.value.stackTrace?(n(),s("div",In,"Stack Trace")):M("",!0),p.value.stackTrace?(n(),s("pre",Dn,u(p.value.stackTrace),1)):M("",!0)])])],8,Cn)]),e("div",{class:"modal-footer"},[e("button",{onClick:m,class:"btn btn-primary"}," OK ")])])])):M("",!0)]),_:1})]))}},Tn=ke(xn,[["__scopeId","data-v-23858149"]]),Rn={key:0,class:"discovery-banner"},Mn={class:"banner-content"},Ln={class:"banner-text"},On={class:"modal-dialog"},An={class:"modal-header"},En={class:"modal-body"},Vn={class:"device-list"},jn={class:"device-info"},Pn={class:"device-details"},Un={class:"command-count"},Fn={class:"device-actions"},Nn=["onClick"],Bn=["onClick"],Hn={class:"modal-footer"},qn={class:"modal-dialog modal-dialog-small"},Jn={class:"modal-header"},zn={class:"modal-body"},Gn={class:"warning-message"},Wn={class:"modal-footer"},Kn=["disabled"],Xn=["disabled"],Yn={__name:"DeviceDiscovery",emits:["adopt"],setup(o,{expose:c,emit:d}){const w=Ve(),$=d,l=y([]),m=y(!1),p=y(!1),C=y(null),S=y(!1),V=J(()=>l.value.length>0);Te(async()=>{await h()});const h=async()=>{try{const P=await ce.get("/api/devices/discover");l.value=P.data.untracked_devices||[]}catch(P){console.error("Error loading untracked devices:",P),l.value=[]}},t=P=>{m.value=!1,$("adopt",P)},L=P=>{C.value=P,p.value=!0},B=async()=>{if(C.value){S.value=!0;try{const P=await ce.delete(`/api/devices/untracked/${encodeURIComponent(C.value.device_name)}`);if(P.data.success)l.value=l.value.filter(T=>T.device_name!==C.value.device_name),p.value=!1,C.value=null,console.log("Device deleted successfully");else throw new Error(P.data.error||"Failed to delete device")}catch(P){console.error("Error deleting device:",P),w.error(`Failed to delete device: ${P.message}`)}finally{S.value=!1}}};return c({refresh:h}),(P,T)=>{var a,g,f;return V.value?(n(),s("div",Rn,[e("div",Mn,[T[9]||(T[9]=e("div",{class:"banner-icon"},[e("i",{class:"mdi mdi-radar"})],-1)),e("div",Ln,[T[7]||(T[7]=e("h3",null,"Untracked Devices Found",-1)),e("p",null,u(l.value.length)+" device"+u(l.value.length>1?"s":"")+" with learned commands found in Broadlink storage",1)]),e("button",{onClick:T[0]||(T[0]=E=>m.value=!0),class:"btn btn-primary"},[...T[8]||(T[8]=[e("i",{class:"mdi mdi-eye"},null,-1),_(" View Devices ",-1)])])]),m.value?(n(),s("div",{key:0,class:"modal-overlay",onClick:T[3]||(T[3]=ge(E=>m.value=!1,["self"]))},[e("div",On,[e("div",An,[T[11]||(T[11]=e("h2",null,"Discovered Devices",-1)),e("button",{onClick:T[1]||(T[1]=E=>m.value=!1),class:"close-btn"},[...T[10]||(T[10]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",En,[T[16]||(T[16]=e("p",{class:"info-text"}," These devices have learned commands in Broadlink storage but are not being tracked. Adopt them to manage their commands and generate Home Assistant entities. ",-1)),e("div",Vn,[(n(!0),s(me,null,he(l.value,E=>(n(),s("div",{key:E.device_name,class:"discovered-device"},[e("div",jn,[T[13]||(T[13]=e("div",{class:"device-icon"},[e("i",{class:"mdi mdi-devices"})],-1)),e("div",Pn,[e("h4",null,u(E.device_name),1),e("span",Un,[T[12]||(T[12]=e("i",{class:"mdi mdi-remote"},null,-1)),_(" "+u(E.command_count)+" command"+u(E.command_count>1?"s":""),1)])])]),e("div",Fn,[e("button",{onClick:X=>t(E),class:"btn btn-primary"},[...T[14]||(T[14]=[e("i",{class:"mdi mdi-plus"},null,-1),_(" Adopt ",-1)])],8,Nn),e("button",{onClick:X=>L(E),class:"btn btn-danger",title:"Delete all commands"},[...T[15]||(T[15]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,Bn)])]))),128))])]),e("div",Hn,[e("button",{onClick:T[2]||(T[2]=E=>m.value=!1),class:"btn btn-secondary"}," Close ")])])])):M("",!0),p.value?(n(),s("div",{key:1,class:"modal-overlay",onClick:T[6]||(T[6]=ge(E=>p.value=!1,["self"]))},[e("div",qn,[e("div",Jn,[T[18]||(T[18]=e("h2",null,"Delete Untracked Device",-1)),e("button",{onClick:T[4]||(T[4]=E=>p.value=!1),class:"close-btn"},[...T[17]||(T[17]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",zn,[e("div",Gn,[T[20]||(T[20]=e("i",{class:"mdi mdi-alert"},null,-1)),e("div",null,[e("p",null,[e("strong",null,'Are you sure you want to delete "'+u((a=C.value)==null?void 0:a.device_name)+'"?',1)]),e("p",null,"This will permanently delete all "+u((g=C.value)==null?void 0:g.command_count)+" command"+u(((f=C.value)==null?void 0:f.command_count)>1?"s":"")+" from Broadlink storage.",1),T[19]||(T[19]=e("p",{class:"warning-text"},"This action cannot be undone.",-1))])])]),e("div",Wn,[e("button",{onClick:T[5]||(T[5]=E=>p.value=!1),class:"btn btn-secondary",disabled:S.value}," Cancel ",8,Kn),e("button",{onClick:B,class:"btn btn-danger",disabled:S.value},[e("i",{class:Z(["mdi",S.value?"mdi-loading mdi-spin":"mdi-delete"])},null,2),_(" "+u(S.value?"Deleting...":"Delete"),1)],8,Xn)])])])):M("",!0)])):M("",!0)}}},Zn=ke(Yn,[["__scopeId","data-v-24463050"]]),Qn={class:"device-list-card"},es={class:"card-header"},ts={class:"header-badges"},os={class:"header-info"},ls={class:"header-right"},ns=["disabled"],ss=["disabled"],as={class:"card-body"},is={key:0,class:"filter-bar"},rs={class:"filter-row filter-row-search"},ds={class:"filter-group filter-search"},us={class:"filter-row filter-row-dropdowns"},cs={class:"filter-group"},ms=["value"],vs={class:"filter-group"},ps=["value"],fs={class:"filter-group"},gs={key:0,class:"filter-group filter-toggle"},ys={class:"toggle-label"},bs={class:"view-toggle-group"},hs={class:"filter-results"},ks={key:1,class:"loading-state"},ws={key:2,class:"error-state"},$s={key:3,class:"empty-state"},Cs={key:4,class:"device-grid"},_s={key:6,class:"no-results"},Ss={__name:"DeviceList",setup(o){const c=at(),d=Ve(),w=y(!1),$=y(!1),l=y(null),m=y(!1),p=y(null),C=y(null),S=y(!0),V=y(!1),h=y(!1),t=y(localStorage.getItem("device_view_mode")||"grid"),L=()=>{S.value=!S.value},B=y(!1),P=y({title:"Error",message:"",suggestion:"",details:"",error:null,context:{}}),T=y(!1),a=y({success:!1,title:"",message:""}),g=y({search:"",broadlinkDevice:"",area:"",entityType:"",showSmartIROnly:!1}),f=y([]),E=Ce("smartirStatus"),X=Ce("smartirEnabled"),oe=J(()=>{var k;return localStorage.getItem("smartir_simulate_not_installed")==="true"?!1:((k=E==null?void 0:E.value)==null?void 0:k.installed)||!1}),le=J(()=>{const x=new Map;return c.devices.forEach(k=>{if(k.broadlink_entity){const R=f.value.find(K=>K.entity_id===k.broadlink_entity),H=R&&R.name||k.broadlink_entity;x.set(k.broadlink_entity,{entity_id:k.broadlink_entity,friendly_name:H})}}),Array.from(x.values()).sort((k,R)=>k.friendly_name.localeCompare(R.friendly_name))}),ve=J(()=>{const x=new Set;return c.devices.forEach(k=>{k.area&&x.add(k.area)}),Array.from(x).sort()}),O=J(()=>{let x=c.devices;if(g.value.search){const R=g.value.search.toLowerCase();x=x.filter(H=>{var G,ee,de,xe,Me;if((G=H.name)!=null&&G.toLowerCase().includes(R)||(ee=H.entity_type)!=null&&ee.toLowerCase().includes(R)||(de=H.area)!=null&&de.toLowerCase().includes(R)||(xe=H.id)!=null&&xe.toLowerCase().includes(R)||Object.keys(H.commands||{}).some(Ee=>Ee.toLowerCase().includes(R)))return!0;const se=f.value.find(Ee=>Ee.entity_id===H.broadlink_entity);return!!((Me=se==null?void 0:se.name)!=null&&Me.toLowerCase().includes(R))})}g.value.broadlinkDevice&&(x=x.filter(R=>R.broadlink_entity===g.value.broadlinkDevice||R.controller_device===g.value.broadlinkDevice)),g.value.area&&(x=x.filter(R=>R.area===g.value.area)),g.value.entityType&&(x=x.filter(R=>R.entity_type===g.value.entityType)),g.value.showSmartIROnly&&(x=x.filter(R=>R.device_type==="smartir"));const k=localStorage.getItem("smartir_simulate_not_installed")==="true";return(!(X!=null&&X.value)||k)&&(x=x.filter(R=>R.device_type!=="smartir")),x}),N=J(()=>g.value.search||g.value.broadlinkDevice||g.value.area||g.value.entityType||g.value.showSmartIROnly),te=()=>{g.value.search="",g.value.broadlinkDevice="",g.value.area="",g.value.entityType="",g.value.showSmartIROnly=!1},ue=async()=>{try{const x=await ce.get("/api/remote/devices");f.value=x.data.devices||[]}catch(x){console.error("Error loading remote devices:",x)}};Te(async()=>{await Promise.all([c.loadDevices(),ue()])});const be=x=>{l.value=x,w.value=!0},Se=J(()=>{if(!p.value)return"";const x=Object.keys(p.value.commands||{}).length;return x===0?"This device has no commands. The device will be removed from tracking.":`This device has ${x} learned command${x>1?"s":""}. What would you like to do?`}),Ie=J(()=>{if(!p.value)return"";const x=Object.keys(p.value.commands||{}).length;return x===0?"":`Also delete all ${x} command${x>1?"s":""} from Broadlink storage`}),De=x=>{p.value=x,m.value=!0},I=()=>{m.value=!1,p.value=null},r=async x=>{var R,H;const k=p.value;m.value=!1;try{await c.deleteDevice(k.id,x),C.value&&await C.value.refresh()}catch(K){const se=((H=(R=K.response)==null?void 0:R.data)==null?void 0:H.error)||K.message||"Unknown error";v("Failed to Delete Device",se)}finally{p.value=null}},j=async x=>{var k,R,H,K,se;try{console.log("💾 Saving device data:",x),console.log("💾 Device commands:",x.commands),console.log("💾 Selected device:",l.value),(k=l.value)!=null&&k.id&&l.value.id!==null?await c.updateDevice(l.value.id,x):await c.createDevice(x),ie(),C.value&&await C.value.refresh()}catch(G){let ee="Failed to save device",de="",xe="";(H=(R=G.response)==null?void 0:R.data)!=null&&H.error?(ee=G.response.data.error,de=G.response.data.suggestion||""):G.message&&(ee=G.message),G.response&&(xe=`Status: ${G.response.status}
URL: ${((K=G.config)==null?void 0:K.url)||"N/A"}`),v("Failed to Save Device",ee,de,xe,G,{action:"save_device",deviceData:x,isEdit:!!((se=l.value)!=null&&se.id)})}},ie=()=>{w.value=!1,l.value=null},W=x=>{l.value=x,$.value=!0},b=()=>{$.value=!1,l.value=null},v=(x,k,R="",H="",K=null,se={})=>{P.value={title:x,message:k,suggestion:R,details:H,error:K,context:se},B.value=!0},Y=()=>{B.value=!1},ae=()=>{T.value=!1},q=async x=>{if(x&&x.commands&&l.value){const k=c.devices.findIndex(R=>R.id===l.value.id);k!==-1&&(c.devices[k].commands=x.commands,console.log(`Optimistically updated device ${l.value.id} with new command: ${x.commandName}`))}c.loadDevices(),C.value&&C.value.refresh()},D=x=>{const k=x.split("_"),R=[];for(let H=0;H<k.length;H++){const K=k[H],se=k[H+1];K&&se==="s"&&k[H+2]?(R.push(K.charAt(0).toUpperCase()+K.slice(1)+"'s"),H++):K!=="s"&&R.push(K.charAt(0).toUpperCase()+K.slice(1))}return R.join(" ")},ne=(x,k)=>{const R=x.toLowerCase(),H=k.map(ee=>ee.toLowerCase());return R.includes("lamp")||R.includes("light")?"light":R.includes("fan")?"fan":R.includes("tv")||R.includes("stereo")||R.includes("speaker")||R.includes("receiver")?"media_player":R.includes("blind")||R.includes("curtain")||R.includes("shade")||R.includes("garage")?"cover":H.some(ee=>ee.includes("volume")||ee.includes("channel")||ee.includes("play")||ee.includes("pause")||ee.includes("mute"))?"media_player":H.some(ee=>ee.includes("fan_speed")||ee.includes("fan_low")||ee.includes("fan_high"))?"fan":H.some(ee=>ee.includes("open")||ee.includes("close")||ee.includes("stop"))?"cover":"switch"},Q=(x,k)=>{const R=x.toLowerCase();return R.includes("tv")?"mdi:television":R.includes("stereo")||R.includes("receiver")||R.includes("speaker")?"mdi:speaker":R.includes("lamp")?"mdi:lamp":R.includes("light")?"mdi:lightbulb":R.includes("fan")?"mdi:fan":R.includes("blind")?"mdi:blinds":R.includes("curtain")?"mdi:curtains":R.includes("garage")?"mdi:garage":{light:"mdi:lightbulb",fan:"mdi:fan",switch:"mdi:light-switch",media_player:"mdi:speaker",cover:"mdi:window-shutter"}[k]||"mdi:devices"},re=x=>{const k=x.toLowerCase().split("_");for(let K=0;K<k.length-2;K++)if(k[K+1]==="s"){const se=k.slice(K,K+3),G=D(se.join("_"));return console.log("Detected possessive area:",G,"from",x),G}const R=[["living","room"],["dining","room"],["master","bedroom"],["guest","bedroom"],["family","room"],["laundry","room"],["home","office"]];for(let K=0;K<k.length-1;K++){const se=[k[K],k[K+1]],G=R.find(ee=>ee[0]===se[0]&&ee[1]===se[1]);if(G)return D(G.join("_"))}const H=["kitchen","bedroom","bathroom","garage","office","basement","attic","hallway","entryway","patio","deck","yard","garden"];for(const K of k)if(H.includes(K))return K.charAt(0).toUpperCase()+K.slice(1);return""},A=async x=>{const k=D(x.device_name),R=re(x.device_name),H=ne(x.device_name,x.commands),K=Q(x.device_name,H);let se="";try{console.log("Finding Broadlink owner for:",x.device_name);const ee=await ce.post("/api/devices/find-broadlink-owner",{device_name:x.device_name});console.log("Broadlink owner response:",ee.data),se=ee.data.broadlink_entity||"",console.log("Detected Broadlink entity:",se)}catch(ee){console.error("Error finding Broadlink owner:",ee)}l.value={id:null,device:x.device_name,name:k,entity_type:H,commands:{},area:R,icon:K,broadlink_entity:se,enabled:!0};const G={};x.commands.forEach(ee=>{G[ee]=ee}),l.value.commands=G,w.value=!0},i=async()=>{h.value=!0;try{await c.syncAllAreas(),d.success("Areas synced from Home Assistant")}catch(x){console.error("Error syncing areas:",x),d.error("Failed to sync areas")}finally{h.value=!1}},F=async()=>{var x,k;V.value=!0;try{const R=await ce.post("/api/entities/generate",{});if(R.data.success){const H=R.data.broadlink_count||0,K=R.data.smartir_count||0,se=R.data.total_count||0,G=R.data.errors||[];let ee="✅ Entity Generation Successful",de=[];const xe=[];H>0&&xe.push(`${H} Broadlink native`),K>0&&xe.push(`${K} SmartIR`),xe.length>0&&de.push(`Generated ${xe.join(" and ")} entity configuration${se!==1?"s":""}.`),H>0&&(de.push(`
📁 Broadlink entities created in:`),de.push("  • broadlink_manager/entities.yaml"),de.push("  • broadlink_manager/helpers.yaml")),K>0&&(de.push(`
📁 SmartIR entities created in:`),de.push("  • smartir/climate.yaml"),de.push("  • smartir/media_player.yaml"),de.push("  • smartir/fan.yaml")),de.push(`
📝 Next steps:`),de.push("1. Check your configuration.yaml includes the generated files"),de.push("2. Restart Home Assistant to load the new entities"),G.length>0&&(ee="⚠️ Entity Generation Completed with Errors",de.push(`
⚠️ ${G.length} error${G.length!==1?"s":""} occurred:`),G.forEach(Me=>{de.push(`  • ${Me}`)})),a.value={success:!0,title:ee,message:de.join(`
`)},T.value=!0}else a.value={success:!1,title:"❌ Entity Generation Failed",message:R.data.message||`Failed to generate entities.

Please check that you have at least one device configured.`},T.value=!0}catch(R){console.error("Error generating entities:",R);const H=((k=(x=R.response)==null?void 0:x.data)==null?void 0:k.error)||R.message||"Unknown error occurred";a.value={success:!1,title:"❌ Entity Generation Error",message:`Failed to generate entities:

${H}

Please check the logs for more details.`},T.value=!0}finally{V.value=!1}},U=async({device:x,command:k})=>{var R,H;try{const K={device_id:x.id,command:k,entity_id:x.broadlink_entity,device:x.device};await ce.post("/api/commands/test",K),d.success(`Sent ${k} to ${x.name}`)}catch(K){console.error("Error sending command:",K);const se=((H=(R=K.response)==null?void 0:R.data)==null?void 0:H.error)||K.message||"Unknown error";d.error(`Failed to send ${k}: ${se}`)}};return(x,k)=>{var R;return n(),s("div",Qn,[e("div",es,[e("button",{class:"icon-button chevron-button",onClick:L},[e("i",{class:Z(["mdi",S.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2)]),e("div",{class:"header-left",onClick:L},[k[10]||(k[10]=e("div",{class:"header-icon"},[e("i",{class:"mdi mdi-devices"})],-1)),k[11]||(k[11]=e("h3",null,"Managed Devices",-1)),e("div",ts,[e("span",os,u($e(c).deviceCount)+" devices",1)])]),e("div",ls,[S.value?(n(),s("button",{key:0,onClick:ge(i,["stop"]),class:"btn btn-secondary",disabled:h.value,title:"Sync all areas from Home Assistant"},[e("i",{class:Z(["mdi",h.value?"mdi-loading mdi-spin":"mdi-refresh"])},null,2),_(" "+u(h.value?"Syncing...":"Sync Areas"),1)],8,ns)):M("",!0),S.value?(n(),s("button",{key:1,onClick:ge(F,["stop"]),class:"btn btn-secondary",disabled:V.value,title:"Generate entities for all devices"},[e("i",{class:Z(["mdi",V.value?"mdi-loading mdi-spin":"mdi-file-code"])},null,2),_(" "+u(V.value?"Generating...":"Generate Entities"),1)],8,ss)):M("",!0),S.value?(n(),s("button",{key:2,onClick:k[0]||(k[0]=ge(H=>w.value=!0,["stop"])),class:"btn btn-primary"},[...k[12]||(k[12]=[e("i",{class:"mdi mdi-plus"},null,-1),_(" Add Device ",-1)])])):M("",!0)])]),z(e("div",as,[ye(Zn,{ref_key:"discoveryRef",ref:C,onAdopt:A},null,512),$e(c).hasDevices?(n(),s("div",is,[e("div",rs,[e("div",ds,[e("label",null,[k[13]||(k[13]=e("i",{class:"mdi mdi-magnify"},null,-1)),z(e("input",{"onUpdate:modelValue":k[1]||(k[1]=H=>g.value.search=H),type:"text",placeholder:"Search devices, commands...",class:"search-input"},null,512),[[_e,g.value.search]])])])]),e("div",us,[e("div",cs,[e("label",null,[k[15]||(k[15]=e("i",{class:"mdi mdi-access-point"},null,-1)),z(e("select",{"onUpdate:modelValue":k[2]||(k[2]=H=>g.value.broadlinkDevice=H)},[k[14]||(k[14]=e("option",{value:""},"All Controller Devices",-1)),(n(!0),s(me,null,he(le.value,H=>(n(),s("option",{key:H.entity_id,value:H.entity_id},u(H.friendly_name),9,ms))),128))],512),[[we,g.value.broadlinkDevice]])])]),e("div",vs,[e("label",null,[k[17]||(k[17]=e("i",{class:"mdi mdi-home-map-marker"},null,-1)),z(e("select",{"onUpdate:modelValue":k[3]||(k[3]=H=>g.value.area=H)},[k[16]||(k[16]=e("option",{value:""},"All Areas",-1)),(n(!0),s(me,null,he(ve.value,H=>(n(),s("option",{key:H,value:H},u(H),9,ps))),128))],512),[[we,g.value.area]])])]),e("div",fs,[e("label",null,[k[19]||(k[19]=e("i",{class:"mdi mdi-shape"},null,-1)),z(e("select",{"onUpdate:modelValue":k[4]||(k[4]=H=>g.value.entityType=H)},[...k[18]||(k[18]=[Oe('<option value="" data-v-320d08f3>All Types</option><option value="light" data-v-320d08f3>Light</option><option value="fan" data-v-320d08f3>Fan</option><option value="switch" data-v-320d08f3>Switch</option><option value="media_player" data-v-320d08f3>Media Player</option><option value="cover" data-v-320d08f3>Cover</option><option value="climate" data-v-320d08f3>Climate</option>',7)])],512),[[we,g.value.entityType]])])]),oe.value?(n(),s("div",gs,[e("label",ys,[k[20]||(k[20]=e("span",{class:"toggle-text"},[e("img",{src:Be,alt:"SmartIR",class:"smartir-icon"}),_(" SmartIR Only ")],-1)),z(e("input",{type:"checkbox","onUpdate:modelValue":k[5]||(k[5]=H=>g.value.showSmartIROnly=H),class:"toggle-checkbox"},null,512),[[pe,g.value.showSmartIROnly]]),k[21]||(k[21]=e("span",{class:"toggle-slider"},null,-1))])])):M("",!0),N.value?(n(),s("button",{key:1,onClick:te,class:"btn-clear-filters"},[...k[22]||(k[22]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),_(" Clear ",-1)])])):M("",!0),e("div",bs,[e("button",{onClick:k[6]||(k[6]=H=>t.value="grid"),class:Z(["view-toggle-btn",{active:t.value==="grid"}]),title:"Grid View"},[...k[23]||(k[23]=[e("i",{class:"mdi mdi-view-grid"},null,-1),_(" Grid ",-1)])],2),e("button",{onClick:k[7]||(k[7]=H=>t.value="list"),class:Z(["view-toggle-btn",{active:t.value==="list"}]),title:"List View"},[...k[24]||(k[24]=[e("i",{class:"mdi mdi-view-list"},null,-1),_(" List ",-1)])],2)]),e("div",hs,u(O.value.length)+" of "+u($e(c).deviceCount),1)])])):M("",!0),$e(c).loading?(n(),s("div",ks,[...k[25]||(k[25]=[e("i",{class:"mdi mdi-loading mdi-spin"},null,-1),e("p",null,"Loading devices...",-1)])])):$e(c).error?(n(),s("div",ws,[k[26]||(k[26]=e("i",{class:"mdi mdi-alert-circle"},null,-1)),e("p",null,u($e(c).error),1),e("button",{onClick:k[8]||(k[8]=H=>$e(c).loadDevices()),class:"btn btn-secondary"}," Retry ")])):$e(c).hasDevices?M("",!0):(n(),s("div",$s,[k[28]||(k[28]=e("i",{class:"mdi mdi-devices"},null,-1)),k[29]||(k[29]=e("h3",null,"No Devices Yet",-1)),k[30]||(k[30]=e("p",null,"Get started by adding your first managed device",-1)),e("button",{onClick:k[9]||(k[9]=H=>w.value=!0),class:"btn btn-primary"},[...k[27]||(k[27]=[e("i",{class:"mdi mdi-plus"},null,-1),_(" Add Your First Device ",-1)])])])),t.value==="grid"?(n(),s("div",Cs,[(n(!0),s(me,null,he(O.value,H=>(n(),Re(Tt,{key:H.id,device:H,"broadlink-devices":f.value,onEdit:be,onDelete:De,onLearn:W},null,8,["device","broadlink-devices"]))),128))])):t.value==="list"&&O.value.length>0?(n(),Re(Wt,{key:5,devices:O.value,onSendCommand:U,onEditDevice:be,onDeleteDevice:De},null,8,["devices"])):M("",!0),$e(c).hasDevices&&O.value.length===0?(n(),s("div",_s,[...k[31]||(k[31]=[e("i",{class:"mdi mdi-filter-off"},null,-1),e("h3",null,"No devices match your filters",-1),e("p",null,"Try adjusting your search or filter criteria",-1)])])):M("",!0)],512),[[Ke,S.value]]),w.value?(n(),Re(Cl,{key:0,device:l.value,onSave:j,onCancel:ie},null,8,["device"])):M("",!0),$.value?(n(),Re(yn,{key:1,device:l.value,onLearned:q,onCancel:b},null,8,["device"])):M("",!0),ye(Le,{isOpen:m.value,title:`Delete ${(R=p.value)==null?void 0:R.name}?`,message:Se.value,confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,checkboxLabel:Ie.value,onConfirm:r,onCancel:I},null,8,["isOpen","title","message","checkboxLabel"]),ye(Tn,{isOpen:B.value,title:P.value.title,message:P.value.message,suggestion:P.value.suggestion,details:P.value.details,error:P.value.error,context:P.value.context,onClose:Y},null,8,["isOpen","title","message","suggestion","details","error","context"]),ye(Le,{isOpen:T.value,title:a.value.title,message:a.value.message,confirmText:"OK",showCancel:!1,dangerMode:!a.value.success,onConfirm:ae,onCancel:ae},null,8,["isOpen","title","message","dangerMode"])])}}},Is=ke(Ss,[["__scopeId","data-v-320d08f3"]]),Ds={class:"banner-content"},xs={class:"banner-icon"},Ts={class:"banner-message"},Rs={class:"banner-actions"},Ms={__name:"SmartIRBanner",setup(o){const c=Ce("smartirStatus"),d=y(!1),w=J(()=>!(!c.value||d.value||localStorage.getItem("smartir_banner_dismissed")==="true")),$=J(()=>{var V;return(V=c.value)!=null&&V.installed?"banner-success":"banner-info"}),l=J(()=>{var V;return(V=c.value)!=null&&V.installed?"mdi mdi-check-circle":"mdi mdi-information"}),m=J(()=>{var V;return(V=c.value)!=null&&V.installed?`SmartIR Detected (v${c.value.version})`:"Want Climate Device Support?"}),p=J(()=>{var V;return(V=c.value)!=null&&V.installed?"You can now create climate device profiles with full temperature and HVAC mode control.":"Install SmartIR to unlock AC/heater control with temperature settings, HVAC modes, and 120+ pre-configured device profiles."});function C(){window.open("https://github.com/smartHomeHub/SmartIR","_blank")}function S(){var V;if(d.value=!0,(V=c.value)!=null&&V.installed)localStorage.setItem("smartir_banner_dismissed","true");else{const h=parseInt(localStorage.getItem("smartir_banner_dismiss_count")||"0");h>=2?localStorage.setItem("smartir_banner_dismissed","true"):localStorage.setItem("smartir_banner_dismiss_count",String(h+1))}}return Te(()=>{var t;const V=localStorage.getItem("smartir_last_status"),h=(t=c.value)!=null&&t.installed?"installed":"not_installed";V!==h&&(localStorage.removeItem("smartir_banner_dismissed"),localStorage.removeItem("smartir_banner_dismiss_count"),localStorage.setItem("smartir_last_status",h))}),(V,h)=>{var t,L;return w.value?(n(),s("div",{key:0,class:Z(["smartir-banner",$.value])},[e("div",Ds,[e("div",xs,[e("i",{class:Z(l.value)},null,2)]),e("div",Ts,[e("strong",null,u(m.value),1),e("p",null,u(p.value),1)]),e("div",Rs,[(t=V.status)!=null&&t.installed?M("",!0):(n(),s("button",{key:0,onClick:C,class:"btn-primary"}," Learn More ")),e("button",{onClick:S,class:"btn-text"},u((L=V.status)!=null&&L.installed?"Got it":"Dismiss"),1)])])],2)):M("",!0)}}},Ls=ke(Ms,[["__scopeId","data-v-7bbcbcd7"]]),Ae="api/smartir",Ye={async getStatus(){try{const o=await fetch(`${Ae}/status`);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return await o.json()}catch(o){return console.error("Error fetching SmartIR status:",o),{installed:!1,version:null,error:o.message}}},async getInstallInstructions(){try{const o=await fetch(`${Ae}/install-instructions`);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return await o.json()}catch(o){throw console.error("Error fetching install instructions:",o),o}},async getPlatforms(){try{const o=await fetch(`${Ae}/platforms`);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return await o.json()}catch(o){throw console.error("Error fetching platforms:",o),o}},async getPlatformCodes(o){try{const c=await fetch(`${Ae}/platforms/${o}/codes`);if(!c.ok)throw new Error(`HTTP error! status: ${c.status}`);return await c.json()}catch(c){throw console.error(`Error fetching codes for ${o}:`,c),c}},async getNextCode(o){try{const c=await fetch(`${Ae}/platforms/${o}/next-code`);if(!c.ok)throw new Error(`HTTP error! status: ${c.status}`);return await c.json()}catch(c){throw console.error(`Error fetching next code for ${o}:`,c),c}},async validateCode(o,c){try{const d=await fetch(`${Ae}/validate-code`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({platform:o,code:c})});if(!d.ok)throw new Error(`HTTP error! status: ${d.status}`);return await d.json()}catch(d){throw console.error("Error validating code:",d),d}}},Os={class:"profile-card"},As={class:"profile-card-header"},Es=["title"],Vs={class:"profile-details"},js=["title"],Ps={class:"profile-meta"},Us=["title"],Fs=["title"],Ns=["title"],Bs={class:"profile-card-footer"},Hs=["title"],qs={key:0,class:"learned-indicator"},Js={class:"profile-actions"},zs={__name:"SmartIRProfileCard",props:{profile:{type:Object,required:!0}},emits:["edit","download","delete","commands"],setup(o){const c=o,d=Xe(J(()=>c.profile.platform)),w=m=>m.replace(/_/g," ").replace(/\b\w/g,p=>p.toUpperCase()),$=m=>m&&m.startsWith("mdi:")?`mdi ${m.replace(":"," mdi-")}`:`mdi mdi-${m}`,l=m=>{if(!m)return"";const p=m.toLowerCase();return p.includes("broadlink")?"broadlink-tag":p.includes("not set")?"not-set-tag":"default-controller-tag"};return(m,p)=>(n(),s("div",Os,[e("div",As,[e("div",{class:Z(["profile-icon",$e(d).colorClass.value]),title:w(o.profile.platform)},[e("i",{class:Z($($e(d).icon.value))},null,2)],10,Es),e("div",Vs,[e("h4",{title:`${o.profile.manufacturer} ${o.profile.model}`},u(o.profile.manufacturer)+" "+u(o.profile.model),9,js),e("div",Ps,[e("span",{class:"tag platform-tag",title:w(o.profile.platform)},u(w(o.profile.platform)),9,Us),o.profile.controllerBrand?(n(),s("span",{key:0,class:Z(["tag controller-tag",l(o.profile.controllerBrand)]),title:"Controller: "+o.profile.controllerBrand},[p[4]||(p[4]=e("i",{class:"mdi mdi-remote-tv"},null,-1)),_(" "+u(o.profile.controllerBrand),1)],10,Fs)):M("",!0)])]),e("div",{class:"code-badge",title:"Device Code: "+o.profile.code},u(o.profile.code),9,Ns)]),e("div",Bs,[e("div",{class:"profile-stats",title:o.profile.commandCount+" total commands"+(o.profile.learnedCount>0?", "+o.profile.learnedCount+" learned":"")},[p[5]||(p[5]=e("i",{class:"mdi mdi-remote"},null,-1)),e("span",null,u(o.profile.commandCount)+" command"+u(o.profile.commandCount!==1?"s":""),1),o.profile.learnedCount>0?(n(),s("span",qs,"( "+u(o.profile.learnedCount)+" learned )",1)):M("",!0)],8,Hs),e("div",Js,[e("button",{onClick:p[0]||(p[0]=C=>m.$emit("commands")),class:"action-btn",title:"Commands"},[...p[6]||(p[6]=[e("i",{class:"mdi mdi-remote"},null,-1)])]),e("button",{onClick:p[1]||(p[1]=C=>m.$emit("edit")),class:"action-btn",title:"Edit Profile"},[...p[7]||(p[7]=[e("i",{class:"mdi mdi-pencil"},null,-1)])]),e("button",{onClick:p[2]||(p[2]=C=>m.$emit("download")),class:"action-btn",title:"Download JSON"},[...p[8]||(p[8]=[e("i",{class:"mdi mdi-download"},null,-1)])]),e("button",{onClick:p[3]||(p[3]=C=>m.$emit("delete")),class:"action-btn delete",title:"Delete Profile"},[...p[9]||(p[9]=[e("i",{class:"mdi mdi-delete"},null,-1)])])])])]))}},Gs=ke(zs,[["__scopeId","data-v-b72a1955"]]),Ws={name:"SmartIRProfileListView",props:{profiles:{type:Array,required:!0}},methods:{getPlatformIcon(o){return{climate:"mdi-thermostat",media_player:"mdi-television",fan:"mdi-fan",light:"mdi-lightbulb"}[o]||"mdi-devices"},formatPlatform(o){return{climate:"Climate",media_player:"Media Player",fan:"Fan",light:"Light"}[o]||o},editProfile(o){this.$emit("edit",o)},viewCommands(o){this.$emit("commands",o)},downloadProfile(o){this.$emit("download",o)},deleteProfile(o){this.$emit("delete",o)}}},Ks={class:"profile-list-view"},Xs={class:"profile-table"},Ys={class:"profile-code"},Zs={class:"code-badge"},Qs={class:"profile-manufacturer"},ea={class:"profile-model"},ta={class:"model-info"},oa={class:"model-name"},la={key:0,class:"model-count"},na={class:"profile-platform"},sa={class:"profile-controller"},aa={class:"profile-commands"},ia={class:"command-stats"},ra={class:"stat-item"},da={key:0,class:"stat-item learned"},ua={class:"profile-actions"},ca=["onClick"],ma=["onClick"],va=["onClick"],pa=["onClick"];function fa(o,c,d,w,$,l){return n(),s("div",Ks,[e("table",Xs,[c[6]||(c[6]=e("thead",null,[e("tr",null,[e("th",null,"Code"),e("th",null,"Manufacturer"),e("th",null,"Model"),e("th",null,"Platform"),e("th",null,"Controller"),e("th",null,"Commands"),e("th",null,"Actions")])],-1)),e("tbody",null,[(n(!0),s(me,null,he(d.profiles,m=>(n(),s("tr",{key:`${m.platform}-${m.code}`,class:"profile-row"},[e("td",Ys,[e("span",Zs,u(m.code),1)]),e("td",Qs,u(m.manufacturer||"Unknown"),1),e("td",ea,[e("div",ta,[e("div",oa,u(m.model||"Unknown"),1),m.models&&m.models.length>1?(n(),s("div",la," +"+u(m.models.length-1)+" more ",1)):M("",!0)])]),e("td",na,[e("span",{class:Z(["platform-badge",m.platform])},[e("i",{class:Z(["mdi",l.getPlatformIcon(m.platform)])},null,2),_(" "+u(l.formatPlatform(m.platform)),1)],2)]),e("td",sa,u(m.controller_brand||"N/A"),1),e("td",aa,[e("div",ia,[e("span",ra,[c[0]||(c[0]=e("i",{class:"mdi mdi-remote"},null,-1)),_(" "+u(m.command_count||0),1)]),m.learned_count>0?(n(),s("span",da,[c[1]||(c[1]=e("i",{class:"mdi mdi-school"},null,-1)),_(" "+u(m.learned_count),1)])):M("",!0)])]),e("td",ua,[e("button",{class:"action-btn edit",onClick:p=>l.editProfile(m),title:"Edit Profile"},[...c[2]||(c[2]=[e("i",{class:"mdi mdi-pencil"},null,-1)])],8,ca),e("button",{class:"action-btn commands",onClick:p=>l.viewCommands(m),title:"View Commands"},[...c[3]||(c[3]=[e("i",{class:"mdi mdi-remote"},null,-1)])],8,ma),e("button",{class:"action-btn download",onClick:p=>l.downloadProfile(m),title:"Download"},[...c[4]||(c[4]=[e("i",{class:"mdi mdi-download"},null,-1)])],8,va),e("button",{class:"action-btn delete",onClick:p=>l.deleteProfile(m),title:"Delete"},[...c[5]||(c[5]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,pa)])]))),128))])])])}const ga=ke(Ws,[["render",fa],["__scopeId","data-v-8e144275"]]),ya={class:"modal-container"},ba={class:"modal-body"},ha={key:0,class:"selection-section"},ka={class:"form-group"},wa={class:"form-group"},$a={class:"form-group"},Ca={key:0,class:"code-info"},_a={class:"form-actions"},Sa=["disabled"],Ia={key:1,class:"testing-section"},Da={class:"code-header"},xa={class:"code-details"},Ta={class:"code-badge"},Ra={class:"device-selector"},Ma=["value"],La={class:"commands-section"},Oa={class:"commands-header"},Aa={key:0,class:"tested-count"},Ea={key:0,class:"filters-section"},Va={class:"filter-row"},ja={class:"filter-row"},Pa={key:1,class:"empty-state"},Ua={key:2,class:"empty-state"},Fa={key:3,class:"commands-list"},Na={class:"command-name"},Ba={class:"command-actions"},Ha={key:0,class:"status-badge success"},qa=["onClick","disabled"],Ja={__name:"SmartIRCodeTester",props:{isOpen:{type:Boolean,default:!1}},emits:["close","clone"],setup(o,{emit:c}){const d=o,w=c,$=Ce("toast"),l=y("climate"),m=y(""),p=y([]),C=y(!1),S=y(null),V=y(""),h=y([]),t=y(!1),L=J(()=>h.value.map(q=>({code:q.code,label:`${q.models.join(", ")} (Code: ${q.code})`,value:q.code}))),B=y(null),P=y(null),T=y(!1),a=y([]),g=y(""),f=y([]),E=y(new Set),X=y(null),oe=y(""),le=y(""),ve=y(""),O=y(""),N=J(()=>{let q=f.value;if(oe.value){const D=oe.value.toLowerCase();q=q.filter(ne=>(ne.label||ne.name).toLowerCase().includes(D))}return le.value&&(q=q.filter(D=>D.mode===le.value)),ve.value&&(q=q.filter(D=>D.fanSpeed===ve.value)),O.value&&(q=q.filter(D=>D.swingMode===O.value)),q}),te=J(()=>oe.value||le.value||ve.value||O.value);fe(()=>d.isOpen,q=>{q&&(ue(),Se())}),fe(l,()=>{d.isOpen&&(m.value="",S.value=null,h.value=[],ue())});async function ue(){var q;C.value=!0;try{const D=await fetch(`/api/smartir/codes/manufacturers?entity_type=${l.value}`);if(!D.ok)throw new Error("Failed to load manufacturers");const ne=await D.json();p.value=ne.manufacturers||[]}catch(D){console.error("Error loading manufacturers:",D),(q=$.value)==null||q.error("Failed to load manufacturers","❌ Error")}finally{C.value=!1}}async function be(){var q;if(m.value){t.value=!0;try{const D=await fetch(`/api/smartir/codes/models?entity_type=${l.value}&manufacturer=${encodeURIComponent(m.value)}`);if(!D.ok)throw new Error("Failed to load models");const ne=await D.json();h.value=ne.models||[]}catch(D){console.error("Error loading models:",D),(q=$.value)==null||q.error("Failed to load models","❌ Error")}finally{t.value=!1}}}async function Se(){try{const q=await fetch("/api/remote/devices");if(!q.ok)throw new Error("Failed to load devices");const D=await q.json();a.value=D.devices||[]}catch(q){console.error("Error loading Broadlink devices:",q)}}async function Ie(){var q,D;if(S.value){T.value=!0;try{const ne=await fetch(`/api/smartir/codes/code?entity_type=${l.value}&code_id=${S.value.code}`);if(!ne.ok)throw new Error("Failed to load code");const Q=await ne.json();P.value=Q.code,B.value=S.value.code,De(Q.code),(q=$.value)==null||q.success(`Loaded ${f.value.length} commands`,"✅ Code Loaded")}catch(ne){console.error("Error loading code:",ne),(D=$.value)==null||D.error(ne.message||"Failed to load code","❌ Error")}finally{T.value=!1}}}function De(q){const D=[];if(!q.commands){f.value=D;return}if(l.value==="climate"){const Q=q.commands;for(const[re,A]of Object.entries(Q)){if(re==="off"){typeof A=="string"&&D.push({name:"off",label:"OFF",data:A,mode:"off"});continue}if(typeof A=="object"){for(const[i,F]of Object.entries(A))if(typeof F=="object")for(const[U,x]of Object.entries(F)){if(typeof x!="object")continue;const k=Object.keys(x),R=k.includes("24")?"24":k[0];if(R&&typeof x[R]=="string"){const H=`${re}_${R}_${i}_${U}`,K=`${re.toUpperCase()} ${R}°C ${i} ${U}`;D.push({name:H,label:K,data:x[R],mode:re,temperature:R,fanSpeed:i,swingMode:U})}}}}}else for(const[Q,re]of Object.entries(q.commands))typeof re=="string"&&D.push({name:Q,label:Q.toUpperCase().replace(/_/g," "),data:re});f.value=D}async function I(q){var D,ne,Q;if(!g.value){(D=$.value)==null||D.warning("Please select a Broadlink device first","⚠️ No Device");return}X.value=q;try{const re=f.value.find(i=>i.name===q);if(!re||!re.data)throw new Error(`Command "${q}" not found`);const A=await fetch("/api/commands/send-raw",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({entity_id:g.value,command:re.data,command_type:"ir"})});if(!A.ok){const i=await A.json();throw new Error(i.error||"Failed to send command")}E.value.add(q),(ne=$.value)==null||ne.success(`Command sent: ${re.label||q}`,"✅ Tested")}catch(re){console.error("Error testing command:",re),(Q=$.value)==null||Q.error("Failed to test command","❌ Error")}finally{X.value=null}}function r(){var q,D,ne,Q;if(!P.value){(q=$.value)==null||q.error("No profile data to download","❌ Error");return}try{const re=P.value.manufacturer||"unknown",A=((D=P.value.supportedModels)==null?void 0:D[0])||B.value,i=`${re.toLowerCase().replace(/\s+/g,"_")}_${A.toLowerCase().replace(/\s+/g,"_")}.json`,F=JSON.stringify(P.value,null,2),U=new Blob([F],{type:"application/json"}),x=URL.createObjectURL(U),k=document.createElement("a");k.href=x,k.download=i,document.body.appendChild(k),k.click(),document.body.removeChild(k),URL.revokeObjectURL(x),(ne=$.value)==null||ne.success(`Downloaded ${i}`,"✅ Download Complete")}catch(re){console.error("Error downloading JSON:",re),(Q=$.value)==null||Q.error(re.message||"Failed to download JSON","❌ Download Error")}}function j(){m.value="",S.value=null,V.value="",h.value=[]}function ie(){S.value=null,V.value="",be()}function W(){V.value?S.value=h.value.find(q=>q.code===V.value):S.value=null}function b(){oe.value="",le.value="",ve.value="",O.value=""}function v(){B.value=null,P.value=null,f.value=[],E.value.clear(),X.value=null,b()}function Y(q){const D=q.toLowerCase();return D.includes("power")||D.includes("off")||D==="off"?"mdi-power":D.includes("cool")?"mdi-snowflake":D.includes("heat")?"mdi-fire":D.includes("fan")?"mdi-fan":D.includes("auto")?"mdi-auto-fix":D.includes("dry")?"mdi-water-percent":D.includes("temp")?"mdi-thermometer":D.includes("swing")?"mdi-swap-vertical":"mdi-remote"}function ae(){v(),m.value="",S.value=null,w("close")}return(q,D)=>{var ne;return o.isOpen?(n(),s("div",{key:0,class:"modal-overlay",onClick:ge(ae,["self"])},[e("div",ya,[e("div",{class:"modal-header"},[D[9]||(D[9]=e("h3",null,[e("i",{class:"mdi mdi-test-tube"}),_(" Test SmartIR Code ")],-1)),e("button",{onClick:ae,class:"close-btn"},[...D[8]||(D[8]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",ba,[B.value?(n(),s("div",Ia,[e("div",Da,[e("div",xa,[e("h4",null,u(P.value.manufacturer)+" - "+u(((ne=P.value.supportedModels)==null?void 0:ne[0])||"Unknown"),1),e("span",Ta,"Code: "+u(B.value),1)]),e("button",{onClick:v,class:"btn-secondary-small"},[...D[14]||(D[14]=[e("i",{class:"mdi mdi-arrow-left"},null,-1),_(" Change Code ",-1)])])]),e("div",Ra,[D[16]||(D[16]=e("label",null,[e("i",{class:"mdi mdi-remote"}),_(" Broadlink Device ")],-1)),z(e("select",{"onUpdate:modelValue":D[3]||(D[3]=Q=>g.value=Q),class:"form-select"},[D[15]||(D[15]=e("option",{value:""},"Select device to test with...",-1)),(n(!0),s(me,null,he(a.value,Q=>(n(),s("option",{key:Q.entity_id,value:Q.entity_id},u(Q.friendly_name||Q.entity_id),9,Ma))),128))],512),[[we,g.value]])]),e("div",La,[e("div",Oa,[e("h5",null,"Sample Commands ("+u(N.value.length)+" / "+u(f.value.length)+")",1),E.value.size>0?(n(),s("span",Aa,u(E.value.size)+" tested ",1)):M("",!0)]),l.value==="climate"&&f.value.length>0?(n(),s("div",Ea,[e("div",Va,[z(e("input",{"onUpdate:modelValue":D[4]||(D[4]=Q=>oe.value=Q),type:"text",placeholder:"Search commands...",class:"search-input"},null,512),[[_e,oe.value]])]),e("div",ja,[z(e("select",{"onUpdate:modelValue":D[5]||(D[5]=Q=>le.value=Q),class:"filter-select"},[...D[17]||(D[17]=[e("option",{value:""},"All Modes",-1),e("option",{value:"cool"},"Cool",-1),e("option",{value:"heat"},"Heat",-1),e("option",{value:"off"},"Off",-1)])],512),[[we,le.value]]),z(e("select",{"onUpdate:modelValue":D[6]||(D[6]=Q=>ve.value=Q),class:"filter-select"},[...D[18]||(D[18]=[Oe('<option value="" data-v-64d207ed>All Fan Speeds</option><option value="low" data-v-64d207ed>Low</option><option value="mid" data-v-64d207ed>Mid</option><option value="high" data-v-64d207ed>High</option><option value="auto" data-v-64d207ed>Auto</option>',5)])],512),[[we,ve.value]]),z(e("select",{"onUpdate:modelValue":D[7]||(D[7]=Q=>O.value=Q),class:"filter-select"},[...D[19]||(D[19]=[e("option",{value:""},"All Swing",-1),e("option",{value:"stop"},"Stop",-1),e("option",{value:"swing"},"Swing",-1)])],512),[[we,O.value]]),te.value?(n(),s("button",{key:0,onClick:b,class:"btn-clear-filters"},[...D[20]||(D[20]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),_(" Clear ",-1)])])):M("",!0)])])):M("",!0),f.value.length===0?(n(),s("div",Pa,[...D[21]||(D[21]=[e("i",{class:"mdi mdi-alert-circle"},null,-1),e("p",null,"No commands found in this code",-1)])])):N.value.length===0?(n(),s("div",Ua,[D[22]||(D[22]=e("i",{class:"mdi mdi-filter-off"},null,-1)),D[23]||(D[23]=e("p",null,"No commands match your filters",-1)),e("button",{onClick:b,class:"btn-secondary-small"}," Clear Filters ")])):(n(),s("div",Fa,[(n(!0),s(me,null,he(N.value,Q=>(n(),s("div",{key:Q.name,class:Z(["command-item",{tested:E.value.has(Q.name),testing:X.value===Q.name}])},[e("div",Na,[e("i",{class:Z(["mdi",Y(Q.mode||Q.name)])},null,2),e("span",null,u(Q.label||Q.name),1)]),e("div",Ba,[E.value.has(Q.name)?(n(),s("span",Ha,[...D[24]||(D[24]=[e("i",{class:"mdi mdi-check"},null,-1),_(" Tested ",-1)])])):M("",!0),e("button",{onClick:re=>I(Q.name),disabled:!g.value||X.value===Q.name,class:"btn-test"},[e("i",{class:Z(["mdi",X.value===Q.name?"mdi-loading mdi-spin":"mdi-play"])},null,2),D[25]||(D[25]=_(" Test ",-1))],8,qa)])],2))),128))]))]),e("div",{class:"modal-actions"},[e("button",{onClick:r,class:"btn-primary"},[...D[26]||(D[26]=[e("i",{class:"mdi mdi-download"},null,-1),_(" Download JSON ",-1)])]),e("button",{onClick:ae,class:"btn-secondary"}," Close ")])])):(n(),s("div",ha,[D[13]||(D[13]=e("div",{class:"info-banner"},[e("i",{class:"mdi mdi-information"}),e("p",null,"Select a SmartIR code from the index to test commands with your Broadlink device.")],-1)),e("div",ka,[D[11]||(D[11]=e("label",null,[e("i",{class:"mdi mdi-shape"}),_(" Platform ")],-1)),z(e("select",{"onUpdate:modelValue":D[0]||(D[0]=Q=>l.value=Q),onChange:j,class:"form-select"},[...D[10]||(D[10]=[e("option",{value:"climate"},"Climate (AC/Heater)",-1),e("option",{value:"media_player"},"Media Player (TV/Audio)",-1),e("option",{value:"fan"},"Fan",-1),e("option",{value:"light"},"Light",-1)])],544),[[we,l.value]])]),e("div",wa,[ye(Fe,{modelValue:m.value,"onUpdate:modelValue":D[1]||(D[1]=Q=>m.value=Q),options:p.value,label:"Manufacturer",placeholder:"Search manufacturers...",loading:C.value,disabled:C.value,onChange:ie},null,8,["modelValue","options","loading","disabled"])]),e("div",$a,[ye(Fe,{modelValue:V.value,"onUpdate:modelValue":D[2]||(D[2]=Q=>V.value=Q),options:L.value,"option-label":"label","option-value":"code",label:"Model",placeholder:"Search models...",loading:t.value,disabled:!m.value||t.value,onChange:W},null,8,["modelValue","options","loading","disabled"])]),S.value?(n(),s("div",Ca,[D[12]||(D[12]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[e("strong",null,u(m.value)+" - "+u(S.value.models[0]),1),e("p",null,"Code: "+u(S.value.code),1)])])):M("",!0),e("div",_a,[e("button",{onClick:Ie,disabled:!S.value||T.value,class:"btn-primary"},[e("i",{class:Z(["mdi",T.value?"mdi-loading mdi-spin":"mdi-download"])},null,2),_(" "+u(T.value?"Loading...":"Load Commands"),1)],8,Sa)])]))])])])):M("",!0)}}},za=ke(Ja,[["__scopeId","data-v-64d207ed"]]),Ga={class:"smartir-status-card"},Wa={class:"card-header"},Ka=["src"],Xa={class:"header-badges"},Ya=["title"],Za={class:"header-info"},Qa={class:"header-info"},ei={class:"header-info"},ti={class:"header-right"},oi={key:0,class:"card-body loading-state"},li={key:1,class:"card-body error-state"},ni={key:2,class:"card-body installed-state"},si={key:0,class:"help-panel"},ai={key:0,class:"recommendation"},ii={key:0,class:"next-steps"},ri={key:1,class:"filter-bar"},di={class:"filter-row"},ui={class:"filter-group filter-search"},ci={class:"filter-group"},mi={class:"view-toggle-group"},vi={class:"filter-results"},pi={key:2,class:"loading-state"},fi={key:3,class:"empty-state"},gi={key:4,class:"profiles-grid"},yi={key:6,class:"no-results"},bi={key:3,class:"card-body not-installed-state"},hi={class:"benefits-section"},ki={class:"benefits-list"},wi={class:"recommendation"},$i={__name:"SmartIRStatusCard",emits:["create-profile","show-install-guide","edit-profile"],setup(o,{expose:c,emit:d}){const w=d,$=Ce("smartirStatus");Ce("smartirEnabled");const l=Ce("refreshSmartIR"),m=y(!1),p=y(null),C=y(($==null?void 0:$.value)||null),S=y(localStorage.getItem("smartir_simulate_not_installed")==="true"),V=y(!1),h=y(!0),t=y([]),L=y(!1),B=y({search:"",platform:""}),P=y({show:!1,title:"",message:"",platform:null,profile:null}),T=y(!1),a=y(localStorage.getItem("profile_view_mode")||"grid"),g=["Full climate entity support (AC, heaters)","120+ pre-configured device profiles","Temperature and humidity sensor integration","HVAC mode control (heat, cool, auto, dry, fan)"],f=["climate","media_player","fan","light"],E=J(()=>S.value?{installed:!1,recommendation:{message:"Install SmartIR to unlock climate device support!",benefits:["Full climate entity support (AC, heaters)","120+ pre-configured device profiles","Temperature and humidity sensor integration","HVAC mode control (heat, cool, auto, dry, fan)"]}}:C.value),X=J(()=>{var b,v;return((v=(b=E.value)==null?void 0:b.platforms)==null?void 0:v.length)||0}),oe=J(()=>{var b;return(b=E.value)!=null&&b.device_counts?Object.values(E.value.device_counts).reduce((v,Y)=>v+Y,0):0});function le(){var b;S.value=!S.value,localStorage.setItem("smartir_simulate_not_installed",S.value.toString()),!S.value&&((b=C.value)!=null&&b.installed)&&I()}const ve=J(()=>{let b=t.value;if(B.value.search){const v=B.value.search.toLowerCase();b=b.filter(Y=>{var ae,q,D,ne;return((ae=Y.manufacturer)==null?void 0:ae.toLowerCase().includes(v))||((q=Y.model)==null?void 0:q.toLowerCase().includes(v))||((D=Y.code)==null?void 0:D.toString().includes(v))||((ne=Y.platform)==null?void 0:ne.toLowerCase().includes(v))})}return B.value.platform&&(b=b.filter(v=>v.platform===B.value.platform)),b}),O=J(()=>B.value.search||B.value.platform);function N(){B.value.search="",B.value.platform=""}async function te(){m.value=!0,p.value=null;try{if(l)await l();else{const b=await Ye.getStatus();C.value=b}}catch(b){p.value=b.message||"Failed to refresh SmartIR status",console.error("Error refreshing SmartIR status:",b)}finally{m.value=!1}}function ue(){w("create-profile")}function be(){T.value=!0}function Se(){w("show-install-guide")}function Ie(){window.open("https://github.com/smartHomeHub/SmartIR","_blank")}function De(){window.open("https://github.com/smartHomeHub/SmartIR","_blank")}async function I(){L.value=!0;const b=[];try{for(const v of f)try{const Y=await fetch(`api/smartir/platforms/${v}/profiles`);if(Y.ok){const q=((await Y.json()).profiles||[]).map(D=>({...D,platform:v}));b.push(...q)}}catch(Y){console.error(`Error loading ${v} profiles:`,Y)}t.value=b}finally{L.value=!1}}function r(b,v,Y){w("edit-profile",{platform:b,profile:v,startStep:Y})}async function j(b,v){var Y,ae;try{const q=await fetch(`api/smartir/platforms/${b}/profiles/${v.code}`);if(!q.ok)throw new Error("Failed to fetch profile");const D=await q.json(),ne=JSON.stringify(D.profile,null,2),Q=new Blob([ne],{type:"application/json"}),re=URL.createObjectURL(Q),A=document.createElement("a");A.href=re,A.download=`smartir_${b}_${v.manufacturer}_${v.model}_${v.code}.json`,document.body.appendChild(A),A.click(),document.body.removeChild(A),URL.revokeObjectURL(re),(Y=Ce("toast").value)==null||Y.success(`Downloaded ${v.manufacturer} ${v.model}`,"✅ Profile Downloaded")}catch(q){console.error("Error downloading profile:",q),(ae=Ce("toast").value)==null||ae.error("Failed to download profile","❌ Download Error")}}async function ie(b,v){Ce("toast");try{const Y=await fetch(`api/smartir/profiles/${v.code}/check-usage`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({platform:b})});if(Y.ok){const ae=await Y.json();if(ae.in_use){P.value={show:!0,title:`Cannot Delete ${v.manufacturer} ${v.model}`,message:`This profile is currently in use by ${ae.device_count} device(s):

${ae.devices.join(`
`)}

Please remove or reassign these devices before deleting the profile.`,platform:b,profile:v,canDelete:!1,devices:ae.devices};return}}}catch(Y){console.error("Error checking profile usage:",Y)}P.value={show:!0,title:`Delete ${v.manufacturer} ${v.model}?`,message:`Device Code: ${v.code}

This will remove the profile and update your configuration.`,platform:b,profile:v,canDelete:!0}}async function W(){var ae,q,D;const b=Ce("toast"),{platform:v,profile:Y}=P.value;P.value.show=!1;try{const ne=await fetch(`api/smartir/profiles/${Y.code}`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({platform:v})});if(ne.ok)await I(),await Ge(),await te(),(ae=b.value)==null||ae.success(`${Y.manufacturer} ${Y.model} has been removed`,"✅ Profile Deleted");else{const Q=await ne.json();(q=b.value)==null||q.error(Q.error||"Unknown error","❌ Delete Failed")}}catch(ne){console.error("Error deleting profile:",ne),(D=b.value)==null||D.error("Failed to delete profile","❌ Delete Error")}}return fe($,b=>{b&&(C.value=b)},{immediate:!0}),Te(async()=>{var b;$!=null&&$.value&&(C.value=$.value),C.value||await te(),(b=C.value)!=null&&b.installed&&await I()}),c({loadAllProfiles:I,refreshStatus:te}),(b,v)=>{var Y,ae,q,D,ne,Q,re,A,i,F;return n(),s("div",Ga,[e("div",Wa,[e("button",{class:"icon-button chevron-button",onClick:v[0]||(v[0]=U=>h.value=!h.value)},[e("i",{class:Z(["mdi",h.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2)]),e("div",{class:"header-left",onClick:v[1]||(v[1]=U=>h.value=!h.value)},[e("img",{src:$e(Be),alt:"SmartIR",class:"smartir-logo"},null,8,Ka),v[14]||(v[14]=e("h3",null,"SmartIR Integration",-1)),e("div",Xa,[e("div",{class:Z(["simulation-toggle-pill",{active:S.value}]),onClick:ge(le,["stop"]),title:S.value?"Click to show as installed":"Click to simulate not-installed"},[e("i",{class:Z(["mdi",S.value?"mdi-eye-off":"mdi-eye"])},null,2),e("span",null,u(S.value?"Simulating: Not Installed":"Simulation Mode"),1)],10,Ya),(Y=E.value)!=null&&Y.installed?(n(),s(me,{key:0},[v[13]||(v[13]=e("div",{class:"status-badge-mini success"},[e("i",{class:"mdi mdi-check-circle"}),e("span",null,"Installed")],-1)),e("span",Za,"v"+u(E.value.version||"Unknown"),1),e("span",Qa,u(X.value)+" platform"+u(X.value!==1?"s":""),1),e("span",ei,u(oe.value)+" device"+u(oe.value!==1?"s":""),1)],64)):M("",!0)])]),e("div",ti,[(ae=C.value)!=null&&ae.installed&&h.value?(n(),s("button",{key:0,onClick:v[2]||(v[2]=ge(U=>V.value=!V.value,["stop"])),class:Z(["icon-button",{active:V.value}]),title:"Show help"},[...v[15]||(v[15]=[e("i",{class:"mdi mdi-help-circle"},null,-1)])],2)):M("",!0),(q=C.value)!=null&&q.installed&&h.value?(n(),s("button",{key:1,onClick:ge(te,["stop"]),class:"icon-button",title:"Refresh status"},[...v[16]||(v[16]=[e("i",{class:"mdi mdi-refresh"},null,-1)])])):M("",!0),(D=C.value)!=null&&D.installed&&h.value?(n(),s("button",{key:2,onClick:ge(be,["stop"]),class:"btn btn-secondary"},[...v[17]||(v[17]=[e("i",{class:"mdi mdi-test-tube"},null,-1),_(" Test Codes ",-1)])])):M("",!0),(ne=C.value)!=null&&ne.installed&&h.value?(n(),s("button",{key:3,onClick:ge(ue,["stop"]),class:"btn btn-primary"},[...v[18]||(v[18]=[e("i",{class:"mdi mdi-plus"},null,-1),_(" Create SmartIR Profile ",-1)])])):M("",!0)])]),z(e("div",null,[m.value?(n(),s("div",oi,[...v[19]||(v[19]=[e("div",{class:"spinner"},null,-1),e("p",null,"Checking SmartIR installation...",-1)])])):p.value?(n(),s("div",li,[v[20]||(v[20]=e("i",{class:"mdi mdi-alert-circle"},null,-1)),e("p",null,u(p.value),1),e("button",{onClick:te,class:"btn-secondary"}," Try Again ")])):(Q=E.value)!=null&&Q.installed?(n(),s("div",ni,[V.value?(n(),s("div",si,[C.value.recommendation?(n(),s("div",ai,[e("p",null,u(C.value.recommendation.message),1),C.value.recommendation.next_steps?(n(),s("div",ii,[v[21]||(v[21]=e("strong",null,"Next Steps:",-1)),e("ul",null,[(n(!0),s(me,null,he(C.value.recommendation.next_steps,(U,x)=>(n(),s("li",{key:x},u(U),1))),128))])])):M("",!0)])):M("",!0),e("div",{class:"help-actions"},[e("button",{onClick:Ie,class:"btn-secondary"},[...v[22]||(v[22]=[e("i",{class:"mdi mdi-book-open-variant"},null,-1),_(" View Documentation ",-1)])])])])):M("",!0),t.value.length>0&&!S.value?(n(),s("div",ri,[e("div",di,[e("div",ui,[e("label",null,[v[23]||(v[23]=e("i",{class:"mdi mdi-magnify"},null,-1)),z(e("input",{"onUpdate:modelValue":v[3]||(v[3]=U=>B.value.search=U),type:"text",placeholder:"Search profiles...",class:"search-input"},null,512),[[_e,B.value.search]])])]),e("div",ci,[e("label",null,[v[25]||(v[25]=e("i",{class:"mdi mdi-shape"},null,-1)),z(e("select",{"onUpdate:modelValue":v[4]||(v[4]=U=>B.value.platform=U)},[...v[24]||(v[24]=[Oe('<option value="" data-v-4e6e6058>All Platforms</option><option value="climate" data-v-4e6e6058>Climate</option><option value="media_player" data-v-4e6e6058>Media Player</option><option value="fan" data-v-4e6e6058>Fan</option><option value="light" data-v-4e6e6058>Light</option>',5)])],512),[[we,B.value.platform]])])]),O.value?(n(),s("button",{key:0,onClick:N,class:"btn-clear-filters"},[...v[26]||(v[26]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),_(" Clear ",-1)])])):M("",!0),e("div",mi,[e("button",{onClick:v[5]||(v[5]=U=>a.value="grid"),class:Z(["view-toggle-btn",{active:a.value==="grid"}]),title:"Grid View"},[...v[27]||(v[27]=[e("i",{class:"mdi mdi-view-grid"},null,-1),_(" Grid ",-1)])],2),e("button",{onClick:v[6]||(v[6]=U=>a.value="list"),class:Z(["view-toggle-btn",{active:a.value==="list"}]),title:"List View"},[...v[28]||(v[28]=[e("i",{class:"mdi mdi-view-list"},null,-1),_(" List ",-1)])],2)]),e("div",vi,u(ve.value.length)+" of "+u(t.value.length),1)])])):M("",!0),L.value?(n(),s("div",pi,[...v[29]||(v[29]=[e("i",{class:"mdi mdi-loading mdi-spin"},null,-1),e("p",null,"Loading profiles...",-1)])])):t.value.length===0?(n(),s("div",fi,[...v[30]||(v[30]=[e("i",{class:"mdi mdi-file-document-outline"},null,-1),e("h3",null,"No Profiles Yet",-1),e("p",null,"Create your first SmartIR profile to get started",-1)])])):M("",!0),a.value==="grid"&&!S.value?(n(),s("div",gi,[(n(!0),s(me,null,he(ve.value,U=>(n(),Re(Gs,{key:`${U.platform}-${U.code}`,profile:U,onEdit:x=>r(U.platform,U),onCommands:x=>r(U.platform,U,2),onDownload:x=>j(U.platform,U),onDelete:x=>ie(U.platform,U)},null,8,["profile","onEdit","onCommands","onDownload","onDelete"]))),128))])):a.value==="list"&&!S.value&&ve.value.length>0?(n(),Re(ga,{key:5,profiles:ve.value,onEdit:v[7]||(v[7]=U=>r(U.platform,U)),onCommands:v[8]||(v[8]=U=>r(U.platform,U,2)),onDownload:v[9]||(v[9]=U=>j(U.platform,U)),onDelete:v[10]||(v[10]=U=>ie(U.platform,U))},null,8,["profiles"])):M("",!0),t.value.length>0&&ve.value.length===0&&!S.value?(n(),s("div",yi,[...v[31]||(v[31]=[e("i",{class:"mdi mdi-filter-off"},null,-1),e("h3",null,"No profiles match your filters",-1),e("p",null,"Try adjusting your search or filter criteria",-1)])])):M("",!0)])):(n(),s("div",bi,[v[37]||(v[37]=e("div",{class:"status-badge warning"},[e("i",{class:"mdi mdi-information"}),e("span",null,"Not Installed")],-1)),e("div",hi,[v[33]||(v[33]=e("h4",null,"Why Install SmartIR?",-1)),e("ul",ki,[(n(!0),s(me,null,he(((A=(re=C.value)==null?void 0:re.recommendation)==null?void 0:A.benefits)||g,(U,x)=>(n(),s("li",{key:x},[v[32]||(v[32]=e("i",{class:"mdi mdi-check"},null,-1)),e("span",null,u(U),1)]))),128))])]),e("div",wi,[e("p",null,u(((F=(i=C.value)==null?void 0:i.recommendation)==null?void 0:F.message)||"Install SmartIR to unlock climate device support!"),1)]),e("div",{class:"card-actions"},[e("button",{onClick:Se,class:"btn-primary"},[...v[34]||(v[34]=[e("i",{class:"mdi mdi-download"},null,-1),_(" Install SmartIR ",-1)])]),e("button",{onClick:De,class:"btn-secondary"},[...v[35]||(v[35]=[e("i",{class:"mdi mdi-github"},null,-1),_(" View on GitHub ",-1)])]),e("button",{onClick:Ie,class:"btn-secondary"},[...v[36]||(v[36]=[e("i",{class:"mdi mdi-help-circle"},null,-1),_(" Learn More ",-1)])])])]))],512),[[Ke,h.value]]),ye(Le,{isOpen:P.value.show,title:P.value.title,message:P.value.message,confirmText:P.value.canDelete===!1?null:"Delete",cancelText:"Close",dangerMode:!0,confirmDisabled:P.value.canDelete===!1,onConfirm:W,onCancel:v[11]||(v[11]=U=>P.value.show=!1)},null,8,["isOpen","title","message","confirmText","confirmDisabled"]),ye(za,{isOpen:T.value,onClose:v[12]||(v[12]=U=>T.value=!1)},null,8,["isOpen"])])}}},Ci=ke($i,[["__scopeId","data-v-4e6e6058"]]),_i={class:"climate-form"},Si={class:"learning-mode-section"},Ii={class:"mode-toggle"},Di={class:"mode-content"},xi={class:"mode-stats"},Ti={class:"stat-badge"},Ri={class:"stat-badge time"},Mi={class:"mode-content"},Li={class:"mode-stats"},Oi={class:"stat-badge"},Ai={class:"stat-badge time warning"},Ei={key:0,class:"command-breakdown"},Vi={class:"warning-text"},ji={class:"form-section"},Pi={key:0,class:"help-text"},Ui={key:1,class:"help-text"},Fi={class:"form-row"},Ni={class:"form-group"},Bi={class:"form-group"},Hi={class:"form-group"},qi={key:2,class:"representative-temp-section"},Ji={class:"form-group"},zi=["value"],Gi={class:"form-section"},Wi={class:"checkbox-grid"},Ki={class:"checkbox-item"},Xi={class:"checkbox-item"},Yi={class:"checkbox-item"},Zi={class:"checkbox-item"},Qi={class:"checkbox-item"},er={class:"checkbox-item"},tr={class:"form-section"},or={class:"checkbox-grid"},lr={class:"checkbox-item"},nr={class:"checkbox-item"},sr={class:"checkbox-item"},ar={class:"checkbox-item"},ir={class:"form-section"},rr={class:"checkbox-grid"},dr={class:"checkbox-item"},ur={class:"checkbox-item"},cr={class:"checkbox-item"},mr={class:"checkbox-item"},vr={class:"form-section"},pr={class:"form-group"},fr={class:"form-group"},gr={class:"form-group"},yr={key:0,class:"validation-summary"},br={__name:"ClimateProfileForm",props:{modelValue:{type:Object,default:()=>({})}},emits:["update:modelValue"],setup(o,{emit:c}){const d=o,w=c,$=y("quick"),l=y({minTemp:16,maxTemp:30,precision:1,representativeTemp:24,modes:["off","auto","cool","heat"],fanModes:["auto","low","medium","high"],swingModes:[],tempSensor:"",humiditySensor:"",powerSensor:"",learningMode:"quick",...d.modelValue}),m=J(()=>{const T=[],a=l.value.minTemp||16,g=l.value.maxTemp||30,f=l.value.precision||1;for(let E=a;E<=g;E+=f)T.push(E);return T}),p=J(()=>l.value.modes.filter(T=>T!=="off").length),C=J(()=>l.value.fanModes.length||1),S=J(()=>l.value.swingModes.length||1),V=J(()=>{const T=l.value.minTemp||16,a=l.value.maxTemp||30,g=l.value.precision||1;return Math.floor((a-T)/g)+1}),h=J(()=>{const T=l.value.modes.includes("off")?1:0;return p.value*C.value*S.value+T}),t=J(()=>Math.ceil(h.value*30/60)),L=J(()=>{const T=l.value.modes.includes("off")?1:0;return p.value*V.value*C.value*S.value+T}),B=J(()=>Math.ceil(L.value*30/60)),P=J(()=>{const T=[];return(!l.value.minTemp||l.value.minTemp<10||l.value.minTemp>35)&&T.push("Minimum temperature must be between 10°C and 35°C"),(!l.value.maxTemp||l.value.maxTemp<10||l.value.maxTemp>35)&&T.push("Maximum temperature must be between 10°C and 35°C"),l.value.minTemp>=l.value.maxTemp&&T.push("Minimum temperature must be less than maximum temperature"),(!l.value.modes||l.value.modes.length===0)&&T.push("At least one HVAC mode must be selected"),T});return fe($,T=>{l.value.learningMode=T}),fe(l,T=>{w("update:modelValue",T)},{deep:!0,immediate:!0}),(T,a)=>(n(),s("div",_i,[a[63]||(a[63]=e("h3",null,"Climate Device Configuration",-1)),e("div",Si,[e("div",Ii,[e("label",{class:Z(["mode-option",{active:$.value==="quick"}])},[z(e("input",{type:"radio",value:"quick","onUpdate:modelValue":a[0]||(a[0]=g=>$.value=g)},null,512),[[Ue,$.value]]),e("div",Di,[a[23]||(a[23]=e("div",{class:"mode-header"},[e("i",{class:"mdi mdi-flash"}),e("strong",null,"Quick Mode (Recommended)")],-1)),a[24]||(a[24]=e("p",null,"Learn one temperature per mode combination",-1)),e("div",xi,[e("span",Ti,u(h.value)+" commands",1),e("span",Ri,"~"+u(t.value)+" min",1)])])],2),e("label",{class:Z(["mode-option",{active:$.value==="complete"}])},[z(e("input",{type:"radio",value:"complete","onUpdate:modelValue":a[1]||(a[1]=g=>$.value=g)},null,512),[[Ue,$.value]]),e("div",Mi,[a[25]||(a[25]=e("div",{class:"mode-header"},[e("i",{class:"mdi mdi-check-all"}),e("strong",null,"Complete Mode")],-1)),a[26]||(a[26]=e("p",null,"Learn all temperature combinations",-1)),e("div",Li,[e("span",Oi,u(L.value)+" commands",1),e("span",Ai,"~"+u(B.value)+" min",1)])])],2)]),$.value==="complete"?(n(),s("div",Ei,[a[27]||(a[27]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[e("strong",null,"Complete mode will require learning "+u(L.value)+" commands",1),e("p",null,"This includes all combinations of modes ("+u(p.value)+"), temperatures ("+u(V.value)+"), fan speeds ("+u(C.value)+"), and swing modes ("+u(S.value)+").",1),e("p",Vi,"⏱️ Estimated time: "+u(B.value)+" minutes at ~30 seconds per command",1)])])):M("",!0)]),e("div",ji,[a[33]||(a[33]=e("h4",null,"Temperature Range",-1)),$.value==="quick"?(n(),s("p",Pi," Define the full temperature range your device supports. You'll select one temperature to learn below. ")):(n(),s("p",Ui," Define the temperature range. All temperatures in this range will be learned. ")),e("div",Fi,[e("div",Ni,[a[28]||(a[28]=e("label",null,"Minimum Temperature (°C) *",-1)),z(e("input",{"onUpdate:modelValue":a[2]||(a[2]=g=>l.value.minTemp=g),type:"number",min:"10",max:"35",placeholder:"16"},null,512),[[_e,l.value.minTemp,void 0,{number:!0}]])]),e("div",Bi,[a[29]||(a[29]=e("label",null,"Maximum Temperature (°C) *",-1)),z(e("input",{"onUpdate:modelValue":a[3]||(a[3]=g=>l.value.maxTemp=g),type:"number",min:"10",max:"35",placeholder:"30"},null,512),[[_e,l.value.maxTemp,void 0,{number:!0}]])]),e("div",Hi,[a[31]||(a[31]=e("label",null,"Precision",-1)),z(e("select",{"onUpdate:modelValue":a[4]||(a[4]=g=>l.value.precision=g)},[...a[30]||(a[30]=[e("option",{value:1},"1°C (Whole degrees)",-1),e("option",{value:.5},"0.5°C (Half degrees)",-1)])],512),[[we,l.value.precision,void 0,{number:!0}]])])]),$.value==="quick"?(n(),s("div",qi,[e("div",Ji,[a[32]||(a[32]=e("label",null,"Representative Temperature to Learn *",-1)),z(e("select",{"onUpdate:modelValue":a[5]||(a[5]=g=>l.value.representativeTemp=g)},[(n(!0),s(me,null,he(m.value,g=>(n(),s("option",{key:g,value:g},u(g)+"°C ",9,zi))),128))],512),[[we,l.value.representativeTemp,void 0,{number:!0}]]),e("small",null,"This temperature will be learned for all mode combinations. The device profile will still show the full range ("+u(l.value.minTemp)+"°C - "+u(l.value.maxTemp)+"°C).",1)])])):M("",!0)]),e("div",Gi,[a[40]||(a[40]=e("h4",null,"Supported HVAC Modes *",-1)),a[41]||(a[41]=e("p",{class:"help-text"},"Select all modes your device supports",-1)),e("div",Wi,[e("label",Ki,[z(e("input",{type:"checkbox",value:"off","onUpdate:modelValue":a[6]||(a[6]=g=>l.value.modes=g)},null,512),[[pe,l.value.modes]]),a[34]||(a[34]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),_(" Off ")],-1))]),e("label",Xi,[z(e("input",{type:"checkbox",value:"auto","onUpdate:modelValue":a[7]||(a[7]=g=>l.value.modes=g)},null,512),[[pe,l.value.modes]]),a[35]||(a[35]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-autorenew"}),_(" Auto ")],-1))]),e("label",Yi,[z(e("input",{type:"checkbox",value:"cool","onUpdate:modelValue":a[8]||(a[8]=g=>l.value.modes=g)},null,512),[[pe,l.value.modes]]),a[36]||(a[36]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-snowflake"}),_(" Cool ")],-1))]),e("label",Zi,[z(e("input",{type:"checkbox",value:"heat","onUpdate:modelValue":a[9]||(a[9]=g=>l.value.modes=g)},null,512),[[pe,l.value.modes]]),a[37]||(a[37]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fire"}),_(" Heat ")],-1))]),e("label",Qi,[z(e("input",{type:"checkbox",value:"dry","onUpdate:modelValue":a[10]||(a[10]=g=>l.value.modes=g)},null,512),[[pe,l.value.modes]]),a[38]||(a[38]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-water-percent"}),_(" Dry ")],-1))]),e("label",er,[z(e("input",{type:"checkbox",value:"fan_only","onUpdate:modelValue":a[11]||(a[11]=g=>l.value.modes=g)},null,512),[[pe,l.value.modes]]),a[39]||(a[39]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan"}),_(" Fan Only ")],-1))])])]),e("div",tr,[a[46]||(a[46]=e("h4",null,"Fan Modes",-1)),a[47]||(a[47]=e("p",{class:"help-text"},"Select all fan speeds your device supports",-1)),e("div",or,[e("label",lr,[z(e("input",{type:"checkbox",value:"auto","onUpdate:modelValue":a[12]||(a[12]=g=>l.value.fanModes=g)},null,512),[[pe,l.value.fanModes]]),a[42]||(a[42]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-autorenew"}),_(" Auto ")],-1))]),e("label",nr,[z(e("input",{type:"checkbox",value:"low","onUpdate:modelValue":a[13]||(a[13]=g=>l.value.fanModes=g)},null,512),[[pe,l.value.fanModes]]),a[43]||(a[43]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-1"}),_(" Low ")],-1))]),e("label",sr,[z(e("input",{type:"checkbox",value:"medium","onUpdate:modelValue":a[14]||(a[14]=g=>l.value.fanModes=g)},null,512),[[pe,l.value.fanModes]]),a[44]||(a[44]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-2"}),_(" Medium ")],-1))]),e("label",ar,[z(e("input",{type:"checkbox",value:"high","onUpdate:modelValue":a[15]||(a[15]=g=>l.value.fanModes=g)},null,512),[[pe,l.value.fanModes]]),a[45]||(a[45]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-3"}),_(" High ")],-1))])])]),e("div",ir,[a[52]||(a[52]=e("h4",null,"Swing Modes (Optional)",-1)),a[53]||(a[53]=e("p",{class:"help-text"},"Select if your device has swing/oscillation",-1)),e("div",rr,[e("label",dr,[z(e("input",{type:"checkbox",value:"off","onUpdate:modelValue":a[16]||(a[16]=g=>l.value.swingModes=g)},null,512),[[pe,l.value.swingModes]]),a[48]||(a[48]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-horizontal"}),_(" Off ")],-1))]),e("label",ur,[z(e("input",{type:"checkbox",value:"vertical","onUpdate:modelValue":a[17]||(a[17]=g=>l.value.swingModes=g)},null,512),[[pe,l.value.swingModes]]),a[49]||(a[49]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-vertical"}),_(" Vertical ")],-1))]),e("label",cr,[z(e("input",{type:"checkbox",value:"horizontal","onUpdate:modelValue":a[18]||(a[18]=g=>l.value.swingModes=g)},null,512),[[pe,l.value.swingModes]]),a[50]||(a[50]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-horizontal"}),_(" Horizontal ")],-1))]),e("label",mr,[z(e("input",{type:"checkbox",value:"both","onUpdate:modelValue":a[19]||(a[19]=g=>l.value.swingModes=g)},null,512),[[pe,l.value.swingModes]]),a[51]||(a[51]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-arrow-all"}),_(" Both ")],-1))])])]),e("div",vr,[a[60]||(a[60]=e("h4",null,"Sensors (Optional)",-1)),a[61]||(a[61]=e("p",{class:"help-text"},"Link external sensors for better climate control",-1)),e("div",pr,[a[54]||(a[54]=e("label",null,"Temperature Sensor",-1)),z(e("input",{"onUpdate:modelValue":a[20]||(a[20]=g=>l.value.tempSensor=g),type:"text",placeholder:"sensor.living_room_temperature"},null,512),[[_e,l.value.tempSensor]]),a[55]||(a[55]=e("small",null,"Entity ID of temperature sensor",-1))]),e("div",fr,[a[56]||(a[56]=e("label",null,"Humidity Sensor",-1)),z(e("input",{"onUpdate:modelValue":a[21]||(a[21]=g=>l.value.humiditySensor=g),type:"text",placeholder:"sensor.living_room_humidity"},null,512),[[_e,l.value.humiditySensor]]),a[57]||(a[57]=e("small",null,"Entity ID of humidity sensor",-1))]),e("div",gr,[a[58]||(a[58]=e("label",null,"Power Sensor",-1)),z(e("input",{"onUpdate:modelValue":a[22]||(a[22]=g=>l.value.powerSensor=g),type:"text",placeholder:"binary_sensor.ac_power"},null,512),[[_e,l.value.powerSensor]]),a[59]||(a[59]=e("small",null,"Entity ID of power sensor (to detect on/off state)",-1))])]),P.value.length>0?(n(),s("div",yr,[a[62]||(a[62]=e("h4",null,[e("i",{class:"mdi mdi-alert-circle"}),_(" Please fix the following: ")],-1)),e("ul",null,[(n(!0),s(me,null,he(P.value,(g,f)=>(n(),s("li",{key:f},u(g),1))),128))])])):M("",!0)]))}},hr=ke(br,[["__scopeId","data-v-5674f3f7"]]),kr={class:"command-wizard"},wr={class:"device-selection-section"},$r={class:"input-wrapper"},Cr=["value"],_r={key:0,class:"validation-tooltip"},Sr={class:"form-group"},Ir=["disabled"],Dr={key:0},xr={key:1},Tr={key:0,class:"edit-mode-banner"},Rr={class:"wizard-info"},Mr={key:0},Lr={key:1},Or={class:"progress-info"},Ar={class:"progress-bar"},Er={class:"progress-text"},Vr={class:"commands-grid"},jr={class:"command-header"},Pr={class:"command-icon"},Ur={class:"command-info"},Fr={key:0,class:"learning-indicator"},Nr={key:0,class:"ir-learning-steps"},Br={key:1,class:"rf-learning-steps"},Hr={class:"command-actions"},qr=["onClick","disabled"],Jr={key:1,class:"learned-status"},zr=["onClick","disabled"],Gr=["onClick"],Wr={class:"quick-actions"},Kr=["disabled"],Xr=["disabled"],Yr={__name:"CommandLearningWizard",props:{modelValue:{type:Object,default:()=>({})},platform:{type:String,required:!0},config:{type:Object,required:!0},broadlinkDevice:{type:String,default:""},manufacturer:{type:String,required:!0},model:{type:String,required:!0},commandType:{type:String,default:"ir"}},emits:["update:modelValue","update:broadlinkDevice","update:commandType"],setup(o,{emit:c}){const d=Ve(),w=o,$=c,l=y({...w.modelValue}),m=y(null),p=y(null),C=y([]),S=y(w.broadlinkDevice),V=y(w.commandType),h=y(!1),t=y([]),L=y(!1),B=y(!1),P=y({show:!1,commandKey:null,commandLabel:""}),T=y(!1),a=J(()=>{const I=[];if(w.platform==="climate"){const r=w.config.modes||[],j=w.config.fanModes||[],ie=w.config.minTemp||16,W=w.config.maxTemp||30;r.forEach(b=>{if(b==="off")I.push({key:"off",label:"Power Off",description:"Turn device off",icon:"mdi mdi-power",mode:"off"});else for(let v=ie;v<=W;v++)j.forEach(Y=>{const ae=`${b}_${v}_${Y}`;I.push({key:ae,label:`${b.toUpperCase()} ${v}°C ${Y}`,description:`Mode: ${b}, Temp: ${v}°C, Fan: ${Y}`,icon:X(b),mode:b,temp:v,fanMode:Y})})})}else if(w.platform==="media_player"){const r=w.config.features||[];r.includes("turn_on")&&(I.push({key:"turn_on",label:"Power On",description:"Turn on the device",icon:"mdi mdi-power"}),I.push({key:"turn_off",label:"Power Off",description:"Turn off the device",icon:"mdi mdi-power-off"})),r.includes("volume")&&(I.push({key:"volume_up",label:"Volume Up",description:"Increase volume",icon:"mdi mdi-volume-plus"}),I.push({key:"volume_down",label:"Volume Down",description:"Decrease volume",icon:"mdi mdi-volume-minus"})),r.includes("mute")&&I.push({key:"mute",label:"Mute",description:"Toggle mute",icon:"mdi mdi-volume-mute"}),r.includes("source")&&(I.push({key:"source_hdmi1",label:"Source: HDMI 1",description:"Switch to HDMI 1",icon:"mdi mdi-import"}),I.push({key:"source_hdmi2",label:"Source: HDMI 2",description:"Switch to HDMI 2",icon:"mdi mdi-import"}),I.push({key:"source_hdmi3",label:"Source: HDMI 3",description:"Switch to HDMI 3",icon:"mdi mdi-import"})),r.includes("channel")&&(I.push({key:"channel_up",label:"Channel Up",description:"Next channel",icon:"mdi mdi-chevron-up"}),I.push({key:"channel_down",label:"Channel Down",description:"Previous channel",icon:"mdi mdi-chevron-down"}))}else if(w.platform==="fan"){const r=w.config.speedLevels||3,j=w.config.features||[];I.push({key:"turn_on",label:"Power On",description:"Turn on the fan",icon:"mdi mdi-power"}),I.push({key:"turn_off",label:"Power Off",description:"Turn off the fan",icon:"mdi mdi-power-off"});for(let ie=1;ie<=r;ie++){const W=ie===1?"Low":ie===r?"High":ie===2&&r===3?"Medium":`Speed ${ie}`;I.push({key:`speed_${ie}`,label:`${W}`,description:`Set fan to speed level ${ie}`,icon:"mdi mdi-fan"})}j.includes("oscillate")&&(I.push({key:"oscillate_on",label:"Oscillate On",description:"Enable oscillation",icon:"mdi mdi-sync"}),I.push({key:"oscillate_off",label:"Oscillate Off",description:"Disable oscillation",icon:"mdi mdi-sync-off"})),j.includes("direction")&&(I.push({key:"direction_forward",label:"Direction: Forward",description:"Set direction to forward",icon:"mdi mdi-rotate-right"}),I.push({key:"direction_reverse",label:"Direction: Reverse",description:"Set direction to reverse",icon:"mdi mdi-rotate-left"}))}else if(w.platform==="light"){const r=w.config.features||[];r.includes("turn_on")&&(I.push({key:"turn_on",label:"Power On",description:"Turn on the light",icon:"mdi mdi-lightbulb-on"}),I.push({key:"turn_off",label:"Power Off",description:"Turn off the light",icon:"mdi mdi-lightbulb-off"})),r.includes("brightness")&&(I.push({key:"brightness_up",label:"Brightness Up",description:"Increase brightness",icon:"mdi mdi-brightness-7"}),I.push({key:"brightness_down",label:"Brightness Down",description:"Decrease brightness",icon:"mdi mdi-brightness-5"})),r.includes("color_temp")&&(I.push({key:"color_temp_warm",label:"Warm White",description:"Set to warm white",icon:"mdi mdi-weather-sunset"}),I.push({key:"color_temp_cool",label:"Cool White",description:"Set to cool white",icon:"mdi mdi-weather-sunny"})),r.includes("rgb")&&(I.push({key:"color_red",label:"Color: Red",description:"Set color to red",icon:"mdi mdi-palette"}),I.push({key:"color_green",label:"Color: Green",description:"Set color to green",icon:"mdi mdi-palette"}),I.push({key:"color_blue",label:"Color: Blue",description:"Set color to blue",icon:"mdi mdi-palette"}))}return I}),g=J(()=>a.value.length),f=J(()=>Object.keys(l.value).length),E=J(()=>g.value===0?0:Math.round(f.value/g.value*100));function X(I){return{off:"mdi mdi-power",auto:"mdi mdi-autorenew",cool:"mdi mdi-snowflake",heat:"mdi mdi-fire",dry:"mdi mdi-water-percent",fan_only:"mdi mdi-fan"}[I]||"mdi mdi-remote"}async function oe(I){if(!m.value){if(!S.value){B.value=!0,window.scrollTo({top:0,behavior:"smooth"});return}B.value=!1,m.value=I.key;try{const r=w.manufacturer.toLowerCase().replace(/[^a-z0-9]+/g,"_"),j=w.model.toLowerCase().replace(/[^a-z0-9]+/g,"_"),ie=`${r}_${j}`,W=await fetch("/api/commands/learn",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({entity_id:S.value,device:ie,command:I.key,command_type:V.value})});if(!W.ok)throw new Error(`Failed to learn command: ${W.statusText}`);const b=await W.json();if(b.success&&b.code)l.value[I.key]=b.code,$("update:modelValue",l.value),L.value=!0,b.code==="pending"&&console.log(`⏳ Command '${I.key}' learned, code will be fetched from storage when saving`),h.value&&t.value.length>0&&setTimeout(()=>{const v=t.value.shift();v?oe(v):h.value=!1},1e3);else throw new Error(b.error||"Failed to learn command")}catch(r){console.error("Error learning command:",r),d.error(`Error learning command: ${r.message}`),h.value=!1,t.value=[]}finally{h.value||(m.value=null)}}}async function le(I){var r;if(!S.value){B.value=!0,window.scrollTo({top:0,behavior:"smooth"});return}if(!l.value[I]){(r=d.value)==null||r.error("Command not learned yet");return}p.value=I;try{const j=l.value[I],ie=await fetch("/api/commands/send-raw",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({entity_id:S.value,command:j,command_type:V.value})});if(!ie.ok){const W=await ie.json();throw new Error(W.error||"Failed to send command")}d.success("Command sent successfully")}catch(j){console.error("Error testing command:",j),d.error(`Error testing command: ${j.message}`)}finally{p.value=null}}function ve(I){const r=a.value.find(j=>j.key===I);P.value={show:!0,commandKey:I,commandLabel:r?r.label:I}}function O(){const I=P.value.commandKey;delete l.value[I],$("update:modelValue",l.value),P.value.show=!1}function N(){const I=a.value.filter(j=>!l.value[j.key]);if(I.length===0)return;h.value=!0,t.value=[...I];const r=t.value.shift();r&&oe(r)}function te(){T.value=!0}function ue(){l.value={},$("update:modelValue",l.value),T.value=!1}fe(()=>w.modelValue,I=>{l.value={...I}},{deep:!0}),Te(async()=>{await be()});async function be(){try{console.log("SmartIR device - commands will be loaded from SmartIR JSON file, not Broadlink storage")}catch(I){console.error("Error in loadExistingCommands:",I)}}function Se(){$("update:broadlinkDevice",S.value)}function Ie(){$("update:commandType",V.value)}async function De(){try{const I=await fetch("/api/remote/devices");if(I.ok){const j=(await I.json()).devices||[];C.value=j}}catch(I){console.error("Error loading remote devices:",I),C.value=[]}}return fe(()=>w.broadlinkDevice,I=>{S.value=I}),fe(S,I=>{I&&(B.value=!1)}),fe(()=>w.commandType,I=>{V.value=I}),Te(async()=>{await De(),await be()}),(I,r)=>(n(),s("div",kr,[r[22]||(r[22]=e("h3",null,"Learn IR Commands",-1)),e("div",wr,[e("div",{class:Z(["form-group",{"has-error":B.value}])},[r[6]||(r[6]=e("label",null,"Broadlink Device *",-1)),e("div",$r,[z(e("select",{"onUpdate:modelValue":r[0]||(r[0]=j=>S.value=j),onChange:Se},[r[4]||(r[4]=e("option",{value:""},"Select Broadlink device...",-1)),(n(!0),s(me,null,he(C.value,j=>(n(),s("option",{key:j.entity_id,value:j.entity_id},u(j.name)+u(j.area_name?" ("+j.area_name+")":""),9,Cr))),128))],544),[[we,S.value]]),B.value?(n(),s("div",_r,[...r[5]||(r[5]=[e("i",{class:"mdi mdi-alert"},null,-1),_(" Device is required ",-1)])])):M("",!0)]),e("small",null,"This device will be used to learn commands ("+u(C.value.length)+" devices found)",1)],2),e("div",Sr,[r[8]||(r[8]=e("label",null,"Command Type *",-1)),z(e("select",{"onUpdate:modelValue":r[1]||(r[1]=j=>V.value=j),onChange:Ie,disabled:f.value>0},[...r[7]||(r[7]=[e("option",{value:"ir"},"📡 Infrared (IR) - Most common for AC, TV, etc.",-1),e("option",{value:"rf"},"📻 Radio Frequency (RF) - For RF remotes",-1)])],40,Ir),[[we,V.value]]),f.value>0?(n(),s("small",Dr,"Command type cannot be changed after learning commands")):(n(),s("small",xr,"Select the type of commands your device uses"))])]),f.value>0&&!L.value?(n(),s("div",Tr,[r[10]||(r[10]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[r[9]||(r[9]=e("strong",null,"Editing Existing Profile",-1)),e("p",null,u(f.value)+" command"+u(f.value!==1?"s":"")+' already learned. You can re-learn any command by clicking the delete icon and then "Learn Command".',1)])])):M("",!0),e("div",Rr,[r[14]||(r[14]=e("i",{class:"mdi mdi-information"},null,-1)),e("div",null,[r[13]||(r[13]=e("p",null,[e("strong",null,"How it works:")],-1)),o.commandType==="ir"?(n(),s("ol",Mr,[...r[11]||(r[11]=[e("li",null,'Click "Learn Command" for each combination',-1),e("li",null,[e("strong",null,"Point your IR remote directly at the Broadlink device")],-1),e("li",null,"Press the button on your remote",-1),e("li",null,"Wait for confirmation (up to 30 seconds)",-1)])])):(n(),s("ol",Lr,[...r[12]||(r[12]=[e("li",null,'Click "Learn Command" for each combination',-1),e("li",null,[e("strong",null,"Step 1:"),_(" Hold button on remote - Broadlink scans for RF frequency")],-1),e("li",null,[e("strong",null,"Step 2:"),_(" Watch for Home Assistant notification, then press and release button")],-1),e("li",null,"Keep remote within 5cm of Broadlink (RF doesn't need line-of-sight)",-1),e("li",null,"Wait for confirmation (may take up to 30 seconds)",-1)])]))])]),e("div",Or,[e("div",Ar,[e("div",{class:"progress-fill",style:tt({width:E.value+"%"})},null,4)]),e("span",Er,u(f.value)+" / "+u(g.value)+" commands learned ("+u(E.value)+"%) ",1)]),e("div",Vr,[(n(!0),s(me,null,he(a.value,j=>(n(),s("div",{key:j.key,class:Z(["command-card",{learned:l.value[j.key],learning:m.value===j.key}])},[e("div",jr,[e("div",Pr,[e("i",{class:Z(j.icon)},null,2)]),e("div",Ur,[e("h4",null,u(j.label),1),e("p",null,u(j.description),1)])]),m.value===j.key?(n(),s("div",Fr,[o.commandType==="ir"?(n(),s("div",Nr,[...r[15]||(r[15]=[e("p",null,[e("strong",null,"Point your remote directly at the Broadlink device and press the button.")],-1),e("small",null,"Listening for up to 30 seconds...",-1)])])):(n(),s("div",Br,[...r[16]||(r[16]=[e("p",{class:"rf-title"},[e("strong",null,"Learning request sent to device.")],-1),e("p",{class:"rf-subtitle"},[_("RF learning is a "),e("strong",null,"two-step process"),_(":")],-1),e("ol",null,[e("li",null,[e("strong",null,"Step 1 - Frequency Sweep (~10-15 seconds):"),_(" Press and hold the button on your remote until the notification updates. ")]),e("li",null,[e("strong",null,"Step 2 - Learn Signal:"),_(" Press and release the button once. ")])],-1),e("p",{class:"rf-note"},"Follow the Home Assistant notifications (🔔) for real-time instructions.",-1)])]))])):M("",!0),e("div",Hr,[l.value[j.key]?(n(),s("div",Jr,[r[18]||(r[18]=e("i",{class:"mdi mdi-check-circle"},null,-1)),r[19]||(r[19]=e("span",null,"Learned",-1)),e("span",{class:Z(["command-type-badge",V.value])},u(V.value.toUpperCase()),3),e("button",{onClick:ie=>le(j.key),class:"icon-btn",title:"Test command",disabled:p.value===j.key,style:{"margin-left":"auto"}},[e("i",{class:Z(["mdi mdi-play",{"mdi-spin":p.value===j.key}])},null,2)],8,zr),e("button",{onClick:ie=>ve(j.key),class:"icon-btn danger",title:"Delete and re-learn"},[...r[17]||(r[17]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,Gr)])):(n(),s("button",{key:0,onClick:ie=>oe(j),class:Z(["btn-learn",{learning:m.value===j.key}]),disabled:m.value!==null},[e("i",{class:Z(["mdi mdi-radio-tower",{"mdi-spin":m.value===j.key}])},null,2),_(" "+u(m.value===j.key?"Listening...":"Learn Command"),1)],10,qr))])],2))),128))]),e("div",Wr,[e("button",{onClick:N,class:"btn-secondary",disabled:m.value!==null||f.value===g.value},[...r[20]||(r[20]=[e("i",{class:"mdi mdi-play-circle"},null,-1),_(" Learn All Remaining ",-1)])],8,Kr),e("button",{onClick:te,class:"btn-text",disabled:f.value===0},[...r[21]||(r[21]=[e("i",{class:"mdi mdi-delete-sweep"},null,-1),_(" Clear All ",-1)])],8,Xr)]),ye(Le,{isOpen:P.value.show,title:"Delete Learned Command?",message:`Are you sure you want to delete the '${P.value.commandLabel}' command?

You will need to re-learn this command.`,confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,onConfirm:O,onCancel:r[2]||(r[2]=j=>P.value.show=!1)},null,8,["isOpen","message"]),ye(Le,{isOpen:T.value,title:"Delete All Learned Commands?",message:"Are you sure you want to delete all learned commands? This cannot be undone.\\n\\nYou will need to re-learn all commands.",confirmText:"Delete All",cancelText:"Cancel",dangerMode:!0,onConfirm:ue,onCancel:r[3]||(r[3]=j=>T.value=!1)},null,8,["isOpen"])]))}},Zr=ke(Yr,[["__scopeId","data-v-3ef02e18"]]),Qr={class:"profile-preview"},ed={class:"preview-summary"},td={class:"summary-card"},od={class:"stats-grid"},ld={class:"stat-item"},nd={class:"stat-value"},sd={class:"stat-item"},ad={class:"stat-value"},id={class:"stat-item"},rd={class:"stat-value"},dd={class:"preview-tabs"},ud={class:"preview-content"},cd={key:0,class:"tab-content"},md={class:"code-header"},vd={class:"code-block"},pd={key:1,class:"tab-content"},fd={class:"code-header"},gd={class:"code-block"},yd={key:2,class:"tab-content"},bd={class:"instructions"},hd={class:"step-item"},kd={class:"step-content"},wd={class:"code-path"},$d={__name:"ProfilePreview",props:{profile:{type:Object,required:!0},jsonData:{type:Object,required:!0},yamlConfig:{type:String,required:!0}},setup(o){const c=Ve(),d=o,w=y("json"),$=y(!1),l=y(!1),m=J(()=>Object.keys(d.profile.commands||{}).length),p=J(()=>JSON.stringify(d.jsonData,null,2));async function C(){try{await navigator.clipboard.writeText(p.value),$.value=!0,setTimeout(()=>{$.value=!1},2e3)}catch(V){console.error("Failed to copy JSON:",V),c.error("Failed to copy to clipboard")}}async function S(){try{await navigator.clipboard.writeText(d.yamlConfig),l.value=!0,setTimeout(()=>{l.value=!1},2e3)}catch(V){console.error("Failed to copy YAML:",V),c.error("Failed to copy to clipboard")}}return(V,h)=>{var t;return n(),s("div",Qr,[h[22]||(h[22]=e("h3",null,"Preview & Save",-1)),e("div",ed,[e("div",td,[h[4]||(h[4]=e("i",{class:"mdi mdi-check-circle"},null,-1)),e("div",null,[h[3]||(h[3]=e("h4",null,"Profile Ready!",-1)),e("p",null,u(o.profile.manufacturer)+" "+u(o.profile.model),1)])]),e("div",od,[e("div",ld,[e("span",nd,u(m.value),1),h[5]||(h[5]=e("span",{class:"stat-label"},"Commands Learned",-1))]),e("div",sd,[e("span",ad,u(o.profile.platform),1),h[6]||(h[6]=e("span",{class:"stat-label"},"Platform",-1))]),e("div",id,[e("span",rd,u(((t=o.profile.config.modes)==null?void 0:t.length)||0),1),h[7]||(h[7]=e("span",{class:"stat-label"},"HVAC Modes",-1))])])]),e("div",dd,[e("button",{onClick:h[0]||(h[0]=L=>w.value="json"),class:Z(["tab-button",{active:w.value==="json"}])},[...h[8]||(h[8]=[e("i",{class:"mdi mdi-code-json"},null,-1),_(" SmartIR JSON ",-1)])],2),e("button",{onClick:h[1]||(h[1]=L=>w.value="yaml"),class:Z(["tab-button",{active:w.value==="yaml"}])},[...h[9]||(h[9]=[e("i",{class:"mdi mdi-file-code"},null,-1),_(" YAML Config ",-1)])],2),e("button",{onClick:h[2]||(h[2]=L=>w.value="instructions"),class:Z(["tab-button",{active:w.value==="instructions"}])},[...h[10]||(h[10]=[e("i",{class:"mdi mdi-information"},null,-1),_(" Instructions ",-1)])],2)]),e("div",ud,[w.value==="json"?(n(),s("div",cd,[e("div",md,[h[12]||(h[12]=e("h4",null,"SmartIR Device Code JSON",-1)),e("button",{onClick:C,class:"btn-copy"},[h[11]||(h[11]=e("i",{class:"mdi mdi-content-copy"},null,-1)),_(" "+u($.value?"Copied!":"Copy"),1)])]),e("pre",vd,[e("code",null,u(p.value),1)]),h[13]||(h[13]=e("p",{class:"code-note"},[e("i",{class:"mdi mdi-information"}),_(" Save this as "),e("code",null,"10000.json"),_(" in your SmartIR codes directory ")],-1))])):M("",!0),w.value==="yaml"?(n(),s("div",pd,[e("div",fd,[h[15]||(h[15]=e("h4",null,"Home Assistant Configuration",-1)),e("button",{onClick:S,class:"btn-copy"},[h[14]||(h[14]=e("i",{class:"mdi mdi-content-copy"},null,-1)),_(" "+u(l.value?"Copied!":"Copy"),1)])]),e("pre",gd,[e("code",null,u(o.yamlConfig),1)]),h[16]||(h[16]=e("p",{class:"code-note"},[e("i",{class:"mdi mdi-information"}),_(" Add this to your "),e("code",null,"configuration.yaml"),_(" file ")],-1))])):M("",!0),w.value==="instructions"?(n(),s("div",yd,[e("div",bd,[h[20]||(h[20]=e("h4",null,"Installation Steps",-1)),e("div",hd,[h[19]||(h[19]=e("div",{class:"step-number"},"1",-1)),e("div",kd,[h[17]||(h[17]=e("h5",null,"Get Next Code Number",-1)),h[18]||(h[18]=e("p",null,"Custom device codes start at 10000. Check your SmartIR codes directory to find the next available number.",-1)),e("div",wd,[e("code",null,"/config/custom_components/smartir/codes/"+u(o.profile.platform)+"/",1)])])]),h[21]||(h[21]=Oe('<div class="step-item" data-v-cbf0874d><div class="step-number" data-v-cbf0874d>2</div><div class="step-content" data-v-cbf0874d><h5 data-v-cbf0874d>Save JSON File</h5><p data-v-cbf0874d>Copy the JSON from the &quot;SmartIR JSON&quot; tab and save it as <code data-v-cbf0874d>10000.json</code> (or your next available number) in the codes directory.</p></div></div><div class="step-item" data-v-cbf0874d><div class="step-number" data-v-cbf0874d>3</div><div class="step-content" data-v-cbf0874d><h5 data-v-cbf0874d>Update Configuration</h5><p data-v-cbf0874d>Copy the YAML from the &quot;YAML Config&quot; tab and add it to your <code data-v-cbf0874d>configuration.yaml</code> file. Update the <code data-v-cbf0874d>device_code</code> to match your JSON filename.</p></div></div><div class="step-item" data-v-cbf0874d><div class="step-number" data-v-cbf0874d>4</div><div class="step-content" data-v-cbf0874d><h5 data-v-cbf0874d>Restart Home Assistant</h5><p data-v-cbf0874d>Restart Home Assistant to load the new configuration. Your climate entity will appear in the UI.</p></div></div><div class="step-item" data-v-cbf0874d><div class="step-number" data-v-cbf0874d>5</div><div class="step-content" data-v-cbf0874d><h5 data-v-cbf0874d>Test Your Device</h5><p data-v-cbf0874d>Go to your climate entity and test different modes, temperatures, and fan speeds to ensure everything works correctly.</p></div></div><div class="tips-section" data-v-cbf0874d><h4 data-v-cbf0874d><i class="mdi mdi-lightbulb" data-v-cbf0874d></i> Tips </h4><ul data-v-cbf0874d><li data-v-cbf0874d>Keep a backup of your JSON file in case you need to modify it</li><li data-v-cbf0874d>Test all commands to ensure they work as expected</li><li data-v-cbf0874d>You can share your profile with the SmartIR community on GitHub</li><li data-v-cbf0874d>If a command doesn&#39;t work, you can re-learn it and update the JSON</li></ul></div>',5))])])):M("",!0)])])}}},Cd=ke($d,[["__scopeId","data-v-cbf0874d"]]),_d={class:"wizard-body"},Sd={key:0,class:"warning-section"},Id={class:"warning-box"},Dd={class:"instructions"},xd={class:"code-block"},Td={class:"steps"},Rd={key:0},Md={class:"help-section"},Ld={key:0,class:"help-content"},Od={class:"help-step"},Ad={key:0,class:"help-step"},Ed={class:"help-step"},Vd={class:"help-step"},jd={class:"checklist"},Pd={class:"checkbox-label"},Ud={key:0,class:"checkbox-label"},Fd={class:"wizard-footer"},Nd=["disabled"],Bd={__name:"SmartIRSetupWizard",props:{show:{type:Boolean,default:!1},platform:{type:String,required:!0},warnings:{type:Array,default:()=>[]},configPath:{type:String,default:"/config"}},emits:["close","complete"],setup(o,{emit:c}){const d=o,w=c,$=Ce("toast"),l=y(!1),m=y(!1),p=y(!1),C=J(()=>d.warnings.length>0?l.value&&m.value:l.value);function S(){const h=`${d.platform}: !include smartir/${d.platform}.yaml`;navigator.clipboard.writeText(h).then(()=>{var t;(t=$.value)==null||t.success("Include line copied to clipboard!","✅ Copied")}).catch(t=>{var L;console.error("Failed to copy:",t),(L=$.value)==null||L.error("Failed to copy to clipboard","❌ Copy Failed")})}function V(){w("complete")}return(h,t)=>o.show?(n(),s("div",{key:0,class:"modal-overlay",onClick:t[5]||(t[5]=ge(()=>{},["stop"]))},[e("div",{class:"setup-wizard",onClick:t[4]||(t[4]=ge(()=>{},["stop"]))},[t[31]||(t[31]=e("div",{class:"wizard-header"},[e("h2",null,[e("i",{class:"mdi mdi-cog"}),_(" SmartIR Configuration Setup ")])],-1)),e("div",_d,[o.warnings.length>0?(n(),s("div",Sd,[e("div",Id,[t[11]||(t[11]=e("i",{class:"mdi mdi-alert"},null,-1)),e("div",null,[t[9]||(t[9]=e("h3",null,"⚠️ Configuration Migration Needed",-1)),t[10]||(t[10]=e("p",null,"We detected existing platform entries in your configuration.yaml:",-1)),e("ul",null,[(n(!0),s(me,null,he(o.warnings,L=>(n(),s("li",{key:L.platform},[e("strong",null,u(L.platform)+":",1),_(" "+u(L.message),1)]))),128))]),e("p",null,[t[6]||(t[6]=e("strong",null,"Action Required:",-1)),t[7]||(t[7]=_(" Move these entries to ",-1)),e("code",null,"smartir/"+u(o.platform)+".yaml",1),t[8]||(t[8]=_(" before continuing.",-1))])])])])):M("",!0),e("div",Dd,[t[27]||(t[27]=e("h3",null,"📝 One-Time Setup",-1)),t[28]||(t[28]=e("p",null,[_("To enable SmartIR device management, add this line to your "),e("code",null,"configuration.yaml"),_(":")],-1)),e("div",xd,[e("code",null,u(o.platform)+": !include smartir/"+u(o.platform)+".yaml",1),e("button",{onClick:S,class:"copy-btn",title:"Copy to clipboard"},[...t[12]||(t[12]=[e("i",{class:"mdi mdi-content-copy"},null,-1)])])]),e("div",Td,[t[19]||(t[19]=e("h4",null,"Steps:",-1)),e("ol",null,[o.warnings.length>0?(n(),s("li",Rd,[t[13]||(t[13]=e("strong",null,"Move existing entries:",-1)),t[14]||(t[14]=_(" Copy any existing ",-1)),e("code",null,u(o.platform)+":",1),t[15]||(t[15]=_(" entries from configuration.yaml to ",-1)),e("code",null,"smartir/"+u(o.platform)+".yaml",1)])):M("",!0),t[16]||(t[16]=e("li",null,[e("strong",null,"Add include line:"),_(" Add the line above to your configuration.yaml ")],-1)),t[17]||(t[17]=e("li",null,[e("strong",null,"Save changes:"),_(" Save configuration.yaml ")],-1)),t[18]||(t[18]=e("li",null,[e("strong",null,"Continue here:"),_(` Click "I've Completed Setup" below `)],-1))])]),e("div",Md,[e("button",{onClick:t[0]||(t[0]=L=>p.value=!p.value),class:"help-toggle"},[e("i",{class:Z(["mdi",p.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2),_(" "+u(p.value?"Hide":"Show")+" Detailed Instructions ",1)]),p.value?(n(),s("div",Ld,[t[26]||(t[26]=e("h4",null,"Detailed Setup Guide:",-1)),e("div",Od,[t[21]||(t[21]=e("h5",null,"1. Open configuration.yaml",-1)),e("p",null,[t[20]||(t[20]=_("Location: ",-1)),e("code",null,u(o.configPath)+"/configuration.yaml",1)])]),o.warnings.length>0?(n(),s("div",Ad,[t[22]||(t[22]=e("h5",null,"2. Migrate Existing Entries (If Any)",-1)),e("p",null,"If you have existing "+u(o.platform)+" entries, cut them from configuration.yaml and paste into:",1),e("p",null,[e("code",null,u(o.configPath)+"/smartir/"+u(o.platform)+".yaml",1)]),t[23]||(t[23]=e("p",{class:"note"},"Broadlink Manager will create this file automatically.",-1))])):M("",!0),e("div",Ed,[e("h5",null,u(o.warnings.length>0?"3":"2")+". Add Include Line",1),t[24]||(t[24]=e("p",null,"Add this to configuration.yaml:",-1)),e("pre",null,u(o.platform)+": !include smartir/"+u(o.platform)+".yaml",1)]),e("div",Vd,[e("h5",null,u(o.warnings.length>0?"4":"3")+". Restart Home Assistant",1),t[25]||(t[25]=e("p",null,"After saving, you'll need to restart HA for changes to take effect.",-1))])])):M("",!0)])]),e("div",jd,[e("label",Pd,[z(e("input",{type:"checkbox","onUpdate:modelValue":t[1]||(t[1]=L=>l.value=L)},null,512),[[pe,l.value]]),t[29]||(t[29]=e("span",null,"I've added the include line to configuration.yaml",-1))]),o.warnings.length>0?(n(),s("label",Ud,[z(e("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=L=>m.value=L)},null,512),[[pe,m.value]]),e("span",null,"I've migrated existing "+u(o.platform)+" entries (if any)",1)])):M("",!0)])]),e("div",Fd,[e("button",{onClick:t[3]||(t[3]=L=>h.$emit("close")),class:"btn-secondary"}," Cancel "),e("button",{onClick:V,class:"btn-primary",disabled:!C.value},[...t[30]||(t[30]=[e("i",{class:"mdi mdi-check"},null,-1),_(" I've Completed Setup ",-1)])],8,Nd)])])])):M("",!0)}},Hd=ke(Bd,[["__scopeId","data-v-f6fe4c03"]]),qd={class:"modal-header"},Jd={class:"progress-steps"},zd={class:"step-number"},Gd={key:0,class:"mdi mdi-check"},Wd={key:1},Kd={class:"step-label"},Xd={class:"modal-body"},Yd={key:0,class:"step-content"},Zd={class:"form-group"},Qd={class:"form-group"},eu={class:"form-group"},tu={key:1,class:"step-content"},ou={key:1,class:"platform-form"},lu={class:"form-section"},nu={class:"checkbox-grid"},su={class:"checkbox-item"},au={class:"checkbox-item"},iu={class:"checkbox-item"},ru={class:"checkbox-item"},du={class:"checkbox-item"},uu={key:2,class:"platform-form"},cu={class:"form-section"},mu={class:"form-group"},vu={class:"form-section"},pu={class:"checkbox-grid"},fu={class:"checkbox-item"},gu={class:"checkbox-item"},yu={key:3,class:"platform-form"},bu={class:"form-section"},hu={class:"checkbox-grid"},ku={class:"checkbox-item"},wu={class:"checkbox-item"},$u={class:"checkbox-item"},Cu={class:"checkbox-item"},_u={key:2,class:"step-content"},Su={key:3,class:"step-content"},Iu={class:"modal-footer"},Du=["disabled"],xu={key:2,class:"save-buttons"},Tu=["disabled"],Ru=["disabled"],Mu={__name:"SmartIRProfileBuilder",props:{show:{type:Boolean,default:!1},editMode:{type:Boolean,default:!1},editData:{type:Object,default:null},startStep:{type:Number,default:0}},emits:["close","save"],setup(o,{emit:c}){const d=o,w=c,$=Ce("toast"),l=y(0),m=y(!1),p=y([]),C=y(!1),S=y([]),V=y("/config"),h=y(!1),t=y(null),L=y(!1),B=y(!1),P=y(""),T=y("ir"),a=y(!1),g=[{label:"Device Info",key:"info"},{label:"Configuration",key:"config"},{label:"Learn Commands",key:"commands"},{label:"Preview & Save",key:"preview"}],f=y({platform:"",manufacturer:"",model:"",broadlinkDevice:"",commandType:"ir",config:{},commands:{}}),E=y(["turn_on"]),X=y(3),oe=y([]),le=y(["turn_on"]);fe(()=>f.value.platform,A=>{A==="media_player"?f.value.config={features:E.value}:A==="fan"?f.value.config={speedLevels:X.value,features:oe.value}:A==="light"&&(f.value.config={features:le.value})}),fe(E,A=>{f.value.platform==="media_player"&&(f.value.config={features:A})},{deep:!0}),fe(X,A=>{f.value.platform==="fan"&&(f.value.config={speedLevels:A,features:oe.value})}),fe(oe,A=>{f.value.platform==="fan"&&(f.value.config={speedLevels:X.value,features:A})},{deep:!0}),fe(le,A=>{f.value.platform==="light"&&(f.value.config={features:A})},{deep:!0});function ve(A){const i=new Set,F=Object.keys(A);return F.some(U=>U==="off"||U.includes("_off"))&&i.add("off"),F.some(U=>U.includes("auto"))&&i.add("auto"),F.some(U=>U.includes("cool"))&&i.add("cool"),F.some(U=>U.includes("heat"))&&i.add("heat"),F.some(U=>U.includes("dry"))&&i.add("dry"),F.some(U=>U.includes("fan_only"))&&i.add("fan_only"),Array.from(i)}function O(A){const i=new Set,F=Object.keys(A);return F.some(U=>U.includes("auto"))&&i.add("auto"),F.some(U=>U.includes("low"))&&i.add("low"),F.some(U=>U.includes("medium")||U.includes("mid"))&&i.add("medium"),F.some(U=>U.includes("high"))&&i.add("high"),Array.from(i)}function N(A){const i=new Set,F=Object.keys(A);return F.some(U=>U.includes("swing_off")||U.includes("_off"))&&i.add("off"),F.some(U=>U.includes("vertical"))&&i.add("vertical"),F.some(U=>U.includes("horizontal"))&&i.add("horizontal"),F.some(U=>U.includes("both"))&&i.add("both"),Array.from(i)}function te(A){for(const i of Object.values(A))if(typeof i=="string"&&i.startsWith("sc")||Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0].startsWith("sc"))return"rf";return"ir"}fe(()=>f.value.commandType,(A,i)=>{!i||L.value||a.value||(Object.keys(f.value.commands).length>0&&A!==i?(P.value=A,f.value.commandType=i,L.value=!0):A!==i&&(T.value=A))}),fe(()=>d.editData,async A=>{var i,F,U;if(A&&d.editMode){console.log("🔧 Edit mode activated, loading profile data:",A),a.value=!0,p.value.length===0&&(console.log("📡 Loading Broadlink devices..."),await re(),console.log("📡 Devices loaded:",p.value.length));const x=A.profile,k=x.controller_data;console.log("🎮 Controller data from profile:",k),console.log("🎮 Available devices:",p.value.map(G=>G.entity_id));const R=x.commands||{},H=x.commandType||te(R);console.log("🔍 Command type (stored):",x.commandType),console.log("🔍 Command type (final):",H);let K={};if(A.platform==="climate"){const G=x.operationModes||ve(R),ee=x.fanModes||O(R),de=x.swingModes||N(R);console.log("🔍 Inferred modes:",G),console.log("🔍 Inferred fan modes:",ee),console.log("🔍 Inferred swing modes:",de),K={minTemp:x.minTemperature,maxTemp:x.maxTemperature,precision:x.precision,modes:G,fanModes:ee,swingModes:de}}else if(A.platform==="media_player"){const G=[];(R.on||R.off)&&G.push("turn_on"),(R.volumeUp||R.volumeDown)&&G.push("volume"),R.mute&&G.push("mute"),R.sources&&G.push("source"),(R.channelUp||R.channelDown)&&G.push("channel"),K={features:G},E.value=G,console.log("🔍 Inferred media player features:",G)}else if(A.platform==="fan"){const G=((i=x.speed)==null?void 0:i.length)||Object.keys(R.default||{}).length||3,ee=[];(R.oscillate_on||R.oscillate_off)&&ee.push("oscillate"),(R.direction_forward||R.direction_reverse)&&ee.push("direction"),K={speedLevels:G,features:ee},X.value=G,oe.value=ee,console.log("🔍 Inferred fan config:",K)}else if(A.platform==="light"){const G=[];K={features:G},le.value=G,console.log("🔍 Inferred light features:",G)}const se=await D(x.manufacturer,(F=x.supportedModels)==null?void 0:F[0],R);f.value={platform:A.platform,manufacturer:x.manufacturer||"",model:((U=x.supportedModels)==null?void 0:U[0])||"",broadlinkDevice:k||"",commandType:H,config:K,commands:se},console.log("✅ Profile populated:",f.value),console.log("✅ Selected device:",f.value.broadlinkDevice),console.log("✅ Command type:",f.value.commandType),console.log("✅ Commands (with learned codes):",se),T.value=H,setTimeout(()=>{a.value=!1},100)}},{immediate:!0});const ue=J(()=>{var A;switch(l.value){case 0:return f.value.platform&&f.value.manufacturer&&f.value.model;case 1:return f.value.platform==="climate"?f.value.config.minTemp&&f.value.config.maxTemp&&((A=f.value.config.modes)==null?void 0:A.length)>0:!0;case 2:return f.value.broadlinkDevice&&f.value.commandType&&Object.keys(f.value.commands).length>0;case 3:return!0;default:return!1}}),be=y(null);async function Se(){if(l.value!==3){be.value=null;return}if(console.log("🔍 Generating JSON with commands:",f.value.commands),Object.values(f.value.commands).some(i=>typeof i=="string"?i==="pending":typeof i=="object"?Object.values(i).some(F=>typeof F=="string"?F==="pending":typeof F=="object"?Object.values(F).some(U=>U==="pending"):!1):!1)){console.warn('⚠️ Commands still contain "pending" placeholders!'),console.log("📦 Attempting to fetch from Broadlink storage...");const i=await D(f.value.manufacturer,f.value.model,f.value.commands);f.value.commands=i,console.log("✅ Updated commands:",i)}be.value=ne(f.value),console.log("📄 Generated JSON:",be.value)}const Ie=J(()=>l.value!==3?null:Q(f.value));function De(){f.value.config={},f.value.commands={}}function I(){L.value=!1,f.value.commandType=P.value,T.value=P.value,f.value.commands={},P.value=""}function r(){L.value=!1,P.value=""}async function j(){l.value<g.length-1&&(l.value++,l.value===3&&await Se())}function ie(){l.value>0&&l.value--}function W(){L.value||(B.value=!0)}function b(){B.value=!1,v()}function v(){w("close"),setTimeout(()=>{l.value=0,f.value={platform:"",manufacturer:"",model:"",broadlinkDevice:"",commandType:"ir",config:{},commands:{}},T.value="ir"},300)}async function Y(){var A,i,F,U,x;m.value=!0;try{if(!h.value){const G=await fetch("api/smartir/config/check");if(G.ok){const ee=await G.json();if(!((A=ee.platforms[f.value.platform])==null?void 0:A.file_exists)){S.value=ee.configuration_warnings||[],V.value=ee.config_path||"/config",t.value={platform:f.value.platform,json:be.value},C.value=!0,m.value=!1;return}}}let k;if(d.editMode&&((i=d.editData)!=null&&i.code))k=parseInt(d.editData.code),console.log("📝 Edit mode: Using existing code",k);else{const G=await fetch(`api/smartir/platforms/${f.value.platform}/next-code`);if(!G.ok)throw new Error("Failed to get next code number");k=(await G.json()).next_code,console.log("✨ New profile: Using next code",k)}const R=await fetch("api/smartir/profiles",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({platform:f.value.platform,json:be.value,code_number:k})});if(!R.ok){const G=await R.json();throw new Error(G.error||"Failed to save profile")}const H=await R.json(),K={platform:"smartir",name:`${f.value.manufacturer} ${f.value.model}`,unique_id:`${f.value.manufacturer.toLowerCase().replace(/[^a-z0-9]+/g,"_")}_${f.value.model.toLowerCase().replace(/[^a-z0-9]+/g,"_")}`,device_code:k,controller_data:f.value.broadlinkDevice},se=await fetch("api/smartir/config/add-device",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({platform:f.value.platform,device_config:K})});if(!se.ok){const G=await se.json();console.error("Failed to add device to config:",G);let ee=G.error||"Unknown error";G.validation_errors&&G.validation_errors.length>0&&(ee=`Device configuration validation failed:
`+G.validation_errors.map(de=>`  • ${de}`).join(`
`)),(F=$.value)==null||F.warning(`Profile saved but failed to add to config file:
${ee}`,"⚠️ Partial Success")}w("save",{json:be.value,yaml:Ie.value,profile:f.value,saved_to:H.path}),(U=$.value)==null||U.success(`File: ${H.filename}
Device Code: ${k}
Added to: smartir/${f.value.platform}.yaml

⚠️ Restart Home Assistant to activate`,"✅ Profile Saved Successfully!"),v()}catch(k){console.error("Error saving profile:",k),(x=$.value)==null||x.error(k.message,"❌ Error Saving Profile")}finally{m.value=!1}}async function ae(){h.value=!0,C.value=!1,t.value&&(await Y(),t.value=null)}function q(){var A,i;try{const F=JSON.stringify(be.value,null,2),U=new Blob([F],{type:"application/json"}),x=URL.createObjectURL(U),k=document.createElement("a");k.href=x;const R=f.value.manufacturer.toLowerCase().replace(/\s+/g,"_"),H=f.value.model.toLowerCase().replace(/\s+/g,"_");k.download=`smartir_${f.value.platform}_${R}_${H}.json`,document.body.appendChild(k),k.click(),document.body.removeChild(k),URL.revokeObjectURL(x),(A=$.value)==null||A.success("You can manually upload this file to your SmartIR codes directory.","✅ Profile Downloaded")}catch(F){console.error("Error downloading profile:",F),(i=$.value)==null||i.error(F.message,"❌ Error Downloading Profile")}}async function D(A,i,F){const U=A.toLowerCase().replace(/[^a-z0-9]+/g,"_"),x=i.toLowerCase().replace(/[^a-z0-9]+/g,"_"),k=`${U}_${x}`;try{const R=await fetch("/api/commands/all");if(!R.ok)return console.error("Failed to fetch commands from Broadlink storage"),F;const K=(await R.json())[k]||{};console.log(`🔍 Fetching learned commands for device: ${k}`),console.log("📦 Device commands from storage:",K);const se={...F};for(const[G,ee]of Object.entries(se))if(ee==="pending"&&K[G])se[G]=K[G];else if(typeof ee=="object"){for(const[de,xe]of Object.entries(ee))if(typeof xe=="object")for(const[Me,Ee]of Object.entries(xe)){const He=`${G}_${de}_${Me}`;Ee==="pending"&&K[He]&&(se[G][de][Me]=K[He])}else if(xe==="pending"){const Me=`${G}_${de}`;K[Me]&&(se[G][de]=K[Me])}}return console.log("✅ Merged commands:",se),se}catch(R){return console.error("Error fetching learned commands:",R),F}}function ne(A){const i={manufacturer:A.manufacturer,supportedModels:[A.model],supportedController:"Broadlink",commandsEncoding:"Base64",commandType:A.commandType||"ir",commands:{}};return A.platform==="climate"&&(i.minTemperature=A.config.minTemp,i.maxTemperature=A.config.maxTemp,i.precision=A.config.precision||1,i.operationModes=A.config.modes||[],i.fanModes=A.config.fanModes&&A.config.fanModes.length>0?A.config.fanModes:["auto"],A.config.swingModes&&A.config.swingModes.length>0&&(i.swingModes=A.config.swingModes),i.commands=A.commands),i}function Q(A){let i=`# SmartIR ${A.platform} configuration
`;return i+=`# Generated by Broadlink Manager v2

`,A.platform==="climate"&&(i+=`climate:
`,i+=`  - platform: smartir
`,i+=`    name: ${A.manufacturer} ${A.model}
`,i+=`    unique_id: ${A.manufacturer.toLowerCase()}_${A.model.toLowerCase().replace(/\s+/g,"_")}
`,i+=`    device_code: 10000  # Change this to your custom code number
`,i+=`    controller_data: ${A.broadlinkDevice}
`,A.config.tempSensor&&(i+=`    temperature_sensor: ${A.config.tempSensor}
`),A.config.humiditySensor&&(i+=`    humidity_sensor: ${A.config.humiditySensor}
`),A.config.powerSensor&&(i+=`    power_sensor: ${A.config.powerSensor}
`)),i}async function re(){try{console.log("Fetching remote devices from api/remote/devices...");const A=await fetch("api/remote/devices");if(console.log("Response status:",A.status,A.ok),A.ok){const i=await A.json();console.log("Loaded remote devices response:",i);const F=i.devices||[];console.log("Extracted devices array:",F),console.log("Device count:",F.length),p.value=F,console.log("broadlinkDevices.value set to:",p.value),console.log("Final device count:",p.value.length)}else console.error("Response not OK:",A.status,A.statusText),p.value=[]}catch(A){console.error("Error loading remote devices:",A),p.value=[]}}return fe(()=>d.show,A=>{if(A){const i=Number.isInteger(d.startStep)?d.startStep:0;l.value=Math.min(Math.max(i,0),g.length-1)}}),fe(()=>d.startStep,A=>{if(d.show){const i=Number.isInteger(A)?A:0;l.value=Math.min(Math.max(i,0),g.length-1)}}),Te(()=>{d.show&&re()}),(A,i)=>o.show?(n(),s("div",{key:0,class:"modal-overlay",onClick:W},[e("div",{class:"modal-container",onClick:i[19]||(i[19]=ge(()=>{},["stop"]))},[e("div",qd,[e("h2",null,[i[22]||(i[22]=e("i",{class:"mdi mdi-file-document-edit"},null,-1)),_(" "+u(o.editMode?"Edit SmartIR Profile":"Create SmartIR Profile"),1)]),e("button",{onClick:v,class:"close-button"},[...i[23]||(i[23]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Jd,[(n(),s(me,null,he(g,(F,U)=>e("div",{key:U,class:Z(["step",{active:l.value===U,completed:l.value>U}])},[e("div",zd,[l.value>U?(n(),s("i",Gd)):(n(),s("span",Wd,u(U+1),1))]),e("span",Kd,u(F.label),1)],2)),64))]),e("div",Xd,[l.value===0?(n(),s("div",Yd,[i[29]||(i[29]=e("h3",null,"Device Information",-1)),e("div",Zd,[i[25]||(i[25]=e("label",null,"Platform Type *",-1)),z(e("select",{"onUpdate:modelValue":i[0]||(i[0]=F=>f.value.platform=F),onChange:De},[...i[24]||(i[24]=[Oe('<option value="" data-v-fc0e4111>Select platform...</option><option value="climate" data-v-fc0e4111>🌡️ Climate (AC, Heater, Heat Pump)</option><option value="media_player" data-v-fc0e4111>📺 Media Player (TV, Receiver)</option><option value="fan" data-v-fc0e4111>🌀 Fan</option><option value="light" data-v-fc0e4111>💡 Light (LED Strip, IR Light)</option>',5)])],544),[[we,f.value.platform]])]),e("div",Qd,[i[26]||(i[26]=e("label",null,"Manufacturer *",-1)),z(e("input",{"onUpdate:modelValue":i[1]||(i[1]=F=>f.value.manufacturer=F),type:"text",placeholder:"e.g., Daikin, LG, Samsung"},null,512),[[_e,f.value.manufacturer]])]),e("div",eu,[i[27]||(i[27]=e("label",null,"Model(s) *",-1)),z(e("input",{"onUpdate:modelValue":i[2]||(i[2]=F=>f.value.model=F),type:"text",placeholder:"e.g., FTXS35K, Multiple models"},null,512),[[_e,f.value.model]]),i[28]||(i[28]=e("small",null,'Enter model number or "Multiple" if it works with many models',-1))])])):M("",!0),l.value===1?(n(),s("div",tu,[f.value.platform==="climate"?(n(),Re(hr,{key:0,modelValue:f.value.config,"onUpdate:modelValue":i[3]||(i[3]=F=>f.value.config=F)},null,8,["modelValue"])):f.value.platform==="media_player"?(n(),s("div",ou,[i[36]||(i[36]=e("h3",null,"Media Player Configuration",-1)),i[37]||(i[37]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),_(" Configure the features your media player supports. You'll learn the IR commands in the next step. ")],-1)),e("div",lu,[i[35]||(i[35]=e("h4",null,"Supported Features",-1)),e("div",nu,[e("label",su,[z(e("input",{type:"checkbox",value:"turn_on","onUpdate:modelValue":i[4]||(i[4]=F=>E.value=F)},null,512),[[pe,E.value]]),i[30]||(i[30]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),_(" Power On/Off ")],-1))]),e("label",au,[z(e("input",{type:"checkbox",value:"volume","onUpdate:modelValue":i[5]||(i[5]=F=>E.value=F)},null,512),[[pe,E.value]]),i[31]||(i[31]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-volume-high"}),_(" Volume Control ")],-1))]),e("label",iu,[z(e("input",{type:"checkbox",value:"mute","onUpdate:modelValue":i[6]||(i[6]=F=>E.value=F)},null,512),[[pe,E.value]]),i[32]||(i[32]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-volume-mute"}),_(" Mute ")],-1))]),e("label",ru,[z(e("input",{type:"checkbox",value:"source","onUpdate:modelValue":i[7]||(i[7]=F=>E.value=F)},null,512),[[pe,E.value]]),i[33]||(i[33]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-import"}),_(" Source Selection ")],-1))]),e("label",du,[z(e("input",{type:"checkbox",value:"channel","onUpdate:modelValue":i[8]||(i[8]=F=>E.value=F)},null,512),[[pe,E.value]]),i[34]||(i[34]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-numeric"}),_(" Channel Control ")],-1))])])])])):f.value.platform==="fan"?(n(),s("div",uu,[i[44]||(i[44]=e("h3",null,"Fan Configuration",-1)),i[45]||(i[45]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),_(" Configure the features your fan supports. You'll learn the IR commands in the next step. ")],-1)),e("div",cu,[i[40]||(i[40]=e("h4",null,"Fan Speed Levels",-1)),e("div",mu,[i[39]||(i[39]=e("label",null,"Number of Speed Levels *",-1)),z(e("select",{"onUpdate:modelValue":i[9]||(i[9]=F=>X.value=F)},[...i[38]||(i[38]=[e("option",{value:1},"1 Speed",-1),e("option",{value:2},"2 Speeds",-1),e("option",{value:3},"3 Speeds (Low/Med/High)",-1),e("option",{value:4},"4 Speeds",-1),e("option",{value:5},"5 Speeds",-1),e("option",{value:6},"6 Speeds",-1)])],512),[[we,X.value,void 0,{number:!0}]])])]),e("div",vu,[i[43]||(i[43]=e("h4",null,"Additional Features",-1)),e("div",pu,[e("label",fu,[z(e("input",{type:"checkbox",value:"oscillate","onUpdate:modelValue":i[10]||(i[10]=F=>oe.value=F)},null,512),[[pe,oe.value]]),i[41]||(i[41]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-sync"}),_(" Oscillation ")],-1))]),e("label",gu,[z(e("input",{type:"checkbox",value:"direction","onUpdate:modelValue":i[11]||(i[11]=F=>oe.value=F)},null,512),[[pe,oe.value]]),i[42]||(i[42]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-rotate-3d-variant"}),_(" Direction (Forward/Reverse) ")],-1))])])])])):f.value.platform==="light"?(n(),s("div",yu,[i[51]||(i[51]=e("h3",null,"Light Configuration",-1)),i[52]||(i[52]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),_(" Configure the features your light supports. You'll learn the IR commands in the next step. ")],-1)),e("div",bu,[i[50]||(i[50]=e("h4",null,"Supported Features",-1)),e("div",hu,[e("label",ku,[z(e("input",{type:"checkbox",value:"turn_on","onUpdate:modelValue":i[12]||(i[12]=F=>le.value=F)},null,512),[[pe,le.value]]),i[46]||(i[46]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),_(" Power On/Off ")],-1))]),e("label",wu,[z(e("input",{type:"checkbox",value:"brightness","onUpdate:modelValue":i[13]||(i[13]=F=>le.value=F)},null,512),[[pe,le.value]]),i[47]||(i[47]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-brightness-6"}),_(" Brightness Control ")],-1))]),e("label",$u,[z(e("input",{type:"checkbox",value:"color_temp","onUpdate:modelValue":i[14]||(i[14]=F=>le.value=F)},null,512),[[pe,le.value]]),i[48]||(i[48]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-thermometer"}),_(" Color Temperature ")],-1))]),e("label",Cu,[z(e("input",{type:"checkbox",value:"rgb","onUpdate:modelValue":i[15]||(i[15]=F=>le.value=F)},null,512),[[pe,le.value]]),i[49]||(i[49]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-palette"}),_(" RGB Color ")],-1))])])])])):M("",!0)])):M("",!0),l.value===2?(n(),s("div",_u,[ye(Zr,{modelValue:f.value.commands,"onUpdate:modelValue":i[16]||(i[16]=F=>f.value.commands=F),platform:f.value.platform,config:f.value.config,broadlinkDevice:f.value.broadlinkDevice,"onUpdate:broadlinkDevice":i[17]||(i[17]=F=>f.value.broadlinkDevice=F),manufacturer:f.value.manufacturer,model:f.value.model,commandType:f.value.commandType,"onUpdate:commandType":i[18]||(i[18]=F=>f.value.commandType=F)},null,8,["modelValue","platform","config","broadlinkDevice","manufacturer","model","commandType"])])):M("",!0),l.value===3?(n(),s("div",Su,[ye(Cd,{profile:f.value,"json-data":be.value,"yaml-config":Ie.value},null,8,["profile","json-data","yaml-config"])])):M("",!0)]),e("div",Iu,[l.value>0?(n(),s("button",{key:0,onClick:ie,class:"btn-secondary"},[...i[53]||(i[53]=[e("i",{class:"mdi mdi-arrow-left"},null,-1),_(" Back ",-1)])])):M("",!0),i[57]||(i[57]=e("div",{class:"spacer"},null,-1)),e("button",{onClick:v,class:"btn-text"}," Cancel "),l.value<g.length-1?(n(),s("button",{key:1,onClick:j,class:"btn-primary",disabled:!ue.value},[...i[54]||(i[54]=[_(" Next ",-1),e("i",{class:"mdi mdi-arrow-right"},null,-1)])],8,Du)):(n(),s("div",xu,[e("button",{onClick:Y,class:"btn-primary",disabled:m.value},[i[55]||(i[55]=e("i",{class:"mdi mdi-cloud-upload"},null,-1)),_(" "+u(m.value?"Saving...":"Save to SmartIR"),1)],8,Tu),e("button",{onClick:q,class:"btn-secondary",disabled:m.value},[...i[56]||(i[56]=[e("i",{class:"mdi mdi-download"},null,-1),_(" Download JSON ",-1)])],8,Ru)]))])]),ye(Hd,{show:C.value,platform:f.value.platform,warnings:S.value,"config-path":V.value,onClose:i[20]||(i[20]=F=>C.value=!1),onComplete:ae},null,8,["show","platform","warnings","config-path"]),ye(Le,{isOpen:L.value,title:"Change Command Type?",message:"Changing the command type will clear all learned commands. Continue?",confirmText:"Continue",cancelText:"Cancel",dangerMode:!0,onConfirm:I,onCancel:r},null,8,["isOpen"]),ye(Le,{isOpen:B.value,title:"Close Profile Builder?",message:"Are you sure you want to close? Your progress will be lost.",confirmText:"Close",cancelText:"Keep Editing",dangerMode:!0,onConfirm:b,onCancel:i[21]||(i[21]=F=>B.value=!1)},null,8,["isOpen"])])):M("",!0)}},Lu=ke(Mu,[["__scopeId","data-v-fc0e4111"]]),Ou={class:"dashboard"},Au={__name:"Dashboard",setup(o){const c=Ve(),d=Ce("smartirEnabled"),w=y(!1),$=y(!1),l=y(null),m=y(0),p=y(null);function C(){$.value=!1,l.value=null,m.value=0,w.value=!0}async function S({platform:L,profile:B,startStep:P}){m.value=Number.isInteger(P)?P:0;try{const T=await fetch(`api/smartir/platforms/${L}/profiles/${B.code}`);if(!T.ok)throw new Error("Failed to load profile");const a=await T.json();let g="";try{const f=await fetch(`api/smartir/config/get-device?platform=${L}&code=${B.code}`);f.ok?(g=(await f.json()).controller_data||"",console.log("✅ Found controller_data from YAML:",g)):console.warn("⚠️ No YAML entry found for this profile (this is OK for profiles not yet added to config)")}catch(f){console.warn("⚠️ Could not fetch controller_data from config:",f)}$.value=!0,l.value={platform:L,code:B.code,profile:{...a.profile,controller_data:g}},w.value=!0}catch(T){console.error("Error loading profile for edit:",T),c.error("Failed to load profile for editing")}}function V(){w.value=!1,$.value=!1,l.value=null}function h(){console.log("Show install guide clicked"),window.open("https://github.com/smartHomeHub/SmartIR","_blank")}async function t(L){console.log("Profile saved:",L),V(),p.value&&p.value.loadAllProfiles&&(await p.value.loadAllProfiles(),console.log("✅ Profiles list refreshed"))}return(L,B)=>(n(),s("div",Ou,[$e(d)?(n(),Re(Ls,{key:0})):M("",!0),B[0]||(B[0]=Oe('<div class="welcome-banner" data-v-fbe628f8><div class="banner-content" data-v-fbe628f8><div class="banner-icon" data-v-fbe628f8><i class="mdi mdi-rocket-launch" data-v-fbe628f8></i></div><div class="banner-text" data-v-fbe628f8><h2 data-v-fbe628f8>Welcome to Broadlink Manager v2!</h2><p data-v-fbe628f8>Manage your IR/RF devices with a modern Vue 3 interface</p></div></div><div class="status-badges" data-v-fbe628f8><span class="badge success" data-v-fbe628f8><i class="mdi mdi-check-circle" data-v-fbe628f8></i> Vue 3 Ready </span><span class="badge warning" data-v-fbe628f8><i class="mdi mdi-beta" data-v-fbe628f8></i> Beta </span></div></div>',1)),ye(Is),$e(d)?(n(),Re(Ci,{key:1,ref_key:"smartirStatusCard",ref:p,onCreateProfile:C,onEditProfile:S,onShowInstallGuide:h},null,512)):M("",!0),ye(Lu,{show:w.value,editMode:$.value,editData:l.value,startStep:m.value,onClose:V,onSave:t},null,8,["show","editMode","editData","startStep"])]))}},Eu=ke(Au,[["__scopeId","data-v-fbe628f8"]]),Vu={class:"toast-container"},ju={class:"toast-content"},Pu={key:0,class:"toast-title"},Uu={class:"toast-message"},Fu={key:1,class:"toast-description"},Nu=["onClick","title"],Bu={__name:"Toast",setup(o,{expose:c}){const d=y([]);let w=0;function $(p){const C={success:"mdi-check-circle",error:"mdi-alert-circle",warning:"mdi-alert",info:"mdi-information"};return C[p]||C.info}function l({message:p,title:C,description:S,type:V="info",duration:h=5e3}){const t=w++,L={id:t,message:p,title:C,description:S,type:V};return d.value.push(L),h>0&&setTimeout(()=>{m(t)},h),t}function m(p){const C=d.value.findIndex(S=>S.id===p);C>-1&&d.value.splice(C,1)}return c({addToast:l,removeToast:m,show:l,success:(p,C)=>l({message:p,title:C,type:"success"}),error:(p,C)=>l({message:p,title:C,type:"error",duration:0}),warning:(p,C)=>l({message:p,title:C,type:"warning",duration:0}),info:(p,C)=>l({message:p,title:C,type:"info"})}),(p,C)=>(n(),Re(We,{to:"body"},[e("div",Vu,[ye(ot,{name:"toast"},{default:Ne(()=>[(n(!0),s(me,null,he(d.value,S=>(n(),s("div",{key:S.id,class:Z(["toast",[`toast-${S.type}`,{"toast-persistent":S.type==="error"||S.type==="warning"}]])},[e("i",{class:Z(["mdi",$(S.type)])},null,2),e("div",ju,[S.title?(n(),s("div",Pu,u(S.title),1)):M("",!0),e("div",Uu,u(S.message),1),S.description?(n(),s("div",Fu,u(S.description),1)):M("",!0)]),e("button",{onClick:V=>m(S.id),class:Z(["toast-close",{"toast-close-prominent":S.type==="error"||S.type==="warning"}]),title:S.type==="error"||S.type==="warning"?"Click to dismiss":"Close"},[...C[0]||(C[0]=[e("i",{class:"mdi mdi-close"},null,-1)])],10,Nu)],2))),128))]),_:1})])]))}},Hu=ke(Bu,[["__scopeId","data-v-f0587837"]]),qu="0.3.0-alpha.1",Ju={version:qu},zu={id:"app",class:"app-container"},Gu={class:"app-header"},Wu={class:"header-content"},Ku={class:"header-right"},Xu=["title"],Yu={class:"settings-menu-container"},Zu={key:0,class:"settings-menu"},Qu=["title"],ec={class:"toggle-content"},tc={key:0,class:"not-installed-label"},oc={key:0,href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"menu-item menu-link menu-subitem"},lc=["disabled"],nc=["disabled"],sc=["disabled"],ac={class:"app-main"},ic={class:"app-footer"},rc={__name:"App",setup(o){const c=y(null),d=Ju.version,w=y("light"),$=y(null),l=y(!1),m=y(!1),p=y(!1),C=y(localStorage.getItem("smartir_enabled")!=="false"),S=J(()=>{var f;return((f=$.value)==null?void 0:f.installed)||!1}),V=J(()=>({light:"mdi mdi-weather-sunny",medium:"mdi mdi-weather-partly-cloudy",dark:"mdi mdi-weather-night"})[w.value]),h=J(()=>({light:"Switch to Medium Theme",medium:"Switch to Dark Theme",dark:"Switch to Light Theme"})[w.value]),t=()=>{const f=["light","medium","dark"],X=(f.indexOf(w.value)+1)%f.length;w.value=f[X],document.body.classList.remove("medium-mode","dark-mode"),w.value==="medium"?document.body.classList.add("medium-mode"):w.value==="dark"&&document.body.classList.add("dark-mode"),localStorage.setItem("theme",w.value)},L=async()=>{try{const f=await Ye.getStatus();$.value=f,f.installed?console.log("✅ SmartIR detected:",f.version):console.log("ℹ️ SmartIR not detected")}catch(f){console.error("Error checking SmartIR:",f),$.value={installed:!1,error:f.message}}},B=async()=>{var f,E;m.value=!0;try{const oe=(await ce.get("/api/diagnostics/markdown")).data.markdown;await navigator.clipboard.writeText(oe),(f=c.value)==null||f.success("Diagnostic summary copied to clipboard!"),l.value=!1}catch(X){console.error("Error copying diagnostics:",X),(E=c.value)==null||E.error("Failed to copy diagnostics")}finally{m.value=!1}},P=async()=>{var f,E;m.value=!0;try{const X=await ce.get("/api/diagnostics/download",{responseType:"blob"}),oe=window.URL.createObjectURL(new Blob([X.data])),le=document.createElement("a");le.href=oe;const ve=X.headers["content-disposition"];let O="broadlink_manager_diagnostics.zip";if(ve){const N=ve.match(/filename="?(.+)"?/);N&&(O=N[1])}le.setAttribute("download",O),document.body.appendChild(le),le.click(),le.remove(),window.URL.revokeObjectURL(oe),(f=c.value)==null||f.success("Diagnostic bundle downloaded!"),l.value=!1}catch(X){console.error("Error downloading diagnostics:",X),(E=c.value)==null||E.error("Failed to download diagnostics")}finally{m.value=!1}},T=()=>{S.value&&(C.value=!C.value,localStorage.setItem("smartir_enabled",C.value.toString()),window.location.reload())},a=async()=>{var f,E,X;p.value=!0;try{const oe=await ce.post("/api/smartir/refresh-index");oe.data.success?(f=c.value)==null||f.success(`Updated to v${oe.data.version} (${oe.data.total_devices} devices)`,"✅ Index Updated"):(E=c.value)==null||E.error(oe.data.error||"Unknown error","❌ Update Failed")}catch(oe){console.error("Error updating SmartIR index:",oe),(X=c.value)==null||X.error("Failed to update device index","❌ Update Error")}finally{p.value=!1,l.value=!1}},g=f=>{f.target.closest(".settings-menu-container")||(l.value=!1)};return Te(async()=>{const f=localStorage.getItem("theme");f&&["light","medium","dark"].includes(f)?(w.value=f,f==="medium"?document.body.classList.add("medium-mode"):f==="dark"&&document.body.classList.add("dark-mode")):localStorage.getItem("darkMode")==="true"&&(w.value="dark",document.body.classList.add("dark-mode"),localStorage.setItem("theme","dark")),await L();const E=qe();E&&c.value&&(E.appContext.config.globalProperties.$toast=c.value),document.addEventListener("click",g)}),Je(()=>{document.removeEventListener("click",g)}),Pe("smartirStatus",$),Pe("smartirEnabled",C),Pe("refreshSmartIR",L),Pe("toast",c),(f,E)=>(n(),s("div",zu,[e("header",Gu,[e("div",Wu,[E[13]||(E[13]=e("div",{class:"header-left"},[e("i",{class:"mdi mdi-remote"}),e("h1",null,"Broadlink Manager v2"),e("span",{class:"beta-badge"},"BETA")],-1)),e("div",Ku,[e("button",{onClick:t,class:"icon-button",title:h.value},[e("i",{class:Z(V.value)},null,2)],8,Xu),e("div",Yu,[e("button",{onClick:E[0]||(E[0]=X=>l.value=!l.value),class:"icon-button",title:"Settings"},[...E[2]||(E[2]=[e("i",{class:"mdi mdi-cog"},null,-1)])]),l.value?(n(),s("div",Zu,[E[9]||(E[9]=e("div",{class:"menu-section-title"},"Integration Settings",-1)),e("div",{class:Z(["menu-item toggle-item",{disabled:!S.value}]),onClick:E[1]||(E[1]=X=>S.value?T():null),title:S.value?"":"SmartIR is not installed"},[e("div",ec,[E[3]||(E[3]=e("i",{class:"mdi mdi-air-conditioner"},null,-1)),E[4]||(E[4]=e("span",null,"SmartIR Integration",-1)),S.value?M("",!0):(n(),s("span",tc,"(Not Installed)"))]),e("div",{class:Z(["toggle-switch",{active:C.value&&S.value,disabled:!S.value}])},[...E[5]||(E[5]=[e("div",{class:"toggle-slider"},null,-1)])],2)],10,Qu),C.value?(n(),s("a",oc,[...E[6]||(E[6]=[e("i",{class:"mdi mdi-github"},null,-1),e("span",null,"SmartIR on GitHub",-1)])])):M("",!0),C.value?(n(),s("button",{key:1,onClick:a,class:"menu-item menu-subitem",disabled:p.value},[e("i",{class:Z(["mdi",p.value?"mdi-loading mdi-spin":"mdi-refresh"])},null,2),e("span",null,u(p.value?"Updating...":"Update Device Index"),1)],8,lc)):M("",!0),E[10]||(E[10]=e("div",{class:"menu-divider"},null,-1)),E[11]||(E[11]=e("div",{class:"menu-section-title"},"Diagnostics",-1)),e("button",{onClick:B,class:"menu-item",disabled:m.value},[...E[7]||(E[7]=[e("i",{class:"mdi mdi-content-copy"},null,-1),e("span",null,"Copy Diagnostics",-1)])],8,nc),e("button",{onClick:P,class:"menu-item",disabled:m.value},[...E[8]||(E[8]=[e("i",{class:"mdi mdi-download"},null,-1),e("span",null,"Download Diagnostics",-1)])],8,sc),E[12]||(E[12]=Oe('<div class="menu-divider" data-v-58d20c03></div><div class="menu-section-title" data-v-58d20c03>Help &amp; Support</div><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2#readme" target="_blank" class="menu-item menu-link" data-v-58d20c03><i class="mdi mdi-book-open-variant" data-v-58d20c03></i><span data-v-58d20c03>Documentation</span></a><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2/issues" target="_blank" class="menu-item menu-link" data-v-58d20c03><i class="mdi mdi-bug" data-v-58d20c03></i><span data-v-58d20c03>Report Issue</span></a><div class="menu-divider" data-v-58d20c03></div><div class="menu-section-title" data-v-58d20c03>Community</div><a href="https://community.home-assistant.io/t/broadlink-manager-modern-web-interface-for-broadlink-devices/938473" target="_blank" class="menu-item menu-link" data-v-58d20c03><i class="mdi mdi-forum" data-v-58d20c03></i><span data-v-58d20c03>HA Forum Discussion</span></a><a href="https://www.reddit.com/r/homeassistant/comments/1o1q3kf/release_broadlink_manager_addon_a_modern_web_ui/" target="_blank" class="menu-item menu-link" data-v-58d20c03><i class="mdi mdi-reddit" data-v-58d20c03></i><span data-v-58d20c03>Reddit Discussion</span></a><div class="menu-divider" data-v-58d20c03></div><div class="menu-section-title" data-v-58d20c03>Project</div><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2" target="_blank" class="menu-item menu-link" data-v-58d20c03><i class="mdi mdi-github" data-v-58d20c03></i><span data-v-58d20c03>GitHub Repository</span></a><a href="https://ko-fi.com/tonyperkins" target="_blank" class="menu-item menu-link menu-item-sponsor" data-v-58d20c03><i class="mdi mdi-coffee" data-v-58d20c03></i><span data-v-58d20c03>Support on Ko-fi</span></a>',12))])):M("",!0)])])])]),e("main",ac,[ye(Eu)]),e("footer",ic,[e("p",null,"Broadlink Manager v"+u($e(d))+" | Built with Vue "+u(lt),1)]),ye(Hu,{ref_key:"toastRef",ref:c},null,512)]))}},dc=ke(rc,[["__scopeId","data-v-58d20c03"]]),Ze=nt(dc),uc=st();Ze.use(uc);Ze.mount("#app");
