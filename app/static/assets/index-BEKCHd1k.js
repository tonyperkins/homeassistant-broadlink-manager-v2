import{g as We,r as y,o as De,a as Be,b as tt,d as ot,c as z,e as n,f as l,h as e,i as R,n as Y,u as $e,t as m,j as I,F as ve,k as he,w as ue,l as W,v as _e,m as ye,p as be,q as Pe,s as qe,T as Ke,x as we,y as Ce,z as Ae,A as ge,B as Xe,C as Fe,D as Re,E as Ge,G as Ye,H as lt,I as nt,J as st,K as je,L as at,M as it}from"./vendor-DGiFqQ_g.js";(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))k(h);new MutationObserver(h=>{for(const s of h)if(s.type==="childList")for(const u of s.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&k(u)}).observe(document,{childList:!0,subtree:!0});function r(h){const s={};return h.integrity&&(s.integrity=h.integrity),h.referrerPolicy&&(s.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?s.credentials="include":h.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function k(h){if(h.ep)return;h.ep=!0;const s=r(h);fetch(h.href,s)}})();let Je=!1;function Ve(){const o=We(),c=o==null?void 0:o.appContext.config.globalProperties.$toast;return c||(Je||(console.warn("Toast notification system not yet initialized - using console fallback"),Je=!0),{success:r=>console.log("✓",r),error:r=>console.error("✗",r),warning:r=>console.warn("⚠",r),info:r=>console.info("ℹ",r)})}function He(){const o=y(!1),c=y(!1),r=y(!1),k=y(0),h=767,s=768,u=1023,f=1024,S=()=>{const C=window.innerWidth;k.value=C,o.value=C<=h,c.value=C>=s&&C<=u,r.value=C>=f};return De(()=>{S(),window.addEventListener("resize",S)}),Be(()=>{window.removeEventListener("resize",S)}),{isMobile:o,isTablet:c,isDesktop:r,screenWidth:k,isMobileOrTablet:()=>o.value||c.value,isTabletOrDesktop:()=>c.value||r.value}}const ze="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAHBUlEQVR4nOxZC1BTVxo+9+aNZI2LNsgjWR4hgoIiRVDBslKnIKPbx1jqTrtYoakat1a6dNsdd7t1X8XHyAbEhdUu1u2mXdbasqJbtsaMIqBBECiPBmqEICEBEx4xJLlJ7s6lw6rJDeQ2FzLM+M1kBs7/3+/83zn/Oee/51JRFAXzGbCvA/AWjwX4GvNeANWXnXffHQ4+K6/dYbHeD+IFhjRkb1wn9WPQbEQ4IF/tQlXX2p5+/8OyczY74j/VxuMG3Sh/Oz9jaQDb4CmPT1LIbLXBfzrz0cmHg8fQpx1Yc1Ra+TsiXD4R0PqtRmAyj/LxbJeaujKIcPlEAINOM7vLXBaTZibCRWgRq3WGJZWX63aoNDpB8BJOX/bGlIqwpUv6iXBgWBHG7eUF8urUWvU6Z9sLGxI/IsLl8SJu6u4XigqPXkVspiVTbTQqU1/6Vn7ammh+G5FOMZyqludIKqUVU/9jcaSuTCo/unfHbiad4iBdwMu/P1bV1tO1xbk9NDC0/vwHB1xGcjqYLAh16zsHW3R6XXTu1mfFdAqMrIoSKNbGhLcQ4QGeppDJ7ACtPcqNEI6tT9O3Vqm+tygqNMDjrU9Sef6tIYM2JjUuuXzfC5knCEXsBI8WMZUCAxiCrfhWyMZkMNzYXNHVpwmXXqp5j0Hz0/1m57a3PQ8VHx4JoNMASIl9shLPFsB5ooO7iDXhCY/dAcCvT/79LwC1s/K2bDnAXcQeJRqwMzzeRt/bua0gLChcDsCDNQNBkEU/qot7o6j0kzETQpuJ40ZnT6xSrUoNWhyseHVz2ikv4n4QA5FSArE5IFlTZ0r3XU1MWODib6NCl3a9dkhSYxgbjo4XLq8sL9j7Ip36YEwMRjMNQazMhf7+RgYNnuyo7bY6ArFaWKuXRX495wLwoLk39sO9RaVnM5OTP8zLSjtjsljpp6ovi6pqr706eE8XBwGUSqEy9Guihf/92TMZhetjI5rJCHwKpBRzZqsNYtKp6KD+Pvv1w5ILdzR3UvD8HA4YefOl7N25JKUPIKuUwIJH7A5of/GJf7oLfrIz2EH786fSss+uKFzOk+8L0mqh6rpbmR0q5YyFGAQBSuHHlcUWxEaZyXfMhFD0Rgt9Oh/SBMiam58HAO+oc4XZMsK/1taT6M6uHjJw8w6VSNfvemM8TbzPlFlwsP5KyzfJeL6kCejXDgo894aASqOZ9O/uHwzq6B3ijhitkzOC7XS7j0g+V3S0vQTDDhYEoZSBobvJ+yXFNZ29gy4lOGmvlDBMIfQqSKV8539EWvXHhvbGHBSFrAwGW+vvxzLoR7RxzrNpsyPs0xcv7/lg1/ZfPtKvuw7MVhulUakWdvRq+XY3tWFT90Bk+52BCOzvyOBgjytSFKAgms+b9F/2o+BbKwUrvgjhhjSjKLAPG4YE7lJxfEIf5dyGOwMXrren/eF0RYXRNMrHDt4QbmjDEbHop9F8rqpddZd3sV6R/aWiabtWr41PW534V8m+PFHW+qSPL9TX7oM8WAaBi4IbE4S8yYNs/7asIgBA0ZStRqFM/MXxIzcgHBEBP+C6DJKLgJvK3uXvniitBsDmNzkSEAD9uv5k0aFjXy1gMQ0DQ5p4CAIwNuXLwyL/ExcpqMWeS42NUmxKXFf8VWPdz6cLnkqhGd/Pe+U1Cow/+ekJUYr4qJgvbik7f/Jw+0J/tjpvS3qxs7/LQZZfcrrkUmOdGI/cgUKIkB8pz0xK+CQjKf6z4MWckYftZqsderfsTInsZt0evDRgMRYMHhaLnk+NW1Y/nchxk5lZ+I/Pf/vl9RvbLYiVlSBcJv/VK9sKBCHc3hkF7D12/NzVltZn8YhzNj/3ev6LGeXTdQ6+uzLZ+C+5XNza05Nsd1gXcNgBvekJK/+du3lTUSiXMzzT80TgkkK8wJAGgCMAE5ooFFz3hHTr+lgZ9iMryOngkoi5WZuOc9hPtDu3r4198nTqygjCr3wYmrvVkSerZXljJoT0m0DcYm5g2Mg5WV39zrVWZZofkzaRnhB/bufm9FI/JpXQXj8F8bHyitqWxhzJmwUJT60SNJER+P+BCZjt34lzNbvickRoWVWNmGzuObnYWhER3oAdX41dPbj1jDeYEwGrInltKKCNtatub6hRfJOEnfJkcc+JgE9ltS/DkINuNI3xCo4fbXgm/0CnouvOcjK4Z/16/ZKia+3+kqIrEIQ+sgNx2Jzb5wsPxrD9GBZv+Gd9BqSXr4icg8cwMj4SLmv6+mlv+WddgGlilOPOZkEmFnrLP+sCVgtXyPHaHShkiw0XXPWWf9YF5Gb9uGzp4sCbj7ai4LkNTx2O5nPV3vLPyTeye6P32X+7KNujVKtSYJg+viEu/mx2etJZCgnD57OPfGRh3n8nfizA15j3Av4XAAD//5k1S2w3zfwVAAAAAElFTkSuQmCC",ne=tt.create({baseURL:"./",timeout:3e4,headers:{"Content-Type":"application/json"}});ne.interceptors.request.use(o=>o,o=>Promise.reject(o));ne.interceptors.response.use(o=>o,o=>(console.error("API Error:",o),o.response?console.error("Response error:",o.response.data):o.request?console.error("No response received"):console.error("Request setup error:",o.message),Promise.reject(o)));const rt=ot("devices",{state:()=>({devices:[],loading:!1,error:null,selectedDevice:null}),getters:{deviceById:o=>c=>o.devices.find(r=>r.id===c),devicesByType:o=>c=>o.devices.filter(r=>r.entity_type===c),deviceCount:o=>o.devices.length,hasDevices:o=>o.devices.length>0},actions:{async loadDevices(o=!1){this.loading=!0,this.error=null;try{const c=o?`/api/devices/managed?_t=${Date.now()}`:"/api/devices/managed",r=await ne.get(c);this.devices=r.data.devices||[],console.log("📥 Loaded devices:",this.devices),this.devices.forEach(k=>{console.log(`📥 Device "${k.name}":`,{id:k.id,device:k.device,commands:k.commands,commandCount:k.commands?Object.keys(k.commands).length:0})})}catch(c){this.error=c.message,console.error("Error loading devices:",c)}finally{this.loading=!1}},async createDevice(o){this.loading=!0,this.error=null;try{console.log("🏪 Store: Creating device with data:",o),console.log("🏪 Store: Device commands being sent:",o.commands);const c={device_name:o.name,device:o.device,area_id:o.area||"",area_name:o.area||"",entity_type:o.entity_type,icon:o.icon,broadlink_entity:o.broadlink_entity,device_type:o.device_type||"broadlink",commands:o.commands||{}};o.device_type==="smartir"&&o.smartir_config&&(c.smartir_config=o.smartir_config),console.log("🏪 Store: Transformed data for backend:",c);const r=await ne.post("/api/devices/managed",c);return console.log("🏪 Store: Create response:",r.data),await this.loadDevices(),r.data}catch(c){throw console.error("Error creating device:",c),c}finally{this.loading=!1}},async updateDevice(o,c){this.loading=!0,this.error=null;try{const r=await ne.put(`/api/devices/managed/${o}`,c);return await this.loadDevices(),r.data}catch(r){throw console.error("Error updating device:",r),r}finally{this.loading=!1}},async deleteDevice(o,c=!1){this.loading=!0,this.error=null;try{await ne.delete(`/api/devices/managed/${o}`,{data:{delete_commands:c}}),this.devices=this.devices.filter(r=>r.id!==o)}catch(r){throw this.error=r.message,console.error("Error deleting device:",r),r}finally{this.loading=!1}},selectDevice(o){this.selectedDevice=o},clearSelection(){this.selectedDevice=null},clearError(){this.error=null},async syncAllAreas(){if(!this.devices||this.devices.length===0){console.log("⚠️ No devices to sync");return}console.log(`🔄 Syncing areas from Home Assistant for ${this.devices.length} devices...`);try{const o=await Promise.all(this.devices.map(k=>(console.log(`🔄 Syncing device: ${k.id} (${k.name})`),ne.post(`/api/devices/${k.id}/sync-area`).then(h=>h.data.success&&h.data.area?(console.log(`✅ Synced area for ${k.name}: ${h.data.area}`),{status:"synced",device:k.name}):{status:"no_area"}).catch(h=>{var s;return((s=h.response)==null?void 0:s.status)===404?(console.log(`❌ Device not found in HA: ${k.id}`),{status:"not_found"}):(console.warn(`⚠️ Failed to sync area for ${k.id}:`,h.message),{status:"error",error:h.message})})))),c=o.filter(k=>k.status==="synced").length,r=o.filter(k=>k.status==="not_found").length;await this.loadDevices(!0),c>0?console.log(`✅ Area sync complete: ${c} synced, ${r} not found in HA`):r>0&&console.log(`ℹ️ No areas synced - ${r} entities not found in HA registry (generate entities first)`)}catch(o){console.debug("Area sync error:",o)}}}});function Ze(o){const c=z(()=>o.value||o),r=z(()=>{switch(c.value){case"climate":return"mdi:air-conditioner";case"fan":return"mdi:fan";case"light":return"mdi:lightbulb";case"media_player":return"mdi:television";case"switch":return"mdi:light-switch";default:return"mdi:devices"}}),k=z(()=>`device-type-${c.value}-color`),h=z(()=>`tag-${c.value}-bg`);return{icon:r,colorClass:k,tagBgClass:h}}const dt=""+new URL("broadlink-logo-BDjImjRY.png",import.meta.url).href,ke=(o,c)=>{const r=o.__vccOpts||o;for(const[k,h]of c)r[k]=h;return r},ut={class:"device-header"},ct={class:"device-info"},mt=["title"],vt={class:"device-labels"},pt={class:"device-type"},ft=["src","alt","title"],gt={class:"device-body"},yt={class:"device-stats"},bt={class:"stat",title:"Learned command count"},ht={class:"stat",title:"HA Assigned Area"},kt={class:"device-meta"},wt={class:"device-id",title:"Device ID"},$t={key:0,class:"storage-name"},Ct={key:1,class:"broadlink-entity",title:"Controller Device"},_t={key:2,class:"controller-device"},St={class:"device-actions"},It=["disabled"],Dt=["disabled"],xt=["disabled"],Tt={key:0,class:"disabled-overlay"},Mt={__name:"DeviceCard",props:{device:{type:Object,required:!0},broadlinkDevices:{type:Array,default:()=>[]}},emits:["edit","delete","learn"],setup(o){const c=o,r=z(()=>localStorage.getItem("smartir_simulate_not_installed")==="true"),k=z(()=>c.device.device_type==="smartir"&&r.value),h=y(null),s=Ze(z(()=>c.device.entity_type)),u=z(()=>c.device.icon?c.device.icon:s.icon.value),f=a=>a&&a.startsWith("mdi:")?`mdi ${a.replace(":"," mdi-")}`:`mdi mdi-${a}`,S=z(()=>({light:"Light",fan:"Fan",switch:"Switch",media_player:"Media Player",cover:"Cover"})[c.device.entity_type]||c.device.entity_type),C=z(()=>(c.device.device_type||"broadlink")==="smartir"?"SmartIR":"Broadlink"),M=z(()=>(c.device.device_type||"broadlink")==="smartir"?ze:dt),$=z(()=>(c.device.device_type||"broadlink")==="smartir"?h.value!==null?h.value:0:Object.keys(c.device.commands||{}).length),t=a=>{if(!a)return"";const w=c.broadlinkDevices.find(v=>v.entity_id===a);return w&&w.name||a},L=z(()=>{if(!c.device.device)return!1;const a=c.device.id.includes(".")?c.device.id.split(".")[1]:c.device.id;return c.device.device!==a}),B=z(()=>{if(!c.device.broadlink_entity)return"";const a=c.broadlinkDevices.find(w=>w.entity_id===c.device.broadlink_entity);return a&&a.name||c.device.broadlink_entity}),U=a=>{if(!a||typeof a!="object")return 0;let w=0;for(const v of Object.values(a))typeof v=="string"?w++:typeof v=="object"&&(w+=U(v));return w},T=async()=>{if(!(!c.device.device_code||!c.device.entity_type))try{const a=await ne.get("/api/smartir/codes/code",{params:{entity_type:c.device.entity_type,code_id:c.device.device_code}});if(a.data.success&&a.data.code){const w=a.data.code;w.commands&&(h.value=U(w.commands))}}catch(a){console.error("Error fetching SmartIR command count:",a)}};return De(async()=>{(c.device.device_type||"broadlink")==="smartir"&&await T()}),(a,w)=>(l(),n("div",{class:Y(["device-card",{disabled:k.value}])},[e("div",ut,[e("div",{class:Y(["device-icon",$e(s).colorClass.value])},[e("i",{class:Y(f(u.value))},null,2)],2),e("div",ct,[e("h3",{title:o.device.name},m(o.device.name),9,mt),e("div",vt,[e("span",pt,m(S.value),1)])]),e("img",{src:M.value,alt:C.value,title:C.value,class:"device-source-logo"},null,8,ft)]),e("div",gt,[e("div",yt,[e("div",bt,[w[3]||(w[3]=e("i",{class:"mdi mdi-remote"},null,-1)),e("span",null,m($.value)+" command"+m($.value!==1?"s":""),1)]),e("div",ht,[w[4]||(w[4]=e("i",{class:"mdi mdi-map-marker"},null,-1)),e("span",null,m(o.device.area||"No area"),1)])]),e("div",kt,[e("span",wt,[w[5]||(w[5]=e("i",{class:"mdi mdi-identifier"},null,-1)),I(" "+m(o.device.id),1)]),L.value?(l(),n("span",$t,[w[6]||(w[6]=e("i",{class:"mdi mdi-code-tags"},null,-1)),I(" "+m(o.device.device),1)])):R("",!0),o.device.broadlink_entity?(l(),n("span",Ct,[w[7]||(w[7]=e("i",{class:"mdi mdi-access-point"},null,-1)),I(" "+m(B.value),1)])):R("",!0),o.device.controller_device?(l(),n("span",_t,[w[8]||(w[8]=e("i",{class:"mdi mdi-access-point"},null,-1)),I(" "+m(t(o.device.controller_device)),1)])):R("",!0)])]),e("div",St,[e("button",{onClick:w[0]||(w[0]=v=>!k.value&&a.$emit("learn",o.device)),class:"icon-btn",title:"Manage Commands",disabled:k.value},[...w[9]||(w[9]=[e("i",{class:"mdi mdi-remote-tv"},null,-1)])],8,It),e("button",{onClick:w[1]||(w[1]=v=>!k.value&&a.$emit("edit",o.device)),class:"icon-btn",title:"Edit",disabled:k.value},[...w[10]||(w[10]=[e("i",{class:"mdi mdi-pencil"},null,-1)])],8,Dt),e("button",{onClick:w[2]||(w[2]=v=>!k.value&&a.$emit("delete",o.device)),class:"icon-btn danger",title:"Delete",disabled:k.value},[...w[11]||(w[11]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,xt)]),k.value?(l(),n("div",Tt,[...w[12]||(w[12]=[e("div",{class:"disabled-message"},[e("i",{class:"mdi mdi-eye-off"}),e("span",null,"SmartIR Not Installed")],-1)])])):R("",!0)],2))}},Rt=ke(Mt,[["__scopeId","data-v-7a7f5c18"]]),Lt={name:"DeviceListView",props:{devices:{type:Array,required:!0}},methods:{getDeviceCommands(o){return o.commands&&typeof o.commands=="object"?Object.keys(o.commands):[]},sendCommand(o,c){this.$emit("send-command",{device:o,command:c})},editDevice(o){this.$emit("edit-device",o)},deleteDevice(o){this.$emit("delete-device",o)}}},At={class:"device-list-view"},Ot={class:"device-table"},Et={class:"device-info"},Vt={class:"device-name"},Ut={class:"device-entity"},Pt={class:"device-area"},jt={class:"device-type"},Ft={class:"device-commands"},Nt={key:0,class:"command-list"},Bt=["onClick"],qt={key:0,class:"no-commands"},Ht={key:1,class:"smartir-info"},zt={class:"profile-code"},Jt={class:"device-actions"},Wt=["onClick"],Kt=["onClick"];function Xt(o,c,r,k,h,s){return l(),n("div",At,[e("table",Ot,[c[2]||(c[2]=e("thead",null,[e("tr",null,[e("th",null,"Device"),e("th",null,"Room/Area"),e("th",null,"Type"),e("th",null,"Commands"),e("th",null,"Actions")])],-1)),e("tbody",null,[(l(!0),n(ve,null,he(r.devices,u=>(l(),n("tr",{key:u.entity_id,class:"device-row"},[e("td",Et,[e("div",Vt,m(u.friendly_name||u.name),1),e("div",Ut,m(u.entity_id),1)]),e("td",Pt,m(u.area||"No Area"),1),e("td",jt,[e("span",{class:Y(["type-badge",u.device_type])},m(u.device_type==="smartir"?"SmartIR":"Broadlink"),3)]),e("td",Ft,[u.device_type==="broadlink"?(l(),n("div",Nt,[(l(!0),n(ve,null,he(s.getDeviceCommands(u),f=>(l(),n("button",{key:f,class:"command-btn",onClick:S=>s.sendCommand(u,f)},m(f),9,Bt))),128)),s.getDeviceCommands(u).length===0?(l(),n("span",qt," No commands ")):R("",!0)])):u.device_type==="smartir"?(l(),n("div",Ht,[e("span",zt,"Profile: "+m(u.device_code),1)])):R("",!0)]),e("td",Jt,[e("button",{class:"action-btn edit",onClick:f=>s.editDevice(u),title:"Edit"},[...c[0]||(c[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})],-1)])],8,Wt),e("button",{class:"action-btn delete",onClick:f=>s.deleteDevice(u),title:"Delete"},[...c[1]||(c[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"3 6 5 6 21 6"}),e("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})],-1)])],8,Kt)])]))),128))])])])}const Gt=ke(Lt,[["render",Xt],["__scopeId","data-v-952596a6"]]),Yt={class:"icon-picker"},Zt={class:"icon-input-wrapper"},Qt=["id","placeholder"],eo={key:0,class:"icon-preview"},to={key:0,class:"icon-dropdown"},oo={class:"icon-grid"},lo=["onMousedown","title"],no={__name:"IconPicker",props:{modelValue:{type:String,default:""},inputId:{type:String,default:"icon-input"},placeholder:{type:String,default:"e.g., mdi:television"}},emits:["update:modelValue"],setup(o,{emit:c}){const r=o,k=c,h=y(r.modelValue),s=y(!1),u=["television","speaker","radio","music","video","movie","play","pause","stop","skip-next","skip-previous","volume-high","volume-medium","volume-low","volume-off","remote","remote-tv","cast","chromecast","spotify","netflix","youtube","lightbulb","lightbulb-on","lightbulb-off","lamp","floor-lamp","ceiling-light","light-switch","led-strip","led-strip-variant","wall-sconce","chandelier","spotlight","track-light","vanity-light","desk-lamp","fan","ceiling-fan","air-conditioner","thermometer","thermostat","heat-wave","snowflake","fire","radiator","water-boiler","hvac","blinds","blinds-open","window-shutter","window-shutter-open","curtains","curtains-closed","roller-shade","roller-shade-closed","garage","garage-open","gate","door","door-open","window-open","window-closed","washing-machine","tumble-dryer","dishwasher","refrigerator","stove","microwave","oven","toaster","kettle","coffee","coffee-maker","blender","robot-vacuum","robot-vacuum-variant","vacuum","broom","spray-bottle","lock","lock-open","lock-smart","key","shield","shield-check","alarm-light","bell","doorbell","camera","cctv","motion-sensor","smoke-detector","fire-extinguisher","water-alert","gas-cylinder","sofa","bed","bed-double","desk","chair","table","bookshelf","home","home-outline","home-assistant","floor-plan","room","weather-sunny","weather-night","weather-cloudy","weather-rainy","weather-snowy","weather-lightning","weather-windy","weather-fog","weather-partly-cloudy","umbrella","water","water-percent","phone","cellphone","tablet","laptop","desktop-tower","monitor","keyboard","mouse","printer","router","router-wireless","access-point","wifi","bluetooth","usb","hdmi-port","ethernet","power","power-plug","power-socket","battery","battery-charging","lightning-bolt","flash","solar-panel","solar-power","leaf","tree","flower","sprout","grass","watering-can","shovel","fence","pool","hot-tub","silverware","silverware-fork-knife","food","food-apple","glass-wine","glass-cocktail","bottle-wine","pot","pot-steam","shower","shower-head","bathtub","toilet","sink","faucet","hand-wash","car","car-side","garage-variant","tools","hammer","wrench","screwdriver","toolbox","ladder","heart","heart-pulse","run","walk","bike","dumbbell","yoga","scale-bathroom","thermometer-lines","clock","clock-outline","timer","alarm","calendar","calendar-today","calendar-clock","history","bell-ring","bell-alert","alert","alert-circle","information","help-circle","check","check-circle","close-circle","minus-circle","plus-circle","arrow-up","arrow-down","arrow-left","arrow-right","chevron-up","chevron-down","menu","dots-vertical","dots-horizontal","cog","tune","circle","square","triangle","hexagon","star","star-outline","heart-outline","plus","minus","close","check-bold","eye","eye-off","account","account-group","baby","dog","cat","paw","gift","balloon","party-popper","candle","book","book-open","newspaper","email","message","phone-classic"];ue(()=>r.modelValue,$=>{h.value=$});const f=z(()=>{if(!h.value)return u.slice(0,50);const $=h.value.toLowerCase().replace("mdi:","");return u.filter(t=>t.toLowerCase().includes($)).slice(0,50)}),S=()=>{s.value=!0,k("update:modelValue",h.value)},C=()=>{setTimeout(()=>{s.value=!1},200)},M=$=>{h.value=`mdi:${$}`,k("update:modelValue",h.value),s.value=!1};return($,t)=>(l(),n("div",Yt,[e("div",Zt,[W(e("input",{id:o.inputId,"onUpdate:modelValue":t[0]||(t[0]=L=>h.value=L),type:"text",placeholder:o.placeholder,onInput:S,onFocus:t[1]||(t[1]=L=>s.value=!0),onBlur:C},null,40,Qt),[[_e,h.value]]),h.value?(l(),n("div",eo,[e("i",{class:Y(`mdi mdi-${h.value.replace("mdi:","")}`)},null,2)])):R("",!0)]),s.value&&f.value.length>0?(l(),n("div",to,[e("div",oo,[(l(!0),n(ve,null,he(f.value,L=>(l(),n("div",{key:L,class:"icon-option",onMousedown:ye(B=>M(L),["prevent"]),title:L},[e("i",{class:Y(`mdi mdi-${L}`)},null,2),e("span",null,m(L),1)],40,lo))),128))])])):R("",!0)]))}},so=ke(no,[["__scopeId","data-v-a64f5011"]]),ao={key:0,class:"dropdown-label"},io={key:0,class:"required"},ro=["placeholder","disabled","onKeydown"],uo={class:"dropdown-icons"},co={key:0,class:"mdi mdi-loading mdi-spin"},mo={key:2,class:"mdi mdi-chevron-down"},vo={key:1,class:"error-message"},po={key:2,class:"hint-message"},fo={key:0,class:"dropdown-menu"},go=["onMousedown","onMouseenter"],yo={class:"option-content"},bo={class:"option-label"},ho={key:0,class:"option-description"},ko={key:0,class:"mdi mdi-check selected-icon"},wo={key:3,class:"dropdown-menu"},$o={__name:"SearchableDropdown",props:{modelValue:{type:[String,Number,Object],default:null},options:{type:Array,required:!0,default:()=>[]},label:{type:String,default:""},placeholder:{type:String,default:"Search..."},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},error:{type:String,default:""},hint:{type:String,default:""},optionLabel:{type:String,default:"label"},optionValue:{type:String,default:"value"},optionDescription:{type:String,default:"description"},filterMethod:{type:Function,default:null}},emits:["update:modelValue","change","search"],setup(o,{emit:c}){const r=o,k=c,h=y(null),s=y(null),u=y(""),f=y(!1),S=y(0),C=y(!1),M=E=>typeof E=="string"||typeof E=="number"?E:E[r.optionLabel]||E.label||E.name||String(E),$=E=>typeof E=="string"||typeof E=="number"?E:E[r.optionValue]||E.value||E.id||E,t=E=>typeof E=="string"||typeof E=="number"?"":E[r.optionDescription]||E.description||"",L=E=>{const j=$(E);return typeof r.modelValue=="object"?$(r.modelValue)===j:r.modelValue===j},B=z(()=>{if(!u.value)return r.options;if(r.filterMethod)return r.options.filter(j=>r.filterMethod(j,u.value));const E=u.value.toLowerCase();return r.options.filter(j=>{const te=M(j).toLowerCase(),me=t(j).toLowerCase();return te.includes(E)||me.includes(E)})}),U=z(()=>{if(!r.modelValue)return"";const E=r.options.find(j=>{const te=$(j);return typeof r.modelValue=="object"?te===$(r.modelValue):te===r.modelValue});return E?M(E):""});ue(()=>r.modelValue,E=>{C.value||(u.value=U.value)}),ue(()=>r.options,()=>{!C.value&&r.modelValue&&(u.value=U.value)},{deep:!0}),ue(u,E=>{k("search",E),S.value=0}),De(()=>{u.value=U.value});const T=()=>{var E;C.value=!0,f.value=!0,(E=s.value)==null||E.select()},a=()=>{C.value=!1,setTimeout(()=>{f.value=!1,r.modelValue?u.value=U.value:u.value=""},200)},w=()=>{var E;f.value=!1,(E=s.value)==null||E.blur()},v=E=>{const j=$(E);k("update:modelValue",j),k("change",j,E),u.value=M(E),w()},D=()=>{var E;k("update:modelValue",null),k("change",null,null),u.value="",(E=s.value)==null||E.focus()},X=()=>{if(!f.value){f.value=!0;return}S.value<B.value.length-1&&S.value++},Z=()=>{S.value>0&&S.value--},oe=()=>{B.value.length>0&&S.value>=0&&v(B.value[S.value])},de=E=>{h.value&&!h.value.contains(E.target)&&(f.value=!1,r.modelValue?u.value=U.value:u.value="")};return De(()=>{document.addEventListener("click",de)}),Be(()=>{document.removeEventListener("click",de)}),(E,j)=>(l(),n("div",{class:"searchable-dropdown",ref_key:"dropdownRef",ref:h},[o.label?(l(),n("label",ao,[I(m(o.label)+" ",1),o.required?(l(),n("span",io,"*")):R("",!0)])):R("",!0),e("div",{class:Y(["dropdown-input-wrapper",{"has-error":o.error,disabled:o.disabled}])},[W(e("input",{ref_key:"inputRef",ref:s,type:"text","onUpdate:modelValue":j[0]||(j[0]=te=>u.value=te),placeholder:o.placeholder,disabled:o.disabled||o.loading,onFocus:T,onBlur:a,onKeydown:[Pe(ye(X,["prevent"]),["down"]),Pe(ye(Z,["prevent"]),["up"]),Pe(ye(oe,["prevent"]),["enter"]),Pe(w,["escape"])],class:"dropdown-input"},null,40,ro),[[_e,u.value]]),e("div",uo,[o.loading?(l(),n("i",co)):o.modelValue&&!o.disabled?(l(),n("i",{key:1,class:"mdi mdi-close-circle clear-icon",onClick:D})):(l(),n("i",mo))])],2),o.error?(l(),n("div",vo,m(o.error),1)):R("",!0),o.hint&&!o.error?(l(),n("div",po,m(o.hint),1)):R("",!0),be(Ke,{name:"dropdown"},{default:qe(()=>[f.value&&B.value.length>0?(l(),n("div",fo,[(l(!0),n(ve,null,he(B.value,(te,me)=>(l(),n("div",{key:$(te),class:Y(["dropdown-item",{highlighted:me===S.value,selected:L(te)}]),onMousedown:ye(pe=>v(te),["prevent"]),onMouseenter:pe=>S.value=me},[e("div",yo,[e("div",bo,m(M(te)),1),t(te)?(l(),n("div",ho,m(t(te)),1)):R("",!0)]),L(te)?(l(),n("i",ko)):R("",!0)],42,go))),128))])):R("",!0)]),_:1}),f.value&&B.value.length===0&&!o.loading?(l(),n("div",wo,[...j[1]||(j[1]=[e("div",{class:"dropdown-item no-results"},[e("i",{class:"mdi mdi-magnify"}),I(" No results found ")],-1)])])):R("",!0)],512))}},Ne=ke($o,[["__scopeId","data-v-679ce35f"]]),Co={class:"smartir-selector"},_o={class:"form-group"},So={class:"form-group"},Io={class:"form-group"},Do=["value"],xo={key:0,class:"error-message"},To={class:"form-group"},Mo={class:"form-group"},Ro={key:1,class:"code-info"},Lo={class:"info-content"},Ao={class:"info-row"},Oo={class:"info-value"},Eo={class:"info-row"},Vo={class:"info-value"},Uo={key:0,class:"info-row"},Po={class:"info-value"},jo={class:"info-row"},Fo={class:"info-value"},No={__name:"SmartIRDeviceSelector",props:{entityType:{type:String,required:!0},modelValue:{type:Object,default:()=>({})},broadlinkDevices:{type:Array,default:()=>[]}},emits:["update:modelValue","change"],setup(o,{expose:c,emit:r}){const k=o,h=r,s=y([]),u=y([]),f=y(""),S=y(""),C=y(""),M=y(""),$=y(""),t=y(null),L=y(!1),B=y(!1),U=y({manufacturer:"",model:"",controller:""});De(async()=>{if(await T(),k.modelValue&&(f.value=k.modelValue.manufacturer||"",S.value=k.modelValue.device_code||"",C.value=k.modelValue.controller_device||"",M.value=k.modelValue.temperature_sensor||"",$.value=k.modelValue.humidity_sensor||"",f.value&&(await a(f.value),S.value&&u.value.length>0))){const E=u.value.find(j=>j.code===S.value);E&&(t.value={code:E.code,manufacturer:f.value,models:E.models,controller:E.controller})}}),ue(()=>k.entityType,async E=>{E&&(f.value="",S.value="",u.value=[],t.value=null,await T())});const T=async()=>{if(k.entityType){L.value=!0,U.value.manufacturer="";try{const E=await ne.get("/api/smartir/codes/manufacturers",{params:{entity_type:k.entityType}});if(E.data.success)s.value=E.data.manufacturers||[];else throw new Error(E.data.error||"Failed to load manufacturers")}catch(E){console.error("Error loading manufacturers:",E),U.value.manufacturer="Failed to load manufacturers. Please try again.",s.value=[]}finally{L.value=!1}}},a=async E=>{if(!(!E||!k.entityType)){B.value=!0,U.value.model="";try{const j=await ne.get("/api/smartir/codes/models",{params:{entity_type:k.entityType,manufacturer:E}});if(j.data.success){const te=j.data.models||[];u.value=te.map(me=>{const pe=me.models&&me.models.length>0?me.models.join(", "):`Code ${me.code}`;return{code:me.code,label:pe,description:`Code: ${me.code}`,models:me.models,controller:me.controller}})}else throw new Error(j.data.error||"Failed to load models")}catch(j){console.error("Error loading models:",j),U.value.model="Failed to load models. Please try again.",u.value=[]}finally{B.value=!1}}},w=async E=>{f.value=E,S.value="",t.value=null,u.value=[],E&&await a(E),oe()},v=()=>{const E=u.value.find(j=>j.code===S.value);E&&(t.value={code:E.code,manufacturer:f.value,models:E.models,controller:E.controller}),oe()},D=()=>{oe()},X=()=>{oe()},Z=()=>{oe()},oe=()=>{var j,te;const E={manufacturer:f.value,model:((te=(j=t.value)==null?void 0:j.models)==null?void 0:te[0])||"",device_code:S.value,controller_device:C.value};k.entityType==="climate"&&(M.value&&(E.temperature_sensor=M.value),$.value&&(E.humidity_sensor=$.value)),h("update:modelValue",E),h("change",E)};return c({validate:()=>{let E=!0;return U.value={manufacturer:"",model:"",controller:""},f.value||(U.value.manufacturer="Manufacturer is required",E=!1),S.value||(U.value.model="Model is required",E=!1),C.value||(U.value.controller="Broadlink controller is required",E=!1),E}}),(E,j)=>(l(),n("div",Co,[e("div",_o,[be(Ne,{modelValue:f.value,"onUpdate:modelValue":j[0]||(j[0]=te=>f.value=te),options:s.value,label:"Manufacturer",placeholder:"Search manufacturers...",required:"",loading:L.value,error:U.value.manufacturer,hint:"Select the device manufacturer",onChange:w},null,8,["modelValue","options","loading","error"])]),e("div",So,[be(Ne,{modelValue:S.value,"onUpdate:modelValue":j[1]||(j[1]=te=>S.value=te),options:u.value,"option-label":"label","option-value":"code","option-description":"description",label:"Model",placeholder:"Search models...",required:"",disabled:!f.value,loading:B.value,error:U.value.model,hint:"Select the device model",onChange:v},null,8,["modelValue","options","disabled","loading","error"])]),e("div",Io,[j[6]||(j[6]=e("label",{for:"controller-device"},[e("i",{class:"mdi mdi-remote"}),I(" Controller Device * ")],-1)),W(e("select",{id:"controller-device","onUpdate:modelValue":j[2]||(j[2]=te=>C.value=te),required:"",onChange:D},[j[5]||(j[5]=e("option",{value:""},"-- Select Controller Device --",-1)),(l(!0),n(ve,null,he(o.broadlinkDevices,te=>(l(),n("option",{key:te.entity_id,value:te.entity_id},[I(m(te.name||te.entity_id)+" ",1),te.area_name?(l(),n(ve,{key:0},[I(" - "+m(te.area_name),1)],64)):R("",!0)],8,Do))),128))],544),[[we,C.value]]),j[7]||(j[7]=e("small",null,"Which remote device will send the IR/RF commands",-1)),U.value.controller?(l(),n("div",xo,m(U.value.controller),1)):R("",!0)]),o.entityType==="climate"?(l(),n(ve,{key:0},[e("div",To,[j[8]||(j[8]=e("label",{for:"temperature-sensor"},"Temperature Sensor",-1)),W(e("input",{id:"temperature-sensor","onUpdate:modelValue":j[3]||(j[3]=te=>M.value=te),type:"text",placeholder:"e.g., sensor.living_room_temperature",onInput:X},null,544),[[_e,M.value]]),j[9]||(j[9]=e("small",null,"Optional: Temperature sensor entity for current temperature",-1))]),e("div",Mo,[j[10]||(j[10]=e("label",{for:"humidity-sensor"},"Humidity Sensor",-1)),W(e("input",{id:"humidity-sensor","onUpdate:modelValue":j[4]||(j[4]=te=>$.value=te),type:"text",placeholder:"e.g., sensor.living_room_humidity",onInput:Z},null,544),[[_e,$.value]]),j[11]||(j[11]=e("small",null,"Optional: Humidity sensor entity for current humidity",-1))])],64)):R("",!0),t.value?(l(),n("div",Ro,[j[16]||(j[16]=e("div",{class:"info-header"},[e("i",{class:"mdi mdi-information"}),e("span",null,"Selected Device Code")],-1)),e("div",Lo,[e("div",Ao,[j[12]||(j[12]=e("span",{class:"info-label"},"Code ID:",-1)),e("span",Oo,m(t.value.code_id),1)]),e("div",Eo,[j[13]||(j[13]=e("span",{class:"info-label"},"Manufacturer:",-1)),e("span",Vo,m(t.value.manufacturer),1)]),t.value.models&&t.value.models.length>0?(l(),n("div",Uo,[j[14]||(j[14]=e("span",{class:"info-label"},"Supported Models:",-1)),e("span",Po,m(t.value.models.join(", ")),1)])):R("",!0),e("div",jo,[j[15]||(j[15]=e("span",{class:"info-label"},"Controller:",-1)),e("span",Fo,m(t.value.controller||"Broadlink"),1)])])])):R("",!0)]))}},Bo=ke(No,[["__scopeId","data-v-1911c8f6"]]),qo={class:"modal-content"},Ho={class:"modal-header"},zo={class:"input-wrapper"},Jo={key:0,class:"validation-tooltip"},Wo={class:"input-wrapper"},Ko=["disabled"],Xo={key:0,class:"validation-tooltip"},Go={key:0,class:"smartir-notice"},Yo={key:0,class:"notice-success"},Zo={key:1,class:"notice-warning"},Qo={key:1,class:"smartir-notice"},el={key:2},tl={class:"form-group"},ol=["disabled"],ll=["disabled"],nl={key:0},sl={key:1},al={key:2},il={key:3},rl={key:0,class:"form-group"},dl={class:"area-display-readonly"},ul=["value"],cl=["disabled"],ml=["href"],vl={key:1,class:"form-group"},pl={class:"form-group"},fl={class:"input-wrapper"},gl=["value"],yl=["value"],bl={key:2,class:"validation-tooltip"},hl={key:0},kl={key:1},wl={key:3,class:"smartir-section"},$l={class:"modal-footer"},Cl={type:"submit",form:"device-form",class:"btn btn-primary"},_l={__name:"DeviceForm",props:{device:{type:Object,default:null}},emits:["save","cancel"],setup(o,{emit:c}){const r=o,k=c,h=Ce("smartirStatus"),s=Ce("smartirEnabled"),u=z(()=>{var d;return localStorage.getItem("smartir_simulate_not_installed")==="true"?!1:((d=h==null?void 0:h.value)==null?void 0:d.installed)||!1}),f=z(()=>!!r.device),S=z(()=>["climate","media_player","fan","light"].includes(t.value.entity_type)),C=z(()=>u.value?!S.value&&t.value.entity_type?"(Not supported for this type)":"(Pre-configured Codes)":"(Requires SmartIR)"),M=z(()=>{var d;const x=((d=r.device)==null?void 0:d.commands)||{};return Object.keys(x).length>0}),$=z(()=>{if(!t.value.broadlink_entity)return"";const x=a.value.find(d=>d.entity_id===t.value.broadlink_entity);return x&&x.name||t.value.broadlink_entity}),t=y({name:"",entity_type:"",device_type:"broadlink",device:"",area:"",icon:"",broadlink_entity:"",enabled:!0,commands:{}}),L=y({name:"",entity_type:"",broadlink_entity:""}),B=y({}),U=y(null),T=y([]),a=y([]),w=y(null),v=y(null),D=y(null),X=y(!1);De(async()=>{r.device&&(t.value={...r.device,device_type:r.device.device_type||"broadlink"},t.value.device_type==="smartir"&&(B.value={manufacturer:r.device.manufacturer,model:r.device.model,device_code:r.device.device_code,controller_device:r.device.controller_device,temperature_sensor:r.device.temperature_sensor,humidity_sensor:r.device.humidity_sensor})),await Promise.all([Z(),oe()])});const Z=async()=>{try{const x=await ne.get("/api/areas");T.value=x.data.areas||[]}catch(x){console.error("Error loading areas:",x),T.value=[]}},oe=async()=>{try{const d=(await ne.get("/api/remote/devices")).data.devices||[];a.value=d,console.log("Loaded remote devices:",d)}catch(x){console.error("Error loading remote devices:",x),a.value=[]}},de=x=>{if(!x)return"";const d=x.toLowerCase();for(const V of T.value){const fe=V.toLowerCase();if(d.includes(fe))return V}return""},E=(x,d="")=>{const V=d.toLowerCase();return V.includes("tv")?"mdi:television":V.includes("lamp")?"mdi:lamp":V.includes("ceiling")?"mdi:ceiling-light":V.includes("floor")?"mdi:floor-lamp":V.includes("desk")?"mdi:desk-lamp":V.includes("fan")?"mdi:fan":V.includes("ac")||V.includes("air con")?"mdi:air-conditioner":V.includes("heater")?"mdi:radiator":V.includes("blind")?"mdi:blinds":V.includes("curtain")?"mdi:curtains":V.includes("garage")?"mdi:garage":V.includes("speaker")||V.includes("stereo")?"mdi:speaker":V.includes("receiver")?"mdi:audio-video":{light:"mdi:lightbulb",fan:"mdi:fan",switch:"mdi:light-switch",media_player:"mdi:television",cover:"mdi:window-shutter",climate:"mdi:thermostat"}[x]||"mdi:devices"};ue(()=>t.value.name,x=>{if(!f.value&&x&&!t.value.area){const d=de(x);d&&(t.value.area=d)}!f.value&&x&&t.value.entity_type&&(X.value||!t.value.icon)&&(t.value.icon=E(t.value.entity_type,x),X.value=!0)}),ue(()=>t.value.entity_type,x=>{!f.value&&x&&(X.value||!t.value.icon)&&(t.value.icon=E(x,t.value.name),X.value=!0)}),ue(()=>t.value.icon,(x,d)=>{d!==void 0&&x!==d&&!X.value&&(X.value=!1),x||(X.value=!1)});const j=y(!1),te=async()=>{var x;if((x=r.device)!=null&&x.id){j.value=!0;try{const d=await ne.post(`/api/devices/${r.device.id}/sync-area`);d.data.success?(t.value.area=d.data.area||"",d.data.area?console.log(`Area synced: ${d.data.area}`):console.log("No area assigned in Home Assistant")):console.warn(d.data.message||"Entity not found in HA")}catch(d){console.error("Failed to sync area:",d)}finally{j.value=!1}}},me=()=>{var V;return!((V=r.device)!=null&&V.id)||!t.value.entity_type?"#":`/config/entities/entity/${`${t.value.entity_type}.${r.device.id}`}`},pe=()=>{L.value={name:"",entity_type:"",broadlink_entity:""};let x=!0;return(!t.value.name||t.value.name.trim()==="")&&(L.value.name="Device name is required",x=!1),t.value.entity_type||(L.value.entity_type="Entity type is required",x=!1),t.value.device_type==="broadlink"&&!t.value.broadlink_entity&&(L.value.broadlink_entity="Broadlink device is required",x=!1),x},Se=x=>{L.value[x]=""},Ie=async()=>{if(t.value.device_type==="smartir"){if(U.value&&!U.value.validate())return;const x={...t.value,smartir_config:{manufacturer:B.value.manufacturer,model:B.value.model,code_id:B.value.device_code,controller_device:B.value.controller_device}};k("save",x)}else{if(!pe())return;k("save",{...t.value})}},xe=x=>{B.value=x};return(x,d)=>(l(),n("div",{class:"modal-overlay",onClick:d[11]||(d[11]=ye(V=>x.$emit("cancel"),["self"]))},[e("div",qo,[e("div",Ho,[e("h2",null,m(f.value?"Edit Device":"Add New Device"),1),e("button",{onClick:d[0]||(d[0]=V=>x.$emit("cancel")),class:"close-btn"},[...d[12]||(d[12]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("form",{id:"device-form",onSubmit:ye(Ie,["prevent"]),class:"modal-body"},[e("div",{class:Y(["form-group",{"has-error":L.value.name}])},[d[14]||(d[14]=e("label",{for:"device-name"},"Device Name *",-1)),e("div",zo,[W(e("input",{id:"device-name",ref_key:"nameInput",ref:w,"onUpdate:modelValue":d[1]||(d[1]=V=>t.value.name=V),type:"text",placeholder:"e.g., Living Room TV",onInput:d[2]||(d[2]=V=>Se("name"))},null,544),[[_e,t.value.name]]),L.value.name?(l(),n("div",Jo,[d[13]||(d[13]=e("i",{class:"mdi mdi-alert"},null,-1)),I(" "+m(L.value.name),1)])):R("",!0)]),d[15]||(d[15]=e("small",null,"Friendly name for this device",-1))],2),e("div",{class:Y(["form-group",{"has-error":L.value.entity_type}])},[d[23]||(d[23]=e("label",{for:"entity-type"},"Entity Type *",-1)),e("div",Wo,[W(e("select",{id:"entity-type",ref_key:"typeSelect",ref:v,"onUpdate:modelValue":d[3]||(d[3]=V=>t.value.entity_type=V),onChange:d[4]||(d[4]=V=>Se("entity_type"))},[d[16]||(d[16]=Ae('<option value="" data-v-94bc1fe5>-- Select Type --</option><option value="light" data-v-94bc1fe5>💡 Light</option><option value="fan" data-v-94bc1fe5>🌀 Fan</option><option value="switch" data-v-94bc1fe5>🔌 Switch</option><option value="media_player" data-v-94bc1fe5>📺 Media Player</option><option value="cover" data-v-94bc1fe5>🪟 Cover (Blinds/Curtains)</option>',6)),e("option",{value:"climate",disabled:!u.value}," 🌡️ Climate "+m(u.value?"":"(Requires SmartIR)"),9,Ko)],544),[[we,t.value.entity_type]]),L.value.entity_type?(l(),n("div",Xo,[d[17]||(d[17]=e("i",{class:"mdi mdi-alert"},null,-1)),I(" "+m(L.value.entity_type),1)])):R("",!0)]),t.value.entity_type==="climate"?(l(),n("div",Go,[u.value?(l(),n("div",Yo,[...d[18]||(d[18]=[e("i",{class:"mdi mdi-check-circle"},null,-1),e("span",null,"SmartIR detected! Climate entities will be created via SmartIR profiles.",-1)])])):(l(),n("div",Zo,[...d[19]||(d[19]=[e("i",{class:"mdi mdi-alert"},null,-1),e("div",null,[e("strong",null,"SmartIR Required"),e("p",null,"Climate entities (AC, heaters) require SmartIR integration."),e("a",{href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"smartir-link"}," Install SmartIR → ")],-1)])]))])):u.value&&["media_player","fan","light"].includes(t.value.entity_type)?(l(),n("div",Qo,[...d[20]||(d[20]=[e("div",{class:"notice-info"},[e("i",{class:"mdi mdi-information"}),e("span",null,"💡 SmartIR available! You can use pre-configured codes or learn your own.")],-1)])])):!u.value&&t.value.entity_type?(l(),n("small",el,[d[21]||(d[21]=I(" 💡 Tip: Install ",-1)),d[22]||(d[22]=e("a",{href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"inline-link"},"SmartIR",-1)),I(" for pre-configured "+m(t.value.entity_type==="climate"?"climate":t.value.entity_type)+" device codes ",1)])):R("",!0)],2),e("div",tl,[d[26]||(d[26]=e("label",{for:"device-type"},"Device Type *",-1)),W(e("select",{id:"device-type","onUpdate:modelValue":d[5]||(d[5]=V=>t.value.device_type=V),required:"",disabled:f.value},[d[24]||(d[24]=e("option",{value:""},"-- Select Device Type --",-1)),d[25]||(d[25]=e("option",{value:"broadlink"},"📡 Broadlink Device (Learn IR Codes)",-1)),$e(s)?(l(),n("option",{key:0,value:"smartir",disabled:!u.value||!S.value}," 🌐 SmartIR Device "+m(C.value),9,ll)):R("",!0)],8,ol),[[we,t.value.device_type]]),f.value?(l(),n("small",nl,"Cannot change device type after creation")):t.value.device_type==="smartir"?(l(),n("small",sl,"Using pre-configured codes from SmartIR repository")):t.value.device_type==="broadlink"?(l(),n("small",al,"Learn and store your own IR codes")):(l(),n("small",il,"Choose how to configure this device"))]),f.value?(l(),n("div",rl,[d[29]||(d[29]=e("label",{for:"device-area"},"Area",-1)),e("div",dl,[e("input",{id:"device-area",value:t.value.area||"Not assigned",type:"text",readonly:"",class:"readonly-input"},null,8,ul),e("button",{type:"button",onClick:te,disabled:j.value,class:"sync-area-btn",title:"Sync area from Home Assistant"},[e("i",{class:Y(j.value?"mdi mdi-loading mdi-spin":"mdi mdi-refresh")},null,2)],8,cl)]),e("small",null,[d[27]||(d[27]=e("i",{class:"mdi mdi-information-outline"},null,-1)),d[28]||(d[28]=I(" Set area in Home Assistant, then click sync. ",-1)),e("a",{href:me(),target:"_blank",class:"inline-link"},"Open in HA →",8,ml)])])):(l(),n("div",vl,[...d[30]||(d[30]=[e("div",{class:"info-notice"},[e("i",{class:"mdi mdi-information-outline"}),e("span",null,[e("strong",null,"Area Assignment:"),I(" After generating entities and restarting Home Assistant, you can assign areas in HA and sync them here.")])],-1)])])),e("div",pl,[d[31]||(d[31]=e("label",{for:"device-icon"},"Icon",-1)),be(so,{modelValue:t.value.icon,"onUpdate:modelValue":d[6]||(d[6]=V=>t.value.icon=V),inputId:"device-icon",placeholder:"e.g., mdi:television"},null,8,["modelValue"]),d[32]||(d[32]=e("small",null,"Optional: Material Design Icon name",-1))]),t.value.device_type==="broadlink"?(l(),n("div",{key:2,class:Y(["form-group",{"has-error":L.value.broadlink_entity}])},[d[35]||(d[35]=e("label",{for:"broadlink-entity"},"Remote Device *",-1)),e("div",fl,[!f.value||!M.value?W((l(),n("select",{key:0,id:"broadlink-entity",ref_key:"broadlinkSelect",ref:D,"onUpdate:modelValue":d[7]||(d[7]=V=>t.value.broadlink_entity=V),onChange:d[8]||(d[8]=V=>Se("broadlink_entity"))},[d[33]||(d[33]=e("option",{value:""},"-- Select Remote Device --",-1)),(l(!0),n(ve,null,he(a.value,V=>(l(),n("option",{key:V.entity_id,value:V.entity_id},[I(m(V.name||V.entity_id)+" ",1),V.area_name?(l(),n(ve,{key:0},[I(" - "+m(V.area_name),1)],64)):R("",!0)],8,gl))),128))],544)),[[we,t.value.broadlink_entity]]):(l(),n("input",{key:1,id:"broadlink-entity",value:$.value,type:"text",readonly:"",disabled:""},null,8,yl)),L.value.broadlink_entity?(l(),n("div",bl,[d[34]||(d[34]=e("i",{class:"mdi mdi-alert"},null,-1)),I(" "+m(L.value.broadlink_entity),1)])):R("",!0)]),!f.value||!M.value?(l(),n("small",hl,"Required: Select which remote device to use for sending commands")):(l(),n("small",kl,"Cannot change remote device after commands are learned"))],2)):R("",!0),t.value.device_type==="smartir"?(l(),n("div",wl,[d[36]||(d[36]=e("div",{class:"section-header"},[e("i",{class:"mdi mdi-cloud-download"}),e("span",null,"SmartIR Device Configuration")],-1)),be(Bo,{ref_key:"smartirSelector",ref:U,"entity-type":t.value.entity_type,modelValue:B.value,"onUpdate:modelValue":d[9]||(d[9]=V=>B.value=V),"broadlink-devices":a.value,onChange:xe},null,8,["entity-type","modelValue","broadlink-devices"])])):R("",!0)],32),e("div",$l,[e("button",{type:"button",onClick:d[10]||(d[10]=V=>x.$emit("cancel")),class:"btn btn-secondary"}," Cancel "),e("button",Cl,[d[37]||(d[37]=e("i",{class:"mdi mdi-check"},null,-1)),I(" "+m(f.value?"Update":"Create"),1)])])])]))}},Sl=ke(_l,[["__scopeId","data-v-94bc1fe5"]]),Il={class:"modal-header"},Dl={class:"modal-body"},xl={class:"message-text"},Tl={key:0,class:"checkbox-option"},Ml={class:"modal-footer"},Rl=["disabled"],Ll={__name:"ConfirmDialog",props:{isOpen:{type:Boolean,default:!1},title:{type:String,default:"Confirm"},message:{type:String,required:!0},confirmText:{type:String,default:"OK"},cancelText:{type:String,default:"Cancel"},showCancel:{type:Boolean,default:!0},dangerMode:{type:Boolean,default:!1},confirmDisabled:{type:Boolean,default:!1},checkboxLabel:{type:String,default:""}},emits:["confirm","cancel"],setup(o,{emit:c}){const r=o,k=c,h=y(!1);ue(()=>r.isOpen,f=>{f&&(h.value=!1)});const s=()=>{k("confirm",h.value)},u=()=>{k("cancel")};return(f,S)=>o.isOpen?(l(),n("div",{key:0,class:"modal-overlay",onClick:ye(u,["self","stop"])},[e("div",{class:"modal-dialog confirm-dialog",onClick:S[1]||(S[1]=ye(()=>{},["stop"]))},[e("div",Il,[e("h2",null,m(o.title),1)]),e("div",Dl,[e("p",xl,m(o.message),1),o.checkboxLabel?(l(),n("div",Tl,[e("label",null,[W(e("input",{type:"checkbox","onUpdate:modelValue":S[0]||(S[0]=C=>h.value=C)},null,512),[[ge,h.value]]),e("span",null,m(o.checkboxLabel),1)])])):R("",!0)]),e("div",Ml,[o.showCancel?(l(),n("button",{key:0,onClick:ye(u,["stop"]),class:"btn btn-secondary"},m(o.cancelText),1)):R("",!0),o.confirmText?(l(),n("button",{key:1,onClick:ye(s,["stop"]),class:Y(["btn",o.dangerMode?"btn-danger":"btn-primary"]),disabled:o.confirmDisabled},m(o.confirmText),11,Rl)):R("",!0)])])])):R("",!0)}},Le=ke(Ll,[["__scopeId","data-v-9cea6cb3"]]),Al={class:"modal-content"},Ol={class:"modal-header"},El={class:"modal-body"},Vl={key:0,class:"smartir-info"},Ul={key:0,class:"climate-note"},Pl={class:"form-group"},jl=["value"],Fl={class:"form-group"},Nl=["disabled"],Bl={label:"Suggested Commands"},ql=["value"],Hl=["disabled"],zl={class:"form-group"},Jl={class:"radio-group"},Wl={class:"radio-label"},Kl=["disabled"],Xl={class:"radio-label"},Gl=["disabled"],Yl={class:"learn-action"},Zl=["disabled"],Ql={key:0,class:"mdi mdi-loading mdi-spin"},en={key:1,class:"mdi mdi-remote-tv"},tn={key:0,class:"learning-status"},on={key:0},ln={key:1,class:"rf-instructions"},nn={key:1,class:"result-message success"},sn={key:2,class:"section-divider"},an={key:3,class:"learned-commands"},rn={class:"command-list"},dn={class:"command-info"},un={class:"command-name"},cn={class:"learned-status"},mn={class:"command-actions"},vn=["onClick","disabled"],pn=["onClick"],fn={key:4,class:"untracked-commands"},gn={class:"command-list"},yn={class:"command-name"},bn={class:"modal-footer"},hn=["disabled"],kn={__name:"CommandLearner",props:{device:{type:Object,required:!0}},emits:["cancel","learned"],setup(o,{emit:c}){const r=o,k=c,h=y([]),s=y(""),u=y(""),f=y(""),S=y("ir"),C=y(!1),M=y(""),$=y("success"),t=y([]),L=y([]),B=y(!1),U=y(""),T=y(!1),a=y(null),w=y(null),v=y(""),D=y(""),X=z(()=>r.device.device_type==="smartir");z(()=>{if(X.value)return!1;const K=u.value==="__custom__"?f.value:u.value;return s.value&&K.trim()});const Z=()=>{a.value&&a.value.setCustomValidity("")},oe=()=>{w.value&&w.value.setCustomValidity("")},de=z(()=>{const K=h.value.find(g=>g.entity_id===s.value);return K?K.name||K.entity_id:s.value}),E={light:["turn_on","turn_off","toggle","brightness_up","brightness_down","dim","bright"],fan:["turn_on","turn_off","toggle","speed_low","speed_medium","speed_high","speed_1","speed_2","speed_3","speed_4","speed_5","oscillate_on","oscillate_off","direction_forward","direction_reverse"],switch:["turn_on","turn_off","toggle"],media_player:["turn_on","turn_off","toggle","volume_up","volume_down","volume_mute","play","pause","stop","play_pause","next_track","previous_track","channel_up","channel_down","source_hdmi1","source_hdmi2","source_hdmi3","source_tv","source_aux","source_bluetooth","menu","home","back","select","arrow_up","arrow_down","arrow_left","arrow_right"],cover:["open","close","stop","open_tilt","close_tilt","position_0","position_25","position_50","position_75","position_100"]},j=z(()=>{const K=r.device.entity_type||"switch";return E[K]||E.switch});De(async()=>{await te();try{console.log("🔄 Syncing command types...");const g=await ne.post("/api/commands/sync");console.log("✅ Command types synced:",g.data)}catch(g){console.error("⚠️ Failed to sync command types:",g)}const K=!X.value;console.log(`📋 Will ${K?"FORCE RELOAD":"use cached"} commands`),await me(K),a.value&&(a.value.setCustomValidity(""),a.value.oninvalid=()=>{a.value.setCustomValidity("Command name is required")}),r.device.broadlink_entity&&(s.value=r.device.broadlink_entity)}),ue(u,async K=>{K==="__custom__"&&(await Xe(),w.value&&(w.value.setCustomValidity(""),w.value.oninvalid=()=>{w.value.setCustomValidity("Custom command name is required")}))});const te=async()=>{try{const K=await ne.get("/api/broadlink/devices");h.value=K.data.devices||[]}catch(K){console.error("Error loading Broadlink devices:",K)}},me=async(K=!1)=>{var g,p;try{if(X.value){const J=await ne.get("/api/smartir/codes/code",{params:{entity_type:r.device.entity_type,code_id:r.device.device_code}});if(J.data.success&&J.data.code){const le=J.data.code.commands||{},H=J.data.code.commandType||"ir";if(r.device.entity_type==="climate"){const _=[];for(const[re,G]of Object.entries(le))typeof G=="string"?_.push({name:re,type:H}):typeof G=="object"&&G!==null&&Object.keys(G).sort((O,i)=>parseInt(O)-parseInt(i)).forEach(O=>{_.push({name:`${re}_${O}`,type:H,label:`${re.charAt(0).toUpperCase()+re.slice(1)} ${O}°C`})});t.value=_}else t.value=Object.keys(le).map(_=>({name:_,type:H}))}}else{if(console.log("📋 Loading commands for device:",r.device),console.log("📋 Device ID:",r.device.id),console.log("📋 Force reload:",K),K&&r.device.id){console.log("🔄 Force reloading commands from API after sync");try{const le=(await ne.get(`/api/commands/${r.device.id}`)).data.commands||{};console.log("📦 Raw commands from API:",le),t.value=Object.entries(le).map(([H,_])=>{console.log(`  Command '${H}':`,_,`(type: ${typeof _})`);const re=typeof _=="object"&&_!==null&&(_.command_type||_.type)||"ir";return{name:H,type:re}}),console.log("📋 Reloaded commands:",t.value)}catch(J){if(console.error("❌ Error loading commands:",J),((g=J.response)==null?void 0:g.status)===404)console.log("ℹ️ No commands found for device"),t.value=[];else throw J}}else if(r.device.commands&&Object.keys(r.device.commands).length>0)console.log("✅ Using commands from device object"),t.value=Object.entries(r.device.commands).map(([J,le])=>({name:J,type:le.command_type||le.type||"ir"}));else if(r.device.commands!==void 0)console.log("ℹ️ Device has empty commands object - skipping API call"),t.value=[];else if(r.device.id){console.log("🌐 Fetching commands from API for device ID:",r.device.id);try{const le=(await ne.get(`/api/commands/${r.device.id}`)).data.commands||{};t.value=Object.entries(le).map(([H,_])=>({name:H,type:_.command_type||_.type||"ir"}))}catch(J){if(((p=J.response)==null?void 0:p.status)===404)console.log("ℹ️ No commands found for device (this is normal for new devices)"),t.value=[];else throw J}}else console.log("⚠️ No commands found and no device ID");console.log("📋 Final learned commands:",t.value)}}catch(J){console.error("Error loading commands:",J)}},pe=async()=>{var K,g;M.value="",$.value="",C.value=!0;try{let p=r.device.id.split(".")[1];r.device.device&&(p=r.device.device);const J=u.value==="__custom__"?f.value:u.value,le=await ne.post("/api/commands/learn",{entity_id:s.value,device:p,device_id:r.device.id,command:J.trim(),command_type:S.value});if(le.data.success){M.value=`Command "${J}" learned successfully!`,$.value="success",t.value.find(G=>G.name===J)||t.value.push({name:J,type:S.value});const _=L.value.indexOf(J);_>-1&&L.value.splice(_,1);const re={...r.device.commands};re[J]={command_type:S.value,type:S.value},await d(),u.value="",f.value="",k("learned",{commands:re,commandName:J})}else M.value=le.data.error||"Failed to learn command",$.value="error"}catch(p){M.value=((g=(K=p.response)==null?void 0:K.data)==null?void 0:g.error)||"Error learning command",$.value="error"}finally{C.value=!1}},Se=async K=>{var g,p;try{D.value=K,v.value="";let J=r.device.id.split(".")[1];r.device.device&&(J=r.device.device);const le=X.value?r.device.controller_device:s.value||r.device.broadlink_entity;if(!le){console.error("Missing entity_id for test command:",{isSmartIR:X.value,controller_device:r.device.controller_device,broadlink_entity:r.device.broadlink_entity,selectedBroadlink:s.value,device:r.device}),M.value="Missing Broadlink remote entity. Please select a Broadlink device.",$.value="error",D.value="";return}const H={entity_id:le,device:J,command:K,device_id:r.device.id};console.log("🧪 Testing command:",H),(await ne.post("/api/commands/test",H)).data.success&&(v.value=K,setTimeout(()=>{v.value===K&&(v.value="")},2e3))}catch(J){console.error("❌ Test command error:",J);const le=((p=(g=J.response)==null?void 0:g.data)==null?void 0:p.error)||J.message||"Unknown error";M.value=`Failed to send command: ${le}`,$.value="error"}finally{D.value=""}},Ie=K=>{U.value=K,B.value=!0},xe=()=>{B.value=!1,U.value=""},x=async()=>{const K=U.value;B.value=!1;try{console.log(`🗑️ Deleting command: ${K}`),await ne.delete(`/api/commands/${r.device.id}/${K}`),t.value=t.value.filter(g=>g.name!==K),await me(),await d(),M.value=`Command "${K}" deleted`,$.value="success",k("learned")}catch(g){console.error("❌ Delete error:",g),M.value=`Failed to delete command: ${g.message}`,$.value="error"}finally{U.value=""}},d=async()=>{try{let K=r.device.device;K||(K=r.device.id.includes(".")?r.device.id.split(".")[1]:r.device.id),console.log("🔍 Looking for untracked commands for device:",K);const p=(await ne.get("/api/commands/untracked")).data.untracked||{};console.log("📦 All untracked commands:",Object.keys(p)),console.log("📦 Untracked for this device:",p[K]),p[K]?L.value=Object.keys(p[K].commands):L.value=[]}catch(K){console.error("Error loading untracked commands:",K),L.value=[]}},V=()=>{L.value.length!==0&&(T.value=!0)},fe=async()=>{T.value=!1;try{const K=r.device.device||r.device.id.split(".")[1],g=await ne.post("/api/commands/import",{device_id:r.device.id,source_device:K,commands:L.value});g.data.success&&(M.value=`Imported ${g.data.imported_count} commands successfully!`,$.value="success",await me(),await d(),k("learned"))}catch(K){M.value=`Failed to import commands: ${K.message}`,$.value="error"}};return(K,g)=>(l(),n("div",{class:"modal-overlay",onClick:g[7]||(g[7]=ye(p=>K.$emit("cancel"),["self"]))},[e("div",Al,[e("div",Ol,[e("h2",null,m(X.value?"Commands for":"Learn Commands for")+" "+m(o.device.name),1),e("button",{onClick:g[0]||(g[0]=p=>K.$emit("cancel")),class:"close-btn"},[...g[8]||(g[8]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",El,[X.value?(l(),n("div",Vl,[g[13]||(g[13]=e("i",{class:"mdi mdi-information"},null,-1)),e("div",null,[g[12]||(g[12]=e("h3",null,"SmartIR Device",-1)),e("p",null,[g[9]||(g[9]=I("This device uses SmartIR code file ",-1)),e("strong",null,m(o.device.device_code),1),g[10]||(g[10]=I(". Commands are pre-configured and cannot be learned.",-1))]),o.device.entity_type==="climate"?(l(),n("p",Ul,[...g[11]||(g[11]=[e("i",{class:"mdi mdi-alert-circle-outline"},null,-1),e("strong",null,"Note:",-1),I(" Climate device commands are temperature-based. Testing individual modes may not work as expected. Use the Home Assistant climate card to control your device. ",-1)])])):R("",!0)])])):(l(),n("form",{key:1,onSubmit:ye(pe,["prevent"])},[e("div",Pl,[g[14]||(g[14]=e("label",{for:"broadlink-entity"},"Broadlink Device",-1)),e("input",{id:"broadlink-entity",value:de.value,type:"text",readonly:"",disabled:""},null,8,jl),g[15]||(g[15]=e("small",null,"Commands will be learned using this device (set when device was created)",-1))]),e("div",Fl,[g[18]||(g[18]=e("label",{for:"command-name"},"Command Name *",-1)),W(e("select",{id:"command-name",ref_key:"commandSelect",ref:a,"onUpdate:modelValue":g[1]||(g[1]=p=>u.value=p),disabled:C.value,required:"",onChange:Z},[g[16]||(g[16]=e("option",{value:""},"-- Select or type command --",-1)),e("optgroup",Bl,[(l(!0),n(ve,null,he(j.value,p=>(l(),n("option",{key:p,value:p},m(p),9,ql))),128))]),g[17]||(g[17]=e("option",{value:"__custom__"},"Custom command...",-1))],40,Nl),[[we,u.value]]),u.value==="__custom__"?W((l(),n("input",{key:0,ref_key:"customCommandInput",ref:w,"onUpdate:modelValue":g[2]||(g[2]=p=>f.value=p),type:"text",placeholder:"Enter custom command name",disabled:C.value,required:"",class:"custom-command-input",onInput:oe},null,40,Hl)),[[_e,f.value]]):R("",!0),e("small",null,"Select a suggested command for "+m(o.device.entity_type||"this device")+", or enter a custom one.",1)]),e("div",zl,[g[21]||(g[21]=e("label",null,"Command Type",-1)),e("div",Jl,[e("label",Wl,[W(e("input",{type:"radio","onUpdate:modelValue":g[3]||(g[3]=p=>S.value=p),value:"ir",disabled:C.value},null,8,Kl),[[Fe,S.value]]),g[19]||(g[19]=e("span",null,"IR (Infrared)",-1))]),e("label",Xl,[W(e("input",{type:"radio","onUpdate:modelValue":g[4]||(g[4]=p=>S.value=p),value:"rf",disabled:C.value},null,8,Gl),[[Fe,S.value]]),g[20]||(g[20]=e("span",null,"RF (Radio Frequency)",-1))])])]),e("div",Yl,[e("button",{type:"submit",class:"btn btn-primary btn-large",disabled:C.value},[C.value?(l(),n("i",Ql)):(l(),n("i",en)),I(" "+m(C.value?"Learning...":"Learn Command"),1)],8,Zl)]),C.value?(l(),n("div",tn,[g[24]||(g[24]=e("i",{class:"mdi mdi-loading mdi-spin"},null,-1)),S.value==="ir"?(l(),n("div",on,[...g[22]||(g[22]=[e("p",null,"Point your remote at the Broadlink device and press the button...",-1),e("small",null,"This may take up to 30 seconds",-1)])])):S.value==="rf"?(l(),n("div",ln,[...g[23]||(g[23]=[e("p",null,[e("strong",null,"Learning request sent to device.")],-1),e("p",null,"RF learning is a two-step process:",-1),e("ol",null,[e("li",null,[e("strong",null,"Step 1 - Frequency Sweep (~10-15 seconds):"),I(" Press and hold the button on your remote until the notification updates.")]),e("li",null,[e("strong",null,"Step 2 - Learn Signal:"),I(" Press and release the button once.")])],-1),e("p",{class:"ha-note"},[I(" Follow the Home Assistant notifications ("),e("i",{class:"mdi mdi-bell"}),I(") for real-time instructions. ")],-1)])])):R("",!0)])):R("",!0),M.value&&$.value==="success"&&!M.value.includes("sent successfully")?(l(),n("div",nn,[g[25]||(g[25]=e("i",{class:"mdi mdi-check-circle"},null,-1)),e("p",null,m(M.value),1)])):R("",!0)],32)),t.value.length>0||L.value.length>0?(l(),n("div",sn)):R("",!0),t.value.length>0?(l(),n("div",an,[e("h3",null,"Tracked Commands ("+m(t.value.length)+")",1),e("div",rn,[(l(!0),n(ve,null,he(t.value,p=>(l(),n("div",{key:p.name,class:"command-item"},[e("div",dn,[e("span",un,m(p.label||p.name),1)]),e("div",cn,[g[26]||(g[26]=e("i",{class:"mdi mdi-check-circle"},null,-1)),g[27]||(g[27]=e("span",null,"Learned",-1)),e("span",{class:Y(["command-type-badge",p.type||"ir"])},m((p.type||"ir").toUpperCase()),3)]),e("div",mn,[e("button",{type:"button",onClick:J=>Se(p.name),class:"icon-btn",title:"Test command",disabled:D.value===p.name},[e("i",{class:Y(["mdi mdi-play",{"mdi-spin":D.value===p.name}])},null,2)],8,vn),e("button",{type:"button",onClick:J=>Ie(p.name),class:"icon-btn danger",title:"Delete and re-learn"},[...g[28]||(g[28]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,pn)])]))),128))])])):R("",!0),L.value.length>0?(l(),n("div",fn,[e("h3",null,[g[29]||(g[29]=e("i",{class:"mdi mdi-alert"},null,-1)),I(" Untracked Commands ("+m(L.value.length)+") ",1)]),g[32]||(g[32]=e("p",{class:"untracked-info"}," These commands exist in Broadlink storage but are not tracked in this device. ",-1)),e("div",gn,[(l(!0),n(ve,null,he(L.value,p=>(l(),n("div",{key:p,class:"command-item untracked"},[e("span",yn,m(p),1),g[30]||(g[30]=e("span",{class:"untracked-badge"},"Not tracked",-1))]))),128))]),e("button",{type:"button",onClick:V,class:"btn btn-secondary"},[...g[31]||(g[31]=[e("i",{class:"mdi mdi-import"},null,-1),I(" Import All Untracked Commands ",-1)])])])):R("",!0)]),e("div",bn,[e("button",{type:"button",onClick:g[5]||(g[5]=p=>K.$emit("cancel")),class:"btn btn-secondary",disabled:C.value}," Close ",8,hn)])]),be(Le,{isOpen:B.value,title:"Delete Command?",message:`Delete command '${U.value}'? This will remove it from Broadlink storage.`,confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,onConfirm:x,onCancel:xe},null,8,["isOpen","message"]),be(Le,{isOpen:T.value,title:"Import Commands?",message:`Import ${L.value.length} untracked command${L.value.length>1?"s":""} into this device?`,confirmText:"Import",cancelText:"Cancel",onConfirm:fe,onCancel:g[6]||(g[6]=p=>T.value=!1)},null,8,["isOpen","message"])]))}},wn=ke(kn,[["__scopeId","data-v-5d279b7f"]]),$n={class:"modal-container error-dialog"},Cn={class:"modal-header"},_n={class:"modal-body"},Sn={class:"error-message"},In={key:0,class:"error-suggestion"},Dn=["open"],xn={class:"debug-content"},Tn={class:"debug-info"},Mn={key:0,class:"debug-section-title"},Rn={key:1},Ln={__name:"ErrorDialog",props:{isOpen:{type:Boolean,default:!1},title:{type:String,default:"Error"},message:{type:String,required:!0},suggestion:{type:String,default:""},details:{type:String,default:""},error:{type:Object,default:null},context:{type:Object,default:()=>({})}},emits:["close"],setup(o,{emit:c}){const r=o,k=c,h=Ce("toast"),s=y(!1),u=()=>{k("close")},f=z(()=>{var L,B,U,T,a,w,v,D,X,Z,oe;const $=new Date().toISOString(),t=r.error||{};return{error:JSON.stringify({message:r.message,title:r.title,details:r.details,errorObject:t.message||t.toString(),timestamp:$},null,2),request:JSON.stringify({method:((B=(L=t.config)==null?void 0:L.method)==null?void 0:B.toUpperCase())||"N/A",url:((U=t.config)==null?void 0:U.url)||"N/A",baseURL:((T=t.config)==null?void 0:T.baseURL)||"N/A",headers:((a=t.config)==null?void 0:a.headers)||{},data:(w=t.config)!=null&&w.data?JSON.parse(t.config.data):"N/A",params:((v=t.config)==null?void 0:v.params)||{}},null,2),response:JSON.stringify({status:((D=t.response)==null?void 0:D.status)||"N/A",statusText:((X=t.response)==null?void 0:X.statusText)||"N/A",data:((Z=t.response)==null?void 0:Z.data)||"N/A",headers:((oe=t.response)==null?void 0:oe.headers)||{}},null,2),browser:JSON.stringify({userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language,cookieEnabled:navigator.cookieEnabled,onLine:navigator.onLine,viewport:`${window.innerWidth}x${window.innerHeight}`,screenResolution:`${window.screen.width}x${window.screen.height}`,colorDepth:window.screen.colorDepth,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,timestamp:$},null,2),appState:JSON.stringify({currentRoute:window.location.pathname,currentURL:window.location.href,referrer:document.referrer||"N/A",context:r.context||{},localStorage:{smartir_simulate:localStorage.getItem("smartir_simulate_not_installed"),theme:localStorage.getItem("theme")}},null,2),stackTrace:t.stack||null}}),S=async()=>{const $=M();try{await navigator.clipboard.writeText($),h==null||h.success("Debug information copied to clipboard","✅ Copied")}catch(t){console.error("Failed to copy:",t),h==null||h.error("Failed to copy to clipboard","❌ Copy Failed")}},C=()=>{const $=M(),t=new Blob([$],{type:"text/plain"}),L=URL.createObjectURL(t),B=document.createElement("a");B.href=L;const U=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5);B.download=`broadlink-manager-error-${U}.txt`,document.body.appendChild(B),B.click(),document.body.removeChild(B),URL.revokeObjectURL(L),h==null||h.success("Debug report downloaded","✅ Downloaded")},M=()=>`Broadlink Manager - Error Report
${"=".repeat(60)}

Generated: ${new Date().toISOString()}
Title: ${r.title}
Message: ${r.message}
${r.suggestion?`Suggestion: ${r.suggestion}
`:""}
${"=".repeat(60)}

ERROR DETAILS
${"-".repeat(60)}
${f.value.error}

REQUEST INFORMATION
${"-".repeat(60)}
${f.value.request}

RESPONSE INFORMATION
${"-".repeat(60)}
${f.value.response}

BROWSER INFORMATION
${"-".repeat(60)}
${f.value.browser}

APPLICATION STATE
${"-".repeat(60)}
${f.value.appState}

${f.value.stackTrace?`STACK TRACE
${"-".repeat(60)}
${f.value.stackTrace}

`:""}
${"=".repeat(60)}
End of Report
`;return ue(()=>r.isOpen,$=>{if($){const t=L=>{L.key==="Escape"&&u()};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)}}),($,t)=>(l(),Re(Ge,{to:"body"},[be(Ke,{name:"modal"},{default:qe(()=>[o.isOpen?(l(),n("div",{key:0,class:"modal-overlay",onClick:ye(u,["self"])},[e("div",$n,[e("div",Cn,[t[2]||(t[2]=e("div",{class:"header-icon error-icon"},[e("i",{class:"mdi mdi-alert-circle"})],-1)),e("h3",null,m(o.title),1),e("button",{onClick:u,class:"close-button"},[...t[1]||(t[1]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",_n,[e("p",Sn,m(o.message),1),o.suggestion?(l(),n("p",In,[t[3]||(t[3]=e("i",{class:"mdi mdi-lightbulb-on"},null,-1)),I(" "+m(o.suggestion),1)])):R("",!0),e("details",{class:"debug-section",open:s.value},[e("summary",{onClick:t[0]||(t[0]=L=>s.value=!s.value)},[e("i",{class:Y(["mdi",s.value?"mdi-chevron-down":"mdi-chevron-right"])},null,2),t[4]||(t[4]=I(" Debug Information ",-1))]),e("div",xn,[e("div",{class:"debug-actions"},[e("button",{onClick:S,class:"btn-debug btn-copy"},[...t[5]||(t[5]=[e("i",{class:"mdi mdi-content-copy"},null,-1),I(" Copy to Clipboard ",-1)])]),e("button",{onClick:C,class:"btn-debug btn-download"},[...t[6]||(t[6]=[e("i",{class:"mdi mdi-download"},null,-1),I(" Download Report ",-1)])])]),e("div",Tn,[t[7]||(t[7]=e("div",{class:"debug-section-title"},"Error Details",-1)),e("pre",null,m(f.value.error),1),t[8]||(t[8]=e("div",{class:"debug-section-title"},"Request Information",-1)),e("pre",null,m(f.value.request),1),t[9]||(t[9]=e("div",{class:"debug-section-title"},"Response Information",-1)),e("pre",null,m(f.value.response),1),t[10]||(t[10]=e("div",{class:"debug-section-title"},"Browser Information",-1)),e("pre",null,m(f.value.browser),1),t[11]||(t[11]=e("div",{class:"debug-section-title"},"Application State",-1)),e("pre",null,m(f.value.appState),1),f.value.stackTrace?(l(),n("div",Mn,"Stack Trace")):R("",!0),f.value.stackTrace?(l(),n("pre",Rn,m(f.value.stackTrace),1)):R("",!0)])])],8,Dn)]),e("div",{class:"modal-footer"},[e("button",{onClick:u,class:"btn btn-primary"}," OK ")])])])):R("",!0)]),_:1})]))}},An=ke(Ln,[["__scopeId","data-v-23858149"]]),On={key:0,class:"discovery-banner"},En={class:"banner-content"},Vn={class:"banner-text"},Un={class:"modal-dialog"},Pn={class:"modal-header"},jn={class:"modal-body"},Fn={class:"device-list"},Nn={class:"device-info"},Bn={class:"device-details"},qn={class:"command-count"},Hn={class:"device-actions"},zn=["onClick"],Jn=["onClick"],Wn={class:"modal-footer"},Kn={class:"modal-dialog modal-dialog-small"},Xn={class:"modal-header"},Gn={class:"modal-body"},Yn={class:"warning-message"},Zn={class:"modal-footer"},Qn=["disabled"],es=["disabled"],ts={__name:"DeviceDiscovery",emits:["adopt"],setup(o,{expose:c,emit:r}){const k=Ve(),h=r,s=y([]),u=y(!1),f=y(!1),S=y(null),C=y(!1),M=z(()=>s.value.length>0);De(async()=>{await $()});const $=async()=>{try{const U=await ne.get("/api/devices/discover");s.value=U.data.untracked_devices||[]}catch(U){console.error("Error loading untracked devices:",U),s.value=[]}},t=U=>{u.value=!1,h("adopt",U)},L=U=>{S.value=U,f.value=!0},B=async()=>{if(S.value){C.value=!0;try{const U=await ne.delete(`/api/devices/untracked/${encodeURIComponent(S.value.device_name)}`);if(U.data.success)s.value=s.value.filter(T=>T.device_name!==S.value.device_name),f.value=!1,S.value=null,console.log("Device deleted successfully");else throw new Error(U.data.error||"Failed to delete device")}catch(U){console.error("Error deleting device:",U),k.error(`Failed to delete device: ${U.message}`)}finally{C.value=!1}}};return c({refresh:$}),(U,T)=>{var a,w,v;return M.value?(l(),n("div",On,[e("div",En,[T[9]||(T[9]=e("div",{class:"banner-icon"},[e("i",{class:"mdi mdi-radar"})],-1)),e("div",Vn,[T[7]||(T[7]=e("h3",null,"Untracked Devices Found",-1)),e("p",null,m(s.value.length)+" device"+m(s.value.length>1?"s":"")+" with learned commands found in Broadlink storage",1)]),e("button",{onClick:T[0]||(T[0]=D=>u.value=!0),class:"btn btn-primary"},[...T[8]||(T[8]=[e("i",{class:"mdi mdi-eye"},null,-1),I(" View Devices ",-1)])])]),u.value?(l(),n("div",{key:0,class:"modal-overlay",onClick:T[3]||(T[3]=ye(D=>u.value=!1,["self"]))},[e("div",Un,[e("div",Pn,[T[11]||(T[11]=e("h2",null,"Discovered Devices",-1)),e("button",{onClick:T[1]||(T[1]=D=>u.value=!1),class:"close-btn"},[...T[10]||(T[10]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",jn,[T[16]||(T[16]=e("p",{class:"info-text"}," These devices have learned commands in Broadlink storage but are not being tracked. Adopt them to manage their commands and generate Home Assistant entities. ",-1)),e("div",Fn,[(l(!0),n(ve,null,he(s.value,D=>(l(),n("div",{key:D.device_name,class:"discovered-device"},[e("div",Nn,[T[13]||(T[13]=e("div",{class:"device-icon"},[e("i",{class:"mdi mdi-devices"})],-1)),e("div",Bn,[e("h4",null,m(D.device_name),1),e("span",qn,[T[12]||(T[12]=e("i",{class:"mdi mdi-remote"},null,-1)),I(" "+m(D.command_count)+" command"+m(D.command_count>1?"s":""),1)])])]),e("div",Hn,[e("button",{onClick:X=>t(D),class:"btn btn-primary"},[...T[14]||(T[14]=[e("i",{class:"mdi mdi-plus"},null,-1),I(" Adopt ",-1)])],8,zn),e("button",{onClick:X=>L(D),class:"btn btn-danger",title:"Delete all commands"},[...T[15]||(T[15]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,Jn)])]))),128))])]),e("div",Wn,[e("button",{onClick:T[2]||(T[2]=D=>u.value=!1),class:"btn btn-secondary"}," Close ")])])])):R("",!0),f.value?(l(),n("div",{key:1,class:"modal-overlay",onClick:T[6]||(T[6]=ye(D=>f.value=!1,["self"]))},[e("div",Kn,[e("div",Xn,[T[18]||(T[18]=e("h2",null,"Delete Untracked Device",-1)),e("button",{onClick:T[4]||(T[4]=D=>f.value=!1),class:"close-btn"},[...T[17]||(T[17]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Gn,[e("div",Yn,[T[20]||(T[20]=e("i",{class:"mdi mdi-alert"},null,-1)),e("div",null,[e("p",null,[e("strong",null,'Are you sure you want to delete "'+m((a=S.value)==null?void 0:a.device_name)+'"?',1)]),e("p",null,"This will permanently delete all "+m((w=S.value)==null?void 0:w.command_count)+" command"+m(((v=S.value)==null?void 0:v.command_count)>1?"s":"")+" from Broadlink storage.",1),T[19]||(T[19]=e("p",{class:"warning-text"},"This action cannot be undone.",-1))])])]),e("div",Zn,[e("button",{onClick:T[5]||(T[5]=D=>f.value=!1),class:"btn btn-secondary",disabled:C.value}," Cancel ",8,Qn),e("button",{onClick:B,class:"btn btn-danger",disabled:C.value},[e("i",{class:Y(["mdi",C.value?"mdi-loading mdi-spin":"mdi-delete"])},null,2),I(" "+m(C.value?"Deleting...":"Delete"),1)],8,es)])])])):R("",!0)])):R("",!0)}}},os=ke(ts,[["__scopeId","data-v-24463050"]]),ls={class:"device-list-card"},ns={class:"card-header"},ss={class:"header-badges"},as={class:"header-info"},is={class:"header-right"},rs=["disabled"],ds=["disabled"],us={class:"card-body"},cs={key:0,class:"filter-bar"},ms={class:"filter-row filter-row-search"},vs={class:"filter-group filter-search"},ps={class:"filter-row filter-row-dropdowns"},fs={class:"filter-group"},gs=["value"],ys={class:"filter-group"},bs=["value"],hs={class:"filter-group"},ks={key:0,class:"filter-group filter-toggle"},ws={class:"toggle-label"},$s={key:2,class:"view-toggle-group"},Cs={class:"filter-results"},_s={key:1,class:"loading-state"},Ss={key:2,class:"error-state"},Is={key:3,class:"empty-state"},Ds={key:4,class:"device-grid"},xs={key:6,class:"no-results"},Ts={__name:"DeviceList",setup(o){const c=rt(),r=Ve(),{isMobile:k}=He(),h=y(!1),s=y(!1),u=y(null),f=y(!1),S=y(null),C=y(null),M=y(!0),$=y(!1),t=y(!1),B=y(window.innerWidth<=767?"grid":localStorage.getItem("device_view_mode")||"grid");ue(k,A=>{A&&B.value==="list"&&(B.value="grid")}),ue(B,A=>{localStorage.setItem("device_view_mode",A)});const U=()=>{M.value=!M.value},T=y(!1),a=y({title:"Error",message:"",suggestion:"",details:"",error:null,context:{}}),w=y(!1),v=y({success:!1,title:"",message:""}),D=y({search:"",broadlinkDevice:"",area:"",entityType:"",showSmartIROnly:!1}),X=y([]),Z=Ce("smartirStatus"),oe=Ce("smartirEnabled"),de=z(()=>{var b;return localStorage.getItem("smartir_simulate_not_installed")==="true"?!1:((b=Z==null?void 0:Z.value)==null?void 0:b.installed)||!1}),E=z(()=>{const A=new Map;return c.devices.forEach(b=>{if(b.broadlink_entity){const q=X.value.find(ee=>ee.entity_id===b.broadlink_entity),N=q&&q.name||b.broadlink_entity;A.set(b.broadlink_entity,{entity_id:b.broadlink_entity,friendly_name:N})}}),Array.from(A.values()).sort((b,q)=>b.friendly_name.localeCompare(q.friendly_name))}),j=z(()=>{const A=new Set;return c.devices.forEach(b=>{b.area&&A.add(b.area)}),Array.from(A).sort()}),te=z(()=>{let A=c.devices;if(D.value.search){const q=D.value.search.toLowerCase();A=A.filter(N=>{var ae,se,Te,Me,Ue;if((ae=N.name)!=null&&ae.toLowerCase().includes(q)||(se=N.entity_type)!=null&&se.toLowerCase().includes(q)||(Te=N.area)!=null&&Te.toLowerCase().includes(q)||(Me=N.id)!=null&&Me.toLowerCase().includes(q)||Object.keys(N.commands||{}).some(Oe=>Oe.toLowerCase().includes(q)))return!0;const Q=X.value.find(Oe=>Oe.entity_id===N.broadlink_entity);return!!((Ue=Q==null?void 0:Q.name)!=null&&Ue.toLowerCase().includes(q))})}D.value.broadlinkDevice&&(A=A.filter(q=>q.broadlink_entity===D.value.broadlinkDevice||q.controller_device===D.value.broadlinkDevice)),D.value.area&&(A=A.filter(q=>q.area===D.value.area)),D.value.entityType&&(A=A.filter(q=>q.entity_type===D.value.entityType)),D.value.showSmartIROnly&&(A=A.filter(q=>q.device_type==="smartir"));const b=localStorage.getItem("smartir_simulate_not_installed")==="true";return(!(oe!=null&&oe.value)||b)&&(A=A.filter(q=>q.device_type!=="smartir")),A}),me=z(()=>D.value.search||D.value.broadlinkDevice||D.value.area||D.value.entityType||D.value.showSmartIROnly),pe=()=>{D.value.search="",D.value.broadlinkDevice="",D.value.area="",D.value.entityType="",D.value.showSmartIROnly=!1},Se=async()=>{try{const A=await ne.get("/api/remote/devices");X.value=A.data.devices||[]}catch(A){console.error("Error loading remote devices:",A)}};ue(B,A=>{localStorage.setItem("device_view_mode",A)}),De(async()=>{await Promise.all([c.loadDevices(),Se()])});const Ie=A=>{u.value=A,h.value=!0},xe=z(()=>{if(!S.value)return"";const A=Object.keys(S.value.commands||{}).length;return A===0?"This device has no commands. The device will be removed from tracking.":`This device has ${A} learned command${A>1?"s":""}. What would you like to do?`}),x=z(()=>{if(!S.value)return"";const A=Object.keys(S.value.commands||{}).length;return A===0?"":`Also delete all ${A} command${A>1?"s":""} from Broadlink storage`}),d=A=>{S.value=A,f.value=!0},V=()=>{f.value=!1,S.value=null},fe=async A=>{var q,N;const b=S.value;f.value=!1;try{await c.deleteDevice(b.id,A),C.value&&await C.value.refresh()}catch(ee){const Q=((N=(q=ee.response)==null?void 0:q.data)==null?void 0:N.error)||ee.message||"Unknown error";le("Failed to Delete Device",Q)}finally{S.value=null}},K=async A=>{var b,q,N,ee,Q;try{console.log("💾 Saving device data:",A),console.log("💾 Device commands:",A.commands),console.log("💾 Selected device:",u.value),(b=u.value)!=null&&b.id&&u.value.id!==null?await c.updateDevice(u.value.id,A):await c.createDevice(A),g(),C.value&&await C.value.refresh()}catch(ae){let se="Failed to save device",Te="",Me="";(N=(q=ae.response)==null?void 0:q.data)!=null&&N.error?(se=ae.response.data.error,Te=ae.response.data.suggestion||""):ae.message&&(se=ae.message),ae.response&&(Me=`Status: ${ae.response.status}
URL: ${((ee=ae.config)==null?void 0:ee.url)||"N/A"}`),le("Failed to Save Device",se,Te,Me,ae,{action:"save_device",deviceData:A,isEdit:!!((Q=u.value)!=null&&Q.id)})}},g=()=>{h.value=!1,u.value=null},p=A=>{u.value=A,s.value=!0},J=()=>{s.value=!1,u.value=null},le=(A,b,q="",N="",ee=null,Q={})=>{a.value={title:A,message:b,suggestion:q,details:N,error:ee,context:Q},T.value=!0},H=()=>{T.value=!1},_=()=>{w.value=!1},re=async A=>{if(A&&A.commands&&u.value){const b=c.devices.findIndex(q=>q.id===u.value.id);b!==-1&&(c.devices[b].commands=A.commands,console.log(`Optimistically updated device ${u.value.id} with new command: ${A.commandName}`))}c.loadDevices(),C.value&&C.value.refresh()},G=A=>{const b=A.split("_"),q=[];for(let N=0;N<b.length;N++){const ee=b[N],Q=b[N+1];ee&&Q==="s"&&b[N+2]?(q.push(ee.charAt(0).toUpperCase()+ee.slice(1)+"'s"),N++):ee!=="s"&&q.push(ee.charAt(0).toUpperCase()+ee.slice(1))}return q.join(" ")},ce=(A,b)=>{const q=A.toLowerCase(),N=b.map(se=>se.toLowerCase());return q.includes("lamp")||q.includes("light")?"light":q.includes("fan")?"fan":q.includes("tv")||q.includes("stereo")||q.includes("speaker")||q.includes("receiver")?"media_player":q.includes("blind")||q.includes("curtain")||q.includes("shade")||q.includes("garage")?"cover":N.some(se=>se.includes("volume")||se.includes("channel")||se.includes("play")||se.includes("pause")||se.includes("mute"))?"media_player":N.some(se=>se.includes("fan_speed")||se.includes("fan_low")||se.includes("fan_high"))?"fan":N.some(se=>se.includes("open")||se.includes("close")||se.includes("stop"))?"cover":"switch"},O=(A,b)=>{const q=A.toLowerCase();return q.includes("tv")?"mdi:television":q.includes("stereo")||q.includes("receiver")||q.includes("speaker")?"mdi:speaker":q.includes("lamp")?"mdi:lamp":q.includes("light")?"mdi:lightbulb":q.includes("fan")?"mdi:fan":q.includes("blind")?"mdi:blinds":q.includes("curtain")?"mdi:curtains":q.includes("garage")?"mdi:garage":{light:"mdi:lightbulb",fan:"mdi:fan",switch:"mdi:light-switch",media_player:"mdi:speaker",cover:"mdi:window-shutter"}[b]||"mdi:devices"},i=A=>{const b=A.toLowerCase().split("_");for(let ee=0;ee<b.length-2;ee++)if(b[ee+1]==="s"){const Q=b.slice(ee,ee+3),ae=G(Q.join("_"));return console.log("Detected possessive area:",ae,"from",A),ae}const q=[["living","room"],["dining","room"],["master","bedroom"],["guest","bedroom"],["family","room"],["laundry","room"],["home","office"]];for(let ee=0;ee<b.length-1;ee++){const Q=[b[ee],b[ee+1]],ae=q.find(se=>se[0]===Q[0]&&se[1]===Q[1]);if(ae)return G(ae.join("_"))}const N=["kitchen","bedroom","bathroom","garage","office","basement","attic","hallway","entryway","patio","deck","yard","garden"];for(const ee of b)if(N.includes(ee))return ee.charAt(0).toUpperCase()+ee.slice(1);return""},F=async A=>{const b=G(A.device_name),q=i(A.device_name),N=ce(A.device_name,A.commands),ee=O(A.device_name,N);let Q="";try{console.log("Finding Broadlink owner for:",A.device_name);const se=await ne.post("/api/devices/find-broadlink-owner",{device_name:A.device_name});console.log("Broadlink owner response:",se.data),Q=se.data.broadlink_entity||"",console.log("Detected Broadlink entity:",Q)}catch(se){console.error("Error finding Broadlink owner:",se)}u.value={id:null,device:A.device_name,name:b,entity_type:N,commands:{},area:q,icon:ee,broadlink_entity:Q,enabled:!0};const ae={};A.commands.forEach(se=>{ae[se]=se}),u.value.commands=ae,h.value=!0},P=async()=>{t.value=!0;try{await c.syncAllAreas(),r.success("Areas synced from Home Assistant")}catch(A){console.error("Error syncing areas:",A),r.error("Failed to sync areas")}finally{t.value=!1}},ie=async({device:A,command:b})=>{var q,N;try{const ee={device_id:A.id,command:b,entity_id:A.broadlink_entity,device:A.device};await ne.post("/api/commands/test",ee),r.success(`Sent ${b} to ${A.name}`)}catch(ee){console.error("Error sending command:",ee);const Q=((N=(q=ee.response)==null?void 0:q.data)==null?void 0:N.error)||ee.message||"Unknown error";r.error(`Failed to send ${b}: ${Q}`)}};return(A,b)=>{var q;return l(),n("div",ls,[e("div",ns,[e("button",{class:"icon-button chevron-button",onClick:U},[e("i",{class:Y(["mdi",M.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2)]),e("div",{class:"header-left",onClick:U},[b[11]||(b[11]=e("div",{class:"header-icon"},[e("i",{class:"mdi mdi-devices"})],-1)),b[12]||(b[12]=e("h3",null,"Managed Devices",-1)),e("div",ss,[e("span",as,m($e(c).deviceCount)+" devices",1)])]),e("div",is,[M.value?(l(),n("button",{key:0,onClick:ye(P,["stop"]),class:"btn btn-secondary",disabled:t.value,title:"Sync all areas from Home Assistant"},[e("i",{class:Y(["mdi",t.value?"mdi-loading mdi-spin":"mdi-refresh"])},null,2),I(" "+m(t.value?"Syncing...":"Sync Areas"),1)],8,rs)):R("",!0),M.value?(l(),n("button",{key:1,onClick:b[0]||(b[0]=ye((...N)=>A.generateAllEntities&&A.generateAllEntities(...N),["stop"])),class:"btn btn-secondary",disabled:$.value,title:"Generate entities for all devices"},[e("i",{class:Y(["mdi",$.value?"mdi-loading mdi-spin":"mdi-file-code"])},null,2),I(" "+m($.value?"Generating...":"Generate Entities"),1)],8,ds)):R("",!0),M.value?(l(),n("button",{key:2,onClick:b[1]||(b[1]=ye(N=>h.value=!0,["stop"])),class:"btn btn-primary"},[...b[13]||(b[13]=[e("i",{class:"mdi mdi-plus"},null,-1),I(" Add Device ",-1)])])):R("",!0)])]),W(e("div",us,[be(os,{ref_key:"discoveryRef",ref:C,onAdopt:F},null,512),$e(c).hasDevices?(l(),n("div",cs,[e("div",ms,[e("div",vs,[e("label",null,[b[14]||(b[14]=e("i",{class:"mdi mdi-magnify"},null,-1)),W(e("input",{"onUpdate:modelValue":b[2]||(b[2]=N=>D.value.search=N),type:"text",placeholder:"Search devices, commands...",class:"search-input"},null,512),[[_e,D.value.search]])])])]),e("div",ps,[e("div",fs,[e("label",null,[b[16]||(b[16]=e("i",{class:"mdi mdi-access-point"},null,-1)),W(e("select",{"onUpdate:modelValue":b[3]||(b[3]=N=>D.value.broadlinkDevice=N)},[b[15]||(b[15]=e("option",{value:""},"All Controller Devices",-1)),(l(!0),n(ve,null,he(E.value,N=>(l(),n("option",{key:N.entity_id,value:N.entity_id},m(N.friendly_name),9,gs))),128))],512),[[we,D.value.broadlinkDevice]])])]),e("div",ys,[e("label",null,[b[18]||(b[18]=e("i",{class:"mdi mdi-home-map-marker"},null,-1)),W(e("select",{"onUpdate:modelValue":b[4]||(b[4]=N=>D.value.area=N)},[b[17]||(b[17]=e("option",{value:""},"All Areas",-1)),(l(!0),n(ve,null,he(j.value,N=>(l(),n("option",{key:N,value:N},m(N),9,bs))),128))],512),[[we,D.value.area]])])]),e("div",hs,[e("label",null,[b[20]||(b[20]=e("i",{class:"mdi mdi-shape"},null,-1)),W(e("select",{"onUpdate:modelValue":b[5]||(b[5]=N=>D.value.entityType=N)},[...b[19]||(b[19]=[Ae('<option value="" data-v-8d45ea8b>All Types</option><option value="light" data-v-8d45ea8b>Light</option><option value="fan" data-v-8d45ea8b>Fan</option><option value="switch" data-v-8d45ea8b>Switch</option><option value="media_player" data-v-8d45ea8b>Media Player</option><option value="cover" data-v-8d45ea8b>Cover</option><option value="climate" data-v-8d45ea8b>Climate</option>',7)])],512),[[we,D.value.entityType]])])]),de.value?(l(),n("div",ks,[e("label",ws,[b[21]||(b[21]=e("span",{class:"toggle-text"},[e("img",{src:ze,alt:"SmartIR",class:"smartir-icon"}),I(" SmartIR Only ")],-1)),W(e("input",{type:"checkbox","onUpdate:modelValue":b[6]||(b[6]=N=>D.value.showSmartIROnly=N),class:"toggle-checkbox"},null,512),[[ge,D.value.showSmartIROnly]]),b[22]||(b[22]=e("span",{class:"toggle-slider"},null,-1))])])):R("",!0),me.value?(l(),n("button",{key:1,onClick:pe,class:"btn-clear-filters"},[...b[23]||(b[23]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),I(" Clear ",-1)])])):R("",!0),$e(k)?R("",!0):(l(),n("div",$s,[e("button",{onClick:b[7]||(b[7]=N=>B.value="grid"),class:Y(["view-toggle-btn",{active:B.value==="grid"}]),title:"Grid View"},[...b[24]||(b[24]=[e("i",{class:"mdi mdi-view-grid"},null,-1),I(" Grid ",-1)])],2),e("button",{onClick:b[8]||(b[8]=N=>B.value="list"),class:Y(["view-toggle-btn",{active:B.value==="list"}]),title:"List View"},[...b[25]||(b[25]=[e("i",{class:"mdi mdi-view-list"},null,-1),I(" List ",-1)])],2)])),e("div",Cs,m(te.value.length)+" of "+m($e(c).deviceCount),1)])])):R("",!0),$e(c).loading?(l(),n("div",_s,[...b[26]||(b[26]=[e("i",{class:"mdi mdi-loading mdi-spin"},null,-1),e("p",null,"Loading devices...",-1)])])):$e(c).error?(l(),n("div",Ss,[b[27]||(b[27]=e("i",{class:"mdi mdi-alert-circle"},null,-1)),e("p",null,m($e(c).error),1),e("button",{onClick:b[9]||(b[9]=N=>$e(c).loadDevices()),class:"btn btn-secondary"}," Retry ")])):$e(c).hasDevices?R("",!0):(l(),n("div",Is,[b[29]||(b[29]=e("i",{class:"mdi mdi-devices"},null,-1)),b[30]||(b[30]=e("h3",null,"No Devices Yet",-1)),b[31]||(b[31]=e("p",null,"Get started by adding your first managed device",-1)),e("button",{onClick:b[10]||(b[10]=N=>h.value=!0),class:"btn btn-primary"},[...b[28]||(b[28]=[e("i",{class:"mdi mdi-plus"},null,-1),I(" Add Your First Device ",-1)])])])),B.value==="grid"?(l(),n("div",Ds,[(l(!0),n(ve,null,he(te.value,N=>(l(),Re(Rt,{key:N.id,device:N,"broadlink-devices":X.value,onEdit:Ie,onDelete:d,onLearn:p},null,8,["device","broadlink-devices"]))),128))])):B.value==="list"&&te.value.length>0?(l(),Re(Gt,{key:5,devices:te.value,onSendCommand:ie,onEditDevice:Ie,onDeleteDevice:d},null,8,["devices"])):R("",!0),$e(c).hasDevices&&te.value.length===0?(l(),n("div",xs,[...b[32]||(b[32]=[e("i",{class:"mdi mdi-filter-off"},null,-1),e("h3",null,"No devices match your filters",-1),e("p",null,"Try adjusting your search or filter criteria",-1)])])):R("",!0)],512),[[Ye,M.value]]),h.value?(l(),Re(Sl,{key:0,device:u.value,onSave:K,onCancel:g},null,8,["device"])):R("",!0),s.value?(l(),Re(wn,{key:1,device:u.value,onLearned:re,onCancel:J},null,8,["device"])):R("",!0),be(Le,{isOpen:f.value,title:`Delete ${(q=S.value)==null?void 0:q.name}?`,message:xe.value,confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,checkboxLabel:x.value,onConfirm:fe,onCancel:V},null,8,["isOpen","title","message","checkboxLabel"]),be(An,{isOpen:T.value,title:a.value.title,message:a.value.message,suggestion:a.value.suggestion,details:a.value.details,error:a.value.error,context:a.value.context,onClose:H},null,8,["isOpen","title","message","suggestion","details","error","context"]),be(Le,{isOpen:w.value,title:v.value.title,message:v.value.message,confirmText:"OK",showCancel:!1,dangerMode:!v.value.success,onConfirm:_,onCancel:_},null,8,["isOpen","title","message","dangerMode"])])}}},Ms=ke(Ts,[["__scopeId","data-v-8d45ea8b"]]),Rs={class:"banner-content"},Ls={class:"banner-icon"},As={class:"banner-message"},Os={class:"banner-actions"},Es={__name:"SmartIRBanner",setup(o){const c=Ce("smartirStatus"),r=y(!1),k=z(()=>!(!c.value||r.value||localStorage.getItem("smartir_banner_dismissed")==="true")),h=z(()=>{var M;return(M=c.value)!=null&&M.installed?"banner-success":"banner-info"}),s=z(()=>{var M;return(M=c.value)!=null&&M.installed?"mdi mdi-check-circle":"mdi mdi-information"}),u=z(()=>{var M;return(M=c.value)!=null&&M.installed?`SmartIR Detected (v${c.value.version})`:"Want Climate Device Support?"}),f=z(()=>{var M;return(M=c.value)!=null&&M.installed?"You can now create climate device profiles with full temperature and HVAC mode control.":"Install SmartIR to unlock AC/heater control with temperature settings, HVAC modes, and 120+ pre-configured device profiles."});function S(){window.open("https://github.com/smartHomeHub/SmartIR","_blank")}function C(){var M;if(r.value=!0,(M=c.value)!=null&&M.installed)localStorage.setItem("smartir_banner_dismissed","true");else{const $=parseInt(localStorage.getItem("smartir_banner_dismiss_count")||"0");$>=2?localStorage.setItem("smartir_banner_dismissed","true"):localStorage.setItem("smartir_banner_dismiss_count",String($+1))}}return De(()=>{var t;const M=localStorage.getItem("smartir_last_status"),$=(t=c.value)!=null&&t.installed?"installed":"not_installed";M!==$&&(localStorage.removeItem("smartir_banner_dismissed"),localStorage.removeItem("smartir_banner_dismiss_count"),localStorage.setItem("smartir_last_status",$))}),(M,$)=>{var t,L;return k.value?(l(),n("div",{key:0,class:Y(["smartir-banner",h.value])},[e("div",Rs,[e("div",Ls,[e("i",{class:Y(s.value)},null,2)]),e("div",As,[e("strong",null,m(u.value),1),e("p",null,m(f.value),1)]),e("div",Os,[(t=M.status)!=null&&t.installed?R("",!0):(l(),n("button",{key:0,onClick:S,class:"btn-primary"}," Learn More ")),e("button",{onClick:C,class:"btn-text"},m((L=M.status)!=null&&L.installed?"Got it":"Dismiss"),1)])])],2)):R("",!0)}}},Vs=ke(Es,[["__scopeId","data-v-7bbcbcd7"]]),Ee="api/smartir",Qe={async getStatus(){try{const o=await fetch(`${Ee}/status`);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return await o.json()}catch(o){return console.error("Error fetching SmartIR status:",o),{installed:!1,version:null,error:o.message}}},async getInstallInstructions(){try{const o=await fetch(`${Ee}/install-instructions`);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return await o.json()}catch(o){throw console.error("Error fetching install instructions:",o),o}},async getPlatforms(){try{const o=await fetch(`${Ee}/platforms`);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return await o.json()}catch(o){throw console.error("Error fetching platforms:",o),o}},async getPlatformCodes(o){try{const c=await fetch(`${Ee}/platforms/${o}/codes`);if(!c.ok)throw new Error(`HTTP error! status: ${c.status}`);return await c.json()}catch(c){throw console.error(`Error fetching codes for ${o}:`,c),c}},async getNextCode(o){try{const c=await fetch(`${Ee}/platforms/${o}/next-code`);if(!c.ok)throw new Error(`HTTP error! status: ${c.status}`);return await c.json()}catch(c){throw console.error(`Error fetching next code for ${o}:`,c),c}},async validateCode(o,c){try{const r=await fetch(`${Ee}/validate-code`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({platform:o,code:c})});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);return await r.json()}catch(r){throw console.error("Error validating code:",r),r}}},Us={class:"profile-card"},Ps={class:"profile-card-header"},js=["title"],Fs={class:"profile-details"},Ns=["title"],Bs={class:"profile-meta"},qs=["title"],Hs=["title"],zs=["title"],Js={class:"profile-card-footer"},Ws=["title"],Ks={key:0,class:"learned-indicator"},Xs={class:"profile-actions"},Gs={__name:"SmartIRProfileCard",props:{profile:{type:Object,required:!0}},emits:["edit","download","delete","commands"],setup(o){const c=o,r=Ze(z(()=>c.profile.platform)),k=u=>u.replace(/_/g," ").replace(/\b\w/g,f=>f.toUpperCase()),h=u=>u&&u.startsWith("mdi:")?`mdi ${u.replace(":"," mdi-")}`:`mdi mdi-${u}`,s=u=>{if(!u)return"";const f=u.toLowerCase();return f.includes("broadlink")?"broadlink-tag":f.includes("not set")?"not-set-tag":"default-controller-tag"};return(u,f)=>(l(),n("div",Us,[e("div",Ps,[e("div",{class:Y(["profile-icon",$e(r).colorClass.value]),title:k(o.profile.platform)},[e("i",{class:Y(h($e(r).icon.value))},null,2)],10,js),e("div",Fs,[e("h4",{title:`${o.profile.manufacturer} ${o.profile.model}`},m(o.profile.manufacturer)+" "+m(o.profile.model),9,Ns),e("div",Bs,[e("span",{class:"tag platform-tag",title:k(o.profile.platform)},m(k(o.profile.platform)),9,qs),o.profile.controllerBrand?(l(),n("span",{key:0,class:Y(["tag controller-tag",s(o.profile.controllerBrand)]),title:"Controller: "+o.profile.controllerBrand},[f[4]||(f[4]=e("i",{class:"mdi mdi-remote-tv"},null,-1)),I(" "+m(o.profile.controllerBrand),1)],10,Hs)):R("",!0)])]),e("div",{class:"code-badge",title:"Device Code: "+o.profile.code},m(o.profile.code),9,zs)]),e("div",Js,[e("div",{class:"profile-stats",title:o.profile.commandCount+" total commands"+(o.profile.learnedCount>0?", "+o.profile.learnedCount+" learned":"")},[f[5]||(f[5]=e("i",{class:"mdi mdi-remote"},null,-1)),e("span",null,m(o.profile.commandCount)+" command"+m(o.profile.commandCount!==1?"s":""),1),o.profile.learnedCount>0?(l(),n("span",Ks,"( "+m(o.profile.learnedCount)+" learned )",1)):R("",!0)],8,Ws),e("div",Xs,[e("button",{onClick:f[0]||(f[0]=S=>u.$emit("commands")),class:"action-btn",title:"Commands"},[...f[6]||(f[6]=[e("i",{class:"mdi mdi-remote"},null,-1)])]),e("button",{onClick:f[1]||(f[1]=S=>u.$emit("edit")),class:"action-btn",title:"Edit Profile"},[...f[7]||(f[7]=[e("i",{class:"mdi mdi-pencil"},null,-1)])]),e("button",{onClick:f[2]||(f[2]=S=>u.$emit("download")),class:"action-btn",title:"Download JSON"},[...f[8]||(f[8]=[e("i",{class:"mdi mdi-download"},null,-1)])]),e("button",{onClick:f[3]||(f[3]=S=>u.$emit("delete")),class:"action-btn delete",title:"Delete Profile"},[...f[9]||(f[9]=[e("i",{class:"mdi mdi-delete"},null,-1)])])])])]))}},Ys=ke(Gs,[["__scopeId","data-v-b72a1955"]]),Zs={name:"SmartIRProfileListView",props:{profiles:{type:Array,required:!0}},methods:{getPlatformIcon(o){return{climate:"mdi-thermostat",media_player:"mdi-television",fan:"mdi-fan",light:"mdi-lightbulb"}[o]||"mdi-devices"},formatPlatform(o){return{climate:"Climate",media_player:"Media Player",fan:"Fan",light:"Light"}[o]||o},editProfile(o){this.$emit("edit",o)},viewCommands(o){this.$emit("commands",o)},downloadProfile(o){this.$emit("download",o)},deleteProfile(o){this.$emit("delete",o)}}},Qs={class:"profile-list-view"},ea={class:"profile-table"},ta={class:"profile-code"},oa={class:"code-badge"},la={class:"profile-manufacturer"},na={class:"profile-model"},sa={class:"model-info"},aa={class:"model-name"},ia={key:0,class:"model-count"},ra={class:"profile-platform"},da={class:"profile-controller"},ua={class:"profile-commands"},ca={class:"command-stats"},ma={class:"stat-item"},va={key:0,class:"stat-item learned"},pa={class:"profile-actions"},fa=["onClick"],ga=["onClick"],ya=["onClick"],ba=["onClick"];function ha(o,c,r,k,h,s){return l(),n("div",Qs,[e("table",ea,[c[6]||(c[6]=e("thead",null,[e("tr",null,[e("th",null,"Code"),e("th",null,"Manufacturer"),e("th",null,"Model"),e("th",null,"Platform"),e("th",null,"Controller"),e("th",null,"Commands"),e("th",null,"Actions")])],-1)),e("tbody",null,[(l(!0),n(ve,null,he(r.profiles,u=>(l(),n("tr",{key:`${u.platform}-${u.code}`,class:"profile-row"},[e("td",ta,[e("span",oa,m(u.code),1)]),e("td",la,m(u.manufacturer||"Unknown"),1),e("td",na,[e("div",sa,[e("div",aa,m(u.model||"Unknown"),1),u.models&&u.models.length>1?(l(),n("div",ia," +"+m(u.models.length-1)+" more ",1)):R("",!0)])]),e("td",ra,[e("span",{class:Y(["platform-badge",u.platform])},[e("i",{class:Y(["mdi",s.getPlatformIcon(u.platform)])},null,2),I(" "+m(s.formatPlatform(u.platform)),1)],2)]),e("td",da,m(u.controller_brand||"N/A"),1),e("td",ua,[e("div",ca,[e("span",ma,[c[0]||(c[0]=e("i",{class:"mdi mdi-remote"},null,-1)),I(" "+m(u.command_count||0),1)]),u.learned_count>0?(l(),n("span",va,[c[1]||(c[1]=e("i",{class:"mdi mdi-school"},null,-1)),I(" "+m(u.learned_count),1)])):R("",!0)])]),e("td",pa,[e("button",{class:"action-btn edit",onClick:f=>s.editProfile(u),title:"Edit Profile"},[...c[2]||(c[2]=[e("i",{class:"mdi mdi-pencil"},null,-1)])],8,fa),e("button",{class:"action-btn commands",onClick:f=>s.viewCommands(u),title:"View Commands"},[...c[3]||(c[3]=[e("i",{class:"mdi mdi-remote"},null,-1)])],8,ga),e("button",{class:"action-btn download",onClick:f=>s.downloadProfile(u),title:"Download"},[...c[4]||(c[4]=[e("i",{class:"mdi mdi-download"},null,-1)])],8,ya),e("button",{class:"action-btn delete",onClick:f=>s.deleteProfile(u),title:"Delete"},[...c[5]||(c[5]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,ba)])]))),128))])])])}const ka=ke(Zs,[["render",ha],["__scopeId","data-v-d3773038"]]),wa={class:"modal-container"},$a={class:"modal-body"},Ca={key:0,class:"selection-section"},_a={class:"form-group"},Sa={class:"form-group"},Ia={class:"form-group"},Da={key:0,class:"code-info"},xa={class:"form-actions"},Ta=["disabled"],Ma={key:1,class:"testing-section"},Ra={class:"code-header"},La={class:"code-details"},Aa={class:"code-badge"},Oa={class:"device-selector"},Ea=["value"],Va={class:"commands-section"},Ua={class:"commands-header"},Pa={key:0,class:"tested-count"},ja={key:0,class:"filters-section"},Fa={class:"filter-row"},Na={class:"filter-row"},Ba={key:1,class:"empty-state"},qa={key:2,class:"empty-state"},Ha={key:3,class:"commands-list"},za={class:"command-name"},Ja={class:"command-actions"},Wa={key:0,class:"status-badge success"},Ka=["onClick","disabled"],Xa={__name:"SmartIRCodeTester",props:{isOpen:{type:Boolean,default:!1}},emits:["close","clone"],setup(o,{emit:c}){const r=o,k=c,h=Ce("toast"),s=y("climate"),u=y(""),f=y([]),S=y(!1),C=y(null),M=y(""),$=y([]),t=y(!1),L=z(()=>$.value.map(H=>({code:H.code,label:`${H.models.join(", ")} (Code: ${H.code})`,value:H.code}))),B=y(null),U=y(null),T=y(!1),a=y([]),w=y(""),v=y([]),D=y(new Set),X=y(null),Z=y(""),oe=y(""),de=y(""),E=y(""),j=z(()=>{let H=v.value;if(Z.value){const _=Z.value.toLowerCase();H=H.filter(re=>(re.label||re.name).toLowerCase().includes(_))}return oe.value&&(H=H.filter(_=>_.mode===oe.value)),de.value&&(H=H.filter(_=>_.fanSpeed===de.value)),E.value&&(H=H.filter(_=>_.swingMode===E.value)),H}),te=z(()=>Z.value||oe.value||de.value||E.value);ue(()=>r.isOpen,H=>{H&&(me(),Se())}),ue(s,()=>{r.isOpen&&(u.value="",C.value=null,$.value=[],me())});async function me(){var H;S.value=!0;try{const _=await ne.get("/api/smartir/codes/manufacturers",{params:{entity_type:s.value}});f.value=_.data.manufacturers||[]}catch(_){console.error("Error loading manufacturers:",_),(H=h.value)==null||H.error("Failed to load manufacturers","❌ Error")}finally{S.value=!1}}async function pe(){var H;if(u.value){t.value=!0;try{const _=await ne.get("/api/smartir/codes/models",{params:{entity_type:s.value,manufacturer:u.value}});$.value=_.data.models||[]}catch(_){console.error("Error loading models:",_),(H=h.value)==null||H.error("Failed to load models","❌ Error")}finally{t.value=!1}}}async function Se(){try{const H=await ne.get("/api/remote/devices");a.value=H.data.devices||[]}catch(H){console.error("Error loading Broadlink devices:",H)}}async function Ie(){var H,_;if(C.value){T.value=!0;try{const re=await ne.get("/api/smartir/codes/code",{params:{entity_type:s.value,code_id:C.value.code}});U.value=re.data.code,B.value=C.value.code,xe(re.data.code),(H=h.value)==null||H.success(`Loaded ${v.value.length} commands`,"✅ Code Loaded")}catch(re){console.error("Error loading code:",re),(_=h.value)==null||_.error(re.message||"Failed to load code","❌ Error")}finally{T.value=!1}}}function xe(H){const _=[];if(!H.commands){v.value=_;return}if(s.value==="climate"){const G=H.commands;for(const[ce,O]of Object.entries(G)){if(ce==="off"){typeof O=="string"&&_.push({name:"off",label:"OFF",data:O,mode:"off"});continue}if(typeof O=="object"){for(const[i,F]of Object.entries(O))if(typeof F=="object")for(const[P,ie]of Object.entries(F)){if(typeof ie!="object")continue;const A=Object.keys(ie),b=A.includes("24")?"24":A[0];if(b&&typeof ie[b]=="string"){const q=`${ce}_${b}_${i}_${P}`,N=`${ce.toUpperCase()} ${b}°C ${i} ${P}`;_.push({name:q,label:N,data:ie[b],mode:ce,temperature:b,fanSpeed:i,swingMode:P})}}}}}else for(const[G,ce]of Object.entries(H.commands))typeof ce=="string"&&_.push({name:G,label:G.toUpperCase().replace(/_/g," "),data:ce});v.value=_}async function x(H){var _,re,G;if(!w.value){(_=h.value)==null||_.warning("Please select a Broadlink device first","⚠️ No Device");return}X.value=H;try{const ce=v.value.find(O=>O.name===H);if(!ce||!ce.data)throw new Error(`Command "${H}" not found`);await ne.post("/api/commands/send-raw",{entity_id:w.value,command:ce.data,command_type:"ir"}),D.value.add(H),(re=h.value)==null||re.success(`Command sent: ${ce.label||H}`,"✅ Tested")}catch(ce){console.error("Error testing command:",ce),(G=h.value)==null||G.error("Failed to test command","❌ Error")}finally{X.value=null}}function d(){var H,_,re,G;if(!U.value){(H=h.value)==null||H.error("No profile data to download","❌ Error");return}try{const ce=U.value.manufacturer||"unknown",O=((_=U.value.supportedModels)==null?void 0:_[0])||B.value,i=`${ce.toLowerCase().replace(/\s+/g,"_")}_${O.toLowerCase().replace(/\s+/g,"_")}.json`,F=JSON.stringify(U.value,null,2),P=new Blob([F],{type:"application/json"}),ie=URL.createObjectURL(P),A=document.createElement("a");A.href=ie,A.download=i,document.body.appendChild(A),A.click(),document.body.removeChild(A),URL.revokeObjectURL(ie),(re=h.value)==null||re.success(`Downloaded ${i}`,"✅ Download Complete")}catch(ce){console.error("Error downloading JSON:",ce),(G=h.value)==null||G.error(ce.message||"Failed to download JSON","❌ Download Error")}}function V(){u.value="",C.value=null,M.value="",$.value=[]}function fe(){C.value=null,M.value="",pe()}function K(){M.value?C.value=$.value.find(H=>H.code===M.value):C.value=null}function g(){Z.value="",oe.value="",de.value="",E.value=""}function p(){B.value=null,U.value=null,v.value=[],D.value.clear(),X.value=null,g()}function J(H){const _=H.toLowerCase();return _.includes("power")||_.includes("off")||_==="off"?"mdi-power":_.includes("cool")?"mdi-snowflake":_.includes("heat")?"mdi-fire":_.includes("fan")?"mdi-fan":_.includes("auto")?"mdi-auto-fix":_.includes("dry")?"mdi-water-percent":_.includes("temp")?"mdi-thermometer":_.includes("swing")?"mdi-swap-vertical":"mdi-remote"}function le(){p(),u.value="",C.value=null,k("close")}return(H,_)=>{var re;return o.isOpen?(l(),n("div",{key:0,class:"modal-overlay",onClick:ye(le,["self"])},[e("div",wa,[e("div",{class:"modal-header"},[_[9]||(_[9]=e("h3",null,[e("i",{class:"mdi mdi-test-tube"}),I(" Test SmartIR Code ")],-1)),e("button",{onClick:le,class:"close-btn"},[..._[8]||(_[8]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",$a,[B.value?(l(),n("div",Ma,[e("div",Ra,[e("div",La,[e("h4",null,m(U.value.manufacturer)+" - "+m(((re=U.value.supportedModels)==null?void 0:re[0])||"Unknown"),1),e("span",Aa,"Code: "+m(B.value),1)]),e("button",{onClick:p,class:"btn-secondary-small"},[..._[14]||(_[14]=[e("i",{class:"mdi mdi-arrow-left"},null,-1),I(" Change Code ",-1)])])]),e("div",Oa,[_[16]||(_[16]=e("label",null,[e("i",{class:"mdi mdi-remote"}),I(" Broadlink Device ")],-1)),W(e("select",{"onUpdate:modelValue":_[3]||(_[3]=G=>w.value=G),class:"form-select"},[_[15]||(_[15]=e("option",{value:""},"Select device to test with...",-1)),(l(!0),n(ve,null,he(a.value,G=>(l(),n("option",{key:G.entity_id,value:G.entity_id},m(G.friendly_name||G.entity_id),9,Ea))),128))],512),[[we,w.value]])]),e("div",Va,[e("div",Ua,[e("h5",null,"Sample Commands ("+m(j.value.length)+" / "+m(v.value.length)+")",1),D.value.size>0?(l(),n("span",Pa,m(D.value.size)+" tested ",1)):R("",!0)]),s.value==="climate"&&v.value.length>0?(l(),n("div",ja,[e("div",Fa,[W(e("input",{"onUpdate:modelValue":_[4]||(_[4]=G=>Z.value=G),type:"text",placeholder:"Search commands...",class:"search-input"},null,512),[[_e,Z.value]])]),e("div",Na,[W(e("select",{"onUpdate:modelValue":_[5]||(_[5]=G=>oe.value=G),class:"filter-select"},[..._[17]||(_[17]=[e("option",{value:""},"All Modes",-1),e("option",{value:"cool"},"Cool",-1),e("option",{value:"heat"},"Heat",-1),e("option",{value:"off"},"Off",-1)])],512),[[we,oe.value]]),W(e("select",{"onUpdate:modelValue":_[6]||(_[6]=G=>de.value=G),class:"filter-select"},[..._[18]||(_[18]=[Ae('<option value="" data-v-d1d8935f>All Fan Speeds</option><option value="low" data-v-d1d8935f>Low</option><option value="mid" data-v-d1d8935f>Mid</option><option value="high" data-v-d1d8935f>High</option><option value="auto" data-v-d1d8935f>Auto</option>',5)])],512),[[we,de.value]]),W(e("select",{"onUpdate:modelValue":_[7]||(_[7]=G=>E.value=G),class:"filter-select"},[..._[19]||(_[19]=[e("option",{value:""},"All Swing",-1),e("option",{value:"stop"},"Stop",-1),e("option",{value:"swing"},"Swing",-1)])],512),[[we,E.value]]),te.value?(l(),n("button",{key:0,onClick:g,class:"btn-clear-filters"},[..._[20]||(_[20]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),I(" Clear ",-1)])])):R("",!0)])])):R("",!0),v.value.length===0?(l(),n("div",Ba,[..._[21]||(_[21]=[e("i",{class:"mdi mdi-alert-circle"},null,-1),e("p",null,"No commands found in this code",-1)])])):j.value.length===0?(l(),n("div",qa,[_[22]||(_[22]=e("i",{class:"mdi mdi-filter-off"},null,-1)),_[23]||(_[23]=e("p",null,"No commands match your filters",-1)),e("button",{onClick:g,class:"btn-secondary-small"}," Clear Filters ")])):(l(),n("div",Ha,[(l(!0),n(ve,null,he(j.value,G=>(l(),n("div",{key:G.name,class:Y(["command-item",{tested:D.value.has(G.name),testing:X.value===G.name}])},[e("div",za,[e("i",{class:Y(["mdi",J(G.mode||G.name)])},null,2),e("span",null,m(G.label||G.name),1)]),e("div",Ja,[D.value.has(G.name)?(l(),n("span",Wa,[..._[24]||(_[24]=[e("i",{class:"mdi mdi-check"},null,-1),I(" Tested ",-1)])])):R("",!0),e("button",{onClick:ce=>x(G.name),disabled:!w.value||X.value===G.name,class:"btn-test"},[e("i",{class:Y(["mdi",X.value===G.name?"mdi-loading mdi-spin":"mdi-play"])},null,2),_[25]||(_[25]=I(" Test ",-1))],8,Ka)])],2))),128))]))]),e("div",{class:"modal-actions"},[e("button",{onClick:d,class:"btn-primary"},[..._[26]||(_[26]=[e("i",{class:"mdi mdi-download"},null,-1),I(" Download JSON ",-1)])]),e("button",{onClick:le,class:"btn-secondary"}," Close ")])])):(l(),n("div",Ca,[_[13]||(_[13]=e("div",{class:"info-banner"},[e("i",{class:"mdi mdi-information"}),e("p",null,"Select a SmartIR code from the index to test commands with your Broadlink device.")],-1)),e("div",_a,[_[11]||(_[11]=e("label",null,[e("i",{class:"mdi mdi-shape"}),I(" Platform ")],-1)),W(e("select",{"onUpdate:modelValue":_[0]||(_[0]=G=>s.value=G),onChange:V,class:"form-select"},[..._[10]||(_[10]=[e("option",{value:"climate"},"Climate (AC/Heater)",-1),e("option",{value:"media_player"},"Media Player (TV/Audio)",-1),e("option",{value:"fan"},"Fan",-1),e("option",{value:"light"},"Light",-1)])],544),[[we,s.value]])]),e("div",Sa,[be(Ne,{modelValue:u.value,"onUpdate:modelValue":_[1]||(_[1]=G=>u.value=G),options:f.value,label:"Manufacturer",placeholder:"Search manufacturers...",loading:S.value,disabled:S.value,onChange:fe},null,8,["modelValue","options","loading","disabled"])]),e("div",Ia,[be(Ne,{modelValue:M.value,"onUpdate:modelValue":_[2]||(_[2]=G=>M.value=G),options:L.value,"option-label":"label","option-value":"code",label:"Model",placeholder:"Search models...",loading:t.value,disabled:!u.value||t.value,onChange:K},null,8,["modelValue","options","loading","disabled"])]),C.value?(l(),n("div",Da,[_[12]||(_[12]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[e("strong",null,m(u.value)+" - "+m(C.value.models[0]),1),e("p",null,"Code: "+m(C.value.code),1)])])):R("",!0),e("div",xa,[e("button",{onClick:Ie,disabled:!C.value||T.value,class:"btn-primary"},[e("i",{class:Y(["mdi",T.value?"mdi-loading mdi-spin":"mdi-download"])},null,2),I(" "+m(T.value?"Loading...":"Load Commands"),1)],8,Ta)])]))])])])):R("",!0)}}},Ga=ke(Xa,[["__scopeId","data-v-d1d8935f"]]),Ya={class:"smartir-status-card"},Za={class:"card-header"},Qa=["src"],ei={class:"header-badges"},ti=["title"],oi={class:"header-info"},li={class:"header-info"},ni={class:"header-info"},si={class:"header-right"},ai={key:0,class:"card-body loading-state"},ii={key:1,class:"card-body error-state"},ri={key:2,class:"card-body installed-state"},di={key:0,class:"help-panel"},ui={key:0,class:"recommendation"},ci={key:0,class:"next-steps"},mi={class:"help-actions"},vi={key:1,class:"filter-bar"},pi={class:"filter-row"},fi={class:"filter-group filter-search"},gi={class:"filter-group"},yi={key:1,class:"view-toggle-group"},bi={class:"filter-results"},hi={key:2,class:"loading-state"},ki={key:3,class:"empty-state"},wi={key:4,class:"profiles-grid"},$i={key:6,class:"no-results"},Ci={key:3,class:"card-body not-installed-state"},_i={class:"benefits-section"},Si={class:"benefits-list"},Ii={class:"recommendation"},Di={__name:"SmartIRStatusCard",emits:["create-profile","edit-profile"],setup(o,{expose:c,emit:r}){const k=r,h=Ce("smartirStatus");Ce("smartirEnabled");const s=Ce("refreshSmartIR"),{isMobile:u}=He(),f=y(!1),S=y(null),C=y((h==null?void 0:h.value)||null),M=y(localStorage.getItem("smartir_simulate_not_installed")==="true"),$=y(!1),t=y(!0),L=y([]),B=y(!1),U=y({search:"",platform:""}),T=y({show:!1,title:"",message:"",platform:null,profile:null}),a=y(!1),v=y(window.innerWidth<=767?"grid":localStorage.getItem("profile_view_mode")||"grid");ue(u,g=>{g&&v.value==="list"&&(v.value="grid")}),ue(v,g=>{localStorage.setItem("profile_view_mode",g)});const D=["Full climate entity support (AC, heaters)","120+ pre-configured device profiles","Temperature and humidity sensor integration","HVAC mode control (heat, cool, auto, dry, fan)"],X=["climate","media_player","fan","light"],Z=z(()=>M.value?{installed:!1,recommendation:{message:"Install SmartIR to unlock climate device support!",benefits:["Full climate entity support (AC, heaters)","120+ pre-configured device profiles","Temperature and humidity sensor integration","HVAC mode control (heat, cool, auto, dry, fan)"]}}:C.value),oe=z(()=>{var g,p;return((p=(g=Z.value)==null?void 0:g.platforms)==null?void 0:p.length)||0}),de=z(()=>{var g;return(g=Z.value)!=null&&g.device_counts?Object.values(Z.value.device_counts).reduce((p,J)=>p+J,0):0});function E(){var g;M.value=!M.value,localStorage.setItem("smartir_simulate_not_installed",M.value.toString()),!M.value&&((g=C.value)!=null&&g.installed)&&x()}const j=z(()=>{let g=L.value;if(U.value.search){const p=U.value.search.toLowerCase();g=g.filter(J=>{var le,H,_,re;return((le=J.manufacturer)==null?void 0:le.toLowerCase().includes(p))||((H=J.model)==null?void 0:H.toLowerCase().includes(p))||((_=J.code)==null?void 0:_.toString().includes(p))||((re=J.platform)==null?void 0:re.toLowerCase().includes(p))})}return U.value.platform&&(g=g.filter(p=>p.platform===U.value.platform)),g}),te=z(()=>U.value.search||U.value.platform);function me(){U.value.search="",U.value.platform=""}async function pe(){f.value=!0,S.value=null;try{if(s)await s();else{const g=await Qe.getStatus();C.value=g}}catch(g){S.value=g.message||"Failed to refresh SmartIR status",console.error("Error refreshing SmartIR status:",g)}finally{f.value=!1}}function Se(){k("create-profile")}function Ie(){a.value=!0}function xe(){window.open("https://github.com/smartHomeHub/SmartIR","_blank")}async function x(){B.value=!0;const g=[];try{for(const p of X)try{const le=((await ne.get(`/api/smartir/platforms/${p}/profiles`)).data.profiles||[]).map(H=>({...H,platform:p}));g.push(...le)}catch(J){console.warn(`Network error loading ${p} profiles (using bundled index):`,J.message)}L.value=g}catch(p){console.error("Unexpected error loading profiles:",p)}finally{B.value=!1}}function d(g,p,J){k("edit-profile",{platform:g,profile:p,startStep:J})}async function V(g,p){var J,le;try{const _=(await ne.get(`/api/smartir/platforms/${g}/profiles/${p.code}`)).data,re=JSON.stringify(_.profile,null,2),G=new Blob([re],{type:"application/json"}),ce=URL.createObjectURL(G),O=document.createElement("a");O.href=ce,O.download=`smartir_${g}_${p.manufacturer}_${p.model}_${p.code}.json`,document.body.appendChild(O),O.click(),document.body.removeChild(O),URL.revokeObjectURL(ce),(J=Ce("toast").value)==null||J.success(`Downloaded ${p.manufacturer} ${p.model}`,"✅ Profile Downloaded")}catch(H){console.error("Error downloading profile:",H),(le=Ce("toast").value)==null||le.error("Failed to download profile","❌ Download Error")}}async function fe(g,p){Ce("toast");try{const le=(await ne.post(`/api/smartir/profiles/${p.code}/check-usage`,{platform:g})).data;if(le&&le.in_use){T.value={show:!0,title:`Cannot Delete ${p.manufacturer} ${p.model}`,message:`This profile is currently in use by ${le.device_count} device(s):

${le.devices.join(`
`)}

Please remove or reassign these devices before deleting the profile.`,platform:g,profile:p,canDelete:!1,devices:le.devices};return}}catch(J){console.error("Error checking profile usage:",J)}T.value={show:!0,title:`Delete ${p.manufacturer} ${p.model}?`,message:`Device Code: ${p.code}

This will remove the profile and update your configuration.`,platform:g,profile:p,canDelete:!0}}async function K(){var le,H;const g=Ce("toast"),{platform:p,profile:J}=T.value;T.value.show=!1;try{await ne.delete(`/api/smartir/profiles/${J.code}`,{data:{platform:p}}),await x(),await Xe(),await pe(),(le=g.value)==null||le.success(`${J.manufacturer} ${J.model} has been removed`,"✅ Profile Deleted")}catch(_){console.error("Error deleting profile:",_),(H=g.value)==null||H.error("Failed to delete profile","❌ Delete Error")}}return ue(h,g=>{g&&(C.value=g)},{immediate:!0}),ue(v,g=>{localStorage.setItem("profile_view_mode",g)}),De(async()=>{var g;h!=null&&h.value&&(C.value=h.value),C.value||await pe(),(g=C.value)!=null&&g.installed&&await x()}),c({loadAllProfiles:x,refreshStatus:pe}),(g,p)=>{var J,le,H,_,re,G,ce,O,i,F;return l(),n("div",Ya,[e("div",Za,[e("button",{class:"icon-button chevron-button",onClick:p[0]||(p[0]=P=>t.value=!t.value)},[e("i",{class:Y(["mdi",t.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2)]),e("div",{class:"header-left",onClick:p[1]||(p[1]=P=>t.value=!t.value)},[e("img",{src:$e(ze),alt:"SmartIR",class:"smartir-logo"},null,8,Qa),p[15]||(p[15]=e("h3",null,"SmartIR Integration",-1)),e("div",ei,[e("div",{class:Y(["simulation-toggle-pill",{active:M.value}]),onClick:ye(E,["stop"]),title:M.value?"Click to show as installed":"Click to simulate not-installed"},[e("i",{class:Y(["mdi",M.value?"mdi-eye-off":"mdi-eye"])},null,2),e("span",null,m(M.value?"Simulating: Not Installed":"Simulation Mode"),1)],10,ti),(J=Z.value)!=null&&J.installed?(l(),n(ve,{key:0},[p[14]||(p[14]=e("div",{class:"status-badge-mini success"},[e("i",{class:"mdi mdi-check-circle"}),e("span",null,"Installed")],-1)),e("span",oi,"v"+m(Z.value.version||"Unknown"),1),e("span",li,m(oe.value)+" platform"+m(oe.value!==1?"s":""),1),e("span",ni,m(de.value)+" device"+m(de.value!==1?"s":""),1)],64)):R("",!0)])]),e("div",si,[(le=Z.value)!=null&&le.installed&&t.value?(l(),n("button",{key:0,onClick:p[2]||(p[2]=ye(P=>$.value=!$.value,["stop"])),class:Y(["icon-button",{active:$.value}]),title:"Show help"},[...p[16]||(p[16]=[e("i",{class:"mdi mdi-help-circle"},null,-1)])],2)):R("",!0),(H=Z.value)!=null&&H.installed&&t.value?(l(),n("button",{key:1,onClick:ye(pe,["stop"]),class:"icon-button",title:"Refresh status"},[...p[17]||(p[17]=[e("i",{class:"mdi mdi-refresh"},null,-1)])])):R("",!0),(_=Z.value)!=null&&_.installed&&t.value?(l(),n("button",{key:2,onClick:ye(Ie,["stop"]),class:"btn btn-secondary"},[...p[18]||(p[18]=[e("i",{class:"mdi mdi-test-tube"},null,-1),I(" Test Codes ",-1)])])):R("",!0),(re=Z.value)!=null&&re.installed&&t.value?(l(),n("button",{key:3,onClick:ye(Se,["stop"]),class:"btn btn-primary"},[...p[19]||(p[19]=[e("i",{class:"mdi mdi-plus"},null,-1),I(" Create SmartIR Profile ",-1)])])):R("",!0)])]),W(e("div",null,[f.value?(l(),n("div",ai,[...p[20]||(p[20]=[e("div",{class:"spinner"},null,-1),e("p",null,"Checking SmartIR installation...",-1)])])):S.value?(l(),n("div",ii,[p[21]||(p[21]=e("i",{class:"mdi mdi-alert-circle"},null,-1)),e("p",null,m(S.value),1),e("button",{onClick:pe,class:"btn-secondary"}," Try Again ")])):(G=Z.value)!=null&&G.installed?(l(),n("div",ri,[$.value?(l(),n("div",di,[C.value.recommendation?(l(),n("div",ui,[e("p",null,m(C.value.recommendation.message),1),C.value.recommendation.next_steps?(l(),n("div",ci,[p[22]||(p[22]=e("strong",null,"Next Steps:",-1)),e("ul",null,[(l(!0),n(ve,null,he(C.value.recommendation.next_steps,(P,ie)=>(l(),n("li",{key:ie},m(P),1))),128))])])):R("",!0)])):R("",!0),e("div",mi,[e("button",{onClick:p[3]||(p[3]=(...P)=>g.viewDocumentation&&g.viewDocumentation(...P)),class:"btn-secondary"},[...p[23]||(p[23]=[e("i",{class:"mdi mdi-book-open-variant"},null,-1),I(" View Documentation ",-1)])])])])):R("",!0),L.value.length>0&&!M.value?(l(),n("div",vi,[e("div",pi,[e("div",fi,[e("label",null,[p[24]||(p[24]=e("i",{class:"mdi mdi-magnify"},null,-1)),W(e("input",{"onUpdate:modelValue":p[4]||(p[4]=P=>U.value.search=P),type:"text",placeholder:"Search profiles...",class:"search-input"},null,512),[[_e,U.value.search]])])]),e("div",gi,[e("label",null,[p[26]||(p[26]=e("i",{class:"mdi mdi-shape"},null,-1)),W(e("select",{"onUpdate:modelValue":p[5]||(p[5]=P=>U.value.platform=P)},[...p[25]||(p[25]=[Ae('<option value="" data-v-4e9a3123>All Platforms</option><option value="climate" data-v-4e9a3123>Climate</option><option value="media_player" data-v-4e9a3123>Media Player</option><option value="fan" data-v-4e9a3123>Fan</option><option value="light" data-v-4e9a3123>Light</option>',5)])],512),[[we,U.value.platform]])])]),te.value?(l(),n("button",{key:0,onClick:me,class:"btn-clear-filters"},[...p[27]||(p[27]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),I(" Clear ",-1)])])):R("",!0),$e(u)?R("",!0):(l(),n("div",yi,[e("button",{onClick:p[6]||(p[6]=P=>v.value="grid"),class:Y(["view-toggle-btn",{active:v.value==="grid"}]),title:"Grid View"},[...p[28]||(p[28]=[e("i",{class:"mdi mdi-view-grid"},null,-1),I(" Grid ",-1)])],2),e("button",{onClick:p[7]||(p[7]=P=>v.value="list"),class:Y(["view-toggle-btn",{active:v.value==="list"}]),title:"List View"},[...p[29]||(p[29]=[e("i",{class:"mdi mdi-view-list"},null,-1),I(" List ",-1)])],2)])),e("div",bi,m(j.value.length)+" of "+m(L.value.length),1)])])):R("",!0),B.value?(l(),n("div",hi,[...p[30]||(p[30]=[e("i",{class:"mdi mdi-loading mdi-spin"},null,-1),e("p",null,"Loading profiles...",-1)])])):L.value.length===0?(l(),n("div",ki,[...p[31]||(p[31]=[e("i",{class:"mdi mdi-file-document-outline"},null,-1),e("h3",null,"No Profiles Yet",-1),e("p",null,"Create your first SmartIR profile to get started",-1)])])):R("",!0),v.value==="grid"&&!M.value?(l(),n("div",wi,[(l(!0),n(ve,null,he(j.value,P=>(l(),Re(Ys,{key:`${P.platform}-${P.code}`,profile:P,onEdit:ie=>d(P.platform,P),onCommands:ie=>d(P.platform,P,2),onDownload:ie=>V(P.platform,P),onDelete:ie=>fe(P.platform,P)},null,8,["profile","onEdit","onCommands","onDownload","onDelete"]))),128))])):v.value==="list"&&!M.value&&j.value.length>0?(l(),Re(ka,{key:5,profiles:j.value,onEdit:p[8]||(p[8]=P=>d(P.platform,P)),onCommands:p[9]||(p[9]=P=>d(P.platform,P,2)),onDownload:p[10]||(p[10]=P=>V(P.platform,P)),onDelete:p[11]||(p[11]=P=>fe(P.platform,P))},null,8,["profiles"])):R("",!0),L.value.length>0&&j.value.length===0&&!M.value?(l(),n("div",$i,[...p[32]||(p[32]=[e("i",{class:"mdi mdi-filter-off"},null,-1),e("h3",null,"No profiles match your filters",-1),e("p",null,"Try adjusting your search or filter criteria",-1)])])):R("",!0)])):(l(),n("div",Ci,[p[36]||(p[36]=e("div",{class:"status-badge warning"},[e("i",{class:"mdi mdi-information"}),e("span",null,"Not Installed")],-1)),e("div",_i,[p[34]||(p[34]=e("h4",null,"Why Install SmartIR?",-1)),e("ul",Si,[(l(!0),n(ve,null,he(((O=(ce=C.value)==null?void 0:ce.recommendation)==null?void 0:O.benefits)||D,(P,ie)=>(l(),n("li",{key:ie},[p[33]||(p[33]=e("i",{class:"mdi mdi-check"},null,-1)),e("span",null,m(P),1)]))),128))])]),e("div",Ii,[e("p",null,m(((F=(i=C.value)==null?void 0:i.recommendation)==null?void 0:F.message)||"Install SmartIR to unlock climate device support!"),1)]),e("div",{class:"card-actions"},[e("button",{onClick:xe,class:"btn-primary"},[...p[35]||(p[35]=[e("i",{class:"mdi mdi-github"},null,-1),I(" Install SmartIR ",-1)])])])]))],512),[[Ye,t.value]]),be(Le,{isOpen:T.value.show,title:T.value.title,message:T.value.message,confirmText:T.value.canDelete===!1?null:"Delete",cancelText:"Close",dangerMode:!0,confirmDisabled:T.value.canDelete===!1,onConfirm:K,onCancel:p[12]||(p[12]=P=>T.value.show=!1)},null,8,["isOpen","title","message","confirmText","confirmDisabled"]),be(Ga,{isOpen:a.value,onClose:p[13]||(p[13]=P=>a.value=!1)},null,8,["isOpen"])])}}},xi=ke(Di,[["__scopeId","data-v-4e9a3123"]]),Ti={class:"climate-form"},Mi={class:"learning-mode-section"},Ri={class:"mode-toggle"},Li={class:"mode-content"},Ai={class:"mode-stats"},Oi={class:"stat-badge"},Ei={class:"stat-badge time"},Vi={class:"mode-content"},Ui={class:"mode-stats"},Pi={class:"stat-badge"},ji={class:"stat-badge time warning"},Fi={key:0,class:"command-breakdown"},Ni={class:"warning-text"},Bi={class:"form-section"},qi={key:0,class:"help-text"},Hi={key:1,class:"help-text"},zi={class:"form-row"},Ji={class:"form-group"},Wi={class:"form-group"},Ki={class:"form-group"},Xi={key:2,class:"representative-temp-section"},Gi={class:"form-group"},Yi=["value"],Zi={class:"form-section"},Qi={class:"checkbox-grid"},er={class:"checkbox-item"},tr={class:"checkbox-item"},or={class:"checkbox-item"},lr={class:"checkbox-item"},nr={class:"checkbox-item"},sr={class:"checkbox-item"},ar={class:"form-section"},ir={class:"checkbox-grid"},rr={class:"checkbox-item"},dr={class:"checkbox-item"},ur={class:"checkbox-item"},cr={class:"checkbox-item"},mr={class:"form-section"},vr={class:"checkbox-grid"},pr={class:"checkbox-item"},fr={class:"checkbox-item"},gr={class:"checkbox-item"},yr={class:"checkbox-item"},br={class:"form-section"},hr={class:"form-group"},kr={class:"form-group"},wr={class:"form-group"},$r={key:0,class:"validation-summary"},Cr={__name:"ClimateProfileForm",props:{modelValue:{type:Object,default:()=>({})}},emits:["update:modelValue"],setup(o,{emit:c}){const r=o,k=c,h=y("quick"),s=y({minTemp:16,maxTemp:30,precision:1,representativeTemp:24,modes:["off","auto","cool","heat"],fanModes:["auto","low","medium","high"],swingModes:[],tempSensor:"",humiditySensor:"",powerSensor:"",learningMode:"quick",...r.modelValue}),u=z(()=>{const T=[],a=s.value.minTemp||16,w=s.value.maxTemp||30,v=s.value.precision||1;for(let D=a;D<=w;D+=v)T.push(D);return T}),f=z(()=>s.value.modes.filter(T=>T!=="off").length),S=z(()=>s.value.fanModes.length||1),C=z(()=>s.value.swingModes.length||1),M=z(()=>{const T=s.value.minTemp||16,a=s.value.maxTemp||30,w=s.value.precision||1;return Math.floor((a-T)/w)+1}),$=z(()=>{const T=s.value.modes.includes("off")?1:0;return f.value*S.value*C.value+T}),t=z(()=>Math.ceil($.value*30/60)),L=z(()=>{const T=s.value.modes.includes("off")?1:0;return f.value*M.value*S.value*C.value+T}),B=z(()=>Math.ceil(L.value*30/60)),U=z(()=>{const T=[];return(!s.value.minTemp||s.value.minTemp<10||s.value.minTemp>35)&&T.push("Minimum temperature must be between 10°C and 35°C"),(!s.value.maxTemp||s.value.maxTemp<10||s.value.maxTemp>35)&&T.push("Maximum temperature must be between 10°C and 35°C"),s.value.minTemp>=s.value.maxTemp&&T.push("Minimum temperature must be less than maximum temperature"),(!s.value.modes||s.value.modes.length===0)&&T.push("At least one HVAC mode must be selected"),T});return ue(h,T=>{s.value.learningMode=T}),ue(s,T=>{k("update:modelValue",T)},{deep:!0,immediate:!0}),(T,a)=>(l(),n("div",Ti,[a[63]||(a[63]=e("h3",null,"Climate Device Configuration",-1)),e("div",Mi,[e("div",Ri,[e("label",{class:Y(["mode-option",{active:h.value==="quick"}])},[W(e("input",{type:"radio",value:"quick","onUpdate:modelValue":a[0]||(a[0]=w=>h.value=w)},null,512),[[Fe,h.value]]),e("div",Li,[a[23]||(a[23]=e("div",{class:"mode-header"},[e("i",{class:"mdi mdi-flash"}),e("strong",null,"Quick Mode (Recommended)")],-1)),a[24]||(a[24]=e("p",null,"Learn one temperature per mode combination",-1)),e("div",Ai,[e("span",Oi,m($.value)+" commands",1),e("span",Ei,"~"+m(t.value)+" min",1)])])],2),e("label",{class:Y(["mode-option",{active:h.value==="complete"}])},[W(e("input",{type:"radio",value:"complete","onUpdate:modelValue":a[1]||(a[1]=w=>h.value=w)},null,512),[[Fe,h.value]]),e("div",Vi,[a[25]||(a[25]=e("div",{class:"mode-header"},[e("i",{class:"mdi mdi-check-all"}),e("strong",null,"Complete Mode")],-1)),a[26]||(a[26]=e("p",null,"Learn all temperature combinations",-1)),e("div",Ui,[e("span",Pi,m(L.value)+" commands",1),e("span",ji,"~"+m(B.value)+" min",1)])])],2)]),h.value==="complete"?(l(),n("div",Fi,[a[27]||(a[27]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[e("strong",null,"Complete mode will require learning "+m(L.value)+" commands",1),e("p",null,"This includes all combinations of modes ("+m(f.value)+"), temperatures ("+m(M.value)+"), fan speeds ("+m(S.value)+"), and swing modes ("+m(C.value)+").",1),e("p",Ni,"⏱️ Estimated time: "+m(B.value)+" minutes at ~30 seconds per command",1)])])):R("",!0)]),e("div",Bi,[a[33]||(a[33]=e("h4",null,"Temperature Range",-1)),h.value==="quick"?(l(),n("p",qi," Define the full temperature range your device supports. You'll select one temperature to learn below. ")):(l(),n("p",Hi," Define the temperature range. All temperatures in this range will be learned. ")),e("div",zi,[e("div",Ji,[a[28]||(a[28]=e("label",null,"Minimum Temperature (°C) *",-1)),W(e("input",{"onUpdate:modelValue":a[2]||(a[2]=w=>s.value.minTemp=w),type:"number",min:"10",max:"35",placeholder:"16"},null,512),[[_e,s.value.minTemp,void 0,{number:!0}]])]),e("div",Wi,[a[29]||(a[29]=e("label",null,"Maximum Temperature (°C) *",-1)),W(e("input",{"onUpdate:modelValue":a[3]||(a[3]=w=>s.value.maxTemp=w),type:"number",min:"10",max:"35",placeholder:"30"},null,512),[[_e,s.value.maxTemp,void 0,{number:!0}]])]),e("div",Ki,[a[31]||(a[31]=e("label",null,"Precision",-1)),W(e("select",{"onUpdate:modelValue":a[4]||(a[4]=w=>s.value.precision=w)},[...a[30]||(a[30]=[e("option",{value:1},"1°C (Whole degrees)",-1),e("option",{value:.5},"0.5°C (Half degrees)",-1)])],512),[[we,s.value.precision,void 0,{number:!0}]])])]),h.value==="quick"?(l(),n("div",Xi,[e("div",Gi,[a[32]||(a[32]=e("label",null,"Representative Temperature to Learn *",-1)),W(e("select",{"onUpdate:modelValue":a[5]||(a[5]=w=>s.value.representativeTemp=w)},[(l(!0),n(ve,null,he(u.value,w=>(l(),n("option",{key:w,value:w},m(w)+"°C ",9,Yi))),128))],512),[[we,s.value.representativeTemp,void 0,{number:!0}]]),e("small",null,"This temperature will be learned for all mode combinations. The device profile will still show the full range ("+m(s.value.minTemp)+"°C - "+m(s.value.maxTemp)+"°C).",1)])])):R("",!0)]),e("div",Zi,[a[40]||(a[40]=e("h4",null,"Supported HVAC Modes *",-1)),a[41]||(a[41]=e("p",{class:"help-text"},"Select all modes your device supports",-1)),e("div",Qi,[e("label",er,[W(e("input",{type:"checkbox",value:"off","onUpdate:modelValue":a[6]||(a[6]=w=>s.value.modes=w)},null,512),[[ge,s.value.modes]]),a[34]||(a[34]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),I(" Off ")],-1))]),e("label",tr,[W(e("input",{type:"checkbox",value:"auto","onUpdate:modelValue":a[7]||(a[7]=w=>s.value.modes=w)},null,512),[[ge,s.value.modes]]),a[35]||(a[35]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-autorenew"}),I(" Auto ")],-1))]),e("label",or,[W(e("input",{type:"checkbox",value:"cool","onUpdate:modelValue":a[8]||(a[8]=w=>s.value.modes=w)},null,512),[[ge,s.value.modes]]),a[36]||(a[36]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-snowflake"}),I(" Cool ")],-1))]),e("label",lr,[W(e("input",{type:"checkbox",value:"heat","onUpdate:modelValue":a[9]||(a[9]=w=>s.value.modes=w)},null,512),[[ge,s.value.modes]]),a[37]||(a[37]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fire"}),I(" Heat ")],-1))]),e("label",nr,[W(e("input",{type:"checkbox",value:"dry","onUpdate:modelValue":a[10]||(a[10]=w=>s.value.modes=w)},null,512),[[ge,s.value.modes]]),a[38]||(a[38]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-water-percent"}),I(" Dry ")],-1))]),e("label",sr,[W(e("input",{type:"checkbox",value:"fan_only","onUpdate:modelValue":a[11]||(a[11]=w=>s.value.modes=w)},null,512),[[ge,s.value.modes]]),a[39]||(a[39]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan"}),I(" Fan Only ")],-1))])])]),e("div",ar,[a[46]||(a[46]=e("h4",null,"Fan Modes",-1)),a[47]||(a[47]=e("p",{class:"help-text"},"Select all fan speeds your device supports",-1)),e("div",ir,[e("label",rr,[W(e("input",{type:"checkbox",value:"auto","onUpdate:modelValue":a[12]||(a[12]=w=>s.value.fanModes=w)},null,512),[[ge,s.value.fanModes]]),a[42]||(a[42]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-autorenew"}),I(" Auto ")],-1))]),e("label",dr,[W(e("input",{type:"checkbox",value:"low","onUpdate:modelValue":a[13]||(a[13]=w=>s.value.fanModes=w)},null,512),[[ge,s.value.fanModes]]),a[43]||(a[43]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-1"}),I(" Low ")],-1))]),e("label",ur,[W(e("input",{type:"checkbox",value:"medium","onUpdate:modelValue":a[14]||(a[14]=w=>s.value.fanModes=w)},null,512),[[ge,s.value.fanModes]]),a[44]||(a[44]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-2"}),I(" Medium ")],-1))]),e("label",cr,[W(e("input",{type:"checkbox",value:"high","onUpdate:modelValue":a[15]||(a[15]=w=>s.value.fanModes=w)},null,512),[[ge,s.value.fanModes]]),a[45]||(a[45]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-3"}),I(" High ")],-1))])])]),e("div",mr,[a[52]||(a[52]=e("h4",null,"Swing Modes (Optional)",-1)),a[53]||(a[53]=e("p",{class:"help-text"},"Select if your device has swing/oscillation",-1)),e("div",vr,[e("label",pr,[W(e("input",{type:"checkbox",value:"off","onUpdate:modelValue":a[16]||(a[16]=w=>s.value.swingModes=w)},null,512),[[ge,s.value.swingModes]]),a[48]||(a[48]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-horizontal"}),I(" Off ")],-1))]),e("label",fr,[W(e("input",{type:"checkbox",value:"vertical","onUpdate:modelValue":a[17]||(a[17]=w=>s.value.swingModes=w)},null,512),[[ge,s.value.swingModes]]),a[49]||(a[49]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-vertical"}),I(" Vertical ")],-1))]),e("label",gr,[W(e("input",{type:"checkbox",value:"horizontal","onUpdate:modelValue":a[18]||(a[18]=w=>s.value.swingModes=w)},null,512),[[ge,s.value.swingModes]]),a[50]||(a[50]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-horizontal"}),I(" Horizontal ")],-1))]),e("label",yr,[W(e("input",{type:"checkbox",value:"both","onUpdate:modelValue":a[19]||(a[19]=w=>s.value.swingModes=w)},null,512),[[ge,s.value.swingModes]]),a[51]||(a[51]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-arrow-all"}),I(" Both ")],-1))])])]),e("div",br,[a[60]||(a[60]=e("h4",null,"Sensors (Optional)",-1)),a[61]||(a[61]=e("p",{class:"help-text"},"Link external sensors for better climate control",-1)),e("div",hr,[a[54]||(a[54]=e("label",null,"Temperature Sensor",-1)),W(e("input",{"onUpdate:modelValue":a[20]||(a[20]=w=>s.value.tempSensor=w),type:"text",placeholder:"sensor.living_room_temperature"},null,512),[[_e,s.value.tempSensor]]),a[55]||(a[55]=e("small",null,"Entity ID of temperature sensor",-1))]),e("div",kr,[a[56]||(a[56]=e("label",null,"Humidity Sensor",-1)),W(e("input",{"onUpdate:modelValue":a[21]||(a[21]=w=>s.value.humiditySensor=w),type:"text",placeholder:"sensor.living_room_humidity"},null,512),[[_e,s.value.humiditySensor]]),a[57]||(a[57]=e("small",null,"Entity ID of humidity sensor",-1))]),e("div",wr,[a[58]||(a[58]=e("label",null,"Power Sensor",-1)),W(e("input",{"onUpdate:modelValue":a[22]||(a[22]=w=>s.value.powerSensor=w),type:"text",placeholder:"binary_sensor.ac_power"},null,512),[[_e,s.value.powerSensor]]),a[59]||(a[59]=e("small",null,"Entity ID of power sensor (to detect on/off state)",-1))])]),U.value.length>0?(l(),n("div",$r,[a[62]||(a[62]=e("h4",null,[e("i",{class:"mdi mdi-alert-circle"}),I(" Please fix the following: ")],-1)),e("ul",null,[(l(!0),n(ve,null,he(U.value,(w,v)=>(l(),n("li",{key:v},m(w),1))),128))])])):R("",!0)]))}},_r=ke(Cr,[["__scopeId","data-v-5674f3f7"]]),Sr={class:"command-wizard"},Ir={class:"device-selection-section"},Dr={class:"input-wrapper"},xr=["value"],Tr={key:0,class:"validation-tooltip"},Mr={class:"form-group"},Rr=["disabled"],Lr={key:0},Ar={key:1},Or={key:0,class:"edit-mode-banner"},Er={class:"wizard-info"},Vr={key:0},Ur={key:1},Pr={class:"progress-info"},jr={class:"progress-bar"},Fr={class:"progress-text"},Nr={class:"commands-grid"},Br={class:"command-header"},qr={class:"command-icon"},Hr={class:"command-info"},zr={key:0,class:"learning-indicator"},Jr={key:0,class:"ir-learning-steps"},Wr={key:1,class:"rf-learning-steps"},Kr={class:"command-actions"},Xr=["onClick","disabled"],Gr={key:1,class:"learned-status"},Yr=["onClick","disabled"],Zr=["onClick"],Qr={class:"quick-actions"},ed=["disabled"],td=["disabled"],od={__name:"CommandLearningWizard",props:{modelValue:{type:Object,default:()=>({})},platform:{type:String,required:!0},config:{type:Object,required:!0},broadlinkDevice:{type:String,default:""},manufacturer:{type:String,required:!0},model:{type:String,required:!0},commandType:{type:String,default:"ir"}},emits:["update:modelValue","update:broadlinkDevice","update:commandType"],setup(o,{emit:c}){const r=Ve(),k=o,h=c,s=y({...k.modelValue}),u=y(null),f=y(null),S=y([]),C=y(k.broadlinkDevice),M=y(k.commandType),$=y(!1),t=y([]),L=y(!1),B=y(!1),U=y({show:!1,commandKey:null,commandLabel:""}),T=y(!1),a=z(()=>{const x=[];if(k.platform==="climate"){const d=k.config.modes||[],V=k.config.fanModes||[],fe=k.config.minTemp||16,K=k.config.maxTemp||30;d.forEach(g=>{if(g==="off")x.push({key:"off",label:"Power Off",description:"Turn device off",icon:"mdi mdi-power",mode:"off"});else for(let p=fe;p<=K;p++)V.forEach(J=>{const le=`${g}_${p}_${J}`;x.push({key:le,label:`${g.toUpperCase()} ${p}°C ${J}`,description:`Mode: ${g}, Temp: ${p}°C, Fan: ${J}`,icon:X(g),mode:g,temp:p,fanMode:J})})})}else if(k.platform==="media_player"){const d=k.config.features||[];d.includes("turn_on")&&(x.push({key:"turn_on",label:"Power On",description:"Turn on the device",icon:"mdi mdi-power"}),x.push({key:"turn_off",label:"Power Off",description:"Turn off the device",icon:"mdi mdi-power-off"})),d.includes("volume")&&(x.push({key:"volume_up",label:"Volume Up",description:"Increase volume",icon:"mdi mdi-volume-plus"}),x.push({key:"volume_down",label:"Volume Down",description:"Decrease volume",icon:"mdi mdi-volume-minus"})),d.includes("mute")&&x.push({key:"mute",label:"Mute",description:"Toggle mute",icon:"mdi mdi-volume-mute"}),d.includes("source")&&(x.push({key:"source_hdmi1",label:"Source: HDMI 1",description:"Switch to HDMI 1",icon:"mdi mdi-import"}),x.push({key:"source_hdmi2",label:"Source: HDMI 2",description:"Switch to HDMI 2",icon:"mdi mdi-import"}),x.push({key:"source_hdmi3",label:"Source: HDMI 3",description:"Switch to HDMI 3",icon:"mdi mdi-import"})),d.includes("channel")&&(x.push({key:"channel_up",label:"Channel Up",description:"Next channel",icon:"mdi mdi-chevron-up"}),x.push({key:"channel_down",label:"Channel Down",description:"Previous channel",icon:"mdi mdi-chevron-down"}))}else if(k.platform==="fan"){const d=k.config.speedLevels||3,V=k.config.features||[];x.push({key:"turn_on",label:"Power On",description:"Turn on the fan",icon:"mdi mdi-power"}),x.push({key:"turn_off",label:"Power Off",description:"Turn off the fan",icon:"mdi mdi-power-off"});for(let fe=1;fe<=d;fe++){const K=fe===1?"Low":fe===d?"High":fe===2&&d===3?"Medium":`Speed ${fe}`;x.push({key:`speed_${fe}`,label:`${K}`,description:`Set fan to speed level ${fe}`,icon:"mdi mdi-fan"})}V.includes("oscillate")&&(x.push({key:"oscillate_on",label:"Oscillate On",description:"Enable oscillation",icon:"mdi mdi-sync"}),x.push({key:"oscillate_off",label:"Oscillate Off",description:"Disable oscillation",icon:"mdi mdi-sync-off"})),V.includes("direction")&&(x.push({key:"direction_forward",label:"Direction: Forward",description:"Set direction to forward",icon:"mdi mdi-rotate-right"}),x.push({key:"direction_reverse",label:"Direction: Reverse",description:"Set direction to reverse",icon:"mdi mdi-rotate-left"}))}else if(k.platform==="light"){const d=k.config.features||[];d.includes("turn_on")&&(x.push({key:"turn_on",label:"Power On",description:"Turn on the light",icon:"mdi mdi-lightbulb-on"}),x.push({key:"turn_off",label:"Power Off",description:"Turn off the light",icon:"mdi mdi-lightbulb-off"})),d.includes("brightness")&&(x.push({key:"brightness_up",label:"Brightness Up",description:"Increase brightness",icon:"mdi mdi-brightness-7"}),x.push({key:"brightness_down",label:"Brightness Down",description:"Decrease brightness",icon:"mdi mdi-brightness-5"})),d.includes("color_temp")&&(x.push({key:"color_temp_warm",label:"Warm White",description:"Set to warm white",icon:"mdi mdi-weather-sunset"}),x.push({key:"color_temp_cool",label:"Cool White",description:"Set to cool white",icon:"mdi mdi-weather-sunny"})),d.includes("rgb")&&(x.push({key:"color_red",label:"Color: Red",description:"Set color to red",icon:"mdi mdi-palette"}),x.push({key:"color_green",label:"Color: Green",description:"Set color to green",icon:"mdi mdi-palette"}),x.push({key:"color_blue",label:"Color: Blue",description:"Set color to blue",icon:"mdi mdi-palette"}))}return x}),w=z(()=>a.value.length),v=z(()=>Object.keys(s.value).length),D=z(()=>w.value===0?0:Math.round(v.value/w.value*100));function X(x){return{off:"mdi mdi-power",auto:"mdi mdi-autorenew",cool:"mdi mdi-snowflake",heat:"mdi mdi-fire",dry:"mdi mdi-water-percent",fan_only:"mdi mdi-fan"}[x]||"mdi mdi-remote"}async function Z(x){if(!u.value){if(!C.value){B.value=!0,window.scrollTo({top:0,behavior:"smooth"});return}B.value=!1,u.value=x.key;try{const d=k.manufacturer.toLowerCase().replace(/[^a-z0-9]+/g,"_"),V=k.model.toLowerCase().replace(/[^a-z0-9]+/g,"_"),fe=`${d}_${V}`,g=(await ne.post("/api/commands/learn",{entity_id:C.value,device:fe,command:x.key,command_type:M.value})).data;if(g.success&&g.code)s.value[x.key]=g.code,h("update:modelValue",s.value),L.value=!0,g.code==="pending"&&console.log(`⏳ Command '${x.key}' learned, code will be fetched from storage when saving`),$.value&&t.value.length>0&&setTimeout(()=>{const p=t.value.shift();p?Z(p):$.value=!1},1e3);else throw new Error(g.error||"Failed to learn command")}catch(d){console.error("Error learning command:",d),r.error(`Error learning command: ${d.message}`),$.value=!1,t.value=[]}finally{$.value||(u.value=null)}}}async function oe(x){var d;if(!C.value){B.value=!0,window.scrollTo({top:0,behavior:"smooth"});return}if(!s.value[x]){(d=r.value)==null||d.error("Command not learned yet");return}f.value=x;try{const V=s.value[x];await ne.post("/api/commands/send-raw",{entity_id:C.value,command:V,command_type:M.value}),r.success("Command sent successfully")}catch(V){console.error("Error testing command:",V),r.error(`Error testing command: ${V.message}`)}finally{f.value=null}}function de(x){const d=a.value.find(V=>V.key===x);U.value={show:!0,commandKey:x,commandLabel:d?d.label:x}}function E(){const x=U.value.commandKey;delete s.value[x],h("update:modelValue",s.value),U.value.show=!1}function j(){const x=a.value.filter(V=>!s.value[V.key]);if(x.length===0)return;$.value=!0,t.value=[...x];const d=t.value.shift();d&&Z(d)}function te(){T.value=!0}function me(){s.value={},h("update:modelValue",s.value),T.value=!1}ue(()=>k.modelValue,x=>{s.value={...x}},{deep:!0}),De(async()=>{await pe()});async function pe(){try{console.log("SmartIR device - commands will be loaded from SmartIR JSON file, not Broadlink storage")}catch(x){console.error("Error in loadExistingCommands:",x)}}function Se(){h("update:broadlinkDevice",C.value)}function Ie(){h("update:commandType",M.value)}async function xe(){try{console.log("🔍 Loading Broadlink devices from /api/remote/devices");const x=await ne.get("/api/remote/devices");console.log("📦 Response data:",x.data);const d=x.data.devices||[];console.log(`✅ Found ${d.length} devices:`,d),S.value=d}catch(x){console.error("❌ Error loading remote devices:",x),S.value=[]}}return ue(()=>k.broadlinkDevice,x=>{C.value=x}),ue(C,x=>{x&&(B.value=!1)}),ue(()=>k.commandType,x=>{M.value=x}),De(async()=>{await xe(),await pe()}),(x,d)=>(l(),n("div",Sr,[d[22]||(d[22]=e("h3",null,"Learn IR Commands",-1)),e("div",Ir,[e("div",{class:Y(["form-group",{"has-error":B.value}])},[d[6]||(d[6]=e("label",null,"Broadlink Device *",-1)),e("div",Dr,[W(e("select",{"onUpdate:modelValue":d[0]||(d[0]=V=>C.value=V),onChange:Se},[d[4]||(d[4]=e("option",{value:""},"Select Broadlink device...",-1)),(l(!0),n(ve,null,he(S.value,V=>(l(),n("option",{key:V.entity_id,value:V.entity_id},m(V.name||V.entity_id),9,xr))),128))],544),[[we,C.value]]),B.value?(l(),n("div",Tr,[...d[5]||(d[5]=[e("i",{class:"mdi mdi-alert"},null,-1),I(" Device is required ",-1)])])):R("",!0)]),e("small",null,"This device will be used to learn commands ("+m(S.value.length)+" devices found)",1)],2),e("div",Mr,[d[8]||(d[8]=e("label",null,"Command Type *",-1)),W(e("select",{"onUpdate:modelValue":d[1]||(d[1]=V=>M.value=V),onChange:Ie,disabled:v.value>0},[...d[7]||(d[7]=[e("option",{value:"ir"},"📡 Infrared (IR) - Most common for AC, TV, etc.",-1),e("option",{value:"rf"},"📻 Radio Frequency (RF) - For RF remotes",-1)])],40,Rr),[[we,M.value]]),v.value>0?(l(),n("small",Lr,"Command type cannot be changed after learning commands")):(l(),n("small",Ar,"Select the type of commands your device uses"))])]),v.value>0&&!L.value?(l(),n("div",Or,[d[10]||(d[10]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[d[9]||(d[9]=e("strong",null,"Editing Existing Profile",-1)),e("p",null,m(v.value)+" command"+m(v.value!==1?"s":"")+' already learned. You can re-learn any command by clicking the delete icon and then "Learn Command".',1)])])):R("",!0),e("div",Er,[d[14]||(d[14]=e("i",{class:"mdi mdi-information"},null,-1)),e("div",null,[d[13]||(d[13]=e("p",null,[e("strong",null,"How it works:")],-1)),o.commandType==="ir"?(l(),n("ol",Vr,[...d[11]||(d[11]=[e("li",null,'Click "Learn Command" for each combination',-1),e("li",null,[e("strong",null,"Point your IR remote directly at the Broadlink device")],-1),e("li",null,"Press the button on your remote",-1),e("li",null,"Wait for confirmation (up to 30 seconds)",-1)])])):(l(),n("ol",Ur,[...d[12]||(d[12]=[e("li",null,'Click "Learn Command" for each combination',-1),e("li",null,[e("strong",null,"Step 1:"),I(" Hold button on remote - Broadlink scans for RF frequency")],-1),e("li",null,[e("strong",null,"Step 2:"),I(" Watch for Home Assistant notification, then press and release button")],-1),e("li",null,"Keep remote within 5cm of Broadlink (RF doesn't need line-of-sight)",-1),e("li",null,"Wait for confirmation (may take up to 30 seconds)",-1)])]))])]),e("div",Pr,[e("div",jr,[e("div",{class:"progress-fill",style:lt({width:D.value+"%"})},null,4)]),e("span",Fr,m(v.value)+" / "+m(w.value)+" commands learned ("+m(D.value)+"%) ",1)]),e("div",Nr,[(l(!0),n(ve,null,he(a.value,V=>(l(),n("div",{key:V.key,class:Y(["command-card",{learned:s.value[V.key],learning:u.value===V.key}])},[e("div",Br,[e("div",qr,[e("i",{class:Y(V.icon)},null,2)]),e("div",Hr,[e("h4",null,m(V.label),1),e("p",null,m(V.description),1)])]),u.value===V.key?(l(),n("div",zr,[o.commandType==="ir"?(l(),n("div",Jr,[...d[15]||(d[15]=[e("p",null,[e("strong",null,"Point your remote directly at the Broadlink device and press the button.")],-1),e("small",null,"Listening for up to 30 seconds...",-1)])])):(l(),n("div",Wr,[...d[16]||(d[16]=[e("p",{class:"rf-title"},[e("strong",null,"Learning request sent to device.")],-1),e("p",{class:"rf-subtitle"},[I("RF learning is a "),e("strong",null,"two-step process"),I(":")],-1),e("ol",null,[e("li",null,[e("strong",null,"Step 1 - Frequency Sweep (~10-15 seconds):"),I(" Press and hold the button on your remote until the notification updates. ")]),e("li",null,[e("strong",null,"Step 2 - Learn Signal:"),I(" Press and release the button once. ")])],-1),e("p",{class:"rf-note"},"Follow the Home Assistant notifications (🔔) for real-time instructions.",-1)])]))])):R("",!0),e("div",Kr,[s.value[V.key]?(l(),n("div",Gr,[d[18]||(d[18]=e("i",{class:"mdi mdi-check-circle"},null,-1)),d[19]||(d[19]=e("span",null,"Learned",-1)),e("span",{class:Y(["command-type-badge",M.value])},m(M.value.toUpperCase()),3),e("button",{onClick:fe=>oe(V.key),class:"icon-btn",title:"Test command",disabled:f.value===V.key,style:{"margin-left":"auto"}},[e("i",{class:Y(["mdi mdi-play",{"mdi-spin":f.value===V.key}])},null,2)],8,Yr),e("button",{onClick:fe=>de(V.key),class:"icon-btn danger",title:"Delete and re-learn"},[...d[17]||(d[17]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,Zr)])):(l(),n("button",{key:0,onClick:fe=>Z(V),class:Y(["btn-learn",{learning:u.value===V.key}]),disabled:u.value!==null},[e("i",{class:Y(["mdi mdi-radio-tower",{"mdi-spin":u.value===V.key}])},null,2),I(" "+m(u.value===V.key?"Listening...":"Learn Command"),1)],10,Xr))])],2))),128))]),e("div",Qr,[e("button",{onClick:j,class:"btn-secondary",disabled:u.value!==null||v.value===w.value},[...d[20]||(d[20]=[e("i",{class:"mdi mdi-play-circle"},null,-1),I(" Learn All Remaining ",-1)])],8,ed),e("button",{onClick:te,class:"btn-text",disabled:v.value===0},[...d[21]||(d[21]=[e("i",{class:"mdi mdi-delete-sweep"},null,-1),I(" Clear All ",-1)])],8,td)]),be(Le,{isOpen:U.value.show,title:"Delete Learned Command?",message:`Are you sure you want to delete the '${U.value.commandLabel}' command?

You will need to re-learn this command.`,confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,onConfirm:E,onCancel:d[2]||(d[2]=V=>U.value.show=!1)},null,8,["isOpen","message"]),be(Le,{isOpen:T.value,title:"Delete All Learned Commands?",message:"Are you sure you want to delete all learned commands? This cannot be undone.\\n\\nYou will need to re-learn all commands.",confirmText:"Delete All",cancelText:"Cancel",dangerMode:!0,onConfirm:me,onCancel:d[3]||(d[3]=V=>T.value=!1)},null,8,["isOpen"])]))}},ld=ke(od,[["__scopeId","data-v-84fe090b"]]),nd={class:"profile-preview"},sd={class:"preview-summary"},ad={class:"summary-card"},id={class:"stats-grid"},rd={class:"stat-item"},dd={class:"stat-value"},ud={class:"stat-item"},cd={class:"stat-value"},md={class:"stat-item"},vd={class:"stat-value"},pd={class:"preview-tabs"},fd={class:"preview-content"},gd={key:0,class:"tab-content"},yd={class:"code-header"},bd={class:"code-block"},hd={key:1,class:"tab-content"},kd={class:"code-header"},wd={class:"code-block"},$d={key:2,class:"tab-content"},Cd={class:"instructions"},_d={class:"step-item"},Sd={class:"step-content"},Id={class:"code-path"},Dd={__name:"ProfilePreview",props:{profile:{type:Object,required:!0},jsonData:{type:Object,required:!0},yamlConfig:{type:String,required:!0}},setup(o){const c=Ve(),r=o,k=y("json"),h=y(!1),s=y(!1),u=z(()=>Object.keys(r.profile.commands||{}).length),f=z(()=>JSON.stringify(r.jsonData,null,2));async function S(){try{await navigator.clipboard.writeText(f.value),h.value=!0,setTimeout(()=>{h.value=!1},2e3)}catch(M){console.error("Failed to copy JSON:",M),c.error("Failed to copy to clipboard")}}async function C(){try{await navigator.clipboard.writeText(r.yamlConfig),s.value=!0,setTimeout(()=>{s.value=!1},2e3)}catch(M){console.error("Failed to copy YAML:",M),c.error("Failed to copy to clipboard")}}return(M,$)=>{var t;return l(),n("div",nd,[$[22]||($[22]=e("h3",null,"Preview & Save",-1)),e("div",sd,[e("div",ad,[$[4]||($[4]=e("i",{class:"mdi mdi-check-circle"},null,-1)),e("div",null,[$[3]||($[3]=e("h4",null,"Profile Ready!",-1)),e("p",null,m(o.profile.manufacturer)+" "+m(o.profile.model),1)])]),e("div",id,[e("div",rd,[e("span",dd,m(u.value),1),$[5]||($[5]=e("span",{class:"stat-label"},"Commands Learned",-1))]),e("div",ud,[e("span",cd,m(o.profile.platform),1),$[6]||($[6]=e("span",{class:"stat-label"},"Platform",-1))]),e("div",md,[e("span",vd,m(((t=o.profile.config.modes)==null?void 0:t.length)||0),1),$[7]||($[7]=e("span",{class:"stat-label"},"HVAC Modes",-1))])])]),e("div",pd,[e("button",{onClick:$[0]||($[0]=L=>k.value="json"),class:Y(["tab-button",{active:k.value==="json"}])},[...$[8]||($[8]=[e("i",{class:"mdi mdi-code-json"},null,-1),I(" SmartIR JSON ",-1)])],2),e("button",{onClick:$[1]||($[1]=L=>k.value="yaml"),class:Y(["tab-button",{active:k.value==="yaml"}])},[...$[9]||($[9]=[e("i",{class:"mdi mdi-file-code"},null,-1),I(" YAML Config ",-1)])],2),e("button",{onClick:$[2]||($[2]=L=>k.value="instructions"),class:Y(["tab-button",{active:k.value==="instructions"}])},[...$[10]||($[10]=[e("i",{class:"mdi mdi-information"},null,-1),I(" Instructions ",-1)])],2)]),e("div",fd,[k.value==="json"?(l(),n("div",gd,[e("div",yd,[$[12]||($[12]=e("h4",null,"SmartIR Device Code JSON",-1)),e("button",{onClick:S,class:"btn-copy"},[$[11]||($[11]=e("i",{class:"mdi mdi-content-copy"},null,-1)),I(" "+m(h.value?"Copied!":"Copy"),1)])]),e("pre",bd,[e("code",null,m(f.value),1)]),$[13]||($[13]=e("p",{class:"code-note"},[e("i",{class:"mdi mdi-information"}),I(" Save this as "),e("code",null,"10000.json"),I(" in your SmartIR codes directory ")],-1))])):R("",!0),k.value==="yaml"?(l(),n("div",hd,[e("div",kd,[$[15]||($[15]=e("h4",null,"Home Assistant Configuration",-1)),e("button",{onClick:C,class:"btn-copy"},[$[14]||($[14]=e("i",{class:"mdi mdi-content-copy"},null,-1)),I(" "+m(s.value?"Copied!":"Copy"),1)])]),e("pre",wd,[e("code",null,m(o.yamlConfig),1)]),$[16]||($[16]=e("p",{class:"code-note"},[e("i",{class:"mdi mdi-information"}),I(" Add this to your "),e("code",null,"configuration.yaml"),I(" file ")],-1))])):R("",!0),k.value==="instructions"?(l(),n("div",$d,[e("div",Cd,[$[20]||($[20]=e("h4",null,"Installation Steps",-1)),e("div",_d,[$[19]||($[19]=e("div",{class:"step-number"},"1",-1)),e("div",Sd,[$[17]||($[17]=e("h5",null,"Get Next Code Number",-1)),$[18]||($[18]=e("p",null,"Custom device codes start at 10000. Check your SmartIR codes directory to find the next available number.",-1)),e("div",Id,[e("code",null,"/config/custom_components/smartir/codes/"+m(o.profile.platform)+"/",1)])])]),$[21]||($[21]=Ae('<div class="step-item" data-v-cbf0874d><div class="step-number" data-v-cbf0874d>2</div><div class="step-content" data-v-cbf0874d><h5 data-v-cbf0874d>Save JSON File</h5><p data-v-cbf0874d>Copy the JSON from the &quot;SmartIR JSON&quot; tab and save it as <code data-v-cbf0874d>10000.json</code> (or your next available number) in the codes directory.</p></div></div><div class="step-item" data-v-cbf0874d><div class="step-number" data-v-cbf0874d>3</div><div class="step-content" data-v-cbf0874d><h5 data-v-cbf0874d>Update Configuration</h5><p data-v-cbf0874d>Copy the YAML from the &quot;YAML Config&quot; tab and add it to your <code data-v-cbf0874d>configuration.yaml</code> file. Update the <code data-v-cbf0874d>device_code</code> to match your JSON filename.</p></div></div><div class="step-item" data-v-cbf0874d><div class="step-number" data-v-cbf0874d>4</div><div class="step-content" data-v-cbf0874d><h5 data-v-cbf0874d>Restart Home Assistant</h5><p data-v-cbf0874d>Restart Home Assistant to load the new configuration. Your climate entity will appear in the UI.</p></div></div><div class="step-item" data-v-cbf0874d><div class="step-number" data-v-cbf0874d>5</div><div class="step-content" data-v-cbf0874d><h5 data-v-cbf0874d>Test Your Device</h5><p data-v-cbf0874d>Go to your climate entity and test different modes, temperatures, and fan speeds to ensure everything works correctly.</p></div></div><div class="tips-section" data-v-cbf0874d><h4 data-v-cbf0874d><i class="mdi mdi-lightbulb" data-v-cbf0874d></i> Tips </h4><ul data-v-cbf0874d><li data-v-cbf0874d>Keep a backup of your JSON file in case you need to modify it</li><li data-v-cbf0874d>Test all commands to ensure they work as expected</li><li data-v-cbf0874d>You can share your profile with the SmartIR community on GitHub</li><li data-v-cbf0874d>If a command doesn&#39;t work, you can re-learn it and update the JSON</li></ul></div>',5))])])):R("",!0)])])}}},xd=ke(Dd,[["__scopeId","data-v-cbf0874d"]]),Td={class:"wizard-body"},Md={key:0,class:"warning-section"},Rd={class:"warning-box"},Ld={class:"instructions"},Ad={class:"code-block"},Od={class:"steps"},Ed={key:0},Vd={class:"help-section"},Ud={key:0,class:"help-content"},Pd={class:"help-step"},jd={key:0,class:"help-step"},Fd={class:"help-step"},Nd={class:"help-step"},Bd={class:"checklist"},qd={class:"checkbox-label"},Hd={key:0,class:"checkbox-label"},zd={class:"wizard-footer"},Jd=["disabled"],Wd={__name:"SmartIRSetupWizard",props:{show:{type:Boolean,default:!1},platform:{type:String,required:!0},warnings:{type:Array,default:()=>[]},configPath:{type:String,default:"/config"}},emits:["close","complete"],setup(o,{emit:c}){const r=o,k=c,h=Ce("toast"),s=y(!1),u=y(!1),f=y(!1),S=z(()=>r.warnings.length>0?s.value&&u.value:s.value);function C(){const $=`${r.platform}: !include smartir/${r.platform}.yaml`;navigator.clipboard.writeText($).then(()=>{var t;(t=h.value)==null||t.success("Include line copied to clipboard!","✅ Copied")}).catch(t=>{var L;console.error("Failed to copy:",t),(L=h.value)==null||L.error("Failed to copy to clipboard","❌ Copy Failed")})}function M(){k("complete")}return($,t)=>o.show?(l(),n("div",{key:0,class:"modal-overlay",onClick:t[5]||(t[5]=ye(()=>{},["stop"]))},[e("div",{class:"setup-wizard",onClick:t[4]||(t[4]=ye(()=>{},["stop"]))},[t[31]||(t[31]=e("div",{class:"wizard-header"},[e("h2",null,[e("i",{class:"mdi mdi-cog"}),I(" SmartIR Configuration Setup ")])],-1)),e("div",Td,[o.warnings.length>0?(l(),n("div",Md,[e("div",Rd,[t[11]||(t[11]=e("i",{class:"mdi mdi-alert"},null,-1)),e("div",null,[t[9]||(t[9]=e("h3",null,"⚠️ Configuration Migration Needed",-1)),t[10]||(t[10]=e("p",null,"We detected existing platform entries in your configuration.yaml:",-1)),e("ul",null,[(l(!0),n(ve,null,he(o.warnings,L=>(l(),n("li",{key:L.platform},[e("strong",null,m(L.platform)+":",1),I(" "+m(L.message),1)]))),128))]),e("p",null,[t[6]||(t[6]=e("strong",null,"Action Required:",-1)),t[7]||(t[7]=I(" Move these entries to ",-1)),e("code",null,"smartir/"+m(o.platform)+".yaml",1),t[8]||(t[8]=I(" before continuing.",-1))])])])])):R("",!0),e("div",Ld,[t[27]||(t[27]=e("h3",null,"📝 One-Time Setup",-1)),t[28]||(t[28]=e("p",null,[I("To enable SmartIR device management, add this line to your "),e("code",null,"configuration.yaml"),I(":")],-1)),e("div",Ad,[e("code",null,m(o.platform)+": !include smartir/"+m(o.platform)+".yaml",1),e("button",{onClick:C,class:"copy-btn",title:"Copy to clipboard"},[...t[12]||(t[12]=[e("i",{class:"mdi mdi-content-copy"},null,-1)])])]),e("div",Od,[t[19]||(t[19]=e("h4",null,"Steps:",-1)),e("ol",null,[o.warnings.length>0?(l(),n("li",Ed,[t[13]||(t[13]=e("strong",null,"Move existing entries:",-1)),t[14]||(t[14]=I(" Copy any existing ",-1)),e("code",null,m(o.platform)+":",1),t[15]||(t[15]=I(" entries from configuration.yaml to ",-1)),e("code",null,"smartir/"+m(o.platform)+".yaml",1)])):R("",!0),t[16]||(t[16]=e("li",null,[e("strong",null,"Add include line:"),I(" Add the line above to your configuration.yaml ")],-1)),t[17]||(t[17]=e("li",null,[e("strong",null,"Save changes:"),I(" Save configuration.yaml ")],-1)),t[18]||(t[18]=e("li",null,[e("strong",null,"Continue here:"),I(` Click "I've Completed Setup" below `)],-1))])]),e("div",Vd,[e("button",{onClick:t[0]||(t[0]=L=>f.value=!f.value),class:"help-toggle"},[e("i",{class:Y(["mdi",f.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2),I(" "+m(f.value?"Hide":"Show")+" Detailed Instructions ",1)]),f.value?(l(),n("div",Ud,[t[26]||(t[26]=e("h4",null,"Detailed Setup Guide:",-1)),e("div",Pd,[t[21]||(t[21]=e("h5",null,"1. Open configuration.yaml",-1)),e("p",null,[t[20]||(t[20]=I("Location: ",-1)),e("code",null,m(o.configPath)+"/configuration.yaml",1)])]),o.warnings.length>0?(l(),n("div",jd,[t[22]||(t[22]=e("h5",null,"2. Migrate Existing Entries (If Any)",-1)),e("p",null,"If you have existing "+m(o.platform)+" entries, cut them from configuration.yaml and paste into:",1),e("p",null,[e("code",null,m(o.configPath)+"/smartir/"+m(o.platform)+".yaml",1)]),t[23]||(t[23]=e("p",{class:"note"},"Broadlink Manager will create this file automatically.",-1))])):R("",!0),e("div",Fd,[e("h5",null,m(o.warnings.length>0?"3":"2")+". Add Include Line",1),t[24]||(t[24]=e("p",null,"Add this to configuration.yaml:",-1)),e("pre",null,m(o.platform)+": !include smartir/"+m(o.platform)+".yaml",1)]),e("div",Nd,[e("h5",null,m(o.warnings.length>0?"4":"3")+". Restart Home Assistant",1),t[25]||(t[25]=e("p",null,"After saving, you'll need to restart HA for changes to take effect.",-1))])])):R("",!0)])]),e("div",Bd,[e("label",qd,[W(e("input",{type:"checkbox","onUpdate:modelValue":t[1]||(t[1]=L=>s.value=L)},null,512),[[ge,s.value]]),t[29]||(t[29]=e("span",null,"I've added the include line to configuration.yaml",-1))]),o.warnings.length>0?(l(),n("label",Hd,[W(e("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=L=>u.value=L)},null,512),[[ge,u.value]]),e("span",null,"I've migrated existing "+m(o.platform)+" entries (if any)",1)])):R("",!0)])]),e("div",zd,[e("button",{onClick:t[3]||(t[3]=L=>$.$emit("close")),class:"btn-secondary"}," Cancel "),e("button",{onClick:M,class:"btn-primary",disabled:!S.value},[...t[30]||(t[30]=[e("i",{class:"mdi mdi-check"},null,-1),I(" I've Completed Setup ",-1)])],8,Jd)])])])):R("",!0)}},Kd=ke(Wd,[["__scopeId","data-v-f6fe4c03"]]),Xd={class:"modal-header"},Gd={class:"progress-steps"},Yd={class:"step-number"},Zd={key:0,class:"mdi mdi-check"},Qd={key:1},eu={class:"step-label"},tu={class:"modal-body"},ou={key:0,class:"step-content"},lu={class:"form-group"},nu={class:"form-group"},su={class:"form-group"},au={key:1,class:"step-content"},iu={key:1,class:"platform-form"},ru={class:"form-section"},du={class:"checkbox-grid"},uu={class:"checkbox-item"},cu={class:"checkbox-item"},mu={class:"checkbox-item"},vu={class:"checkbox-item"},pu={class:"checkbox-item"},fu={key:2,class:"platform-form"},gu={class:"form-section"},yu={class:"form-group"},bu={class:"form-section"},hu={class:"checkbox-grid"},ku={class:"checkbox-item"},wu={class:"checkbox-item"},$u={key:3,class:"platform-form"},Cu={class:"form-section"},_u={class:"checkbox-grid"},Su={class:"checkbox-item"},Iu={class:"checkbox-item"},Du={class:"checkbox-item"},xu={class:"checkbox-item"},Tu={key:2,class:"step-content"},Mu={key:3,class:"step-content"},Ru={class:"modal-footer"},Lu=["disabled"],Au={key:2,class:"save-buttons"},Ou=["disabled"],Eu=["disabled"],Vu={__name:"SmartIRProfileBuilder",props:{show:{type:Boolean,default:!1},editMode:{type:Boolean,default:!1},editData:{type:Object,default:null},startStep:{type:Number,default:0}},emits:["close","save"],setup(o,{emit:c}){const r=o,k=c,h=Ce("toast"),s=y(0),u=y(!1),f=y([]),S=y(!1),C=y([]),M=y("/config"),$=y(!1),t=y(null),L=y(!1),B=y(!1),U=y(""),T=y("ir"),a=y(!1),w=[{label:"Device Info",key:"info"},{label:"Configuration",key:"config"},{label:"Learn Commands",key:"commands"},{label:"Preview & Save",key:"preview"}],v=y({platform:"",manufacturer:"",model:"",broadlinkDevice:"",commandType:"ir",config:{},commands:{}}),D=y(["turn_on"]),X=y(3),Z=y([]),oe=y(["turn_on"]);ue(()=>v.value.platform,O=>{O==="media_player"?v.value.config={features:D.value}:O==="fan"?v.value.config={speedLevels:X.value,features:Z.value}:O==="light"&&(v.value.config={features:oe.value})}),ue(D,O=>{v.value.platform==="media_player"&&(v.value.config={features:O})},{deep:!0}),ue(X,O=>{v.value.platform==="fan"&&(v.value.config={speedLevels:O,features:Z.value})}),ue(Z,O=>{v.value.platform==="fan"&&(v.value.config={speedLevels:X.value,features:O})},{deep:!0}),ue(oe,O=>{v.value.platform==="light"&&(v.value.config={features:O})},{deep:!0});function de(O){const i=new Set,F=Object.keys(O);return F.some(P=>P==="off"||P.includes("_off"))&&i.add("off"),F.some(P=>P.includes("auto"))&&i.add("auto"),F.some(P=>P.includes("cool"))&&i.add("cool"),F.some(P=>P.includes("heat"))&&i.add("heat"),F.some(P=>P.includes("dry"))&&i.add("dry"),F.some(P=>P.includes("fan_only"))&&i.add("fan_only"),Array.from(i)}function E(O){const i=new Set,F=Object.keys(O);return F.some(P=>P.includes("auto"))&&i.add("auto"),F.some(P=>P.includes("low"))&&i.add("low"),F.some(P=>P.includes("medium")||P.includes("mid"))&&i.add("medium"),F.some(P=>P.includes("high"))&&i.add("high"),Array.from(i)}function j(O){const i=new Set,F=Object.keys(O);return F.some(P=>P.includes("swing_off")||P.includes("_off"))&&i.add("off"),F.some(P=>P.includes("vertical"))&&i.add("vertical"),F.some(P=>P.includes("horizontal"))&&i.add("horizontal"),F.some(P=>P.includes("both"))&&i.add("both"),Array.from(i)}function te(O){for(const i of Object.values(O))if(typeof i=="string"&&i.startsWith("sc")||Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0].startsWith("sc"))return"rf";return"ir"}ue(()=>v.value.commandType,(O,i)=>{!i||L.value||a.value||(Object.keys(v.value.commands).length>0&&O!==i?(U.value=O,v.value.commandType=i,L.value=!0):O!==i&&(T.value=O))}),ue(()=>r.editData,async O=>{var i,F,P;if(O&&r.editMode){console.log("🔧 Edit mode activated, loading profile data:",O),a.value=!0,f.value.length===0&&(console.log("📡 Loading Broadlink devices..."),await ce(),console.log("📡 Devices loaded:",f.value.length));const ie=O.profile,A=ie.controller_data;console.log("🎮 Controller data from profile:",A),console.log("🎮 Available devices:",f.value.map(Q=>Q.entity_id));const b=ie.commands||{},q=ie.commandType||te(b);console.log("🔍 Command type (stored):",ie.commandType),console.log("🔍 Command type (final):",q);let N={};if(O.platform==="climate"){const Q=ie.operationModes||de(b),ae=ie.fanModes||E(b),se=ie.swingModes||j(b);console.log("🔍 Inferred modes:",Q),console.log("🔍 Inferred fan modes:",ae),console.log("🔍 Inferred swing modes:",se),N={minTemp:ie.minTemperature,maxTemp:ie.maxTemperature,precision:ie.precision,modes:Q,fanModes:ae,swingModes:se}}else if(O.platform==="media_player"){const Q=[];(b.on||b.off)&&Q.push("turn_on"),(b.volumeUp||b.volumeDown)&&Q.push("volume"),b.mute&&Q.push("mute"),b.sources&&Q.push("source"),(b.channelUp||b.channelDown)&&Q.push("channel"),N={features:Q},D.value=Q,console.log("🔍 Inferred media player features:",Q)}else if(O.platform==="fan"){const Q=((i=ie.speed)==null?void 0:i.length)||Object.keys(b.default||{}).length||3,ae=[];(b.oscillate_on||b.oscillate_off)&&ae.push("oscillate"),(b.direction_forward||b.direction_reverse)&&ae.push("direction"),N={speedLevels:Q,features:ae},X.value=Q,Z.value=ae,console.log("🔍 Inferred fan config:",N)}else if(O.platform==="light"){const Q=[];N={features:Q},oe.value=Q,console.log("🔍 Inferred light features:",Q)}const ee=await _(ie.manufacturer,(F=ie.supportedModels)==null?void 0:F[0],b);v.value={platform:O.platform,manufacturer:ie.manufacturer||"",model:((P=ie.supportedModels)==null?void 0:P[0])||"",broadlinkDevice:A||"",commandType:q,config:N,commands:ee},console.log("✅ Profile populated:",v.value),console.log("✅ Selected device:",v.value.broadlinkDevice),console.log("✅ Command type:",v.value.commandType),console.log("✅ Commands (with learned codes):",ee),T.value=q,setTimeout(()=>{a.value=!1},100)}},{immediate:!0});const me=z(()=>{var O;switch(s.value){case 0:return v.value.platform&&v.value.manufacturer&&v.value.model;case 1:return v.value.platform==="climate"?v.value.config.minTemp&&v.value.config.maxTemp&&((O=v.value.config.modes)==null?void 0:O.length)>0:!0;case 2:return v.value.broadlinkDevice&&v.value.commandType&&Object.keys(v.value.commands).length>0;case 3:return!0;default:return!1}}),pe=y(null);async function Se(){if(s.value!==3){pe.value=null;return}if(console.log("🔍 Generating JSON with commands:",v.value.commands),Object.values(v.value.commands).some(i=>typeof i=="string"?i==="pending":typeof i=="object"?Object.values(i).some(F=>typeof F=="string"?F==="pending":typeof F=="object"?Object.values(F).some(P=>P==="pending"):!1):!1)){console.warn('⚠️ Commands still contain "pending" placeholders!'),console.log("📦 Attempting to fetch from Broadlink storage...");const i=await _(v.value.manufacturer,v.value.model,v.value.commands);v.value.commands=i,console.log("✅ Updated commands:",i)}pe.value=re(v.value),console.log("📄 Generated JSON:",pe.value)}const Ie=z(()=>s.value!==3?null:G(v.value));function xe(){v.value.config={},v.value.commands={}}function x(){L.value=!1,v.value.commandType=U.value,T.value=U.value,v.value.commands={},U.value=""}function d(){L.value=!1,U.value=""}async function V(){s.value<w.length-1&&(s.value++,s.value===3&&await Se())}function fe(){s.value>0&&s.value--}function K(){L.value||(B.value=!0)}function g(){B.value=!1,p()}function p(){k("close"),setTimeout(()=>{s.value=0,v.value={platform:"",manufacturer:"",model:"",broadlinkDevice:"",commandType:"ir",config:{},commands:{}},T.value="ir"},300)}async function J(){var O,i,F,P,ie,A;u.value=!0;try{if(!$.value){const ae=(await ne.get("/api/smartir/config/check")).data;if(ae&&!((O=ae.platforms[v.value.platform])==null?void 0:O.file_exists)){C.value=ae.configuration_warnings||[],M.value=ae.config_path||"/config",t.value={platform:v.value.platform,json:pe.value},S.value=!0,u.value=!1;return}}let b;r.editMode&&((i=r.editData)!=null&&i.code)?(b=parseInt(r.editData.code),console.log("📝 Edit mode: Using existing code",b)):(b=(await ne.get(`/api/smartir/platforms/${v.value.platform}/next-code`)).data.next_code,console.log("✨ New profile: Using next code",b));const N=(await ne.post("/api/smartir/profiles",{platform:v.value.platform,json:pe.value,code_number:b})).data,ee={platform:"smartir",name:`${v.value.manufacturer} ${v.value.model}`,unique_id:`${v.value.manufacturer.toLowerCase().replace(/[^a-z0-9]+/g,"_")}_${v.value.model.toLowerCase().replace(/[^a-z0-9]+/g,"_")}`,device_code:b,controller_data:v.value.broadlinkDevice};try{await ne.post("/api/smartir/config/add-device",{platform:v.value.platform,device_config:{platform:"smartir",name:ee.name,unique_id:ee.unique_id,device_code:ee.device_code,controller_data:ee.controller_data}})}catch(Q){console.error("Failed to add device to config:",Q);const ae=((F=Q.response)==null?void 0:F.data)||{};let se=ae.error||"Unknown error";ae.validation_errors&&ae.validation_errors.length>0&&(se=`Device configuration validation failed:
`+ae.validation_errors.map(Te=>`  • ${Te}`).join(`
`)),(P=h.value)==null||P.warning(`Profile saved but failed to add to config file:
${se}`,"⚠️ Partial Success")}k("save",{json:pe.value,yaml:Ie.value,profile:v.value,saved_to:N.path}),(ie=h.value)==null||ie.success(`File: ${N.filename}
Device Code: ${b}
Added to: smartir/${v.value.platform}.yaml

⚠️ Restart Home Assistant to activate`,"✅ Profile Saved Successfully!"),p()}catch(b){console.error("Error saving profile:",b),(A=h.value)==null||A.error(b.message,"❌ Error Saving Profile")}finally{u.value=!1}}async function le(){$.value=!0,S.value=!1,t.value&&(await J(),t.value=null)}function H(){var O,i;try{const F=JSON.stringify(pe.value,null,2),P=new Blob([F],{type:"application/json"}),ie=URL.createObjectURL(P),A=document.createElement("a");A.href=ie;const b=v.value.manufacturer.toLowerCase().replace(/\s+/g,"_"),q=v.value.model.toLowerCase().replace(/\s+/g,"_");A.download=`smartir_${v.value.platform}_${b}_${q}.json`,document.body.appendChild(A),A.click(),document.body.removeChild(A),URL.revokeObjectURL(ie),(O=h.value)==null||O.success("You can manually upload this file to your SmartIR codes directory.","✅ Profile Downloaded")}catch(F){console.error("Error downloading profile:",F),(i=h.value)==null||i.error(F.message,"❌ Error Downloading Profile")}}async function _(O,i,F){const P=O.toLowerCase().replace(/[^a-z0-9]+/g,"_"),ie=i.toLowerCase().replace(/[^a-z0-9]+/g,"_"),A=`${P}_${ie}`;try{const N=(await ne.get("/api/commands/all")).data[A]||{};console.log(`🔍 Fetching learned commands for device: ${A}`),console.log("📦 Device commands from storage:",N);const ee={...F};for(const[Q,ae]of Object.entries(ee))if(ae==="pending"&&N[Q])ee[Q]=N[Q];else if(typeof ae=="object"){for(const[se,Te]of Object.entries(ae))if(typeof Te=="object")for(const[Me,Ue]of Object.entries(Te)){const Oe=`${Q}_${se}_${Me}`;Ue==="pending"&&N[Oe]&&(ee[Q][se][Me]=N[Oe])}else if(Te==="pending"){const Me=`${Q}_${se}`;N[Me]&&(ee[Q][se]=N[Me])}}return console.log("✅ Merged commands:",ee),ee}catch(b){return console.error("Error fetching learned commands:",b),F}}function re(O){const i={manufacturer:O.manufacturer,supportedModels:[O.model],supportedController:"Broadlink",commandsEncoding:"Base64",commandType:O.commandType||"ir",commands:{}};return O.platform==="climate"&&(i.minTemperature=O.config.minTemp,i.maxTemperature=O.config.maxTemp,i.precision=O.config.precision||1,i.operationModes=O.config.modes||[],i.fanModes=O.config.fanModes&&O.config.fanModes.length>0?O.config.fanModes:["auto"],O.config.swingModes&&O.config.swingModes.length>0&&(i.swingModes=O.config.swingModes),i.commands=O.commands),i}function G(O){let i=`# SmartIR ${O.platform} configuration
`;return i+=`# Generated by Broadlink Manager v2

`,O.platform==="climate"&&(i+=`climate:
`,i+=`  - platform: smartir
`,i+=`    name: ${O.manufacturer} ${O.model}
`,i+=`    unique_id: ${O.manufacturer.toLowerCase()}_${O.model.toLowerCase().replace(/\s+/g,"_")}
`,i+=`    device_code: 10000  # Change this to your custom code number
`,i+=`    controller_data: ${O.broadlinkDevice}
`,O.config.tempSensor&&(i+=`    temperature_sensor: ${O.config.tempSensor}
`),O.config.humiditySensor&&(i+=`    humidity_sensor: ${O.config.humiditySensor}
`),O.config.powerSensor&&(i+=`    power_sensor: ${O.config.powerSensor}
`)),i}async function ce(){try{console.log("Fetching remote devices from /api/remote/devices...");const O=await ne.get("/api/remote/devices");console.log("Loaded remote devices response:",O.data);const i=O.data.devices||[];console.log("Extracted devices array:",i),console.log("Device count:",i.length),f.value=i,console.log("broadlinkDevices.value set to:",f.value),console.log("Final device count:",f.value.length)}catch(O){console.error("Error loading remote devices:",O),f.value=[]}}return ue(()=>r.show,O=>{if(O){const i=Number.isInteger(r.startStep)?r.startStep:0;s.value=Math.min(Math.max(i,0),w.length-1)}}),ue(()=>r.startStep,O=>{if(r.show){const i=Number.isInteger(O)?O:0;s.value=Math.min(Math.max(i,0),w.length-1)}}),De(()=>{r.show&&ce()}),(O,i)=>o.show?(l(),n("div",{key:0,class:"modal-overlay",onClick:K},[e("div",{class:"modal-container",onClick:i[19]||(i[19]=ye(()=>{},["stop"]))},[e("div",Xd,[e("h2",null,[i[22]||(i[22]=e("i",{class:"mdi mdi-file-document-edit"},null,-1)),I(" "+m(o.editMode?"Edit SmartIR Profile":"Create SmartIR Profile"),1)]),e("button",{onClick:p,class:"close-button"},[...i[23]||(i[23]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Gd,[(l(),n(ve,null,he(w,(F,P)=>e("div",{key:P,class:Y(["step",{active:s.value===P,completed:s.value>P}])},[e("div",Yd,[s.value>P?(l(),n("i",Zd)):(l(),n("span",Qd,m(P+1),1))]),e("span",eu,m(F.label),1)],2)),64))]),e("div",tu,[s.value===0?(l(),n("div",ou,[i[29]||(i[29]=e("h3",null,"Device Information",-1)),e("div",lu,[i[25]||(i[25]=e("label",null,"Platform Type *",-1)),W(e("select",{"onUpdate:modelValue":i[0]||(i[0]=F=>v.value.platform=F),onChange:xe},[...i[24]||(i[24]=[Ae('<option value="" data-v-c6cdbf90>Select platform...</option><option value="climate" data-v-c6cdbf90>🌡️ Climate (AC, Heater, Heat Pump)</option><option value="media_player" data-v-c6cdbf90>📺 Media Player (TV, Receiver)</option><option value="fan" data-v-c6cdbf90>🌀 Fan</option><option value="light" data-v-c6cdbf90>💡 Light (LED Strip, IR Light)</option>',5)])],544),[[we,v.value.platform]])]),e("div",nu,[i[26]||(i[26]=e("label",null,"Manufacturer *",-1)),W(e("input",{"onUpdate:modelValue":i[1]||(i[1]=F=>v.value.manufacturer=F),type:"text",placeholder:"e.g., Daikin, LG, Samsung"},null,512),[[_e,v.value.manufacturer]])]),e("div",su,[i[27]||(i[27]=e("label",null,"Model(s) *",-1)),W(e("input",{"onUpdate:modelValue":i[2]||(i[2]=F=>v.value.model=F),type:"text",placeholder:"e.g., FTXS35K, Multiple models"},null,512),[[_e,v.value.model]]),i[28]||(i[28]=e("small",null,'Enter model number or "Multiple" if it works with many models',-1))])])):R("",!0),s.value===1?(l(),n("div",au,[v.value.platform==="climate"?(l(),Re(_r,{key:0,modelValue:v.value.config,"onUpdate:modelValue":i[3]||(i[3]=F=>v.value.config=F)},null,8,["modelValue"])):v.value.platform==="media_player"?(l(),n("div",iu,[i[36]||(i[36]=e("h3",null,"Media Player Configuration",-1)),i[37]||(i[37]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),I(" Configure the features your media player supports. You'll learn the IR commands in the next step. ")],-1)),e("div",ru,[i[35]||(i[35]=e("h4",null,"Supported Features",-1)),e("div",du,[e("label",uu,[W(e("input",{type:"checkbox",value:"turn_on","onUpdate:modelValue":i[4]||(i[4]=F=>D.value=F)},null,512),[[ge,D.value]]),i[30]||(i[30]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),I(" Power On/Off ")],-1))]),e("label",cu,[W(e("input",{type:"checkbox",value:"volume","onUpdate:modelValue":i[5]||(i[5]=F=>D.value=F)},null,512),[[ge,D.value]]),i[31]||(i[31]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-volume-high"}),I(" Volume Control ")],-1))]),e("label",mu,[W(e("input",{type:"checkbox",value:"mute","onUpdate:modelValue":i[6]||(i[6]=F=>D.value=F)},null,512),[[ge,D.value]]),i[32]||(i[32]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-volume-mute"}),I(" Mute ")],-1))]),e("label",vu,[W(e("input",{type:"checkbox",value:"source","onUpdate:modelValue":i[7]||(i[7]=F=>D.value=F)},null,512),[[ge,D.value]]),i[33]||(i[33]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-import"}),I(" Source Selection ")],-1))]),e("label",pu,[W(e("input",{type:"checkbox",value:"channel","onUpdate:modelValue":i[8]||(i[8]=F=>D.value=F)},null,512),[[ge,D.value]]),i[34]||(i[34]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-numeric"}),I(" Channel Control ")],-1))])])])])):v.value.platform==="fan"?(l(),n("div",fu,[i[44]||(i[44]=e("h3",null,"Fan Configuration",-1)),i[45]||(i[45]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),I(" Configure the features your fan supports. You'll learn the IR commands in the next step. ")],-1)),e("div",gu,[i[40]||(i[40]=e("h4",null,"Fan Speed Levels",-1)),e("div",yu,[i[39]||(i[39]=e("label",null,"Number of Speed Levels *",-1)),W(e("select",{"onUpdate:modelValue":i[9]||(i[9]=F=>X.value=F)},[...i[38]||(i[38]=[e("option",{value:1},"1 Speed",-1),e("option",{value:2},"2 Speeds",-1),e("option",{value:3},"3 Speeds (Low/Med/High)",-1),e("option",{value:4},"4 Speeds",-1),e("option",{value:5},"5 Speeds",-1),e("option",{value:6},"6 Speeds",-1)])],512),[[we,X.value,void 0,{number:!0}]])])]),e("div",bu,[i[43]||(i[43]=e("h4",null,"Additional Features",-1)),e("div",hu,[e("label",ku,[W(e("input",{type:"checkbox",value:"oscillate","onUpdate:modelValue":i[10]||(i[10]=F=>Z.value=F)},null,512),[[ge,Z.value]]),i[41]||(i[41]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-sync"}),I(" Oscillation ")],-1))]),e("label",wu,[W(e("input",{type:"checkbox",value:"direction","onUpdate:modelValue":i[11]||(i[11]=F=>Z.value=F)},null,512),[[ge,Z.value]]),i[42]||(i[42]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-rotate-3d-variant"}),I(" Direction (Forward/Reverse) ")],-1))])])])])):v.value.platform==="light"?(l(),n("div",$u,[i[51]||(i[51]=e("h3",null,"Light Configuration",-1)),i[52]||(i[52]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),I(" Configure the features your light supports. You'll learn the IR commands in the next step. ")],-1)),e("div",Cu,[i[50]||(i[50]=e("h4",null,"Supported Features",-1)),e("div",_u,[e("label",Su,[W(e("input",{type:"checkbox",value:"turn_on","onUpdate:modelValue":i[12]||(i[12]=F=>oe.value=F)},null,512),[[ge,oe.value]]),i[46]||(i[46]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),I(" Power On/Off ")],-1))]),e("label",Iu,[W(e("input",{type:"checkbox",value:"brightness","onUpdate:modelValue":i[13]||(i[13]=F=>oe.value=F)},null,512),[[ge,oe.value]]),i[47]||(i[47]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-brightness-6"}),I(" Brightness Control ")],-1))]),e("label",Du,[W(e("input",{type:"checkbox",value:"color_temp","onUpdate:modelValue":i[14]||(i[14]=F=>oe.value=F)},null,512),[[ge,oe.value]]),i[48]||(i[48]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-thermometer"}),I(" Color Temperature ")],-1))]),e("label",xu,[W(e("input",{type:"checkbox",value:"rgb","onUpdate:modelValue":i[15]||(i[15]=F=>oe.value=F)},null,512),[[ge,oe.value]]),i[49]||(i[49]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-palette"}),I(" RGB Color ")],-1))])])])])):R("",!0)])):R("",!0),s.value===2?(l(),n("div",Tu,[be(ld,{modelValue:v.value.commands,"onUpdate:modelValue":i[16]||(i[16]=F=>v.value.commands=F),platform:v.value.platform,config:v.value.config,broadlinkDevice:v.value.broadlinkDevice,"onUpdate:broadlinkDevice":i[17]||(i[17]=F=>v.value.broadlinkDevice=F),manufacturer:v.value.manufacturer,model:v.value.model,commandType:v.value.commandType,"onUpdate:commandType":i[18]||(i[18]=F=>v.value.commandType=F)},null,8,["modelValue","platform","config","broadlinkDevice","manufacturer","model","commandType"])])):R("",!0),s.value===3?(l(),n("div",Mu,[be(xd,{profile:v.value,"json-data":pe.value,"yaml-config":Ie.value},null,8,["profile","json-data","yaml-config"])])):R("",!0)]),e("div",Ru,[s.value>0?(l(),n("button",{key:0,onClick:fe,class:"btn-secondary"},[...i[53]||(i[53]=[e("i",{class:"mdi mdi-arrow-left"},null,-1),I(" Back ",-1)])])):R("",!0),i[57]||(i[57]=e("div",{class:"spacer"},null,-1)),e("button",{onClick:p,class:"btn-text"}," Cancel "),s.value<w.length-1?(l(),n("button",{key:1,onClick:V,class:"btn-primary",disabled:!me.value},[...i[54]||(i[54]=[I(" Next ",-1),e("i",{class:"mdi mdi-arrow-right"},null,-1)])],8,Lu)):(l(),n("div",Au,[e("button",{onClick:J,class:"btn-primary",disabled:u.value},[i[55]||(i[55]=e("i",{class:"mdi mdi-cloud-upload"},null,-1)),I(" "+m(u.value?"Saving...":"Save to SmartIR"),1)],8,Ou),e("button",{onClick:H,class:"btn-secondary",disabled:u.value},[...i[56]||(i[56]=[e("i",{class:"mdi mdi-download"},null,-1),I(" Download JSON ",-1)])],8,Eu)]))])]),be(Kd,{show:S.value,platform:v.value.platform,warnings:C.value,"config-path":M.value,onClose:i[20]||(i[20]=F=>S.value=!1),onComplete:le},null,8,["show","platform","warnings","config-path"]),be(Le,{isOpen:L.value,title:"Change Command Type?",message:"Changing the command type will clear all learned commands. Continue?",confirmText:"Continue",cancelText:"Cancel",dangerMode:!0,onConfirm:x,onCancel:d},null,8,["isOpen"]),be(Le,{isOpen:B.value,title:"Close Profile Builder?",message:"Are you sure you want to close? Your progress will be lost.",confirmText:"Close",cancelText:"Keep Editing",dangerMode:!0,onConfirm:g,onCancel:i[21]||(i[21]=F=>B.value=!1)},null,8,["isOpen"])])):R("",!0)}},Uu=ke(Vu,[["__scopeId","data-v-c6cdbf90"]]),Pu={class:"dashboard"},ju={__name:"Dashboard",setup(o){const c=Ve(),r=Ce("smartirEnabled");He();const k=y(!1),h=y(!1),s=y(null),u=y(0),f=y(null);function S(){h.value=!1,s.value=null,u.value=0,k.value=!0}async function C({platform:t,profile:L,startStep:B}){u.value=Number.isInteger(B)?B:0;try{const U=await fetch(`api/smartir/platforms/${t}/profiles/${L.code}`);if(!U.ok)throw new Error("Failed to load profile");const T=await U.json();let a="";try{const w=await fetch(`api/smartir/config/get-device?platform=${t}&code=${L.code}`);w.ok?(a=(await w.json()).controller_data||"",console.log("✅ Found controller_data from YAML:",a)):console.warn("⚠️ No YAML entry found for this profile (this is OK for profiles not yet added to config)")}catch(w){console.warn("⚠️ Could not fetch controller_data from config:",w)}h.value=!0,s.value={platform:t,code:L.code,profile:{...T.profile,controller_data:a}},k.value=!0}catch(U){console.error("Error loading profile for edit:",U),c.error("Failed to load profile for editing")}}function M(){k.value=!1,h.value=!1,s.value=null}async function $(t){console.log("Profile saved:",t),M(),f.value&&f.value.loadAllProfiles&&(await f.value.loadAllProfiles(),console.log("✅ Profiles list refreshed"))}return(t,L)=>(l(),n("div",Pu,[$e(r)?(l(),Re(Vs,{key:0})):R("",!0),L[0]||(L[0]=Ae('<div class="welcome-banner" data-v-c3efa930><div class="banner-content" data-v-c3efa930><div class="banner-icon" data-v-c3efa930><i class="mdi mdi-rocket-launch" data-v-c3efa930></i></div><div class="banner-text" data-v-c3efa930><h2 data-v-c3efa930>Welcome to Broadlink Manager v2!</h2><p data-v-c3efa930>Manage your IR/RF devices with a modern Vue 3 interface</p></div></div><div class="status-badges" data-v-c3efa930><span class="badge success" data-v-c3efa930><i class="mdi mdi-check-circle" data-v-c3efa930></i> Vue 3 Ready </span><span class="badge warning" data-v-c3efa930><i class="mdi mdi-beta" data-v-c3efa930></i> Beta </span></div></div>',1)),be(Ms),$e(r)?(l(),Re(xi,{key:1,ref_key:"smartirStatusCard",ref:f,onCreateProfile:S,onEditProfile:C},null,512)):R("",!0),be(Uu,{show:k.value,editMode:h.value,editData:s.value,startStep:u.value,onClose:M,onSave:$},null,8,["show","editMode","editData","startStep"])]))}},Fu=ke(ju,[["__scopeId","data-v-c3efa930"]]),Nu={class:"toast-container"},Bu={class:"toast-content"},qu={key:0,class:"toast-title"},Hu={class:"toast-message"},zu={key:1,class:"toast-description"},Ju=["onClick","title"],Wu={__name:"Toast",setup(o,{expose:c}){const r=y([]);let k=0;function h(f){const S={success:"mdi-check-circle",error:"mdi-alert-circle",warning:"mdi-alert",info:"mdi-information"};return S[f]||S.info}function s({message:f,title:S,description:C,type:M="info",duration:$=5e3}){const t=k++,L={id:t,message:f,title:S,description:C,type:M};return r.value.push(L),$>0&&setTimeout(()=>{u(t)},$),t}function u(f){const S=r.value.findIndex(C=>C.id===f);S>-1&&r.value.splice(S,1)}return c({addToast:s,removeToast:u,show:s,success:(f,S)=>s({message:f,title:S,type:"success"}),error:(f,S)=>s({message:f,title:S,type:"error",duration:0}),warning:(f,S)=>s({message:f,title:S,type:"warning",duration:0}),info:(f,S)=>s({message:f,title:S,type:"info"})}),(f,S)=>(l(),Re(Ge,{to:"body"},[e("div",Nu,[be(nt,{name:"toast"},{default:qe(()=>[(l(!0),n(ve,null,he(r.value,C=>(l(),n("div",{key:C.id,class:Y(["toast",[`toast-${C.type}`,{"toast-persistent":C.type==="error"||C.type==="warning"}]])},[e("i",{class:Y(["mdi",h(C.type)])},null,2),e("div",Bu,[C.title?(l(),n("div",qu,m(C.title),1)):R("",!0),e("div",Hu,m(C.message),1),C.description?(l(),n("div",zu,m(C.description),1)):R("",!0)]),e("button",{onClick:M=>u(C.id),class:Y(["toast-close",{"toast-close-prominent":C.type==="error"||C.type==="warning"}]),title:C.type==="error"||C.type==="warning"?"Click to dismiss":"Close"},[...S[0]||(S[0]=[e("i",{class:"mdi mdi-close"},null,-1)])],10,Ju)],2))),128))]),_:1})])]))}},Ku=ke(Wu,[["__scopeId","data-v-3948c088"]]),Xu="0.3.0-alpha.1",Gu={version:Xu},Yu={id:"app",class:"app-container"},Zu={class:"app-header"},Qu={class:"header-content"},ec={class:"header-right"},tc=["title"],oc={class:"settings-menu-container"},lc={key:0,class:"settings-menu"},nc=["title"],sc={class:"toggle-content"},ac={key:0,class:"not-installed-label"},ic={key:0,href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"menu-item menu-link menu-subitem"},rc=["disabled"],dc=["disabled"],uc=["disabled"],cc={class:"app-main"},mc={class:"app-footer"},vc={__name:"App",setup(o){const c=y(null),r=Gu.version,k=y("light"),h=y(null),s=y(!1),u=y(!1),f=y(!1),S=y(localStorage.getItem("smartir_enabled")!=="false"),C=z(()=>{var v;return((v=h.value)==null?void 0:v.installed)||!1}),M=z(()=>({light:"mdi mdi-weather-sunny",medium:"mdi mdi-weather-partly-cloudy",dark:"mdi mdi-weather-night"})[k.value]),$=z(()=>({light:"Switch to Medium Theme",medium:"Switch to Dark Theme",dark:"Switch to Light Theme"})[k.value]),t=()=>{const v=["light","medium","dark"],X=(v.indexOf(k.value)+1)%v.length;k.value=v[X],document.body.classList.remove("medium-mode","dark-mode"),k.value==="medium"?document.body.classList.add("medium-mode"):k.value==="dark"&&document.body.classList.add("dark-mode"),localStorage.setItem("theme",k.value)},L=async()=>{try{const v=await Qe.getStatus();h.value=v,v.installed?console.log("✅ SmartIR detected:",v.version):console.log("ℹ️ SmartIR not detected")}catch(v){console.error("Error checking SmartIR:",v),h.value={installed:!1,error:v.message}}},B=async()=>{var v,D,X;u.value=!0;try{const oe=(await ne.get("/api/diagnostics/markdown")).data.markdown;if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(oe),(v=c.value)==null||v.success("Diagnostic summary copied to clipboard!");else{const de=document.createElement("textarea");de.value=oe,de.style.position="fixed",de.style.left="-999999px",de.style.top="-999999px",document.body.appendChild(de),de.focus(),de.select();try{if(document.execCommand("copy"))(D=c.value)==null||D.success("Diagnostic summary copied to clipboard!");else throw new Error("execCommand failed")}finally{document.body.removeChild(de)}}s.value=!1}catch(Z){console.error("Error copying diagnostics:",Z),(X=c.value)==null||X.error("Failed to copy diagnostics: "+Z.message)}finally{u.value=!1}},U=async()=>{var v,D;u.value=!0;try{const X=await ne.get("/api/diagnostics/download",{responseType:"blob"}),Z=window.URL.createObjectURL(new Blob([X.data])),oe=document.createElement("a");oe.href=Z;const de=X.headers["content-disposition"];let E="broadlink_manager_diagnostics.zip";if(de){const j=de.match(/filename="?(.+)"?/);j&&(E=j[1])}oe.setAttribute("download",E),document.body.appendChild(oe),oe.click(),oe.remove(),window.URL.revokeObjectURL(Z),(v=c.value)==null||v.success("Diagnostic bundle downloaded!"),s.value=!1}catch(X){console.error("Error downloading diagnostics:",X),(D=c.value)==null||D.error("Failed to download diagnostics")}finally{u.value=!1}},T=()=>{C.value&&(S.value=!S.value,localStorage.setItem("smartir_enabled",S.value.toString()),window.location.reload())},a=async()=>{var v,D,X;f.value=!0;try{const Z=await ne.post("/api/smartir/refresh-index");Z.data.success?(v=c.value)==null||v.success(`Updated to v${Z.data.version} (${Z.data.total_devices} devices)`,"✅ Index Updated"):(D=c.value)==null||D.error(Z.data.error||"Unknown error","❌ Update Failed")}catch(Z){console.error("Error updating SmartIR index:",Z),(X=c.value)==null||X.error("Failed to update device index","❌ Update Error")}finally{f.value=!1,s.value=!1}},w=v=>{v.target.closest(".settings-menu-container")||(s.value=!1)};return De(async()=>{const v=localStorage.getItem("theme");v&&["light","medium","dark"].includes(v)?(k.value=v,v==="medium"?document.body.classList.add("medium-mode"):v==="dark"&&document.body.classList.add("dark-mode")):localStorage.getItem("darkMode")==="true"&&(k.value="dark",document.body.classList.add("dark-mode"),localStorage.setItem("theme","dark")),await L();const D=We();D&&c.value&&(D.appContext.config.globalProperties.$toast=c.value),document.addEventListener("click",w)}),Be(()=>{document.removeEventListener("click",w)}),je("smartirStatus",h),je("smartirEnabled",S),je("refreshSmartIR",L),je("toast",c),(v,D)=>(l(),n("div",Yu,[e("header",Zu,[e("div",Qu,[D[13]||(D[13]=e("div",{class:"header-left"},[e("i",{class:"mdi mdi-remote"}),e("h1",null,"Broadlink Manager v2"),e("span",{class:"beta-badge"},"BETA")],-1)),e("div",ec,[e("button",{onClick:t,class:"icon-button",title:$.value},[e("i",{class:Y(M.value)},null,2)],8,tc),e("div",oc,[e("button",{onClick:D[0]||(D[0]=X=>s.value=!s.value),class:"icon-button",title:"Settings"},[...D[2]||(D[2]=[e("i",{class:"mdi mdi-cog"},null,-1)])]),s.value?(l(),n("div",lc,[D[9]||(D[9]=e("div",{class:"menu-section-title"},"Integration Settings",-1)),e("div",{class:Y(["menu-item toggle-item",{disabled:!C.value}]),onClick:D[1]||(D[1]=X=>C.value?T():null),title:C.value?"":"SmartIR is not installed"},[e("div",sc,[D[3]||(D[3]=e("i",{class:"mdi mdi-air-conditioner"},null,-1)),D[4]||(D[4]=e("span",null,"SmartIR Integration",-1)),C.value?R("",!0):(l(),n("span",ac,"(Not Installed)"))]),e("div",{class:Y(["toggle-switch",{active:S.value&&C.value,disabled:!C.value}])},[...D[5]||(D[5]=[e("div",{class:"toggle-slider"},null,-1)])],2)],10,nc),S.value?(l(),n("a",ic,[...D[6]||(D[6]=[e("i",{class:"mdi mdi-github"},null,-1),e("span",null,"SmartIR on GitHub",-1)])])):R("",!0),S.value?(l(),n("button",{key:1,onClick:a,class:"menu-item menu-subitem",disabled:f.value},[e("i",{class:Y(["mdi",f.value?"mdi-loading mdi-spin":"mdi-refresh"])},null,2),e("span",null,m(f.value?"Updating...":"Update Device Index"),1)],8,rc)):R("",!0),D[10]||(D[10]=e("div",{class:"menu-divider"},null,-1)),D[11]||(D[11]=e("div",{class:"menu-section-title"},"Diagnostics",-1)),e("button",{onClick:B,class:"menu-item",disabled:u.value},[...D[7]||(D[7]=[e("i",{class:"mdi mdi-content-copy"},null,-1),e("span",null,"Copy Diagnostics",-1)])],8,dc),e("button",{onClick:U,class:"menu-item",disabled:u.value},[...D[8]||(D[8]=[e("i",{class:"mdi mdi-download"},null,-1),e("span",null,"Download Diagnostics",-1)])],8,uc),D[12]||(D[12]=Ae('<div class="menu-divider" data-v-73e31407></div><div class="menu-section-title" data-v-73e31407>Help &amp; Support</div><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2#readme" target="_blank" class="menu-item menu-link" data-v-73e31407><i class="mdi mdi-book-open-variant" data-v-73e31407></i><span data-v-73e31407>Documentation</span></a><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2/issues" target="_blank" class="menu-item menu-link" data-v-73e31407><i class="mdi mdi-bug" data-v-73e31407></i><span data-v-73e31407>Report Issue</span></a><div class="menu-divider" data-v-73e31407></div><div class="menu-section-title" data-v-73e31407>Community</div><a href="https://community.home-assistant.io/t/broadlink-manager-modern-web-interface-for-broadlink-devices/938473" target="_blank" class="menu-item menu-link" data-v-73e31407><i class="mdi mdi-forum" data-v-73e31407></i><span data-v-73e31407>HA Forum Discussion</span></a><a href="https://www.reddit.com/r/homeassistant/comments/1o1q3kf/release_broadlink_manager_addon_a_modern_web_ui/" target="_blank" class="menu-item menu-link" data-v-73e31407><i class="mdi mdi-reddit" data-v-73e31407></i><span data-v-73e31407>Reddit Discussion</span></a><div class="menu-divider" data-v-73e31407></div><div class="menu-section-title" data-v-73e31407>Project</div><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2" target="_blank" class="menu-item menu-link" data-v-73e31407><i class="mdi mdi-github" data-v-73e31407></i><span data-v-73e31407>GitHub Repository</span></a><a href="https://ko-fi.com/tonyperkins" target="_blank" class="menu-item menu-link menu-item-sponsor" data-v-73e31407><i class="mdi mdi-coffee" data-v-73e31407></i><span data-v-73e31407>Support on Ko-fi</span></a>',12))])):R("",!0)])])])]),e("main",cc,[be(Fu)]),e("footer",mc,[e("p",null,"Broadlink Manager v"+m($e(r))+" | Built with Vue "+m(st),1)]),be(Ku,{ref_key:"toastRef",ref:c},null,512)]))}},pc=ke(vc,[["__scopeId","data-v-73e31407"]]),et=at(pc),fc=it();et.use(fc);et.mount("#app");
