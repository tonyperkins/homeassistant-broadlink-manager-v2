import{g as nt,r as y,o as Ee,a as We,b as vt,d as pt,c as K,e as d,f as a,h as e,i as M,n as G,u as Se,t as f,j as D,F as ve,k as be,w as ie,l as q,v as Pe,m as me,p as fe,q as Ke,s as tt,T as st,x as Re,y as Le,z as qe,A as de,B as at,C as ze,D as Ne,E as it,G as Ye,H as ft,I as gt,J as yt,K as Xe,L as bt,M as ht}from"./vendor-DGiFqQ_g.js";(function(){const m=document.createElement("link").relList;if(m&&m.supports&&m.supports("modulepreload"))return;for(const k of document.querySelectorAll('link[rel="modulepreload"]'))w(k);new MutationObserver(k=>{for(const i of k)if(i.type==="childList")for(const p of i.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&w(p)}).observe(document,{childList:!0,subtree:!0});function u(k){const i={};return k.integrity&&(i.integrity=k.integrity),k.referrerPolicy&&(i.referrerPolicy=k.referrerPolicy),k.crossOrigin==="use-credentials"?i.credentials="include":k.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function w(k){if(k.ep)return;k.ep=!0;const i=u(k);fetch(k.href,i)}})();let lt=!1;function Ge(){const t=nt(),m=t==null?void 0:t.appContext.config.globalProperties.$toast;return m||(lt||(console.warn("Toast notification system not yet initialized - using console fallback"),lt=!0),{success:u=>console.log("âœ“",u),error:u=>console.error("âœ—",u),warning:u=>console.warn("âš ",u),info:u=>console.info("â„¹",u)})}function ot(){const t=y(!1),m=y(!1),u=y(!1),w=y(0),k=767,i=768,p=1023,g=1024,_=()=>{const C=window.innerWidth;w.value=C,t.value=C<=k,m.value=C>=i&&C<=p,u.value=C>=g};return Ee(()=>{_(),window.addEventListener("resize",_)}),We(()=>{window.removeEventListener("resize",_)}),{isMobile:t,isTablet:m,isDesktop:u,screenWidth:w,isMobileOrTablet:()=>t.value||m.value,isTabletOrDesktop:()=>m.value||u.value}}const Qe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAHBUlEQVR4nOxZC1BTVxo+9+aNZI2LNsgjWR4hgoIiRVDBslKnIKPbx1jqTrtYoakat1a6dNsdd7t1X8XHyAbEhdUu1u2mXdbasqJbtsaMIqBBECiPBmqEICEBEx4xJLlJ7s6lw6rJDeQ2FzLM+M1kBs7/3+/83zn/Oee/51JRFAXzGbCvA/AWjwX4GvNeANWXnXffHQ4+K6/dYbHeD+IFhjRkb1wn9WPQbEQ4IF/tQlXX2p5+/8OyczY74j/VxuMG3Sh/Oz9jaQDb4CmPT1LIbLXBfzrz0cmHg8fQpx1Yc1Ra+TsiXD4R0PqtRmAyj/LxbJeaujKIcPlEAINOM7vLXBaTZibCRWgRq3WGJZWX63aoNDpB8BJOX/bGlIqwpUv6iXBgWBHG7eUF8urUWvU6Z9sLGxI/IsLl8SJu6u4XigqPXkVspiVTbTQqU1/6Vn7ammh+G5FOMZyqludIKqUVU/9jcaSuTCo/unfHbiad4iBdwMu/P1bV1tO1xbk9NDC0/vwHB1xGcjqYLAh16zsHW3R6XXTu1mfFdAqMrIoSKNbGhLcQ4QGeppDJ7ACtPcqNEI6tT9O3Vqm+tygqNMDjrU9Sef6tIYM2JjUuuXzfC5knCEXsBI8WMZUCAxiCrfhWyMZkMNzYXNHVpwmXXqp5j0Hz0/1m57a3PQ8VHx4JoNMASIl9shLPFsB5ooO7iDXhCY/dAcCvT/79LwC1s/K2bDnAXcQeJRqwMzzeRt/bua0gLChcDsCDNQNBkEU/qot7o6j0kzETQpuJ40ZnT6xSrUoNWhyseHVz2ikv4n4QA5FSArE5IFlTZ0r3XU1MWODib6NCl3a9dkhSYxgbjo4XLq8sL9j7Ip36YEwMRjMNQazMhf7+RgYNnuyo7bY6ArFaWKuXRX495wLwoLk39sO9RaVnM5OTP8zLSjtjsljpp6ovi6pqr706eE8XBwGUSqEy9Guihf/92TMZhetjI5rJCHwKpBRzZqsNYtKp6KD+Pvv1w5ILdzR3UvD8HA4YefOl7N25JKUPIKuUwIJH7A5of/GJf7oLfrIz2EH786fSss+uKFzOk+8L0mqh6rpbmR0q5YyFGAQBSuHHlcUWxEaZyXfMhFD0Rgt9Oh/SBMiam58HAO+oc4XZMsK/1taT6M6uHjJw8w6VSNfvemM8TbzPlFlwsP5KyzfJeL6kCejXDgo894aASqOZ9O/uHwzq6B3ijhitkzOC7XS7j0g+V3S0vQTDDhYEoZSBobvJ+yXFNZ29gy4lOGmvlDBMIfQqSKV8539EWvXHhvbGHBSFrAwGW+vvxzLoR7RxzrNpsyPs0xcv7/lg1/ZfPtKvuw7MVhulUakWdvRq+XY3tWFT90Bk+52BCOzvyOBgjytSFKAgms+b9F/2o+BbKwUrvgjhhjSjKLAPG4YE7lJxfEIf5dyGOwMXrren/eF0RYXRNMrHDt4QbmjDEbHop9F8rqpddZd3sV6R/aWiabtWr41PW534V8m+PFHW+qSPL9TX7oM8WAaBi4IbE4S8yYNs/7asIgBA0ZStRqFM/MXxIzcgHBEBP+C6DJKLgJvK3uXvniitBsDmNzkSEAD9uv5k0aFjXy1gMQ0DQ5p4CAIwNuXLwyL/ExcpqMWeS42NUmxKXFf8VWPdz6cLnkqhGd/Pe+U1Cow/+ekJUYr4qJgvbik7f/Jw+0J/tjpvS3qxs7/LQZZfcrrkUmOdGI/cgUKIkB8pz0xK+CQjKf6z4MWckYftZqsderfsTInsZt0evDRgMRYMHhaLnk+NW1Y/nchxk5lZ+I/Pf/vl9RvbLYiVlSBcJv/VK9sKBCHc3hkF7D12/NzVltZn8YhzNj/3ev6LGeXTdQ6+uzLZ+C+5XNza05Nsd1gXcNgBvekJK/+du3lTUSiXMzzT80TgkkK8wJAGgCMAE5ooFFz3hHTr+lgZ9iMryOngkoi5WZuOc9hPtDu3r4198nTqygjCr3wYmrvVkSerZXljJoT0m0DcYm5g2Mg5WV39zrVWZZofkzaRnhB/bufm9FI/JpXQXj8F8bHyitqWxhzJmwUJT60SNJER+P+BCZjt34lzNbvickRoWVWNmGzuObnYWhER3oAdX41dPbj1jDeYEwGrInltKKCNtatub6hRfJOEnfJkcc+JgE9ltS/DkINuNI3xCo4fbXgm/0CnouvOcjK4Z/16/ZKia+3+kqIrEIQ+sgNx2Jzb5wsPxrD9GBZv+Gd9BqSXr4icg8cwMj4SLmv6+mlv+WddgGlilOPOZkEmFnrLP+sCVgtXyPHaHShkiw0XXPWWf9YF5Gb9uGzp4sCbj7ai4LkNTx2O5nPV3vLPyTeye6P32X+7KNujVKtSYJg+viEu/mx2etJZCgnD57OPfGRh3n8nfizA15j3Av4XAAD//5k1S2w3zfwVAAAAAElFTkSuQmCC",te=vt.create({baseURL:"./",timeout:3e4,headers:{"Content-Type":"application/json","Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"}});te.interceptors.request.use(t=>t,t=>Promise.reject(t));te.interceptors.response.use(t=>t,t=>(console.error("API Error:",t),t.response?console.error("Response error:",t.response.data):t.request?console.error("No response received"):console.error("Request setup error:",t.message),Promise.reject(t)));const kt=pt("devices",{state:()=>({devices:[],loading:!1,error:null,selectedDevice:null}),getters:{deviceById:t=>m=>t.devices.find(u=>u.id===m),devicesByType:t=>m=>t.devices.filter(u=>u.entity_type===m),deviceCount:t=>t.devices.length,hasDevices:t=>t.devices.length>0},actions:{async loadDevices(t=!1){this.loading=!0,this.error=null;try{const m=t?`/api/devices/managed?_t=${Date.now()}`:"/api/devices/managed",u=await te.get(m);this.devices=u.data.devices||[],console.log("ğŸ“¥ Loaded devices:",this.devices),this.devices.forEach(w=>{console.log(`ğŸ“¥ Device "${w.name}":`,{id:w.id,device:w.device,commands:w.commands,commandCount:w.commands?Object.keys(w.commands).length:0})})}catch(m){this.error=m.message,console.error("Error loading devices:",m)}finally{this.loading=!1}},async createDevice(t){this.loading=!0,this.error=null;try{console.log("ğŸª Store: Creating device with data:",t),console.log("ğŸª Store: Device commands being sent:",t.commands);const m={device_name:t.name,device:t.device,area_id:t.area||"",area_name:t.area||"",entity_type:t.entity_type,icon:t.icon,broadlink_entity:t.broadlink_entity,device_type:t.device_type||"broadlink",commands:t.commands||{}};t.device_type==="smartir"&&t.smartir_config&&(m.smartir_config=t.smartir_config),console.log("ğŸª Store: Transformed data for backend:",m);const u=await te.post("/api/devices/managed",m);return console.log("ğŸª Store: Create response:",u.data),await this.loadDevices(),u.data}catch(m){throw console.error("Error creating device:",m),m}finally{this.loading=!1}},async updateDevice(t,m){this.loading=!0,this.error=null;try{const u=await te.put(`/api/devices/managed/${t}`,m);return await this.loadDevices(),u.data}catch(u){throw console.error("Error updating device:",u),u}finally{this.loading=!1}},async deleteDevice(t,m=!1){this.loading=!0,this.error=null;try{await te.delete(`/api/devices/managed/${t}`,{data:{delete_commands:m}}),this.devices=this.devices.filter(u=>u.id!==t)}catch(u){throw this.error=u.message,console.error("Error deleting device:",u),u}finally{this.loading=!1}},selectDevice(t){this.selectedDevice=t},clearSelection(){this.selectedDevice=null},clearError(){this.error=null},updateDeviceCommands(t,m){const u=this.devices.findIndex(w=>w.id===t);if(u!==-1){const w={...this.devices[u],commands:m};this.devices.splice(u,1,w),console.log(`âœ… Store: Updated commands for ${t}, count: ${Object.keys(m).length}`)}else console.warn(`âš ï¸ Store: Device ${t} not found for command update`)},async syncAllAreas(){if(!this.devices||this.devices.length===0){console.log("âš ï¸ No devices to sync");return}console.log(`ğŸ”„ Syncing areas from Home Assistant for ${this.devices.length} devices...`);try{const t=await Promise.all(this.devices.map(w=>(console.log(`ğŸ”„ Syncing device: ${w.id} (${w.name})`),te.post(`/api/devices/${w.id}/sync-area`).then(k=>k.data.success&&k.data.area?(console.log(`âœ… Synced area for ${w.name}: ${k.data.area}`),{status:"synced",device:w.name}):{status:"no_area"}).catch(k=>{var i;return((i=k.response)==null?void 0:i.status)===404?(console.log(`âŒ Device not found in HA: ${w.id}`),{status:"not_found"}):(console.warn(`âš ï¸ Failed to sync area for ${w.id}:`,k.message),{status:"error",error:k.message})})))),m=t.filter(w=>w.status==="synced").length,u=t.filter(w=>w.status==="not_found").length;await this.loadDevices(!0),m>0?console.log(`âœ… Area sync complete: ${m} synced, ${u} not found in HA`):u>0&&console.log(`â„¹ï¸ No areas synced - ${u} entities not found in HA registry (generate entities first)`)}catch(t){console.debug("Area sync error:",t)}}}});function rt(t){const m=K(()=>t.value||t),u=K(()=>{switch(m.value){case"climate":return"mdi:air-conditioner";case"fan":return"mdi:fan";case"light":return"mdi:lightbulb";case"media_player":return"mdi:television";case"switch":return"mdi:light-switch";default:return"mdi:devices"}}),w=K(()=>`device-type-${m.value}-color`),k=K(()=>`tag-${m.value}-bg`);return{icon:u,colorClass:w,tagBgClass:k}}const dt=""+new URL("broadlink-logo-BDjImjRY.png",import.meta.url).href,ke=(t,m)=>{const u=t.__vccOpts||t;for(const[w,k]of m)u[w]=k;return u},wt={class:"device-header"},$t={class:"device-info"},Ct=["title"],_t={class:"device-labels"},St={class:"device-type"},It=["src","alt","title"],Dt={class:"device-body"},xt={class:"device-stats"},Tt={class:"stat",title:"Learned command count"},Mt={class:"stat",title:"HA Assigned Area"},Rt={class:"device-meta"},Et={class:"device-id",title:"Device ID"},At={key:0,class:"storage-name"},Lt={key:1,class:"broadlink-entity",title:"Controller Device"},Ot={key:2,class:"controller-device"},Pt={class:"device-actions"},Vt=["disabled"],Ut=["disabled"],jt=["disabled"],Ft={key:0,class:"disabled-overlay"},Nt={__name:"DeviceCard",props:{device:{type:Object,required:!0},broadlinkDevices:{type:Array,default:()=>[]}},emits:["edit","delete","learn"],setup(t){const m=t,u=K(()=>localStorage.getItem("smartir_simulate_not_installed")==="true"),w=K(()=>m.device.device_type==="smartir"&&u.value),k=y(null),i=rt(K(()=>m.device.entity_type)),p=K(()=>m.device.icon?m.device.icon:i.icon.value),g=x=>x&&x.startsWith("mdi:")?`mdi ${x.replace(":"," mdi-")}`:`mdi mdi-${x}`,_=K(()=>({light:"Light",fan:"Fan",switch:"Switch",media_player:"Media Player",cover:"Cover"})[m.device.entity_type]||m.device.entity_type),C=K(()=>(m.device.device_type||"broadlink")==="smartir"?"SmartIR":"Broadlink"),L=K(()=>(m.device.device_type||"broadlink")==="smartir"?Qe:dt),h=K(()=>(m.device.device_type||"broadlink")==="smartir"?k.value!==null?k.value:0:Object.keys(m.device.commands||{}).length),l=x=>{if(!x)return"";const o=m.broadlinkDevices.find(r=>r.entity_id===x);return o&&o.name||x},P=K(()=>{if(!m.device.device)return!1;const x=m.device.id.includes(".")?m.device.id.split(".")[1]:m.device.id;return m.device.device!==x}),N=K(()=>{if(!m.device.broadlink_entity)return"";const x=m.broadlinkDevices.find(o=>o.entity_id===m.device.broadlink_entity);return x&&x.name||m.device.broadlink_entity}),U=x=>{if(!x||typeof x!="object")return 0;let o=0;for(const r of Object.values(x))typeof r=="string"?o++:typeof r=="object"&&(o+=U(r));return o},T=async()=>{if(!(!m.device.device_code||!m.device.entity_type))try{const x=await te.get("/api/smartir/codes/code",{params:{entity_type:m.device.entity_type,code_id:m.device.device_code}});if(x.data.success&&x.data.code){const o=x.data.code;o.commands&&(k.value=U(o.commands))}}catch(x){console.error("Error fetching SmartIR command count:",x)}};return Ee(async()=>{(m.device.device_type||"broadlink")==="smartir"&&await T()}),(x,o)=>(a(),d("div",{class:G(["device-card",{disabled:w.value}])},[e("div",wt,[e("div",{class:G(["device-icon",Se(i).colorClass.value])},[e("i",{class:G(g(p.value))},null,2)],2),e("div",$t,[e("h3",{title:t.device.name},f(t.device.name),9,Ct),e("div",_t,[e("span",St,f(_.value),1)])]),e("img",{src:L.value,alt:C.value,title:C.value,class:"device-source-logo"},null,8,It)]),e("div",Dt,[e("div",xt,[e("div",Tt,[o[3]||(o[3]=e("i",{class:"mdi mdi-remote"},null,-1)),e("span",null,f(h.value)+" command"+f(h.value!==1?"s":""),1)]),e("div",Mt,[o[4]||(o[4]=e("i",{class:"mdi mdi-map-marker"},null,-1)),e("span",null,f(t.device.area||"No area"),1)])]),e("div",Rt,[e("span",Et,[o[5]||(o[5]=e("i",{class:"mdi mdi-identifier"},null,-1)),D(" "+f(t.device.id),1)]),P.value?(a(),d("span",At,[o[6]||(o[6]=e("i",{class:"mdi mdi-code-tags"},null,-1)),D(" "+f(t.device.device),1)])):M("",!0),t.device.broadlink_entity?(a(),d("span",Lt,[o[7]||(o[7]=e("i",{class:"mdi mdi-access-point"},null,-1)),D(" "+f(N.value),1)])):M("",!0),t.device.controller_device?(a(),d("span",Ot,[o[8]||(o[8]=e("i",{class:"mdi mdi-access-point"},null,-1)),D(" "+f(l(t.device.controller_device)),1)])):M("",!0)])]),e("div",Pt,[e("button",{onClick:o[0]||(o[0]=r=>!w.value&&x.$emit("learn",t.device)),class:"icon-btn",title:"Manage Commands",disabled:w.value},[...o[9]||(o[9]=[e("i",{class:"mdi mdi-remote-tv"},null,-1)])],8,Vt),e("button",{onClick:o[1]||(o[1]=r=>!w.value&&x.$emit("edit",t.device)),class:"icon-btn",title:"Edit",disabled:w.value},[...o[10]||(o[10]=[e("i",{class:"mdi mdi-pencil"},null,-1)])],8,Ut),e("button",{onClick:o[2]||(o[2]=r=>!w.value&&x.$emit("delete",t.device)),class:"icon-btn danger",title:"Delete",disabled:w.value},[...o[11]||(o[11]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,jt)]),w.value?(a(),d("div",Ft,[...o[12]||(o[12]=[e("div",{class:"disabled-message"},[e("i",{class:"mdi mdi-eye-off"}),e("span",null,"SmartIR Not Installed")],-1)])])):M("",!0)],2))}},Bt=ke(Nt,[["__scopeId","data-v-7a7f5c18"]]),Ht={name:"DeviceListView",props:{devices:{type:Array,required:!0}},methods:{getDeviceSourceLogo(t){return(t.device_type||"broadlink")==="smartir"?Qe:dt},getDeviceCommands(t){return t.commands&&typeof t.commands=="object"?Object.keys(t.commands):[]},getCommandType(t,m){return t.commands&&t.commands[m]&&t.commands[m].type||"ir"},getCommandTypeClass(t,m){return this.getCommandType(t,m)==="rf"?"command-rf":"command-ir"},getCommandTypeLabel(t,m){return this.getCommandType(t,m)==="rf"?"RF Command":"IR Command"},sendCommand(t,m){this.$emit("send-command",{device:t,command:m})},openCommands(t){this.$emit("open-commands",t)},editDevice(t){this.$emit("edit-device",t)},deleteDevice(t){this.$emit("delete-device",t)}}},qt={class:"device-list-view"},zt={class:"device-table"},Jt={class:"device-info"},Wt={class:"device-name"},Gt={class:"device-entity"},Kt={class:"device-area"},Xt={class:"device-type"},Yt=["src","alt","title"],Zt={class:"device-commands"},Qt={key:0,class:"command-list"},eo=["onClick","title"],to={key:0,class:"no-commands"},oo={key:1,class:"smartir-info"},lo={class:"profile-code"},no={class:"device-actions"},so=["onClick"],ao=["onClick"],io=["onClick"];function ro(t,m,u,w,k,i){return a(),d("div",qt,[e("table",zt,[m[3]||(m[3]=e("thead",null,[e("tr",null,[e("th",null,"Device"),e("th",null,"Room/Area"),e("th",null,"Type"),e("th",null,[e("div",{class:"commands-header"},[e("span",null,"Commands"),e("div",{class:"command-legend"},[e("span",{class:"legend-badge command-rf"},"RF"),e("span",{class:"legend-badge command-ir"},"IR")])])]),e("th",null,"Actions")])],-1)),e("tbody",null,[(a(!0),d(ve,null,be(u.devices,p=>(a(),d("tr",{key:p.entity_id,class:"device-row"},[e("td",Jt,[e("div",Wt,f(p.friendly_name||p.name),1),e("div",Gt,f(p.entity_id),1)]),e("td",Kt,f(p.area||"No Area"),1),e("td",Xt,[e("img",{src:i.getDeviceSourceLogo(p),alt:p.device_type==="smartir"?"SmartIR":"Broadlink",title:p.device_type==="smartir"?"SmartIR":"Broadlink",class:"device-source-logo"},null,8,Yt)]),e("td",Zt,[(p.device_type||"broadlink")==="broadlink"?(a(),d("div",Qt,[(a(!0),d(ve,null,be(i.getDeviceCommands(p),g=>(a(),d("button",{key:g,class:G(["command-btn",i.getCommandTypeClass(p,g)]),onClick:_=>i.sendCommand(p,g),title:i.getCommandTypeLabel(p,g)},f(g),11,eo))),128)),i.getDeviceCommands(p).length===0?(a(),d("span",to," No commands ")):M("",!0)])):p.device_type==="smartir"?(a(),d("div",oo,[e("span",lo,"Profile: "+f(p.device_code),1)])):M("",!0)]),e("td",no,[e("button",{class:"action-btn commands",onClick:g=>i.openCommands(p),title:"Manage Commands"},[...m[0]||(m[0]=[e("i",{class:"mdi mdi-remote-tv"},null,-1)])],8,so),e("button",{class:"action-btn edit",onClick:g=>i.editDevice(p),title:"Edit"},[...m[1]||(m[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})],-1)])],8,ao),e("button",{class:"action-btn delete",onClick:g=>i.deleteDevice(p),title:"Delete"},[...m[2]||(m[2]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"3 6 5 6 21 6"}),e("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})],-1)])],8,io)])]))),128))])])])}const uo=ke(Ht,[["render",ro],["__scopeId","data-v-2895a204"]]),co={class:"icon-picker"},mo={class:"icon-input-wrapper"},vo=["id","placeholder"],po={key:0,class:"icon-preview"},fo={key:0,class:"icon-dropdown"},go={class:"icon-grid"},yo=["onMousedown","title"],bo={__name:"IconPicker",props:{modelValue:{type:String,default:""},inputId:{type:String,default:"icon-input"},placeholder:{type:String,default:"e.g., mdi:television"}},emits:["update:modelValue"],setup(t,{emit:m}){const u=t,w=m,k=y(u.modelValue),i=y(!1),p=["television","speaker","radio","music","video","movie","play","pause","stop","skip-next","skip-previous","volume-high","volume-medium","volume-low","volume-off","remote","remote-tv","cast","chromecast","spotify","netflix","youtube","lightbulb","lightbulb-on","lightbulb-off","lamp","floor-lamp","ceiling-light","light-switch","led-strip","led-strip-variant","wall-sconce","chandelier","spotlight","track-light","vanity-light","desk-lamp","fan","ceiling-fan","air-conditioner","thermometer","thermostat","heat-wave","snowflake","fire","radiator","water-boiler","hvac","blinds","blinds-open","window-shutter","window-shutter-open","curtains","curtains-closed","roller-shade","roller-shade-closed","garage","garage-open","gate","door","door-open","window-open","window-closed","washing-machine","tumble-dryer","dishwasher","refrigerator","stove","microwave","oven","toaster","kettle","coffee","coffee-maker","blender","robot-vacuum","robot-vacuum-variant","vacuum","broom","spray-bottle","lock","lock-open","lock-smart","key","shield","shield-check","alarm-light","bell","doorbell","camera","cctv","motion-sensor","smoke-detector","fire-extinguisher","water-alert","gas-cylinder","sofa","bed","bed-double","desk","chair","table","bookshelf","home","home-outline","home-assistant","floor-plan","room","weather-sunny","weather-night","weather-cloudy","weather-rainy","weather-snowy","weather-lightning","weather-windy","weather-fog","weather-partly-cloudy","umbrella","water","water-percent","phone","cellphone","tablet","laptop","desktop-tower","monitor","keyboard","mouse","printer","router","router-wireless","access-point","wifi","bluetooth","usb","hdmi-port","ethernet","power","power-plug","power-socket","battery","battery-charging","lightning-bolt","flash","solar-panel","solar-power","leaf","tree","flower","sprout","grass","watering-can","shovel","fence","pool","hot-tub","silverware","silverware-fork-knife","food","food-apple","glass-wine","glass-cocktail","bottle-wine","pot","pot-steam","shower","shower-head","bathtub","toilet","sink","faucet","hand-wash","car","car-side","garage-variant","tools","hammer","wrench","screwdriver","toolbox","ladder","heart","heart-pulse","run","walk","bike","dumbbell","yoga","scale-bathroom","thermometer-lines","clock","clock-outline","timer","alarm","calendar","calendar-today","calendar-clock","history","bell-ring","bell-alert","alert","alert-circle","information","help-circle","check","check-circle","close-circle","minus-circle","plus-circle","arrow-up","arrow-down","arrow-left","arrow-right","chevron-up","chevron-down","menu","dots-vertical","dots-horizontal","cog","tune","circle","square","triangle","hexagon","star","star-outline","heart-outline","plus","minus","close","check-bold","eye","eye-off","account","account-group","baby","dog","cat","paw","gift","balloon","party-popper","candle","book","book-open","newspaper","email","message","phone-classic"];ie(()=>u.modelValue,h=>{k.value=h});const g=K(()=>{if(!k.value)return p.slice(0,50);const h=k.value.toLowerCase().replace("mdi:","");return p.filter(l=>l.toLowerCase().includes(h)).slice(0,50)}),_=()=>{i.value=!0,w("update:modelValue",k.value)},C=()=>{setTimeout(()=>{i.value=!1},200)},L=h=>{k.value=`mdi:${h}`,w("update:modelValue",k.value),i.value=!1};return(h,l)=>(a(),d("div",co,[e("div",mo,[q(e("input",{id:t.inputId,"onUpdate:modelValue":l[0]||(l[0]=P=>k.value=P),type:"text",placeholder:t.placeholder,onInput:_,onFocus:l[1]||(l[1]=P=>i.value=!0),onBlur:C},null,40,vo),[[Pe,k.value]]),k.value?(a(),d("div",po,[e("i",{class:G(`mdi mdi-${k.value.replace("mdi:","")}`)},null,2)])):M("",!0)]),i.value&&g.value.length>0?(a(),d("div",fo,[e("div",go,[(a(!0),d(ve,null,be(g.value,P=>(a(),d("div",{key:P,class:"icon-option",onMousedown:me(N=>L(P),["prevent"]),title:P},[e("i",{class:G(`mdi mdi-${P}`)},null,2),e("span",null,f(P),1)],40,yo))),128))])])):M("",!0)]))}},ho=ke(bo,[["__scopeId","data-v-a64f5011"]]),ko={key:0,class:"dropdown-label"},wo={key:0,class:"required"},$o=["placeholder","disabled","onKeydown"],Co={class:"dropdown-icons"},_o={key:0,class:"mdi mdi-loading mdi-spin"},So={key:2,class:"mdi mdi-chevron-down"},Io={key:1,class:"error-message"},Do={key:2,class:"hint-message"},xo={key:0,class:"dropdown-menu"},To=["onMousedown","onMouseenter"],Mo={class:"option-content"},Ro={class:"option-label"},Eo={key:0,class:"option-description"},Ao={key:0,class:"mdi mdi-check selected-icon"},Lo={key:3,class:"dropdown-menu"},Oo={__name:"SearchableDropdown",props:{modelValue:{type:[String,Number,Object],default:null},options:{type:Array,required:!0,default:()=>[]},label:{type:String,default:""},placeholder:{type:String,default:"Search..."},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},error:{type:String,default:""},hint:{type:String,default:""},optionLabel:{type:String,default:"label"},optionValue:{type:String,default:"value"},optionDescription:{type:String,default:"description"},filterMethod:{type:Function,default:null}},emits:["update:modelValue","change","search"],setup(t,{emit:m}){const u=t,w=m,k=y(null),i=y(null),p=y(""),g=y(!1),_=y(0),C=y(!1),L=R=>typeof R=="string"||typeof R=="number"?R:R[u.optionLabel]||R.label||R.name||String(R),h=R=>typeof R=="string"||typeof R=="number"?R:R[u.optionValue]||R.value||R.id||R,l=R=>typeof R=="string"||typeof R=="number"?"":R[u.optionDescription]||R.description||"",P=R=>{const j=h(R);return typeof u.modelValue=="object"?h(u.modelValue)===j:u.modelValue===j},N=K(()=>{if(!p.value)return u.options;if(u.filterMethod)return u.options.filter(j=>u.filterMethod(j,p.value));const R=p.value.toLowerCase();return u.options.filter(j=>{const ee=L(j).toLowerCase(),ue=l(j).toLowerCase();return ee.includes(R)||ue.includes(R)})}),U=K(()=>{if(!u.modelValue)return"";const R=u.options.find(j=>{const ee=h(j);return typeof u.modelValue=="object"?ee===h(u.modelValue):ee===u.modelValue});return R?L(R):""});ie(()=>u.modelValue,R=>{C.value||(p.value=U.value)}),ie(()=>u.options,()=>{!C.value&&u.modelValue&&(p.value=U.value)},{deep:!0}),ie(p,R=>{w("search",R),_.value=0}),Ee(()=>{p.value=U.value});const T=()=>{var R;C.value=!0,g.value=!0,(R=i.value)==null||R.select()},x=()=>{C.value=!1,setTimeout(()=>{g.value=!1,u.modelValue?p.value=U.value:p.value=""},200)},o=()=>{var R;g.value=!1,(R=i.value)==null||R.blur()},r=R=>{const j=h(R);w("update:modelValue",j),w("change",j,R),p.value=L(R),o()},A=()=>{var R;w("update:modelValue",null),w("change",null,null),p.value="",(R=i.value)==null||R.focus()},J=()=>{if(!g.value){g.value=!0;return}_.value<N.value.length-1&&_.value++},Z=()=>{_.value>0&&_.value--},Q=()=>{N.value.length>0&&_.value>=0&&r(N.value[_.value])},W=R=>{k.value&&!k.value.contains(R.target)&&(g.value=!1,u.modelValue?p.value=U.value:p.value="")};return Ee(()=>{document.addEventListener("click",W)}),We(()=>{document.removeEventListener("click",W)}),(R,j)=>(a(),d("div",{class:"searchable-dropdown",ref_key:"dropdownRef",ref:k},[t.label?(a(),d("label",ko,[D(f(t.label)+" ",1),t.required?(a(),d("span",wo,"*")):M("",!0)])):M("",!0),e("div",{class:G(["dropdown-input-wrapper",{"has-error":t.error,disabled:t.disabled}])},[q(e("input",{ref_key:"inputRef",ref:i,type:"text","onUpdate:modelValue":j[0]||(j[0]=ee=>p.value=ee),placeholder:t.placeholder,disabled:t.disabled||t.loading,onFocus:T,onBlur:x,onKeydown:[Ke(me(J,["prevent"]),["down"]),Ke(me(Z,["prevent"]),["up"]),Ke(me(Q,["prevent"]),["enter"]),Ke(o,["escape"])],class:"dropdown-input"},null,40,$o),[[Pe,p.value]]),e("div",Co,[t.loading?(a(),d("i",_o)):t.modelValue&&!t.disabled?(a(),d("i",{key:1,class:"mdi mdi-close-circle clear-icon",onClick:A})):(a(),d("i",So))])],2),t.error?(a(),d("div",Io,f(t.error),1)):M("",!0),t.hint&&!t.error?(a(),d("div",Do,f(t.hint),1)):M("",!0),fe(st,{name:"dropdown"},{default:tt(()=>[g.value&&N.value.length>0?(a(),d("div",xo,[(a(!0),d(ve,null,be(N.value,(ee,ue)=>(a(),d("div",{key:h(ee),class:G(["dropdown-item",{highlighted:ue===_.value,selected:P(ee)}]),onMousedown:me(De=>r(ee),["prevent"]),onMouseenter:De=>_.value=ue},[e("div",Mo,[e("div",Ro,f(L(ee)),1),l(ee)?(a(),d("div",Eo,f(l(ee)),1)):M("",!0)]),P(ee)?(a(),d("i",Ao)):M("",!0)],42,To))),128))])):M("",!0)]),_:1}),g.value&&N.value.length===0&&!t.loading?(a(),d("div",Lo,[...j[1]||(j[1]=[e("div",{class:"dropdown-item no-results"},[e("i",{class:"mdi mdi-magnify"}),D(" No results found ")],-1)])])):M("",!0)],512))}},Ze=ke(Oo,[["__scopeId","data-v-679ce35f"]]),Po={class:"smartir-selector"},Vo={class:"form-group"},Uo={class:"form-group"},jo={class:"form-group"},Fo=["value"],No={key:0,class:"error-message"},Bo={class:"form-group"},Ho={class:"form-group"},qo={key:1,class:"code-info"},zo={class:"info-content"},Jo={class:"info-row"},Wo={class:"info-value"},Go={class:"info-row"},Ko={class:"info-value"},Xo={key:0,class:"info-row"},Yo={class:"info-value"},Zo={class:"info-row"},Qo={class:"info-value"},el={__name:"SmartIRDeviceSelector",props:{entityType:{type:String,required:!0},modelValue:{type:Object,default:()=>({})},broadlinkDevices:{type:Array,default:()=>[]}},emits:["update:modelValue","change"],setup(t,{expose:m,emit:u}){const w=t,k=u,i=y([]),p=y([]),g=y(""),_=y(""),C=y(""),L=y(""),h=y(""),l=y(null),P=y(!1),N=y(!1),U=y({manufacturer:"",model:"",controller:""});Ee(async()=>{if(await T(),w.modelValue&&(g.value=w.modelValue.manufacturer||"",_.value=w.modelValue.device_code||"",C.value=w.modelValue.controller_device||"",L.value=w.modelValue.temperature_sensor||"",h.value=w.modelValue.humidity_sensor||"",g.value&&(await x(g.value),_.value&&p.value.length>0))){const R=p.value.find(j=>j.code===_.value);R&&(l.value={code:R.code,manufacturer:g.value,models:R.models,controller:R.controller})}}),ie(()=>w.entityType,async R=>{R&&(g.value="",_.value="",p.value=[],l.value=null,await T())});const T=async()=>{if(w.entityType){P.value=!0,U.value.manufacturer="";try{const R=await te.get("/api/smartir/codes/manufacturers",{params:{entity_type:w.entityType}});if(R.data.success)i.value=R.data.manufacturers||[];else throw new Error(R.data.error||"Failed to load manufacturers")}catch(R){console.error("Error loading manufacturers:",R),U.value.manufacturer="Failed to load manufacturers. Please try again.",i.value=[]}finally{P.value=!1}}},x=async R=>{if(!(!R||!w.entityType)){N.value=!0,U.value.model="";try{const j=await te.get("/api/smartir/codes/models",{params:{entity_type:w.entityType,manufacturer:R}});if(j.data.success){const ee=j.data.models||[];p.value=ee.map(ue=>{const De=ue.models&&ue.models.length>0?ue.models.join(", "):`Code ${ue.code}`;return{code:ue.code,label:De,description:`Code: ${ue.code}`,models:ue.models,controller:ue.controller}})}else throw new Error(j.data.error||"Failed to load models")}catch(j){console.error("Error loading models:",j),U.value.model="Failed to load models. Please try again.",p.value=[]}finally{N.value=!1}}},o=async R=>{g.value=R,_.value="",l.value=null,p.value=[],R&&await x(R),Q()},r=()=>{const R=p.value.find(j=>j.code===_.value);R&&(l.value={code:R.code,manufacturer:g.value,models:R.models,controller:R.controller}),Q()},A=()=>{Q()},J=()=>{Q()},Z=()=>{Q()},Q=()=>{var j,ee;const R={manufacturer:g.value,model:((ee=(j=l.value)==null?void 0:j.models)==null?void 0:ee[0])||"",device_code:_.value,controller_device:C.value};w.entityType==="climate"&&(L.value&&(R.temperature_sensor=L.value),h.value&&(R.humidity_sensor=h.value)),k("update:modelValue",R),k("change",R)};return m({validate:()=>{let R=!0;return U.value={manufacturer:"",model:"",controller:""},g.value||(U.value.manufacturer="Manufacturer is required",R=!1),_.value||(U.value.model="Model is required",R=!1),C.value||(U.value.controller="Broadlink controller is required",R=!1),R}}),(R,j)=>(a(),d("div",Po,[e("div",Vo,[fe(Ze,{modelValue:g.value,"onUpdate:modelValue":j[0]||(j[0]=ee=>g.value=ee),options:i.value,label:"Manufacturer",placeholder:"Search manufacturers...",required:"",loading:P.value,error:U.value.manufacturer,hint:"Select the device manufacturer",onChange:o},null,8,["modelValue","options","loading","error"])]),e("div",Uo,[fe(Ze,{modelValue:_.value,"onUpdate:modelValue":j[1]||(j[1]=ee=>_.value=ee),options:p.value,"option-label":"label","option-value":"code","option-description":"description",label:"Model",placeholder:"Search models...",required:"",disabled:!g.value,loading:N.value,error:U.value.model,hint:"Select the device model",onChange:r},null,8,["modelValue","options","disabled","loading","error"])]),e("div",jo,[j[6]||(j[6]=e("label",{for:"controller-device"},[e("i",{class:"mdi mdi-remote"}),D(" Controller Device * ")],-1)),q(e("select",{id:"controller-device","onUpdate:modelValue":j[2]||(j[2]=ee=>C.value=ee),required:"",onChange:A},[j[5]||(j[5]=e("option",{value:""},"-- Select Controller Device --",-1)),(a(!0),d(ve,null,be(t.broadlinkDevices,ee=>(a(),d("option",{key:ee.entity_id,value:ee.entity_id},[D(f(ee.name||ee.entity_id)+" ",1),ee.area_name?(a(),d(ve,{key:0},[D(" - "+f(ee.area_name),1)],64)):M("",!0)],8,Fo))),128))],544),[[Re,C.value]]),j[7]||(j[7]=e("small",null,"Which remote device will send the IR/RF commands",-1)),U.value.controller?(a(),d("div",No,f(U.value.controller),1)):M("",!0)]),t.entityType==="climate"?(a(),d(ve,{key:0},[e("div",Bo,[j[8]||(j[8]=e("label",{for:"temperature-sensor"},"Temperature Sensor",-1)),q(e("input",{id:"temperature-sensor","onUpdate:modelValue":j[3]||(j[3]=ee=>L.value=ee),type:"text",placeholder:"e.g., sensor.living_room_temperature",onInput:J},null,544),[[Pe,L.value]]),j[9]||(j[9]=e("small",null,"Optional: Temperature sensor entity for current temperature",-1))]),e("div",Ho,[j[10]||(j[10]=e("label",{for:"humidity-sensor"},"Humidity Sensor",-1)),q(e("input",{id:"humidity-sensor","onUpdate:modelValue":j[4]||(j[4]=ee=>h.value=ee),type:"text",placeholder:"e.g., sensor.living_room_humidity",onInput:Z},null,544),[[Pe,h.value]]),j[11]||(j[11]=e("small",null,"Optional: Humidity sensor entity for current humidity",-1))])],64)):M("",!0),l.value?(a(),d("div",qo,[j[16]||(j[16]=e("div",{class:"info-header"},[e("i",{class:"mdi mdi-information"}),e("span",null,"Selected Device Code")],-1)),e("div",zo,[e("div",Jo,[j[12]||(j[12]=e("span",{class:"info-label"},"Code ID:",-1)),e("span",Wo,f(l.value.code_id),1)]),e("div",Go,[j[13]||(j[13]=e("span",{class:"info-label"},"Manufacturer:",-1)),e("span",Ko,f(l.value.manufacturer),1)]),l.value.models&&l.value.models.length>0?(a(),d("div",Xo,[j[14]||(j[14]=e("span",{class:"info-label"},"Supported Models:",-1)),e("span",Yo,f(l.value.models.join(", ")),1)])):M("",!0),e("div",Zo,[j[15]||(j[15]=e("span",{class:"info-label"},"Controller:",-1)),e("span",Qo,f(l.value.controller||"Broadlink"),1)])])])):M("",!0)]))}},tl=ke(el,[["__scopeId","data-v-1911c8f6"]]),ol={class:"modal-content"},ll={class:"modal-header"},nl={class:"input-wrapper"},sl={key:0,class:"validation-tooltip"},al={class:"input-wrapper"},il=["disabled"],rl={key:0,class:"validation-tooltip"},dl={key:0,class:"smartir-notice"},ul={key:0,class:"notice-success"},cl={key:1,class:"notice-warning"},ml={key:1,class:"smartir-notice"},vl={key:2},pl={class:"form-group"},fl=["disabled"],gl=["disabled"],yl={key:0},bl={key:1},hl={key:2},kl={key:3},wl={key:0,class:"form-group"},$l={class:"area-display-readonly"},Cl=["value"],_l=["disabled"],Sl=["href"],Il={key:1,class:"form-group"},Dl={class:"form-group"},xl={class:"input-wrapper"},Tl=["value"],Ml=["value"],Rl={key:2,class:"validation-tooltip"},El={key:0},Al={key:1},Ll={key:3,class:"smartir-section"},Ol={class:"modal-footer"},Pl={type:"submit",form:"device-form",class:"btn btn-primary"},Vl={__name:"DeviceForm",props:{device:{type:Object,default:null}},emits:["save","cancel"],setup(t,{emit:m}){const u=t,w=m,k=Le("smartirStatus"),i=Le("smartirEnabled"),p=K(()=>{var v;return localStorage.getItem("smartir_simulate_not_installed")==="true"?!1:((v=k==null?void 0:k.value)==null?void 0:v.installed)||!1}),g=K(()=>!!u.device),_=K(()=>["climate","media_player","fan","light"].includes(l.value.entity_type)),C=K(()=>p.value?!_.value&&l.value.entity_type?"(Not supported for this type)":"(Pre-configured Codes)":"(Requires SmartIR)"),L=K(()=>{var v;const I=((v=u.device)==null?void 0:v.commands)||{};return Object.keys(I).length>0}),h=K(()=>{if(!l.value.broadlink_entity)return"";const I=x.value.find(v=>v.entity_id===l.value.broadlink_entity);return I&&I.name||l.value.broadlink_entity}),l=y({name:"",entity_type:"",device_type:"broadlink",device:"",area:"",icon:"",broadlink_entity:"",enabled:!0,commands:{}}),P=y({name:"",entity_type:"",broadlink_entity:""}),N=y({}),U=y(null),T=y([]),x=y([]),o=y(null),r=y(null),A=y(null),J=y(!1);Ee(async()=>{u.device&&(l.value={...u.device,device_type:u.device.device_type||"broadlink"},l.value.device_type==="smartir"&&(N.value={manufacturer:u.device.manufacturer,model:u.device.model,device_code:u.device.device_code,controller_device:u.device.controller_device,temperature_sensor:u.device.temperature_sensor,humidity_sensor:u.device.humidity_sensor})),await Promise.all([Z(),Q()])});const Z=async()=>{try{const I=await te.get("/api/areas");T.value=I.data.areas||[]}catch(I){console.error("Error loading areas:",I),T.value=[]}},Q=async()=>{try{const v=(await te.get("/api/remote/devices")).data.devices||[];x.value=v,console.log("Loaded remote devices:",v)}catch(I){console.error("Error loading remote devices:",I),x.value=[]}},W=I=>{if(!I)return"";const v=I.toLowerCase();for(const V of T.value){const pe=V.toLowerCase();if(v.includes(pe))return V}return""},R=(I,v="")=>{const V=v.toLowerCase();return V.includes("tv")?"mdi:television":V.includes("lamp")?"mdi:lamp":V.includes("ceiling")?"mdi:ceiling-light":V.includes("floor")?"mdi:floor-lamp":V.includes("desk")?"mdi:desk-lamp":V.includes("fan")?"mdi:fan":V.includes("ac")||V.includes("air con")?"mdi:air-conditioner":V.includes("heater")?"mdi:radiator":V.includes("blind")?"mdi:blinds":V.includes("curtain")?"mdi:curtains":V.includes("garage")?"mdi:garage":V.includes("speaker")||V.includes("stereo")?"mdi:speaker":V.includes("receiver")?"mdi:audio-video":{light:"mdi:lightbulb",fan:"mdi:fan",switch:"mdi:light-switch",media_player:"mdi:television",cover:"mdi:window-shutter",climate:"mdi:thermostat"}[I]||"mdi:devices"};ie(()=>l.value.name,I=>{if(!g.value&&I&&!l.value.area){const v=W(I);v&&(l.value.area=v)}!g.value&&I&&l.value.entity_type&&(J.value||!l.value.icon)&&(l.value.icon=R(l.value.entity_type,I),J.value=!0)}),ie(()=>l.value.entity_type,I=>{!g.value&&I&&(J.value||!l.value.icon)&&(l.value.icon=R(I,l.value.name),J.value=!0)}),ie(()=>l.value.icon,(I,v)=>{v!==void 0&&I!==v&&!J.value&&(J.value=!1),I||(J.value=!1)});const j=y(!1),ee=async()=>{var I;if((I=u.device)!=null&&I.id){j.value=!0;try{const v=await te.post(`/api/devices/${u.device.id}/sync-area`);v.data.success?(l.value.area=v.data.area||"",v.data.area?console.log(`Area synced: ${v.data.area}`):console.log("No area assigned in Home Assistant")):console.warn(v.data.message||"Entity not found in HA")}catch(v){console.error("Failed to sync area:",v)}finally{j.value=!1}}},ue=()=>{var V;return!((V=u.device)!=null&&V.id)||!l.value.entity_type?"#":`/config/entities/entity/${`${l.value.entity_type}.${u.device.id}`}`},De=()=>{P.value={name:"",entity_type:"",broadlink_entity:""};let I=!0;return(!l.value.name||l.value.name.trim()==="")&&(P.value.name="Device name is required",I=!1),l.value.entity_type||(P.value.entity_type="Entity type is required",I=!1),l.value.device_type==="broadlink"&&!l.value.broadlink_entity&&(P.value.broadlink_entity="Broadlink device is required",I=!1),I},we=I=>{P.value[I]=""},Ae=async()=>{if(l.value.device_type==="smartir"){if(U.value&&!U.value.validate())return;const I={...l.value,smartir_config:{manufacturer:N.value.manufacturer,model:N.value.model,code_id:N.value.device_code,controller_device:N.value.controller_device}};w("save",I)}else{if(!De())return;w("save",{...l.value})}},xe=I=>{N.value=I};return(I,v)=>(a(),d("div",{class:"modal-overlay",onClick:v[11]||(v[11]=me(V=>I.$emit("cancel"),["self"]))},[e("div",ol,[e("div",ll,[e("h2",null,f(g.value?"Edit Device":"Add New Device"),1),e("button",{onClick:v[0]||(v[0]=V=>I.$emit("cancel")),class:"close-btn"},[...v[12]||(v[12]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("form",{id:"device-form",onSubmit:me(Ae,["prevent"]),class:"modal-body"},[e("div",{class:G(["form-group",{"has-error":P.value.name}])},[v[14]||(v[14]=e("label",{for:"device-name"},"Device Name *",-1)),e("div",nl,[q(e("input",{id:"device-name",ref_key:"nameInput",ref:o,"onUpdate:modelValue":v[1]||(v[1]=V=>l.value.name=V),type:"text",placeholder:"e.g., Living Room TV",onInput:v[2]||(v[2]=V=>we("name"))},null,544),[[Pe,l.value.name]]),P.value.name?(a(),d("div",sl,[v[13]||(v[13]=e("i",{class:"mdi mdi-alert"},null,-1)),D(" "+f(P.value.name),1)])):M("",!0)]),v[15]||(v[15]=e("small",null,"Friendly name for this device",-1))],2),e("div",{class:G(["form-group",{"has-error":P.value.entity_type}])},[v[23]||(v[23]=e("label",{for:"entity-type"},"Entity Type *",-1)),e("div",al,[q(e("select",{id:"entity-type",ref_key:"typeSelect",ref:r,"onUpdate:modelValue":v[3]||(v[3]=V=>l.value.entity_type=V),onChange:v[4]||(v[4]=V=>we("entity_type"))},[v[16]||(v[16]=qe('<option value="" data-v-94bc1fe5>-- Select Type --</option><option value="light" data-v-94bc1fe5>ğŸ’¡ Light</option><option value="fan" data-v-94bc1fe5>ğŸŒ€ Fan</option><option value="switch" data-v-94bc1fe5>ğŸ”Œ Switch</option><option value="media_player" data-v-94bc1fe5>ğŸ“º Media Player</option><option value="cover" data-v-94bc1fe5>ğŸªŸ Cover (Blinds/Curtains)</option>',6)),e("option",{value:"climate",disabled:!p.value}," ğŸŒ¡ï¸ Climate "+f(p.value?"":"(Requires SmartIR)"),9,il)],544),[[Re,l.value.entity_type]]),P.value.entity_type?(a(),d("div",rl,[v[17]||(v[17]=e("i",{class:"mdi mdi-alert"},null,-1)),D(" "+f(P.value.entity_type),1)])):M("",!0)]),l.value.entity_type==="climate"?(a(),d("div",dl,[p.value?(a(),d("div",ul,[...v[18]||(v[18]=[e("i",{class:"mdi mdi-check-circle"},null,-1),e("span",null,"SmartIR detected! Climate entities will be created via SmartIR profiles.",-1)])])):(a(),d("div",cl,[...v[19]||(v[19]=[e("i",{class:"mdi mdi-alert"},null,-1),e("div",null,[e("strong",null,"SmartIR Required"),e("p",null,"Climate entities (AC, heaters) require SmartIR integration."),e("a",{href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"smartir-link"}," Install SmartIR â†’ ")],-1)])]))])):p.value&&["media_player","fan","light"].includes(l.value.entity_type)?(a(),d("div",ml,[...v[20]||(v[20]=[e("div",{class:"notice-info"},[e("i",{class:"mdi mdi-information"}),e("span",null,"ğŸ’¡ SmartIR available! You can use pre-configured codes or learn your own.")],-1)])])):!p.value&&l.value.entity_type?(a(),d("small",vl,[v[21]||(v[21]=D(" ğŸ’¡ Tip: Install ",-1)),v[22]||(v[22]=e("a",{href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"inline-link"},"SmartIR",-1)),D(" for pre-configured "+f(l.value.entity_type==="climate"?"climate":l.value.entity_type)+" device codes ",1)])):M("",!0)],2),e("div",pl,[v[26]||(v[26]=e("label",{for:"device-type"},"Device Type *",-1)),q(e("select",{id:"device-type","onUpdate:modelValue":v[5]||(v[5]=V=>l.value.device_type=V),required:"",disabled:g.value},[v[24]||(v[24]=e("option",{value:""},"-- Select Device Type --",-1)),v[25]||(v[25]=e("option",{value:"broadlink"},"ğŸ“¡ Broadlink Device (Learn IR Codes)",-1)),Se(i)?(a(),d("option",{key:0,value:"smartir",disabled:!p.value||!_.value}," ğŸŒ SmartIR Device "+f(C.value),9,gl)):M("",!0)],8,fl),[[Re,l.value.device_type]]),g.value?(a(),d("small",yl,"Cannot change device type after creation")):l.value.device_type==="smartir"?(a(),d("small",bl,"Using pre-configured codes from SmartIR repository")):l.value.device_type==="broadlink"?(a(),d("small",hl,"Learn and store your own IR codes")):(a(),d("small",kl,"Choose how to configure this device"))]),g.value?(a(),d("div",wl,[v[29]||(v[29]=e("label",{for:"device-area"},"Area",-1)),e("div",$l,[e("input",{id:"device-area",value:l.value.area||"Not assigned",type:"text",readonly:"",class:"readonly-input"},null,8,Cl),e("button",{type:"button",onClick:ee,disabled:j.value,class:"sync-area-btn",title:"Sync area from Home Assistant"},[e("i",{class:G(j.value?"mdi mdi-loading mdi-spin":"mdi mdi-refresh")},null,2)],8,_l)]),e("small",null,[v[27]||(v[27]=e("i",{class:"mdi mdi-information-outline"},null,-1)),v[28]||(v[28]=D(" Set area in Home Assistant, then click sync. ",-1)),e("a",{href:ue(),target:"_blank",class:"inline-link"},"Open in HA â†’",8,Sl)])])):(a(),d("div",Il,[...v[30]||(v[30]=[e("div",{class:"info-notice"},[e("i",{class:"mdi mdi-information-outline"}),e("span",null,[e("strong",null,"Area Assignment:"),D(" After generating entities and restarting Home Assistant, you can assign areas in HA and sync them here.")])],-1)])])),e("div",Dl,[v[31]||(v[31]=e("label",{for:"device-icon"},"Icon",-1)),fe(ho,{modelValue:l.value.icon,"onUpdate:modelValue":v[6]||(v[6]=V=>l.value.icon=V),inputId:"device-icon",placeholder:"e.g., mdi:television"},null,8,["modelValue"]),v[32]||(v[32]=e("small",null,"Optional: Material Design Icon name",-1))]),l.value.device_type==="broadlink"?(a(),d("div",{key:2,class:G(["form-group",{"has-error":P.value.broadlink_entity}])},[v[35]||(v[35]=e("label",{for:"broadlink-entity"},"Remote Device *",-1)),e("div",xl,[!g.value||!L.value?q((a(),d("select",{key:0,id:"broadlink-entity",ref_key:"broadlinkSelect",ref:A,"onUpdate:modelValue":v[7]||(v[7]=V=>l.value.broadlink_entity=V),onChange:v[8]||(v[8]=V=>we("broadlink_entity"))},[v[33]||(v[33]=e("option",{value:""},"-- Select Remote Device --",-1)),(a(!0),d(ve,null,be(x.value,V=>(a(),d("option",{key:V.entity_id,value:V.entity_id},[D(f(V.name||V.entity_id)+" ",1),V.area_name?(a(),d(ve,{key:0},[D(" - "+f(V.area_name),1)],64)):M("",!0)],8,Tl))),128))],544)),[[Re,l.value.broadlink_entity]]):(a(),d("input",{key:1,id:"broadlink-entity",value:h.value,type:"text",readonly:"",disabled:""},null,8,Ml)),P.value.broadlink_entity?(a(),d("div",Rl,[v[34]||(v[34]=e("i",{class:"mdi mdi-alert"},null,-1)),D(" "+f(P.value.broadlink_entity),1)])):M("",!0)]),!g.value||!L.value?(a(),d("small",El,"Required: Select which remote device to use for sending commands")):(a(),d("small",Al,"Cannot change remote device after commands are learned"))],2)):M("",!0),l.value.device_type==="smartir"?(a(),d("div",Ll,[v[36]||(v[36]=e("div",{class:"section-header"},[e("i",{class:"mdi mdi-cloud-download"}),e("span",null,"SmartIR Device Configuration")],-1)),fe(tl,{ref_key:"smartirSelector",ref:U,"entity-type":l.value.entity_type,modelValue:N.value,"onUpdate:modelValue":v[9]||(v[9]=V=>N.value=V),"broadlink-devices":x.value,onChange:xe},null,8,["entity-type","modelValue","broadlink-devices"])])):M("",!0)],32),e("div",Ol,[e("button",{type:"button",onClick:v[10]||(v[10]=V=>I.$emit("cancel")),class:"btn btn-secondary"}," Cancel "),e("button",Pl,[v[37]||(v[37]=e("i",{class:"mdi mdi-check"},null,-1)),D(" "+f(g.value?"Update":"Create"),1)])])])]))}},Ul=ke(Vl,[["__scopeId","data-v-94bc1fe5"]]),jl={class:"modal-header"},Fl={class:"modal-body"},Nl={class:"message-text"},Bl={key:0,class:"checkbox-option"},Hl={class:"modal-footer"},ql=["disabled"],zl={__name:"ConfirmDialog",props:{isOpen:{type:Boolean,default:!1},title:{type:String,default:"Confirm"},message:{type:String,required:!0},confirmText:{type:String,default:"OK"},cancelText:{type:String,default:"Cancel"},showCancel:{type:Boolean,default:!0},dangerMode:{type:Boolean,default:!1},confirmDisabled:{type:Boolean,default:!1},checkboxLabel:{type:String,default:""}},emits:["confirm","cancel"],setup(t,{emit:m}){const u=t,w=m,k=y(!1);ie(()=>u.isOpen,g=>{g&&(k.value=!1)});const i=()=>{w("confirm",k.value)},p=()=>{w("cancel")};return(g,_)=>t.isOpen?(a(),d("div",{key:0,class:"modal-overlay",onClick:me(p,["self","stop"])},[e("div",{class:"modal-dialog confirm-dialog",onClick:_[1]||(_[1]=me(()=>{},["stop"]))},[e("div",jl,[e("h2",null,f(t.title),1)]),e("div",Fl,[e("p",Nl,f(t.message),1),t.checkboxLabel?(a(),d("div",Bl,[e("label",null,[q(e("input",{type:"checkbox","onUpdate:modelValue":_[0]||(_[0]=C=>k.value=C)},null,512),[[de,k.value]]),e("span",null,f(t.checkboxLabel),1)])])):M("",!0)]),e("div",Hl,[t.showCancel?(a(),d("button",{key:0,onClick:me(p,["stop"]),class:"btn btn-secondary"},f(t.cancelText),1)):M("",!0),t.confirmText?(a(),d("button",{key:1,onClick:me(i,["stop"]),class:G(["btn",t.dangerMode?"btn-danger":"btn-primary"]),disabled:t.confirmDisabled},f(t.confirmText),11,ql)):M("",!0)])])])):M("",!0)}},He=ke(zl,[["__scopeId","data-v-9cea6cb3"]]),Jl={class:"modal-content"},Wl={class:"modal-header"},Gl={class:"modal-body"},Kl={key:0,class:"smartir-info"},Xl={key:0,class:"climate-note"},Yl={class:"form-group"},Zl=["value"],Ql={class:"form-group"},en=["disabled"],tn={label:"Suggested Commands"},on=["value"],ln=["disabled"],nn={class:"form-group"},sn={class:"radio-card-group"},an=["disabled"],rn=["disabled"],dn={class:"form-group"},un={class:"radio-card-group"},cn=["disabled"],mn=["disabled"],vn=["disabled"],pn={key:0,class:"help-box"},fn={class:"learn-action"},gn=["disabled"],yn={key:0,class:"mdi mdi-loading mdi-spin"},bn={key:1,class:"mdi mdi-remote-tv"},hn={key:0,class:"learning-status"},kn={key:0},wn={key:1},$n={key:2},Cn={key:1,class:"result-message success"},_n={key:2,class:"section-divider"},Sn={key:3,class:"loading-commands"},In={key:4,class:"learned-commands"},Dn={class:"commands-header"},xn=["disabled"],Tn={class:"command-list"},Mn={class:"command-info"},Rn={class:"command-name"},En={class:"command-right"},An={key:0,class:"mdi mdi-alert-circle error-icon",title:"Error: Command failed to learn. Delete and try again."},Ln={key:1,class:"mdi mdi-clock-outline pending-icon",title:"Pending: Waiting for code from storage..."},On=["title"],Pn={class:"command-actions"},Vn=["onClick","title","disabled"],Un=["onClick","title"],jn={key:5,class:"untracked-commands"},Fn={class:"command-list"},Nn={class:"command-name"},Bn=["onClick"],Hn={class:"modal-footer"},qn=["disabled"],zn={__name:"CommandLearner",props:{device:{type:Object,required:!0}},emits:["cancel","learned"],setup(t,{emit:m}){const u=t,w=m,k=y([]),i=y(""),p=y(""),g=y(""),_=y("ir"),C=y("manager_only"),L=y(!1),h=y(!1),l=y(""),P=y(""),N=y(""),U=y("success"),T=y([]),x=y([]),o=y(!1),r=y(!1),A=y(""),J=y(!1),Z=y(null),Q=y(null),W=y(""),R=y(""),j=K(()=>u.device.device_type==="smartir");K(()=>{if(j.value)return!1;const b=p.value==="__custom__"?g.value:p.value;return i.value&&b.trim()});const ee=()=>{Z.value&&Z.value.setCustomValidity("")},ue=()=>{Q.value&&Q.value.setCustomValidity("")},De=K(()=>{const b=k.value.find(c=>c.entity_id===i.value);return b?b.name||b.entity_id:i.value}),we={light:["turn_on","turn_off","toggle","brightness_up","brightness_down","dim","bright"],fan:["turn_on","turn_off","toggle","speed_low","speed_medium","speed_high","speed_1","speed_2","speed_3","speed_4","speed_5","oscillate_on","oscillate_off","direction_forward","direction_reverse"],switch:["turn_on","turn_off","toggle"],media_player:["turn_on","turn_off","toggle","volume_up","volume_down","volume_mute","play","pause","stop","play_pause","next_track","previous_track","channel_up","channel_down","source_hdmi1","source_hdmi2","source_hdmi3","source_tv","source_aux","source_bluetooth","menu","home","back","select","arrow_up","arrow_down","arrow_left","arrow_right"],cover:["open","close","stop","open_tilt","close_tilt","position_0","position_25","position_50","position_75","position_100"]},Ae=K(()=>{const b=u.device.entity_type||"switch";return we[b]||we.switch});ie(()=>u.device,async(b,c)=>{if(b&&c&&b.id===c.id){const s=Object.keys(b.commands||{}).length,F=Object.keys(c.commands||{}).length;s!==F&&(console.log(`ğŸ”„ Device commands changed (${F} -> ${s}), reloading...`),await I(!0))}},{deep:!0}),Ee(async()=>{await xe(),await I(),await Ce(),Z.value&&(Z.value.setCustomValidity(""),Z.value.oninvalid=()=>{Z.value.setCustomValidity("Command name is required")}),u.device.broadlink_entity&&(i.value=u.device.broadlink_entity)}),ie(p,async b=>{b==="__custom__"&&(await at(),Q.value&&(Q.value.setCustomValidity(""),Q.value.oninvalid=()=>{Q.value.setCustomValidity("Custom command name is required")}))});const xe=async()=>{try{const b=await te.get("/api/broadlink/devices");k.value=b.data.devices||[]}catch(b){console.error("Error loading Broadlink devices:",b)}},I=async(b=!1)=>{var c,s;o.value=!0;try{if(b&&!j.value)try{await te.post("/api/commands/check-pending"),console.log("ğŸ”„ Triggered backend polling check")}catch(F){console.warn("âš ï¸ Could not trigger polling check:",F)}if(j.value){const F=await te.get("/api/smartir/codes/code",{params:{entity_type:u.device.entity_type,code_id:u.device.device_code}});if(F.data.success&&F.data.code){const X=F.data.code.commands||{},S=F.data.code.commandType||"ir";if(u.device.entity_type==="climate"){const n=[];for(const[O,B]of Object.entries(X))typeof B=="string"?n.push({name:O,type:S}):typeof B=="object"&&B!==null&&Object.keys(B).sort((ae,ne)=>parseInt(ae)-parseInt(ne)).forEach(ae=>{n.push({name:`${O}_${ae}`,type:S,label:`${O.charAt(0).toUpperCase()+O.slice(1)} ${ae}Â°C`})});T.value=n}else T.value=Object.keys(X).map(n=>({name:n,type:S}))}}else{if(console.log("ğŸ“‹ Loading commands for device:",u.device),console.log("ğŸ“‹ Device ID:",u.device.id),console.log("ğŸ“‹ Force reload:",b),b&&u.device.id){console.log("ğŸ”„ Force reloading commands from API after sync");try{const X=(await te.get(`/api/commands/${u.device.id}`)).data.commands||{};console.log("ğŸ“¦ Raw commands from API:",X),T.value=Object.entries(X).map(([S,n])=>{console.log(`  Command '${S}':`,n,`(type: ${typeof n})`);const O=typeof n=="object"&&n!==null&&(n.command_type||n.type)||"ir",B=typeof n=="object"&&n!==null?n.data:n;return{name:S,type:O,data:B,hasError:B==="error",isPending:B==="pending"}}),console.log("ğŸ“‹ Reloaded commands:",T.value)}catch(F){if(console.error("âŒ Error loading commands:",F),((c=F.response)==null?void 0:c.status)===404)console.log("â„¹ï¸ No commands found for device"),T.value=[];else throw F}}else if(u.device.commands&&Object.keys(u.device.commands).length>0)console.log("âœ… Using commands from device object"),T.value=Object.entries(u.device.commands).map(([F,X])=>{const S=X.data||X;return{name:F,type:X.command_type||X.type||"ir",data:S,hasError:S==="error",isPending:S==="pending"}});else if(u.device.commands!==void 0)console.log("â„¹ï¸ Device has empty commands object - skipping API call"),T.value=[];else if(u.device.id){console.log("ğŸŒ Fetching commands from API for device ID:",u.device.id);try{const X=(await te.get(`/api/commands/${u.device.id}`)).data.commands||{};T.value=Object.entries(X).map(([S,n])=>({name:S,type:n.command_type||n.type||"ir"}))}catch(F){if(((s=F.response)==null?void 0:s.status)===404)console.log("â„¹ï¸ No commands found for device (this is normal for new devices)"),T.value=[];else throw F}}else console.log("âš ï¸ No commands found and no device ID");console.log("ğŸ“‹ Final learned commands:",T.value)}}catch(F){console.error("Error loading commands:",F)}finally{o.value=!1}},v=async()=>{N.value="",U.value="",P.value="",h.value=!0,l.value="preparing";try{const b=p.value==="__custom__"?g.value:p.value;_.value==="rf"?(l.value="learning",N.value="âš ï¸ Learning request sent to device. Check Home Assistant notifications (ğŸ””) for instructions. Note: If the device is offline or times out, you will see a notification but this dialog will still show success.",U.value="warning",await new Promise(s=>setTimeout(s,50))):l.value="learning";const c=await te.post("/api/commands/learn",{device_id:u.device.id,entity_id:i.value||u.device.broadlink_entity,device:u.device.device||u.device.id,command:b.trim(),command_type:_.value,save_destination:C.value});if(c.data.success){if(l.value="complete",N.value="",U.value="",C.value==="manager_only"||C.value==="both"){T.value.find(X=>X.name===b)||T.value.push({name:b,type:_.value});const F=x.value.indexOf(b);F>-1&&x.value.splice(F,1)}await Ce(),p.value="",g.value="",w("learned",{deviceId:u.device.id,commandName:b,commandType:_.value}),h.value=!1,l.value=""}else throw new Error(c.data.error||"Failed to learn command")}catch(b){console.error("Learning error:",b),N.value=b.message||"Error learning command",U.value="error",h.value=!1,l.value=""}},V=async b=>{var c,s;try{R.value=b,W.value="";let F=u.device.id.split(".")[1];u.device.device&&(F=u.device.device);const X=j.value?u.device.controller_device:i.value||u.device.broadlink_entity;if(!X){console.error("Missing entity_id for test command:",{isSmartIR:j.value,controller_device:u.device.controller_device,broadlink_entity:u.device.broadlink_entity,selectedBroadlink:i.value,device:u.device}),N.value="Missing Broadlink remote entity. Please select a Broadlink device.",U.value="error",R.value="";return}const S={device_id:u.device.id,entity_id:X,command:b,device:u.device.device||u.device.id};console.log("ğŸ§ª Testing command:",S),(await te.post("/api/commands/test",S)).data.success&&(W.value=b,setTimeout(()=>{W.value===b&&(W.value="")},2e3))}catch(F){console.error("âŒ Test command error:",F);const X=((s=(c=F.response)==null?void 0:c.data)==null?void 0:s.error)||F.message||"Unknown error";N.value=`Failed to send command: ${X}`,U.value="error"}finally{R.value=""}},pe=b=>{A.value=b,r.value=!0},Ve=()=>{r.value=!1,A.value=""},$e=async b=>{const c=A.value;r.value=!1;try{if(console.log(`ğŸ—‘ï¸ Deleting command: ${c}, alsoDeleteFromIntegration: ${b}`),await te.delete(`/api/commands/${u.device.id}/${c}`),b)try{const s=u.device.device||u.device.id;await te.post("/api/commands/delete-from-storage",{device:s,command:c}),console.log("âœ… Also deleted from Broadlink Integration storage")}catch(s){console.warn("âš ï¸ Failed to delete from Broadlink Integration storage:",s)}await I(!0),await Ce(),N.value=`Command "${c}" deleted`,U.value="success",w("learned",{deviceId:u.device.id,commandName:c,action:"deleted"})}catch(s){console.error("âŒ Delete error:",s),N.value=`Failed to delete command: ${s.message}`,U.value="error",await I(!0)}finally{A.value=""}},Ce=async()=>{try{let b=u.device.device;b||(b=u.device.id.includes(".")?u.device.id.split(".")[1]:u.device.id),console.log("ğŸ” Looking for untracked commands for device:",b);const s=(await te.get("/api/commands/untracked")).data.untracked||{};console.log("ğŸ“¦ All untracked commands:",Object.keys(s)),console.log("ğŸ“¦ Untracked for this device:",s[b]),s[b]?x.value=Object.keys(s[b].commands):x.value=[]}catch(b){console.error("Error loading untracked commands:",b),x.value=[]}},Te=()=>{x.value.length!==0&&(J.value=!0)},Me=async b=>{var c,s,F;console.log("ğŸ”µ [IMPORT SINGLE] Importing command:",b);try{const X=u.device.device||u.device.id||((c=u.device.id)!=null&&c.includes(".")?u.device.id.split(".")[1]:null);if(!X)throw new Error("Could not determine device name for import");console.log("ğŸ”µ [IMPORT SINGLE] Calling API to import command...");const S=await te.post("/api/commands/import",{device_id:u.device.id,source_device:X,commands:[b]});console.log("ğŸ”µ [IMPORT SINGLE] API response:",S.data),S.data.success?(N.value=`Imported command '${b}' successfully!`,U.value="success",await I(!0),await Ce()):(N.value=S.data.error||"Failed to import command",U.value="error")}catch(X){console.error("ğŸ”´ [IMPORT SINGLE] Error:",X),N.value=((F=(s=X.response)==null?void 0:s.data)==null?void 0:F.error)||X.message||"Failed to import command",U.value="error"}},Y=async()=>{var b;console.log("ğŸ”µ [IMPORT] Starting import process..."),console.log("ğŸ”µ [IMPORT] Current learned commands:",T.value.length),console.log("ğŸ”µ [IMPORT] Current untracked commands:",x.value.length),J.value=!1;try{const c=u.device.device||u.device.id||((b=u.device.id)!=null&&b.includes(".")?u.device.id.split(".")[1]:null);if(console.log("ğŸ”µ [IMPORT] Device object:",u.device),console.log("ğŸ”µ [IMPORT] Extracted device name:",c),!c)throw new Error("Could not determine device name for import");console.log("ğŸ”µ [IMPORT] Calling API to import commands...");const s=await te.post("/api/commands/import",{device_id:u.device.id,source_device:c,commands:x.value});console.log("ğŸ”µ [IMPORT] API response:",s.data),s.data.success&&(N.value=`Imported ${s.data.imported_count} commands successfully!`,U.value="success",console.log("ğŸ”µ [IMPORT] Import successful, now reloading commands..."),console.log("ğŸ”µ [IMPORT] BEFORE reload - learned:",T.value.length,"untracked:",x.value.length),await I(!0),console.log("ğŸ”µ [IMPORT] AFTER loadLearnedCommands - learned:",T.value.length),await Ce(),console.log("ğŸ”µ [IMPORT] AFTER loadUntrackedCommands - untracked:",x.value.length),console.log("ğŸ”µ [IMPORT] Final state - learned:",T.value,"untracked:",x.value),console.log("ğŸ”µ [IMPORT] Emitting learned event to parent..."),w("learned",{deviceId:u.device.id,action:"imported",count:s.data.imported_count}),console.log("ğŸ”µ [IMPORT] âœ… Import process complete!"))}catch(c){console.error("ğŸ”µ [IMPORT] âŒ Import failed:",c),N.value=`Failed to import commands: ${c.message}`,U.value="error"}};return(b,c)=>(a(),d("div",{class:"modal-overlay",onClick:c[12]||(c[12]=me(s=>b.$emit("cancel"),["self"]))},[e("div",Jl,[e("div",Wl,[e("h2",null,f(j.value?"Commands for":"Learn Commands for")+" "+f(t.device.name),1),e("button",{onClick:c[0]||(c[0]=s=>b.$emit("cancel")),class:"close-btn"},[...c[13]||(c[13]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Gl,[j.value?(a(),d("div",Kl,[c[18]||(c[18]=e("i",{class:"mdi mdi-information"},null,-1)),e("div",null,[c[17]||(c[17]=e("h3",null,"SmartIR Device",-1)),e("p",null,[c[14]||(c[14]=D("This device uses SmartIR code file ",-1)),e("strong",null,f(t.device.device_code),1),c[15]||(c[15]=D(". Commands are pre-configured and cannot be learned.",-1))]),t.device.entity_type==="climate"?(a(),d("p",Xl,[...c[16]||(c[16]=[e("i",{class:"mdi mdi-alert-circle-outline"},null,-1),e("strong",null,"Note:",-1),D(" Climate device commands are temperature-based. Testing individual modes may not work as expected. Use the Home Assistant climate card to control your device. ",-1)])])):M("",!0)])])):(a(),d("form",{key:1,onSubmit:me(v,["prevent"])},[e("div",Yl,[c[19]||(c[19]=e("label",{for:"broadlink-entity"},"Broadlink Device",-1)),e("input",{id:"broadlink-entity",value:De.value,type:"text",readonly:"",disabled:""},null,8,Zl),c[20]||(c[20]=e("small",null,"Commands will be learned using this device (set when device was created)",-1))]),e("div",Ql,[c[23]||(c[23]=e("label",{for:"command-name"},"Command Name *",-1)),q(e("select",{id:"command-name",ref_key:"commandSelect",ref:Z,"onUpdate:modelValue":c[1]||(c[1]=s=>p.value=s),disabled:h.value,required:"",onChange:ee},[c[21]||(c[21]=e("option",{value:""},"-- Select or type command --",-1)),e("optgroup",tn,[(a(!0),d(ve,null,be(Ae.value,s=>(a(),d("option",{key:s,value:s},f(s),9,on))),128))]),c[22]||(c[22]=e("option",{value:"__custom__"},"Custom command...",-1))],40,en),[[Re,p.value]]),p.value==="__custom__"?q((a(),d("input",{key:0,ref_key:"customCommandInput",ref:Q,"onUpdate:modelValue":c[2]||(c[2]=s=>g.value=s),type:"text",placeholder:"Enter custom command name",disabled:h.value,required:"",class:"custom-command-input",onInput:ue},null,40,ln)),[[Pe,g.value]]):M("",!0),e("small",null,"Select a suggested command for "+f(t.device.entity_type||"this device")+", or enter a custom one.",1)]),e("div",nn,[c[28]||(c[28]=e("label",null,"Command Type",-1)),e("div",sn,[e("label",{class:G(["radio-card",{active:_.value==="ir",disabled:h.value}])},[q(e("input",{type:"radio","onUpdate:modelValue":c[3]||(c[3]=s=>_.value=s),value:"ir",disabled:h.value},null,8,an),[[ze,_.value]]),e("i",{class:G(["mdi radio-indicator",_.value==="ir"?"mdi-radiobox-marked":"mdi-radiobox-blank"])},null,2),c[24]||(c[24]=e("i",{class:"mdi mdi-remote card-icon"},null,-1)),c[25]||(c[25]=e("span",{class:"card-text"},"IR (Infrared)",-1))],2),e("label",{class:G(["radio-card",{active:_.value==="rf",disabled:h.value}])},[q(e("input",{type:"radio","onUpdate:modelValue":c[4]||(c[4]=s=>_.value=s),value:"rf",disabled:h.value},null,8,rn),[[ze,_.value]]),e("i",{class:G(["mdi radio-indicator",_.value==="rf"?"mdi-radiobox-marked":"mdi-radiobox-blank"])},null,2),c[26]||(c[26]=e("i",{class:"mdi mdi-radio-tower card-icon"},null,-1)),c[27]||(c[27]=e("span",{class:"card-text"},"RF (Radio Frequency)",-1))],2)])]),e("div",dn,[e("label",null,[c[30]||(c[30]=D(" Save Destination ",-1)),e("button",{type:"button",class:"help-btn",onClick:c[5]||(c[5]=s=>L.value=!L.value),title:"Learn more"},[...c[29]||(c[29]=[e("i",{class:"mdi mdi-help-circle-outline"},null,-1)])])]),e("div",un,[e("label",{class:G(["radio-card",{active:C.value==="manager_only",disabled:h.value}])},[q(e("input",{type:"radio","onUpdate:modelValue":c[6]||(c[6]=s=>C.value=s),value:"manager_only",disabled:h.value},null,8,cn),[[ze,C.value]]),e("i",{class:G(["mdi radio-indicator",C.value==="manager_only"?"mdi-radiobox-marked":"mdi-radiobox-blank"])},null,2),c[31]||(c[31]=e("i",{class:"mdi mdi-application card-icon"},null,-1)),c[32]||(c[32]=e("span",{class:"card-text"},"Broadlink Manager",-1))],2),e("label",{class:G(["radio-card",{active:C.value==="integration_only",disabled:h.value}])},[q(e("input",{type:"radio","onUpdate:modelValue":c[7]||(c[7]=s=>C.value=s),value:"integration_only",disabled:h.value},null,8,mn),[[ze,C.value]]),e("i",{class:G(["mdi radio-indicator",C.value==="integration_only"?"mdi-radiobox-marked":"mdi-radiobox-blank"])},null,2),c[33]||(c[33]=e("i",{class:"mdi mdi-home-assistant card-icon"},null,-1)),c[34]||(c[34]=e("span",{class:"card-text"},"HA Broadlink",-1))],2),e("label",{class:G(["radio-card",{active:C.value==="both",disabled:h.value}])},[q(e("input",{type:"radio","onUpdate:modelValue":c[8]||(c[8]=s=>C.value=s),value:"both",disabled:h.value},null,8,vn),[[ze,C.value]]),e("i",{class:G(["mdi radio-indicator",C.value==="both"?"mdi-radiobox-marked":"mdi-radiobox-blank"])},null,2),c[35]||(c[35]=e("i",{class:"mdi mdi-swap-horizontal card-icon"},null,-1)),c[36]||(c[36]=e("span",{class:"card-text"},"Both",-1))],2)]),L.value?(a(),d("div",pn,[...c[37]||(c[37]=[e("h4",null,"Save Destination Options",-1),e("ul",null,[e("li",null,[e("strong",null,"Broadlink Manager (Recommended):"),D(" Commands are saved only in this app's database (devices.json). This gives you full control and makes commands portable. The Broadlink Integration won't see these commands.")]),e("li",null,[e("strong",null,"HA Broadlink:"),D(" Commands are saved only in Home Assistant's Broadlink Integration storage. This app won't track these commands, but they'll be available to the Broadlink Integration's remote.send_command service.")]),e("li",null,[e("strong",null,"Both:"),D(" Commands are saved in both places. Use this if you want commands available in both this app and the Broadlink Integration.")])],-1)])])):M("",!0)]),e("div",fn,[e("button",{type:"submit",class:"btn btn-primary btn-large",disabled:h.value},[h.value?(a(),d("i",yn)):(a(),d("i",bn)),D(" "+f(h.value?"Learning...":"Learn Command"),1)],8,gn)]),h.value?(a(),d("div",hn,[c[41]||(c[41]=e("i",{class:"mdi mdi-loading mdi-spin"},null,-1)),l.value==="preparing"?(a(),d("div",kn,[...c[38]||(c[38]=[e("p",null,[e("strong",null,"Preparing device...")],-1),e("small",null,"Connecting and authenticating with Broadlink device (this takes a few seconds)",-1)])])):_.value==="ir"?(a(),d("div",wn,[...c[39]||(c[39]=[e("p",null,[e("strong",null,"Ready!"),D(" Point your remote at the Broadlink device and press the button...")],-1),e("small",null,"This may take up to 30 seconds",-1)])])):_.value==="rf"?(a(),d("div",$n,[...c[40]||(c[40]=[e("p",null,[e("strong",null,"Learning RF command...")],-1),e("small",null,"Check Home Assistant notifications (ğŸ””) for instructions",-1)])])):M("",!0)])):M("",!0),N.value&&U.value==="success"&&!N.value.includes("sent successfully")&&!h.value?(a(),d("div",Cn,[c[42]||(c[42]=e("i",{class:"mdi mdi-check-circle"},null,-1)),e("p",null,f(N.value),1)])):M("",!0)],32)),T.value.length>0||x.value.length>0?(a(),d("div",_n)):M("",!0),o.value?(a(),d("div",Sn,[...c[43]||(c[43]=[e("div",{class:"loading-spinner"},[e("i",{class:"mdi mdi-loading mdi-spin"}),e("p",null,"Loading commands...")],-1)])])):T.value.length>0?(a(),d("div",In,[e("div",Dn,[e("h3",null,"Tracked Commands ("+f(T.value.length)+")",1),e("button",{type:"button",onClick:c[9]||(c[9]=s=>I(!0)),class:"icon-btn refresh-btn",title:"Refresh commands",disabled:o.value},[e("i",{class:G(["mdi mdi-refresh",{"mdi-spin":o.value}])},null,2)],8,xn)]),e("div",Tn,[(a(!0),d(ve,null,be(T.value,s=>(a(),d("div",{key:s.name,class:G(["command-item",{"error-state":s.hasError,"pending-state":s.isPending}])},[e("div",Mn,[e("span",Rn,f(s.label||s.name),1)]),e("div",En,[s.hasError?(a(),d("i",An)):s.isPending?(a(),d("i",Ln)):(a(),d("i",{key:2,class:"mdi mdi-check-circle learned-icon",title:`Learned (${(s.type||"ir").toUpperCase()})`},null,8,On)),e("span",{class:G(["command-type-badge",s.type||"ir"])},f((s.type||"ir").toUpperCase()),3),e("div",Pn,[e("button",{type:"button",onClick:F=>V(s.name),class:"icon-btn",title:s.hasError?"Cannot test - command failed to learn":s.isPending?"Cannot test - waiting for code":"Test command",disabled:R.value===s.name||s.hasError||s.isPending},[e("i",{class:G(["mdi mdi-play",{"mdi-spin":R.value===s.name}])},null,2)],8,Vn),e("button",{type:"button",onClick:F=>pe(s.name),class:"icon-btn danger",title:s.hasError?"Delete and re-learn":"Delete command"},[...c[44]||(c[44]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,Un)])])],2))),128))])])):M("",!0),x.value.length>0?(a(),d("div",jn,[e("h3",null,[c[45]||(c[45]=e("i",{class:"mdi mdi-alert"},null,-1)),D(" Untracked Commands ("+f(x.value.length)+") ",1)]),c[48]||(c[48]=e("p",{class:"untracked-info"}," These commands exist in Broadlink storage but are not tracked in this device. ",-1)),e("div",Fn,[(a(!0),d(ve,null,be(x.value,s=>(a(),d("div",{key:s,class:"command-item untracked"},[e("span",Nn,f(s),1),e("button",{type:"button",onClick:F=>Me(s),class:"btn-icon",title:"Import this command"},[...c[46]||(c[46]=[e("i",{class:"mdi mdi-import"},null,-1)])],8,Bn)]))),128))]),c[49]||(c[49]=e("br",null,null,-1)),e("button",{type:"button",onClick:Te,class:"btn btn-secondary"},[...c[47]||(c[47]=[e("i",{class:"mdi mdi-import"},null,-1),D(" Import All Untracked Commands ",-1)])])])):M("",!0)]),e("div",Hn,[e("button",{type:"button",onClick:c[10]||(c[10]=s=>b.$emit("cancel")),class:"btn btn-secondary",disabled:h.value}," Close ",8,qn)])]),fe(He,{isOpen:r.value,title:"Delete Command?",message:`Delete command '${A.value}' from Broadlink Manager?`,checkboxLabel:"Also delete from Broadlink Integration storage",confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,onConfirm:$e,onCancel:Ve},null,8,["isOpen","message"]),fe(He,{isOpen:J.value,title:"Import Commands?",message:`Import ${x.value.length} untracked command${x.value.length>1?"s":""} into this device?`,confirmText:"Import",cancelText:"Cancel",onConfirm:Y,onCancel:c[11]||(c[11]=s=>J.value=!1)},null,8,["isOpen","message"])]))}},Jn=ke(zn,[["__scopeId","data-v-511d0e01"]]),Wn={class:"modal-container error-dialog"},Gn={class:"modal-header"},Kn={class:"modal-body"},Xn={class:"error-message"},Yn={key:0,class:"error-suggestion"},Zn=["open"],Qn={class:"debug-content"},es={class:"debug-info"},ts={key:0,class:"debug-section-title"},os={key:1},ls={__name:"ErrorDialog",props:{isOpen:{type:Boolean,default:!1},title:{type:String,default:"Error"},message:{type:String,required:!0},suggestion:{type:String,default:""},details:{type:String,default:""},error:{type:Object,default:null},context:{type:Object,default:()=>({})}},emits:["close"],setup(t,{emit:m}){const u=t,w=m,k=Le("toast"),i=y(!1),p=()=>{w("close")},g=K(()=>{var P,N,U,T,x,o,r,A,J,Z,Q;const h=new Date().toISOString(),l=u.error||{};return{error:JSON.stringify({message:u.message,title:u.title,details:u.details,errorObject:l.message||l.toString(),timestamp:h},null,2),request:JSON.stringify({method:((N=(P=l.config)==null?void 0:P.method)==null?void 0:N.toUpperCase())||"N/A",url:((U=l.config)==null?void 0:U.url)||"N/A",baseURL:((T=l.config)==null?void 0:T.baseURL)||"N/A",headers:((x=l.config)==null?void 0:x.headers)||{},data:(o=l.config)!=null&&o.data?JSON.parse(l.config.data):"N/A",params:((r=l.config)==null?void 0:r.params)||{}},null,2),response:JSON.stringify({status:((A=l.response)==null?void 0:A.status)||"N/A",statusText:((J=l.response)==null?void 0:J.statusText)||"N/A",data:((Z=l.response)==null?void 0:Z.data)||"N/A",headers:((Q=l.response)==null?void 0:Q.headers)||{}},null,2),browser:JSON.stringify({userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language,cookieEnabled:navigator.cookieEnabled,onLine:navigator.onLine,viewport:`${window.innerWidth}x${window.innerHeight}`,screenResolution:`${window.screen.width}x${window.screen.height}`,colorDepth:window.screen.colorDepth,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,timestamp:h},null,2),appState:JSON.stringify({currentRoute:window.location.pathname,currentURL:window.location.href,referrer:document.referrer||"N/A",context:u.context||{},localStorage:{smartir_simulate:localStorage.getItem("smartir_simulate_not_installed"),theme:localStorage.getItem("theme")}},null,2),stackTrace:l.stack||null}}),_=async()=>{const h=L();try{await navigator.clipboard.writeText(h),k==null||k.success("Debug information copied to clipboard","âœ… Copied")}catch(l){console.error("Failed to copy:",l),k==null||k.error("Failed to copy to clipboard","âŒ Copy Failed")}},C=()=>{const h=L(),l=new Blob([h],{type:"text/plain"}),P=URL.createObjectURL(l),N=document.createElement("a");N.href=P;const U=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5);N.download=`broadlink-manager-error-${U}.txt`,document.body.appendChild(N),N.click(),document.body.removeChild(N),URL.revokeObjectURL(P),k==null||k.success("Debug report downloaded","âœ… Downloaded")},L=()=>`Broadlink Manager - Error Report
${"=".repeat(60)}

Generated: ${new Date().toISOString()}
Title: ${u.title}
Message: ${u.message}
${u.suggestion?`Suggestion: ${u.suggestion}
`:""}
${"=".repeat(60)}

ERROR DETAILS
${"-".repeat(60)}
${g.value.error}

REQUEST INFORMATION
${"-".repeat(60)}
${g.value.request}

RESPONSE INFORMATION
${"-".repeat(60)}
${g.value.response}

BROWSER INFORMATION
${"-".repeat(60)}
${g.value.browser}

APPLICATION STATE
${"-".repeat(60)}
${g.value.appState}

${g.value.stackTrace?`STACK TRACE
${"-".repeat(60)}
${g.value.stackTrace}

`:""}
${"=".repeat(60)}
End of Report
`;return ie(()=>u.isOpen,h=>{if(h){const l=P=>{P.key==="Escape"&&p()};return document.addEventListener("keydown",l),()=>document.removeEventListener("keydown",l)}}),(h,l)=>(a(),Ne(it,{to:"body"},[fe(st,{name:"modal"},{default:tt(()=>[t.isOpen?(a(),d("div",{key:0,class:"modal-overlay",onClick:me(p,["self"])},[e("div",Wn,[e("div",Gn,[l[2]||(l[2]=e("div",{class:"header-icon error-icon"},[e("i",{class:"mdi mdi-alert-circle"})],-1)),e("h3",null,f(t.title),1),e("button",{onClick:p,class:"close-button"},[...l[1]||(l[1]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Kn,[e("p",Xn,f(t.message),1),t.suggestion?(a(),d("p",Yn,[l[3]||(l[3]=e("i",{class:"mdi mdi-lightbulb-on"},null,-1)),D(" "+f(t.suggestion),1)])):M("",!0),e("details",{class:"debug-section",open:i.value},[e("summary",{onClick:l[0]||(l[0]=P=>i.value=!i.value)},[e("i",{class:G(["mdi",i.value?"mdi-chevron-down":"mdi-chevron-right"])},null,2),l[4]||(l[4]=D(" Debug Information ",-1))]),e("div",Qn,[e("div",{class:"debug-actions"},[e("button",{onClick:_,class:"btn-debug btn-copy"},[...l[5]||(l[5]=[e("i",{class:"mdi mdi-content-copy"},null,-1),D(" Copy to Clipboard ",-1)])]),e("button",{onClick:C,class:"btn-debug btn-download"},[...l[6]||(l[6]=[e("i",{class:"mdi mdi-download"},null,-1),D(" Download Report ",-1)])])]),e("div",es,[l[7]||(l[7]=e("div",{class:"debug-section-title"},"Error Details",-1)),e("pre",null,f(g.value.error),1),l[8]||(l[8]=e("div",{class:"debug-section-title"},"Request Information",-1)),e("pre",null,f(g.value.request),1),l[9]||(l[9]=e("div",{class:"debug-section-title"},"Response Information",-1)),e("pre",null,f(g.value.response),1),l[10]||(l[10]=e("div",{class:"debug-section-title"},"Browser Information",-1)),e("pre",null,f(g.value.browser),1),l[11]||(l[11]=e("div",{class:"debug-section-title"},"Application State",-1)),e("pre",null,f(g.value.appState),1),g.value.stackTrace?(a(),d("div",ts,"Stack Trace")):M("",!0),g.value.stackTrace?(a(),d("pre",os,f(g.value.stackTrace),1)):M("",!0)])])],8,Zn)]),e("div",{class:"modal-footer"},[e("button",{onClick:p,class:"btn btn-primary"}," OK ")])])])):M("",!0)]),_:1})]))}},ns=ke(ls,[["__scopeId","data-v-23858149"]]),ss={class:"modal-dialog"},as={class:"modal-header"},is={class:"modal-body"},rs={class:"device-list"},ds={class:"device-info"},us={class:"device-details"},cs={class:"command-count"},ms={class:"device-actions"},vs=["onClick"],ps=["onClick"],fs={class:"modal-footer"},gs={class:"modal-dialog modal-dialog-small"},ys={class:"modal-header"},bs={class:"modal-body"},hs={class:"warning-message"},ks={class:"modal-footer"},ws=["disabled"],$s=["disabled"],Cs={__name:"DeviceDiscovery",emits:["adopt"],setup(t,{expose:m,emit:u}){const w=Ge(),k=u,i=y([]),p=y(!1),g=y(!1),_=y(null),C=y(!1);y(!1),K(()=>i.value.length>0),Ee(async()=>{await L()});const L=async()=>{try{const U=await te.get("/api/devices/discover");i.value=U.data.untracked_devices||[]}catch(U){console.error("Error loading untracked devices:",U),i.value=[]}},h=()=>{p.value=!0},l=U=>{p.value=!1,k("adopt",U)},P=U=>{_.value=U,g.value=!0},N=async()=>{if(!_.value)return;const U=_.value.device_name;C.value=!0;try{const T=await te.delete(`/api/devices/untracked/${encodeURIComponent(U)}`);if(T.data.success)i.value=i.value.filter(x=>x.device_name!==U),g.value=!1,_.value=null,i.value.length===0&&(p.value=!1),w.success(`Deleted all commands for '${U}'`);else throw new Error(T.data.error||"Failed to delete device")}catch(T){console.error("Error deleting device:",T),w.error(`Failed to delete device: ${T.message}`)}finally{C.value=!1}};return m({refresh:L,openDiscovery:h}),(U,T)=>{var x,o,r;return a(),d("div",null,[M("",!0),p.value?(a(),d("div",{key:1,class:"modal-overlay",onClick:T[2]||(T[2]=me(A=>p.value=!1,["self"]))},[e("div",ss,[e("div",as,[T[9]||(T[9]=e("h2",null,"Discovered Devices",-1)),e("button",{onClick:T[0]||(T[0]=A=>p.value=!1),class:"close-btn"},[...T[8]||(T[8]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",is,[T[14]||(T[14]=e("p",{class:"info-text"}," These devices have learned commands in Broadlink storage but are not being tracked. Adopt them to manage their commands and generate Home Assistant entities. ",-1)),e("div",rs,[(a(!0),d(ve,null,be(i.value,A=>(a(),d("div",{key:A.device_name,class:"discovered-device"},[e("div",ds,[T[11]||(T[11]=e("div",{class:"device-icon"},[e("i",{class:"mdi mdi-devices"})],-1)),e("div",us,[e("h4",null,f(A.device_name),1),e("span",cs,[T[10]||(T[10]=e("i",{class:"mdi mdi-remote"},null,-1)),D(" "+f(A.command_count)+" command"+f(A.command_count>1?"s":""),1)])])]),e("div",ms,[e("button",{onClick:J=>l(A),class:"btn btn-primary"},[...T[12]||(T[12]=[e("i",{class:"mdi mdi-plus"},null,-1),D(" Adopt ",-1)])],8,vs),e("button",{onClick:J=>P(A),class:"btn btn-danger",title:"Delete all commands"},[...T[13]||(T[13]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,ps)])]))),128))])]),e("div",fs,[M("",!0),e("button",{onClick:T[1]||(T[1]=A=>p.value=!1),class:"btn btn-secondary"}," Close ")])])])):M("",!0),g.value?(a(),d("div",{key:2,class:"modal-overlay",onClick:T[5]||(T[5]=me(A=>g.value=!1,["self"]))},[e("div",gs,[e("div",ys,[T[16]||(T[16]=e("h2",null,"Delete Untracked Device",-1)),e("button",{onClick:T[3]||(T[3]=A=>g.value=!1),class:"close-btn"},[...T[15]||(T[15]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",bs,[e("div",hs,[T[18]||(T[18]=e("i",{class:"mdi mdi-alert"},null,-1)),e("div",null,[e("p",null,[e("strong",null,'Are you sure you want to delete "'+f((x=_.value)==null?void 0:x.device_name)+'"?',1)]),e("p",null,"This will permanently delete all "+f((o=_.value)==null?void 0:o.command_count)+" command"+f(((r=_.value)==null?void 0:r.command_count)>1?"s":"")+" from Broadlink storage.",1),T[17]||(T[17]=e("p",{class:"warning-text"},"This action cannot be undone.",-1))])])]),e("div",ks,[e("button",{onClick:T[4]||(T[4]=A=>g.value=!1),class:"btn btn-secondary",disabled:C.value}," Cancel ",8,ws),e("button",{onClick:N,class:"btn btn-danger",disabled:C.value},[e("i",{class:G(["mdi",C.value?"mdi-loading mdi-spin":"mdi-delete"])},null,2),D(" "+f(C.value?"Deleting...":"Delete"),1)],8,$s)])])])):M("",!0)])}}},_s=ke(Cs,[["__scopeId","data-v-78e5b712"]]),Ss={class:"device-list-card"},Is={class:"card-header"},Ds={class:"header-badges"},xs={class:"header-info"},Ts=["title"],Ms={class:"header-right"},Rs={key:0,class:"view-toggle-group header-view-toggle"},Es={class:"settings-menu-container"},As=["disabled"],Ls=["disabled"],Os={class:"card-body"},Ps={key:0,class:"filter-bar"},Vs={class:"filter-search-row"},Us=["title"],js={key:0,class:"filter-badge"},Fs={class:"search-input-wrapper"},Ns={class:"filter-content"},Bs={class:"filter-row filter-row-dropdowns"},Hs={class:"filter-group"},qs=["value"],zs={class:"filter-group"},Js=["value"],Ws={class:"filter-group"},Gs={key:0,class:"filter-group filter-toggle"},Ks={class:"toggle-label"},Xs={class:"filter-results"},Ys={key:1,class:"loading-state"},Zs={key:2,class:"error-state"},Qs={key:3,class:"empty-state"},ea={key:4,class:"device-grid"},ta={key:6,class:"no-results"},oa={__name:"DeviceList",setup(t){const m=kt(),u=Ge(),{isMobile:w}=ot(),k=y(!1),i=y(!1),p=y(null),g=y(!1),_=y(!1),C=y(null),L=y(null),h=y(!0),l=y(!1),P=y(!1),N=y(0),T=y(window.innerWidth<=767?"grid":localStorage.getItem("device_view_mode")||"grid");ie(w,E=>{E&&T.value==="list"&&(T.value="grid")}),ie(T,E=>{localStorage.setItem("device_view_mode",E)});const x=()=>{h.value=!h.value,h.value||(_.value=!1)},o=()=>{h.value||(h.value=!0),_.value=!_.value},r=y(!1),A=y({title:"Error",message:"",suggestion:"",details:"",error:null,context:{}}),J=y(!1),Z=y({success:!1,title:"",message:""}),Q=y(!1),W=y({search:"",broadlinkDevice:"",area:"",entityType:"",showSmartIROnly:!1}),R=y([]),j=Le("smartirStatus"),ee=Le("smartirEnabled"),ue=K(()=>{var $;return localStorage.getItem("smartir_simulate_not_installed")==="true"||!(ee!=null&&ee.value)?!1:(($=j==null?void 0:j.value)==null?void 0:$.installed)||!1}),De=K(()=>{const E=new Map;return m.devices.forEach($=>{if($.broadlink_entity){const H=R.value.find(le=>le.entity_id===$.broadlink_entity),z=H&&H.name||$.broadlink_entity;E.set($.broadlink_entity,{entity_id:$.broadlink_entity,friendly_name:z})}}),Array.from(E.values()).sort(($,H)=>$.friendly_name.localeCompare(H.friendly_name))}),we=K(()=>{const E=new Set;return m.devices.forEach($=>{$.area&&E.add($.area)}),Array.from(E).sort()}),Ae=K(()=>{let E=m.devices;if(W.value.search){const H=W.value.search.toLowerCase();E=E.filter(z=>{var ye,ce,Ie,je,Be;if((ye=z.name)!=null&&ye.toLowerCase().includes(H)||(ce=z.entity_type)!=null&&ce.toLowerCase().includes(H)||(Ie=z.area)!=null&&Ie.toLowerCase().includes(H)||(je=z.id)!=null&&je.toLowerCase().includes(H)||Object.keys(z.commands||{}).some(Fe=>Fe.toLowerCase().includes(H)))return!0;const he=R.value.find(Fe=>Fe.entity_id===z.broadlink_entity);return!!((Be=he==null?void 0:he.name)!=null&&Be.toLowerCase().includes(H))})}W.value.broadlinkDevice&&(E=E.filter(H=>H.broadlink_entity===W.value.broadlinkDevice||H.controller_device===W.value.broadlinkDevice)),W.value.area&&(E=E.filter(H=>H.area===W.value.area)),W.value.entityType&&(E=E.filter(H=>H.entity_type===W.value.entityType)),W.value.showSmartIROnly&&(E=E.filter(H=>H.device_type==="smartir"));const $=localStorage.getItem("smartir_simulate_not_installed")==="true";return(!(ee!=null&&ee.value)||$)&&(E=E.filter(H=>H.device_type!=="smartir")),E}),xe=K(()=>W.value.search||W.value.broadlinkDevice||W.value.area||W.value.entityType||W.value.showSmartIROnly),I=K(()=>{let E=0;return W.value.search&&E++,W.value.broadlinkDevice&&E++,W.value.area&&E++,W.value.entityType&&E++,W.value.showSmartIROnly&&E++,E}),v=E=>{E.target.closest(".settings-container")||(_.value=!1)};Ee(()=>{document.addEventListener("click",v)}),We(()=>{document.removeEventListener("click",v)});const V=()=>{W.value.search="",W.value.broadlinkDevice="",W.value.area="",W.value.entityType="",W.value.showSmartIROnly=!1},pe=()=>{L.value&&L.value.openDiscovery()},Ve=async()=>{try{const E=await te.get("/api/remote/devices");R.value=E.data.devices||[]}catch(E){console.error("Error loading remote devices:",E)}};ie(T,E=>{localStorage.setItem("device_view_mode",E)});const $e=async()=>{var E;try{const $=await te.get("/api/devices/discover");N.value=((E=$.data.untracked_devices)==null?void 0:E.length)||0}catch($){console.error("Error loading untracked count:",$),N.value=0}};Ee(async()=>{await Promise.all([m.loadDevices(),Ve(),$e()])});const Ce=E=>{p.value=E,k.value=!0},Te=K(()=>{if(!C.value)return"";const E=Object.keys(C.value.commands||{}).length;return E===0?"This device has no commands. The device will be removed from tracking.":`This device has ${E} learned command${E>1?"s":""}. What would you like to do?`}),Me=K(()=>{if(!C.value)return"";const E=Object.keys(C.value.commands||{}).length;return E===0?"":`Also delete all ${E} command${E>1?"s":""} from Broadlink storage`}),Y=E=>{C.value=E,g.value=!0},b=()=>{g.value=!1,C.value=null},c=async E=>{var H,z;const $=C.value;g.value=!1;try{await m.deleteDevice($.id,E),L.value&&await L.value.refresh()}catch(le){const he=((z=(H=le.response)==null?void 0:H.data)==null?void 0:z.error)||le.message||"Unknown error";n("Failed to Delete Device",he)}finally{C.value=null}},s=async E=>{var $,H,z,le,he;try{console.log("ğŸ’¾ Saving device data:",E),console.log("ğŸ’¾ Device commands:",E.commands),console.log("ğŸ’¾ Selected device:",p.value),($=p.value)!=null&&$.id&&p.value.id!==null?await m.updateDevice(p.value.id,E):await m.createDevice(E),F(),L.value&&await L.value.refresh()}catch(ye){let ce="Failed to save device",Ie="",je="";(z=(H=ye.response)==null?void 0:H.data)!=null&&z.error?(ce=ye.response.data.error,Ie=ye.response.data.suggestion||""):ye.message&&(ce=ye.message),ye.response&&(je=`Status: ${ye.response.status}
URL: ${((le=ye.config)==null?void 0:le.url)||"N/A"}`),n("Failed to Save Device",ce,Ie,je,ye,{action:"save_device",deviceData:E,isEdit:!!((he=p.value)!=null&&he.id)})}},F=()=>{k.value=!1,p.value=null},X=E=>{p.value=E,i.value=!0},S=()=>{i.value=!1,p.value=null},n=(E,$,H="",z="",le=null,he={})=>{A.value={title:E,message:$,suggestion:H,details:z,error:le,context:he},r.value=!0},O=()=>{r.value=!1},B=()=>{J.value=!1},se=async E=>{var $;if(console.log("ğŸŸ¢ [PARENT] Received learned event:",E),!E||!E.deviceId){console.warn("âš ï¸ [PARENT] Missing required data in learned event");return}if(console.log("ğŸŸ¢ [PARENT] Current selectedDevice commands:",Object.keys((($=p.value)==null?void 0:$.commands)||{}).length),console.log("ğŸŸ¢ [PARENT] Current store device count:",m.devices.length),console.log("ğŸŸ¢ [PARENT] Force reloading all devices from API with cache bust..."),await m.loadDevices(!0),console.log("ğŸŸ¢ [PARENT] After reload - store device count:",m.devices.length),p.value){console.log("ğŸŸ¢ [PARENT] Looking for device:",E.deviceId);const H=m.devices.find(z=>z.id===E.deviceId);H?(console.log("ğŸŸ¢ [PARENT] Found fresh device with",Object.keys(H.commands||{}).length,"commands"),p.value={...H},console.log("ğŸŸ¢ [PARENT] âœ… Updated selectedDevice - now has",Object.keys(p.value.commands||{}).length,"commands")):console.error("ğŸŸ¢ [PARENT] âŒ Device not found in store after reload!")}L.value&&(console.log("ğŸŸ¢ [PARENT] Refreshing discovery..."),L.value.refresh()),console.log("ğŸŸ¢ [PARENT] âœ… handleCommandLearned complete!")},ae=E=>{const $=E.split("_"),H=[];for(let z=0;z<$.length;z++){const le=$[z],he=$[z+1];le&&he==="s"&&$[z+2]?(H.push(le.charAt(0).toUpperCase()+le.slice(1)+"'s"),z++):le!=="s"&&H.push(le.charAt(0).toUpperCase()+le.slice(1))}return H.join(" ")},ne=(E,$)=>{const H=E.toLowerCase(),z=$.map(ce=>ce.toLowerCase());return H.includes("lamp")||H.includes("light")?"light":H.includes("fan")?"fan":H.includes("tv")||H.includes("stereo")||H.includes("speaker")||H.includes("receiver")?"media_player":H.includes("blind")||H.includes("curtain")||H.includes("shade")||H.includes("garage")?"cover":z.some(ce=>ce.includes("volume")||ce.includes("channel")||ce.includes("play")||ce.includes("pause")||ce.includes("mute"))?"media_player":z.some(ce=>ce.includes("fan_speed")||ce.includes("fan_low")||ce.includes("fan_high"))?"fan":z.some(ce=>ce.includes("open")||ce.includes("close")||ce.includes("stop"))?"cover":"switch"},oe=(E,$)=>{const H=E.toLowerCase();return H.includes("tv")?"mdi:television":H.includes("stereo")||H.includes("receiver")||H.includes("speaker")?"mdi:speaker":H.includes("lamp")?"mdi:lamp":H.includes("light")?"mdi:lightbulb":H.includes("fan")?"mdi:fan":H.includes("blind")?"mdi:blinds":H.includes("curtain")?"mdi:curtains":H.includes("garage")?"mdi:garage":{light:"mdi:lightbulb",fan:"mdi:fan",switch:"mdi:light-switch",media_player:"mdi:speaker",cover:"mdi:window-shutter"}[$]||"mdi:devices"},ge=E=>{const $=E.toLowerCase().split("_");for(let le=0;le<$.length-2;le++)if($[le+1]==="s"){const he=$.slice(le,le+3),ye=ae(he.join("_"));return console.log("Detected possessive area:",ye,"from",E),ye}const H=[["living","room"],["dining","room"],["master","bedroom"],["guest","bedroom"],["family","room"],["laundry","room"],["home","office"]];for(let le=0;le<$.length-1;le++){const he=[$[le],$[le+1]],ye=H.find(ce=>ce[0]===he[0]&&ce[1]===he[1]);if(ye)return ae(ye.join("_"))}const z=["kitchen","bedroom","bathroom","garage","office","basement","attic","hallway","entryway","patio","deck","yard","garden"];for(const le of $)if(z.includes(le))return le.charAt(0).toUpperCase()+le.slice(1);return""},Oe=async E=>{var $,H;try{const z=ae(E.device_name),le=ge(E.device_name),he=ne(E.device_name,E.commands),ye=oe(E.device_name,he);let ce="";try{console.log("Finding Broadlink owner for:",E.device_name);const Fe=await te.post("/api/devices/find-broadlink-owner",{device_name:E.device_name});console.log("Broadlink owner response:",Fe.data),ce=Fe.data.broadlink_entity||"",console.log("Detected Broadlink entity:",ce)}catch(Fe){console.error("Error finding Broadlink owner:",Fe)}console.log("Fetching command data from Broadlink storage...");const je=(await te.get(`/api/commands/broadlink/${E.device_name}`)).data.commands||{};console.log("Fetched command data:",je);const Be={};for(const[Fe,et]of Object.entries(je)){const mt=typeof et=="string"&&et.length>200;Be[Fe]={data:et,type:mt?"rf":"ir",name:Fe,learned_at:new Date().toISOString()}}console.log("Transformed commands:",Be),p.value={id:null,device:E.device_name,name:z,entity_type:he,commands:Be,area:le,icon:ye,broadlink_entity:ce,enabled:!0},k.value=!0,u.success(`Imported ${Object.keys(Be).length} commands from Broadlink storage`),await $e()}catch(z){console.error("Error adopting device:",z),u.error("Failed to adopt device: "+(((H=($=z.response)==null?void 0:$.data)==null?void 0:H.error)||z.message))}},re=async()=>{P.value=!0;try{await m.syncAllAreas(),u.success("Areas synced from Home Assistant")}catch(E){console.error("Error syncing areas:",E),u.error("Failed to sync areas")}finally{P.value=!1}},_e=async()=>{var E,$;l.value=!0;try{const H=await te.post("/api/entities/generate",{});if(H.data.success){const z=H.data.broadlink_count||0,le=H.data.smartir_count||0,he=H.data.total_count||0,ye=H.data.errors||[];let ce="âœ… Entity Generation Successful",Ie=[];const je=[];z>0&&je.push(`${z} Broadlink native`),le>0&&je.push(`${le} SmartIR`),je.length>0&&Ie.push(`Generated ${je.join(" and ")} entity configuration${he!==1?"s":""}.`),z>0&&(Ie.push(`
ğŸ“ Broadlink entities created in:`),Ie.push("  â€¢ broadlink_manager/entities.yaml"),Ie.push("  â€¢ broadlink_manager/helpers.yaml")),le>0&&(Ie.push(`
ğŸ“ SmartIR entities created in:`),Ie.push("  â€¢ smartir/climate.yaml"),Ie.push("  â€¢ smartir/media_player.yaml"),Ie.push("  â€¢ smartir/fan.yaml")),Ie.push(`
ğŸ“ Next steps:`),Ie.push("1. Check your configuration.yaml includes the generated files"),Ie.push("2. Restart Home Assistant to load the new entities"),ye.length>0&&(ce="âš ï¸ Entity Generation Completed with Errors",Ie.push(`
âš ï¸ ${ye.length} error${ye.length!==1?"s":""} occurred:`),ye.forEach(Be=>{Ie.push(`  â€¢ ${Be}`)})),Z.value={success:!0,title:ce,message:Ie.join(`
`)},J.value=!0}else Z.value={success:!1,title:"âŒ Entity Generation Failed",message:H.data.message||`Failed to generate entities.

Please check that you have at least one device configured.`},J.value=!0}catch(H){console.error("Error generating entities:",H);const z=(($=(E=H.response)==null?void 0:E.data)==null?void 0:$.error)||H.message||"Unknown error occurred";Z.value={success:!1,title:"âŒ Entity Generation Error",message:`Failed to generate entities:

${z}

Please check the logs for more details.`},J.value=!0}finally{l.value=!1}},Ue=async({device:E,command:$})=>{var H,z;try{const le={device_id:E.id,command:$,device:E.device||E.id,entity_id:E.broadlink_entity||E.controller_device};await te.post("/api/commands/test",le),u.success(`Sent ${$} to ${E.name}`)}catch(le){console.error("Error sending command:",le);const he=((z=(H=le.response)==null?void 0:H.data)==null?void 0:z.error)||le.message||"Unknown error";u.error(`Failed to send ${$}: ${he}`)}};return(E,$)=>{var H;return a(),d("div",Ss,[e("div",Is,[e("button",{class:"icon-button chevron-button",onClick:x},[e("i",{class:G(["mdi",h.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2)]),e("div",{class:"header-left",onClick:x},[$[15]||($[15]=e("div",{class:"header-icon"},[e("i",{class:"mdi mdi-devices"})],-1)),e("h3",null,f(Se(w)?"Devices":"Managed Devices"),1),e("div",Ds,[e("span",xs,f(Se(m).deviceCount)+" devices",1),N.value>0?(a(),d("span",{key:0,class:"header-info untracked-badge",title:`${N.value} device${N.value>1?"s":""} with learned commands found in Broadlink storage. Use the settings menu (âš™ï¸) to view and adopt them.`},f(N.value)+" untracked ",9,Ts)):M("",!0)])]),e("div",Ms,[Se(w)?M("",!0):(a(),d("div",Rs,[e("button",{onClick:$[0]||($[0]=me(z=>T.value="grid",["stop"])),class:G(["view-toggle-btn",{active:T.value==="grid"}]),title:"Grid View"},[...$[16]||($[16]=[e("i",{class:"mdi mdi-view-grid"},null,-1)])],2),e("button",{onClick:$[1]||($[1]=me(z=>T.value="list",["stop"])),class:G(["view-toggle-btn",{active:T.value==="list"}]),title:"List View"},[...$[17]||($[17]=[e("i",{class:"mdi mdi-view-list"},null,-1)])],2)])),e("button",{onClick:$[2]||($[2]=me(z=>k.value=!0,["stop"])),class:"btn btn-primary new-button"},[...$[18]||($[18]=[e("i",{class:"mdi mdi-plus"},null,-1),e("span",null,"New",-1)])]),e("div",Es,[e("button",{onClick:me(o,["stop"]),class:G(["icon-button settings-button",{active:_.value}]),title:"Settings"},[...$[19]||($[19]=[e("i",{class:"mdi mdi-cog"},null,-1)])],2),_.value?(a(),d("div",{key:0,class:"settings-dropdown",onClick:$[6]||($[6]=me(()=>{},["stop"]))},[e("button",{onClick:$[3]||($[3]=z=>{pe(),_.value=!1}),class:"menu-item"},[...$[20]||($[20]=[e("i",{class:"mdi mdi-radar"},null,-1),e("span",null,"Untracked Devices",-1)])]),e("button",{onClick:$[4]||($[4]=z=>{re(),_.value=!1}),class:"menu-item",disabled:P.value},[e("i",{class:G(["mdi",P.value?"mdi-loading mdi-spin":"mdi-refresh"])},null,2),e("span",null,f(P.value?"Syncing Areas...":"Sync Areas"),1)],8,As),e("button",{onClick:$[5]||($[5]=z=>{_e(),_.value=!1}),class:"menu-item",disabled:l.value},[e("i",{class:G(["mdi",l.value?"mdi-loading mdi-spin":"mdi-file-code"])},null,2),e("span",null,f(l.value?"Generating...":"Generate Entities"),1)],8,Ls)])):M("",!0)])])]),q(e("div",Os,[fe(_s,{ref_key:"discoveryRef",ref:L,onAdopt:Oe},null,512),Se(m).hasDevices?(a(),d("div",Ps,[e("div",Vs,[e("button",{class:G(["filter-toggle-button",{active:Q.value||xe.value}]),onClick:$[7]||($[7]=z=>Q.value=!Q.value),title:Q.value?"Hide filters":"Show filters"},[$[21]||($[21]=e("i",{class:"mdi mdi-filter-variant"},null,-1)),xe.value?(a(),d("span",js,f(I.value),1)):M("",!0)],10,Us),e("div",Fs,[$[22]||($[22]=e("i",{class:"mdi mdi-magnify search-icon"},null,-1)),q(e("input",{"onUpdate:modelValue":$[8]||($[8]=z=>W.value.search=z),type:"text",placeholder:"Search devices, commands...",class:"search-input"},null,512),[[Pe,W.value.search]])])]),q(e("div",Ns,[e("div",Bs,[e("div",Hs,[e("label",null,[$[24]||($[24]=e("i",{class:"mdi mdi-access-point"},null,-1)),q(e("select",{"onUpdate:modelValue":$[9]||($[9]=z=>W.value.broadlinkDevice=z)},[$[23]||($[23]=e("option",{value:""},"All Controller Devices",-1)),(a(!0),d(ve,null,be(De.value,z=>(a(),d("option",{key:z.entity_id,value:z.entity_id},f(z.friendly_name),9,qs))),128))],512),[[Re,W.value.broadlinkDevice]])])]),e("div",zs,[e("label",null,[$[26]||($[26]=e("i",{class:"mdi mdi-home-map-marker"},null,-1)),q(e("select",{"onUpdate:modelValue":$[10]||($[10]=z=>W.value.area=z)},[$[25]||($[25]=e("option",{value:""},"All Areas",-1)),(a(!0),d(ve,null,be(we.value,z=>(a(),d("option",{key:z,value:z},f(z),9,Js))),128))],512),[[Re,W.value.area]])])]),e("div",Ws,[e("label",null,[$[28]||($[28]=e("i",{class:"mdi mdi-shape"},null,-1)),q(e("select",{"onUpdate:modelValue":$[11]||($[11]=z=>W.value.entityType=z)},[...$[27]||($[27]=[qe('<option value="" data-v-c4b0679b>All Types</option><option value="light" data-v-c4b0679b>Light</option><option value="fan" data-v-c4b0679b>Fan</option><option value="switch" data-v-c4b0679b>Switch</option><option value="media_player" data-v-c4b0679b>Media Player</option><option value="cover" data-v-c4b0679b>Cover</option><option value="climate" data-v-c4b0679b>Climate</option>',7)])],512),[[Re,W.value.entityType]])])]),ue.value?(a(),d("div",Gs,[e("label",Ks,[$[29]||($[29]=e("span",{class:"toggle-text"},[e("img",{src:Qe,alt:"SmartIR",class:"smartir-icon"}),D(" SmartIR Only ")],-1)),q(e("input",{type:"checkbox","onUpdate:modelValue":$[12]||($[12]=z=>W.value.showSmartIROnly=z),class:"toggle-checkbox"},null,512),[[de,W.value.showSmartIROnly]]),$[30]||($[30]=e("span",{class:"toggle-slider"},null,-1))])])):M("",!0),xe.value?(a(),d("button",{key:1,onClick:V,class:"btn-clear-filters"},[...$[31]||($[31]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),D(" Clear ",-1)])])):M("",!0),e("div",Xs,f(Ae.value.length)+" of "+f(Se(m).deviceCount),1)])],512),[[Ye,Q.value]])])):M("",!0),Se(m).loading?(a(),d("div",Ys,[...$[32]||($[32]=[e("i",{class:"mdi mdi-loading mdi-spin"},null,-1),e("p",null,"Loading devices...",-1)])])):Se(m).error?(a(),d("div",Zs,[$[33]||($[33]=e("i",{class:"mdi mdi-alert-circle"},null,-1)),e("p",null,f(Se(m).error),1),e("button",{onClick:$[13]||($[13]=z=>Se(m).loadDevices()),class:"btn btn-secondary"}," Retry ")])):Se(m).hasDevices?M("",!0):(a(),d("div",Qs,[$[35]||($[35]=e("i",{class:"mdi mdi-devices"},null,-1)),$[36]||($[36]=e("h3",null,"No Devices Yet",-1)),$[37]||($[37]=e("p",null,"Get started by adding your first managed device",-1)),e("button",{onClick:$[14]||($[14]=z=>k.value=!0),class:"btn btn-primary"},[...$[34]||($[34]=[e("i",{class:"mdi mdi-plus"},null,-1),D(" Add Your First Device ",-1)])])])),T.value==="grid"?(a(),d("div",ea,[(a(!0),d(ve,null,be(Ae.value,z=>(a(),Ne(Bt,{key:z.id,device:z,"broadlink-devices":R.value,onEdit:Ce,onDelete:Y,onLearn:X},null,8,["device","broadlink-devices"]))),128))])):T.value==="list"&&Ae.value.length>0?(a(),Ne(uo,{key:5,devices:Ae.value,onSendCommand:Ue,onOpenCommands:X,onEditDevice:Ce,onDeleteDevice:Y},null,8,["devices"])):M("",!0),Se(m).hasDevices&&Ae.value.length===0?(a(),d("div",ta,[...$[38]||($[38]=[e("i",{class:"mdi mdi-filter-off"},null,-1),e("h3",null,"No devices match your filters",-1),e("p",null,"Try adjusting your search or filter criteria",-1)])])):M("",!0)],512),[[Ye,h.value]]),k.value?(a(),Ne(Ul,{key:0,device:p.value,onSave:s,onCancel:F},null,8,["device"])):M("",!0),i.value?(a(),Ne(Jn,{key:1,device:p.value,onLearned:se,onCancel:S},null,8,["device"])):M("",!0),fe(He,{isOpen:g.value,title:`Delete ${(H=C.value)==null?void 0:H.name}?`,message:Te.value,confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,checkboxLabel:Me.value,onConfirm:c,onCancel:b},null,8,["isOpen","title","message","checkboxLabel"]),fe(ns,{isOpen:r.value,title:A.value.title,message:A.value.message,suggestion:A.value.suggestion,details:A.value.details,error:A.value.error,context:A.value.context,onClose:O},null,8,["isOpen","title","message","suggestion","details","error","context"]),fe(He,{isOpen:J.value,title:Z.value.title,message:Z.value.message,confirmText:"OK",showCancel:!1,dangerMode:!Z.value.success,onConfirm:B,onCancel:B},null,8,["isOpen","title","message","dangerMode"])])}}},la=ke(oa,[["__scopeId","data-v-c4b0679b"]]),na={class:"banner-content"},sa={class:"banner-icon"},aa={class:"banner-message"},ia={class:"banner-actions"},ra={__name:"SmartIRBanner",setup(t){const m=Le("smartirStatus"),u=y(!1),w=K(()=>!(!m.value||u.value||localStorage.getItem("smartir_banner_dismissed")==="true")),k=K(()=>{var L;return(L=m.value)!=null&&L.installed?"banner-success":"banner-info"}),i=K(()=>{var L;return(L=m.value)!=null&&L.installed?"mdi mdi-check-circle":"mdi mdi-information"}),p=K(()=>{var L;return(L=m.value)!=null&&L.installed?`SmartIR Detected (v${m.value.version})`:"Want Climate Device Support?"}),g=K(()=>{var L;return(L=m.value)!=null&&L.installed?"You can now create climate device profiles with full temperature and HVAC mode control.":"Install SmartIR to unlock AC/heater control with temperature settings, HVAC modes, and 120+ pre-configured device profiles."});function _(){window.open("https://github.com/smartHomeHub/SmartIR","_blank")}function C(){var L;if(u.value=!0,(L=m.value)!=null&&L.installed)localStorage.setItem("smartir_banner_dismissed","true");else{const h=parseInt(localStorage.getItem("smartir_banner_dismiss_count")||"0");h>=2?localStorage.setItem("smartir_banner_dismissed","true"):localStorage.setItem("smartir_banner_dismiss_count",String(h+1))}}return Ee(()=>{var l;const L=localStorage.getItem("smartir_last_status"),h=(l=m.value)!=null&&l.installed?"installed":"not_installed";L!==h&&(localStorage.removeItem("smartir_banner_dismissed"),localStorage.removeItem("smartir_banner_dismiss_count"),localStorage.setItem("smartir_last_status",h))}),(L,h)=>{var l,P;return w.value?(a(),d("div",{key:0,class:G(["smartir-banner",k.value])},[e("div",na,[e("div",sa,[e("i",{class:G(i.value)},null,2)]),e("div",aa,[e("strong",null,f(p.value),1),e("p",null,f(g.value),1)]),e("div",ia,[(l=L.status)!=null&&l.installed?M("",!0):(a(),d("button",{key:0,onClick:_,class:"btn-primary"}," Learn More ")),e("button",{onClick:C,class:"btn-text"},f((P=L.status)!=null&&P.installed?"Got it":"Dismiss"),1)])])],2)):M("",!0)}}},da=ke(ra,[["__scopeId","data-v-7bbcbcd7"]]),Je="api/smartir",ut={async getStatus(){try{const t=await fetch(`${Je}/status`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return await t.json()}catch(t){return console.error("Error fetching SmartIR status:",t),{installed:!1,version:null,error:t.message}}},async getInstallInstructions(){try{const t=await fetch(`${Je}/install-instructions`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return await t.json()}catch(t){throw console.error("Error fetching install instructions:",t),t}},async getPlatforms(){try{const t=await fetch(`${Je}/platforms`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return await t.json()}catch(t){throw console.error("Error fetching platforms:",t),t}},async getPlatformCodes(t){try{const m=await fetch(`${Je}/platforms/${t}/codes`);if(!m.ok)throw new Error(`HTTP error! status: ${m.status}`);return await m.json()}catch(m){throw console.error(`Error fetching codes for ${t}:`,m),m}},async getNextCode(t){try{const m=await fetch(`${Je}/platforms/${t}/next-code`);if(!m.ok)throw new Error(`HTTP error! status: ${m.status}`);return await m.json()}catch(m){throw console.error(`Error fetching next code for ${t}:`,m),m}},async validateCode(t,m){try{const u=await fetch(`${Je}/validate-code`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({platform:t,code:m})});if(!u.ok)throw new Error(`HTTP error! status: ${u.status}`);return await u.json()}catch(u){throw console.error("Error validating code:",u),u}}},ua={class:"profile-card"},ca={class:"profile-card-header"},ma=["title"],va={class:"profile-details"},pa=["title"],fa={class:"profile-meta"},ga=["title"],ya=["title"],ba=["title"],ha={class:"profile-card-footer"},ka=["title"],wa={key:0,class:"learned-indicator"},$a={class:"profile-actions"},Ca={__name:"SmartIRProfileCard",props:{profile:{type:Object,required:!0}},emits:["edit","download","delete","commands"],setup(t){const m=t,u=rt(K(()=>m.profile.platform)),w=p=>p.replace(/_/g," ").replace(/\b\w/g,g=>g.toUpperCase()),k=p=>p&&p.startsWith("mdi:")?`mdi ${p.replace(":"," mdi-")}`:`mdi mdi-${p}`,i=p=>{if(!p)return"";const g=p.toLowerCase();return g.includes("broadlink")?"broadlink-tag":g.includes("not set")?"not-set-tag":"default-controller-tag"};return(p,g)=>(a(),d("div",ua,[e("div",ca,[e("div",{class:G(["profile-icon",Se(u).colorClass.value]),title:w(t.profile.platform)},[e("i",{class:G(k(Se(u).icon.value))},null,2)],10,ma),e("div",va,[e("h4",{title:`${t.profile.manufacturer} ${t.profile.model}`},f(t.profile.manufacturer)+" "+f(t.profile.model),9,pa),e("div",fa,[e("span",{class:"tag platform-tag",title:w(t.profile.platform)},f(w(t.profile.platform)),9,ga),t.profile.controllerBrand?(a(),d("span",{key:0,class:G(["tag controller-tag",i(t.profile.controllerBrand)]),title:"Controller: "+t.profile.controllerBrand},[g[4]||(g[4]=e("i",{class:"mdi mdi-remote-tv"},null,-1)),D(" "+f(t.profile.controllerBrand),1)],10,ya)):M("",!0)])]),e("div",{class:"code-badge",title:"Device Code: "+t.profile.code},f(t.profile.code),9,ba)]),e("div",ha,[e("div",{class:"profile-stats",title:t.profile.commandCount+" total commands"+(t.profile.learnedCount>0?", "+t.profile.learnedCount+" learned":"")},[g[5]||(g[5]=e("i",{class:"mdi mdi-remote"},null,-1)),e("span",null,f(t.profile.commandCount)+" command"+f(t.profile.commandCount!==1?"s":""),1),t.profile.learnedCount>0?(a(),d("span",wa,"( "+f(t.profile.learnedCount)+" learned )",1)):M("",!0)],8,ka),e("div",$a,[e("button",{onClick:g[0]||(g[0]=_=>p.$emit("commands")),class:"action-btn",title:"Commands"},[...g[6]||(g[6]=[e("i",{class:"mdi mdi-remote"},null,-1)])]),e("button",{onClick:g[1]||(g[1]=_=>p.$emit("edit")),class:"action-btn",title:"Edit Profile"},[...g[7]||(g[7]=[e("i",{class:"mdi mdi-pencil"},null,-1)])]),e("button",{onClick:g[2]||(g[2]=_=>p.$emit("download")),class:"action-btn",title:"Download JSON"},[...g[8]||(g[8]=[e("i",{class:"mdi mdi-download"},null,-1)])]),e("button",{onClick:g[3]||(g[3]=_=>p.$emit("delete")),class:"action-btn delete",title:"Delete Profile"},[...g[9]||(g[9]=[e("i",{class:"mdi mdi-delete"},null,-1)])])])])]))}},_a=ke(Ca,[["__scopeId","data-v-aad9720f"]]),Sa={name:"SmartIRProfileListView",props:{profiles:{type:Array,required:!0}},methods:{getPlatformIcon(t){return{climate:"mdi-thermostat",media_player:"mdi-television",fan:"mdi-fan",light:"mdi-lightbulb"}[t]||"mdi-devices"},formatPlatform(t){return{climate:"Climate",media_player:"Media Player",fan:"Fan",light:"Light"}[t]||t},editProfile(t){this.$emit("edit",t)},viewCommands(t){this.$emit("commands",t)},downloadProfile(t){this.$emit("download",t)},deleteProfile(t){this.$emit("delete",t)}}},Ia={class:"profile-list-view"},Da={class:"profile-table"},xa={class:"profile-code"},Ta={class:"code-badge"},Ma={class:"profile-manufacturer"},Ra={class:"profile-model"},Ea={class:"model-info"},Aa={class:"model-name"},La={key:0,class:"model-count"},Oa={class:"profile-platform"},Pa={class:"profile-controller"},Va={class:"profile-commands"},Ua={class:"command-stats"},ja={class:"stat-item"},Fa={key:0,class:"stat-item learned"},Na={class:"profile-actions"},Ba=["onClick"],Ha=["onClick"],qa=["onClick"],za=["onClick"];function Ja(t,m,u,w,k,i){return a(),d("div",Ia,[e("table",Da,[m[6]||(m[6]=e("thead",null,[e("tr",null,[e("th",null,"Code"),e("th",null,"Manufacturer"),e("th",null,"Model"),e("th",null,"Platform"),e("th",null,"Controller"),e("th",null,"Commands"),e("th",null,"Actions")])],-1)),e("tbody",null,[(a(!0),d(ve,null,be(u.profiles,p=>(a(),d("tr",{key:`${p.platform}-${p.code}`,class:"profile-row"},[e("td",xa,[e("span",Ta,f(p.code),1)]),e("td",Ma,f(p.manufacturer||"Unknown"),1),e("td",Ra,[e("div",Ea,[e("div",Aa,f(p.model||"Unknown"),1),p.models&&p.models.length>1?(a(),d("div",La," +"+f(p.models.length-1)+" more ",1)):M("",!0)])]),e("td",Oa,[e("span",{class:G(["platform-badge",p.platform])},[e("i",{class:G(["mdi",i.getPlatformIcon(p.platform)])},null,2),D(" "+f(i.formatPlatform(p.platform)),1)],2)]),e("td",Pa,f(p.controller_brand||"N/A"),1),e("td",Va,[e("div",Ua,[e("span",ja,[m[0]||(m[0]=e("i",{class:"mdi mdi-remote"},null,-1)),D(" "+f(p.command_count||0),1)]),p.learned_count>0?(a(),d("span",Fa,[m[1]||(m[1]=e("i",{class:"mdi mdi-school"},null,-1)),D(" "+f(p.learned_count),1)])):M("",!0)])]),e("td",Na,[e("button",{class:"action-btn edit",onClick:g=>i.editProfile(p),title:"Edit Profile"},[...m[2]||(m[2]=[e("i",{class:"mdi mdi-pencil"},null,-1)])],8,Ba),e("button",{class:"action-btn commands",onClick:g=>i.viewCommands(p),title:"View Commands"},[...m[3]||(m[3]=[e("i",{class:"mdi mdi-remote"},null,-1)])],8,Ha),e("button",{class:"action-btn download",onClick:g=>i.downloadProfile(p),title:"Download"},[...m[4]||(m[4]=[e("i",{class:"mdi mdi-download"},null,-1)])],8,qa),e("button",{class:"action-btn delete",onClick:g=>i.deleteProfile(p),title:"Delete"},[...m[5]||(m[5]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,za)])]))),128))])])])}const Wa=ke(Sa,[["render",Ja],["__scopeId","data-v-d3773038"]]),Ga={class:"modal-container"},Ka={class:"modal-body"},Xa={key:0,class:"selection-section"},Ya={class:"form-group"},Za={class:"form-group"},Qa={class:"form-group"},ei={key:0,class:"code-info"},ti={class:"form-actions"},oi=["disabled"],li={key:1,class:"testing-section"},ni={class:"code-header"},si={class:"code-details"},ai={class:"code-badge"},ii={class:"device-selector"},ri=["value"],di={key:0,class:"helper-text"},ui={class:"commands-section"},ci={class:"commands-header"},mi={key:0,class:"tested-count"},vi={key:0,class:"filters-section"},pi={class:"filter-row"},fi={class:"filter-row"},gi={key:1,class:"empty-state"},yi={key:2,class:"empty-state"},bi={key:3,class:"commands-list"},hi={class:"command-name"},ki={class:"command-actions"},wi={key:0,class:"status-badge success"},$i=["onClick","disabled","title"],Ci={__name:"SmartIRCodeTester",props:{isOpen:{type:Boolean,default:!1}},emits:["close","clone"],setup(t,{emit:m}){const u=t,w=m,k=Le("toast"),i=y("climate"),p=y(""),g=y([]),_=y(!1),C=y(null),L=y(""),h=y([]),l=y(!1),P=K(()=>h.value.map(Y=>({code:Y.code,label:`${Y.models.join(", ")} (Code: ${Y.code})`,value:Y.code}))),N=y(null),U=y(null),T=y(!1),x=y([]),o=y(""),r=y([]),A=y(new Set),J=y(null),Z=y(""),Q=y(""),W=y(""),R=y(""),j=K(()=>{let Y=r.value;if(Z.value){const b=Z.value.toLowerCase();Y=Y.filter(c=>(c.label||c.name).toLowerCase().includes(b))}return Q.value&&(Y=Y.filter(b=>b.mode===Q.value)),W.value&&(Y=Y.filter(b=>b.fanSpeed===W.value)),R.value&&(Y=Y.filter(b=>b.swingMode===R.value)),Y}),ee=K(()=>Z.value||Q.value||W.value||R.value);ie(()=>u.isOpen,Y=>{Y&&(ue(),we())}),ie(i,()=>{u.isOpen&&(p.value="",C.value=null,h.value=[],ue())});async function ue(){var Y;_.value=!0;try{const b=await te.get("/api/smartir/codes/manufacturers",{params:{entity_type:i.value}});g.value=b.data.manufacturers||[]}catch(b){console.error("Error loading manufacturers:",b),(Y=k.value)==null||Y.error("Failed to load manufacturers","âŒ Error")}finally{_.value=!1}}async function De(){var Y;if(p.value){l.value=!0;try{const b=await te.get("/api/smartir/codes/models",{params:{entity_type:i.value,manufacturer:p.value}});h.value=b.data.models||[]}catch(b){console.error("Error loading models:",b),(Y=k.value)==null||Y.error("Failed to load models","âŒ Error")}finally{l.value=!1}}}async function we(){try{const Y=await te.get("/api/remote/devices");x.value=Y.data.devices||[]}catch(Y){console.error("Error loading Broadlink devices:",Y)}}async function Ae(){var Y,b;if(C.value){T.value=!0;try{const c=await te.get("/api/smartir/codes/code",{params:{entity_type:i.value,code_id:C.value.code}});U.value=c.data.code,N.value=C.value.code,xe(c.data.code),(Y=k.value)==null||Y.success(`Loaded ${r.value.length} commands`,"âœ… Code Loaded")}catch(c){console.error("Error loading code:",c),(b=k.value)==null||b.error(c.message||"Failed to load code","âŒ Error")}finally{T.value=!1}}}function xe(Y){const b=[];if(!Y.commands){r.value=b;return}if(i.value==="climate"){const s=Y.commands;for(const[F,X]of Object.entries(s)){if(F==="off"){typeof X=="string"&&b.push({name:"off",label:"OFF",data:X,mode:"off"});continue}if(typeof X=="object"){for(const[S,n]of Object.entries(X))if(typeof n=="object")for(const[O,B]of Object.entries(n)){if(typeof B!="object")continue;const se=Object.keys(B),ae=se.includes("24")?"24":se[0];if(ae&&typeof B[ae]=="string"){const ne=`${F}_${ae}_${S}_${O}`,oe=`${F.toUpperCase()} ${ae}Â°C ${S} ${O}`;b.push({name:ne,label:oe,data:B[ae],mode:F,temperature:ae,fanSpeed:S,swingMode:O})}}}}}else for(const[s,F]of Object.entries(Y.commands))typeof F=="string"&&b.push({name:s,label:s.toUpperCase().replace(/_/g," "),data:F});r.value=b}async function I(Y){var b,c,s;if(!o.value){(b=k.value)==null||b.warning("Please select a Broadlink device first","âš ï¸ No Device");return}J.value=Y;try{const F=r.value.find(X=>X.name===Y);if(!F||!F.data)throw new Error(`Command "${Y}" not found`);await te.post("/api/commands/send-raw",{entity_id:o.value,command:F.data,command_type:"ir"}),A.value.add(Y),(c=k.value)==null||c.success(`Command sent: ${F.label||Y}`,"âœ… Tested")}catch(F){console.error("Error testing command:",F),(s=k.value)==null||s.error("Failed to test command","âŒ Error")}finally{J.value=null}}function v(){var Y,b,c,s;if(!U.value){(Y=k.value)==null||Y.error("No profile data to download","âŒ Error");return}try{const F=U.value.manufacturer||"unknown",X=((b=U.value.supportedModels)==null?void 0:b[0])||N.value,S=`${F.toLowerCase().replace(/\s+/g,"_")}_${X.toLowerCase().replace(/\s+/g,"_")}.json`,n=JSON.stringify(U.value,null,2),O=new Blob([n],{type:"application/json"}),B=URL.createObjectURL(O),se=document.createElement("a");se.href=B,se.download=S,document.body.appendChild(se),se.click(),document.body.removeChild(se),URL.revokeObjectURL(B),(c=k.value)==null||c.success(`Downloaded ${S}`,"âœ… Download Complete")}catch(F){console.error("Error downloading JSON:",F),(s=k.value)==null||s.error(F.message||"Failed to download JSON","âŒ Download Error")}}function V(){p.value="",C.value=null,L.value="",h.value=[]}function pe(){C.value=null,L.value="",De()}function Ve(){L.value?C.value=h.value.find(Y=>Y.code===L.value):C.value=null}function $e(){Z.value="",Q.value="",W.value="",R.value=""}function Ce(){N.value=null,U.value=null,r.value=[],A.value.clear(),J.value=null,$e()}function Te(Y){const b=Y.toLowerCase();return b.includes("power")||b.includes("off")||b==="off"?"mdi-power":b.includes("cool")?"mdi-snowflake":b.includes("heat")?"mdi-fire":b.includes("fan")?"mdi-fan":b.includes("auto")?"mdi-auto-fix":b.includes("dry")?"mdi-water-percent":b.includes("temp")?"mdi-thermometer":b.includes("swing")?"mdi-swap-vertical":"mdi-remote"}function Me(){Ce(),p.value="",C.value=null,w("close")}return(Y,b)=>{var c;return t.isOpen?(a(),d("div",{key:0,class:"modal-overlay",onClick:me(Me,["self"])},[e("div",Ga,[e("div",{class:"modal-header"},[b[9]||(b[9]=e("h3",null,[e("i",{class:"mdi mdi-test-tube"}),D(" Test SmartIR Code ")],-1)),e("button",{onClick:Me,class:"close-btn"},[...b[8]||(b[8]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Ka,[N.value?(a(),d("div",li,[e("div",ni,[e("div",si,[e("h4",null,f(U.value.manufacturer)+" - "+f(((c=U.value.supportedModels)==null?void 0:c[0])||"Unknown"),1),e("span",ai,"Code: "+f(N.value),1)]),e("button",{onClick:Ce,class:"btn-secondary-small"},[...b[14]||(b[14]=[e("i",{class:"mdi mdi-arrow-left"},null,-1),D(" Change Code ",-1)])])]),e("div",ii,[b[17]||(b[17]=e("label",null,[e("i",{class:"mdi mdi-remote"}),D(" Broadlink Device ")],-1)),q(e("select",{"onUpdate:modelValue":b[3]||(b[3]=s=>o.value=s),class:"form-select"},[b[15]||(b[15]=e("option",{value:""},"Select device to test with...",-1)),(a(!0),d(ve,null,be(x.value,s=>(a(),d("option",{key:s.entity_id,value:s.entity_id},f(s.friendly_name||s.entity_id),9,ri))),128))],512),[[Re,o.value]]),o.value?M("",!0):(a(),d("p",di,[...b[16]||(b[16]=[e("i",{class:"mdi mdi-information-outline"},null,-1),D(" Select a Broadlink device to enable command testing ",-1)])]))]),e("div",ui,[e("div",ci,[e("h5",null,"Sample Commands ("+f(j.value.length)+" / "+f(r.value.length)+")",1),A.value.size>0?(a(),d("span",mi,f(A.value.size)+" tested ",1)):M("",!0)]),i.value==="climate"&&r.value.length>0?(a(),d("div",vi,[e("div",pi,[q(e("input",{"onUpdate:modelValue":b[4]||(b[4]=s=>Z.value=s),type:"text",placeholder:"Search commands...",class:"search-input"},null,512),[[Pe,Z.value]])]),e("div",fi,[q(e("select",{"onUpdate:modelValue":b[5]||(b[5]=s=>Q.value=s),class:"filter-select"},[...b[18]||(b[18]=[e("option",{value:""},"All Modes",-1),e("option",{value:"cool"},"Cool",-1),e("option",{value:"heat"},"Heat",-1),e("option",{value:"off"},"Off",-1)])],512),[[Re,Q.value]]),q(e("select",{"onUpdate:modelValue":b[6]||(b[6]=s=>W.value=s),class:"filter-select"},[...b[19]||(b[19]=[qe('<option value="" data-v-66569200>All Fan Speeds</option><option value="low" data-v-66569200>Low</option><option value="mid" data-v-66569200>Mid</option><option value="high" data-v-66569200>High</option><option value="auto" data-v-66569200>Auto</option>',5)])],512),[[Re,W.value]]),q(e("select",{"onUpdate:modelValue":b[7]||(b[7]=s=>R.value=s),class:"filter-select"},[...b[20]||(b[20]=[e("option",{value:""},"All Swing",-1),e("option",{value:"stop"},"Stop",-1),e("option",{value:"swing"},"Swing",-1)])],512),[[Re,R.value]]),ee.value?(a(),d("button",{key:0,onClick:$e,class:"btn-clear-filters"},[...b[21]||(b[21]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),D(" Clear ",-1)])])):M("",!0)])])):M("",!0),r.value.length===0?(a(),d("div",gi,[...b[22]||(b[22]=[e("i",{class:"mdi mdi-alert-circle"},null,-1),e("p",null,"No commands found in this code",-1)])])):j.value.length===0?(a(),d("div",yi,[b[23]||(b[23]=e("i",{class:"mdi mdi-filter-off"},null,-1)),b[24]||(b[24]=e("p",null,"No commands match your filters",-1)),e("button",{onClick:$e,class:"btn-secondary-small"}," Clear Filters ")])):(a(),d("div",bi,[(a(!0),d(ve,null,be(j.value,s=>(a(),d("div",{key:s.name,class:G(["command-item",{tested:A.value.has(s.name),testing:J.value===s.name}])},[e("div",hi,[e("i",{class:G(["mdi",Te(s.mode||s.name)])},null,2),e("span",null,f(s.label||s.name),1)]),e("div",ki,[A.value.has(s.name)?(a(),d("span",wi,[...b[25]||(b[25]=[e("i",{class:"mdi mdi-check"},null,-1),D(" Tested ",-1)])])):M("",!0),e("button",{onClick:F=>I(s.name),disabled:!o.value||J.value===s.name,title:o.value?"Test this command":"Select a Broadlink device first",class:"btn-test"},[e("i",{class:G(["mdi",J.value===s.name?"mdi-loading mdi-spin":"mdi-play"])},null,2),b[26]||(b[26]=D(" Test ",-1))],8,$i)])],2))),128))]))]),e("div",{class:"modal-actions"},[e("button",{onClick:v,class:"btn-primary"},[...b[27]||(b[27]=[e("i",{class:"mdi mdi-download"},null,-1),D(" Download JSON ",-1)])]),e("button",{onClick:Me,class:"btn-secondary"}," Close ")])])):(a(),d("div",Xa,[b[13]||(b[13]=e("div",{class:"info-banner"},[e("i",{class:"mdi mdi-information"}),e("p",null,"Select a SmartIR code from the index to test commands with your Broadlink device.")],-1)),e("div",Ya,[b[11]||(b[11]=e("label",null,[e("i",{class:"mdi mdi-shape"}),D(" Platform ")],-1)),q(e("select",{"onUpdate:modelValue":b[0]||(b[0]=s=>i.value=s),onChange:V,class:"form-select"},[...b[10]||(b[10]=[e("option",{value:"climate"},"Climate (AC/Heater)",-1),e("option",{value:"media_player"},"Media Player (TV/Audio)",-1),e("option",{value:"fan"},"Fan",-1),e("option",{value:"light"},"Light",-1)])],544),[[Re,i.value]])]),e("div",Za,[fe(Ze,{modelValue:p.value,"onUpdate:modelValue":b[1]||(b[1]=s=>p.value=s),options:g.value,label:"Manufacturer",placeholder:"Search manufacturers...",loading:_.value,disabled:_.value,onChange:pe},null,8,["modelValue","options","loading","disabled"])]),e("div",Qa,[fe(Ze,{modelValue:L.value,"onUpdate:modelValue":b[2]||(b[2]=s=>L.value=s),options:P.value,"option-label":"label","option-value":"code",label:"Model",placeholder:"Search models...",loading:l.value,disabled:!p.value||l.value,onChange:Ve},null,8,["modelValue","options","loading","disabled"])]),C.value?(a(),d("div",ei,[b[12]||(b[12]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[e("strong",null,f(p.value)+" - "+f(C.value.models[0]),1),e("p",null,"Code: "+f(C.value.code),1)])])):M("",!0),e("div",ti,[e("button",{onClick:Ae,disabled:!C.value||T.value,class:"btn-primary"},[e("i",{class:G(["mdi",T.value?"mdi-loading mdi-spin":"mdi-download"])},null,2),D(" "+f(T.value?"Loading...":"Load Commands"),1)],8,oi)])]))])])])):M("",!0)}}},_i=ke(Ci,[["__scopeId","data-v-66569200"]]),Si={class:"smartir-status-card"},Ii={class:"card-header"},Di=["src"],xi={class:"header-badges"},Ti=["title"],Mi={class:"header-info"},Ri={class:"header-info"},Ei={class:"header-info"},Ai={class:"header-right"},Li={key:0,class:"view-toggle-group header-view-toggle"},Oi={key:2,class:"settings-menu-container"},Pi={key:0,class:"card-body loading-state"},Vi={key:1,class:"card-body error-state"},Ui={key:2,class:"card-body installed-state"},ji={key:0,class:"help-panel"},Fi={key:0,class:"recommendation"},Ni={key:0,class:"next-steps"},Bi={class:"help-actions"},Hi={key:1,class:"filter-bar"},qi={class:"filter-search-row"},zi=["title"],Ji={key:0,class:"filter-badge"},Wi={class:"search-input-wrapper"},Gi={class:"filter-content"},Ki={class:"filter-row"},Xi={class:"filter-group"},Yi={class:"filter-results"},Zi={key:2,class:"loading-state"},Qi={key:3,class:"empty-state"},er={key:4,class:"profiles-grid"},tr={key:6,class:"no-results"},or={key:3,class:"card-body not-installed-state"},lr={class:"benefits-section"},nr={class:"benefits-list"},sr={class:"recommendation"},ar={__name:"SmartIRStatusCard",emits:["create-profile","edit-profile"],setup(t,{expose:m,emit:u}){const w=u,k=Le("smartirStatus");Le("smartirEnabled");const i=Le("refreshSmartIR"),{isMobile:p}=ot(),g=y(!1),_=y(null),C=y((k==null?void 0:k.value)||null),L=y(localStorage.getItem("smartir_simulate_not_installed")==="true"),h=y(!1),l=y(!1),P=y(!0),N=y([]),U=y(!1),T=y(!1),x=y({search:"",platform:""}),o=y({show:!1,title:"",message:"",platform:null,profile:null}),r=y(!1),J=y(window.innerWidth<=767?"grid":localStorage.getItem("profile_view_mode")||"grid");ie(p,c=>{c&&J.value==="list"&&(J.value="grid")}),ie(J,c=>{localStorage.setItem("profile_view_mode",c)}),ie(P,c=>{c||(l.value=!1)});const Z=["Full climate entity support (AC, heaters)","120+ pre-configured device profiles","Temperature and humidity sensor integration","HVAC mode control (heat, cool, auto, dry, fan)"],Q=["climate","media_player","fan","light"],W=K(()=>L.value?{installed:!1,recommendation:{message:"Install SmartIR to unlock climate device support!",benefits:["Full climate entity support (AC, heaters)","120+ pre-configured device profiles","Temperature and humidity sensor integration","HVAC mode control (heat, cool, auto, dry, fan)"]}}:C.value),R=K(()=>{var c,s;return((s=(c=W.value)==null?void 0:c.platforms)==null?void 0:s.length)||0}),j=K(()=>{var c;return(c=W.value)!=null&&c.device_counts?Object.values(W.value.device_counts).reduce((s,F)=>s+F,0):0});function ee(){var c;L.value=!L.value,localStorage.setItem("smartir_simulate_not_installed",L.value.toString()),!L.value&&((c=C.value)!=null&&c.installed)&&$e()}const ue=K(()=>{let c=N.value;if(x.value.search){const s=x.value.search.toLowerCase();c=c.filter(F=>{var X,S,n,O;return((X=F.manufacturer)==null?void 0:X.toLowerCase().includes(s))||((S=F.model)==null?void 0:S.toLowerCase().includes(s))||((n=F.code)==null?void 0:n.toString().includes(s))||((O=F.platform)==null?void 0:O.toLowerCase().includes(s))})}return x.value.platform&&(c=c.filter(s=>s.platform===x.value.platform)),c}),De=K(()=>x.value.search||x.value.platform),we=K(()=>{let c=0;return x.value.search&&c++,x.value.platform&&c++,c});function Ae(){x.value.search="",x.value.platform=""}async function xe(){g.value=!0,_.value=null;try{if(i)await i();else{const c=await ut.getStatus();C.value=c}}catch(c){_.value=c.message||"Failed to refresh SmartIR status",console.error("Error refreshing SmartIR status:",c)}finally{g.value=!1}}function I(){w("create-profile")}function v(){h.value=!h.value,l.value=!1}function V(){P.value||(P.value=!0),l.value=!l.value}function pe(){r.value=!0,l.value=!1}function Ve(){window.open("https://github.com/smartHomeHub/SmartIR","_blank")}async function $e(){U.value=!0;const c=[];try{for(const s of Q)try{const X=((await te.get(`/api/smartir/platforms/${s}/profiles`)).data.profiles||[]).map(S=>({...S,platform:s}));c.push(...X)}catch(F){console.warn(`Network error loading ${s} profiles (using bundled index):`,F.message)}N.value=c}catch(s){console.error("Unexpected error loading profiles:",s)}finally{U.value=!1}}function Ce(c,s,F){w("edit-profile",{platform:c,profile:s,startStep:F})}async function Te(c,s){var F,X;try{const n=(await te.get(`/api/smartir/platforms/${c}/profiles/${s.code}`)).data,O=JSON.stringify(n.profile,null,2),B=new Blob([O],{type:"application/json"}),se=URL.createObjectURL(B),ae=document.createElement("a");ae.href=se,ae.download=`smartir_${c}_${s.manufacturer}_${s.model}_${s.code}.json`,document.body.appendChild(ae),ae.click(),document.body.removeChild(ae),URL.revokeObjectURL(se),(F=Le("toast").value)==null||F.success(`Downloaded ${s.manufacturer} ${s.model}`,"âœ… Profile Downloaded")}catch(S){console.error("Error downloading profile:",S),(X=Le("toast").value)==null||X.error("Failed to download profile","âŒ Download Error")}}const Me=c=>{c.target.closest(".settings-container")||(l.value=!1)};Ee(()=>{document.addEventListener("click",Me)}),We(()=>{document.removeEventListener("click",Me)});async function Y(c,s){Le("toast");try{const X=(await te.post(`/api/smartir/profiles/${s.code}/check-usage`,{platform:c})).data;if(X&&X.in_use){o.value={show:!0,title:`Cannot Delete ${s.manufacturer} ${s.model}`,message:`This profile is currently in use by ${X.device_count} device(s):

${X.devices.join(`
`)}

Please remove or reassign these devices before deleting the profile.`,platform:c,profile:s,canDelete:!1,devices:X.devices};return}}catch(F){console.error("Error checking profile usage:",F)}o.value={show:!0,title:`Delete ${s.manufacturer} ${s.model}?`,message:`Device Code: ${s.code}

This will remove the profile and update your configuration.`,platform:c,profile:s,canDelete:!0}}async function b(){var X,S;const c=Le("toast"),{platform:s,profile:F}=o.value;o.value.show=!1;try{await te.delete(`/api/smartir/profiles/${F.code}`,{data:{platform:s}}),await $e(),await at(),await xe(),(X=c.value)==null||X.success(`${F.manufacturer} ${F.model} has been removed`,"âœ… Profile Deleted")}catch(n){console.error("Error deleting profile:",n),(S=c.value)==null||S.error("Failed to delete profile","âŒ Delete Error")}}return ie(k,c=>{c&&(C.value=c)},{immediate:!0}),ie(J,c=>{localStorage.setItem("profile_view_mode",c)}),Ee(async()=>{var c;k!=null&&k.value&&(C.value=k.value),C.value||await xe(),(c=C.value)!=null&&c.installed&&await $e()}),m({loadAllProfiles:$e,refreshStatus:xe}),(c,s)=>{var F,X,S,n,O,B,se,ae,ne;return a(),d("div",Si,[e("div",Ii,[e("button",{class:"icon-button chevron-button",onClick:s[0]||(s[0]=oe=>P.value=!P.value)},[e("i",{class:G(["mdi",P.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2)]),e("div",{class:"header-left",onClick:s[1]||(s[1]=oe=>P.value=!P.value)},[e("img",{src:Se(Qe),alt:"SmartIR",class:"smartir-logo"},null,8,Di),e("h3",null,f(Se(p)?"SmartIR":"SmartIR Integration"),1),e("div",xi,[e("div",{class:G(["simulation-toggle-pill",{active:L.value}]),onClick:me(ee,["stop"]),title:L.value?"Click to show as installed":"Click to simulate not-installed"},[e("i",{class:G(["mdi",L.value?"mdi-eye-off":"mdi-eye"])},null,2),e("span",null,f(L.value?"Simulating: Not Installed":"Simulation Mode"),1)],10,Ti),(F=W.value)!=null&&F.installed?(a(),d(ve,{key:0},[s[16]||(s[16]=e("div",{class:"status-badge-mini success"},[e("i",{class:"mdi mdi-check-circle"}),e("span",null,"Installed")],-1)),e("span",Mi,"v"+f(W.value.version||"Unknown"),1),e("span",Ri,f(R.value)+" platform"+f(R.value!==1?"s":""),1),e("span",Ei,f(j.value)+" device"+f(j.value!==1?"s":""),1)],64)):M("",!0)])]),e("div",Ai,[!Se(p)&&((X=W.value)!=null&&X.installed)?(a(),d("div",Li,[e("button",{onClick:s[2]||(s[2]=me(oe=>J.value="grid",["stop"])),class:G(["view-toggle-btn",{active:J.value==="grid"}]),title:"Grid View"},[...s[17]||(s[17]=[e("i",{class:"mdi mdi-view-grid"},null,-1)])],2),e("button",{onClick:s[3]||(s[3]=me(oe=>J.value="list",["stop"])),class:G(["view-toggle-btn",{active:J.value==="list"}]),title:"List View"},[...s[18]||(s[18]=[e("i",{class:"mdi mdi-view-list"},null,-1)])],2)])):M("",!0),(S=W.value)!=null&&S.installed?(a(),d("button",{key:1,onClick:me(I,["stop"]),class:"btn btn-primary new-button"},[...s[19]||(s[19]=[e("i",{class:"mdi mdi-plus"},null,-1),e("span",null,"New",-1)])])):M("",!0),(n=W.value)!=null&&n.installed?(a(),d("div",Oi,[e("button",{onClick:me(V,["stop"]),class:G(["icon-button settings-button",{active:l.value}]),title:"Settings"},[...s[20]||(s[20]=[e("i",{class:"mdi mdi-cog"},null,-1)])],2),l.value?(a(),d("div",{key:0,class:"settings-dropdown",onClick:s[5]||(s[5]=me(()=>{},["stop"]))},[e("button",{onClick:v,class:"menu-item"},[s[21]||(s[21]=e("i",{class:"mdi mdi-help-circle"},null,-1)),e("span",null,f(h.value?"Hide Help":"Show Help"),1)]),e("button",{onClick:s[4]||(s[4]=oe=>{l.value=!1,xe()}),class:"menu-item"},[...s[22]||(s[22]=[e("i",{class:"mdi mdi-refresh"},null,-1),e("span",null,"Refresh Status",-1)])]),e("button",{onClick:pe,class:"menu-item"},[...s[23]||(s[23]=[e("i",{class:"mdi mdi-test-tube"},null,-1),e("span",null,"Test Codes",-1)])])])):M("",!0)])):M("",!0)])]),q(e("div",null,[g.value?(a(),d("div",Pi,[...s[24]||(s[24]=[e("div",{class:"spinner"},null,-1),e("p",null,"Checking SmartIR installation...",-1)])])):_.value?(a(),d("div",Vi,[s[25]||(s[25]=e("i",{class:"mdi mdi-alert-circle"},null,-1)),e("p",null,f(_.value),1),e("button",{onClick:xe,class:"btn-secondary"}," Try Again ")])):(O=W.value)!=null&&O.installed?(a(),d("div",Ui,[h.value?(a(),d("div",ji,[C.value.recommendation?(a(),d("div",Fi,[e("p",null,f(C.value.recommendation.message),1),C.value.recommendation.next_steps?(a(),d("div",Ni,[s[26]||(s[26]=e("strong",null,"Next Steps:",-1)),e("ul",null,[(a(!0),d(ve,null,be(C.value.recommendation.next_steps,(oe,ge)=>(a(),d("li",{key:ge},f(oe),1))),128))])])):M("",!0)])):M("",!0),e("div",Bi,[e("button",{onClick:s[6]||(s[6]=(...oe)=>c.viewDocumentation&&c.viewDocumentation(...oe)),class:"btn-secondary"},[...s[27]||(s[27]=[e("i",{class:"mdi mdi-book-open-variant"},null,-1),D(" View Documentation ",-1)])])])])):M("",!0),N.value.length>0&&!L.value?(a(),d("div",Hi,[e("div",qi,[e("button",{class:G(["filter-toggle-button",{active:T.value||De.value}]),onClick:s[7]||(s[7]=oe=>T.value=!T.value),title:T.value?"Hide filters":"Show filters"},[s[28]||(s[28]=e("i",{class:"mdi mdi-filter-variant"},null,-1)),De.value?(a(),d("span",Ji,f(we.value),1)):M("",!0)],10,zi),e("div",Wi,[s[29]||(s[29]=e("i",{class:"mdi mdi-magnify search-icon"},null,-1)),q(e("input",{"onUpdate:modelValue":s[8]||(s[8]=oe=>x.value.search=oe),type:"text",placeholder:"Search profiles...",class:"search-input"},null,512),[[Pe,x.value.search]])])]),q(e("div",Gi,[e("div",Ki,[e("div",Xi,[e("label",null,[s[31]||(s[31]=e("i",{class:"mdi mdi-shape"},null,-1)),q(e("select",{"onUpdate:modelValue":s[9]||(s[9]=oe=>x.value.platform=oe)},[...s[30]||(s[30]=[qe('<option value="" data-v-b48342da>All Platforms</option><option value="climate" data-v-b48342da>Climate</option><option value="media_player" data-v-b48342da>Media Player</option><option value="fan" data-v-b48342da>Fan</option><option value="light" data-v-b48342da>Light</option>',5)])],512),[[Re,x.value.platform]])])]),De.value?(a(),d("button",{key:0,onClick:Ae,class:"btn-clear-filters"},[...s[32]||(s[32]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),D(" Clear ",-1)])])):M("",!0),e("div",Yi,f(ue.value.length)+" of "+f(N.value.length),1)])],512),[[Ye,T.value]])])):M("",!0),U.value?(a(),d("div",Zi,[...s[33]||(s[33]=[e("i",{class:"mdi mdi-loading mdi-spin"},null,-1),e("p",null,"Loading profiles...",-1)])])):N.value.length===0?(a(),d("div",Qi,[...s[34]||(s[34]=[e("i",{class:"mdi mdi-file-document-outline"},null,-1),e("h3",null,"No Profiles Yet",-1),e("p",null,"Create your first SmartIR profile to get started",-1)])])):M("",!0),J.value==="grid"&&!L.value?(a(),d("div",er,[(a(!0),d(ve,null,be(ue.value,oe=>(a(),Ne(_a,{key:`${oe.platform}-${oe.code}`,profile:oe,onEdit:ge=>Ce(oe.platform,oe),onCommands:ge=>Ce(oe.platform,oe,2),onDownload:ge=>Te(oe.platform,oe),onDelete:ge=>Y(oe.platform,oe)},null,8,["profile","onEdit","onCommands","onDownload","onDelete"]))),128))])):J.value==="list"&&!L.value&&ue.value.length>0?(a(),Ne(Wa,{key:5,profiles:ue.value,onEdit:s[10]||(s[10]=oe=>Ce(oe.platform,oe)),onCommands:s[11]||(s[11]=oe=>Ce(oe.platform,oe,2)),onDownload:s[12]||(s[12]=oe=>Te(oe.platform,oe)),onDelete:s[13]||(s[13]=oe=>Y(oe.platform,oe))},null,8,["profiles"])):M("",!0),N.value.length>0&&ue.value.length===0&&!L.value?(a(),d("div",tr,[...s[35]||(s[35]=[e("i",{class:"mdi mdi-filter-off"},null,-1),e("h3",null,"No profiles match your filters",-1),e("p",null,"Try adjusting your search or filter criteria",-1)])])):M("",!0)])):(a(),d("div",or,[s[39]||(s[39]=e("div",{class:"status-badge warning"},[e("i",{class:"mdi mdi-information"}),e("span",null,"Not Installed")],-1)),e("div",lr,[s[37]||(s[37]=e("h4",null,"Why Install SmartIR?",-1)),e("ul",nr,[(a(!0),d(ve,null,be(((se=(B=C.value)==null?void 0:B.recommendation)==null?void 0:se.benefits)||Z,(oe,ge)=>(a(),d("li",{key:ge},[s[36]||(s[36]=e("i",{class:"mdi mdi-check"},null,-1)),e("span",null,f(oe),1)]))),128))])]),e("div",sr,[e("p",null,f(((ne=(ae=C.value)==null?void 0:ae.recommendation)==null?void 0:ne.message)||"Install SmartIR to unlock climate device support!"),1)]),e("div",{class:"card-actions"},[e("button",{onClick:Ve,class:"btn-primary"},[...s[38]||(s[38]=[e("i",{class:"mdi mdi-github"},null,-1),D(" Install SmartIR ",-1)])])])]))],512),[[Ye,P.value]]),fe(He,{isOpen:o.value.show,title:o.value.title,message:o.value.message,confirmText:o.value.canDelete===!1?null:"Delete",cancelText:"Close",dangerMode:!0,confirmDisabled:o.value.canDelete===!1,onConfirm:b,onCancel:s[14]||(s[14]=oe=>o.value.show=!1)},null,8,["isOpen","title","message","confirmText","confirmDisabled"]),fe(_i,{isOpen:r.value,onClose:s[15]||(s[15]=oe=>r.value=!1)},null,8,["isOpen"])])}}},ir=ke(ar,[["__scopeId","data-v-b48342da"]]),rr={class:"climate-form"},dr={class:"learning-mode-section"},ur={class:"mode-toggle"},cr={class:"mode-content"},mr={class:"mode-stats"},vr={class:"stat-badge"},pr={class:"stat-badge time"},fr={class:"mode-content"},gr={class:"mode-stats"},yr={class:"stat-badge"},br={class:"stat-badge time warning"},hr={key:0,class:"command-breakdown"},kr={class:"warning-text"},wr={class:"form-section"},$r={key:0,class:"help-text"},Cr={key:1,class:"help-text"},_r={class:"form-row"},Sr={class:"form-group"},Ir={class:"form-group"},Dr={class:"form-group"},xr={key:2,class:"representative-temp-section"},Tr={class:"form-group"},Mr=["value"],Rr={class:"form-section"},Er={class:"checkbox-grid"},Ar={class:"checkbox-item"},Lr={class:"checkbox-item"},Or={class:"checkbox-item"},Pr={class:"checkbox-item"},Vr={class:"checkbox-item"},Ur={class:"checkbox-item"},jr={class:"form-section"},Fr={class:"checkbox-grid"},Nr={class:"checkbox-item"},Br={class:"checkbox-item"},Hr={class:"checkbox-item"},qr={class:"checkbox-item"},zr={class:"form-section"},Jr={class:"checkbox-grid"},Wr={class:"checkbox-item"},Gr={class:"checkbox-item"},Kr={class:"checkbox-item"},Xr={class:"checkbox-item"},Yr={class:"form-section"},Zr={class:"checkbox-grid"},Qr={class:"checkbox-item"},ed={class:"checkbox-item"},td={class:"checkbox-item"},od={class:"checkbox-item"},ld={class:"checkbox-item"},nd={class:"checkbox-item"},sd={class:"form-section"},ad={class:"form-group"},id={class:"form-group"},rd={class:"form-group"},dd={key:0,class:"validation-summary"},ud={__name:"ClimateProfileForm",props:{modelValue:{type:Object,default:()=>({})}},emits:["update:modelValue"],setup(t,{emit:m}){const u=t,w=m,k=y("quick"),i=y({minTemp:16,maxTemp:30,precision:1,representativeTemp:24,modes:["off","auto","cool","heat"],fanModes:["auto","low","medium","high"],swingModes:[],presetModes:[],tempSensor:"",humiditySensor:"",powerSensor:"",learningMode:"quick",...u.modelValue}),p=K(()=>{const x=[],o=i.value.minTemp||16,r=i.value.maxTemp||30,A=i.value.precision||1;for(let J=o;J<=r;J+=A)x.push(J);return x}),g=K(()=>i.value.modes.filter(x=>x!=="off").length),_=K(()=>i.value.fanModes.length||1),C=K(()=>i.value.swingModes.length||1),L=K(()=>i.value.presetModes.length||1),h=K(()=>{const x=i.value.minTemp||16,o=i.value.maxTemp||30,r=i.value.precision||1;return Math.floor((o-x)/r)+1}),l=K(()=>{const x=i.value.modes.includes("off")?1:0;return g.value*_.value*C.value*L.value+x}),P=K(()=>Math.ceil(l.value*30/60)),N=K(()=>{const x=i.value.modes.includes("off")?1:0;return g.value*h.value*_.value*C.value*L.value+x}),U=K(()=>Math.ceil(N.value*30/60)),T=K(()=>{const x=[];return(!i.value.minTemp||i.value.minTemp<10||i.value.minTemp>35)&&x.push("Minimum temperature must be between 10Â°C and 35Â°C"),(!i.value.maxTemp||i.value.maxTemp<10||i.value.maxTemp>35)&&x.push("Maximum temperature must be between 10Â°C and 35Â°C"),i.value.minTemp>=i.value.maxTemp&&x.push("Minimum temperature must be less than maximum temperature"),(!i.value.modes||i.value.modes.length===0)&&x.push("At least one HVAC mode must be selected"),x});return ie(k,x=>{i.value.learningMode=x}),ie(i,x=>{w("update:modelValue",x)},{deep:!0,immediate:!0}),(x,o)=>(a(),d("div",rr,[o[77]||(o[77]=e("h3",null,"Climate Device Configuration",-1)),e("div",dr,[e("div",ur,[e("label",{class:G(["mode-option",{active:k.value==="quick"}])},[q(e("input",{type:"radio",value:"quick","onUpdate:modelValue":o[0]||(o[0]=r=>k.value=r)},null,512),[[ze,k.value]]),e("div",cr,[o[29]||(o[29]=e("div",{class:"mode-header"},[e("i",{class:"mdi mdi-flash"}),e("strong",null,"Quick Mode (Recommended)")],-1)),o[30]||(o[30]=e("p",null,"Learn one temperature per mode combination",-1)),e("div",mr,[e("span",vr,f(l.value)+" commands",1),e("span",pr,"~"+f(P.value)+" min",1)])])],2),e("label",{class:G(["mode-option",{active:k.value==="complete"}])},[q(e("input",{type:"radio",value:"complete","onUpdate:modelValue":o[1]||(o[1]=r=>k.value=r)},null,512),[[ze,k.value]]),e("div",fr,[o[31]||(o[31]=e("div",{class:"mode-header"},[e("i",{class:"mdi mdi-check-all"}),e("strong",null,"Complete Mode")],-1)),o[32]||(o[32]=e("p",null,"Learn all temperature combinations",-1)),e("div",gr,[e("span",yr,f(N.value)+" commands",1),e("span",br,"~"+f(U.value)+" min",1)])])],2)]),k.value==="complete"?(a(),d("div",hr,[o[33]||(o[33]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[e("strong",null,"Complete mode will require learning "+f(N.value)+" commands",1),e("p",null,"This includes all combinations of modes ("+f(g.value)+"), temperatures ("+f(h.value)+"), fan speeds ("+f(_.value)+"), swing modes ("+f(C.value)+"), and preset modes ("+f(L.value)+").",1),e("p",kr,"â±ï¸ Estimated time: "+f(U.value)+" minutes at ~30 seconds per command",1)])])):M("",!0)]),e("div",wr,[o[39]||(o[39]=e("h4",null,"Temperature Range",-1)),k.value==="quick"?(a(),d("p",$r," Define the full temperature range your device supports. You'll select one temperature to learn below. ")):(a(),d("p",Cr," Define the temperature range. All temperatures in this range will be learned. ")),e("div",_r,[e("div",Sr,[o[34]||(o[34]=e("label",null,"Minimum Temperature (Â°C) *",-1)),q(e("input",{"onUpdate:modelValue":o[2]||(o[2]=r=>i.value.minTemp=r),type:"number",min:"10",max:"35",placeholder:"16"},null,512),[[Pe,i.value.minTemp,void 0,{number:!0}]])]),e("div",Ir,[o[35]||(o[35]=e("label",null,"Maximum Temperature (Â°C) *",-1)),q(e("input",{"onUpdate:modelValue":o[3]||(o[3]=r=>i.value.maxTemp=r),type:"number",min:"10",max:"35",placeholder:"30"},null,512),[[Pe,i.value.maxTemp,void 0,{number:!0}]])]),e("div",Dr,[o[37]||(o[37]=e("label",null,"Precision",-1)),q(e("select",{"onUpdate:modelValue":o[4]||(o[4]=r=>i.value.precision=r)},[...o[36]||(o[36]=[e("option",{value:1},"1Â°C (Whole degrees)",-1),e("option",{value:.5},"0.5Â°C (Half degrees)",-1)])],512),[[Re,i.value.precision,void 0,{number:!0}]])])]),k.value==="quick"?(a(),d("div",xr,[e("div",Tr,[o[38]||(o[38]=e("label",null,"Representative Temperature to Learn *",-1)),q(e("select",{"onUpdate:modelValue":o[5]||(o[5]=r=>i.value.representativeTemp=r)},[(a(!0),d(ve,null,be(p.value,r=>(a(),d("option",{key:r,value:r},f(r)+"Â°C ",9,Mr))),128))],512),[[Re,i.value.representativeTemp,void 0,{number:!0}]]),e("small",null,"This temperature will be learned for all mode combinations. The device profile will still show the full range ("+f(i.value.minTemp)+"Â°C - "+f(i.value.maxTemp)+"Â°C).",1)])])):M("",!0)]),e("div",Rr,[o[46]||(o[46]=e("h4",null,"Supported HVAC Modes *",-1)),o[47]||(o[47]=e("p",{class:"help-text"},"Select all modes your device supports",-1)),e("div",Er,[e("label",Ar,[q(e("input",{type:"checkbox",value:"off","onUpdate:modelValue":o[6]||(o[6]=r=>i.value.modes=r)},null,512),[[de,i.value.modes]]),o[40]||(o[40]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),D(" Off ")],-1))]),e("label",Lr,[q(e("input",{type:"checkbox",value:"auto","onUpdate:modelValue":o[7]||(o[7]=r=>i.value.modes=r)},null,512),[[de,i.value.modes]]),o[41]||(o[41]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-autorenew"}),D(" Auto ")],-1))]),e("label",Or,[q(e("input",{type:"checkbox",value:"cool","onUpdate:modelValue":o[8]||(o[8]=r=>i.value.modes=r)},null,512),[[de,i.value.modes]]),o[42]||(o[42]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-snowflake"}),D(" Cool ")],-1))]),e("label",Pr,[q(e("input",{type:"checkbox",value:"heat","onUpdate:modelValue":o[9]||(o[9]=r=>i.value.modes=r)},null,512),[[de,i.value.modes]]),o[43]||(o[43]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fire"}),D(" Heat ")],-1))]),e("label",Vr,[q(e("input",{type:"checkbox",value:"dry","onUpdate:modelValue":o[10]||(o[10]=r=>i.value.modes=r)},null,512),[[de,i.value.modes]]),o[44]||(o[44]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-water-percent"}),D(" Dry ")],-1))]),e("label",Ur,[q(e("input",{type:"checkbox",value:"fan_only","onUpdate:modelValue":o[11]||(o[11]=r=>i.value.modes=r)},null,512),[[de,i.value.modes]]),o[45]||(o[45]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan"}),D(" Fan Only ")],-1))])])]),e("div",jr,[o[52]||(o[52]=e("h4",null,"Fan Modes",-1)),o[53]||(o[53]=e("p",{class:"help-text"},"Select all fan speeds your device supports",-1)),e("div",Fr,[e("label",Nr,[q(e("input",{type:"checkbox",value:"auto","onUpdate:modelValue":o[12]||(o[12]=r=>i.value.fanModes=r)},null,512),[[de,i.value.fanModes]]),o[48]||(o[48]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-autorenew"}),D(" Auto ")],-1))]),e("label",Br,[q(e("input",{type:"checkbox",value:"low","onUpdate:modelValue":o[13]||(o[13]=r=>i.value.fanModes=r)},null,512),[[de,i.value.fanModes]]),o[49]||(o[49]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-1"}),D(" Low ")],-1))]),e("label",Hr,[q(e("input",{type:"checkbox",value:"medium","onUpdate:modelValue":o[14]||(o[14]=r=>i.value.fanModes=r)},null,512),[[de,i.value.fanModes]]),o[50]||(o[50]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-2"}),D(" Medium ")],-1))]),e("label",qr,[q(e("input",{type:"checkbox",value:"high","onUpdate:modelValue":o[15]||(o[15]=r=>i.value.fanModes=r)},null,512),[[de,i.value.fanModes]]),o[51]||(o[51]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-3"}),D(" High ")],-1))])])]),e("div",zr,[o[58]||(o[58]=e("h4",null,"Swing Modes (Optional)",-1)),o[59]||(o[59]=e("p",{class:"help-text"},"Select if your device has swing/oscillation",-1)),e("div",Jr,[e("label",Wr,[q(e("input",{type:"checkbox",value:"off","onUpdate:modelValue":o[16]||(o[16]=r=>i.value.swingModes=r)},null,512),[[de,i.value.swingModes]]),o[54]||(o[54]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-horizontal"}),D(" Off ")],-1))]),e("label",Gr,[q(e("input",{type:"checkbox",value:"vertical","onUpdate:modelValue":o[17]||(o[17]=r=>i.value.swingModes=r)},null,512),[[de,i.value.swingModes]]),o[55]||(o[55]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-vertical"}),D(" Vertical ")],-1))]),e("label",Kr,[q(e("input",{type:"checkbox",value:"horizontal","onUpdate:modelValue":o[18]||(o[18]=r=>i.value.swingModes=r)},null,512),[[de,i.value.swingModes]]),o[56]||(o[56]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-horizontal"}),D(" Horizontal ")],-1))]),e("label",Xr,[q(e("input",{type:"checkbox",value:"both","onUpdate:modelValue":o[19]||(o[19]=r=>i.value.swingModes=r)},null,512),[[de,i.value.swingModes]]),o[57]||(o[57]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-arrow-all"}),D(" Both ")],-1))])])]),e("div",Yr,[o[66]||(o[66]=e("h4",null,"Preset Modes (Optional)",-1)),o[67]||(o[67]=e("p",{class:"help-text"},"Select special modes your device supports",-1)),e("div",Zr,[e("label",Qr,[q(e("input",{type:"checkbox",value:"none","onUpdate:modelValue":o[20]||(o[20]=r=>i.value.presetModes=r)},null,512),[[de,i.value.presetModes]]),o[60]||(o[60]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-circle-outline"}),D(" None ")],-1))]),e("label",ed,[q(e("input",{type:"checkbox",value:"eco","onUpdate:modelValue":o[21]||(o[21]=r=>i.value.presetModes=r)},null,512),[[de,i.value.presetModes]]),o[61]||(o[61]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-leaf"}),D(" Eco ")],-1))]),e("label",td,[q(e("input",{type:"checkbox",value:"boost","onUpdate:modelValue":o[22]||(o[22]=r=>i.value.presetModes=r)},null,512),[[de,i.value.presetModes]]),o[62]||(o[62]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-rocket-launch"}),D(" Boost ")],-1))]),e("label",od,[q(e("input",{type:"checkbox",value:"sleep","onUpdate:modelValue":o[23]||(o[23]=r=>i.value.presetModes=r)},null,512),[[de,i.value.presetModes]]),o[63]||(o[63]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power-sleep"}),D(" Sleep ")],-1))]),e("label",ld,[q(e("input",{type:"checkbox",value:"away","onUpdate:modelValue":o[24]||(o[24]=r=>i.value.presetModes=r)},null,512),[[de,i.value.presetModes]]),o[64]||(o[64]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-home-export-outline"}),D(" Away ")],-1))]),e("label",nd,[q(e("input",{type:"checkbox",value:"comfort","onUpdate:modelValue":o[25]||(o[25]=r=>i.value.presetModes=r)},null,512),[[de,i.value.presetModes]]),o[65]||(o[65]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-sofa"}),D(" Comfort ")],-1))])])]),e("div",sd,[o[74]||(o[74]=e("h4",null,"Sensors (Optional)",-1)),o[75]||(o[75]=e("p",{class:"help-text"},"Link external sensors for better climate control",-1)),e("div",ad,[o[68]||(o[68]=e("label",null,"Temperature Sensor",-1)),q(e("input",{"onUpdate:modelValue":o[26]||(o[26]=r=>i.value.tempSensor=r),type:"text",placeholder:"sensor.living_room_temperature"},null,512),[[Pe,i.value.tempSensor]]),o[69]||(o[69]=e("small",null,"Entity ID of temperature sensor",-1))]),e("div",id,[o[70]||(o[70]=e("label",null,"Humidity Sensor",-1)),q(e("input",{"onUpdate:modelValue":o[27]||(o[27]=r=>i.value.humiditySensor=r),type:"text",placeholder:"sensor.living_room_humidity"},null,512),[[Pe,i.value.humiditySensor]]),o[71]||(o[71]=e("small",null,"Entity ID of humidity sensor",-1))]),e("div",rd,[o[72]||(o[72]=e("label",null,"Power Sensor",-1)),q(e("input",{"onUpdate:modelValue":o[28]||(o[28]=r=>i.value.powerSensor=r),type:"text",placeholder:"binary_sensor.ac_power"},null,512),[[Pe,i.value.powerSensor]]),o[73]||(o[73]=e("small",null,"Entity ID of power sensor (to detect on/off state)",-1))])]),T.value.length>0?(a(),d("div",dd,[o[76]||(o[76]=e("h4",null,[e("i",{class:"mdi mdi-alert-circle"}),D(" Please fix the following: ")],-1)),e("ul",null,[(a(!0),d(ve,null,be(T.value,(r,A)=>(a(),d("li",{key:A},f(r),1))),128))])])):M("",!0)]))}},cd=ke(ud,[["__scopeId","data-v-e22a3983"]]),md={class:"command-wizard"},vd={class:"device-selection-section"},pd={class:"input-wrapper"},fd=["value"],gd={key:0,class:"validation-tooltip"},yd={class:"form-group"},bd=["disabled"],hd={key:0},kd={key:1},wd={key:0,class:"edit-mode-banner"},$d={class:"wizard-info"},Cd={key:0},_d={key:1},Sd={class:"progress-info"},Id={class:"progress-bar"},Dd={class:"progress-text"},xd={class:"commands-grid"},Td={class:"command-header"},Md={class:"command-icon"},Rd={class:"command-info"},Ed={key:0,class:"learning-indicator"},Ad={key:0,class:"ir-learning-steps"},Ld={key:1,class:"rf-learning-steps"},Od={class:"command-actions"},Pd=["onClick","disabled"],Vd={key:1,class:"learned-status"},Ud=["onClick","disabled"],jd=["onClick"],Fd={class:"quick-actions"},Nd=["disabled"],Bd=["disabled"],Hd={__name:"CommandLearningWizard",props:{modelValue:{type:Object,default:()=>({})},platform:{type:String,required:!0},config:{type:Object,required:!0},broadlinkDevice:{type:String,default:""},manufacturer:{type:String,required:!0},model:{type:String,required:!0},commandType:{type:String,default:"ir"}},emits:["update:modelValue","update:broadlinkDevice","update:commandType"],setup(t,{emit:m}){const u=Ge(),w=t,k=m,i=y({...w.modelValue}),p=y(null),g=y(null),_=y([]),C=y(w.broadlinkDevice),L=y(w.commandType),h=y(!1),l=y([]),P=y(!1),N=y(!1),U=y({show:!1,commandKey:null,commandLabel:""}),T=y(!1),x=K(()=>{const I=[];if(w.platform==="climate"){const v=w.config.modes||[],V=w.config.fanModes||[],pe=w.config.swingModes||[],Ve=w.config.presetModes||[],$e=w.config.minTemp||16,Ce=w.config.maxTemp||30;v.forEach(Te=>{if(Te==="off")I.push({key:"off",label:"Power Off",description:"Turn device off",icon:"mdi mdi-power",mode:"off"});else for(let Me=$e;Me<=Ce;Me++)V.forEach(Y=>{(pe.length>0?pe:[null]).forEach(c=>{(Ve.length>0?Ve:[null]).forEach(F=>{let X=`${Te}_${Me}_${Y}`,S=`${Te.toUpperCase()} ${Me}Â°C ${Y}`,n=`Mode: ${Te}, Temp: ${Me}Â°C, Fan: ${Y}`;c&&(X+=`_${c}`,S+=` ${c}`,n+=`, Swing: ${c}`),F&&(X+=`_${F}`,S+=` [${F}]`,n+=`, Preset: ${F}`),I.push({key:X,label:S,description:n,icon:J(Te),mode:Te,temp:Me,fanMode:Y,swingMode:c,presetMode:F})})})})})}else if(w.platform==="media_player"){const v=w.config.features||[];v.includes("turn_on")&&(I.push({key:"turn_on",label:"Power On",description:"Turn on the device",icon:"mdi mdi-power"}),I.push({key:"turn_off",label:"Power Off",description:"Turn off the device",icon:"mdi mdi-power-off"})),v.includes("volume")&&(I.push({key:"volume_up",label:"Volume Up",description:"Increase volume",icon:"mdi mdi-volume-plus"}),I.push({key:"volume_down",label:"Volume Down",description:"Decrease volume",icon:"mdi mdi-volume-minus"})),v.includes("mute")&&I.push({key:"mute",label:"Mute",description:"Toggle mute",icon:"mdi mdi-volume-mute"}),v.includes("source")&&(I.push({key:"source_hdmi1",label:"Source: HDMI 1",description:"Switch to HDMI 1",icon:"mdi mdi-import"}),I.push({key:"source_hdmi2",label:"Source: HDMI 2",description:"Switch to HDMI 2",icon:"mdi mdi-import"}),I.push({key:"source_hdmi3",label:"Source: HDMI 3",description:"Switch to HDMI 3",icon:"mdi mdi-import"})),v.includes("channel")&&(I.push({key:"channel_up",label:"Channel Up",description:"Next channel",icon:"mdi mdi-chevron-up"}),I.push({key:"channel_down",label:"Channel Down",description:"Previous channel",icon:"mdi mdi-chevron-down"}))}else if(w.platform==="fan"){const v=w.config.speedLevels||3,V=w.config.features||[];I.push({key:"turn_on",label:"Power On",description:"Turn on the fan",icon:"mdi mdi-power"}),I.push({key:"turn_off",label:"Power Off",description:"Turn off the fan",icon:"mdi mdi-power-off"});for(let pe=1;pe<=v;pe++){const Ve=pe===1?"Low":pe===v?"High":pe===2&&v===3?"Medium":`Speed ${pe}`;I.push({key:`speed_${pe}`,label:`${Ve}`,description:`Set fan to speed level ${pe}`,icon:"mdi mdi-fan"})}V.includes("oscillate")&&(I.push({key:"oscillate_on",label:"Oscillate On",description:"Enable oscillation",icon:"mdi mdi-sync"}),I.push({key:"oscillate_off",label:"Oscillate Off",description:"Disable oscillation",icon:"mdi mdi-sync-off"})),V.includes("direction")&&(I.push({key:"direction_forward",label:"Direction: Forward",description:"Set direction to forward",icon:"mdi mdi-rotate-right"}),I.push({key:"direction_reverse",label:"Direction: Reverse",description:"Set direction to reverse",icon:"mdi mdi-rotate-left"}))}else if(w.platform==="light"){const v=w.config.features||[];v.includes("turn_on")&&(I.push({key:"turn_on",label:"Power On",description:"Turn on the light",icon:"mdi mdi-lightbulb-on"}),I.push({key:"turn_off",label:"Power Off",description:"Turn off the light",icon:"mdi mdi-lightbulb-off"})),v.includes("brightness")&&(I.push({key:"brightness_up",label:"Brightness Up",description:"Increase brightness",icon:"mdi mdi-brightness-7"}),I.push({key:"brightness_down",label:"Brightness Down",description:"Decrease brightness",icon:"mdi mdi-brightness-5"})),v.includes("color_temp")&&(I.push({key:"color_temp_warm",label:"Warm White",description:"Set to warm white",icon:"mdi mdi-weather-sunset"}),I.push({key:"color_temp_cool",label:"Cool White",description:"Set to cool white",icon:"mdi mdi-weather-sunny"})),v.includes("rgb")&&(I.push({key:"color_red",label:"Color: Red",description:"Set color to red",icon:"mdi mdi-palette"}),I.push({key:"color_green",label:"Color: Green",description:"Set color to green",icon:"mdi mdi-palette"}),I.push({key:"color_blue",label:"Color: Blue",description:"Set color to blue",icon:"mdi mdi-palette"}))}return I}),o=K(()=>x.value.length),r=K(()=>Object.keys(i.value).length),A=K(()=>o.value===0?0:Math.round(r.value/o.value*100));function J(I){return{off:"mdi mdi-power",auto:"mdi mdi-autorenew",cool:"mdi mdi-snowflake",heat:"mdi mdi-fire",dry:"mdi mdi-water-percent",fan_only:"mdi mdi-fan"}[I]||"mdi mdi-remote"}async function Z(I){if(!p.value){if(!C.value){N.value=!0,window.scrollTo({top:0,behavior:"smooth"});return}N.value=!1,p.value=I.key;try{const v=w.manufacturer.toLowerCase().replace(/[^a-z0-9]+/g,"_"),V=w.model.toLowerCase().replace(/[^a-z0-9]+/g,"_"),pe=`${v}_${V}`,$e=(await te.post("/api/commands/learn",{entity_id:C.value,device:pe,command:I.key,command_type:L.value})).data;if($e.success&&$e.code)i.value[I.key]=$e.code,k("update:modelValue",i.value),P.value=!0,$e.code==="pending"&&console.log(`â³ Command '${I.key}' learned, code will be fetched from storage when saving`),h.value&&l.value.length>0&&setTimeout(()=>{const Ce=l.value.shift();Ce?Z(Ce):h.value=!1},1e3);else throw new Error($e.error||"Failed to learn command")}catch(v){console.error("Error learning command:",v),u.error(`Error learning command: ${v.message}`),h.value=!1,l.value=[]}finally{h.value||(p.value=null)}}}async function Q(I){var v;if(!C.value){N.value=!0,window.scrollTo({top:0,behavior:"smooth"});return}if(!i.value[I]){(v=u.value)==null||v.error("Command not learned yet");return}g.value=I;try{const V=i.value[I];await te.post("/api/commands/send-raw",{entity_id:C.value,command:V,command_type:L.value}),u.success("Command sent successfully")}catch(V){console.error("Error testing command:",V),u.error(`Error testing command: ${V.message}`)}finally{g.value=null}}function W(I){const v=x.value.find(V=>V.key===I);U.value={show:!0,commandKey:I,commandLabel:v?v.label:I}}function R(){const I=U.value.commandKey;delete i.value[I],k("update:modelValue",i.value),U.value.show=!1}function j(){const I=x.value.filter(V=>!i.value[V.key]);if(I.length===0)return;h.value=!0,l.value=[...I];const v=l.value.shift();v&&Z(v)}function ee(){T.value=!0}function ue(){i.value={},k("update:modelValue",i.value),T.value=!1}ie(()=>w.modelValue,I=>{i.value={...I}},{deep:!0}),Ee(async()=>{await De()});async function De(){try{console.log("SmartIR device - commands will be loaded from SmartIR JSON file, not Broadlink storage")}catch(I){console.error("Error in loadExistingCommands:",I)}}function we(){k("update:broadlinkDevice",C.value)}function Ae(){k("update:commandType",L.value)}async function xe(){try{console.log("ğŸ” Loading Broadlink devices from /api/remote/devices");const I=await te.get("/api/remote/devices");console.log("ğŸ“¦ Response data:",I.data);const v=I.data.devices||[];console.log(`âœ… Found ${v.length} devices:`,v),_.value=v}catch(I){console.error("âŒ Error loading remote devices:",I),_.value=[]}}return ie(()=>w.broadlinkDevice,I=>{C.value=I}),ie(C,I=>{I&&(N.value=!1)}),ie(()=>w.commandType,I=>{L.value=I}),Ee(async()=>{await xe(),await De()}),(I,v)=>(a(),d("div",md,[v[22]||(v[22]=e("h3",null,"Learn IR Commands",-1)),e("div",vd,[e("div",{class:G(["form-group",{"has-error":N.value}])},[v[6]||(v[6]=e("label",null,"Broadlink Device *",-1)),e("div",pd,[q(e("select",{"onUpdate:modelValue":v[0]||(v[0]=V=>C.value=V),onChange:we},[v[4]||(v[4]=e("option",{value:""},"Select Broadlink device...",-1)),(a(!0),d(ve,null,be(_.value,V=>(a(),d("option",{key:V.entity_id,value:V.entity_id},f(V.name||V.entity_id),9,fd))),128))],544),[[Re,C.value]]),N.value?(a(),d("div",gd,[...v[5]||(v[5]=[e("i",{class:"mdi mdi-alert"},null,-1),D(" Device is required ",-1)])])):M("",!0)]),e("small",null,"This device will be used to learn commands ("+f(_.value.length)+" devices found)",1)],2),e("div",yd,[v[8]||(v[8]=e("label",null,"Command Type *",-1)),q(e("select",{"onUpdate:modelValue":v[1]||(v[1]=V=>L.value=V),onChange:Ae,disabled:r.value>0},[...v[7]||(v[7]=[e("option",{value:"ir"},"ğŸ“¡ Infrared (IR) - Most common for AC, TV, etc.",-1),e("option",{value:"rf"},"ğŸ“» Radio Frequency (RF) - For RF remotes",-1)])],40,bd),[[Re,L.value]]),r.value>0?(a(),d("small",hd,"Command type cannot be changed after learning commands")):(a(),d("small",kd,"Select the type of commands your device uses"))])]),r.value>0&&!P.value?(a(),d("div",wd,[v[10]||(v[10]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[v[9]||(v[9]=e("strong",null,"Editing Existing Profile",-1)),e("p",null,f(r.value)+" command"+f(r.value!==1?"s":"")+' already learned. You can re-learn any command by clicking the delete icon and then "Learn Command".',1)])])):M("",!0),e("div",$d,[v[14]||(v[14]=e("i",{class:"mdi mdi-information"},null,-1)),e("div",null,[v[13]||(v[13]=e("p",null,[e("strong",null,"How it works:")],-1)),t.commandType==="ir"?(a(),d("ol",Cd,[...v[11]||(v[11]=[e("li",null,'Click "Learn Command" for each combination',-1),e("li",null,[e("strong",null,"Point your IR remote directly at the Broadlink device")],-1),e("li",null,"Press the button on your remote",-1),e("li",null,"Wait for confirmation (up to 30 seconds)",-1)])])):(a(),d("ol",_d,[...v[12]||(v[12]=[e("li",null,'Click "Learn Command" for each combination',-1),e("li",null,[e("strong",null,"Step 1:"),D(" Hold button on remote - Broadlink scans for RF frequency")],-1),e("li",null,[e("strong",null,"Step 2:"),D(" Watch for Home Assistant notification, then press and release button")],-1),e("li",null,"Keep remote within 5cm of Broadlink (RF doesn't need line-of-sight)",-1),e("li",null,"Wait for confirmation (may take up to 30 seconds)",-1)])]))])]),e("div",Sd,[e("div",Id,[e("div",{class:"progress-fill",style:ft({width:A.value+"%"})},null,4)]),e("span",Dd,f(r.value)+" / "+f(o.value)+" commands learned ("+f(A.value)+"%) ",1)]),e("div",xd,[(a(!0),d(ve,null,be(x.value,V=>(a(),d("div",{key:V.key,class:G(["command-card",{learned:i.value[V.key],learning:p.value===V.key}])},[e("div",Td,[e("div",Md,[e("i",{class:G(V.icon)},null,2)]),e("div",Rd,[e("h4",null,f(V.label),1),e("p",null,f(V.description),1)])]),p.value===V.key?(a(),d("div",Ed,[t.commandType==="ir"?(a(),d("div",Ad,[...v[15]||(v[15]=[e("p",null,[e("strong",null,"Point your remote directly at the Broadlink device and press the button.")],-1),e("small",null,"Listening for up to 30 seconds...",-1)])])):(a(),d("div",Ld,[...v[16]||(v[16]=[e("p",{class:"rf-title"},[e("strong",null,"Learning request sent to device.")],-1),e("p",{class:"rf-subtitle"},[D("RF learning is a "),e("strong",null,"two-step process"),D(":")],-1),e("ol",null,[e("li",null,[e("strong",null,"Step 1 - Frequency Sweep (~10-15 seconds):"),D(" Press and hold the button on your remote until the notification updates. ")]),e("li",null,[e("strong",null,"Step 2 - Learn Signal:"),D(" Press and release the button once. ")])],-1),e("p",{class:"rf-note"},"Follow the Home Assistant notifications (ğŸ””) for real-time instructions.",-1)])]))])):M("",!0),e("div",Od,[i.value[V.key]?(a(),d("div",Vd,[v[18]||(v[18]=e("i",{class:"mdi mdi-check-circle"},null,-1)),v[19]||(v[19]=e("span",null,"Learned",-1)),e("span",{class:G(["command-type-badge",L.value])},f(L.value.toUpperCase()),3),e("button",{onClick:pe=>Q(V.key),class:"icon-btn",title:"Test command",disabled:g.value===V.key,style:{"margin-left":"auto"}},[e("i",{class:G(["mdi mdi-play",{"mdi-spin":g.value===V.key}])},null,2)],8,Ud),e("button",{onClick:pe=>W(V.key),class:"icon-btn danger",title:"Delete and re-learn"},[...v[17]||(v[17]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,jd)])):(a(),d("button",{key:0,onClick:pe=>Z(V),class:G(["btn-learn",{learning:p.value===V.key}]),disabled:p.value!==null},[e("i",{class:G(["mdi mdi-radio-tower",{"mdi-spin":p.value===V.key}])},null,2),D(" "+f(p.value===V.key?"Listening...":"Learn Command"),1)],10,Pd))])],2))),128))]),e("div",Fd,[e("button",{onClick:j,class:"btn-secondary",disabled:p.value!==null||r.value===o.value},[...v[20]||(v[20]=[e("i",{class:"mdi mdi-play-circle"},null,-1),D(" Learn All Remaining ",-1)])],8,Nd),e("button",{onClick:ee,class:"btn-text",disabled:r.value===0},[...v[21]||(v[21]=[e("i",{class:"mdi mdi-delete-sweep"},null,-1),D(" Clear All ",-1)])],8,Bd)]),fe(He,{isOpen:U.value.show,title:"Delete Learned Command?",message:`Are you sure you want to delete the '${U.value.commandLabel}' command?

You will need to re-learn this command.`,confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,onConfirm:R,onCancel:v[2]||(v[2]=V=>U.value.show=!1)},null,8,["isOpen","message"]),fe(He,{isOpen:T.value,title:"Delete All Learned Commands?",message:"Are you sure you want to delete all learned commands? This cannot be undone.\\n\\nYou will need to re-learn all commands.",confirmText:"Delete All",cancelText:"Cancel",dangerMode:!0,onConfirm:ue,onCancel:v[3]||(v[3]=V=>T.value=!1)},null,8,["isOpen"])]))}},qd=ke(Hd,[["__scopeId","data-v-5c24d9df"]]),zd={class:"profile-preview"},Jd={class:"preview-summary"},Wd={class:"summary-card"},Gd={class:"stats-grid"},Kd={class:"stat-item"},Xd={class:"stat-value"},Yd={class:"stat-item"},Zd={class:"stat-value"},Qd={class:"stat-item"},eu={class:"stat-value"},tu={class:"preview-tabs"},ou={class:"preview-content"},lu={key:0,class:"tab-content"},nu={class:"code-header"},su={class:"code-block"},au={key:1,class:"tab-content"},iu={class:"code-header"},ru={class:"code-block"},du={key:2,class:"tab-content"},uu={class:"instructions"},cu={class:"step-item"},mu={class:"step-content"},vu={class:"code-path"},pu={__name:"ProfilePreview",props:{profile:{type:Object,required:!0},jsonData:{type:Object,required:!0},yamlConfig:{type:String,required:!0}},setup(t){const m=Ge(),u=t,w=y("json"),k=y(!1),i=y(!1),p=K(()=>Object.keys(u.profile.commands||{}).length),g=K(()=>JSON.stringify(u.jsonData,null,2));async function _(){try{await navigator.clipboard.writeText(g.value),k.value=!0,setTimeout(()=>{k.value=!1},2e3)}catch(L){console.error("Failed to copy JSON:",L),m.error("Failed to copy to clipboard")}}async function C(){try{await navigator.clipboard.writeText(u.yamlConfig),i.value=!0,setTimeout(()=>{i.value=!1},2e3)}catch(L){console.error("Failed to copy YAML:",L),m.error("Failed to copy to clipboard")}}return(L,h)=>{var l;return a(),d("div",zd,[h[22]||(h[22]=e("h3",null,"Preview & Save",-1)),e("div",Jd,[e("div",Wd,[h[4]||(h[4]=e("i",{class:"mdi mdi-check-circle"},null,-1)),e("div",null,[h[3]||(h[3]=e("h4",null,"Profile Ready!",-1)),e("p",null,f(t.profile.manufacturer)+" "+f(t.profile.model),1)])]),e("div",Gd,[e("div",Kd,[e("span",Xd,f(p.value),1),h[5]||(h[5]=e("span",{class:"stat-label"},"Commands Learned",-1))]),e("div",Yd,[e("span",Zd,f(t.profile.platform),1),h[6]||(h[6]=e("span",{class:"stat-label"},"Platform",-1))]),e("div",Qd,[e("span",eu,f(((l=t.profile.config.modes)==null?void 0:l.length)||0),1),h[7]||(h[7]=e("span",{class:"stat-label"},"HVAC Modes",-1))])])]),e("div",tu,[e("button",{onClick:h[0]||(h[0]=P=>w.value="json"),class:G(["tab-button",{active:w.value==="json"}])},[...h[8]||(h[8]=[e("i",{class:"mdi mdi-code-json"},null,-1),D(" SmartIR JSON ",-1)])],2),e("button",{onClick:h[1]||(h[1]=P=>w.value="yaml"),class:G(["tab-button",{active:w.value==="yaml"}])},[...h[9]||(h[9]=[e("i",{class:"mdi mdi-file-code"},null,-1),D(" YAML Config ",-1)])],2),e("button",{onClick:h[2]||(h[2]=P=>w.value="instructions"),class:G(["tab-button",{active:w.value==="instructions"}])},[...h[10]||(h[10]=[e("i",{class:"mdi mdi-information"},null,-1),D(" Instructions ",-1)])],2)]),e("div",ou,[w.value==="json"?(a(),d("div",lu,[e("div",nu,[h[12]||(h[12]=e("h4",null,"SmartIR Device Code JSON",-1)),e("button",{onClick:_,class:"btn-copy"},[h[11]||(h[11]=e("i",{class:"mdi mdi-content-copy"},null,-1)),D(" "+f(k.value?"Copied!":"Copy"),1)])]),e("pre",su,[e("code",null,f(g.value),1)]),h[13]||(h[13]=e("p",{class:"code-note"},[e("i",{class:"mdi mdi-information"}),D(" Save this as "),e("code",null,"10000.json"),D(" in your SmartIR codes directory ")],-1))])):M("",!0),w.value==="yaml"?(a(),d("div",au,[e("div",iu,[h[15]||(h[15]=e("h4",null,"Home Assistant Configuration",-1)),e("button",{onClick:C,class:"btn-copy"},[h[14]||(h[14]=e("i",{class:"mdi mdi-content-copy"},null,-1)),D(" "+f(i.value?"Copied!":"Copy"),1)])]),e("pre",ru,[e("code",null,f(t.yamlConfig),1)]),h[16]||(h[16]=e("p",{class:"code-note"},[e("i",{class:"mdi mdi-information"}),D(" Add this to your "),e("code",null,"configuration.yaml"),D(" file ")],-1))])):M("",!0),w.value==="instructions"?(a(),d("div",du,[e("div",uu,[h[20]||(h[20]=e("h4",null,"Installation Steps",-1)),e("div",cu,[h[19]||(h[19]=e("div",{class:"step-number"},"1",-1)),e("div",mu,[h[17]||(h[17]=e("h5",null,"Get Next Code Number",-1)),h[18]||(h[18]=e("p",null,"Custom device codes start at 10000. Check your SmartIR codes directory to find the next available number.",-1)),e("div",vu,[e("code",null,"/config/custom_components/smartir/codes/"+f(t.profile.platform)+"/",1)])])]),h[21]||(h[21]=qe('<div class="step-item" data-v-e7b997c8><div class="step-number" data-v-e7b997c8>2</div><div class="step-content" data-v-e7b997c8><h5 data-v-e7b997c8>Save JSON File</h5><p data-v-e7b997c8>Copy the JSON from the &quot;SmartIR JSON&quot; tab and save it as <code data-v-e7b997c8>10000.json</code> (or your next available number) in the codes directory.</p></div></div><div class="step-item" data-v-e7b997c8><div class="step-number" data-v-e7b997c8>3</div><div class="step-content" data-v-e7b997c8><h5 data-v-e7b997c8>Update Configuration</h5><p data-v-e7b997c8>Copy the YAML from the &quot;YAML Config&quot; tab and add it to your <code data-v-e7b997c8>configuration.yaml</code> file. Update the <code data-v-e7b997c8>device_code</code> to match your JSON filename.</p></div></div><div class="step-item" data-v-e7b997c8><div class="step-number" data-v-e7b997c8>4</div><div class="step-content" data-v-e7b997c8><h5 data-v-e7b997c8>Restart Home Assistant</h5><p data-v-e7b997c8>Restart Home Assistant to load the new configuration. Your climate entity will appear in the UI.</p></div></div><div class="step-item" data-v-e7b997c8><div class="step-number" data-v-e7b997c8>5</div><div class="step-content" data-v-e7b997c8><h5 data-v-e7b997c8>Test Your Device</h5><p data-v-e7b997c8>Go to your climate entity and test different modes, temperatures, and fan speeds to ensure everything works correctly.</p></div></div><div class="tips-section" data-v-e7b997c8><h4 data-v-e7b997c8><i class="mdi mdi-lightbulb" data-v-e7b997c8></i> Tips </h4><ul data-v-e7b997c8><li data-v-e7b997c8>Keep a backup of your JSON file in case you need to modify it</li><li data-v-e7b997c8>Test all commands to ensure they work as expected</li><li data-v-e7b997c8>You can share your profile with the SmartIR community on GitHub</li><li data-v-e7b997c8>If a command doesn&#39;t work, you can re-learn it and update the JSON</li></ul></div>',5))])])):M("",!0)])])}}},fu=ke(pu,[["__scopeId","data-v-e7b997c8"]]),gu={class:"wizard-body"},yu={key:0,class:"warning-section"},bu={class:"warning-box"},hu={class:"instructions"},ku={class:"code-block"},wu={class:"steps"},$u={key:0},Cu={class:"help-section"},_u={key:0,class:"help-content"},Su={class:"help-step"},Iu={key:0,class:"help-step"},Du={class:"help-step"},xu={class:"help-step"},Tu={class:"checklist"},Mu={class:"checkbox-label"},Ru={key:0,class:"checkbox-label"},Eu={class:"wizard-footer"},Au=["disabled"],Lu={__name:"SmartIRSetupWizard",props:{show:{type:Boolean,default:!1},platform:{type:String,required:!0},warnings:{type:Array,default:()=>[]},configPath:{type:String,default:"/config"}},emits:["close","complete"],setup(t,{emit:m}){const u=t,w=m,k=Le("toast"),i=y(!1),p=y(!1),g=y(!1),_=K(()=>u.warnings.length>0?i.value&&p.value:i.value);function C(){const h=`${u.platform}: !include smartir/${u.platform}.yaml`;navigator.clipboard.writeText(h).then(()=>{var l;(l=k.value)==null||l.success("Include line copied to clipboard!","âœ… Copied")}).catch(l=>{var P;console.error("Failed to copy:",l),(P=k.value)==null||P.error("Failed to copy to clipboard","âŒ Copy Failed")})}function L(){w("complete")}return(h,l)=>t.show?(a(),d("div",{key:0,class:"modal-overlay",onClick:l[5]||(l[5]=me(()=>{},["stop"]))},[e("div",{class:"setup-wizard",onClick:l[4]||(l[4]=me(()=>{},["stop"]))},[l[31]||(l[31]=e("div",{class:"wizard-header"},[e("h2",null,[e("i",{class:"mdi mdi-cog"}),D(" SmartIR Configuration Setup ")])],-1)),e("div",gu,[t.warnings.length>0?(a(),d("div",yu,[e("div",bu,[l[11]||(l[11]=e("i",{class:"mdi mdi-alert"},null,-1)),e("div",null,[l[9]||(l[9]=e("h3",null,"âš ï¸ Configuration Migration Needed",-1)),l[10]||(l[10]=e("p",null,"We detected existing platform entries in your configuration.yaml:",-1)),e("ul",null,[(a(!0),d(ve,null,be(t.warnings,P=>(a(),d("li",{key:P.platform},[e("strong",null,f(P.platform)+":",1),D(" "+f(P.message),1)]))),128))]),e("p",null,[l[6]||(l[6]=e("strong",null,"Action Required:",-1)),l[7]||(l[7]=D(" Move these entries to ",-1)),e("code",null,"smartir/"+f(t.platform)+".yaml",1),l[8]||(l[8]=D(" before continuing.",-1))])])])])):M("",!0),e("div",hu,[l[27]||(l[27]=e("h3",null,"ğŸ“ One-Time Setup",-1)),l[28]||(l[28]=e("p",null,[D("To enable SmartIR device management, add this line to your "),e("code",null,"configuration.yaml"),D(":")],-1)),e("div",ku,[e("code",null,f(t.platform)+": !include smartir/"+f(t.platform)+".yaml",1),e("button",{onClick:C,class:"copy-btn",title:"Copy to clipboard"},[...l[12]||(l[12]=[e("i",{class:"mdi mdi-content-copy"},null,-1)])])]),e("div",wu,[l[19]||(l[19]=e("h4",null,"Steps:",-1)),e("ol",null,[t.warnings.length>0?(a(),d("li",$u,[l[13]||(l[13]=e("strong",null,"Move existing entries:",-1)),l[14]||(l[14]=D(" Copy any existing ",-1)),e("code",null,f(t.platform)+":",1),l[15]||(l[15]=D(" entries from configuration.yaml to ",-1)),e("code",null,"smartir/"+f(t.platform)+".yaml",1)])):M("",!0),l[16]||(l[16]=e("li",null,[e("strong",null,"Add include line:"),D(" Add the line above to your configuration.yaml ")],-1)),l[17]||(l[17]=e("li",null,[e("strong",null,"Save changes:"),D(" Save configuration.yaml ")],-1)),l[18]||(l[18]=e("li",null,[e("strong",null,"Continue here:"),D(` Click "I've Completed Setup" below `)],-1))])]),e("div",Cu,[e("button",{onClick:l[0]||(l[0]=P=>g.value=!g.value),class:"help-toggle"},[e("i",{class:G(["mdi",g.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2),D(" "+f(g.value?"Hide":"Show")+" Detailed Instructions ",1)]),g.value?(a(),d("div",_u,[l[26]||(l[26]=e("h4",null,"Detailed Setup Guide:",-1)),e("div",Su,[l[21]||(l[21]=e("h5",null,"1. Open configuration.yaml",-1)),e("p",null,[l[20]||(l[20]=D("Location: ",-1)),e("code",null,f(t.configPath)+"/configuration.yaml",1)])]),t.warnings.length>0?(a(),d("div",Iu,[l[22]||(l[22]=e("h5",null,"2. Migrate Existing Entries (If Any)",-1)),e("p",null,"If you have existing "+f(t.platform)+" entries, cut them from configuration.yaml and paste into:",1),e("p",null,[e("code",null,f(t.configPath)+"/smartir/"+f(t.platform)+".yaml",1)]),l[23]||(l[23]=e("p",{class:"note"},"Broadlink Manager will create this file automatically.",-1))])):M("",!0),e("div",Du,[e("h5",null,f(t.warnings.length>0?"3":"2")+". Add Include Line",1),l[24]||(l[24]=e("p",null,"Add this to configuration.yaml:",-1)),e("pre",null,f(t.platform)+": !include smartir/"+f(t.platform)+".yaml",1)]),e("div",xu,[e("h5",null,f(t.warnings.length>0?"4":"3")+". Restart Home Assistant",1),l[25]||(l[25]=e("p",null,"After saving, you'll need to restart HA for changes to take effect.",-1))])])):M("",!0)])]),e("div",Tu,[e("label",Mu,[q(e("input",{type:"checkbox","onUpdate:modelValue":l[1]||(l[1]=P=>i.value=P)},null,512),[[de,i.value]]),l[29]||(l[29]=e("span",null,"I've added the include line to configuration.yaml",-1))]),t.warnings.length>0?(a(),d("label",Ru,[q(e("input",{type:"checkbox","onUpdate:modelValue":l[2]||(l[2]=P=>p.value=P)},null,512),[[de,p.value]]),e("span",null,"I've migrated existing "+f(t.platform)+" entries (if any)",1)])):M("",!0)])]),e("div",Eu,[e("button",{onClick:l[3]||(l[3]=P=>h.$emit("close")),class:"btn-secondary"}," Cancel "),e("button",{onClick:L,class:"btn-primary",disabled:!_.value},[...l[30]||(l[30]=[e("i",{class:"mdi mdi-check"},null,-1),D(" I've Completed Setup ",-1)])],8,Au)])])])):M("",!0)}},Ou=ke(Lu,[["__scopeId","data-v-f6fe4c03"]]),Pu={class:"modal-header"},Vu={class:"progress-steps"},Uu={class:"step-number"},ju={key:0,class:"mdi mdi-check"},Fu={key:1},Nu={class:"step-label"},Bu={class:"modal-body"},Hu={key:0,class:"step-content"},qu={class:"form-group"},zu={class:"form-group"},Ju={class:"form-group"},Wu={key:1,class:"step-content"},Gu={key:1,class:"platform-form"},Ku={class:"form-section"},Xu={class:"checkbox-grid"},Yu={class:"checkbox-item"},Zu={class:"checkbox-item"},Qu={class:"checkbox-item"},ec={class:"checkbox-item"},tc={class:"checkbox-item"},oc={key:2,class:"platform-form"},lc={class:"form-section"},nc={class:"form-group"},sc={class:"form-section"},ac={class:"checkbox-grid"},ic={class:"checkbox-item"},rc={class:"checkbox-item"},dc={key:3,class:"platform-form"},uc={class:"form-section"},cc={class:"checkbox-grid"},mc={class:"checkbox-item"},vc={class:"checkbox-item"},pc={class:"checkbox-item"},fc={class:"checkbox-item"},gc={key:2,class:"step-content"},yc={key:3,class:"step-content"},bc={class:"modal-footer"},hc=["disabled"],kc={key:2,class:"save-buttons"},wc=["disabled"],$c=["disabled"],Cc={__name:"SmartIRProfileBuilder",props:{show:{type:Boolean,default:!1},editMode:{type:Boolean,default:!1},editData:{type:Object,default:null},startStep:{type:Number,default:0}},emits:["close","save"],setup(t,{emit:m}){const u=t,w=m,k=Le("toast"),i=y(0),p=y(!1),g=y([]),_=y(!1),C=y([]),L=y("/config"),h=y(!1),l=y(null),P=y(!1),N=y(!1),U=y(""),T=y("ir"),x=y(!1),o=[{label:"Device Info",key:"info"},{label:"Configuration",key:"config"},{label:"Learn Commands",key:"commands"},{label:"Preview & Save",key:"preview"}],r=y({platform:"",manufacturer:"",model:"",broadlinkDevice:"",commandType:"ir",config:{},commands:{}}),A=y(["turn_on"]),J=y(3),Z=y([]),Q=y(["turn_on"]);ie(()=>r.value.platform,S=>{S==="media_player"?r.value.config={features:A.value}:S==="fan"?r.value.config={speedLevels:J.value,features:Z.value}:S==="light"&&(r.value.config={features:Q.value})}),ie(A,S=>{r.value.platform==="media_player"&&(r.value.config={features:S})},{deep:!0}),ie(J,S=>{r.value.platform==="fan"&&(r.value.config={speedLevels:S,features:Z.value})}),ie(Z,S=>{r.value.platform==="fan"&&(r.value.config={speedLevels:J.value,features:S})},{deep:!0}),ie(Q,S=>{r.value.platform==="light"&&(r.value.config={features:S})},{deep:!0});function W(S){const n=new Set,O=Object.keys(S);return O.some(B=>B==="off"||B.includes("_off"))&&n.add("off"),O.some(B=>B.includes("auto"))&&n.add("auto"),O.some(B=>B.includes("cool"))&&n.add("cool"),O.some(B=>B.includes("heat"))&&n.add("heat"),O.some(B=>B.includes("dry"))&&n.add("dry"),O.some(B=>B.includes("fan_only"))&&n.add("fan_only"),Array.from(n)}function R(S){const n=new Set,O=Object.keys(S);return O.some(B=>B.includes("auto"))&&n.add("auto"),O.some(B=>B.includes("low"))&&n.add("low"),O.some(B=>B.includes("medium")||B.includes("mid"))&&n.add("medium"),O.some(B=>B.includes("high"))&&n.add("high"),Array.from(n)}function j(S){const n=new Set,O=Object.keys(S);return O.some(B=>B.includes("swing_off")||B.includes("_off"))&&n.add("off"),O.some(B=>B.includes("vertical"))&&n.add("vertical"),O.some(B=>B.includes("horizontal"))&&n.add("horizontal"),O.some(B=>B.includes("both"))&&n.add("both"),Array.from(n)}function ee(S){const n=new Set,O=Object.keys(S);return O.some(B=>B.includes("none"))&&n.add("none"),O.some(B=>B.includes("eco"))&&n.add("eco"),O.some(B=>B.includes("boost"))&&n.add("boost"),O.some(B=>B.includes("sleep"))&&n.add("sleep"),O.some(B=>B.includes("away"))&&n.add("away"),O.some(B=>B.includes("comfort"))&&n.add("comfort"),Array.from(n)}function ue(S){for(const n of Object.values(S))if(typeof n=="string"&&n.startsWith("sc")||Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0].startsWith("sc"))return"rf";return"ir"}ie(()=>r.value.commandType,(S,n)=>{!n||P.value||x.value||(Object.keys(r.value.commands).length>0&&S!==n?(U.value=S,r.value.commandType=n,P.value=!0):S!==n&&(T.value=S))}),ie(()=>u.editData,async S=>{var n,O,B;if(S&&u.editMode){console.log("ğŸ”§ Edit mode activated, loading profile data:",S),x.value=!0,g.value.length===0&&(console.log("ğŸ“¡ Loading Broadlink devices..."),await X(),console.log("ğŸ“¡ Devices loaded:",g.value.length));const se=S.profile,ae=se.controller_data;console.log("ğŸ® Controller data from profile:",ae),console.log("ğŸ® Available devices:",g.value.map(re=>re.entity_id));const ne=se.commands||{},oe=se.commandType||ue(ne);console.log("ğŸ” Command type (stored):",se.commandType),console.log("ğŸ” Command type (final):",oe);let ge={};if(S.platform==="climate"){const re=se.operationModes||W(ne),_e=se.fanModes||R(ne),Ue=se.swingModes||j(ne),E=se.presetModes||ee(ne);console.log("ğŸ” Inferred modes:",re),console.log("ğŸ” Inferred fan modes:",_e),console.log("ğŸ” Inferred swing modes:",Ue),console.log("ğŸ” Inferred preset modes:",E),ge={minTemp:se.minTemperature,maxTemp:se.maxTemperature,precision:se.precision,modes:re,fanModes:_e,swingModes:Ue,presetModes:E}}else if(S.platform==="media_player"){const re=[];(ne.on||ne.off)&&re.push("turn_on"),(ne.volumeUp||ne.volumeDown)&&re.push("volume"),ne.mute&&re.push("mute"),ne.sources&&re.push("source"),(ne.channelUp||ne.channelDown)&&re.push("channel"),ge={features:re},A.value=re,console.log("ğŸ” Inferred media player features:",re)}else if(S.platform==="fan"){const re=((n=se.speed)==null?void 0:n.length)||Object.keys(ne.default||{}).length||3,_e=[];(ne.oscillate_on||ne.oscillate_off)&&_e.push("oscillate"),(ne.direction_forward||ne.direction_reverse)&&_e.push("direction"),ge={speedLevels:re,features:_e},J.value=re,Z.value=_e,console.log("ğŸ” Inferred fan config:",ge)}else if(S.platform==="light"){const re=[];ge={features:re},Q.value=re,console.log("ğŸ” Inferred light features:",re)}const Oe=await c(se.manufacturer,(O=se.supportedModels)==null?void 0:O[0],ne);r.value={platform:S.platform,manufacturer:se.manufacturer||"",model:((B=se.supportedModels)==null?void 0:B[0])||"",broadlinkDevice:ae||"",commandType:oe,config:ge,commands:Oe},console.log("âœ… Profile populated:",r.value),console.log("âœ… Selected device:",r.value.broadlinkDevice),console.log("âœ… Command type:",r.value.commandType),console.log("âœ… Commands (with learned codes):",Oe),T.value=oe,setTimeout(()=>{x.value=!1},100)}},{immediate:!0});const De=K(()=>{var S;switch(i.value){case 0:return r.value.platform&&r.value.manufacturer&&r.value.model;case 1:return r.value.platform==="climate"?r.value.config.minTemp&&r.value.config.maxTemp&&((S=r.value.config.modes)==null?void 0:S.length)>0:!0;case 2:return r.value.broadlinkDevice&&r.value.commandType&&Object.keys(r.value.commands).length>0;case 3:return!0;default:return!1}}),we=y(null);async function Ae(){if(i.value!==3){we.value=null;return}if(console.log("ğŸ” Generating JSON with commands:",r.value.commands),Object.values(r.value.commands).some(n=>typeof n=="string"?n==="pending":typeof n=="object"?Object.values(n).some(O=>typeof O=="string"?O==="pending":typeof O=="object"?Object.values(O).some(B=>B==="pending"):!1):!1)){console.warn('âš ï¸ Commands still contain "pending" placeholders!'),console.log("ğŸ“¦ Attempting to fetch from Broadlink storage...");const n=await c(r.value.manufacturer,r.value.model,r.value.commands);r.value.commands=n,console.log("âœ… Updated commands:",n)}we.value=s(r.value),console.log("ğŸ“„ Generated JSON:",we.value)}const xe=K(()=>i.value!==3?null:F(r.value));function I(){r.value.config={},r.value.commands={}}function v(){P.value=!1,r.value.commandType=U.value,T.value=U.value,r.value.commands={},U.value=""}function V(){P.value=!1,U.value=""}async function pe(){i.value<o.length-1&&(i.value++,i.value===3&&await Ae())}function Ve(){i.value>0&&i.value--}function $e(){P.value||(N.value=!0)}function Ce(){N.value=!1,Te()}function Te(){w("close"),setTimeout(()=>{i.value=0,r.value={platform:"",manufacturer:"",model:"",broadlinkDevice:"",commandType:"ir",config:{},commands:{}},T.value="ir"},300)}async function Me(){var S,n,O,B,se,ae;p.value=!0;try{if(!h.value){const _e=(await te.get("/api/smartir/config/check")).data;if(_e&&!((S=_e.platforms[r.value.platform])==null?void 0:S.file_exists)){C.value=_e.configuration_warnings||[],L.value=_e.config_path||"/config",l.value={platform:r.value.platform,json:we.value},_.value=!0,p.value=!1;return}}let ne;u.editMode&&((n=u.editData)!=null&&n.code)?(ne=parseInt(u.editData.code),console.log("ğŸ“ Edit mode: Using existing code",ne)):(ne=(await te.get(`/api/smartir/platforms/${r.value.platform}/next-code`)).data.next_code,console.log("âœ¨ New profile: Using next code",ne));const ge=(await te.post("/api/smartir/profiles",{platform:r.value.platform,json:we.value,code_number:ne})).data,Oe={platform:"smartir",name:`${r.value.manufacturer} ${r.value.model}`,unique_id:`${r.value.manufacturer.toLowerCase().replace(/[^a-z0-9]+/g,"_")}_${r.value.model.toLowerCase().replace(/[^a-z0-9]+/g,"_")}`,device_code:ne,controller_data:r.value.broadlinkDevice};try{await te.post("/api/smartir/config/add-device",{platform:r.value.platform,device_config:{platform:"smartir",name:Oe.name,unique_id:Oe.unique_id,device_code:Oe.device_code,controller_data:Oe.controller_data}})}catch(re){console.error("Failed to add device to config:",re);const _e=((O=re.response)==null?void 0:O.data)||{};let Ue=_e.error||"Unknown error";_e.validation_errors&&_e.validation_errors.length>0&&(Ue=`Device configuration validation failed:
`+_e.validation_errors.map(E=>`  â€¢ ${E}`).join(`
`)),(B=k.value)==null||B.warning(`Profile saved but failed to add to config file:
${Ue}`,"âš ï¸ Partial Success")}w("save",{json:we.value,yaml:xe.value,profile:r.value,saved_to:ge.path}),(se=k.value)==null||se.success(`âœ… Profile saved to custom_codes/${r.value.platform}/${ge.filename}
âœ… Device added to smartir/${r.value.platform}.yaml
âœ… Profile visible in Broadlink Manager immediately

âš ï¸ Restart Home Assistant for SmartIR integration to use this profile`,"âœ… Profile Saved Successfully!"),Te()}catch(ne){console.error("Error saving profile:",ne),(ae=k.value)==null||ae.error(ne.message,"âŒ Error Saving Profile")}finally{p.value=!1}}async function Y(){h.value=!0,_.value=!1,l.value&&(await Me(),l.value=null)}function b(){var S,n;try{const O=JSON.stringify(we.value,null,2),B=new Blob([O],{type:"application/json"}),se=URL.createObjectURL(B),ae=document.createElement("a");ae.href=se;const ne=r.value.manufacturer.toLowerCase().replace(/\s+/g,"_"),oe=r.value.model.toLowerCase().replace(/\s+/g,"_");ae.download=`smartir_${r.value.platform}_${ne}_${oe}.json`,document.body.appendChild(ae),ae.click(),document.body.removeChild(ae),URL.revokeObjectURL(se),(S=k.value)==null||S.success("You can manually upload this file to your SmartIR codes directory.","âœ… Profile Downloaded")}catch(O){console.error("Error downloading profile:",O),(n=k.value)==null||n.error(O.message,"âŒ Error Downloading Profile")}}async function c(S,n,O){const B=S.toLowerCase().replace(/[^a-z0-9]+/g,"_"),se=n.toLowerCase().replace(/[^a-z0-9]+/g,"_"),ae=`${B}_${se}`;try{const ge=(await te.get("/api/commands/all")).data[ae]||{};console.log(`ğŸ” Fetching learned commands for device: ${ae}`),console.log("ğŸ“¦ Device commands from storage:",ge);const Oe={...O};for(const[re,_e]of Object.entries(Oe))if(_e==="pending"&&ge[re])Oe[re]=ge[re];else if(typeof _e=="object"){for(const[Ue,E]of Object.entries(_e))if(typeof E=="object")for(const[$,H]of Object.entries(E)){const z=`${re}_${Ue}_${$}`;H==="pending"&&ge[z]&&(Oe[re][Ue][$]=ge[z])}else if(E==="pending"){const $=`${re}_${Ue}`;ge[$]&&(Oe[re][Ue]=ge[$])}}return console.log("âœ… Merged commands:",Oe),Oe}catch(ne){return console.error("Error fetching learned commands:",ne),O}}function s(S){const n={manufacturer:S.manufacturer,supportedModels:[S.model],supportedController:"Broadlink",commandsEncoding:"Base64",commandType:S.commandType||"ir",commands:{}};return S.platform==="climate"&&(n.minTemperature=S.config.minTemp,n.maxTemperature=S.config.maxTemp,n.precision=S.config.precision||1,n.operationModes=S.config.modes||[],n.fanModes=S.config.fanModes&&S.config.fanModes.length>0?S.config.fanModes:["auto"],S.config.swingModes&&S.config.swingModes.length>0&&(n.swingModes=S.config.swingModes),S.config.presetModes&&S.config.presetModes.length>0&&(n.presetModes=S.config.presetModes),n.commands=S.commands),n}function F(S){let n=`# SmartIR ${S.platform} configuration
`;return n+=`# Generated by Broadlink Manager v2

`,S.platform==="climate"&&(n+=`climate:
`,n+=`  - platform: smartir
`,n+=`    name: ${S.manufacturer} ${S.model}
`,n+=`    unique_id: ${S.manufacturer.toLowerCase()}_${S.model.toLowerCase().replace(/\s+/g,"_")}
`,n+=`    device_code: 10000  # Change this to your custom code number
`,n+=`    controller_data: ${S.broadlinkDevice}
`,S.config.tempSensor&&(n+=`    temperature_sensor: ${S.config.tempSensor}
`),S.config.humiditySensor&&(n+=`    humidity_sensor: ${S.config.humiditySensor}
`),S.config.powerSensor&&(n+=`    power_sensor: ${S.config.powerSensor}
`)),n}async function X(){try{console.log("Fetching remote devices from /api/remote/devices...");const S=await te.get("/api/remote/devices");console.log("Loaded remote devices response:",S.data);const n=S.data.devices||[];console.log("Extracted devices array:",n),console.log("Device count:",n.length),g.value=n,console.log("broadlinkDevices.value set to:",g.value),console.log("Final device count:",g.value.length)}catch(S){console.error("Error loading remote devices:",S),g.value=[]}}return ie(()=>u.show,S=>{if(S){const n=Number.isInteger(u.startStep)?u.startStep:0;i.value=Math.min(Math.max(n,0),o.length-1)}}),ie(()=>u.startStep,S=>{if(u.show){const n=Number.isInteger(S)?S:0;i.value=Math.min(Math.max(n,0),o.length-1)}}),Ee(()=>{u.show&&X()}),(S,n)=>t.show?(a(),d("div",{key:0,class:"modal-overlay",onClick:$e},[e("div",{class:"modal-container",onClick:n[19]||(n[19]=me(()=>{},["stop"]))},[e("div",Pu,[e("h2",null,[n[22]||(n[22]=e("i",{class:"mdi mdi-file-document-edit"},null,-1)),D(" "+f(t.editMode?"Edit SmartIR Profile":"Create SmartIR Profile"),1)]),e("button",{onClick:Te,class:"close-button"},[...n[23]||(n[23]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Vu,[(a(),d(ve,null,be(o,(O,B)=>e("div",{key:B,class:G(["step",{active:i.value===B,completed:i.value>B}])},[e("div",Uu,[i.value>B?(a(),d("i",ju)):(a(),d("span",Fu,f(B+1),1))]),e("span",Nu,f(O.label),1)],2)),64))]),e("div",Bu,[i.value===0?(a(),d("div",Hu,[n[29]||(n[29]=e("h3",null,"Device Information",-1)),e("div",qu,[n[25]||(n[25]=e("label",null,"Platform Type *",-1)),q(e("select",{"onUpdate:modelValue":n[0]||(n[0]=O=>r.value.platform=O),onChange:I},[...n[24]||(n[24]=[qe('<option value="" data-v-7a8a11c9>Select platform...</option><option value="climate" data-v-7a8a11c9>ğŸŒ¡ï¸ Climate (AC, Heater, Heat Pump)</option><option value="media_player" data-v-7a8a11c9>ğŸ“º Media Player (TV, Receiver)</option><option value="fan" data-v-7a8a11c9>ğŸŒ€ Fan</option><option value="light" data-v-7a8a11c9>ğŸ’¡ Light (LED Strip, IR Light)</option>',5)])],544),[[Re,r.value.platform]])]),e("div",zu,[n[26]||(n[26]=e("label",null,"Manufacturer *",-1)),q(e("input",{"onUpdate:modelValue":n[1]||(n[1]=O=>r.value.manufacturer=O),type:"text",placeholder:"e.g., Daikin, LG, Samsung"},null,512),[[Pe,r.value.manufacturer]])]),e("div",Ju,[n[27]||(n[27]=e("label",null,"Model(s) *",-1)),q(e("input",{"onUpdate:modelValue":n[2]||(n[2]=O=>r.value.model=O),type:"text",placeholder:"e.g., FTXS35K, Multiple models"},null,512),[[Pe,r.value.model]]),n[28]||(n[28]=e("small",null,'Enter model number or "Multiple" if it works with many models',-1))])])):M("",!0),i.value===1?(a(),d("div",Wu,[r.value.platform==="climate"?(a(),Ne(cd,{key:0,modelValue:r.value.config,"onUpdate:modelValue":n[3]||(n[3]=O=>r.value.config=O)},null,8,["modelValue"])):r.value.platform==="media_player"?(a(),d("div",Gu,[n[36]||(n[36]=e("h3",null,"Media Player Configuration",-1)),n[37]||(n[37]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),D(" Configure the features your media player supports. You'll learn the IR commands in the next step. ")],-1)),e("div",Ku,[n[35]||(n[35]=e("h4",null,"Supported Features",-1)),e("div",Xu,[e("label",Yu,[q(e("input",{type:"checkbox",value:"turn_on","onUpdate:modelValue":n[4]||(n[4]=O=>A.value=O)},null,512),[[de,A.value]]),n[30]||(n[30]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),D(" Power On/Off ")],-1))]),e("label",Zu,[q(e("input",{type:"checkbox",value:"volume","onUpdate:modelValue":n[5]||(n[5]=O=>A.value=O)},null,512),[[de,A.value]]),n[31]||(n[31]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-volume-high"}),D(" Volume Control ")],-1))]),e("label",Qu,[q(e("input",{type:"checkbox",value:"mute","onUpdate:modelValue":n[6]||(n[6]=O=>A.value=O)},null,512),[[de,A.value]]),n[32]||(n[32]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-volume-mute"}),D(" Mute ")],-1))]),e("label",ec,[q(e("input",{type:"checkbox",value:"source","onUpdate:modelValue":n[7]||(n[7]=O=>A.value=O)},null,512),[[de,A.value]]),n[33]||(n[33]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-import"}),D(" Source Selection ")],-1))]),e("label",tc,[q(e("input",{type:"checkbox",value:"channel","onUpdate:modelValue":n[8]||(n[8]=O=>A.value=O)},null,512),[[de,A.value]]),n[34]||(n[34]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-numeric"}),D(" Channel Control ")],-1))])])])])):r.value.platform==="fan"?(a(),d("div",oc,[n[44]||(n[44]=e("h3",null,"Fan Configuration",-1)),n[45]||(n[45]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),D(" Configure the features your fan supports. You'll learn the IR commands in the next step. ")],-1)),e("div",lc,[n[40]||(n[40]=e("h4",null,"Fan Speed Levels",-1)),e("div",nc,[n[39]||(n[39]=e("label",null,"Number of Speed Levels *",-1)),q(e("select",{"onUpdate:modelValue":n[9]||(n[9]=O=>J.value=O)},[...n[38]||(n[38]=[e("option",{value:1},"1 Speed",-1),e("option",{value:2},"2 Speeds",-1),e("option",{value:3},"3 Speeds (Low/Med/High)",-1),e("option",{value:4},"4 Speeds",-1),e("option",{value:5},"5 Speeds",-1),e("option",{value:6},"6 Speeds",-1)])],512),[[Re,J.value,void 0,{number:!0}]])])]),e("div",sc,[n[43]||(n[43]=e("h4",null,"Additional Features",-1)),e("div",ac,[e("label",ic,[q(e("input",{type:"checkbox",value:"oscillate","onUpdate:modelValue":n[10]||(n[10]=O=>Z.value=O)},null,512),[[de,Z.value]]),n[41]||(n[41]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-sync"}),D(" Oscillation ")],-1))]),e("label",rc,[q(e("input",{type:"checkbox",value:"direction","onUpdate:modelValue":n[11]||(n[11]=O=>Z.value=O)},null,512),[[de,Z.value]]),n[42]||(n[42]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-rotate-3d-variant"}),D(" Direction (Forward/Reverse) ")],-1))])])])])):r.value.platform==="light"?(a(),d("div",dc,[n[51]||(n[51]=e("h3",null,"Light Configuration",-1)),n[52]||(n[52]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),D(" Configure the features your light supports. You'll learn the IR commands in the next step. ")],-1)),e("div",uc,[n[50]||(n[50]=e("h4",null,"Supported Features",-1)),e("div",cc,[e("label",mc,[q(e("input",{type:"checkbox",value:"turn_on","onUpdate:modelValue":n[12]||(n[12]=O=>Q.value=O)},null,512),[[de,Q.value]]),n[46]||(n[46]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),D(" Power On/Off ")],-1))]),e("label",vc,[q(e("input",{type:"checkbox",value:"brightness","onUpdate:modelValue":n[13]||(n[13]=O=>Q.value=O)},null,512),[[de,Q.value]]),n[47]||(n[47]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-brightness-6"}),D(" Brightness Control ")],-1))]),e("label",pc,[q(e("input",{type:"checkbox",value:"color_temp","onUpdate:modelValue":n[14]||(n[14]=O=>Q.value=O)},null,512),[[de,Q.value]]),n[48]||(n[48]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-thermometer"}),D(" Color Temperature ")],-1))]),e("label",fc,[q(e("input",{type:"checkbox",value:"rgb","onUpdate:modelValue":n[15]||(n[15]=O=>Q.value=O)},null,512),[[de,Q.value]]),n[49]||(n[49]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-palette"}),D(" RGB Color ")],-1))])])])])):M("",!0)])):M("",!0),i.value===2?(a(),d("div",gc,[fe(qd,{modelValue:r.value.commands,"onUpdate:modelValue":n[16]||(n[16]=O=>r.value.commands=O),platform:r.value.platform,config:r.value.config,broadlinkDevice:r.value.broadlinkDevice,"onUpdate:broadlinkDevice":n[17]||(n[17]=O=>r.value.broadlinkDevice=O),manufacturer:r.value.manufacturer,model:r.value.model,commandType:r.value.commandType,"onUpdate:commandType":n[18]||(n[18]=O=>r.value.commandType=O)},null,8,["modelValue","platform","config","broadlinkDevice","manufacturer","model","commandType"])])):M("",!0),i.value===3?(a(),d("div",yc,[fe(fu,{profile:r.value,"json-data":we.value,"yaml-config":xe.value},null,8,["profile","json-data","yaml-config"])])):M("",!0)]),e("div",bc,[i.value>0?(a(),d("button",{key:0,onClick:Ve,class:"btn-secondary"},[...n[53]||(n[53]=[e("i",{class:"mdi mdi-arrow-left"},null,-1),D(" Back ",-1)])])):M("",!0),n[57]||(n[57]=e("div",{class:"spacer"},null,-1)),e("button",{onClick:Te,class:"btn-text"}," Cancel "),i.value<o.length-1?(a(),d("button",{key:1,onClick:pe,class:"btn-primary",disabled:!De.value},[...n[54]||(n[54]=[D(" Next ",-1),e("i",{class:"mdi mdi-arrow-right"},null,-1)])],8,hc)):(a(),d("div",kc,[e("button",{onClick:Me,class:"btn-primary",disabled:p.value},[n[55]||(n[55]=e("i",{class:"mdi mdi-cloud-upload"},null,-1)),D(" "+f(p.value?"Saving...":"Save to SmartIR"),1)],8,wc),e("button",{onClick:b,class:"btn-secondary",disabled:p.value},[...n[56]||(n[56]=[e("i",{class:"mdi mdi-download"},null,-1),D(" Download JSON ",-1)])],8,$c)]))])]),fe(Ou,{show:_.value,platform:r.value.platform,warnings:C.value,"config-path":L.value,onClose:n[20]||(n[20]=O=>_.value=!1),onComplete:Y},null,8,["show","platform","warnings","config-path"]),fe(He,{isOpen:P.value,title:"Change Command Type?",message:"Changing the command type will clear all learned commands. Continue?",confirmText:"Continue",cancelText:"Cancel",dangerMode:!0,onConfirm:v,onCancel:V},null,8,["isOpen"]),fe(He,{isOpen:N.value,title:"Close Profile Builder?",message:"Are you sure you want to close? Your progress will be lost.",confirmText:"Close",cancelText:"Keep Editing",dangerMode:!0,onConfirm:Ce,onCancel:n[21]||(n[21]=O=>N.value=!1)},null,8,["isOpen"])])):M("",!0)}},_c=ke(Cc,[["__scopeId","data-v-7a8a11c9"]]),Sc={class:"dashboard"},Ic={key:1,class:"welcome-banner"},Dc={__name:"Dashboard",setup(t){const m=Ge(),u=Le("smartirEnabled"),{isMobile:w}=ot(),k=y(!1),i=y(!1),p=y(null),g=y(0),_=y(null),C=y(localStorage.getItem("welcome_banner_dismissed")==="true");function L(){C.value=!0,localStorage.setItem("welcome_banner_dismissed","true")}function h(){i.value=!1,p.value=null,g.value=0,k.value=!0}async function l({platform:U,profile:T,startStep:x}){g.value=Number.isInteger(x)?x:0;try{const o=await fetch(`api/smartir/platforms/${U}/profiles/${T.code}`);if(!o.ok)throw new Error("Failed to load profile");const r=await o.json();let A="";try{const J=await fetch(`api/smartir/config/get-device?platform=${U}&code=${T.code}`);J.ok?(A=(await J.json()).controller_data||"",console.log("âœ… Found controller_data from YAML:",A)):console.warn("âš ï¸ No YAML entry found for this profile (this is OK for profiles not yet added to config)")}catch(J){console.warn("âš ï¸ Could not fetch controller_data from config:",J)}i.value=!0,p.value={platform:U,code:T.code,profile:{...r.profile,controller_data:A}},k.value=!0}catch(o){console.error("Error loading profile for edit:",o),m.error("Failed to load profile for editing")}}function P(){k.value=!1,i.value=!1,p.value=null}async function N(U){console.log("Profile saved:",U),P(),_.value&&_.value.loadAllProfiles&&(await _.value.loadAllProfiles(),console.log("âœ… Profiles list refreshed"))}return(U,T)=>(a(),d("div",Sc,[Se(u)?(a(),Ne(da,{key:0})):M("",!0),!Se(w)&&!C.value?(a(),d("div",Ic,[e("button",{class:"dismiss-button",onClick:L,title:"Dismiss"},[...T[0]||(T[0]=[e("i",{class:"mdi mdi-close"},null,-1)])]),T[1]||(T[1]=qe('<div class="banner-content" data-v-12185d74><div class="banner-icon" data-v-12185d74><i class="mdi mdi-rocket-launch" data-v-12185d74></i></div><div class="banner-text" data-v-12185d74><h2 data-v-12185d74>Welcome to Broadlink Manager v2!</h2><p data-v-12185d74>Manage your IR/RF devices with a modern Vue 3 interface</p></div></div><div class="status-badges" data-v-12185d74><span class="badge success" data-v-12185d74><i class="mdi mdi-check-circle" data-v-12185d74></i> Vue 3 Ready </span><span class="badge warning" data-v-12185d74><i class="mdi mdi-beta" data-v-12185d74></i> Beta </span></div>',2))])):M("",!0),fe(la),Se(u)?(a(),Ne(ir,{key:2,ref_key:"smartirStatusCard",ref:_,onCreateProfile:h,onEditProfile:l},null,512)):M("",!0),fe(_c,{show:k.value,editMode:i.value,editData:p.value,startStep:g.value,onClose:P,onSave:N},null,8,["show","editMode","editData","startStep"])]))}},xc=ke(Dc,[["__scopeId","data-v-12185d74"]]),Tc={class:"toast-container"},Mc={class:"toast-content"},Rc={key:0,class:"toast-title"},Ec={class:"toast-message"},Ac={key:1,class:"toast-description"},Lc=["onClick","title"],Oc={__name:"Toast",setup(t,{expose:m}){const u=y([]);let w=0;function k(g){const _={success:"mdi-check-circle",error:"mdi-alert-circle",warning:"mdi-alert",info:"mdi-information"};return _[g]||_.info}function i({message:g,title:_,description:C,type:L="info",duration:h=5e3}){const l=w++,P={id:l,message:g,title:_,description:C,type:L};return u.value.push(P),h>0&&setTimeout(()=>{p(l)},h),l}function p(g){const _=u.value.findIndex(C=>C.id===g);_>-1&&u.value.splice(_,1)}return m({addToast:i,removeToast:p,show:i,success:(g,_)=>i({message:g,title:_,type:"success"}),error:(g,_)=>i({message:g,title:_,type:"error",duration:0}),warning:(g,_)=>i({message:g,title:_,type:"warning",duration:0}),info:(g,_)=>i({message:g,title:_,type:"info"})}),(g,_)=>(a(),Ne(it,{to:"body"},[e("div",Tc,[fe(gt,{name:"toast"},{default:tt(()=>[(a(!0),d(ve,null,be(u.value,C=>(a(),d("div",{key:C.id,class:G(["toast",[`toast-${C.type}`,{"toast-persistent":C.type==="error"||C.type==="warning"}]])},[e("i",{class:G(["mdi",k(C.type)])},null,2),e("div",Mc,[C.title?(a(),d("div",Rc,f(C.title),1)):M("",!0),e("div",Ec,f(C.message),1),C.description?(a(),d("div",Ac,f(C.description),1)):M("",!0)]),e("button",{onClick:L=>p(C.id),class:G(["toast-close",{"toast-close-prominent":C.type==="error"||C.type==="warning"}]),title:C.type==="error"||C.type==="warning"?"Click to dismiss":"Close"},[..._[0]||(_[0]=[e("i",{class:"mdi mdi-close"},null,-1)])],10,Lc)],2))),128))]),_:1})])]))}},Pc=ke(Oc,[["__scopeId","data-v-3948c088"]]),Vc="0.3.0-alpha.11",Uc={version:Vc},jc={id:"app",class:"app-container"},Fc={class:"app-header"},Nc={class:"header-content"},Bc={class:"header-right"},Hc=["title"],qc={class:"settings-menu-container"},zc={key:0,class:"settings-menu"},Jc=["title"],Wc={class:"toggle-content"},Gc={key:0,class:"not-installed-label"},Kc={key:0,href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"menu-item menu-link menu-subitem"},Xc=["disabled"],Yc=["disabled"],Zc=["disabled"],Qc={class:"app-main"},em={class:"app-footer"},tm={__name:"App",setup(t){const m=y(null),u=Uc.version,w=y("light"),k=y(null),i=y(!1),p=y(!1),g=y(!1),_=y(localStorage.getItem("smartir_enabled")!=="false"),C=K(()=>{var r;return((r=k.value)==null?void 0:r.installed)||!1}),L=K(()=>({light:"mdi mdi-weather-sunny",medium:"mdi mdi-weather-partly-cloudy",dark:"mdi mdi-weather-night"})[w.value]),h=K(()=>({light:"Switch to Medium Theme",medium:"Switch to Dark Theme",dark:"Switch to Light Theme"})[w.value]),l=()=>{const r=["light","medium","dark"],J=(r.indexOf(w.value)+1)%r.length;w.value=r[J],document.body.classList.remove("medium-mode","dark-mode"),w.value==="medium"?document.body.classList.add("medium-mode"):w.value==="dark"&&document.body.classList.add("dark-mode"),localStorage.setItem("theme",w.value)},P=async()=>{try{const r=await ut.getStatus();k.value=r,r.installed?console.log("âœ… SmartIR detected:",r.version):console.log("â„¹ï¸ SmartIR not detected")}catch(r){console.error("Error checking SmartIR:",r),k.value={installed:!1,error:r.message}}},N=async()=>{var r,A,J;p.value=!0;try{const Q=(await te.get("/api/diagnostics/markdown")).data.markdown;if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(Q),(r=m.value)==null||r.success("Diagnostic summary copied to clipboard!");else{const W=document.createElement("textarea");W.value=Q,W.style.position="fixed",W.style.left="-999999px",W.style.top="-999999px",document.body.appendChild(W),W.focus(),W.select();try{if(document.execCommand("copy"))(A=m.value)==null||A.success("Diagnostic summary copied to clipboard!");else throw new Error("execCommand failed")}finally{document.body.removeChild(W)}}i.value=!1}catch(Z){console.error("Error copying diagnostics:",Z),(J=m.value)==null||J.error("Failed to copy diagnostics: "+Z.message)}finally{p.value=!1}},U=async()=>{var r,A;p.value=!0;try{const J=await te.get("/api/diagnostics/download",{responseType:"blob"}),Z=window.URL.createObjectURL(new Blob([J.data])),Q=document.createElement("a");Q.href=Z;const W=J.headers["content-disposition"];let R="broadlink_manager_diagnostics.zip";if(W){const j=W.match(/filename="?(.+)"?/);j&&(R=j[1])}Q.setAttribute("download",R),document.body.appendChild(Q),Q.click(),Q.remove(),window.URL.revokeObjectURL(Z),(r=m.value)==null||r.success("Diagnostic bundle downloaded!"),i.value=!1}catch(J){console.error("Error downloading diagnostics:",J),(A=m.value)==null||A.error("Failed to download diagnostics")}finally{p.value=!1}},T=r=>{r.target.closest(".settings-menu-container")||(i.value=!1)};Ee(()=>{document.addEventListener("click",T)}),We(()=>{document.removeEventListener("click",T)});const x=()=>{C.value&&(_.value=!_.value,localStorage.setItem("smartir_enabled",_.value.toString()),window.location.reload())},o=async()=>{var r,A,J;g.value=!0;try{const Z=await te.post("/api/smartir/refresh-index");Z.data.success?(r=m.value)==null||r.success(`Updated to v${Z.data.version} (${Z.data.total_devices} devices)`,"âœ… Index Updated"):(A=m.value)==null||A.error(Z.data.error||"Unknown error","âŒ Update Failed")}catch(Z){console.error("Error updating SmartIR index:",Z),(J=m.value)==null||J.error("Failed to update device index","âŒ Update Error")}finally{g.value=!1,i.value=!1}};return Ee(async()=>{const r=localStorage.getItem("theme");r&&["light","medium","dark"].includes(r)?(w.value=r,r==="medium"?document.body.classList.add("medium-mode"):r==="dark"&&document.body.classList.add("dark-mode")):localStorage.getItem("darkMode")==="true"&&(w.value="dark",document.body.classList.add("dark-mode"),localStorage.setItem("theme","dark")),await P();const A=nt();A&&m.value&&(A.appContext.config.globalProperties.$toast=m.value),document.addEventListener("click",T)}),We(()=>{document.removeEventListener("click",T)}),Xe("smartirStatus",k),Xe("smartirEnabled",_),Xe("refreshSmartIR",P),Xe("toast",m),(r,A)=>(a(),d("div",jc,[e("header",Fc,[e("div",Nc,[A[13]||(A[13]=e("div",{class:"header-left"},[e("i",{class:"mdi mdi-remote"}),e("h1",null,"Broadlink Manager v2"),e("span",{class:"beta-badge"},"BETA")],-1)),e("div",Bc,[e("button",{onClick:l,class:"icon-button",title:h.value},[e("i",{class:G(L.value)},null,2)],8,Hc),e("div",qc,[e("button",{onClick:A[0]||(A[0]=J=>i.value=!i.value),class:"icon-button",title:"Settings"},[...A[2]||(A[2]=[e("i",{class:"mdi mdi-cog"},null,-1)])]),i.value?(a(),d("div",zc,[A[9]||(A[9]=e("div",{class:"menu-section-title"},"Integration Settings",-1)),e("div",{class:G(["menu-item toggle-item",{disabled:!C.value}]),onClick:A[1]||(A[1]=J=>C.value?x():null),title:C.value?"":"SmartIR is not installed"},[e("div",Wc,[A[3]||(A[3]=e("i",{class:"mdi mdi-air-conditioner"},null,-1)),A[4]||(A[4]=e("span",null,"SmartIR Integration",-1)),C.value?M("",!0):(a(),d("span",Gc,"(Not Installed)"))]),e("div",{class:G(["toggle-switch",{active:_.value&&C.value,disabled:!C.value}])},[...A[5]||(A[5]=[e("div",{class:"toggle-slider"},null,-1)])],2)],10,Jc),_.value?(a(),d("a",Kc,[...A[6]||(A[6]=[e("i",{class:"mdi mdi-github"},null,-1),e("span",null,"SmartIR on GitHub",-1)])])):M("",!0),_.value?(a(),d("button",{key:1,onClick:o,class:"menu-item menu-subitem",disabled:g.value},[e("i",{class:G(["mdi",g.value?"mdi-loading mdi-spin":"mdi-refresh"])},null,2),e("span",null,f(g.value?"Updating...":"Update Device Index"),1)],8,Xc)):M("",!0),A[10]||(A[10]=e("div",{class:"menu-divider"},null,-1)),A[11]||(A[11]=e("div",{class:"menu-section-title"},"Diagnostics",-1)),e("button",{onClick:N,class:"menu-item",disabled:p.value},[...A[7]||(A[7]=[e("i",{class:"mdi mdi-content-copy"},null,-1),e("span",null,"Copy Diagnostics",-1)])],8,Yc),e("button",{onClick:U,class:"menu-item",disabled:p.value},[...A[8]||(A[8]=[e("i",{class:"mdi mdi-download"},null,-1),e("span",null,"Download Diagnostics",-1)])],8,Zc),A[12]||(A[12]=qe('<div class="menu-divider" data-v-96564cf9></div><div class="menu-section-title" data-v-96564cf9>Help &amp; Support</div><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2#readme" target="_blank" class="menu-item menu-link" data-v-96564cf9><i class="mdi mdi-book-open-variant" data-v-96564cf9></i><span data-v-96564cf9>Documentation</span></a><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2/issues" target="_blank" class="menu-item menu-link" data-v-96564cf9><i class="mdi mdi-bug" data-v-96564cf9></i><span data-v-96564cf9>Report Issue</span></a><div class="menu-divider" data-v-96564cf9></div><div class="menu-section-title" data-v-96564cf9>Community</div><a href="https://community.home-assistant.io/t/broadlink-manager-modern-web-interface-for-broadlink-devices/938473" target="_blank" class="menu-item menu-link" data-v-96564cf9><i class="mdi mdi-forum" data-v-96564cf9></i><span data-v-96564cf9>HA Forum Discussion</span></a><a href="https://www.reddit.com/r/homeassistant/comments/1o1q3kf/release_broadlink_manager_addon_a_modern_web_ui/" target="_blank" class="menu-item menu-link" data-v-96564cf9><i class="mdi mdi-reddit" data-v-96564cf9></i><span data-v-96564cf9>Reddit Discussion</span></a><div class="menu-divider" data-v-96564cf9></div><div class="menu-section-title" data-v-96564cf9>Project</div><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2" target="_blank" class="menu-item menu-link" data-v-96564cf9><i class="mdi mdi-github" data-v-96564cf9></i><span data-v-96564cf9>GitHub Repository</span></a><a href="https://ko-fi.com/tonyperkins" target="_blank" class="menu-item menu-link menu-item-sponsor" data-v-96564cf9><i class="mdi mdi-coffee" data-v-96564cf9></i><span data-v-96564cf9>Support on Ko-fi</span></a>',12))])):M("",!0)])])])]),e("main",Qc,[fe(xc)]),e("footer",em,[e("p",null,"Broadlink Manager v"+f(Se(u))+" | Built with Vue "+f(yt),1)]),fe(Pc,{ref_key:"toastRef",ref:m},null,512)]))}},om=ke(tm,[["__scopeId","data-v-96564cf9"]]),ct=bt(om),lm=ht();ct.use(lm);ct.mount("#app");
