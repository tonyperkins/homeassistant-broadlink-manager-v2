import{g as et,r as g,o as Ae,a as Xe,b as rt,d as dt,c as K,e as n,f as l,h as e,i as R,n as G,u as _e,t as m,j as T,F as pe,k as $e,w as re,l as X,v as Le,m as me,p as he,q as He,s as Ge,T as tt,x as De,y as xe,z as je,A as ye,B as ot,C as ze,D as Pe,E as lt,G as Je,H as ut,I as ct,J as mt,K as qe,L as vt,M as pt}from"./vendor-DGiFqQ_g.js";(function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))w(h);new MutationObserver(h=>{for(const s of h)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&w(c)}).observe(document,{childList:!0,subtree:!0});function i(h){const s={};return h.integrity&&(s.integrity=h.integrity),h.referrerPolicy&&(s.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?s.credentials="include":h.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function w(h){if(h.ep)return;h.ep=!0;const s=i(h);fetch(h.href,s)}})();let Qe=!1;function Be(){const t=et(),u=t==null?void 0:t.appContext.config.globalProperties.$toast;return u||(Qe||(console.warn("Toast notification system not yet initialized - using console fallback"),Qe=!0),{success:i=>console.log("✓",i),error:i=>console.error("✗",i),warning:i=>console.warn("⚠",i),info:i=>console.info("ℹ",i)})}function Ye(){const t=g(!1),u=g(!1),i=g(!1),w=g(0),h=767,s=768,c=1023,f=1024,S=()=>{const C=window.innerWidth;w.value=C,t.value=C<=h,u.value=C>=s&&C<=c,i.value=C>=f};return Ae(()=>{S(),window.addEventListener("resize",S)}),Xe(()=>{window.removeEventListener("resize",S)}),{isMobile:t,isTablet:u,isDesktop:i,screenWidth:w,isMobileOrTablet:()=>t.value||u.value,isTabletOrDesktop:()=>u.value||i.value}}const Ze="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAHBUlEQVR4nOxZC1BTVxo+9+aNZI2LNsgjWR4hgoIiRVDBslKnIKPbx1jqTrtYoakat1a6dNsdd7t1X8XHyAbEhdUu1u2mXdbasqJbtsaMIqBBECiPBmqEICEBEx4xJLlJ7s6lw6rJDeQ2FzLM+M1kBs7/3+/83zn/Oee/51JRFAXzGbCvA/AWjwX4GvNeANWXnXffHQ4+K6/dYbHeD+IFhjRkb1wn9WPQbEQ4IF/tQlXX2p5+/8OyczY74j/VxuMG3Sh/Oz9jaQDb4CmPT1LIbLXBfzrz0cmHg8fQpx1Yc1Ra+TsiXD4R0PqtRmAyj/LxbJeaujKIcPlEAINOM7vLXBaTZibCRWgRq3WGJZWX63aoNDpB8BJOX/bGlIqwpUv6iXBgWBHG7eUF8urUWvU6Z9sLGxI/IsLl8SJu6u4XigqPXkVspiVTbTQqU1/6Vn7ammh+G5FOMZyqludIKqUVU/9jcaSuTCo/unfHbiad4iBdwMu/P1bV1tO1xbk9NDC0/vwHB1xGcjqYLAh16zsHW3R6XXTu1mfFdAqMrIoSKNbGhLcQ4QGeppDJ7ACtPcqNEI6tT9O3Vqm+tygqNMDjrU9Sef6tIYM2JjUuuXzfC5knCEXsBI8WMZUCAxiCrfhWyMZkMNzYXNHVpwmXXqp5j0Hz0/1m57a3PQ8VHx4JoNMASIl9shLPFsB5ooO7iDXhCY/dAcCvT/79LwC1s/K2bDnAXcQeJRqwMzzeRt/bua0gLChcDsCDNQNBkEU/qot7o6j0kzETQpuJ40ZnT6xSrUoNWhyseHVz2ikv4n4QA5FSArE5IFlTZ0r3XU1MWODib6NCl3a9dkhSYxgbjo4XLq8sL9j7Ip36YEwMRjMNQazMhf7+RgYNnuyo7bY6ArFaWKuXRX495wLwoLk39sO9RaVnM5OTP8zLSjtjsljpp6ovi6pqr706eE8XBwGUSqEy9Guihf/92TMZhetjI5rJCHwKpBRzZqsNYtKp6KD+Pvv1w5ILdzR3UvD8HA4YefOl7N25JKUPIKuUwIJH7A5of/GJf7oLfrIz2EH786fSss+uKFzOk+8L0mqh6rpbmR0q5YyFGAQBSuHHlcUWxEaZyXfMhFD0Rgt9Oh/SBMiam58HAO+oc4XZMsK/1taT6M6uHjJw8w6VSNfvemM8TbzPlFlwsP5KyzfJeL6kCejXDgo894aASqOZ9O/uHwzq6B3ijhitkzOC7XS7j0g+V3S0vQTDDhYEoZSBobvJ+yXFNZ29gy4lOGmvlDBMIfQqSKV8539EWvXHhvbGHBSFrAwGW+vvxzLoR7RxzrNpsyPs0xcv7/lg1/ZfPtKvuw7MVhulUakWdvRq+XY3tWFT90Bk+52BCOzvyOBgjytSFKAgms+b9F/2o+BbKwUrvgjhhjSjKLAPG4YE7lJxfEIf5dyGOwMXrren/eF0RYXRNMrHDt4QbmjDEbHop9F8rqpddZd3sV6R/aWiabtWr41PW534V8m+PFHW+qSPL9TX7oM8WAaBi4IbE4S8yYNs/7asIgBA0ZStRqFM/MXxIzcgHBEBP+C6DJKLgJvK3uXvniitBsDmNzkSEAD9uv5k0aFjXy1gMQ0DQ5p4CAIwNuXLwyL/ExcpqMWeS42NUmxKXFf8VWPdz6cLnkqhGd/Pe+U1Cow/+ekJUYr4qJgvbik7f/Jw+0J/tjpvS3qxs7/LQZZfcrrkUmOdGI/cgUKIkB8pz0xK+CQjKf6z4MWckYftZqsderfsTInsZt0evDRgMRYMHhaLnk+NW1Y/nchxk5lZ+I/Pf/vl9RvbLYiVlSBcJv/VK9sKBCHc3hkF7D12/NzVltZn8YhzNj/3ev6LGeXTdQ6+uzLZ+C+5XNza05Nsd1gXcNgBvekJK/+du3lTUSiXMzzT80TgkkK8wJAGgCMAE5ooFFz3hHTr+lgZ9iMryOngkoi5WZuOc9hPtDu3r4198nTqygjCr3wYmrvVkSerZXljJoT0m0DcYm5g2Mg5WV39zrVWZZofkzaRnhB/bufm9FI/JpXQXj8F8bHyitqWxhzJmwUJT60SNJER+P+BCZjt34lzNbvickRoWVWNmGzuObnYWhER3oAdX41dPbj1jDeYEwGrInltKKCNtatub6hRfJOEnfJkcc+JgE9ltS/DkINuNI3xCo4fbXgm/0CnouvOcjK4Z/16/ZKia+3+kqIrEIQ+sgNx2Jzb5wsPxrD9GBZv+Gd9BqSXr4icg8cwMj4SLmv6+mlv+WddgGlilOPOZkEmFnrLP+sCVgtXyPHaHShkiw0XXPWWf9YF5Gb9uGzp4sCbj7ai4LkNTx2O5nPV3vLPyTeye6P32X+7KNujVKtSYJg+viEu/mx2etJZCgnD57OPfGRh3n8nfizA15j3Av4XAAD//5k1S2w3zfwVAAAAAElFTkSuQmCC",ne=rt.create({baseURL:"./",timeout:3e4,headers:{"Content-Type":"application/json"}});ne.interceptors.request.use(t=>t,t=>Promise.reject(t));ne.interceptors.response.use(t=>t,t=>(console.error("API Error:",t),t.response?console.error("Response error:",t.response.data):t.request?console.error("No response received"):console.error("Request setup error:",t.message),Promise.reject(t)));const ft=dt("devices",{state:()=>({devices:[],loading:!1,error:null,selectedDevice:null}),getters:{deviceById:t=>u=>t.devices.find(i=>i.id===u),devicesByType:t=>u=>t.devices.filter(i=>i.entity_type===u),deviceCount:t=>t.devices.length,hasDevices:t=>t.devices.length>0},actions:{async loadDevices(t=!1){this.loading=!0,this.error=null;try{const u=t?`/api/devices/managed?_t=${Date.now()}`:"/api/devices/managed",i=await ne.get(u);this.devices=i.data.devices||[],console.log("📥 Loaded devices:",this.devices),this.devices.forEach(w=>{console.log(`📥 Device "${w.name}":`,{id:w.id,device:w.device,commands:w.commands,commandCount:w.commands?Object.keys(w.commands).length:0})})}catch(u){this.error=u.message,console.error("Error loading devices:",u)}finally{this.loading=!1}},async createDevice(t){this.loading=!0,this.error=null;try{console.log("🏪 Store: Creating device with data:",t),console.log("🏪 Store: Device commands being sent:",t.commands);const u={device_name:t.name,device:t.device,area_id:t.area||"",area_name:t.area||"",entity_type:t.entity_type,icon:t.icon,broadlink_entity:t.broadlink_entity,device_type:t.device_type||"broadlink",commands:t.commands||{}};t.device_type==="smartir"&&t.smartir_config&&(u.smartir_config=t.smartir_config),console.log("🏪 Store: Transformed data for backend:",u);const i=await ne.post("/api/devices/managed",u);return console.log("🏪 Store: Create response:",i.data),await this.loadDevices(),i.data}catch(u){throw console.error("Error creating device:",u),u}finally{this.loading=!1}},async updateDevice(t,u){this.loading=!0,this.error=null;try{const i=await ne.put(`/api/devices/managed/${t}`,u);return await this.loadDevices(),i.data}catch(i){throw console.error("Error updating device:",i),i}finally{this.loading=!1}},async deleteDevice(t,u=!1){this.loading=!0,this.error=null;try{await ne.delete(`/api/devices/managed/${t}`,{data:{delete_commands:u}}),this.devices=this.devices.filter(i=>i.id!==t)}catch(i){throw this.error=i.message,console.error("Error deleting device:",i),i}finally{this.loading=!1}},selectDevice(t){this.selectedDevice=t},clearSelection(){this.selectedDevice=null},clearError(){this.error=null},updateDeviceCommands(t,u){const i=this.devices.findIndex(w=>w.id===t);if(i!==-1){const w={...this.devices[i],commands:u};this.devices.splice(i,1,w),console.log(`✅ Store: Updated commands for ${t}, count: ${Object.keys(u).length}`)}else console.warn(`⚠️ Store: Device ${t} not found for command update`)},async syncAllAreas(){if(!this.devices||this.devices.length===0){console.log("⚠️ No devices to sync");return}console.log(`🔄 Syncing areas from Home Assistant for ${this.devices.length} devices...`);try{const t=await Promise.all(this.devices.map(w=>(console.log(`🔄 Syncing device: ${w.id} (${w.name})`),ne.post(`/api/devices/${w.id}/sync-area`).then(h=>h.data.success&&h.data.area?(console.log(`✅ Synced area for ${w.name}: ${h.data.area}`),{status:"synced",device:w.name}):{status:"no_area"}).catch(h=>{var s;return((s=h.response)==null?void 0:s.status)===404?(console.log(`❌ Device not found in HA: ${w.id}`),{status:"not_found"}):(console.warn(`⚠️ Failed to sync area for ${w.id}:`,h.message),{status:"error",error:h.message})})))),u=t.filter(w=>w.status==="synced").length,i=t.filter(w=>w.status==="not_found").length;await this.loadDevices(!0),u>0?console.log(`✅ Area sync complete: ${u} synced, ${i} not found in HA`):i>0&&console.log(`ℹ️ No areas synced - ${i} entities not found in HA registry (generate entities first)`)}catch(t){console.debug("Area sync error:",t)}}}});function nt(t){const u=K(()=>t.value||t),i=K(()=>{switch(u.value){case"climate":return"mdi:air-conditioner";case"fan":return"mdi:fan";case"light":return"mdi:lightbulb";case"media_player":return"mdi:television";case"switch":return"mdi:light-switch";default:return"mdi:devices"}}),w=K(()=>`device-type-${u.value}-color`),h=K(()=>`tag-${u.value}-bg`);return{icon:i,colorClass:w,tagBgClass:h}}const gt=""+new URL("broadlink-logo-BDjImjRY.png",import.meta.url).href,Ce=(t,u)=>{const i=t.__vccOpts||t;for(const[w,h]of u)i[w]=h;return i},yt={class:"device-header"},bt={class:"device-info"},ht=["title"],kt={class:"device-labels"},wt={class:"device-type"},$t=["src","alt","title"],Ct={class:"device-body"},_t={class:"device-stats"},St={class:"stat",title:"Learned command count"},It={class:"stat",title:"HA Assigned Area"},Dt={class:"device-meta"},Tt={class:"device-id",title:"Device ID"},xt={key:0,class:"storage-name"},Mt={key:1,class:"broadlink-entity",title:"Controller Device"},Rt={key:2,class:"controller-device"},Lt={class:"device-actions"},At=["disabled"],Ot=["disabled"],Et=["disabled"],Vt={key:0,class:"disabled-overlay"},Pt={__name:"DeviceCard",props:{device:{type:Object,required:!0},broadlinkDevices:{type:Array,default:()=>[]}},emits:["edit","delete","learn"],setup(t){const u=t,i=K(()=>localStorage.getItem("smartir_simulate_not_installed")==="true"),w=K(()=>u.device.device_type==="smartir"&&i.value),h=g(null),s=nt(K(()=>u.device.entity_type)),c=K(()=>u.device.icon?u.device.icon:s.icon.value),f=a=>a&&a.startsWith("mdi:")?`mdi ${a.replace(":"," mdi-")}`:`mdi mdi-${a}`,S=K(()=>({light:"Light",fan:"Fan",switch:"Switch",media_player:"Media Player",cover:"Cover"})[u.device.entity_type]||u.device.entity_type),C=K(()=>(u.device.device_type||"broadlink")==="smartir"?"SmartIR":"Broadlink"),O=K(()=>(u.device.device_type||"broadlink")==="smartir"?Ze:gt),$=K(()=>(u.device.device_type||"broadlink")==="smartir"?h.value!==null?h.value:0:Object.keys(u.device.commands||{}).length),o=a=>{if(!a)return"";const b=u.broadlinkDevices.find(p=>p.entity_id===a);return b&&b.name||a},x=K(()=>{if(!u.device.device)return!1;const a=u.device.id.includes(".")?u.device.id.split(".")[1]:u.device.id;return u.device.device!==a}),q=K(()=>{if(!u.device.broadlink_entity)return"";const a=u.broadlinkDevices.find(b=>b.entity_id===u.device.broadlink_entity);return a&&a.name||u.device.broadlink_entity}),U=a=>{if(!a||typeof a!="object")return 0;let b=0;for(const p of Object.values(a))typeof p=="string"?b++:typeof p=="object"&&(b+=U(p));return b},I=async()=>{if(!(!u.device.device_code||!u.device.entity_type))try{const a=await ne.get("/api/smartir/codes/code",{params:{entity_type:u.device.entity_type,code_id:u.device.device_code}});if(a.data.success&&a.data.code){const b=a.data.code;b.commands&&(h.value=U(b.commands))}}catch(a){console.error("Error fetching SmartIR command count:",a)}};return Ae(async()=>{(u.device.device_type||"broadlink")==="smartir"&&await I()}),(a,b)=>(l(),n("div",{class:G(["device-card",{disabled:w.value}])},[e("div",yt,[e("div",{class:G(["device-icon",_e(s).colorClass.value])},[e("i",{class:G(f(c.value))},null,2)],2),e("div",bt,[e("h3",{title:t.device.name},m(t.device.name),9,ht),e("div",kt,[e("span",wt,m(S.value),1)])]),e("img",{src:O.value,alt:C.value,title:C.value,class:"device-source-logo"},null,8,$t)]),e("div",Ct,[e("div",_t,[e("div",St,[b[3]||(b[3]=e("i",{class:"mdi mdi-remote"},null,-1)),e("span",null,m($.value)+" command"+m($.value!==1?"s":""),1)]),e("div",It,[b[4]||(b[4]=e("i",{class:"mdi mdi-map-marker"},null,-1)),e("span",null,m(t.device.area||"No area"),1)])]),e("div",Dt,[e("span",Tt,[b[5]||(b[5]=e("i",{class:"mdi mdi-identifier"},null,-1)),T(" "+m(t.device.id),1)]),x.value?(l(),n("span",xt,[b[6]||(b[6]=e("i",{class:"mdi mdi-code-tags"},null,-1)),T(" "+m(t.device.device),1)])):R("",!0),t.device.broadlink_entity?(l(),n("span",Mt,[b[7]||(b[7]=e("i",{class:"mdi mdi-access-point"},null,-1)),T(" "+m(q.value),1)])):R("",!0),t.device.controller_device?(l(),n("span",Rt,[b[8]||(b[8]=e("i",{class:"mdi mdi-access-point"},null,-1)),T(" "+m(o(t.device.controller_device)),1)])):R("",!0)])]),e("div",Lt,[e("button",{onClick:b[0]||(b[0]=p=>!w.value&&a.$emit("learn",t.device)),class:"icon-btn",title:"Manage Commands",disabled:w.value},[...b[9]||(b[9]=[e("i",{class:"mdi mdi-remote-tv"},null,-1)])],8,At),e("button",{onClick:b[1]||(b[1]=p=>!w.value&&a.$emit("edit",t.device)),class:"icon-btn",title:"Edit",disabled:w.value},[...b[10]||(b[10]=[e("i",{class:"mdi mdi-pencil"},null,-1)])],8,Ot),e("button",{onClick:b[2]||(b[2]=p=>!w.value&&a.$emit("delete",t.device)),class:"icon-btn danger",title:"Delete",disabled:w.value},[...b[11]||(b[11]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,Et)]),w.value?(l(),n("div",Vt,[...b[12]||(b[12]=[e("div",{class:"disabled-message"},[e("i",{class:"mdi mdi-eye-off"}),e("span",null,"SmartIR Not Installed")],-1)])])):R("",!0)],2))}},Ut=Ce(Pt,[["__scopeId","data-v-7a7f5c18"]]),Ft={name:"DeviceListView",props:{devices:{type:Array,required:!0}},methods:{getDeviceCommands(t){return t.commands&&typeof t.commands=="object"?Object.keys(t.commands):[]},getCommandType(t,u){return t.commands&&t.commands[u]&&t.commands[u].type||"ir"},getCommandTypeClass(t,u){return this.getCommandType(t,u)==="rf"?"command-rf":"command-ir"},getCommandTypeLabel(t,u){return this.getCommandType(t,u)==="rf"?"RF Command":"IR Command"},sendCommand(t,u){this.$emit("send-command",{device:t,command:u})},editDevice(t){this.$emit("edit-device",t)},deleteDevice(t){this.$emit("delete-device",t)}}},jt={class:"device-list-view"},Nt={class:"device-table"},Bt={class:"device-info"},Ht={class:"device-name"},qt={class:"device-entity"},zt={class:"device-area"},Jt={class:"device-type"},Wt={class:"device-commands"},Kt={key:0,class:"command-list"},Xt=["onClick","title"],Gt={key:0,class:"no-commands"},Yt={key:1,class:"smartir-info"},Zt={class:"profile-code"},Qt={class:"device-actions"},eo=["onClick"],to=["onClick"];function oo(t,u,i,w,h,s){return l(),n("div",jt,[e("table",Nt,[u[2]||(u[2]=e("thead",null,[e("tr",null,[e("th",null,"Device"),e("th",null,"Room/Area"),e("th",null,"Type"),e("th",null,"Commands"),e("th",null,"Actions")])],-1)),e("tbody",null,[(l(!0),n(pe,null,$e(i.devices,c=>(l(),n("tr",{key:c.entity_id,class:"device-row"},[e("td",Bt,[e("div",Ht,m(c.friendly_name||c.name),1),e("div",qt,m(c.entity_id),1)]),e("td",zt,m(c.area||"No Area"),1),e("td",Jt,[e("span",{class:G(["type-badge",c.device_type||"broadlink"])},m(c.device_type==="smartir"?"SmartIR":"Broadlink"),3)]),e("td",Wt,[(c.device_type||"broadlink")==="broadlink"?(l(),n("div",Kt,[(l(!0),n(pe,null,$e(s.getDeviceCommands(c),f=>(l(),n("button",{key:f,class:G(["command-btn",s.getCommandTypeClass(c,f)]),onClick:S=>s.sendCommand(c,f),title:s.getCommandTypeLabel(c,f)},m(f),11,Xt))),128)),s.getDeviceCommands(c).length===0?(l(),n("span",Gt," No commands ")):R("",!0)])):c.device_type==="smartir"?(l(),n("div",Yt,[e("span",Zt,"Profile: "+m(c.device_code),1)])):R("",!0)]),e("td",Qt,[e("button",{class:"action-btn edit",onClick:f=>s.editDevice(c),title:"Edit"},[...u[0]||(u[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})],-1)])],8,eo),e("button",{class:"action-btn delete",onClick:f=>s.deleteDevice(c),title:"Delete"},[...u[1]||(u[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"3 6 5 6 21 6"}),e("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})],-1)])],8,to)])]))),128))])])])}const lo=Ce(Ft,[["render",oo],["__scopeId","data-v-f67eb139"]]),no={class:"icon-picker"},so={class:"icon-input-wrapper"},ao=["id","placeholder"],io={key:0,class:"icon-preview"},ro={key:0,class:"icon-dropdown"},uo={class:"icon-grid"},co=["onMousedown","title"],mo={__name:"IconPicker",props:{modelValue:{type:String,default:""},inputId:{type:String,default:"icon-input"},placeholder:{type:String,default:"e.g., mdi:television"}},emits:["update:modelValue"],setup(t,{emit:u}){const i=t,w=u,h=g(i.modelValue),s=g(!1),c=["television","speaker","radio","music","video","movie","play","pause","stop","skip-next","skip-previous","volume-high","volume-medium","volume-low","volume-off","remote","remote-tv","cast","chromecast","spotify","netflix","youtube","lightbulb","lightbulb-on","lightbulb-off","lamp","floor-lamp","ceiling-light","light-switch","led-strip","led-strip-variant","wall-sconce","chandelier","spotlight","track-light","vanity-light","desk-lamp","fan","ceiling-fan","air-conditioner","thermometer","thermostat","heat-wave","snowflake","fire","radiator","water-boiler","hvac","blinds","blinds-open","window-shutter","window-shutter-open","curtains","curtains-closed","roller-shade","roller-shade-closed","garage","garage-open","gate","door","door-open","window-open","window-closed","washing-machine","tumble-dryer","dishwasher","refrigerator","stove","microwave","oven","toaster","kettle","coffee","coffee-maker","blender","robot-vacuum","robot-vacuum-variant","vacuum","broom","spray-bottle","lock","lock-open","lock-smart","key","shield","shield-check","alarm-light","bell","doorbell","camera","cctv","motion-sensor","smoke-detector","fire-extinguisher","water-alert","gas-cylinder","sofa","bed","bed-double","desk","chair","table","bookshelf","home","home-outline","home-assistant","floor-plan","room","weather-sunny","weather-night","weather-cloudy","weather-rainy","weather-snowy","weather-lightning","weather-windy","weather-fog","weather-partly-cloudy","umbrella","water","water-percent","phone","cellphone","tablet","laptop","desktop-tower","monitor","keyboard","mouse","printer","router","router-wireless","access-point","wifi","bluetooth","usb","hdmi-port","ethernet","power","power-plug","power-socket","battery","battery-charging","lightning-bolt","flash","solar-panel","solar-power","leaf","tree","flower","sprout","grass","watering-can","shovel","fence","pool","hot-tub","silverware","silverware-fork-knife","food","food-apple","glass-wine","glass-cocktail","bottle-wine","pot","pot-steam","shower","shower-head","bathtub","toilet","sink","faucet","hand-wash","car","car-side","garage-variant","tools","hammer","wrench","screwdriver","toolbox","ladder","heart","heart-pulse","run","walk","bike","dumbbell","yoga","scale-bathroom","thermometer-lines","clock","clock-outline","timer","alarm","calendar","calendar-today","calendar-clock","history","bell-ring","bell-alert","alert","alert-circle","information","help-circle","check","check-circle","close-circle","minus-circle","plus-circle","arrow-up","arrow-down","arrow-left","arrow-right","chevron-up","chevron-down","menu","dots-vertical","dots-horizontal","cog","tune","circle","square","triangle","hexagon","star","star-outline","heart-outline","plus","minus","close","check-bold","eye","eye-off","account","account-group","baby","dog","cat","paw","gift","balloon","party-popper","candle","book","book-open","newspaper","email","message","phone-classic"];re(()=>i.modelValue,$=>{h.value=$});const f=K(()=>{if(!h.value)return c.slice(0,50);const $=h.value.toLowerCase().replace("mdi:","");return c.filter(o=>o.toLowerCase().includes($)).slice(0,50)}),S=()=>{s.value=!0,w("update:modelValue",h.value)},C=()=>{setTimeout(()=>{s.value=!1},200)},O=$=>{h.value=`mdi:${$}`,w("update:modelValue",h.value),s.value=!1};return($,o)=>(l(),n("div",no,[e("div",so,[X(e("input",{id:t.inputId,"onUpdate:modelValue":o[0]||(o[0]=x=>h.value=x),type:"text",placeholder:t.placeholder,onInput:S,onFocus:o[1]||(o[1]=x=>s.value=!0),onBlur:C},null,40,ao),[[Le,h.value]]),h.value?(l(),n("div",io,[e("i",{class:G(`mdi mdi-${h.value.replace("mdi:","")}`)},null,2)])):R("",!0)]),s.value&&f.value.length>0?(l(),n("div",ro,[e("div",uo,[(l(!0),n(pe,null,$e(f.value,x=>(l(),n("div",{key:x,class:"icon-option",onMousedown:me(q=>O(x),["prevent"]),title:x},[e("i",{class:G(`mdi mdi-${x}`)},null,2),e("span",null,m(x),1)],40,co))),128))])])):R("",!0)]))}},vo=Ce(mo,[["__scopeId","data-v-a64f5011"]]),po={key:0,class:"dropdown-label"},fo={key:0,class:"required"},go=["placeholder","disabled","onKeydown"],yo={class:"dropdown-icons"},bo={key:0,class:"mdi mdi-loading mdi-spin"},ho={key:2,class:"mdi mdi-chevron-down"},ko={key:1,class:"error-message"},wo={key:2,class:"hint-message"},$o={key:0,class:"dropdown-menu"},Co=["onMousedown","onMouseenter"],_o={class:"option-content"},So={class:"option-label"},Io={key:0,class:"option-description"},Do={key:0,class:"mdi mdi-check selected-icon"},To={key:3,class:"dropdown-menu"},xo={__name:"SearchableDropdown",props:{modelValue:{type:[String,Number,Object],default:null},options:{type:Array,required:!0,default:()=>[]},label:{type:String,default:""},placeholder:{type:String,default:"Search..."},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},error:{type:String,default:""},hint:{type:String,default:""},optionLabel:{type:String,default:"label"},optionValue:{type:String,default:"value"},optionDescription:{type:String,default:"description"},filterMethod:{type:Function,default:null}},emits:["update:modelValue","change","search"],setup(t,{emit:u}){const i=t,w=u,h=g(null),s=g(null),c=g(""),f=g(!1),S=g(0),C=g(!1),O=A=>typeof A=="string"||typeof A=="number"?A:A[i.optionLabel]||A.label||A.name||String(A),$=A=>typeof A=="string"||typeof A=="number"?A:A[i.optionValue]||A.value||A.id||A,o=A=>typeof A=="string"||typeof A=="number"?"":A[i.optionDescription]||A.description||"",x=A=>{const N=$(A);return typeof i.modelValue=="object"?$(i.modelValue)===N:i.modelValue===N},q=K(()=>{if(!c.value)return i.options;if(i.filterMethod)return i.options.filter(N=>i.filterMethod(N,c.value));const A=c.value.toLowerCase();return i.options.filter(N=>{const oe=O(N).toLowerCase(),ue=o(N).toLowerCase();return oe.includes(A)||ue.includes(A)})}),U=K(()=>{if(!i.modelValue)return"";const A=i.options.find(N=>{const oe=$(N);return typeof i.modelValue=="object"?oe===$(i.modelValue):oe===i.modelValue});return A?O(A):""});re(()=>i.modelValue,A=>{C.value||(c.value=U.value)}),re(()=>i.options,()=>{!C.value&&i.modelValue&&(c.value=U.value)},{deep:!0}),re(c,A=>{w("search",A),S.value=0}),Ae(()=>{c.value=U.value});const I=()=>{var A;C.value=!0,f.value=!0,(A=s.value)==null||A.select()},a=()=>{C.value=!1,setTimeout(()=>{f.value=!1,i.modelValue?c.value=U.value:c.value=""},200)},b=()=>{var A;f.value=!1,(A=s.value)==null||A.blur()},p=A=>{const N=$(A);w("update:modelValue",N),w("change",N,A),c.value=O(A),b()},L=()=>{var A;w("update:modelValue",null),w("change",null,null),c.value="",(A=s.value)==null||A.focus()},J=()=>{if(!f.value){f.value=!0;return}S.value<q.value.length-1&&S.value++},Z=()=>{S.value>0&&S.value--},B=()=>{q.value.length>0&&S.value>=0&&p(q.value[S.value])},ae=A=>{h.value&&!h.value.contains(A.target)&&(f.value=!1,i.modelValue?c.value=U.value:c.value="")};return Ae(()=>{document.addEventListener("click",ae)}),Xe(()=>{document.removeEventListener("click",ae)}),(A,N)=>(l(),n("div",{class:"searchable-dropdown",ref_key:"dropdownRef",ref:h},[t.label?(l(),n("label",po,[T(m(t.label)+" ",1),t.required?(l(),n("span",fo,"*")):R("",!0)])):R("",!0),e("div",{class:G(["dropdown-input-wrapper",{"has-error":t.error,disabled:t.disabled}])},[X(e("input",{ref_key:"inputRef",ref:s,type:"text","onUpdate:modelValue":N[0]||(N[0]=oe=>c.value=oe),placeholder:t.placeholder,disabled:t.disabled||t.loading,onFocus:I,onBlur:a,onKeydown:[He(me(J,["prevent"]),["down"]),He(me(Z,["prevent"]),["up"]),He(me(B,["prevent"]),["enter"]),He(b,["escape"])],class:"dropdown-input"},null,40,go),[[Le,c.value]]),e("div",yo,[t.loading?(l(),n("i",bo)):t.modelValue&&!t.disabled?(l(),n("i",{key:1,class:"mdi mdi-close-circle clear-icon",onClick:L})):(l(),n("i",ho))])],2),t.error?(l(),n("div",ko,m(t.error),1)):R("",!0),t.hint&&!t.error?(l(),n("div",wo,m(t.hint),1)):R("",!0),he(tt,{name:"dropdown"},{default:Ge(()=>[f.value&&q.value.length>0?(l(),n("div",$o,[(l(!0),n(pe,null,$e(q.value,(oe,ue)=>(l(),n("div",{key:$(oe),class:G(["dropdown-item",{highlighted:ue===S.value,selected:x(oe)}]),onMousedown:me(ke=>p(oe),["prevent"]),onMouseenter:ke=>S.value=ue},[e("div",_o,[e("div",So,m(O(oe)),1),o(oe)?(l(),n("div",Io,m(o(oe)),1)):R("",!0)]),x(oe)?(l(),n("i",Do)):R("",!0)],42,Co))),128))])):R("",!0)]),_:1}),f.value&&q.value.length===0&&!t.loading?(l(),n("div",To,[...N[1]||(N[1]=[e("div",{class:"dropdown-item no-results"},[e("i",{class:"mdi mdi-magnify"}),T(" No results found ")],-1)])])):R("",!0)],512))}},We=Ce(xo,[["__scopeId","data-v-679ce35f"]]),Mo={class:"smartir-selector"},Ro={class:"form-group"},Lo={class:"form-group"},Ao={class:"form-group"},Oo=["value"],Eo={key:0,class:"error-message"},Vo={class:"form-group"},Po={class:"form-group"},Uo={key:1,class:"code-info"},Fo={class:"info-content"},jo={class:"info-row"},No={class:"info-value"},Bo={class:"info-row"},Ho={class:"info-value"},qo={key:0,class:"info-row"},zo={class:"info-value"},Jo={class:"info-row"},Wo={class:"info-value"},Ko={__name:"SmartIRDeviceSelector",props:{entityType:{type:String,required:!0},modelValue:{type:Object,default:()=>({})},broadlinkDevices:{type:Array,default:()=>[]}},emits:["update:modelValue","change"],setup(t,{expose:u,emit:i}){const w=t,h=i,s=g([]),c=g([]),f=g(""),S=g(""),C=g(""),O=g(""),$=g(""),o=g(null),x=g(!1),q=g(!1),U=g({manufacturer:"",model:"",controller:""});Ae(async()=>{if(await I(),w.modelValue&&(f.value=w.modelValue.manufacturer||"",S.value=w.modelValue.device_code||"",C.value=w.modelValue.controller_device||"",O.value=w.modelValue.temperature_sensor||"",$.value=w.modelValue.humidity_sensor||"",f.value&&(await a(f.value),S.value&&c.value.length>0))){const A=c.value.find(N=>N.code===S.value);A&&(o.value={code:A.code,manufacturer:f.value,models:A.models,controller:A.controller})}}),re(()=>w.entityType,async A=>{A&&(f.value="",S.value="",c.value=[],o.value=null,await I())});const I=async()=>{if(w.entityType){x.value=!0,U.value.manufacturer="";try{const A=await ne.get("/api/smartir/codes/manufacturers",{params:{entity_type:w.entityType}});if(A.data.success)s.value=A.data.manufacturers||[];else throw new Error(A.data.error||"Failed to load manufacturers")}catch(A){console.error("Error loading manufacturers:",A),U.value.manufacturer="Failed to load manufacturers. Please try again.",s.value=[]}finally{x.value=!1}}},a=async A=>{if(!(!A||!w.entityType)){q.value=!0,U.value.model="";try{const N=await ne.get("/api/smartir/codes/models",{params:{entity_type:w.entityType,manufacturer:A}});if(N.data.success){const oe=N.data.models||[];c.value=oe.map(ue=>{const ke=ue.models&&ue.models.length>0?ue.models.join(", "):`Code ${ue.code}`;return{code:ue.code,label:ke,description:`Code: ${ue.code}`,models:ue.models,controller:ue.controller}})}else throw new Error(N.data.error||"Failed to load models")}catch(N){console.error("Error loading models:",N),U.value.model="Failed to load models. Please try again.",c.value=[]}finally{q.value=!1}}},b=async A=>{f.value=A,S.value="",o.value=null,c.value=[],A&&await a(A),B()},p=()=>{const A=c.value.find(N=>N.code===S.value);A&&(o.value={code:A.code,manufacturer:f.value,models:A.models,controller:A.controller}),B()},L=()=>{B()},J=()=>{B()},Z=()=>{B()},B=()=>{var N,oe;const A={manufacturer:f.value,model:((oe=(N=o.value)==null?void 0:N.models)==null?void 0:oe[0])||"",device_code:S.value,controller_device:C.value};w.entityType==="climate"&&(O.value&&(A.temperature_sensor=O.value),$.value&&(A.humidity_sensor=$.value)),h("update:modelValue",A),h("change",A)};return u({validate:()=>{let A=!0;return U.value={manufacturer:"",model:"",controller:""},f.value||(U.value.manufacturer="Manufacturer is required",A=!1),S.value||(U.value.model="Model is required",A=!1),C.value||(U.value.controller="Broadlink controller is required",A=!1),A}}),(A,N)=>(l(),n("div",Mo,[e("div",Ro,[he(We,{modelValue:f.value,"onUpdate:modelValue":N[0]||(N[0]=oe=>f.value=oe),options:s.value,label:"Manufacturer",placeholder:"Search manufacturers...",required:"",loading:x.value,error:U.value.manufacturer,hint:"Select the device manufacturer",onChange:b},null,8,["modelValue","options","loading","error"])]),e("div",Lo,[he(We,{modelValue:S.value,"onUpdate:modelValue":N[1]||(N[1]=oe=>S.value=oe),options:c.value,"option-label":"label","option-value":"code","option-description":"description",label:"Model",placeholder:"Search models...",required:"",disabled:!f.value,loading:q.value,error:U.value.model,hint:"Select the device model",onChange:p},null,8,["modelValue","options","disabled","loading","error"])]),e("div",Ao,[N[6]||(N[6]=e("label",{for:"controller-device"},[e("i",{class:"mdi mdi-remote"}),T(" Controller Device * ")],-1)),X(e("select",{id:"controller-device","onUpdate:modelValue":N[2]||(N[2]=oe=>C.value=oe),required:"",onChange:L},[N[5]||(N[5]=e("option",{value:""},"-- Select Controller Device --",-1)),(l(!0),n(pe,null,$e(t.broadlinkDevices,oe=>(l(),n("option",{key:oe.entity_id,value:oe.entity_id},[T(m(oe.name||oe.entity_id)+" ",1),oe.area_name?(l(),n(pe,{key:0},[T(" - "+m(oe.area_name),1)],64)):R("",!0)],8,Oo))),128))],544),[[De,C.value]]),N[7]||(N[7]=e("small",null,"Which remote device will send the IR/RF commands",-1)),U.value.controller?(l(),n("div",Eo,m(U.value.controller),1)):R("",!0)]),t.entityType==="climate"?(l(),n(pe,{key:0},[e("div",Vo,[N[8]||(N[8]=e("label",{for:"temperature-sensor"},"Temperature Sensor",-1)),X(e("input",{id:"temperature-sensor","onUpdate:modelValue":N[3]||(N[3]=oe=>O.value=oe),type:"text",placeholder:"e.g., sensor.living_room_temperature",onInput:J},null,544),[[Le,O.value]]),N[9]||(N[9]=e("small",null,"Optional: Temperature sensor entity for current temperature",-1))]),e("div",Po,[N[10]||(N[10]=e("label",{for:"humidity-sensor"},"Humidity Sensor",-1)),X(e("input",{id:"humidity-sensor","onUpdate:modelValue":N[4]||(N[4]=oe=>$.value=oe),type:"text",placeholder:"e.g., sensor.living_room_humidity",onInput:Z},null,544),[[Le,$.value]]),N[11]||(N[11]=e("small",null,"Optional: Humidity sensor entity for current humidity",-1))])],64)):R("",!0),o.value?(l(),n("div",Uo,[N[16]||(N[16]=e("div",{class:"info-header"},[e("i",{class:"mdi mdi-information"}),e("span",null,"Selected Device Code")],-1)),e("div",Fo,[e("div",jo,[N[12]||(N[12]=e("span",{class:"info-label"},"Code ID:",-1)),e("span",No,m(o.value.code_id),1)]),e("div",Bo,[N[13]||(N[13]=e("span",{class:"info-label"},"Manufacturer:",-1)),e("span",Ho,m(o.value.manufacturer),1)]),o.value.models&&o.value.models.length>0?(l(),n("div",qo,[N[14]||(N[14]=e("span",{class:"info-label"},"Supported Models:",-1)),e("span",zo,m(o.value.models.join(", ")),1)])):R("",!0),e("div",Jo,[N[15]||(N[15]=e("span",{class:"info-label"},"Controller:",-1)),e("span",Wo,m(o.value.controller||"Broadlink"),1)])])])):R("",!0)]))}},Xo=Ce(Ko,[["__scopeId","data-v-1911c8f6"]]),Go={class:"modal-content"},Yo={class:"modal-header"},Zo={class:"input-wrapper"},Qo={key:0,class:"validation-tooltip"},el={class:"input-wrapper"},tl=["disabled"],ol={key:0,class:"validation-tooltip"},ll={key:0,class:"smartir-notice"},nl={key:0,class:"notice-success"},sl={key:1,class:"notice-warning"},al={key:1,class:"smartir-notice"},il={key:2},rl={class:"form-group"},dl=["disabled"],ul=["disabled"],cl={key:0},ml={key:1},vl={key:2},pl={key:3},fl={key:0,class:"form-group"},gl={class:"area-display-readonly"},yl=["value"],bl=["disabled"],hl=["href"],kl={key:1,class:"form-group"},wl={class:"form-group"},$l={class:"input-wrapper"},Cl=["value"],_l=["value"],Sl={key:2,class:"validation-tooltip"},Il={key:0},Dl={key:1},Tl={key:3,class:"smartir-section"},xl={class:"modal-footer"},Ml={type:"submit",form:"device-form",class:"btn btn-primary"},Rl={__name:"DeviceForm",props:{device:{type:Object,default:null}},emits:["save","cancel"],setup(t,{emit:u}){const i=t,w=u,h=xe("smartirStatus"),s=xe("smartirEnabled"),c=K(()=>{var d;return localStorage.getItem("smartir_simulate_not_installed")==="true"?!1:((d=h==null?void 0:h.value)==null?void 0:d.installed)||!1}),f=K(()=>!!i.device),S=K(()=>["climate","media_player","fan","light"].includes(o.value.entity_type)),C=K(()=>c.value?!S.value&&o.value.entity_type?"(Not supported for this type)":"(Pre-configured Codes)":"(Requires SmartIR)"),O=K(()=>{var d;const D=((d=i.device)==null?void 0:d.commands)||{};return Object.keys(D).length>0}),$=K(()=>{if(!o.value.broadlink_entity)return"";const D=a.value.find(d=>d.entity_id===o.value.broadlink_entity);return D&&D.name||o.value.broadlink_entity}),o=g({name:"",entity_type:"",device_type:"broadlink",device:"",area:"",icon:"",broadlink_entity:"",enabled:!0,commands:{}}),x=g({name:"",entity_type:"",broadlink_entity:""}),q=g({}),U=g(null),I=g([]),a=g([]),b=g(null),p=g(null),L=g(null),J=g(!1);Ae(async()=>{i.device&&(o.value={...i.device,device_type:i.device.device_type||"broadlink"},o.value.device_type==="smartir"&&(q.value={manufacturer:i.device.manufacturer,model:i.device.model,device_code:i.device.device_code,controller_device:i.device.controller_device,temperature_sensor:i.device.temperature_sensor,humidity_sensor:i.device.humidity_sensor})),await Promise.all([Z(),B()])});const Z=async()=>{try{const D=await ne.get("/api/areas");I.value=D.data.areas||[]}catch(D){console.error("Error loading areas:",D),I.value=[]}},B=async()=>{try{const d=(await ne.get("/api/remote/devices")).data.devices||[];a.value=d,console.log("Loaded remote devices:",d)}catch(D){console.error("Error loading remote devices:",D),a.value=[]}},ae=D=>{if(!D)return"";const d=D.toLowerCase();for(const V of I.value){const ve=V.toLowerCase();if(d.includes(ve))return V}return""},A=(D,d="")=>{const V=d.toLowerCase();return V.includes("tv")?"mdi:television":V.includes("lamp")?"mdi:lamp":V.includes("ceiling")?"mdi:ceiling-light":V.includes("floor")?"mdi:floor-lamp":V.includes("desk")?"mdi:desk-lamp":V.includes("fan")?"mdi:fan":V.includes("ac")||V.includes("air con")?"mdi:air-conditioner":V.includes("heater")?"mdi:radiator":V.includes("blind")?"mdi:blinds":V.includes("curtain")?"mdi:curtains":V.includes("garage")?"mdi:garage":V.includes("speaker")||V.includes("stereo")?"mdi:speaker":V.includes("receiver")?"mdi:audio-video":{light:"mdi:lightbulb",fan:"mdi:fan",switch:"mdi:light-switch",media_player:"mdi:television",cover:"mdi:window-shutter",climate:"mdi:thermostat"}[D]||"mdi:devices"};re(()=>o.value.name,D=>{if(!f.value&&D&&!o.value.area){const d=ae(D);d&&(o.value.area=d)}!f.value&&D&&o.value.entity_type&&(J.value||!o.value.icon)&&(o.value.icon=A(o.value.entity_type,D),J.value=!0)}),re(()=>o.value.entity_type,D=>{!f.value&&D&&(J.value||!o.value.icon)&&(o.value.icon=A(D,o.value.name),J.value=!0)}),re(()=>o.value.icon,(D,d)=>{d!==void 0&&D!==d&&!J.value&&(J.value=!1),D||(J.value=!1)});const N=g(!1),oe=async()=>{var D;if((D=i.device)!=null&&D.id){N.value=!0;try{const d=await ne.post(`/api/devices/${i.device.id}/sync-area`);d.data.success?(o.value.area=d.data.area||"",d.data.area?console.log(`Area synced: ${d.data.area}`):console.log("No area assigned in Home Assistant")):console.warn(d.data.message||"Entity not found in HA")}catch(d){console.error("Failed to sync area:",d)}finally{N.value=!1}}},ue=()=>{var V;return!((V=i.device)!=null&&V.id)||!o.value.entity_type?"#":`/config/entities/entity/${`${o.value.entity_type}.${i.device.id}`}`},ke=()=>{x.value={name:"",entity_type:"",broadlink_entity:""};let D=!0;return(!o.value.name||o.value.name.trim()==="")&&(x.value.name="Device name is required",D=!1),o.value.entity_type||(x.value.entity_type="Entity type is required",D=!1),o.value.device_type==="broadlink"&&!o.value.broadlink_entity&&(x.value.broadlink_entity="Broadlink device is required",D=!1),D},Se=D=>{x.value[D]=""},Me=async()=>{if(o.value.device_type==="smartir"){if(U.value&&!U.value.validate())return;const D={...o.value,smartir_config:{manufacturer:q.value.manufacturer,model:q.value.model,code_id:q.value.device_code,controller_device:q.value.controller_device}};w("save",D)}else{if(!ke())return;w("save",{...o.value})}},Te=D=>{q.value=D};return(D,d)=>(l(),n("div",{class:"modal-overlay",onClick:d[11]||(d[11]=me(V=>D.$emit("cancel"),["self"]))},[e("div",Go,[e("div",Yo,[e("h2",null,m(f.value?"Edit Device":"Add New Device"),1),e("button",{onClick:d[0]||(d[0]=V=>D.$emit("cancel")),class:"close-btn"},[...d[12]||(d[12]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("form",{id:"device-form",onSubmit:me(Me,["prevent"]),class:"modal-body"},[e("div",{class:G(["form-group",{"has-error":x.value.name}])},[d[14]||(d[14]=e("label",{for:"device-name"},"Device Name *",-1)),e("div",Zo,[X(e("input",{id:"device-name",ref_key:"nameInput",ref:b,"onUpdate:modelValue":d[1]||(d[1]=V=>o.value.name=V),type:"text",placeholder:"e.g., Living Room TV",onInput:d[2]||(d[2]=V=>Se("name"))},null,544),[[Le,o.value.name]]),x.value.name?(l(),n("div",Qo,[d[13]||(d[13]=e("i",{class:"mdi mdi-alert"},null,-1)),T(" "+m(x.value.name),1)])):R("",!0)]),d[15]||(d[15]=e("small",null,"Friendly name for this device",-1))],2),e("div",{class:G(["form-group",{"has-error":x.value.entity_type}])},[d[23]||(d[23]=e("label",{for:"entity-type"},"Entity Type *",-1)),e("div",el,[X(e("select",{id:"entity-type",ref_key:"typeSelect",ref:p,"onUpdate:modelValue":d[3]||(d[3]=V=>o.value.entity_type=V),onChange:d[4]||(d[4]=V=>Se("entity_type"))},[d[16]||(d[16]=je('<option value="" data-v-94bc1fe5>-- Select Type --</option><option value="light" data-v-94bc1fe5>💡 Light</option><option value="fan" data-v-94bc1fe5>🌀 Fan</option><option value="switch" data-v-94bc1fe5>🔌 Switch</option><option value="media_player" data-v-94bc1fe5>📺 Media Player</option><option value="cover" data-v-94bc1fe5>🪟 Cover (Blinds/Curtains)</option>',6)),e("option",{value:"climate",disabled:!c.value}," 🌡️ Climate "+m(c.value?"":"(Requires SmartIR)"),9,tl)],544),[[De,o.value.entity_type]]),x.value.entity_type?(l(),n("div",ol,[d[17]||(d[17]=e("i",{class:"mdi mdi-alert"},null,-1)),T(" "+m(x.value.entity_type),1)])):R("",!0)]),o.value.entity_type==="climate"?(l(),n("div",ll,[c.value?(l(),n("div",nl,[...d[18]||(d[18]=[e("i",{class:"mdi mdi-check-circle"},null,-1),e("span",null,"SmartIR detected! Climate entities will be created via SmartIR profiles.",-1)])])):(l(),n("div",sl,[...d[19]||(d[19]=[e("i",{class:"mdi mdi-alert"},null,-1),e("div",null,[e("strong",null,"SmartIR Required"),e("p",null,"Climate entities (AC, heaters) require SmartIR integration."),e("a",{href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"smartir-link"}," Install SmartIR → ")],-1)])]))])):c.value&&["media_player","fan","light"].includes(o.value.entity_type)?(l(),n("div",al,[...d[20]||(d[20]=[e("div",{class:"notice-info"},[e("i",{class:"mdi mdi-information"}),e("span",null,"💡 SmartIR available! You can use pre-configured codes or learn your own.")],-1)])])):!c.value&&o.value.entity_type?(l(),n("small",il,[d[21]||(d[21]=T(" 💡 Tip: Install ",-1)),d[22]||(d[22]=e("a",{href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"inline-link"},"SmartIR",-1)),T(" for pre-configured "+m(o.value.entity_type==="climate"?"climate":o.value.entity_type)+" device codes ",1)])):R("",!0)],2),e("div",rl,[d[26]||(d[26]=e("label",{for:"device-type"},"Device Type *",-1)),X(e("select",{id:"device-type","onUpdate:modelValue":d[5]||(d[5]=V=>o.value.device_type=V),required:"",disabled:f.value},[d[24]||(d[24]=e("option",{value:""},"-- Select Device Type --",-1)),d[25]||(d[25]=e("option",{value:"broadlink"},"📡 Broadlink Device (Learn IR Codes)",-1)),_e(s)?(l(),n("option",{key:0,value:"smartir",disabled:!c.value||!S.value}," 🌐 SmartIR Device "+m(C.value),9,ul)):R("",!0)],8,dl),[[De,o.value.device_type]]),f.value?(l(),n("small",cl,"Cannot change device type after creation")):o.value.device_type==="smartir"?(l(),n("small",ml,"Using pre-configured codes from SmartIR repository")):o.value.device_type==="broadlink"?(l(),n("small",vl,"Learn and store your own IR codes")):(l(),n("small",pl,"Choose how to configure this device"))]),f.value?(l(),n("div",fl,[d[29]||(d[29]=e("label",{for:"device-area"},"Area",-1)),e("div",gl,[e("input",{id:"device-area",value:o.value.area||"Not assigned",type:"text",readonly:"",class:"readonly-input"},null,8,yl),e("button",{type:"button",onClick:oe,disabled:N.value,class:"sync-area-btn",title:"Sync area from Home Assistant"},[e("i",{class:G(N.value?"mdi mdi-loading mdi-spin":"mdi mdi-refresh")},null,2)],8,bl)]),e("small",null,[d[27]||(d[27]=e("i",{class:"mdi mdi-information-outline"},null,-1)),d[28]||(d[28]=T(" Set area in Home Assistant, then click sync. ",-1)),e("a",{href:ue(),target:"_blank",class:"inline-link"},"Open in HA →",8,hl)])])):(l(),n("div",kl,[...d[30]||(d[30]=[e("div",{class:"info-notice"},[e("i",{class:"mdi mdi-information-outline"}),e("span",null,[e("strong",null,"Area Assignment:"),T(" After generating entities and restarting Home Assistant, you can assign areas in HA and sync them here.")])],-1)])])),e("div",wl,[d[31]||(d[31]=e("label",{for:"device-icon"},"Icon",-1)),he(vo,{modelValue:o.value.icon,"onUpdate:modelValue":d[6]||(d[6]=V=>o.value.icon=V),inputId:"device-icon",placeholder:"e.g., mdi:television"},null,8,["modelValue"]),d[32]||(d[32]=e("small",null,"Optional: Material Design Icon name",-1))]),o.value.device_type==="broadlink"?(l(),n("div",{key:2,class:G(["form-group",{"has-error":x.value.broadlink_entity}])},[d[35]||(d[35]=e("label",{for:"broadlink-entity"},"Remote Device *",-1)),e("div",$l,[!f.value||!O.value?X((l(),n("select",{key:0,id:"broadlink-entity",ref_key:"broadlinkSelect",ref:L,"onUpdate:modelValue":d[7]||(d[7]=V=>o.value.broadlink_entity=V),onChange:d[8]||(d[8]=V=>Se("broadlink_entity"))},[d[33]||(d[33]=e("option",{value:""},"-- Select Remote Device --",-1)),(l(!0),n(pe,null,$e(a.value,V=>(l(),n("option",{key:V.entity_id,value:V.entity_id},[T(m(V.name||V.entity_id)+" ",1),V.area_name?(l(),n(pe,{key:0},[T(" - "+m(V.area_name),1)],64)):R("",!0)],8,Cl))),128))],544)),[[De,o.value.broadlink_entity]]):(l(),n("input",{key:1,id:"broadlink-entity",value:$.value,type:"text",readonly:"",disabled:""},null,8,_l)),x.value.broadlink_entity?(l(),n("div",Sl,[d[34]||(d[34]=e("i",{class:"mdi mdi-alert"},null,-1)),T(" "+m(x.value.broadlink_entity),1)])):R("",!0)]),!f.value||!O.value?(l(),n("small",Il,"Required: Select which remote device to use for sending commands")):(l(),n("small",Dl,"Cannot change remote device after commands are learned"))],2)):R("",!0),o.value.device_type==="smartir"?(l(),n("div",Tl,[d[36]||(d[36]=e("div",{class:"section-header"},[e("i",{class:"mdi mdi-cloud-download"}),e("span",null,"SmartIR Device Configuration")],-1)),he(Xo,{ref_key:"smartirSelector",ref:U,"entity-type":o.value.entity_type,modelValue:q.value,"onUpdate:modelValue":d[9]||(d[9]=V=>q.value=V),"broadlink-devices":a.value,onChange:Te},null,8,["entity-type","modelValue","broadlink-devices"])])):R("",!0)],32),e("div",xl,[e("button",{type:"button",onClick:d[10]||(d[10]=V=>D.$emit("cancel")),class:"btn btn-secondary"}," Cancel "),e("button",Ml,[d[37]||(d[37]=e("i",{class:"mdi mdi-check"},null,-1)),T(" "+m(f.value?"Update":"Create"),1)])])])]))}},Ll=Ce(Rl,[["__scopeId","data-v-94bc1fe5"]]),Al={class:"modal-header"},Ol={class:"modal-body"},El={class:"message-text"},Vl={key:0,class:"checkbox-option"},Pl={class:"modal-footer"},Ul=["disabled"],Fl={__name:"ConfirmDialog",props:{isOpen:{type:Boolean,default:!1},title:{type:String,default:"Confirm"},message:{type:String,required:!0},confirmText:{type:String,default:"OK"},cancelText:{type:String,default:"Cancel"},showCancel:{type:Boolean,default:!0},dangerMode:{type:Boolean,default:!1},confirmDisabled:{type:Boolean,default:!1},checkboxLabel:{type:String,default:""}},emits:["confirm","cancel"],setup(t,{emit:u}){const i=t,w=u,h=g(!1);re(()=>i.isOpen,f=>{f&&(h.value=!1)});const s=()=>{w("confirm",h.value)},c=()=>{w("cancel")};return(f,S)=>t.isOpen?(l(),n("div",{key:0,class:"modal-overlay",onClick:me(c,["self","stop"])},[e("div",{class:"modal-dialog confirm-dialog",onClick:S[1]||(S[1]=me(()=>{},["stop"]))},[e("div",Al,[e("h2",null,m(t.title),1)]),e("div",Ol,[e("p",El,m(t.message),1),t.checkboxLabel?(l(),n("div",Vl,[e("label",null,[X(e("input",{type:"checkbox","onUpdate:modelValue":S[0]||(S[0]=C=>h.value=C)},null,512),[[ye,h.value]]),e("span",null,m(t.checkboxLabel),1)])])):R("",!0)]),e("div",Pl,[t.showCancel?(l(),n("button",{key:0,onClick:me(c,["stop"]),class:"btn btn-secondary"},m(t.cancelText),1)):R("",!0),t.confirmText?(l(),n("button",{key:1,onClick:me(s,["stop"]),class:G(["btn",t.dangerMode?"btn-danger":"btn-primary"]),disabled:t.confirmDisabled},m(t.confirmText),11,Ul)):R("",!0)])])])):R("",!0)}},Fe=Ce(Fl,[["__scopeId","data-v-9cea6cb3"]]),jl={class:"modal-content"},Nl={class:"modal-header"},Bl={class:"modal-body"},Hl={key:0,class:"smartir-info"},ql={key:0,class:"climate-note"},zl={class:"form-group"},Jl=["value"],Wl={class:"form-group"},Kl=["disabled"],Xl={label:"Suggested Commands"},Gl=["value"],Yl=["disabled"],Zl={class:"form-group"},Ql={class:"radio-group"},en={class:"radio-label"},tn=["disabled"],on={class:"radio-label"},ln=["disabled"],nn={class:"learn-action"},sn=["disabled"],an={key:0,class:"mdi mdi-loading mdi-spin"},rn={key:1,class:"mdi mdi-remote-tv"},dn={key:0,class:"learning-status"},un={key:0},cn={key:1},mn={key:2,class:"rf-instructions"},vn={key:1,class:"result-message success"},pn={key:2,class:"section-divider"},fn={key:3,class:"loading-commands"},gn={key:4,class:"learned-commands"},yn={class:"command-list"},bn={class:"command-info"},hn={class:"command-name"},kn={class:"command-right"},wn=["title"],$n={class:"command-actions"},Cn=["onClick","disabled"],_n=["onClick"],Sn={key:5,class:"untracked-commands"},In={class:"command-list"},Dn={class:"command-name"},Tn={class:"modal-footer"},xn=["disabled"],Mn={__name:"CommandLearner",props:{device:{type:Object,required:!0}},emits:["cancel","learned"],setup(t,{emit:u}){const i=t,w=u,h=g([]),s=g(""),c=g(""),f=g(""),S=g("ir"),C=g(!1),O=g(""),$=g(""),o=g("success"),x=g([]),q=g([]),U=g(!1),I=g(!1),a=g(""),b=g(!1),p=g(null),L=g(null),J=g(""),Z=g(""),B=K(()=>i.device.device_type==="smartir");K(()=>{if(B.value)return!1;const W=c.value==="__custom__"?f.value:c.value;return s.value&&W.trim()});const ae=()=>{p.value&&p.value.setCustomValidity("")},A=()=>{L.value&&L.value.setCustomValidity("")},N=K(()=>{const W=h.value.find(E=>E.entity_id===s.value);return W?W.name||W.entity_id:s.value}),oe={light:["turn_on","turn_off","toggle","brightness_up","brightness_down","dim","bright"],fan:["turn_on","turn_off","toggle","speed_low","speed_medium","speed_high","speed_1","speed_2","speed_3","speed_4","speed_5","oscillate_on","oscillate_off","direction_forward","direction_reverse"],switch:["turn_on","turn_off","toggle"],media_player:["turn_on","turn_off","toggle","volume_up","volume_down","volume_mute","play","pause","stop","play_pause","next_track","previous_track","channel_up","channel_down","source_hdmi1","source_hdmi2","source_hdmi3","source_tv","source_aux","source_bluetooth","menu","home","back","select","arrow_up","arrow_down","arrow_left","arrow_right"],cover:["open","close","stop","open_tilt","close_tilt","position_0","position_25","position_50","position_75","position_100"]},ue=K(()=>{const W=i.device.entity_type||"switch";return oe[W]||oe.switch});Ae(async()=>{await ke();try{console.log("🔄 Syncing command types...");const E=await ne.post("/api/commands/sync");console.log("✅ Command types synced:",E.data)}catch(E){console.error("⚠️ Failed to sync command types:",E)}const W=!B.value;console.log(`📋 Will ${W?"FORCE RELOAD":"use cached"} commands`),await Se(W),p.value&&(p.value.setCustomValidity(""),p.value.oninvalid=()=>{p.value.setCustomValidity("Command name is required")}),i.device.broadlink_entity&&(s.value=i.device.broadlink_entity)}),re(c,async W=>{W==="__custom__"&&(await ot(),L.value&&(L.value.setCustomValidity(""),L.value.oninvalid=()=>{L.value.setCustomValidity("Custom command name is required")}))});const ke=async()=>{try{const W=await ne.get("/api/broadlink/devices");h.value=W.data.devices||[]}catch(W){console.error("Error loading Broadlink devices:",W)}},Se=async(W=!1)=>{var E,Q;U.value=!0;try{if(B.value){const H=await ne.get("/api/smartir/codes/code",{params:{entity_type:i.device.entity_type,code_id:i.device.device_code}});if(H.data.success&&H.data.code){const v=H.data.code.commands||{},y=H.data.code.commandType||"ir";if(i.device.entity_type==="climate"){const j=[];for(const[ee,M]of Object.entries(v))typeof M=="string"?j.push({name:ee,type:y}):typeof M=="object"&&M!==null&&Object.keys(M).sort((P,Y)=>parseInt(P)-parseInt(Y)).forEach(P=>{j.push({name:`${ee}_${P}`,type:y,label:`${ee.charAt(0).toUpperCase()+ee.slice(1)} ${P}°C`})});x.value=j}else x.value=Object.keys(v).map(j=>({name:j,type:y}))}}else{if(console.log("📋 Loading commands for device:",i.device),console.log("📋 Device ID:",i.device.id),console.log("📋 Force reload:",W),W&&i.device.id){console.log("🔄 Force reloading commands from API after sync");try{const v=(await ne.get(`/api/commands/${i.device.id}`)).data.commands||{};console.log("📦 Raw commands from API:",v),x.value=Object.entries(v).map(([y,j])=>{console.log(`  Command '${y}':`,j,`(type: ${typeof j})`);const ee=typeof j=="object"&&j!==null&&(j.command_type||j.type)||"ir";return{name:y,type:ee}}),console.log("📋 Reloaded commands:",x.value)}catch(H){if(console.error("❌ Error loading commands:",H),((E=H.response)==null?void 0:E.status)===404)console.log("ℹ️ No commands found for device"),x.value=[];else throw H}}else if(i.device.commands&&Object.keys(i.device.commands).length>0)console.log("✅ Using commands from device object"),x.value=Object.entries(i.device.commands).map(([H,v])=>({name:H,type:v.command_type||v.type||"ir"}));else if(i.device.commands!==void 0)console.log("ℹ️ Device has empty commands object - skipping API call"),x.value=[];else if(i.device.id){console.log("🌐 Fetching commands from API for device ID:",i.device.id);try{const v=(await ne.get(`/api/commands/${i.device.id}`)).data.commands||{};x.value=Object.entries(v).map(([y,j])=>({name:y,type:j.command_type||j.type||"ir"}))}catch(H){if(((Q=H.response)==null?void 0:Q.status)===404)console.log("ℹ️ No commands found for device (this is normal for new devices)"),x.value=[];else throw H}}else console.log("⚠️ No commands found and no device ID");console.log("📋 Final learned commands:",x.value)}}catch(H){console.error("Error loading commands:",H)}finally{U.value=!1}},Me=async()=>{var E,Q;$.value="",o.value="",C.value=!0,O.value="preparing";const W=setTimeout(()=>{O.value="ready"},6e3);try{let H=i.device.id.split(".")[1];i.device.device&&(H=i.device.device);const v=c.value==="__custom__"?f.value:c.value,y=await ne.post("/api/commands/learn/direct",{device_id:i.device.id,entity_id:s.value||i.device.broadlink_entity,command_name:v.trim(),command_type:S.value});if(y.data.success){$.value=`Command "${v}" learned successfully!`,o.value="success",x.value.find(M=>M.name===v)||(x.value.push({name:v,type:S.value}),console.log(`✅ CommandLearner: Added '${v}' to local list, total: ${x.value.length}`));const ee=q.value.indexOf(v);ee>-1&&q.value.splice(ee,1),await ve(),c.value="",f.value="",console.log(`📤 CommandLearner: Emitting learned event for '${v}'`),w("learned",{deviceId:i.device.id,commandName:v,commandType:S.value})}else $.value=y.data.error||"Failed to learn command",o.value="error"}catch(H){$.value=((Q=(E=H.response)==null?void 0:E.data)==null?void 0:Q.error)||"Error learning command",o.value="error"}finally{clearTimeout(W),C.value=!1,O.value=""}},Te=async W=>{var E,Q;try{Z.value=W,J.value="";let H=i.device.id.split(".")[1];i.device.device&&(H=i.device.device);const v=B.value?i.device.controller_device:s.value||i.device.broadlink_entity;if(!v){console.error("Missing entity_id for test command:",{isSmartIR:B.value,controller_device:i.device.controller_device,broadlink_entity:i.device.broadlink_entity,selectedBroadlink:s.value,device:i.device}),$.value="Missing Broadlink remote entity. Please select a Broadlink device.",o.value="error",Z.value="";return}const y={device_id:i.device.id,entity_id:v,command_name:W};console.log("🧪 Testing command:",y),(await ne.post("/api/commands/test/direct",y)).data.success&&(J.value=W,setTimeout(()=>{J.value===W&&(J.value="")},2e3))}catch(H){console.error("❌ Test command error:",H);const v=((Q=(E=H.response)==null?void 0:E.data)==null?void 0:Q.error)||H.message||"Unknown error";$.value=`Failed to send command: ${v}`,o.value="error"}finally{Z.value=""}},D=W=>{a.value=W,I.value=!0},d=()=>{I.value=!1,a.value=""},V=async()=>{const W=a.value;I.value=!1;try{console.log(`🗑️ Deleting command: ${W}`),await ne.delete(`/api/commands/${i.device.id}/${W}`),x.value=x.value.filter(E=>E.name!==W),await Se(),await ve(),$.value=`Command "${W}" deleted`,o.value="success",w("learned")}catch(E){console.error("❌ Delete error:",E),$.value=`Failed to delete command: ${E.message}`,o.value="error"}finally{a.value=""}},ve=async()=>{try{let W=i.device.device;W||(W=i.device.id.includes(".")?i.device.id.split(".")[1]:i.device.id),console.log("🔍 Looking for untracked commands for device:",W);const Q=(await ne.get("/api/commands/untracked")).data.untracked||{};console.log("📦 All untracked commands:",Object.keys(Q)),console.log("📦 Untracked for this device:",Q[W]),Q[W]?q.value=Object.keys(Q[W].commands):q.value=[]}catch(W){console.error("Error loading untracked commands:",W),q.value=[]}},Oe=()=>{q.value.length!==0&&(b.value=!0)},be=async()=>{b.value=!1;try{const W=i.device.device||i.device.id.split(".")[1],E=await ne.post("/api/commands/import",{device_id:i.device.id,source_device:W,commands:q.value});E.data.success&&($.value=`Imported ${E.data.imported_count} commands successfully!`,o.value="success",await Se(),await ve(),w("learned"))}catch(W){$.value=`Failed to import commands: ${W.message}`,o.value="error"}};return(W,E)=>(l(),n("div",{class:"modal-overlay",onClick:E[7]||(E[7]=me(Q=>W.$emit("cancel"),["self"]))},[e("div",jl,[e("div",Nl,[e("h2",null,m(B.value?"Commands for":"Learn Commands for")+" "+m(t.device.name),1),e("button",{onClick:E[0]||(E[0]=Q=>W.$emit("cancel")),class:"close-btn"},[...E[8]||(E[8]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Bl,[B.value?(l(),n("div",Hl,[E[13]||(E[13]=e("i",{class:"mdi mdi-information"},null,-1)),e("div",null,[E[12]||(E[12]=e("h3",null,"SmartIR Device",-1)),e("p",null,[E[9]||(E[9]=T("This device uses SmartIR code file ",-1)),e("strong",null,m(t.device.device_code),1),E[10]||(E[10]=T(". Commands are pre-configured and cannot be learned.",-1))]),t.device.entity_type==="climate"?(l(),n("p",ql,[...E[11]||(E[11]=[e("i",{class:"mdi mdi-alert-circle-outline"},null,-1),e("strong",null,"Note:",-1),T(" Climate device commands are temperature-based. Testing individual modes may not work as expected. Use the Home Assistant climate card to control your device. ",-1)])])):R("",!0)])])):(l(),n("form",{key:1,onSubmit:me(Me,["prevent"])},[e("div",zl,[E[14]||(E[14]=e("label",{for:"broadlink-entity"},"Broadlink Device",-1)),e("input",{id:"broadlink-entity",value:N.value,type:"text",readonly:"",disabled:""},null,8,Jl),E[15]||(E[15]=e("small",null,"Commands will be learned using this device (set when device was created)",-1))]),e("div",Wl,[E[18]||(E[18]=e("label",{for:"command-name"},"Command Name *",-1)),X(e("select",{id:"command-name",ref_key:"commandSelect",ref:p,"onUpdate:modelValue":E[1]||(E[1]=Q=>c.value=Q),disabled:C.value,required:"",onChange:ae},[E[16]||(E[16]=e("option",{value:""},"-- Select or type command --",-1)),e("optgroup",Xl,[(l(!0),n(pe,null,$e(ue.value,Q=>(l(),n("option",{key:Q,value:Q},m(Q),9,Gl))),128))]),E[17]||(E[17]=e("option",{value:"__custom__"},"Custom command...",-1))],40,Kl),[[De,c.value]]),c.value==="__custom__"?X((l(),n("input",{key:0,ref_key:"customCommandInput",ref:L,"onUpdate:modelValue":E[2]||(E[2]=Q=>f.value=Q),type:"text",placeholder:"Enter custom command name",disabled:C.value,required:"",class:"custom-command-input",onInput:A},null,40,Yl)),[[Le,f.value]]):R("",!0),e("small",null,"Select a suggested command for "+m(t.device.entity_type||"this device")+", or enter a custom one.",1)]),e("div",Zl,[E[21]||(E[21]=e("label",null,"Command Type",-1)),e("div",Ql,[e("label",en,[X(e("input",{type:"radio","onUpdate:modelValue":E[3]||(E[3]=Q=>S.value=Q),value:"ir",disabled:C.value},null,8,tn),[[ze,S.value]]),E[19]||(E[19]=e("span",null,"IR (Infrared)",-1))]),e("label",on,[X(e("input",{type:"radio","onUpdate:modelValue":E[4]||(E[4]=Q=>S.value=Q),value:"rf",disabled:C.value},null,8,ln),[[ze,S.value]]),E[20]||(E[20]=e("span",null,"RF (Radio Frequency)",-1))])])]),e("div",nn,[e("button",{type:"submit",class:"btn btn-primary btn-large",disabled:C.value},[C.value?(l(),n("i",an)):(l(),n("i",rn)),T(" "+m(C.value?"Learning...":"Learn Command"),1)],8,sn)]),C.value?(l(),n("div",dn,[E[25]||(E[25]=e("i",{class:"mdi mdi-loading mdi-spin"},null,-1)),O.value==="preparing"?(l(),n("div",un,[...E[22]||(E[22]=[e("p",null,[e("strong",null,"Preparing device...")],-1),e("small",null,"Connecting and authenticating with Broadlink device (this takes a few seconds)",-1)])])):S.value==="ir"?(l(),n("div",cn,[...E[23]||(E[23]=[e("p",null,[e("strong",null,"Ready!"),T(" Point your remote at the Broadlink device and press the button...")],-1),e("small",null,"This may take up to 30 seconds",-1)])])):S.value==="rf"?(l(),n("div",mn,[...E[24]||(E[24]=[e("p",null,[e("strong",null,"RF Learning Process:")],-1),e("ol",null,[e("li",null,[e("strong",null,"Step 1 - Frequency Sweep (~10-15 seconds):"),e("br"),T(" Press and HOLD the button on your remote for 2-3 seconds, then RELEASE")]),e("li",null,[e("strong",null,"Step 2 - Capture Signal (automatic):"),e("br"),T(" After releasing, the device will capture the signal (may take a few seconds)")])],-1),e("div",{class:"rf-note"},[e("i",{class:"mdi mdi-information"}),e("span",null,"The UI will update once the signal is captured. Be patient after releasing the button.")],-1)])])):R("",!0)])):R("",!0),$.value&&o.value==="success"&&!$.value.includes("sent successfully")?(l(),n("div",vn,[E[26]||(E[26]=e("i",{class:"mdi mdi-check-circle"},null,-1)),e("p",null,m($.value),1)])):R("",!0)],32)),x.value.length>0||q.value.length>0?(l(),n("div",pn)):R("",!0),U.value?(l(),n("div",fn,[...E[27]||(E[27]=[e("div",{class:"loading-spinner"},[e("i",{class:"mdi mdi-loading mdi-spin"}),e("p",null,"Loading commands...")],-1)])])):x.value.length>0?(l(),n("div",gn,[e("h3",null,"Tracked Commands ("+m(x.value.length)+")",1),e("div",yn,[(l(!0),n(pe,null,$e(x.value,Q=>(l(),n("div",{key:Q.name,class:"command-item"},[e("div",bn,[e("span",hn,m(Q.label||Q.name),1)]),e("div",kn,[e("i",{class:"mdi mdi-check-circle learned-icon",title:`Learned (${(Q.type||"ir").toUpperCase()})`},null,8,wn),e("span",{class:G(["command-type-badge",Q.type||"ir"])},m((Q.type||"ir").toUpperCase()),3),e("div",$n,[e("button",{type:"button",onClick:H=>Te(Q.name),class:"icon-btn",title:"Test command",disabled:Z.value===Q.name},[e("i",{class:G(["mdi mdi-play",{"mdi-spin":Z.value===Q.name}])},null,2)],8,Cn),e("button",{type:"button",onClick:H=>D(Q.name),class:"icon-btn danger",title:"Delete and re-learn"},[...E[28]||(E[28]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,_n)])])]))),128))])])):R("",!0),q.value.length>0?(l(),n("div",Sn,[e("h3",null,[E[29]||(E[29]=e("i",{class:"mdi mdi-alert"},null,-1)),T(" Untracked Commands ("+m(q.value.length)+") ",1)]),E[32]||(E[32]=e("p",{class:"untracked-info"}," These commands exist in Broadlink storage but are not tracked in this device. ",-1)),e("div",In,[(l(!0),n(pe,null,$e(q.value,Q=>(l(),n("div",{key:Q,class:"command-item untracked"},[e("span",Dn,m(Q),1),E[30]||(E[30]=e("span",{class:"untracked-badge"},"Not tracked",-1))]))),128))]),e("button",{type:"button",onClick:Oe,class:"btn btn-secondary"},[...E[31]||(E[31]=[e("i",{class:"mdi mdi-import"},null,-1),T(" Import All Untracked Commands ",-1)])])])):R("",!0)]),e("div",Tn,[e("button",{type:"button",onClick:E[5]||(E[5]=Q=>W.$emit("cancel")),class:"btn btn-secondary",disabled:C.value}," Close ",8,xn)])]),he(Fe,{isOpen:I.value,title:"Delete Command?",message:`Delete command '${a.value}'? This will remove it from Broadlink storage.`,confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,onConfirm:V,onCancel:d},null,8,["isOpen","message"]),he(Fe,{isOpen:b.value,title:"Import Commands?",message:`Import ${q.value.length} untracked command${q.value.length>1?"s":""} into this device?`,confirmText:"Import",cancelText:"Cancel",onConfirm:be,onCancel:E[6]||(E[6]=Q=>b.value=!1)},null,8,["isOpen","message"])]))}},Rn=Ce(Mn,[["__scopeId","data-v-daa1ddef"]]),Ln={class:"modal-container error-dialog"},An={class:"modal-header"},On={class:"modal-body"},En={class:"error-message"},Vn={key:0,class:"error-suggestion"},Pn=["open"],Un={class:"debug-content"},Fn={class:"debug-info"},jn={key:0,class:"debug-section-title"},Nn={key:1},Bn={__name:"ErrorDialog",props:{isOpen:{type:Boolean,default:!1},title:{type:String,default:"Error"},message:{type:String,required:!0},suggestion:{type:String,default:""},details:{type:String,default:""},error:{type:Object,default:null},context:{type:Object,default:()=>({})}},emits:["close"],setup(t,{emit:u}){const i=t,w=u,h=xe("toast"),s=g(!1),c=()=>{w("close")},f=K(()=>{var x,q,U,I,a,b,p,L,J,Z,B;const $=new Date().toISOString(),o=i.error||{};return{error:JSON.stringify({message:i.message,title:i.title,details:i.details,errorObject:o.message||o.toString(),timestamp:$},null,2),request:JSON.stringify({method:((q=(x=o.config)==null?void 0:x.method)==null?void 0:q.toUpperCase())||"N/A",url:((U=o.config)==null?void 0:U.url)||"N/A",baseURL:((I=o.config)==null?void 0:I.baseURL)||"N/A",headers:((a=o.config)==null?void 0:a.headers)||{},data:(b=o.config)!=null&&b.data?JSON.parse(o.config.data):"N/A",params:((p=o.config)==null?void 0:p.params)||{}},null,2),response:JSON.stringify({status:((L=o.response)==null?void 0:L.status)||"N/A",statusText:((J=o.response)==null?void 0:J.statusText)||"N/A",data:((Z=o.response)==null?void 0:Z.data)||"N/A",headers:((B=o.response)==null?void 0:B.headers)||{}},null,2),browser:JSON.stringify({userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language,cookieEnabled:navigator.cookieEnabled,onLine:navigator.onLine,viewport:`${window.innerWidth}x${window.innerHeight}`,screenResolution:`${window.screen.width}x${window.screen.height}`,colorDepth:window.screen.colorDepth,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,timestamp:$},null,2),appState:JSON.stringify({currentRoute:window.location.pathname,currentURL:window.location.href,referrer:document.referrer||"N/A",context:i.context||{},localStorage:{smartir_simulate:localStorage.getItem("smartir_simulate_not_installed"),theme:localStorage.getItem("theme")}},null,2),stackTrace:o.stack||null}}),S=async()=>{const $=O();try{await navigator.clipboard.writeText($),h==null||h.success("Debug information copied to clipboard","✅ Copied")}catch(o){console.error("Failed to copy:",o),h==null||h.error("Failed to copy to clipboard","❌ Copy Failed")}},C=()=>{const $=O(),o=new Blob([$],{type:"text/plain"}),x=URL.createObjectURL(o),q=document.createElement("a");q.href=x;const U=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5);q.download=`broadlink-manager-error-${U}.txt`,document.body.appendChild(q),q.click(),document.body.removeChild(q),URL.revokeObjectURL(x),h==null||h.success("Debug report downloaded","✅ Downloaded")},O=()=>`Broadlink Manager - Error Report
${"=".repeat(60)}

Generated: ${new Date().toISOString()}
Title: ${i.title}
Message: ${i.message}
${i.suggestion?`Suggestion: ${i.suggestion}
`:""}
${"=".repeat(60)}

ERROR DETAILS
${"-".repeat(60)}
${f.value.error}

REQUEST INFORMATION
${"-".repeat(60)}
${f.value.request}

RESPONSE INFORMATION
${"-".repeat(60)}
${f.value.response}

BROWSER INFORMATION
${"-".repeat(60)}
${f.value.browser}

APPLICATION STATE
${"-".repeat(60)}
${f.value.appState}

${f.value.stackTrace?`STACK TRACE
${"-".repeat(60)}
${f.value.stackTrace}

`:""}
${"=".repeat(60)}
End of Report
`;return re(()=>i.isOpen,$=>{if($){const o=x=>{x.key==="Escape"&&c()};return document.addEventListener("keydown",o),()=>document.removeEventListener("keydown",o)}}),($,o)=>(l(),Pe(lt,{to:"body"},[he(tt,{name:"modal"},{default:Ge(()=>[t.isOpen?(l(),n("div",{key:0,class:"modal-overlay",onClick:me(c,["self"])},[e("div",Ln,[e("div",An,[o[2]||(o[2]=e("div",{class:"header-icon error-icon"},[e("i",{class:"mdi mdi-alert-circle"})],-1)),e("h3",null,m(t.title),1),e("button",{onClick:c,class:"close-button"},[...o[1]||(o[1]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",On,[e("p",En,m(t.message),1),t.suggestion?(l(),n("p",Vn,[o[3]||(o[3]=e("i",{class:"mdi mdi-lightbulb-on"},null,-1)),T(" "+m(t.suggestion),1)])):R("",!0),e("details",{class:"debug-section",open:s.value},[e("summary",{onClick:o[0]||(o[0]=x=>s.value=!s.value)},[e("i",{class:G(["mdi",s.value?"mdi-chevron-down":"mdi-chevron-right"])},null,2),o[4]||(o[4]=T(" Debug Information ",-1))]),e("div",Un,[e("div",{class:"debug-actions"},[e("button",{onClick:S,class:"btn-debug btn-copy"},[...o[5]||(o[5]=[e("i",{class:"mdi mdi-content-copy"},null,-1),T(" Copy to Clipboard ",-1)])]),e("button",{onClick:C,class:"btn-debug btn-download"},[...o[6]||(o[6]=[e("i",{class:"mdi mdi-download"},null,-1),T(" Download Report ",-1)])])]),e("div",Fn,[o[7]||(o[7]=e("div",{class:"debug-section-title"},"Error Details",-1)),e("pre",null,m(f.value.error),1),o[8]||(o[8]=e("div",{class:"debug-section-title"},"Request Information",-1)),e("pre",null,m(f.value.request),1),o[9]||(o[9]=e("div",{class:"debug-section-title"},"Response Information",-1)),e("pre",null,m(f.value.response),1),o[10]||(o[10]=e("div",{class:"debug-section-title"},"Browser Information",-1)),e("pre",null,m(f.value.browser),1),o[11]||(o[11]=e("div",{class:"debug-section-title"},"Application State",-1)),e("pre",null,m(f.value.appState),1),f.value.stackTrace?(l(),n("div",jn,"Stack Trace")):R("",!0),f.value.stackTrace?(l(),n("pre",Nn,m(f.value.stackTrace),1)):R("",!0)])])],8,Pn)]),e("div",{class:"modal-footer"},[e("button",{onClick:c,class:"btn btn-primary"}," OK ")])])])):R("",!0)]),_:1})]))}},Hn=Ce(Bn,[["__scopeId","data-v-23858149"]]),qn={key:0,class:"discovery-banner"},zn={class:"banner-content"},Jn={class:"banner-text"},Wn={class:"modal-dialog"},Kn={class:"modal-header"},Xn={class:"modal-body"},Gn={class:"device-list"},Yn={class:"device-info"},Zn={class:"device-details"},Qn={class:"command-count"},es={class:"device-actions"},ts=["onClick"],os=["onClick"],ls={class:"modal-footer"},ns={class:"modal-dialog modal-dialog-small"},ss={class:"modal-header"},as={class:"modal-body"},is={class:"warning-message"},rs={class:"modal-footer"},ds=["disabled"],us=["disabled"],cs={__name:"DeviceDiscovery",emits:["adopt"],setup(t,{expose:u,emit:i}){const w=Be(),h=i,s=g([]),c=g(!1),f=g(!1),S=g(null),C=g(!1),O=K(()=>s.value.length>0);Ae(async()=>{await $()});const $=async()=>{try{const U=await ne.get("/api/devices/discover");s.value=U.data.untracked_devices||[]}catch(U){console.error("Error loading untracked devices:",U),s.value=[]}},o=U=>{c.value=!1,h("adopt",U)},x=U=>{S.value=U,f.value=!0},q=async()=>{if(!S.value)return;const U=S.value.device_name;C.value=!0;try{const I=await ne.delete(`/api/devices/untracked/${encodeURIComponent(U)}`);if(I.data.success)s.value=s.value.filter(a=>a.device_name!==U),f.value=!1,S.value=null,s.value.length===0&&(c.value=!1),w.success(`Deleted all commands for '${U}'`);else throw new Error(I.data.error||"Failed to delete device")}catch(I){console.error("Error deleting device:",I),w.error(`Failed to delete device: ${I.message}`)}finally{C.value=!1}};return u({refresh:$}),(U,I)=>{var a,b,p;return O.value?(l(),n("div",qn,[e("div",zn,[I[9]||(I[9]=e("div",{class:"banner-icon"},[e("i",{class:"mdi mdi-radar"})],-1)),e("div",Jn,[I[7]||(I[7]=e("h3",null,"Untracked Devices Found",-1)),e("p",null,m(s.value.length)+" device"+m(s.value.length>1?"s":"")+" with learned commands found in Broadlink storage",1)]),e("button",{onClick:I[0]||(I[0]=L=>c.value=!0),class:"btn btn-primary"},[...I[8]||(I[8]=[e("i",{class:"mdi mdi-eye"},null,-1),T(" View Devices ",-1)])])]),c.value?(l(),n("div",{key:0,class:"modal-overlay",onClick:I[3]||(I[3]=me(L=>c.value=!1,["self"]))},[e("div",Wn,[e("div",Kn,[I[11]||(I[11]=e("h2",null,"Discovered Devices",-1)),e("button",{onClick:I[1]||(I[1]=L=>c.value=!1),class:"close-btn"},[...I[10]||(I[10]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Xn,[I[16]||(I[16]=e("p",{class:"info-text"}," These devices have learned commands in Broadlink storage but are not being tracked. Adopt them to manage their commands and generate Home Assistant entities. ",-1)),e("div",Gn,[(l(!0),n(pe,null,$e(s.value,L=>(l(),n("div",{key:L.device_name,class:"discovered-device"},[e("div",Yn,[I[13]||(I[13]=e("div",{class:"device-icon"},[e("i",{class:"mdi mdi-devices"})],-1)),e("div",Zn,[e("h4",null,m(L.device_name),1),e("span",Qn,[I[12]||(I[12]=e("i",{class:"mdi mdi-remote"},null,-1)),T(" "+m(L.command_count)+" command"+m(L.command_count>1?"s":""),1)])])]),e("div",es,[e("button",{onClick:J=>o(L),class:"btn btn-primary"},[...I[14]||(I[14]=[e("i",{class:"mdi mdi-plus"},null,-1),T(" Adopt ",-1)])],8,ts),e("button",{onClick:J=>x(L),class:"btn btn-danger",title:"Delete all commands"},[...I[15]||(I[15]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,os)])]))),128))])]),e("div",ls,[e("button",{onClick:I[2]||(I[2]=L=>c.value=!1),class:"btn btn-secondary"}," Close ")])])])):R("",!0),f.value?(l(),n("div",{key:1,class:"modal-overlay",onClick:I[6]||(I[6]=me(L=>f.value=!1,["self"]))},[e("div",ns,[e("div",ss,[I[18]||(I[18]=e("h2",null,"Delete Untracked Device",-1)),e("button",{onClick:I[4]||(I[4]=L=>f.value=!1),class:"close-btn"},[...I[17]||(I[17]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",as,[e("div",is,[I[20]||(I[20]=e("i",{class:"mdi mdi-alert"},null,-1)),e("div",null,[e("p",null,[e("strong",null,'Are you sure you want to delete "'+m((a=S.value)==null?void 0:a.device_name)+'"?',1)]),e("p",null,"This will permanently delete all "+m((b=S.value)==null?void 0:b.command_count)+" command"+m(((p=S.value)==null?void 0:p.command_count)>1?"s":"")+" from Broadlink storage.",1),I[19]||(I[19]=e("p",{class:"warning-text"},"This action cannot be undone.",-1))])])]),e("div",rs,[e("button",{onClick:I[5]||(I[5]=L=>f.value=!1),class:"btn btn-secondary",disabled:C.value}," Cancel ",8,ds),e("button",{onClick:q,class:"btn btn-danger",disabled:C.value},[e("i",{class:G(["mdi",C.value?"mdi-loading mdi-spin":"mdi-delete"])},null,2),T(" "+m(C.value?"Deleting...":"Delete"),1)],8,us)])])])):R("",!0)])):R("",!0)}}},ms=Ce(cs,[["__scopeId","data-v-783e943f"]]),vs={class:"device-list-card"},ps={class:"card-header"},fs={class:"header-badges"},gs={class:"header-info"},ys={class:"header-right"},bs={key:0,class:"view-toggle-group header-view-toggle"},hs={class:"settings-menu-container"},ks=["disabled"],ws=["disabled"],$s={class:"card-body"},Cs={key:0,class:"filter-bar"},_s={class:"filter-search-row"},Ss=["title"],Is={key:0,class:"filter-badge"},Ds={class:"search-input-wrapper"},Ts={class:"filter-content"},xs={class:"filter-row filter-row-dropdowns"},Ms={class:"filter-group"},Rs=["value"],Ls={class:"filter-group"},As=["value"],Os={class:"filter-group"},Es={key:0,class:"filter-group filter-toggle"},Vs={class:"toggle-label"},Ps={class:"filter-results"},Us={key:1,class:"loading-state"},Fs={key:2,class:"error-state"},js={key:3,class:"empty-state"},Ns={key:4,class:"device-grid"},Bs={key:6,class:"no-results"},Hs={__name:"DeviceList",setup(t){const u=ft(),i=Be(),{isMobile:w}=Ye(),h=g(!1),s=g(!1),c=g(null),f=g(!1),S=g(!1),C=g(null),O=g(null),$=g(!0),o=g(!1),x=g(!1),U=g(window.innerWidth<=767?"grid":localStorage.getItem("device_view_mode")||"grid");re(w,_=>{_&&U.value==="list"&&(U.value="grid")}),re(U,_=>{localStorage.setItem("device_view_mode",_)});const I=()=>{$.value=!$.value,$.value||(S.value=!1)},a=()=>{$.value||($.value=!0),S.value=!S.value},b=g(!1),p=g({title:"Error",message:"",suggestion:"",details:"",error:null,context:{}}),L=g(!1),J=g({success:!1,title:"",message:""}),Z=g(!1),B=g({search:"",broadlinkDevice:"",area:"",entityType:"",showSmartIROnly:!1}),ae=g([]),A=xe("smartirStatus"),N=xe("smartirEnabled"),oe=K(()=>{var k;return localStorage.getItem("smartir_simulate_not_installed")==="true"?!1:((k=A==null?void 0:A.value)==null?void 0:k.installed)||!1}),ue=K(()=>{const _=new Map;return u.devices.forEach(k=>{if(k.broadlink_entity){const F=ae.value.find(le=>le.entity_id===k.broadlink_entity),z=F&&F.name||k.broadlink_entity;_.set(k.broadlink_entity,{entity_id:k.broadlink_entity,friendly_name:z})}}),Array.from(_.values()).sort((k,F)=>k.friendly_name.localeCompare(F.friendly_name))}),ke=K(()=>{const _=new Set;return u.devices.forEach(k=>{k.area&&_.add(k.area)}),Array.from(_).sort()}),Se=K(()=>{let _=u.devices;if(B.value.search){const F=B.value.search.toLowerCase();_=_.filter(z=>{var ge,ce,Ie,Ee,Ue;if((ge=z.name)!=null&&ge.toLowerCase().includes(F)||(ce=z.entity_type)!=null&&ce.toLowerCase().includes(F)||(Ie=z.area)!=null&&Ie.toLowerCase().includes(F)||(Ee=z.id)!=null&&Ee.toLowerCase().includes(F)||Object.keys(z.commands||{}).some(Ve=>Ve.toLowerCase().includes(F)))return!0;const we=ae.value.find(Ve=>Ve.entity_id===z.broadlink_entity);return!!((Ue=we==null?void 0:we.name)!=null&&Ue.toLowerCase().includes(F))})}B.value.broadlinkDevice&&(_=_.filter(F=>F.broadlink_entity===B.value.broadlinkDevice||F.controller_device===B.value.broadlinkDevice)),B.value.area&&(_=_.filter(F=>F.area===B.value.area)),B.value.entityType&&(_=_.filter(F=>F.entity_type===B.value.entityType)),B.value.showSmartIROnly&&(_=_.filter(F=>F.device_type==="smartir"));const k=localStorage.getItem("smartir_simulate_not_installed")==="true";return(!(N!=null&&N.value)||k)&&(_=_.filter(F=>F.device_type!=="smartir")),_}),Me=K(()=>B.value.search||B.value.broadlinkDevice||B.value.area||B.value.entityType||B.value.showSmartIROnly),Te=K(()=>{let _=0;return B.value.search&&_++,B.value.broadlinkDevice&&_++,B.value.area&&_++,B.value.entityType&&_++,B.value.showSmartIROnly&&_++,_}),D=()=>{B.value.search="",B.value.broadlinkDevice="",B.value.area="",B.value.entityType="",B.value.showSmartIROnly=!1},d=async()=>{try{const _=await ne.get("/api/remote/devices");ae.value=_.data.devices||[]}catch(_){console.error("Error loading remote devices:",_)}};re(U,_=>{localStorage.setItem("device_view_mode",_)}),Ae(async()=>{await Promise.all([u.loadDevices(),d()])});const V=_=>{c.value=_,h.value=!0},ve=K(()=>{if(!C.value)return"";const _=Object.keys(C.value.commands||{}).length;return _===0?"This device has no commands. The device will be removed from tracking.":`This device has ${_} learned command${_>1?"s":""}. What would you like to do?`}),Oe=K(()=>{if(!C.value)return"";const _=Object.keys(C.value.commands||{}).length;return _===0?"":`Also delete all ${_} command${_>1?"s":""} from Broadlink storage`}),be=_=>{C.value=_,f.value=!0},W=()=>{f.value=!1,C.value=null},E=async _=>{var F,z;const k=C.value;f.value=!1;try{await u.deleteDevice(k.id,_),O.value&&await O.value.refresh()}catch(le){const we=((z=(F=le.response)==null?void 0:F.data)==null?void 0:z.error)||le.message||"Unknown error";j("Failed to Delete Device",we)}finally{C.value=null}},Q=async _=>{var k,F,z,le,we;try{console.log("💾 Saving device data:",_),console.log("💾 Device commands:",_.commands),console.log("💾 Selected device:",c.value),(k=c.value)!=null&&k.id&&c.value.id!==null?await u.updateDevice(c.value.id,_):await u.createDevice(_),H(),O.value&&await O.value.refresh()}catch(ge){let ce="Failed to save device",Ie="",Ee="";(z=(F=ge.response)==null?void 0:F.data)!=null&&z.error?(ce=ge.response.data.error,Ie=ge.response.data.suggestion||""):ge.message&&(ce=ge.message),ge.response&&(Ee=`Status: ${ge.response.status}
URL: ${((le=ge.config)==null?void 0:le.url)||"N/A"}`),j("Failed to Save Device",ce,Ie,Ee,ge,{action:"save_device",deviceData:_,isEdit:!!((we=c.value)!=null&&we.id)})}},H=()=>{h.value=!1,c.value=null},v=_=>{c.value=_,s.value=!0},y=()=>{s.value=!1,c.value=null},j=(_,k,F="",z="",le=null,we={})=>{p.value={title:_,message:k,suggestion:F,details:z,error:le,context:we},b.value=!0},ee=()=>{b.value=!1},M=()=>{L.value=!1},r=async _=>{if(console.log("📥 DeviceList: Command learned:",_),!_||!_.deviceId||!c.value){console.warn("⚠️ DeviceList: Missing required data in learned event");return}const k=c.value.commands||{},F={...k,[_.commandName]:{command_type:_.commandType,type:_.commandType}};console.log(`✅ DeviceList: Optimistically adding command '${_.commandName}'`),console.log(`✅ DeviceList: Command count: ${Object.keys(k).length} -> ${Object.keys(F).length}`),c.value={...c.value,commands:F},console.log("🔄 DeviceList: Force reloading all devices from API"),await u.loadDevices(!0),O.value&&O.value.refresh()},P=_=>{const k=_.split("_"),F=[];for(let z=0;z<k.length;z++){const le=k[z],we=k[z+1];le&&we==="s"&&k[z+2]?(F.push(le.charAt(0).toUpperCase()+le.slice(1)+"'s"),z++):le!=="s"&&F.push(le.charAt(0).toUpperCase()+le.slice(1))}return F.join(" ")},Y=(_,k)=>{const F=_.toLowerCase(),z=k.map(ce=>ce.toLowerCase());return F.includes("lamp")||F.includes("light")?"light":F.includes("fan")?"fan":F.includes("tv")||F.includes("stereo")||F.includes("speaker")||F.includes("receiver")?"media_player":F.includes("blind")||F.includes("curtain")||F.includes("shade")||F.includes("garage")?"cover":z.some(ce=>ce.includes("volume")||ce.includes("channel")||ce.includes("play")||ce.includes("pause")||ce.includes("mute"))?"media_player":z.some(ce=>ce.includes("fan_speed")||ce.includes("fan_low")||ce.includes("fan_high"))?"fan":z.some(ce=>ce.includes("open")||ce.includes("close")||ce.includes("stop"))?"cover":"switch"},ie=(_,k)=>{const F=_.toLowerCase();return F.includes("tv")?"mdi:television":F.includes("stereo")||F.includes("receiver")||F.includes("speaker")?"mdi:speaker":F.includes("lamp")?"mdi:lamp":F.includes("light")?"mdi:lightbulb":F.includes("fan")?"mdi:fan":F.includes("blind")?"mdi:blinds":F.includes("curtain")?"mdi:curtains":F.includes("garage")?"mdi:garage":{light:"mdi:lightbulb",fan:"mdi:fan",switch:"mdi:light-switch",media_player:"mdi:speaker",cover:"mdi:window-shutter"}[k]||"mdi:devices"},de=_=>{const k=_.toLowerCase().split("_");for(let le=0;le<k.length-2;le++)if(k[le+1]==="s"){const we=k.slice(le,le+3),ge=P(we.join("_"));return console.log("Detected possessive area:",ge,"from",_),ge}const F=[["living","room"],["dining","room"],["master","bedroom"],["guest","bedroom"],["family","room"],["laundry","room"],["home","office"]];for(let le=0;le<k.length-1;le++){const we=[k[le],k[le+1]],ge=F.find(ce=>ce[0]===we[0]&&ce[1]===we[1]);if(ge)return P(ge.join("_"))}const z=["kitchen","bedroom","bathroom","garage","office","basement","attic","hallway","entryway","patio","deck","yard","garden"];for(const le of k)if(z.includes(le))return le.charAt(0).toUpperCase()+le.slice(1);return""},se=async _=>{var k,F;try{const z=P(_.device_name),le=de(_.device_name),we=Y(_.device_name,_.commands),ge=ie(_.device_name,we);let ce="";try{console.log("Finding Broadlink owner for:",_.device_name);const Ve=await ne.post("/api/devices/find-broadlink-owner",{device_name:_.device_name});console.log("Broadlink owner response:",Ve.data),ce=Ve.data.broadlink_entity||"",console.log("Detected Broadlink entity:",ce)}catch(Ve){console.error("Error finding Broadlink owner:",Ve)}console.log("Fetching command data from Broadlink storage...");const Ee=(await ne.get(`/api/commands/broadlink/${_.device_name}`)).data.commands||{};console.log("Fetched command data:",Ee);const Ue={};for(const[Ve,Ke]of Object.entries(Ee)){const it=typeof Ke=="string"&&Ke.length>200;Ue[Ve]={data:Ke,type:it?"rf":"ir",name:Ve,learned_at:new Date().toISOString()}}console.log("Transformed commands:",Ue),c.value={id:null,device:_.device_name,name:z,entity_type:we,commands:Ue,area:le,icon:ge,broadlink_entity:ce,enabled:!0},h.value=!0,i.success(`Imported ${Object.keys(Ue).length} commands from Broadlink storage`)}catch(z){console.error("Error adopting device:",z),i.error("Failed to adopt device: "+(((F=(k=z.response)==null?void 0:k.data)==null?void 0:F.error)||z.message))}},te=async()=>{x.value=!0;try{await u.syncAllAreas(),i.success("Areas synced from Home Assistant")}catch(_){console.error("Error syncing areas:",_),i.error("Failed to sync areas")}finally{x.value=!1}},fe=async()=>{var _,k;o.value=!0;try{const F=await ne.post("/api/entities/generate",{});if(F.data.success){const z=F.data.broadlink_count||0,le=F.data.smartir_count||0,we=F.data.total_count||0,ge=F.data.errors||[];let ce="✅ Entity Generation Successful",Ie=[];const Ee=[];z>0&&Ee.push(`${z} Broadlink native`),le>0&&Ee.push(`${le} SmartIR`),Ee.length>0&&Ie.push(`Generated ${Ee.join(" and ")} entity configuration${we!==1?"s":""}.`),z>0&&(Ie.push(`
📁 Broadlink entities created in:`),Ie.push("  • broadlink_manager/entities.yaml"),Ie.push("  • broadlink_manager/helpers.yaml")),le>0&&(Ie.push(`
📁 SmartIR entities created in:`),Ie.push("  • smartir/climate.yaml"),Ie.push("  • smartir/media_player.yaml"),Ie.push("  • smartir/fan.yaml")),Ie.push(`
📝 Next steps:`),Ie.push("1. Check your configuration.yaml includes the generated files"),Ie.push("2. Restart Home Assistant to load the new entities"),ge.length>0&&(ce="⚠️ Entity Generation Completed with Errors",Ie.push(`
⚠️ ${ge.length} error${ge.length!==1?"s":""} occurred:`),ge.forEach(Ue=>{Ie.push(`  • ${Ue}`)})),J.value={success:!0,title:ce,message:Ie.join(`
`)},L.value=!0}else J.value={success:!1,title:"❌ Entity Generation Failed",message:F.data.message||`Failed to generate entities.

Please check that you have at least one device configured.`},L.value=!0}catch(F){console.error("Error generating entities:",F);const z=((k=(_=F.response)==null?void 0:_.data)==null?void 0:k.error)||F.message||"Unknown error occurred";J.value={success:!1,title:"❌ Entity Generation Error",message:`Failed to generate entities:

${z}

Please check the logs for more details.`},L.value=!0}finally{o.value=!1}},Re=async({device:_,command:k})=>{var F,z;try{const le={device_id:_.id,command_name:k,entity_id:_.broadlink_entity||_.controller_device};await ne.post("/api/commands/test/direct",le),i.success(`Sent ${k} to ${_.name}`)}catch(le){console.error("Error sending command:",le);const we=((z=(F=le.response)==null?void 0:F.data)==null?void 0:z.error)||le.message||"Unknown error";i.error(`Failed to send ${k}: ${we}`)}};return(_,k)=>{var F;return l(),n("div",vs,[e("div",ps,[e("button",{class:"icon-button chevron-button",onClick:I},[e("i",{class:G(["mdi",$.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2)]),e("div",{class:"header-left",onClick:I},[k[14]||(k[14]=e("div",{class:"header-icon"},[e("i",{class:"mdi mdi-devices"})],-1)),e("h3",null,m(_e(w)?"Devices":"Managed Devices"),1),e("div",fs,[e("span",gs,m(_e(u).deviceCount)+" devices",1)])]),e("div",ys,[_e(w)?R("",!0):(l(),n("div",bs,[e("button",{onClick:k[0]||(k[0]=me(z=>U.value="grid",["stop"])),class:G(["view-toggle-btn",{active:U.value==="grid"}]),title:"Grid View"},[...k[15]||(k[15]=[e("i",{class:"mdi mdi-view-grid"},null,-1)])],2),e("button",{onClick:k[1]||(k[1]=me(z=>U.value="list",["stop"])),class:G(["view-toggle-btn",{active:U.value==="list"}]),title:"List View"},[...k[16]||(k[16]=[e("i",{class:"mdi mdi-view-list"},null,-1)])],2)])),e("button",{onClick:k[2]||(k[2]=me(z=>h.value=!0,["stop"])),class:"btn btn-primary new-button"},[...k[17]||(k[17]=[e("i",{class:"mdi mdi-plus"},null,-1),e("span",null,"New",-1)])]),e("div",hs,[e("button",{onClick:me(a,["stop"]),class:G(["icon-button settings-button",{active:S.value}]),title:"Settings"},[...k[18]||(k[18]=[e("i",{class:"mdi mdi-cog"},null,-1)])],2),S.value?(l(),n("div",{key:0,class:"settings-dropdown",onClick:k[5]||(k[5]=me(()=>{},["stop"]))},[e("button",{onClick:k[3]||(k[3]=z=>{te(),S.value=!1}),class:"menu-item",disabled:x.value},[e("i",{class:G(["mdi",x.value?"mdi-loading mdi-spin":"mdi-refresh"])},null,2),e("span",null,m(x.value?"Syncing Areas...":"Sync Areas"),1)],8,ks),e("button",{onClick:k[4]||(k[4]=z=>{fe(),S.value=!1}),class:"menu-item",disabled:o.value},[e("i",{class:G(["mdi",o.value?"mdi-loading mdi-spin":"mdi-file-code"])},null,2),e("span",null,m(o.value?"Generating...":"Generate Entities"),1)],8,ws)])):R("",!0)])])]),X(e("div",$s,[he(ms,{ref_key:"discoveryRef",ref:O,onAdopt:se},null,512),_e(u).hasDevices?(l(),n("div",Cs,[e("div",_s,[e("button",{class:G(["filter-toggle-button",{active:Z.value||Me.value}]),onClick:k[6]||(k[6]=z=>Z.value=!Z.value),title:Z.value?"Hide filters":"Show filters"},[k[19]||(k[19]=e("i",{class:"mdi mdi-filter-variant"},null,-1)),Me.value?(l(),n("span",Is,m(Te.value),1)):R("",!0)],10,Ss),e("div",Ds,[k[20]||(k[20]=e("i",{class:"mdi mdi-magnify search-icon"},null,-1)),X(e("input",{"onUpdate:modelValue":k[7]||(k[7]=z=>B.value.search=z),type:"text",placeholder:"Search devices, commands...",class:"search-input"},null,512),[[Le,B.value.search]])])]),X(e("div",Ts,[e("div",xs,[e("div",Ms,[e("label",null,[k[22]||(k[22]=e("i",{class:"mdi mdi-access-point"},null,-1)),X(e("select",{"onUpdate:modelValue":k[8]||(k[8]=z=>B.value.broadlinkDevice=z)},[k[21]||(k[21]=e("option",{value:""},"All Controller Devices",-1)),(l(!0),n(pe,null,$e(ue.value,z=>(l(),n("option",{key:z.entity_id,value:z.entity_id},m(z.friendly_name),9,Rs))),128))],512),[[De,B.value.broadlinkDevice]])])]),e("div",Ls,[e("label",null,[k[24]||(k[24]=e("i",{class:"mdi mdi-home-map-marker"},null,-1)),X(e("select",{"onUpdate:modelValue":k[9]||(k[9]=z=>B.value.area=z)},[k[23]||(k[23]=e("option",{value:""},"All Areas",-1)),(l(!0),n(pe,null,$e(ke.value,z=>(l(),n("option",{key:z,value:z},m(z),9,As))),128))],512),[[De,B.value.area]])])]),e("div",Os,[e("label",null,[k[26]||(k[26]=e("i",{class:"mdi mdi-shape"},null,-1)),X(e("select",{"onUpdate:modelValue":k[10]||(k[10]=z=>B.value.entityType=z)},[...k[25]||(k[25]=[je('<option value="" data-v-68660d56>All Types</option><option value="light" data-v-68660d56>Light</option><option value="fan" data-v-68660d56>Fan</option><option value="switch" data-v-68660d56>Switch</option><option value="media_player" data-v-68660d56>Media Player</option><option value="cover" data-v-68660d56>Cover</option><option value="climate" data-v-68660d56>Climate</option>',7)])],512),[[De,B.value.entityType]])])]),oe.value?(l(),n("div",Es,[e("label",Vs,[k[27]||(k[27]=e("span",{class:"toggle-text"},[e("img",{src:Ze,alt:"SmartIR",class:"smartir-icon"}),T(" SmartIR Only ")],-1)),X(e("input",{type:"checkbox","onUpdate:modelValue":k[11]||(k[11]=z=>B.value.showSmartIROnly=z),class:"toggle-checkbox"},null,512),[[ye,B.value.showSmartIROnly]]),k[28]||(k[28]=e("span",{class:"toggle-slider"},null,-1))])])):R("",!0),Me.value?(l(),n("button",{key:1,onClick:D,class:"btn-clear-filters"},[...k[29]||(k[29]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),T(" Clear ",-1)])])):R("",!0),e("div",Ps,m(Se.value.length)+" of "+m(_e(u).deviceCount),1)])],512),[[Je,Z.value]])])):R("",!0),_e(u).loading?(l(),n("div",Us,[...k[30]||(k[30]=[e("i",{class:"mdi mdi-loading mdi-spin"},null,-1),e("p",null,"Loading devices...",-1)])])):_e(u).error?(l(),n("div",Fs,[k[31]||(k[31]=e("i",{class:"mdi mdi-alert-circle"},null,-1)),e("p",null,m(_e(u).error),1),e("button",{onClick:k[12]||(k[12]=z=>_e(u).loadDevices()),class:"btn btn-secondary"}," Retry ")])):_e(u).hasDevices?R("",!0):(l(),n("div",js,[k[33]||(k[33]=e("i",{class:"mdi mdi-devices"},null,-1)),k[34]||(k[34]=e("h3",null,"No Devices Yet",-1)),k[35]||(k[35]=e("p",null,"Get started by adding your first managed device",-1)),e("button",{onClick:k[13]||(k[13]=z=>h.value=!0),class:"btn btn-primary"},[...k[32]||(k[32]=[e("i",{class:"mdi mdi-plus"},null,-1),T(" Add Your First Device ",-1)])])])),U.value==="grid"?(l(),n("div",Ns,[(l(!0),n(pe,null,$e(Se.value,z=>(l(),Pe(Ut,{key:z.id,device:z,"broadlink-devices":ae.value,onEdit:V,onDelete:be,onLearn:v},null,8,["device","broadlink-devices"]))),128))])):U.value==="list"&&Se.value.length>0?(l(),Pe(lo,{key:5,devices:Se.value,onSendCommand:Re,onEditDevice:V,onDeleteDevice:be},null,8,["devices"])):R("",!0),_e(u).hasDevices&&Se.value.length===0?(l(),n("div",Bs,[...k[36]||(k[36]=[e("i",{class:"mdi mdi-filter-off"},null,-1),e("h3",null,"No devices match your filters",-1),e("p",null,"Try adjusting your search or filter criteria",-1)])])):R("",!0)],512),[[Je,$.value]]),h.value?(l(),Pe(Ll,{key:0,device:c.value,onSave:Q,onCancel:H},null,8,["device"])):R("",!0),s.value?(l(),Pe(Rn,{key:1,device:c.value,onLearned:r,onCancel:y},null,8,["device"])):R("",!0),he(Fe,{isOpen:f.value,title:`Delete ${(F=C.value)==null?void 0:F.name}?`,message:ve.value,confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,checkboxLabel:Oe.value,onConfirm:E,onCancel:W},null,8,["isOpen","title","message","checkboxLabel"]),he(Hn,{isOpen:b.value,title:p.value.title,message:p.value.message,suggestion:p.value.suggestion,details:p.value.details,error:p.value.error,context:p.value.context,onClose:ee},null,8,["isOpen","title","message","suggestion","details","error","context"]),he(Fe,{isOpen:L.value,title:J.value.title,message:J.value.message,confirmText:"OK",showCancel:!1,dangerMode:!J.value.success,onConfirm:M,onCancel:M},null,8,["isOpen","title","message","dangerMode"])])}}},qs=Ce(Hs,[["__scopeId","data-v-68660d56"]]),zs={class:"banner-content"},Js={class:"banner-icon"},Ws={class:"banner-message"},Ks={class:"banner-actions"},Xs={__name:"SmartIRBanner",setup(t){const u=xe("smartirStatus"),i=g(!1),w=K(()=>!(!u.value||i.value||localStorage.getItem("smartir_banner_dismissed")==="true")),h=K(()=>{var O;return(O=u.value)!=null&&O.installed?"banner-success":"banner-info"}),s=K(()=>{var O;return(O=u.value)!=null&&O.installed?"mdi mdi-check-circle":"mdi mdi-information"}),c=K(()=>{var O;return(O=u.value)!=null&&O.installed?`SmartIR Detected (v${u.value.version})`:"Want Climate Device Support?"}),f=K(()=>{var O;return(O=u.value)!=null&&O.installed?"You can now create climate device profiles with full temperature and HVAC mode control.":"Install SmartIR to unlock AC/heater control with temperature settings, HVAC modes, and 120+ pre-configured device profiles."});function S(){window.open("https://github.com/smartHomeHub/SmartIR","_blank")}function C(){var O;if(i.value=!0,(O=u.value)!=null&&O.installed)localStorage.setItem("smartir_banner_dismissed","true");else{const $=parseInt(localStorage.getItem("smartir_banner_dismiss_count")||"0");$>=2?localStorage.setItem("smartir_banner_dismissed","true"):localStorage.setItem("smartir_banner_dismiss_count",String($+1))}}return Ae(()=>{var o;const O=localStorage.getItem("smartir_last_status"),$=(o=u.value)!=null&&o.installed?"installed":"not_installed";O!==$&&(localStorage.removeItem("smartir_banner_dismissed"),localStorage.removeItem("smartir_banner_dismiss_count"),localStorage.setItem("smartir_last_status",$))}),(O,$)=>{var o,x;return w.value?(l(),n("div",{key:0,class:G(["smartir-banner",h.value])},[e("div",zs,[e("div",Js,[e("i",{class:G(s.value)},null,2)]),e("div",Ws,[e("strong",null,m(c.value),1),e("p",null,m(f.value),1)]),e("div",Ks,[(o=O.status)!=null&&o.installed?R("",!0):(l(),n("button",{key:0,onClick:S,class:"btn-primary"}," Learn More ")),e("button",{onClick:C,class:"btn-text"},m((x=O.status)!=null&&x.installed?"Got it":"Dismiss"),1)])])],2)):R("",!0)}}},Gs=Ce(Xs,[["__scopeId","data-v-7bbcbcd7"]]),Ne="api/smartir",st={async getStatus(){try{const t=await fetch(`${Ne}/status`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return await t.json()}catch(t){return console.error("Error fetching SmartIR status:",t),{installed:!1,version:null,error:t.message}}},async getInstallInstructions(){try{const t=await fetch(`${Ne}/install-instructions`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return await t.json()}catch(t){throw console.error("Error fetching install instructions:",t),t}},async getPlatforms(){try{const t=await fetch(`${Ne}/platforms`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return await t.json()}catch(t){throw console.error("Error fetching platforms:",t),t}},async getPlatformCodes(t){try{const u=await fetch(`${Ne}/platforms/${t}/codes`);if(!u.ok)throw new Error(`HTTP error! status: ${u.status}`);return await u.json()}catch(u){throw console.error(`Error fetching codes for ${t}:`,u),u}},async getNextCode(t){try{const u=await fetch(`${Ne}/platforms/${t}/next-code`);if(!u.ok)throw new Error(`HTTP error! status: ${u.status}`);return await u.json()}catch(u){throw console.error(`Error fetching next code for ${t}:`,u),u}},async validateCode(t,u){try{const i=await fetch(`${Ne}/validate-code`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({platform:t,code:u})});if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);return await i.json()}catch(i){throw console.error("Error validating code:",i),i}}},Ys={class:"profile-card"},Zs={class:"profile-card-header"},Qs=["title"],ea={class:"profile-details"},ta=["title"],oa={class:"profile-meta"},la=["title"],na=["title"],sa=["title"],aa={class:"profile-card-footer"},ia=["title"],ra={key:0,class:"learned-indicator"},da={class:"profile-actions"},ua={__name:"SmartIRProfileCard",props:{profile:{type:Object,required:!0}},emits:["edit","download","delete","commands"],setup(t){const u=t,i=nt(K(()=>u.profile.platform)),w=c=>c.replace(/_/g," ").replace(/\b\w/g,f=>f.toUpperCase()),h=c=>c&&c.startsWith("mdi:")?`mdi ${c.replace(":"," mdi-")}`:`mdi mdi-${c}`,s=c=>{if(!c)return"";const f=c.toLowerCase();return f.includes("broadlink")?"broadlink-tag":f.includes("not set")?"not-set-tag":"default-controller-tag"};return(c,f)=>(l(),n("div",Ys,[e("div",Zs,[e("div",{class:G(["profile-icon",_e(i).colorClass.value]),title:w(t.profile.platform)},[e("i",{class:G(h(_e(i).icon.value))},null,2)],10,Qs),e("div",ea,[e("h4",{title:`${t.profile.manufacturer} ${t.profile.model}`},m(t.profile.manufacturer)+" "+m(t.profile.model),9,ta),e("div",oa,[e("span",{class:"tag platform-tag",title:w(t.profile.platform)},m(w(t.profile.platform)),9,la),t.profile.controllerBrand?(l(),n("span",{key:0,class:G(["tag controller-tag",s(t.profile.controllerBrand)]),title:"Controller: "+t.profile.controllerBrand},[f[4]||(f[4]=e("i",{class:"mdi mdi-remote-tv"},null,-1)),T(" "+m(t.profile.controllerBrand),1)],10,na)):R("",!0)])]),e("div",{class:"code-badge",title:"Device Code: "+t.profile.code},m(t.profile.code),9,sa)]),e("div",aa,[e("div",{class:"profile-stats",title:t.profile.commandCount+" total commands"+(t.profile.learnedCount>0?", "+t.profile.learnedCount+" learned":"")},[f[5]||(f[5]=e("i",{class:"mdi mdi-remote"},null,-1)),e("span",null,m(t.profile.commandCount)+" command"+m(t.profile.commandCount!==1?"s":""),1),t.profile.learnedCount>0?(l(),n("span",ra,"( "+m(t.profile.learnedCount)+" learned )",1)):R("",!0)],8,ia),e("div",da,[e("button",{onClick:f[0]||(f[0]=S=>c.$emit("commands")),class:"action-btn",title:"Commands"},[...f[6]||(f[6]=[e("i",{class:"mdi mdi-remote"},null,-1)])]),e("button",{onClick:f[1]||(f[1]=S=>c.$emit("edit")),class:"action-btn",title:"Edit Profile"},[...f[7]||(f[7]=[e("i",{class:"mdi mdi-pencil"},null,-1)])]),e("button",{onClick:f[2]||(f[2]=S=>c.$emit("download")),class:"action-btn",title:"Download JSON"},[...f[8]||(f[8]=[e("i",{class:"mdi mdi-download"},null,-1)])]),e("button",{onClick:f[3]||(f[3]=S=>c.$emit("delete")),class:"action-btn delete",title:"Delete Profile"},[...f[9]||(f[9]=[e("i",{class:"mdi mdi-delete"},null,-1)])])])])]))}},ca=Ce(ua,[["__scopeId","data-v-aad9720f"]]),ma={name:"SmartIRProfileListView",props:{profiles:{type:Array,required:!0}},methods:{getPlatformIcon(t){return{climate:"mdi-thermostat",media_player:"mdi-television",fan:"mdi-fan",light:"mdi-lightbulb"}[t]||"mdi-devices"},formatPlatform(t){return{climate:"Climate",media_player:"Media Player",fan:"Fan",light:"Light"}[t]||t},editProfile(t){this.$emit("edit",t)},viewCommands(t){this.$emit("commands",t)},downloadProfile(t){this.$emit("download",t)},deleteProfile(t){this.$emit("delete",t)}}},va={class:"profile-list-view"},pa={class:"profile-table"},fa={class:"profile-code"},ga={class:"code-badge"},ya={class:"profile-manufacturer"},ba={class:"profile-model"},ha={class:"model-info"},ka={class:"model-name"},wa={key:0,class:"model-count"},$a={class:"profile-platform"},Ca={class:"profile-controller"},_a={class:"profile-commands"},Sa={class:"command-stats"},Ia={class:"stat-item"},Da={key:0,class:"stat-item learned"},Ta={class:"profile-actions"},xa=["onClick"],Ma=["onClick"],Ra=["onClick"],La=["onClick"];function Aa(t,u,i,w,h,s){return l(),n("div",va,[e("table",pa,[u[6]||(u[6]=e("thead",null,[e("tr",null,[e("th",null,"Code"),e("th",null,"Manufacturer"),e("th",null,"Model"),e("th",null,"Platform"),e("th",null,"Controller"),e("th",null,"Commands"),e("th",null,"Actions")])],-1)),e("tbody",null,[(l(!0),n(pe,null,$e(i.profiles,c=>(l(),n("tr",{key:`${c.platform}-${c.code}`,class:"profile-row"},[e("td",fa,[e("span",ga,m(c.code),1)]),e("td",ya,m(c.manufacturer||"Unknown"),1),e("td",ba,[e("div",ha,[e("div",ka,m(c.model||"Unknown"),1),c.models&&c.models.length>1?(l(),n("div",wa," +"+m(c.models.length-1)+" more ",1)):R("",!0)])]),e("td",$a,[e("span",{class:G(["platform-badge",c.platform])},[e("i",{class:G(["mdi",s.getPlatformIcon(c.platform)])},null,2),T(" "+m(s.formatPlatform(c.platform)),1)],2)]),e("td",Ca,m(c.controller_brand||"N/A"),1),e("td",_a,[e("div",Sa,[e("span",Ia,[u[0]||(u[0]=e("i",{class:"mdi mdi-remote"},null,-1)),T(" "+m(c.command_count||0),1)]),c.learned_count>0?(l(),n("span",Da,[u[1]||(u[1]=e("i",{class:"mdi mdi-school"},null,-1)),T(" "+m(c.learned_count),1)])):R("",!0)])]),e("td",Ta,[e("button",{class:"action-btn edit",onClick:f=>s.editProfile(c),title:"Edit Profile"},[...u[2]||(u[2]=[e("i",{class:"mdi mdi-pencil"},null,-1)])],8,xa),e("button",{class:"action-btn commands",onClick:f=>s.viewCommands(c),title:"View Commands"},[...u[3]||(u[3]=[e("i",{class:"mdi mdi-remote"},null,-1)])],8,Ma),e("button",{class:"action-btn download",onClick:f=>s.downloadProfile(c),title:"Download"},[...u[4]||(u[4]=[e("i",{class:"mdi mdi-download"},null,-1)])],8,Ra),e("button",{class:"action-btn delete",onClick:f=>s.deleteProfile(c),title:"Delete"},[...u[5]||(u[5]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,La)])]))),128))])])])}const Oa=Ce(ma,[["render",Aa],["__scopeId","data-v-d3773038"]]),Ea={class:"modal-container"},Va={class:"modal-body"},Pa={key:0,class:"selection-section"},Ua={class:"form-group"},Fa={class:"form-group"},ja={class:"form-group"},Na={key:0,class:"code-info"},Ba={class:"form-actions"},Ha=["disabled"],qa={key:1,class:"testing-section"},za={class:"code-header"},Ja={class:"code-details"},Wa={class:"code-badge"},Ka={class:"device-selector"},Xa=["value"],Ga={key:0,class:"helper-text"},Ya={class:"commands-section"},Za={class:"commands-header"},Qa={key:0,class:"tested-count"},ei={key:0,class:"filters-section"},ti={class:"filter-row"},oi={class:"filter-row"},li={key:1,class:"empty-state"},ni={key:2,class:"empty-state"},si={key:3,class:"commands-list"},ai={class:"command-name"},ii={class:"command-actions"},ri={key:0,class:"status-badge success"},di=["onClick","disabled","title"],ui={__name:"SmartIRCodeTester",props:{isOpen:{type:Boolean,default:!1}},emits:["close","clone"],setup(t,{emit:u}){const i=t,w=u,h=xe("toast"),s=g("climate"),c=g(""),f=g([]),S=g(!1),C=g(null),O=g(""),$=g([]),o=g(!1),x=K(()=>$.value.map(H=>({code:H.code,label:`${H.models.join(", ")} (Code: ${H.code})`,value:H.code}))),q=g(null),U=g(null),I=g(!1),a=g([]),b=g(""),p=g([]),L=g(new Set),J=g(null),Z=g(""),B=g(""),ae=g(""),A=g(""),N=K(()=>{let H=p.value;if(Z.value){const v=Z.value.toLowerCase();H=H.filter(y=>(y.label||y.name).toLowerCase().includes(v))}return B.value&&(H=H.filter(v=>v.mode===B.value)),ae.value&&(H=H.filter(v=>v.fanSpeed===ae.value)),A.value&&(H=H.filter(v=>v.swingMode===A.value)),H}),oe=K(()=>Z.value||B.value||ae.value||A.value);re(()=>i.isOpen,H=>{H&&(ue(),Se())}),re(s,()=>{i.isOpen&&(c.value="",C.value=null,$.value=[],ue())});async function ue(){var H;S.value=!0;try{const v=await ne.get("/api/smartir/codes/manufacturers",{params:{entity_type:s.value}});f.value=v.data.manufacturers||[]}catch(v){console.error("Error loading manufacturers:",v),(H=h.value)==null||H.error("Failed to load manufacturers","❌ Error")}finally{S.value=!1}}async function ke(){var H;if(c.value){o.value=!0;try{const v=await ne.get("/api/smartir/codes/models",{params:{entity_type:s.value,manufacturer:c.value}});$.value=v.data.models||[]}catch(v){console.error("Error loading models:",v),(H=h.value)==null||H.error("Failed to load models","❌ Error")}finally{o.value=!1}}}async function Se(){try{const H=await ne.get("/api/remote/devices");a.value=H.data.devices||[]}catch(H){console.error("Error loading Broadlink devices:",H)}}async function Me(){var H,v;if(C.value){I.value=!0;try{const y=await ne.get("/api/smartir/codes/code",{params:{entity_type:s.value,code_id:C.value.code}});U.value=y.data.code,q.value=C.value.code,Te(y.data.code),(H=h.value)==null||H.success(`Loaded ${p.value.length} commands`,"✅ Code Loaded")}catch(y){console.error("Error loading code:",y),(v=h.value)==null||v.error(y.message||"Failed to load code","❌ Error")}finally{I.value=!1}}}function Te(H){const v=[];if(!H.commands){p.value=v;return}if(s.value==="climate"){const j=H.commands;for(const[ee,M]of Object.entries(j)){if(ee==="off"){typeof M=="string"&&v.push({name:"off",label:"OFF",data:M,mode:"off"});continue}if(typeof M=="object"){for(const[r,P]of Object.entries(M))if(typeof P=="object")for(const[Y,ie]of Object.entries(P)){if(typeof ie!="object")continue;const de=Object.keys(ie),se=de.includes("24")?"24":de[0];if(se&&typeof ie[se]=="string"){const te=`${ee}_${se}_${r}_${Y}`,fe=`${ee.toUpperCase()} ${se}°C ${r} ${Y}`;v.push({name:te,label:fe,data:ie[se],mode:ee,temperature:se,fanSpeed:r,swingMode:Y})}}}}}else for(const[j,ee]of Object.entries(H.commands))typeof ee=="string"&&v.push({name:j,label:j.toUpperCase().replace(/_/g," "),data:ee});p.value=v}async function D(H){var v,y,j;if(!b.value){(v=h.value)==null||v.warning("Please select a Broadlink device first","⚠️ No Device");return}J.value=H;try{const ee=p.value.find(M=>M.name===H);if(!ee||!ee.data)throw new Error(`Command "${H}" not found`);await ne.post("/api/commands/send-raw",{entity_id:b.value,command:ee.data,command_type:"ir"}),L.value.add(H),(y=h.value)==null||y.success(`Command sent: ${ee.label||H}`,"✅ Tested")}catch(ee){console.error("Error testing command:",ee),(j=h.value)==null||j.error("Failed to test command","❌ Error")}finally{J.value=null}}function d(){var H,v,y,j;if(!U.value){(H=h.value)==null||H.error("No profile data to download","❌ Error");return}try{const ee=U.value.manufacturer||"unknown",M=((v=U.value.supportedModels)==null?void 0:v[0])||q.value,r=`${ee.toLowerCase().replace(/\s+/g,"_")}_${M.toLowerCase().replace(/\s+/g,"_")}.json`,P=JSON.stringify(U.value,null,2),Y=new Blob([P],{type:"application/json"}),ie=URL.createObjectURL(Y),de=document.createElement("a");de.href=ie,de.download=r,document.body.appendChild(de),de.click(),document.body.removeChild(de),URL.revokeObjectURL(ie),(y=h.value)==null||y.success(`Downloaded ${r}`,"✅ Download Complete")}catch(ee){console.error("Error downloading JSON:",ee),(j=h.value)==null||j.error(ee.message||"Failed to download JSON","❌ Download Error")}}function V(){c.value="",C.value=null,O.value="",$.value=[]}function ve(){C.value=null,O.value="",ke()}function Oe(){O.value?C.value=$.value.find(H=>H.code===O.value):C.value=null}function be(){Z.value="",B.value="",ae.value="",A.value=""}function W(){q.value=null,U.value=null,p.value=[],L.value.clear(),J.value=null,be()}function E(H){const v=H.toLowerCase();return v.includes("power")||v.includes("off")||v==="off"?"mdi-power":v.includes("cool")?"mdi-snowflake":v.includes("heat")?"mdi-fire":v.includes("fan")?"mdi-fan":v.includes("auto")?"mdi-auto-fix":v.includes("dry")?"mdi-water-percent":v.includes("temp")?"mdi-thermometer":v.includes("swing")?"mdi-swap-vertical":"mdi-remote"}function Q(){W(),c.value="",C.value=null,w("close")}return(H,v)=>{var y;return t.isOpen?(l(),n("div",{key:0,class:"modal-overlay",onClick:me(Q,["self"])},[e("div",Ea,[e("div",{class:"modal-header"},[v[9]||(v[9]=e("h3",null,[e("i",{class:"mdi mdi-test-tube"}),T(" Test SmartIR Code ")],-1)),e("button",{onClick:Q,class:"close-btn"},[...v[8]||(v[8]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Va,[q.value?(l(),n("div",qa,[e("div",za,[e("div",Ja,[e("h4",null,m(U.value.manufacturer)+" - "+m(((y=U.value.supportedModels)==null?void 0:y[0])||"Unknown"),1),e("span",Wa,"Code: "+m(q.value),1)]),e("button",{onClick:W,class:"btn-secondary-small"},[...v[14]||(v[14]=[e("i",{class:"mdi mdi-arrow-left"},null,-1),T(" Change Code ",-1)])])]),e("div",Ka,[v[17]||(v[17]=e("label",null,[e("i",{class:"mdi mdi-remote"}),T(" Broadlink Device ")],-1)),X(e("select",{"onUpdate:modelValue":v[3]||(v[3]=j=>b.value=j),class:"form-select"},[v[15]||(v[15]=e("option",{value:""},"Select device to test with...",-1)),(l(!0),n(pe,null,$e(a.value,j=>(l(),n("option",{key:j.entity_id,value:j.entity_id},m(j.friendly_name||j.entity_id),9,Xa))),128))],512),[[De,b.value]]),b.value?R("",!0):(l(),n("p",Ga,[...v[16]||(v[16]=[e("i",{class:"mdi mdi-information-outline"},null,-1),T(" Select a Broadlink device to enable command testing ",-1)])]))]),e("div",Ya,[e("div",Za,[e("h5",null,"Sample Commands ("+m(N.value.length)+" / "+m(p.value.length)+")",1),L.value.size>0?(l(),n("span",Qa,m(L.value.size)+" tested ",1)):R("",!0)]),s.value==="climate"&&p.value.length>0?(l(),n("div",ei,[e("div",ti,[X(e("input",{"onUpdate:modelValue":v[4]||(v[4]=j=>Z.value=j),type:"text",placeholder:"Search commands...",class:"search-input"},null,512),[[Le,Z.value]])]),e("div",oi,[X(e("select",{"onUpdate:modelValue":v[5]||(v[5]=j=>B.value=j),class:"filter-select"},[...v[18]||(v[18]=[e("option",{value:""},"All Modes",-1),e("option",{value:"cool"},"Cool",-1),e("option",{value:"heat"},"Heat",-1),e("option",{value:"off"},"Off",-1)])],512),[[De,B.value]]),X(e("select",{"onUpdate:modelValue":v[6]||(v[6]=j=>ae.value=j),class:"filter-select"},[...v[19]||(v[19]=[je('<option value="" data-v-66569200>All Fan Speeds</option><option value="low" data-v-66569200>Low</option><option value="mid" data-v-66569200>Mid</option><option value="high" data-v-66569200>High</option><option value="auto" data-v-66569200>Auto</option>',5)])],512),[[De,ae.value]]),X(e("select",{"onUpdate:modelValue":v[7]||(v[7]=j=>A.value=j),class:"filter-select"},[...v[20]||(v[20]=[e("option",{value:""},"All Swing",-1),e("option",{value:"stop"},"Stop",-1),e("option",{value:"swing"},"Swing",-1)])],512),[[De,A.value]]),oe.value?(l(),n("button",{key:0,onClick:be,class:"btn-clear-filters"},[...v[21]||(v[21]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),T(" Clear ",-1)])])):R("",!0)])])):R("",!0),p.value.length===0?(l(),n("div",li,[...v[22]||(v[22]=[e("i",{class:"mdi mdi-alert-circle"},null,-1),e("p",null,"No commands found in this code",-1)])])):N.value.length===0?(l(),n("div",ni,[v[23]||(v[23]=e("i",{class:"mdi mdi-filter-off"},null,-1)),v[24]||(v[24]=e("p",null,"No commands match your filters",-1)),e("button",{onClick:be,class:"btn-secondary-small"}," Clear Filters ")])):(l(),n("div",si,[(l(!0),n(pe,null,$e(N.value,j=>(l(),n("div",{key:j.name,class:G(["command-item",{tested:L.value.has(j.name),testing:J.value===j.name}])},[e("div",ai,[e("i",{class:G(["mdi",E(j.mode||j.name)])},null,2),e("span",null,m(j.label||j.name),1)]),e("div",ii,[L.value.has(j.name)?(l(),n("span",ri,[...v[25]||(v[25]=[e("i",{class:"mdi mdi-check"},null,-1),T(" Tested ",-1)])])):R("",!0),e("button",{onClick:ee=>D(j.name),disabled:!b.value||J.value===j.name,title:b.value?"Test this command":"Select a Broadlink device first",class:"btn-test"},[e("i",{class:G(["mdi",J.value===j.name?"mdi-loading mdi-spin":"mdi-play"])},null,2),v[26]||(v[26]=T(" Test ",-1))],8,di)])],2))),128))]))]),e("div",{class:"modal-actions"},[e("button",{onClick:d,class:"btn-primary"},[...v[27]||(v[27]=[e("i",{class:"mdi mdi-download"},null,-1),T(" Download JSON ",-1)])]),e("button",{onClick:Q,class:"btn-secondary"}," Close ")])])):(l(),n("div",Pa,[v[13]||(v[13]=e("div",{class:"info-banner"},[e("i",{class:"mdi mdi-information"}),e("p",null,"Select a SmartIR code from the index to test commands with your Broadlink device.")],-1)),e("div",Ua,[v[11]||(v[11]=e("label",null,[e("i",{class:"mdi mdi-shape"}),T(" Platform ")],-1)),X(e("select",{"onUpdate:modelValue":v[0]||(v[0]=j=>s.value=j),onChange:V,class:"form-select"},[...v[10]||(v[10]=[e("option",{value:"climate"},"Climate (AC/Heater)",-1),e("option",{value:"media_player"},"Media Player (TV/Audio)",-1),e("option",{value:"fan"},"Fan",-1),e("option",{value:"light"},"Light",-1)])],544),[[De,s.value]])]),e("div",Fa,[he(We,{modelValue:c.value,"onUpdate:modelValue":v[1]||(v[1]=j=>c.value=j),options:f.value,label:"Manufacturer",placeholder:"Search manufacturers...",loading:S.value,disabled:S.value,onChange:ve},null,8,["modelValue","options","loading","disabled"])]),e("div",ja,[he(We,{modelValue:O.value,"onUpdate:modelValue":v[2]||(v[2]=j=>O.value=j),options:x.value,"option-label":"label","option-value":"code",label:"Model",placeholder:"Search models...",loading:o.value,disabled:!c.value||o.value,onChange:Oe},null,8,["modelValue","options","loading","disabled"])]),C.value?(l(),n("div",Na,[v[12]||(v[12]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[e("strong",null,m(c.value)+" - "+m(C.value.models[0]),1),e("p",null,"Code: "+m(C.value.code),1)])])):R("",!0),e("div",Ba,[e("button",{onClick:Me,disabled:!C.value||I.value,class:"btn-primary"},[e("i",{class:G(["mdi",I.value?"mdi-loading mdi-spin":"mdi-download"])},null,2),T(" "+m(I.value?"Loading...":"Load Commands"),1)],8,Ha)])]))])])])):R("",!0)}}},ci=Ce(ui,[["__scopeId","data-v-66569200"]]),mi={class:"smartir-status-card"},vi={class:"card-header"},pi=["src"],fi={class:"header-badges"},gi=["title"],yi={class:"header-info"},bi={class:"header-info"},hi={class:"header-info"},ki={class:"header-right"},wi={key:0,class:"view-toggle-group header-view-toggle"},$i={key:2,class:"settings-menu-container"},Ci={key:0,class:"card-body loading-state"},_i={key:1,class:"card-body error-state"},Si={key:2,class:"card-body installed-state"},Ii={key:0,class:"help-panel"},Di={key:0,class:"recommendation"},Ti={key:0,class:"next-steps"},xi={class:"help-actions"},Mi={key:1,class:"filter-bar"},Ri={class:"filter-search-row"},Li=["title"],Ai={key:0,class:"filter-badge"},Oi={class:"search-input-wrapper"},Ei={class:"filter-content"},Vi={class:"filter-row"},Pi={class:"filter-group"},Ui={class:"filter-results"},Fi={key:2,class:"loading-state"},ji={key:3,class:"empty-state"},Ni={key:4,class:"profiles-grid"},Bi={key:6,class:"no-results"},Hi={key:3,class:"card-body not-installed-state"},qi={class:"benefits-section"},zi={class:"benefits-list"},Ji={class:"recommendation"},Wi={__name:"SmartIRStatusCard",emits:["create-profile","edit-profile"],setup(t,{expose:u,emit:i}){const w=i,h=xe("smartirStatus");xe("smartirEnabled");const s=xe("refreshSmartIR"),{isMobile:c}=Ye(),f=g(!1),S=g(null),C=g((h==null?void 0:h.value)||null),O=g(localStorage.getItem("smartir_simulate_not_installed")==="true"),$=g(!1),o=g(!1),x=g(!0),q=g([]),U=g(!1),I=g(!1),a=g({search:"",platform:""}),b=g({show:!1,title:"",message:"",platform:null,profile:null}),p=g(!1),J=g(window.innerWidth<=767?"grid":localStorage.getItem("profile_view_mode")||"grid");re(c,v=>{v&&J.value==="list"&&(J.value="grid")}),re(J,v=>{localStorage.setItem("profile_view_mode",v)}),re(x,v=>{v||(o.value=!1)});const Z=["Full climate entity support (AC, heaters)","120+ pre-configured device profiles","Temperature and humidity sensor integration","HVAC mode control (heat, cool, auto, dry, fan)"],B=["climate","media_player","fan","light"],ae=K(()=>O.value?{installed:!1,recommendation:{message:"Install SmartIR to unlock climate device support!",benefits:["Full climate entity support (AC, heaters)","120+ pre-configured device profiles","Temperature and humidity sensor integration","HVAC mode control (heat, cool, auto, dry, fan)"]}}:C.value),A=K(()=>{var v,y;return((y=(v=ae.value)==null?void 0:v.platforms)==null?void 0:y.length)||0}),N=K(()=>{var v;return(v=ae.value)!=null&&v.device_counts?Object.values(ae.value.device_counts).reduce((y,j)=>y+j,0):0});function oe(){var v;O.value=!O.value,localStorage.setItem("smartir_simulate_not_installed",O.value.toString()),!O.value&&((v=C.value)!=null&&v.installed)&&be()}const ue=K(()=>{let v=q.value;if(a.value.search){const y=a.value.search.toLowerCase();v=v.filter(j=>{var ee,M,r,P;return((ee=j.manufacturer)==null?void 0:ee.toLowerCase().includes(y))||((M=j.model)==null?void 0:M.toLowerCase().includes(y))||((r=j.code)==null?void 0:r.toString().includes(y))||((P=j.platform)==null?void 0:P.toLowerCase().includes(y))})}return a.value.platform&&(v=v.filter(y=>y.platform===a.value.platform)),v}),ke=K(()=>a.value.search||a.value.platform),Se=K(()=>{let v=0;return a.value.search&&v++,a.value.platform&&v++,v});function Me(){a.value.search="",a.value.platform=""}async function Te(){f.value=!0,S.value=null;try{if(s)await s();else{const v=await st.getStatus();C.value=v}}catch(v){S.value=v.message||"Failed to refresh SmartIR status",console.error("Error refreshing SmartIR status:",v)}finally{f.value=!1}}function D(){w("create-profile")}function d(){$.value=!$.value,o.value=!1}function V(){x.value||(x.value=!0),o.value=!o.value}function ve(){p.value=!0,o.value=!1}function Oe(){window.open("https://github.com/smartHomeHub/SmartIR","_blank")}async function be(){U.value=!0;const v=[];try{for(const y of B)try{const ee=((await ne.get(`/api/smartir/platforms/${y}/profiles`)).data.profiles||[]).map(M=>({...M,platform:y}));v.push(...ee)}catch(j){console.warn(`Network error loading ${y} profiles (using bundled index):`,j.message)}q.value=v}catch(y){console.error("Unexpected error loading profiles:",y)}finally{U.value=!1}}function W(v,y,j){w("edit-profile",{platform:v,profile:y,startStep:j})}async function E(v,y){var j,ee;try{const r=(await ne.get(`/api/smartir/platforms/${v}/profiles/${y.code}`)).data,P=JSON.stringify(r.profile,null,2),Y=new Blob([P],{type:"application/json"}),ie=URL.createObjectURL(Y),de=document.createElement("a");de.href=ie,de.download=`smartir_${v}_${y.manufacturer}_${y.model}_${y.code}.json`,document.body.appendChild(de),de.click(),document.body.removeChild(de),URL.revokeObjectURL(ie),(j=xe("toast").value)==null||j.success(`Downloaded ${y.manufacturer} ${y.model}`,"✅ Profile Downloaded")}catch(M){console.error("Error downloading profile:",M),(ee=xe("toast").value)==null||ee.error("Failed to download profile","❌ Download Error")}}async function Q(v,y){xe("toast");try{const ee=(await ne.post(`/api/smartir/profiles/${y.code}/check-usage`,{platform:v})).data;if(ee&&ee.in_use){b.value={show:!0,title:`Cannot Delete ${y.manufacturer} ${y.model}`,message:`This profile is currently in use by ${ee.device_count} device(s):

${ee.devices.join(`
`)}

Please remove or reassign these devices before deleting the profile.`,platform:v,profile:y,canDelete:!1,devices:ee.devices};return}}catch(j){console.error("Error checking profile usage:",j)}b.value={show:!0,title:`Delete ${y.manufacturer} ${y.model}?`,message:`Device Code: ${y.code}

This will remove the profile and update your configuration.`,platform:v,profile:y,canDelete:!0}}async function H(){var ee,M;const v=xe("toast"),{platform:y,profile:j}=b.value;b.value.show=!1;try{await ne.delete(`/api/smartir/profiles/${j.code}`,{data:{platform:y}}),await be(),await ot(),await Te(),(ee=v.value)==null||ee.success(`${j.manufacturer} ${j.model} has been removed`,"✅ Profile Deleted")}catch(r){console.error("Error deleting profile:",r),(M=v.value)==null||M.error("Failed to delete profile","❌ Delete Error")}}return re(h,v=>{v&&(C.value=v)},{immediate:!0}),re(J,v=>{localStorage.setItem("profile_view_mode",v)}),Ae(async()=>{var v;h!=null&&h.value&&(C.value=h.value),C.value||await Te(),(v=C.value)!=null&&v.installed&&await be()}),u({loadAllProfiles:be,refreshStatus:Te}),(v,y)=>{var j,ee,M,r,P,Y,ie,de,se;return l(),n("div",mi,[e("div",vi,[e("button",{class:"icon-button chevron-button",onClick:y[0]||(y[0]=te=>x.value=!x.value)},[e("i",{class:G(["mdi",x.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2)]),e("div",{class:"header-left",onClick:y[1]||(y[1]=te=>x.value=!x.value)},[e("img",{src:_e(Ze),alt:"SmartIR",class:"smartir-logo"},null,8,pi),e("h3",null,m(_e(c)?"SmartIR":"SmartIR Integration"),1),e("div",fi,[e("div",{class:G(["simulation-toggle-pill",{active:O.value}]),onClick:me(oe,["stop"]),title:O.value?"Click to show as installed":"Click to simulate not-installed"},[e("i",{class:G(["mdi",O.value?"mdi-eye-off":"mdi-eye"])},null,2),e("span",null,m(O.value?"Simulating: Not Installed":"Simulation Mode"),1)],10,gi),(j=ae.value)!=null&&j.installed?(l(),n(pe,{key:0},[y[16]||(y[16]=e("div",{class:"status-badge-mini success"},[e("i",{class:"mdi mdi-check-circle"}),e("span",null,"Installed")],-1)),e("span",yi,"v"+m(ae.value.version||"Unknown"),1),e("span",bi,m(A.value)+" platform"+m(A.value!==1?"s":""),1),e("span",hi,m(N.value)+" device"+m(N.value!==1?"s":""),1)],64)):R("",!0)])]),e("div",ki,[!_e(c)&&((ee=ae.value)!=null&&ee.installed)?(l(),n("div",wi,[e("button",{onClick:y[2]||(y[2]=me(te=>J.value="grid",["stop"])),class:G(["view-toggle-btn",{active:J.value==="grid"}]),title:"Grid View"},[...y[17]||(y[17]=[e("i",{class:"mdi mdi-view-grid"},null,-1)])],2),e("button",{onClick:y[3]||(y[3]=me(te=>J.value="list",["stop"])),class:G(["view-toggle-btn",{active:J.value==="list"}]),title:"List View"},[...y[18]||(y[18]=[e("i",{class:"mdi mdi-view-list"},null,-1)])],2)])):R("",!0),(M=ae.value)!=null&&M.installed?(l(),n("button",{key:1,onClick:me(D,["stop"]),class:"btn btn-primary new-button"},[...y[19]||(y[19]=[e("i",{class:"mdi mdi-plus"},null,-1),e("span",null,"New",-1)])])):R("",!0),(r=ae.value)!=null&&r.installed?(l(),n("div",$i,[e("button",{onClick:me(V,["stop"]),class:G(["icon-button settings-button",{active:o.value}]),title:"Settings"},[...y[20]||(y[20]=[e("i",{class:"mdi mdi-cog"},null,-1)])],2),o.value?(l(),n("div",{key:0,class:"settings-dropdown",onClick:y[5]||(y[5]=me(()=>{},["stop"]))},[e("button",{onClick:d,class:"menu-item"},[y[21]||(y[21]=e("i",{class:"mdi mdi-help-circle"},null,-1)),e("span",null,m($.value?"Hide Help":"Show Help"),1)]),e("button",{onClick:y[4]||(y[4]=te=>{o.value=!1,Te()}),class:"menu-item"},[...y[22]||(y[22]=[e("i",{class:"mdi mdi-refresh"},null,-1),e("span",null,"Refresh Status",-1)])]),e("button",{onClick:ve,class:"menu-item"},[...y[23]||(y[23]=[e("i",{class:"mdi mdi-test-tube"},null,-1),e("span",null,"Test Codes",-1)])])])):R("",!0)])):R("",!0)])]),X(e("div",null,[f.value?(l(),n("div",Ci,[...y[24]||(y[24]=[e("div",{class:"spinner"},null,-1),e("p",null,"Checking SmartIR installation...",-1)])])):S.value?(l(),n("div",_i,[y[25]||(y[25]=e("i",{class:"mdi mdi-alert-circle"},null,-1)),e("p",null,m(S.value),1),e("button",{onClick:Te,class:"btn-secondary"}," Try Again ")])):(P=ae.value)!=null&&P.installed?(l(),n("div",Si,[$.value?(l(),n("div",Ii,[C.value.recommendation?(l(),n("div",Di,[e("p",null,m(C.value.recommendation.message),1),C.value.recommendation.next_steps?(l(),n("div",Ti,[y[26]||(y[26]=e("strong",null,"Next Steps:",-1)),e("ul",null,[(l(!0),n(pe,null,$e(C.value.recommendation.next_steps,(te,fe)=>(l(),n("li",{key:fe},m(te),1))),128))])])):R("",!0)])):R("",!0),e("div",xi,[e("button",{onClick:y[6]||(y[6]=(...te)=>v.viewDocumentation&&v.viewDocumentation(...te)),class:"btn-secondary"},[...y[27]||(y[27]=[e("i",{class:"mdi mdi-book-open-variant"},null,-1),T(" View Documentation ",-1)])])])])):R("",!0),q.value.length>0&&!O.value?(l(),n("div",Mi,[e("div",Ri,[e("button",{class:G(["filter-toggle-button",{active:I.value||ke.value}]),onClick:y[7]||(y[7]=te=>I.value=!I.value),title:I.value?"Hide filters":"Show filters"},[y[28]||(y[28]=e("i",{class:"mdi mdi-filter-variant"},null,-1)),ke.value?(l(),n("span",Ai,m(Se.value),1)):R("",!0)],10,Li),e("div",Oi,[y[29]||(y[29]=e("i",{class:"mdi mdi-magnify search-icon"},null,-1)),X(e("input",{"onUpdate:modelValue":y[8]||(y[8]=te=>a.value.search=te),type:"text",placeholder:"Search profiles...",class:"search-input"},null,512),[[Le,a.value.search]])])]),X(e("div",Ei,[e("div",Vi,[e("div",Pi,[e("label",null,[y[31]||(y[31]=e("i",{class:"mdi mdi-shape"},null,-1)),X(e("select",{"onUpdate:modelValue":y[9]||(y[9]=te=>a.value.platform=te)},[...y[30]||(y[30]=[je('<option value="" data-v-4ef33ace>All Platforms</option><option value="climate" data-v-4ef33ace>Climate</option><option value="media_player" data-v-4ef33ace>Media Player</option><option value="fan" data-v-4ef33ace>Fan</option><option value="light" data-v-4ef33ace>Light</option>',5)])],512),[[De,a.value.platform]])])]),ke.value?(l(),n("button",{key:0,onClick:Me,class:"btn-clear-filters"},[...y[32]||(y[32]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),T(" Clear ",-1)])])):R("",!0),e("div",Ui,m(ue.value.length)+" of "+m(q.value.length),1)])],512),[[Je,I.value]])])):R("",!0),U.value?(l(),n("div",Fi,[...y[33]||(y[33]=[e("i",{class:"mdi mdi-loading mdi-spin"},null,-1),e("p",null,"Loading profiles...",-1)])])):q.value.length===0?(l(),n("div",ji,[...y[34]||(y[34]=[e("i",{class:"mdi mdi-file-document-outline"},null,-1),e("h3",null,"No Profiles Yet",-1),e("p",null,"Create your first SmartIR profile to get started",-1)])])):R("",!0),J.value==="grid"&&!O.value?(l(),n("div",Ni,[(l(!0),n(pe,null,$e(ue.value,te=>(l(),Pe(ca,{key:`${te.platform}-${te.code}`,profile:te,onEdit:fe=>W(te.platform,te),onCommands:fe=>W(te.platform,te,2),onDownload:fe=>E(te.platform,te),onDelete:fe=>Q(te.platform,te)},null,8,["profile","onEdit","onCommands","onDownload","onDelete"]))),128))])):J.value==="list"&&!O.value&&ue.value.length>0?(l(),Pe(Oa,{key:5,profiles:ue.value,onEdit:y[10]||(y[10]=te=>W(te.platform,te)),onCommands:y[11]||(y[11]=te=>W(te.platform,te,2)),onDownload:y[12]||(y[12]=te=>E(te.platform,te)),onDelete:y[13]||(y[13]=te=>Q(te.platform,te))},null,8,["profiles"])):R("",!0),q.value.length>0&&ue.value.length===0&&!O.value?(l(),n("div",Bi,[...y[35]||(y[35]=[e("i",{class:"mdi mdi-filter-off"},null,-1),e("h3",null,"No profiles match your filters",-1),e("p",null,"Try adjusting your search or filter criteria",-1)])])):R("",!0)])):(l(),n("div",Hi,[y[39]||(y[39]=e("div",{class:"status-badge warning"},[e("i",{class:"mdi mdi-information"}),e("span",null,"Not Installed")],-1)),e("div",qi,[y[37]||(y[37]=e("h4",null,"Why Install SmartIR?",-1)),e("ul",zi,[(l(!0),n(pe,null,$e(((ie=(Y=C.value)==null?void 0:Y.recommendation)==null?void 0:ie.benefits)||Z,(te,fe)=>(l(),n("li",{key:fe},[y[36]||(y[36]=e("i",{class:"mdi mdi-check"},null,-1)),e("span",null,m(te),1)]))),128))])]),e("div",Ji,[e("p",null,m(((se=(de=C.value)==null?void 0:de.recommendation)==null?void 0:se.message)||"Install SmartIR to unlock climate device support!"),1)]),e("div",{class:"card-actions"},[e("button",{onClick:Oe,class:"btn-primary"},[...y[38]||(y[38]=[e("i",{class:"mdi mdi-github"},null,-1),T(" Install SmartIR ",-1)])])])]))],512),[[Je,x.value]]),he(Fe,{isOpen:b.value.show,title:b.value.title,message:b.value.message,confirmText:b.value.canDelete===!1?null:"Delete",cancelText:"Close",dangerMode:!0,confirmDisabled:b.value.canDelete===!1,onConfirm:H,onCancel:y[14]||(y[14]=te=>b.value.show=!1)},null,8,["isOpen","title","message","confirmText","confirmDisabled"]),he(ci,{isOpen:p.value,onClose:y[15]||(y[15]=te=>p.value=!1)},null,8,["isOpen"])])}}},Ki=Ce(Wi,[["__scopeId","data-v-4ef33ace"]]),Xi={class:"climate-form"},Gi={class:"learning-mode-section"},Yi={class:"mode-toggle"},Zi={class:"mode-content"},Qi={class:"mode-stats"},er={class:"stat-badge"},tr={class:"stat-badge time"},or={class:"mode-content"},lr={class:"mode-stats"},nr={class:"stat-badge"},sr={class:"stat-badge time warning"},ar={key:0,class:"command-breakdown"},ir={class:"warning-text"},rr={class:"form-section"},dr={key:0,class:"help-text"},ur={key:1,class:"help-text"},cr={class:"form-row"},mr={class:"form-group"},vr={class:"form-group"},pr={class:"form-group"},fr={key:2,class:"representative-temp-section"},gr={class:"form-group"},yr=["value"],br={class:"form-section"},hr={class:"checkbox-grid"},kr={class:"checkbox-item"},wr={class:"checkbox-item"},$r={class:"checkbox-item"},Cr={class:"checkbox-item"},_r={class:"checkbox-item"},Sr={class:"checkbox-item"},Ir={class:"form-section"},Dr={class:"checkbox-grid"},Tr={class:"checkbox-item"},xr={class:"checkbox-item"},Mr={class:"checkbox-item"},Rr={class:"checkbox-item"},Lr={class:"form-section"},Ar={class:"checkbox-grid"},Or={class:"checkbox-item"},Er={class:"checkbox-item"},Vr={class:"checkbox-item"},Pr={class:"checkbox-item"},Ur={class:"form-section"},Fr={class:"form-group"},jr={class:"form-group"},Nr={class:"form-group"},Br={key:0,class:"validation-summary"},Hr={__name:"ClimateProfileForm",props:{modelValue:{type:Object,default:()=>({})}},emits:["update:modelValue"],setup(t,{emit:u}){const i=t,w=u,h=g("quick"),s=g({minTemp:16,maxTemp:30,precision:1,representativeTemp:24,modes:["off","auto","cool","heat"],fanModes:["auto","low","medium","high"],swingModes:[],tempSensor:"",humiditySensor:"",powerSensor:"",learningMode:"quick",...i.modelValue}),c=K(()=>{const I=[],a=s.value.minTemp||16,b=s.value.maxTemp||30,p=s.value.precision||1;for(let L=a;L<=b;L+=p)I.push(L);return I}),f=K(()=>s.value.modes.filter(I=>I!=="off").length),S=K(()=>s.value.fanModes.length||1),C=K(()=>s.value.swingModes.length||1),O=K(()=>{const I=s.value.minTemp||16,a=s.value.maxTemp||30,b=s.value.precision||1;return Math.floor((a-I)/b)+1}),$=K(()=>{const I=s.value.modes.includes("off")?1:0;return f.value*S.value*C.value+I}),o=K(()=>Math.ceil($.value*30/60)),x=K(()=>{const I=s.value.modes.includes("off")?1:0;return f.value*O.value*S.value*C.value+I}),q=K(()=>Math.ceil(x.value*30/60)),U=K(()=>{const I=[];return(!s.value.minTemp||s.value.minTemp<10||s.value.minTemp>35)&&I.push("Minimum temperature must be between 10°C and 35°C"),(!s.value.maxTemp||s.value.maxTemp<10||s.value.maxTemp>35)&&I.push("Maximum temperature must be between 10°C and 35°C"),s.value.minTemp>=s.value.maxTemp&&I.push("Minimum temperature must be less than maximum temperature"),(!s.value.modes||s.value.modes.length===0)&&I.push("At least one HVAC mode must be selected"),I});return re(h,I=>{s.value.learningMode=I}),re(s,I=>{w("update:modelValue",I)},{deep:!0,immediate:!0}),(I,a)=>(l(),n("div",Xi,[a[63]||(a[63]=e("h3",null,"Climate Device Configuration",-1)),e("div",Gi,[e("div",Yi,[e("label",{class:G(["mode-option",{active:h.value==="quick"}])},[X(e("input",{type:"radio",value:"quick","onUpdate:modelValue":a[0]||(a[0]=b=>h.value=b)},null,512),[[ze,h.value]]),e("div",Zi,[a[23]||(a[23]=e("div",{class:"mode-header"},[e("i",{class:"mdi mdi-flash"}),e("strong",null,"Quick Mode (Recommended)")],-1)),a[24]||(a[24]=e("p",null,"Learn one temperature per mode combination",-1)),e("div",Qi,[e("span",er,m($.value)+" commands",1),e("span",tr,"~"+m(o.value)+" min",1)])])],2),e("label",{class:G(["mode-option",{active:h.value==="complete"}])},[X(e("input",{type:"radio",value:"complete","onUpdate:modelValue":a[1]||(a[1]=b=>h.value=b)},null,512),[[ze,h.value]]),e("div",or,[a[25]||(a[25]=e("div",{class:"mode-header"},[e("i",{class:"mdi mdi-check-all"}),e("strong",null,"Complete Mode")],-1)),a[26]||(a[26]=e("p",null,"Learn all temperature combinations",-1)),e("div",lr,[e("span",nr,m(x.value)+" commands",1),e("span",sr,"~"+m(q.value)+" min",1)])])],2)]),h.value==="complete"?(l(),n("div",ar,[a[27]||(a[27]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[e("strong",null,"Complete mode will require learning "+m(x.value)+" commands",1),e("p",null,"This includes all combinations of modes ("+m(f.value)+"), temperatures ("+m(O.value)+"), fan speeds ("+m(S.value)+"), and swing modes ("+m(C.value)+").",1),e("p",ir,"⏱️ Estimated time: "+m(q.value)+" minutes at ~30 seconds per command",1)])])):R("",!0)]),e("div",rr,[a[33]||(a[33]=e("h4",null,"Temperature Range",-1)),h.value==="quick"?(l(),n("p",dr," Define the full temperature range your device supports. You'll select one temperature to learn below. ")):(l(),n("p",ur," Define the temperature range. All temperatures in this range will be learned. ")),e("div",cr,[e("div",mr,[a[28]||(a[28]=e("label",null,"Minimum Temperature (°C) *",-1)),X(e("input",{"onUpdate:modelValue":a[2]||(a[2]=b=>s.value.minTemp=b),type:"number",min:"10",max:"35",placeholder:"16"},null,512),[[Le,s.value.minTemp,void 0,{number:!0}]])]),e("div",vr,[a[29]||(a[29]=e("label",null,"Maximum Temperature (°C) *",-1)),X(e("input",{"onUpdate:modelValue":a[3]||(a[3]=b=>s.value.maxTemp=b),type:"number",min:"10",max:"35",placeholder:"30"},null,512),[[Le,s.value.maxTemp,void 0,{number:!0}]])]),e("div",pr,[a[31]||(a[31]=e("label",null,"Precision",-1)),X(e("select",{"onUpdate:modelValue":a[4]||(a[4]=b=>s.value.precision=b)},[...a[30]||(a[30]=[e("option",{value:1},"1°C (Whole degrees)",-1),e("option",{value:.5},"0.5°C (Half degrees)",-1)])],512),[[De,s.value.precision,void 0,{number:!0}]])])]),h.value==="quick"?(l(),n("div",fr,[e("div",gr,[a[32]||(a[32]=e("label",null,"Representative Temperature to Learn *",-1)),X(e("select",{"onUpdate:modelValue":a[5]||(a[5]=b=>s.value.representativeTemp=b)},[(l(!0),n(pe,null,$e(c.value,b=>(l(),n("option",{key:b,value:b},m(b)+"°C ",9,yr))),128))],512),[[De,s.value.representativeTemp,void 0,{number:!0}]]),e("small",null,"This temperature will be learned for all mode combinations. The device profile will still show the full range ("+m(s.value.minTemp)+"°C - "+m(s.value.maxTemp)+"°C).",1)])])):R("",!0)]),e("div",br,[a[40]||(a[40]=e("h4",null,"Supported HVAC Modes *",-1)),a[41]||(a[41]=e("p",{class:"help-text"},"Select all modes your device supports",-1)),e("div",hr,[e("label",kr,[X(e("input",{type:"checkbox",value:"off","onUpdate:modelValue":a[6]||(a[6]=b=>s.value.modes=b)},null,512),[[ye,s.value.modes]]),a[34]||(a[34]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),T(" Off ")],-1))]),e("label",wr,[X(e("input",{type:"checkbox",value:"auto","onUpdate:modelValue":a[7]||(a[7]=b=>s.value.modes=b)},null,512),[[ye,s.value.modes]]),a[35]||(a[35]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-autorenew"}),T(" Auto ")],-1))]),e("label",$r,[X(e("input",{type:"checkbox",value:"cool","onUpdate:modelValue":a[8]||(a[8]=b=>s.value.modes=b)},null,512),[[ye,s.value.modes]]),a[36]||(a[36]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-snowflake"}),T(" Cool ")],-1))]),e("label",Cr,[X(e("input",{type:"checkbox",value:"heat","onUpdate:modelValue":a[9]||(a[9]=b=>s.value.modes=b)},null,512),[[ye,s.value.modes]]),a[37]||(a[37]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fire"}),T(" Heat ")],-1))]),e("label",_r,[X(e("input",{type:"checkbox",value:"dry","onUpdate:modelValue":a[10]||(a[10]=b=>s.value.modes=b)},null,512),[[ye,s.value.modes]]),a[38]||(a[38]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-water-percent"}),T(" Dry ")],-1))]),e("label",Sr,[X(e("input",{type:"checkbox",value:"fan_only","onUpdate:modelValue":a[11]||(a[11]=b=>s.value.modes=b)},null,512),[[ye,s.value.modes]]),a[39]||(a[39]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan"}),T(" Fan Only ")],-1))])])]),e("div",Ir,[a[46]||(a[46]=e("h4",null,"Fan Modes",-1)),a[47]||(a[47]=e("p",{class:"help-text"},"Select all fan speeds your device supports",-1)),e("div",Dr,[e("label",Tr,[X(e("input",{type:"checkbox",value:"auto","onUpdate:modelValue":a[12]||(a[12]=b=>s.value.fanModes=b)},null,512),[[ye,s.value.fanModes]]),a[42]||(a[42]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-autorenew"}),T(" Auto ")],-1))]),e("label",xr,[X(e("input",{type:"checkbox",value:"low","onUpdate:modelValue":a[13]||(a[13]=b=>s.value.fanModes=b)},null,512),[[ye,s.value.fanModes]]),a[43]||(a[43]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-1"}),T(" Low ")],-1))]),e("label",Mr,[X(e("input",{type:"checkbox",value:"medium","onUpdate:modelValue":a[14]||(a[14]=b=>s.value.fanModes=b)},null,512),[[ye,s.value.fanModes]]),a[44]||(a[44]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-2"}),T(" Medium ")],-1))]),e("label",Rr,[X(e("input",{type:"checkbox",value:"high","onUpdate:modelValue":a[15]||(a[15]=b=>s.value.fanModes=b)},null,512),[[ye,s.value.fanModes]]),a[45]||(a[45]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-3"}),T(" High ")],-1))])])]),e("div",Lr,[a[52]||(a[52]=e("h4",null,"Swing Modes (Optional)",-1)),a[53]||(a[53]=e("p",{class:"help-text"},"Select if your device has swing/oscillation",-1)),e("div",Ar,[e("label",Or,[X(e("input",{type:"checkbox",value:"off","onUpdate:modelValue":a[16]||(a[16]=b=>s.value.swingModes=b)},null,512),[[ye,s.value.swingModes]]),a[48]||(a[48]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-horizontal"}),T(" Off ")],-1))]),e("label",Er,[X(e("input",{type:"checkbox",value:"vertical","onUpdate:modelValue":a[17]||(a[17]=b=>s.value.swingModes=b)},null,512),[[ye,s.value.swingModes]]),a[49]||(a[49]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-vertical"}),T(" Vertical ")],-1))]),e("label",Vr,[X(e("input",{type:"checkbox",value:"horizontal","onUpdate:modelValue":a[18]||(a[18]=b=>s.value.swingModes=b)},null,512),[[ye,s.value.swingModes]]),a[50]||(a[50]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-horizontal"}),T(" Horizontal ")],-1))]),e("label",Pr,[X(e("input",{type:"checkbox",value:"both","onUpdate:modelValue":a[19]||(a[19]=b=>s.value.swingModes=b)},null,512),[[ye,s.value.swingModes]]),a[51]||(a[51]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-arrow-all"}),T(" Both ")],-1))])])]),e("div",Ur,[a[60]||(a[60]=e("h4",null,"Sensors (Optional)",-1)),a[61]||(a[61]=e("p",{class:"help-text"},"Link external sensors for better climate control",-1)),e("div",Fr,[a[54]||(a[54]=e("label",null,"Temperature Sensor",-1)),X(e("input",{"onUpdate:modelValue":a[20]||(a[20]=b=>s.value.tempSensor=b),type:"text",placeholder:"sensor.living_room_temperature"},null,512),[[Le,s.value.tempSensor]]),a[55]||(a[55]=e("small",null,"Entity ID of temperature sensor",-1))]),e("div",jr,[a[56]||(a[56]=e("label",null,"Humidity Sensor",-1)),X(e("input",{"onUpdate:modelValue":a[21]||(a[21]=b=>s.value.humiditySensor=b),type:"text",placeholder:"sensor.living_room_humidity"},null,512),[[Le,s.value.humiditySensor]]),a[57]||(a[57]=e("small",null,"Entity ID of humidity sensor",-1))]),e("div",Nr,[a[58]||(a[58]=e("label",null,"Power Sensor",-1)),X(e("input",{"onUpdate:modelValue":a[22]||(a[22]=b=>s.value.powerSensor=b),type:"text",placeholder:"binary_sensor.ac_power"},null,512),[[Le,s.value.powerSensor]]),a[59]||(a[59]=e("small",null,"Entity ID of power sensor (to detect on/off state)",-1))])]),U.value.length>0?(l(),n("div",Br,[a[62]||(a[62]=e("h4",null,[e("i",{class:"mdi mdi-alert-circle"}),T(" Please fix the following: ")],-1)),e("ul",null,[(l(!0),n(pe,null,$e(U.value,(b,p)=>(l(),n("li",{key:p},m(b),1))),128))])])):R("",!0)]))}},qr=Ce(Hr,[["__scopeId","data-v-c44d7198"]]),zr={class:"command-wizard"},Jr={class:"device-selection-section"},Wr={class:"input-wrapper"},Kr=["value"],Xr={key:0,class:"validation-tooltip"},Gr={class:"form-group"},Yr=["disabled"],Zr={key:0},Qr={key:1},ed={key:0,class:"edit-mode-banner"},td={class:"wizard-info"},od={key:0},ld={key:1},nd={class:"progress-info"},sd={class:"progress-bar"},ad={class:"progress-text"},id={class:"commands-grid"},rd={class:"command-header"},dd={class:"command-icon"},ud={class:"command-info"},cd={key:0,class:"learning-indicator"},md={key:0,class:"ir-learning-steps"},vd={key:1,class:"rf-learning-steps"},pd={class:"command-actions"},fd=["onClick","disabled"],gd={key:1,class:"learned-status"},yd=["onClick","disabled"],bd=["onClick"],hd={class:"quick-actions"},kd=["disabled"],wd=["disabled"],$d={__name:"CommandLearningWizard",props:{modelValue:{type:Object,default:()=>({})},platform:{type:String,required:!0},config:{type:Object,required:!0},broadlinkDevice:{type:String,default:""},manufacturer:{type:String,required:!0},model:{type:String,required:!0},commandType:{type:String,default:"ir"}},emits:["update:modelValue","update:broadlinkDevice","update:commandType"],setup(t,{emit:u}){const i=Be(),w=t,h=u,s=g({...w.modelValue}),c=g(null),f=g(null),S=g([]),C=g(w.broadlinkDevice),O=g(w.commandType),$=g(!1),o=g([]),x=g(!1),q=g(!1),U=g({show:!1,commandKey:null,commandLabel:""}),I=g(!1),a=K(()=>{const D=[];if(w.platform==="climate"){const d=w.config.modes||[],V=w.config.fanModes||[],ve=w.config.minTemp||16,Oe=w.config.maxTemp||30;d.forEach(be=>{if(be==="off")D.push({key:"off",label:"Power Off",description:"Turn device off",icon:"mdi mdi-power",mode:"off"});else for(let W=ve;W<=Oe;W++)V.forEach(E=>{const Q=`${be}_${W}_${E}`;D.push({key:Q,label:`${be.toUpperCase()} ${W}°C ${E}`,description:`Mode: ${be}, Temp: ${W}°C, Fan: ${E}`,icon:J(be),mode:be,temp:W,fanMode:E})})})}else if(w.platform==="media_player"){const d=w.config.features||[];d.includes("turn_on")&&(D.push({key:"turn_on",label:"Power On",description:"Turn on the device",icon:"mdi mdi-power"}),D.push({key:"turn_off",label:"Power Off",description:"Turn off the device",icon:"mdi mdi-power-off"})),d.includes("volume")&&(D.push({key:"volume_up",label:"Volume Up",description:"Increase volume",icon:"mdi mdi-volume-plus"}),D.push({key:"volume_down",label:"Volume Down",description:"Decrease volume",icon:"mdi mdi-volume-minus"})),d.includes("mute")&&D.push({key:"mute",label:"Mute",description:"Toggle mute",icon:"mdi mdi-volume-mute"}),d.includes("source")&&(D.push({key:"source_hdmi1",label:"Source: HDMI 1",description:"Switch to HDMI 1",icon:"mdi mdi-import"}),D.push({key:"source_hdmi2",label:"Source: HDMI 2",description:"Switch to HDMI 2",icon:"mdi mdi-import"}),D.push({key:"source_hdmi3",label:"Source: HDMI 3",description:"Switch to HDMI 3",icon:"mdi mdi-import"})),d.includes("channel")&&(D.push({key:"channel_up",label:"Channel Up",description:"Next channel",icon:"mdi mdi-chevron-up"}),D.push({key:"channel_down",label:"Channel Down",description:"Previous channel",icon:"mdi mdi-chevron-down"}))}else if(w.platform==="fan"){const d=w.config.speedLevels||3,V=w.config.features||[];D.push({key:"turn_on",label:"Power On",description:"Turn on the fan",icon:"mdi mdi-power"}),D.push({key:"turn_off",label:"Power Off",description:"Turn off the fan",icon:"mdi mdi-power-off"});for(let ve=1;ve<=d;ve++){const Oe=ve===1?"Low":ve===d?"High":ve===2&&d===3?"Medium":`Speed ${ve}`;D.push({key:`speed_${ve}`,label:`${Oe}`,description:`Set fan to speed level ${ve}`,icon:"mdi mdi-fan"})}V.includes("oscillate")&&(D.push({key:"oscillate_on",label:"Oscillate On",description:"Enable oscillation",icon:"mdi mdi-sync"}),D.push({key:"oscillate_off",label:"Oscillate Off",description:"Disable oscillation",icon:"mdi mdi-sync-off"})),V.includes("direction")&&(D.push({key:"direction_forward",label:"Direction: Forward",description:"Set direction to forward",icon:"mdi mdi-rotate-right"}),D.push({key:"direction_reverse",label:"Direction: Reverse",description:"Set direction to reverse",icon:"mdi mdi-rotate-left"}))}else if(w.platform==="light"){const d=w.config.features||[];d.includes("turn_on")&&(D.push({key:"turn_on",label:"Power On",description:"Turn on the light",icon:"mdi mdi-lightbulb-on"}),D.push({key:"turn_off",label:"Power Off",description:"Turn off the light",icon:"mdi mdi-lightbulb-off"})),d.includes("brightness")&&(D.push({key:"brightness_up",label:"Brightness Up",description:"Increase brightness",icon:"mdi mdi-brightness-7"}),D.push({key:"brightness_down",label:"Brightness Down",description:"Decrease brightness",icon:"mdi mdi-brightness-5"})),d.includes("color_temp")&&(D.push({key:"color_temp_warm",label:"Warm White",description:"Set to warm white",icon:"mdi mdi-weather-sunset"}),D.push({key:"color_temp_cool",label:"Cool White",description:"Set to cool white",icon:"mdi mdi-weather-sunny"})),d.includes("rgb")&&(D.push({key:"color_red",label:"Color: Red",description:"Set color to red",icon:"mdi mdi-palette"}),D.push({key:"color_green",label:"Color: Green",description:"Set color to green",icon:"mdi mdi-palette"}),D.push({key:"color_blue",label:"Color: Blue",description:"Set color to blue",icon:"mdi mdi-palette"}))}return D}),b=K(()=>a.value.length),p=K(()=>Object.keys(s.value).length),L=K(()=>b.value===0?0:Math.round(p.value/b.value*100));function J(D){return{off:"mdi mdi-power",auto:"mdi mdi-autorenew",cool:"mdi mdi-snowflake",heat:"mdi mdi-fire",dry:"mdi mdi-water-percent",fan_only:"mdi mdi-fan"}[D]||"mdi mdi-remote"}async function Z(D){if(!c.value){if(!C.value){q.value=!0,window.scrollTo({top:0,behavior:"smooth"});return}q.value=!1,c.value=D.key;try{const d=w.manufacturer.toLowerCase().replace(/[^a-z0-9]+/g,"_"),V=w.model.toLowerCase().replace(/[^a-z0-9]+/g,"_"),ve=`${d}_${V}`,be=(await ne.post("/api/commands/learn",{entity_id:C.value,device:ve,command:D.key,command_type:O.value})).data;if(be.success&&be.code)s.value[D.key]=be.code,h("update:modelValue",s.value),x.value=!0,be.code==="pending"&&console.log(`⏳ Command '${D.key}' learned, code will be fetched from storage when saving`),$.value&&o.value.length>0&&setTimeout(()=>{const W=o.value.shift();W?Z(W):$.value=!1},1e3);else throw new Error(be.error||"Failed to learn command")}catch(d){console.error("Error learning command:",d),i.error(`Error learning command: ${d.message}`),$.value=!1,o.value=[]}finally{$.value||(c.value=null)}}}async function B(D){var d;if(!C.value){q.value=!0,window.scrollTo({top:0,behavior:"smooth"});return}if(!s.value[D]){(d=i.value)==null||d.error("Command not learned yet");return}f.value=D;try{const V=s.value[D];await ne.post("/api/commands/send-raw",{entity_id:C.value,command:V,command_type:O.value}),i.success("Command sent successfully")}catch(V){console.error("Error testing command:",V),i.error(`Error testing command: ${V.message}`)}finally{f.value=null}}function ae(D){const d=a.value.find(V=>V.key===D);U.value={show:!0,commandKey:D,commandLabel:d?d.label:D}}function A(){const D=U.value.commandKey;delete s.value[D],h("update:modelValue",s.value),U.value.show=!1}function N(){const D=a.value.filter(V=>!s.value[V.key]);if(D.length===0)return;$.value=!0,o.value=[...D];const d=o.value.shift();d&&Z(d)}function oe(){I.value=!0}function ue(){s.value={},h("update:modelValue",s.value),I.value=!1}re(()=>w.modelValue,D=>{s.value={...D}},{deep:!0}),Ae(async()=>{await ke()});async function ke(){try{console.log("SmartIR device - commands will be loaded from SmartIR JSON file, not Broadlink storage")}catch(D){console.error("Error in loadExistingCommands:",D)}}function Se(){h("update:broadlinkDevice",C.value)}function Me(){h("update:commandType",O.value)}async function Te(){try{console.log("🔍 Loading Broadlink devices from /api/remote/devices");const D=await ne.get("/api/remote/devices");console.log("📦 Response data:",D.data);const d=D.data.devices||[];console.log(`✅ Found ${d.length} devices:`,d),S.value=d}catch(D){console.error("❌ Error loading remote devices:",D),S.value=[]}}return re(()=>w.broadlinkDevice,D=>{C.value=D}),re(C,D=>{D&&(q.value=!1)}),re(()=>w.commandType,D=>{O.value=D}),Ae(async()=>{await Te(),await ke()}),(D,d)=>(l(),n("div",zr,[d[22]||(d[22]=e("h3",null,"Learn IR Commands",-1)),e("div",Jr,[e("div",{class:G(["form-group",{"has-error":q.value}])},[d[6]||(d[6]=e("label",null,"Broadlink Device *",-1)),e("div",Wr,[X(e("select",{"onUpdate:modelValue":d[0]||(d[0]=V=>C.value=V),onChange:Se},[d[4]||(d[4]=e("option",{value:""},"Select Broadlink device...",-1)),(l(!0),n(pe,null,$e(S.value,V=>(l(),n("option",{key:V.entity_id,value:V.entity_id},m(V.name||V.entity_id),9,Kr))),128))],544),[[De,C.value]]),q.value?(l(),n("div",Xr,[...d[5]||(d[5]=[e("i",{class:"mdi mdi-alert"},null,-1),T(" Device is required ",-1)])])):R("",!0)]),e("small",null,"This device will be used to learn commands ("+m(S.value.length)+" devices found)",1)],2),e("div",Gr,[d[8]||(d[8]=e("label",null,"Command Type *",-1)),X(e("select",{"onUpdate:modelValue":d[1]||(d[1]=V=>O.value=V),onChange:Me,disabled:p.value>0},[...d[7]||(d[7]=[e("option",{value:"ir"},"📡 Infrared (IR) - Most common for AC, TV, etc.",-1),e("option",{value:"rf"},"📻 Radio Frequency (RF) - For RF remotes",-1)])],40,Yr),[[De,O.value]]),p.value>0?(l(),n("small",Zr,"Command type cannot be changed after learning commands")):(l(),n("small",Qr,"Select the type of commands your device uses"))])]),p.value>0&&!x.value?(l(),n("div",ed,[d[10]||(d[10]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[d[9]||(d[9]=e("strong",null,"Editing Existing Profile",-1)),e("p",null,m(p.value)+" command"+m(p.value!==1?"s":"")+' already learned. You can re-learn any command by clicking the delete icon and then "Learn Command".',1)])])):R("",!0),e("div",td,[d[14]||(d[14]=e("i",{class:"mdi mdi-information"},null,-1)),e("div",null,[d[13]||(d[13]=e("p",null,[e("strong",null,"How it works:")],-1)),t.commandType==="ir"?(l(),n("ol",od,[...d[11]||(d[11]=[e("li",null,'Click "Learn Command" for each combination',-1),e("li",null,[e("strong",null,"Point your IR remote directly at the Broadlink device")],-1),e("li",null,"Press the button on your remote",-1),e("li",null,"Wait for confirmation (up to 30 seconds)",-1)])])):(l(),n("ol",ld,[...d[12]||(d[12]=[e("li",null,'Click "Learn Command" for each combination',-1),e("li",null,[e("strong",null,"Step 1:"),T(" Hold button on remote - Broadlink scans for RF frequency")],-1),e("li",null,[e("strong",null,"Step 2:"),T(" Watch for Home Assistant notification, then press and release button")],-1),e("li",null,"Keep remote within 5cm of Broadlink (RF doesn't need line-of-sight)",-1),e("li",null,"Wait for confirmation (may take up to 30 seconds)",-1)])]))])]),e("div",nd,[e("div",sd,[e("div",{class:"progress-fill",style:ut({width:L.value+"%"})},null,4)]),e("span",ad,m(p.value)+" / "+m(b.value)+" commands learned ("+m(L.value)+"%) ",1)]),e("div",id,[(l(!0),n(pe,null,$e(a.value,V=>(l(),n("div",{key:V.key,class:G(["command-card",{learned:s.value[V.key],learning:c.value===V.key}])},[e("div",rd,[e("div",dd,[e("i",{class:G(V.icon)},null,2)]),e("div",ud,[e("h4",null,m(V.label),1),e("p",null,m(V.description),1)])]),c.value===V.key?(l(),n("div",cd,[t.commandType==="ir"?(l(),n("div",md,[...d[15]||(d[15]=[e("p",null,[e("strong",null,"Point your remote directly at the Broadlink device and press the button.")],-1),e("small",null,"Listening for up to 30 seconds...",-1)])])):(l(),n("div",vd,[...d[16]||(d[16]=[e("p",{class:"rf-title"},[e("strong",null,"Learning request sent to device.")],-1),e("p",{class:"rf-subtitle"},[T("RF learning is a "),e("strong",null,"two-step process"),T(":")],-1),e("ol",null,[e("li",null,[e("strong",null,"Step 1 - Frequency Sweep (~10-15 seconds):"),T(" Press and hold the button on your remote until the notification updates. ")]),e("li",null,[e("strong",null,"Step 2 - Learn Signal:"),T(" Press and release the button once. ")])],-1),e("p",{class:"rf-note"},"Follow the Home Assistant notifications (🔔) for real-time instructions.",-1)])]))])):R("",!0),e("div",pd,[s.value[V.key]?(l(),n("div",gd,[d[18]||(d[18]=e("i",{class:"mdi mdi-check-circle"},null,-1)),d[19]||(d[19]=e("span",null,"Learned",-1)),e("span",{class:G(["command-type-badge",O.value])},m(O.value.toUpperCase()),3),e("button",{onClick:ve=>B(V.key),class:"icon-btn",title:"Test command",disabled:f.value===V.key,style:{"margin-left":"auto"}},[e("i",{class:G(["mdi mdi-play",{"mdi-spin":f.value===V.key}])},null,2)],8,yd),e("button",{onClick:ve=>ae(V.key),class:"icon-btn danger",title:"Delete and re-learn"},[...d[17]||(d[17]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,bd)])):(l(),n("button",{key:0,onClick:ve=>Z(V),class:G(["btn-learn",{learning:c.value===V.key}]),disabled:c.value!==null},[e("i",{class:G(["mdi mdi-radio-tower",{"mdi-spin":c.value===V.key}])},null,2),T(" "+m(c.value===V.key?"Listening...":"Learn Command"),1)],10,fd))])],2))),128))]),e("div",hd,[e("button",{onClick:N,class:"btn-secondary",disabled:c.value!==null||p.value===b.value},[...d[20]||(d[20]=[e("i",{class:"mdi mdi-play-circle"},null,-1),T(" Learn All Remaining ",-1)])],8,kd),e("button",{onClick:oe,class:"btn-text",disabled:p.value===0},[...d[21]||(d[21]=[e("i",{class:"mdi mdi-delete-sweep"},null,-1),T(" Clear All ",-1)])],8,wd)]),he(Fe,{isOpen:U.value.show,title:"Delete Learned Command?",message:`Are you sure you want to delete the '${U.value.commandLabel}' command?

You will need to re-learn this command.`,confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,onConfirm:A,onCancel:d[2]||(d[2]=V=>U.value.show=!1)},null,8,["isOpen","message"]),he(Fe,{isOpen:I.value,title:"Delete All Learned Commands?",message:"Are you sure you want to delete all learned commands? This cannot be undone.\\n\\nYou will need to re-learn all commands.",confirmText:"Delete All",cancelText:"Cancel",dangerMode:!0,onConfirm:ue,onCancel:d[3]||(d[3]=V=>I.value=!1)},null,8,["isOpen"])]))}},Cd=Ce($d,[["__scopeId","data-v-9a9e9e51"]]),_d={class:"profile-preview"},Sd={class:"preview-summary"},Id={class:"summary-card"},Dd={class:"stats-grid"},Td={class:"stat-item"},xd={class:"stat-value"},Md={class:"stat-item"},Rd={class:"stat-value"},Ld={class:"stat-item"},Ad={class:"stat-value"},Od={class:"preview-tabs"},Ed={class:"preview-content"},Vd={key:0,class:"tab-content"},Pd={class:"code-header"},Ud={class:"code-block"},Fd={key:1,class:"tab-content"},jd={class:"code-header"},Nd={class:"code-block"},Bd={key:2,class:"tab-content"},Hd={class:"instructions"},qd={class:"step-item"},zd={class:"step-content"},Jd={class:"code-path"},Wd={__name:"ProfilePreview",props:{profile:{type:Object,required:!0},jsonData:{type:Object,required:!0},yamlConfig:{type:String,required:!0}},setup(t){const u=Be(),i=t,w=g("json"),h=g(!1),s=g(!1),c=K(()=>Object.keys(i.profile.commands||{}).length),f=K(()=>JSON.stringify(i.jsonData,null,2));async function S(){try{await navigator.clipboard.writeText(f.value),h.value=!0,setTimeout(()=>{h.value=!1},2e3)}catch(O){console.error("Failed to copy JSON:",O),u.error("Failed to copy to clipboard")}}async function C(){try{await navigator.clipboard.writeText(i.yamlConfig),s.value=!0,setTimeout(()=>{s.value=!1},2e3)}catch(O){console.error("Failed to copy YAML:",O),u.error("Failed to copy to clipboard")}}return(O,$)=>{var o;return l(),n("div",_d,[$[22]||($[22]=e("h3",null,"Preview & Save",-1)),e("div",Sd,[e("div",Id,[$[4]||($[4]=e("i",{class:"mdi mdi-check-circle"},null,-1)),e("div",null,[$[3]||($[3]=e("h4",null,"Profile Ready!",-1)),e("p",null,m(t.profile.manufacturer)+" "+m(t.profile.model),1)])]),e("div",Dd,[e("div",Td,[e("span",xd,m(c.value),1),$[5]||($[5]=e("span",{class:"stat-label"},"Commands Learned",-1))]),e("div",Md,[e("span",Rd,m(t.profile.platform),1),$[6]||($[6]=e("span",{class:"stat-label"},"Platform",-1))]),e("div",Ld,[e("span",Ad,m(((o=t.profile.config.modes)==null?void 0:o.length)||0),1),$[7]||($[7]=e("span",{class:"stat-label"},"HVAC Modes",-1))])])]),e("div",Od,[e("button",{onClick:$[0]||($[0]=x=>w.value="json"),class:G(["tab-button",{active:w.value==="json"}])},[...$[8]||($[8]=[e("i",{class:"mdi mdi-code-json"},null,-1),T(" SmartIR JSON ",-1)])],2),e("button",{onClick:$[1]||($[1]=x=>w.value="yaml"),class:G(["tab-button",{active:w.value==="yaml"}])},[...$[9]||($[9]=[e("i",{class:"mdi mdi-file-code"},null,-1),T(" YAML Config ",-1)])],2),e("button",{onClick:$[2]||($[2]=x=>w.value="instructions"),class:G(["tab-button",{active:w.value==="instructions"}])},[...$[10]||($[10]=[e("i",{class:"mdi mdi-information"},null,-1),T(" Instructions ",-1)])],2)]),e("div",Ed,[w.value==="json"?(l(),n("div",Vd,[e("div",Pd,[$[12]||($[12]=e("h4",null,"SmartIR Device Code JSON",-1)),e("button",{onClick:S,class:"btn-copy"},[$[11]||($[11]=e("i",{class:"mdi mdi-content-copy"},null,-1)),T(" "+m(h.value?"Copied!":"Copy"),1)])]),e("pre",Ud,[e("code",null,m(f.value),1)]),$[13]||($[13]=e("p",{class:"code-note"},[e("i",{class:"mdi mdi-information"}),T(" Save this as "),e("code",null,"10000.json"),T(" in your SmartIR codes directory ")],-1))])):R("",!0),w.value==="yaml"?(l(),n("div",Fd,[e("div",jd,[$[15]||($[15]=e("h4",null,"Home Assistant Configuration",-1)),e("button",{onClick:C,class:"btn-copy"},[$[14]||($[14]=e("i",{class:"mdi mdi-content-copy"},null,-1)),T(" "+m(s.value?"Copied!":"Copy"),1)])]),e("pre",Nd,[e("code",null,m(t.yamlConfig),1)]),$[16]||($[16]=e("p",{class:"code-note"},[e("i",{class:"mdi mdi-information"}),T(" Add this to your "),e("code",null,"configuration.yaml"),T(" file ")],-1))])):R("",!0),w.value==="instructions"?(l(),n("div",Bd,[e("div",Hd,[$[20]||($[20]=e("h4",null,"Installation Steps",-1)),e("div",qd,[$[19]||($[19]=e("div",{class:"step-number"},"1",-1)),e("div",zd,[$[17]||($[17]=e("h5",null,"Get Next Code Number",-1)),$[18]||($[18]=e("p",null,"Custom device codes start at 10000. Check your SmartIR codes directory to find the next available number.",-1)),e("div",Jd,[e("code",null,"/config/custom_components/smartir/codes/"+m(t.profile.platform)+"/",1)])])]),$[21]||($[21]=je('<div class="step-item" data-v-e7b997c8><div class="step-number" data-v-e7b997c8>2</div><div class="step-content" data-v-e7b997c8><h5 data-v-e7b997c8>Save JSON File</h5><p data-v-e7b997c8>Copy the JSON from the &quot;SmartIR JSON&quot; tab and save it as <code data-v-e7b997c8>10000.json</code> (or your next available number) in the codes directory.</p></div></div><div class="step-item" data-v-e7b997c8><div class="step-number" data-v-e7b997c8>3</div><div class="step-content" data-v-e7b997c8><h5 data-v-e7b997c8>Update Configuration</h5><p data-v-e7b997c8>Copy the YAML from the &quot;YAML Config&quot; tab and add it to your <code data-v-e7b997c8>configuration.yaml</code> file. Update the <code data-v-e7b997c8>device_code</code> to match your JSON filename.</p></div></div><div class="step-item" data-v-e7b997c8><div class="step-number" data-v-e7b997c8>4</div><div class="step-content" data-v-e7b997c8><h5 data-v-e7b997c8>Restart Home Assistant</h5><p data-v-e7b997c8>Restart Home Assistant to load the new configuration. Your climate entity will appear in the UI.</p></div></div><div class="step-item" data-v-e7b997c8><div class="step-number" data-v-e7b997c8>5</div><div class="step-content" data-v-e7b997c8><h5 data-v-e7b997c8>Test Your Device</h5><p data-v-e7b997c8>Go to your climate entity and test different modes, temperatures, and fan speeds to ensure everything works correctly.</p></div></div><div class="tips-section" data-v-e7b997c8><h4 data-v-e7b997c8><i class="mdi mdi-lightbulb" data-v-e7b997c8></i> Tips </h4><ul data-v-e7b997c8><li data-v-e7b997c8>Keep a backup of your JSON file in case you need to modify it</li><li data-v-e7b997c8>Test all commands to ensure they work as expected</li><li data-v-e7b997c8>You can share your profile with the SmartIR community on GitHub</li><li data-v-e7b997c8>If a command doesn&#39;t work, you can re-learn it and update the JSON</li></ul></div>',5))])])):R("",!0)])])}}},Kd=Ce(Wd,[["__scopeId","data-v-e7b997c8"]]),Xd={class:"wizard-body"},Gd={key:0,class:"warning-section"},Yd={class:"warning-box"},Zd={class:"instructions"},Qd={class:"code-block"},eu={class:"steps"},tu={key:0},ou={class:"help-section"},lu={key:0,class:"help-content"},nu={class:"help-step"},su={key:0,class:"help-step"},au={class:"help-step"},iu={class:"help-step"},ru={class:"checklist"},du={class:"checkbox-label"},uu={key:0,class:"checkbox-label"},cu={class:"wizard-footer"},mu=["disabled"],vu={__name:"SmartIRSetupWizard",props:{show:{type:Boolean,default:!1},platform:{type:String,required:!0},warnings:{type:Array,default:()=>[]},configPath:{type:String,default:"/config"}},emits:["close","complete"],setup(t,{emit:u}){const i=t,w=u,h=xe("toast"),s=g(!1),c=g(!1),f=g(!1),S=K(()=>i.warnings.length>0?s.value&&c.value:s.value);function C(){const $=`${i.platform}: !include smartir/${i.platform}.yaml`;navigator.clipboard.writeText($).then(()=>{var o;(o=h.value)==null||o.success("Include line copied to clipboard!","✅ Copied")}).catch(o=>{var x;console.error("Failed to copy:",o),(x=h.value)==null||x.error("Failed to copy to clipboard","❌ Copy Failed")})}function O(){w("complete")}return($,o)=>t.show?(l(),n("div",{key:0,class:"modal-overlay",onClick:o[5]||(o[5]=me(()=>{},["stop"]))},[e("div",{class:"setup-wizard",onClick:o[4]||(o[4]=me(()=>{},["stop"]))},[o[31]||(o[31]=e("div",{class:"wizard-header"},[e("h2",null,[e("i",{class:"mdi mdi-cog"}),T(" SmartIR Configuration Setup ")])],-1)),e("div",Xd,[t.warnings.length>0?(l(),n("div",Gd,[e("div",Yd,[o[11]||(o[11]=e("i",{class:"mdi mdi-alert"},null,-1)),e("div",null,[o[9]||(o[9]=e("h3",null,"⚠️ Configuration Migration Needed",-1)),o[10]||(o[10]=e("p",null,"We detected existing platform entries in your configuration.yaml:",-1)),e("ul",null,[(l(!0),n(pe,null,$e(t.warnings,x=>(l(),n("li",{key:x.platform},[e("strong",null,m(x.platform)+":",1),T(" "+m(x.message),1)]))),128))]),e("p",null,[o[6]||(o[6]=e("strong",null,"Action Required:",-1)),o[7]||(o[7]=T(" Move these entries to ",-1)),e("code",null,"smartir/"+m(t.platform)+".yaml",1),o[8]||(o[8]=T(" before continuing.",-1))])])])])):R("",!0),e("div",Zd,[o[27]||(o[27]=e("h3",null,"📝 One-Time Setup",-1)),o[28]||(o[28]=e("p",null,[T("To enable SmartIR device management, add this line to your "),e("code",null,"configuration.yaml"),T(":")],-1)),e("div",Qd,[e("code",null,m(t.platform)+": !include smartir/"+m(t.platform)+".yaml",1),e("button",{onClick:C,class:"copy-btn",title:"Copy to clipboard"},[...o[12]||(o[12]=[e("i",{class:"mdi mdi-content-copy"},null,-1)])])]),e("div",eu,[o[19]||(o[19]=e("h4",null,"Steps:",-1)),e("ol",null,[t.warnings.length>0?(l(),n("li",tu,[o[13]||(o[13]=e("strong",null,"Move existing entries:",-1)),o[14]||(o[14]=T(" Copy any existing ",-1)),e("code",null,m(t.platform)+":",1),o[15]||(o[15]=T(" entries from configuration.yaml to ",-1)),e("code",null,"smartir/"+m(t.platform)+".yaml",1)])):R("",!0),o[16]||(o[16]=e("li",null,[e("strong",null,"Add include line:"),T(" Add the line above to your configuration.yaml ")],-1)),o[17]||(o[17]=e("li",null,[e("strong",null,"Save changes:"),T(" Save configuration.yaml ")],-1)),o[18]||(o[18]=e("li",null,[e("strong",null,"Continue here:"),T(` Click "I've Completed Setup" below `)],-1))])]),e("div",ou,[e("button",{onClick:o[0]||(o[0]=x=>f.value=!f.value),class:"help-toggle"},[e("i",{class:G(["mdi",f.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2),T(" "+m(f.value?"Hide":"Show")+" Detailed Instructions ",1)]),f.value?(l(),n("div",lu,[o[26]||(o[26]=e("h4",null,"Detailed Setup Guide:",-1)),e("div",nu,[o[21]||(o[21]=e("h5",null,"1. Open configuration.yaml",-1)),e("p",null,[o[20]||(o[20]=T("Location: ",-1)),e("code",null,m(t.configPath)+"/configuration.yaml",1)])]),t.warnings.length>0?(l(),n("div",su,[o[22]||(o[22]=e("h5",null,"2. Migrate Existing Entries (If Any)",-1)),e("p",null,"If you have existing "+m(t.platform)+" entries, cut them from configuration.yaml and paste into:",1),e("p",null,[e("code",null,m(t.configPath)+"/smartir/"+m(t.platform)+".yaml",1)]),o[23]||(o[23]=e("p",{class:"note"},"Broadlink Manager will create this file automatically.",-1))])):R("",!0),e("div",au,[e("h5",null,m(t.warnings.length>0?"3":"2")+". Add Include Line",1),o[24]||(o[24]=e("p",null,"Add this to configuration.yaml:",-1)),e("pre",null,m(t.platform)+": !include smartir/"+m(t.platform)+".yaml",1)]),e("div",iu,[e("h5",null,m(t.warnings.length>0?"4":"3")+". Restart Home Assistant",1),o[25]||(o[25]=e("p",null,"After saving, you'll need to restart HA for changes to take effect.",-1))])])):R("",!0)])]),e("div",ru,[e("label",du,[X(e("input",{type:"checkbox","onUpdate:modelValue":o[1]||(o[1]=x=>s.value=x)},null,512),[[ye,s.value]]),o[29]||(o[29]=e("span",null,"I've added the include line to configuration.yaml",-1))]),t.warnings.length>0?(l(),n("label",uu,[X(e("input",{type:"checkbox","onUpdate:modelValue":o[2]||(o[2]=x=>c.value=x)},null,512),[[ye,c.value]]),e("span",null,"I've migrated existing "+m(t.platform)+" entries (if any)",1)])):R("",!0)])]),e("div",cu,[e("button",{onClick:o[3]||(o[3]=x=>$.$emit("close")),class:"btn-secondary"}," Cancel "),e("button",{onClick:O,class:"btn-primary",disabled:!S.value},[...o[30]||(o[30]=[e("i",{class:"mdi mdi-check"},null,-1),T(" I've Completed Setup ",-1)])],8,mu)])])])):R("",!0)}},pu=Ce(vu,[["__scopeId","data-v-f6fe4c03"]]),fu={class:"modal-header"},gu={class:"progress-steps"},yu={class:"step-number"},bu={key:0,class:"mdi mdi-check"},hu={key:1},ku={class:"step-label"},wu={class:"modal-body"},$u={key:0,class:"step-content"},Cu={class:"form-group"},_u={class:"form-group"},Su={class:"form-group"},Iu={key:1,class:"step-content"},Du={key:1,class:"platform-form"},Tu={class:"form-section"},xu={class:"checkbox-grid"},Mu={class:"checkbox-item"},Ru={class:"checkbox-item"},Lu={class:"checkbox-item"},Au={class:"checkbox-item"},Ou={class:"checkbox-item"},Eu={key:2,class:"platform-form"},Vu={class:"form-section"},Pu={class:"form-group"},Uu={class:"form-section"},Fu={class:"checkbox-grid"},ju={class:"checkbox-item"},Nu={class:"checkbox-item"},Bu={key:3,class:"platform-form"},Hu={class:"form-section"},qu={class:"checkbox-grid"},zu={class:"checkbox-item"},Ju={class:"checkbox-item"},Wu={class:"checkbox-item"},Ku={class:"checkbox-item"},Xu={key:2,class:"step-content"},Gu={key:3,class:"step-content"},Yu={class:"modal-footer"},Zu=["disabled"],Qu={key:2,class:"save-buttons"},ec=["disabled"],tc=["disabled"],oc={__name:"SmartIRProfileBuilder",props:{show:{type:Boolean,default:!1},editMode:{type:Boolean,default:!1},editData:{type:Object,default:null},startStep:{type:Number,default:0}},emits:["close","save"],setup(t,{emit:u}){const i=t,w=u,h=xe("toast"),s=g(0),c=g(!1),f=g([]),S=g(!1),C=g([]),O=g("/config"),$=g(!1),o=g(null),x=g(!1),q=g(!1),U=g(""),I=g("ir"),a=g(!1),b=[{label:"Device Info",key:"info"},{label:"Configuration",key:"config"},{label:"Learn Commands",key:"commands"},{label:"Preview & Save",key:"preview"}],p=g({platform:"",manufacturer:"",model:"",broadlinkDevice:"",commandType:"ir",config:{},commands:{}}),L=g(["turn_on"]),J=g(3),Z=g([]),B=g(["turn_on"]);re(()=>p.value.platform,M=>{M==="media_player"?p.value.config={features:L.value}:M==="fan"?p.value.config={speedLevels:J.value,features:Z.value}:M==="light"&&(p.value.config={features:B.value})}),re(L,M=>{p.value.platform==="media_player"&&(p.value.config={features:M})},{deep:!0}),re(J,M=>{p.value.platform==="fan"&&(p.value.config={speedLevels:M,features:Z.value})}),re(Z,M=>{p.value.platform==="fan"&&(p.value.config={speedLevels:J.value,features:M})},{deep:!0}),re(B,M=>{p.value.platform==="light"&&(p.value.config={features:M})},{deep:!0});function ae(M){const r=new Set,P=Object.keys(M);return P.some(Y=>Y==="off"||Y.includes("_off"))&&r.add("off"),P.some(Y=>Y.includes("auto"))&&r.add("auto"),P.some(Y=>Y.includes("cool"))&&r.add("cool"),P.some(Y=>Y.includes("heat"))&&r.add("heat"),P.some(Y=>Y.includes("dry"))&&r.add("dry"),P.some(Y=>Y.includes("fan_only"))&&r.add("fan_only"),Array.from(r)}function A(M){const r=new Set,P=Object.keys(M);return P.some(Y=>Y.includes("auto"))&&r.add("auto"),P.some(Y=>Y.includes("low"))&&r.add("low"),P.some(Y=>Y.includes("medium")||Y.includes("mid"))&&r.add("medium"),P.some(Y=>Y.includes("high"))&&r.add("high"),Array.from(r)}function N(M){const r=new Set,P=Object.keys(M);return P.some(Y=>Y.includes("swing_off")||Y.includes("_off"))&&r.add("off"),P.some(Y=>Y.includes("vertical"))&&r.add("vertical"),P.some(Y=>Y.includes("horizontal"))&&r.add("horizontal"),P.some(Y=>Y.includes("both"))&&r.add("both"),Array.from(r)}function oe(M){for(const r of Object.values(M))if(typeof r=="string"&&r.startsWith("sc")||Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0].startsWith("sc"))return"rf";return"ir"}re(()=>p.value.commandType,(M,r)=>{!r||x.value||a.value||(Object.keys(p.value.commands).length>0&&M!==r?(U.value=M,p.value.commandType=r,x.value=!0):M!==r&&(I.value=M))}),re(()=>i.editData,async M=>{var r,P,Y;if(M&&i.editMode){console.log("🔧 Edit mode activated, loading profile data:",M),a.value=!0,f.value.length===0&&(console.log("📡 Loading Broadlink devices..."),await ee(),console.log("📡 Devices loaded:",f.value.length));const ie=M.profile,de=ie.controller_data;console.log("🎮 Controller data from profile:",de),console.log("🎮 Available devices:",f.value.map(_=>_.entity_id));const se=ie.commands||{},te=ie.commandType||oe(se);console.log("🔍 Command type (stored):",ie.commandType),console.log("🔍 Command type (final):",te);let fe={};if(M.platform==="climate"){const _=ie.operationModes||ae(se),k=ie.fanModes||A(se),F=ie.swingModes||N(se);console.log("🔍 Inferred modes:",_),console.log("🔍 Inferred fan modes:",k),console.log("🔍 Inferred swing modes:",F),fe={minTemp:ie.minTemperature,maxTemp:ie.maxTemperature,precision:ie.precision,modes:_,fanModes:k,swingModes:F}}else if(M.platform==="media_player"){const _=[];(se.on||se.off)&&_.push("turn_on"),(se.volumeUp||se.volumeDown)&&_.push("volume"),se.mute&&_.push("mute"),se.sources&&_.push("source"),(se.channelUp||se.channelDown)&&_.push("channel"),fe={features:_},L.value=_,console.log("🔍 Inferred media player features:",_)}else if(M.platform==="fan"){const _=((r=ie.speed)==null?void 0:r.length)||Object.keys(se.default||{}).length||3,k=[];(se.oscillate_on||se.oscillate_off)&&k.push("oscillate"),(se.direction_forward||se.direction_reverse)&&k.push("direction"),fe={speedLevels:_,features:k},J.value=_,Z.value=k,console.log("🔍 Inferred fan config:",fe)}else if(M.platform==="light"){const _=[];fe={features:_},B.value=_,console.log("🔍 Inferred light features:",_)}const Re=await v(ie.manufacturer,(P=ie.supportedModels)==null?void 0:P[0],se);p.value={platform:M.platform,manufacturer:ie.manufacturer||"",model:((Y=ie.supportedModels)==null?void 0:Y[0])||"",broadlinkDevice:de||"",commandType:te,config:fe,commands:Re},console.log("✅ Profile populated:",p.value),console.log("✅ Selected device:",p.value.broadlinkDevice),console.log("✅ Command type:",p.value.commandType),console.log("✅ Commands (with learned codes):",Re),I.value=te,setTimeout(()=>{a.value=!1},100)}},{immediate:!0});const ue=K(()=>{var M;switch(s.value){case 0:return p.value.platform&&p.value.manufacturer&&p.value.model;case 1:return p.value.platform==="climate"?p.value.config.minTemp&&p.value.config.maxTemp&&((M=p.value.config.modes)==null?void 0:M.length)>0:!0;case 2:return p.value.broadlinkDevice&&p.value.commandType&&Object.keys(p.value.commands).length>0;case 3:return!0;default:return!1}}),ke=g(null);async function Se(){if(s.value!==3){ke.value=null;return}if(console.log("🔍 Generating JSON with commands:",p.value.commands),Object.values(p.value.commands).some(r=>typeof r=="string"?r==="pending":typeof r=="object"?Object.values(r).some(P=>typeof P=="string"?P==="pending":typeof P=="object"?Object.values(P).some(Y=>Y==="pending"):!1):!1)){console.warn('⚠️ Commands still contain "pending" placeholders!'),console.log("📦 Attempting to fetch from Broadlink storage...");const r=await v(p.value.manufacturer,p.value.model,p.value.commands);p.value.commands=r,console.log("✅ Updated commands:",r)}ke.value=y(p.value),console.log("📄 Generated JSON:",ke.value)}const Me=K(()=>s.value!==3?null:j(p.value));function Te(){p.value.config={},p.value.commands={}}function D(){x.value=!1,p.value.commandType=U.value,I.value=U.value,p.value.commands={},U.value=""}function d(){x.value=!1,U.value=""}async function V(){s.value<b.length-1&&(s.value++,s.value===3&&await Se())}function ve(){s.value>0&&s.value--}function Oe(){x.value||(q.value=!0)}function be(){q.value=!1,W()}function W(){w("close"),setTimeout(()=>{s.value=0,p.value={platform:"",manufacturer:"",model:"",broadlinkDevice:"",commandType:"ir",config:{},commands:{}},I.value="ir"},300)}async function E(){var M,r,P,Y,ie,de;c.value=!0;try{if(!$.value){const k=(await ne.get("/api/smartir/config/check")).data;if(k&&!((M=k.platforms[p.value.platform])==null?void 0:M.file_exists)){C.value=k.configuration_warnings||[],O.value=k.config_path||"/config",o.value={platform:p.value.platform,json:ke.value},S.value=!0,c.value=!1;return}}let se;i.editMode&&((r=i.editData)!=null&&r.code)?(se=parseInt(i.editData.code),console.log("📝 Edit mode: Using existing code",se)):(se=(await ne.get(`/api/smartir/platforms/${p.value.platform}/next-code`)).data.next_code,console.log("✨ New profile: Using next code",se));const fe=(await ne.post("/api/smartir/profiles",{platform:p.value.platform,json:ke.value,code_number:se})).data,Re={platform:"smartir",name:`${p.value.manufacturer} ${p.value.model}`,unique_id:`${p.value.manufacturer.toLowerCase().replace(/[^a-z0-9]+/g,"_")}_${p.value.model.toLowerCase().replace(/[^a-z0-9]+/g,"_")}`,device_code:se,controller_data:p.value.broadlinkDevice};try{await ne.post("/api/smartir/config/add-device",{platform:p.value.platform,device_config:{platform:"smartir",name:Re.name,unique_id:Re.unique_id,device_code:Re.device_code,controller_data:Re.controller_data}})}catch(_){console.error("Failed to add device to config:",_);const k=((P=_.response)==null?void 0:P.data)||{};let F=k.error||"Unknown error";k.validation_errors&&k.validation_errors.length>0&&(F=`Device configuration validation failed:
`+k.validation_errors.map(z=>`  • ${z}`).join(`
`)),(Y=h.value)==null||Y.warning(`Profile saved but failed to add to config file:
${F}`,"⚠️ Partial Success")}w("save",{json:ke.value,yaml:Me.value,profile:p.value,saved_to:fe.path}),(ie=h.value)==null||ie.success(`File: ${fe.filename}
Device Code: ${se}
Added to: smartir/${p.value.platform}.yaml

⚠️ Restart Home Assistant to activate`,"✅ Profile Saved Successfully!"),W()}catch(se){console.error("Error saving profile:",se),(de=h.value)==null||de.error(se.message,"❌ Error Saving Profile")}finally{c.value=!1}}async function Q(){$.value=!0,S.value=!1,o.value&&(await E(),o.value=null)}function H(){var M,r;try{const P=JSON.stringify(ke.value,null,2),Y=new Blob([P],{type:"application/json"}),ie=URL.createObjectURL(Y),de=document.createElement("a");de.href=ie;const se=p.value.manufacturer.toLowerCase().replace(/\s+/g,"_"),te=p.value.model.toLowerCase().replace(/\s+/g,"_");de.download=`smartir_${p.value.platform}_${se}_${te}.json`,document.body.appendChild(de),de.click(),document.body.removeChild(de),URL.revokeObjectURL(ie),(M=h.value)==null||M.success("You can manually upload this file to your SmartIR codes directory.","✅ Profile Downloaded")}catch(P){console.error("Error downloading profile:",P),(r=h.value)==null||r.error(P.message,"❌ Error Downloading Profile")}}async function v(M,r,P){const Y=M.toLowerCase().replace(/[^a-z0-9]+/g,"_"),ie=r.toLowerCase().replace(/[^a-z0-9]+/g,"_"),de=`${Y}_${ie}`;try{const fe=(await ne.get("/api/commands/all")).data[de]||{};console.log(`🔍 Fetching learned commands for device: ${de}`),console.log("📦 Device commands from storage:",fe);const Re={...P};for(const[_,k]of Object.entries(Re))if(k==="pending"&&fe[_])Re[_]=fe[_];else if(typeof k=="object"){for(const[F,z]of Object.entries(k))if(typeof z=="object")for(const[le,we]of Object.entries(z)){const ge=`${_}_${F}_${le}`;we==="pending"&&fe[ge]&&(Re[_][F][le]=fe[ge])}else if(z==="pending"){const le=`${_}_${F}`;fe[le]&&(Re[_][F]=fe[le])}}return console.log("✅ Merged commands:",Re),Re}catch(se){return console.error("Error fetching learned commands:",se),P}}function y(M){const r={manufacturer:M.manufacturer,supportedModels:[M.model],supportedController:"Broadlink",commandsEncoding:"Base64",commandType:M.commandType||"ir",commands:{}};return M.platform==="climate"&&(r.minTemperature=M.config.minTemp,r.maxTemperature=M.config.maxTemp,r.precision=M.config.precision||1,r.operationModes=M.config.modes||[],r.fanModes=M.config.fanModes&&M.config.fanModes.length>0?M.config.fanModes:["auto"],M.config.swingModes&&M.config.swingModes.length>0&&(r.swingModes=M.config.swingModes),r.commands=M.commands),r}function j(M){let r=`# SmartIR ${M.platform} configuration
`;return r+=`# Generated by Broadlink Manager v2

`,M.platform==="climate"&&(r+=`climate:
`,r+=`  - platform: smartir
`,r+=`    name: ${M.manufacturer} ${M.model}
`,r+=`    unique_id: ${M.manufacturer.toLowerCase()}_${M.model.toLowerCase().replace(/\s+/g,"_")}
`,r+=`    device_code: 10000  # Change this to your custom code number
`,r+=`    controller_data: ${M.broadlinkDevice}
`,M.config.tempSensor&&(r+=`    temperature_sensor: ${M.config.tempSensor}
`),M.config.humiditySensor&&(r+=`    humidity_sensor: ${M.config.humiditySensor}
`),M.config.powerSensor&&(r+=`    power_sensor: ${M.config.powerSensor}
`)),r}async function ee(){try{console.log("Fetching remote devices from /api/remote/devices...");const M=await ne.get("/api/remote/devices");console.log("Loaded remote devices response:",M.data);const r=M.data.devices||[];console.log("Extracted devices array:",r),console.log("Device count:",r.length),f.value=r,console.log("broadlinkDevices.value set to:",f.value),console.log("Final device count:",f.value.length)}catch(M){console.error("Error loading remote devices:",M),f.value=[]}}return re(()=>i.show,M=>{if(M){const r=Number.isInteger(i.startStep)?i.startStep:0;s.value=Math.min(Math.max(r,0),b.length-1)}}),re(()=>i.startStep,M=>{if(i.show){const r=Number.isInteger(M)?M:0;s.value=Math.min(Math.max(r,0),b.length-1)}}),Ae(()=>{i.show&&ee()}),(M,r)=>t.show?(l(),n("div",{key:0,class:"modal-overlay",onClick:Oe},[e("div",{class:"modal-container",onClick:r[19]||(r[19]=me(()=>{},["stop"]))},[e("div",fu,[e("h2",null,[r[22]||(r[22]=e("i",{class:"mdi mdi-file-document-edit"},null,-1)),T(" "+m(t.editMode?"Edit SmartIR Profile":"Create SmartIR Profile"),1)]),e("button",{onClick:W,class:"close-button"},[...r[23]||(r[23]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",gu,[(l(),n(pe,null,$e(b,(P,Y)=>e("div",{key:Y,class:G(["step",{active:s.value===Y,completed:s.value>Y}])},[e("div",yu,[s.value>Y?(l(),n("i",bu)):(l(),n("span",hu,m(Y+1),1))]),e("span",ku,m(P.label),1)],2)),64))]),e("div",wu,[s.value===0?(l(),n("div",$u,[r[29]||(r[29]=e("h3",null,"Device Information",-1)),e("div",Cu,[r[25]||(r[25]=e("label",null,"Platform Type *",-1)),X(e("select",{"onUpdate:modelValue":r[0]||(r[0]=P=>p.value.platform=P),onChange:Te},[...r[24]||(r[24]=[je('<option value="" data-v-2e218e9d>Select platform...</option><option value="climate" data-v-2e218e9d>🌡️ Climate (AC, Heater, Heat Pump)</option><option value="media_player" data-v-2e218e9d>📺 Media Player (TV, Receiver)</option><option value="fan" data-v-2e218e9d>🌀 Fan</option><option value="light" data-v-2e218e9d>💡 Light (LED Strip, IR Light)</option>',5)])],544),[[De,p.value.platform]])]),e("div",_u,[r[26]||(r[26]=e("label",null,"Manufacturer *",-1)),X(e("input",{"onUpdate:modelValue":r[1]||(r[1]=P=>p.value.manufacturer=P),type:"text",placeholder:"e.g., Daikin, LG, Samsung"},null,512),[[Le,p.value.manufacturer]])]),e("div",Su,[r[27]||(r[27]=e("label",null,"Model(s) *",-1)),X(e("input",{"onUpdate:modelValue":r[2]||(r[2]=P=>p.value.model=P),type:"text",placeholder:"e.g., FTXS35K, Multiple models"},null,512),[[Le,p.value.model]]),r[28]||(r[28]=e("small",null,'Enter model number or "Multiple" if it works with many models',-1))])])):R("",!0),s.value===1?(l(),n("div",Iu,[p.value.platform==="climate"?(l(),Pe(qr,{key:0,modelValue:p.value.config,"onUpdate:modelValue":r[3]||(r[3]=P=>p.value.config=P)},null,8,["modelValue"])):p.value.platform==="media_player"?(l(),n("div",Du,[r[36]||(r[36]=e("h3",null,"Media Player Configuration",-1)),r[37]||(r[37]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),T(" Configure the features your media player supports. You'll learn the IR commands in the next step. ")],-1)),e("div",Tu,[r[35]||(r[35]=e("h4",null,"Supported Features",-1)),e("div",xu,[e("label",Mu,[X(e("input",{type:"checkbox",value:"turn_on","onUpdate:modelValue":r[4]||(r[4]=P=>L.value=P)},null,512),[[ye,L.value]]),r[30]||(r[30]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),T(" Power On/Off ")],-1))]),e("label",Ru,[X(e("input",{type:"checkbox",value:"volume","onUpdate:modelValue":r[5]||(r[5]=P=>L.value=P)},null,512),[[ye,L.value]]),r[31]||(r[31]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-volume-high"}),T(" Volume Control ")],-1))]),e("label",Lu,[X(e("input",{type:"checkbox",value:"mute","onUpdate:modelValue":r[6]||(r[6]=P=>L.value=P)},null,512),[[ye,L.value]]),r[32]||(r[32]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-volume-mute"}),T(" Mute ")],-1))]),e("label",Au,[X(e("input",{type:"checkbox",value:"source","onUpdate:modelValue":r[7]||(r[7]=P=>L.value=P)},null,512),[[ye,L.value]]),r[33]||(r[33]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-import"}),T(" Source Selection ")],-1))]),e("label",Ou,[X(e("input",{type:"checkbox",value:"channel","onUpdate:modelValue":r[8]||(r[8]=P=>L.value=P)},null,512),[[ye,L.value]]),r[34]||(r[34]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-numeric"}),T(" Channel Control ")],-1))])])])])):p.value.platform==="fan"?(l(),n("div",Eu,[r[44]||(r[44]=e("h3",null,"Fan Configuration",-1)),r[45]||(r[45]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),T(" Configure the features your fan supports. You'll learn the IR commands in the next step. ")],-1)),e("div",Vu,[r[40]||(r[40]=e("h4",null,"Fan Speed Levels",-1)),e("div",Pu,[r[39]||(r[39]=e("label",null,"Number of Speed Levels *",-1)),X(e("select",{"onUpdate:modelValue":r[9]||(r[9]=P=>J.value=P)},[...r[38]||(r[38]=[e("option",{value:1},"1 Speed",-1),e("option",{value:2},"2 Speeds",-1),e("option",{value:3},"3 Speeds (Low/Med/High)",-1),e("option",{value:4},"4 Speeds",-1),e("option",{value:5},"5 Speeds",-1),e("option",{value:6},"6 Speeds",-1)])],512),[[De,J.value,void 0,{number:!0}]])])]),e("div",Uu,[r[43]||(r[43]=e("h4",null,"Additional Features",-1)),e("div",Fu,[e("label",ju,[X(e("input",{type:"checkbox",value:"oscillate","onUpdate:modelValue":r[10]||(r[10]=P=>Z.value=P)},null,512),[[ye,Z.value]]),r[41]||(r[41]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-sync"}),T(" Oscillation ")],-1))]),e("label",Nu,[X(e("input",{type:"checkbox",value:"direction","onUpdate:modelValue":r[11]||(r[11]=P=>Z.value=P)},null,512),[[ye,Z.value]]),r[42]||(r[42]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-rotate-3d-variant"}),T(" Direction (Forward/Reverse) ")],-1))])])])])):p.value.platform==="light"?(l(),n("div",Bu,[r[51]||(r[51]=e("h3",null,"Light Configuration",-1)),r[52]||(r[52]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),T(" Configure the features your light supports. You'll learn the IR commands in the next step. ")],-1)),e("div",Hu,[r[50]||(r[50]=e("h4",null,"Supported Features",-1)),e("div",qu,[e("label",zu,[X(e("input",{type:"checkbox",value:"turn_on","onUpdate:modelValue":r[12]||(r[12]=P=>B.value=P)},null,512),[[ye,B.value]]),r[46]||(r[46]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),T(" Power On/Off ")],-1))]),e("label",Ju,[X(e("input",{type:"checkbox",value:"brightness","onUpdate:modelValue":r[13]||(r[13]=P=>B.value=P)},null,512),[[ye,B.value]]),r[47]||(r[47]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-brightness-6"}),T(" Brightness Control ")],-1))]),e("label",Wu,[X(e("input",{type:"checkbox",value:"color_temp","onUpdate:modelValue":r[14]||(r[14]=P=>B.value=P)},null,512),[[ye,B.value]]),r[48]||(r[48]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-thermometer"}),T(" Color Temperature ")],-1))]),e("label",Ku,[X(e("input",{type:"checkbox",value:"rgb","onUpdate:modelValue":r[15]||(r[15]=P=>B.value=P)},null,512),[[ye,B.value]]),r[49]||(r[49]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-palette"}),T(" RGB Color ")],-1))])])])])):R("",!0)])):R("",!0),s.value===2?(l(),n("div",Xu,[he(Cd,{modelValue:p.value.commands,"onUpdate:modelValue":r[16]||(r[16]=P=>p.value.commands=P),platform:p.value.platform,config:p.value.config,broadlinkDevice:p.value.broadlinkDevice,"onUpdate:broadlinkDevice":r[17]||(r[17]=P=>p.value.broadlinkDevice=P),manufacturer:p.value.manufacturer,model:p.value.model,commandType:p.value.commandType,"onUpdate:commandType":r[18]||(r[18]=P=>p.value.commandType=P)},null,8,["modelValue","platform","config","broadlinkDevice","manufacturer","model","commandType"])])):R("",!0),s.value===3?(l(),n("div",Gu,[he(Kd,{profile:p.value,"json-data":ke.value,"yaml-config":Me.value},null,8,["profile","json-data","yaml-config"])])):R("",!0)]),e("div",Yu,[s.value>0?(l(),n("button",{key:0,onClick:ve,class:"btn-secondary"},[...r[53]||(r[53]=[e("i",{class:"mdi mdi-arrow-left"},null,-1),T(" Back ",-1)])])):R("",!0),r[57]||(r[57]=e("div",{class:"spacer"},null,-1)),e("button",{onClick:W,class:"btn-text"}," Cancel "),s.value<b.length-1?(l(),n("button",{key:1,onClick:V,class:"btn-primary",disabled:!ue.value},[...r[54]||(r[54]=[T(" Next ",-1),e("i",{class:"mdi mdi-arrow-right"},null,-1)])],8,Zu)):(l(),n("div",Qu,[e("button",{onClick:E,class:"btn-primary",disabled:c.value},[r[55]||(r[55]=e("i",{class:"mdi mdi-cloud-upload"},null,-1)),T(" "+m(c.value?"Saving...":"Save to SmartIR"),1)],8,ec),e("button",{onClick:H,class:"btn-secondary",disabled:c.value},[...r[56]||(r[56]=[e("i",{class:"mdi mdi-download"},null,-1),T(" Download JSON ",-1)])],8,tc)]))])]),he(pu,{show:S.value,platform:p.value.platform,warnings:C.value,"config-path":O.value,onClose:r[20]||(r[20]=P=>S.value=!1),onComplete:Q},null,8,["show","platform","warnings","config-path"]),he(Fe,{isOpen:x.value,title:"Change Command Type?",message:"Changing the command type will clear all learned commands. Continue?",confirmText:"Continue",cancelText:"Cancel",dangerMode:!0,onConfirm:D,onCancel:d},null,8,["isOpen"]),he(Fe,{isOpen:q.value,title:"Close Profile Builder?",message:"Are you sure you want to close? Your progress will be lost.",confirmText:"Close",cancelText:"Keep Editing",dangerMode:!0,onConfirm:be,onCancel:r[21]||(r[21]=P=>q.value=!1)},null,8,["isOpen"])])):R("",!0)}},lc=Ce(oc,[["__scopeId","data-v-2e218e9d"]]),nc={class:"dashboard"},sc={key:1,class:"welcome-banner"},ac={__name:"Dashboard",setup(t){const u=Be(),i=xe("smartirEnabled"),{isMobile:w}=Ye(),h=g(!1),s=g(!1),c=g(null),f=g(0),S=g(null),C=g(localStorage.getItem("welcome_banner_dismissed")==="true");function O(){C.value=!0,localStorage.setItem("welcome_banner_dismissed","true")}function $(){s.value=!1,c.value=null,f.value=0,h.value=!0}async function o({platform:U,profile:I,startStep:a}){f.value=Number.isInteger(a)?a:0;try{const b=await fetch(`api/smartir/platforms/${U}/profiles/${I.code}`);if(!b.ok)throw new Error("Failed to load profile");const p=await b.json();let L="";try{const J=await fetch(`api/smartir/config/get-device?platform=${U}&code=${I.code}`);J.ok?(L=(await J.json()).controller_data||"",console.log("✅ Found controller_data from YAML:",L)):console.warn("⚠️ No YAML entry found for this profile (this is OK for profiles not yet added to config)")}catch(J){console.warn("⚠️ Could not fetch controller_data from config:",J)}s.value=!0,c.value={platform:U,code:I.code,profile:{...p.profile,controller_data:L}},h.value=!0}catch(b){console.error("Error loading profile for edit:",b),u.error("Failed to load profile for editing")}}function x(){h.value=!1,s.value=!1,c.value=null}async function q(U){console.log("Profile saved:",U),x(),S.value&&S.value.loadAllProfiles&&(await S.value.loadAllProfiles(),console.log("✅ Profiles list refreshed"))}return(U,I)=>(l(),n("div",nc,[_e(i)?(l(),Pe(Gs,{key:0})):R("",!0),!_e(w)&&!C.value?(l(),n("div",sc,[e("button",{class:"dismiss-button",onClick:O,title:"Dismiss"},[...I[0]||(I[0]=[e("i",{class:"mdi mdi-close"},null,-1)])]),I[1]||(I[1]=je('<div class="banner-content" data-v-12185d74><div class="banner-icon" data-v-12185d74><i class="mdi mdi-rocket-launch" data-v-12185d74></i></div><div class="banner-text" data-v-12185d74><h2 data-v-12185d74>Welcome to Broadlink Manager v2!</h2><p data-v-12185d74>Manage your IR/RF devices with a modern Vue 3 interface</p></div></div><div class="status-badges" data-v-12185d74><span class="badge success" data-v-12185d74><i class="mdi mdi-check-circle" data-v-12185d74></i> Vue 3 Ready </span><span class="badge warning" data-v-12185d74><i class="mdi mdi-beta" data-v-12185d74></i> Beta </span></div>',2))])):R("",!0),he(qs),_e(i)?(l(),Pe(Ki,{key:2,ref_key:"smartirStatusCard",ref:S,onCreateProfile:$,onEditProfile:o},null,512)):R("",!0),he(lc,{show:h.value,editMode:s.value,editData:c.value,startStep:f.value,onClose:x,onSave:q},null,8,["show","editMode","editData","startStep"])]))}},ic=Ce(ac,[["__scopeId","data-v-12185d74"]]),rc={class:"toast-container"},dc={class:"toast-content"},uc={key:0,class:"toast-title"},cc={class:"toast-message"},mc={key:1,class:"toast-description"},vc=["onClick","title"],pc={__name:"Toast",setup(t,{expose:u}){const i=g([]);let w=0;function h(f){const S={success:"mdi-check-circle",error:"mdi-alert-circle",warning:"mdi-alert",info:"mdi-information"};return S[f]||S.info}function s({message:f,title:S,description:C,type:O="info",duration:$=5e3}){const o=w++,x={id:o,message:f,title:S,description:C,type:O};return i.value.push(x),$>0&&setTimeout(()=>{c(o)},$),o}function c(f){const S=i.value.findIndex(C=>C.id===f);S>-1&&i.value.splice(S,1)}return u({addToast:s,removeToast:c,show:s,success:(f,S)=>s({message:f,title:S,type:"success"}),error:(f,S)=>s({message:f,title:S,type:"error",duration:0}),warning:(f,S)=>s({message:f,title:S,type:"warning",duration:0}),info:(f,S)=>s({message:f,title:S,type:"info"})}),(f,S)=>(l(),Pe(lt,{to:"body"},[e("div",rc,[he(ct,{name:"toast"},{default:Ge(()=>[(l(!0),n(pe,null,$e(i.value,C=>(l(),n("div",{key:C.id,class:G(["toast",[`toast-${C.type}`,{"toast-persistent":C.type==="error"||C.type==="warning"}]])},[e("i",{class:G(["mdi",h(C.type)])},null,2),e("div",dc,[C.title?(l(),n("div",uc,m(C.title),1)):R("",!0),e("div",cc,m(C.message),1),C.description?(l(),n("div",mc,m(C.description),1)):R("",!0)]),e("button",{onClick:O=>c(C.id),class:G(["toast-close",{"toast-close-prominent":C.type==="error"||C.type==="warning"}]),title:C.type==="error"||C.type==="warning"?"Click to dismiss":"Close"},[...S[0]||(S[0]=[e("i",{class:"mdi mdi-close"},null,-1)])],10,vc)],2))),128))]),_:1})])]))}},fc=Ce(pc,[["__scopeId","data-v-3948c088"]]),gc="0.3.0-alpha.2",yc={version:gc},bc={id:"app",class:"app-container"},hc={class:"app-header"},kc={class:"header-content"},wc={class:"header-right"},$c=["title"],Cc={class:"settings-menu-container"},_c={key:0,class:"settings-menu"},Sc=["title"],Ic={class:"toggle-content"},Dc={key:0,class:"not-installed-label"},Tc={key:0,href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"menu-item menu-link menu-subitem"},xc=["disabled"],Mc=["disabled"],Rc=["disabled"],Lc={class:"app-main"},Ac={class:"app-footer"},Oc={__name:"App",setup(t){const u=g(null),i=yc.version,w=g("light"),h=g(null),s=g(!1),c=g(!1),f=g(!1),S=g(localStorage.getItem("smartir_enabled")!=="false"),C=K(()=>{var p;return((p=h.value)==null?void 0:p.installed)||!1}),O=K(()=>({light:"mdi mdi-weather-sunny",medium:"mdi mdi-weather-partly-cloudy",dark:"mdi mdi-weather-night"})[w.value]),$=K(()=>({light:"Switch to Medium Theme",medium:"Switch to Dark Theme",dark:"Switch to Light Theme"})[w.value]),o=()=>{const p=["light","medium","dark"],J=(p.indexOf(w.value)+1)%p.length;w.value=p[J],document.body.classList.remove("medium-mode","dark-mode"),w.value==="medium"?document.body.classList.add("medium-mode"):w.value==="dark"&&document.body.classList.add("dark-mode"),localStorage.setItem("theme",w.value)},x=async()=>{try{const p=await st.getStatus();h.value=p,p.installed?console.log("✅ SmartIR detected:",p.version):console.log("ℹ️ SmartIR not detected")}catch(p){console.error("Error checking SmartIR:",p),h.value={installed:!1,error:p.message}}},q=async()=>{var p,L,J;c.value=!0;try{const B=(await ne.get("/api/diagnostics/markdown")).data.markdown;if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(B),(p=u.value)==null||p.success("Diagnostic summary copied to clipboard!");else{const ae=document.createElement("textarea");ae.value=B,ae.style.position="fixed",ae.style.left="-999999px",ae.style.top="-999999px",document.body.appendChild(ae),ae.focus(),ae.select();try{if(document.execCommand("copy"))(L=u.value)==null||L.success("Diagnostic summary copied to clipboard!");else throw new Error("execCommand failed")}finally{document.body.removeChild(ae)}}s.value=!1}catch(Z){console.error("Error copying diagnostics:",Z),(J=u.value)==null||J.error("Failed to copy diagnostics: "+Z.message)}finally{c.value=!1}},U=async()=>{var p,L;c.value=!0;try{const J=await ne.get("/api/diagnostics/download",{responseType:"blob"}),Z=window.URL.createObjectURL(new Blob([J.data])),B=document.createElement("a");B.href=Z;const ae=J.headers["content-disposition"];let A="broadlink_manager_diagnostics.zip";if(ae){const N=ae.match(/filename="?(.+)"?/);N&&(A=N[1])}B.setAttribute("download",A),document.body.appendChild(B),B.click(),B.remove(),window.URL.revokeObjectURL(Z),(p=u.value)==null||p.success("Diagnostic bundle downloaded!"),s.value=!1}catch(J){console.error("Error downloading diagnostics:",J),(L=u.value)==null||L.error("Failed to download diagnostics")}finally{c.value=!1}},I=()=>{C.value&&(S.value=!S.value,localStorage.setItem("smartir_enabled",S.value.toString()),window.location.reload())},a=async()=>{var p,L,J;f.value=!0;try{const Z=await ne.post("/api/smartir/refresh-index");Z.data.success?(p=u.value)==null||p.success(`Updated to v${Z.data.version} (${Z.data.total_devices} devices)`,"✅ Index Updated"):(L=u.value)==null||L.error(Z.data.error||"Unknown error","❌ Update Failed")}catch(Z){console.error("Error updating SmartIR index:",Z),(J=u.value)==null||J.error("Failed to update device index","❌ Update Error")}finally{f.value=!1,s.value=!1}},b=p=>{p.target.closest(".settings-menu-container")||(s.value=!1)};return Ae(async()=>{const p=localStorage.getItem("theme");p&&["light","medium","dark"].includes(p)?(w.value=p,p==="medium"?document.body.classList.add("medium-mode"):p==="dark"&&document.body.classList.add("dark-mode")):localStorage.getItem("darkMode")==="true"&&(w.value="dark",document.body.classList.add("dark-mode"),localStorage.setItem("theme","dark")),await x();const L=et();L&&u.value&&(L.appContext.config.globalProperties.$toast=u.value),document.addEventListener("click",b)}),Xe(()=>{document.removeEventListener("click",b)}),qe("smartirStatus",h),qe("smartirEnabled",S),qe("refreshSmartIR",x),qe("toast",u),(p,L)=>(l(),n("div",bc,[e("header",hc,[e("div",kc,[L[13]||(L[13]=e("div",{class:"header-left"},[e("i",{class:"mdi mdi-remote"}),e("h1",null,"Broadlink Manager v2"),e("span",{class:"beta-badge"},"BETA")],-1)),e("div",wc,[e("button",{onClick:o,class:"icon-button",title:$.value},[e("i",{class:G(O.value)},null,2)],8,$c),e("div",Cc,[e("button",{onClick:L[0]||(L[0]=J=>s.value=!s.value),class:"icon-button",title:"Settings"},[...L[2]||(L[2]=[e("i",{class:"mdi mdi-cog"},null,-1)])]),s.value?(l(),n("div",_c,[L[9]||(L[9]=e("div",{class:"menu-section-title"},"Integration Settings",-1)),e("div",{class:G(["menu-item toggle-item",{disabled:!C.value}]),onClick:L[1]||(L[1]=J=>C.value?I():null),title:C.value?"":"SmartIR is not installed"},[e("div",Ic,[L[3]||(L[3]=e("i",{class:"mdi mdi-air-conditioner"},null,-1)),L[4]||(L[4]=e("span",null,"SmartIR Integration",-1)),C.value?R("",!0):(l(),n("span",Dc,"(Not Installed)"))]),e("div",{class:G(["toggle-switch",{active:S.value&&C.value,disabled:!C.value}])},[...L[5]||(L[5]=[e("div",{class:"toggle-slider"},null,-1)])],2)],10,Sc),S.value?(l(),n("a",Tc,[...L[6]||(L[6]=[e("i",{class:"mdi mdi-github"},null,-1),e("span",null,"SmartIR on GitHub",-1)])])):R("",!0),S.value?(l(),n("button",{key:1,onClick:a,class:"menu-item menu-subitem",disabled:f.value},[e("i",{class:G(["mdi",f.value?"mdi-loading mdi-spin":"mdi-refresh"])},null,2),e("span",null,m(f.value?"Updating...":"Update Device Index"),1)],8,xc)):R("",!0),L[10]||(L[10]=e("div",{class:"menu-divider"},null,-1)),L[11]||(L[11]=e("div",{class:"menu-section-title"},"Diagnostics",-1)),e("button",{onClick:q,class:"menu-item",disabled:c.value},[...L[7]||(L[7]=[e("i",{class:"mdi mdi-content-copy"},null,-1),e("span",null,"Copy Diagnostics",-1)])],8,Mc),e("button",{onClick:U,class:"menu-item",disabled:c.value},[...L[8]||(L[8]=[e("i",{class:"mdi mdi-download"},null,-1),e("span",null,"Download Diagnostics",-1)])],8,Rc),L[12]||(L[12]=je('<div class="menu-divider" data-v-4bc2c39f></div><div class="menu-section-title" data-v-4bc2c39f>Help &amp; Support</div><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2#readme" target="_blank" class="menu-item menu-link" data-v-4bc2c39f><i class="mdi mdi-book-open-variant" data-v-4bc2c39f></i><span data-v-4bc2c39f>Documentation</span></a><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2/issues" target="_blank" class="menu-item menu-link" data-v-4bc2c39f><i class="mdi mdi-bug" data-v-4bc2c39f></i><span data-v-4bc2c39f>Report Issue</span></a><div class="menu-divider" data-v-4bc2c39f></div><div class="menu-section-title" data-v-4bc2c39f>Community</div><a href="https://community.home-assistant.io/t/broadlink-manager-modern-web-interface-for-broadlink-devices/938473" target="_blank" class="menu-item menu-link" data-v-4bc2c39f><i class="mdi mdi-forum" data-v-4bc2c39f></i><span data-v-4bc2c39f>HA Forum Discussion</span></a><a href="https://www.reddit.com/r/homeassistant/comments/1o1q3kf/release_broadlink_manager_addon_a_modern_web_ui/" target="_blank" class="menu-item menu-link" data-v-4bc2c39f><i class="mdi mdi-reddit" data-v-4bc2c39f></i><span data-v-4bc2c39f>Reddit Discussion</span></a><div class="menu-divider" data-v-4bc2c39f></div><div class="menu-section-title" data-v-4bc2c39f>Project</div><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2" target="_blank" class="menu-item menu-link" data-v-4bc2c39f><i class="mdi mdi-github" data-v-4bc2c39f></i><span data-v-4bc2c39f>GitHub Repository</span></a><a href="https://ko-fi.com/tonyperkins" target="_blank" class="menu-item menu-link menu-item-sponsor" data-v-4bc2c39f><i class="mdi mdi-coffee" data-v-4bc2c39f></i><span data-v-4bc2c39f>Support on Ko-fi</span></a>',12))])):R("",!0)])])])]),e("main",Lc,[he(ic)]),e("footer",Ac,[e("p",null,"Broadlink Manager v"+m(_e(i))+" | Built with Vue "+m(mt),1)]),he(fc,{ref_key:"toastRef",ref:u},null,512)]))}},Ec=Ce(Oc,[["__scopeId","data-v-4bc2c39f"]]),at=vt(Ec),Vc=pt();at.use(Vc);at.mount("#app");
