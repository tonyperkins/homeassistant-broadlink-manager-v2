import{g as He,a as et,d as tt,c as z,r as y,o as xe,b as a,e as n,f as e,h as T,n as Y,u as _e,t as u,i as S,F as me,j as be,w as ue,k as J,v as De,l as pe,m as ze,p as fe,q as Ee,s as Fe,T as Je,x as ke,y as Se,z as Ae,A as ve,B as We,C as Pe,D as Te,E as Ke,G as Xe,H as ot,I as lt,J as nt,K as Ue,L as st,M as at}from"./vendor-DHe6d6Ka.js";(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const w of document.querySelectorAll('link[rel="modulepreload"]'))k(w);new MutationObserver(w=>{for(const s of w)if(s.type==="childList")for(const m of s.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&k(m)}).observe(document,{childList:!0,subtree:!0});function r(w){const s={};return w.integrity&&(s.integrity=w.integrity),w.referrerPolicy&&(s.referrerPolicy=w.referrerPolicy),w.crossOrigin==="use-credentials"?s.credentials="include":w.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function k(w){if(w.ep)return;w.ep=!0;const s=r(w);fetch(w.href,s)}})();let qe=!1;function Ve(){const o=He(),c=o==null?void 0:o.appContext.config.globalProperties.$toast;return c||(qe||(console.warn("Toast notification system not yet initialized - using console fallback"),qe=!0),{success:r=>console.log("✓",r),error:r=>console.error("✗",r),warning:r=>console.warn("⚠",r),info:r=>console.info("ℹ",r)})}const Ne="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAHBUlEQVR4nOxZC1BTVxo+9+aNZI2LNsgjWR4hgoIiRVDBslKnIKPbx1jqTrtYoakat1a6dNsdd7t1X8XHyAbEhdUu1u2mXdbasqJbtsaMIqBBECiPBmqEICEBEx4xJLlJ7s6lw6rJDeQ2FzLM+M1kBs7/3+/83zn/Oee/51JRFAXzGbCvA/AWjwX4GvNeANWXnXffHQ4+K6/dYbHeD+IFhjRkb1wn9WPQbEQ4IF/tQlXX2p5+/8OyczY74j/VxuMG3Sh/Oz9jaQDb4CmPT1LIbLXBfzrz0cmHg8fQpx1Yc1Ra+TsiXD4R0PqtRmAyj/LxbJeaujKIcPlEAINOM7vLXBaTZibCRWgRq3WGJZWX63aoNDpB8BJOX/bGlIqwpUv6iXBgWBHG7eUF8urUWvU6Z9sLGxI/IsLl8SJu6u4XigqPXkVspiVTbTQqU1/6Vn7ammh+G5FOMZyqludIKqUVU/9jcaSuTCo/unfHbiad4iBdwMu/P1bV1tO1xbk9NDC0/vwHB1xGcjqYLAh16zsHW3R6XXTu1mfFdAqMrIoSKNbGhLcQ4QGeppDJ7ACtPcqNEI6tT9O3Vqm+tygqNMDjrU9Sef6tIYM2JjUuuXzfC5knCEXsBI8WMZUCAxiCrfhWyMZkMNzYXNHVpwmXXqp5j0Hz0/1m57a3PQ8VHx4JoNMASIl9shLPFsB5ooO7iDXhCY/dAcCvT/79LwC1s/K2bDnAXcQeJRqwMzzeRt/bua0gLChcDsCDNQNBkEU/qot7o6j0kzETQpuJ40ZnT6xSrUoNWhyseHVz2ikv4n4QA5FSArE5IFlTZ0r3XU1MWODib6NCl3a9dkhSYxgbjo4XLq8sL9j7Ip36YEwMRjMNQazMhf7+RgYNnuyo7bY6ArFaWKuXRX495wLwoLk39sO9RaVnM5OTP8zLSjtjsljpp6ovi6pqr706eE8XBwGUSqEy9Guihf/92TMZhetjI5rJCHwKpBRzZqsNYtKp6KD+Pvv1w5ILdzR3UvD8HA4YefOl7N25JKUPIKuUwIJH7A5of/GJf7oLfrIz2EH786fSss+uKFzOk+8L0mqh6rpbmR0q5YyFGAQBSuHHlcUWxEaZyXfMhFD0Rgt9Oh/SBMiam58HAO+oc4XZMsK/1taT6M6uHjJw8w6VSNfvemM8TbzPlFlwsP5KyzfJeL6kCejXDgo894aASqOZ9O/uHwzq6B3ijhitkzOC7XS7j0g+V3S0vQTDDhYEoZSBobvJ+yXFNZ29gy4lOGmvlDBMIfQqSKV8539EWvXHhvbGHBSFrAwGW+vvxzLoR7RxzrNpsyPs0xcv7/lg1/ZfPtKvuw7MVhulUakWdvRq+XY3tWFT90Bk+52BCOzvyOBgjytSFKAgms+b9F/2o+BbKwUrvgjhhjSjKLAPG4YE7lJxfEIf5dyGOwMXrren/eF0RYXRNMrHDt4QbmjDEbHop9F8rqpddZd3sV6R/aWiabtWr41PW534V8m+PFHW+qSPL9TX7oM8WAaBi4IbE4S8yYNs/7asIgBA0ZStRqFM/MXxIzcgHBEBP+C6DJKLgJvK3uXvniitBsDmNzkSEAD9uv5k0aFjXy1gMQ0DQ5p4CAIwNuXLwyL/ExcpqMWeS42NUmxKXFf8VWPdz6cLnkqhGd/Pe+U1Cow/+ekJUYr4qJgvbik7f/Jw+0J/tjpvS3qxs7/LQZZfcrrkUmOdGI/cgUKIkB8pz0xK+CQjKf6z4MWckYftZqsderfsTInsZt0evDRgMRYMHhaLnk+NW1Y/nchxk5lZ+I/Pf/vl9RvbLYiVlSBcJv/VK9sKBCHc3hkF7D12/NzVltZn8YhzNj/3ev6LGeXTdQ6+uzLZ+C+5XNza05Nsd1gXcNgBvekJK/+du3lTUSiXMzzT80TgkkK8wJAGgCMAE5ooFFz3hHTr+lgZ9iMryOngkoi5WZuOc9hPtDu3r4198nTqygjCr3wYmrvVkSerZXljJoT0m0DcYm5g2Mg5WV39zrVWZZofkzaRnhB/bufm9FI/JpXQXj8F8bHyitqWxhzJmwUJT60SNJER+P+BCZjt34lzNbvickRoWVWNmGzuObnYWhER3oAdX41dPbj1jDeYEwGrInltKKCNtatub6hRfJOEnfJkcc+JgE9ltS/DkINuNI3xCo4fbXgm/0CnouvOcjK4Z/16/ZKia+3+kqIrEIQ+sgNx2Jzb5wsPxrD9GBZv+Gd9BqSXr4icg8cwMj4SLmv6+mlv+WddgGlilOPOZkEmFnrLP+sCVgtXyPHaHShkiw0XXPWWf9YF5Gb9uGzp4sCbj7ai4LkNTx2O5nPV3vLPyTeye6P32X+7KNujVKtSYJg+viEu/mx2etJZCgnD57OPfGRh3n8nfizA15j3Av4XAAD//5k1S2w3zfwVAAAAAElFTkSuQmCC",le=et.create({baseURL:"./",timeout:3e4,headers:{"Content-Type":"application/json"}});le.interceptors.request.use(o=>o,o=>Promise.reject(o));le.interceptors.response.use(o=>o,o=>(console.error("API Error:",o),o.response?console.error("Response error:",o.response.data):o.request?console.error("No response received"):console.error("Request setup error:",o.message),Promise.reject(o)));const it=tt("devices",{state:()=>({devices:[],loading:!1,error:null,selectedDevice:null}),getters:{deviceById:o=>c=>o.devices.find(r=>r.id===c),devicesByType:o=>c=>o.devices.filter(r=>r.entity_type===c),deviceCount:o=>o.devices.length,hasDevices:o=>o.devices.length>0},actions:{async loadDevices(o=!1){this.loading=!0,this.error=null;try{const c=o?`/api/devices/managed?_t=${Date.now()}`:"/api/devices/managed",r=await le.get(c);this.devices=r.data.devices||[],console.log("📥 Loaded devices:",this.devices),this.devices.forEach(k=>{console.log(`📥 Device "${k.name}":`,{id:k.id,device:k.device,commands:k.commands,commandCount:k.commands?Object.keys(k.commands).length:0})})}catch(c){this.error=c.message,console.error("Error loading devices:",c)}finally{this.loading=!1}},async createDevice(o){this.loading=!0,this.error=null;try{console.log("🏪 Store: Creating device with data:",o),console.log("🏪 Store: Device commands being sent:",o.commands);const c={device_name:o.name,device:o.device,area_id:o.area||"",area_name:o.area||"",entity_type:o.entity_type,icon:o.icon,broadlink_entity:o.broadlink_entity,device_type:o.device_type||"broadlink",commands:o.commands||{}};o.device_type==="smartir"&&o.smartir_config&&(c.smartir_config=o.smartir_config),console.log("🏪 Store: Transformed data for backend:",c);const r=await le.post("/api/devices/managed",c);return console.log("🏪 Store: Create response:",r.data),await this.loadDevices(),r.data}catch(c){throw console.error("Error creating device:",c),c}finally{this.loading=!1}},async updateDevice(o,c){this.loading=!0,this.error=null;try{const r=await le.put(`/api/devices/managed/${o}`,c);return await this.loadDevices(),r.data}catch(r){throw console.error("Error updating device:",r),r}finally{this.loading=!1}},async deleteDevice(o,c=!1){this.loading=!0,this.error=null;try{await le.delete(`/api/devices/managed/${o}`,{data:{delete_commands:c}}),this.devices=this.devices.filter(r=>r.id!==o)}catch(r){throw this.error=r.message,console.error("Error deleting device:",r),r}finally{this.loading=!1}},selectDevice(o){this.selectedDevice=o},clearSelection(){this.selectedDevice=null},clearError(){this.error=null},async syncAllAreas(){if(!this.devices||this.devices.length===0){console.log("⚠️ No devices to sync");return}console.log(`🔄 Syncing areas from Home Assistant for ${this.devices.length} devices...`);try{const o=await Promise.all(this.devices.map(k=>(console.log(`🔄 Syncing device: ${k.id} (${k.name})`),le.post(`/api/devices/${k.id}/sync-area`).then(w=>w.data.success&&w.data.area?(console.log(`✅ Synced area for ${k.name}: ${w.data.area}`),{status:"synced",device:k.name}):{status:"no_area"}).catch(w=>{var s;return((s=w.response)==null?void 0:s.status)===404?(console.log(`❌ Device not found in HA: ${k.id}`),{status:"not_found"}):(console.warn(`⚠️ Failed to sync area for ${k.id}:`,w.message),{status:"error",error:w.message})})))),c=o.filter(k=>k.status==="synced").length,r=o.filter(k=>k.status==="not_found").length;await this.loadDevices(!0),c>0?console.log(`✅ Area sync complete: ${c} synced, ${r} not found in HA`):r>0&&console.log(`ℹ️ No areas synced - ${r} entities not found in HA registry (generate entities first)`)}catch(o){console.debug("Area sync error:",o)}}}});function Ge(o){const c=z(()=>o.value||o),r=z(()=>{switch(c.value){case"climate":return"mdi:air-conditioner";case"fan":return"mdi:fan";case"light":return"mdi:lightbulb";case"media_player":return"mdi:television";case"switch":return"mdi:light-switch";default:return"mdi:devices"}}),k=z(()=>`device-type-${c.value}-color`),w=z(()=>`tag-${c.value}-bg`);return{icon:r,colorClass:k,tagBgClass:w}}const rt=""+new URL("broadlink-logo-BDjImjRY.png",import.meta.url).href,he=(o,c)=>{const r=o.__vccOpts||o;for(const[k,w]of c)r[k]=w;return r},dt={class:"device-header"},ut={class:"device-info"},ct=["title"],mt={class:"device-labels"},vt={class:"device-type"},pt=["src","alt","title"],ft={class:"device-body"},gt={class:"device-stats"},yt={class:"stat",title:"Learned command count"},bt={class:"stat",title:"HA Assigned Area"},ht={class:"device-meta"},kt={class:"device-id",title:"Device ID"},wt={key:0,class:"storage-name"},$t={key:1,class:"broadlink-entity",title:"Controller Device"},Ct={key:2,class:"controller-device"},_t={class:"device-actions"},St=["disabled"],Dt=["disabled"],It=["disabled"],xt={key:0,class:"disabled-overlay"},Tt={__name:"DeviceCard",props:{device:{type:Object,required:!0},broadlinkDevices:{type:Array,default:()=>[]}},emits:["edit","delete","learn"],setup(o){const c=o,r=z(()=>localStorage.getItem("smartir_simulate_not_installed")==="true"),k=z(()=>c.device.device_type==="smartir"&&r.value),w=y(null),s=Ge(z(()=>c.device.entity_type)),m=z(()=>c.device.icon?c.device.icon:s.icon.value),v=i=>i&&i.startsWith("mdi:")?`mdi ${i.replace(":"," mdi-")}`:`mdi mdi-${i}`,_=z(()=>({light:"Light",fan:"Fan",switch:"Switch",media_player:"Media Player",cover:"Cover"})[c.device.entity_type]||c.device.entity_type),D=z(()=>(c.device.device_type||"broadlink")==="smartir"?"SmartIR":"Broadlink"),V=z(()=>(c.device.device_type||"broadlink")==="smartir"?Ne:rt),b=z(()=>(c.device.device_type||"broadlink")==="smartir"?w.value!==null?w.value:0:Object.keys(c.device.commands||{}).length),t=i=>{if(!i)return"";const f=c.broadlinkDevices.find(p=>p.entity_id===i);return f&&f.name||i},A=z(()=>{if(!c.device.device)return!1;const i=c.device.id.includes(".")?c.device.id.split(".")[1]:c.device.id;return c.device.device!==i}),q=z(()=>{if(!c.device.broadlink_entity)return"";const i=c.broadlinkDevices.find(f=>f.entity_id===c.device.broadlink_entity);return i&&i.name||c.device.broadlink_entity}),E=i=>{if(!i||typeof i!="object")return 0;let f=0;for(const p of Object.values(i))typeof p=="string"?f++:typeof p=="object"&&(f+=E(p));return f},R=async()=>{if(!(!c.device.device_code||!c.device.entity_type))try{const i=await le.get("/api/smartir/codes/code",{params:{entity_type:c.device.entity_type,code_id:c.device.device_code}});if(i.data.success&&i.data.code){const f=i.data.code;f.commands&&(w.value=E(f.commands))}}catch(i){console.error("Error fetching SmartIR command count:",i)}};return xe(async()=>{(c.device.device_type||"broadlink")==="smartir"&&await R()}),(i,f)=>(n(),a("div",{class:Y(["device-card",{disabled:k.value}])},[e("div",dt,[e("div",{class:Y(["device-icon",_e(s).colorClass.value])},[e("i",{class:Y(v(m.value))},null,2)],2),e("div",ut,[e("h3",{title:o.device.name},u(o.device.name),9,ct),e("div",mt,[e("span",vt,u(_.value),1)])]),e("img",{src:V.value,alt:D.value,title:D.value,class:"device-source-logo"},null,8,pt)]),e("div",ft,[e("div",gt,[e("div",yt,[f[3]||(f[3]=e("i",{class:"mdi mdi-remote"},null,-1)),e("span",null,u(b.value)+" command"+u(b.value!==1?"s":""),1)]),e("div",bt,[f[4]||(f[4]=e("i",{class:"mdi mdi-map-marker"},null,-1)),e("span",null,u(o.device.area||"No area"),1)])]),e("div",ht,[e("span",kt,[f[5]||(f[5]=e("i",{class:"mdi mdi-identifier"},null,-1)),S(" "+u(o.device.id),1)]),A.value?(n(),a("span",wt,[f[6]||(f[6]=e("i",{class:"mdi mdi-code-tags"},null,-1)),S(" "+u(o.device.device),1)])):T("",!0),o.device.broadlink_entity?(n(),a("span",$t,[f[7]||(f[7]=e("i",{class:"mdi mdi-access-point"},null,-1)),S(" "+u(q.value),1)])):T("",!0),o.device.controller_device?(n(),a("span",Ct,[f[8]||(f[8]=e("i",{class:"mdi mdi-access-point"},null,-1)),S(" "+u(t(o.device.controller_device)),1)])):T("",!0)])]),e("div",_t,[e("button",{onClick:f[0]||(f[0]=p=>!k.value&&i.$emit("learn",o.device)),class:"icon-btn",title:"Manage Commands",disabled:k.value},[...f[9]||(f[9]=[e("i",{class:"mdi mdi-remote-tv"},null,-1)])],8,St),e("button",{onClick:f[1]||(f[1]=p=>!k.value&&i.$emit("edit",o.device)),class:"icon-btn",title:"Edit",disabled:k.value},[...f[10]||(f[10]=[e("i",{class:"mdi mdi-pencil"},null,-1)])],8,Dt),e("button",{onClick:f[2]||(f[2]=p=>!k.value&&i.$emit("delete",o.device)),class:"icon-btn danger",title:"Delete",disabled:k.value},[...f[11]||(f[11]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,It)]),k.value?(n(),a("div",xt,[...f[12]||(f[12]=[e("div",{class:"disabled-message"},[e("i",{class:"mdi mdi-eye-off"}),e("span",null,"SmartIR Not Installed")],-1)])])):T("",!0)],2))}},Mt=he(Tt,[["__scopeId","data-v-7a7f5c18"]]),Rt={name:"DeviceListView",props:{devices:{type:Array,required:!0}},methods:{getDeviceCommands(o){return o.commands&&typeof o.commands=="object"?Object.keys(o.commands):[]},sendCommand(o,c){this.$emit("send-command",{device:o,command:c})},editDevice(o){this.$emit("edit-device",o)},deleteDevice(o){this.$emit("delete-device",o)}}},Lt={class:"device-list-view"},At={class:"device-table"},Ot={class:"device-info"},Vt={class:"device-name"},Et={class:"device-entity"},Ut={class:"device-area"},Pt={class:"device-type"},jt={class:"device-commands"},Ft={key:0,class:"command-list"},Nt=["onClick"],Bt={key:0,class:"no-commands"},qt={key:1,class:"smartir-info"},Ht={class:"profile-code"},zt={class:"device-actions"},Jt=["onClick"],Wt=["onClick"];function Kt(o,c,r,k,w,s){return n(),a("div",Lt,[e("table",At,[c[2]||(c[2]=e("thead",null,[e("tr",null,[e("th",null,"Device"),e("th",null,"Room/Area"),e("th",null,"Type"),e("th",null,"Commands"),e("th",null,"Actions")])],-1)),e("tbody",null,[(n(!0),a(me,null,be(r.devices,m=>(n(),a("tr",{key:m.entity_id,class:"device-row"},[e("td",Ot,[e("div",Vt,u(m.friendly_name||m.name),1),e("div",Et,u(m.entity_id),1)]),e("td",Ut,u(m.area||"No Area"),1),e("td",Pt,[e("span",{class:Y(["type-badge",m.device_type])},u(m.device_type==="smartir"?"SmartIR":"Broadlink"),3)]),e("td",jt,[m.device_type==="broadlink"?(n(),a("div",Ft,[(n(!0),a(me,null,be(s.getDeviceCommands(m),v=>(n(),a("button",{key:v,class:"command-btn",onClick:_=>s.sendCommand(m,v)},u(v),9,Nt))),128)),s.getDeviceCommands(m).length===0?(n(),a("span",Bt," No commands ")):T("",!0)])):m.device_type==="smartir"?(n(),a("div",qt,[e("span",Ht,"Profile: "+u(m.device_code),1)])):T("",!0)]),e("td",zt,[e("button",{class:"action-btn edit",onClick:v=>s.editDevice(m),title:"Edit"},[...c[0]||(c[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})],-1)])],8,Jt),e("button",{class:"action-btn delete",onClick:v=>s.deleteDevice(m),title:"Delete"},[...c[1]||(c[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"3 6 5 6 21 6"}),e("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})],-1)])],8,Wt)])]))),128))])])])}const Xt=he(Rt,[["render",Kt],["__scopeId","data-v-34e538b4"]]),Gt={class:"icon-picker"},Yt={class:"icon-input-wrapper"},Zt=["id","placeholder"],Qt={key:0,class:"icon-preview"},eo={key:0,class:"icon-dropdown"},to={class:"icon-grid"},oo=["onMousedown","title"],lo={__name:"IconPicker",props:{modelValue:{type:String,default:""},inputId:{type:String,default:"icon-input"},placeholder:{type:String,default:"e.g., mdi:television"}},emits:["update:modelValue"],setup(o,{emit:c}){const r=o,k=c,w=y(r.modelValue),s=y(!1),m=["television","speaker","radio","music","video","movie","play","pause","stop","skip-next","skip-previous","volume-high","volume-medium","volume-low","volume-off","remote","remote-tv","cast","chromecast","spotify","netflix","youtube","lightbulb","lightbulb-on","lightbulb-off","lamp","floor-lamp","ceiling-light","light-switch","led-strip","led-strip-variant","wall-sconce","chandelier","spotlight","track-light","vanity-light","desk-lamp","fan","ceiling-fan","air-conditioner","thermometer","thermostat","heat-wave","snowflake","fire","radiator","water-boiler","hvac","blinds","blinds-open","window-shutter","window-shutter-open","curtains","curtains-closed","roller-shade","roller-shade-closed","garage","garage-open","gate","door","door-open","window-open","window-closed","washing-machine","tumble-dryer","dishwasher","refrigerator","stove","microwave","oven","toaster","kettle","coffee","coffee-maker","blender","robot-vacuum","robot-vacuum-variant","vacuum","broom","spray-bottle","lock","lock-open","lock-smart","key","shield","shield-check","alarm-light","bell","doorbell","camera","cctv","motion-sensor","smoke-detector","fire-extinguisher","water-alert","gas-cylinder","sofa","bed","bed-double","desk","chair","table","bookshelf","home","home-outline","home-assistant","floor-plan","room","weather-sunny","weather-night","weather-cloudy","weather-rainy","weather-snowy","weather-lightning","weather-windy","weather-fog","weather-partly-cloudy","umbrella","water","water-percent","phone","cellphone","tablet","laptop","desktop-tower","monitor","keyboard","mouse","printer","router","router-wireless","access-point","wifi","bluetooth","usb","hdmi-port","ethernet","power","power-plug","power-socket","battery","battery-charging","lightning-bolt","flash","solar-panel","solar-power","leaf","tree","flower","sprout","grass","watering-can","shovel","fence","pool","hot-tub","silverware","silverware-fork-knife","food","food-apple","glass-wine","glass-cocktail","bottle-wine","pot","pot-steam","shower","shower-head","bathtub","toilet","sink","faucet","hand-wash","car","car-side","garage-variant","tools","hammer","wrench","screwdriver","toolbox","ladder","heart","heart-pulse","run","walk","bike","dumbbell","yoga","scale-bathroom","thermometer-lines","clock","clock-outline","timer","alarm","calendar","calendar-today","calendar-clock","history","bell-ring","bell-alert","alert","alert-circle","information","help-circle","check","check-circle","close-circle","minus-circle","plus-circle","arrow-up","arrow-down","arrow-left","arrow-right","chevron-up","chevron-down","menu","dots-vertical","dots-horizontal","cog","tune","circle","square","triangle","hexagon","star","star-outline","heart-outline","plus","minus","close","check-bold","eye","eye-off","account","account-group","baby","dog","cat","paw","gift","balloon","party-popper","candle","book","book-open","newspaper","email","message","phone-classic"];ue(()=>r.modelValue,b=>{w.value=b});const v=z(()=>{if(!w.value)return m.slice(0,50);const b=w.value.toLowerCase().replace("mdi:","");return m.filter(t=>t.toLowerCase().includes(b)).slice(0,50)}),_=()=>{s.value=!0,k("update:modelValue",w.value)},D=()=>{setTimeout(()=>{s.value=!1},200)},V=b=>{w.value=`mdi:${b}`,k("update:modelValue",w.value),s.value=!1};return(b,t)=>(n(),a("div",Gt,[e("div",Yt,[J(e("input",{id:o.inputId,"onUpdate:modelValue":t[0]||(t[0]=A=>w.value=A),type:"text",placeholder:o.placeholder,onInput:_,onFocus:t[1]||(t[1]=A=>s.value=!0),onBlur:D},null,40,Zt),[[De,w.value]]),w.value?(n(),a("div",Qt,[e("i",{class:Y(`mdi mdi-${w.value.replace("mdi:","")}`)},null,2)])):T("",!0)]),s.value&&v.value.length>0?(n(),a("div",eo,[e("div",to,[(n(!0),a(me,null,be(v.value,A=>(n(),a("div",{key:A,class:"icon-option",onMousedown:pe(q=>V(A),["prevent"]),title:A},[e("i",{class:Y(`mdi mdi-${A}`)},null,2),e("span",null,u(A),1)],40,oo))),128))])])):T("",!0)]))}},no=he(lo,[["__scopeId","data-v-a64f5011"]]),so={key:0,class:"dropdown-label"},ao={key:0,class:"required"},io=["placeholder","disabled","onKeydown"],ro={class:"dropdown-icons"},uo={key:0,class:"mdi mdi-loading mdi-spin"},co={key:2,class:"mdi mdi-chevron-down"},mo={key:1,class:"error-message"},vo={key:2,class:"hint-message"},po={key:0,class:"dropdown-menu"},fo=["onMousedown","onMouseenter"],go={class:"option-content"},yo={class:"option-label"},bo={key:0,class:"option-description"},ho={key:0,class:"mdi mdi-check selected-icon"},ko={key:3,class:"dropdown-menu"},wo={__name:"SearchableDropdown",props:{modelValue:{type:[String,Number,Object],default:null},options:{type:Array,required:!0,default:()=>[]},label:{type:String,default:""},placeholder:{type:String,default:"Search..."},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},error:{type:String,default:""},hint:{type:String,default:""},optionLabel:{type:String,default:"label"},optionValue:{type:String,default:"value"},optionDescription:{type:String,default:"description"},filterMethod:{type:Function,default:null}},emits:["update:modelValue","change","search"],setup(o,{emit:c}){const r=o,k=c,w=y(null),s=y(null),m=y(""),v=y(!1),_=y(0),D=y(!1),V=L=>typeof L=="string"||typeof L=="number"?L:L[r.optionLabel]||L.label||L.name||String(L),b=L=>typeof L=="string"||typeof L=="number"?L:L[r.optionValue]||L.value||L.id||L,t=L=>typeof L=="string"||typeof L=="number"?"":L[r.optionDescription]||L.description||"",A=L=>{const B=b(L);return typeof r.modelValue=="object"?b(r.modelValue)===B:r.modelValue===B},q=z(()=>{if(!m.value)return r.options;if(r.filterMethod)return r.options.filter(B=>r.filterMethod(B,m.value));const L=m.value.toLowerCase();return r.options.filter(B=>{const Z=V(B).toLowerCase(),ce=t(B).toLowerCase();return Z.includes(L)||ce.includes(L)})}),E=z(()=>{if(!r.modelValue)return"";const L=r.options.find(B=>{const Z=b(B);return typeof r.modelValue=="object"?Z===b(r.modelValue):Z===r.modelValue});return L?V(L):""});ue(()=>r.modelValue,L=>{D.value||(m.value=E.value)}),ue(()=>r.options,()=>{!D.value&&r.modelValue&&(m.value=E.value)},{deep:!0}),ue(m,L=>{k("search",L),_.value=0}),xe(()=>{m.value=E.value});const R=()=>{var L;D.value=!0,v.value=!0,(L=s.value)==null||L.select()},i=()=>{D.value=!1,setTimeout(()=>{v.value=!1,r.modelValue?m.value=E.value:m.value=""},200)},f=()=>{var L;v.value=!1,(L=s.value)==null||L.blur()},p=L=>{const B=b(L);k("update:modelValue",B),k("change",B,L),m.value=V(L),f()},M=()=>{var L;k("update:modelValue",null),k("change",null,null),m.value="",(L=s.value)==null||L.focus()},G=()=>{if(!v.value){v.value=!0;return}_.value<q.value.length-1&&_.value++},ee=()=>{_.value>0&&_.value--},te=()=>{q.value.length>0&&_.value>=0&&p(q.value[_.value])},se=L=>{w.value&&!w.value.contains(L.target)&&(v.value=!1,r.modelValue?m.value=E.value:m.value="")};return xe(()=>{document.addEventListener("click",se)}),ze(()=>{document.removeEventListener("click",se)}),(L,B)=>(n(),a("div",{class:"searchable-dropdown",ref_key:"dropdownRef",ref:w},[o.label?(n(),a("label",so,[S(u(o.label)+" ",1),o.required?(n(),a("span",ao,"*")):T("",!0)])):T("",!0),e("div",{class:Y(["dropdown-input-wrapper",{"has-error":o.error,disabled:o.disabled}])},[J(e("input",{ref_key:"inputRef",ref:s,type:"text","onUpdate:modelValue":B[0]||(B[0]=Z=>m.value=Z),placeholder:o.placeholder,disabled:o.disabled||o.loading,onFocus:R,onBlur:i,onKeydown:[Ee(pe(G,["prevent"]),["down"]),Ee(pe(ee,["prevent"]),["up"]),Ee(pe(te,["prevent"]),["enter"]),Ee(f,["escape"])],class:"dropdown-input"},null,40,io),[[De,m.value]]),e("div",ro,[o.loading?(n(),a("i",uo)):o.modelValue&&!o.disabled?(n(),a("i",{key:1,class:"mdi mdi-close-circle clear-icon",onClick:M})):(n(),a("i",co))])],2),o.error?(n(),a("div",mo,u(o.error),1)):T("",!0),o.hint&&!o.error?(n(),a("div",vo,u(o.hint),1)):T("",!0),fe(Je,{name:"dropdown"},{default:Fe(()=>[v.value&&q.value.length>0?(n(),a("div",po,[(n(!0),a(me,null,be(q.value,(Z,ce)=>(n(),a("div",{key:b(Z),class:Y(["dropdown-item",{highlighted:ce===_.value,selected:A(Z)}]),onMousedown:pe(ye=>p(Z),["prevent"]),onMouseenter:ye=>_.value=ce},[e("div",go,[e("div",yo,u(V(Z)),1),t(Z)?(n(),a("div",bo,u(t(Z)),1)):T("",!0)]),A(Z)?(n(),a("i",ho)):T("",!0)],42,fo))),128))])):T("",!0)]),_:1}),v.value&&q.value.length===0&&!o.loading?(n(),a("div",ko,[...B[1]||(B[1]=[e("div",{class:"dropdown-item no-results"},[e("i",{class:"mdi mdi-magnify"}),S(" No results found ")],-1)])])):T("",!0)],512))}},je=he(wo,[["__scopeId","data-v-679ce35f"]]),$o={class:"smartir-selector"},Co={class:"form-group"},_o={class:"form-group"},So={class:"form-group"},Do=["value"],Io={key:0,class:"error-message"},xo={class:"form-group"},To={class:"form-group"},Mo={key:1,class:"code-info"},Ro={class:"info-content"},Lo={class:"info-row"},Ao={class:"info-value"},Oo={class:"info-row"},Vo={class:"info-value"},Eo={key:0,class:"info-row"},Uo={class:"info-value"},Po={class:"info-row"},jo={class:"info-value"},Fo={__name:"SmartIRDeviceSelector",props:{entityType:{type:String,required:!0},modelValue:{type:Object,default:()=>({})},broadlinkDevices:{type:Array,default:()=>[]}},emits:["update:modelValue","change"],setup(o,{expose:c,emit:r}){const k=o,w=r,s=y([]),m=y([]),v=y(""),_=y(""),D=y(""),V=y(""),b=y(""),t=y(null),A=y(!1),q=y(!1),E=y({manufacturer:"",model:"",controller:""});xe(async()=>{if(await R(),k.modelValue&&(v.value=k.modelValue.manufacturer||"",_.value=k.modelValue.device_code||"",D.value=k.modelValue.controller_device||"",V.value=k.modelValue.temperature_sensor||"",b.value=k.modelValue.humidity_sensor||"",v.value&&(await i(v.value),_.value&&m.value.length>0))){const L=m.value.find(B=>B.code===_.value);L&&(t.value={code:L.code,manufacturer:v.value,models:L.models,controller:L.controller})}}),ue(()=>k.entityType,async L=>{L&&(v.value="",_.value="",m.value=[],t.value=null,await R())});const R=async()=>{if(k.entityType){A.value=!0,E.value.manufacturer="";try{const L=await le.get("/api/smartir/codes/manufacturers",{params:{entity_type:k.entityType}});if(L.data.success)s.value=L.data.manufacturers||[];else throw new Error(L.data.error||"Failed to load manufacturers")}catch(L){console.error("Error loading manufacturers:",L),E.value.manufacturer="Failed to load manufacturers. Please try again.",s.value=[]}finally{A.value=!1}}},i=async L=>{if(!(!L||!k.entityType)){q.value=!0,E.value.model="";try{const B=await le.get("/api/smartir/codes/models",{params:{entity_type:k.entityType,manufacturer:L}});if(B.data.success){const Z=B.data.models||[];m.value=Z.map(ce=>{const ye=ce.models&&ce.models.length>0?ce.models.join(", "):`Code ${ce.code}`;return{code:ce.code,label:ye,description:`Code: ${ce.code}`,models:ce.models,controller:ce.controller}})}else throw new Error(B.data.error||"Failed to load models")}catch(B){console.error("Error loading models:",B),E.value.model="Failed to load models. Please try again.",m.value=[]}finally{q.value=!1}}},f=async L=>{v.value=L,_.value="",t.value=null,m.value=[],L&&await i(L),te()},p=()=>{const L=m.value.find(B=>B.code===_.value);L&&(t.value={code:L.code,manufacturer:v.value,models:L.models,controller:L.controller}),te()},M=()=>{te()},G=()=>{te()},ee=()=>{te()},te=()=>{var B,Z;const L={manufacturer:v.value,model:((Z=(B=t.value)==null?void 0:B.models)==null?void 0:Z[0])||"",device_code:_.value,controller_device:D.value};k.entityType==="climate"&&(V.value&&(L.temperature_sensor=V.value),b.value&&(L.humidity_sensor=b.value)),w("update:modelValue",L),w("change",L)};return c({validate:()=>{let L=!0;return E.value={manufacturer:"",model:"",controller:""},v.value||(E.value.manufacturer="Manufacturer is required",L=!1),_.value||(E.value.model="Model is required",L=!1),D.value||(E.value.controller="Broadlink controller is required",L=!1),L}}),(L,B)=>(n(),a("div",$o,[e("div",Co,[fe(je,{modelValue:v.value,"onUpdate:modelValue":B[0]||(B[0]=Z=>v.value=Z),options:s.value,label:"Manufacturer",placeholder:"Search manufacturers...",required:"",loading:A.value,error:E.value.manufacturer,hint:"Select the device manufacturer",onChange:f},null,8,["modelValue","options","loading","error"])]),e("div",_o,[fe(je,{modelValue:_.value,"onUpdate:modelValue":B[1]||(B[1]=Z=>_.value=Z),options:m.value,"option-label":"label","option-value":"code","option-description":"description",label:"Model",placeholder:"Search models...",required:"",disabled:!v.value,loading:q.value,error:E.value.model,hint:"Select the device model",onChange:p},null,8,["modelValue","options","disabled","loading","error"])]),e("div",So,[B[6]||(B[6]=e("label",{for:"controller-device"},[e("i",{class:"mdi mdi-remote"}),S(" Controller Device * ")],-1)),J(e("select",{id:"controller-device","onUpdate:modelValue":B[2]||(B[2]=Z=>D.value=Z),required:"",onChange:M},[B[5]||(B[5]=e("option",{value:""},"-- Select Controller Device --",-1)),(n(!0),a(me,null,be(o.broadlinkDevices,Z=>(n(),a("option",{key:Z.entity_id,value:Z.entity_id},[S(u(Z.name||Z.entity_id)+" ",1),Z.area_name?(n(),a(me,{key:0},[S(" - "+u(Z.area_name),1)],64)):T("",!0)],8,Do))),128))],544),[[ke,D.value]]),B[7]||(B[7]=e("small",null,"Which remote device will send the IR/RF commands",-1)),E.value.controller?(n(),a("div",Io,u(E.value.controller),1)):T("",!0)]),o.entityType==="climate"?(n(),a(me,{key:0},[e("div",xo,[B[8]||(B[8]=e("label",{for:"temperature-sensor"},"Temperature Sensor",-1)),J(e("input",{id:"temperature-sensor","onUpdate:modelValue":B[3]||(B[3]=Z=>V.value=Z),type:"text",placeholder:"e.g., sensor.living_room_temperature",onInput:G},null,544),[[De,V.value]]),B[9]||(B[9]=e("small",null,"Optional: Temperature sensor entity for current temperature",-1))]),e("div",To,[B[10]||(B[10]=e("label",{for:"humidity-sensor"},"Humidity Sensor",-1)),J(e("input",{id:"humidity-sensor","onUpdate:modelValue":B[4]||(B[4]=Z=>b.value=Z),type:"text",placeholder:"e.g., sensor.living_room_humidity",onInput:ee},null,544),[[De,b.value]]),B[11]||(B[11]=e("small",null,"Optional: Humidity sensor entity for current humidity",-1))])],64)):T("",!0),t.value?(n(),a("div",Mo,[B[16]||(B[16]=e("div",{class:"info-header"},[e("i",{class:"mdi mdi-information"}),e("span",null,"Selected Device Code")],-1)),e("div",Ro,[e("div",Lo,[B[12]||(B[12]=e("span",{class:"info-label"},"Code ID:",-1)),e("span",Ao,u(t.value.code_id),1)]),e("div",Oo,[B[13]||(B[13]=e("span",{class:"info-label"},"Manufacturer:",-1)),e("span",Vo,u(t.value.manufacturer),1)]),t.value.models&&t.value.models.length>0?(n(),a("div",Eo,[B[14]||(B[14]=e("span",{class:"info-label"},"Supported Models:",-1)),e("span",Uo,u(t.value.models.join(", ")),1)])):T("",!0),e("div",Po,[B[15]||(B[15]=e("span",{class:"info-label"},"Controller:",-1)),e("span",jo,u(t.value.controller||"Broadlink"),1)])])])):T("",!0)]))}},No=he(Fo,[["__scopeId","data-v-1911c8f6"]]),Bo={class:"modal-content"},qo={class:"modal-header"},Ho={class:"input-wrapper"},zo={key:0,class:"validation-tooltip"},Jo={class:"input-wrapper"},Wo=["disabled"],Ko={key:0,class:"validation-tooltip"},Xo={key:0,class:"smartir-notice"},Go={key:0,class:"notice-success"},Yo={key:1,class:"notice-warning"},Zo={key:1,class:"smartir-notice"},Qo={key:2},el={class:"form-group"},tl=["disabled"],ol=["disabled"],ll={key:0},nl={key:1},sl={key:2},al={key:3},il={key:0,class:"form-group"},rl={class:"area-display-readonly"},dl=["value"],ul=["disabled"],cl=["href"],ml={key:1,class:"form-group"},vl={class:"form-group"},pl={class:"input-wrapper"},fl=["value"],gl=["value"],yl={key:2,class:"validation-tooltip"},bl={key:0},hl={key:1},kl={key:3,class:"smartir-section"},wl={class:"modal-footer"},$l={type:"submit",form:"device-form",class:"btn btn-primary"},Cl={__name:"DeviceForm",props:{device:{type:Object,default:null}},emits:["save","cancel"],setup(o,{emit:c}){const r=o,k=c,w=Se("smartirStatus"),s=Se("smartirEnabled"),m=z(()=>{var d;return localStorage.getItem("smartir_simulate_not_installed")==="true"?!1:((d=w==null?void 0:w.value)==null?void 0:d.installed)||!1}),v=z(()=>!!r.device),_=z(()=>["climate","media_player","fan","light"].includes(t.value.entity_type)),D=z(()=>m.value?!_.value&&t.value.entity_type?"(Not supported for this type)":"(Pre-configured Codes)":"(Requires SmartIR)"),V=z(()=>{var d;const I=((d=r.device)==null?void 0:d.commands)||{};return Object.keys(I).length>0}),b=z(()=>{if(!t.value.broadlink_entity)return"";const I=i.value.find(d=>d.entity_id===t.value.broadlink_entity);return I&&I.name||t.value.broadlink_entity}),t=y({name:"",entity_type:"",device_type:"broadlink",device:"",area:"",icon:"",broadlink_entity:"",enabled:!0,commands:{}}),A=y({name:"",entity_type:"",broadlink_entity:""}),q=y({}),E=y(null),R=y([]),i=y([]),f=y(null),p=y(null),M=y(null),G=y(!1);xe(async()=>{r.device&&(t.value={...r.device,device_type:r.device.device_type||"broadlink"},t.value.device_type==="smartir"&&(q.value={manufacturer:r.device.manufacturer,model:r.device.model,device_code:r.device.device_code,controller_device:r.device.controller_device,temperature_sensor:r.device.temperature_sensor,humidity_sensor:r.device.humidity_sensor})),await Promise.all([ee(),te()])});const ee=async()=>{try{const I=await le.get("/api/areas");R.value=I.data.areas||[]}catch(I){console.error("Error loading areas:",I),R.value=[]}},te=async()=>{try{const d=(await le.get("/api/remote/devices")).data.devices||[];i.value=d,console.log("Loaded remote devices:",d)}catch(I){console.error("Error loading remote devices:",I),i.value=[]}},se=I=>{if(!I)return"";const d=I.toLowerCase();for(const U of R.value){const H=U.toLowerCase();if(d.includes(H))return U}return""},L=(I,d="")=>{const U=d.toLowerCase();return U.includes("tv")?"mdi:television":U.includes("lamp")?"mdi:lamp":U.includes("ceiling")?"mdi:ceiling-light":U.includes("floor")?"mdi:floor-lamp":U.includes("desk")?"mdi:desk-lamp":U.includes("fan")?"mdi:fan":U.includes("ac")||U.includes("air con")?"mdi:air-conditioner":U.includes("heater")?"mdi:radiator":U.includes("blind")?"mdi:blinds":U.includes("curtain")?"mdi:curtains":U.includes("garage")?"mdi:garage":U.includes("speaker")||U.includes("stereo")?"mdi:speaker":U.includes("receiver")?"mdi:audio-video":{light:"mdi:lightbulb",fan:"mdi:fan",switch:"mdi:light-switch",media_player:"mdi:television",cover:"mdi:window-shutter",climate:"mdi:thermostat"}[I]||"mdi:devices"};ue(()=>t.value.name,I=>{if(!v.value&&I&&!t.value.area){const d=se(I);d&&(t.value.area=d)}!v.value&&I&&t.value.entity_type&&(G.value||!t.value.icon)&&(t.value.icon=L(t.value.entity_type,I),G.value=!0)}),ue(()=>t.value.entity_type,I=>{!v.value&&I&&(G.value||!t.value.icon)&&(t.value.icon=L(I,t.value.name),G.value=!0)}),ue(()=>t.value.icon,(I,d)=>{d!==void 0&&I!==d&&!G.value&&(G.value=!1),I||(G.value=!1)});const B=y(!1),Z=async()=>{var I;if((I=r.device)!=null&&I.id){B.value=!0;try{const d=await le.post(`/api/devices/${r.device.id}/sync-area`);d.data.success?(t.value.area=d.data.area||"",d.data.area?console.log(`Area synced: ${d.data.area}`):console.log("No area assigned in Home Assistant")):console.warn(d.data.message||"Entity not found in HA")}catch(d){console.error("Failed to sync area:",d)}finally{B.value=!1}}},ce=()=>{var U;return!((U=r.device)!=null&&U.id)||!t.value.entity_type?"#":`/config/entities/entity/${`${t.value.entity_type}.${r.device.id}`}`},ye=()=>{A.value={name:"",entity_type:"",broadlink_entity:""};let I=!0;return(!t.value.name||t.value.name.trim()==="")&&(A.value.name="Device name is required",I=!1),t.value.entity_type||(A.value.entity_type="Entity type is required",I=!1),t.value.device_type==="broadlink"&&!t.value.broadlink_entity&&(A.value.broadlink_entity="Broadlink device is required",I=!1),I},Ie=I=>{A.value[I]=""},we=async()=>{if(t.value.device_type==="smartir"){if(E.value&&!E.value.validate())return;const I={...t.value,smartir_config:{manufacturer:q.value.manufacturer,model:q.value.model,code_id:q.value.device_code,controller_device:q.value.controller_device}};k("save",I)}else{if(!ye())return;k("save",{...t.value})}},$e=I=>{q.value=I};return(I,d)=>(n(),a("div",{class:"modal-overlay",onClick:d[11]||(d[11]=pe(U=>I.$emit("cancel"),["self"]))},[e("div",Bo,[e("div",qo,[e("h2",null,u(v.value?"Edit Device":"Add New Device"),1),e("button",{onClick:d[0]||(d[0]=U=>I.$emit("cancel")),class:"close-btn"},[...d[12]||(d[12]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("form",{id:"device-form",onSubmit:pe(we,["prevent"]),class:"modal-body"},[e("div",{class:Y(["form-group",{"has-error":A.value.name}])},[d[14]||(d[14]=e("label",{for:"device-name"},"Device Name *",-1)),e("div",Ho,[J(e("input",{id:"device-name",ref_key:"nameInput",ref:f,"onUpdate:modelValue":d[1]||(d[1]=U=>t.value.name=U),type:"text",placeholder:"e.g., Living Room TV",onInput:d[2]||(d[2]=U=>Ie("name"))},null,544),[[De,t.value.name]]),A.value.name?(n(),a("div",zo,[d[13]||(d[13]=e("i",{class:"mdi mdi-alert"},null,-1)),S(" "+u(A.value.name),1)])):T("",!0)]),d[15]||(d[15]=e("small",null,"Friendly name for this device",-1))],2),e("div",{class:Y(["form-group",{"has-error":A.value.entity_type}])},[d[23]||(d[23]=e("label",{for:"entity-type"},"Entity Type *",-1)),e("div",Jo,[J(e("select",{id:"entity-type",ref_key:"typeSelect",ref:p,"onUpdate:modelValue":d[3]||(d[3]=U=>t.value.entity_type=U),onChange:d[4]||(d[4]=U=>Ie("entity_type"))},[d[16]||(d[16]=Ae('<option value="" data-v-94bc1fe5>-- Select Type --</option><option value="light" data-v-94bc1fe5>💡 Light</option><option value="fan" data-v-94bc1fe5>🌀 Fan</option><option value="switch" data-v-94bc1fe5>🔌 Switch</option><option value="media_player" data-v-94bc1fe5>📺 Media Player</option><option value="cover" data-v-94bc1fe5>🪟 Cover (Blinds/Curtains)</option>',6)),e("option",{value:"climate",disabled:!m.value}," 🌡️ Climate "+u(m.value?"":"(Requires SmartIR)"),9,Wo)],544),[[ke,t.value.entity_type]]),A.value.entity_type?(n(),a("div",Ko,[d[17]||(d[17]=e("i",{class:"mdi mdi-alert"},null,-1)),S(" "+u(A.value.entity_type),1)])):T("",!0)]),t.value.entity_type==="climate"?(n(),a("div",Xo,[m.value?(n(),a("div",Go,[...d[18]||(d[18]=[e("i",{class:"mdi mdi-check-circle"},null,-1),e("span",null,"SmartIR detected! Climate entities will be created via SmartIR profiles.",-1)])])):(n(),a("div",Yo,[...d[19]||(d[19]=[e("i",{class:"mdi mdi-alert"},null,-1),e("div",null,[e("strong",null,"SmartIR Required"),e("p",null,"Climate entities (AC, heaters) require SmartIR integration."),e("a",{href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"smartir-link"}," Install SmartIR → ")],-1)])]))])):m.value&&["media_player","fan","light"].includes(t.value.entity_type)?(n(),a("div",Zo,[...d[20]||(d[20]=[e("div",{class:"notice-info"},[e("i",{class:"mdi mdi-information"}),e("span",null,"💡 SmartIR available! You can use pre-configured codes or learn your own.")],-1)])])):!m.value&&t.value.entity_type?(n(),a("small",Qo,[d[21]||(d[21]=S(" 💡 Tip: Install ",-1)),d[22]||(d[22]=e("a",{href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"inline-link"},"SmartIR",-1)),S(" for pre-configured "+u(t.value.entity_type==="climate"?"climate":t.value.entity_type)+" device codes ",1)])):T("",!0)],2),e("div",el,[d[26]||(d[26]=e("label",{for:"device-type"},"Device Type *",-1)),J(e("select",{id:"device-type","onUpdate:modelValue":d[5]||(d[5]=U=>t.value.device_type=U),required:"",disabled:v.value},[d[24]||(d[24]=e("option",{value:""},"-- Select Device Type --",-1)),d[25]||(d[25]=e("option",{value:"broadlink"},"📡 Broadlink Device (Learn IR Codes)",-1)),_e(s)?(n(),a("option",{key:0,value:"smartir",disabled:!m.value||!_.value}," 🌐 SmartIR Device "+u(D.value),9,ol)):T("",!0)],8,tl),[[ke,t.value.device_type]]),v.value?(n(),a("small",ll,"Cannot change device type after creation")):t.value.device_type==="smartir"?(n(),a("small",nl,"Using pre-configured codes from SmartIR repository")):t.value.device_type==="broadlink"?(n(),a("small",sl,"Learn and store your own IR codes")):(n(),a("small",al,"Choose how to configure this device"))]),v.value?(n(),a("div",il,[d[29]||(d[29]=e("label",{for:"device-area"},"Area",-1)),e("div",rl,[e("input",{id:"device-area",value:t.value.area||"Not assigned",type:"text",readonly:"",class:"readonly-input"},null,8,dl),e("button",{type:"button",onClick:Z,disabled:B.value,class:"sync-area-btn",title:"Sync area from Home Assistant"},[e("i",{class:Y(B.value?"mdi mdi-loading mdi-spin":"mdi mdi-refresh")},null,2)],8,ul)]),e("small",null,[d[27]||(d[27]=e("i",{class:"mdi mdi-information-outline"},null,-1)),d[28]||(d[28]=S(" Set area in Home Assistant, then click sync. ",-1)),e("a",{href:ce(),target:"_blank",class:"inline-link"},"Open in HA →",8,cl)])])):(n(),a("div",ml,[...d[30]||(d[30]=[e("div",{class:"info-notice"},[e("i",{class:"mdi mdi-information-outline"}),e("span",null,[e("strong",null,"Area Assignment:"),S(" After generating entities and restarting Home Assistant, you can assign areas in HA and sync them here.")])],-1)])])),e("div",vl,[d[31]||(d[31]=e("label",{for:"device-icon"},"Icon",-1)),fe(no,{modelValue:t.value.icon,"onUpdate:modelValue":d[6]||(d[6]=U=>t.value.icon=U),inputId:"device-icon",placeholder:"e.g., mdi:television"},null,8,["modelValue"]),d[32]||(d[32]=e("small",null,"Optional: Material Design Icon name",-1))]),t.value.device_type==="broadlink"?(n(),a("div",{key:2,class:Y(["form-group",{"has-error":A.value.broadlink_entity}])},[d[35]||(d[35]=e("label",{for:"broadlink-entity"},"Remote Device *",-1)),e("div",pl,[!v.value||!V.value?J((n(),a("select",{key:0,id:"broadlink-entity",ref_key:"broadlinkSelect",ref:M,"onUpdate:modelValue":d[7]||(d[7]=U=>t.value.broadlink_entity=U),onChange:d[8]||(d[8]=U=>Ie("broadlink_entity"))},[d[33]||(d[33]=e("option",{value:""},"-- Select Remote Device --",-1)),(n(!0),a(me,null,be(i.value,U=>(n(),a("option",{key:U.entity_id,value:U.entity_id},[S(u(U.name||U.entity_id)+" ",1),U.area_name?(n(),a(me,{key:0},[S(" - "+u(U.area_name),1)],64)):T("",!0)],8,fl))),128))],544)),[[ke,t.value.broadlink_entity]]):(n(),a("input",{key:1,id:"broadlink-entity",value:b.value,type:"text",readonly:"",disabled:""},null,8,gl)),A.value.broadlink_entity?(n(),a("div",yl,[d[34]||(d[34]=e("i",{class:"mdi mdi-alert"},null,-1)),S(" "+u(A.value.broadlink_entity),1)])):T("",!0)]),!v.value||!V.value?(n(),a("small",bl,"Required: Select which remote device to use for sending commands")):(n(),a("small",hl,"Cannot change remote device after commands are learned"))],2)):T("",!0),t.value.device_type==="smartir"?(n(),a("div",kl,[d[36]||(d[36]=e("div",{class:"section-header"},[e("i",{class:"mdi mdi-cloud-download"}),e("span",null,"SmartIR Device Configuration")],-1)),fe(No,{ref_key:"smartirSelector",ref:E,"entity-type":t.value.entity_type,modelValue:q.value,"onUpdate:modelValue":d[9]||(d[9]=U=>q.value=U),"broadlink-devices":i.value,onChange:$e},null,8,["entity-type","modelValue","broadlink-devices"])])):T("",!0)],32),e("div",wl,[e("button",{type:"button",onClick:d[10]||(d[10]=U=>I.$emit("cancel")),class:"btn btn-secondary"}," Cancel "),e("button",$l,[d[37]||(d[37]=e("i",{class:"mdi mdi-check"},null,-1)),S(" "+u(v.value?"Update":"Create"),1)])])])]))}},_l=he(Cl,[["__scopeId","data-v-94bc1fe5"]]),Sl={class:"modal-header"},Dl={class:"modal-body"},Il={class:"message-text"},xl={key:0,class:"checkbox-option"},Tl={class:"modal-footer"},Ml=["disabled"],Rl={__name:"ConfirmDialog",props:{isOpen:{type:Boolean,default:!1},title:{type:String,default:"Confirm"},message:{type:String,required:!0},confirmText:{type:String,default:"OK"},cancelText:{type:String,default:"Cancel"},showCancel:{type:Boolean,default:!0},dangerMode:{type:Boolean,default:!1},confirmDisabled:{type:Boolean,default:!1},checkboxLabel:{type:String,default:""}},emits:["confirm","cancel"],setup(o,{emit:c}){const r=o,k=c,w=y(!1);ue(()=>r.isOpen,v=>{v&&(w.value=!1)});const s=()=>{k("confirm",w.value)},m=()=>{k("cancel")};return(v,_)=>o.isOpen?(n(),a("div",{key:0,class:"modal-overlay",onClick:pe(m,["self","stop"])},[e("div",{class:"modal-dialog confirm-dialog",onClick:_[1]||(_[1]=pe(()=>{},["stop"]))},[e("div",Sl,[e("h2",null,u(o.title),1)]),e("div",Dl,[e("p",Il,u(o.message),1),o.checkboxLabel?(n(),a("div",xl,[e("label",null,[J(e("input",{type:"checkbox","onUpdate:modelValue":_[0]||(_[0]=D=>w.value=D)},null,512),[[ve,w.value]]),e("span",null,u(o.checkboxLabel),1)])])):T("",!0)]),e("div",Tl,[o.showCancel?(n(),a("button",{key:0,onClick:pe(m,["stop"]),class:"btn btn-secondary"},u(o.cancelText),1)):T("",!0),o.confirmText?(n(),a("button",{key:1,onClick:pe(s,["stop"]),class:Y(["btn",o.dangerMode?"btn-danger":"btn-primary"]),disabled:o.confirmDisabled},u(o.confirmText),11,Ml)):T("",!0)])])])):T("",!0)}},Re=he(Rl,[["__scopeId","data-v-80a9de08"]]),Ll={class:"modal-content"},Al={class:"modal-header"},Ol={class:"modal-body"},Vl={key:0,class:"smartir-info"},El={key:0,class:"climate-note"},Ul={class:"form-group"},Pl=["value"],jl={class:"form-group"},Fl=["disabled"],Nl={label:"Suggested Commands"},Bl=["value"],ql=["disabled"],Hl={class:"form-group"},zl={class:"radio-group"},Jl={class:"radio-label"},Wl=["disabled"],Kl={class:"radio-label"},Xl=["disabled"],Gl={class:"learn-action"},Yl=["disabled"],Zl={key:0,class:"mdi mdi-loading mdi-spin"},Ql={key:1,class:"mdi mdi-remote-tv"},en={key:0,class:"learning-status"},tn={key:0},on={key:1,class:"rf-instructions"},ln={key:1,class:"result-message success"},nn={key:2,class:"section-divider"},sn={key:3,class:"learned-commands"},an={class:"command-list"},rn={class:"command-info"},dn={class:"command-name"},un={class:"learned-status"},cn={class:"command-actions"},mn=["onClick","disabled"],vn=["onClick"],pn={key:4,class:"untracked-commands"},fn={class:"command-list"},gn={class:"command-name"},yn={class:"modal-footer"},bn=["disabled"],hn={__name:"CommandLearner",props:{device:{type:Object,required:!0}},emits:["cancel","learned"],setup(o,{emit:c}){const r=o,k=c,w=y([]),s=y(""),m=y(""),v=y(""),_=y("ir"),D=y(!1),V=y(""),b=y("success"),t=y([]),A=y([]),q=y(!1),E=y(""),R=y(!1),i=y(null),f=y(null),p=y(""),M=y(""),G=z(()=>r.device.device_type==="smartir");z(()=>{if(G.value)return!1;const g=m.value==="__custom__"?v.value:m.value;return s.value&&g.trim()});const ee=()=>{i.value&&i.value.setCustomValidity("")},te=()=>{f.value&&f.value.setCustomValidity("")},se=z(()=>{const g=w.value.find($=>$.entity_id===s.value);return g?g.name||g.entity_id:s.value}),L={light:["turn_on","turn_off","toggle","brightness_up","brightness_down","dim","bright"],fan:["turn_on","turn_off","toggle","speed_low","speed_medium","speed_high","speed_1","speed_2","speed_3","speed_4","speed_5","oscillate_on","oscillate_off","direction_forward","direction_reverse"],switch:["turn_on","turn_off","toggle"],media_player:["turn_on","turn_off","toggle","volume_up","volume_down","volume_mute","play","pause","stop","play_pause","next_track","previous_track","channel_up","channel_down","source_hdmi1","source_hdmi2","source_hdmi3","source_tv","source_aux","source_bluetooth","menu","home","back","select","arrow_up","arrow_down","arrow_left","arrow_right"],cover:["open","close","stop","open_tilt","close_tilt","position_0","position_25","position_50","position_75","position_100"]},B=z(()=>{const g=r.device.entity_type||"switch";return L[g]||L.switch});xe(async()=>{await Z(),await ce(),i.value&&(i.value.setCustomValidity(""),i.value.oninvalid=()=>{i.value.setCustomValidity("Command name is required")}),r.device.broadlink_entity&&(s.value=r.device.broadlink_entity)}),ue(m,async g=>{g==="__custom__"&&(await We(),f.value&&(f.value.setCustomValidity(""),f.value.oninvalid=()=>{f.value.setCustomValidity("Custom command name is required")}))});const Z=async()=>{try{const g=await le.get("/api/broadlink/devices");w.value=g.data.devices||[]}catch(g){console.error("Error loading Broadlink devices:",g)}},ce=async()=>{var g;try{if(G.value){const $=await le.get("/api/smartir/codes/code",{params:{entity_type:r.device.entity_type,code_id:r.device.device_code}});if($.data.success&&$.data.code){const N=$.data.code.commands||{},oe=$.data.code.commandType||"ir";if(r.device.entity_type==="climate"){const ae=[];for(const[W,x]of Object.entries(N))typeof x=="string"?ae.push({name:W,type:oe}):typeof x=="object"&&x!==null&&Object.keys(x).sort((X,de)=>parseInt(X)-parseInt(de)).forEach(X=>{ae.push({name:`${W}_${X}`,type:oe,label:`${W.charAt(0).toUpperCase()+W.slice(1)} ${X}°C`})});t.value=ae}else t.value=Object.keys(N).map(ae=>({name:ae,type:oe}))}}else{if(console.log("📋 Loading commands for device:",r.device),console.log("📋 Device commands:",r.device.commands),console.log("📋 Device ID:",r.device.id),r.device.commands&&Object.keys(r.device.commands).length>0)console.log("✅ Using commands from device object"),t.value=Object.entries(r.device.commands).map(([$,N])=>({name:$,type:N.command_type||N.type||"ir"}));else if(r.device.commands!==void 0)console.log("ℹ️ Device has empty commands object - skipping API call"),t.value=[];else if(r.device.id){console.log("🌐 Fetching commands from API for device ID:",r.device.id);try{const N=(await le.get(`/api/commands/${r.device.id}`)).data.commands||{};t.value=Object.entries(N).map(([oe,ae])=>({name:oe,type:ae.command_type||ae.type||"ir"}))}catch($){if(((g=$.response)==null?void 0:g.status)===404)console.log("ℹ️ No commands found for device (this is normal for new devices)"),t.value=[];else throw $}}else console.log("⚠️ No commands found and no device ID");console.log("📋 Final learned commands:",t.value)}}catch($){console.error("Error loading commands:",$)}},ye=async()=>{var g,$;V.value="",b.value="",D.value=!0;try{let N=r.device.id.split(".")[1];r.device.device&&(N=r.device.device);const oe=m.value==="__custom__"?v.value:m.value,ae=await le.post("/api/commands/learn",{entity_id:s.value,device:N,device_id:r.device.id,command:oe.trim(),command_type:_.value});if(ae.data.success){V.value=`Command "${oe}" learned successfully!`,b.value="success",t.value.find(X=>X.name===oe)||t.value.push({name:oe,type:_.value});const x=A.value.indexOf(oe);x>-1&&A.value.splice(x,1);const re={...r.device.commands};re[oe]={command_type:_.value,type:_.value},await d(),m.value="",v.value="",k("learned",{commands:re,commandName:oe})}else V.value=ae.data.error||"Failed to learn command",b.value="error"}catch(N){V.value=(($=(g=N.response)==null?void 0:g.data)==null?void 0:$.error)||"Error learning command",b.value="error"}finally{D.value=!1}},Ie=async g=>{var $,N;try{M.value=g,p.value="";let oe=r.device.id.split(".")[1];r.device.device&&(oe=r.device.device);const ae=G.value?r.device.controller_device:s.value||r.device.broadlink_entity;if(!ae){console.error("Missing entity_id for test command:",{isSmartIR:G.value,controller_device:r.device.controller_device,broadlink_entity:r.device.broadlink_entity,selectedBroadlink:s.value,device:r.device}),V.value="Missing Broadlink remote entity. Please select a Broadlink device.",b.value="error",M.value="";return}const W={entity_id:ae,device:oe,command:g,device_id:r.device.id};console.log("🧪 Testing command:",W),(await le.post("/api/commands/test",W)).data.success&&(p.value=g,setTimeout(()=>{p.value===g&&(p.value="")},2e3))}catch(oe){console.error("❌ Test command error:",oe);const ae=((N=($=oe.response)==null?void 0:$.data)==null?void 0:N.error)||oe.message||"Unknown error";V.value=`Failed to send command: ${ae}`,b.value="error"}finally{M.value=""}},we=g=>{E.value=g,q.value=!0},$e=()=>{q.value=!1,E.value=""},I=async()=>{const g=E.value;q.value=!1;try{console.log(`🗑️ Deleting command: ${g}`),await le.delete(`/api/commands/${r.device.id}/${g}`),t.value=t.value.filter($=>$.name!==g),await ce(),await d(),V.value=`Command "${g}" deleted`,b.value="success",k("learned")}catch($){console.error("❌ Delete error:",$),V.value=`Failed to delete command: ${$.message}`,b.value="error"}finally{E.value=""}},d=async()=>{try{let g=r.device.device;g||(g=r.device.id.includes(".")?r.device.id.split(".")[1]:r.device.id),console.log("🔍 Looking for untracked commands for device:",g);const N=(await le.get("/api/commands/untracked")).data.untracked||{};console.log("📦 All untracked commands:",Object.keys(N)),console.log("📦 Untracked for this device:",N[g]),N[g]?A.value=Object.keys(N[g].commands):A.value=[]}catch(g){console.error("Error loading untracked commands:",g),A.value=[]}},U=()=>{A.value.length!==0&&(R.value=!0)},H=async()=>{R.value=!1;try{const g=r.device.device||r.device.id.split(".")[1],$=await le.post("/api/commands/import",{device_id:r.device.id,source_device:g,commands:A.value});$.data.success&&(V.value=`Imported ${$.data.imported_count} commands successfully!`,b.value="success",await ce(),await d(),k("learned"))}catch(g){V.value=`Failed to import commands: ${g.message}`,b.value="error"}};return(g,$)=>(n(),a("div",{class:"modal-overlay",onClick:$[7]||($[7]=pe(N=>g.$emit("cancel"),["self"]))},[e("div",Ll,[e("div",Al,[e("h2",null,u(G.value?"Commands for":"Learn Commands for")+" "+u(o.device.name),1),e("button",{onClick:$[0]||($[0]=N=>g.$emit("cancel")),class:"close-btn"},[...$[8]||($[8]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Ol,[G.value?(n(),a("div",Vl,[$[13]||($[13]=e("i",{class:"mdi mdi-information"},null,-1)),e("div",null,[$[12]||($[12]=e("h3",null,"SmartIR Device",-1)),e("p",null,[$[9]||($[9]=S("This device uses SmartIR code file ",-1)),e("strong",null,u(o.device.device_code),1),$[10]||($[10]=S(". Commands are pre-configured and cannot be learned.",-1))]),o.device.entity_type==="climate"?(n(),a("p",El,[...$[11]||($[11]=[e("i",{class:"mdi mdi-alert-circle-outline"},null,-1),e("strong",null,"Note:",-1),S(" Climate device commands are temperature-based. Testing individual modes may not work as expected. Use the Home Assistant climate card to control your device. ",-1)])])):T("",!0)])])):(n(),a("form",{key:1,onSubmit:pe(ye,["prevent"])},[e("div",Ul,[$[14]||($[14]=e("label",{for:"broadlink-entity"},"Broadlink Device",-1)),e("input",{id:"broadlink-entity",value:se.value,type:"text",readonly:"",disabled:""},null,8,Pl),$[15]||($[15]=e("small",null,"Commands will be learned using this device (set when device was created)",-1))]),e("div",jl,[$[18]||($[18]=e("label",{for:"command-name"},"Command Name *",-1)),J(e("select",{id:"command-name",ref_key:"commandSelect",ref:i,"onUpdate:modelValue":$[1]||($[1]=N=>m.value=N),disabled:D.value,required:"",onChange:ee},[$[16]||($[16]=e("option",{value:""},"-- Select or type command --",-1)),e("optgroup",Nl,[(n(!0),a(me,null,be(B.value,N=>(n(),a("option",{key:N,value:N},u(N),9,Bl))),128))]),$[17]||($[17]=e("option",{value:"__custom__"},"Custom command...",-1))],40,Fl),[[ke,m.value]]),m.value==="__custom__"?J((n(),a("input",{key:0,ref_key:"customCommandInput",ref:f,"onUpdate:modelValue":$[2]||($[2]=N=>v.value=N),type:"text",placeholder:"Enter custom command name",disabled:D.value,required:"",class:"custom-command-input",onInput:te},null,40,ql)),[[De,v.value]]):T("",!0),e("small",null,"Select a suggested command for "+u(o.device.entity_type||"this device")+", or enter a custom one.",1)]),e("div",Hl,[$[21]||($[21]=e("label",null,"Command Type",-1)),e("div",zl,[e("label",Jl,[J(e("input",{type:"radio","onUpdate:modelValue":$[3]||($[3]=N=>_.value=N),value:"ir",disabled:D.value},null,8,Wl),[[Pe,_.value]]),$[19]||($[19]=e("span",null,"IR (Infrared)",-1))]),e("label",Kl,[J(e("input",{type:"radio","onUpdate:modelValue":$[4]||($[4]=N=>_.value=N),value:"rf",disabled:D.value},null,8,Xl),[[Pe,_.value]]),$[20]||($[20]=e("span",null,"RF (Radio Frequency)",-1))])])]),e("div",Gl,[e("button",{type:"submit",class:"btn btn-primary btn-large",disabled:D.value},[D.value?(n(),a("i",Zl)):(n(),a("i",Ql)),S(" "+u(D.value?"Learning...":"Learn Command"),1)],8,Yl)]),D.value?(n(),a("div",en,[$[24]||($[24]=e("i",{class:"mdi mdi-loading mdi-spin"},null,-1)),_.value==="ir"?(n(),a("div",tn,[...$[22]||($[22]=[e("p",null,"Point your remote at the Broadlink device and press the button...",-1),e("small",null,"This may take up to 30 seconds",-1)])])):_.value==="rf"?(n(),a("div",on,[...$[23]||($[23]=[e("p",null,[e("strong",null,"Learning request sent to device.")],-1),e("p",null,"RF learning is a two-step process:",-1),e("ol",null,[e("li",null,[e("strong",null,"Step 1 - Frequency Sweep (~10-15 seconds):"),S(" Press and hold the button on your remote until the notification updates.")]),e("li",null,[e("strong",null,"Step 2 - Learn Signal:"),S(" Press and release the button once.")])],-1),e("p",{class:"ha-note"},[S(" Follow the Home Assistant notifications ("),e("i",{class:"mdi mdi-bell"}),S(") for real-time instructions. ")],-1)])])):T("",!0)])):T("",!0),V.value&&b.value==="success"&&!V.value.includes("sent successfully")?(n(),a("div",ln,[$[25]||($[25]=e("i",{class:"mdi mdi-check-circle"},null,-1)),e("p",null,u(V.value),1)])):T("",!0)],32)),t.value.length>0||A.value.length>0?(n(),a("div",nn)):T("",!0),t.value.length>0?(n(),a("div",sn,[e("h3",null,"Tracked Commands ("+u(t.value.length)+")",1),e("div",an,[(n(!0),a(me,null,be(t.value,N=>(n(),a("div",{key:N.name,class:"command-item"},[e("div",rn,[e("span",dn,u(N.label||N.name),1)]),e("div",un,[$[26]||($[26]=e("i",{class:"mdi mdi-check-circle"},null,-1)),$[27]||($[27]=e("span",null,"Learned",-1)),e("span",{class:Y(["command-type-badge",N.type||"ir"])},u((N.type||"ir").toUpperCase()),3)]),e("div",cn,[e("button",{type:"button",onClick:oe=>Ie(N.name),class:"icon-btn",title:"Test command",disabled:M.value===N.name},[e("i",{class:Y(["mdi mdi-play",{"mdi-spin":M.value===N.name}])},null,2)],8,mn),e("button",{type:"button",onClick:oe=>we(N.name),class:"icon-btn danger",title:"Delete and re-learn"},[...$[28]||($[28]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,vn)])]))),128))])])):T("",!0),A.value.length>0?(n(),a("div",pn,[e("h3",null,[$[29]||($[29]=e("i",{class:"mdi mdi-alert"},null,-1)),S(" Untracked Commands ("+u(A.value.length)+") ",1)]),$[32]||($[32]=e("p",{class:"untracked-info"}," These commands exist in Broadlink storage but are not tracked in this device. ",-1)),e("div",fn,[(n(!0),a(me,null,be(A.value,N=>(n(),a("div",{key:N,class:"command-item untracked"},[e("span",gn,u(N),1),$[30]||($[30]=e("span",{class:"untracked-badge"},"Not tracked",-1))]))),128))]),e("button",{type:"button",onClick:U,class:"btn btn-secondary"},[...$[31]||($[31]=[e("i",{class:"mdi mdi-import"},null,-1),S(" Import All Untracked Commands ",-1)])])])):T("",!0)]),e("div",yn,[e("button",{type:"button",onClick:$[5]||($[5]=N=>g.$emit("cancel")),class:"btn btn-secondary",disabled:D.value}," Close ",8,bn)])]),fe(Re,{isOpen:q.value,title:"Delete Command?",message:`Delete command '${E.value}'? This will remove it from Broadlink storage.`,confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,onConfirm:I,onCancel:$e},null,8,["isOpen","message"]),fe(Re,{isOpen:R.value,title:"Import Commands?",message:`Import ${A.value.length} untracked command${A.value.length>1?"s":""} into this device?`,confirmText:"Import",cancelText:"Cancel",onConfirm:H,onCancel:$[6]||($[6]=N=>R.value=!1)},null,8,["isOpen","message"])]))}},kn=he(hn,[["__scopeId","data-v-c0fecf1f"]]),wn={class:"modal-container error-dialog"},$n={class:"modal-header"},Cn={class:"modal-body"},_n={class:"error-message"},Sn={key:0,class:"error-suggestion"},Dn=["open"],In={class:"debug-content"},xn={class:"debug-info"},Tn={key:0,class:"debug-section-title"},Mn={key:1},Rn={__name:"ErrorDialog",props:{isOpen:{type:Boolean,default:!1},title:{type:String,default:"Error"},message:{type:String,required:!0},suggestion:{type:String,default:""},details:{type:String,default:""},error:{type:Object,default:null},context:{type:Object,default:()=>({})}},emits:["close"],setup(o,{emit:c}){const r=o,k=c,w=Se("toast"),s=y(!1),m=()=>{k("close")},v=z(()=>{var A,q,E,R,i,f,p,M,G,ee,te;const b=new Date().toISOString(),t=r.error||{};return{error:JSON.stringify({message:r.message,title:r.title,details:r.details,errorObject:t.message||t.toString(),timestamp:b},null,2),request:JSON.stringify({method:((q=(A=t.config)==null?void 0:A.method)==null?void 0:q.toUpperCase())||"N/A",url:((E=t.config)==null?void 0:E.url)||"N/A",baseURL:((R=t.config)==null?void 0:R.baseURL)||"N/A",headers:((i=t.config)==null?void 0:i.headers)||{},data:(f=t.config)!=null&&f.data?JSON.parse(t.config.data):"N/A",params:((p=t.config)==null?void 0:p.params)||{}},null,2),response:JSON.stringify({status:((M=t.response)==null?void 0:M.status)||"N/A",statusText:((G=t.response)==null?void 0:G.statusText)||"N/A",data:((ee=t.response)==null?void 0:ee.data)||"N/A",headers:((te=t.response)==null?void 0:te.headers)||{}},null,2),browser:JSON.stringify({userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language,cookieEnabled:navigator.cookieEnabled,onLine:navigator.onLine,viewport:`${window.innerWidth}x${window.innerHeight}`,screenResolution:`${window.screen.width}x${window.screen.height}`,colorDepth:window.screen.colorDepth,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,timestamp:b},null,2),appState:JSON.stringify({currentRoute:window.location.pathname,currentURL:window.location.href,referrer:document.referrer||"N/A",context:r.context||{},localStorage:{smartir_simulate:localStorage.getItem("smartir_simulate_not_installed"),theme:localStorage.getItem("theme")}},null,2),stackTrace:t.stack||null}}),_=async()=>{const b=V();try{await navigator.clipboard.writeText(b),w==null||w.success("Debug information copied to clipboard","✅ Copied")}catch(t){console.error("Failed to copy:",t),w==null||w.error("Failed to copy to clipboard","❌ Copy Failed")}},D=()=>{const b=V(),t=new Blob([b],{type:"text/plain"}),A=URL.createObjectURL(t),q=document.createElement("a");q.href=A;const E=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5);q.download=`broadlink-manager-error-${E}.txt`,document.body.appendChild(q),q.click(),document.body.removeChild(q),URL.revokeObjectURL(A),w==null||w.success("Debug report downloaded","✅ Downloaded")},V=()=>`Broadlink Manager - Error Report
${"=".repeat(60)}

Generated: ${new Date().toISOString()}
Title: ${r.title}
Message: ${r.message}
${r.suggestion?`Suggestion: ${r.suggestion}
`:""}
${"=".repeat(60)}

ERROR DETAILS
${"-".repeat(60)}
${v.value.error}

REQUEST INFORMATION
${"-".repeat(60)}
${v.value.request}

RESPONSE INFORMATION
${"-".repeat(60)}
${v.value.response}

BROWSER INFORMATION
${"-".repeat(60)}
${v.value.browser}

APPLICATION STATE
${"-".repeat(60)}
${v.value.appState}

${v.value.stackTrace?`STACK TRACE
${"-".repeat(60)}
${v.value.stackTrace}

`:""}
${"=".repeat(60)}
End of Report
`;return ue(()=>r.isOpen,b=>{if(b){const t=A=>{A.key==="Escape"&&m()};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)}}),(b,t)=>(n(),Te(Ke,{to:"body"},[fe(Je,{name:"modal"},{default:Fe(()=>[o.isOpen?(n(),a("div",{key:0,class:"modal-overlay",onClick:pe(m,["self"])},[e("div",wn,[e("div",$n,[t[2]||(t[2]=e("div",{class:"header-icon error-icon"},[e("i",{class:"mdi mdi-alert-circle"})],-1)),e("h3",null,u(o.title),1),e("button",{onClick:m,class:"close-button"},[...t[1]||(t[1]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Cn,[e("p",_n,u(o.message),1),o.suggestion?(n(),a("p",Sn,[t[3]||(t[3]=e("i",{class:"mdi mdi-lightbulb-on"},null,-1)),S(" "+u(o.suggestion),1)])):T("",!0),e("details",{class:"debug-section",open:s.value},[e("summary",{onClick:t[0]||(t[0]=A=>s.value=!s.value)},[e("i",{class:Y(["mdi",s.value?"mdi-chevron-down":"mdi-chevron-right"])},null,2),t[4]||(t[4]=S(" Debug Information ",-1))]),e("div",In,[e("div",{class:"debug-actions"},[e("button",{onClick:_,class:"btn-debug btn-copy"},[...t[5]||(t[5]=[e("i",{class:"mdi mdi-content-copy"},null,-1),S(" Copy to Clipboard ",-1)])]),e("button",{onClick:D,class:"btn-debug btn-download"},[...t[6]||(t[6]=[e("i",{class:"mdi mdi-download"},null,-1),S(" Download Report ",-1)])])]),e("div",xn,[t[7]||(t[7]=e("div",{class:"debug-section-title"},"Error Details",-1)),e("pre",null,u(v.value.error),1),t[8]||(t[8]=e("div",{class:"debug-section-title"},"Request Information",-1)),e("pre",null,u(v.value.request),1),t[9]||(t[9]=e("div",{class:"debug-section-title"},"Response Information",-1)),e("pre",null,u(v.value.response),1),t[10]||(t[10]=e("div",{class:"debug-section-title"},"Browser Information",-1)),e("pre",null,u(v.value.browser),1),t[11]||(t[11]=e("div",{class:"debug-section-title"},"Application State",-1)),e("pre",null,u(v.value.appState),1),v.value.stackTrace?(n(),a("div",Tn,"Stack Trace")):T("",!0),v.value.stackTrace?(n(),a("pre",Mn,u(v.value.stackTrace),1)):T("",!0)])])],8,Dn)]),e("div",{class:"modal-footer"},[e("button",{onClick:m,class:"btn btn-primary"}," OK ")])])])):T("",!0)]),_:1})]))}},Ln=he(Rn,[["__scopeId","data-v-23858149"]]),An={key:0,class:"discovery-banner"},On={class:"banner-content"},Vn={class:"banner-text"},En={class:"modal-dialog"},Un={class:"modal-header"},Pn={class:"modal-body"},jn={class:"device-list"},Fn={class:"device-info"},Nn={class:"device-details"},Bn={class:"command-count"},qn={class:"device-actions"},Hn=["onClick"],zn=["onClick"],Jn={class:"modal-footer"},Wn={class:"modal-dialog modal-dialog-small"},Kn={class:"modal-header"},Xn={class:"modal-body"},Gn={class:"warning-message"},Yn={class:"modal-footer"},Zn=["disabled"],Qn=["disabled"],es={__name:"DeviceDiscovery",emits:["adopt"],setup(o,{expose:c,emit:r}){const k=Ve(),w=r,s=y([]),m=y(!1),v=y(!1),_=y(null),D=y(!1),V=z(()=>s.value.length>0);xe(async()=>{await b()});const b=async()=>{try{const E=await le.get("/api/devices/discover");s.value=E.data.untracked_devices||[]}catch(E){console.error("Error loading untracked devices:",E),s.value=[]}},t=E=>{m.value=!1,w("adopt",E)},A=E=>{_.value=E,v.value=!0},q=async()=>{if(_.value){D.value=!0;try{const E=await le.delete(`/api/devices/untracked/${encodeURIComponent(_.value.device_name)}`);if(E.data.success)s.value=s.value.filter(R=>R.device_name!==_.value.device_name),v.value=!1,_.value=null,console.log("Device deleted successfully");else throw new Error(E.data.error||"Failed to delete device")}catch(E){console.error("Error deleting device:",E),k.error(`Failed to delete device: ${E.message}`)}finally{D.value=!1}}};return c({refresh:b}),(E,R)=>{var i,f,p;return V.value?(n(),a("div",An,[e("div",On,[R[9]||(R[9]=e("div",{class:"banner-icon"},[e("i",{class:"mdi mdi-radar"})],-1)),e("div",Vn,[R[7]||(R[7]=e("h3",null,"Untracked Devices Found",-1)),e("p",null,u(s.value.length)+" device"+u(s.value.length>1?"s":"")+" with learned commands found in Broadlink storage",1)]),e("button",{onClick:R[0]||(R[0]=M=>m.value=!0),class:"btn btn-primary"},[...R[8]||(R[8]=[e("i",{class:"mdi mdi-eye"},null,-1),S(" View Devices ",-1)])])]),m.value?(n(),a("div",{key:0,class:"modal-overlay",onClick:R[3]||(R[3]=pe(M=>m.value=!1,["self"]))},[e("div",En,[e("div",Un,[R[11]||(R[11]=e("h2",null,"Discovered Devices",-1)),e("button",{onClick:R[1]||(R[1]=M=>m.value=!1),class:"close-btn"},[...R[10]||(R[10]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Pn,[R[16]||(R[16]=e("p",{class:"info-text"}," These devices have learned commands in Broadlink storage but are not being tracked. Adopt them to manage their commands and generate Home Assistant entities. ",-1)),e("div",jn,[(n(!0),a(me,null,be(s.value,M=>(n(),a("div",{key:M.device_name,class:"discovered-device"},[e("div",Fn,[R[13]||(R[13]=e("div",{class:"device-icon"},[e("i",{class:"mdi mdi-devices"})],-1)),e("div",Nn,[e("h4",null,u(M.device_name),1),e("span",Bn,[R[12]||(R[12]=e("i",{class:"mdi mdi-remote"},null,-1)),S(" "+u(M.command_count)+" command"+u(M.command_count>1?"s":""),1)])])]),e("div",qn,[e("button",{onClick:G=>t(M),class:"btn btn-primary"},[...R[14]||(R[14]=[e("i",{class:"mdi mdi-plus"},null,-1),S(" Adopt ",-1)])],8,Hn),e("button",{onClick:G=>A(M),class:"btn btn-danger",title:"Delete all commands"},[...R[15]||(R[15]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,zn)])]))),128))])]),e("div",Jn,[e("button",{onClick:R[2]||(R[2]=M=>m.value=!1),class:"btn btn-secondary"}," Close ")])])])):T("",!0),v.value?(n(),a("div",{key:1,class:"modal-overlay",onClick:R[6]||(R[6]=pe(M=>v.value=!1,["self"]))},[e("div",Wn,[e("div",Kn,[R[18]||(R[18]=e("h2",null,"Delete Untracked Device",-1)),e("button",{onClick:R[4]||(R[4]=M=>v.value=!1),class:"close-btn"},[...R[17]||(R[17]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Xn,[e("div",Gn,[R[20]||(R[20]=e("i",{class:"mdi mdi-alert"},null,-1)),e("div",null,[e("p",null,[e("strong",null,'Are you sure you want to delete "'+u((i=_.value)==null?void 0:i.device_name)+'"?',1)]),e("p",null,"This will permanently delete all "+u((f=_.value)==null?void 0:f.command_count)+" command"+u(((p=_.value)==null?void 0:p.command_count)>1?"s":"")+" from Broadlink storage.",1),R[19]||(R[19]=e("p",{class:"warning-text"},"This action cannot be undone.",-1))])])]),e("div",Yn,[e("button",{onClick:R[5]||(R[5]=M=>v.value=!1),class:"btn btn-secondary",disabled:D.value}," Cancel ",8,Zn),e("button",{onClick:q,class:"btn btn-danger",disabled:D.value},[e("i",{class:Y(["mdi",D.value?"mdi-loading mdi-spin":"mdi-delete"])},null,2),S(" "+u(D.value?"Deleting...":"Delete"),1)],8,Qn)])])])):T("",!0)])):T("",!0)}}},ts=he(es,[["__scopeId","data-v-24463050"]]),os={class:"device-list-card"},ls={class:"card-header"},ns={class:"header-badges"},ss={class:"header-info"},as={class:"header-right"},is=["disabled"],rs=["disabled"],ds={class:"card-body"},us={key:0,class:"filter-bar"},cs={class:"filter-row filter-row-search"},ms={class:"filter-group filter-search"},vs={class:"filter-row filter-row-dropdowns"},ps={class:"filter-group"},fs=["value"],gs={class:"filter-group"},ys=["value"],bs={class:"filter-group"},hs={key:0,class:"filter-group filter-toggle"},ks={class:"toggle-label"},ws={class:"view-toggle-group"},$s={class:"filter-results"},Cs={key:1,class:"loading-state"},_s={key:2,class:"error-state"},Ss={key:3,class:"empty-state"},Ds={key:4,class:"device-grid"},Is={key:6,class:"no-results"},xs={__name:"DeviceList",setup(o){const c=it(),r=Ve(),k=y(!1),w=y(!1),s=y(null),m=y(!1),v=y(null),_=y(null),D=y(!0),V=y(!1),b=y(!1),t=y(localStorage.getItem("device_view_mode")||"grid"),A=()=>{D.value=!D.value},q=y(!1),E=y({title:"Error",message:"",suggestion:"",details:"",error:null,context:{}}),R=y(!1),i=y({success:!1,title:"",message:""}),f=y({search:"",broadlinkDevice:"",area:"",entityType:"",showSmartIROnly:!1}),p=y([]),M=Se("smartirStatus"),G=Se("smartirEnabled"),ee=z(()=>{var h;return localStorage.getItem("smartir_simulate_not_installed")==="true"?!1:((h=M==null?void 0:M.value)==null?void 0:h.installed)||!1}),te=z(()=>{const C=new Map;return c.devices.forEach(h=>{if(h.broadlink_entity){const j=p.value.find(Q=>Q.entity_id===h.broadlink_entity),O=j&&j.name||h.broadlink_entity;C.set(h.broadlink_entity,{entity_id:h.broadlink_entity,friendly_name:O})}}),Array.from(C.values()).sort((h,j)=>h.friendly_name.localeCompare(j.friendly_name))}),se=z(()=>{const C=new Set;return c.devices.forEach(h=>{h.area&&C.add(h.area)}),Array.from(C).sort()}),L=z(()=>{let C=c.devices;if(f.value.search){const j=f.value.search.toLowerCase();C=C.filter(O=>{var ie,K,ge,Ce,Le;if((ie=O.name)!=null&&ie.toLowerCase().includes(j)||(K=O.entity_type)!=null&&K.toLowerCase().includes(j)||(ge=O.area)!=null&&ge.toLowerCase().includes(j)||(Ce=O.id)!=null&&Ce.toLowerCase().includes(j)||Object.keys(O.commands||{}).some(Me=>Me.toLowerCase().includes(j)))return!0;const ne=p.value.find(Me=>Me.entity_id===O.broadlink_entity);return!!((Le=ne==null?void 0:ne.name)!=null&&Le.toLowerCase().includes(j))})}f.value.broadlinkDevice&&(C=C.filter(j=>j.broadlink_entity===f.value.broadlinkDevice||j.controller_device===f.value.broadlinkDevice)),f.value.area&&(C=C.filter(j=>j.area===f.value.area)),f.value.entityType&&(C=C.filter(j=>j.entity_type===f.value.entityType)),f.value.showSmartIROnly&&(C=C.filter(j=>j.device_type==="smartir"));const h=localStorage.getItem("smartir_simulate_not_installed")==="true";return(!(G!=null&&G.value)||h)&&(C=C.filter(j=>j.device_type!=="smartir")),C}),B=z(()=>f.value.search||f.value.broadlinkDevice||f.value.area||f.value.entityType||f.value.showSmartIROnly),Z=()=>{f.value.search="",f.value.broadlinkDevice="",f.value.area="",f.value.entityType="",f.value.showSmartIROnly=!1},ce=async()=>{try{const C=await le.get("/api/remote/devices");p.value=C.data.devices||[]}catch(C){console.error("Error loading remote devices:",C)}};ue(t,C=>{localStorage.setItem("device_view_mode",C)}),xe(async()=>{await Promise.all([c.loadDevices(),ce()])});const ye=C=>{s.value=C,k.value=!0},Ie=z(()=>{if(!v.value)return"";const C=Object.keys(v.value.commands||{}).length;return C===0?"This device has no commands. The device will be removed from tracking.":`This device has ${C} learned command${C>1?"s":""}. What would you like to do?`}),we=z(()=>{if(!v.value)return"";const C=Object.keys(v.value.commands||{}).length;return C===0?"":`Also delete all ${C} command${C>1?"s":""} from Broadlink storage`}),$e=C=>{v.value=C,m.value=!0},I=()=>{m.value=!1,v.value=null},d=async C=>{var j,O;const h=v.value;m.value=!1;try{await c.deleteDevice(h.id,C),_.value&&await _.value.refresh()}catch(Q){const ne=((O=(j=Q.response)==null?void 0:j.data)==null?void 0:O.error)||Q.message||"Unknown error";N("Failed to Delete Device",ne)}finally{v.value=null}},U=async C=>{var h,j,O,Q,ne;try{console.log("💾 Saving device data:",C),console.log("💾 Device commands:",C.commands),console.log("💾 Selected device:",s.value),(h=s.value)!=null&&h.id&&s.value.id!==null?await c.updateDevice(s.value.id,C):await c.createDevice(C),H(),_.value&&await _.value.refresh()}catch(ie){let K="Failed to save device",ge="",Ce="";(O=(j=ie.response)==null?void 0:j.data)!=null&&O.error?(K=ie.response.data.error,ge=ie.response.data.suggestion||""):ie.message&&(K=ie.message),ie.response&&(Ce=`Status: ${ie.response.status}
URL: ${((Q=ie.config)==null?void 0:Q.url)||"N/A"}`),N("Failed to Save Device",K,ge,Ce,ie,{action:"save_device",deviceData:C,isEdit:!!((ne=s.value)!=null&&ne.id)})}},H=()=>{k.value=!1,s.value=null},g=C=>{s.value=C,w.value=!0},$=()=>{w.value=!1,s.value=null},N=(C,h,j="",O="",Q=null,ne={})=>{E.value={title:C,message:h,suggestion:j,details:O,error:Q,context:ne},q.value=!0},oe=()=>{q.value=!1},ae=()=>{R.value=!1},W=async C=>{if(C&&C.commands&&s.value){const h=c.devices.findIndex(j=>j.id===s.value.id);h!==-1&&(c.devices[h].commands=C.commands,console.log(`Optimistically updated device ${s.value.id} with new command: ${C.commandName}`))}c.loadDevices(),_.value&&_.value.refresh()},x=C=>{const h=C.split("_"),j=[];for(let O=0;O<h.length;O++){const Q=h[O],ne=h[O+1];Q&&ne==="s"&&h[O+2]?(j.push(Q.charAt(0).toUpperCase()+Q.slice(1)+"'s"),O++):Q!=="s"&&j.push(Q.charAt(0).toUpperCase()+Q.slice(1))}return j.join(" ")},re=(C,h)=>{const j=C.toLowerCase(),O=h.map(K=>K.toLowerCase());return j.includes("lamp")||j.includes("light")?"light":j.includes("fan")?"fan":j.includes("tv")||j.includes("stereo")||j.includes("speaker")||j.includes("receiver")?"media_player":j.includes("blind")||j.includes("curtain")||j.includes("shade")||j.includes("garage")?"cover":O.some(K=>K.includes("volume")||K.includes("channel")||K.includes("play")||K.includes("pause")||K.includes("mute"))?"media_player":O.some(K=>K.includes("fan_speed")||K.includes("fan_low")||K.includes("fan_high"))?"fan":O.some(K=>K.includes("open")||K.includes("close")||K.includes("stop"))?"cover":"switch"},X=(C,h)=>{const j=C.toLowerCase();return j.includes("tv")?"mdi:television":j.includes("stereo")||j.includes("receiver")||j.includes("speaker")?"mdi:speaker":j.includes("lamp")?"mdi:lamp":j.includes("light")?"mdi:lightbulb":j.includes("fan")?"mdi:fan":j.includes("blind")?"mdi:blinds":j.includes("curtain")?"mdi:curtains":j.includes("garage")?"mdi:garage":{light:"mdi:lightbulb",fan:"mdi:fan",switch:"mdi:light-switch",media_player:"mdi:speaker",cover:"mdi:window-shutter"}[h]||"mdi:devices"},de=C=>{const h=C.toLowerCase().split("_");for(let Q=0;Q<h.length-2;Q++)if(h[Q+1]==="s"){const ne=h.slice(Q,Q+3),ie=x(ne.join("_"));return console.log("Detected possessive area:",ie,"from",C),ie}const j=[["living","room"],["dining","room"],["master","bedroom"],["guest","bedroom"],["family","room"],["laundry","room"],["home","office"]];for(let Q=0;Q<h.length-1;Q++){const ne=[h[Q],h[Q+1]],ie=j.find(K=>K[0]===ne[0]&&K[1]===ne[1]);if(ie)return x(ie.join("_"))}const O=["kitchen","bedroom","bathroom","garage","office","basement","attic","hallway","entryway","patio","deck","yard","garden"];for(const Q of h)if(O.includes(Q))return Q.charAt(0).toUpperCase()+Q.slice(1);return""},P=async C=>{const h=x(C.device_name),j=de(C.device_name),O=re(C.device_name,C.commands),Q=X(C.device_name,O);let ne="";try{console.log("Finding Broadlink owner for:",C.device_name);const K=await le.post("/api/devices/find-broadlink-owner",{device_name:C.device_name});console.log("Broadlink owner response:",K.data),ne=K.data.broadlink_entity||"",console.log("Detected Broadlink entity:",ne)}catch(K){console.error("Error finding Broadlink owner:",K)}s.value={id:null,device:C.device_name,name:h,entity_type:O,commands:{},area:j,icon:Q,broadlink_entity:ne,enabled:!0};const ie={};C.commands.forEach(K=>{ie[K]=K}),s.value.commands=ie,k.value=!0},l=async()=>{b.value=!0;try{await c.syncAllAreas(),r.success("Areas synced from Home Assistant")}catch(C){console.error("Error syncing areas:",C),r.error("Failed to sync areas")}finally{b.value=!1}},F=async({device:C,command:h})=>{var j,O;try{const Q={device_id:C.id,command:h,entity_id:C.broadlink_entity,device:C.device};await le.post("/api/commands/test",Q),r.success(`Sent ${h} to ${C.name}`)}catch(Q){console.error("Error sending command:",Q);const ne=((O=(j=Q.response)==null?void 0:j.data)==null?void 0:O.error)||Q.message||"Unknown error";r.error(`Failed to send ${h}: ${ne}`)}};return(C,h)=>{var j;return n(),a("div",os,[e("div",ls,[e("button",{class:"icon-button chevron-button",onClick:A},[e("i",{class:Y(["mdi",D.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2)]),e("div",{class:"header-left",onClick:A},[h[11]||(h[11]=e("div",{class:"header-icon"},[e("i",{class:"mdi mdi-devices"})],-1)),h[12]||(h[12]=e("h3",null,"Managed Devices",-1)),e("div",ns,[e("span",ss,u(_e(c).deviceCount)+" devices",1)])]),e("div",as,[D.value?(n(),a("button",{key:0,onClick:pe(l,["stop"]),class:"btn btn-secondary",disabled:b.value,title:"Sync all areas from Home Assistant"},[e("i",{class:Y(["mdi",b.value?"mdi-loading mdi-spin":"mdi-refresh"])},null,2),S(" "+u(b.value?"Syncing...":"Sync Areas"),1)],8,is)):T("",!0),D.value?(n(),a("button",{key:1,onClick:h[0]||(h[0]=pe((...O)=>C.generateAllEntities&&C.generateAllEntities(...O),["stop"])),class:"btn btn-secondary",disabled:V.value,title:"Generate entities for all devices"},[e("i",{class:Y(["mdi",V.value?"mdi-loading mdi-spin":"mdi-file-code"])},null,2),S(" "+u(V.value?"Generating...":"Generate Entities"),1)],8,rs)):T("",!0),D.value?(n(),a("button",{key:2,onClick:h[1]||(h[1]=pe(O=>k.value=!0,["stop"])),class:"btn btn-primary"},[...h[13]||(h[13]=[e("i",{class:"mdi mdi-plus"},null,-1),S(" Add Device ",-1)])])):T("",!0)])]),J(e("div",ds,[fe(ts,{ref_key:"discoveryRef",ref:_,onAdopt:P},null,512),_e(c).hasDevices?(n(),a("div",us,[e("div",cs,[e("div",ms,[e("label",null,[h[14]||(h[14]=e("i",{class:"mdi mdi-magnify"},null,-1)),J(e("input",{"onUpdate:modelValue":h[2]||(h[2]=O=>f.value.search=O),type:"text",placeholder:"Search devices, commands...",class:"search-input"},null,512),[[De,f.value.search]])])])]),e("div",vs,[e("div",ps,[e("label",null,[h[16]||(h[16]=e("i",{class:"mdi mdi-access-point"},null,-1)),J(e("select",{"onUpdate:modelValue":h[3]||(h[3]=O=>f.value.broadlinkDevice=O)},[h[15]||(h[15]=e("option",{value:""},"All Controller Devices",-1)),(n(!0),a(me,null,be(te.value,O=>(n(),a("option",{key:O.entity_id,value:O.entity_id},u(O.friendly_name),9,fs))),128))],512),[[ke,f.value.broadlinkDevice]])])]),e("div",gs,[e("label",null,[h[18]||(h[18]=e("i",{class:"mdi mdi-home-map-marker"},null,-1)),J(e("select",{"onUpdate:modelValue":h[4]||(h[4]=O=>f.value.area=O)},[h[17]||(h[17]=e("option",{value:""},"All Areas",-1)),(n(!0),a(me,null,be(se.value,O=>(n(),a("option",{key:O,value:O},u(O),9,ys))),128))],512),[[ke,f.value.area]])])]),e("div",bs,[e("label",null,[h[20]||(h[20]=e("i",{class:"mdi mdi-shape"},null,-1)),J(e("select",{"onUpdate:modelValue":h[5]||(h[5]=O=>f.value.entityType=O)},[...h[19]||(h[19]=[Ae('<option value="" data-v-ed5a04a8>All Types</option><option value="light" data-v-ed5a04a8>Light</option><option value="fan" data-v-ed5a04a8>Fan</option><option value="switch" data-v-ed5a04a8>Switch</option><option value="media_player" data-v-ed5a04a8>Media Player</option><option value="cover" data-v-ed5a04a8>Cover</option><option value="climate" data-v-ed5a04a8>Climate</option>',7)])],512),[[ke,f.value.entityType]])])]),ee.value?(n(),a("div",hs,[e("label",ks,[h[21]||(h[21]=e("span",{class:"toggle-text"},[e("img",{src:Ne,alt:"SmartIR",class:"smartir-icon"}),S(" SmartIR Only ")],-1)),J(e("input",{type:"checkbox","onUpdate:modelValue":h[6]||(h[6]=O=>f.value.showSmartIROnly=O),class:"toggle-checkbox"},null,512),[[ve,f.value.showSmartIROnly]]),h[22]||(h[22]=e("span",{class:"toggle-slider"},null,-1))])])):T("",!0),B.value?(n(),a("button",{key:1,onClick:Z,class:"btn-clear-filters"},[...h[23]||(h[23]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),S(" Clear ",-1)])])):T("",!0),e("div",ws,[e("button",{onClick:h[7]||(h[7]=O=>t.value="grid"),class:Y(["view-toggle-btn",{active:t.value==="grid"}]),title:"Grid View"},[...h[24]||(h[24]=[e("i",{class:"mdi mdi-view-grid"},null,-1),S(" Grid ",-1)])],2),e("button",{onClick:h[8]||(h[8]=O=>t.value="list"),class:Y(["view-toggle-btn",{active:t.value==="list"}]),title:"List View"},[...h[25]||(h[25]=[e("i",{class:"mdi mdi-view-list"},null,-1),S(" List ",-1)])],2)]),e("div",$s,u(L.value.length)+" of "+u(_e(c).deviceCount),1)])])):T("",!0),_e(c).loading?(n(),a("div",Cs,[...h[26]||(h[26]=[e("i",{class:"mdi mdi-loading mdi-spin"},null,-1),e("p",null,"Loading devices...",-1)])])):_e(c).error?(n(),a("div",_s,[h[27]||(h[27]=e("i",{class:"mdi mdi-alert-circle"},null,-1)),e("p",null,u(_e(c).error),1),e("button",{onClick:h[9]||(h[9]=O=>_e(c).loadDevices()),class:"btn btn-secondary"}," Retry ")])):_e(c).hasDevices?T("",!0):(n(),a("div",Ss,[h[29]||(h[29]=e("i",{class:"mdi mdi-devices"},null,-1)),h[30]||(h[30]=e("h3",null,"No Devices Yet",-1)),h[31]||(h[31]=e("p",null,"Get started by adding your first managed device",-1)),e("button",{onClick:h[10]||(h[10]=O=>k.value=!0),class:"btn btn-primary"},[...h[28]||(h[28]=[e("i",{class:"mdi mdi-plus"},null,-1),S(" Add Your First Device ",-1)])])])),t.value==="grid"?(n(),a("div",Ds,[(n(!0),a(me,null,be(L.value,O=>(n(),Te(Mt,{key:O.id,device:O,"broadlink-devices":p.value,onEdit:ye,onDelete:$e,onLearn:g},null,8,["device","broadlink-devices"]))),128))])):t.value==="list"&&L.value.length>0?(n(),Te(Xt,{key:5,devices:L.value,onSendCommand:F,onEditDevice:ye,onDeleteDevice:$e},null,8,["devices"])):T("",!0),_e(c).hasDevices&&L.value.length===0?(n(),a("div",Is,[...h[32]||(h[32]=[e("i",{class:"mdi mdi-filter-off"},null,-1),e("h3",null,"No devices match your filters",-1),e("p",null,"Try adjusting your search or filter criteria",-1)])])):T("",!0)],512),[[Xe,D.value]]),k.value?(n(),Te(_l,{key:0,device:s.value,onSave:U,onCancel:H},null,8,["device"])):T("",!0),w.value?(n(),Te(kn,{key:1,device:s.value,onLearned:W,onCancel:$},null,8,["device"])):T("",!0),fe(Re,{isOpen:m.value,title:`Delete ${(j=v.value)==null?void 0:j.name}?`,message:Ie.value,confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,checkboxLabel:we.value,onConfirm:d,onCancel:I},null,8,["isOpen","title","message","checkboxLabel"]),fe(Ln,{isOpen:q.value,title:E.value.title,message:E.value.message,suggestion:E.value.suggestion,details:E.value.details,error:E.value.error,context:E.value.context,onClose:oe},null,8,["isOpen","title","message","suggestion","details","error","context"]),fe(Re,{isOpen:R.value,title:i.value.title,message:i.value.message,confirmText:"OK",showCancel:!1,dangerMode:!i.value.success,onConfirm:ae,onCancel:ae},null,8,["isOpen","title","message","dangerMode"])])}}},Ts=he(xs,[["__scopeId","data-v-ed5a04a8"]]),Ms={class:"banner-content"},Rs={class:"banner-icon"},Ls={class:"banner-message"},As={class:"banner-actions"},Os={__name:"SmartIRBanner",setup(o){const c=Se("smartirStatus"),r=y(!1),k=z(()=>!(!c.value||r.value||localStorage.getItem("smartir_banner_dismissed")==="true")),w=z(()=>{var V;return(V=c.value)!=null&&V.installed?"banner-success":"banner-info"}),s=z(()=>{var V;return(V=c.value)!=null&&V.installed?"mdi mdi-check-circle":"mdi mdi-information"}),m=z(()=>{var V;return(V=c.value)!=null&&V.installed?`SmartIR Detected (v${c.value.version})`:"Want Climate Device Support?"}),v=z(()=>{var V;return(V=c.value)!=null&&V.installed?"You can now create climate device profiles with full temperature and HVAC mode control.":"Install SmartIR to unlock AC/heater control with temperature settings, HVAC modes, and 120+ pre-configured device profiles."});function _(){window.open("https://github.com/smartHomeHub/SmartIR","_blank")}function D(){var V;if(r.value=!0,(V=c.value)!=null&&V.installed)localStorage.setItem("smartir_banner_dismissed","true");else{const b=parseInt(localStorage.getItem("smartir_banner_dismiss_count")||"0");b>=2?localStorage.setItem("smartir_banner_dismissed","true"):localStorage.setItem("smartir_banner_dismiss_count",String(b+1))}}return xe(()=>{var t;const V=localStorage.getItem("smartir_last_status"),b=(t=c.value)!=null&&t.installed?"installed":"not_installed";V!==b&&(localStorage.removeItem("smartir_banner_dismissed"),localStorage.removeItem("smartir_banner_dismiss_count"),localStorage.setItem("smartir_last_status",b))}),(V,b)=>{var t,A;return k.value?(n(),a("div",{key:0,class:Y(["smartir-banner",w.value])},[e("div",Ms,[e("div",Rs,[e("i",{class:Y(s.value)},null,2)]),e("div",Ls,[e("strong",null,u(m.value),1),e("p",null,u(v.value),1)]),e("div",As,[(t=V.status)!=null&&t.installed?T("",!0):(n(),a("button",{key:0,onClick:_,class:"btn-primary"}," Learn More ")),e("button",{onClick:D,class:"btn-text"},u((A=V.status)!=null&&A.installed?"Got it":"Dismiss"),1)])])],2)):T("",!0)}}},Vs=he(Os,[["__scopeId","data-v-7bbcbcd7"]]),Oe="api/smartir",Ye={async getStatus(){try{const o=await fetch(`${Oe}/status`);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return await o.json()}catch(o){return console.error("Error fetching SmartIR status:",o),{installed:!1,version:null,error:o.message}}},async getInstallInstructions(){try{const o=await fetch(`${Oe}/install-instructions`);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return await o.json()}catch(o){throw console.error("Error fetching install instructions:",o),o}},async getPlatforms(){try{const o=await fetch(`${Oe}/platforms`);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return await o.json()}catch(o){throw console.error("Error fetching platforms:",o),o}},async getPlatformCodes(o){try{const c=await fetch(`${Oe}/platforms/${o}/codes`);if(!c.ok)throw new Error(`HTTP error! status: ${c.status}`);return await c.json()}catch(c){throw console.error(`Error fetching codes for ${o}:`,c),c}},async getNextCode(o){try{const c=await fetch(`${Oe}/platforms/${o}/next-code`);if(!c.ok)throw new Error(`HTTP error! status: ${c.status}`);return await c.json()}catch(c){throw console.error(`Error fetching next code for ${o}:`,c),c}},async validateCode(o,c){try{const r=await fetch(`${Oe}/validate-code`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({platform:o,code:c})});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);return await r.json()}catch(r){throw console.error("Error validating code:",r),r}}},Es={class:"profile-card"},Us={class:"profile-card-header"},Ps=["title"],js={class:"profile-details"},Fs=["title"],Ns={class:"profile-meta"},Bs=["title"],qs=["title"],Hs=["title"],zs={class:"profile-card-footer"},Js=["title"],Ws={key:0,class:"learned-indicator"},Ks={class:"profile-actions"},Xs={__name:"SmartIRProfileCard",props:{profile:{type:Object,required:!0}},emits:["edit","download","delete","commands"],setup(o){const c=o,r=Ge(z(()=>c.profile.platform)),k=m=>m.replace(/_/g," ").replace(/\b\w/g,v=>v.toUpperCase()),w=m=>m&&m.startsWith("mdi:")?`mdi ${m.replace(":"," mdi-")}`:`mdi mdi-${m}`,s=m=>{if(!m)return"";const v=m.toLowerCase();return v.includes("broadlink")?"broadlink-tag":v.includes("not set")?"not-set-tag":"default-controller-tag"};return(m,v)=>(n(),a("div",Es,[e("div",Us,[e("div",{class:Y(["profile-icon",_e(r).colorClass.value]),title:k(o.profile.platform)},[e("i",{class:Y(w(_e(r).icon.value))},null,2)],10,Ps),e("div",js,[e("h4",{title:`${o.profile.manufacturer} ${o.profile.model}`},u(o.profile.manufacturer)+" "+u(o.profile.model),9,Fs),e("div",Ns,[e("span",{class:"tag platform-tag",title:k(o.profile.platform)},u(k(o.profile.platform)),9,Bs),o.profile.controllerBrand?(n(),a("span",{key:0,class:Y(["tag controller-tag",s(o.profile.controllerBrand)]),title:"Controller: "+o.profile.controllerBrand},[v[4]||(v[4]=e("i",{class:"mdi mdi-remote-tv"},null,-1)),S(" "+u(o.profile.controllerBrand),1)],10,qs)):T("",!0)])]),e("div",{class:"code-badge",title:"Device Code: "+o.profile.code},u(o.profile.code),9,Hs)]),e("div",zs,[e("div",{class:"profile-stats",title:o.profile.commandCount+" total commands"+(o.profile.learnedCount>0?", "+o.profile.learnedCount+" learned":"")},[v[5]||(v[5]=e("i",{class:"mdi mdi-remote"},null,-1)),e("span",null,u(o.profile.commandCount)+" command"+u(o.profile.commandCount!==1?"s":""),1),o.profile.learnedCount>0?(n(),a("span",Ws,"( "+u(o.profile.learnedCount)+" learned )",1)):T("",!0)],8,Js),e("div",Ks,[e("button",{onClick:v[0]||(v[0]=_=>m.$emit("commands")),class:"action-btn",title:"Commands"},[...v[6]||(v[6]=[e("i",{class:"mdi mdi-remote"},null,-1)])]),e("button",{onClick:v[1]||(v[1]=_=>m.$emit("edit")),class:"action-btn",title:"Edit Profile"},[...v[7]||(v[7]=[e("i",{class:"mdi mdi-pencil"},null,-1)])]),e("button",{onClick:v[2]||(v[2]=_=>m.$emit("download")),class:"action-btn",title:"Download JSON"},[...v[8]||(v[8]=[e("i",{class:"mdi mdi-download"},null,-1)])]),e("button",{onClick:v[3]||(v[3]=_=>m.$emit("delete")),class:"action-btn delete",title:"Delete Profile"},[...v[9]||(v[9]=[e("i",{class:"mdi mdi-delete"},null,-1)])])])])]))}},Gs=he(Xs,[["__scopeId","data-v-b72a1955"]]),Ys={name:"SmartIRProfileListView",props:{profiles:{type:Array,required:!0}},methods:{getPlatformIcon(o){return{climate:"mdi-thermostat",media_player:"mdi-television",fan:"mdi-fan",light:"mdi-lightbulb"}[o]||"mdi-devices"},formatPlatform(o){return{climate:"Climate",media_player:"Media Player",fan:"Fan",light:"Light"}[o]||o},editProfile(o){this.$emit("edit",o)},viewCommands(o){this.$emit("commands",o)},downloadProfile(o){this.$emit("download",o)},deleteProfile(o){this.$emit("delete",o)}}},Zs={class:"profile-list-view"},Qs={class:"profile-table"},ea={class:"profile-code"},ta={class:"code-badge"},oa={class:"profile-manufacturer"},la={class:"profile-model"},na={class:"model-info"},sa={class:"model-name"},aa={key:0,class:"model-count"},ia={class:"profile-platform"},ra={class:"profile-controller"},da={class:"profile-commands"},ua={class:"command-stats"},ca={class:"stat-item"},ma={key:0,class:"stat-item learned"},va={class:"profile-actions"},pa=["onClick"],fa=["onClick"],ga=["onClick"],ya=["onClick"];function ba(o,c,r,k,w,s){return n(),a("div",Zs,[e("table",Qs,[c[6]||(c[6]=e("thead",null,[e("tr",null,[e("th",null,"Code"),e("th",null,"Manufacturer"),e("th",null,"Model"),e("th",null,"Platform"),e("th",null,"Controller"),e("th",null,"Commands"),e("th",null,"Actions")])],-1)),e("tbody",null,[(n(!0),a(me,null,be(r.profiles,m=>(n(),a("tr",{key:`${m.platform}-${m.code}`,class:"profile-row"},[e("td",ea,[e("span",ta,u(m.code),1)]),e("td",oa,u(m.manufacturer||"Unknown"),1),e("td",la,[e("div",na,[e("div",sa,u(m.model||"Unknown"),1),m.models&&m.models.length>1?(n(),a("div",aa," +"+u(m.models.length-1)+" more ",1)):T("",!0)])]),e("td",ia,[e("span",{class:Y(["platform-badge",m.platform])},[e("i",{class:Y(["mdi",s.getPlatformIcon(m.platform)])},null,2),S(" "+u(s.formatPlatform(m.platform)),1)],2)]),e("td",ra,u(m.controller_brand||"N/A"),1),e("td",da,[e("div",ua,[e("span",ca,[c[0]||(c[0]=e("i",{class:"mdi mdi-remote"},null,-1)),S(" "+u(m.command_count||0),1)]),m.learned_count>0?(n(),a("span",ma,[c[1]||(c[1]=e("i",{class:"mdi mdi-school"},null,-1)),S(" "+u(m.learned_count),1)])):T("",!0)])]),e("td",va,[e("button",{class:"action-btn edit",onClick:v=>s.editProfile(m),title:"Edit Profile"},[...c[2]||(c[2]=[e("i",{class:"mdi mdi-pencil"},null,-1)])],8,pa),e("button",{class:"action-btn commands",onClick:v=>s.viewCommands(m),title:"View Commands"},[...c[3]||(c[3]=[e("i",{class:"mdi mdi-remote"},null,-1)])],8,fa),e("button",{class:"action-btn download",onClick:v=>s.downloadProfile(m),title:"Download"},[...c[4]||(c[4]=[e("i",{class:"mdi mdi-download"},null,-1)])],8,ga),e("button",{class:"action-btn delete",onClick:v=>s.deleteProfile(m),title:"Delete"},[...c[5]||(c[5]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,ya)])]))),128))])])])}const ha=he(Ys,[["render",ba],["__scopeId","data-v-8e144275"]]),ka={class:"modal-container"},wa={class:"modal-body"},$a={key:0,class:"selection-section"},Ca={class:"form-group"},_a={class:"form-group"},Sa={class:"form-group"},Da={key:0,class:"code-info"},Ia={class:"form-actions"},xa=["disabled"],Ta={key:1,class:"testing-section"},Ma={class:"code-header"},Ra={class:"code-details"},La={class:"code-badge"},Aa={class:"device-selector"},Oa=["value"],Va={class:"commands-section"},Ea={class:"commands-header"},Ua={key:0,class:"tested-count"},Pa={key:0,class:"filters-section"},ja={class:"filter-row"},Fa={class:"filter-row"},Na={key:1,class:"empty-state"},Ba={key:2,class:"empty-state"},qa={key:3,class:"commands-list"},Ha={class:"command-name"},za={class:"command-actions"},Ja={key:0,class:"status-badge success"},Wa=["onClick","disabled"],Ka={__name:"SmartIRCodeTester",props:{isOpen:{type:Boolean,default:!1}},emits:["close","clone"],setup(o,{emit:c}){const r=o,k=c,w=Se("toast"),s=y("climate"),m=y(""),v=y([]),_=y(!1),D=y(null),V=y(""),b=y([]),t=y(!1),A=z(()=>b.value.map(W=>({code:W.code,label:`${W.models.join(", ")} (Code: ${W.code})`,value:W.code}))),q=y(null),E=y(null),R=y(!1),i=y([]),f=y(""),p=y([]),M=y(new Set),G=y(null),ee=y(""),te=y(""),se=y(""),L=y(""),B=z(()=>{let W=p.value;if(ee.value){const x=ee.value.toLowerCase();W=W.filter(re=>(re.label||re.name).toLowerCase().includes(x))}return te.value&&(W=W.filter(x=>x.mode===te.value)),se.value&&(W=W.filter(x=>x.fanSpeed===se.value)),L.value&&(W=W.filter(x=>x.swingMode===L.value)),W}),Z=z(()=>ee.value||te.value||se.value||L.value);ue(()=>r.isOpen,W=>{W&&(ce(),Ie())}),ue(s,()=>{r.isOpen&&(m.value="",D.value=null,b.value=[],ce())});async function ce(){var W;_.value=!0;try{const x=await le.get("/api/smartir/codes/manufacturers",{params:{entity_type:s.value}});v.value=x.data.manufacturers||[]}catch(x){console.error("Error loading manufacturers:",x),(W=w.value)==null||W.error("Failed to load manufacturers","❌ Error")}finally{_.value=!1}}async function ye(){var W;if(m.value){t.value=!0;try{const x=await le.get("/api/smartir/codes/models",{params:{entity_type:s.value,manufacturer:m.value}});b.value=x.data.models||[]}catch(x){console.error("Error loading models:",x),(W=w.value)==null||W.error("Failed to load models","❌ Error")}finally{t.value=!1}}}async function Ie(){try{const W=await le.get("/api/remote/devices");i.value=W.data.devices||[]}catch(W){console.error("Error loading Broadlink devices:",W)}}async function we(){var W,x;if(D.value){R.value=!0;try{const re=await le.get("/api/smartir/codes/code",{params:{entity_type:s.value,code_id:D.value.code}});E.value=re.data.code,q.value=D.value.code,$e(re.data.code),(W=w.value)==null||W.success(`Loaded ${p.value.length} commands`,"✅ Code Loaded")}catch(re){console.error("Error loading code:",re),(x=w.value)==null||x.error(re.message||"Failed to load code","❌ Error")}finally{R.value=!1}}}function $e(W){const x=[];if(!W.commands){p.value=x;return}if(s.value==="climate"){const X=W.commands;for(const[de,P]of Object.entries(X)){if(de==="off"){typeof P=="string"&&x.push({name:"off",label:"OFF",data:P,mode:"off"});continue}if(typeof P=="object"){for(const[l,F]of Object.entries(P))if(typeof F=="object")for(const[C,h]of Object.entries(F)){if(typeof h!="object")continue;const j=Object.keys(h),O=j.includes("24")?"24":j[0];if(O&&typeof h[O]=="string"){const Q=`${de}_${O}_${l}_${C}`,ne=`${de.toUpperCase()} ${O}°C ${l} ${C}`;x.push({name:Q,label:ne,data:h[O],mode:de,temperature:O,fanSpeed:l,swingMode:C})}}}}}else for(const[X,de]of Object.entries(W.commands))typeof de=="string"&&x.push({name:X,label:X.toUpperCase().replace(/_/g," "),data:de});p.value=x}async function I(W){var x,re,X;if(!f.value){(x=w.value)==null||x.warning("Please select a Broadlink device first","⚠️ No Device");return}G.value=W;try{const de=p.value.find(P=>P.name===W);if(!de||!de.data)throw new Error(`Command "${W}" not found`);await le.post("/api/commands/send-raw",{entity_id:f.value,command:de.data,command_type:"ir"}),M.value.add(W),(re=w.value)==null||re.success(`Command sent: ${de.label||W}`,"✅ Tested")}catch(de){console.error("Error testing command:",de),(X=w.value)==null||X.error("Failed to test command","❌ Error")}finally{G.value=null}}function d(){var W,x,re,X;if(!E.value){(W=w.value)==null||W.error("No profile data to download","❌ Error");return}try{const de=E.value.manufacturer||"unknown",P=((x=E.value.supportedModels)==null?void 0:x[0])||q.value,l=`${de.toLowerCase().replace(/\s+/g,"_")}_${P.toLowerCase().replace(/\s+/g,"_")}.json`,F=JSON.stringify(E.value,null,2),C=new Blob([F],{type:"application/json"}),h=URL.createObjectURL(C),j=document.createElement("a");j.href=h,j.download=l,document.body.appendChild(j),j.click(),document.body.removeChild(j),URL.revokeObjectURL(h),(re=w.value)==null||re.success(`Downloaded ${l}`,"✅ Download Complete")}catch(de){console.error("Error downloading JSON:",de),(X=w.value)==null||X.error(de.message||"Failed to download JSON","❌ Download Error")}}function U(){m.value="",D.value=null,V.value="",b.value=[]}function H(){D.value=null,V.value="",ye()}function g(){V.value?D.value=b.value.find(W=>W.code===V.value):D.value=null}function $(){ee.value="",te.value="",se.value="",L.value=""}function N(){q.value=null,E.value=null,p.value=[],M.value.clear(),G.value=null,$()}function oe(W){const x=W.toLowerCase();return x.includes("power")||x.includes("off")||x==="off"?"mdi-power":x.includes("cool")?"mdi-snowflake":x.includes("heat")?"mdi-fire":x.includes("fan")?"mdi-fan":x.includes("auto")?"mdi-auto-fix":x.includes("dry")?"mdi-water-percent":x.includes("temp")?"mdi-thermometer":x.includes("swing")?"mdi-swap-vertical":"mdi-remote"}function ae(){N(),m.value="",D.value=null,k("close")}return(W,x)=>{var re;return o.isOpen?(n(),a("div",{key:0,class:"modal-overlay",onClick:pe(ae,["self"])},[e("div",ka,[e("div",{class:"modal-header"},[x[9]||(x[9]=e("h3",null,[e("i",{class:"mdi mdi-test-tube"}),S(" Test SmartIR Code ")],-1)),e("button",{onClick:ae,class:"close-btn"},[...x[8]||(x[8]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",wa,[q.value?(n(),a("div",Ta,[e("div",Ma,[e("div",Ra,[e("h4",null,u(E.value.manufacturer)+" - "+u(((re=E.value.supportedModels)==null?void 0:re[0])||"Unknown"),1),e("span",La,"Code: "+u(q.value),1)]),e("button",{onClick:N,class:"btn-secondary-small"},[...x[14]||(x[14]=[e("i",{class:"mdi mdi-arrow-left"},null,-1),S(" Change Code ",-1)])])]),e("div",Aa,[x[16]||(x[16]=e("label",null,[e("i",{class:"mdi mdi-remote"}),S(" Broadlink Device ")],-1)),J(e("select",{"onUpdate:modelValue":x[3]||(x[3]=X=>f.value=X),class:"form-select"},[x[15]||(x[15]=e("option",{value:""},"Select device to test with...",-1)),(n(!0),a(me,null,be(i.value,X=>(n(),a("option",{key:X.entity_id,value:X.entity_id},u(X.friendly_name||X.entity_id),9,Oa))),128))],512),[[ke,f.value]])]),e("div",Va,[e("div",Ea,[e("h5",null,"Sample Commands ("+u(B.value.length)+" / "+u(p.value.length)+")",1),M.value.size>0?(n(),a("span",Ua,u(M.value.size)+" tested ",1)):T("",!0)]),s.value==="climate"&&p.value.length>0?(n(),a("div",Pa,[e("div",ja,[J(e("input",{"onUpdate:modelValue":x[4]||(x[4]=X=>ee.value=X),type:"text",placeholder:"Search commands...",class:"search-input"},null,512),[[De,ee.value]])]),e("div",Fa,[J(e("select",{"onUpdate:modelValue":x[5]||(x[5]=X=>te.value=X),class:"filter-select"},[...x[17]||(x[17]=[e("option",{value:""},"All Modes",-1),e("option",{value:"cool"},"Cool",-1),e("option",{value:"heat"},"Heat",-1),e("option",{value:"off"},"Off",-1)])],512),[[ke,te.value]]),J(e("select",{"onUpdate:modelValue":x[6]||(x[6]=X=>se.value=X),class:"filter-select"},[...x[18]||(x[18]=[Ae('<option value="" data-v-d1d8935f>All Fan Speeds</option><option value="low" data-v-d1d8935f>Low</option><option value="mid" data-v-d1d8935f>Mid</option><option value="high" data-v-d1d8935f>High</option><option value="auto" data-v-d1d8935f>Auto</option>',5)])],512),[[ke,se.value]]),J(e("select",{"onUpdate:modelValue":x[7]||(x[7]=X=>L.value=X),class:"filter-select"},[...x[19]||(x[19]=[e("option",{value:""},"All Swing",-1),e("option",{value:"stop"},"Stop",-1),e("option",{value:"swing"},"Swing",-1)])],512),[[ke,L.value]]),Z.value?(n(),a("button",{key:0,onClick:$,class:"btn-clear-filters"},[...x[20]||(x[20]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),S(" Clear ",-1)])])):T("",!0)])])):T("",!0),p.value.length===0?(n(),a("div",Na,[...x[21]||(x[21]=[e("i",{class:"mdi mdi-alert-circle"},null,-1),e("p",null,"No commands found in this code",-1)])])):B.value.length===0?(n(),a("div",Ba,[x[22]||(x[22]=e("i",{class:"mdi mdi-filter-off"},null,-1)),x[23]||(x[23]=e("p",null,"No commands match your filters",-1)),e("button",{onClick:$,class:"btn-secondary-small"}," Clear Filters ")])):(n(),a("div",qa,[(n(!0),a(me,null,be(B.value,X=>(n(),a("div",{key:X.name,class:Y(["command-item",{tested:M.value.has(X.name),testing:G.value===X.name}])},[e("div",Ha,[e("i",{class:Y(["mdi",oe(X.mode||X.name)])},null,2),e("span",null,u(X.label||X.name),1)]),e("div",za,[M.value.has(X.name)?(n(),a("span",Ja,[...x[24]||(x[24]=[e("i",{class:"mdi mdi-check"},null,-1),S(" Tested ",-1)])])):T("",!0),e("button",{onClick:de=>I(X.name),disabled:!f.value||G.value===X.name,class:"btn-test"},[e("i",{class:Y(["mdi",G.value===X.name?"mdi-loading mdi-spin":"mdi-play"])},null,2),x[25]||(x[25]=S(" Test ",-1))],8,Wa)])],2))),128))]))]),e("div",{class:"modal-actions"},[e("button",{onClick:d,class:"btn-primary"},[...x[26]||(x[26]=[e("i",{class:"mdi mdi-download"},null,-1),S(" Download JSON ",-1)])]),e("button",{onClick:ae,class:"btn-secondary"}," Close ")])])):(n(),a("div",$a,[x[13]||(x[13]=e("div",{class:"info-banner"},[e("i",{class:"mdi mdi-information"}),e("p",null,"Select a SmartIR code from the index to test commands with your Broadlink device.")],-1)),e("div",Ca,[x[11]||(x[11]=e("label",null,[e("i",{class:"mdi mdi-shape"}),S(" Platform ")],-1)),J(e("select",{"onUpdate:modelValue":x[0]||(x[0]=X=>s.value=X),onChange:U,class:"form-select"},[...x[10]||(x[10]=[e("option",{value:"climate"},"Climate (AC/Heater)",-1),e("option",{value:"media_player"},"Media Player (TV/Audio)",-1),e("option",{value:"fan"},"Fan",-1),e("option",{value:"light"},"Light",-1)])],544),[[ke,s.value]])]),e("div",_a,[fe(je,{modelValue:m.value,"onUpdate:modelValue":x[1]||(x[1]=X=>m.value=X),options:v.value,label:"Manufacturer",placeholder:"Search manufacturers...",loading:_.value,disabled:_.value,onChange:H},null,8,["modelValue","options","loading","disabled"])]),e("div",Sa,[fe(je,{modelValue:V.value,"onUpdate:modelValue":x[2]||(x[2]=X=>V.value=X),options:A.value,"option-label":"label","option-value":"code",label:"Model",placeholder:"Search models...",loading:t.value,disabled:!m.value||t.value,onChange:g},null,8,["modelValue","options","loading","disabled"])]),D.value?(n(),a("div",Da,[x[12]||(x[12]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[e("strong",null,u(m.value)+" - "+u(D.value.models[0]),1),e("p",null,"Code: "+u(D.value.code),1)])])):T("",!0),e("div",Ia,[e("button",{onClick:we,disabled:!D.value||R.value,class:"btn-primary"},[e("i",{class:Y(["mdi",R.value?"mdi-loading mdi-spin":"mdi-download"])},null,2),S(" "+u(R.value?"Loading...":"Load Commands"),1)],8,xa)])]))])])])):T("",!0)}}},Xa=he(Ka,[["__scopeId","data-v-d1d8935f"]]),Ga={class:"smartir-status-card"},Ya={class:"card-header"},Za=["src"],Qa={class:"header-badges"},ei=["title"],ti={class:"header-info"},oi={class:"header-info"},li={class:"header-info"},ni={class:"header-right"},si={key:0,class:"card-body loading-state"},ai={key:1,class:"card-body error-state"},ii={key:2,class:"card-body installed-state"},ri={key:0,class:"help-panel"},di={key:0,class:"recommendation"},ui={key:0,class:"next-steps"},ci={class:"help-actions"},mi={key:1,class:"filter-bar"},vi={class:"filter-row"},pi={class:"filter-group filter-search"},fi={class:"filter-group"},gi={class:"view-toggle-group"},yi={class:"filter-results"},bi={key:2,class:"loading-state"},hi={key:3,class:"empty-state"},ki={key:4,class:"profiles-grid"},wi={key:6,class:"no-results"},$i={key:3,class:"card-body not-installed-state"},Ci={class:"benefits-section"},_i={class:"benefits-list"},Si={class:"recommendation"},Di={__name:"SmartIRStatusCard",emits:["create-profile","edit-profile"],setup(o,{expose:c,emit:r}){const k=r,w=Se("smartirStatus");Se("smartirEnabled");const s=Se("refreshSmartIR"),m=y(!1),v=y(null),_=y((w==null?void 0:w.value)||null),D=y(localStorage.getItem("smartir_simulate_not_installed")==="true"),V=y(!1),b=y(!0),t=y([]),A=y(!1),q=y({search:"",platform:""}),E=y({show:!1,title:"",message:"",platform:null,profile:null}),R=y(!1),i=y(localStorage.getItem("profile_view_mode")||"grid"),f=["Full climate entity support (AC, heaters)","120+ pre-configured device profiles","Temperature and humidity sensor integration","HVAC mode control (heat, cool, auto, dry, fan)"],p=["climate","media_player","fan","light"],M=z(()=>D.value?{installed:!1,recommendation:{message:"Install SmartIR to unlock climate device support!",benefits:["Full climate entity support (AC, heaters)","120+ pre-configured device profiles","Temperature and humidity sensor integration","HVAC mode control (heat, cool, auto, dry, fan)"]}}:_.value),G=z(()=>{var H,g;return((g=(H=M.value)==null?void 0:H.platforms)==null?void 0:g.length)||0}),ee=z(()=>{var H;return(H=M.value)!=null&&H.device_counts?Object.values(M.value.device_counts).reduce((g,$)=>g+$,0):0});function te(){var H;D.value=!D.value,localStorage.setItem("smartir_simulate_not_installed",D.value.toString()),!D.value&&((H=_.value)!=null&&H.installed)&&we()}const se=z(()=>{let H=t.value;if(q.value.search){const g=q.value.search.toLowerCase();H=H.filter($=>{var N,oe,ae,W;return((N=$.manufacturer)==null?void 0:N.toLowerCase().includes(g))||((oe=$.model)==null?void 0:oe.toLowerCase().includes(g))||((ae=$.code)==null?void 0:ae.toString().includes(g))||((W=$.platform)==null?void 0:W.toLowerCase().includes(g))})}return q.value.platform&&(H=H.filter(g=>g.platform===q.value.platform)),H}),L=z(()=>q.value.search||q.value.platform);function B(){q.value.search="",q.value.platform=""}async function Z(){m.value=!0,v.value=null;try{if(s)await s();else{const H=await Ye.getStatus();_.value=H}}catch(H){v.value=H.message||"Failed to refresh SmartIR status",console.error("Error refreshing SmartIR status:",H)}finally{m.value=!1}}function ce(){k("create-profile")}function ye(){R.value=!0}function Ie(){window.open("https://github.com/smartHomeHub/SmartIR","_blank")}async function we(){A.value=!0;const H=[];try{for(const g of p)try{const N=((await le.get(`/api/smartir/platforms/${g}/profiles`)).data.profiles||[]).map(oe=>({...oe,platform:g}));H.push(...N)}catch($){console.warn(`Network error loading ${g} profiles (using bundled index):`,$.message)}t.value=H}catch(g){console.error("Unexpected error loading profiles:",g)}finally{A.value=!1}}function $e(H,g,$){k("edit-profile",{platform:H,profile:g,startStep:$})}async function I(H,g){var $,N;try{const ae=(await le.get(`/api/smartir/platforms/${H}/profiles/${g.code}`)).data,W=JSON.stringify(ae.profile,null,2),x=new Blob([W],{type:"application/json"}),re=URL.createObjectURL(x),X=document.createElement("a");X.href=re,X.download=`smartir_${H}_${g.manufacturer}_${g.model}_${g.code}.json`,document.body.appendChild(X),X.click(),document.body.removeChild(X),URL.revokeObjectURL(re),($=Se("toast").value)==null||$.success(`Downloaded ${g.manufacturer} ${g.model}`,"✅ Profile Downloaded")}catch(oe){console.error("Error downloading profile:",oe),(N=Se("toast").value)==null||N.error("Failed to download profile","❌ Download Error")}}async function d(H,g){Se("toast");try{const N=(await le.post(`/api/smartir/profiles/${g.code}/check-usage`,{platform:H})).data;if(N&&N.in_use){E.value={show:!0,title:`Cannot Delete ${g.manufacturer} ${g.model}`,message:`This profile is currently in use by ${N.device_count} device(s):

${N.devices.join(`
`)}

Please remove or reassign these devices before deleting the profile.`,platform:H,profile:g,canDelete:!1,devices:N.devices};return}}catch($){console.error("Error checking profile usage:",$)}E.value={show:!0,title:`Delete ${g.manufacturer} ${g.model}?`,message:`Device Code: ${g.code}

This will remove the profile and update your configuration.`,platform:H,profile:g,canDelete:!0}}async function U(){var N,oe;const H=Se("toast"),{platform:g,profile:$}=E.value;E.value.show=!1;try{await le.delete(`/api/smartir/profiles/${$.code}`,{data:{platform:g}}),await we(),await We(),await Z(),(N=H.value)==null||N.success(`${$.manufacturer} ${$.model} has been removed`,"✅ Profile Deleted")}catch(ae){console.error("Error deleting profile:",ae),(oe=H.value)==null||oe.error("Failed to delete profile","❌ Delete Error")}}return ue(w,H=>{H&&(_.value=H)},{immediate:!0}),ue(i,H=>{localStorage.setItem("profile_view_mode",H)}),xe(async()=>{var H;w!=null&&w.value&&(_.value=w.value),_.value||await Z(),(H=_.value)!=null&&H.installed&&await we()}),c({loadAllProfiles:we,refreshStatus:Z}),(H,g)=>{var $,N,oe,ae,W,x,re,X,de,P;return n(),a("div",Ga,[e("div",Ya,[e("button",{class:"icon-button chevron-button",onClick:g[0]||(g[0]=l=>b.value=!b.value)},[e("i",{class:Y(["mdi",b.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2)]),e("div",{class:"header-left",onClick:g[1]||(g[1]=l=>b.value=!b.value)},[e("img",{src:_e(Ne),alt:"SmartIR",class:"smartir-logo"},null,8,Za),g[15]||(g[15]=e("h3",null,"SmartIR Integration",-1)),e("div",Qa,[e("div",{class:Y(["simulation-toggle-pill",{active:D.value}]),onClick:pe(te,["stop"]),title:D.value?"Click to show as installed":"Click to simulate not-installed"},[e("i",{class:Y(["mdi",D.value?"mdi-eye-off":"mdi-eye"])},null,2),e("span",null,u(D.value?"Simulating: Not Installed":"Simulation Mode"),1)],10,ei),($=M.value)!=null&&$.installed?(n(),a(me,{key:0},[g[14]||(g[14]=e("div",{class:"status-badge-mini success"},[e("i",{class:"mdi mdi-check-circle"}),e("span",null,"Installed")],-1)),e("span",ti,"v"+u(M.value.version||"Unknown"),1),e("span",oi,u(G.value)+" platform"+u(G.value!==1?"s":""),1),e("span",li,u(ee.value)+" device"+u(ee.value!==1?"s":""),1)],64)):T("",!0)])]),e("div",ni,[(N=M.value)!=null&&N.installed&&b.value?(n(),a("button",{key:0,onClick:g[2]||(g[2]=pe(l=>V.value=!V.value,["stop"])),class:Y(["icon-button",{active:V.value}]),title:"Show help"},[...g[16]||(g[16]=[e("i",{class:"mdi mdi-help-circle"},null,-1)])],2)):T("",!0),(oe=M.value)!=null&&oe.installed&&b.value?(n(),a("button",{key:1,onClick:pe(Z,["stop"]),class:"icon-button",title:"Refresh status"},[...g[17]||(g[17]=[e("i",{class:"mdi mdi-refresh"},null,-1)])])):T("",!0),(ae=M.value)!=null&&ae.installed&&b.value?(n(),a("button",{key:2,onClick:pe(ye,["stop"]),class:"btn btn-secondary"},[...g[18]||(g[18]=[e("i",{class:"mdi mdi-test-tube"},null,-1),S(" Test Codes ",-1)])])):T("",!0),(W=M.value)!=null&&W.installed&&b.value?(n(),a("button",{key:3,onClick:pe(ce,["stop"]),class:"btn btn-primary"},[...g[19]||(g[19]=[e("i",{class:"mdi mdi-plus"},null,-1),S(" Create SmartIR Profile ",-1)])])):T("",!0)])]),J(e("div",null,[m.value?(n(),a("div",si,[...g[20]||(g[20]=[e("div",{class:"spinner"},null,-1),e("p",null,"Checking SmartIR installation...",-1)])])):v.value?(n(),a("div",ai,[g[21]||(g[21]=e("i",{class:"mdi mdi-alert-circle"},null,-1)),e("p",null,u(v.value),1),e("button",{onClick:Z,class:"btn-secondary"}," Try Again ")])):(x=M.value)!=null&&x.installed?(n(),a("div",ii,[V.value?(n(),a("div",ri,[_.value.recommendation?(n(),a("div",di,[e("p",null,u(_.value.recommendation.message),1),_.value.recommendation.next_steps?(n(),a("div",ui,[g[22]||(g[22]=e("strong",null,"Next Steps:",-1)),e("ul",null,[(n(!0),a(me,null,be(_.value.recommendation.next_steps,(l,F)=>(n(),a("li",{key:F},u(l),1))),128))])])):T("",!0)])):T("",!0),e("div",ci,[e("button",{onClick:g[3]||(g[3]=(...l)=>H.viewDocumentation&&H.viewDocumentation(...l)),class:"btn-secondary"},[...g[23]||(g[23]=[e("i",{class:"mdi mdi-book-open-variant"},null,-1),S(" View Documentation ",-1)])])])])):T("",!0),t.value.length>0&&!D.value?(n(),a("div",mi,[e("div",vi,[e("div",pi,[e("label",null,[g[24]||(g[24]=e("i",{class:"mdi mdi-magnify"},null,-1)),J(e("input",{"onUpdate:modelValue":g[4]||(g[4]=l=>q.value.search=l),type:"text",placeholder:"Search profiles...",class:"search-input"},null,512),[[De,q.value.search]])])]),e("div",fi,[e("label",null,[g[26]||(g[26]=e("i",{class:"mdi mdi-shape"},null,-1)),J(e("select",{"onUpdate:modelValue":g[5]||(g[5]=l=>q.value.platform=l)},[...g[25]||(g[25]=[Ae('<option value="" data-v-10700524>All Platforms</option><option value="climate" data-v-10700524>Climate</option><option value="media_player" data-v-10700524>Media Player</option><option value="fan" data-v-10700524>Fan</option><option value="light" data-v-10700524>Light</option>',5)])],512),[[ke,q.value.platform]])])]),L.value?(n(),a("button",{key:0,onClick:B,class:"btn-clear-filters"},[...g[27]||(g[27]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),S(" Clear ",-1)])])):T("",!0),e("div",gi,[e("button",{onClick:g[6]||(g[6]=l=>i.value="grid"),class:Y(["view-toggle-btn",{active:i.value==="grid"}]),title:"Grid View"},[...g[28]||(g[28]=[e("i",{class:"mdi mdi-view-grid"},null,-1),S(" Grid ",-1)])],2),e("button",{onClick:g[7]||(g[7]=l=>i.value="list"),class:Y(["view-toggle-btn",{active:i.value==="list"}]),title:"List View"},[...g[29]||(g[29]=[e("i",{class:"mdi mdi-view-list"},null,-1),S(" List ",-1)])],2)]),e("div",yi,u(se.value.length)+" of "+u(t.value.length),1)])])):T("",!0),A.value?(n(),a("div",bi,[...g[30]||(g[30]=[e("i",{class:"mdi mdi-loading mdi-spin"},null,-1),e("p",null,"Loading profiles...",-1)])])):t.value.length===0?(n(),a("div",hi,[...g[31]||(g[31]=[e("i",{class:"mdi mdi-file-document-outline"},null,-1),e("h3",null,"No Profiles Yet",-1),e("p",null,"Create your first SmartIR profile to get started",-1)])])):T("",!0),i.value==="grid"&&!D.value?(n(),a("div",ki,[(n(!0),a(me,null,be(se.value,l=>(n(),Te(Gs,{key:`${l.platform}-${l.code}`,profile:l,onEdit:F=>$e(l.platform,l),onCommands:F=>$e(l.platform,l,2),onDownload:F=>I(l.platform,l),onDelete:F=>d(l.platform,l)},null,8,["profile","onEdit","onCommands","onDownload","onDelete"]))),128))])):i.value==="list"&&!D.value&&se.value.length>0?(n(),Te(ha,{key:5,profiles:se.value,onEdit:g[8]||(g[8]=l=>$e(l.platform,l)),onCommands:g[9]||(g[9]=l=>$e(l.platform,l,2)),onDownload:g[10]||(g[10]=l=>I(l.platform,l)),onDelete:g[11]||(g[11]=l=>d(l.platform,l))},null,8,["profiles"])):T("",!0),t.value.length>0&&se.value.length===0&&!D.value?(n(),a("div",wi,[...g[32]||(g[32]=[e("i",{class:"mdi mdi-filter-off"},null,-1),e("h3",null,"No profiles match your filters",-1),e("p",null,"Try adjusting your search or filter criteria",-1)])])):T("",!0)])):(n(),a("div",$i,[g[36]||(g[36]=e("div",{class:"status-badge warning"},[e("i",{class:"mdi mdi-information"}),e("span",null,"Not Installed")],-1)),e("div",Ci,[g[34]||(g[34]=e("h4",null,"Why Install SmartIR?",-1)),e("ul",_i,[(n(!0),a(me,null,be(((X=(re=_.value)==null?void 0:re.recommendation)==null?void 0:X.benefits)||f,(l,F)=>(n(),a("li",{key:F},[g[33]||(g[33]=e("i",{class:"mdi mdi-check"},null,-1)),e("span",null,u(l),1)]))),128))])]),e("div",Si,[e("p",null,u(((P=(de=_.value)==null?void 0:de.recommendation)==null?void 0:P.message)||"Install SmartIR to unlock climate device support!"),1)]),e("div",{class:"card-actions"},[e("button",{onClick:Ie,class:"btn-primary"},[...g[35]||(g[35]=[e("i",{class:"mdi mdi-github"},null,-1),S(" Install SmartIR ",-1)])])])]))],512),[[Xe,b.value]]),fe(Re,{isOpen:E.value.show,title:E.value.title,message:E.value.message,confirmText:E.value.canDelete===!1?null:"Delete",cancelText:"Close",dangerMode:!0,confirmDisabled:E.value.canDelete===!1,onConfirm:U,onCancel:g[12]||(g[12]=l=>E.value.show=!1)},null,8,["isOpen","title","message","confirmText","confirmDisabled"]),fe(Xa,{isOpen:R.value,onClose:g[13]||(g[13]=l=>R.value=!1)},null,8,["isOpen"])])}}},Ii=he(Di,[["__scopeId","data-v-10700524"]]),xi={class:"climate-form"},Ti={class:"learning-mode-section"},Mi={class:"mode-toggle"},Ri={class:"mode-content"},Li={class:"mode-stats"},Ai={class:"stat-badge"},Oi={class:"stat-badge time"},Vi={class:"mode-content"},Ei={class:"mode-stats"},Ui={class:"stat-badge"},Pi={class:"stat-badge time warning"},ji={key:0,class:"command-breakdown"},Fi={class:"warning-text"},Ni={class:"form-section"},Bi={key:0,class:"help-text"},qi={key:1,class:"help-text"},Hi={class:"form-row"},zi={class:"form-group"},Ji={class:"form-group"},Wi={class:"form-group"},Ki={key:2,class:"representative-temp-section"},Xi={class:"form-group"},Gi=["value"],Yi={class:"form-section"},Zi={class:"checkbox-grid"},Qi={class:"checkbox-item"},er={class:"checkbox-item"},tr={class:"checkbox-item"},or={class:"checkbox-item"},lr={class:"checkbox-item"},nr={class:"checkbox-item"},sr={class:"form-section"},ar={class:"checkbox-grid"},ir={class:"checkbox-item"},rr={class:"checkbox-item"},dr={class:"checkbox-item"},ur={class:"checkbox-item"},cr={class:"form-section"},mr={class:"checkbox-grid"},vr={class:"checkbox-item"},pr={class:"checkbox-item"},fr={class:"checkbox-item"},gr={class:"checkbox-item"},yr={class:"form-section"},br={class:"form-group"},hr={class:"form-group"},kr={class:"form-group"},wr={key:0,class:"validation-summary"},$r={__name:"ClimateProfileForm",props:{modelValue:{type:Object,default:()=>({})}},emits:["update:modelValue"],setup(o,{emit:c}){const r=o,k=c,w=y("quick"),s=y({minTemp:16,maxTemp:30,precision:1,representativeTemp:24,modes:["off","auto","cool","heat"],fanModes:["auto","low","medium","high"],swingModes:[],tempSensor:"",humiditySensor:"",powerSensor:"",learningMode:"quick",...r.modelValue}),m=z(()=>{const R=[],i=s.value.minTemp||16,f=s.value.maxTemp||30,p=s.value.precision||1;for(let M=i;M<=f;M+=p)R.push(M);return R}),v=z(()=>s.value.modes.filter(R=>R!=="off").length),_=z(()=>s.value.fanModes.length||1),D=z(()=>s.value.swingModes.length||1),V=z(()=>{const R=s.value.minTemp||16,i=s.value.maxTemp||30,f=s.value.precision||1;return Math.floor((i-R)/f)+1}),b=z(()=>{const R=s.value.modes.includes("off")?1:0;return v.value*_.value*D.value+R}),t=z(()=>Math.ceil(b.value*30/60)),A=z(()=>{const R=s.value.modes.includes("off")?1:0;return v.value*V.value*_.value*D.value+R}),q=z(()=>Math.ceil(A.value*30/60)),E=z(()=>{const R=[];return(!s.value.minTemp||s.value.minTemp<10||s.value.minTemp>35)&&R.push("Minimum temperature must be between 10°C and 35°C"),(!s.value.maxTemp||s.value.maxTemp<10||s.value.maxTemp>35)&&R.push("Maximum temperature must be between 10°C and 35°C"),s.value.minTemp>=s.value.maxTemp&&R.push("Minimum temperature must be less than maximum temperature"),(!s.value.modes||s.value.modes.length===0)&&R.push("At least one HVAC mode must be selected"),R});return ue(w,R=>{s.value.learningMode=R}),ue(s,R=>{k("update:modelValue",R)},{deep:!0,immediate:!0}),(R,i)=>(n(),a("div",xi,[i[63]||(i[63]=e("h3",null,"Climate Device Configuration",-1)),e("div",Ti,[e("div",Mi,[e("label",{class:Y(["mode-option",{active:w.value==="quick"}])},[J(e("input",{type:"radio",value:"quick","onUpdate:modelValue":i[0]||(i[0]=f=>w.value=f)},null,512),[[Pe,w.value]]),e("div",Ri,[i[23]||(i[23]=e("div",{class:"mode-header"},[e("i",{class:"mdi mdi-flash"}),e("strong",null,"Quick Mode (Recommended)")],-1)),i[24]||(i[24]=e("p",null,"Learn one temperature per mode combination",-1)),e("div",Li,[e("span",Ai,u(b.value)+" commands",1),e("span",Oi,"~"+u(t.value)+" min",1)])])],2),e("label",{class:Y(["mode-option",{active:w.value==="complete"}])},[J(e("input",{type:"radio",value:"complete","onUpdate:modelValue":i[1]||(i[1]=f=>w.value=f)},null,512),[[Pe,w.value]]),e("div",Vi,[i[25]||(i[25]=e("div",{class:"mode-header"},[e("i",{class:"mdi mdi-check-all"}),e("strong",null,"Complete Mode")],-1)),i[26]||(i[26]=e("p",null,"Learn all temperature combinations",-1)),e("div",Ei,[e("span",Ui,u(A.value)+" commands",1),e("span",Pi,"~"+u(q.value)+" min",1)])])],2)]),w.value==="complete"?(n(),a("div",ji,[i[27]||(i[27]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[e("strong",null,"Complete mode will require learning "+u(A.value)+" commands",1),e("p",null,"This includes all combinations of modes ("+u(v.value)+"), temperatures ("+u(V.value)+"), fan speeds ("+u(_.value)+"), and swing modes ("+u(D.value)+").",1),e("p",Fi,"⏱️ Estimated time: "+u(q.value)+" minutes at ~30 seconds per command",1)])])):T("",!0)]),e("div",Ni,[i[33]||(i[33]=e("h4",null,"Temperature Range",-1)),w.value==="quick"?(n(),a("p",Bi," Define the full temperature range your device supports. You'll select one temperature to learn below. ")):(n(),a("p",qi," Define the temperature range. All temperatures in this range will be learned. ")),e("div",Hi,[e("div",zi,[i[28]||(i[28]=e("label",null,"Minimum Temperature (°C) *",-1)),J(e("input",{"onUpdate:modelValue":i[2]||(i[2]=f=>s.value.minTemp=f),type:"number",min:"10",max:"35",placeholder:"16"},null,512),[[De,s.value.minTemp,void 0,{number:!0}]])]),e("div",Ji,[i[29]||(i[29]=e("label",null,"Maximum Temperature (°C) *",-1)),J(e("input",{"onUpdate:modelValue":i[3]||(i[3]=f=>s.value.maxTemp=f),type:"number",min:"10",max:"35",placeholder:"30"},null,512),[[De,s.value.maxTemp,void 0,{number:!0}]])]),e("div",Wi,[i[31]||(i[31]=e("label",null,"Precision",-1)),J(e("select",{"onUpdate:modelValue":i[4]||(i[4]=f=>s.value.precision=f)},[...i[30]||(i[30]=[e("option",{value:1},"1°C (Whole degrees)",-1),e("option",{value:.5},"0.5°C (Half degrees)",-1)])],512),[[ke,s.value.precision,void 0,{number:!0}]])])]),w.value==="quick"?(n(),a("div",Ki,[e("div",Xi,[i[32]||(i[32]=e("label",null,"Representative Temperature to Learn *",-1)),J(e("select",{"onUpdate:modelValue":i[5]||(i[5]=f=>s.value.representativeTemp=f)},[(n(!0),a(me,null,be(m.value,f=>(n(),a("option",{key:f,value:f},u(f)+"°C ",9,Gi))),128))],512),[[ke,s.value.representativeTemp,void 0,{number:!0}]]),e("small",null,"This temperature will be learned for all mode combinations. The device profile will still show the full range ("+u(s.value.minTemp)+"°C - "+u(s.value.maxTemp)+"°C).",1)])])):T("",!0)]),e("div",Yi,[i[40]||(i[40]=e("h4",null,"Supported HVAC Modes *",-1)),i[41]||(i[41]=e("p",{class:"help-text"},"Select all modes your device supports",-1)),e("div",Zi,[e("label",Qi,[J(e("input",{type:"checkbox",value:"off","onUpdate:modelValue":i[6]||(i[6]=f=>s.value.modes=f)},null,512),[[ve,s.value.modes]]),i[34]||(i[34]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),S(" Off ")],-1))]),e("label",er,[J(e("input",{type:"checkbox",value:"auto","onUpdate:modelValue":i[7]||(i[7]=f=>s.value.modes=f)},null,512),[[ve,s.value.modes]]),i[35]||(i[35]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-autorenew"}),S(" Auto ")],-1))]),e("label",tr,[J(e("input",{type:"checkbox",value:"cool","onUpdate:modelValue":i[8]||(i[8]=f=>s.value.modes=f)},null,512),[[ve,s.value.modes]]),i[36]||(i[36]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-snowflake"}),S(" Cool ")],-1))]),e("label",or,[J(e("input",{type:"checkbox",value:"heat","onUpdate:modelValue":i[9]||(i[9]=f=>s.value.modes=f)},null,512),[[ve,s.value.modes]]),i[37]||(i[37]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fire"}),S(" Heat ")],-1))]),e("label",lr,[J(e("input",{type:"checkbox",value:"dry","onUpdate:modelValue":i[10]||(i[10]=f=>s.value.modes=f)},null,512),[[ve,s.value.modes]]),i[38]||(i[38]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-water-percent"}),S(" Dry ")],-1))]),e("label",nr,[J(e("input",{type:"checkbox",value:"fan_only","onUpdate:modelValue":i[11]||(i[11]=f=>s.value.modes=f)},null,512),[[ve,s.value.modes]]),i[39]||(i[39]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan"}),S(" Fan Only ")],-1))])])]),e("div",sr,[i[46]||(i[46]=e("h4",null,"Fan Modes",-1)),i[47]||(i[47]=e("p",{class:"help-text"},"Select all fan speeds your device supports",-1)),e("div",ar,[e("label",ir,[J(e("input",{type:"checkbox",value:"auto","onUpdate:modelValue":i[12]||(i[12]=f=>s.value.fanModes=f)},null,512),[[ve,s.value.fanModes]]),i[42]||(i[42]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-autorenew"}),S(" Auto ")],-1))]),e("label",rr,[J(e("input",{type:"checkbox",value:"low","onUpdate:modelValue":i[13]||(i[13]=f=>s.value.fanModes=f)},null,512),[[ve,s.value.fanModes]]),i[43]||(i[43]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-1"}),S(" Low ")],-1))]),e("label",dr,[J(e("input",{type:"checkbox",value:"medium","onUpdate:modelValue":i[14]||(i[14]=f=>s.value.fanModes=f)},null,512),[[ve,s.value.fanModes]]),i[44]||(i[44]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-2"}),S(" Medium ")],-1))]),e("label",ur,[J(e("input",{type:"checkbox",value:"high","onUpdate:modelValue":i[15]||(i[15]=f=>s.value.fanModes=f)},null,512),[[ve,s.value.fanModes]]),i[45]||(i[45]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-3"}),S(" High ")],-1))])])]),e("div",cr,[i[52]||(i[52]=e("h4",null,"Swing Modes (Optional)",-1)),i[53]||(i[53]=e("p",{class:"help-text"},"Select if your device has swing/oscillation",-1)),e("div",mr,[e("label",vr,[J(e("input",{type:"checkbox",value:"off","onUpdate:modelValue":i[16]||(i[16]=f=>s.value.swingModes=f)},null,512),[[ve,s.value.swingModes]]),i[48]||(i[48]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-horizontal"}),S(" Off ")],-1))]),e("label",pr,[J(e("input",{type:"checkbox",value:"vertical","onUpdate:modelValue":i[17]||(i[17]=f=>s.value.swingModes=f)},null,512),[[ve,s.value.swingModes]]),i[49]||(i[49]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-vertical"}),S(" Vertical ")],-1))]),e("label",fr,[J(e("input",{type:"checkbox",value:"horizontal","onUpdate:modelValue":i[18]||(i[18]=f=>s.value.swingModes=f)},null,512),[[ve,s.value.swingModes]]),i[50]||(i[50]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-horizontal"}),S(" Horizontal ")],-1))]),e("label",gr,[J(e("input",{type:"checkbox",value:"both","onUpdate:modelValue":i[19]||(i[19]=f=>s.value.swingModes=f)},null,512),[[ve,s.value.swingModes]]),i[51]||(i[51]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-arrow-all"}),S(" Both ")],-1))])])]),e("div",yr,[i[60]||(i[60]=e("h4",null,"Sensors (Optional)",-1)),i[61]||(i[61]=e("p",{class:"help-text"},"Link external sensors for better climate control",-1)),e("div",br,[i[54]||(i[54]=e("label",null,"Temperature Sensor",-1)),J(e("input",{"onUpdate:modelValue":i[20]||(i[20]=f=>s.value.tempSensor=f),type:"text",placeholder:"sensor.living_room_temperature"},null,512),[[De,s.value.tempSensor]]),i[55]||(i[55]=e("small",null,"Entity ID of temperature sensor",-1))]),e("div",hr,[i[56]||(i[56]=e("label",null,"Humidity Sensor",-1)),J(e("input",{"onUpdate:modelValue":i[21]||(i[21]=f=>s.value.humiditySensor=f),type:"text",placeholder:"sensor.living_room_humidity"},null,512),[[De,s.value.humiditySensor]]),i[57]||(i[57]=e("small",null,"Entity ID of humidity sensor",-1))]),e("div",kr,[i[58]||(i[58]=e("label",null,"Power Sensor",-1)),J(e("input",{"onUpdate:modelValue":i[22]||(i[22]=f=>s.value.powerSensor=f),type:"text",placeholder:"binary_sensor.ac_power"},null,512),[[De,s.value.powerSensor]]),i[59]||(i[59]=e("small",null,"Entity ID of power sensor (to detect on/off state)",-1))])]),E.value.length>0?(n(),a("div",wr,[i[62]||(i[62]=e("h4",null,[e("i",{class:"mdi mdi-alert-circle"}),S(" Please fix the following: ")],-1)),e("ul",null,[(n(!0),a(me,null,be(E.value,(f,p)=>(n(),a("li",{key:p},u(f),1))),128))])])):T("",!0)]))}},Cr=he($r,[["__scopeId","data-v-5674f3f7"]]),_r={class:"command-wizard"},Sr={class:"device-selection-section"},Dr={class:"input-wrapper"},Ir=["value"],xr={key:0,class:"validation-tooltip"},Tr={class:"form-group"},Mr=["disabled"],Rr={key:0},Lr={key:1},Ar={key:0,class:"edit-mode-banner"},Or={class:"wizard-info"},Vr={key:0},Er={key:1},Ur={class:"progress-info"},Pr={class:"progress-bar"},jr={class:"progress-text"},Fr={class:"commands-grid"},Nr={class:"command-header"},Br={class:"command-icon"},qr={class:"command-info"},Hr={key:0,class:"learning-indicator"},zr={key:0,class:"ir-learning-steps"},Jr={key:1,class:"rf-learning-steps"},Wr={class:"command-actions"},Kr=["onClick","disabled"],Xr={key:1,class:"learned-status"},Gr=["onClick","disabled"],Yr=["onClick"],Zr={class:"quick-actions"},Qr=["disabled"],ed=["disabled"],td={__name:"CommandLearningWizard",props:{modelValue:{type:Object,default:()=>({})},platform:{type:String,required:!0},config:{type:Object,required:!0},broadlinkDevice:{type:String,default:""},manufacturer:{type:String,required:!0},model:{type:String,required:!0},commandType:{type:String,default:"ir"}},emits:["update:modelValue","update:broadlinkDevice","update:commandType"],setup(o,{emit:c}){const r=Ve(),k=o,w=c,s=y({...k.modelValue}),m=y(null),v=y(null),_=y([]),D=y(k.broadlinkDevice),V=y(k.commandType),b=y(!1),t=y([]),A=y(!1),q=y(!1),E=y({show:!1,commandKey:null,commandLabel:""}),R=y(!1),i=z(()=>{const I=[];if(k.platform==="climate"){const d=k.config.modes||[],U=k.config.fanModes||[],H=k.config.minTemp||16,g=k.config.maxTemp||30;d.forEach($=>{if($==="off")I.push({key:"off",label:"Power Off",description:"Turn device off",icon:"mdi mdi-power",mode:"off"});else for(let N=H;N<=g;N++)U.forEach(oe=>{const ae=`${$}_${N}_${oe}`;I.push({key:ae,label:`${$.toUpperCase()} ${N}°C ${oe}`,description:`Mode: ${$}, Temp: ${N}°C, Fan: ${oe}`,icon:G($),mode:$,temp:N,fanMode:oe})})})}else if(k.platform==="media_player"){const d=k.config.features||[];d.includes("turn_on")&&(I.push({key:"turn_on",label:"Power On",description:"Turn on the device",icon:"mdi mdi-power"}),I.push({key:"turn_off",label:"Power Off",description:"Turn off the device",icon:"mdi mdi-power-off"})),d.includes("volume")&&(I.push({key:"volume_up",label:"Volume Up",description:"Increase volume",icon:"mdi mdi-volume-plus"}),I.push({key:"volume_down",label:"Volume Down",description:"Decrease volume",icon:"mdi mdi-volume-minus"})),d.includes("mute")&&I.push({key:"mute",label:"Mute",description:"Toggle mute",icon:"mdi mdi-volume-mute"}),d.includes("source")&&(I.push({key:"source_hdmi1",label:"Source: HDMI 1",description:"Switch to HDMI 1",icon:"mdi mdi-import"}),I.push({key:"source_hdmi2",label:"Source: HDMI 2",description:"Switch to HDMI 2",icon:"mdi mdi-import"}),I.push({key:"source_hdmi3",label:"Source: HDMI 3",description:"Switch to HDMI 3",icon:"mdi mdi-import"})),d.includes("channel")&&(I.push({key:"channel_up",label:"Channel Up",description:"Next channel",icon:"mdi mdi-chevron-up"}),I.push({key:"channel_down",label:"Channel Down",description:"Previous channel",icon:"mdi mdi-chevron-down"}))}else if(k.platform==="fan"){const d=k.config.speedLevels||3,U=k.config.features||[];I.push({key:"turn_on",label:"Power On",description:"Turn on the fan",icon:"mdi mdi-power"}),I.push({key:"turn_off",label:"Power Off",description:"Turn off the fan",icon:"mdi mdi-power-off"});for(let H=1;H<=d;H++){const g=H===1?"Low":H===d?"High":H===2&&d===3?"Medium":`Speed ${H}`;I.push({key:`speed_${H}`,label:`${g}`,description:`Set fan to speed level ${H}`,icon:"mdi mdi-fan"})}U.includes("oscillate")&&(I.push({key:"oscillate_on",label:"Oscillate On",description:"Enable oscillation",icon:"mdi mdi-sync"}),I.push({key:"oscillate_off",label:"Oscillate Off",description:"Disable oscillation",icon:"mdi mdi-sync-off"})),U.includes("direction")&&(I.push({key:"direction_forward",label:"Direction: Forward",description:"Set direction to forward",icon:"mdi mdi-rotate-right"}),I.push({key:"direction_reverse",label:"Direction: Reverse",description:"Set direction to reverse",icon:"mdi mdi-rotate-left"}))}else if(k.platform==="light"){const d=k.config.features||[];d.includes("turn_on")&&(I.push({key:"turn_on",label:"Power On",description:"Turn on the light",icon:"mdi mdi-lightbulb-on"}),I.push({key:"turn_off",label:"Power Off",description:"Turn off the light",icon:"mdi mdi-lightbulb-off"})),d.includes("brightness")&&(I.push({key:"brightness_up",label:"Brightness Up",description:"Increase brightness",icon:"mdi mdi-brightness-7"}),I.push({key:"brightness_down",label:"Brightness Down",description:"Decrease brightness",icon:"mdi mdi-brightness-5"})),d.includes("color_temp")&&(I.push({key:"color_temp_warm",label:"Warm White",description:"Set to warm white",icon:"mdi mdi-weather-sunset"}),I.push({key:"color_temp_cool",label:"Cool White",description:"Set to cool white",icon:"mdi mdi-weather-sunny"})),d.includes("rgb")&&(I.push({key:"color_red",label:"Color: Red",description:"Set color to red",icon:"mdi mdi-palette"}),I.push({key:"color_green",label:"Color: Green",description:"Set color to green",icon:"mdi mdi-palette"}),I.push({key:"color_blue",label:"Color: Blue",description:"Set color to blue",icon:"mdi mdi-palette"}))}return I}),f=z(()=>i.value.length),p=z(()=>Object.keys(s.value).length),M=z(()=>f.value===0?0:Math.round(p.value/f.value*100));function G(I){return{off:"mdi mdi-power",auto:"mdi mdi-autorenew",cool:"mdi mdi-snowflake",heat:"mdi mdi-fire",dry:"mdi mdi-water-percent",fan_only:"mdi mdi-fan"}[I]||"mdi mdi-remote"}async function ee(I){if(!m.value){if(!D.value){q.value=!0,window.scrollTo({top:0,behavior:"smooth"});return}q.value=!1,m.value=I.key;try{const d=k.manufacturer.toLowerCase().replace(/[^a-z0-9]+/g,"_"),U=k.model.toLowerCase().replace(/[^a-z0-9]+/g,"_"),H=`${d}_${U}`,$=(await le.post("/api/commands/learn",{entity_id:D.value,device:H,command:I.key,command_type:V.value})).data;if($.success&&$.code)s.value[I.key]=$.code,w("update:modelValue",s.value),A.value=!0,$.code==="pending"&&console.log(`⏳ Command '${I.key}' learned, code will be fetched from storage when saving`),b.value&&t.value.length>0&&setTimeout(()=>{const N=t.value.shift();N?ee(N):b.value=!1},1e3);else throw new Error($.error||"Failed to learn command")}catch(d){console.error("Error learning command:",d),r.error(`Error learning command: ${d.message}`),b.value=!1,t.value=[]}finally{b.value||(m.value=null)}}}async function te(I){var d;if(!D.value){q.value=!0,window.scrollTo({top:0,behavior:"smooth"});return}if(!s.value[I]){(d=r.value)==null||d.error("Command not learned yet");return}v.value=I;try{const U=s.value[I];await le.post("/api/commands/send-raw",{entity_id:D.value,command:U,command_type:V.value}),r.success("Command sent successfully")}catch(U){console.error("Error testing command:",U),r.error(`Error testing command: ${U.message}`)}finally{v.value=null}}function se(I){const d=i.value.find(U=>U.key===I);E.value={show:!0,commandKey:I,commandLabel:d?d.label:I}}function L(){const I=E.value.commandKey;delete s.value[I],w("update:modelValue",s.value),E.value.show=!1}function B(){const I=i.value.filter(U=>!s.value[U.key]);if(I.length===0)return;b.value=!0,t.value=[...I];const d=t.value.shift();d&&ee(d)}function Z(){R.value=!0}function ce(){s.value={},w("update:modelValue",s.value),R.value=!1}ue(()=>k.modelValue,I=>{s.value={...I}},{deep:!0}),xe(async()=>{await ye()});async function ye(){try{console.log("SmartIR device - commands will be loaded from SmartIR JSON file, not Broadlink storage")}catch(I){console.error("Error in loadExistingCommands:",I)}}function Ie(){w("update:broadlinkDevice",D.value)}function we(){w("update:commandType",V.value)}async function $e(){try{console.log("🔍 Loading Broadlink devices from /api/remote/devices");const I=await le.get("/api/remote/devices");console.log("📦 Response data:",I.data);const d=I.data.devices||[];console.log(`✅ Found ${d.length} devices:`,d),_.value=d}catch(I){console.error("❌ Error loading remote devices:",I),_.value=[]}}return ue(()=>k.broadlinkDevice,I=>{D.value=I}),ue(D,I=>{I&&(q.value=!1)}),ue(()=>k.commandType,I=>{V.value=I}),xe(async()=>{await $e(),await ye()}),(I,d)=>(n(),a("div",_r,[d[22]||(d[22]=e("h3",null,"Learn IR Commands",-1)),e("div",Sr,[e("div",{class:Y(["form-group",{"has-error":q.value}])},[d[6]||(d[6]=e("label",null,"Broadlink Device *",-1)),e("div",Dr,[J(e("select",{"onUpdate:modelValue":d[0]||(d[0]=U=>D.value=U),onChange:Ie},[d[4]||(d[4]=e("option",{value:""},"Select Broadlink device...",-1)),(n(!0),a(me,null,be(_.value,U=>(n(),a("option",{key:U.entity_id,value:U.entity_id},u(U.name||U.entity_id),9,Ir))),128))],544),[[ke,D.value]]),q.value?(n(),a("div",xr,[...d[5]||(d[5]=[e("i",{class:"mdi mdi-alert"},null,-1),S(" Device is required ",-1)])])):T("",!0)]),e("small",null,"This device will be used to learn commands ("+u(_.value.length)+" devices found)",1)],2),e("div",Tr,[d[8]||(d[8]=e("label",null,"Command Type *",-1)),J(e("select",{"onUpdate:modelValue":d[1]||(d[1]=U=>V.value=U),onChange:we,disabled:p.value>0},[...d[7]||(d[7]=[e("option",{value:"ir"},"📡 Infrared (IR) - Most common for AC, TV, etc.",-1),e("option",{value:"rf"},"📻 Radio Frequency (RF) - For RF remotes",-1)])],40,Mr),[[ke,V.value]]),p.value>0?(n(),a("small",Rr,"Command type cannot be changed after learning commands")):(n(),a("small",Lr,"Select the type of commands your device uses"))])]),p.value>0&&!A.value?(n(),a("div",Ar,[d[10]||(d[10]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[d[9]||(d[9]=e("strong",null,"Editing Existing Profile",-1)),e("p",null,u(p.value)+" command"+u(p.value!==1?"s":"")+' already learned. You can re-learn any command by clicking the delete icon and then "Learn Command".',1)])])):T("",!0),e("div",Or,[d[14]||(d[14]=e("i",{class:"mdi mdi-information"},null,-1)),e("div",null,[d[13]||(d[13]=e("p",null,[e("strong",null,"How it works:")],-1)),o.commandType==="ir"?(n(),a("ol",Vr,[...d[11]||(d[11]=[e("li",null,'Click "Learn Command" for each combination',-1),e("li",null,[e("strong",null,"Point your IR remote directly at the Broadlink device")],-1),e("li",null,"Press the button on your remote",-1),e("li",null,"Wait for confirmation (up to 30 seconds)",-1)])])):(n(),a("ol",Er,[...d[12]||(d[12]=[e("li",null,'Click "Learn Command" for each combination',-1),e("li",null,[e("strong",null,"Step 1:"),S(" Hold button on remote - Broadlink scans for RF frequency")],-1),e("li",null,[e("strong",null,"Step 2:"),S(" Watch for Home Assistant notification, then press and release button")],-1),e("li",null,"Keep remote within 5cm of Broadlink (RF doesn't need line-of-sight)",-1),e("li",null,"Wait for confirmation (may take up to 30 seconds)",-1)])]))])]),e("div",Ur,[e("div",Pr,[e("div",{class:"progress-fill",style:ot({width:M.value+"%"})},null,4)]),e("span",jr,u(p.value)+" / "+u(f.value)+" commands learned ("+u(M.value)+"%) ",1)]),e("div",Fr,[(n(!0),a(me,null,be(i.value,U=>(n(),a("div",{key:U.key,class:Y(["command-card",{learned:s.value[U.key],learning:m.value===U.key}])},[e("div",Nr,[e("div",Br,[e("i",{class:Y(U.icon)},null,2)]),e("div",qr,[e("h4",null,u(U.label),1),e("p",null,u(U.description),1)])]),m.value===U.key?(n(),a("div",Hr,[o.commandType==="ir"?(n(),a("div",zr,[...d[15]||(d[15]=[e("p",null,[e("strong",null,"Point your remote directly at the Broadlink device and press the button.")],-1),e("small",null,"Listening for up to 30 seconds...",-1)])])):(n(),a("div",Jr,[...d[16]||(d[16]=[e("p",{class:"rf-title"},[e("strong",null,"Learning request sent to device.")],-1),e("p",{class:"rf-subtitle"},[S("RF learning is a "),e("strong",null,"two-step process"),S(":")],-1),e("ol",null,[e("li",null,[e("strong",null,"Step 1 - Frequency Sweep (~10-15 seconds):"),S(" Press and hold the button on your remote until the notification updates. ")]),e("li",null,[e("strong",null,"Step 2 - Learn Signal:"),S(" Press and release the button once. ")])],-1),e("p",{class:"rf-note"},"Follow the Home Assistant notifications (🔔) for real-time instructions.",-1)])]))])):T("",!0),e("div",Wr,[s.value[U.key]?(n(),a("div",Xr,[d[18]||(d[18]=e("i",{class:"mdi mdi-check-circle"},null,-1)),d[19]||(d[19]=e("span",null,"Learned",-1)),e("span",{class:Y(["command-type-badge",V.value])},u(V.value.toUpperCase()),3),e("button",{onClick:H=>te(U.key),class:"icon-btn",title:"Test command",disabled:v.value===U.key,style:{"margin-left":"auto"}},[e("i",{class:Y(["mdi mdi-play",{"mdi-spin":v.value===U.key}])},null,2)],8,Gr),e("button",{onClick:H=>se(U.key),class:"icon-btn danger",title:"Delete and re-learn"},[...d[17]||(d[17]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,Yr)])):(n(),a("button",{key:0,onClick:H=>ee(U),class:Y(["btn-learn",{learning:m.value===U.key}]),disabled:m.value!==null},[e("i",{class:Y(["mdi mdi-radio-tower",{"mdi-spin":m.value===U.key}])},null,2),S(" "+u(m.value===U.key?"Listening...":"Learn Command"),1)],10,Kr))])],2))),128))]),e("div",Zr,[e("button",{onClick:B,class:"btn-secondary",disabled:m.value!==null||p.value===f.value},[...d[20]||(d[20]=[e("i",{class:"mdi mdi-play-circle"},null,-1),S(" Learn All Remaining ",-1)])],8,Qr),e("button",{onClick:Z,class:"btn-text",disabled:p.value===0},[...d[21]||(d[21]=[e("i",{class:"mdi mdi-delete-sweep"},null,-1),S(" Clear All ",-1)])],8,ed)]),fe(Re,{isOpen:E.value.show,title:"Delete Learned Command?",message:`Are you sure you want to delete the '${E.value.commandLabel}' command?

You will need to re-learn this command.`,confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,onConfirm:L,onCancel:d[2]||(d[2]=U=>E.value.show=!1)},null,8,["isOpen","message"]),fe(Re,{isOpen:R.value,title:"Delete All Learned Commands?",message:"Are you sure you want to delete all learned commands? This cannot be undone.\\n\\nYou will need to re-learn all commands.",confirmText:"Delete All",cancelText:"Cancel",dangerMode:!0,onConfirm:ce,onCancel:d[3]||(d[3]=U=>R.value=!1)},null,8,["isOpen"])]))}},od=he(td,[["__scopeId","data-v-84fe090b"]]),ld={class:"profile-preview"},nd={class:"preview-summary"},sd={class:"summary-card"},ad={class:"stats-grid"},id={class:"stat-item"},rd={class:"stat-value"},dd={class:"stat-item"},ud={class:"stat-value"},cd={class:"stat-item"},md={class:"stat-value"},vd={class:"preview-tabs"},pd={class:"preview-content"},fd={key:0,class:"tab-content"},gd={class:"code-header"},yd={class:"code-block"},bd={key:1,class:"tab-content"},hd={class:"code-header"},kd={class:"code-block"},wd={key:2,class:"tab-content"},$d={class:"instructions"},Cd={class:"step-item"},_d={class:"step-content"},Sd={class:"code-path"},Dd={__name:"ProfilePreview",props:{profile:{type:Object,required:!0},jsonData:{type:Object,required:!0},yamlConfig:{type:String,required:!0}},setup(o){const c=Ve(),r=o,k=y("json"),w=y(!1),s=y(!1),m=z(()=>Object.keys(r.profile.commands||{}).length),v=z(()=>JSON.stringify(r.jsonData,null,2));async function _(){try{await navigator.clipboard.writeText(v.value),w.value=!0,setTimeout(()=>{w.value=!1},2e3)}catch(V){console.error("Failed to copy JSON:",V),c.error("Failed to copy to clipboard")}}async function D(){try{await navigator.clipboard.writeText(r.yamlConfig),s.value=!0,setTimeout(()=>{s.value=!1},2e3)}catch(V){console.error("Failed to copy YAML:",V),c.error("Failed to copy to clipboard")}}return(V,b)=>{var t;return n(),a("div",ld,[b[22]||(b[22]=e("h3",null,"Preview & Save",-1)),e("div",nd,[e("div",sd,[b[4]||(b[4]=e("i",{class:"mdi mdi-check-circle"},null,-1)),e("div",null,[b[3]||(b[3]=e("h4",null,"Profile Ready!",-1)),e("p",null,u(o.profile.manufacturer)+" "+u(o.profile.model),1)])]),e("div",ad,[e("div",id,[e("span",rd,u(m.value),1),b[5]||(b[5]=e("span",{class:"stat-label"},"Commands Learned",-1))]),e("div",dd,[e("span",ud,u(o.profile.platform),1),b[6]||(b[6]=e("span",{class:"stat-label"},"Platform",-1))]),e("div",cd,[e("span",md,u(((t=o.profile.config.modes)==null?void 0:t.length)||0),1),b[7]||(b[7]=e("span",{class:"stat-label"},"HVAC Modes",-1))])])]),e("div",vd,[e("button",{onClick:b[0]||(b[0]=A=>k.value="json"),class:Y(["tab-button",{active:k.value==="json"}])},[...b[8]||(b[8]=[e("i",{class:"mdi mdi-code-json"},null,-1),S(" SmartIR JSON ",-1)])],2),e("button",{onClick:b[1]||(b[1]=A=>k.value="yaml"),class:Y(["tab-button",{active:k.value==="yaml"}])},[...b[9]||(b[9]=[e("i",{class:"mdi mdi-file-code"},null,-1),S(" YAML Config ",-1)])],2),e("button",{onClick:b[2]||(b[2]=A=>k.value="instructions"),class:Y(["tab-button",{active:k.value==="instructions"}])},[...b[10]||(b[10]=[e("i",{class:"mdi mdi-information"},null,-1),S(" Instructions ",-1)])],2)]),e("div",pd,[k.value==="json"?(n(),a("div",fd,[e("div",gd,[b[12]||(b[12]=e("h4",null,"SmartIR Device Code JSON",-1)),e("button",{onClick:_,class:"btn-copy"},[b[11]||(b[11]=e("i",{class:"mdi mdi-content-copy"},null,-1)),S(" "+u(w.value?"Copied!":"Copy"),1)])]),e("pre",yd,[e("code",null,u(v.value),1)]),b[13]||(b[13]=e("p",{class:"code-note"},[e("i",{class:"mdi mdi-information"}),S(" Save this as "),e("code",null,"10000.json"),S(" in your SmartIR codes directory ")],-1))])):T("",!0),k.value==="yaml"?(n(),a("div",bd,[e("div",hd,[b[15]||(b[15]=e("h4",null,"Home Assistant Configuration",-1)),e("button",{onClick:D,class:"btn-copy"},[b[14]||(b[14]=e("i",{class:"mdi mdi-content-copy"},null,-1)),S(" "+u(s.value?"Copied!":"Copy"),1)])]),e("pre",kd,[e("code",null,u(o.yamlConfig),1)]),b[16]||(b[16]=e("p",{class:"code-note"},[e("i",{class:"mdi mdi-information"}),S(" Add this to your "),e("code",null,"configuration.yaml"),S(" file ")],-1))])):T("",!0),k.value==="instructions"?(n(),a("div",wd,[e("div",$d,[b[20]||(b[20]=e("h4",null,"Installation Steps",-1)),e("div",Cd,[b[19]||(b[19]=e("div",{class:"step-number"},"1",-1)),e("div",_d,[b[17]||(b[17]=e("h5",null,"Get Next Code Number",-1)),b[18]||(b[18]=e("p",null,"Custom device codes start at 10000. Check your SmartIR codes directory to find the next available number.",-1)),e("div",Sd,[e("code",null,"/config/custom_components/smartir/codes/"+u(o.profile.platform)+"/",1)])])]),b[21]||(b[21]=Ae('<div class="step-item" data-v-cbf0874d><div class="step-number" data-v-cbf0874d>2</div><div class="step-content" data-v-cbf0874d><h5 data-v-cbf0874d>Save JSON File</h5><p data-v-cbf0874d>Copy the JSON from the &quot;SmartIR JSON&quot; tab and save it as <code data-v-cbf0874d>10000.json</code> (or your next available number) in the codes directory.</p></div></div><div class="step-item" data-v-cbf0874d><div class="step-number" data-v-cbf0874d>3</div><div class="step-content" data-v-cbf0874d><h5 data-v-cbf0874d>Update Configuration</h5><p data-v-cbf0874d>Copy the YAML from the &quot;YAML Config&quot; tab and add it to your <code data-v-cbf0874d>configuration.yaml</code> file. Update the <code data-v-cbf0874d>device_code</code> to match your JSON filename.</p></div></div><div class="step-item" data-v-cbf0874d><div class="step-number" data-v-cbf0874d>4</div><div class="step-content" data-v-cbf0874d><h5 data-v-cbf0874d>Restart Home Assistant</h5><p data-v-cbf0874d>Restart Home Assistant to load the new configuration. Your climate entity will appear in the UI.</p></div></div><div class="step-item" data-v-cbf0874d><div class="step-number" data-v-cbf0874d>5</div><div class="step-content" data-v-cbf0874d><h5 data-v-cbf0874d>Test Your Device</h5><p data-v-cbf0874d>Go to your climate entity and test different modes, temperatures, and fan speeds to ensure everything works correctly.</p></div></div><div class="tips-section" data-v-cbf0874d><h4 data-v-cbf0874d><i class="mdi mdi-lightbulb" data-v-cbf0874d></i> Tips </h4><ul data-v-cbf0874d><li data-v-cbf0874d>Keep a backup of your JSON file in case you need to modify it</li><li data-v-cbf0874d>Test all commands to ensure they work as expected</li><li data-v-cbf0874d>You can share your profile with the SmartIR community on GitHub</li><li data-v-cbf0874d>If a command doesn&#39;t work, you can re-learn it and update the JSON</li></ul></div>',5))])])):T("",!0)])])}}},Id=he(Dd,[["__scopeId","data-v-cbf0874d"]]),xd={class:"wizard-body"},Td={key:0,class:"warning-section"},Md={class:"warning-box"},Rd={class:"instructions"},Ld={class:"code-block"},Ad={class:"steps"},Od={key:0},Vd={class:"help-section"},Ed={key:0,class:"help-content"},Ud={class:"help-step"},Pd={key:0,class:"help-step"},jd={class:"help-step"},Fd={class:"help-step"},Nd={class:"checklist"},Bd={class:"checkbox-label"},qd={key:0,class:"checkbox-label"},Hd={class:"wizard-footer"},zd=["disabled"],Jd={__name:"SmartIRSetupWizard",props:{show:{type:Boolean,default:!1},platform:{type:String,required:!0},warnings:{type:Array,default:()=>[]},configPath:{type:String,default:"/config"}},emits:["close","complete"],setup(o,{emit:c}){const r=o,k=c,w=Se("toast"),s=y(!1),m=y(!1),v=y(!1),_=z(()=>r.warnings.length>0?s.value&&m.value:s.value);function D(){const b=`${r.platform}: !include smartir/${r.platform}.yaml`;navigator.clipboard.writeText(b).then(()=>{var t;(t=w.value)==null||t.success("Include line copied to clipboard!","✅ Copied")}).catch(t=>{var A;console.error("Failed to copy:",t),(A=w.value)==null||A.error("Failed to copy to clipboard","❌ Copy Failed")})}function V(){k("complete")}return(b,t)=>o.show?(n(),a("div",{key:0,class:"modal-overlay",onClick:t[5]||(t[5]=pe(()=>{},["stop"]))},[e("div",{class:"setup-wizard",onClick:t[4]||(t[4]=pe(()=>{},["stop"]))},[t[31]||(t[31]=e("div",{class:"wizard-header"},[e("h2",null,[e("i",{class:"mdi mdi-cog"}),S(" SmartIR Configuration Setup ")])],-1)),e("div",xd,[o.warnings.length>0?(n(),a("div",Td,[e("div",Md,[t[11]||(t[11]=e("i",{class:"mdi mdi-alert"},null,-1)),e("div",null,[t[9]||(t[9]=e("h3",null,"⚠️ Configuration Migration Needed",-1)),t[10]||(t[10]=e("p",null,"We detected existing platform entries in your configuration.yaml:",-1)),e("ul",null,[(n(!0),a(me,null,be(o.warnings,A=>(n(),a("li",{key:A.platform},[e("strong",null,u(A.platform)+":",1),S(" "+u(A.message),1)]))),128))]),e("p",null,[t[6]||(t[6]=e("strong",null,"Action Required:",-1)),t[7]||(t[7]=S(" Move these entries to ",-1)),e("code",null,"smartir/"+u(o.platform)+".yaml",1),t[8]||(t[8]=S(" before continuing.",-1))])])])])):T("",!0),e("div",Rd,[t[27]||(t[27]=e("h3",null,"📝 One-Time Setup",-1)),t[28]||(t[28]=e("p",null,[S("To enable SmartIR device management, add this line to your "),e("code",null,"configuration.yaml"),S(":")],-1)),e("div",Ld,[e("code",null,u(o.platform)+": !include smartir/"+u(o.platform)+".yaml",1),e("button",{onClick:D,class:"copy-btn",title:"Copy to clipboard"},[...t[12]||(t[12]=[e("i",{class:"mdi mdi-content-copy"},null,-1)])])]),e("div",Ad,[t[19]||(t[19]=e("h4",null,"Steps:",-1)),e("ol",null,[o.warnings.length>0?(n(),a("li",Od,[t[13]||(t[13]=e("strong",null,"Move existing entries:",-1)),t[14]||(t[14]=S(" Copy any existing ",-1)),e("code",null,u(o.platform)+":",1),t[15]||(t[15]=S(" entries from configuration.yaml to ",-1)),e("code",null,"smartir/"+u(o.platform)+".yaml",1)])):T("",!0),t[16]||(t[16]=e("li",null,[e("strong",null,"Add include line:"),S(" Add the line above to your configuration.yaml ")],-1)),t[17]||(t[17]=e("li",null,[e("strong",null,"Save changes:"),S(" Save configuration.yaml ")],-1)),t[18]||(t[18]=e("li",null,[e("strong",null,"Continue here:"),S(` Click "I've Completed Setup" below `)],-1))])]),e("div",Vd,[e("button",{onClick:t[0]||(t[0]=A=>v.value=!v.value),class:"help-toggle"},[e("i",{class:Y(["mdi",v.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2),S(" "+u(v.value?"Hide":"Show")+" Detailed Instructions ",1)]),v.value?(n(),a("div",Ed,[t[26]||(t[26]=e("h4",null,"Detailed Setup Guide:",-1)),e("div",Ud,[t[21]||(t[21]=e("h5",null,"1. Open configuration.yaml",-1)),e("p",null,[t[20]||(t[20]=S("Location: ",-1)),e("code",null,u(o.configPath)+"/configuration.yaml",1)])]),o.warnings.length>0?(n(),a("div",Pd,[t[22]||(t[22]=e("h5",null,"2. Migrate Existing Entries (If Any)",-1)),e("p",null,"If you have existing "+u(o.platform)+" entries, cut them from configuration.yaml and paste into:",1),e("p",null,[e("code",null,u(o.configPath)+"/smartir/"+u(o.platform)+".yaml",1)]),t[23]||(t[23]=e("p",{class:"note"},"Broadlink Manager will create this file automatically.",-1))])):T("",!0),e("div",jd,[e("h5",null,u(o.warnings.length>0?"3":"2")+". Add Include Line",1),t[24]||(t[24]=e("p",null,"Add this to configuration.yaml:",-1)),e("pre",null,u(o.platform)+": !include smartir/"+u(o.platform)+".yaml",1)]),e("div",Fd,[e("h5",null,u(o.warnings.length>0?"4":"3")+". Restart Home Assistant",1),t[25]||(t[25]=e("p",null,"After saving, you'll need to restart HA for changes to take effect.",-1))])])):T("",!0)])]),e("div",Nd,[e("label",Bd,[J(e("input",{type:"checkbox","onUpdate:modelValue":t[1]||(t[1]=A=>s.value=A)},null,512),[[ve,s.value]]),t[29]||(t[29]=e("span",null,"I've added the include line to configuration.yaml",-1))]),o.warnings.length>0?(n(),a("label",qd,[J(e("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=A=>m.value=A)},null,512),[[ve,m.value]]),e("span",null,"I've migrated existing "+u(o.platform)+" entries (if any)",1)])):T("",!0)])]),e("div",Hd,[e("button",{onClick:t[3]||(t[3]=A=>b.$emit("close")),class:"btn-secondary"}," Cancel "),e("button",{onClick:V,class:"btn-primary",disabled:!_.value},[...t[30]||(t[30]=[e("i",{class:"mdi mdi-check"},null,-1),S(" I've Completed Setup ",-1)])],8,zd)])])])):T("",!0)}},Wd=he(Jd,[["__scopeId","data-v-f6fe4c03"]]),Kd={class:"modal-header"},Xd={class:"progress-steps"},Gd={class:"step-number"},Yd={key:0,class:"mdi mdi-check"},Zd={key:1},Qd={class:"step-label"},eu={class:"modal-body"},tu={key:0,class:"step-content"},ou={class:"form-group"},lu={class:"form-group"},nu={class:"form-group"},su={key:1,class:"step-content"},au={key:1,class:"platform-form"},iu={class:"form-section"},ru={class:"checkbox-grid"},du={class:"checkbox-item"},uu={class:"checkbox-item"},cu={class:"checkbox-item"},mu={class:"checkbox-item"},vu={class:"checkbox-item"},pu={key:2,class:"platform-form"},fu={class:"form-section"},gu={class:"form-group"},yu={class:"form-section"},bu={class:"checkbox-grid"},hu={class:"checkbox-item"},ku={class:"checkbox-item"},wu={key:3,class:"platform-form"},$u={class:"form-section"},Cu={class:"checkbox-grid"},_u={class:"checkbox-item"},Su={class:"checkbox-item"},Du={class:"checkbox-item"},Iu={class:"checkbox-item"},xu={key:2,class:"step-content"},Tu={key:3,class:"step-content"},Mu={class:"modal-footer"},Ru=["disabled"],Lu={key:2,class:"save-buttons"},Au=["disabled"],Ou=["disabled"],Vu={__name:"SmartIRProfileBuilder",props:{show:{type:Boolean,default:!1},editMode:{type:Boolean,default:!1},editData:{type:Object,default:null},startStep:{type:Number,default:0}},emits:["close","save"],setup(o,{emit:c}){const r=o,k=c,w=Se("toast"),s=y(0),m=y(!1),v=y([]),_=y(!1),D=y([]),V=y("/config"),b=y(!1),t=y(null),A=y(!1),q=y(!1),E=y(""),R=y("ir"),i=y(!1),f=[{label:"Device Info",key:"info"},{label:"Configuration",key:"config"},{label:"Learn Commands",key:"commands"},{label:"Preview & Save",key:"preview"}],p=y({platform:"",manufacturer:"",model:"",broadlinkDevice:"",commandType:"ir",config:{},commands:{}}),M=y(["turn_on"]),G=y(3),ee=y([]),te=y(["turn_on"]);ue(()=>p.value.platform,P=>{P==="media_player"?p.value.config={features:M.value}:P==="fan"?p.value.config={speedLevels:G.value,features:ee.value}:P==="light"&&(p.value.config={features:te.value})}),ue(M,P=>{p.value.platform==="media_player"&&(p.value.config={features:P})},{deep:!0}),ue(G,P=>{p.value.platform==="fan"&&(p.value.config={speedLevels:P,features:ee.value})}),ue(ee,P=>{p.value.platform==="fan"&&(p.value.config={speedLevels:G.value,features:P})},{deep:!0}),ue(te,P=>{p.value.platform==="light"&&(p.value.config={features:P})},{deep:!0});function se(P){const l=new Set,F=Object.keys(P);return F.some(C=>C==="off"||C.includes("_off"))&&l.add("off"),F.some(C=>C.includes("auto"))&&l.add("auto"),F.some(C=>C.includes("cool"))&&l.add("cool"),F.some(C=>C.includes("heat"))&&l.add("heat"),F.some(C=>C.includes("dry"))&&l.add("dry"),F.some(C=>C.includes("fan_only"))&&l.add("fan_only"),Array.from(l)}function L(P){const l=new Set,F=Object.keys(P);return F.some(C=>C.includes("auto"))&&l.add("auto"),F.some(C=>C.includes("low"))&&l.add("low"),F.some(C=>C.includes("medium")||C.includes("mid"))&&l.add("medium"),F.some(C=>C.includes("high"))&&l.add("high"),Array.from(l)}function B(P){const l=new Set,F=Object.keys(P);return F.some(C=>C.includes("swing_off")||C.includes("_off"))&&l.add("off"),F.some(C=>C.includes("vertical"))&&l.add("vertical"),F.some(C=>C.includes("horizontal"))&&l.add("horizontal"),F.some(C=>C.includes("both"))&&l.add("both"),Array.from(l)}function Z(P){for(const l of Object.values(P))if(typeof l=="string"&&l.startsWith("sc")||Array.isArray(l)&&l.length>0&&typeof l[0]=="string"&&l[0].startsWith("sc"))return"rf";return"ir"}ue(()=>p.value.commandType,(P,l)=>{!l||A.value||i.value||(Object.keys(p.value.commands).length>0&&P!==l?(E.value=P,p.value.commandType=l,A.value=!0):P!==l&&(R.value=P))}),ue(()=>r.editData,async P=>{var l,F,C;if(P&&r.editMode){console.log("🔧 Edit mode activated, loading profile data:",P),i.value=!0,v.value.length===0&&(console.log("📡 Loading Broadlink devices..."),await de(),console.log("📡 Devices loaded:",v.value.length));const h=P.profile,j=h.controller_data;console.log("🎮 Controller data from profile:",j),console.log("🎮 Available devices:",v.value.map(K=>K.entity_id));const O=h.commands||{},Q=h.commandType||Z(O);console.log("🔍 Command type (stored):",h.commandType),console.log("🔍 Command type (final):",Q);let ne={};if(P.platform==="climate"){const K=h.operationModes||se(O),ge=h.fanModes||L(O),Ce=h.swingModes||B(O);console.log("🔍 Inferred modes:",K),console.log("🔍 Inferred fan modes:",ge),console.log("🔍 Inferred swing modes:",Ce),ne={minTemp:h.minTemperature,maxTemp:h.maxTemperature,precision:h.precision,modes:K,fanModes:ge,swingModes:Ce}}else if(P.platform==="media_player"){const K=[];(O.on||O.off)&&K.push("turn_on"),(O.volumeUp||O.volumeDown)&&K.push("volume"),O.mute&&K.push("mute"),O.sources&&K.push("source"),(O.channelUp||O.channelDown)&&K.push("channel"),ne={features:K},M.value=K,console.log("🔍 Inferred media player features:",K)}else if(P.platform==="fan"){const K=((l=h.speed)==null?void 0:l.length)||Object.keys(O.default||{}).length||3,ge=[];(O.oscillate_on||O.oscillate_off)&&ge.push("oscillate"),(O.direction_forward||O.direction_reverse)&&ge.push("direction"),ne={speedLevels:K,features:ge},G.value=K,ee.value=ge,console.log("🔍 Inferred fan config:",ne)}else if(P.platform==="light"){const K=[];ne={features:K},te.value=K,console.log("🔍 Inferred light features:",K)}const ie=await x(h.manufacturer,(F=h.supportedModels)==null?void 0:F[0],O);p.value={platform:P.platform,manufacturer:h.manufacturer||"",model:((C=h.supportedModels)==null?void 0:C[0])||"",broadlinkDevice:j||"",commandType:Q,config:ne,commands:ie},console.log("✅ Profile populated:",p.value),console.log("✅ Selected device:",p.value.broadlinkDevice),console.log("✅ Command type:",p.value.commandType),console.log("✅ Commands (with learned codes):",ie),R.value=Q,setTimeout(()=>{i.value=!1},100)}},{immediate:!0});const ce=z(()=>{var P;switch(s.value){case 0:return p.value.platform&&p.value.manufacturer&&p.value.model;case 1:return p.value.platform==="climate"?p.value.config.minTemp&&p.value.config.maxTemp&&((P=p.value.config.modes)==null?void 0:P.length)>0:!0;case 2:return p.value.broadlinkDevice&&p.value.commandType&&Object.keys(p.value.commands).length>0;case 3:return!0;default:return!1}}),ye=y(null);async function Ie(){if(s.value!==3){ye.value=null;return}if(console.log("🔍 Generating JSON with commands:",p.value.commands),Object.values(p.value.commands).some(l=>typeof l=="string"?l==="pending":typeof l=="object"?Object.values(l).some(F=>typeof F=="string"?F==="pending":typeof F=="object"?Object.values(F).some(C=>C==="pending"):!1):!1)){console.warn('⚠️ Commands still contain "pending" placeholders!'),console.log("📦 Attempting to fetch from Broadlink storage...");const l=await x(p.value.manufacturer,p.value.model,p.value.commands);p.value.commands=l,console.log("✅ Updated commands:",l)}ye.value=re(p.value),console.log("📄 Generated JSON:",ye.value)}const we=z(()=>s.value!==3?null:X(p.value));function $e(){p.value.config={},p.value.commands={}}function I(){A.value=!1,p.value.commandType=E.value,R.value=E.value,p.value.commands={},E.value=""}function d(){A.value=!1,E.value=""}async function U(){s.value<f.length-1&&(s.value++,s.value===3&&await Ie())}function H(){s.value>0&&s.value--}function g(){A.value||(q.value=!0)}function $(){q.value=!1,N()}function N(){k("close"),setTimeout(()=>{s.value=0,p.value={platform:"",manufacturer:"",model:"",broadlinkDevice:"",commandType:"ir",config:{},commands:{}},R.value="ir"},300)}async function oe(){var P,l,F,C,h,j;m.value=!0;try{if(!b.value){const ge=(await le.get("/api/smartir/config/check")).data;if(ge&&!((P=ge.platforms[p.value.platform])==null?void 0:P.file_exists)){D.value=ge.configuration_warnings||[],V.value=ge.config_path||"/config",t.value={platform:p.value.platform,json:ye.value},_.value=!0,m.value=!1;return}}let O;r.editMode&&((l=r.editData)!=null&&l.code)?(O=parseInt(r.editData.code),console.log("📝 Edit mode: Using existing code",O)):(O=(await le.get(`/api/smartir/platforms/${p.value.platform}/next-code`)).data.next_code,console.log("✨ New profile: Using next code",O));const ne=(await le.post("/api/smartir/profiles",{platform:p.value.platform,json:ye.value,code_number:O})).data,ie={platform:"smartir",name:`${p.value.manufacturer} ${p.value.model}`,unique_id:`${p.value.manufacturer.toLowerCase().replace(/[^a-z0-9]+/g,"_")}_${p.value.model.toLowerCase().replace(/[^a-z0-9]+/g,"_")}`,device_code:O,controller_data:p.value.broadlinkDevice};try{await le.post("/api/smartir/config/add-device",{platform:p.value.platform,entity_type:p.value.platform,name:ie.name,unique_id:ie.unique_id,device_code:ie.device_code,controller_data:ie.controller_data})}catch(K){console.error("Failed to add device to config:",K);const ge=((F=K.response)==null?void 0:F.data)||{};let Ce=ge.error||"Unknown error";ge.validation_errors&&ge.validation_errors.length>0&&(Ce=`Device configuration validation failed:
`+ge.validation_errors.map(Le=>`  • ${Le}`).join(`
`)),(C=w.value)==null||C.warning(`Profile saved but failed to add to config file:
${Ce}`,"⚠️ Partial Success")}k("save",{json:ye.value,yaml:we.value,profile:p.value,saved_to:ne.path}),(h=w.value)==null||h.success(`File: ${ne.filename}
Device Code: ${O}
Added to: smartir/${p.value.platform}.yaml

⚠️ Restart Home Assistant to activate`,"✅ Profile Saved Successfully!"),N()}catch(O){console.error("Error saving profile:",O),(j=w.value)==null||j.error(O.message,"❌ Error Saving Profile")}finally{m.value=!1}}async function ae(){b.value=!0,_.value=!1,t.value&&(await oe(),t.value=null)}function W(){var P,l;try{const F=JSON.stringify(ye.value,null,2),C=new Blob([F],{type:"application/json"}),h=URL.createObjectURL(C),j=document.createElement("a");j.href=h;const O=p.value.manufacturer.toLowerCase().replace(/\s+/g,"_"),Q=p.value.model.toLowerCase().replace(/\s+/g,"_");j.download=`smartir_${p.value.platform}_${O}_${Q}.json`,document.body.appendChild(j),j.click(),document.body.removeChild(j),URL.revokeObjectURL(h),(P=w.value)==null||P.success("You can manually upload this file to your SmartIR codes directory.","✅ Profile Downloaded")}catch(F){console.error("Error downloading profile:",F),(l=w.value)==null||l.error(F.message,"❌ Error Downloading Profile")}}async function x(P,l,F){const C=P.toLowerCase().replace(/[^a-z0-9]+/g,"_"),h=l.toLowerCase().replace(/[^a-z0-9]+/g,"_"),j=`${C}_${h}`;try{const ne=(await le.get("/api/commands/all")).data[j]||{};console.log(`🔍 Fetching learned commands for device: ${j}`),console.log("📦 Device commands from storage:",ne);const ie={...F};for(const[K,ge]of Object.entries(ie))if(ge==="pending"&&ne[K])ie[K]=ne[K];else if(typeof ge=="object"){for(const[Ce,Le]of Object.entries(ge))if(typeof Le=="object")for(const[Me,Qe]of Object.entries(Le)){const Be=`${K}_${Ce}_${Me}`;Qe==="pending"&&ne[Be]&&(ie[K][Ce][Me]=ne[Be])}else if(Le==="pending"){const Me=`${K}_${Ce}`;ne[Me]&&(ie[K][Ce]=ne[Me])}}return console.log("✅ Merged commands:",ie),ie}catch(O){return console.error("Error fetching learned commands:",O),F}}function re(P){const l={manufacturer:P.manufacturer,supportedModels:[P.model],supportedController:"Broadlink",commandsEncoding:"Base64",commandType:P.commandType||"ir",commands:{}};return P.platform==="climate"&&(l.minTemperature=P.config.minTemp,l.maxTemperature=P.config.maxTemp,l.precision=P.config.precision||1,l.operationModes=P.config.modes||[],l.fanModes=P.config.fanModes&&P.config.fanModes.length>0?P.config.fanModes:["auto"],P.config.swingModes&&P.config.swingModes.length>0&&(l.swingModes=P.config.swingModes),l.commands=P.commands),l}function X(P){let l=`# SmartIR ${P.platform} configuration
`;return l+=`# Generated by Broadlink Manager v2

`,P.platform==="climate"&&(l+=`climate:
`,l+=`  - platform: smartir
`,l+=`    name: ${P.manufacturer} ${P.model}
`,l+=`    unique_id: ${P.manufacturer.toLowerCase()}_${P.model.toLowerCase().replace(/\s+/g,"_")}
`,l+=`    device_code: 10000  # Change this to your custom code number
`,l+=`    controller_data: ${P.broadlinkDevice}
`,P.config.tempSensor&&(l+=`    temperature_sensor: ${P.config.tempSensor}
`),P.config.humiditySensor&&(l+=`    humidity_sensor: ${P.config.humiditySensor}
`),P.config.powerSensor&&(l+=`    power_sensor: ${P.config.powerSensor}
`)),l}async function de(){try{console.log("Fetching remote devices from /api/remote/devices...");const P=await le.get("/api/remote/devices");console.log("Loaded remote devices response:",P.data);const l=P.data.devices||[];console.log("Extracted devices array:",l),console.log("Device count:",l.length),v.value=l,console.log("broadlinkDevices.value set to:",v.value),console.log("Final device count:",v.value.length)}catch(P){console.error("Error loading remote devices:",P),v.value=[]}}return ue(()=>r.show,P=>{if(P){const l=Number.isInteger(r.startStep)?r.startStep:0;s.value=Math.min(Math.max(l,0),f.length-1)}}),ue(()=>r.startStep,P=>{if(r.show){const l=Number.isInteger(P)?P:0;s.value=Math.min(Math.max(l,0),f.length-1)}}),xe(()=>{r.show&&de()}),(P,l)=>o.show?(n(),a("div",{key:0,class:"modal-overlay",onClick:g},[e("div",{class:"modal-container",onClick:l[19]||(l[19]=pe(()=>{},["stop"]))},[e("div",Kd,[e("h2",null,[l[22]||(l[22]=e("i",{class:"mdi mdi-file-document-edit"},null,-1)),S(" "+u(o.editMode?"Edit SmartIR Profile":"Create SmartIR Profile"),1)]),e("button",{onClick:N,class:"close-button"},[...l[23]||(l[23]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Xd,[(n(),a(me,null,be(f,(F,C)=>e("div",{key:C,class:Y(["step",{active:s.value===C,completed:s.value>C}])},[e("div",Gd,[s.value>C?(n(),a("i",Yd)):(n(),a("span",Zd,u(C+1),1))]),e("span",Qd,u(F.label),1)],2)),64))]),e("div",eu,[s.value===0?(n(),a("div",tu,[l[29]||(l[29]=e("h3",null,"Device Information",-1)),e("div",ou,[l[25]||(l[25]=e("label",null,"Platform Type *",-1)),J(e("select",{"onUpdate:modelValue":l[0]||(l[0]=F=>p.value.platform=F),onChange:$e},[...l[24]||(l[24]=[Ae('<option value="" data-v-e9a50cce>Select platform...</option><option value="climate" data-v-e9a50cce>🌡️ Climate (AC, Heater, Heat Pump)</option><option value="media_player" data-v-e9a50cce>📺 Media Player (TV, Receiver)</option><option value="fan" data-v-e9a50cce>🌀 Fan</option><option value="light" data-v-e9a50cce>💡 Light (LED Strip, IR Light)</option>',5)])],544),[[ke,p.value.platform]])]),e("div",lu,[l[26]||(l[26]=e("label",null,"Manufacturer *",-1)),J(e("input",{"onUpdate:modelValue":l[1]||(l[1]=F=>p.value.manufacturer=F),type:"text",placeholder:"e.g., Daikin, LG, Samsung"},null,512),[[De,p.value.manufacturer]])]),e("div",nu,[l[27]||(l[27]=e("label",null,"Model(s) *",-1)),J(e("input",{"onUpdate:modelValue":l[2]||(l[2]=F=>p.value.model=F),type:"text",placeholder:"e.g., FTXS35K, Multiple models"},null,512),[[De,p.value.model]]),l[28]||(l[28]=e("small",null,'Enter model number or "Multiple" if it works with many models',-1))])])):T("",!0),s.value===1?(n(),a("div",su,[p.value.platform==="climate"?(n(),Te(Cr,{key:0,modelValue:p.value.config,"onUpdate:modelValue":l[3]||(l[3]=F=>p.value.config=F)},null,8,["modelValue"])):p.value.platform==="media_player"?(n(),a("div",au,[l[36]||(l[36]=e("h3",null,"Media Player Configuration",-1)),l[37]||(l[37]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),S(" Configure the features your media player supports. You'll learn the IR commands in the next step. ")],-1)),e("div",iu,[l[35]||(l[35]=e("h4",null,"Supported Features",-1)),e("div",ru,[e("label",du,[J(e("input",{type:"checkbox",value:"turn_on","onUpdate:modelValue":l[4]||(l[4]=F=>M.value=F)},null,512),[[ve,M.value]]),l[30]||(l[30]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),S(" Power On/Off ")],-1))]),e("label",uu,[J(e("input",{type:"checkbox",value:"volume","onUpdate:modelValue":l[5]||(l[5]=F=>M.value=F)},null,512),[[ve,M.value]]),l[31]||(l[31]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-volume-high"}),S(" Volume Control ")],-1))]),e("label",cu,[J(e("input",{type:"checkbox",value:"mute","onUpdate:modelValue":l[6]||(l[6]=F=>M.value=F)},null,512),[[ve,M.value]]),l[32]||(l[32]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-volume-mute"}),S(" Mute ")],-1))]),e("label",mu,[J(e("input",{type:"checkbox",value:"source","onUpdate:modelValue":l[7]||(l[7]=F=>M.value=F)},null,512),[[ve,M.value]]),l[33]||(l[33]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-import"}),S(" Source Selection ")],-1))]),e("label",vu,[J(e("input",{type:"checkbox",value:"channel","onUpdate:modelValue":l[8]||(l[8]=F=>M.value=F)},null,512),[[ve,M.value]]),l[34]||(l[34]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-numeric"}),S(" Channel Control ")],-1))])])])])):p.value.platform==="fan"?(n(),a("div",pu,[l[44]||(l[44]=e("h3",null,"Fan Configuration",-1)),l[45]||(l[45]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),S(" Configure the features your fan supports. You'll learn the IR commands in the next step. ")],-1)),e("div",fu,[l[40]||(l[40]=e("h4",null,"Fan Speed Levels",-1)),e("div",gu,[l[39]||(l[39]=e("label",null,"Number of Speed Levels *",-1)),J(e("select",{"onUpdate:modelValue":l[9]||(l[9]=F=>G.value=F)},[...l[38]||(l[38]=[e("option",{value:1},"1 Speed",-1),e("option",{value:2},"2 Speeds",-1),e("option",{value:3},"3 Speeds (Low/Med/High)",-1),e("option",{value:4},"4 Speeds",-1),e("option",{value:5},"5 Speeds",-1),e("option",{value:6},"6 Speeds",-1)])],512),[[ke,G.value,void 0,{number:!0}]])])]),e("div",yu,[l[43]||(l[43]=e("h4",null,"Additional Features",-1)),e("div",bu,[e("label",hu,[J(e("input",{type:"checkbox",value:"oscillate","onUpdate:modelValue":l[10]||(l[10]=F=>ee.value=F)},null,512),[[ve,ee.value]]),l[41]||(l[41]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-sync"}),S(" Oscillation ")],-1))]),e("label",ku,[J(e("input",{type:"checkbox",value:"direction","onUpdate:modelValue":l[11]||(l[11]=F=>ee.value=F)},null,512),[[ve,ee.value]]),l[42]||(l[42]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-rotate-3d-variant"}),S(" Direction (Forward/Reverse) ")],-1))])])])])):p.value.platform==="light"?(n(),a("div",wu,[l[51]||(l[51]=e("h3",null,"Light Configuration",-1)),l[52]||(l[52]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),S(" Configure the features your light supports. You'll learn the IR commands in the next step. ")],-1)),e("div",$u,[l[50]||(l[50]=e("h4",null,"Supported Features",-1)),e("div",Cu,[e("label",_u,[J(e("input",{type:"checkbox",value:"turn_on","onUpdate:modelValue":l[12]||(l[12]=F=>te.value=F)},null,512),[[ve,te.value]]),l[46]||(l[46]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),S(" Power On/Off ")],-1))]),e("label",Su,[J(e("input",{type:"checkbox",value:"brightness","onUpdate:modelValue":l[13]||(l[13]=F=>te.value=F)},null,512),[[ve,te.value]]),l[47]||(l[47]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-brightness-6"}),S(" Brightness Control ")],-1))]),e("label",Du,[J(e("input",{type:"checkbox",value:"color_temp","onUpdate:modelValue":l[14]||(l[14]=F=>te.value=F)},null,512),[[ve,te.value]]),l[48]||(l[48]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-thermometer"}),S(" Color Temperature ")],-1))]),e("label",Iu,[J(e("input",{type:"checkbox",value:"rgb","onUpdate:modelValue":l[15]||(l[15]=F=>te.value=F)},null,512),[[ve,te.value]]),l[49]||(l[49]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-palette"}),S(" RGB Color ")],-1))])])])])):T("",!0)])):T("",!0),s.value===2?(n(),a("div",xu,[fe(od,{modelValue:p.value.commands,"onUpdate:modelValue":l[16]||(l[16]=F=>p.value.commands=F),platform:p.value.platform,config:p.value.config,broadlinkDevice:p.value.broadlinkDevice,"onUpdate:broadlinkDevice":l[17]||(l[17]=F=>p.value.broadlinkDevice=F),manufacturer:p.value.manufacturer,model:p.value.model,commandType:p.value.commandType,"onUpdate:commandType":l[18]||(l[18]=F=>p.value.commandType=F)},null,8,["modelValue","platform","config","broadlinkDevice","manufacturer","model","commandType"])])):T("",!0),s.value===3?(n(),a("div",Tu,[fe(Id,{profile:p.value,"json-data":ye.value,"yaml-config":we.value},null,8,["profile","json-data","yaml-config"])])):T("",!0)]),e("div",Mu,[s.value>0?(n(),a("button",{key:0,onClick:H,class:"btn-secondary"},[...l[53]||(l[53]=[e("i",{class:"mdi mdi-arrow-left"},null,-1),S(" Back ",-1)])])):T("",!0),l[57]||(l[57]=e("div",{class:"spacer"},null,-1)),e("button",{onClick:N,class:"btn-text"}," Cancel "),s.value<f.length-1?(n(),a("button",{key:1,onClick:U,class:"btn-primary",disabled:!ce.value},[...l[54]||(l[54]=[S(" Next ",-1),e("i",{class:"mdi mdi-arrow-right"},null,-1)])],8,Ru)):(n(),a("div",Lu,[e("button",{onClick:oe,class:"btn-primary",disabled:m.value},[l[55]||(l[55]=e("i",{class:"mdi mdi-cloud-upload"},null,-1)),S(" "+u(m.value?"Saving...":"Save to SmartIR"),1)],8,Au),e("button",{onClick:W,class:"btn-secondary",disabled:m.value},[...l[56]||(l[56]=[e("i",{class:"mdi mdi-download"},null,-1),S(" Download JSON ",-1)])],8,Ou)]))])]),fe(Wd,{show:_.value,platform:p.value.platform,warnings:D.value,"config-path":V.value,onClose:l[20]||(l[20]=F=>_.value=!1),onComplete:ae},null,8,["show","platform","warnings","config-path"]),fe(Re,{isOpen:A.value,title:"Change Command Type?",message:"Changing the command type will clear all learned commands. Continue?",confirmText:"Continue",cancelText:"Cancel",dangerMode:!0,onConfirm:I,onCancel:d},null,8,["isOpen"]),fe(Re,{isOpen:q.value,title:"Close Profile Builder?",message:"Are you sure you want to close? Your progress will be lost.",confirmText:"Close",cancelText:"Keep Editing",dangerMode:!0,onConfirm:$,onCancel:l[21]||(l[21]=F=>q.value=!1)},null,8,["isOpen"])])):T("",!0)}},Eu=he(Vu,[["__scopeId","data-v-e9a50cce"]]),Uu={class:"dashboard"},Pu={__name:"Dashboard",setup(o){const c=Ve(),r=Se("smartirEnabled"),k=y(!1),w=y(!1),s=y(null),m=y(0),v=y(null);function _(){w.value=!1,s.value=null,m.value=0,k.value=!0}async function D({platform:t,profile:A,startStep:q}){m.value=Number.isInteger(q)?q:0;try{const E=await fetch(`api/smartir/platforms/${t}/profiles/${A.code}`);if(!E.ok)throw new Error("Failed to load profile");const R=await E.json();let i="";try{const f=await fetch(`api/smartir/config/get-device?platform=${t}&code=${A.code}`);f.ok?(i=(await f.json()).controller_data||"",console.log("✅ Found controller_data from YAML:",i)):console.warn("⚠️ No YAML entry found for this profile (this is OK for profiles not yet added to config)")}catch(f){console.warn("⚠️ Could not fetch controller_data from config:",f)}w.value=!0,s.value={platform:t,code:A.code,profile:{...R.profile,controller_data:i}},k.value=!0}catch(E){console.error("Error loading profile for edit:",E),c.error("Failed to load profile for editing")}}function V(){k.value=!1,w.value=!1,s.value=null}async function b(t){console.log("Profile saved:",t),V(),v.value&&v.value.loadAllProfiles&&(await v.value.loadAllProfiles(),console.log("✅ Profiles list refreshed"))}return(t,A)=>(n(),a("div",Uu,[_e(r)?(n(),Te(Vs,{key:0})):T("",!0),A[0]||(A[0]=Ae('<div class="welcome-banner" data-v-f324d01b><div class="banner-content" data-v-f324d01b><div class="banner-icon" data-v-f324d01b><i class="mdi mdi-rocket-launch" data-v-f324d01b></i></div><div class="banner-text" data-v-f324d01b><h2 data-v-f324d01b>Welcome to Broadlink Manager v2!</h2><p data-v-f324d01b>Manage your IR/RF devices with a modern Vue 3 interface</p></div></div><div class="status-badges" data-v-f324d01b><span class="badge success" data-v-f324d01b><i class="mdi mdi-check-circle" data-v-f324d01b></i> Vue 3 Ready </span><span class="badge warning" data-v-f324d01b><i class="mdi mdi-beta" data-v-f324d01b></i> Beta </span></div></div>',1)),fe(Ts),_e(r)?(n(),Te(Ii,{key:1,ref_key:"smartirStatusCard",ref:v,onCreateProfile:_,onEditProfile:D},null,512)):T("",!0),fe(Eu,{show:k.value,editMode:w.value,editData:s.value,startStep:m.value,onClose:V,onSave:b},null,8,["show","editMode","editData","startStep"])]))}},ju=he(Pu,[["__scopeId","data-v-f324d01b"]]),Fu={class:"toast-container"},Nu={class:"toast-content"},Bu={key:0,class:"toast-title"},qu={class:"toast-message"},Hu={key:1,class:"toast-description"},zu=["onClick","title"],Ju={__name:"Toast",setup(o,{expose:c}){const r=y([]);let k=0;function w(v){const _={success:"mdi-check-circle",error:"mdi-alert-circle",warning:"mdi-alert",info:"mdi-information"};return _[v]||_.info}function s({message:v,title:_,description:D,type:V="info",duration:b=5e3}){const t=k++,A={id:t,message:v,title:_,description:D,type:V};return r.value.push(A),b>0&&setTimeout(()=>{m(t)},b),t}function m(v){const _=r.value.findIndex(D=>D.id===v);_>-1&&r.value.splice(_,1)}return c({addToast:s,removeToast:m,show:s,success:(v,_)=>s({message:v,title:_,type:"success"}),error:(v,_)=>s({message:v,title:_,type:"error",duration:0}),warning:(v,_)=>s({message:v,title:_,type:"warning",duration:0}),info:(v,_)=>s({message:v,title:_,type:"info"})}),(v,_)=>(n(),Te(Ke,{to:"body"},[e("div",Fu,[fe(lt,{name:"toast"},{default:Fe(()=>[(n(!0),a(me,null,be(r.value,D=>(n(),a("div",{key:D.id,class:Y(["toast",[`toast-${D.type}`,{"toast-persistent":D.type==="error"||D.type==="warning"}]])},[e("i",{class:Y(["mdi",w(D.type)])},null,2),e("div",Nu,[D.title?(n(),a("div",Bu,u(D.title),1)):T("",!0),e("div",qu,u(D.message),1),D.description?(n(),a("div",Hu,u(D.description),1)):T("",!0)]),e("button",{onClick:V=>m(D.id),class:Y(["toast-close",{"toast-close-prominent":D.type==="error"||D.type==="warning"}]),title:D.type==="error"||D.type==="warning"?"Click to dismiss":"Close"},[..._[0]||(_[0]=[e("i",{class:"mdi mdi-close"},null,-1)])],10,zu)],2))),128))]),_:1})])]))}},Wu=he(Ju,[["__scopeId","data-v-f0587837"]]),Ku="0.3.0-alpha.1",Xu={version:Ku},Gu={id:"app",class:"app-container"},Yu={class:"app-header"},Zu={class:"header-content"},Qu={class:"header-right"},ec=["title"],tc={class:"settings-menu-container"},oc={key:0,class:"settings-menu"},lc=["title"],nc={class:"toggle-content"},sc={key:0,class:"not-installed-label"},ac={key:0,href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"menu-item menu-link menu-subitem"},ic=["disabled"],rc=["disabled"],dc=["disabled"],uc={class:"app-main"},cc={class:"app-footer"},mc={__name:"App",setup(o){const c=y(null),r=Xu.version,k=y("light"),w=y(null),s=y(!1),m=y(!1),v=y(!1),_=y(localStorage.getItem("smartir_enabled")!=="false"),D=z(()=>{var p;return((p=w.value)==null?void 0:p.installed)||!1}),V=z(()=>({light:"mdi mdi-weather-sunny",medium:"mdi mdi-weather-partly-cloudy",dark:"mdi mdi-weather-night"})[k.value]),b=z(()=>({light:"Switch to Medium Theme",medium:"Switch to Dark Theme",dark:"Switch to Light Theme"})[k.value]),t=()=>{const p=["light","medium","dark"],G=(p.indexOf(k.value)+1)%p.length;k.value=p[G],document.body.classList.remove("medium-mode","dark-mode"),k.value==="medium"?document.body.classList.add("medium-mode"):k.value==="dark"&&document.body.classList.add("dark-mode"),localStorage.setItem("theme",k.value)},A=async()=>{try{const p=await Ye.getStatus();w.value=p,p.installed?console.log("✅ SmartIR detected:",p.version):console.log("ℹ️ SmartIR not detected")}catch(p){console.error("Error checking SmartIR:",p),w.value={installed:!1,error:p.message}}},q=async()=>{var p,M,G;m.value=!0;try{const te=(await le.get("/api/diagnostics/markdown")).data.markdown;if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(te),(p=c.value)==null||p.success("Diagnostic summary copied to clipboard!");else{const se=document.createElement("textarea");se.value=te,se.style.position="fixed",se.style.left="-999999px",se.style.top="-999999px",document.body.appendChild(se),se.focus(),se.select();try{if(document.execCommand("copy"))(M=c.value)==null||M.success("Diagnostic summary copied to clipboard!");else throw new Error("execCommand failed")}finally{document.body.removeChild(se)}}s.value=!1}catch(ee){console.error("Error copying diagnostics:",ee),(G=c.value)==null||G.error("Failed to copy diagnostics: "+ee.message)}finally{m.value=!1}},E=async()=>{var p,M;m.value=!0;try{const G=await le.get("/api/diagnostics/download",{responseType:"blob"}),ee=window.URL.createObjectURL(new Blob([G.data])),te=document.createElement("a");te.href=ee;const se=G.headers["content-disposition"];let L="broadlink_manager_diagnostics.zip";if(se){const B=se.match(/filename="?(.+)"?/);B&&(L=B[1])}te.setAttribute("download",L),document.body.appendChild(te),te.click(),te.remove(),window.URL.revokeObjectURL(ee),(p=c.value)==null||p.success("Diagnostic bundle downloaded!"),s.value=!1}catch(G){console.error("Error downloading diagnostics:",G),(M=c.value)==null||M.error("Failed to download diagnostics")}finally{m.value=!1}},R=()=>{D.value&&(_.value=!_.value,localStorage.setItem("smartir_enabled",_.value.toString()),window.location.reload())},i=async()=>{var p,M,G;v.value=!0;try{const ee=await le.post("/api/smartir/refresh-index");ee.data.success?(p=c.value)==null||p.success(`Updated to v${ee.data.version} (${ee.data.total_devices} devices)`,"✅ Index Updated"):(M=c.value)==null||M.error(ee.data.error||"Unknown error","❌ Update Failed")}catch(ee){console.error("Error updating SmartIR index:",ee),(G=c.value)==null||G.error("Failed to update device index","❌ Update Error")}finally{v.value=!1,s.value=!1}},f=p=>{p.target.closest(".settings-menu-container")||(s.value=!1)};return xe(async()=>{const p=localStorage.getItem("theme");p&&["light","medium","dark"].includes(p)?(k.value=p,p==="medium"?document.body.classList.add("medium-mode"):p==="dark"&&document.body.classList.add("dark-mode")):localStorage.getItem("darkMode")==="true"&&(k.value="dark",document.body.classList.add("dark-mode"),localStorage.setItem("theme","dark")),await A();const M=He();M&&c.value&&(M.appContext.config.globalProperties.$toast=c.value),document.addEventListener("click",f)}),ze(()=>{document.removeEventListener("click",f)}),Ue("smartirStatus",w),Ue("smartirEnabled",_),Ue("refreshSmartIR",A),Ue("toast",c),(p,M)=>(n(),a("div",Gu,[e("header",Yu,[e("div",Zu,[M[13]||(M[13]=e("div",{class:"header-left"},[e("i",{class:"mdi mdi-remote"}),e("h1",null,"Broadlink Manager v2"),e("span",{class:"beta-badge"},"BETA")],-1)),e("div",Qu,[e("button",{onClick:t,class:"icon-button",title:b.value},[e("i",{class:Y(V.value)},null,2)],8,ec),e("div",tc,[e("button",{onClick:M[0]||(M[0]=G=>s.value=!s.value),class:"icon-button",title:"Settings"},[...M[2]||(M[2]=[e("i",{class:"mdi mdi-cog"},null,-1)])]),s.value?(n(),a("div",oc,[M[9]||(M[9]=e("div",{class:"menu-section-title"},"Integration Settings",-1)),e("div",{class:Y(["menu-item toggle-item",{disabled:!D.value}]),onClick:M[1]||(M[1]=G=>D.value?R():null),title:D.value?"":"SmartIR is not installed"},[e("div",nc,[M[3]||(M[3]=e("i",{class:"mdi mdi-air-conditioner"},null,-1)),M[4]||(M[4]=e("span",null,"SmartIR Integration",-1)),D.value?T("",!0):(n(),a("span",sc,"(Not Installed)"))]),e("div",{class:Y(["toggle-switch",{active:_.value&&D.value,disabled:!D.value}])},[...M[5]||(M[5]=[e("div",{class:"toggle-slider"},null,-1)])],2)],10,lc),_.value?(n(),a("a",ac,[...M[6]||(M[6]=[e("i",{class:"mdi mdi-github"},null,-1),e("span",null,"SmartIR on GitHub",-1)])])):T("",!0),_.value?(n(),a("button",{key:1,onClick:i,class:"menu-item menu-subitem",disabled:v.value},[e("i",{class:Y(["mdi",v.value?"mdi-loading mdi-spin":"mdi-refresh"])},null,2),e("span",null,u(v.value?"Updating...":"Update Device Index"),1)],8,ic)):T("",!0),M[10]||(M[10]=e("div",{class:"menu-divider"},null,-1)),M[11]||(M[11]=e("div",{class:"menu-section-title"},"Diagnostics",-1)),e("button",{onClick:q,class:"menu-item",disabled:m.value},[...M[7]||(M[7]=[e("i",{class:"mdi mdi-content-copy"},null,-1),e("span",null,"Copy Diagnostics",-1)])],8,rc),e("button",{onClick:E,class:"menu-item",disabled:m.value},[...M[8]||(M[8]=[e("i",{class:"mdi mdi-download"},null,-1),e("span",null,"Download Diagnostics",-1)])],8,dc),M[12]||(M[12]=Ae('<div class="menu-divider" data-v-70b7366b></div><div class="menu-section-title" data-v-70b7366b>Help &amp; Support</div><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2#readme" target="_blank" class="menu-item menu-link" data-v-70b7366b><i class="mdi mdi-book-open-variant" data-v-70b7366b></i><span data-v-70b7366b>Documentation</span></a><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2/issues" target="_blank" class="menu-item menu-link" data-v-70b7366b><i class="mdi mdi-bug" data-v-70b7366b></i><span data-v-70b7366b>Report Issue</span></a><div class="menu-divider" data-v-70b7366b></div><div class="menu-section-title" data-v-70b7366b>Community</div><a href="https://community.home-assistant.io/t/broadlink-manager-modern-web-interface-for-broadlink-devices/938473" target="_blank" class="menu-item menu-link" data-v-70b7366b><i class="mdi mdi-forum" data-v-70b7366b></i><span data-v-70b7366b>HA Forum Discussion</span></a><a href="https://www.reddit.com/r/homeassistant/comments/1o1q3kf/release_broadlink_manager_addon_a_modern_web_ui/" target="_blank" class="menu-item menu-link" data-v-70b7366b><i class="mdi mdi-reddit" data-v-70b7366b></i><span data-v-70b7366b>Reddit Discussion</span></a><div class="menu-divider" data-v-70b7366b></div><div class="menu-section-title" data-v-70b7366b>Project</div><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2" target="_blank" class="menu-item menu-link" data-v-70b7366b><i class="mdi mdi-github" data-v-70b7366b></i><span data-v-70b7366b>GitHub Repository</span></a><a href="https://ko-fi.com/tonyperkins" target="_blank" class="menu-item menu-link menu-item-sponsor" data-v-70b7366b><i class="mdi mdi-coffee" data-v-70b7366b></i><span data-v-70b7366b>Support on Ko-fi</span></a>',12))])):T("",!0)])])])]),e("main",uc,[fe(ju)]),e("footer",cc,[e("p",null,"Broadlink Manager v"+u(_e(r))+" | Built with Vue "+u(nt),1)]),fe(Wu,{ref_key:"toastRef",ref:c},null,512)]))}},vc=he(mc,[["__scopeId","data-v-70b7366b"]]),Ze=st(vc),pc=at();Ze.use(pc);Ze.mount("#app");
