import{g as Qe,r as g,o as Ae,a as Ke,b as at,d as it,c as K,e as n,f as l,h as e,i as R,n as Y,u as _e,t as c,j as x,F as fe,k as $e,w as de,l as X,v as Le,m as me,p as ke,q as Be,s as Xe,T as et,x as De,y as Te,z as Ue,A as ye,B as tt,C as qe,D as Ee,E as ot,G as ze,H as rt,I as dt,J as ut,K as He,L as ct,M as mt}from"./vendor-DGiFqQ_g.js";(function(){const m=document.createElement("link").relList;if(m&&m.supports&&m.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))w(h);new MutationObserver(h=>{for(const a of h)if(a.type==="childList")for(const u of a.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&w(u)}).observe(document,{childList:!0,subtree:!0});function r(h){const a={};return h.integrity&&(a.integrity=h.integrity),h.referrerPolicy&&(a.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?a.credentials="include":h.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function w(h){if(h.ep)return;h.ep=!0;const a=r(h);fetch(h.href,a)}})();let Ze=!1;function Fe(){const t=Qe(),m=t==null?void 0:t.appContext.config.globalProperties.$toast;return m||(Ze||(console.warn("Toast notification system not yet initialized - using console fallback"),Ze=!0),{success:r=>console.log("âœ“",r),error:r=>console.error("âœ—",r),warning:r=>console.warn("âš ",r),info:r=>console.info("â„¹",r)})}function Ge(){const t=g(!1),m=g(!1),r=g(!1),w=g(0),h=767,a=768,u=1023,f=1024,S=()=>{const C=window.innerWidth;w.value=C,t.value=C<=h,m.value=C>=a&&C<=u,r.value=C>=f};return Ae(()=>{S(),window.addEventListener("resize",S)}),Ke(()=>{window.removeEventListener("resize",S)}),{isMobile:t,isTablet:m,isDesktop:r,screenWidth:w,isMobileOrTablet:()=>t.value||m.value,isTabletOrDesktop:()=>m.value||r.value}}const Ye="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAHBUlEQVR4nOxZC1BTVxo+9+aNZI2LNsgjWR4hgoIiRVDBslKnIKPbx1jqTrtYoakat1a6dNsdd7t1X8XHyAbEhdUu1u2mXdbasqJbtsaMIqBBECiPBmqEICEBEx4xJLlJ7s6lw6rJDeQ2FzLM+M1kBs7/3+/83zn/Oee/51JRFAXzGbCvA/AWjwX4GvNeANWXnXffHQ4+K6/dYbHeD+IFhjRkb1wn9WPQbEQ4IF/tQlXX2p5+/8OyczY74j/VxuMG3Sh/Oz9jaQDb4CmPT1LIbLXBfzrz0cmHg8fQpx1Yc1Ra+TsiXD4R0PqtRmAyj/LxbJeaujKIcPlEAINOM7vLXBaTZibCRWgRq3WGJZWX63aoNDpB8BJOX/bGlIqwpUv6iXBgWBHG7eUF8urUWvU6Z9sLGxI/IsLl8SJu6u4XigqPXkVspiVTbTQqU1/6Vn7ammh+G5FOMZyqludIKqUVU/9jcaSuTCo/unfHbiad4iBdwMu/P1bV1tO1xbk9NDC0/vwHB1xGcjqYLAh16zsHW3R6XXTu1mfFdAqMrIoSKNbGhLcQ4QGeppDJ7ACtPcqNEI6tT9O3Vqm+tygqNMDjrU9Sef6tIYM2JjUuuXzfC5knCEXsBI8WMZUCAxiCrfhWyMZkMNzYXNHVpwmXXqp5j0Hz0/1m57a3PQ8VHx4JoNMASIl9shLPFsB5ooO7iDXhCY/dAcCvT/79LwC1s/K2bDnAXcQeJRqwMzzeRt/bua0gLChcDsCDNQNBkEU/qot7o6j0kzETQpuJ40ZnT6xSrUoNWhyseHVz2ikv4n4QA5FSArE5IFlTZ0r3XU1MWODib6NCl3a9dkhSYxgbjo4XLq8sL9j7Ip36YEwMRjMNQazMhf7+RgYNnuyo7bY6ArFaWKuXRX495wLwoLk39sO9RaVnM5OTP8zLSjtjsljpp6ovi6pqr706eE8XBwGUSqEy9Guihf/92TMZhetjI5rJCHwKpBRzZqsNYtKp6KD+Pvv1w5ILdzR3UvD8HA4YefOl7N25JKUPIKuUwIJH7A5of/GJf7oLfrIz2EH786fSss+uKFzOk+8L0mqh6rpbmR0q5YyFGAQBSuHHlcUWxEaZyXfMhFD0Rgt9Oh/SBMiam58HAO+oc4XZMsK/1taT6M6uHjJw8w6VSNfvemM8TbzPlFlwsP5KyzfJeL6kCejXDgo894aASqOZ9O/uHwzq6B3ijhitkzOC7XS7j0g+V3S0vQTDDhYEoZSBobvJ+yXFNZ29gy4lOGmvlDBMIfQqSKV8539EWvXHhvbGHBSFrAwGW+vvxzLoR7RxzrNpsyPs0xcv7/lg1/ZfPtKvuw7MVhulUakWdvRq+XY3tWFT90Bk+52BCOzvyOBgjytSFKAgms+b9F/2o+BbKwUrvgjhhjSjKLAPG4YE7lJxfEIf5dyGOwMXrren/eF0RYXRNMrHDt4QbmjDEbHop9F8rqpddZd3sV6R/aWiabtWr41PW534V8m+PFHW+qSPL9TX7oM8WAaBi4IbE4S8yYNs/7asIgBA0ZStRqFM/MXxIzcgHBEBP+C6DJKLgJvK3uXvniitBsDmNzkSEAD9uv5k0aFjXy1gMQ0DQ5p4CAIwNuXLwyL/ExcpqMWeS42NUmxKXFf8VWPdz6cLnkqhGd/Pe+U1Cow/+ekJUYr4qJgvbik7f/Jw+0J/tjpvS3qxs7/LQZZfcrrkUmOdGI/cgUKIkB8pz0xK+CQjKf6z4MWckYftZqsderfsTInsZt0evDRgMRYMHhaLnk+NW1Y/nchxk5lZ+I/Pf/vl9RvbLYiVlSBcJv/VK9sKBCHc3hkF7D12/NzVltZn8YhzNj/3ev6LGeXTdQ6+uzLZ+C+5XNza05Nsd1gXcNgBvekJK/+du3lTUSiXMzzT80TgkkK8wJAGgCMAE5ooFFz3hHTr+lgZ9iMryOngkoi5WZuOc9hPtDu3r4198nTqygjCr3wYmrvVkSerZXljJoT0m0DcYm5g2Mg5WV39zrVWZZofkzaRnhB/bufm9FI/JpXQXj8F8bHyitqWxhzJmwUJT60SNJER+P+BCZjt34lzNbvickRoWVWNmGzuObnYWhER3oAdX41dPbj1jDeYEwGrInltKKCNtatub6hRfJOEnfJkcc+JgE9ltS/DkINuNI3xCo4fbXgm/0CnouvOcjK4Z/16/ZKia+3+kqIrEIQ+sgNx2Jzb5wsPxrD9GBZv+Gd9BqSXr4icg8cwMj4SLmv6+mlv+WddgGlilOPOZkEmFnrLP+sCVgtXyPHaHShkiw0XXPWWf9YF5Gb9uGzp4sCbj7ai4LkNTx2O5nPV3vLPyTeye6P32X+7KNujVKtSYJg+viEu/mx2etJZCgnD57OPfGRh3n8nfizA15j3Av4XAAD//5k1S2w3zfwVAAAAAElFTkSuQmCC",ne=at.create({baseURL:"./",timeout:3e4,headers:{"Content-Type":"application/json"}});ne.interceptors.request.use(t=>t,t=>Promise.reject(t));ne.interceptors.response.use(t=>t,t=>(console.error("API Error:",t),t.response?console.error("Response error:",t.response.data):t.request?console.error("No response received"):console.error("Request setup error:",t.message),Promise.reject(t)));const vt=it("devices",{state:()=>({devices:[],loading:!1,error:null,selectedDevice:null}),getters:{deviceById:t=>m=>t.devices.find(r=>r.id===m),devicesByType:t=>m=>t.devices.filter(r=>r.entity_type===m),deviceCount:t=>t.devices.length,hasDevices:t=>t.devices.length>0},actions:{async loadDevices(t=!1){this.loading=!0,this.error=null;try{const m=t?`/api/devices/managed?_t=${Date.now()}`:"/api/devices/managed",r=await ne.get(m);this.devices=r.data.devices||[],console.log("ğŸ“¥ Loaded devices:",this.devices),this.devices.forEach(w=>{console.log(`ğŸ“¥ Device "${w.name}":`,{id:w.id,device:w.device,commands:w.commands,commandCount:w.commands?Object.keys(w.commands).length:0})})}catch(m){this.error=m.message,console.error("Error loading devices:",m)}finally{this.loading=!1}},async createDevice(t){this.loading=!0,this.error=null;try{console.log("ğŸª Store: Creating device with data:",t),console.log("ğŸª Store: Device commands being sent:",t.commands);const m={device_name:t.name,device:t.device,area_id:t.area||"",area_name:t.area||"",entity_type:t.entity_type,icon:t.icon,broadlink_entity:t.broadlink_entity,device_type:t.device_type||"broadlink",commands:t.commands||{}};t.device_type==="smartir"&&t.smartir_config&&(m.smartir_config=t.smartir_config),console.log("ğŸª Store: Transformed data for backend:",m);const r=await ne.post("/api/devices/managed",m);return console.log("ğŸª Store: Create response:",r.data),await this.loadDevices(),r.data}catch(m){throw console.error("Error creating device:",m),m}finally{this.loading=!1}},async updateDevice(t,m){this.loading=!0,this.error=null;try{const r=await ne.put(`/api/devices/managed/${t}`,m);return await this.loadDevices(),r.data}catch(r){throw console.error("Error updating device:",r),r}finally{this.loading=!1}},async deleteDevice(t,m=!1){this.loading=!0,this.error=null;try{await ne.delete(`/api/devices/managed/${t}`,{data:{delete_commands:m}}),this.devices=this.devices.filter(r=>r.id!==t)}catch(r){throw this.error=r.message,console.error("Error deleting device:",r),r}finally{this.loading=!1}},selectDevice(t){this.selectedDevice=t},clearSelection(){this.selectedDevice=null},clearError(){this.error=null},updateDeviceCommands(t,m){const r=this.devices.findIndex(w=>w.id===t);if(r!==-1){const w={...this.devices[r],commands:m};this.devices.splice(r,1,w),console.log(`âœ… Store: Updated commands for ${t}, count: ${Object.keys(m).length}`)}else console.warn(`âš ï¸ Store: Device ${t} not found for command update`)},async syncAllAreas(){if(!this.devices||this.devices.length===0){console.log("âš ï¸ No devices to sync");return}console.log(`ğŸ”„ Syncing areas from Home Assistant for ${this.devices.length} devices...`);try{const t=await Promise.all(this.devices.map(w=>(console.log(`ğŸ”„ Syncing device: ${w.id} (${w.name})`),ne.post(`/api/devices/${w.id}/sync-area`).then(h=>h.data.success&&h.data.area?(console.log(`âœ… Synced area for ${w.name}: ${h.data.area}`),{status:"synced",device:w.name}):{status:"no_area"}).catch(h=>{var a;return((a=h.response)==null?void 0:a.status)===404?(console.log(`âŒ Device not found in HA: ${w.id}`),{status:"not_found"}):(console.warn(`âš ï¸ Failed to sync area for ${w.id}:`,h.message),{status:"error",error:h.message})})))),m=t.filter(w=>w.status==="synced").length,r=t.filter(w=>w.status==="not_found").length;await this.loadDevices(!0),m>0?console.log(`âœ… Area sync complete: ${m} synced, ${r} not found in HA`):r>0&&console.log(`â„¹ï¸ No areas synced - ${r} entities not found in HA registry (generate entities first)`)}catch(t){console.debug("Area sync error:",t)}}}});function lt(t){const m=K(()=>t.value||t),r=K(()=>{switch(m.value){case"climate":return"mdi:air-conditioner";case"fan":return"mdi:fan";case"light":return"mdi:lightbulb";case"media_player":return"mdi:television";case"switch":return"mdi:light-switch";default:return"mdi:devices"}}),w=K(()=>`device-type-${m.value}-color`),h=K(()=>`tag-${m.value}-bg`);return{icon:r,colorClass:w,tagBgClass:h}}const pt=""+new URL("broadlink-logo-BDjImjRY.png",import.meta.url).href,Ce=(t,m)=>{const r=t.__vccOpts||t;for(const[w,h]of m)r[w]=h;return r},ft={class:"device-header"},gt={class:"device-info"},yt=["title"],bt={class:"device-labels"},ht={class:"device-type"},kt=["src","alt","title"],wt={class:"device-body"},$t={class:"device-stats"},Ct={class:"stat",title:"Learned command count"},_t={class:"stat",title:"HA Assigned Area"},St={class:"device-meta"},It={class:"device-id",title:"Device ID"},Dt={key:0,class:"storage-name"},xt={key:1,class:"broadlink-entity",title:"Controller Device"},Tt={key:2,class:"controller-device"},Mt={class:"device-actions"},Rt=["disabled"],Lt=["disabled"],At=["disabled"],Ot={key:0,class:"disabled-overlay"},Et={__name:"DeviceCard",props:{device:{type:Object,required:!0},broadlinkDevices:{type:Array,default:()=>[]}},emits:["edit","delete","learn"],setup(t){const m=t,r=K(()=>localStorage.getItem("smartir_simulate_not_installed")==="true"),w=K(()=>m.device.device_type==="smartir"&&r.value),h=g(null),a=lt(K(()=>m.device.entity_type)),u=K(()=>m.device.icon?m.device.icon:a.icon.value),f=s=>s&&s.startsWith("mdi:")?`mdi ${s.replace(":"," mdi-")}`:`mdi mdi-${s}`,S=K(()=>({light:"Light",fan:"Fan",switch:"Switch",media_player:"Media Player",cover:"Cover"})[m.device.entity_type]||m.device.entity_type),C=K(()=>(m.device.device_type||"broadlink")==="smartir"?"SmartIR":"Broadlink"),O=K(()=>(m.device.device_type||"broadlink")==="smartir"?Ye:pt),$=K(()=>(m.device.device_type||"broadlink")==="smartir"?h.value!==null?h.value:0:Object.keys(m.device.commands||{}).length),o=s=>{if(!s)return"";const b=m.broadlinkDevices.find(p=>p.entity_id===s);return b&&b.name||s},T=K(()=>{if(!m.device.device)return!1;const s=m.device.id.includes(".")?m.device.id.split(".")[1]:m.device.id;return m.device.device!==s}),q=K(()=>{if(!m.device.broadlink_entity)return"";const s=m.broadlinkDevices.find(b=>b.entity_id===m.device.broadlink_entity);return s&&s.name||m.device.broadlink_entity}),U=s=>{if(!s||typeof s!="object")return 0;let b=0;for(const p of Object.values(s))typeof p=="string"?b++:typeof p=="object"&&(b+=U(p));return b},I=async()=>{if(!(!m.device.device_code||!m.device.entity_type))try{const s=await ne.get("/api/smartir/codes/code",{params:{entity_type:m.device.entity_type,code_id:m.device.device_code}});if(s.data.success&&s.data.code){const b=s.data.code;b.commands&&(h.value=U(b.commands))}}catch(s){console.error("Error fetching SmartIR command count:",s)}};return Ae(async()=>{(m.device.device_type||"broadlink")==="smartir"&&await I()}),(s,b)=>(l(),n("div",{class:Y(["device-card",{disabled:w.value}])},[e("div",ft,[e("div",{class:Y(["device-icon",_e(a).colorClass.value])},[e("i",{class:Y(f(u.value))},null,2)],2),e("div",gt,[e("h3",{title:t.device.name},c(t.device.name),9,yt),e("div",bt,[e("span",ht,c(S.value),1)])]),e("img",{src:O.value,alt:C.value,title:C.value,class:"device-source-logo"},null,8,kt)]),e("div",wt,[e("div",$t,[e("div",Ct,[b[3]||(b[3]=e("i",{class:"mdi mdi-remote"},null,-1)),e("span",null,c($.value)+" command"+c($.value!==1?"s":""),1)]),e("div",_t,[b[4]||(b[4]=e("i",{class:"mdi mdi-map-marker"},null,-1)),e("span",null,c(t.device.area||"No area"),1)])]),e("div",St,[e("span",It,[b[5]||(b[5]=e("i",{class:"mdi mdi-identifier"},null,-1)),x(" "+c(t.device.id),1)]),T.value?(l(),n("span",Dt,[b[6]||(b[6]=e("i",{class:"mdi mdi-code-tags"},null,-1)),x(" "+c(t.device.device),1)])):R("",!0),t.device.broadlink_entity?(l(),n("span",xt,[b[7]||(b[7]=e("i",{class:"mdi mdi-access-point"},null,-1)),x(" "+c(q.value),1)])):R("",!0),t.device.controller_device?(l(),n("span",Tt,[b[8]||(b[8]=e("i",{class:"mdi mdi-access-point"},null,-1)),x(" "+c(o(t.device.controller_device)),1)])):R("",!0)])]),e("div",Mt,[e("button",{onClick:b[0]||(b[0]=p=>!w.value&&s.$emit("learn",t.device)),class:"icon-btn",title:"Manage Commands",disabled:w.value},[...b[9]||(b[9]=[e("i",{class:"mdi mdi-remote-tv"},null,-1)])],8,Rt),e("button",{onClick:b[1]||(b[1]=p=>!w.value&&s.$emit("edit",t.device)),class:"icon-btn",title:"Edit",disabled:w.value},[...b[10]||(b[10]=[e("i",{class:"mdi mdi-pencil"},null,-1)])],8,Lt),e("button",{onClick:b[2]||(b[2]=p=>!w.value&&s.$emit("delete",t.device)),class:"icon-btn danger",title:"Delete",disabled:w.value},[...b[11]||(b[11]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,At)]),w.value?(l(),n("div",Ot,[...b[12]||(b[12]=[e("div",{class:"disabled-message"},[e("i",{class:"mdi mdi-eye-off"}),e("span",null,"SmartIR Not Installed")],-1)])])):R("",!0)],2))}},Vt=Ce(Et,[["__scopeId","data-v-7a7f5c18"]]),Pt={name:"DeviceListView",props:{devices:{type:Array,required:!0}},methods:{getDeviceCommands(t){return t.commands&&typeof t.commands=="object"?Object.keys(t.commands):[]},sendCommand(t,m){this.$emit("send-command",{device:t,command:m})},editDevice(t){this.$emit("edit-device",t)},deleteDevice(t){this.$emit("delete-device",t)}}},Ut={class:"device-list-view"},jt={class:"device-table"},Ft={class:"device-info"},Nt={class:"device-name"},Bt={class:"device-entity"},Ht={class:"device-area"},qt={class:"device-type"},zt={class:"device-commands"},Jt={key:0,class:"command-list"},Wt=["onClick"],Kt={key:0,class:"no-commands"},Xt={key:1,class:"smartir-info"},Gt={class:"profile-code"},Yt={class:"device-actions"},Zt=["onClick"],Qt=["onClick"];function eo(t,m,r,w,h,a){return l(),n("div",Ut,[e("table",jt,[m[2]||(m[2]=e("thead",null,[e("tr",null,[e("th",null,"Device"),e("th",null,"Room/Area"),e("th",null,"Type"),e("th",null,"Commands"),e("th",null,"Actions")])],-1)),e("tbody",null,[(l(!0),n(fe,null,$e(r.devices,u=>(l(),n("tr",{key:u.entity_id,class:"device-row"},[e("td",Ft,[e("div",Nt,c(u.friendly_name||u.name),1),e("div",Bt,c(u.entity_id),1)]),e("td",Ht,c(u.area||"No Area"),1),e("td",qt,[e("span",{class:Y(["type-badge",u.device_type||"broadlink"])},c(u.device_type==="smartir"?"SmartIR":"Broadlink"),3)]),e("td",zt,[(u.device_type||"broadlink")==="broadlink"?(l(),n("div",Jt,[(l(!0),n(fe,null,$e(a.getDeviceCommands(u),f=>(l(),n("button",{key:f,class:"command-btn",onClick:S=>a.sendCommand(u,f)},c(f),9,Wt))),128)),a.getDeviceCommands(u).length===0?(l(),n("span",Kt," No commands ")):R("",!0)])):u.device_type==="smartir"?(l(),n("div",Xt,[e("span",Gt,"Profile: "+c(u.device_code),1)])):R("",!0)]),e("td",Yt,[e("button",{class:"action-btn edit",onClick:f=>a.editDevice(u),title:"Edit"},[...m[0]||(m[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})],-1)])],8,Zt),e("button",{class:"action-btn delete",onClick:f=>a.deleteDevice(u),title:"Delete"},[...m[1]||(m[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"3 6 5 6 21 6"}),e("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})],-1)])],8,Qt)])]))),128))])])])}const to=Ce(Pt,[["render",eo],["__scopeId","data-v-d1ca6f69"]]),oo={class:"icon-picker"},lo={class:"icon-input-wrapper"},no=["id","placeholder"],so={key:0,class:"icon-preview"},ao={key:0,class:"icon-dropdown"},io={class:"icon-grid"},ro=["onMousedown","title"],uo={__name:"IconPicker",props:{modelValue:{type:String,default:""},inputId:{type:String,default:"icon-input"},placeholder:{type:String,default:"e.g., mdi:television"}},emits:["update:modelValue"],setup(t,{emit:m}){const r=t,w=m,h=g(r.modelValue),a=g(!1),u=["television","speaker","radio","music","video","movie","play","pause","stop","skip-next","skip-previous","volume-high","volume-medium","volume-low","volume-off","remote","remote-tv","cast","chromecast","spotify","netflix","youtube","lightbulb","lightbulb-on","lightbulb-off","lamp","floor-lamp","ceiling-light","light-switch","led-strip","led-strip-variant","wall-sconce","chandelier","spotlight","track-light","vanity-light","desk-lamp","fan","ceiling-fan","air-conditioner","thermometer","thermostat","heat-wave","snowflake","fire","radiator","water-boiler","hvac","blinds","blinds-open","window-shutter","window-shutter-open","curtains","curtains-closed","roller-shade","roller-shade-closed","garage","garage-open","gate","door","door-open","window-open","window-closed","washing-machine","tumble-dryer","dishwasher","refrigerator","stove","microwave","oven","toaster","kettle","coffee","coffee-maker","blender","robot-vacuum","robot-vacuum-variant","vacuum","broom","spray-bottle","lock","lock-open","lock-smart","key","shield","shield-check","alarm-light","bell","doorbell","camera","cctv","motion-sensor","smoke-detector","fire-extinguisher","water-alert","gas-cylinder","sofa","bed","bed-double","desk","chair","table","bookshelf","home","home-outline","home-assistant","floor-plan","room","weather-sunny","weather-night","weather-cloudy","weather-rainy","weather-snowy","weather-lightning","weather-windy","weather-fog","weather-partly-cloudy","umbrella","water","water-percent","phone","cellphone","tablet","laptop","desktop-tower","monitor","keyboard","mouse","printer","router","router-wireless","access-point","wifi","bluetooth","usb","hdmi-port","ethernet","power","power-plug","power-socket","battery","battery-charging","lightning-bolt","flash","solar-panel","solar-power","leaf","tree","flower","sprout","grass","watering-can","shovel","fence","pool","hot-tub","silverware","silverware-fork-knife","food","food-apple","glass-wine","glass-cocktail","bottle-wine","pot","pot-steam","shower","shower-head","bathtub","toilet","sink","faucet","hand-wash","car","car-side","garage-variant","tools","hammer","wrench","screwdriver","toolbox","ladder","heart","heart-pulse","run","walk","bike","dumbbell","yoga","scale-bathroom","thermometer-lines","clock","clock-outline","timer","alarm","calendar","calendar-today","calendar-clock","history","bell-ring","bell-alert","alert","alert-circle","information","help-circle","check","check-circle","close-circle","minus-circle","plus-circle","arrow-up","arrow-down","arrow-left","arrow-right","chevron-up","chevron-down","menu","dots-vertical","dots-horizontal","cog","tune","circle","square","triangle","hexagon","star","star-outline","heart-outline","plus","minus","close","check-bold","eye","eye-off","account","account-group","baby","dog","cat","paw","gift","balloon","party-popper","candle","book","book-open","newspaper","email","message","phone-classic"];de(()=>r.modelValue,$=>{h.value=$});const f=K(()=>{if(!h.value)return u.slice(0,50);const $=h.value.toLowerCase().replace("mdi:","");return u.filter(o=>o.toLowerCase().includes($)).slice(0,50)}),S=()=>{a.value=!0,w("update:modelValue",h.value)},C=()=>{setTimeout(()=>{a.value=!1},200)},O=$=>{h.value=`mdi:${$}`,w("update:modelValue",h.value),a.value=!1};return($,o)=>(l(),n("div",oo,[e("div",lo,[X(e("input",{id:t.inputId,"onUpdate:modelValue":o[0]||(o[0]=T=>h.value=T),type:"text",placeholder:t.placeholder,onInput:S,onFocus:o[1]||(o[1]=T=>a.value=!0),onBlur:C},null,40,no),[[Le,h.value]]),h.value?(l(),n("div",so,[e("i",{class:Y(`mdi mdi-${h.value.replace("mdi:","")}`)},null,2)])):R("",!0)]),a.value&&f.value.length>0?(l(),n("div",ao,[e("div",io,[(l(!0),n(fe,null,$e(f.value,T=>(l(),n("div",{key:T,class:"icon-option",onMousedown:me(q=>O(T),["prevent"]),title:T},[e("i",{class:Y(`mdi mdi-${T}`)},null,2),e("span",null,c(T),1)],40,ro))),128))])])):R("",!0)]))}},co=Ce(uo,[["__scopeId","data-v-a64f5011"]]),mo={key:0,class:"dropdown-label"},vo={key:0,class:"required"},po=["placeholder","disabled","onKeydown"],fo={class:"dropdown-icons"},go={key:0,class:"mdi mdi-loading mdi-spin"},yo={key:2,class:"mdi mdi-chevron-down"},bo={key:1,class:"error-message"},ho={key:2,class:"hint-message"},ko={key:0,class:"dropdown-menu"},wo=["onMousedown","onMouseenter"],$o={class:"option-content"},Co={class:"option-label"},_o={key:0,class:"option-description"},So={key:0,class:"mdi mdi-check selected-icon"},Io={key:3,class:"dropdown-menu"},Do={__name:"SearchableDropdown",props:{modelValue:{type:[String,Number,Object],default:null},options:{type:Array,required:!0,default:()=>[]},label:{type:String,default:""},placeholder:{type:String,default:"Search..."},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},error:{type:String,default:""},hint:{type:String,default:""},optionLabel:{type:String,default:"label"},optionValue:{type:String,default:"value"},optionDescription:{type:String,default:"description"},filterMethod:{type:Function,default:null}},emits:["update:modelValue","change","search"],setup(t,{emit:m}){const r=t,w=m,h=g(null),a=g(null),u=g(""),f=g(!1),S=g(0),C=g(!1),O=A=>typeof A=="string"||typeof A=="number"?A:A[r.optionLabel]||A.label||A.name||String(A),$=A=>typeof A=="string"||typeof A=="number"?A:A[r.optionValue]||A.value||A.id||A,o=A=>typeof A=="string"||typeof A=="number"?"":A[r.optionDescription]||A.description||"",T=A=>{const N=$(A);return typeof r.modelValue=="object"?$(r.modelValue)===N:r.modelValue===N},q=K(()=>{if(!u.value)return r.options;if(r.filterMethod)return r.options.filter(N=>r.filterMethod(N,u.value));const A=u.value.toLowerCase();return r.options.filter(N=>{const oe=O(N).toLowerCase(),ce=o(N).toLowerCase();return oe.includes(A)||ce.includes(A)})}),U=K(()=>{if(!r.modelValue)return"";const A=r.options.find(N=>{const oe=$(N);return typeof r.modelValue=="object"?oe===$(r.modelValue):oe===r.modelValue});return A?O(A):""});de(()=>r.modelValue,A=>{C.value||(u.value=U.value)}),de(()=>r.options,()=>{!C.value&&r.modelValue&&(u.value=U.value)},{deep:!0}),de(u,A=>{w("search",A),S.value=0}),Ae(()=>{u.value=U.value});const I=()=>{var A;C.value=!0,f.value=!0,(A=a.value)==null||A.select()},s=()=>{C.value=!1,setTimeout(()=>{f.value=!1,r.modelValue?u.value=U.value:u.value=""},200)},b=()=>{var A;f.value=!1,(A=a.value)==null||A.blur()},p=A=>{const N=$(A);w("update:modelValue",N),w("change",N,A),u.value=O(A),b()},L=()=>{var A;w("update:modelValue",null),w("change",null,null),u.value="",(A=a.value)==null||A.focus()},J=()=>{if(!f.value){f.value=!0;return}S.value<q.value.length-1&&S.value++},Z=()=>{S.value>0&&S.value--},B=()=>{q.value.length>0&&S.value>=0&&p(q.value[S.value])},ae=A=>{h.value&&!h.value.contains(A.target)&&(f.value=!1,r.modelValue?u.value=U.value:u.value="")};return Ae(()=>{document.addEventListener("click",ae)}),Ke(()=>{document.removeEventListener("click",ae)}),(A,N)=>(l(),n("div",{class:"searchable-dropdown",ref_key:"dropdownRef",ref:h},[t.label?(l(),n("label",mo,[x(c(t.label)+" ",1),t.required?(l(),n("span",vo,"*")):R("",!0)])):R("",!0),e("div",{class:Y(["dropdown-input-wrapper",{"has-error":t.error,disabled:t.disabled}])},[X(e("input",{ref_key:"inputRef",ref:a,type:"text","onUpdate:modelValue":N[0]||(N[0]=oe=>u.value=oe),placeholder:t.placeholder,disabled:t.disabled||t.loading,onFocus:I,onBlur:s,onKeydown:[Be(me(J,["prevent"]),["down"]),Be(me(Z,["prevent"]),["up"]),Be(me(B,["prevent"]),["enter"]),Be(b,["escape"])],class:"dropdown-input"},null,40,po),[[Le,u.value]]),e("div",fo,[t.loading?(l(),n("i",go)):t.modelValue&&!t.disabled?(l(),n("i",{key:1,class:"mdi mdi-close-circle clear-icon",onClick:L})):(l(),n("i",yo))])],2),t.error?(l(),n("div",bo,c(t.error),1)):R("",!0),t.hint&&!t.error?(l(),n("div",ho,c(t.hint),1)):R("",!0),ke(et,{name:"dropdown"},{default:Xe(()=>[f.value&&q.value.length>0?(l(),n("div",ko,[(l(!0),n(fe,null,$e(q.value,(oe,ce)=>(l(),n("div",{key:$(oe),class:Y(["dropdown-item",{highlighted:ce===S.value,selected:T(oe)}]),onMousedown:me(we=>p(oe),["prevent"]),onMouseenter:we=>S.value=ce},[e("div",$o,[e("div",Co,c(O(oe)),1),o(oe)?(l(),n("div",_o,c(o(oe)),1)):R("",!0)]),T(oe)?(l(),n("i",So)):R("",!0)],42,wo))),128))])):R("",!0)]),_:1}),f.value&&q.value.length===0&&!t.loading?(l(),n("div",Io,[...N[1]||(N[1]=[e("div",{class:"dropdown-item no-results"},[e("i",{class:"mdi mdi-magnify"}),x(" No results found ")],-1)])])):R("",!0)],512))}},Je=Ce(Do,[["__scopeId","data-v-679ce35f"]]),xo={class:"smartir-selector"},To={class:"form-group"},Mo={class:"form-group"},Ro={class:"form-group"},Lo=["value"],Ao={key:0,class:"error-message"},Oo={class:"form-group"},Eo={class:"form-group"},Vo={key:1,class:"code-info"},Po={class:"info-content"},Uo={class:"info-row"},jo={class:"info-value"},Fo={class:"info-row"},No={class:"info-value"},Bo={key:0,class:"info-row"},Ho={class:"info-value"},qo={class:"info-row"},zo={class:"info-value"},Jo={__name:"SmartIRDeviceSelector",props:{entityType:{type:String,required:!0},modelValue:{type:Object,default:()=>({})},broadlinkDevices:{type:Array,default:()=>[]}},emits:["update:modelValue","change"],setup(t,{expose:m,emit:r}){const w=t,h=r,a=g([]),u=g([]),f=g(""),S=g(""),C=g(""),O=g(""),$=g(""),o=g(null),T=g(!1),q=g(!1),U=g({manufacturer:"",model:"",controller:""});Ae(async()=>{if(await I(),w.modelValue&&(f.value=w.modelValue.manufacturer||"",S.value=w.modelValue.device_code||"",C.value=w.modelValue.controller_device||"",O.value=w.modelValue.temperature_sensor||"",$.value=w.modelValue.humidity_sensor||"",f.value&&(await s(f.value),S.value&&u.value.length>0))){const A=u.value.find(N=>N.code===S.value);A&&(o.value={code:A.code,manufacturer:f.value,models:A.models,controller:A.controller})}}),de(()=>w.entityType,async A=>{A&&(f.value="",S.value="",u.value=[],o.value=null,await I())});const I=async()=>{if(w.entityType){T.value=!0,U.value.manufacturer="";try{const A=await ne.get("/api/smartir/codes/manufacturers",{params:{entity_type:w.entityType}});if(A.data.success)a.value=A.data.manufacturers||[];else throw new Error(A.data.error||"Failed to load manufacturers")}catch(A){console.error("Error loading manufacturers:",A),U.value.manufacturer="Failed to load manufacturers. Please try again.",a.value=[]}finally{T.value=!1}}},s=async A=>{if(!(!A||!w.entityType)){q.value=!0,U.value.model="";try{const N=await ne.get("/api/smartir/codes/models",{params:{entity_type:w.entityType,manufacturer:A}});if(N.data.success){const oe=N.data.models||[];u.value=oe.map(ce=>{const we=ce.models&&ce.models.length>0?ce.models.join(", "):`Code ${ce.code}`;return{code:ce.code,label:we,description:`Code: ${ce.code}`,models:ce.models,controller:ce.controller}})}else throw new Error(N.data.error||"Failed to load models")}catch(N){console.error("Error loading models:",N),U.value.model="Failed to load models. Please try again.",u.value=[]}finally{q.value=!1}}},b=async A=>{f.value=A,S.value="",o.value=null,u.value=[],A&&await s(A),B()},p=()=>{const A=u.value.find(N=>N.code===S.value);A&&(o.value={code:A.code,manufacturer:f.value,models:A.models,controller:A.controller}),B()},L=()=>{B()},J=()=>{B()},Z=()=>{B()},B=()=>{var N,oe;const A={manufacturer:f.value,model:((oe=(N=o.value)==null?void 0:N.models)==null?void 0:oe[0])||"",device_code:S.value,controller_device:C.value};w.entityType==="climate"&&(O.value&&(A.temperature_sensor=O.value),$.value&&(A.humidity_sensor=$.value)),h("update:modelValue",A),h("change",A)};return m({validate:()=>{let A=!0;return U.value={manufacturer:"",model:"",controller:""},f.value||(U.value.manufacturer="Manufacturer is required",A=!1),S.value||(U.value.model="Model is required",A=!1),C.value||(U.value.controller="Broadlink controller is required",A=!1),A}}),(A,N)=>(l(),n("div",xo,[e("div",To,[ke(Je,{modelValue:f.value,"onUpdate:modelValue":N[0]||(N[0]=oe=>f.value=oe),options:a.value,label:"Manufacturer",placeholder:"Search manufacturers...",required:"",loading:T.value,error:U.value.manufacturer,hint:"Select the device manufacturer",onChange:b},null,8,["modelValue","options","loading","error"])]),e("div",Mo,[ke(Je,{modelValue:S.value,"onUpdate:modelValue":N[1]||(N[1]=oe=>S.value=oe),options:u.value,"option-label":"label","option-value":"code","option-description":"description",label:"Model",placeholder:"Search models...",required:"",disabled:!f.value,loading:q.value,error:U.value.model,hint:"Select the device model",onChange:p},null,8,["modelValue","options","disabled","loading","error"])]),e("div",Ro,[N[6]||(N[6]=e("label",{for:"controller-device"},[e("i",{class:"mdi mdi-remote"}),x(" Controller Device * ")],-1)),X(e("select",{id:"controller-device","onUpdate:modelValue":N[2]||(N[2]=oe=>C.value=oe),required:"",onChange:L},[N[5]||(N[5]=e("option",{value:""},"-- Select Controller Device --",-1)),(l(!0),n(fe,null,$e(t.broadlinkDevices,oe=>(l(),n("option",{key:oe.entity_id,value:oe.entity_id},[x(c(oe.name||oe.entity_id)+" ",1),oe.area_name?(l(),n(fe,{key:0},[x(" - "+c(oe.area_name),1)],64)):R("",!0)],8,Lo))),128))],544),[[De,C.value]]),N[7]||(N[7]=e("small",null,"Which remote device will send the IR/RF commands",-1)),U.value.controller?(l(),n("div",Ao,c(U.value.controller),1)):R("",!0)]),t.entityType==="climate"?(l(),n(fe,{key:0},[e("div",Oo,[N[8]||(N[8]=e("label",{for:"temperature-sensor"},"Temperature Sensor",-1)),X(e("input",{id:"temperature-sensor","onUpdate:modelValue":N[3]||(N[3]=oe=>O.value=oe),type:"text",placeholder:"e.g., sensor.living_room_temperature",onInput:J},null,544),[[Le,O.value]]),N[9]||(N[9]=e("small",null,"Optional: Temperature sensor entity for current temperature",-1))]),e("div",Eo,[N[10]||(N[10]=e("label",{for:"humidity-sensor"},"Humidity Sensor",-1)),X(e("input",{id:"humidity-sensor","onUpdate:modelValue":N[4]||(N[4]=oe=>$.value=oe),type:"text",placeholder:"e.g., sensor.living_room_humidity",onInput:Z},null,544),[[Le,$.value]]),N[11]||(N[11]=e("small",null,"Optional: Humidity sensor entity for current humidity",-1))])],64)):R("",!0),o.value?(l(),n("div",Vo,[N[16]||(N[16]=e("div",{class:"info-header"},[e("i",{class:"mdi mdi-information"}),e("span",null,"Selected Device Code")],-1)),e("div",Po,[e("div",Uo,[N[12]||(N[12]=e("span",{class:"info-label"},"Code ID:",-1)),e("span",jo,c(o.value.code_id),1)]),e("div",Fo,[N[13]||(N[13]=e("span",{class:"info-label"},"Manufacturer:",-1)),e("span",No,c(o.value.manufacturer),1)]),o.value.models&&o.value.models.length>0?(l(),n("div",Bo,[N[14]||(N[14]=e("span",{class:"info-label"},"Supported Models:",-1)),e("span",Ho,c(o.value.models.join(", ")),1)])):R("",!0),e("div",qo,[N[15]||(N[15]=e("span",{class:"info-label"},"Controller:",-1)),e("span",zo,c(o.value.controller||"Broadlink"),1)])])])):R("",!0)]))}},Wo=Ce(Jo,[["__scopeId","data-v-1911c8f6"]]),Ko={class:"modal-content"},Xo={class:"modal-header"},Go={class:"input-wrapper"},Yo={key:0,class:"validation-tooltip"},Zo={class:"input-wrapper"},Qo=["disabled"],el={key:0,class:"validation-tooltip"},tl={key:0,class:"smartir-notice"},ol={key:0,class:"notice-success"},ll={key:1,class:"notice-warning"},nl={key:1,class:"smartir-notice"},sl={key:2},al={class:"form-group"},il=["disabled"],rl=["disabled"],dl={key:0},ul={key:1},cl={key:2},ml={key:3},vl={key:0,class:"form-group"},pl={class:"area-display-readonly"},fl=["value"],gl=["disabled"],yl=["href"],bl={key:1,class:"form-group"},hl={class:"form-group"},kl={class:"input-wrapper"},wl=["value"],$l=["value"],Cl={key:2,class:"validation-tooltip"},_l={key:0},Sl={key:1},Il={key:3,class:"smartir-section"},Dl={class:"modal-footer"},xl={type:"submit",form:"device-form",class:"btn btn-primary"},Tl={__name:"DeviceForm",props:{device:{type:Object,default:null}},emits:["save","cancel"],setup(t,{emit:m}){const r=t,w=m,h=Te("smartirStatus"),a=Te("smartirEnabled"),u=K(()=>{var d;return localStorage.getItem("smartir_simulate_not_installed")==="true"?!1:((d=h==null?void 0:h.value)==null?void 0:d.installed)||!1}),f=K(()=>!!r.device),S=K(()=>["climate","media_player","fan","light"].includes(o.value.entity_type)),C=K(()=>u.value?!S.value&&o.value.entity_type?"(Not supported for this type)":"(Pre-configured Codes)":"(Requires SmartIR)"),O=K(()=>{var d;const D=((d=r.device)==null?void 0:d.commands)||{};return Object.keys(D).length>0}),$=K(()=>{if(!o.value.broadlink_entity)return"";const D=s.value.find(d=>d.entity_id===o.value.broadlink_entity);return D&&D.name||o.value.broadlink_entity}),o=g({name:"",entity_type:"",device_type:"broadlink",device:"",area:"",icon:"",broadlink_entity:"",enabled:!0,commands:{}}),T=g({name:"",entity_type:"",broadlink_entity:""}),q=g({}),U=g(null),I=g([]),s=g([]),b=g(null),p=g(null),L=g(null),J=g(!1);Ae(async()=>{r.device&&(o.value={...r.device,device_type:r.device.device_type||"broadlink"},o.value.device_type==="smartir"&&(q.value={manufacturer:r.device.manufacturer,model:r.device.model,device_code:r.device.device_code,controller_device:r.device.controller_device,temperature_sensor:r.device.temperature_sensor,humidity_sensor:r.device.humidity_sensor})),await Promise.all([Z(),B()])});const Z=async()=>{try{const D=await ne.get("/api/areas");I.value=D.data.areas||[]}catch(D){console.error("Error loading areas:",D),I.value=[]}},B=async()=>{try{const d=(await ne.get("/api/remote/devices")).data.devices||[];s.value=d,console.log("Loaded remote devices:",d)}catch(D){console.error("Error loading remote devices:",D),s.value=[]}},ae=D=>{if(!D)return"";const d=D.toLowerCase();for(const V of I.value){const ve=V.toLowerCase();if(d.includes(ve))return V}return""},A=(D,d="")=>{const V=d.toLowerCase();return V.includes("tv")?"mdi:television":V.includes("lamp")?"mdi:lamp":V.includes("ceiling")?"mdi:ceiling-light":V.includes("floor")?"mdi:floor-lamp":V.includes("desk")?"mdi:desk-lamp":V.includes("fan")?"mdi:fan":V.includes("ac")||V.includes("air con")?"mdi:air-conditioner":V.includes("heater")?"mdi:radiator":V.includes("blind")?"mdi:blinds":V.includes("curtain")?"mdi:curtains":V.includes("garage")?"mdi:garage":V.includes("speaker")||V.includes("stereo")?"mdi:speaker":V.includes("receiver")?"mdi:audio-video":{light:"mdi:lightbulb",fan:"mdi:fan",switch:"mdi:light-switch",media_player:"mdi:television",cover:"mdi:window-shutter",climate:"mdi:thermostat"}[D]||"mdi:devices"};de(()=>o.value.name,D=>{if(!f.value&&D&&!o.value.area){const d=ae(D);d&&(o.value.area=d)}!f.value&&D&&o.value.entity_type&&(J.value||!o.value.icon)&&(o.value.icon=A(o.value.entity_type,D),J.value=!0)}),de(()=>o.value.entity_type,D=>{!f.value&&D&&(J.value||!o.value.icon)&&(o.value.icon=A(D,o.value.name),J.value=!0)}),de(()=>o.value.icon,(D,d)=>{d!==void 0&&D!==d&&!J.value&&(J.value=!1),D||(J.value=!1)});const N=g(!1),oe=async()=>{var D;if((D=r.device)!=null&&D.id){N.value=!0;try{const d=await ne.post(`/api/devices/${r.device.id}/sync-area`);d.data.success?(o.value.area=d.data.area||"",d.data.area?console.log(`Area synced: ${d.data.area}`):console.log("No area assigned in Home Assistant")):console.warn(d.data.message||"Entity not found in HA")}catch(d){console.error("Failed to sync area:",d)}finally{N.value=!1}}},ce=()=>{var V;return!((V=r.device)!=null&&V.id)||!o.value.entity_type?"#":`/config/entities/entity/${`${o.value.entity_type}.${r.device.id}`}`},we=()=>{T.value={name:"",entity_type:"",broadlink_entity:""};let D=!0;return(!o.value.name||o.value.name.trim()==="")&&(T.value.name="Device name is required",D=!1),o.value.entity_type||(T.value.entity_type="Entity type is required",D=!1),o.value.device_type==="broadlink"&&!o.value.broadlink_entity&&(T.value.broadlink_entity="Broadlink device is required",D=!1),D},Se=D=>{T.value[D]=""},Me=async()=>{if(o.value.device_type==="smartir"){if(U.value&&!U.value.validate())return;const D={...o.value,smartir_config:{manufacturer:q.value.manufacturer,model:q.value.model,code_id:q.value.device_code,controller_device:q.value.controller_device}};w("save",D)}else{if(!we())return;w("save",{...o.value})}},xe=D=>{q.value=D};return(D,d)=>(l(),n("div",{class:"modal-overlay",onClick:d[11]||(d[11]=me(V=>D.$emit("cancel"),["self"]))},[e("div",Ko,[e("div",Xo,[e("h2",null,c(f.value?"Edit Device":"Add New Device"),1),e("button",{onClick:d[0]||(d[0]=V=>D.$emit("cancel")),class:"close-btn"},[...d[12]||(d[12]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("form",{id:"device-form",onSubmit:me(Me,["prevent"]),class:"modal-body"},[e("div",{class:Y(["form-group",{"has-error":T.value.name}])},[d[14]||(d[14]=e("label",{for:"device-name"},"Device Name *",-1)),e("div",Go,[X(e("input",{id:"device-name",ref_key:"nameInput",ref:b,"onUpdate:modelValue":d[1]||(d[1]=V=>o.value.name=V),type:"text",placeholder:"e.g., Living Room TV",onInput:d[2]||(d[2]=V=>Se("name"))},null,544),[[Le,o.value.name]]),T.value.name?(l(),n("div",Yo,[d[13]||(d[13]=e("i",{class:"mdi mdi-alert"},null,-1)),x(" "+c(T.value.name),1)])):R("",!0)]),d[15]||(d[15]=e("small",null,"Friendly name for this device",-1))],2),e("div",{class:Y(["form-group",{"has-error":T.value.entity_type}])},[d[23]||(d[23]=e("label",{for:"entity-type"},"Entity Type *",-1)),e("div",Zo,[X(e("select",{id:"entity-type",ref_key:"typeSelect",ref:p,"onUpdate:modelValue":d[3]||(d[3]=V=>o.value.entity_type=V),onChange:d[4]||(d[4]=V=>Se("entity_type"))},[d[16]||(d[16]=Ue('<option value="" data-v-94bc1fe5>-- Select Type --</option><option value="light" data-v-94bc1fe5>ğŸ’¡ Light</option><option value="fan" data-v-94bc1fe5>ğŸŒ€ Fan</option><option value="switch" data-v-94bc1fe5>ğŸ”Œ Switch</option><option value="media_player" data-v-94bc1fe5>ğŸ“º Media Player</option><option value="cover" data-v-94bc1fe5>ğŸªŸ Cover (Blinds/Curtains)</option>',6)),e("option",{value:"climate",disabled:!u.value}," ğŸŒ¡ï¸ Climate "+c(u.value?"":"(Requires SmartIR)"),9,Qo)],544),[[De,o.value.entity_type]]),T.value.entity_type?(l(),n("div",el,[d[17]||(d[17]=e("i",{class:"mdi mdi-alert"},null,-1)),x(" "+c(T.value.entity_type),1)])):R("",!0)]),o.value.entity_type==="climate"?(l(),n("div",tl,[u.value?(l(),n("div",ol,[...d[18]||(d[18]=[e("i",{class:"mdi mdi-check-circle"},null,-1),e("span",null,"SmartIR detected! Climate entities will be created via SmartIR profiles.",-1)])])):(l(),n("div",ll,[...d[19]||(d[19]=[e("i",{class:"mdi mdi-alert"},null,-1),e("div",null,[e("strong",null,"SmartIR Required"),e("p",null,"Climate entities (AC, heaters) require SmartIR integration."),e("a",{href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"smartir-link"}," Install SmartIR â†’ ")],-1)])]))])):u.value&&["media_player","fan","light"].includes(o.value.entity_type)?(l(),n("div",nl,[...d[20]||(d[20]=[e("div",{class:"notice-info"},[e("i",{class:"mdi mdi-information"}),e("span",null,"ğŸ’¡ SmartIR available! You can use pre-configured codes or learn your own.")],-1)])])):!u.value&&o.value.entity_type?(l(),n("small",sl,[d[21]||(d[21]=x(" ğŸ’¡ Tip: Install ",-1)),d[22]||(d[22]=e("a",{href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"inline-link"},"SmartIR",-1)),x(" for pre-configured "+c(o.value.entity_type==="climate"?"climate":o.value.entity_type)+" device codes ",1)])):R("",!0)],2),e("div",al,[d[26]||(d[26]=e("label",{for:"device-type"},"Device Type *",-1)),X(e("select",{id:"device-type","onUpdate:modelValue":d[5]||(d[5]=V=>o.value.device_type=V),required:"",disabled:f.value},[d[24]||(d[24]=e("option",{value:""},"-- Select Device Type --",-1)),d[25]||(d[25]=e("option",{value:"broadlink"},"ğŸ“¡ Broadlink Device (Learn IR Codes)",-1)),_e(a)?(l(),n("option",{key:0,value:"smartir",disabled:!u.value||!S.value}," ğŸŒ SmartIR Device "+c(C.value),9,rl)):R("",!0)],8,il),[[De,o.value.device_type]]),f.value?(l(),n("small",dl,"Cannot change device type after creation")):o.value.device_type==="smartir"?(l(),n("small",ul,"Using pre-configured codes from SmartIR repository")):o.value.device_type==="broadlink"?(l(),n("small",cl,"Learn and store your own IR codes")):(l(),n("small",ml,"Choose how to configure this device"))]),f.value?(l(),n("div",vl,[d[29]||(d[29]=e("label",{for:"device-area"},"Area",-1)),e("div",pl,[e("input",{id:"device-area",value:o.value.area||"Not assigned",type:"text",readonly:"",class:"readonly-input"},null,8,fl),e("button",{type:"button",onClick:oe,disabled:N.value,class:"sync-area-btn",title:"Sync area from Home Assistant"},[e("i",{class:Y(N.value?"mdi mdi-loading mdi-spin":"mdi mdi-refresh")},null,2)],8,gl)]),e("small",null,[d[27]||(d[27]=e("i",{class:"mdi mdi-information-outline"},null,-1)),d[28]||(d[28]=x(" Set area in Home Assistant, then click sync. ",-1)),e("a",{href:ce(),target:"_blank",class:"inline-link"},"Open in HA â†’",8,yl)])])):(l(),n("div",bl,[...d[30]||(d[30]=[e("div",{class:"info-notice"},[e("i",{class:"mdi mdi-information-outline"}),e("span",null,[e("strong",null,"Area Assignment:"),x(" After generating entities and restarting Home Assistant, you can assign areas in HA and sync them here.")])],-1)])])),e("div",hl,[d[31]||(d[31]=e("label",{for:"device-icon"},"Icon",-1)),ke(co,{modelValue:o.value.icon,"onUpdate:modelValue":d[6]||(d[6]=V=>o.value.icon=V),inputId:"device-icon",placeholder:"e.g., mdi:television"},null,8,["modelValue"]),d[32]||(d[32]=e("small",null,"Optional: Material Design Icon name",-1))]),o.value.device_type==="broadlink"?(l(),n("div",{key:2,class:Y(["form-group",{"has-error":T.value.broadlink_entity}])},[d[35]||(d[35]=e("label",{for:"broadlink-entity"},"Remote Device *",-1)),e("div",kl,[!f.value||!O.value?X((l(),n("select",{key:0,id:"broadlink-entity",ref_key:"broadlinkSelect",ref:L,"onUpdate:modelValue":d[7]||(d[7]=V=>o.value.broadlink_entity=V),onChange:d[8]||(d[8]=V=>Se("broadlink_entity"))},[d[33]||(d[33]=e("option",{value:""},"-- Select Remote Device --",-1)),(l(!0),n(fe,null,$e(s.value,V=>(l(),n("option",{key:V.entity_id,value:V.entity_id},[x(c(V.name||V.entity_id)+" ",1),V.area_name?(l(),n(fe,{key:0},[x(" - "+c(V.area_name),1)],64)):R("",!0)],8,wl))),128))],544)),[[De,o.value.broadlink_entity]]):(l(),n("input",{key:1,id:"broadlink-entity",value:$.value,type:"text",readonly:"",disabled:""},null,8,$l)),T.value.broadlink_entity?(l(),n("div",Cl,[d[34]||(d[34]=e("i",{class:"mdi mdi-alert"},null,-1)),x(" "+c(T.value.broadlink_entity),1)])):R("",!0)]),!f.value||!O.value?(l(),n("small",_l,"Required: Select which remote device to use for sending commands")):(l(),n("small",Sl,"Cannot change remote device after commands are learned"))],2)):R("",!0),o.value.device_type==="smartir"?(l(),n("div",Il,[d[36]||(d[36]=e("div",{class:"section-header"},[e("i",{class:"mdi mdi-cloud-download"}),e("span",null,"SmartIR Device Configuration")],-1)),ke(Wo,{ref_key:"smartirSelector",ref:U,"entity-type":o.value.entity_type,modelValue:q.value,"onUpdate:modelValue":d[9]||(d[9]=V=>q.value=V),"broadlink-devices":s.value,onChange:xe},null,8,["entity-type","modelValue","broadlink-devices"])])):R("",!0)],32),e("div",Dl,[e("button",{type:"button",onClick:d[10]||(d[10]=V=>D.$emit("cancel")),class:"btn btn-secondary"}," Cancel "),e("button",xl,[d[37]||(d[37]=e("i",{class:"mdi mdi-check"},null,-1)),x(" "+c(f.value?"Update":"Create"),1)])])])]))}},Ml=Ce(Tl,[["__scopeId","data-v-94bc1fe5"]]),Rl={class:"modal-header"},Ll={class:"modal-body"},Al={class:"message-text"},Ol={key:0,class:"checkbox-option"},El={class:"modal-footer"},Vl=["disabled"],Pl={__name:"ConfirmDialog",props:{isOpen:{type:Boolean,default:!1},title:{type:String,default:"Confirm"},message:{type:String,required:!0},confirmText:{type:String,default:"OK"},cancelText:{type:String,default:"Cancel"},showCancel:{type:Boolean,default:!0},dangerMode:{type:Boolean,default:!1},confirmDisabled:{type:Boolean,default:!1},checkboxLabel:{type:String,default:""}},emits:["confirm","cancel"],setup(t,{emit:m}){const r=t,w=m,h=g(!1);de(()=>r.isOpen,f=>{f&&(h.value=!1)});const a=()=>{w("confirm",h.value)},u=()=>{w("cancel")};return(f,S)=>t.isOpen?(l(),n("div",{key:0,class:"modal-overlay",onClick:me(u,["self","stop"])},[e("div",{class:"modal-dialog confirm-dialog",onClick:S[1]||(S[1]=me(()=>{},["stop"]))},[e("div",Rl,[e("h2",null,c(t.title),1)]),e("div",Ll,[e("p",Al,c(t.message),1),t.checkboxLabel?(l(),n("div",Ol,[e("label",null,[X(e("input",{type:"checkbox","onUpdate:modelValue":S[0]||(S[0]=C=>h.value=C)},null,512),[[ye,h.value]]),e("span",null,c(t.checkboxLabel),1)])])):R("",!0)]),e("div",El,[t.showCancel?(l(),n("button",{key:0,onClick:me(u,["stop"]),class:"btn btn-secondary"},c(t.cancelText),1)):R("",!0),t.confirmText?(l(),n("button",{key:1,onClick:me(a,["stop"]),class:Y(["btn",t.dangerMode?"btn-danger":"btn-primary"]),disabled:t.confirmDisabled},c(t.confirmText),11,Vl)):R("",!0)])])])):R("",!0)}},Pe=Ce(Pl,[["__scopeId","data-v-9cea6cb3"]]),Ul={class:"modal-content"},jl={class:"modal-header"},Fl={class:"modal-body"},Nl={key:0,class:"smartir-info"},Bl={key:0,class:"climate-note"},Hl={class:"form-group"},ql=["value"],zl={class:"form-group"},Jl=["disabled"],Wl={label:"Suggested Commands"},Kl=["value"],Xl=["disabled"],Gl={class:"form-group"},Yl={class:"radio-group"},Zl={class:"radio-label"},Ql=["disabled"],en={class:"radio-label"},tn=["disabled"],on={class:"learn-action"},ln=["disabled"],nn={key:0,class:"mdi mdi-loading mdi-spin"},sn={key:1,class:"mdi mdi-remote-tv"},an={key:0,class:"learning-status"},rn={key:0},dn={key:1},un={key:2,class:"rf-instructions"},cn={key:1,class:"result-message success"},mn={key:2,class:"section-divider"},vn={key:3,class:"loading-commands"},pn={key:4,class:"learned-commands"},fn={class:"command-list"},gn={class:"command-info"},yn={class:"command-name"},bn={class:"command-right"},hn=["title"],kn={class:"command-actions"},wn=["onClick","disabled"],$n=["onClick"],Cn={key:5,class:"untracked-commands"},_n={class:"command-list"},Sn={class:"command-name"},In={class:"modal-footer"},Dn=["disabled"],xn={__name:"CommandLearner",props:{device:{type:Object,required:!0}},emits:["cancel","learned"],setup(t,{emit:m}){const r=t,w=m,h=g([]),a=g(""),u=g(""),f=g(""),S=g("ir"),C=g(!1),O=g(""),$=g(""),o=g("success"),T=g([]),q=g([]),U=g(!1),I=g(!1),s=g(""),b=g(!1),p=g(null),L=g(null),J=g(""),Z=g(""),B=K(()=>r.device.device_type==="smartir");K(()=>{if(B.value)return!1;const W=u.value==="__custom__"?f.value:u.value;return a.value&&W.trim()});const ae=()=>{p.value&&p.value.setCustomValidity("")},A=()=>{L.value&&L.value.setCustomValidity("")},N=K(()=>{const W=h.value.find(E=>E.entity_id===a.value);return W?W.name||W.entity_id:a.value}),oe={light:["turn_on","turn_off","toggle","brightness_up","brightness_down","dim","bright"],fan:["turn_on","turn_off","toggle","speed_low","speed_medium","speed_high","speed_1","speed_2","speed_3","speed_4","speed_5","oscillate_on","oscillate_off","direction_forward","direction_reverse"],switch:["turn_on","turn_off","toggle"],media_player:["turn_on","turn_off","toggle","volume_up","volume_down","volume_mute","play","pause","stop","play_pause","next_track","previous_track","channel_up","channel_down","source_hdmi1","source_hdmi2","source_hdmi3","source_tv","source_aux","source_bluetooth","menu","home","back","select","arrow_up","arrow_down","arrow_left","arrow_right"],cover:["open","close","stop","open_tilt","close_tilt","position_0","position_25","position_50","position_75","position_100"]},ce=K(()=>{const W=r.device.entity_type||"switch";return oe[W]||oe.switch});Ae(async()=>{await we();try{console.log("ğŸ”„ Syncing command types...");const E=await ne.post("/api/commands/sync");console.log("âœ… Command types synced:",E.data)}catch(E){console.error("âš ï¸ Failed to sync command types:",E)}const W=!B.value;console.log(`ğŸ“‹ Will ${W?"FORCE RELOAD":"use cached"} commands`),await Se(W),p.value&&(p.value.setCustomValidity(""),p.value.oninvalid=()=>{p.value.setCustomValidity("Command name is required")}),r.device.broadlink_entity&&(a.value=r.device.broadlink_entity)}),de(u,async W=>{W==="__custom__"&&(await tt(),L.value&&(L.value.setCustomValidity(""),L.value.oninvalid=()=>{L.value.setCustomValidity("Custom command name is required")}))});const we=async()=>{try{const W=await ne.get("/api/broadlink/devices");h.value=W.data.devices||[]}catch(W){console.error("Error loading Broadlink devices:",W)}},Se=async(W=!1)=>{var E,Q;U.value=!0;try{if(B.value){const H=await ne.get("/api/smartir/codes/code",{params:{entity_type:r.device.entity_type,code_id:r.device.device_code}});if(H.data.success&&H.data.code){const v=H.data.code.commands||{},y=H.data.code.commandType||"ir";if(r.device.entity_type==="climate"){const F=[];for(const[ee,M]of Object.entries(v))typeof M=="string"?F.push({name:ee,type:y}):typeof M=="object"&&M!==null&&Object.keys(M).sort((P,G)=>parseInt(P)-parseInt(G)).forEach(P=>{F.push({name:`${ee}_${P}`,type:y,label:`${ee.charAt(0).toUpperCase()+ee.slice(1)} ${P}Â°C`})});T.value=F}else T.value=Object.keys(v).map(F=>({name:F,type:y}))}}else{if(console.log("ğŸ“‹ Loading commands for device:",r.device),console.log("ğŸ“‹ Device ID:",r.device.id),console.log("ğŸ“‹ Force reload:",W),W&&r.device.id){console.log("ğŸ”„ Force reloading commands from API after sync");try{const v=(await ne.get(`/api/commands/${r.device.id}`)).data.commands||{};console.log("ğŸ“¦ Raw commands from API:",v),T.value=Object.entries(v).map(([y,F])=>{console.log(`  Command '${y}':`,F,`(type: ${typeof F})`);const ee=typeof F=="object"&&F!==null&&(F.command_type||F.type)||"ir";return{name:y,type:ee}}),console.log("ğŸ“‹ Reloaded commands:",T.value)}catch(H){if(console.error("âŒ Error loading commands:",H),((E=H.response)==null?void 0:E.status)===404)console.log("â„¹ï¸ No commands found for device"),T.value=[];else throw H}}else if(r.device.commands&&Object.keys(r.device.commands).length>0)console.log("âœ… Using commands from device object"),T.value=Object.entries(r.device.commands).map(([H,v])=>({name:H,type:v.command_type||v.type||"ir"}));else if(r.device.commands!==void 0)console.log("â„¹ï¸ Device has empty commands object - skipping API call"),T.value=[];else if(r.device.id){console.log("ğŸŒ Fetching commands from API for device ID:",r.device.id);try{const v=(await ne.get(`/api/commands/${r.device.id}`)).data.commands||{};T.value=Object.entries(v).map(([y,F])=>({name:y,type:F.command_type||F.type||"ir"}))}catch(H){if(((Q=H.response)==null?void 0:Q.status)===404)console.log("â„¹ï¸ No commands found for device (this is normal for new devices)"),T.value=[];else throw H}}else console.log("âš ï¸ No commands found and no device ID");console.log("ğŸ“‹ Final learned commands:",T.value)}}catch(H){console.error("Error loading commands:",H)}finally{U.value=!1}},Me=async()=>{var E,Q;$.value="",o.value="",C.value=!0,O.value="preparing";const W=setTimeout(()=>{O.value="ready"},6e3);try{let H=r.device.id.split(".")[1];r.device.device&&(H=r.device.device);const v=u.value==="__custom__"?f.value:u.value,y=await ne.post("/api/commands/learn/direct",{device_id:r.device.id,entity_id:a.value||r.device.broadlink_entity,command_name:v.trim(),command_type:S.value});if(y.data.success){$.value=`Command "${v}" learned successfully!`,o.value="success",T.value.find(M=>M.name===v)||(T.value.push({name:v,type:S.value}),console.log(`âœ… CommandLearner: Added '${v}' to local list, total: ${T.value.length}`));const ee=q.value.indexOf(v);ee>-1&&q.value.splice(ee,1),await ve(),u.value="",f.value="",console.log(`ğŸ“¤ CommandLearner: Emitting learned event for '${v}'`),w("learned",{deviceId:r.device.id,commandName:v,commandType:S.value})}else $.value=y.data.error||"Failed to learn command",o.value="error"}catch(H){$.value=((Q=(E=H.response)==null?void 0:E.data)==null?void 0:Q.error)||"Error learning command",o.value="error"}finally{clearTimeout(W),C.value=!1,O.value=""}},xe=async W=>{var E,Q;try{Z.value=W,J.value="";let H=r.device.id.split(".")[1];r.device.device&&(H=r.device.device);const v=B.value?r.device.controller_device:a.value||r.device.broadlink_entity;if(!v){console.error("Missing entity_id for test command:",{isSmartIR:B.value,controller_device:r.device.controller_device,broadlink_entity:r.device.broadlink_entity,selectedBroadlink:a.value,device:r.device}),$.value="Missing Broadlink remote entity. Please select a Broadlink device.",o.value="error",Z.value="";return}const y={device_id:r.device.id,entity_id:v,command_name:W};console.log("ğŸ§ª Testing command:",y),(await ne.post("/api/commands/test/direct",y)).data.success&&(J.value=W,setTimeout(()=>{J.value===W&&(J.value="")},2e3))}catch(H){console.error("âŒ Test command error:",H);const v=((Q=(E=H.response)==null?void 0:E.data)==null?void 0:Q.error)||H.message||"Unknown error";$.value=`Failed to send command: ${v}`,o.value="error"}finally{Z.value=""}},D=W=>{s.value=W,I.value=!0},d=()=>{I.value=!1,s.value=""},V=async()=>{const W=s.value;I.value=!1;try{console.log(`ğŸ—‘ï¸ Deleting command: ${W}`),await ne.delete(`/api/commands/${r.device.id}/${W}`),T.value=T.value.filter(E=>E.name!==W),await Se(),await ve(),$.value=`Command "${W}" deleted`,o.value="success",w("learned")}catch(E){console.error("âŒ Delete error:",E),$.value=`Failed to delete command: ${E.message}`,o.value="error"}finally{s.value=""}},ve=async()=>{try{let W=r.device.device;W||(W=r.device.id.includes(".")?r.device.id.split(".")[1]:r.device.id),console.log("ğŸ” Looking for untracked commands for device:",W);const Q=(await ne.get("/api/commands/untracked")).data.untracked||{};console.log("ğŸ“¦ All untracked commands:",Object.keys(Q)),console.log("ğŸ“¦ Untracked for this device:",Q[W]),Q[W]?q.value=Object.keys(Q[W].commands):q.value=[]}catch(W){console.error("Error loading untracked commands:",W),q.value=[]}},Oe=()=>{q.value.length!==0&&(b.value=!0)},be=async()=>{b.value=!1;try{const W=r.device.device||r.device.id.split(".")[1],E=await ne.post("/api/commands/import",{device_id:r.device.id,source_device:W,commands:q.value});E.data.success&&($.value=`Imported ${E.data.imported_count} commands successfully!`,o.value="success",await Se(),await ve(),w("learned"))}catch(W){$.value=`Failed to import commands: ${W.message}`,o.value="error"}};return(W,E)=>(l(),n("div",{class:"modal-overlay",onClick:E[7]||(E[7]=me(Q=>W.$emit("cancel"),["self"]))},[e("div",Ul,[e("div",jl,[e("h2",null,c(B.value?"Commands for":"Learn Commands for")+" "+c(t.device.name),1),e("button",{onClick:E[0]||(E[0]=Q=>W.$emit("cancel")),class:"close-btn"},[...E[8]||(E[8]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Fl,[B.value?(l(),n("div",Nl,[E[13]||(E[13]=e("i",{class:"mdi mdi-information"},null,-1)),e("div",null,[E[12]||(E[12]=e("h3",null,"SmartIR Device",-1)),e("p",null,[E[9]||(E[9]=x("This device uses SmartIR code file ",-1)),e("strong",null,c(t.device.device_code),1),E[10]||(E[10]=x(". Commands are pre-configured and cannot be learned.",-1))]),t.device.entity_type==="climate"?(l(),n("p",Bl,[...E[11]||(E[11]=[e("i",{class:"mdi mdi-alert-circle-outline"},null,-1),e("strong",null,"Note:",-1),x(" Climate device commands are temperature-based. Testing individual modes may not work as expected. Use the Home Assistant climate card to control your device. ",-1)])])):R("",!0)])])):(l(),n("form",{key:1,onSubmit:me(Me,["prevent"])},[e("div",Hl,[E[14]||(E[14]=e("label",{for:"broadlink-entity"},"Broadlink Device",-1)),e("input",{id:"broadlink-entity",value:N.value,type:"text",readonly:"",disabled:""},null,8,ql),E[15]||(E[15]=e("small",null,"Commands will be learned using this device (set when device was created)",-1))]),e("div",zl,[E[18]||(E[18]=e("label",{for:"command-name"},"Command Name *",-1)),X(e("select",{id:"command-name",ref_key:"commandSelect",ref:p,"onUpdate:modelValue":E[1]||(E[1]=Q=>u.value=Q),disabled:C.value,required:"",onChange:ae},[E[16]||(E[16]=e("option",{value:""},"-- Select or type command --",-1)),e("optgroup",Wl,[(l(!0),n(fe,null,$e(ce.value,Q=>(l(),n("option",{key:Q,value:Q},c(Q),9,Kl))),128))]),E[17]||(E[17]=e("option",{value:"__custom__"},"Custom command...",-1))],40,Jl),[[De,u.value]]),u.value==="__custom__"?X((l(),n("input",{key:0,ref_key:"customCommandInput",ref:L,"onUpdate:modelValue":E[2]||(E[2]=Q=>f.value=Q),type:"text",placeholder:"Enter custom command name",disabled:C.value,required:"",class:"custom-command-input",onInput:A},null,40,Xl)),[[Le,f.value]]):R("",!0),e("small",null,"Select a suggested command for "+c(t.device.entity_type||"this device")+", or enter a custom one.",1)]),e("div",Gl,[E[21]||(E[21]=e("label",null,"Command Type",-1)),e("div",Yl,[e("label",Zl,[X(e("input",{type:"radio","onUpdate:modelValue":E[3]||(E[3]=Q=>S.value=Q),value:"ir",disabled:C.value},null,8,Ql),[[qe,S.value]]),E[19]||(E[19]=e("span",null,"IR (Infrared)",-1))]),e("label",en,[X(e("input",{type:"radio","onUpdate:modelValue":E[4]||(E[4]=Q=>S.value=Q),value:"rf",disabled:C.value},null,8,tn),[[qe,S.value]]),E[20]||(E[20]=e("span",null,"RF (Radio Frequency)",-1))])])]),e("div",on,[e("button",{type:"submit",class:"btn btn-primary btn-large",disabled:C.value},[C.value?(l(),n("i",nn)):(l(),n("i",sn)),x(" "+c(C.value?"Learning...":"Learn Command"),1)],8,ln)]),C.value?(l(),n("div",an,[E[25]||(E[25]=e("i",{class:"mdi mdi-loading mdi-spin"},null,-1)),O.value==="preparing"?(l(),n("div",rn,[...E[22]||(E[22]=[e("p",null,[e("strong",null,"Preparing device...")],-1),e("small",null,"Connecting and authenticating with Broadlink device (this takes a few seconds)",-1)])])):S.value==="ir"?(l(),n("div",dn,[...E[23]||(E[23]=[e("p",null,[e("strong",null,"Ready!"),x(" Point your remote at the Broadlink device and press the button...")],-1),e("small",null,"This may take up to 30 seconds",-1)])])):S.value==="rf"?(l(),n("div",un,[...E[24]||(E[24]=[e("p",null,[e("strong",null,"RF Learning - Two Steps:")],-1),e("ol",null,[e("li",null,[e("strong",null,"Step 1 - Frequency Sweep (~10-15 seconds):"),x(" Press and HOLD the button on your remote for 2-3 seconds")]),e("li",null,[e("strong",null,"Step 2 - Learn Signal:"),x(" After frequency locks, press the button again (short press)")])],-1),e("small",null,"Watch for status updates below",-1)])])):R("",!0)])):R("",!0),$.value&&o.value==="success"&&!$.value.includes("sent successfully")?(l(),n("div",cn,[E[26]||(E[26]=e("i",{class:"mdi mdi-check-circle"},null,-1)),e("p",null,c($.value),1)])):R("",!0)],32)),T.value.length>0||q.value.length>0?(l(),n("div",mn)):R("",!0),U.value?(l(),n("div",vn,[...E[27]||(E[27]=[e("div",{class:"loading-spinner"},[e("i",{class:"mdi mdi-loading mdi-spin"}),e("p",null,"Loading commands...")],-1)])])):T.value.length>0?(l(),n("div",pn,[e("h3",null,"Tracked Commands ("+c(T.value.length)+")",1),e("div",fn,[(l(!0),n(fe,null,$e(T.value,Q=>(l(),n("div",{key:Q.name,class:"command-item"},[e("div",gn,[e("span",yn,c(Q.label||Q.name),1)]),e("div",bn,[e("i",{class:"mdi mdi-check-circle learned-icon",title:`Learned (${(Q.type||"ir").toUpperCase()})`},null,8,hn),e("span",{class:Y(["command-type-badge",Q.type||"ir"])},c((Q.type||"ir").toUpperCase()),3),e("div",kn,[e("button",{type:"button",onClick:H=>xe(Q.name),class:"icon-btn",title:"Test command",disabled:Z.value===Q.name},[e("i",{class:Y(["mdi mdi-play",{"mdi-spin":Z.value===Q.name}])},null,2)],8,wn),e("button",{type:"button",onClick:H=>D(Q.name),class:"icon-btn danger",title:"Delete and re-learn"},[...E[28]||(E[28]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,$n)])])]))),128))])])):R("",!0),q.value.length>0?(l(),n("div",Cn,[e("h3",null,[E[29]||(E[29]=e("i",{class:"mdi mdi-alert"},null,-1)),x(" Untracked Commands ("+c(q.value.length)+") ",1)]),E[32]||(E[32]=e("p",{class:"untracked-info"}," These commands exist in Broadlink storage but are not tracked in this device. ",-1)),e("div",_n,[(l(!0),n(fe,null,$e(q.value,Q=>(l(),n("div",{key:Q,class:"command-item untracked"},[e("span",Sn,c(Q),1),E[30]||(E[30]=e("span",{class:"untracked-badge"},"Not tracked",-1))]))),128))]),e("button",{type:"button",onClick:Oe,class:"btn btn-secondary"},[...E[31]||(E[31]=[e("i",{class:"mdi mdi-import"},null,-1),x(" Import All Untracked Commands ",-1)])])])):R("",!0)]),e("div",In,[e("button",{type:"button",onClick:E[5]||(E[5]=Q=>W.$emit("cancel")),class:"btn btn-secondary",disabled:C.value}," Close ",8,Dn)])]),ke(Pe,{isOpen:I.value,title:"Delete Command?",message:`Delete command '${s.value}'? This will remove it from Broadlink storage.`,confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,onConfirm:V,onCancel:d},null,8,["isOpen","message"]),ke(Pe,{isOpen:b.value,title:"Import Commands?",message:`Import ${q.value.length} untracked command${q.value.length>1?"s":""} into this device?`,confirmText:"Import",cancelText:"Cancel",onConfirm:be,onCancel:E[6]||(E[6]=Q=>b.value=!1)},null,8,["isOpen","message"])]))}},Tn=Ce(xn,[["__scopeId","data-v-5ed6fd5f"]]),Mn={class:"modal-container error-dialog"},Rn={class:"modal-header"},Ln={class:"modal-body"},An={class:"error-message"},On={key:0,class:"error-suggestion"},En=["open"],Vn={class:"debug-content"},Pn={class:"debug-info"},Un={key:0,class:"debug-section-title"},jn={key:1},Fn={__name:"ErrorDialog",props:{isOpen:{type:Boolean,default:!1},title:{type:String,default:"Error"},message:{type:String,required:!0},suggestion:{type:String,default:""},details:{type:String,default:""},error:{type:Object,default:null},context:{type:Object,default:()=>({})}},emits:["close"],setup(t,{emit:m}){const r=t,w=m,h=Te("toast"),a=g(!1),u=()=>{w("close")},f=K(()=>{var T,q,U,I,s,b,p,L,J,Z,B;const $=new Date().toISOString(),o=r.error||{};return{error:JSON.stringify({message:r.message,title:r.title,details:r.details,errorObject:o.message||o.toString(),timestamp:$},null,2),request:JSON.stringify({method:((q=(T=o.config)==null?void 0:T.method)==null?void 0:q.toUpperCase())||"N/A",url:((U=o.config)==null?void 0:U.url)||"N/A",baseURL:((I=o.config)==null?void 0:I.baseURL)||"N/A",headers:((s=o.config)==null?void 0:s.headers)||{},data:(b=o.config)!=null&&b.data?JSON.parse(o.config.data):"N/A",params:((p=o.config)==null?void 0:p.params)||{}},null,2),response:JSON.stringify({status:((L=o.response)==null?void 0:L.status)||"N/A",statusText:((J=o.response)==null?void 0:J.statusText)||"N/A",data:((Z=o.response)==null?void 0:Z.data)||"N/A",headers:((B=o.response)==null?void 0:B.headers)||{}},null,2),browser:JSON.stringify({userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language,cookieEnabled:navigator.cookieEnabled,onLine:navigator.onLine,viewport:`${window.innerWidth}x${window.innerHeight}`,screenResolution:`${window.screen.width}x${window.screen.height}`,colorDepth:window.screen.colorDepth,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,timestamp:$},null,2),appState:JSON.stringify({currentRoute:window.location.pathname,currentURL:window.location.href,referrer:document.referrer||"N/A",context:r.context||{},localStorage:{smartir_simulate:localStorage.getItem("smartir_simulate_not_installed"),theme:localStorage.getItem("theme")}},null,2),stackTrace:o.stack||null}}),S=async()=>{const $=O();try{await navigator.clipboard.writeText($),h==null||h.success("Debug information copied to clipboard","âœ… Copied")}catch(o){console.error("Failed to copy:",o),h==null||h.error("Failed to copy to clipboard","âŒ Copy Failed")}},C=()=>{const $=O(),o=new Blob([$],{type:"text/plain"}),T=URL.createObjectURL(o),q=document.createElement("a");q.href=T;const U=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5);q.download=`broadlink-manager-error-${U}.txt`,document.body.appendChild(q),q.click(),document.body.removeChild(q),URL.revokeObjectURL(T),h==null||h.success("Debug report downloaded","âœ… Downloaded")},O=()=>`Broadlink Manager - Error Report
${"=".repeat(60)}

Generated: ${new Date().toISOString()}
Title: ${r.title}
Message: ${r.message}
${r.suggestion?`Suggestion: ${r.suggestion}
`:""}
${"=".repeat(60)}

ERROR DETAILS
${"-".repeat(60)}
${f.value.error}

REQUEST INFORMATION
${"-".repeat(60)}
${f.value.request}

RESPONSE INFORMATION
${"-".repeat(60)}
${f.value.response}

BROWSER INFORMATION
${"-".repeat(60)}
${f.value.browser}

APPLICATION STATE
${"-".repeat(60)}
${f.value.appState}

${f.value.stackTrace?`STACK TRACE
${"-".repeat(60)}
${f.value.stackTrace}

`:""}
${"=".repeat(60)}
End of Report
`;return de(()=>r.isOpen,$=>{if($){const o=T=>{T.key==="Escape"&&u()};return document.addEventListener("keydown",o),()=>document.removeEventListener("keydown",o)}}),($,o)=>(l(),Ee(ot,{to:"body"},[ke(et,{name:"modal"},{default:Xe(()=>[t.isOpen?(l(),n("div",{key:0,class:"modal-overlay",onClick:me(u,["self"])},[e("div",Mn,[e("div",Rn,[o[2]||(o[2]=e("div",{class:"header-icon error-icon"},[e("i",{class:"mdi mdi-alert-circle"})],-1)),e("h3",null,c(t.title),1),e("button",{onClick:u,class:"close-button"},[...o[1]||(o[1]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Ln,[e("p",An,c(t.message),1),t.suggestion?(l(),n("p",On,[o[3]||(o[3]=e("i",{class:"mdi mdi-lightbulb-on"},null,-1)),x(" "+c(t.suggestion),1)])):R("",!0),e("details",{class:"debug-section",open:a.value},[e("summary",{onClick:o[0]||(o[0]=T=>a.value=!a.value)},[e("i",{class:Y(["mdi",a.value?"mdi-chevron-down":"mdi-chevron-right"])},null,2),o[4]||(o[4]=x(" Debug Information ",-1))]),e("div",Vn,[e("div",{class:"debug-actions"},[e("button",{onClick:S,class:"btn-debug btn-copy"},[...o[5]||(o[5]=[e("i",{class:"mdi mdi-content-copy"},null,-1),x(" Copy to Clipboard ",-1)])]),e("button",{onClick:C,class:"btn-debug btn-download"},[...o[6]||(o[6]=[e("i",{class:"mdi mdi-download"},null,-1),x(" Download Report ",-1)])])]),e("div",Pn,[o[7]||(o[7]=e("div",{class:"debug-section-title"},"Error Details",-1)),e("pre",null,c(f.value.error),1),o[8]||(o[8]=e("div",{class:"debug-section-title"},"Request Information",-1)),e("pre",null,c(f.value.request),1),o[9]||(o[9]=e("div",{class:"debug-section-title"},"Response Information",-1)),e("pre",null,c(f.value.response),1),o[10]||(o[10]=e("div",{class:"debug-section-title"},"Browser Information",-1)),e("pre",null,c(f.value.browser),1),o[11]||(o[11]=e("div",{class:"debug-section-title"},"Application State",-1)),e("pre",null,c(f.value.appState),1),f.value.stackTrace?(l(),n("div",Un,"Stack Trace")):R("",!0),f.value.stackTrace?(l(),n("pre",jn,c(f.value.stackTrace),1)):R("",!0)])])],8,En)]),e("div",{class:"modal-footer"},[e("button",{onClick:u,class:"btn btn-primary"}," OK ")])])])):R("",!0)]),_:1})]))}},Nn=Ce(Fn,[["__scopeId","data-v-23858149"]]),Bn={key:0,class:"discovery-banner"},Hn={class:"banner-content"},qn={class:"banner-text"},zn={class:"modal-dialog"},Jn={class:"modal-header"},Wn={class:"modal-body"},Kn={class:"device-list"},Xn={class:"device-info"},Gn={class:"device-details"},Yn={class:"command-count"},Zn={class:"device-actions"},Qn=["onClick"],es=["onClick"],ts={class:"modal-footer"},os={class:"modal-dialog modal-dialog-small"},ls={class:"modal-header"},ns={class:"modal-body"},ss={class:"warning-message"},as={class:"modal-footer"},is=["disabled"],rs=["disabled"],ds={__name:"DeviceDiscovery",emits:["adopt"],setup(t,{expose:m,emit:r}){const w=Fe(),h=r,a=g([]),u=g(!1),f=g(!1),S=g(null),C=g(!1),O=K(()=>a.value.length>0);Ae(async()=>{await $()});const $=async()=>{try{const U=await ne.get("/api/devices/discover");a.value=U.data.untracked_devices||[]}catch(U){console.error("Error loading untracked devices:",U),a.value=[]}},o=U=>{u.value=!1,h("adopt",U)},T=U=>{S.value=U,f.value=!0},q=async()=>{if(!S.value)return;const U=S.value.device_name;C.value=!0;try{const I=await ne.delete(`/api/devices/untracked/${encodeURIComponent(U)}`);if(I.data.success)a.value=a.value.filter(s=>s.device_name!==U),f.value=!1,S.value=null,a.value.length===0&&(u.value=!1),w.success(`Deleted all commands for '${U}'`);else throw new Error(I.data.error||"Failed to delete device")}catch(I){console.error("Error deleting device:",I),w.error(`Failed to delete device: ${I.message}`)}finally{C.value=!1}};return m({refresh:$}),(U,I)=>{var s,b,p;return O.value?(l(),n("div",Bn,[e("div",Hn,[I[9]||(I[9]=e("div",{class:"banner-icon"},[e("i",{class:"mdi mdi-radar"})],-1)),e("div",qn,[I[7]||(I[7]=e("h3",null,"Untracked Devices Found",-1)),e("p",null,c(a.value.length)+" device"+c(a.value.length>1?"s":"")+" with learned commands found in Broadlink storage",1)]),e("button",{onClick:I[0]||(I[0]=L=>u.value=!0),class:"btn btn-primary"},[...I[8]||(I[8]=[e("i",{class:"mdi mdi-eye"},null,-1),x(" View Devices ",-1)])])]),u.value?(l(),n("div",{key:0,class:"modal-overlay",onClick:I[3]||(I[3]=me(L=>u.value=!1,["self"]))},[e("div",zn,[e("div",Jn,[I[11]||(I[11]=e("h2",null,"Discovered Devices",-1)),e("button",{onClick:I[1]||(I[1]=L=>u.value=!1),class:"close-btn"},[...I[10]||(I[10]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Wn,[I[16]||(I[16]=e("p",{class:"info-text"}," These devices have learned commands in Broadlink storage but are not being tracked. Adopt them to manage their commands and generate Home Assistant entities. ",-1)),e("div",Kn,[(l(!0),n(fe,null,$e(a.value,L=>(l(),n("div",{key:L.device_name,class:"discovered-device"},[e("div",Xn,[I[13]||(I[13]=e("div",{class:"device-icon"},[e("i",{class:"mdi mdi-devices"})],-1)),e("div",Gn,[e("h4",null,c(L.device_name),1),e("span",Yn,[I[12]||(I[12]=e("i",{class:"mdi mdi-remote"},null,-1)),x(" "+c(L.command_count)+" command"+c(L.command_count>1?"s":""),1)])])]),e("div",Zn,[e("button",{onClick:J=>o(L),class:"btn btn-primary"},[...I[14]||(I[14]=[e("i",{class:"mdi mdi-plus"},null,-1),x(" Adopt ",-1)])],8,Qn),e("button",{onClick:J=>T(L),class:"btn btn-danger",title:"Delete all commands"},[...I[15]||(I[15]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,es)])]))),128))])]),e("div",ts,[e("button",{onClick:I[2]||(I[2]=L=>u.value=!1),class:"btn btn-secondary"}," Close ")])])])):R("",!0),f.value?(l(),n("div",{key:1,class:"modal-overlay",onClick:I[6]||(I[6]=me(L=>f.value=!1,["self"]))},[e("div",os,[e("div",ls,[I[18]||(I[18]=e("h2",null,"Delete Untracked Device",-1)),e("button",{onClick:I[4]||(I[4]=L=>f.value=!1),class:"close-btn"},[...I[17]||(I[17]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",ns,[e("div",ss,[I[20]||(I[20]=e("i",{class:"mdi mdi-alert"},null,-1)),e("div",null,[e("p",null,[e("strong",null,'Are you sure you want to delete "'+c((s=S.value)==null?void 0:s.device_name)+'"?',1)]),e("p",null,"This will permanently delete all "+c((b=S.value)==null?void 0:b.command_count)+" command"+c(((p=S.value)==null?void 0:p.command_count)>1?"s":"")+" from Broadlink storage.",1),I[19]||(I[19]=e("p",{class:"warning-text"},"This action cannot be undone.",-1))])])]),e("div",as,[e("button",{onClick:I[5]||(I[5]=L=>f.value=!1),class:"btn btn-secondary",disabled:C.value}," Cancel ",8,is),e("button",{onClick:q,class:"btn btn-danger",disabled:C.value},[e("i",{class:Y(["mdi",C.value?"mdi-loading mdi-spin":"mdi-delete"])},null,2),x(" "+c(C.value?"Deleting...":"Delete"),1)],8,rs)])])])):R("",!0)])):R("",!0)}}},us=Ce(ds,[["__scopeId","data-v-783e943f"]]),cs={class:"device-list-card"},ms={class:"card-header"},vs={class:"header-badges"},ps={class:"header-info"},fs={class:"header-right"},gs={key:0,class:"view-toggle-group header-view-toggle"},ys={class:"settings-menu-container"},bs=["disabled"],hs=["disabled"],ks={class:"card-body"},ws={key:0,class:"filter-bar"},$s={class:"filter-search-row"},Cs=["title"],_s={key:0,class:"filter-badge"},Ss={class:"search-input-wrapper"},Is={class:"filter-content"},Ds={class:"filter-row filter-row-dropdowns"},xs={class:"filter-group"},Ts=["value"],Ms={class:"filter-group"},Rs=["value"],Ls={class:"filter-group"},As={key:0,class:"filter-group filter-toggle"},Os={class:"toggle-label"},Es={class:"filter-results"},Vs={key:1,class:"loading-state"},Ps={key:2,class:"error-state"},Us={key:3,class:"empty-state"},js={key:4,class:"device-grid"},Fs={key:6,class:"no-results"},Ns={__name:"DeviceList",setup(t){const m=vt(),r=Fe(),{isMobile:w}=Ge(),h=g(!1),a=g(!1),u=g(null),f=g(!1),S=g(!1),C=g(null),O=g(null),$=g(!0),o=g(!1),T=g(!1),U=g(window.innerWidth<=767?"grid":localStorage.getItem("device_view_mode")||"grid");de(w,_=>{_&&U.value==="list"&&(U.value="grid")}),de(U,_=>{localStorage.setItem("device_view_mode",_)});const I=()=>{$.value=!$.value,$.value||(S.value=!1)},s=()=>{$.value||($.value=!0),S.value=!S.value},b=g(!1),p=g({title:"Error",message:"",suggestion:"",details:"",error:null,context:{}}),L=g(!1),J=g({success:!1,title:"",message:""}),Z=g(!1),B=g({search:"",broadlinkDevice:"",area:"",entityType:"",showSmartIROnly:!1}),ae=g([]),A=Te("smartirStatus"),N=Te("smartirEnabled"),oe=K(()=>{var k;return localStorage.getItem("smartir_simulate_not_installed")==="true"?!1:((k=A==null?void 0:A.value)==null?void 0:k.installed)||!1}),ce=K(()=>{const _=new Map;return m.devices.forEach(k=>{if(k.broadlink_entity){const j=ae.value.find(le=>le.entity_id===k.broadlink_entity),z=j&&j.name||k.broadlink_entity;_.set(k.broadlink_entity,{entity_id:k.broadlink_entity,friendly_name:z})}}),Array.from(_.values()).sort((k,j)=>k.friendly_name.localeCompare(j.friendly_name))}),we=K(()=>{const _=new Set;return m.devices.forEach(k=>{k.area&&_.add(k.area)}),Array.from(_).sort()}),Se=K(()=>{let _=m.devices;if(B.value.search){const j=B.value.search.toLowerCase();_=_.filter(z=>{var pe,re,Ie,Ve,Ne;if((pe=z.name)!=null&&pe.toLowerCase().includes(j)||(re=z.entity_type)!=null&&re.toLowerCase().includes(j)||(Ie=z.area)!=null&&Ie.toLowerCase().includes(j)||(Ve=z.id)!=null&&Ve.toLowerCase().includes(j)||Object.keys(z.commands||{}).some(We=>We.toLowerCase().includes(j)))return!0;const he=ae.value.find(We=>We.entity_id===z.broadlink_entity);return!!((Ne=he==null?void 0:he.name)!=null&&Ne.toLowerCase().includes(j))})}B.value.broadlinkDevice&&(_=_.filter(j=>j.broadlink_entity===B.value.broadlinkDevice||j.controller_device===B.value.broadlinkDevice)),B.value.area&&(_=_.filter(j=>j.area===B.value.area)),B.value.entityType&&(_=_.filter(j=>j.entity_type===B.value.entityType)),B.value.showSmartIROnly&&(_=_.filter(j=>j.device_type==="smartir"));const k=localStorage.getItem("smartir_simulate_not_installed")==="true";return(!(N!=null&&N.value)||k)&&(_=_.filter(j=>j.device_type!=="smartir")),_}),Me=K(()=>B.value.search||B.value.broadlinkDevice||B.value.area||B.value.entityType||B.value.showSmartIROnly),xe=K(()=>{let _=0;return B.value.search&&_++,B.value.broadlinkDevice&&_++,B.value.area&&_++,B.value.entityType&&_++,B.value.showSmartIROnly&&_++,_}),D=()=>{B.value.search="",B.value.broadlinkDevice="",B.value.area="",B.value.entityType="",B.value.showSmartIROnly=!1},d=async()=>{try{const _=await ne.get("/api/remote/devices");ae.value=_.data.devices||[]}catch(_){console.error("Error loading remote devices:",_)}};de(U,_=>{localStorage.setItem("device_view_mode",_)}),Ae(async()=>{await Promise.all([m.loadDevices(),d()])});const V=_=>{u.value=_,h.value=!0},ve=K(()=>{if(!C.value)return"";const _=Object.keys(C.value.commands||{}).length;return _===0?"This device has no commands. The device will be removed from tracking.":`This device has ${_} learned command${_>1?"s":""}. What would you like to do?`}),Oe=K(()=>{if(!C.value)return"";const _=Object.keys(C.value.commands||{}).length;return _===0?"":`Also delete all ${_} command${_>1?"s":""} from Broadlink storage`}),be=_=>{C.value=_,f.value=!0},W=()=>{f.value=!1,C.value=null},E=async _=>{var j,z;const k=C.value;f.value=!1;try{await m.deleteDevice(k.id,_),O.value&&await O.value.refresh()}catch(le){const he=((z=(j=le.response)==null?void 0:j.data)==null?void 0:z.error)||le.message||"Unknown error";F("Failed to Delete Device",he)}finally{C.value=null}},Q=async _=>{var k,j,z,le,he;try{console.log("ğŸ’¾ Saving device data:",_),console.log("ğŸ’¾ Device commands:",_.commands),console.log("ğŸ’¾ Selected device:",u.value),(k=u.value)!=null&&k.id&&u.value.id!==null?await m.updateDevice(u.value.id,_):await m.createDevice(_),H(),O.value&&await O.value.refresh()}catch(pe){let re="Failed to save device",Ie="",Ve="";(z=(j=pe.response)==null?void 0:j.data)!=null&&z.error?(re=pe.response.data.error,Ie=pe.response.data.suggestion||""):pe.message&&(re=pe.message),pe.response&&(Ve=`Status: ${pe.response.status}
URL: ${((le=pe.config)==null?void 0:le.url)||"N/A"}`),F("Failed to Save Device",re,Ie,Ve,pe,{action:"save_device",deviceData:_,isEdit:!!((he=u.value)!=null&&he.id)})}},H=()=>{h.value=!1,u.value=null},v=_=>{u.value=_,a.value=!0},y=()=>{a.value=!1,u.value=null},F=(_,k,j="",z="",le=null,he={})=>{p.value={title:_,message:k,suggestion:j,details:z,error:le,context:he},b.value=!0},ee=()=>{b.value=!1},M=()=>{L.value=!1},i=async _=>{if(console.log("ğŸ“¥ DeviceList: Command learned:",_),!_||!_.deviceId||!u.value){console.warn("âš ï¸ DeviceList: Missing required data in learned event");return}const k=u.value.commands||{},j={...k,[_.commandName]:{command_type:_.commandType,type:_.commandType}};console.log(`âœ… DeviceList: Optimistically adding command '${_.commandName}'`),console.log(`âœ… DeviceList: Command count: ${Object.keys(k).length} -> ${Object.keys(j).length}`),u.value={...u.value,commands:j},console.log("ğŸ”„ DeviceList: Force reloading all devices from API"),await m.loadDevices(!0),O.value&&O.value.refresh()},P=_=>{const k=_.split("_"),j=[];for(let z=0;z<k.length;z++){const le=k[z],he=k[z+1];le&&he==="s"&&k[z+2]?(j.push(le.charAt(0).toUpperCase()+le.slice(1)+"'s"),z++):le!=="s"&&j.push(le.charAt(0).toUpperCase()+le.slice(1))}return j.join(" ")},G=(_,k)=>{const j=_.toLowerCase(),z=k.map(re=>re.toLowerCase());return j.includes("lamp")||j.includes("light")?"light":j.includes("fan")?"fan":j.includes("tv")||j.includes("stereo")||j.includes("speaker")||j.includes("receiver")?"media_player":j.includes("blind")||j.includes("curtain")||j.includes("shade")||j.includes("garage")?"cover":z.some(re=>re.includes("volume")||re.includes("channel")||re.includes("play")||re.includes("pause")||re.includes("mute"))?"media_player":z.some(re=>re.includes("fan_speed")||re.includes("fan_low")||re.includes("fan_high"))?"fan":z.some(re=>re.includes("open")||re.includes("close")||re.includes("stop"))?"cover":"switch"},ie=(_,k)=>{const j=_.toLowerCase();return j.includes("tv")?"mdi:television":j.includes("stereo")||j.includes("receiver")||j.includes("speaker")?"mdi:speaker":j.includes("lamp")?"mdi:lamp":j.includes("light")?"mdi:lightbulb":j.includes("fan")?"mdi:fan":j.includes("blind")?"mdi:blinds":j.includes("curtain")?"mdi:curtains":j.includes("garage")?"mdi:garage":{light:"mdi:lightbulb",fan:"mdi:fan",switch:"mdi:light-switch",media_player:"mdi:speaker",cover:"mdi:window-shutter"}[k]||"mdi:devices"},ue=_=>{const k=_.toLowerCase().split("_");for(let le=0;le<k.length-2;le++)if(k[le+1]==="s"){const he=k.slice(le,le+3),pe=P(he.join("_"));return console.log("Detected possessive area:",pe,"from",_),pe}const j=[["living","room"],["dining","room"],["master","bedroom"],["guest","bedroom"],["family","room"],["laundry","room"],["home","office"]];for(let le=0;le<k.length-1;le++){const he=[k[le],k[le+1]],pe=j.find(re=>re[0]===he[0]&&re[1]===he[1]);if(pe)return P(pe.join("_"))}const z=["kitchen","bedroom","bathroom","garage","office","basement","attic","hallway","entryway","patio","deck","yard","garden"];for(const le of k)if(z.includes(le))return le.charAt(0).toUpperCase()+le.slice(1);return""},se=async _=>{const k=P(_.device_name),j=ue(_.device_name),z=G(_.device_name,_.commands),le=ie(_.device_name,z);let he="";try{console.log("Finding Broadlink owner for:",_.device_name);const re=await ne.post("/api/devices/find-broadlink-owner",{device_name:_.device_name});console.log("Broadlink owner response:",re.data),he=re.data.broadlink_entity||"",console.log("Detected Broadlink entity:",he)}catch(re){console.error("Error finding Broadlink owner:",re)}u.value={id:null,device:_.device_name,name:k,entity_type:z,commands:{},area:j,icon:le,broadlink_entity:he,enabled:!0};const pe={};_.commands.forEach(re=>{pe[re]=re}),u.value.commands=pe,h.value=!0},te=async()=>{T.value=!0;try{await m.syncAllAreas(),r.success("Areas synced from Home Assistant")}catch(_){console.error("Error syncing areas:",_),r.error("Failed to sync areas")}finally{T.value=!1}},ge=async()=>{var _,k;o.value=!0;try{const j=await ne.post("/api/entities/generate",{});if(j.data.success){const z=j.data.broadlink_count||0,le=j.data.smartir_count||0,he=j.data.total_count||0,pe=j.data.errors||[];let re="âœ… Entity Generation Successful",Ie=[];const Ve=[];z>0&&Ve.push(`${z} Broadlink native`),le>0&&Ve.push(`${le} SmartIR`),Ve.length>0&&Ie.push(`Generated ${Ve.join(" and ")} entity configuration${he!==1?"s":""}.`),z>0&&(Ie.push(`
ğŸ“ Broadlink entities created in:`),Ie.push("  â€¢ broadlink_manager/entities.yaml"),Ie.push("  â€¢ broadlink_manager/helpers.yaml")),le>0&&(Ie.push(`
ğŸ“ SmartIR entities created in:`),Ie.push("  â€¢ smartir/climate.yaml"),Ie.push("  â€¢ smartir/media_player.yaml"),Ie.push("  â€¢ smartir/fan.yaml")),Ie.push(`
ğŸ“ Next steps:`),Ie.push("1. Check your configuration.yaml includes the generated files"),Ie.push("2. Restart Home Assistant to load the new entities"),pe.length>0&&(re="âš ï¸ Entity Generation Completed with Errors",Ie.push(`
âš ï¸ ${pe.length} error${pe.length!==1?"s":""} occurred:`),pe.forEach(Ne=>{Ie.push(`  â€¢ ${Ne}`)})),J.value={success:!0,title:re,message:Ie.join(`
`)},L.value=!0}else J.value={success:!1,title:"âŒ Entity Generation Failed",message:j.data.message||`Failed to generate entities.

Please check that you have at least one device configured.`},L.value=!0}catch(j){console.error("Error generating entities:",j);const z=((k=(_=j.response)==null?void 0:_.data)==null?void 0:k.error)||j.message||"Unknown error occurred";J.value={success:!1,title:"âŒ Entity Generation Error",message:`Failed to generate entities:

${z}

Please check the logs for more details.`},L.value=!0}finally{o.value=!1}},Re=async({device:_,command:k})=>{var j,z;try{const le={device_id:_.id,command_name:k,entity_id:_.broadlink_entity||_.controller_device};await ne.post("/api/commands/test/direct",le),r.success(`Sent ${k} to ${_.name}`)}catch(le){console.error("Error sending command:",le);const he=((z=(j=le.response)==null?void 0:j.data)==null?void 0:z.error)||le.message||"Unknown error";r.error(`Failed to send ${k}: ${he}`)}};return(_,k)=>{var j;return l(),n("div",cs,[e("div",ms,[e("button",{class:"icon-button chevron-button",onClick:I},[e("i",{class:Y(["mdi",$.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2)]),e("div",{class:"header-left",onClick:I},[k[14]||(k[14]=e("div",{class:"header-icon"},[e("i",{class:"mdi mdi-devices"})],-1)),e("h3",null,c(_e(w)?"Devices":"Managed Devices"),1),e("div",vs,[e("span",ps,c(_e(m).deviceCount)+" devices",1)])]),e("div",fs,[_e(w)?R("",!0):(l(),n("div",gs,[e("button",{onClick:k[0]||(k[0]=me(z=>U.value="grid",["stop"])),class:Y(["view-toggle-btn",{active:U.value==="grid"}]),title:"Grid View"},[...k[15]||(k[15]=[e("i",{class:"mdi mdi-view-grid"},null,-1)])],2),e("button",{onClick:k[1]||(k[1]=me(z=>U.value="list",["stop"])),class:Y(["view-toggle-btn",{active:U.value==="list"}]),title:"List View"},[...k[16]||(k[16]=[e("i",{class:"mdi mdi-view-list"},null,-1)])],2)])),e("button",{onClick:k[2]||(k[2]=me(z=>h.value=!0,["stop"])),class:"btn btn-primary new-button"},[...k[17]||(k[17]=[e("i",{class:"mdi mdi-plus"},null,-1),e("span",null,"New",-1)])]),e("div",ys,[e("button",{onClick:me(s,["stop"]),class:Y(["icon-button settings-button",{active:S.value}]),title:"Settings"},[...k[18]||(k[18]=[e("i",{class:"mdi mdi-cog"},null,-1)])],2),S.value?(l(),n("div",{key:0,class:"settings-dropdown",onClick:k[5]||(k[5]=me(()=>{},["stop"]))},[e("button",{onClick:k[3]||(k[3]=z=>{te(),S.value=!1}),class:"menu-item",disabled:T.value},[e("i",{class:Y(["mdi",T.value?"mdi-loading mdi-spin":"mdi-refresh"])},null,2),e("span",null,c(T.value?"Syncing Areas...":"Sync Areas"),1)],8,bs),e("button",{onClick:k[4]||(k[4]=z=>{ge(),S.value=!1}),class:"menu-item",disabled:o.value},[e("i",{class:Y(["mdi",o.value?"mdi-loading mdi-spin":"mdi-file-code"])},null,2),e("span",null,c(o.value?"Generating...":"Generate Entities"),1)],8,hs)])):R("",!0)])])]),X(e("div",ks,[ke(us,{ref_key:"discoveryRef",ref:O,onAdopt:se},null,512),_e(m).hasDevices?(l(),n("div",ws,[e("div",$s,[e("button",{class:Y(["filter-toggle-button",{active:Z.value||Me.value}]),onClick:k[6]||(k[6]=z=>Z.value=!Z.value),title:Z.value?"Hide filters":"Show filters"},[k[19]||(k[19]=e("i",{class:"mdi mdi-filter-variant"},null,-1)),Me.value?(l(),n("span",_s,c(xe.value),1)):R("",!0)],10,Cs),e("div",Ss,[k[20]||(k[20]=e("i",{class:"mdi mdi-magnify search-icon"},null,-1)),X(e("input",{"onUpdate:modelValue":k[7]||(k[7]=z=>B.value.search=z),type:"text",placeholder:"Search devices, commands...",class:"search-input"},null,512),[[Le,B.value.search]])])]),X(e("div",Is,[e("div",Ds,[e("div",xs,[e("label",null,[k[22]||(k[22]=e("i",{class:"mdi mdi-access-point"},null,-1)),X(e("select",{"onUpdate:modelValue":k[8]||(k[8]=z=>B.value.broadlinkDevice=z)},[k[21]||(k[21]=e("option",{value:""},"All Controller Devices",-1)),(l(!0),n(fe,null,$e(ce.value,z=>(l(),n("option",{key:z.entity_id,value:z.entity_id},c(z.friendly_name),9,Ts))),128))],512),[[De,B.value.broadlinkDevice]])])]),e("div",Ms,[e("label",null,[k[24]||(k[24]=e("i",{class:"mdi mdi-home-map-marker"},null,-1)),X(e("select",{"onUpdate:modelValue":k[9]||(k[9]=z=>B.value.area=z)},[k[23]||(k[23]=e("option",{value:""},"All Areas",-1)),(l(!0),n(fe,null,$e(we.value,z=>(l(),n("option",{key:z,value:z},c(z),9,Rs))),128))],512),[[De,B.value.area]])])]),e("div",Ls,[e("label",null,[k[26]||(k[26]=e("i",{class:"mdi mdi-shape"},null,-1)),X(e("select",{"onUpdate:modelValue":k[10]||(k[10]=z=>B.value.entityType=z)},[...k[25]||(k[25]=[Ue('<option value="" data-v-a35da958>All Types</option><option value="light" data-v-a35da958>Light</option><option value="fan" data-v-a35da958>Fan</option><option value="switch" data-v-a35da958>Switch</option><option value="media_player" data-v-a35da958>Media Player</option><option value="cover" data-v-a35da958>Cover</option><option value="climate" data-v-a35da958>Climate</option>',7)])],512),[[De,B.value.entityType]])])]),oe.value?(l(),n("div",As,[e("label",Os,[k[27]||(k[27]=e("span",{class:"toggle-text"},[e("img",{src:Ye,alt:"SmartIR",class:"smartir-icon"}),x(" SmartIR Only ")],-1)),X(e("input",{type:"checkbox","onUpdate:modelValue":k[11]||(k[11]=z=>B.value.showSmartIROnly=z),class:"toggle-checkbox"},null,512),[[ye,B.value.showSmartIROnly]]),k[28]||(k[28]=e("span",{class:"toggle-slider"},null,-1))])])):R("",!0),Me.value?(l(),n("button",{key:1,onClick:D,class:"btn-clear-filters"},[...k[29]||(k[29]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),x(" Clear ",-1)])])):R("",!0),e("div",Es,c(Se.value.length)+" of "+c(_e(m).deviceCount),1)])],512),[[ze,Z.value]])])):R("",!0),_e(m).loading?(l(),n("div",Vs,[...k[30]||(k[30]=[e("i",{class:"mdi mdi-loading mdi-spin"},null,-1),e("p",null,"Loading devices...",-1)])])):_e(m).error?(l(),n("div",Ps,[k[31]||(k[31]=e("i",{class:"mdi mdi-alert-circle"},null,-1)),e("p",null,c(_e(m).error),1),e("button",{onClick:k[12]||(k[12]=z=>_e(m).loadDevices()),class:"btn btn-secondary"}," Retry ")])):_e(m).hasDevices?R("",!0):(l(),n("div",Us,[k[33]||(k[33]=e("i",{class:"mdi mdi-devices"},null,-1)),k[34]||(k[34]=e("h3",null,"No Devices Yet",-1)),k[35]||(k[35]=e("p",null,"Get started by adding your first managed device",-1)),e("button",{onClick:k[13]||(k[13]=z=>h.value=!0),class:"btn btn-primary"},[...k[32]||(k[32]=[e("i",{class:"mdi mdi-plus"},null,-1),x(" Add Your First Device ",-1)])])])),U.value==="grid"?(l(),n("div",js,[(l(!0),n(fe,null,$e(Se.value,z=>(l(),Ee(Vt,{key:z.id,device:z,"broadlink-devices":ae.value,onEdit:V,onDelete:be,onLearn:v},null,8,["device","broadlink-devices"]))),128))])):U.value==="list"&&Se.value.length>0?(l(),Ee(to,{key:5,devices:Se.value,onSendCommand:Re,onEditDevice:V,onDeleteDevice:be},null,8,["devices"])):R("",!0),_e(m).hasDevices&&Se.value.length===0?(l(),n("div",Fs,[...k[36]||(k[36]=[e("i",{class:"mdi mdi-filter-off"},null,-1),e("h3",null,"No devices match your filters",-1),e("p",null,"Try adjusting your search or filter criteria",-1)])])):R("",!0)],512),[[ze,$.value]]),h.value?(l(),Ee(Ml,{key:0,device:u.value,onSave:Q,onCancel:H},null,8,["device"])):R("",!0),a.value?(l(),Ee(Tn,{key:1,device:u.value,onLearned:i,onCancel:y},null,8,["device"])):R("",!0),ke(Pe,{isOpen:f.value,title:`Delete ${(j=C.value)==null?void 0:j.name}?`,message:ve.value,confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,checkboxLabel:Oe.value,onConfirm:E,onCancel:W},null,8,["isOpen","title","message","checkboxLabel"]),ke(Nn,{isOpen:b.value,title:p.value.title,message:p.value.message,suggestion:p.value.suggestion,details:p.value.details,error:p.value.error,context:p.value.context,onClose:ee},null,8,["isOpen","title","message","suggestion","details","error","context"]),ke(Pe,{isOpen:L.value,title:J.value.title,message:J.value.message,confirmText:"OK",showCancel:!1,dangerMode:!J.value.success,onConfirm:M,onCancel:M},null,8,["isOpen","title","message","dangerMode"])])}}},Bs=Ce(Ns,[["__scopeId","data-v-a35da958"]]),Hs={class:"banner-content"},qs={class:"banner-icon"},zs={class:"banner-message"},Js={class:"banner-actions"},Ws={__name:"SmartIRBanner",setup(t){const m=Te("smartirStatus"),r=g(!1),w=K(()=>!(!m.value||r.value||localStorage.getItem("smartir_banner_dismissed")==="true")),h=K(()=>{var O;return(O=m.value)!=null&&O.installed?"banner-success":"banner-info"}),a=K(()=>{var O;return(O=m.value)!=null&&O.installed?"mdi mdi-check-circle":"mdi mdi-information"}),u=K(()=>{var O;return(O=m.value)!=null&&O.installed?`SmartIR Detected (v${m.value.version})`:"Want Climate Device Support?"}),f=K(()=>{var O;return(O=m.value)!=null&&O.installed?"You can now create climate device profiles with full temperature and HVAC mode control.":"Install SmartIR to unlock AC/heater control with temperature settings, HVAC modes, and 120+ pre-configured device profiles."});function S(){window.open("https://github.com/smartHomeHub/SmartIR","_blank")}function C(){var O;if(r.value=!0,(O=m.value)!=null&&O.installed)localStorage.setItem("smartir_banner_dismissed","true");else{const $=parseInt(localStorage.getItem("smartir_banner_dismiss_count")||"0");$>=2?localStorage.setItem("smartir_banner_dismissed","true"):localStorage.setItem("smartir_banner_dismiss_count",String($+1))}}return Ae(()=>{var o;const O=localStorage.getItem("smartir_last_status"),$=(o=m.value)!=null&&o.installed?"installed":"not_installed";O!==$&&(localStorage.removeItem("smartir_banner_dismissed"),localStorage.removeItem("smartir_banner_dismiss_count"),localStorage.setItem("smartir_last_status",$))}),(O,$)=>{var o,T;return w.value?(l(),n("div",{key:0,class:Y(["smartir-banner",h.value])},[e("div",Hs,[e("div",qs,[e("i",{class:Y(a.value)},null,2)]),e("div",zs,[e("strong",null,c(u.value),1),e("p",null,c(f.value),1)]),e("div",Js,[(o=O.status)!=null&&o.installed?R("",!0):(l(),n("button",{key:0,onClick:S,class:"btn-primary"}," Learn More ")),e("button",{onClick:C,class:"btn-text"},c((T=O.status)!=null&&T.installed?"Got it":"Dismiss"),1)])])],2)):R("",!0)}}},Ks=Ce(Ws,[["__scopeId","data-v-7bbcbcd7"]]),je="api/smartir",nt={async getStatus(){try{const t=await fetch(`${je}/status`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return await t.json()}catch(t){return console.error("Error fetching SmartIR status:",t),{installed:!1,version:null,error:t.message}}},async getInstallInstructions(){try{const t=await fetch(`${je}/install-instructions`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return await t.json()}catch(t){throw console.error("Error fetching install instructions:",t),t}},async getPlatforms(){try{const t=await fetch(`${je}/platforms`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return await t.json()}catch(t){throw console.error("Error fetching platforms:",t),t}},async getPlatformCodes(t){try{const m=await fetch(`${je}/platforms/${t}/codes`);if(!m.ok)throw new Error(`HTTP error! status: ${m.status}`);return await m.json()}catch(m){throw console.error(`Error fetching codes for ${t}:`,m),m}},async getNextCode(t){try{const m=await fetch(`${je}/platforms/${t}/next-code`);if(!m.ok)throw new Error(`HTTP error! status: ${m.status}`);return await m.json()}catch(m){throw console.error(`Error fetching next code for ${t}:`,m),m}},async validateCode(t,m){try{const r=await fetch(`${je}/validate-code`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({platform:t,code:m})});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);return await r.json()}catch(r){throw console.error("Error validating code:",r),r}}},Xs={class:"profile-card"},Gs={class:"profile-card-header"},Ys=["title"],Zs={class:"profile-details"},Qs=["title"],ea={class:"profile-meta"},ta=["title"],oa=["title"],la=["title"],na={class:"profile-card-footer"},sa=["title"],aa={key:0,class:"learned-indicator"},ia={class:"profile-actions"},ra={__name:"SmartIRProfileCard",props:{profile:{type:Object,required:!0}},emits:["edit","download","delete","commands"],setup(t){const m=t,r=lt(K(()=>m.profile.platform)),w=u=>u.replace(/_/g," ").replace(/\b\w/g,f=>f.toUpperCase()),h=u=>u&&u.startsWith("mdi:")?`mdi ${u.replace(":"," mdi-")}`:`mdi mdi-${u}`,a=u=>{if(!u)return"";const f=u.toLowerCase();return f.includes("broadlink")?"broadlink-tag":f.includes("not set")?"not-set-tag":"default-controller-tag"};return(u,f)=>(l(),n("div",Xs,[e("div",Gs,[e("div",{class:Y(["profile-icon",_e(r).colorClass.value]),title:w(t.profile.platform)},[e("i",{class:Y(h(_e(r).icon.value))},null,2)],10,Ys),e("div",Zs,[e("h4",{title:`${t.profile.manufacturer} ${t.profile.model}`},c(t.profile.manufacturer)+" "+c(t.profile.model),9,Qs),e("div",ea,[e("span",{class:"tag platform-tag",title:w(t.profile.platform)},c(w(t.profile.platform)),9,ta),t.profile.controllerBrand?(l(),n("span",{key:0,class:Y(["tag controller-tag",a(t.profile.controllerBrand)]),title:"Controller: "+t.profile.controllerBrand},[f[4]||(f[4]=e("i",{class:"mdi mdi-remote-tv"},null,-1)),x(" "+c(t.profile.controllerBrand),1)],10,oa)):R("",!0)])]),e("div",{class:"code-badge",title:"Device Code: "+t.profile.code},c(t.profile.code),9,la)]),e("div",na,[e("div",{class:"profile-stats",title:t.profile.commandCount+" total commands"+(t.profile.learnedCount>0?", "+t.profile.learnedCount+" learned":"")},[f[5]||(f[5]=e("i",{class:"mdi mdi-remote"},null,-1)),e("span",null,c(t.profile.commandCount)+" command"+c(t.profile.commandCount!==1?"s":""),1),t.profile.learnedCount>0?(l(),n("span",aa,"( "+c(t.profile.learnedCount)+" learned )",1)):R("",!0)],8,sa),e("div",ia,[e("button",{onClick:f[0]||(f[0]=S=>u.$emit("commands")),class:"action-btn",title:"Commands"},[...f[6]||(f[6]=[e("i",{class:"mdi mdi-remote"},null,-1)])]),e("button",{onClick:f[1]||(f[1]=S=>u.$emit("edit")),class:"action-btn",title:"Edit Profile"},[...f[7]||(f[7]=[e("i",{class:"mdi mdi-pencil"},null,-1)])]),e("button",{onClick:f[2]||(f[2]=S=>u.$emit("download")),class:"action-btn",title:"Download JSON"},[...f[8]||(f[8]=[e("i",{class:"mdi mdi-download"},null,-1)])]),e("button",{onClick:f[3]||(f[3]=S=>u.$emit("delete")),class:"action-btn delete",title:"Delete Profile"},[...f[9]||(f[9]=[e("i",{class:"mdi mdi-delete"},null,-1)])])])])]))}},da=Ce(ra,[["__scopeId","data-v-aad9720f"]]),ua={name:"SmartIRProfileListView",props:{profiles:{type:Array,required:!0}},methods:{getPlatformIcon(t){return{climate:"mdi-thermostat",media_player:"mdi-television",fan:"mdi-fan",light:"mdi-lightbulb"}[t]||"mdi-devices"},formatPlatform(t){return{climate:"Climate",media_player:"Media Player",fan:"Fan",light:"Light"}[t]||t},editProfile(t){this.$emit("edit",t)},viewCommands(t){this.$emit("commands",t)},downloadProfile(t){this.$emit("download",t)},deleteProfile(t){this.$emit("delete",t)}}},ca={class:"profile-list-view"},ma={class:"profile-table"},va={class:"profile-code"},pa={class:"code-badge"},fa={class:"profile-manufacturer"},ga={class:"profile-model"},ya={class:"model-info"},ba={class:"model-name"},ha={key:0,class:"model-count"},ka={class:"profile-platform"},wa={class:"profile-controller"},$a={class:"profile-commands"},Ca={class:"command-stats"},_a={class:"stat-item"},Sa={key:0,class:"stat-item learned"},Ia={class:"profile-actions"},Da=["onClick"],xa=["onClick"],Ta=["onClick"],Ma=["onClick"];function Ra(t,m,r,w,h,a){return l(),n("div",ca,[e("table",ma,[m[6]||(m[6]=e("thead",null,[e("tr",null,[e("th",null,"Code"),e("th",null,"Manufacturer"),e("th",null,"Model"),e("th",null,"Platform"),e("th",null,"Controller"),e("th",null,"Commands"),e("th",null,"Actions")])],-1)),e("tbody",null,[(l(!0),n(fe,null,$e(r.profiles,u=>(l(),n("tr",{key:`${u.platform}-${u.code}`,class:"profile-row"},[e("td",va,[e("span",pa,c(u.code),1)]),e("td",fa,c(u.manufacturer||"Unknown"),1),e("td",ga,[e("div",ya,[e("div",ba,c(u.model||"Unknown"),1),u.models&&u.models.length>1?(l(),n("div",ha," +"+c(u.models.length-1)+" more ",1)):R("",!0)])]),e("td",ka,[e("span",{class:Y(["platform-badge",u.platform])},[e("i",{class:Y(["mdi",a.getPlatformIcon(u.platform)])},null,2),x(" "+c(a.formatPlatform(u.platform)),1)],2)]),e("td",wa,c(u.controller_brand||"N/A"),1),e("td",$a,[e("div",Ca,[e("span",_a,[m[0]||(m[0]=e("i",{class:"mdi mdi-remote"},null,-1)),x(" "+c(u.command_count||0),1)]),u.learned_count>0?(l(),n("span",Sa,[m[1]||(m[1]=e("i",{class:"mdi mdi-school"},null,-1)),x(" "+c(u.learned_count),1)])):R("",!0)])]),e("td",Ia,[e("button",{class:"action-btn edit",onClick:f=>a.editProfile(u),title:"Edit Profile"},[...m[2]||(m[2]=[e("i",{class:"mdi mdi-pencil"},null,-1)])],8,Da),e("button",{class:"action-btn commands",onClick:f=>a.viewCommands(u),title:"View Commands"},[...m[3]||(m[3]=[e("i",{class:"mdi mdi-remote"},null,-1)])],8,xa),e("button",{class:"action-btn download",onClick:f=>a.downloadProfile(u),title:"Download"},[...m[4]||(m[4]=[e("i",{class:"mdi mdi-download"},null,-1)])],8,Ta),e("button",{class:"action-btn delete",onClick:f=>a.deleteProfile(u),title:"Delete"},[...m[5]||(m[5]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,Ma)])]))),128))])])])}const La=Ce(ua,[["render",Ra],["__scopeId","data-v-d3773038"]]),Aa={class:"modal-container"},Oa={class:"modal-body"},Ea={key:0,class:"selection-section"},Va={class:"form-group"},Pa={class:"form-group"},Ua={class:"form-group"},ja={key:0,class:"code-info"},Fa={class:"form-actions"},Na=["disabled"],Ba={key:1,class:"testing-section"},Ha={class:"code-header"},qa={class:"code-details"},za={class:"code-badge"},Ja={class:"device-selector"},Wa=["value"],Ka={key:0,class:"helper-text"},Xa={class:"commands-section"},Ga={class:"commands-header"},Ya={key:0,class:"tested-count"},Za={key:0,class:"filters-section"},Qa={class:"filter-row"},ei={class:"filter-row"},ti={key:1,class:"empty-state"},oi={key:2,class:"empty-state"},li={key:3,class:"commands-list"},ni={class:"command-name"},si={class:"command-actions"},ai={key:0,class:"status-badge success"},ii=["onClick","disabled","title"],ri={__name:"SmartIRCodeTester",props:{isOpen:{type:Boolean,default:!1}},emits:["close","clone"],setup(t,{emit:m}){const r=t,w=m,h=Te("toast"),a=g("climate"),u=g(""),f=g([]),S=g(!1),C=g(null),O=g(""),$=g([]),o=g(!1),T=K(()=>$.value.map(H=>({code:H.code,label:`${H.models.join(", ")} (Code: ${H.code})`,value:H.code}))),q=g(null),U=g(null),I=g(!1),s=g([]),b=g(""),p=g([]),L=g(new Set),J=g(null),Z=g(""),B=g(""),ae=g(""),A=g(""),N=K(()=>{let H=p.value;if(Z.value){const v=Z.value.toLowerCase();H=H.filter(y=>(y.label||y.name).toLowerCase().includes(v))}return B.value&&(H=H.filter(v=>v.mode===B.value)),ae.value&&(H=H.filter(v=>v.fanSpeed===ae.value)),A.value&&(H=H.filter(v=>v.swingMode===A.value)),H}),oe=K(()=>Z.value||B.value||ae.value||A.value);de(()=>r.isOpen,H=>{H&&(ce(),Se())}),de(a,()=>{r.isOpen&&(u.value="",C.value=null,$.value=[],ce())});async function ce(){var H;S.value=!0;try{const v=await ne.get("/api/smartir/codes/manufacturers",{params:{entity_type:a.value}});f.value=v.data.manufacturers||[]}catch(v){console.error("Error loading manufacturers:",v),(H=h.value)==null||H.error("Failed to load manufacturers","âŒ Error")}finally{S.value=!1}}async function we(){var H;if(u.value){o.value=!0;try{const v=await ne.get("/api/smartir/codes/models",{params:{entity_type:a.value,manufacturer:u.value}});$.value=v.data.models||[]}catch(v){console.error("Error loading models:",v),(H=h.value)==null||H.error("Failed to load models","âŒ Error")}finally{o.value=!1}}}async function Se(){try{const H=await ne.get("/api/remote/devices");s.value=H.data.devices||[]}catch(H){console.error("Error loading Broadlink devices:",H)}}async function Me(){var H,v;if(C.value){I.value=!0;try{const y=await ne.get("/api/smartir/codes/code",{params:{entity_type:a.value,code_id:C.value.code}});U.value=y.data.code,q.value=C.value.code,xe(y.data.code),(H=h.value)==null||H.success(`Loaded ${p.value.length} commands`,"âœ… Code Loaded")}catch(y){console.error("Error loading code:",y),(v=h.value)==null||v.error(y.message||"Failed to load code","âŒ Error")}finally{I.value=!1}}}function xe(H){const v=[];if(!H.commands){p.value=v;return}if(a.value==="climate"){const F=H.commands;for(const[ee,M]of Object.entries(F)){if(ee==="off"){typeof M=="string"&&v.push({name:"off",label:"OFF",data:M,mode:"off"});continue}if(typeof M=="object"){for(const[i,P]of Object.entries(M))if(typeof P=="object")for(const[G,ie]of Object.entries(P)){if(typeof ie!="object")continue;const ue=Object.keys(ie),se=ue.includes("24")?"24":ue[0];if(se&&typeof ie[se]=="string"){const te=`${ee}_${se}_${i}_${G}`,ge=`${ee.toUpperCase()} ${se}Â°C ${i} ${G}`;v.push({name:te,label:ge,data:ie[se],mode:ee,temperature:se,fanSpeed:i,swingMode:G})}}}}}else for(const[F,ee]of Object.entries(H.commands))typeof ee=="string"&&v.push({name:F,label:F.toUpperCase().replace(/_/g," "),data:ee});p.value=v}async function D(H){var v,y,F;if(!b.value){(v=h.value)==null||v.warning("Please select a Broadlink device first","âš ï¸ No Device");return}J.value=H;try{const ee=p.value.find(M=>M.name===H);if(!ee||!ee.data)throw new Error(`Command "${H}" not found`);await ne.post("/api/commands/send-raw",{entity_id:b.value,command:ee.data,command_type:"ir"}),L.value.add(H),(y=h.value)==null||y.success(`Command sent: ${ee.label||H}`,"âœ… Tested")}catch(ee){console.error("Error testing command:",ee),(F=h.value)==null||F.error("Failed to test command","âŒ Error")}finally{J.value=null}}function d(){var H,v,y,F;if(!U.value){(H=h.value)==null||H.error("No profile data to download","âŒ Error");return}try{const ee=U.value.manufacturer||"unknown",M=((v=U.value.supportedModels)==null?void 0:v[0])||q.value,i=`${ee.toLowerCase().replace(/\s+/g,"_")}_${M.toLowerCase().replace(/\s+/g,"_")}.json`,P=JSON.stringify(U.value,null,2),G=new Blob([P],{type:"application/json"}),ie=URL.createObjectURL(G),ue=document.createElement("a");ue.href=ie,ue.download=i,document.body.appendChild(ue),ue.click(),document.body.removeChild(ue),URL.revokeObjectURL(ie),(y=h.value)==null||y.success(`Downloaded ${i}`,"âœ… Download Complete")}catch(ee){console.error("Error downloading JSON:",ee),(F=h.value)==null||F.error(ee.message||"Failed to download JSON","âŒ Download Error")}}function V(){u.value="",C.value=null,O.value="",$.value=[]}function ve(){C.value=null,O.value="",we()}function Oe(){O.value?C.value=$.value.find(H=>H.code===O.value):C.value=null}function be(){Z.value="",B.value="",ae.value="",A.value=""}function W(){q.value=null,U.value=null,p.value=[],L.value.clear(),J.value=null,be()}function E(H){const v=H.toLowerCase();return v.includes("power")||v.includes("off")||v==="off"?"mdi-power":v.includes("cool")?"mdi-snowflake":v.includes("heat")?"mdi-fire":v.includes("fan")?"mdi-fan":v.includes("auto")?"mdi-auto-fix":v.includes("dry")?"mdi-water-percent":v.includes("temp")?"mdi-thermometer":v.includes("swing")?"mdi-swap-vertical":"mdi-remote"}function Q(){W(),u.value="",C.value=null,w("close")}return(H,v)=>{var y;return t.isOpen?(l(),n("div",{key:0,class:"modal-overlay",onClick:me(Q,["self"])},[e("div",Aa,[e("div",{class:"modal-header"},[v[9]||(v[9]=e("h3",null,[e("i",{class:"mdi mdi-test-tube"}),x(" Test SmartIR Code ")],-1)),e("button",{onClick:Q,class:"close-btn"},[...v[8]||(v[8]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Oa,[q.value?(l(),n("div",Ba,[e("div",Ha,[e("div",qa,[e("h4",null,c(U.value.manufacturer)+" - "+c(((y=U.value.supportedModels)==null?void 0:y[0])||"Unknown"),1),e("span",za,"Code: "+c(q.value),1)]),e("button",{onClick:W,class:"btn-secondary-small"},[...v[14]||(v[14]=[e("i",{class:"mdi mdi-arrow-left"},null,-1),x(" Change Code ",-1)])])]),e("div",Ja,[v[17]||(v[17]=e("label",null,[e("i",{class:"mdi mdi-remote"}),x(" Broadlink Device ")],-1)),X(e("select",{"onUpdate:modelValue":v[3]||(v[3]=F=>b.value=F),class:"form-select"},[v[15]||(v[15]=e("option",{value:""},"Select device to test with...",-1)),(l(!0),n(fe,null,$e(s.value,F=>(l(),n("option",{key:F.entity_id,value:F.entity_id},c(F.friendly_name||F.entity_id),9,Wa))),128))],512),[[De,b.value]]),b.value?R("",!0):(l(),n("p",Ka,[...v[16]||(v[16]=[e("i",{class:"mdi mdi-information-outline"},null,-1),x(" Select a Broadlink device to enable command testing ",-1)])]))]),e("div",Xa,[e("div",Ga,[e("h5",null,"Sample Commands ("+c(N.value.length)+" / "+c(p.value.length)+")",1),L.value.size>0?(l(),n("span",Ya,c(L.value.size)+" tested ",1)):R("",!0)]),a.value==="climate"&&p.value.length>0?(l(),n("div",Za,[e("div",Qa,[X(e("input",{"onUpdate:modelValue":v[4]||(v[4]=F=>Z.value=F),type:"text",placeholder:"Search commands...",class:"search-input"},null,512),[[Le,Z.value]])]),e("div",ei,[X(e("select",{"onUpdate:modelValue":v[5]||(v[5]=F=>B.value=F),class:"filter-select"},[...v[18]||(v[18]=[e("option",{value:""},"All Modes",-1),e("option",{value:"cool"},"Cool",-1),e("option",{value:"heat"},"Heat",-1),e("option",{value:"off"},"Off",-1)])],512),[[De,B.value]]),X(e("select",{"onUpdate:modelValue":v[6]||(v[6]=F=>ae.value=F),class:"filter-select"},[...v[19]||(v[19]=[Ue('<option value="" data-v-66569200>All Fan Speeds</option><option value="low" data-v-66569200>Low</option><option value="mid" data-v-66569200>Mid</option><option value="high" data-v-66569200>High</option><option value="auto" data-v-66569200>Auto</option>',5)])],512),[[De,ae.value]]),X(e("select",{"onUpdate:modelValue":v[7]||(v[7]=F=>A.value=F),class:"filter-select"},[...v[20]||(v[20]=[e("option",{value:""},"All Swing",-1),e("option",{value:"stop"},"Stop",-1),e("option",{value:"swing"},"Swing",-1)])],512),[[De,A.value]]),oe.value?(l(),n("button",{key:0,onClick:be,class:"btn-clear-filters"},[...v[21]||(v[21]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),x(" Clear ",-1)])])):R("",!0)])])):R("",!0),p.value.length===0?(l(),n("div",ti,[...v[22]||(v[22]=[e("i",{class:"mdi mdi-alert-circle"},null,-1),e("p",null,"No commands found in this code",-1)])])):N.value.length===0?(l(),n("div",oi,[v[23]||(v[23]=e("i",{class:"mdi mdi-filter-off"},null,-1)),v[24]||(v[24]=e("p",null,"No commands match your filters",-1)),e("button",{onClick:be,class:"btn-secondary-small"}," Clear Filters ")])):(l(),n("div",li,[(l(!0),n(fe,null,$e(N.value,F=>(l(),n("div",{key:F.name,class:Y(["command-item",{tested:L.value.has(F.name),testing:J.value===F.name}])},[e("div",ni,[e("i",{class:Y(["mdi",E(F.mode||F.name)])},null,2),e("span",null,c(F.label||F.name),1)]),e("div",si,[L.value.has(F.name)?(l(),n("span",ai,[...v[25]||(v[25]=[e("i",{class:"mdi mdi-check"},null,-1),x(" Tested ",-1)])])):R("",!0),e("button",{onClick:ee=>D(F.name),disabled:!b.value||J.value===F.name,title:b.value?"Test this command":"Select a Broadlink device first",class:"btn-test"},[e("i",{class:Y(["mdi",J.value===F.name?"mdi-loading mdi-spin":"mdi-play"])},null,2),v[26]||(v[26]=x(" Test ",-1))],8,ii)])],2))),128))]))]),e("div",{class:"modal-actions"},[e("button",{onClick:d,class:"btn-primary"},[...v[27]||(v[27]=[e("i",{class:"mdi mdi-download"},null,-1),x(" Download JSON ",-1)])]),e("button",{onClick:Q,class:"btn-secondary"}," Close ")])])):(l(),n("div",Ea,[v[13]||(v[13]=e("div",{class:"info-banner"},[e("i",{class:"mdi mdi-information"}),e("p",null,"Select a SmartIR code from the index to test commands with your Broadlink device.")],-1)),e("div",Va,[v[11]||(v[11]=e("label",null,[e("i",{class:"mdi mdi-shape"}),x(" Platform ")],-1)),X(e("select",{"onUpdate:modelValue":v[0]||(v[0]=F=>a.value=F),onChange:V,class:"form-select"},[...v[10]||(v[10]=[e("option",{value:"climate"},"Climate (AC/Heater)",-1),e("option",{value:"media_player"},"Media Player (TV/Audio)",-1),e("option",{value:"fan"},"Fan",-1),e("option",{value:"light"},"Light",-1)])],544),[[De,a.value]])]),e("div",Pa,[ke(Je,{modelValue:u.value,"onUpdate:modelValue":v[1]||(v[1]=F=>u.value=F),options:f.value,label:"Manufacturer",placeholder:"Search manufacturers...",loading:S.value,disabled:S.value,onChange:ve},null,8,["modelValue","options","loading","disabled"])]),e("div",Ua,[ke(Je,{modelValue:O.value,"onUpdate:modelValue":v[2]||(v[2]=F=>O.value=F),options:T.value,"option-label":"label","option-value":"code",label:"Model",placeholder:"Search models...",loading:o.value,disabled:!u.value||o.value,onChange:Oe},null,8,["modelValue","options","loading","disabled"])]),C.value?(l(),n("div",ja,[v[12]||(v[12]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[e("strong",null,c(u.value)+" - "+c(C.value.models[0]),1),e("p",null,"Code: "+c(C.value.code),1)])])):R("",!0),e("div",Fa,[e("button",{onClick:Me,disabled:!C.value||I.value,class:"btn-primary"},[e("i",{class:Y(["mdi",I.value?"mdi-loading mdi-spin":"mdi-download"])},null,2),x(" "+c(I.value?"Loading...":"Load Commands"),1)],8,Na)])]))])])])):R("",!0)}}},di=Ce(ri,[["__scopeId","data-v-66569200"]]),ui={class:"smartir-status-card"},ci={class:"card-header"},mi=["src"],vi={class:"header-badges"},pi=["title"],fi={class:"header-info"},gi={class:"header-info"},yi={class:"header-info"},bi={class:"header-right"},hi={key:0,class:"view-toggle-group header-view-toggle"},ki={key:2,class:"settings-menu-container"},wi={key:0,class:"card-body loading-state"},$i={key:1,class:"card-body error-state"},Ci={key:2,class:"card-body installed-state"},_i={key:0,class:"help-panel"},Si={key:0,class:"recommendation"},Ii={key:0,class:"next-steps"},Di={class:"help-actions"},xi={key:1,class:"filter-bar"},Ti={class:"filter-search-row"},Mi=["title"],Ri={key:0,class:"filter-badge"},Li={class:"search-input-wrapper"},Ai={class:"filter-content"},Oi={class:"filter-row"},Ei={class:"filter-group"},Vi={class:"filter-results"},Pi={key:2,class:"loading-state"},Ui={key:3,class:"empty-state"},ji={key:4,class:"profiles-grid"},Fi={key:6,class:"no-results"},Ni={key:3,class:"card-body not-installed-state"},Bi={class:"benefits-section"},Hi={class:"benefits-list"},qi={class:"recommendation"},zi={__name:"SmartIRStatusCard",emits:["create-profile","edit-profile"],setup(t,{expose:m,emit:r}){const w=r,h=Te("smartirStatus");Te("smartirEnabled");const a=Te("refreshSmartIR"),{isMobile:u}=Ge(),f=g(!1),S=g(null),C=g((h==null?void 0:h.value)||null),O=g(localStorage.getItem("smartir_simulate_not_installed")==="true"),$=g(!1),o=g(!1),T=g(!0),q=g([]),U=g(!1),I=g(!1),s=g({search:"",platform:""}),b=g({show:!1,title:"",message:"",platform:null,profile:null}),p=g(!1),J=g(window.innerWidth<=767?"grid":localStorage.getItem("profile_view_mode")||"grid");de(u,v=>{v&&J.value==="list"&&(J.value="grid")}),de(J,v=>{localStorage.setItem("profile_view_mode",v)}),de(T,v=>{v||(o.value=!1)});const Z=["Full climate entity support (AC, heaters)","120+ pre-configured device profiles","Temperature and humidity sensor integration","HVAC mode control (heat, cool, auto, dry, fan)"],B=["climate","media_player","fan","light"],ae=K(()=>O.value?{installed:!1,recommendation:{message:"Install SmartIR to unlock climate device support!",benefits:["Full climate entity support (AC, heaters)","120+ pre-configured device profiles","Temperature and humidity sensor integration","HVAC mode control (heat, cool, auto, dry, fan)"]}}:C.value),A=K(()=>{var v,y;return((y=(v=ae.value)==null?void 0:v.platforms)==null?void 0:y.length)||0}),N=K(()=>{var v;return(v=ae.value)!=null&&v.device_counts?Object.values(ae.value.device_counts).reduce((y,F)=>y+F,0):0});function oe(){var v;O.value=!O.value,localStorage.setItem("smartir_simulate_not_installed",O.value.toString()),!O.value&&((v=C.value)!=null&&v.installed)&&be()}const ce=K(()=>{let v=q.value;if(s.value.search){const y=s.value.search.toLowerCase();v=v.filter(F=>{var ee,M,i,P;return((ee=F.manufacturer)==null?void 0:ee.toLowerCase().includes(y))||((M=F.model)==null?void 0:M.toLowerCase().includes(y))||((i=F.code)==null?void 0:i.toString().includes(y))||((P=F.platform)==null?void 0:P.toLowerCase().includes(y))})}return s.value.platform&&(v=v.filter(y=>y.platform===s.value.platform)),v}),we=K(()=>s.value.search||s.value.platform),Se=K(()=>{let v=0;return s.value.search&&v++,s.value.platform&&v++,v});function Me(){s.value.search="",s.value.platform=""}async function xe(){f.value=!0,S.value=null;try{if(a)await a();else{const v=await nt.getStatus();C.value=v}}catch(v){S.value=v.message||"Failed to refresh SmartIR status",console.error("Error refreshing SmartIR status:",v)}finally{f.value=!1}}function D(){w("create-profile")}function d(){$.value=!$.value,o.value=!1}function V(){T.value||(T.value=!0),o.value=!o.value}function ve(){p.value=!0,o.value=!1}function Oe(){window.open("https://github.com/smartHomeHub/SmartIR","_blank")}async function be(){U.value=!0;const v=[];try{for(const y of B)try{const ee=((await ne.get(`/api/smartir/platforms/${y}/profiles`)).data.profiles||[]).map(M=>({...M,platform:y}));v.push(...ee)}catch(F){console.warn(`Network error loading ${y} profiles (using bundled index):`,F.message)}q.value=v}catch(y){console.error("Unexpected error loading profiles:",y)}finally{U.value=!1}}function W(v,y,F){w("edit-profile",{platform:v,profile:y,startStep:F})}async function E(v,y){var F,ee;try{const i=(await ne.get(`/api/smartir/platforms/${v}/profiles/${y.code}`)).data,P=JSON.stringify(i.profile,null,2),G=new Blob([P],{type:"application/json"}),ie=URL.createObjectURL(G),ue=document.createElement("a");ue.href=ie,ue.download=`smartir_${v}_${y.manufacturer}_${y.model}_${y.code}.json`,document.body.appendChild(ue),ue.click(),document.body.removeChild(ue),URL.revokeObjectURL(ie),(F=Te("toast").value)==null||F.success(`Downloaded ${y.manufacturer} ${y.model}`,"âœ… Profile Downloaded")}catch(M){console.error("Error downloading profile:",M),(ee=Te("toast").value)==null||ee.error("Failed to download profile","âŒ Download Error")}}async function Q(v,y){Te("toast");try{const ee=(await ne.post(`/api/smartir/profiles/${y.code}/check-usage`,{platform:v})).data;if(ee&&ee.in_use){b.value={show:!0,title:`Cannot Delete ${y.manufacturer} ${y.model}`,message:`This profile is currently in use by ${ee.device_count} device(s):

${ee.devices.join(`
`)}

Please remove or reassign these devices before deleting the profile.`,platform:v,profile:y,canDelete:!1,devices:ee.devices};return}}catch(F){console.error("Error checking profile usage:",F)}b.value={show:!0,title:`Delete ${y.manufacturer} ${y.model}?`,message:`Device Code: ${y.code}

This will remove the profile and update your configuration.`,platform:v,profile:y,canDelete:!0}}async function H(){var ee,M;const v=Te("toast"),{platform:y,profile:F}=b.value;b.value.show=!1;try{await ne.delete(`/api/smartir/profiles/${F.code}`,{data:{platform:y}}),await be(),await tt(),await xe(),(ee=v.value)==null||ee.success(`${F.manufacturer} ${F.model} has been removed`,"âœ… Profile Deleted")}catch(i){console.error("Error deleting profile:",i),(M=v.value)==null||M.error("Failed to delete profile","âŒ Delete Error")}}return de(h,v=>{v&&(C.value=v)},{immediate:!0}),de(J,v=>{localStorage.setItem("profile_view_mode",v)}),Ae(async()=>{var v;h!=null&&h.value&&(C.value=h.value),C.value||await xe(),(v=C.value)!=null&&v.installed&&await be()}),m({loadAllProfiles:be,refreshStatus:xe}),(v,y)=>{var F,ee,M,i,P,G,ie,ue,se;return l(),n("div",ui,[e("div",ci,[e("button",{class:"icon-button chevron-button",onClick:y[0]||(y[0]=te=>T.value=!T.value)},[e("i",{class:Y(["mdi",T.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2)]),e("div",{class:"header-left",onClick:y[1]||(y[1]=te=>T.value=!T.value)},[e("img",{src:_e(Ye),alt:"SmartIR",class:"smartir-logo"},null,8,mi),e("h3",null,c(_e(u)?"SmartIR":"SmartIR Integration"),1),e("div",vi,[e("div",{class:Y(["simulation-toggle-pill",{active:O.value}]),onClick:me(oe,["stop"]),title:O.value?"Click to show as installed":"Click to simulate not-installed"},[e("i",{class:Y(["mdi",O.value?"mdi-eye-off":"mdi-eye"])},null,2),e("span",null,c(O.value?"Simulating: Not Installed":"Simulation Mode"),1)],10,pi),(F=ae.value)!=null&&F.installed?(l(),n(fe,{key:0},[y[16]||(y[16]=e("div",{class:"status-badge-mini success"},[e("i",{class:"mdi mdi-check-circle"}),e("span",null,"Installed")],-1)),e("span",fi,"v"+c(ae.value.version||"Unknown"),1),e("span",gi,c(A.value)+" platform"+c(A.value!==1?"s":""),1),e("span",yi,c(N.value)+" device"+c(N.value!==1?"s":""),1)],64)):R("",!0)])]),e("div",bi,[!_e(u)&&((ee=ae.value)!=null&&ee.installed)?(l(),n("div",hi,[e("button",{onClick:y[2]||(y[2]=me(te=>J.value="grid",["stop"])),class:Y(["view-toggle-btn",{active:J.value==="grid"}]),title:"Grid View"},[...y[17]||(y[17]=[e("i",{class:"mdi mdi-view-grid"},null,-1)])],2),e("button",{onClick:y[3]||(y[3]=me(te=>J.value="list",["stop"])),class:Y(["view-toggle-btn",{active:J.value==="list"}]),title:"List View"},[...y[18]||(y[18]=[e("i",{class:"mdi mdi-view-list"},null,-1)])],2)])):R("",!0),(M=ae.value)!=null&&M.installed?(l(),n("button",{key:1,onClick:me(D,["stop"]),class:"btn btn-primary new-button"},[...y[19]||(y[19]=[e("i",{class:"mdi mdi-plus"},null,-1),e("span",null,"New",-1)])])):R("",!0),(i=ae.value)!=null&&i.installed?(l(),n("div",ki,[e("button",{onClick:me(V,["stop"]),class:Y(["icon-button settings-button",{active:o.value}]),title:"Settings"},[...y[20]||(y[20]=[e("i",{class:"mdi mdi-cog"},null,-1)])],2),o.value?(l(),n("div",{key:0,class:"settings-dropdown",onClick:y[5]||(y[5]=me(()=>{},["stop"]))},[e("button",{onClick:d,class:"menu-item"},[y[21]||(y[21]=e("i",{class:"mdi mdi-help-circle"},null,-1)),e("span",null,c($.value?"Hide Help":"Show Help"),1)]),e("button",{onClick:y[4]||(y[4]=te=>{o.value=!1,xe()}),class:"menu-item"},[...y[22]||(y[22]=[e("i",{class:"mdi mdi-refresh"},null,-1),e("span",null,"Refresh Status",-1)])]),e("button",{onClick:ve,class:"menu-item"},[...y[23]||(y[23]=[e("i",{class:"mdi mdi-test-tube"},null,-1),e("span",null,"Test Codes",-1)])])])):R("",!0)])):R("",!0)])]),X(e("div",null,[f.value?(l(),n("div",wi,[...y[24]||(y[24]=[e("div",{class:"spinner"},null,-1),e("p",null,"Checking SmartIR installation...",-1)])])):S.value?(l(),n("div",$i,[y[25]||(y[25]=e("i",{class:"mdi mdi-alert-circle"},null,-1)),e("p",null,c(S.value),1),e("button",{onClick:xe,class:"btn-secondary"}," Try Again ")])):(P=ae.value)!=null&&P.installed?(l(),n("div",Ci,[$.value?(l(),n("div",_i,[C.value.recommendation?(l(),n("div",Si,[e("p",null,c(C.value.recommendation.message),1),C.value.recommendation.next_steps?(l(),n("div",Ii,[y[26]||(y[26]=e("strong",null,"Next Steps:",-1)),e("ul",null,[(l(!0),n(fe,null,$e(C.value.recommendation.next_steps,(te,ge)=>(l(),n("li",{key:ge},c(te),1))),128))])])):R("",!0)])):R("",!0),e("div",Di,[e("button",{onClick:y[6]||(y[6]=(...te)=>v.viewDocumentation&&v.viewDocumentation(...te)),class:"btn-secondary"},[...y[27]||(y[27]=[e("i",{class:"mdi mdi-book-open-variant"},null,-1),x(" View Documentation ",-1)])])])])):R("",!0),q.value.length>0&&!O.value?(l(),n("div",xi,[e("div",Ti,[e("button",{class:Y(["filter-toggle-button",{active:I.value||we.value}]),onClick:y[7]||(y[7]=te=>I.value=!I.value),title:I.value?"Hide filters":"Show filters"},[y[28]||(y[28]=e("i",{class:"mdi mdi-filter-variant"},null,-1)),we.value?(l(),n("span",Ri,c(Se.value),1)):R("",!0)],10,Mi),e("div",Li,[y[29]||(y[29]=e("i",{class:"mdi mdi-magnify search-icon"},null,-1)),X(e("input",{"onUpdate:modelValue":y[8]||(y[8]=te=>s.value.search=te),type:"text",placeholder:"Search profiles...",class:"search-input"},null,512),[[Le,s.value.search]])])]),X(e("div",Ai,[e("div",Oi,[e("div",Ei,[e("label",null,[y[31]||(y[31]=e("i",{class:"mdi mdi-shape"},null,-1)),X(e("select",{"onUpdate:modelValue":y[9]||(y[9]=te=>s.value.platform=te)},[...y[30]||(y[30]=[Ue('<option value="" data-v-4ef33ace>All Platforms</option><option value="climate" data-v-4ef33ace>Climate</option><option value="media_player" data-v-4ef33ace>Media Player</option><option value="fan" data-v-4ef33ace>Fan</option><option value="light" data-v-4ef33ace>Light</option>',5)])],512),[[De,s.value.platform]])])]),we.value?(l(),n("button",{key:0,onClick:Me,class:"btn-clear-filters"},[...y[32]||(y[32]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),x(" Clear ",-1)])])):R("",!0),e("div",Vi,c(ce.value.length)+" of "+c(q.value.length),1)])],512),[[ze,I.value]])])):R("",!0),U.value?(l(),n("div",Pi,[...y[33]||(y[33]=[e("i",{class:"mdi mdi-loading mdi-spin"},null,-1),e("p",null,"Loading profiles...",-1)])])):q.value.length===0?(l(),n("div",Ui,[...y[34]||(y[34]=[e("i",{class:"mdi mdi-file-document-outline"},null,-1),e("h3",null,"No Profiles Yet",-1),e("p",null,"Create your first SmartIR profile to get started",-1)])])):R("",!0),J.value==="grid"&&!O.value?(l(),n("div",ji,[(l(!0),n(fe,null,$e(ce.value,te=>(l(),Ee(da,{key:`${te.platform}-${te.code}`,profile:te,onEdit:ge=>W(te.platform,te),onCommands:ge=>W(te.platform,te,2),onDownload:ge=>E(te.platform,te),onDelete:ge=>Q(te.platform,te)},null,8,["profile","onEdit","onCommands","onDownload","onDelete"]))),128))])):J.value==="list"&&!O.value&&ce.value.length>0?(l(),Ee(La,{key:5,profiles:ce.value,onEdit:y[10]||(y[10]=te=>W(te.platform,te)),onCommands:y[11]||(y[11]=te=>W(te.platform,te,2)),onDownload:y[12]||(y[12]=te=>E(te.platform,te)),onDelete:y[13]||(y[13]=te=>Q(te.platform,te))},null,8,["profiles"])):R("",!0),q.value.length>0&&ce.value.length===0&&!O.value?(l(),n("div",Fi,[...y[35]||(y[35]=[e("i",{class:"mdi mdi-filter-off"},null,-1),e("h3",null,"No profiles match your filters",-1),e("p",null,"Try adjusting your search or filter criteria",-1)])])):R("",!0)])):(l(),n("div",Ni,[y[39]||(y[39]=e("div",{class:"status-badge warning"},[e("i",{class:"mdi mdi-information"}),e("span",null,"Not Installed")],-1)),e("div",Bi,[y[37]||(y[37]=e("h4",null,"Why Install SmartIR?",-1)),e("ul",Hi,[(l(!0),n(fe,null,$e(((ie=(G=C.value)==null?void 0:G.recommendation)==null?void 0:ie.benefits)||Z,(te,ge)=>(l(),n("li",{key:ge},[y[36]||(y[36]=e("i",{class:"mdi mdi-check"},null,-1)),e("span",null,c(te),1)]))),128))])]),e("div",qi,[e("p",null,c(((se=(ue=C.value)==null?void 0:ue.recommendation)==null?void 0:se.message)||"Install SmartIR to unlock climate device support!"),1)]),e("div",{class:"card-actions"},[e("button",{onClick:Oe,class:"btn-primary"},[...y[38]||(y[38]=[e("i",{class:"mdi mdi-github"},null,-1),x(" Install SmartIR ",-1)])])])]))],512),[[ze,T.value]]),ke(Pe,{isOpen:b.value.show,title:b.value.title,message:b.value.message,confirmText:b.value.canDelete===!1?null:"Delete",cancelText:"Close",dangerMode:!0,confirmDisabled:b.value.canDelete===!1,onConfirm:H,onCancel:y[14]||(y[14]=te=>b.value.show=!1)},null,8,["isOpen","title","message","confirmText","confirmDisabled"]),ke(di,{isOpen:p.value,onClose:y[15]||(y[15]=te=>p.value=!1)},null,8,["isOpen"])])}}},Ji=Ce(zi,[["__scopeId","data-v-4ef33ace"]]),Wi={class:"climate-form"},Ki={class:"learning-mode-section"},Xi={class:"mode-toggle"},Gi={class:"mode-content"},Yi={class:"mode-stats"},Zi={class:"stat-badge"},Qi={class:"stat-badge time"},er={class:"mode-content"},tr={class:"mode-stats"},or={class:"stat-badge"},lr={class:"stat-badge time warning"},nr={key:0,class:"command-breakdown"},sr={class:"warning-text"},ar={class:"form-section"},ir={key:0,class:"help-text"},rr={key:1,class:"help-text"},dr={class:"form-row"},ur={class:"form-group"},cr={class:"form-group"},mr={class:"form-group"},vr={key:2,class:"representative-temp-section"},pr={class:"form-group"},fr=["value"],gr={class:"form-section"},yr={class:"checkbox-grid"},br={class:"checkbox-item"},hr={class:"checkbox-item"},kr={class:"checkbox-item"},wr={class:"checkbox-item"},$r={class:"checkbox-item"},Cr={class:"checkbox-item"},_r={class:"form-section"},Sr={class:"checkbox-grid"},Ir={class:"checkbox-item"},Dr={class:"checkbox-item"},xr={class:"checkbox-item"},Tr={class:"checkbox-item"},Mr={class:"form-section"},Rr={class:"checkbox-grid"},Lr={class:"checkbox-item"},Ar={class:"checkbox-item"},Or={class:"checkbox-item"},Er={class:"checkbox-item"},Vr={class:"form-section"},Pr={class:"form-group"},Ur={class:"form-group"},jr={class:"form-group"},Fr={key:0,class:"validation-summary"},Nr={__name:"ClimateProfileForm",props:{modelValue:{type:Object,default:()=>({})}},emits:["update:modelValue"],setup(t,{emit:m}){const r=t,w=m,h=g("quick"),a=g({minTemp:16,maxTemp:30,precision:1,representativeTemp:24,modes:["off","auto","cool","heat"],fanModes:["auto","low","medium","high"],swingModes:[],tempSensor:"",humiditySensor:"",powerSensor:"",learningMode:"quick",...r.modelValue}),u=K(()=>{const I=[],s=a.value.minTemp||16,b=a.value.maxTemp||30,p=a.value.precision||1;for(let L=s;L<=b;L+=p)I.push(L);return I}),f=K(()=>a.value.modes.filter(I=>I!=="off").length),S=K(()=>a.value.fanModes.length||1),C=K(()=>a.value.swingModes.length||1),O=K(()=>{const I=a.value.minTemp||16,s=a.value.maxTemp||30,b=a.value.precision||1;return Math.floor((s-I)/b)+1}),$=K(()=>{const I=a.value.modes.includes("off")?1:0;return f.value*S.value*C.value+I}),o=K(()=>Math.ceil($.value*30/60)),T=K(()=>{const I=a.value.modes.includes("off")?1:0;return f.value*O.value*S.value*C.value+I}),q=K(()=>Math.ceil(T.value*30/60)),U=K(()=>{const I=[];return(!a.value.minTemp||a.value.minTemp<10||a.value.minTemp>35)&&I.push("Minimum temperature must be between 10Â°C and 35Â°C"),(!a.value.maxTemp||a.value.maxTemp<10||a.value.maxTemp>35)&&I.push("Maximum temperature must be between 10Â°C and 35Â°C"),a.value.minTemp>=a.value.maxTemp&&I.push("Minimum temperature must be less than maximum temperature"),(!a.value.modes||a.value.modes.length===0)&&I.push("At least one HVAC mode must be selected"),I});return de(h,I=>{a.value.learningMode=I}),de(a,I=>{w("update:modelValue",I)},{deep:!0,immediate:!0}),(I,s)=>(l(),n("div",Wi,[s[63]||(s[63]=e("h3",null,"Climate Device Configuration",-1)),e("div",Ki,[e("div",Xi,[e("label",{class:Y(["mode-option",{active:h.value==="quick"}])},[X(e("input",{type:"radio",value:"quick","onUpdate:modelValue":s[0]||(s[0]=b=>h.value=b)},null,512),[[qe,h.value]]),e("div",Gi,[s[23]||(s[23]=e("div",{class:"mode-header"},[e("i",{class:"mdi mdi-flash"}),e("strong",null,"Quick Mode (Recommended)")],-1)),s[24]||(s[24]=e("p",null,"Learn one temperature per mode combination",-1)),e("div",Yi,[e("span",Zi,c($.value)+" commands",1),e("span",Qi,"~"+c(o.value)+" min",1)])])],2),e("label",{class:Y(["mode-option",{active:h.value==="complete"}])},[X(e("input",{type:"radio",value:"complete","onUpdate:modelValue":s[1]||(s[1]=b=>h.value=b)},null,512),[[qe,h.value]]),e("div",er,[s[25]||(s[25]=e("div",{class:"mode-header"},[e("i",{class:"mdi mdi-check-all"}),e("strong",null,"Complete Mode")],-1)),s[26]||(s[26]=e("p",null,"Learn all temperature combinations",-1)),e("div",tr,[e("span",or,c(T.value)+" commands",1),e("span",lr,"~"+c(q.value)+" min",1)])])],2)]),h.value==="complete"?(l(),n("div",nr,[s[27]||(s[27]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[e("strong",null,"Complete mode will require learning "+c(T.value)+" commands",1),e("p",null,"This includes all combinations of modes ("+c(f.value)+"), temperatures ("+c(O.value)+"), fan speeds ("+c(S.value)+"), and swing modes ("+c(C.value)+").",1),e("p",sr,"â±ï¸ Estimated time: "+c(q.value)+" minutes at ~30 seconds per command",1)])])):R("",!0)]),e("div",ar,[s[33]||(s[33]=e("h4",null,"Temperature Range",-1)),h.value==="quick"?(l(),n("p",ir," Define the full temperature range your device supports. You'll select one temperature to learn below. ")):(l(),n("p",rr," Define the temperature range. All temperatures in this range will be learned. ")),e("div",dr,[e("div",ur,[s[28]||(s[28]=e("label",null,"Minimum Temperature (Â°C) *",-1)),X(e("input",{"onUpdate:modelValue":s[2]||(s[2]=b=>a.value.minTemp=b),type:"number",min:"10",max:"35",placeholder:"16"},null,512),[[Le,a.value.minTemp,void 0,{number:!0}]])]),e("div",cr,[s[29]||(s[29]=e("label",null,"Maximum Temperature (Â°C) *",-1)),X(e("input",{"onUpdate:modelValue":s[3]||(s[3]=b=>a.value.maxTemp=b),type:"number",min:"10",max:"35",placeholder:"30"},null,512),[[Le,a.value.maxTemp,void 0,{number:!0}]])]),e("div",mr,[s[31]||(s[31]=e("label",null,"Precision",-1)),X(e("select",{"onUpdate:modelValue":s[4]||(s[4]=b=>a.value.precision=b)},[...s[30]||(s[30]=[e("option",{value:1},"1Â°C (Whole degrees)",-1),e("option",{value:.5},"0.5Â°C (Half degrees)",-1)])],512),[[De,a.value.precision,void 0,{number:!0}]])])]),h.value==="quick"?(l(),n("div",vr,[e("div",pr,[s[32]||(s[32]=e("label",null,"Representative Temperature to Learn *",-1)),X(e("select",{"onUpdate:modelValue":s[5]||(s[5]=b=>a.value.representativeTemp=b)},[(l(!0),n(fe,null,$e(u.value,b=>(l(),n("option",{key:b,value:b},c(b)+"Â°C ",9,fr))),128))],512),[[De,a.value.representativeTemp,void 0,{number:!0}]]),e("small",null,"This temperature will be learned for all mode combinations. The device profile will still show the full range ("+c(a.value.minTemp)+"Â°C - "+c(a.value.maxTemp)+"Â°C).",1)])])):R("",!0)]),e("div",gr,[s[40]||(s[40]=e("h4",null,"Supported HVAC Modes *",-1)),s[41]||(s[41]=e("p",{class:"help-text"},"Select all modes your device supports",-1)),e("div",yr,[e("label",br,[X(e("input",{type:"checkbox",value:"off","onUpdate:modelValue":s[6]||(s[6]=b=>a.value.modes=b)},null,512),[[ye,a.value.modes]]),s[34]||(s[34]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),x(" Off ")],-1))]),e("label",hr,[X(e("input",{type:"checkbox",value:"auto","onUpdate:modelValue":s[7]||(s[7]=b=>a.value.modes=b)},null,512),[[ye,a.value.modes]]),s[35]||(s[35]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-autorenew"}),x(" Auto ")],-1))]),e("label",kr,[X(e("input",{type:"checkbox",value:"cool","onUpdate:modelValue":s[8]||(s[8]=b=>a.value.modes=b)},null,512),[[ye,a.value.modes]]),s[36]||(s[36]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-snowflake"}),x(" Cool ")],-1))]),e("label",wr,[X(e("input",{type:"checkbox",value:"heat","onUpdate:modelValue":s[9]||(s[9]=b=>a.value.modes=b)},null,512),[[ye,a.value.modes]]),s[37]||(s[37]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fire"}),x(" Heat ")],-1))]),e("label",$r,[X(e("input",{type:"checkbox",value:"dry","onUpdate:modelValue":s[10]||(s[10]=b=>a.value.modes=b)},null,512),[[ye,a.value.modes]]),s[38]||(s[38]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-water-percent"}),x(" Dry ")],-1))]),e("label",Cr,[X(e("input",{type:"checkbox",value:"fan_only","onUpdate:modelValue":s[11]||(s[11]=b=>a.value.modes=b)},null,512),[[ye,a.value.modes]]),s[39]||(s[39]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan"}),x(" Fan Only ")],-1))])])]),e("div",_r,[s[46]||(s[46]=e("h4",null,"Fan Modes",-1)),s[47]||(s[47]=e("p",{class:"help-text"},"Select all fan speeds your device supports",-1)),e("div",Sr,[e("label",Ir,[X(e("input",{type:"checkbox",value:"auto","onUpdate:modelValue":s[12]||(s[12]=b=>a.value.fanModes=b)},null,512),[[ye,a.value.fanModes]]),s[42]||(s[42]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-autorenew"}),x(" Auto ")],-1))]),e("label",Dr,[X(e("input",{type:"checkbox",value:"low","onUpdate:modelValue":s[13]||(s[13]=b=>a.value.fanModes=b)},null,512),[[ye,a.value.fanModes]]),s[43]||(s[43]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-1"}),x(" Low ")],-1))]),e("label",xr,[X(e("input",{type:"checkbox",value:"medium","onUpdate:modelValue":s[14]||(s[14]=b=>a.value.fanModes=b)},null,512),[[ye,a.value.fanModes]]),s[44]||(s[44]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-2"}),x(" Medium ")],-1))]),e("label",Tr,[X(e("input",{type:"checkbox",value:"high","onUpdate:modelValue":s[15]||(s[15]=b=>a.value.fanModes=b)},null,512),[[ye,a.value.fanModes]]),s[45]||(s[45]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-3"}),x(" High ")],-1))])])]),e("div",Mr,[s[52]||(s[52]=e("h4",null,"Swing Modes (Optional)",-1)),s[53]||(s[53]=e("p",{class:"help-text"},"Select if your device has swing/oscillation",-1)),e("div",Rr,[e("label",Lr,[X(e("input",{type:"checkbox",value:"off","onUpdate:modelValue":s[16]||(s[16]=b=>a.value.swingModes=b)},null,512),[[ye,a.value.swingModes]]),s[48]||(s[48]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-horizontal"}),x(" Off ")],-1))]),e("label",Ar,[X(e("input",{type:"checkbox",value:"vertical","onUpdate:modelValue":s[17]||(s[17]=b=>a.value.swingModes=b)},null,512),[[ye,a.value.swingModes]]),s[49]||(s[49]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-vertical"}),x(" Vertical ")],-1))]),e("label",Or,[X(e("input",{type:"checkbox",value:"horizontal","onUpdate:modelValue":s[18]||(s[18]=b=>a.value.swingModes=b)},null,512),[[ye,a.value.swingModes]]),s[50]||(s[50]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-horizontal"}),x(" Horizontal ")],-1))]),e("label",Er,[X(e("input",{type:"checkbox",value:"both","onUpdate:modelValue":s[19]||(s[19]=b=>a.value.swingModes=b)},null,512),[[ye,a.value.swingModes]]),s[51]||(s[51]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-arrow-all"}),x(" Both ")],-1))])])]),e("div",Vr,[s[60]||(s[60]=e("h4",null,"Sensors (Optional)",-1)),s[61]||(s[61]=e("p",{class:"help-text"},"Link external sensors for better climate control",-1)),e("div",Pr,[s[54]||(s[54]=e("label",null,"Temperature Sensor",-1)),X(e("input",{"onUpdate:modelValue":s[20]||(s[20]=b=>a.value.tempSensor=b),type:"text",placeholder:"sensor.living_room_temperature"},null,512),[[Le,a.value.tempSensor]]),s[55]||(s[55]=e("small",null,"Entity ID of temperature sensor",-1))]),e("div",Ur,[s[56]||(s[56]=e("label",null,"Humidity Sensor",-1)),X(e("input",{"onUpdate:modelValue":s[21]||(s[21]=b=>a.value.humiditySensor=b),type:"text",placeholder:"sensor.living_room_humidity"},null,512),[[Le,a.value.humiditySensor]]),s[57]||(s[57]=e("small",null,"Entity ID of humidity sensor",-1))]),e("div",jr,[s[58]||(s[58]=e("label",null,"Power Sensor",-1)),X(e("input",{"onUpdate:modelValue":s[22]||(s[22]=b=>a.value.powerSensor=b),type:"text",placeholder:"binary_sensor.ac_power"},null,512),[[Le,a.value.powerSensor]]),s[59]||(s[59]=e("small",null,"Entity ID of power sensor (to detect on/off state)",-1))])]),U.value.length>0?(l(),n("div",Fr,[s[62]||(s[62]=e("h4",null,[e("i",{class:"mdi mdi-alert-circle"}),x(" Please fix the following: ")],-1)),e("ul",null,[(l(!0),n(fe,null,$e(U.value,(b,p)=>(l(),n("li",{key:p},c(b),1))),128))])])):R("",!0)]))}},Br=Ce(Nr,[["__scopeId","data-v-c44d7198"]]),Hr={class:"command-wizard"},qr={class:"device-selection-section"},zr={class:"input-wrapper"},Jr=["value"],Wr={key:0,class:"validation-tooltip"},Kr={class:"form-group"},Xr=["disabled"],Gr={key:0},Yr={key:1},Zr={key:0,class:"edit-mode-banner"},Qr={class:"wizard-info"},ed={key:0},td={key:1},od={class:"progress-info"},ld={class:"progress-bar"},nd={class:"progress-text"},sd={class:"commands-grid"},ad={class:"command-header"},id={class:"command-icon"},rd={class:"command-info"},dd={key:0,class:"learning-indicator"},ud={key:0,class:"ir-learning-steps"},cd={key:1,class:"rf-learning-steps"},md={class:"command-actions"},vd=["onClick","disabled"],pd={key:1,class:"learned-status"},fd=["onClick","disabled"],gd=["onClick"],yd={class:"quick-actions"},bd=["disabled"],hd=["disabled"],kd={__name:"CommandLearningWizard",props:{modelValue:{type:Object,default:()=>({})},platform:{type:String,required:!0},config:{type:Object,required:!0},broadlinkDevice:{type:String,default:""},manufacturer:{type:String,required:!0},model:{type:String,required:!0},commandType:{type:String,default:"ir"}},emits:["update:modelValue","update:broadlinkDevice","update:commandType"],setup(t,{emit:m}){const r=Fe(),w=t,h=m,a=g({...w.modelValue}),u=g(null),f=g(null),S=g([]),C=g(w.broadlinkDevice),O=g(w.commandType),$=g(!1),o=g([]),T=g(!1),q=g(!1),U=g({show:!1,commandKey:null,commandLabel:""}),I=g(!1),s=K(()=>{const D=[];if(w.platform==="climate"){const d=w.config.modes||[],V=w.config.fanModes||[],ve=w.config.minTemp||16,Oe=w.config.maxTemp||30;d.forEach(be=>{if(be==="off")D.push({key:"off",label:"Power Off",description:"Turn device off",icon:"mdi mdi-power",mode:"off"});else for(let W=ve;W<=Oe;W++)V.forEach(E=>{const Q=`${be}_${W}_${E}`;D.push({key:Q,label:`${be.toUpperCase()} ${W}Â°C ${E}`,description:`Mode: ${be}, Temp: ${W}Â°C, Fan: ${E}`,icon:J(be),mode:be,temp:W,fanMode:E})})})}else if(w.platform==="media_player"){const d=w.config.features||[];d.includes("turn_on")&&(D.push({key:"turn_on",label:"Power On",description:"Turn on the device",icon:"mdi mdi-power"}),D.push({key:"turn_off",label:"Power Off",description:"Turn off the device",icon:"mdi mdi-power-off"})),d.includes("volume")&&(D.push({key:"volume_up",label:"Volume Up",description:"Increase volume",icon:"mdi mdi-volume-plus"}),D.push({key:"volume_down",label:"Volume Down",description:"Decrease volume",icon:"mdi mdi-volume-minus"})),d.includes("mute")&&D.push({key:"mute",label:"Mute",description:"Toggle mute",icon:"mdi mdi-volume-mute"}),d.includes("source")&&(D.push({key:"source_hdmi1",label:"Source: HDMI 1",description:"Switch to HDMI 1",icon:"mdi mdi-import"}),D.push({key:"source_hdmi2",label:"Source: HDMI 2",description:"Switch to HDMI 2",icon:"mdi mdi-import"}),D.push({key:"source_hdmi3",label:"Source: HDMI 3",description:"Switch to HDMI 3",icon:"mdi mdi-import"})),d.includes("channel")&&(D.push({key:"channel_up",label:"Channel Up",description:"Next channel",icon:"mdi mdi-chevron-up"}),D.push({key:"channel_down",label:"Channel Down",description:"Previous channel",icon:"mdi mdi-chevron-down"}))}else if(w.platform==="fan"){const d=w.config.speedLevels||3,V=w.config.features||[];D.push({key:"turn_on",label:"Power On",description:"Turn on the fan",icon:"mdi mdi-power"}),D.push({key:"turn_off",label:"Power Off",description:"Turn off the fan",icon:"mdi mdi-power-off"});for(let ve=1;ve<=d;ve++){const Oe=ve===1?"Low":ve===d?"High":ve===2&&d===3?"Medium":`Speed ${ve}`;D.push({key:`speed_${ve}`,label:`${Oe}`,description:`Set fan to speed level ${ve}`,icon:"mdi mdi-fan"})}V.includes("oscillate")&&(D.push({key:"oscillate_on",label:"Oscillate On",description:"Enable oscillation",icon:"mdi mdi-sync"}),D.push({key:"oscillate_off",label:"Oscillate Off",description:"Disable oscillation",icon:"mdi mdi-sync-off"})),V.includes("direction")&&(D.push({key:"direction_forward",label:"Direction: Forward",description:"Set direction to forward",icon:"mdi mdi-rotate-right"}),D.push({key:"direction_reverse",label:"Direction: Reverse",description:"Set direction to reverse",icon:"mdi mdi-rotate-left"}))}else if(w.platform==="light"){const d=w.config.features||[];d.includes("turn_on")&&(D.push({key:"turn_on",label:"Power On",description:"Turn on the light",icon:"mdi mdi-lightbulb-on"}),D.push({key:"turn_off",label:"Power Off",description:"Turn off the light",icon:"mdi mdi-lightbulb-off"})),d.includes("brightness")&&(D.push({key:"brightness_up",label:"Brightness Up",description:"Increase brightness",icon:"mdi mdi-brightness-7"}),D.push({key:"brightness_down",label:"Brightness Down",description:"Decrease brightness",icon:"mdi mdi-brightness-5"})),d.includes("color_temp")&&(D.push({key:"color_temp_warm",label:"Warm White",description:"Set to warm white",icon:"mdi mdi-weather-sunset"}),D.push({key:"color_temp_cool",label:"Cool White",description:"Set to cool white",icon:"mdi mdi-weather-sunny"})),d.includes("rgb")&&(D.push({key:"color_red",label:"Color: Red",description:"Set color to red",icon:"mdi mdi-palette"}),D.push({key:"color_green",label:"Color: Green",description:"Set color to green",icon:"mdi mdi-palette"}),D.push({key:"color_blue",label:"Color: Blue",description:"Set color to blue",icon:"mdi mdi-palette"}))}return D}),b=K(()=>s.value.length),p=K(()=>Object.keys(a.value).length),L=K(()=>b.value===0?0:Math.round(p.value/b.value*100));function J(D){return{off:"mdi mdi-power",auto:"mdi mdi-autorenew",cool:"mdi mdi-snowflake",heat:"mdi mdi-fire",dry:"mdi mdi-water-percent",fan_only:"mdi mdi-fan"}[D]||"mdi mdi-remote"}async function Z(D){if(!u.value){if(!C.value){q.value=!0,window.scrollTo({top:0,behavior:"smooth"});return}q.value=!1,u.value=D.key;try{const d=w.manufacturer.toLowerCase().replace(/[^a-z0-9]+/g,"_"),V=w.model.toLowerCase().replace(/[^a-z0-9]+/g,"_"),ve=`${d}_${V}`,be=(await ne.post("/api/commands/learn",{entity_id:C.value,device:ve,command:D.key,command_type:O.value})).data;if(be.success&&be.code)a.value[D.key]=be.code,h("update:modelValue",a.value),T.value=!0,be.code==="pending"&&console.log(`â³ Command '${D.key}' learned, code will be fetched from storage when saving`),$.value&&o.value.length>0&&setTimeout(()=>{const W=o.value.shift();W?Z(W):$.value=!1},1e3);else throw new Error(be.error||"Failed to learn command")}catch(d){console.error("Error learning command:",d),r.error(`Error learning command: ${d.message}`),$.value=!1,o.value=[]}finally{$.value||(u.value=null)}}}async function B(D){var d;if(!C.value){q.value=!0,window.scrollTo({top:0,behavior:"smooth"});return}if(!a.value[D]){(d=r.value)==null||d.error("Command not learned yet");return}f.value=D;try{const V=a.value[D];await ne.post("/api/commands/send-raw",{entity_id:C.value,command:V,command_type:O.value}),r.success("Command sent successfully")}catch(V){console.error("Error testing command:",V),r.error(`Error testing command: ${V.message}`)}finally{f.value=null}}function ae(D){const d=s.value.find(V=>V.key===D);U.value={show:!0,commandKey:D,commandLabel:d?d.label:D}}function A(){const D=U.value.commandKey;delete a.value[D],h("update:modelValue",a.value),U.value.show=!1}function N(){const D=s.value.filter(V=>!a.value[V.key]);if(D.length===0)return;$.value=!0,o.value=[...D];const d=o.value.shift();d&&Z(d)}function oe(){I.value=!0}function ce(){a.value={},h("update:modelValue",a.value),I.value=!1}de(()=>w.modelValue,D=>{a.value={...D}},{deep:!0}),Ae(async()=>{await we()});async function we(){try{console.log("SmartIR device - commands will be loaded from SmartIR JSON file, not Broadlink storage")}catch(D){console.error("Error in loadExistingCommands:",D)}}function Se(){h("update:broadlinkDevice",C.value)}function Me(){h("update:commandType",O.value)}async function xe(){try{console.log("ğŸ” Loading Broadlink devices from /api/remote/devices");const D=await ne.get("/api/remote/devices");console.log("ğŸ“¦ Response data:",D.data);const d=D.data.devices||[];console.log(`âœ… Found ${d.length} devices:`,d),S.value=d}catch(D){console.error("âŒ Error loading remote devices:",D),S.value=[]}}return de(()=>w.broadlinkDevice,D=>{C.value=D}),de(C,D=>{D&&(q.value=!1)}),de(()=>w.commandType,D=>{O.value=D}),Ae(async()=>{await xe(),await we()}),(D,d)=>(l(),n("div",Hr,[d[22]||(d[22]=e("h3",null,"Learn IR Commands",-1)),e("div",qr,[e("div",{class:Y(["form-group",{"has-error":q.value}])},[d[6]||(d[6]=e("label",null,"Broadlink Device *",-1)),e("div",zr,[X(e("select",{"onUpdate:modelValue":d[0]||(d[0]=V=>C.value=V),onChange:Se},[d[4]||(d[4]=e("option",{value:""},"Select Broadlink device...",-1)),(l(!0),n(fe,null,$e(S.value,V=>(l(),n("option",{key:V.entity_id,value:V.entity_id},c(V.name||V.entity_id),9,Jr))),128))],544),[[De,C.value]]),q.value?(l(),n("div",Wr,[...d[5]||(d[5]=[e("i",{class:"mdi mdi-alert"},null,-1),x(" Device is required ",-1)])])):R("",!0)]),e("small",null,"This device will be used to learn commands ("+c(S.value.length)+" devices found)",1)],2),e("div",Kr,[d[8]||(d[8]=e("label",null,"Command Type *",-1)),X(e("select",{"onUpdate:modelValue":d[1]||(d[1]=V=>O.value=V),onChange:Me,disabled:p.value>0},[...d[7]||(d[7]=[e("option",{value:"ir"},"ğŸ“¡ Infrared (IR) - Most common for AC, TV, etc.",-1),e("option",{value:"rf"},"ğŸ“» Radio Frequency (RF) - For RF remotes",-1)])],40,Xr),[[De,O.value]]),p.value>0?(l(),n("small",Gr,"Command type cannot be changed after learning commands")):(l(),n("small",Yr,"Select the type of commands your device uses"))])]),p.value>0&&!T.value?(l(),n("div",Zr,[d[10]||(d[10]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[d[9]||(d[9]=e("strong",null,"Editing Existing Profile",-1)),e("p",null,c(p.value)+" command"+c(p.value!==1?"s":"")+' already learned. You can re-learn any command by clicking the delete icon and then "Learn Command".',1)])])):R("",!0),e("div",Qr,[d[14]||(d[14]=e("i",{class:"mdi mdi-information"},null,-1)),e("div",null,[d[13]||(d[13]=e("p",null,[e("strong",null,"How it works:")],-1)),t.commandType==="ir"?(l(),n("ol",ed,[...d[11]||(d[11]=[e("li",null,'Click "Learn Command" for each combination',-1),e("li",null,[e("strong",null,"Point your IR remote directly at the Broadlink device")],-1),e("li",null,"Press the button on your remote",-1),e("li",null,"Wait for confirmation (up to 30 seconds)",-1)])])):(l(),n("ol",td,[...d[12]||(d[12]=[e("li",null,'Click "Learn Command" for each combination',-1),e("li",null,[e("strong",null,"Step 1:"),x(" Hold button on remote - Broadlink scans for RF frequency")],-1),e("li",null,[e("strong",null,"Step 2:"),x(" Watch for Home Assistant notification, then press and release button")],-1),e("li",null,"Keep remote within 5cm of Broadlink (RF doesn't need line-of-sight)",-1),e("li",null,"Wait for confirmation (may take up to 30 seconds)",-1)])]))])]),e("div",od,[e("div",ld,[e("div",{class:"progress-fill",style:rt({width:L.value+"%"})},null,4)]),e("span",nd,c(p.value)+" / "+c(b.value)+" commands learned ("+c(L.value)+"%) ",1)]),e("div",sd,[(l(!0),n(fe,null,$e(s.value,V=>(l(),n("div",{key:V.key,class:Y(["command-card",{learned:a.value[V.key],learning:u.value===V.key}])},[e("div",ad,[e("div",id,[e("i",{class:Y(V.icon)},null,2)]),e("div",rd,[e("h4",null,c(V.label),1),e("p",null,c(V.description),1)])]),u.value===V.key?(l(),n("div",dd,[t.commandType==="ir"?(l(),n("div",ud,[...d[15]||(d[15]=[e("p",null,[e("strong",null,"Point your remote directly at the Broadlink device and press the button.")],-1),e("small",null,"Listening for up to 30 seconds...",-1)])])):(l(),n("div",cd,[...d[16]||(d[16]=[e("p",{class:"rf-title"},[e("strong",null,"Learning request sent to device.")],-1),e("p",{class:"rf-subtitle"},[x("RF learning is a "),e("strong",null,"two-step process"),x(":")],-1),e("ol",null,[e("li",null,[e("strong",null,"Step 1 - Frequency Sweep (~10-15 seconds):"),x(" Press and hold the button on your remote until the notification updates. ")]),e("li",null,[e("strong",null,"Step 2 - Learn Signal:"),x(" Press and release the button once. ")])],-1),e("p",{class:"rf-note"},"Follow the Home Assistant notifications (ğŸ””) for real-time instructions.",-1)])]))])):R("",!0),e("div",md,[a.value[V.key]?(l(),n("div",pd,[d[18]||(d[18]=e("i",{class:"mdi mdi-check-circle"},null,-1)),d[19]||(d[19]=e("span",null,"Learned",-1)),e("span",{class:Y(["command-type-badge",O.value])},c(O.value.toUpperCase()),3),e("button",{onClick:ve=>B(V.key),class:"icon-btn",title:"Test command",disabled:f.value===V.key,style:{"margin-left":"auto"}},[e("i",{class:Y(["mdi mdi-play",{"mdi-spin":f.value===V.key}])},null,2)],8,fd),e("button",{onClick:ve=>ae(V.key),class:"icon-btn danger",title:"Delete and re-learn"},[...d[17]||(d[17]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,gd)])):(l(),n("button",{key:0,onClick:ve=>Z(V),class:Y(["btn-learn",{learning:u.value===V.key}]),disabled:u.value!==null},[e("i",{class:Y(["mdi mdi-radio-tower",{"mdi-spin":u.value===V.key}])},null,2),x(" "+c(u.value===V.key?"Listening...":"Learn Command"),1)],10,vd))])],2))),128))]),e("div",yd,[e("button",{onClick:N,class:"btn-secondary",disabled:u.value!==null||p.value===b.value},[...d[20]||(d[20]=[e("i",{class:"mdi mdi-play-circle"},null,-1),x(" Learn All Remaining ",-1)])],8,bd),e("button",{onClick:oe,class:"btn-text",disabled:p.value===0},[...d[21]||(d[21]=[e("i",{class:"mdi mdi-delete-sweep"},null,-1),x(" Clear All ",-1)])],8,hd)]),ke(Pe,{isOpen:U.value.show,title:"Delete Learned Command?",message:`Are you sure you want to delete the '${U.value.commandLabel}' command?

You will need to re-learn this command.`,confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,onConfirm:A,onCancel:d[2]||(d[2]=V=>U.value.show=!1)},null,8,["isOpen","message"]),ke(Pe,{isOpen:I.value,title:"Delete All Learned Commands?",message:"Are you sure you want to delete all learned commands? This cannot be undone.\\n\\nYou will need to re-learn all commands.",confirmText:"Delete All",cancelText:"Cancel",dangerMode:!0,onConfirm:ce,onCancel:d[3]||(d[3]=V=>I.value=!1)},null,8,["isOpen"])]))}},wd=Ce(kd,[["__scopeId","data-v-9a9e9e51"]]),$d={class:"profile-preview"},Cd={class:"preview-summary"},_d={class:"summary-card"},Sd={class:"stats-grid"},Id={class:"stat-item"},Dd={class:"stat-value"},xd={class:"stat-item"},Td={class:"stat-value"},Md={class:"stat-item"},Rd={class:"stat-value"},Ld={class:"preview-tabs"},Ad={class:"preview-content"},Od={key:0,class:"tab-content"},Ed={class:"code-header"},Vd={class:"code-block"},Pd={key:1,class:"tab-content"},Ud={class:"code-header"},jd={class:"code-block"},Fd={key:2,class:"tab-content"},Nd={class:"instructions"},Bd={class:"step-item"},Hd={class:"step-content"},qd={class:"code-path"},zd={__name:"ProfilePreview",props:{profile:{type:Object,required:!0},jsonData:{type:Object,required:!0},yamlConfig:{type:String,required:!0}},setup(t){const m=Fe(),r=t,w=g("json"),h=g(!1),a=g(!1),u=K(()=>Object.keys(r.profile.commands||{}).length),f=K(()=>JSON.stringify(r.jsonData,null,2));async function S(){try{await navigator.clipboard.writeText(f.value),h.value=!0,setTimeout(()=>{h.value=!1},2e3)}catch(O){console.error("Failed to copy JSON:",O),m.error("Failed to copy to clipboard")}}async function C(){try{await navigator.clipboard.writeText(r.yamlConfig),a.value=!0,setTimeout(()=>{a.value=!1},2e3)}catch(O){console.error("Failed to copy YAML:",O),m.error("Failed to copy to clipboard")}}return(O,$)=>{var o;return l(),n("div",$d,[$[22]||($[22]=e("h3",null,"Preview & Save",-1)),e("div",Cd,[e("div",_d,[$[4]||($[4]=e("i",{class:"mdi mdi-check-circle"},null,-1)),e("div",null,[$[3]||($[3]=e("h4",null,"Profile Ready!",-1)),e("p",null,c(t.profile.manufacturer)+" "+c(t.profile.model),1)])]),e("div",Sd,[e("div",Id,[e("span",Dd,c(u.value),1),$[5]||($[5]=e("span",{class:"stat-label"},"Commands Learned",-1))]),e("div",xd,[e("span",Td,c(t.profile.platform),1),$[6]||($[6]=e("span",{class:"stat-label"},"Platform",-1))]),e("div",Md,[e("span",Rd,c(((o=t.profile.config.modes)==null?void 0:o.length)||0),1),$[7]||($[7]=e("span",{class:"stat-label"},"HVAC Modes",-1))])])]),e("div",Ld,[e("button",{onClick:$[0]||($[0]=T=>w.value="json"),class:Y(["tab-button",{active:w.value==="json"}])},[...$[8]||($[8]=[e("i",{class:"mdi mdi-code-json"},null,-1),x(" SmartIR JSON ",-1)])],2),e("button",{onClick:$[1]||($[1]=T=>w.value="yaml"),class:Y(["tab-button",{active:w.value==="yaml"}])},[...$[9]||($[9]=[e("i",{class:"mdi mdi-file-code"},null,-1),x(" YAML Config ",-1)])],2),e("button",{onClick:$[2]||($[2]=T=>w.value="instructions"),class:Y(["tab-button",{active:w.value==="instructions"}])},[...$[10]||($[10]=[e("i",{class:"mdi mdi-information"},null,-1),x(" Instructions ",-1)])],2)]),e("div",Ad,[w.value==="json"?(l(),n("div",Od,[e("div",Ed,[$[12]||($[12]=e("h4",null,"SmartIR Device Code JSON",-1)),e("button",{onClick:S,class:"btn-copy"},[$[11]||($[11]=e("i",{class:"mdi mdi-content-copy"},null,-1)),x(" "+c(h.value?"Copied!":"Copy"),1)])]),e("pre",Vd,[e("code",null,c(f.value),1)]),$[13]||($[13]=e("p",{class:"code-note"},[e("i",{class:"mdi mdi-information"}),x(" Save this as "),e("code",null,"10000.json"),x(" in your SmartIR codes directory ")],-1))])):R("",!0),w.value==="yaml"?(l(),n("div",Pd,[e("div",Ud,[$[15]||($[15]=e("h4",null,"Home Assistant Configuration",-1)),e("button",{onClick:C,class:"btn-copy"},[$[14]||($[14]=e("i",{class:"mdi mdi-content-copy"},null,-1)),x(" "+c(a.value?"Copied!":"Copy"),1)])]),e("pre",jd,[e("code",null,c(t.yamlConfig),1)]),$[16]||($[16]=e("p",{class:"code-note"},[e("i",{class:"mdi mdi-information"}),x(" Add this to your "),e("code",null,"configuration.yaml"),x(" file ")],-1))])):R("",!0),w.value==="instructions"?(l(),n("div",Fd,[e("div",Nd,[$[20]||($[20]=e("h4",null,"Installation Steps",-1)),e("div",Bd,[$[19]||($[19]=e("div",{class:"step-number"},"1",-1)),e("div",Hd,[$[17]||($[17]=e("h5",null,"Get Next Code Number",-1)),$[18]||($[18]=e("p",null,"Custom device codes start at 10000. Check your SmartIR codes directory to find the next available number.",-1)),e("div",qd,[e("code",null,"/config/custom_components/smartir/codes/"+c(t.profile.platform)+"/",1)])])]),$[21]||($[21]=Ue('<div class="step-item" data-v-e7b997c8><div class="step-number" data-v-e7b997c8>2</div><div class="step-content" data-v-e7b997c8><h5 data-v-e7b997c8>Save JSON File</h5><p data-v-e7b997c8>Copy the JSON from the &quot;SmartIR JSON&quot; tab and save it as <code data-v-e7b997c8>10000.json</code> (or your next available number) in the codes directory.</p></div></div><div class="step-item" data-v-e7b997c8><div class="step-number" data-v-e7b997c8>3</div><div class="step-content" data-v-e7b997c8><h5 data-v-e7b997c8>Update Configuration</h5><p data-v-e7b997c8>Copy the YAML from the &quot;YAML Config&quot; tab and add it to your <code data-v-e7b997c8>configuration.yaml</code> file. Update the <code data-v-e7b997c8>device_code</code> to match your JSON filename.</p></div></div><div class="step-item" data-v-e7b997c8><div class="step-number" data-v-e7b997c8>4</div><div class="step-content" data-v-e7b997c8><h5 data-v-e7b997c8>Restart Home Assistant</h5><p data-v-e7b997c8>Restart Home Assistant to load the new configuration. Your climate entity will appear in the UI.</p></div></div><div class="step-item" data-v-e7b997c8><div class="step-number" data-v-e7b997c8>5</div><div class="step-content" data-v-e7b997c8><h5 data-v-e7b997c8>Test Your Device</h5><p data-v-e7b997c8>Go to your climate entity and test different modes, temperatures, and fan speeds to ensure everything works correctly.</p></div></div><div class="tips-section" data-v-e7b997c8><h4 data-v-e7b997c8><i class="mdi mdi-lightbulb" data-v-e7b997c8></i> Tips </h4><ul data-v-e7b997c8><li data-v-e7b997c8>Keep a backup of your JSON file in case you need to modify it</li><li data-v-e7b997c8>Test all commands to ensure they work as expected</li><li data-v-e7b997c8>You can share your profile with the SmartIR community on GitHub</li><li data-v-e7b997c8>If a command doesn&#39;t work, you can re-learn it and update the JSON</li></ul></div>',5))])])):R("",!0)])])}}},Jd=Ce(zd,[["__scopeId","data-v-e7b997c8"]]),Wd={class:"wizard-body"},Kd={key:0,class:"warning-section"},Xd={class:"warning-box"},Gd={class:"instructions"},Yd={class:"code-block"},Zd={class:"steps"},Qd={key:0},eu={class:"help-section"},tu={key:0,class:"help-content"},ou={class:"help-step"},lu={key:0,class:"help-step"},nu={class:"help-step"},su={class:"help-step"},au={class:"checklist"},iu={class:"checkbox-label"},ru={key:0,class:"checkbox-label"},du={class:"wizard-footer"},uu=["disabled"],cu={__name:"SmartIRSetupWizard",props:{show:{type:Boolean,default:!1},platform:{type:String,required:!0},warnings:{type:Array,default:()=>[]},configPath:{type:String,default:"/config"}},emits:["close","complete"],setup(t,{emit:m}){const r=t,w=m,h=Te("toast"),a=g(!1),u=g(!1),f=g(!1),S=K(()=>r.warnings.length>0?a.value&&u.value:a.value);function C(){const $=`${r.platform}: !include smartir/${r.platform}.yaml`;navigator.clipboard.writeText($).then(()=>{var o;(o=h.value)==null||o.success("Include line copied to clipboard!","âœ… Copied")}).catch(o=>{var T;console.error("Failed to copy:",o),(T=h.value)==null||T.error("Failed to copy to clipboard","âŒ Copy Failed")})}function O(){w("complete")}return($,o)=>t.show?(l(),n("div",{key:0,class:"modal-overlay",onClick:o[5]||(o[5]=me(()=>{},["stop"]))},[e("div",{class:"setup-wizard",onClick:o[4]||(o[4]=me(()=>{},["stop"]))},[o[31]||(o[31]=e("div",{class:"wizard-header"},[e("h2",null,[e("i",{class:"mdi mdi-cog"}),x(" SmartIR Configuration Setup ")])],-1)),e("div",Wd,[t.warnings.length>0?(l(),n("div",Kd,[e("div",Xd,[o[11]||(o[11]=e("i",{class:"mdi mdi-alert"},null,-1)),e("div",null,[o[9]||(o[9]=e("h3",null,"âš ï¸ Configuration Migration Needed",-1)),o[10]||(o[10]=e("p",null,"We detected existing platform entries in your configuration.yaml:",-1)),e("ul",null,[(l(!0),n(fe,null,$e(t.warnings,T=>(l(),n("li",{key:T.platform},[e("strong",null,c(T.platform)+":",1),x(" "+c(T.message),1)]))),128))]),e("p",null,[o[6]||(o[6]=e("strong",null,"Action Required:",-1)),o[7]||(o[7]=x(" Move these entries to ",-1)),e("code",null,"smartir/"+c(t.platform)+".yaml",1),o[8]||(o[8]=x(" before continuing.",-1))])])])])):R("",!0),e("div",Gd,[o[27]||(o[27]=e("h3",null,"ğŸ“ One-Time Setup",-1)),o[28]||(o[28]=e("p",null,[x("To enable SmartIR device management, add this line to your "),e("code",null,"configuration.yaml"),x(":")],-1)),e("div",Yd,[e("code",null,c(t.platform)+": !include smartir/"+c(t.platform)+".yaml",1),e("button",{onClick:C,class:"copy-btn",title:"Copy to clipboard"},[...o[12]||(o[12]=[e("i",{class:"mdi mdi-content-copy"},null,-1)])])]),e("div",Zd,[o[19]||(o[19]=e("h4",null,"Steps:",-1)),e("ol",null,[t.warnings.length>0?(l(),n("li",Qd,[o[13]||(o[13]=e("strong",null,"Move existing entries:",-1)),o[14]||(o[14]=x(" Copy any existing ",-1)),e("code",null,c(t.platform)+":",1),o[15]||(o[15]=x(" entries from configuration.yaml to ",-1)),e("code",null,"smartir/"+c(t.platform)+".yaml",1)])):R("",!0),o[16]||(o[16]=e("li",null,[e("strong",null,"Add include line:"),x(" Add the line above to your configuration.yaml ")],-1)),o[17]||(o[17]=e("li",null,[e("strong",null,"Save changes:"),x(" Save configuration.yaml ")],-1)),o[18]||(o[18]=e("li",null,[e("strong",null,"Continue here:"),x(` Click "I've Completed Setup" below `)],-1))])]),e("div",eu,[e("button",{onClick:o[0]||(o[0]=T=>f.value=!f.value),class:"help-toggle"},[e("i",{class:Y(["mdi",f.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2),x(" "+c(f.value?"Hide":"Show")+" Detailed Instructions ",1)]),f.value?(l(),n("div",tu,[o[26]||(o[26]=e("h4",null,"Detailed Setup Guide:",-1)),e("div",ou,[o[21]||(o[21]=e("h5",null,"1. Open configuration.yaml",-1)),e("p",null,[o[20]||(o[20]=x("Location: ",-1)),e("code",null,c(t.configPath)+"/configuration.yaml",1)])]),t.warnings.length>0?(l(),n("div",lu,[o[22]||(o[22]=e("h5",null,"2. Migrate Existing Entries (If Any)",-1)),e("p",null,"If you have existing "+c(t.platform)+" entries, cut them from configuration.yaml and paste into:",1),e("p",null,[e("code",null,c(t.configPath)+"/smartir/"+c(t.platform)+".yaml",1)]),o[23]||(o[23]=e("p",{class:"note"},"Broadlink Manager will create this file automatically.",-1))])):R("",!0),e("div",nu,[e("h5",null,c(t.warnings.length>0?"3":"2")+". Add Include Line",1),o[24]||(o[24]=e("p",null,"Add this to configuration.yaml:",-1)),e("pre",null,c(t.platform)+": !include smartir/"+c(t.platform)+".yaml",1)]),e("div",su,[e("h5",null,c(t.warnings.length>0?"4":"3")+". Restart Home Assistant",1),o[25]||(o[25]=e("p",null,"After saving, you'll need to restart HA for changes to take effect.",-1))])])):R("",!0)])]),e("div",au,[e("label",iu,[X(e("input",{type:"checkbox","onUpdate:modelValue":o[1]||(o[1]=T=>a.value=T)},null,512),[[ye,a.value]]),o[29]||(o[29]=e("span",null,"I've added the include line to configuration.yaml",-1))]),t.warnings.length>0?(l(),n("label",ru,[X(e("input",{type:"checkbox","onUpdate:modelValue":o[2]||(o[2]=T=>u.value=T)},null,512),[[ye,u.value]]),e("span",null,"I've migrated existing "+c(t.platform)+" entries (if any)",1)])):R("",!0)])]),e("div",du,[e("button",{onClick:o[3]||(o[3]=T=>$.$emit("close")),class:"btn-secondary"}," Cancel "),e("button",{onClick:O,class:"btn-primary",disabled:!S.value},[...o[30]||(o[30]=[e("i",{class:"mdi mdi-check"},null,-1),x(" I've Completed Setup ",-1)])],8,uu)])])])):R("",!0)}},mu=Ce(cu,[["__scopeId","data-v-f6fe4c03"]]),vu={class:"modal-header"},pu={class:"progress-steps"},fu={class:"step-number"},gu={key:0,class:"mdi mdi-check"},yu={key:1},bu={class:"step-label"},hu={class:"modal-body"},ku={key:0,class:"step-content"},wu={class:"form-group"},$u={class:"form-group"},Cu={class:"form-group"},_u={key:1,class:"step-content"},Su={key:1,class:"platform-form"},Iu={class:"form-section"},Du={class:"checkbox-grid"},xu={class:"checkbox-item"},Tu={class:"checkbox-item"},Mu={class:"checkbox-item"},Ru={class:"checkbox-item"},Lu={class:"checkbox-item"},Au={key:2,class:"platform-form"},Ou={class:"form-section"},Eu={class:"form-group"},Vu={class:"form-section"},Pu={class:"checkbox-grid"},Uu={class:"checkbox-item"},ju={class:"checkbox-item"},Fu={key:3,class:"platform-form"},Nu={class:"form-section"},Bu={class:"checkbox-grid"},Hu={class:"checkbox-item"},qu={class:"checkbox-item"},zu={class:"checkbox-item"},Ju={class:"checkbox-item"},Wu={key:2,class:"step-content"},Ku={key:3,class:"step-content"},Xu={class:"modal-footer"},Gu=["disabled"],Yu={key:2,class:"save-buttons"},Zu=["disabled"],Qu=["disabled"],ec={__name:"SmartIRProfileBuilder",props:{show:{type:Boolean,default:!1},editMode:{type:Boolean,default:!1},editData:{type:Object,default:null},startStep:{type:Number,default:0}},emits:["close","save"],setup(t,{emit:m}){const r=t,w=m,h=Te("toast"),a=g(0),u=g(!1),f=g([]),S=g(!1),C=g([]),O=g("/config"),$=g(!1),o=g(null),T=g(!1),q=g(!1),U=g(""),I=g("ir"),s=g(!1),b=[{label:"Device Info",key:"info"},{label:"Configuration",key:"config"},{label:"Learn Commands",key:"commands"},{label:"Preview & Save",key:"preview"}],p=g({platform:"",manufacturer:"",model:"",broadlinkDevice:"",commandType:"ir",config:{},commands:{}}),L=g(["turn_on"]),J=g(3),Z=g([]),B=g(["turn_on"]);de(()=>p.value.platform,M=>{M==="media_player"?p.value.config={features:L.value}:M==="fan"?p.value.config={speedLevels:J.value,features:Z.value}:M==="light"&&(p.value.config={features:B.value})}),de(L,M=>{p.value.platform==="media_player"&&(p.value.config={features:M})},{deep:!0}),de(J,M=>{p.value.platform==="fan"&&(p.value.config={speedLevels:M,features:Z.value})}),de(Z,M=>{p.value.platform==="fan"&&(p.value.config={speedLevels:J.value,features:M})},{deep:!0}),de(B,M=>{p.value.platform==="light"&&(p.value.config={features:M})},{deep:!0});function ae(M){const i=new Set,P=Object.keys(M);return P.some(G=>G==="off"||G.includes("_off"))&&i.add("off"),P.some(G=>G.includes("auto"))&&i.add("auto"),P.some(G=>G.includes("cool"))&&i.add("cool"),P.some(G=>G.includes("heat"))&&i.add("heat"),P.some(G=>G.includes("dry"))&&i.add("dry"),P.some(G=>G.includes("fan_only"))&&i.add("fan_only"),Array.from(i)}function A(M){const i=new Set,P=Object.keys(M);return P.some(G=>G.includes("auto"))&&i.add("auto"),P.some(G=>G.includes("low"))&&i.add("low"),P.some(G=>G.includes("medium")||G.includes("mid"))&&i.add("medium"),P.some(G=>G.includes("high"))&&i.add("high"),Array.from(i)}function N(M){const i=new Set,P=Object.keys(M);return P.some(G=>G.includes("swing_off")||G.includes("_off"))&&i.add("off"),P.some(G=>G.includes("vertical"))&&i.add("vertical"),P.some(G=>G.includes("horizontal"))&&i.add("horizontal"),P.some(G=>G.includes("both"))&&i.add("both"),Array.from(i)}function oe(M){for(const i of Object.values(M))if(typeof i=="string"&&i.startsWith("sc")||Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0].startsWith("sc"))return"rf";return"ir"}de(()=>p.value.commandType,(M,i)=>{!i||T.value||s.value||(Object.keys(p.value.commands).length>0&&M!==i?(U.value=M,p.value.commandType=i,T.value=!0):M!==i&&(I.value=M))}),de(()=>r.editData,async M=>{var i,P,G;if(M&&r.editMode){console.log("ğŸ”§ Edit mode activated, loading profile data:",M),s.value=!0,f.value.length===0&&(console.log("ğŸ“¡ Loading Broadlink devices..."),await ee(),console.log("ğŸ“¡ Devices loaded:",f.value.length));const ie=M.profile,ue=ie.controller_data;console.log("ğŸ® Controller data from profile:",ue),console.log("ğŸ® Available devices:",f.value.map(_=>_.entity_id));const se=ie.commands||{},te=ie.commandType||oe(se);console.log("ğŸ” Command type (stored):",ie.commandType),console.log("ğŸ” Command type (final):",te);let ge={};if(M.platform==="climate"){const _=ie.operationModes||ae(se),k=ie.fanModes||A(se),j=ie.swingModes||N(se);console.log("ğŸ” Inferred modes:",_),console.log("ğŸ” Inferred fan modes:",k),console.log("ğŸ” Inferred swing modes:",j),ge={minTemp:ie.minTemperature,maxTemp:ie.maxTemperature,precision:ie.precision,modes:_,fanModes:k,swingModes:j}}else if(M.platform==="media_player"){const _=[];(se.on||se.off)&&_.push("turn_on"),(se.volumeUp||se.volumeDown)&&_.push("volume"),se.mute&&_.push("mute"),se.sources&&_.push("source"),(se.channelUp||se.channelDown)&&_.push("channel"),ge={features:_},L.value=_,console.log("ğŸ” Inferred media player features:",_)}else if(M.platform==="fan"){const _=((i=ie.speed)==null?void 0:i.length)||Object.keys(se.default||{}).length||3,k=[];(se.oscillate_on||se.oscillate_off)&&k.push("oscillate"),(se.direction_forward||se.direction_reverse)&&k.push("direction"),ge={speedLevels:_,features:k},J.value=_,Z.value=k,console.log("ğŸ” Inferred fan config:",ge)}else if(M.platform==="light"){const _=[];ge={features:_},B.value=_,console.log("ğŸ” Inferred light features:",_)}const Re=await v(ie.manufacturer,(P=ie.supportedModels)==null?void 0:P[0],se);p.value={platform:M.platform,manufacturer:ie.manufacturer||"",model:((G=ie.supportedModels)==null?void 0:G[0])||"",broadlinkDevice:ue||"",commandType:te,config:ge,commands:Re},console.log("âœ… Profile populated:",p.value),console.log("âœ… Selected device:",p.value.broadlinkDevice),console.log("âœ… Command type:",p.value.commandType),console.log("âœ… Commands (with learned codes):",Re),I.value=te,setTimeout(()=>{s.value=!1},100)}},{immediate:!0});const ce=K(()=>{var M;switch(a.value){case 0:return p.value.platform&&p.value.manufacturer&&p.value.model;case 1:return p.value.platform==="climate"?p.value.config.minTemp&&p.value.config.maxTemp&&((M=p.value.config.modes)==null?void 0:M.length)>0:!0;case 2:return p.value.broadlinkDevice&&p.value.commandType&&Object.keys(p.value.commands).length>0;case 3:return!0;default:return!1}}),we=g(null);async function Se(){if(a.value!==3){we.value=null;return}if(console.log("ğŸ” Generating JSON with commands:",p.value.commands),Object.values(p.value.commands).some(i=>typeof i=="string"?i==="pending":typeof i=="object"?Object.values(i).some(P=>typeof P=="string"?P==="pending":typeof P=="object"?Object.values(P).some(G=>G==="pending"):!1):!1)){console.warn('âš ï¸ Commands still contain "pending" placeholders!'),console.log("ğŸ“¦ Attempting to fetch from Broadlink storage...");const i=await v(p.value.manufacturer,p.value.model,p.value.commands);p.value.commands=i,console.log("âœ… Updated commands:",i)}we.value=y(p.value),console.log("ğŸ“„ Generated JSON:",we.value)}const Me=K(()=>a.value!==3?null:F(p.value));function xe(){p.value.config={},p.value.commands={}}function D(){T.value=!1,p.value.commandType=U.value,I.value=U.value,p.value.commands={},U.value=""}function d(){T.value=!1,U.value=""}async function V(){a.value<b.length-1&&(a.value++,a.value===3&&await Se())}function ve(){a.value>0&&a.value--}function Oe(){T.value||(q.value=!0)}function be(){q.value=!1,W()}function W(){w("close"),setTimeout(()=>{a.value=0,p.value={platform:"",manufacturer:"",model:"",broadlinkDevice:"",commandType:"ir",config:{},commands:{}},I.value="ir"},300)}async function E(){var M,i,P,G,ie,ue;u.value=!0;try{if(!$.value){const k=(await ne.get("/api/smartir/config/check")).data;if(k&&!((M=k.platforms[p.value.platform])==null?void 0:M.file_exists)){C.value=k.configuration_warnings||[],O.value=k.config_path||"/config",o.value={platform:p.value.platform,json:we.value},S.value=!0,u.value=!1;return}}let se;r.editMode&&((i=r.editData)!=null&&i.code)?(se=parseInt(r.editData.code),console.log("ğŸ“ Edit mode: Using existing code",se)):(se=(await ne.get(`/api/smartir/platforms/${p.value.platform}/next-code`)).data.next_code,console.log("âœ¨ New profile: Using next code",se));const ge=(await ne.post("/api/smartir/profiles",{platform:p.value.platform,json:we.value,code_number:se})).data,Re={platform:"smartir",name:`${p.value.manufacturer} ${p.value.model}`,unique_id:`${p.value.manufacturer.toLowerCase().replace(/[^a-z0-9]+/g,"_")}_${p.value.model.toLowerCase().replace(/[^a-z0-9]+/g,"_")}`,device_code:se,controller_data:p.value.broadlinkDevice};try{await ne.post("/api/smartir/config/add-device",{platform:p.value.platform,device_config:{platform:"smartir",name:Re.name,unique_id:Re.unique_id,device_code:Re.device_code,controller_data:Re.controller_data}})}catch(_){console.error("Failed to add device to config:",_);const k=((P=_.response)==null?void 0:P.data)||{};let j=k.error||"Unknown error";k.validation_errors&&k.validation_errors.length>0&&(j=`Device configuration validation failed:
`+k.validation_errors.map(z=>`  â€¢ ${z}`).join(`
`)),(G=h.value)==null||G.warning(`Profile saved but failed to add to config file:
${j}`,"âš ï¸ Partial Success")}w("save",{json:we.value,yaml:Me.value,profile:p.value,saved_to:ge.path}),(ie=h.value)==null||ie.success(`File: ${ge.filename}
Device Code: ${se}
Added to: smartir/${p.value.platform}.yaml

âš ï¸ Restart Home Assistant to activate`,"âœ… Profile Saved Successfully!"),W()}catch(se){console.error("Error saving profile:",se),(ue=h.value)==null||ue.error(se.message,"âŒ Error Saving Profile")}finally{u.value=!1}}async function Q(){$.value=!0,S.value=!1,o.value&&(await E(),o.value=null)}function H(){var M,i;try{const P=JSON.stringify(we.value,null,2),G=new Blob([P],{type:"application/json"}),ie=URL.createObjectURL(G),ue=document.createElement("a");ue.href=ie;const se=p.value.manufacturer.toLowerCase().replace(/\s+/g,"_"),te=p.value.model.toLowerCase().replace(/\s+/g,"_");ue.download=`smartir_${p.value.platform}_${se}_${te}.json`,document.body.appendChild(ue),ue.click(),document.body.removeChild(ue),URL.revokeObjectURL(ie),(M=h.value)==null||M.success("You can manually upload this file to your SmartIR codes directory.","âœ… Profile Downloaded")}catch(P){console.error("Error downloading profile:",P),(i=h.value)==null||i.error(P.message,"âŒ Error Downloading Profile")}}async function v(M,i,P){const G=M.toLowerCase().replace(/[^a-z0-9]+/g,"_"),ie=i.toLowerCase().replace(/[^a-z0-9]+/g,"_"),ue=`${G}_${ie}`;try{const ge=(await ne.get("/api/commands/all")).data[ue]||{};console.log(`ğŸ” Fetching learned commands for device: ${ue}`),console.log("ğŸ“¦ Device commands from storage:",ge);const Re={...P};for(const[_,k]of Object.entries(Re))if(k==="pending"&&ge[_])Re[_]=ge[_];else if(typeof k=="object"){for(const[j,z]of Object.entries(k))if(typeof z=="object")for(const[le,he]of Object.entries(z)){const pe=`${_}_${j}_${le}`;he==="pending"&&ge[pe]&&(Re[_][j][le]=ge[pe])}else if(z==="pending"){const le=`${_}_${j}`;ge[le]&&(Re[_][j]=ge[le])}}return console.log("âœ… Merged commands:",Re),Re}catch(se){return console.error("Error fetching learned commands:",se),P}}function y(M){const i={manufacturer:M.manufacturer,supportedModels:[M.model],supportedController:"Broadlink",commandsEncoding:"Base64",commandType:M.commandType||"ir",commands:{}};return M.platform==="climate"&&(i.minTemperature=M.config.minTemp,i.maxTemperature=M.config.maxTemp,i.precision=M.config.precision||1,i.operationModes=M.config.modes||[],i.fanModes=M.config.fanModes&&M.config.fanModes.length>0?M.config.fanModes:["auto"],M.config.swingModes&&M.config.swingModes.length>0&&(i.swingModes=M.config.swingModes),i.commands=M.commands),i}function F(M){let i=`# SmartIR ${M.platform} configuration
`;return i+=`# Generated by Broadlink Manager v2

`,M.platform==="climate"&&(i+=`climate:
`,i+=`  - platform: smartir
`,i+=`    name: ${M.manufacturer} ${M.model}
`,i+=`    unique_id: ${M.manufacturer.toLowerCase()}_${M.model.toLowerCase().replace(/\s+/g,"_")}
`,i+=`    device_code: 10000  # Change this to your custom code number
`,i+=`    controller_data: ${M.broadlinkDevice}
`,M.config.tempSensor&&(i+=`    temperature_sensor: ${M.config.tempSensor}
`),M.config.humiditySensor&&(i+=`    humidity_sensor: ${M.config.humiditySensor}
`),M.config.powerSensor&&(i+=`    power_sensor: ${M.config.powerSensor}
`)),i}async function ee(){try{console.log("Fetching remote devices from /api/remote/devices...");const M=await ne.get("/api/remote/devices");console.log("Loaded remote devices response:",M.data);const i=M.data.devices||[];console.log("Extracted devices array:",i),console.log("Device count:",i.length),f.value=i,console.log("broadlinkDevices.value set to:",f.value),console.log("Final device count:",f.value.length)}catch(M){console.error("Error loading remote devices:",M),f.value=[]}}return de(()=>r.show,M=>{if(M){const i=Number.isInteger(r.startStep)?r.startStep:0;a.value=Math.min(Math.max(i,0),b.length-1)}}),de(()=>r.startStep,M=>{if(r.show){const i=Number.isInteger(M)?M:0;a.value=Math.min(Math.max(i,0),b.length-1)}}),Ae(()=>{r.show&&ee()}),(M,i)=>t.show?(l(),n("div",{key:0,class:"modal-overlay",onClick:Oe},[e("div",{class:"modal-container",onClick:i[19]||(i[19]=me(()=>{},["stop"]))},[e("div",vu,[e("h2",null,[i[22]||(i[22]=e("i",{class:"mdi mdi-file-document-edit"},null,-1)),x(" "+c(t.editMode?"Edit SmartIR Profile":"Create SmartIR Profile"),1)]),e("button",{onClick:W,class:"close-button"},[...i[23]||(i[23]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",pu,[(l(),n(fe,null,$e(b,(P,G)=>e("div",{key:G,class:Y(["step",{active:a.value===G,completed:a.value>G}])},[e("div",fu,[a.value>G?(l(),n("i",gu)):(l(),n("span",yu,c(G+1),1))]),e("span",bu,c(P.label),1)],2)),64))]),e("div",hu,[a.value===0?(l(),n("div",ku,[i[29]||(i[29]=e("h3",null,"Device Information",-1)),e("div",wu,[i[25]||(i[25]=e("label",null,"Platform Type *",-1)),X(e("select",{"onUpdate:modelValue":i[0]||(i[0]=P=>p.value.platform=P),onChange:xe},[...i[24]||(i[24]=[Ue('<option value="" data-v-2e218e9d>Select platform...</option><option value="climate" data-v-2e218e9d>ğŸŒ¡ï¸ Climate (AC, Heater, Heat Pump)</option><option value="media_player" data-v-2e218e9d>ğŸ“º Media Player (TV, Receiver)</option><option value="fan" data-v-2e218e9d>ğŸŒ€ Fan</option><option value="light" data-v-2e218e9d>ğŸ’¡ Light (LED Strip, IR Light)</option>',5)])],544),[[De,p.value.platform]])]),e("div",$u,[i[26]||(i[26]=e("label",null,"Manufacturer *",-1)),X(e("input",{"onUpdate:modelValue":i[1]||(i[1]=P=>p.value.manufacturer=P),type:"text",placeholder:"e.g., Daikin, LG, Samsung"},null,512),[[Le,p.value.manufacturer]])]),e("div",Cu,[i[27]||(i[27]=e("label",null,"Model(s) *",-1)),X(e("input",{"onUpdate:modelValue":i[2]||(i[2]=P=>p.value.model=P),type:"text",placeholder:"e.g., FTXS35K, Multiple models"},null,512),[[Le,p.value.model]]),i[28]||(i[28]=e("small",null,'Enter model number or "Multiple" if it works with many models',-1))])])):R("",!0),a.value===1?(l(),n("div",_u,[p.value.platform==="climate"?(l(),Ee(Br,{key:0,modelValue:p.value.config,"onUpdate:modelValue":i[3]||(i[3]=P=>p.value.config=P)},null,8,["modelValue"])):p.value.platform==="media_player"?(l(),n("div",Su,[i[36]||(i[36]=e("h3",null,"Media Player Configuration",-1)),i[37]||(i[37]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),x(" Configure the features your media player supports. You'll learn the IR commands in the next step. ")],-1)),e("div",Iu,[i[35]||(i[35]=e("h4",null,"Supported Features",-1)),e("div",Du,[e("label",xu,[X(e("input",{type:"checkbox",value:"turn_on","onUpdate:modelValue":i[4]||(i[4]=P=>L.value=P)},null,512),[[ye,L.value]]),i[30]||(i[30]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),x(" Power On/Off ")],-1))]),e("label",Tu,[X(e("input",{type:"checkbox",value:"volume","onUpdate:modelValue":i[5]||(i[5]=P=>L.value=P)},null,512),[[ye,L.value]]),i[31]||(i[31]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-volume-high"}),x(" Volume Control ")],-1))]),e("label",Mu,[X(e("input",{type:"checkbox",value:"mute","onUpdate:modelValue":i[6]||(i[6]=P=>L.value=P)},null,512),[[ye,L.value]]),i[32]||(i[32]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-volume-mute"}),x(" Mute ")],-1))]),e("label",Ru,[X(e("input",{type:"checkbox",value:"source","onUpdate:modelValue":i[7]||(i[7]=P=>L.value=P)},null,512),[[ye,L.value]]),i[33]||(i[33]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-import"}),x(" Source Selection ")],-1))]),e("label",Lu,[X(e("input",{type:"checkbox",value:"channel","onUpdate:modelValue":i[8]||(i[8]=P=>L.value=P)},null,512),[[ye,L.value]]),i[34]||(i[34]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-numeric"}),x(" Channel Control ")],-1))])])])])):p.value.platform==="fan"?(l(),n("div",Au,[i[44]||(i[44]=e("h3",null,"Fan Configuration",-1)),i[45]||(i[45]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),x(" Configure the features your fan supports. You'll learn the IR commands in the next step. ")],-1)),e("div",Ou,[i[40]||(i[40]=e("h4",null,"Fan Speed Levels",-1)),e("div",Eu,[i[39]||(i[39]=e("label",null,"Number of Speed Levels *",-1)),X(e("select",{"onUpdate:modelValue":i[9]||(i[9]=P=>J.value=P)},[...i[38]||(i[38]=[e("option",{value:1},"1 Speed",-1),e("option",{value:2},"2 Speeds",-1),e("option",{value:3},"3 Speeds (Low/Med/High)",-1),e("option",{value:4},"4 Speeds",-1),e("option",{value:5},"5 Speeds",-1),e("option",{value:6},"6 Speeds",-1)])],512),[[De,J.value,void 0,{number:!0}]])])]),e("div",Vu,[i[43]||(i[43]=e("h4",null,"Additional Features",-1)),e("div",Pu,[e("label",Uu,[X(e("input",{type:"checkbox",value:"oscillate","onUpdate:modelValue":i[10]||(i[10]=P=>Z.value=P)},null,512),[[ye,Z.value]]),i[41]||(i[41]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-sync"}),x(" Oscillation ")],-1))]),e("label",ju,[X(e("input",{type:"checkbox",value:"direction","onUpdate:modelValue":i[11]||(i[11]=P=>Z.value=P)},null,512),[[ye,Z.value]]),i[42]||(i[42]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-rotate-3d-variant"}),x(" Direction (Forward/Reverse) ")],-1))])])])])):p.value.platform==="light"?(l(),n("div",Fu,[i[51]||(i[51]=e("h3",null,"Light Configuration",-1)),i[52]||(i[52]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),x(" Configure the features your light supports. You'll learn the IR commands in the next step. ")],-1)),e("div",Nu,[i[50]||(i[50]=e("h4",null,"Supported Features",-1)),e("div",Bu,[e("label",Hu,[X(e("input",{type:"checkbox",value:"turn_on","onUpdate:modelValue":i[12]||(i[12]=P=>B.value=P)},null,512),[[ye,B.value]]),i[46]||(i[46]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),x(" Power On/Off ")],-1))]),e("label",qu,[X(e("input",{type:"checkbox",value:"brightness","onUpdate:modelValue":i[13]||(i[13]=P=>B.value=P)},null,512),[[ye,B.value]]),i[47]||(i[47]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-brightness-6"}),x(" Brightness Control ")],-1))]),e("label",zu,[X(e("input",{type:"checkbox",value:"color_temp","onUpdate:modelValue":i[14]||(i[14]=P=>B.value=P)},null,512),[[ye,B.value]]),i[48]||(i[48]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-thermometer"}),x(" Color Temperature ")],-1))]),e("label",Ju,[X(e("input",{type:"checkbox",value:"rgb","onUpdate:modelValue":i[15]||(i[15]=P=>B.value=P)},null,512),[[ye,B.value]]),i[49]||(i[49]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-palette"}),x(" RGB Color ")],-1))])])])])):R("",!0)])):R("",!0),a.value===2?(l(),n("div",Wu,[ke(wd,{modelValue:p.value.commands,"onUpdate:modelValue":i[16]||(i[16]=P=>p.value.commands=P),platform:p.value.platform,config:p.value.config,broadlinkDevice:p.value.broadlinkDevice,"onUpdate:broadlinkDevice":i[17]||(i[17]=P=>p.value.broadlinkDevice=P),manufacturer:p.value.manufacturer,model:p.value.model,commandType:p.value.commandType,"onUpdate:commandType":i[18]||(i[18]=P=>p.value.commandType=P)},null,8,["modelValue","platform","config","broadlinkDevice","manufacturer","model","commandType"])])):R("",!0),a.value===3?(l(),n("div",Ku,[ke(Jd,{profile:p.value,"json-data":we.value,"yaml-config":Me.value},null,8,["profile","json-data","yaml-config"])])):R("",!0)]),e("div",Xu,[a.value>0?(l(),n("button",{key:0,onClick:ve,class:"btn-secondary"},[...i[53]||(i[53]=[e("i",{class:"mdi mdi-arrow-left"},null,-1),x(" Back ",-1)])])):R("",!0),i[57]||(i[57]=e("div",{class:"spacer"},null,-1)),e("button",{onClick:W,class:"btn-text"}," Cancel "),a.value<b.length-1?(l(),n("button",{key:1,onClick:V,class:"btn-primary",disabled:!ce.value},[...i[54]||(i[54]=[x(" Next ",-1),e("i",{class:"mdi mdi-arrow-right"},null,-1)])],8,Gu)):(l(),n("div",Yu,[e("button",{onClick:E,class:"btn-primary",disabled:u.value},[i[55]||(i[55]=e("i",{class:"mdi mdi-cloud-upload"},null,-1)),x(" "+c(u.value?"Saving...":"Save to SmartIR"),1)],8,Zu),e("button",{onClick:H,class:"btn-secondary",disabled:u.value},[...i[56]||(i[56]=[e("i",{class:"mdi mdi-download"},null,-1),x(" Download JSON ",-1)])],8,Qu)]))])]),ke(mu,{show:S.value,platform:p.value.platform,warnings:C.value,"config-path":O.value,onClose:i[20]||(i[20]=P=>S.value=!1),onComplete:Q},null,8,["show","platform","warnings","config-path"]),ke(Pe,{isOpen:T.value,title:"Change Command Type?",message:"Changing the command type will clear all learned commands. Continue?",confirmText:"Continue",cancelText:"Cancel",dangerMode:!0,onConfirm:D,onCancel:d},null,8,["isOpen"]),ke(Pe,{isOpen:q.value,title:"Close Profile Builder?",message:"Are you sure you want to close? Your progress will be lost.",confirmText:"Close",cancelText:"Keep Editing",dangerMode:!0,onConfirm:be,onCancel:i[21]||(i[21]=P=>q.value=!1)},null,8,["isOpen"])])):R("",!0)}},tc=Ce(ec,[["__scopeId","data-v-2e218e9d"]]),oc={class:"dashboard"},lc={key:1,class:"welcome-banner"},nc={__name:"Dashboard",setup(t){const m=Fe(),r=Te("smartirEnabled"),{isMobile:w}=Ge(),h=g(!1),a=g(!1),u=g(null),f=g(0),S=g(null),C=g(localStorage.getItem("welcome_banner_dismissed")==="true");function O(){C.value=!0,localStorage.setItem("welcome_banner_dismissed","true")}function $(){a.value=!1,u.value=null,f.value=0,h.value=!0}async function o({platform:U,profile:I,startStep:s}){f.value=Number.isInteger(s)?s:0;try{const b=await fetch(`api/smartir/platforms/${U}/profiles/${I.code}`);if(!b.ok)throw new Error("Failed to load profile");const p=await b.json();let L="";try{const J=await fetch(`api/smartir/config/get-device?platform=${U}&code=${I.code}`);J.ok?(L=(await J.json()).controller_data||"",console.log("âœ… Found controller_data from YAML:",L)):console.warn("âš ï¸ No YAML entry found for this profile (this is OK for profiles not yet added to config)")}catch(J){console.warn("âš ï¸ Could not fetch controller_data from config:",J)}a.value=!0,u.value={platform:U,code:I.code,profile:{...p.profile,controller_data:L}},h.value=!0}catch(b){console.error("Error loading profile for edit:",b),m.error("Failed to load profile for editing")}}function T(){h.value=!1,a.value=!1,u.value=null}async function q(U){console.log("Profile saved:",U),T(),S.value&&S.value.loadAllProfiles&&(await S.value.loadAllProfiles(),console.log("âœ… Profiles list refreshed"))}return(U,I)=>(l(),n("div",oc,[_e(r)?(l(),Ee(Ks,{key:0})):R("",!0),!_e(w)&&!C.value?(l(),n("div",lc,[e("button",{class:"dismiss-button",onClick:O,title:"Dismiss"},[...I[0]||(I[0]=[e("i",{class:"mdi mdi-close"},null,-1)])]),I[1]||(I[1]=Ue('<div class="banner-content" data-v-12185d74><div class="banner-icon" data-v-12185d74><i class="mdi mdi-rocket-launch" data-v-12185d74></i></div><div class="banner-text" data-v-12185d74><h2 data-v-12185d74>Welcome to Broadlink Manager v2!</h2><p data-v-12185d74>Manage your IR/RF devices with a modern Vue 3 interface</p></div></div><div class="status-badges" data-v-12185d74><span class="badge success" data-v-12185d74><i class="mdi mdi-check-circle" data-v-12185d74></i> Vue 3 Ready </span><span class="badge warning" data-v-12185d74><i class="mdi mdi-beta" data-v-12185d74></i> Beta </span></div>',2))])):R("",!0),ke(Bs),_e(r)?(l(),Ee(Ji,{key:2,ref_key:"smartirStatusCard",ref:S,onCreateProfile:$,onEditProfile:o},null,512)):R("",!0),ke(tc,{show:h.value,editMode:a.value,editData:u.value,startStep:f.value,onClose:T,onSave:q},null,8,["show","editMode","editData","startStep"])]))}},sc=Ce(nc,[["__scopeId","data-v-12185d74"]]),ac={class:"toast-container"},ic={class:"toast-content"},rc={key:0,class:"toast-title"},dc={class:"toast-message"},uc={key:1,class:"toast-description"},cc=["onClick","title"],mc={__name:"Toast",setup(t,{expose:m}){const r=g([]);let w=0;function h(f){const S={success:"mdi-check-circle",error:"mdi-alert-circle",warning:"mdi-alert",info:"mdi-information"};return S[f]||S.info}function a({message:f,title:S,description:C,type:O="info",duration:$=5e3}){const o=w++,T={id:o,message:f,title:S,description:C,type:O};return r.value.push(T),$>0&&setTimeout(()=>{u(o)},$),o}function u(f){const S=r.value.findIndex(C=>C.id===f);S>-1&&r.value.splice(S,1)}return m({addToast:a,removeToast:u,show:a,success:(f,S)=>a({message:f,title:S,type:"success"}),error:(f,S)=>a({message:f,title:S,type:"error",duration:0}),warning:(f,S)=>a({message:f,title:S,type:"warning",duration:0}),info:(f,S)=>a({message:f,title:S,type:"info"})}),(f,S)=>(l(),Ee(ot,{to:"body"},[e("div",ac,[ke(dt,{name:"toast"},{default:Xe(()=>[(l(!0),n(fe,null,$e(r.value,C=>(l(),n("div",{key:C.id,class:Y(["toast",[`toast-${C.type}`,{"toast-persistent":C.type==="error"||C.type==="warning"}]])},[e("i",{class:Y(["mdi",h(C.type)])},null,2),e("div",ic,[C.title?(l(),n("div",rc,c(C.title),1)):R("",!0),e("div",dc,c(C.message),1),C.description?(l(),n("div",uc,c(C.description),1)):R("",!0)]),e("button",{onClick:O=>u(C.id),class:Y(["toast-close",{"toast-close-prominent":C.type==="error"||C.type==="warning"}]),title:C.type==="error"||C.type==="warning"?"Click to dismiss":"Close"},[...S[0]||(S[0]=[e("i",{class:"mdi mdi-close"},null,-1)])],10,cc)],2))),128))]),_:1})])]))}},vc=Ce(mc,[["__scopeId","data-v-3948c088"]]),pc="0.3.0-alpha.2",fc={version:pc},gc={id:"app",class:"app-container"},yc={class:"app-header"},bc={class:"header-content"},hc={class:"header-right"},kc=["title"],wc={class:"settings-menu-container"},$c={key:0,class:"settings-menu"},Cc=["title"],_c={class:"toggle-content"},Sc={key:0,class:"not-installed-label"},Ic={key:0,href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"menu-item menu-link menu-subitem"},Dc=["disabled"],xc=["disabled"],Tc=["disabled"],Mc={class:"app-main"},Rc={class:"app-footer"},Lc={__name:"App",setup(t){const m=g(null),r=fc.version,w=g("light"),h=g(null),a=g(!1),u=g(!1),f=g(!1),S=g(localStorage.getItem("smartir_enabled")!=="false"),C=K(()=>{var p;return((p=h.value)==null?void 0:p.installed)||!1}),O=K(()=>({light:"mdi mdi-weather-sunny",medium:"mdi mdi-weather-partly-cloudy",dark:"mdi mdi-weather-night"})[w.value]),$=K(()=>({light:"Switch to Medium Theme",medium:"Switch to Dark Theme",dark:"Switch to Light Theme"})[w.value]),o=()=>{const p=["light","medium","dark"],J=(p.indexOf(w.value)+1)%p.length;w.value=p[J],document.body.classList.remove("medium-mode","dark-mode"),w.value==="medium"?document.body.classList.add("medium-mode"):w.value==="dark"&&document.body.classList.add("dark-mode"),localStorage.setItem("theme",w.value)},T=async()=>{try{const p=await nt.getStatus();h.value=p,p.installed?console.log("âœ… SmartIR detected:",p.version):console.log("â„¹ï¸ SmartIR not detected")}catch(p){console.error("Error checking SmartIR:",p),h.value={installed:!1,error:p.message}}},q=async()=>{var p,L,J;u.value=!0;try{const B=(await ne.get("/api/diagnostics/markdown")).data.markdown;if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(B),(p=m.value)==null||p.success("Diagnostic summary copied to clipboard!");else{const ae=document.createElement("textarea");ae.value=B,ae.style.position="fixed",ae.style.left="-999999px",ae.style.top="-999999px",document.body.appendChild(ae),ae.focus(),ae.select();try{if(document.execCommand("copy"))(L=m.value)==null||L.success("Diagnostic summary copied to clipboard!");else throw new Error("execCommand failed")}finally{document.body.removeChild(ae)}}a.value=!1}catch(Z){console.error("Error copying diagnostics:",Z),(J=m.value)==null||J.error("Failed to copy diagnostics: "+Z.message)}finally{u.value=!1}},U=async()=>{var p,L;u.value=!0;try{const J=await ne.get("/api/diagnostics/download",{responseType:"blob"}),Z=window.URL.createObjectURL(new Blob([J.data])),B=document.createElement("a");B.href=Z;const ae=J.headers["content-disposition"];let A="broadlink_manager_diagnostics.zip";if(ae){const N=ae.match(/filename="?(.+)"?/);N&&(A=N[1])}B.setAttribute("download",A),document.body.appendChild(B),B.click(),B.remove(),window.URL.revokeObjectURL(Z),(p=m.value)==null||p.success("Diagnostic bundle downloaded!"),a.value=!1}catch(J){console.error("Error downloading diagnostics:",J),(L=m.value)==null||L.error("Failed to download diagnostics")}finally{u.value=!1}},I=()=>{C.value&&(S.value=!S.value,localStorage.setItem("smartir_enabled",S.value.toString()),window.location.reload())},s=async()=>{var p,L,J;f.value=!0;try{const Z=await ne.post("/api/smartir/refresh-index");Z.data.success?(p=m.value)==null||p.success(`Updated to v${Z.data.version} (${Z.data.total_devices} devices)`,"âœ… Index Updated"):(L=m.value)==null||L.error(Z.data.error||"Unknown error","âŒ Update Failed")}catch(Z){console.error("Error updating SmartIR index:",Z),(J=m.value)==null||J.error("Failed to update device index","âŒ Update Error")}finally{f.value=!1,a.value=!1}},b=p=>{p.target.closest(".settings-menu-container")||(a.value=!1)};return Ae(async()=>{const p=localStorage.getItem("theme");p&&["light","medium","dark"].includes(p)?(w.value=p,p==="medium"?document.body.classList.add("medium-mode"):p==="dark"&&document.body.classList.add("dark-mode")):localStorage.getItem("darkMode")==="true"&&(w.value="dark",document.body.classList.add("dark-mode"),localStorage.setItem("theme","dark")),await T();const L=Qe();L&&m.value&&(L.appContext.config.globalProperties.$toast=m.value),document.addEventListener("click",b)}),Ke(()=>{document.removeEventListener("click",b)}),He("smartirStatus",h),He("smartirEnabled",S),He("refreshSmartIR",T),He("toast",m),(p,L)=>(l(),n("div",gc,[e("header",yc,[e("div",bc,[L[13]||(L[13]=e("div",{class:"header-left"},[e("i",{class:"mdi mdi-remote"}),e("h1",null,"Broadlink Manager v2"),e("span",{class:"beta-badge"},"BETA")],-1)),e("div",hc,[e("button",{onClick:o,class:"icon-button",title:$.value},[e("i",{class:Y(O.value)},null,2)],8,kc),e("div",wc,[e("button",{onClick:L[0]||(L[0]=J=>a.value=!a.value),class:"icon-button",title:"Settings"},[...L[2]||(L[2]=[e("i",{class:"mdi mdi-cog"},null,-1)])]),a.value?(l(),n("div",$c,[L[9]||(L[9]=e("div",{class:"menu-section-title"},"Integration Settings",-1)),e("div",{class:Y(["menu-item toggle-item",{disabled:!C.value}]),onClick:L[1]||(L[1]=J=>C.value?I():null),title:C.value?"":"SmartIR is not installed"},[e("div",_c,[L[3]||(L[3]=e("i",{class:"mdi mdi-air-conditioner"},null,-1)),L[4]||(L[4]=e("span",null,"SmartIR Integration",-1)),C.value?R("",!0):(l(),n("span",Sc,"(Not Installed)"))]),e("div",{class:Y(["toggle-switch",{active:S.value&&C.value,disabled:!C.value}])},[...L[5]||(L[5]=[e("div",{class:"toggle-slider"},null,-1)])],2)],10,Cc),S.value?(l(),n("a",Ic,[...L[6]||(L[6]=[e("i",{class:"mdi mdi-github"},null,-1),e("span",null,"SmartIR on GitHub",-1)])])):R("",!0),S.value?(l(),n("button",{key:1,onClick:s,class:"menu-item menu-subitem",disabled:f.value},[e("i",{class:Y(["mdi",f.value?"mdi-loading mdi-spin":"mdi-refresh"])},null,2),e("span",null,c(f.value?"Updating...":"Update Device Index"),1)],8,Dc)):R("",!0),L[10]||(L[10]=e("div",{class:"menu-divider"},null,-1)),L[11]||(L[11]=e("div",{class:"menu-section-title"},"Diagnostics",-1)),e("button",{onClick:q,class:"menu-item",disabled:u.value},[...L[7]||(L[7]=[e("i",{class:"mdi mdi-content-copy"},null,-1),e("span",null,"Copy Diagnostics",-1)])],8,xc),e("button",{onClick:U,class:"menu-item",disabled:u.value},[...L[8]||(L[8]=[e("i",{class:"mdi mdi-download"},null,-1),e("span",null,"Download Diagnostics",-1)])],8,Tc),L[12]||(L[12]=Ue('<div class="menu-divider" data-v-4bc2c39f></div><div class="menu-section-title" data-v-4bc2c39f>Help &amp; Support</div><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2#readme" target="_blank" class="menu-item menu-link" data-v-4bc2c39f><i class="mdi mdi-book-open-variant" data-v-4bc2c39f></i><span data-v-4bc2c39f>Documentation</span></a><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2/issues" target="_blank" class="menu-item menu-link" data-v-4bc2c39f><i class="mdi mdi-bug" data-v-4bc2c39f></i><span data-v-4bc2c39f>Report Issue</span></a><div class="menu-divider" data-v-4bc2c39f></div><div class="menu-section-title" data-v-4bc2c39f>Community</div><a href="https://community.home-assistant.io/t/broadlink-manager-modern-web-interface-for-broadlink-devices/938473" target="_blank" class="menu-item menu-link" data-v-4bc2c39f><i class="mdi mdi-forum" data-v-4bc2c39f></i><span data-v-4bc2c39f>HA Forum Discussion</span></a><a href="https://www.reddit.com/r/homeassistant/comments/1o1q3kf/release_broadlink_manager_addon_a_modern_web_ui/" target="_blank" class="menu-item menu-link" data-v-4bc2c39f><i class="mdi mdi-reddit" data-v-4bc2c39f></i><span data-v-4bc2c39f>Reddit Discussion</span></a><div class="menu-divider" data-v-4bc2c39f></div><div class="menu-section-title" data-v-4bc2c39f>Project</div><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2" target="_blank" class="menu-item menu-link" data-v-4bc2c39f><i class="mdi mdi-github" data-v-4bc2c39f></i><span data-v-4bc2c39f>GitHub Repository</span></a><a href="https://ko-fi.com/tonyperkins" target="_blank" class="menu-item menu-link menu-item-sponsor" data-v-4bc2c39f><i class="mdi mdi-coffee" data-v-4bc2c39f></i><span data-v-4bc2c39f>Support on Ko-fi</span></a>',12))])):R("",!0)])])])]),e("main",Mc,[ke(sc)]),e("footer",Rc,[e("p",null,"Broadlink Manager v"+c(_e(r))+" | Built with Vue "+c(ut),1)]),ke(vc,{ref_key:"toastRef",ref:m},null,512)]))}},Ac=Ce(Lc,[["__scopeId","data-v-4bc2c39f"]]),st=ct(Ac),Oc=mt();st.use(Oc);st.mount("#app");
