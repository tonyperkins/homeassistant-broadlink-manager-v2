import{g as Qe,r as g,o as Ae,a as Ge,b as at,d as it,c as W,e as n,f as l,h as e,i as T,n as Y,u as $e,t as c,j as I,F as ve,k as ke,w as de,l as K,v as Le,m as he,p as be,q as Be,s as Ke,T as et,x as Se,y as Te,z as Pe,A as fe,B as tt,C as qe,D as Oe,E as ot,G as ze,H as rt,I as dt,J as ut,K as He,L as ct,M as mt}from"./vendor-DGiFqQ_g.js";(function(){const m=document.createElement("link").relList;if(m&&m.supports&&m.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))$(h);new MutationObserver(h=>{for(const s of h)if(s.type==="childList")for(const u of s.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&$(u)}).observe(document,{childList:!0,subtree:!0});function r(h){const s={};return h.integrity&&(s.integrity=h.integrity),h.referrerPolicy&&(s.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?s.credentials="include":h.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function $(h){if(h.ep)return;h.ep=!0;const s=r(h);fetch(h.href,s)}})();let Ze=!1;function je(){const o=Qe(),m=o==null?void 0:o.appContext.config.globalProperties.$toast;return m||(Ze||(console.warn("Toast notification system not yet initialized - using console fallback"),Ze=!0),{success:r=>console.log("âœ“",r),error:r=>console.error("âœ—",r),warning:r=>console.warn("âš ",r),info:r=>console.info("â„¹",r)})}function Xe(){const o=g(!1),m=g(!1),r=g(!1),$=g(0),h=767,s=768,u=1023,p=1024,_=()=>{const C=window.innerWidth;$.value=C,o.value=C<=h,m.value=C>=s&&C<=u,r.value=C>=p};return Ae(()=>{_(),window.addEventListener("resize",_)}),Ge(()=>{window.removeEventListener("resize",_)}),{isMobile:o,isTablet:m,isDesktop:r,screenWidth:$,isMobileOrTablet:()=>o.value||m.value,isTabletOrDesktop:()=>m.value||r.value}}const Ye="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAHBUlEQVR4nOxZC1BTVxo+9+aNZI2LNsgjWR4hgoIiRVDBslKnIKPbx1jqTrtYoakat1a6dNsdd7t1X8XHyAbEhdUu1u2mXdbasqJbtsaMIqBBECiPBmqEICEBEx4xJLlJ7s6lw6rJDeQ2FzLM+M1kBs7/3+/83zn/Oee/51JRFAXzGbCvA/AWjwX4GvNeANWXnXffHQ4+K6/dYbHeD+IFhjRkb1wn9WPQbEQ4IF/tQlXX2p5+/8OyczY74j/VxuMG3Sh/Oz9jaQDb4CmPT1LIbLXBfzrz0cmHg8fQpx1Yc1Ra+TsiXD4R0PqtRmAyj/LxbJeaujKIcPlEAINOM7vLXBaTZibCRWgRq3WGJZWX63aoNDpB8BJOX/bGlIqwpUv6iXBgWBHG7eUF8urUWvU6Z9sLGxI/IsLl8SJu6u4XigqPXkVspiVTbTQqU1/6Vn7ammh+G5FOMZyqludIKqUVU/9jcaSuTCo/unfHbiad4iBdwMu/P1bV1tO1xbk9NDC0/vwHB1xGcjqYLAh16zsHW3R6XXTu1mfFdAqMrIoSKNbGhLcQ4QGeppDJ7ACtPcqNEI6tT9O3Vqm+tygqNMDjrU9Sef6tIYM2JjUuuXzfC5knCEXsBI8WMZUCAxiCrfhWyMZkMNzYXNHVpwmXXqp5j0Hz0/1m57a3PQ8VHx4JoNMASIl9shLPFsB5ooO7iDXhCY/dAcCvT/79LwC1s/K2bDnAXcQeJRqwMzzeRt/bua0gLChcDsCDNQNBkEU/qot7o6j0kzETQpuJ40ZnT6xSrUoNWhyseHVz2ikv4n4QA5FSArE5IFlTZ0r3XU1MWODib6NCl3a9dkhSYxgbjo4XLq8sL9j7Ip36YEwMRjMNQazMhf7+RgYNnuyo7bY6ArFaWKuXRX495wLwoLk39sO9RaVnM5OTP8zLSjtjsljpp6ovi6pqr706eE8XBwGUSqEy9Guihf/92TMZhetjI5rJCHwKpBRzZqsNYtKp6KD+Pvv1w5ILdzR3UvD8HA4YefOl7N25JKUPIKuUwIJH7A5of/GJf7oLfrIz2EH786fSss+uKFzOk+8L0mqh6rpbmR0q5YyFGAQBSuHHlcUWxEaZyXfMhFD0Rgt9Oh/SBMiam58HAO+oc4XZMsK/1taT6M6uHjJw8w6VSNfvemM8TbzPlFlwsP5KyzfJeL6kCejXDgo894aASqOZ9O/uHwzq6B3ijhitkzOC7XS7j0g+V3S0vQTDDhYEoZSBobvJ+yXFNZ29gy4lOGmvlDBMIfQqSKV8539EWvXHhvbGHBSFrAwGW+vvxzLoR7RxzrNpsyPs0xcv7/lg1/ZfPtKvuw7MVhulUakWdvRq+XY3tWFT90Bk+52BCOzvyOBgjytSFKAgms+b9F/2o+BbKwUrvgjhhjSjKLAPG4YE7lJxfEIf5dyGOwMXrren/eF0RYXRNMrHDt4QbmjDEbHop9F8rqpddZd3sV6R/aWiabtWr41PW534V8m+PFHW+qSPL9TX7oM8WAaBi4IbE4S8yYNs/7asIgBA0ZStRqFM/MXxIzcgHBEBP+C6DJKLgJvK3uXvniitBsDmNzkSEAD9uv5k0aFjXy1gMQ0DQ5p4CAIwNuXLwyL/ExcpqMWeS42NUmxKXFf8VWPdz6cLnkqhGd/Pe+U1Cow/+ekJUYr4qJgvbik7f/Jw+0J/tjpvS3qxs7/LQZZfcrrkUmOdGI/cgUKIkB8pz0xK+CQjKf6z4MWckYftZqsderfsTInsZt0evDRgMRYMHhaLnk+NW1Y/nchxk5lZ+I/Pf/vl9RvbLYiVlSBcJv/VK9sKBCHc3hkF7D12/NzVltZn8YhzNj/3ev6LGeXTdQ6+uzLZ+C+5XNza05Nsd1gXcNgBvekJK/+du3lTUSiXMzzT80TgkkK8wJAGgCMAE5ooFFz3hHTr+lgZ9iMryOngkoi5WZuOc9hPtDu3r4198nTqygjCr3wYmrvVkSerZXljJoT0m0DcYm5g2Mg5WV39zrVWZZofkzaRnhB/bufm9FI/JpXQXj8F8bHyitqWxhzJmwUJT60SNJER+P+BCZjt34lzNbvickRoWVWNmGzuObnYWhER3oAdX41dPbj1jDeYEwGrInltKKCNtatub6hRfJOEnfJkcc+JgE9ltS/DkINuNI3xCo4fbXgm/0CnouvOcjK4Z/16/ZKia+3+kqIrEIQ+sgNx2Jzb5wsPxrD9GBZv+Gd9BqSXr4icg8cwMj4SLmv6+mlv+WddgGlilOPOZkEmFnrLP+sCVgtXyPHaHShkiw0XXPWWf9YF5Gb9uGzp4sCbj7ai4LkNTx2O5nPV3vLPyTeye6P32X+7KNujVKtSYJg+viEu/mx2etJZCgnD57OPfGRh3n8nfizA15j3Av4XAAD//5k1S2w3zfwVAAAAAElFTkSuQmCC",ne=at.create({baseURL:"./",timeout:3e4,headers:{"Content-Type":"application/json"}});ne.interceptors.request.use(o=>o,o=>Promise.reject(o));ne.interceptors.response.use(o=>o,o=>(console.error("API Error:",o),o.response?console.error("Response error:",o.response.data):o.request?console.error("No response received"):console.error("Request setup error:",o.message),Promise.reject(o)));const vt=it("devices",{state:()=>({devices:[],loading:!1,error:null,selectedDevice:null}),getters:{deviceById:o=>m=>o.devices.find(r=>r.id===m),devicesByType:o=>m=>o.devices.filter(r=>r.entity_type===m),deviceCount:o=>o.devices.length,hasDevices:o=>o.devices.length>0},actions:{async loadDevices(o=!1){this.loading=!0,this.error=null;try{const m=o?`/api/devices/managed?_t=${Date.now()}`:"/api/devices/managed",r=await ne.get(m);this.devices=r.data.devices||[],console.log("ğŸ“¥ Loaded devices:",this.devices),this.devices.forEach($=>{console.log(`ğŸ“¥ Device "${$.name}":`,{id:$.id,device:$.device,commands:$.commands,commandCount:$.commands?Object.keys($.commands).length:0})})}catch(m){this.error=m.message,console.error("Error loading devices:",m)}finally{this.loading=!1}},async createDevice(o){this.loading=!0,this.error=null;try{console.log("ğŸª Store: Creating device with data:",o),console.log("ğŸª Store: Device commands being sent:",o.commands);const m={device_name:o.name,device:o.device,area_id:o.area||"",area_name:o.area||"",entity_type:o.entity_type,icon:o.icon,broadlink_entity:o.broadlink_entity,device_type:o.device_type||"broadlink",commands:o.commands||{}};o.device_type==="smartir"&&o.smartir_config&&(m.smartir_config=o.smartir_config),console.log("ğŸª Store: Transformed data for backend:",m);const r=await ne.post("/api/devices/managed",m);return console.log("ğŸª Store: Create response:",r.data),await this.loadDevices(),r.data}catch(m){throw console.error("Error creating device:",m),m}finally{this.loading=!1}},async updateDevice(o,m){this.loading=!0,this.error=null;try{const r=await ne.put(`/api/devices/managed/${o}`,m);return await this.loadDevices(),r.data}catch(r){throw console.error("Error updating device:",r),r}finally{this.loading=!1}},async deleteDevice(o,m=!1){this.loading=!0,this.error=null;try{await ne.delete(`/api/devices/managed/${o}`,{data:{delete_commands:m}}),this.devices=this.devices.filter(r=>r.id!==o)}catch(r){throw this.error=r.message,console.error("Error deleting device:",r),r}finally{this.loading=!1}},selectDevice(o){this.selectedDevice=o},clearSelection(){this.selectedDevice=null},clearError(){this.error=null},async syncAllAreas(){if(!this.devices||this.devices.length===0){console.log("âš ï¸ No devices to sync");return}console.log(`ğŸ”„ Syncing areas from Home Assistant for ${this.devices.length} devices...`);try{const o=await Promise.all(this.devices.map($=>(console.log(`ğŸ”„ Syncing device: ${$.id} (${$.name})`),ne.post(`/api/devices/${$.id}/sync-area`).then(h=>h.data.success&&h.data.area?(console.log(`âœ… Synced area for ${$.name}: ${h.data.area}`),{status:"synced",device:$.name}):{status:"no_area"}).catch(h=>{var s;return((s=h.response)==null?void 0:s.status)===404?(console.log(`âŒ Device not found in HA: ${$.id}`),{status:"not_found"}):(console.warn(`âš ï¸ Failed to sync area for ${$.id}:`,h.message),{status:"error",error:h.message})})))),m=o.filter($=>$.status==="synced").length,r=o.filter($=>$.status==="not_found").length;await this.loadDevices(!0),m>0?console.log(`âœ… Area sync complete: ${m} synced, ${r} not found in HA`):r>0&&console.log(`â„¹ï¸ No areas synced - ${r} entities not found in HA registry (generate entities first)`)}catch(o){console.debug("Area sync error:",o)}}}});function lt(o){const m=W(()=>o.value||o),r=W(()=>{switch(m.value){case"climate":return"mdi:air-conditioner";case"fan":return"mdi:fan";case"light":return"mdi:lightbulb";case"media_player":return"mdi:television";case"switch":return"mdi:light-switch";default:return"mdi:devices"}}),$=W(()=>`device-type-${m.value}-color`),h=W(()=>`tag-${m.value}-bg`);return{icon:r,colorClass:$,tagBgClass:h}}const pt=""+new URL("broadlink-logo-BDjImjRY.png",import.meta.url).href,we=(o,m)=>{const r=o.__vccOpts||o;for(const[$,h]of m)r[$]=h;return r},ft={class:"device-header"},gt={class:"device-info"},yt=["title"],bt={class:"device-labels"},ht={class:"device-type"},kt=["src","alt","title"],wt={class:"device-body"},$t={class:"device-stats"},Ct={class:"stat",title:"Learned command count"},_t={class:"stat",title:"HA Assigned Area"},St={class:"device-meta"},It={class:"device-id",title:"Device ID"},Dt={key:0,class:"storage-name"},xt={key:1,class:"broadlink-entity",title:"Controller Device"},Tt={key:2,class:"controller-device"},Mt={class:"device-actions"},Rt=["disabled"],Lt=["disabled"],At=["disabled"],Et={key:0,class:"disabled-overlay"},Ot={__name:"DeviceCard",props:{device:{type:Object,required:!0},broadlinkDevices:{type:Array,default:()=>[]}},emits:["edit","delete","learn"],setup(o){const m=o,r=W(()=>localStorage.getItem("smartir_simulate_not_installed")==="true"),$=W(()=>m.device.device_type==="smartir"&&r.value),h=g(null),s=lt(W(()=>m.device.entity_type)),u=W(()=>m.device.icon?m.device.icon:s.icon.value),p=a=>a&&a.startsWith("mdi:")?`mdi ${a.replace(":"," mdi-")}`:`mdi mdi-${a}`,_=W(()=>({light:"Light",fan:"Fan",switch:"Switch",media_player:"Media Player",cover:"Cover"})[m.device.entity_type]||m.device.entity_type),C=W(()=>(m.device.device_type||"broadlink")==="smartir"?"SmartIR":"Broadlink"),M=W(()=>(m.device.device_type||"broadlink")==="smartir"?Ye:pt),w=W(()=>(m.device.device_type||"broadlink")==="smartir"?h.value!==null?h.value:0:Object.keys(m.device.commands||{}).length),t=a=>{if(!a)return"";const b=m.broadlinkDevices.find(v=>v.entity_id===a);return b&&b.name||a},R=W(()=>{if(!m.device.device)return!1;const a=m.device.id.includes(".")?m.device.id.split(".")[1]:m.device.id;return m.device.device!==a}),X=W(()=>{if(!m.device.broadlink_entity)return"";const a=m.broadlinkDevices.find(b=>b.entity_id===m.device.broadlink_entity);return a&&a.name||m.device.broadlink_entity}),U=a=>{if(!a||typeof a!="object")return 0;let b=0;for(const v of Object.values(a))typeof v=="string"?b++:typeof v=="object"&&(b+=U(v));return b},x=async()=>{if(!(!m.device.device_code||!m.device.entity_type))try{const a=await ne.get("/api/smartir/codes/code",{params:{entity_type:m.device.entity_type,code_id:m.device.device_code}});if(a.data.success&&a.data.code){const b=a.data.code;b.commands&&(h.value=U(b.commands))}}catch(a){console.error("Error fetching SmartIR command count:",a)}};return Ae(async()=>{(m.device.device_type||"broadlink")==="smartir"&&await x()}),(a,b)=>(l(),n("div",{class:Y(["device-card",{disabled:$.value}])},[e("div",ft,[e("div",{class:Y(["device-icon",$e(s).colorClass.value])},[e("i",{class:Y(p(u.value))},null,2)],2),e("div",gt,[e("h3",{title:o.device.name},c(o.device.name),9,yt),e("div",bt,[e("span",ht,c(_.value),1)])]),e("img",{src:M.value,alt:C.value,title:C.value,class:"device-source-logo"},null,8,kt)]),e("div",wt,[e("div",$t,[e("div",Ct,[b[3]||(b[3]=e("i",{class:"mdi mdi-remote"},null,-1)),e("span",null,c(w.value)+" command"+c(w.value!==1?"s":""),1)]),e("div",_t,[b[4]||(b[4]=e("i",{class:"mdi mdi-map-marker"},null,-1)),e("span",null,c(o.device.area||"No area"),1)])]),e("div",St,[e("span",It,[b[5]||(b[5]=e("i",{class:"mdi mdi-identifier"},null,-1)),I(" "+c(o.device.id),1)]),R.value?(l(),n("span",Dt,[b[6]||(b[6]=e("i",{class:"mdi mdi-code-tags"},null,-1)),I(" "+c(o.device.device),1)])):T("",!0),o.device.broadlink_entity?(l(),n("span",xt,[b[7]||(b[7]=e("i",{class:"mdi mdi-access-point"},null,-1)),I(" "+c(X.value),1)])):T("",!0),o.device.controller_device?(l(),n("span",Tt,[b[8]||(b[8]=e("i",{class:"mdi mdi-access-point"},null,-1)),I(" "+c(t(o.device.controller_device)),1)])):T("",!0)])]),e("div",Mt,[e("button",{onClick:b[0]||(b[0]=v=>!$.value&&a.$emit("learn",o.device)),class:"icon-btn",title:"Manage Commands",disabled:$.value},[...b[9]||(b[9]=[e("i",{class:"mdi mdi-remote-tv"},null,-1)])],8,Rt),e("button",{onClick:b[1]||(b[1]=v=>!$.value&&a.$emit("edit",o.device)),class:"icon-btn",title:"Edit",disabled:$.value},[...b[10]||(b[10]=[e("i",{class:"mdi mdi-pencil"},null,-1)])],8,Lt),e("button",{onClick:b[2]||(b[2]=v=>!$.value&&a.$emit("delete",o.device)),class:"icon-btn danger",title:"Delete",disabled:$.value},[...b[11]||(b[11]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,At)]),$.value?(l(),n("div",Et,[...b[12]||(b[12]=[e("div",{class:"disabled-message"},[e("i",{class:"mdi mdi-eye-off"}),e("span",null,"SmartIR Not Installed")],-1)])])):T("",!0)],2))}},Vt=we(Ot,[["__scopeId","data-v-7a7f5c18"]]),Ut={name:"DeviceListView",props:{devices:{type:Array,required:!0}},methods:{getDeviceCommands(o){return o.commands&&typeof o.commands=="object"?Object.keys(o.commands):[]},sendCommand(o,m){this.$emit("send-command",{device:o,command:m})},editDevice(o){this.$emit("edit-device",o)},deleteDevice(o){this.$emit("delete-device",o)}}},Pt={class:"device-list-view"},Ft={class:"device-table"},jt={class:"device-info"},Nt={class:"device-name"},Bt={class:"device-entity"},Ht={class:"device-area"},qt={class:"device-type"},zt={class:"device-commands"},Jt={key:0,class:"command-list"},Wt=["onClick"],Gt={key:0,class:"no-commands"},Kt={key:1,class:"smartir-info"},Xt={class:"profile-code"},Yt={class:"device-actions"},Zt=["onClick"],Qt=["onClick"];function eo(o,m,r,$,h,s){return l(),n("div",Pt,[e("table",Ft,[m[2]||(m[2]=e("thead",null,[e("tr",null,[e("th",null,"Device"),e("th",null,"Room/Area"),e("th",null,"Type"),e("th",null,"Commands"),e("th",null,"Actions")])],-1)),e("tbody",null,[(l(!0),n(ve,null,ke(r.devices,u=>(l(),n("tr",{key:u.entity_id,class:"device-row"},[e("td",jt,[e("div",Nt,c(u.friendly_name||u.name),1),e("div",Bt,c(u.entity_id),1)]),e("td",Ht,c(u.area||"No Area"),1),e("td",qt,[e("span",{class:Y(["type-badge",u.device_type])},c(u.device_type==="smartir"?"SmartIR":"Broadlink"),3)]),e("td",zt,[u.device_type==="broadlink"?(l(),n("div",Jt,[(l(!0),n(ve,null,ke(s.getDeviceCommands(u),p=>(l(),n("button",{key:p,class:"command-btn",onClick:_=>s.sendCommand(u,p)},c(p),9,Wt))),128)),s.getDeviceCommands(u).length===0?(l(),n("span",Gt," No commands ")):T("",!0)])):u.device_type==="smartir"?(l(),n("div",Kt,[e("span",Xt,"Profile: "+c(u.device_code),1)])):T("",!0)]),e("td",Yt,[e("button",{class:"action-btn edit",onClick:p=>s.editDevice(u),title:"Edit"},[...m[0]||(m[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})],-1)])],8,Zt),e("button",{class:"action-btn delete",onClick:p=>s.deleteDevice(u),title:"Delete"},[...m[1]||(m[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"3 6 5 6 21 6"}),e("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})],-1)])],8,Qt)])]))),128))])])])}const to=we(Ut,[["render",eo],["__scopeId","data-v-952596a6"]]),oo={class:"icon-picker"},lo={class:"icon-input-wrapper"},no=["id","placeholder"],so={key:0,class:"icon-preview"},ao={key:0,class:"icon-dropdown"},io={class:"icon-grid"},ro=["onMousedown","title"],uo={__name:"IconPicker",props:{modelValue:{type:String,default:""},inputId:{type:String,default:"icon-input"},placeholder:{type:String,default:"e.g., mdi:television"}},emits:["update:modelValue"],setup(o,{emit:m}){const r=o,$=m,h=g(r.modelValue),s=g(!1),u=["television","speaker","radio","music","video","movie","play","pause","stop","skip-next","skip-previous","volume-high","volume-medium","volume-low","volume-off","remote","remote-tv","cast","chromecast","spotify","netflix","youtube","lightbulb","lightbulb-on","lightbulb-off","lamp","floor-lamp","ceiling-light","light-switch","led-strip","led-strip-variant","wall-sconce","chandelier","spotlight","track-light","vanity-light","desk-lamp","fan","ceiling-fan","air-conditioner","thermometer","thermostat","heat-wave","snowflake","fire","radiator","water-boiler","hvac","blinds","blinds-open","window-shutter","window-shutter-open","curtains","curtains-closed","roller-shade","roller-shade-closed","garage","garage-open","gate","door","door-open","window-open","window-closed","washing-machine","tumble-dryer","dishwasher","refrigerator","stove","microwave","oven","toaster","kettle","coffee","coffee-maker","blender","robot-vacuum","robot-vacuum-variant","vacuum","broom","spray-bottle","lock","lock-open","lock-smart","key","shield","shield-check","alarm-light","bell","doorbell","camera","cctv","motion-sensor","smoke-detector","fire-extinguisher","water-alert","gas-cylinder","sofa","bed","bed-double","desk","chair","table","bookshelf","home","home-outline","home-assistant","floor-plan","room","weather-sunny","weather-night","weather-cloudy","weather-rainy","weather-snowy","weather-lightning","weather-windy","weather-fog","weather-partly-cloudy","umbrella","water","water-percent","phone","cellphone","tablet","laptop","desktop-tower","monitor","keyboard","mouse","printer","router","router-wireless","access-point","wifi","bluetooth","usb","hdmi-port","ethernet","power","power-plug","power-socket","battery","battery-charging","lightning-bolt","flash","solar-panel","solar-power","leaf","tree","flower","sprout","grass","watering-can","shovel","fence","pool","hot-tub","silverware","silverware-fork-knife","food","food-apple","glass-wine","glass-cocktail","bottle-wine","pot","pot-steam","shower","shower-head","bathtub","toilet","sink","faucet","hand-wash","car","car-side","garage-variant","tools","hammer","wrench","screwdriver","toolbox","ladder","heart","heart-pulse","run","walk","bike","dumbbell","yoga","scale-bathroom","thermometer-lines","clock","clock-outline","timer","alarm","calendar","calendar-today","calendar-clock","history","bell-ring","bell-alert","alert","alert-circle","information","help-circle","check","check-circle","close-circle","minus-circle","plus-circle","arrow-up","arrow-down","arrow-left","arrow-right","chevron-up","chevron-down","menu","dots-vertical","dots-horizontal","cog","tune","circle","square","triangle","hexagon","star","star-outline","heart-outline","plus","minus","close","check-bold","eye","eye-off","account","account-group","baby","dog","cat","paw","gift","balloon","party-popper","candle","book","book-open","newspaper","email","message","phone-classic"];de(()=>r.modelValue,w=>{h.value=w});const p=W(()=>{if(!h.value)return u.slice(0,50);const w=h.value.toLowerCase().replace("mdi:","");return u.filter(t=>t.toLowerCase().includes(w)).slice(0,50)}),_=()=>{s.value=!0,$("update:modelValue",h.value)},C=()=>{setTimeout(()=>{s.value=!1},200)},M=w=>{h.value=`mdi:${w}`,$("update:modelValue",h.value),s.value=!1};return(w,t)=>(l(),n("div",oo,[e("div",lo,[K(e("input",{id:o.inputId,"onUpdate:modelValue":t[0]||(t[0]=R=>h.value=R),type:"text",placeholder:o.placeholder,onInput:_,onFocus:t[1]||(t[1]=R=>s.value=!0),onBlur:C},null,40,no),[[Le,h.value]]),h.value?(l(),n("div",so,[e("i",{class:Y(`mdi mdi-${h.value.replace("mdi:","")}`)},null,2)])):T("",!0)]),s.value&&p.value.length>0?(l(),n("div",ao,[e("div",io,[(l(!0),n(ve,null,ke(p.value,R=>(l(),n("div",{key:R,class:"icon-option",onMousedown:he(X=>M(R),["prevent"]),title:R},[e("i",{class:Y(`mdi mdi-${R}`)},null,2),e("span",null,c(R),1)],40,ro))),128))])])):T("",!0)]))}},co=we(uo,[["__scopeId","data-v-a64f5011"]]),mo={key:0,class:"dropdown-label"},vo={key:0,class:"required"},po=["placeholder","disabled","onKeydown"],fo={class:"dropdown-icons"},go={key:0,class:"mdi mdi-loading mdi-spin"},yo={key:2,class:"mdi mdi-chevron-down"},bo={key:1,class:"error-message"},ho={key:2,class:"hint-message"},ko={key:0,class:"dropdown-menu"},wo=["onMousedown","onMouseenter"],$o={class:"option-content"},Co={class:"option-label"},_o={key:0,class:"option-description"},So={key:0,class:"mdi mdi-check selected-icon"},Io={key:3,class:"dropdown-menu"},Do={__name:"SearchableDropdown",props:{modelValue:{type:[String,Number,Object],default:null},options:{type:Array,required:!0,default:()=>[]},label:{type:String,default:""},placeholder:{type:String,default:"Search..."},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},error:{type:String,default:""},hint:{type:String,default:""},optionLabel:{type:String,default:"label"},optionValue:{type:String,default:"value"},optionDescription:{type:String,default:"description"},filterMethod:{type:Function,default:null}},emits:["update:modelValue","change","search"],setup(o,{emit:m}){const r=o,$=m,h=g(null),s=g(null),u=g(""),p=g(!1),_=g(0),C=g(!1),M=E=>typeof E=="string"||typeof E=="number"?E:E[r.optionLabel]||E.label||E.name||String(E),w=E=>typeof E=="string"||typeof E=="number"?E:E[r.optionValue]||E.value||E.id||E,t=E=>typeof E=="string"||typeof E=="number"?"":E[r.optionDescription]||E.description||"",R=E=>{const j=w(E);return typeof r.modelValue=="object"?w(r.modelValue)===j:r.modelValue===j},X=W(()=>{if(!u.value)return r.options;if(r.filterMethod)return r.options.filter(j=>r.filterMethod(j,u.value));const E=u.value.toLowerCase();return r.options.filter(j=>{const le=M(j).toLowerCase(),ce=t(j).toLowerCase();return le.includes(E)||ce.includes(E)})}),U=W(()=>{if(!r.modelValue)return"";const E=r.options.find(j=>{const le=w(j);return typeof r.modelValue=="object"?le===w(r.modelValue):le===r.modelValue});return E?M(E):""});de(()=>r.modelValue,E=>{C.value||(u.value=U.value)}),de(()=>r.options,()=>{!C.value&&r.modelValue&&(u.value=U.value)},{deep:!0}),de(u,E=>{$("search",E),_.value=0}),Ae(()=>{u.value=U.value});const x=()=>{var E;C.value=!0,p.value=!0,(E=s.value)==null||E.select()},a=()=>{C.value=!1,setTimeout(()=>{p.value=!1,r.modelValue?u.value=U.value:u.value=""},200)},b=()=>{var E;p.value=!1,(E=s.value)==null||E.blur()},v=E=>{const j=w(E);$("update:modelValue",j),$("change",j,E),u.value=M(E),b()},O=()=>{var E;$("update:modelValue",null),$("change",null,null),u.value="",(E=s.value)==null||E.focus()},z=()=>{if(!p.value){p.value=!0;return}_.value<X.value.length-1&&_.value++},ee=()=>{_.value>0&&_.value--},H=()=>{X.value.length>0&&_.value>=0&&v(X.value[_.value])},ae=E=>{h.value&&!h.value.contains(E.target)&&(p.value=!1,r.modelValue?u.value=U.value:u.value="")};return Ae(()=>{document.addEventListener("click",ae)}),Ge(()=>{document.removeEventListener("click",ae)}),(E,j)=>(l(),n("div",{class:"searchable-dropdown",ref_key:"dropdownRef",ref:h},[o.label?(l(),n("label",mo,[I(c(o.label)+" ",1),o.required?(l(),n("span",vo,"*")):T("",!0)])):T("",!0),e("div",{class:Y(["dropdown-input-wrapper",{"has-error":o.error,disabled:o.disabled}])},[K(e("input",{ref_key:"inputRef",ref:s,type:"text","onUpdate:modelValue":j[0]||(j[0]=le=>u.value=le),placeholder:o.placeholder,disabled:o.disabled||o.loading,onFocus:x,onBlur:a,onKeydown:[Be(he(z,["prevent"]),["down"]),Be(he(ee,["prevent"]),["up"]),Be(he(H,["prevent"]),["enter"]),Be(b,["escape"])],class:"dropdown-input"},null,40,po),[[Le,u.value]]),e("div",fo,[o.loading?(l(),n("i",go)):o.modelValue&&!o.disabled?(l(),n("i",{key:1,class:"mdi mdi-close-circle clear-icon",onClick:O})):(l(),n("i",yo))])],2),o.error?(l(),n("div",bo,c(o.error),1)):T("",!0),o.hint&&!o.error?(l(),n("div",ho,c(o.hint),1)):T("",!0),be(et,{name:"dropdown"},{default:Ke(()=>[p.value&&X.value.length>0?(l(),n("div",ko,[(l(!0),n(ve,null,ke(X.value,(le,ce)=>(l(),n("div",{key:w(le),class:Y(["dropdown-item",{highlighted:ce===_.value,selected:R(le)}]),onMousedown:he(pe=>v(le),["prevent"]),onMouseenter:pe=>_.value=ce},[e("div",$o,[e("div",Co,c(M(le)),1),t(le)?(l(),n("div",_o,c(t(le)),1)):T("",!0)]),R(le)?(l(),n("i",So)):T("",!0)],42,wo))),128))])):T("",!0)]),_:1}),p.value&&X.value.length===0&&!o.loading?(l(),n("div",Io,[...j[1]||(j[1]=[e("div",{class:"dropdown-item no-results"},[e("i",{class:"mdi mdi-magnify"}),I(" No results found ")],-1)])])):T("",!0)],512))}},Je=we(Do,[["__scopeId","data-v-679ce35f"]]),xo={class:"smartir-selector"},To={class:"form-group"},Mo={class:"form-group"},Ro={class:"form-group"},Lo=["value"],Ao={key:0,class:"error-message"},Eo={class:"form-group"},Oo={class:"form-group"},Vo={key:1,class:"code-info"},Uo={class:"info-content"},Po={class:"info-row"},Fo={class:"info-value"},jo={class:"info-row"},No={class:"info-value"},Bo={key:0,class:"info-row"},Ho={class:"info-value"},qo={class:"info-row"},zo={class:"info-value"},Jo={__name:"SmartIRDeviceSelector",props:{entityType:{type:String,required:!0},modelValue:{type:Object,default:()=>({})},broadlinkDevices:{type:Array,default:()=>[]}},emits:["update:modelValue","change"],setup(o,{expose:m,emit:r}){const $=o,h=r,s=g([]),u=g([]),p=g(""),_=g(""),C=g(""),M=g(""),w=g(""),t=g(null),R=g(!1),X=g(!1),U=g({manufacturer:"",model:"",controller:""});Ae(async()=>{if(await x(),$.modelValue&&(p.value=$.modelValue.manufacturer||"",_.value=$.modelValue.device_code||"",C.value=$.modelValue.controller_device||"",M.value=$.modelValue.temperature_sensor||"",w.value=$.modelValue.humidity_sensor||"",p.value&&(await a(p.value),_.value&&u.value.length>0))){const E=u.value.find(j=>j.code===_.value);E&&(t.value={code:E.code,manufacturer:p.value,models:E.models,controller:E.controller})}}),de(()=>$.entityType,async E=>{E&&(p.value="",_.value="",u.value=[],t.value=null,await x())});const x=async()=>{if($.entityType){R.value=!0,U.value.manufacturer="";try{const E=await ne.get("/api/smartir/codes/manufacturers",{params:{entity_type:$.entityType}});if(E.data.success)s.value=E.data.manufacturers||[];else throw new Error(E.data.error||"Failed to load manufacturers")}catch(E){console.error("Error loading manufacturers:",E),U.value.manufacturer="Failed to load manufacturers. Please try again.",s.value=[]}finally{R.value=!1}}},a=async E=>{if(!(!E||!$.entityType)){X.value=!0,U.value.model="";try{const j=await ne.get("/api/smartir/codes/models",{params:{entity_type:$.entityType,manufacturer:E}});if(j.data.success){const le=j.data.models||[];u.value=le.map(ce=>{const pe=ce.models&&ce.models.length>0?ce.models.join(", "):`Code ${ce.code}`;return{code:ce.code,label:pe,description:`Code: ${ce.code}`,models:ce.models,controller:ce.controller}})}else throw new Error(j.data.error||"Failed to load models")}catch(j){console.error("Error loading models:",j),U.value.model="Failed to load models. Please try again.",u.value=[]}finally{X.value=!1}}},b=async E=>{p.value=E,_.value="",t.value=null,u.value=[],E&&await a(E),H()},v=()=>{const E=u.value.find(j=>j.code===_.value);E&&(t.value={code:E.code,manufacturer:p.value,models:E.models,controller:E.controller}),H()},O=()=>{H()},z=()=>{H()},ee=()=>{H()},H=()=>{var j,le;const E={manufacturer:p.value,model:((le=(j=t.value)==null?void 0:j.models)==null?void 0:le[0])||"",device_code:_.value,controller_device:C.value};$.entityType==="climate"&&(M.value&&(E.temperature_sensor=M.value),w.value&&(E.humidity_sensor=w.value)),h("update:modelValue",E),h("change",E)};return m({validate:()=>{let E=!0;return U.value={manufacturer:"",model:"",controller:""},p.value||(U.value.manufacturer="Manufacturer is required",E=!1),_.value||(U.value.model="Model is required",E=!1),C.value||(U.value.controller="Broadlink controller is required",E=!1),E}}),(E,j)=>(l(),n("div",xo,[e("div",To,[be(Je,{modelValue:p.value,"onUpdate:modelValue":j[0]||(j[0]=le=>p.value=le),options:s.value,label:"Manufacturer",placeholder:"Search manufacturers...",required:"",loading:R.value,error:U.value.manufacturer,hint:"Select the device manufacturer",onChange:b},null,8,["modelValue","options","loading","error"])]),e("div",Mo,[be(Je,{modelValue:_.value,"onUpdate:modelValue":j[1]||(j[1]=le=>_.value=le),options:u.value,"option-label":"label","option-value":"code","option-description":"description",label:"Model",placeholder:"Search models...",required:"",disabled:!p.value,loading:X.value,error:U.value.model,hint:"Select the device model",onChange:v},null,8,["modelValue","options","disabled","loading","error"])]),e("div",Ro,[j[6]||(j[6]=e("label",{for:"controller-device"},[e("i",{class:"mdi mdi-remote"}),I(" Controller Device * ")],-1)),K(e("select",{id:"controller-device","onUpdate:modelValue":j[2]||(j[2]=le=>C.value=le),required:"",onChange:O},[j[5]||(j[5]=e("option",{value:""},"-- Select Controller Device --",-1)),(l(!0),n(ve,null,ke(o.broadlinkDevices,le=>(l(),n("option",{key:le.entity_id,value:le.entity_id},[I(c(le.name||le.entity_id)+" ",1),le.area_name?(l(),n(ve,{key:0},[I(" - "+c(le.area_name),1)],64)):T("",!0)],8,Lo))),128))],544),[[Se,C.value]]),j[7]||(j[7]=e("small",null,"Which remote device will send the IR/RF commands",-1)),U.value.controller?(l(),n("div",Ao,c(U.value.controller),1)):T("",!0)]),o.entityType==="climate"?(l(),n(ve,{key:0},[e("div",Eo,[j[8]||(j[8]=e("label",{for:"temperature-sensor"},"Temperature Sensor",-1)),K(e("input",{id:"temperature-sensor","onUpdate:modelValue":j[3]||(j[3]=le=>M.value=le),type:"text",placeholder:"e.g., sensor.living_room_temperature",onInput:z},null,544),[[Le,M.value]]),j[9]||(j[9]=e("small",null,"Optional: Temperature sensor entity for current temperature",-1))]),e("div",Oo,[j[10]||(j[10]=e("label",{for:"humidity-sensor"},"Humidity Sensor",-1)),K(e("input",{id:"humidity-sensor","onUpdate:modelValue":j[4]||(j[4]=le=>w.value=le),type:"text",placeholder:"e.g., sensor.living_room_humidity",onInput:ee},null,544),[[Le,w.value]]),j[11]||(j[11]=e("small",null,"Optional: Humidity sensor entity for current humidity",-1))])],64)):T("",!0),t.value?(l(),n("div",Vo,[j[16]||(j[16]=e("div",{class:"info-header"},[e("i",{class:"mdi mdi-information"}),e("span",null,"Selected Device Code")],-1)),e("div",Uo,[e("div",Po,[j[12]||(j[12]=e("span",{class:"info-label"},"Code ID:",-1)),e("span",Fo,c(t.value.code_id),1)]),e("div",jo,[j[13]||(j[13]=e("span",{class:"info-label"},"Manufacturer:",-1)),e("span",No,c(t.value.manufacturer),1)]),t.value.models&&t.value.models.length>0?(l(),n("div",Bo,[j[14]||(j[14]=e("span",{class:"info-label"},"Supported Models:",-1)),e("span",Ho,c(t.value.models.join(", ")),1)])):T("",!0),e("div",qo,[j[15]||(j[15]=e("span",{class:"info-label"},"Controller:",-1)),e("span",zo,c(t.value.controller||"Broadlink"),1)])])])):T("",!0)]))}},Wo=we(Jo,[["__scopeId","data-v-1911c8f6"]]),Go={class:"modal-content"},Ko={class:"modal-header"},Xo={class:"input-wrapper"},Yo={key:0,class:"validation-tooltip"},Zo={class:"input-wrapper"},Qo=["disabled"],el={key:0,class:"validation-tooltip"},tl={key:0,class:"smartir-notice"},ol={key:0,class:"notice-success"},ll={key:1,class:"notice-warning"},nl={key:1,class:"smartir-notice"},sl={key:2},al={class:"form-group"},il=["disabled"],rl=["disabled"],dl={key:0},ul={key:1},cl={key:2},ml={key:3},vl={key:0,class:"form-group"},pl={class:"area-display-readonly"},fl=["value"],gl=["disabled"],yl=["href"],bl={key:1,class:"form-group"},hl={class:"form-group"},kl={class:"input-wrapper"},wl=["value"],$l=["value"],Cl={key:2,class:"validation-tooltip"},_l={key:0},Sl={key:1},Il={key:3,class:"smartir-section"},Dl={class:"modal-footer"},xl={type:"submit",form:"device-form",class:"btn btn-primary"},Tl={__name:"DeviceForm",props:{device:{type:Object,default:null}},emits:["save","cancel"],setup(o,{emit:m}){const r=o,$=m,h=Te("smartirStatus"),s=Te("smartirEnabled"),u=W(()=>{var d;return localStorage.getItem("smartir_simulate_not_installed")==="true"?!1:((d=h==null?void 0:h.value)==null?void 0:d.installed)||!1}),p=W(()=>!!r.device),_=W(()=>["climate","media_player","fan","light"].includes(t.value.entity_type)),C=W(()=>u.value?!_.value&&t.value.entity_type?"(Not supported for this type)":"(Pre-configured Codes)":"(Requires SmartIR)"),M=W(()=>{var d;const D=((d=r.device)==null?void 0:d.commands)||{};return Object.keys(D).length>0}),w=W(()=>{if(!t.value.broadlink_entity)return"";const D=a.value.find(d=>d.entity_id===t.value.broadlink_entity);return D&&D.name||t.value.broadlink_entity}),t=g({name:"",entity_type:"",device_type:"broadlink",device:"",area:"",icon:"",broadlink_entity:"",enabled:!0,commands:{}}),R=g({name:"",entity_type:"",broadlink_entity:""}),X=g({}),U=g(null),x=g([]),a=g([]),b=g(null),v=g(null),O=g(null),z=g(!1);Ae(async()=>{r.device&&(t.value={...r.device,device_type:r.device.device_type||"broadlink"},t.value.device_type==="smartir"&&(X.value={manufacturer:r.device.manufacturer,model:r.device.model,device_code:r.device.device_code,controller_device:r.device.controller_device,temperature_sensor:r.device.temperature_sensor,humidity_sensor:r.device.humidity_sensor})),await Promise.all([ee(),H()])});const ee=async()=>{try{const D=await ne.get("/api/areas");x.value=D.data.areas||[]}catch(D){console.error("Error loading areas:",D),x.value=[]}},H=async()=>{try{const d=(await ne.get("/api/remote/devices")).data.devices||[];a.value=d,console.log("Loaded remote devices:",d)}catch(D){console.error("Error loading remote devices:",D),a.value=[]}},ae=D=>{if(!D)return"";const d=D.toLowerCase();for(const V of x.value){const ge=V.toLowerCase();if(d.includes(ge))return V}return""},E=(D,d="")=>{const V=d.toLowerCase();return V.includes("tv")?"mdi:television":V.includes("lamp")?"mdi:lamp":V.includes("ceiling")?"mdi:ceiling-light":V.includes("floor")?"mdi:floor-lamp":V.includes("desk")?"mdi:desk-lamp":V.includes("fan")?"mdi:fan":V.includes("ac")||V.includes("air con")?"mdi:air-conditioner":V.includes("heater")?"mdi:radiator":V.includes("blind")?"mdi:blinds":V.includes("curtain")?"mdi:curtains":V.includes("garage")?"mdi:garage":V.includes("speaker")||V.includes("stereo")?"mdi:speaker":V.includes("receiver")?"mdi:audio-video":{light:"mdi:lightbulb",fan:"mdi:fan",switch:"mdi:light-switch",media_player:"mdi:television",cover:"mdi:window-shutter",climate:"mdi:thermostat"}[D]||"mdi:devices"};de(()=>t.value.name,D=>{if(!p.value&&D&&!t.value.area){const d=ae(D);d&&(t.value.area=d)}!p.value&&D&&t.value.entity_type&&(z.value||!t.value.icon)&&(t.value.icon=E(t.value.entity_type,D),z.value=!0)}),de(()=>t.value.entity_type,D=>{!p.value&&D&&(z.value||!t.value.icon)&&(t.value.icon=E(D,t.value.name),z.value=!0)}),de(()=>t.value.icon,(D,d)=>{d!==void 0&&D!==d&&!z.value&&(z.value=!1),D||(z.value=!1)});const j=g(!1),le=async()=>{var D;if((D=r.device)!=null&&D.id){j.value=!0;try{const d=await ne.post(`/api/devices/${r.device.id}/sync-area`);d.data.success?(t.value.area=d.data.area||"",d.data.area?console.log(`Area synced: ${d.data.area}`):console.log("No area assigned in Home Assistant")):console.warn(d.data.message||"Entity not found in HA")}catch(d){console.error("Failed to sync area:",d)}finally{j.value=!1}}},ce=()=>{var V;return!((V=r.device)!=null&&V.id)||!t.value.entity_type?"#":`/config/entities/entity/${`${t.value.entity_type}.${r.device.id}`}`},pe=()=>{R.value={name:"",entity_type:"",broadlink_entity:""};let D=!0;return(!t.value.name||t.value.name.trim()==="")&&(R.value.name="Device name is required",D=!1),t.value.entity_type||(R.value.entity_type="Entity type is required",D=!1),t.value.device_type==="broadlink"&&!t.value.broadlink_entity&&(R.value.broadlink_entity="Broadlink device is required",D=!1),D},Ie=D=>{R.value[D]=""},Me=async()=>{if(t.value.device_type==="smartir"){if(U.value&&!U.value.validate())return;const D={...t.value,smartir_config:{manufacturer:X.value.manufacturer,model:X.value.model,code_id:X.value.device_code,controller_device:X.value.controller_device}};$("save",D)}else{if(!pe())return;$("save",{...t.value})}},xe=D=>{X.value=D};return(D,d)=>(l(),n("div",{class:"modal-overlay",onClick:d[11]||(d[11]=he(V=>D.$emit("cancel"),["self"]))},[e("div",Go,[e("div",Ko,[e("h2",null,c(p.value?"Edit Device":"Add New Device"),1),e("button",{onClick:d[0]||(d[0]=V=>D.$emit("cancel")),class:"close-btn"},[...d[12]||(d[12]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("form",{id:"device-form",onSubmit:he(Me,["prevent"]),class:"modal-body"},[e("div",{class:Y(["form-group",{"has-error":R.value.name}])},[d[14]||(d[14]=e("label",{for:"device-name"},"Device Name *",-1)),e("div",Xo,[K(e("input",{id:"device-name",ref_key:"nameInput",ref:b,"onUpdate:modelValue":d[1]||(d[1]=V=>t.value.name=V),type:"text",placeholder:"e.g., Living Room TV",onInput:d[2]||(d[2]=V=>Ie("name"))},null,544),[[Le,t.value.name]]),R.value.name?(l(),n("div",Yo,[d[13]||(d[13]=e("i",{class:"mdi mdi-alert"},null,-1)),I(" "+c(R.value.name),1)])):T("",!0)]),d[15]||(d[15]=e("small",null,"Friendly name for this device",-1))],2),e("div",{class:Y(["form-group",{"has-error":R.value.entity_type}])},[d[23]||(d[23]=e("label",{for:"entity-type"},"Entity Type *",-1)),e("div",Zo,[K(e("select",{id:"entity-type",ref_key:"typeSelect",ref:v,"onUpdate:modelValue":d[3]||(d[3]=V=>t.value.entity_type=V),onChange:d[4]||(d[4]=V=>Ie("entity_type"))},[d[16]||(d[16]=Pe('<option value="" data-v-94bc1fe5>-- Select Type --</option><option value="light" data-v-94bc1fe5>ğŸ’¡ Light</option><option value="fan" data-v-94bc1fe5>ğŸŒ€ Fan</option><option value="switch" data-v-94bc1fe5>ğŸ”Œ Switch</option><option value="media_player" data-v-94bc1fe5>ğŸ“º Media Player</option><option value="cover" data-v-94bc1fe5>ğŸªŸ Cover (Blinds/Curtains)</option>',6)),e("option",{value:"climate",disabled:!u.value}," ğŸŒ¡ï¸ Climate "+c(u.value?"":"(Requires SmartIR)"),9,Qo)],544),[[Se,t.value.entity_type]]),R.value.entity_type?(l(),n("div",el,[d[17]||(d[17]=e("i",{class:"mdi mdi-alert"},null,-1)),I(" "+c(R.value.entity_type),1)])):T("",!0)]),t.value.entity_type==="climate"?(l(),n("div",tl,[u.value?(l(),n("div",ol,[...d[18]||(d[18]=[e("i",{class:"mdi mdi-check-circle"},null,-1),e("span",null,"SmartIR detected! Climate entities will be created via SmartIR profiles.",-1)])])):(l(),n("div",ll,[...d[19]||(d[19]=[e("i",{class:"mdi mdi-alert"},null,-1),e("div",null,[e("strong",null,"SmartIR Required"),e("p",null,"Climate entities (AC, heaters) require SmartIR integration."),e("a",{href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"smartir-link"}," Install SmartIR â†’ ")],-1)])]))])):u.value&&["media_player","fan","light"].includes(t.value.entity_type)?(l(),n("div",nl,[...d[20]||(d[20]=[e("div",{class:"notice-info"},[e("i",{class:"mdi mdi-information"}),e("span",null,"ğŸ’¡ SmartIR available! You can use pre-configured codes or learn your own.")],-1)])])):!u.value&&t.value.entity_type?(l(),n("small",sl,[d[21]||(d[21]=I(" ğŸ’¡ Tip: Install ",-1)),d[22]||(d[22]=e("a",{href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"inline-link"},"SmartIR",-1)),I(" for pre-configured "+c(t.value.entity_type==="climate"?"climate":t.value.entity_type)+" device codes ",1)])):T("",!0)],2),e("div",al,[d[26]||(d[26]=e("label",{for:"device-type"},"Device Type *",-1)),K(e("select",{id:"device-type","onUpdate:modelValue":d[5]||(d[5]=V=>t.value.device_type=V),required:"",disabled:p.value},[d[24]||(d[24]=e("option",{value:""},"-- Select Device Type --",-1)),d[25]||(d[25]=e("option",{value:"broadlink"},"ğŸ“¡ Broadlink Device (Learn IR Codes)",-1)),$e(s)?(l(),n("option",{key:0,value:"smartir",disabled:!u.value||!_.value}," ğŸŒ SmartIR Device "+c(C.value),9,rl)):T("",!0)],8,il),[[Se,t.value.device_type]]),p.value?(l(),n("small",dl,"Cannot change device type after creation")):t.value.device_type==="smartir"?(l(),n("small",ul,"Using pre-configured codes from SmartIR repository")):t.value.device_type==="broadlink"?(l(),n("small",cl,"Learn and store your own IR codes")):(l(),n("small",ml,"Choose how to configure this device"))]),p.value?(l(),n("div",vl,[d[29]||(d[29]=e("label",{for:"device-area"},"Area",-1)),e("div",pl,[e("input",{id:"device-area",value:t.value.area||"Not assigned",type:"text",readonly:"",class:"readonly-input"},null,8,fl),e("button",{type:"button",onClick:le,disabled:j.value,class:"sync-area-btn",title:"Sync area from Home Assistant"},[e("i",{class:Y(j.value?"mdi mdi-loading mdi-spin":"mdi mdi-refresh")},null,2)],8,gl)]),e("small",null,[d[27]||(d[27]=e("i",{class:"mdi mdi-information-outline"},null,-1)),d[28]||(d[28]=I(" Set area in Home Assistant, then click sync. ",-1)),e("a",{href:ce(),target:"_blank",class:"inline-link"},"Open in HA â†’",8,yl)])])):(l(),n("div",bl,[...d[30]||(d[30]=[e("div",{class:"info-notice"},[e("i",{class:"mdi mdi-information-outline"}),e("span",null,[e("strong",null,"Area Assignment:"),I(" After generating entities and restarting Home Assistant, you can assign areas in HA and sync them here.")])],-1)])])),e("div",hl,[d[31]||(d[31]=e("label",{for:"device-icon"},"Icon",-1)),be(co,{modelValue:t.value.icon,"onUpdate:modelValue":d[6]||(d[6]=V=>t.value.icon=V),inputId:"device-icon",placeholder:"e.g., mdi:television"},null,8,["modelValue"]),d[32]||(d[32]=e("small",null,"Optional: Material Design Icon name",-1))]),t.value.device_type==="broadlink"?(l(),n("div",{key:2,class:Y(["form-group",{"has-error":R.value.broadlink_entity}])},[d[35]||(d[35]=e("label",{for:"broadlink-entity"},"Remote Device *",-1)),e("div",kl,[!p.value||!M.value?K((l(),n("select",{key:0,id:"broadlink-entity",ref_key:"broadlinkSelect",ref:O,"onUpdate:modelValue":d[7]||(d[7]=V=>t.value.broadlink_entity=V),onChange:d[8]||(d[8]=V=>Ie("broadlink_entity"))},[d[33]||(d[33]=e("option",{value:""},"-- Select Remote Device --",-1)),(l(!0),n(ve,null,ke(a.value,V=>(l(),n("option",{key:V.entity_id,value:V.entity_id},[I(c(V.name||V.entity_id)+" ",1),V.area_name?(l(),n(ve,{key:0},[I(" - "+c(V.area_name),1)],64)):T("",!0)],8,wl))),128))],544)),[[Se,t.value.broadlink_entity]]):(l(),n("input",{key:1,id:"broadlink-entity",value:w.value,type:"text",readonly:"",disabled:""},null,8,$l)),R.value.broadlink_entity?(l(),n("div",Cl,[d[34]||(d[34]=e("i",{class:"mdi mdi-alert"},null,-1)),I(" "+c(R.value.broadlink_entity),1)])):T("",!0)]),!p.value||!M.value?(l(),n("small",_l,"Required: Select which remote device to use for sending commands")):(l(),n("small",Sl,"Cannot change remote device after commands are learned"))],2)):T("",!0),t.value.device_type==="smartir"?(l(),n("div",Il,[d[36]||(d[36]=e("div",{class:"section-header"},[e("i",{class:"mdi mdi-cloud-download"}),e("span",null,"SmartIR Device Configuration")],-1)),be(Wo,{ref_key:"smartirSelector",ref:U,"entity-type":t.value.entity_type,modelValue:X.value,"onUpdate:modelValue":d[9]||(d[9]=V=>X.value=V),"broadlink-devices":a.value,onChange:xe},null,8,["entity-type","modelValue","broadlink-devices"])])):T("",!0)],32),e("div",Dl,[e("button",{type:"button",onClick:d[10]||(d[10]=V=>D.$emit("cancel")),class:"btn btn-secondary"}," Cancel "),e("button",xl,[d[37]||(d[37]=e("i",{class:"mdi mdi-check"},null,-1)),I(" "+c(p.value?"Update":"Create"),1)])])])]))}},Ml=we(Tl,[["__scopeId","data-v-94bc1fe5"]]),Rl={class:"modal-header"},Ll={class:"modal-body"},Al={class:"message-text"},El={key:0,class:"checkbox-option"},Ol={class:"modal-footer"},Vl=["disabled"],Ul={__name:"ConfirmDialog",props:{isOpen:{type:Boolean,default:!1},title:{type:String,default:"Confirm"},message:{type:String,required:!0},confirmText:{type:String,default:"OK"},cancelText:{type:String,default:"Cancel"},showCancel:{type:Boolean,default:!0},dangerMode:{type:Boolean,default:!1},confirmDisabled:{type:Boolean,default:!1},checkboxLabel:{type:String,default:""}},emits:["confirm","cancel"],setup(o,{emit:m}){const r=o,$=m,h=g(!1);de(()=>r.isOpen,p=>{p&&(h.value=!1)});const s=()=>{$("confirm",h.value)},u=()=>{$("cancel")};return(p,_)=>o.isOpen?(l(),n("div",{key:0,class:"modal-overlay",onClick:he(u,["self","stop"])},[e("div",{class:"modal-dialog confirm-dialog",onClick:_[1]||(_[1]=he(()=>{},["stop"]))},[e("div",Rl,[e("h2",null,c(o.title),1)]),e("div",Ll,[e("p",Al,c(o.message),1),o.checkboxLabel?(l(),n("div",El,[e("label",null,[K(e("input",{type:"checkbox","onUpdate:modelValue":_[0]||(_[0]=C=>h.value=C)},null,512),[[fe,h.value]]),e("span",null,c(o.checkboxLabel),1)])])):T("",!0)]),e("div",Ol,[o.showCancel?(l(),n("button",{key:0,onClick:he(u,["stop"]),class:"btn btn-secondary"},c(o.cancelText),1)):T("",!0),o.confirmText?(l(),n("button",{key:1,onClick:he(s,["stop"]),class:Y(["btn",o.dangerMode?"btn-danger":"btn-primary"]),disabled:o.confirmDisabled},c(o.confirmText),11,Vl)):T("",!0)])])])):T("",!0)}},Ue=we(Ul,[["__scopeId","data-v-9cea6cb3"]]),Pl={class:"modal-content"},Fl={class:"modal-header"},jl={class:"modal-body"},Nl={key:0,class:"smartir-info"},Bl={key:0,class:"climate-note"},Hl={class:"form-group"},ql=["value"],zl={class:"form-group"},Jl=["disabled"],Wl={label:"Suggested Commands"},Gl=["value"],Kl=["disabled"],Xl={class:"form-group"},Yl={class:"radio-group"},Zl={class:"radio-label"},Ql=["disabled"],en={class:"radio-label"},tn=["disabled"],on={class:"learn-action"},ln=["disabled"],nn={key:0,class:"mdi mdi-loading mdi-spin"},sn={key:1,class:"mdi mdi-remote-tv"},an={key:0,class:"learning-status"},rn={key:0},dn={key:1,class:"rf-instructions"},un={key:1,class:"result-message success"},cn={key:2,class:"section-divider"},mn={key:3,class:"loading-commands"},vn={key:4,class:"learned-commands"},pn={class:"command-list"},fn={class:"command-info"},gn={class:"command-name"},yn={class:"command-right"},bn=["title"],hn={class:"command-actions"},kn=["onClick","disabled"],wn=["onClick"],$n={key:5,class:"untracked-commands"},Cn={class:"command-list"},_n={class:"command-name"},Sn={class:"modal-footer"},In=["disabled"],Dn={__name:"CommandLearner",props:{device:{type:Object,required:!0}},emits:["cancel","learned"],setup(o,{emit:m}){const r=o,$=m,h=g([]),s=g(""),u=g(""),p=g(""),_=g("ir"),C=g(!1),M=g(""),w=g("success"),t=g([]),R=g([]),X=g(!1),U=g(!1),x=g(""),a=g(!1),b=g(null),v=g(null),O=g(""),z=g(""),ee=W(()=>r.device.device_type==="smartir");W(()=>{if(ee.value)return!1;const q=u.value==="__custom__"?p.value:u.value;return s.value&&q.trim()});const H=()=>{b.value&&b.value.setCustomValidity("")},ae=()=>{v.value&&v.value.setCustomValidity("")},E=W(()=>{const q=h.value.find(L=>L.entity_id===s.value);return q?q.name||q.entity_id:s.value}),j={light:["turn_on","turn_off","toggle","brightness_up","brightness_down","dim","bright"],fan:["turn_on","turn_off","toggle","speed_low","speed_medium","speed_high","speed_1","speed_2","speed_3","speed_4","speed_5","oscillate_on","oscillate_off","direction_forward","direction_reverse"],switch:["turn_on","turn_off","toggle"],media_player:["turn_on","turn_off","toggle","volume_up","volume_down","volume_mute","play","pause","stop","play_pause","next_track","previous_track","channel_up","channel_down","source_hdmi1","source_hdmi2","source_hdmi3","source_tv","source_aux","source_bluetooth","menu","home","back","select","arrow_up","arrow_down","arrow_left","arrow_right"],cover:["open","close","stop","open_tilt","close_tilt","position_0","position_25","position_50","position_75","position_100"]},le=W(()=>{const q=r.device.entity_type||"switch";return j[q]||j.switch});Ae(async()=>{await ce();try{console.log("ğŸ”„ Syncing command types...");const L=await ne.post("/api/commands/sync");console.log("âœ… Command types synced:",L.data)}catch(L){console.error("âš ï¸ Failed to sync command types:",L)}const q=!ee.value;console.log(`ğŸ“‹ Will ${q?"FORCE RELOAD":"use cached"} commands`),await pe(q),b.value&&(b.value.setCustomValidity(""),b.value.oninvalid=()=>{b.value.setCustomValidity("Command name is required")}),r.device.broadlink_entity&&(s.value=r.device.broadlink_entity)}),de(u,async q=>{q==="__custom__"&&(await tt(),v.value&&(v.value.setCustomValidity(""),v.value.oninvalid=()=>{v.value.setCustomValidity("Custom command name is required")}))});const ce=async()=>{try{const q=await ne.get("/api/broadlink/devices");h.value=q.data.devices||[]}catch(q){console.error("Error loading Broadlink devices:",q)}},pe=async(q=!1)=>{var L,Q;X.value=!0;try{if(ee.value){const se=await ne.get("/api/smartir/codes/code",{params:{entity_type:r.device.entity_type,code_id:r.device.device_code}});if(se.data.success&&se.data.code){const G=se.data.code.commands||{},f=se.data.code.commandType||"ir";if(r.device.entity_type==="climate"){const y=[];for(const[B,te]of Object.entries(G))typeof te=="string"?y.push({name:B,type:f}):typeof te=="object"&&te!==null&&Object.keys(te).sort((i,P)=>parseInt(i)-parseInt(P)).forEach(i=>{y.push({name:`${B}_${i}`,type:f,label:`${B.charAt(0).toUpperCase()+B.slice(1)} ${i}Â°C`})});t.value=y}else t.value=Object.keys(G).map(y=>({name:y,type:f}))}}else{if(console.log("ğŸ“‹ Loading commands for device:",r.device),console.log("ğŸ“‹ Device ID:",r.device.id),console.log("ğŸ“‹ Force reload:",q),q&&r.device.id){console.log("ğŸ”„ Force reloading commands from API after sync");try{const G=(await ne.get(`/api/commands/${r.device.id}`)).data.commands||{};console.log("ğŸ“¦ Raw commands from API:",G),t.value=Object.entries(G).map(([f,y])=>{console.log(`  Command '${f}':`,y,`(type: ${typeof y})`);const B=typeof y=="object"&&y!==null&&(y.command_type||y.type)||"ir";return{name:f,type:B}}),console.log("ğŸ“‹ Reloaded commands:",t.value)}catch(se){if(console.error("âŒ Error loading commands:",se),((L=se.response)==null?void 0:L.status)===404)console.log("â„¹ï¸ No commands found for device"),t.value=[];else throw se}}else if(r.device.commands&&Object.keys(r.device.commands).length>0)console.log("âœ… Using commands from device object"),t.value=Object.entries(r.device.commands).map(([se,G])=>({name:se,type:G.command_type||G.type||"ir"}));else if(r.device.commands!==void 0)console.log("â„¹ï¸ Device has empty commands object - skipping API call"),t.value=[];else if(r.device.id){console.log("ğŸŒ Fetching commands from API for device ID:",r.device.id);try{const G=(await ne.get(`/api/commands/${r.device.id}`)).data.commands||{};t.value=Object.entries(G).map(([f,y])=>({name:f,type:y.command_type||y.type||"ir"}))}catch(se){if(((Q=se.response)==null?void 0:Q.status)===404)console.log("â„¹ï¸ No commands found for device (this is normal for new devices)"),t.value=[];else throw se}}else console.log("âš ï¸ No commands found and no device ID");console.log("ğŸ“‹ Final learned commands:",t.value)}}catch(se){console.error("Error loading commands:",se)}finally{X.value=!1}},Ie=async()=>{var q,L;M.value="",w.value="",C.value=!0;try{let Q=r.device.id.split(".")[1];r.device.device&&(Q=r.device.device);const se=u.value==="__custom__"?p.value:u.value,G=await ne.post("/api/commands/learn",{entity_id:s.value,device:Q,device_id:r.device.id,command:se.trim(),command_type:_.value});if(G.data.success){M.value=`Command "${se}" learned successfully!`,w.value="success",t.value.find(te=>te.name===se)||t.value.push({name:se,type:_.value});const y=R.value.indexOf(se);y>-1&&R.value.splice(y,1);const B={...r.device.commands};B[se]={command_type:_.value,type:_.value},await V(),u.value="",p.value="",$("learned",{commands:B,commandName:se})}else M.value=G.data.error||"Failed to learn command",w.value="error"}catch(Q){M.value=((L=(q=Q.response)==null?void 0:q.data)==null?void 0:L.error)||"Error learning command",w.value="error"}finally{C.value=!1}},Me=async q=>{var L,Q;try{z.value=q,O.value="";let se=r.device.id.split(".")[1];r.device.device&&(se=r.device.device);const G=ee.value?r.device.controller_device:s.value||r.device.broadlink_entity;if(!G){console.error("Missing entity_id for test command:",{isSmartIR:ee.value,controller_device:r.device.controller_device,broadlink_entity:r.device.broadlink_entity,selectedBroadlink:s.value,device:r.device}),M.value="Missing Broadlink remote entity. Please select a Broadlink device.",w.value="error",z.value="";return}const f={entity_id:G,device:se,command:q,device_id:r.device.id};console.log("ğŸ§ª Testing command:",f),(await ne.post("/api/commands/test",f)).data.success&&(O.value=q,setTimeout(()=>{O.value===q&&(O.value="")},2e3))}catch(se){console.error("âŒ Test command error:",se);const G=((Q=(L=se.response)==null?void 0:L.data)==null?void 0:Q.error)||se.message||"Unknown error";M.value=`Failed to send command: ${G}`,w.value="error"}finally{z.value=""}},xe=q=>{x.value=q,U.value=!0},D=()=>{U.value=!1,x.value=""},d=async()=>{const q=x.value;U.value=!1;try{console.log(`ğŸ—‘ï¸ Deleting command: ${q}`),await ne.delete(`/api/commands/${r.device.id}/${q}`),t.value=t.value.filter(L=>L.name!==q),await pe(),await V(),M.value=`Command "${q}" deleted`,w.value="success",$("learned")}catch(L){console.error("âŒ Delete error:",L),M.value=`Failed to delete command: ${L.message}`,w.value="error"}finally{x.value=""}},V=async()=>{try{let q=r.device.device;q||(q=r.device.id.includes(".")?r.device.id.split(".")[1]:r.device.id),console.log("ğŸ” Looking for untracked commands for device:",q);const Q=(await ne.get("/api/commands/untracked")).data.untracked||{};console.log("ğŸ“¦ All untracked commands:",Object.keys(Q)),console.log("ğŸ“¦ Untracked for this device:",Q[q]),Q[q]?R.value=Object.keys(Q[q].commands):R.value=[]}catch(q){console.error("Error loading untracked commands:",q),R.value=[]}},ge=()=>{R.value.length!==0&&(a.value=!0)},Ee=async()=>{a.value=!1;try{const q=r.device.device||r.device.id.split(".")[1],L=await ne.post("/api/commands/import",{device_id:r.device.id,source_device:q,commands:R.value});L.data.success&&(M.value=`Imported ${L.data.imported_count} commands successfully!`,w.value="success",await pe(),await V(),$("learned"))}catch(q){M.value=`Failed to import commands: ${q.message}`,w.value="error"}};return(q,L)=>(l(),n("div",{class:"modal-overlay",onClick:L[7]||(L[7]=he(Q=>q.$emit("cancel"),["self"]))},[e("div",Pl,[e("div",Fl,[e("h2",null,c(ee.value?"Commands for":"Learn Commands for")+" "+c(o.device.name),1),e("button",{onClick:L[0]||(L[0]=Q=>q.$emit("cancel")),class:"close-btn"},[...L[8]||(L[8]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",jl,[ee.value?(l(),n("div",Nl,[L[13]||(L[13]=e("i",{class:"mdi mdi-information"},null,-1)),e("div",null,[L[12]||(L[12]=e("h3",null,"SmartIR Device",-1)),e("p",null,[L[9]||(L[9]=I("This device uses SmartIR code file ",-1)),e("strong",null,c(o.device.device_code),1),L[10]||(L[10]=I(". Commands are pre-configured and cannot be learned.",-1))]),o.device.entity_type==="climate"?(l(),n("p",Bl,[...L[11]||(L[11]=[e("i",{class:"mdi mdi-alert-circle-outline"},null,-1),e("strong",null,"Note:",-1),I(" Climate device commands are temperature-based. Testing individual modes may not work as expected. Use the Home Assistant climate card to control your device. ",-1)])])):T("",!0)])])):(l(),n("form",{key:1,onSubmit:he(Ie,["prevent"])},[e("div",Hl,[L[14]||(L[14]=e("label",{for:"broadlink-entity"},"Broadlink Device",-1)),e("input",{id:"broadlink-entity",value:E.value,type:"text",readonly:"",disabled:""},null,8,ql),L[15]||(L[15]=e("small",null,"Commands will be learned using this device (set when device was created)",-1))]),e("div",zl,[L[18]||(L[18]=e("label",{for:"command-name"},"Command Name *",-1)),K(e("select",{id:"command-name",ref_key:"commandSelect",ref:b,"onUpdate:modelValue":L[1]||(L[1]=Q=>u.value=Q),disabled:C.value,required:"",onChange:H},[L[16]||(L[16]=e("option",{value:""},"-- Select or type command --",-1)),e("optgroup",Wl,[(l(!0),n(ve,null,ke(le.value,Q=>(l(),n("option",{key:Q,value:Q},c(Q),9,Gl))),128))]),L[17]||(L[17]=e("option",{value:"__custom__"},"Custom command...",-1))],40,Jl),[[Se,u.value]]),u.value==="__custom__"?K((l(),n("input",{key:0,ref_key:"customCommandInput",ref:v,"onUpdate:modelValue":L[2]||(L[2]=Q=>p.value=Q),type:"text",placeholder:"Enter custom command name",disabled:C.value,required:"",class:"custom-command-input",onInput:ae},null,40,Kl)),[[Le,p.value]]):T("",!0),e("small",null,"Select a suggested command for "+c(o.device.entity_type||"this device")+", or enter a custom one.",1)]),e("div",Xl,[L[21]||(L[21]=e("label",null,"Command Type",-1)),e("div",Yl,[e("label",Zl,[K(e("input",{type:"radio","onUpdate:modelValue":L[3]||(L[3]=Q=>_.value=Q),value:"ir",disabled:C.value},null,8,Ql),[[qe,_.value]]),L[19]||(L[19]=e("span",null,"IR (Infrared)",-1))]),e("label",en,[K(e("input",{type:"radio","onUpdate:modelValue":L[4]||(L[4]=Q=>_.value=Q),value:"rf",disabled:C.value},null,8,tn),[[qe,_.value]]),L[20]||(L[20]=e("span",null,"RF (Radio Frequency)",-1))])])]),e("div",on,[e("button",{type:"submit",class:"btn btn-primary btn-large",disabled:C.value},[C.value?(l(),n("i",nn)):(l(),n("i",sn)),I(" "+c(C.value?"Learning...":"Learn Command"),1)],8,ln)]),C.value?(l(),n("div",an,[L[24]||(L[24]=e("i",{class:"mdi mdi-loading mdi-spin"},null,-1)),_.value==="ir"?(l(),n("div",rn,[...L[22]||(L[22]=[e("p",null,"Point your remote at the Broadlink device and press the button...",-1),e("small",null,"This may take up to 30 seconds",-1)])])):_.value==="rf"?(l(),n("div",dn,[...L[23]||(L[23]=[e("p",null,[e("strong",null,"Learning request sent to device.")],-1),e("p",null,"RF learning is a two-step process:",-1),e("ol",null,[e("li",null,[e("strong",null,"Step 1 - Frequency Sweep (~10-15 seconds):"),I(" Press and hold the button on your remote until the notification updates.")]),e("li",null,[e("strong",null,"Step 2 - Learn Signal:"),I(" Press and release the button once.")])],-1),e("p",{class:"ha-note"},[I(" Follow the Home Assistant notifications ("),e("i",{class:"mdi mdi-bell"}),I(") for real-time instructions. ")],-1)])])):T("",!0)])):T("",!0),M.value&&w.value==="success"&&!M.value.includes("sent successfully")?(l(),n("div",un,[L[25]||(L[25]=e("i",{class:"mdi mdi-check-circle"},null,-1)),e("p",null,c(M.value),1)])):T("",!0)],32)),t.value.length>0||R.value.length>0?(l(),n("div",cn)):T("",!0),X.value?(l(),n("div",mn,[...L[26]||(L[26]=[e("div",{class:"loading-spinner"},[e("i",{class:"mdi mdi-loading mdi-spin"}),e("p",null,"Loading commands...")],-1)])])):t.value.length>0?(l(),n("div",vn,[e("h3",null,"Tracked Commands ("+c(t.value.length)+")",1),e("div",pn,[(l(!0),n(ve,null,ke(t.value,Q=>(l(),n("div",{key:Q.name,class:"command-item"},[e("div",fn,[e("span",gn,c(Q.label||Q.name),1)]),e("div",yn,[e("i",{class:"mdi mdi-check-circle learned-icon",title:`Learned (${(Q.type||"ir").toUpperCase()})`},null,8,bn),e("span",{class:Y(["command-type-badge",Q.type||"ir"])},c((Q.type||"ir").toUpperCase()),3),e("div",hn,[e("button",{type:"button",onClick:se=>Me(Q.name),class:"icon-btn",title:"Test command",disabled:z.value===Q.name},[e("i",{class:Y(["mdi mdi-play",{"mdi-spin":z.value===Q.name}])},null,2)],8,kn),e("button",{type:"button",onClick:se=>xe(Q.name),class:"icon-btn danger",title:"Delete and re-learn"},[...L[27]||(L[27]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,wn)])])]))),128))])])):T("",!0),R.value.length>0?(l(),n("div",$n,[e("h3",null,[L[28]||(L[28]=e("i",{class:"mdi mdi-alert"},null,-1)),I(" Untracked Commands ("+c(R.value.length)+") ",1)]),L[31]||(L[31]=e("p",{class:"untracked-info"}," These commands exist in Broadlink storage but are not tracked in this device. ",-1)),e("div",Cn,[(l(!0),n(ve,null,ke(R.value,Q=>(l(),n("div",{key:Q,class:"command-item untracked"},[e("span",_n,c(Q),1),L[29]||(L[29]=e("span",{class:"untracked-badge"},"Not tracked",-1))]))),128))]),e("button",{type:"button",onClick:ge,class:"btn btn-secondary"},[...L[30]||(L[30]=[e("i",{class:"mdi mdi-import"},null,-1),I(" Import All Untracked Commands ",-1)])])])):T("",!0)]),e("div",Sn,[e("button",{type:"button",onClick:L[5]||(L[5]=Q=>q.$emit("cancel")),class:"btn btn-secondary",disabled:C.value}," Close ",8,In)])]),be(Ue,{isOpen:U.value,title:"Delete Command?",message:`Delete command '${x.value}'? This will remove it from Broadlink storage.`,confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,onConfirm:d,onCancel:D},null,8,["isOpen","message"]),be(Ue,{isOpen:a.value,title:"Import Commands?",message:`Import ${R.value.length} untracked command${R.value.length>1?"s":""} into this device?`,confirmText:"Import",cancelText:"Cancel",onConfirm:Ee,onCancel:L[6]||(L[6]=Q=>a.value=!1)},null,8,["isOpen","message"])]))}},xn=we(Dn,[["__scopeId","data-v-027f5b6b"]]),Tn={class:"modal-container error-dialog"},Mn={class:"modal-header"},Rn={class:"modal-body"},Ln={class:"error-message"},An={key:0,class:"error-suggestion"},En=["open"],On={class:"debug-content"},Vn={class:"debug-info"},Un={key:0,class:"debug-section-title"},Pn={key:1},Fn={__name:"ErrorDialog",props:{isOpen:{type:Boolean,default:!1},title:{type:String,default:"Error"},message:{type:String,required:!0},suggestion:{type:String,default:""},details:{type:String,default:""},error:{type:Object,default:null},context:{type:Object,default:()=>({})}},emits:["close"],setup(o,{emit:m}){const r=o,$=m,h=Te("toast"),s=g(!1),u=()=>{$("close")},p=W(()=>{var R,X,U,x,a,b,v,O,z,ee,H;const w=new Date().toISOString(),t=r.error||{};return{error:JSON.stringify({message:r.message,title:r.title,details:r.details,errorObject:t.message||t.toString(),timestamp:w},null,2),request:JSON.stringify({method:((X=(R=t.config)==null?void 0:R.method)==null?void 0:X.toUpperCase())||"N/A",url:((U=t.config)==null?void 0:U.url)||"N/A",baseURL:((x=t.config)==null?void 0:x.baseURL)||"N/A",headers:((a=t.config)==null?void 0:a.headers)||{},data:(b=t.config)!=null&&b.data?JSON.parse(t.config.data):"N/A",params:((v=t.config)==null?void 0:v.params)||{}},null,2),response:JSON.stringify({status:((O=t.response)==null?void 0:O.status)||"N/A",statusText:((z=t.response)==null?void 0:z.statusText)||"N/A",data:((ee=t.response)==null?void 0:ee.data)||"N/A",headers:((H=t.response)==null?void 0:H.headers)||{}},null,2),browser:JSON.stringify({userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language,cookieEnabled:navigator.cookieEnabled,onLine:navigator.onLine,viewport:`${window.innerWidth}x${window.innerHeight}`,screenResolution:`${window.screen.width}x${window.screen.height}`,colorDepth:window.screen.colorDepth,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,timestamp:w},null,2),appState:JSON.stringify({currentRoute:window.location.pathname,currentURL:window.location.href,referrer:document.referrer||"N/A",context:r.context||{},localStorage:{smartir_simulate:localStorage.getItem("smartir_simulate_not_installed"),theme:localStorage.getItem("theme")}},null,2),stackTrace:t.stack||null}}),_=async()=>{const w=M();try{await navigator.clipboard.writeText(w),h==null||h.success("Debug information copied to clipboard","âœ… Copied")}catch(t){console.error("Failed to copy:",t),h==null||h.error("Failed to copy to clipboard","âŒ Copy Failed")}},C=()=>{const w=M(),t=new Blob([w],{type:"text/plain"}),R=URL.createObjectURL(t),X=document.createElement("a");X.href=R;const U=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5);X.download=`broadlink-manager-error-${U}.txt`,document.body.appendChild(X),X.click(),document.body.removeChild(X),URL.revokeObjectURL(R),h==null||h.success("Debug report downloaded","âœ… Downloaded")},M=()=>`Broadlink Manager - Error Report
${"=".repeat(60)}

Generated: ${new Date().toISOString()}
Title: ${r.title}
Message: ${r.message}
${r.suggestion?`Suggestion: ${r.suggestion}
`:""}
${"=".repeat(60)}

ERROR DETAILS
${"-".repeat(60)}
${p.value.error}

REQUEST INFORMATION
${"-".repeat(60)}
${p.value.request}

RESPONSE INFORMATION
${"-".repeat(60)}
${p.value.response}

BROWSER INFORMATION
${"-".repeat(60)}
${p.value.browser}

APPLICATION STATE
${"-".repeat(60)}
${p.value.appState}

${p.value.stackTrace?`STACK TRACE
${"-".repeat(60)}
${p.value.stackTrace}

`:""}
${"=".repeat(60)}
End of Report
`;return de(()=>r.isOpen,w=>{if(w){const t=R=>{R.key==="Escape"&&u()};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)}}),(w,t)=>(l(),Oe(ot,{to:"body"},[be(et,{name:"modal"},{default:Ke(()=>[o.isOpen?(l(),n("div",{key:0,class:"modal-overlay",onClick:he(u,["self"])},[e("div",Tn,[e("div",Mn,[t[2]||(t[2]=e("div",{class:"header-icon error-icon"},[e("i",{class:"mdi mdi-alert-circle"})],-1)),e("h3",null,c(o.title),1),e("button",{onClick:u,class:"close-button"},[...t[1]||(t[1]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Rn,[e("p",Ln,c(o.message),1),o.suggestion?(l(),n("p",An,[t[3]||(t[3]=e("i",{class:"mdi mdi-lightbulb-on"},null,-1)),I(" "+c(o.suggestion),1)])):T("",!0),e("details",{class:"debug-section",open:s.value},[e("summary",{onClick:t[0]||(t[0]=R=>s.value=!s.value)},[e("i",{class:Y(["mdi",s.value?"mdi-chevron-down":"mdi-chevron-right"])},null,2),t[4]||(t[4]=I(" Debug Information ",-1))]),e("div",On,[e("div",{class:"debug-actions"},[e("button",{onClick:_,class:"btn-debug btn-copy"},[...t[5]||(t[5]=[e("i",{class:"mdi mdi-content-copy"},null,-1),I(" Copy to Clipboard ",-1)])]),e("button",{onClick:C,class:"btn-debug btn-download"},[...t[6]||(t[6]=[e("i",{class:"mdi mdi-download"},null,-1),I(" Download Report ",-1)])])]),e("div",Vn,[t[7]||(t[7]=e("div",{class:"debug-section-title"},"Error Details",-1)),e("pre",null,c(p.value.error),1),t[8]||(t[8]=e("div",{class:"debug-section-title"},"Request Information",-1)),e("pre",null,c(p.value.request),1),t[9]||(t[9]=e("div",{class:"debug-section-title"},"Response Information",-1)),e("pre",null,c(p.value.response),1),t[10]||(t[10]=e("div",{class:"debug-section-title"},"Browser Information",-1)),e("pre",null,c(p.value.browser),1),t[11]||(t[11]=e("div",{class:"debug-section-title"},"Application State",-1)),e("pre",null,c(p.value.appState),1),p.value.stackTrace?(l(),n("div",Un,"Stack Trace")):T("",!0),p.value.stackTrace?(l(),n("pre",Pn,c(p.value.stackTrace),1)):T("",!0)])])],8,En)]),e("div",{class:"modal-footer"},[e("button",{onClick:u,class:"btn btn-primary"}," OK ")])])])):T("",!0)]),_:1})]))}},jn=we(Fn,[["__scopeId","data-v-23858149"]]),Nn={key:0,class:"discovery-banner"},Bn={class:"banner-content"},Hn={class:"banner-text"},qn={class:"modal-dialog"},zn={class:"modal-header"},Jn={class:"modal-body"},Wn={class:"device-list"},Gn={class:"device-info"},Kn={class:"device-details"},Xn={class:"command-count"},Yn={class:"device-actions"},Zn=["onClick"],Qn=["onClick"],es={class:"modal-footer"},ts={class:"modal-dialog modal-dialog-small"},os={class:"modal-header"},ls={class:"modal-body"},ns={class:"warning-message"},ss={class:"modal-footer"},as=["disabled"],is=["disabled"],rs={__name:"DeviceDiscovery",emits:["adopt"],setup(o,{expose:m,emit:r}){const $=je(),h=r,s=g([]),u=g(!1),p=g(!1),_=g(null),C=g(!1),M=W(()=>s.value.length>0);Ae(async()=>{await w()});const w=async()=>{try{const U=await ne.get("/api/devices/discover");s.value=U.data.untracked_devices||[]}catch(U){console.error("Error loading untracked devices:",U),s.value=[]}},t=U=>{u.value=!1,h("adopt",U)},R=U=>{_.value=U,p.value=!0},X=async()=>{if(_.value){C.value=!0;try{const U=await ne.delete(`/api/devices/untracked/${encodeURIComponent(_.value.device_name)}`);if(U.data.success)s.value=s.value.filter(x=>x.device_name!==_.value.device_name),p.value=!1,_.value=null,console.log("Device deleted successfully");else throw new Error(U.data.error||"Failed to delete device")}catch(U){console.error("Error deleting device:",U),$.error(`Failed to delete device: ${U.message}`)}finally{C.value=!1}}};return m({refresh:w}),(U,x)=>{var a,b,v;return M.value?(l(),n("div",Nn,[e("div",Bn,[x[9]||(x[9]=e("div",{class:"banner-icon"},[e("i",{class:"mdi mdi-radar"})],-1)),e("div",Hn,[x[7]||(x[7]=e("h3",null,"Untracked Devices Found",-1)),e("p",null,c(s.value.length)+" device"+c(s.value.length>1?"s":"")+" with learned commands found in Broadlink storage",1)]),e("button",{onClick:x[0]||(x[0]=O=>u.value=!0),class:"btn btn-primary"},[...x[8]||(x[8]=[e("i",{class:"mdi mdi-eye"},null,-1),I(" View Devices ",-1)])])]),u.value?(l(),n("div",{key:0,class:"modal-overlay",onClick:x[3]||(x[3]=he(O=>u.value=!1,["self"]))},[e("div",qn,[e("div",zn,[x[11]||(x[11]=e("h2",null,"Discovered Devices",-1)),e("button",{onClick:x[1]||(x[1]=O=>u.value=!1),class:"close-btn"},[...x[10]||(x[10]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Jn,[x[16]||(x[16]=e("p",{class:"info-text"}," These devices have learned commands in Broadlink storage but are not being tracked. Adopt them to manage their commands and generate Home Assistant entities. ",-1)),e("div",Wn,[(l(!0),n(ve,null,ke(s.value,O=>(l(),n("div",{key:O.device_name,class:"discovered-device"},[e("div",Gn,[x[13]||(x[13]=e("div",{class:"device-icon"},[e("i",{class:"mdi mdi-devices"})],-1)),e("div",Kn,[e("h4",null,c(O.device_name),1),e("span",Xn,[x[12]||(x[12]=e("i",{class:"mdi mdi-remote"},null,-1)),I(" "+c(O.command_count)+" command"+c(O.command_count>1?"s":""),1)])])]),e("div",Yn,[e("button",{onClick:z=>t(O),class:"btn btn-primary"},[...x[14]||(x[14]=[e("i",{class:"mdi mdi-plus"},null,-1),I(" Adopt ",-1)])],8,Zn),e("button",{onClick:z=>R(O),class:"btn btn-danger",title:"Delete all commands"},[...x[15]||(x[15]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,Qn)])]))),128))])]),e("div",es,[e("button",{onClick:x[2]||(x[2]=O=>u.value=!1),class:"btn btn-secondary"}," Close ")])])])):T("",!0),p.value?(l(),n("div",{key:1,class:"modal-overlay",onClick:x[6]||(x[6]=he(O=>p.value=!1,["self"]))},[e("div",ts,[e("div",os,[x[18]||(x[18]=e("h2",null,"Delete Untracked Device",-1)),e("button",{onClick:x[4]||(x[4]=O=>p.value=!1),class:"close-btn"},[...x[17]||(x[17]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",ls,[e("div",ns,[x[20]||(x[20]=e("i",{class:"mdi mdi-alert"},null,-1)),e("div",null,[e("p",null,[e("strong",null,'Are you sure you want to delete "'+c((a=_.value)==null?void 0:a.device_name)+'"?',1)]),e("p",null,"This will permanently delete all "+c((b=_.value)==null?void 0:b.command_count)+" command"+c(((v=_.value)==null?void 0:v.command_count)>1?"s":"")+" from Broadlink storage.",1),x[19]||(x[19]=e("p",{class:"warning-text"},"This action cannot be undone.",-1))])])]),e("div",ss,[e("button",{onClick:x[5]||(x[5]=O=>p.value=!1),class:"btn btn-secondary",disabled:C.value}," Cancel ",8,as),e("button",{onClick:X,class:"btn btn-danger",disabled:C.value},[e("i",{class:Y(["mdi",C.value?"mdi-loading mdi-spin":"mdi-delete"])},null,2),I(" "+c(C.value?"Deleting...":"Delete"),1)],8,is)])])])):T("",!0)])):T("",!0)}}},ds=we(rs,[["__scopeId","data-v-cbf02c76"]]),us={class:"device-list-card"},cs={class:"card-header"},ms={class:"header-badges"},vs={class:"header-info"},ps={class:"header-right"},fs={class:"settings-menu-container"},gs=["disabled"],ys=["disabled"],bs={class:"card-body"},hs={key:0,class:"filter-bar"},ks={class:"filter-search-row"},ws=["title"],$s={key:0,class:"filter-badge"},Cs={class:"search-input-wrapper"},_s={class:"filter-content"},Ss={class:"filter-row filter-row-dropdowns"},Is={class:"filter-group"},Ds=["value"],xs={class:"filter-group"},Ts=["value"],Ms={class:"filter-group"},Rs={key:0,class:"filter-group filter-toggle"},Ls={class:"toggle-label"},As={key:2,class:"view-toggle-group"},Es={class:"filter-results"},Os={key:1,class:"loading-state"},Vs={key:2,class:"error-state"},Us={key:3,class:"empty-state"},Ps={key:4,class:"device-grid"},Fs={key:6,class:"no-results"},js={__name:"DeviceList",setup(o){const m=vt(),r=je(),{isMobile:$}=Xe(),h=g(!1),s=g(!1),u=g(null),p=g(!1),_=g(!1),C=g(null),M=g(null),w=g(!0),t=g(!1),R=g(!1),U=g(window.innerWidth<=767?"grid":localStorage.getItem("device_view_mode")||"grid");de($,S=>{S&&U.value==="list"&&(U.value="grid")}),de(U,S=>{localStorage.setItem("device_view_mode",S)});const x=()=>{w.value=!w.value},a=()=>{w.value||(w.value=!0),_.value=!_.value},b=g(!1),v=g({title:"Error",message:"",suggestion:"",details:"",error:null,context:{}}),O=g(!1),z=g({success:!1,title:"",message:""}),ee=g(!1),H=g({search:"",broadlinkDevice:"",area:"",entityType:"",showSmartIROnly:!1}),ae=g([]),E=Te("smartirStatus"),j=Te("smartirEnabled"),le=W(()=>{var k;return localStorage.getItem("smartir_simulate_not_installed")==="true"?!1:((k=E==null?void 0:E.value)==null?void 0:k.installed)||!1}),ce=W(()=>{const S=new Map;return m.devices.forEach(k=>{if(k.broadlink_entity){const F=ae.value.find(oe=>oe.entity_id===k.broadlink_entity),J=F&&F.name||k.broadlink_entity;S.set(k.broadlink_entity,{entity_id:k.broadlink_entity,friendly_name:J})}}),Array.from(S.values()).sort((k,F)=>k.friendly_name.localeCompare(F.friendly_name))}),pe=W(()=>{const S=new Set;return m.devices.forEach(k=>{k.area&&S.add(k.area)}),Array.from(S).sort()}),Ie=W(()=>{let S=m.devices;if(H.value.search){const F=H.value.search.toLowerCase();S=S.filter(J=>{var me,re,_e,Ve,Ne;if((me=J.name)!=null&&me.toLowerCase().includes(F)||(re=J.entity_type)!=null&&re.toLowerCase().includes(F)||(_e=J.area)!=null&&_e.toLowerCase().includes(F)||(Ve=J.id)!=null&&Ve.toLowerCase().includes(F)||Object.keys(J.commands||{}).some(We=>We.toLowerCase().includes(F)))return!0;const ye=ae.value.find(We=>We.entity_id===J.broadlink_entity);return!!((Ne=ye==null?void 0:ye.name)!=null&&Ne.toLowerCase().includes(F))})}H.value.broadlinkDevice&&(S=S.filter(F=>F.broadlink_entity===H.value.broadlinkDevice||F.controller_device===H.value.broadlinkDevice)),H.value.area&&(S=S.filter(F=>F.area===H.value.area)),H.value.entityType&&(S=S.filter(F=>F.entity_type===H.value.entityType)),H.value.showSmartIROnly&&(S=S.filter(F=>F.device_type==="smartir"));const k=localStorage.getItem("smartir_simulate_not_installed")==="true";return(!(j!=null&&j.value)||k)&&(S=S.filter(F=>F.device_type!=="smartir")),S}),Me=W(()=>H.value.search||H.value.broadlinkDevice||H.value.area||H.value.entityType||H.value.showSmartIROnly),xe=W(()=>{let S=0;return H.value.search&&S++,H.value.broadlinkDevice&&S++,H.value.area&&S++,H.value.entityType&&S++,H.value.showSmartIROnly&&S++,S}),D=()=>{H.value.search="",H.value.broadlinkDevice="",H.value.area="",H.value.entityType="",H.value.showSmartIROnly=!1},d=async()=>{try{const S=await ne.get("/api/remote/devices");ae.value=S.data.devices||[]}catch(S){console.error("Error loading remote devices:",S)}};de(U,S=>{localStorage.setItem("device_view_mode",S)}),Ae(async()=>{await Promise.all([m.loadDevices(),d()])});const V=S=>{u.value=S,h.value=!0},ge=W(()=>{if(!C.value)return"";const S=Object.keys(C.value.commands||{}).length;return S===0?"This device has no commands. The device will be removed from tracking.":`This device has ${S} learned command${S>1?"s":""}. What would you like to do?`}),Ee=W(()=>{if(!C.value)return"";const S=Object.keys(C.value.commands||{}).length;return S===0?"":`Also delete all ${S} command${S>1?"s":""} from Broadlink storage`}),q=S=>{C.value=S,p.value=!0},L=()=>{p.value=!1,C.value=null},Q=async S=>{var F,J;const k=C.value;p.value=!1;try{await m.deleteDevice(k.id,S),M.value&&await M.value.refresh()}catch(oe){const ye=((J=(F=oe.response)==null?void 0:F.data)==null?void 0:J.error)||oe.message||"Unknown error";B("Failed to Delete Device",ye)}finally{C.value=null}},se=async S=>{var k,F,J,oe,ye;try{console.log("ğŸ’¾ Saving device data:",S),console.log("ğŸ’¾ Device commands:",S.commands),console.log("ğŸ’¾ Selected device:",u.value),(k=u.value)!=null&&k.id&&u.value.id!==null?await m.updateDevice(u.value.id,S):await m.createDevice(S),G(),M.value&&await M.value.refresh()}catch(me){let re="Failed to save device",_e="",Ve="";(J=(F=me.response)==null?void 0:F.data)!=null&&J.error?(re=me.response.data.error,_e=me.response.data.suggestion||""):me.message&&(re=me.message),me.response&&(Ve=`Status: ${me.response.status}
URL: ${((oe=me.config)==null?void 0:oe.url)||"N/A"}`),B("Failed to Save Device",re,_e,Ve,me,{action:"save_device",deviceData:S,isEdit:!!((ye=u.value)!=null&&ye.id)})}},G=()=>{h.value=!1,u.value=null},f=S=>{u.value=S,s.value=!0},y=()=>{s.value=!1,u.value=null},B=(S,k,F="",J="",oe=null,ye={})=>{v.value={title:S,message:k,suggestion:F,details:J,error:oe,context:ye},b.value=!0},te=()=>{b.value=!1},A=()=>{O.value=!1},i=async S=>{if(S&&S.commands&&u.value){const k=m.devices.findIndex(F=>F.id===u.value.id);k!==-1&&(m.devices[k].commands=S.commands,console.log(`Optimistically updated device ${u.value.id} with new command: ${S.commandName}`))}m.loadDevices(),M.value&&M.value.refresh()},P=S=>{const k=S.split("_"),F=[];for(let J=0;J<k.length;J++){const oe=k[J],ye=k[J+1];oe&&ye==="s"&&k[J+2]?(F.push(oe.charAt(0).toUpperCase()+oe.slice(1)+"'s"),J++):oe!=="s"&&F.push(oe.charAt(0).toUpperCase()+oe.slice(1))}return F.join(" ")},Z=(S,k)=>{const F=S.toLowerCase(),J=k.map(re=>re.toLowerCase());return F.includes("lamp")||F.includes("light")?"light":F.includes("fan")?"fan":F.includes("tv")||F.includes("stereo")||F.includes("speaker")||F.includes("receiver")?"media_player":F.includes("blind")||F.includes("curtain")||F.includes("shade")||F.includes("garage")?"cover":J.some(re=>re.includes("volume")||re.includes("channel")||re.includes("play")||re.includes("pause")||re.includes("mute"))?"media_player":J.some(re=>re.includes("fan_speed")||re.includes("fan_low")||re.includes("fan_high"))?"fan":J.some(re=>re.includes("open")||re.includes("close")||re.includes("stop"))?"cover":"switch"},ie=(S,k)=>{const F=S.toLowerCase();return F.includes("tv")?"mdi:television":F.includes("stereo")||F.includes("receiver")||F.includes("speaker")?"mdi:speaker":F.includes("lamp")?"mdi:lamp":F.includes("light")?"mdi:lightbulb":F.includes("fan")?"mdi:fan":F.includes("blind")?"mdi:blinds":F.includes("curtain")?"mdi:curtains":F.includes("garage")?"mdi:garage":{light:"mdi:lightbulb",fan:"mdi:fan",switch:"mdi:light-switch",media_player:"mdi:speaker",cover:"mdi:window-shutter"}[k]||"mdi:devices"},ue=S=>{const k=S.toLowerCase().split("_");for(let oe=0;oe<k.length-2;oe++)if(k[oe+1]==="s"){const ye=k.slice(oe,oe+3),me=P(ye.join("_"));return console.log("Detected possessive area:",me,"from",S),me}const F=[["living","room"],["dining","room"],["master","bedroom"],["guest","bedroom"],["family","room"],["laundry","room"],["home","office"]];for(let oe=0;oe<k.length-1;oe++){const ye=[k[oe],k[oe+1]],me=F.find(re=>re[0]===ye[0]&&re[1]===ye[1]);if(me)return P(me.join("_"))}const J=["kitchen","bedroom","bathroom","garage","office","basement","attic","hallway","entryway","patio","deck","yard","garden"];for(const oe of k)if(J.includes(oe))return oe.charAt(0).toUpperCase()+oe.slice(1);return""},N=async S=>{const k=P(S.device_name),F=ue(S.device_name),J=Z(S.device_name,S.commands),oe=ie(S.device_name,J);let ye="";try{console.log("Finding Broadlink owner for:",S.device_name);const re=await ne.post("/api/devices/find-broadlink-owner",{device_name:S.device_name});console.log("Broadlink owner response:",re.data),ye=re.data.broadlink_entity||"",console.log("Detected Broadlink entity:",ye)}catch(re){console.error("Error finding Broadlink owner:",re)}u.value={id:null,device:S.device_name,name:k,entity_type:J,commands:{},area:F,icon:oe,broadlink_entity:ye,enabled:!0};const me={};S.commands.forEach(re=>{me[re]=re}),u.value.commands=me,h.value=!0},De=async()=>{R.value=!0;try{await m.syncAllAreas(),r.success("Areas synced from Home Assistant")}catch(S){console.error("Error syncing areas:",S),r.error("Failed to sync areas")}finally{R.value=!1}},Ce=async()=>{var S,k;t.value=!0;try{const F=await ne.post("/api/entities/generate",{});if(F.data.success){const J=F.data.broadlink_count||0,oe=F.data.smartir_count||0,ye=F.data.total_count||0,me=F.data.errors||[];let re="âœ… Entity Generation Successful",_e=[];const Ve=[];J>0&&Ve.push(`${J} Broadlink native`),oe>0&&Ve.push(`${oe} SmartIR`),Ve.length>0&&_e.push(`Generated ${Ve.join(" and ")} entity configuration${ye!==1?"s":""}.`),J>0&&(_e.push(`
ğŸ“ Broadlink entities created in:`),_e.push("  â€¢ broadlink_manager/entities.yaml"),_e.push("  â€¢ broadlink_manager/helpers.yaml")),oe>0&&(_e.push(`
ğŸ“ SmartIR entities created in:`),_e.push("  â€¢ smartir/climate.yaml"),_e.push("  â€¢ smartir/media_player.yaml"),_e.push("  â€¢ smartir/fan.yaml")),_e.push(`
ğŸ“ Next steps:`),_e.push("1. Check your configuration.yaml includes the generated files"),_e.push("2. Restart Home Assistant to load the new entities"),me.length>0&&(re="âš ï¸ Entity Generation Completed with Errors",_e.push(`
âš ï¸ ${me.length} error${me.length!==1?"s":""} occurred:`),me.forEach(Ne=>{_e.push(`  â€¢ ${Ne}`)})),z.value={success:!0,title:re,message:_e.join(`
`)},O.value=!0}else z.value={success:!1,title:"âŒ Entity Generation Failed",message:F.data.message||`Failed to generate entities.

Please check that you have at least one device configured.`},O.value=!0}catch(F){console.error("Error generating entities:",F);const J=((k=(S=F.response)==null?void 0:S.data)==null?void 0:k.error)||F.message||"Unknown error occurred";z.value={success:!1,title:"âŒ Entity Generation Error",message:`Failed to generate entities:

${J}

Please check the logs for more details.`},O.value=!0}finally{t.value=!1}},Re=async({device:S,command:k})=>{var F,J;try{const oe={device_id:S.id,command:k,entity_id:S.broadlink_entity,device:S.device};await ne.post("/api/commands/test",oe),r.success(`Sent ${k} to ${S.name}`)}catch(oe){console.error("Error sending command:",oe);const ye=((J=(F=oe.response)==null?void 0:F.data)==null?void 0:J.error)||oe.message||"Unknown error";r.error(`Failed to send ${k}: ${ye}`)}};return(S,k)=>{var F;return l(),n("div",us,[e("div",cs,[e("button",{class:"icon-button chevron-button",onClick:x},[e("i",{class:Y(["mdi",w.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2)]),e("div",{class:"header-left",onClick:x},[k[14]||(k[14]=e("div",{class:"header-icon"},[e("i",{class:"mdi mdi-devices"})],-1)),e("h3",null,c($e($)?"Devices":"Managed Devices"),1),e("div",ms,[e("span",vs,c($e(m).deviceCount)+" devices",1)])]),e("div",ps,[e("button",{onClick:k[0]||(k[0]=he(J=>h.value=!0,["stop"])),class:"btn btn-primary new-button"},[...k[15]||(k[15]=[e("i",{class:"mdi mdi-plus"},null,-1),e("span",null,"New",-1)])]),e("div",fs,[e("button",{onClick:he(a,["stop"]),class:Y(["icon-button settings-button",{active:_.value}]),title:"Settings"},[...k[16]||(k[16]=[e("i",{class:"mdi mdi-cog"},null,-1)])],2),_.value?(l(),n("div",{key:0,class:"settings-dropdown",onClick:k[3]||(k[3]=he(()=>{},["stop"]))},[e("button",{onClick:k[1]||(k[1]=J=>{De(),_.value=!1}),class:"menu-item",disabled:R.value},[e("i",{class:Y(["mdi",R.value?"mdi-loading mdi-spin":"mdi-refresh"])},null,2),e("span",null,c(R.value?"Syncing Areas...":"Sync Areas"),1)],8,gs),e("button",{onClick:k[2]||(k[2]=J=>{Ce(),_.value=!1}),class:"menu-item",disabled:t.value},[e("i",{class:Y(["mdi",t.value?"mdi-loading mdi-spin":"mdi-file-code"])},null,2),e("span",null,c(t.value?"Generating...":"Generate Entities"),1)],8,ys)])):T("",!0)])])]),K(e("div",bs,[be(ds,{ref_key:"discoveryRef",ref:M,onAdopt:N},null,512),$e(m).hasDevices?(l(),n("div",hs,[e("div",ks,[e("button",{class:Y(["filter-toggle-button",{active:ee.value||Me.value}]),onClick:k[4]||(k[4]=J=>ee.value=!ee.value),title:ee.value?"Hide filters":"Show filters"},[k[17]||(k[17]=e("i",{class:"mdi mdi-filter-variant"},null,-1)),Me.value?(l(),n("span",$s,c(xe.value),1)):T("",!0)],10,ws),e("div",Cs,[k[18]||(k[18]=e("i",{class:"mdi mdi-magnify search-icon"},null,-1)),K(e("input",{"onUpdate:modelValue":k[5]||(k[5]=J=>H.value.search=J),type:"text",placeholder:"Search devices, commands...",class:"search-input"},null,512),[[Le,H.value.search]])])]),K(e("div",_s,[e("div",Ss,[e("div",Is,[e("label",null,[k[20]||(k[20]=e("i",{class:"mdi mdi-access-point"},null,-1)),K(e("select",{"onUpdate:modelValue":k[6]||(k[6]=J=>H.value.broadlinkDevice=J)},[k[19]||(k[19]=e("option",{value:""},"All Controller Devices",-1)),(l(!0),n(ve,null,ke(ce.value,J=>(l(),n("option",{key:J.entity_id,value:J.entity_id},c(J.friendly_name),9,Ds))),128))],512),[[Se,H.value.broadlinkDevice]])])]),e("div",xs,[e("label",null,[k[22]||(k[22]=e("i",{class:"mdi mdi-home-map-marker"},null,-1)),K(e("select",{"onUpdate:modelValue":k[7]||(k[7]=J=>H.value.area=J)},[k[21]||(k[21]=e("option",{value:""},"All Areas",-1)),(l(!0),n(ve,null,ke(pe.value,J=>(l(),n("option",{key:J,value:J},c(J),9,Ts))),128))],512),[[Se,H.value.area]])])]),e("div",Ms,[e("label",null,[k[24]||(k[24]=e("i",{class:"mdi mdi-shape"},null,-1)),K(e("select",{"onUpdate:modelValue":k[8]||(k[8]=J=>H.value.entityType=J)},[...k[23]||(k[23]=[Pe('<option value="" data-v-ea9f63f1>All Types</option><option value="light" data-v-ea9f63f1>Light</option><option value="fan" data-v-ea9f63f1>Fan</option><option value="switch" data-v-ea9f63f1>Switch</option><option value="media_player" data-v-ea9f63f1>Media Player</option><option value="cover" data-v-ea9f63f1>Cover</option><option value="climate" data-v-ea9f63f1>Climate</option>',7)])],512),[[Se,H.value.entityType]])])]),le.value?(l(),n("div",Rs,[e("label",Ls,[k[25]||(k[25]=e("span",{class:"toggle-text"},[e("img",{src:Ye,alt:"SmartIR",class:"smartir-icon"}),I(" SmartIR Only ")],-1)),K(e("input",{type:"checkbox","onUpdate:modelValue":k[9]||(k[9]=J=>H.value.showSmartIROnly=J),class:"toggle-checkbox"},null,512),[[fe,H.value.showSmartIROnly]]),k[26]||(k[26]=e("span",{class:"toggle-slider"},null,-1))])])):T("",!0),Me.value?(l(),n("button",{key:1,onClick:D,class:"btn-clear-filters"},[...k[27]||(k[27]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),I(" Clear ",-1)])])):T("",!0),$e($)?T("",!0):(l(),n("div",As,[e("button",{onClick:k[10]||(k[10]=J=>U.value="grid"),class:Y(["view-toggle-btn",{active:U.value==="grid"}]),title:"Grid View"},[...k[28]||(k[28]=[e("i",{class:"mdi mdi-view-grid"},null,-1),I(" Grid ",-1)])],2),e("button",{onClick:k[11]||(k[11]=J=>U.value="list"),class:Y(["view-toggle-btn",{active:U.value==="list"}]),title:"List View"},[...k[29]||(k[29]=[e("i",{class:"mdi mdi-view-list"},null,-1),I(" List ",-1)])],2)])),e("div",Es,c(Ie.value.length)+" of "+c($e(m).deviceCount),1)])],512),[[ze,ee.value]])])):T("",!0),$e(m).loading?(l(),n("div",Os,[...k[30]||(k[30]=[e("i",{class:"mdi mdi-loading mdi-spin"},null,-1),e("p",null,"Loading devices...",-1)])])):$e(m).error?(l(),n("div",Vs,[k[31]||(k[31]=e("i",{class:"mdi mdi-alert-circle"},null,-1)),e("p",null,c($e(m).error),1),e("button",{onClick:k[12]||(k[12]=J=>$e(m).loadDevices()),class:"btn btn-secondary"}," Retry ")])):$e(m).hasDevices?T("",!0):(l(),n("div",Us,[k[33]||(k[33]=e("i",{class:"mdi mdi-devices"},null,-1)),k[34]||(k[34]=e("h3",null,"No Devices Yet",-1)),k[35]||(k[35]=e("p",null,"Get started by adding your first managed device",-1)),e("button",{onClick:k[13]||(k[13]=J=>h.value=!0),class:"btn btn-primary"},[...k[32]||(k[32]=[e("i",{class:"mdi mdi-plus"},null,-1),I(" Add Your First Device ",-1)])])])),U.value==="grid"?(l(),n("div",Ps,[(l(!0),n(ve,null,ke(Ie.value,J=>(l(),Oe(Vt,{key:J.id,device:J,"broadlink-devices":ae.value,onEdit:V,onDelete:q,onLearn:f},null,8,["device","broadlink-devices"]))),128))])):U.value==="list"&&Ie.value.length>0?(l(),Oe(to,{key:5,devices:Ie.value,onSendCommand:Re,onEditDevice:V,onDeleteDevice:q},null,8,["devices"])):T("",!0),$e(m).hasDevices&&Ie.value.length===0?(l(),n("div",Fs,[...k[36]||(k[36]=[e("i",{class:"mdi mdi-filter-off"},null,-1),e("h3",null,"No devices match your filters",-1),e("p",null,"Try adjusting your search or filter criteria",-1)])])):T("",!0)],512),[[ze,w.value]]),h.value?(l(),Oe(Ml,{key:0,device:u.value,onSave:se,onCancel:G},null,8,["device"])):T("",!0),s.value?(l(),Oe(xn,{key:1,device:u.value,onLearned:i,onCancel:y},null,8,["device"])):T("",!0),be(Ue,{isOpen:p.value,title:`Delete ${(F=C.value)==null?void 0:F.name}?`,message:ge.value,confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,checkboxLabel:Ee.value,onConfirm:Q,onCancel:L},null,8,["isOpen","title","message","checkboxLabel"]),be(jn,{isOpen:b.value,title:v.value.title,message:v.value.message,suggestion:v.value.suggestion,details:v.value.details,error:v.value.error,context:v.value.context,onClose:te},null,8,["isOpen","title","message","suggestion","details","error","context"]),be(Ue,{isOpen:O.value,title:z.value.title,message:z.value.message,confirmText:"OK",showCancel:!1,dangerMode:!z.value.success,onConfirm:A,onCancel:A},null,8,["isOpen","title","message","dangerMode"])])}}},Ns=we(js,[["__scopeId","data-v-ea9f63f1"]]),Bs={class:"banner-content"},Hs={class:"banner-icon"},qs={class:"banner-message"},zs={class:"banner-actions"},Js={__name:"SmartIRBanner",setup(o){const m=Te("smartirStatus"),r=g(!1),$=W(()=>!(!m.value||r.value||localStorage.getItem("smartir_banner_dismissed")==="true")),h=W(()=>{var M;return(M=m.value)!=null&&M.installed?"banner-success":"banner-info"}),s=W(()=>{var M;return(M=m.value)!=null&&M.installed?"mdi mdi-check-circle":"mdi mdi-information"}),u=W(()=>{var M;return(M=m.value)!=null&&M.installed?`SmartIR Detected (v${m.value.version})`:"Want Climate Device Support?"}),p=W(()=>{var M;return(M=m.value)!=null&&M.installed?"You can now create climate device profiles with full temperature and HVAC mode control.":"Install SmartIR to unlock AC/heater control with temperature settings, HVAC modes, and 120+ pre-configured device profiles."});function _(){window.open("https://github.com/smartHomeHub/SmartIR","_blank")}function C(){var M;if(r.value=!0,(M=m.value)!=null&&M.installed)localStorage.setItem("smartir_banner_dismissed","true");else{const w=parseInt(localStorage.getItem("smartir_banner_dismiss_count")||"0");w>=2?localStorage.setItem("smartir_banner_dismissed","true"):localStorage.setItem("smartir_banner_dismiss_count",String(w+1))}}return Ae(()=>{var t;const M=localStorage.getItem("smartir_last_status"),w=(t=m.value)!=null&&t.installed?"installed":"not_installed";M!==w&&(localStorage.removeItem("smartir_banner_dismissed"),localStorage.removeItem("smartir_banner_dismiss_count"),localStorage.setItem("smartir_last_status",w))}),(M,w)=>{var t,R;return $.value?(l(),n("div",{key:0,class:Y(["smartir-banner",h.value])},[e("div",Bs,[e("div",Hs,[e("i",{class:Y(s.value)},null,2)]),e("div",qs,[e("strong",null,c(u.value),1),e("p",null,c(p.value),1)]),e("div",zs,[(t=M.status)!=null&&t.installed?T("",!0):(l(),n("button",{key:0,onClick:_,class:"btn-primary"}," Learn More ")),e("button",{onClick:C,class:"btn-text"},c((R=M.status)!=null&&R.installed?"Got it":"Dismiss"),1)])])],2)):T("",!0)}}},Ws=we(Js,[["__scopeId","data-v-7bbcbcd7"]]),Fe="api/smartir",nt={async getStatus(){try{const o=await fetch(`${Fe}/status`);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return await o.json()}catch(o){return console.error("Error fetching SmartIR status:",o),{installed:!1,version:null,error:o.message}}},async getInstallInstructions(){try{const o=await fetch(`${Fe}/install-instructions`);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return await o.json()}catch(o){throw console.error("Error fetching install instructions:",o),o}},async getPlatforms(){try{const o=await fetch(`${Fe}/platforms`);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return await o.json()}catch(o){throw console.error("Error fetching platforms:",o),o}},async getPlatformCodes(o){try{const m=await fetch(`${Fe}/platforms/${o}/codes`);if(!m.ok)throw new Error(`HTTP error! status: ${m.status}`);return await m.json()}catch(m){throw console.error(`Error fetching codes for ${o}:`,m),m}},async getNextCode(o){try{const m=await fetch(`${Fe}/platforms/${o}/next-code`);if(!m.ok)throw new Error(`HTTP error! status: ${m.status}`);return await m.json()}catch(m){throw console.error(`Error fetching next code for ${o}:`,m),m}},async validateCode(o,m){try{const r=await fetch(`${Fe}/validate-code`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({platform:o,code:m})});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);return await r.json()}catch(r){throw console.error("Error validating code:",r),r}}},Gs={class:"profile-card"},Ks={class:"profile-card-header"},Xs=["title"],Ys={class:"profile-details"},Zs=["title"],Qs={class:"profile-meta"},ea=["title"],ta=["title"],oa=["title"],la={class:"profile-card-footer"},na=["title"],sa={key:0,class:"learned-indicator"},aa={class:"profile-actions"},ia={__name:"SmartIRProfileCard",props:{profile:{type:Object,required:!0}},emits:["edit","download","delete","commands"],setup(o){const m=o,r=lt(W(()=>m.profile.platform)),$=u=>u.replace(/_/g," ").replace(/\b\w/g,p=>p.toUpperCase()),h=u=>u&&u.startsWith("mdi:")?`mdi ${u.replace(":"," mdi-")}`:`mdi mdi-${u}`,s=u=>{if(!u)return"";const p=u.toLowerCase();return p.includes("broadlink")?"broadlink-tag":p.includes("not set")?"not-set-tag":"default-controller-tag"};return(u,p)=>(l(),n("div",Gs,[e("div",Ks,[e("div",{class:Y(["profile-icon",$e(r).colorClass.value]),title:$(o.profile.platform)},[e("i",{class:Y(h($e(r).icon.value))},null,2)],10,Xs),e("div",Ys,[e("h4",{title:`${o.profile.manufacturer} ${o.profile.model}`},c(o.profile.manufacturer)+" "+c(o.profile.model),9,Zs),e("div",Qs,[e("span",{class:"tag platform-tag",title:$(o.profile.platform)},c($(o.profile.platform)),9,ea),o.profile.controllerBrand?(l(),n("span",{key:0,class:Y(["tag controller-tag",s(o.profile.controllerBrand)]),title:"Controller: "+o.profile.controllerBrand},[p[4]||(p[4]=e("i",{class:"mdi mdi-remote-tv"},null,-1)),I(" "+c(o.profile.controllerBrand),1)],10,ta)):T("",!0)])]),e("div",{class:"code-badge",title:"Device Code: "+o.profile.code},c(o.profile.code),9,oa)]),e("div",la,[e("div",{class:"profile-stats",title:o.profile.commandCount+" total commands"+(o.profile.learnedCount>0?", "+o.profile.learnedCount+" learned":"")},[p[5]||(p[5]=e("i",{class:"mdi mdi-remote"},null,-1)),e("span",null,c(o.profile.commandCount)+" command"+c(o.profile.commandCount!==1?"s":""),1),o.profile.learnedCount>0?(l(),n("span",sa,"( "+c(o.profile.learnedCount)+" learned )",1)):T("",!0)],8,na),e("div",aa,[e("button",{onClick:p[0]||(p[0]=_=>u.$emit("commands")),class:"action-btn",title:"Commands"},[...p[6]||(p[6]=[e("i",{class:"mdi mdi-remote"},null,-1)])]),e("button",{onClick:p[1]||(p[1]=_=>u.$emit("edit")),class:"action-btn",title:"Edit Profile"},[...p[7]||(p[7]=[e("i",{class:"mdi mdi-pencil"},null,-1)])]),e("button",{onClick:p[2]||(p[2]=_=>u.$emit("download")),class:"action-btn",title:"Download JSON"},[...p[8]||(p[8]=[e("i",{class:"mdi mdi-download"},null,-1)])]),e("button",{onClick:p[3]||(p[3]=_=>u.$emit("delete")),class:"action-btn delete",title:"Delete Profile"},[...p[9]||(p[9]=[e("i",{class:"mdi mdi-delete"},null,-1)])])])])]))}},ra=we(ia,[["__scopeId","data-v-aad9720f"]]),da={name:"SmartIRProfileListView",props:{profiles:{type:Array,required:!0}},methods:{getPlatformIcon(o){return{climate:"mdi-thermostat",media_player:"mdi-television",fan:"mdi-fan",light:"mdi-lightbulb"}[o]||"mdi-devices"},formatPlatform(o){return{climate:"Climate",media_player:"Media Player",fan:"Fan",light:"Light"}[o]||o},editProfile(o){this.$emit("edit",o)},viewCommands(o){this.$emit("commands",o)},downloadProfile(o){this.$emit("download",o)},deleteProfile(o){this.$emit("delete",o)}}},ua={class:"profile-list-view"},ca={class:"profile-table"},ma={class:"profile-code"},va={class:"code-badge"},pa={class:"profile-manufacturer"},fa={class:"profile-model"},ga={class:"model-info"},ya={class:"model-name"},ba={key:0,class:"model-count"},ha={class:"profile-platform"},ka={class:"profile-controller"},wa={class:"profile-commands"},$a={class:"command-stats"},Ca={class:"stat-item"},_a={key:0,class:"stat-item learned"},Sa={class:"profile-actions"},Ia=["onClick"],Da=["onClick"],xa=["onClick"],Ta=["onClick"];function Ma(o,m,r,$,h,s){return l(),n("div",ua,[e("table",ca,[m[6]||(m[6]=e("thead",null,[e("tr",null,[e("th",null,"Code"),e("th",null,"Manufacturer"),e("th",null,"Model"),e("th",null,"Platform"),e("th",null,"Controller"),e("th",null,"Commands"),e("th",null,"Actions")])],-1)),e("tbody",null,[(l(!0),n(ve,null,ke(r.profiles,u=>(l(),n("tr",{key:`${u.platform}-${u.code}`,class:"profile-row"},[e("td",ma,[e("span",va,c(u.code),1)]),e("td",pa,c(u.manufacturer||"Unknown"),1),e("td",fa,[e("div",ga,[e("div",ya,c(u.model||"Unknown"),1),u.models&&u.models.length>1?(l(),n("div",ba," +"+c(u.models.length-1)+" more ",1)):T("",!0)])]),e("td",ha,[e("span",{class:Y(["platform-badge",u.platform])},[e("i",{class:Y(["mdi",s.getPlatformIcon(u.platform)])},null,2),I(" "+c(s.formatPlatform(u.platform)),1)],2)]),e("td",ka,c(u.controller_brand||"N/A"),1),e("td",wa,[e("div",$a,[e("span",Ca,[m[0]||(m[0]=e("i",{class:"mdi mdi-remote"},null,-1)),I(" "+c(u.command_count||0),1)]),u.learned_count>0?(l(),n("span",_a,[m[1]||(m[1]=e("i",{class:"mdi mdi-school"},null,-1)),I(" "+c(u.learned_count),1)])):T("",!0)])]),e("td",Sa,[e("button",{class:"action-btn edit",onClick:p=>s.editProfile(u),title:"Edit Profile"},[...m[2]||(m[2]=[e("i",{class:"mdi mdi-pencil"},null,-1)])],8,Ia),e("button",{class:"action-btn commands",onClick:p=>s.viewCommands(u),title:"View Commands"},[...m[3]||(m[3]=[e("i",{class:"mdi mdi-remote"},null,-1)])],8,Da),e("button",{class:"action-btn download",onClick:p=>s.downloadProfile(u),title:"Download"},[...m[4]||(m[4]=[e("i",{class:"mdi mdi-download"},null,-1)])],8,xa),e("button",{class:"action-btn delete",onClick:p=>s.deleteProfile(u),title:"Delete"},[...m[5]||(m[5]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,Ta)])]))),128))])])])}const Ra=we(da,[["render",Ma],["__scopeId","data-v-d3773038"]]),La={class:"modal-container"},Aa={class:"modal-body"},Ea={key:0,class:"selection-section"},Oa={class:"form-group"},Va={class:"form-group"},Ua={class:"form-group"},Pa={key:0,class:"code-info"},Fa={class:"form-actions"},ja=["disabled"],Na={key:1,class:"testing-section"},Ba={class:"code-header"},Ha={class:"code-details"},qa={class:"code-badge"},za={class:"device-selector"},Ja=["value"],Wa={key:0,class:"helper-text"},Ga={class:"commands-section"},Ka={class:"commands-header"},Xa={key:0,class:"tested-count"},Ya={key:0,class:"filters-section"},Za={class:"filter-row"},Qa={class:"filter-row"},ei={key:1,class:"empty-state"},ti={key:2,class:"empty-state"},oi={key:3,class:"commands-list"},li={class:"command-name"},ni={class:"command-actions"},si={key:0,class:"status-badge success"},ai=["onClick","disabled","title"],ii={__name:"SmartIRCodeTester",props:{isOpen:{type:Boolean,default:!1}},emits:["close","clone"],setup(o,{emit:m}){const r=o,$=m,h=Te("toast"),s=g("climate"),u=g(""),p=g([]),_=g(!1),C=g(null),M=g(""),w=g([]),t=g(!1),R=W(()=>w.value.map(G=>({code:G.code,label:`${G.models.join(", ")} (Code: ${G.code})`,value:G.code}))),X=g(null),U=g(null),x=g(!1),a=g([]),b=g(""),v=g([]),O=g(new Set),z=g(null),ee=g(""),H=g(""),ae=g(""),E=g(""),j=W(()=>{let G=v.value;if(ee.value){const f=ee.value.toLowerCase();G=G.filter(y=>(y.label||y.name).toLowerCase().includes(f))}return H.value&&(G=G.filter(f=>f.mode===H.value)),ae.value&&(G=G.filter(f=>f.fanSpeed===ae.value)),E.value&&(G=G.filter(f=>f.swingMode===E.value)),G}),le=W(()=>ee.value||H.value||ae.value||E.value);de(()=>r.isOpen,G=>{G&&(ce(),Ie())}),de(s,()=>{r.isOpen&&(u.value="",C.value=null,w.value=[],ce())});async function ce(){var G;_.value=!0;try{const f=await ne.get("/api/smartir/codes/manufacturers",{params:{entity_type:s.value}});p.value=f.data.manufacturers||[]}catch(f){console.error("Error loading manufacturers:",f),(G=h.value)==null||G.error("Failed to load manufacturers","âŒ Error")}finally{_.value=!1}}async function pe(){var G;if(u.value){t.value=!0;try{const f=await ne.get("/api/smartir/codes/models",{params:{entity_type:s.value,manufacturer:u.value}});w.value=f.data.models||[]}catch(f){console.error("Error loading models:",f),(G=h.value)==null||G.error("Failed to load models","âŒ Error")}finally{t.value=!1}}}async function Ie(){try{const G=await ne.get("/api/remote/devices");a.value=G.data.devices||[]}catch(G){console.error("Error loading Broadlink devices:",G)}}async function Me(){var G,f;if(C.value){x.value=!0;try{const y=await ne.get("/api/smartir/codes/code",{params:{entity_type:s.value,code_id:C.value.code}});U.value=y.data.code,X.value=C.value.code,xe(y.data.code),(G=h.value)==null||G.success(`Loaded ${v.value.length} commands`,"âœ… Code Loaded")}catch(y){console.error("Error loading code:",y),(f=h.value)==null||f.error(y.message||"Failed to load code","âŒ Error")}finally{x.value=!1}}}function xe(G){const f=[];if(!G.commands){v.value=f;return}if(s.value==="climate"){const B=G.commands;for(const[te,A]of Object.entries(B)){if(te==="off"){typeof A=="string"&&f.push({name:"off",label:"OFF",data:A,mode:"off"});continue}if(typeof A=="object"){for(const[i,P]of Object.entries(A))if(typeof P=="object")for(const[Z,ie]of Object.entries(P)){if(typeof ie!="object")continue;const ue=Object.keys(ie),N=ue.includes("24")?"24":ue[0];if(N&&typeof ie[N]=="string"){const De=`${te}_${N}_${i}_${Z}`,Ce=`${te.toUpperCase()} ${N}Â°C ${i} ${Z}`;f.push({name:De,label:Ce,data:ie[N],mode:te,temperature:N,fanSpeed:i,swingMode:Z})}}}}}else for(const[B,te]of Object.entries(G.commands))typeof te=="string"&&f.push({name:B,label:B.toUpperCase().replace(/_/g," "),data:te});v.value=f}async function D(G){var f,y,B;if(!b.value){(f=h.value)==null||f.warning("Please select a Broadlink device first","âš ï¸ No Device");return}z.value=G;try{const te=v.value.find(A=>A.name===G);if(!te||!te.data)throw new Error(`Command "${G}" not found`);await ne.post("/api/commands/send-raw",{entity_id:b.value,command:te.data,command_type:"ir"}),O.value.add(G),(y=h.value)==null||y.success(`Command sent: ${te.label||G}`,"âœ… Tested")}catch(te){console.error("Error testing command:",te),(B=h.value)==null||B.error("Failed to test command","âŒ Error")}finally{z.value=null}}function d(){var G,f,y,B;if(!U.value){(G=h.value)==null||G.error("No profile data to download","âŒ Error");return}try{const te=U.value.manufacturer||"unknown",A=((f=U.value.supportedModels)==null?void 0:f[0])||X.value,i=`${te.toLowerCase().replace(/\s+/g,"_")}_${A.toLowerCase().replace(/\s+/g,"_")}.json`,P=JSON.stringify(U.value,null,2),Z=new Blob([P],{type:"application/json"}),ie=URL.createObjectURL(Z),ue=document.createElement("a");ue.href=ie,ue.download=i,document.body.appendChild(ue),ue.click(),document.body.removeChild(ue),URL.revokeObjectURL(ie),(y=h.value)==null||y.success(`Downloaded ${i}`,"âœ… Download Complete")}catch(te){console.error("Error downloading JSON:",te),(B=h.value)==null||B.error(te.message||"Failed to download JSON","âŒ Download Error")}}function V(){u.value="",C.value=null,M.value="",w.value=[]}function ge(){C.value=null,M.value="",pe()}function Ee(){M.value?C.value=w.value.find(G=>G.code===M.value):C.value=null}function q(){ee.value="",H.value="",ae.value="",E.value=""}function L(){X.value=null,U.value=null,v.value=[],O.value.clear(),z.value=null,q()}function Q(G){const f=G.toLowerCase();return f.includes("power")||f.includes("off")||f==="off"?"mdi-power":f.includes("cool")?"mdi-snowflake":f.includes("heat")?"mdi-fire":f.includes("fan")?"mdi-fan":f.includes("auto")?"mdi-auto-fix":f.includes("dry")?"mdi-water-percent":f.includes("temp")?"mdi-thermometer":f.includes("swing")?"mdi-swap-vertical":"mdi-remote"}function se(){L(),u.value="",C.value=null,$("close")}return(G,f)=>{var y;return o.isOpen?(l(),n("div",{key:0,class:"modal-overlay",onClick:he(se,["self"])},[e("div",La,[e("div",{class:"modal-header"},[f[9]||(f[9]=e("h3",null,[e("i",{class:"mdi mdi-test-tube"}),I(" Test SmartIR Code ")],-1)),e("button",{onClick:se,class:"close-btn"},[...f[8]||(f[8]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Aa,[X.value?(l(),n("div",Na,[e("div",Ba,[e("div",Ha,[e("h4",null,c(U.value.manufacturer)+" - "+c(((y=U.value.supportedModels)==null?void 0:y[0])||"Unknown"),1),e("span",qa,"Code: "+c(X.value),1)]),e("button",{onClick:L,class:"btn-secondary-small"},[...f[14]||(f[14]=[e("i",{class:"mdi mdi-arrow-left"},null,-1),I(" Change Code ",-1)])])]),e("div",za,[f[17]||(f[17]=e("label",null,[e("i",{class:"mdi mdi-remote"}),I(" Broadlink Device ")],-1)),K(e("select",{"onUpdate:modelValue":f[3]||(f[3]=B=>b.value=B),class:"form-select"},[f[15]||(f[15]=e("option",{value:""},"Select device to test with...",-1)),(l(!0),n(ve,null,ke(a.value,B=>(l(),n("option",{key:B.entity_id,value:B.entity_id},c(B.friendly_name||B.entity_id),9,Ja))),128))],512),[[Se,b.value]]),b.value?T("",!0):(l(),n("p",Wa,[...f[16]||(f[16]=[e("i",{class:"mdi mdi-information-outline"},null,-1),I(" Select a Broadlink device to enable command testing ",-1)])]))]),e("div",Ga,[e("div",Ka,[e("h5",null,"Sample Commands ("+c(j.value.length)+" / "+c(v.value.length)+")",1),O.value.size>0?(l(),n("span",Xa,c(O.value.size)+" tested ",1)):T("",!0)]),s.value==="climate"&&v.value.length>0?(l(),n("div",Ya,[e("div",Za,[K(e("input",{"onUpdate:modelValue":f[4]||(f[4]=B=>ee.value=B),type:"text",placeholder:"Search commands...",class:"search-input"},null,512),[[Le,ee.value]])]),e("div",Qa,[K(e("select",{"onUpdate:modelValue":f[5]||(f[5]=B=>H.value=B),class:"filter-select"},[...f[18]||(f[18]=[e("option",{value:""},"All Modes",-1),e("option",{value:"cool"},"Cool",-1),e("option",{value:"heat"},"Heat",-1),e("option",{value:"off"},"Off",-1)])],512),[[Se,H.value]]),K(e("select",{"onUpdate:modelValue":f[6]||(f[6]=B=>ae.value=B),class:"filter-select"},[...f[19]||(f[19]=[Pe('<option value="" data-v-66569200>All Fan Speeds</option><option value="low" data-v-66569200>Low</option><option value="mid" data-v-66569200>Mid</option><option value="high" data-v-66569200>High</option><option value="auto" data-v-66569200>Auto</option>',5)])],512),[[Se,ae.value]]),K(e("select",{"onUpdate:modelValue":f[7]||(f[7]=B=>E.value=B),class:"filter-select"},[...f[20]||(f[20]=[e("option",{value:""},"All Swing",-1),e("option",{value:"stop"},"Stop",-1),e("option",{value:"swing"},"Swing",-1)])],512),[[Se,E.value]]),le.value?(l(),n("button",{key:0,onClick:q,class:"btn-clear-filters"},[...f[21]||(f[21]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),I(" Clear ",-1)])])):T("",!0)])])):T("",!0),v.value.length===0?(l(),n("div",ei,[...f[22]||(f[22]=[e("i",{class:"mdi mdi-alert-circle"},null,-1),e("p",null,"No commands found in this code",-1)])])):j.value.length===0?(l(),n("div",ti,[f[23]||(f[23]=e("i",{class:"mdi mdi-filter-off"},null,-1)),f[24]||(f[24]=e("p",null,"No commands match your filters",-1)),e("button",{onClick:q,class:"btn-secondary-small"}," Clear Filters ")])):(l(),n("div",oi,[(l(!0),n(ve,null,ke(j.value,B=>(l(),n("div",{key:B.name,class:Y(["command-item",{tested:O.value.has(B.name),testing:z.value===B.name}])},[e("div",li,[e("i",{class:Y(["mdi",Q(B.mode||B.name)])},null,2),e("span",null,c(B.label||B.name),1)]),e("div",ni,[O.value.has(B.name)?(l(),n("span",si,[...f[25]||(f[25]=[e("i",{class:"mdi mdi-check"},null,-1),I(" Tested ",-1)])])):T("",!0),e("button",{onClick:te=>D(B.name),disabled:!b.value||z.value===B.name,title:b.value?"Test this command":"Select a Broadlink device first",class:"btn-test"},[e("i",{class:Y(["mdi",z.value===B.name?"mdi-loading mdi-spin":"mdi-play"])},null,2),f[26]||(f[26]=I(" Test ",-1))],8,ai)])],2))),128))]))]),e("div",{class:"modal-actions"},[e("button",{onClick:d,class:"btn-primary"},[...f[27]||(f[27]=[e("i",{class:"mdi mdi-download"},null,-1),I(" Download JSON ",-1)])]),e("button",{onClick:se,class:"btn-secondary"}," Close ")])])):(l(),n("div",Ea,[f[13]||(f[13]=e("div",{class:"info-banner"},[e("i",{class:"mdi mdi-information"}),e("p",null,"Select a SmartIR code from the index to test commands with your Broadlink device.")],-1)),e("div",Oa,[f[11]||(f[11]=e("label",null,[e("i",{class:"mdi mdi-shape"}),I(" Platform ")],-1)),K(e("select",{"onUpdate:modelValue":f[0]||(f[0]=B=>s.value=B),onChange:V,class:"form-select"},[...f[10]||(f[10]=[e("option",{value:"climate"},"Climate (AC/Heater)",-1),e("option",{value:"media_player"},"Media Player (TV/Audio)",-1),e("option",{value:"fan"},"Fan",-1),e("option",{value:"light"},"Light",-1)])],544),[[Se,s.value]])]),e("div",Va,[be(Je,{modelValue:u.value,"onUpdate:modelValue":f[1]||(f[1]=B=>u.value=B),options:p.value,label:"Manufacturer",placeholder:"Search manufacturers...",loading:_.value,disabled:_.value,onChange:ge},null,8,["modelValue","options","loading","disabled"])]),e("div",Ua,[be(Je,{modelValue:M.value,"onUpdate:modelValue":f[2]||(f[2]=B=>M.value=B),options:R.value,"option-label":"label","option-value":"code",label:"Model",placeholder:"Search models...",loading:t.value,disabled:!u.value||t.value,onChange:Ee},null,8,["modelValue","options","loading","disabled"])]),C.value?(l(),n("div",Pa,[f[12]||(f[12]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[e("strong",null,c(u.value)+" - "+c(C.value.models[0]),1),e("p",null,"Code: "+c(C.value.code),1)])])):T("",!0),e("div",Fa,[e("button",{onClick:Me,disabled:!C.value||x.value,class:"btn-primary"},[e("i",{class:Y(["mdi",x.value?"mdi-loading mdi-spin":"mdi-download"])},null,2),I(" "+c(x.value?"Loading...":"Load Commands"),1)],8,ja)])]))])])])):T("",!0)}}},ri=we(ii,[["__scopeId","data-v-66569200"]]),di={class:"smartir-status-card"},ui={class:"card-header"},ci=["src"],mi={class:"header-badges"},vi=["title"],pi={class:"header-info"},fi={class:"header-info"},gi={class:"header-info"},yi={class:"header-right"},bi={key:1,class:"settings-menu-container"},hi={key:0,class:"card-body loading-state"},ki={key:1,class:"card-body error-state"},wi={key:2,class:"card-body installed-state"},$i={key:0,class:"help-panel"},Ci={key:0,class:"recommendation"},_i={key:0,class:"next-steps"},Si={class:"help-actions"},Ii={key:1,class:"filter-bar"},Di={class:"filter-search-row"},xi=["title"],Ti={key:0,class:"filter-badge"},Mi={class:"search-input-wrapper"},Ri={class:"filter-content"},Li={class:"filter-row"},Ai={class:"filter-group"},Ei={key:1,class:"view-toggle-group"},Oi={class:"filter-results"},Vi={key:2,class:"loading-state"},Ui={key:3,class:"empty-state"},Pi={key:4,class:"profiles-grid"},Fi={key:6,class:"no-results"},ji={key:3,class:"card-body not-installed-state"},Ni={class:"benefits-section"},Bi={class:"benefits-list"},Hi={class:"recommendation"},qi={__name:"SmartIRStatusCard",emits:["create-profile","edit-profile"],setup(o,{expose:m,emit:r}){const $=r,h=Te("smartirStatus");Te("smartirEnabled");const s=Te("refreshSmartIR"),{isMobile:u}=Xe(),p=g(!1),_=g(null),C=g((h==null?void 0:h.value)||null),M=g(localStorage.getItem("smartir_simulate_not_installed")==="true"),w=g(!1),t=g(!1),R=g(!0),X=g([]),U=g(!1),x=g(!1),a=g({search:"",platform:""}),b=g({show:!1,title:"",message:"",platform:null,profile:null}),v=g(!1),z=g(window.innerWidth<=767?"grid":localStorage.getItem("profile_view_mode")||"grid");de(u,f=>{f&&z.value==="list"&&(z.value="grid")}),de(z,f=>{localStorage.setItem("profile_view_mode",f)});const ee=["Full climate entity support (AC, heaters)","120+ pre-configured device profiles","Temperature and humidity sensor integration","HVAC mode control (heat, cool, auto, dry, fan)"],H=["climate","media_player","fan","light"],ae=W(()=>M.value?{installed:!1,recommendation:{message:"Install SmartIR to unlock climate device support!",benefits:["Full climate entity support (AC, heaters)","120+ pre-configured device profiles","Temperature and humidity sensor integration","HVAC mode control (heat, cool, auto, dry, fan)"]}}:C.value),E=W(()=>{var f,y;return((y=(f=ae.value)==null?void 0:f.platforms)==null?void 0:y.length)||0}),j=W(()=>{var f;return(f=ae.value)!=null&&f.device_counts?Object.values(ae.value.device_counts).reduce((y,B)=>y+B,0):0});function le(){var f;M.value=!M.value,localStorage.setItem("smartir_simulate_not_installed",M.value.toString()),!M.value&&((f=C.value)!=null&&f.installed)&&q()}const ce=W(()=>{let f=X.value;if(a.value.search){const y=a.value.search.toLowerCase();f=f.filter(B=>{var te,A,i,P;return((te=B.manufacturer)==null?void 0:te.toLowerCase().includes(y))||((A=B.model)==null?void 0:A.toLowerCase().includes(y))||((i=B.code)==null?void 0:i.toString().includes(y))||((P=B.platform)==null?void 0:P.toLowerCase().includes(y))})}return a.value.platform&&(f=f.filter(y=>y.platform===a.value.platform)),f}),pe=W(()=>a.value.search||a.value.platform),Ie=W(()=>{let f=0;return a.value.search&&f++,a.value.platform&&f++,f});function Me(){a.value.search="",a.value.platform=""}async function xe(){p.value=!0,_.value=null;try{if(s)await s();else{const f=await nt.getStatus();C.value=f}}catch(f){_.value=f.message||"Failed to refresh SmartIR status",console.error("Error refreshing SmartIR status:",f)}finally{p.value=!1}}function D(){$("create-profile")}function d(){w.value=!w.value,t.value=!1}function V(){R.value||(R.value=!0),t.value=!t.value}function ge(){v.value=!0,t.value=!1}function Ee(){window.open("https://github.com/smartHomeHub/SmartIR","_blank")}async function q(){U.value=!0;const f=[];try{for(const y of H)try{const te=((await ne.get(`/api/smartir/platforms/${y}/profiles`)).data.profiles||[]).map(A=>({...A,platform:y}));f.push(...te)}catch(B){console.warn(`Network error loading ${y} profiles (using bundled index):`,B.message)}X.value=f}catch(y){console.error("Unexpected error loading profiles:",y)}finally{U.value=!1}}function L(f,y,B){$("edit-profile",{platform:f,profile:y,startStep:B})}async function Q(f,y){var B,te;try{const i=(await ne.get(`/api/smartir/platforms/${f}/profiles/${y.code}`)).data,P=JSON.stringify(i.profile,null,2),Z=new Blob([P],{type:"application/json"}),ie=URL.createObjectURL(Z),ue=document.createElement("a");ue.href=ie,ue.download=`smartir_${f}_${y.manufacturer}_${y.model}_${y.code}.json`,document.body.appendChild(ue),ue.click(),document.body.removeChild(ue),URL.revokeObjectURL(ie),(B=Te("toast").value)==null||B.success(`Downloaded ${y.manufacturer} ${y.model}`,"âœ… Profile Downloaded")}catch(A){console.error("Error downloading profile:",A),(te=Te("toast").value)==null||te.error("Failed to download profile","âŒ Download Error")}}async function se(f,y){Te("toast");try{const te=(await ne.post(`/api/smartir/profiles/${y.code}/check-usage`,{platform:f})).data;if(te&&te.in_use){b.value={show:!0,title:`Cannot Delete ${y.manufacturer} ${y.model}`,message:`This profile is currently in use by ${te.device_count} device(s):

${te.devices.join(`
`)}

Please remove or reassign these devices before deleting the profile.`,platform:f,profile:y,canDelete:!1,devices:te.devices};return}}catch(B){console.error("Error checking profile usage:",B)}b.value={show:!0,title:`Delete ${y.manufacturer} ${y.model}?`,message:`Device Code: ${y.code}

This will remove the profile and update your configuration.`,platform:f,profile:y,canDelete:!0}}async function G(){var te,A;const f=Te("toast"),{platform:y,profile:B}=b.value;b.value.show=!1;try{await ne.delete(`/api/smartir/profiles/${B.code}`,{data:{platform:y}}),await q(),await tt(),await xe(),(te=f.value)==null||te.success(`${B.manufacturer} ${B.model} has been removed`,"âœ… Profile Deleted")}catch(i){console.error("Error deleting profile:",i),(A=f.value)==null||A.error("Failed to delete profile","âŒ Delete Error")}}return de(h,f=>{f&&(C.value=f)},{immediate:!0}),de(z,f=>{localStorage.setItem("profile_view_mode",f)}),Ae(async()=>{var f;h!=null&&h.value&&(C.value=h.value),C.value||await xe(),(f=C.value)!=null&&f.installed&&await q()}),m({loadAllProfiles:q,refreshStatus:xe}),(f,y)=>{var B,te,A,i,P,Z,ie,ue;return l(),n("div",di,[e("div",ui,[e("button",{class:"icon-button chevron-button",onClick:y[0]||(y[0]=N=>R.value=!R.value)},[e("i",{class:Y(["mdi",R.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2)]),e("div",{class:"header-left",onClick:y[1]||(y[1]=N=>R.value=!R.value)},[e("img",{src:$e(Ye),alt:"SmartIR",class:"smartir-logo"},null,8,ci),e("h3",null,c($e(u)?"SmartIR":"SmartIR Integration"),1),e("div",mi,[e("div",{class:Y(["simulation-toggle-pill",{active:M.value}]),onClick:he(le,["stop"]),title:M.value?"Click to show as installed":"Click to simulate not-installed"},[e("i",{class:Y(["mdi",M.value?"mdi-eye-off":"mdi-eye"])},null,2),e("span",null,c(M.value?"Simulating: Not Installed":"Simulation Mode"),1)],10,vi),(B=ae.value)!=null&&B.installed?(l(),n(ve,{key:0},[y[16]||(y[16]=e("div",{class:"status-badge-mini success"},[e("i",{class:"mdi mdi-check-circle"}),e("span",null,"Installed")],-1)),e("span",pi,"v"+c(ae.value.version||"Unknown"),1),e("span",fi,c(E.value)+" platform"+c(E.value!==1?"s":""),1),e("span",gi,c(j.value)+" device"+c(j.value!==1?"s":""),1)],64)):T("",!0)])]),e("div",yi,[(te=ae.value)!=null&&te.installed?(l(),n("button",{key:0,onClick:he(D,["stop"]),class:"btn btn-primary new-button"},[...y[17]||(y[17]=[e("i",{class:"mdi mdi-plus"},null,-1),e("span",null,"New",-1)])])):T("",!0),(A=ae.value)!=null&&A.installed?(l(),n("div",bi,[e("button",{onClick:he(V,["stop"]),class:Y(["icon-button settings-button",{active:t.value}]),title:"Settings"},[...y[18]||(y[18]=[e("i",{class:"mdi mdi-cog"},null,-1)])],2),t.value?(l(),n("div",{key:0,class:"settings-dropdown",onClick:y[3]||(y[3]=he(()=>{},["stop"]))},[e("button",{onClick:d,class:"menu-item"},[y[19]||(y[19]=e("i",{class:"mdi mdi-help-circle"},null,-1)),e("span",null,c(w.value?"Hide Help":"Show Help"),1)]),e("button",{onClick:y[2]||(y[2]=N=>{t.value=!1,xe()}),class:"menu-item"},[...y[20]||(y[20]=[e("i",{class:"mdi mdi-refresh"},null,-1),e("span",null,"Refresh Status",-1)])]),e("button",{onClick:ge,class:"menu-item"},[...y[21]||(y[21]=[e("i",{class:"mdi mdi-test-tube"},null,-1),e("span",null,"Test Codes",-1)])])])):T("",!0)])):T("",!0)])]),K(e("div",null,[p.value?(l(),n("div",hi,[...y[22]||(y[22]=[e("div",{class:"spinner"},null,-1),e("p",null,"Checking SmartIR installation...",-1)])])):_.value?(l(),n("div",ki,[y[23]||(y[23]=e("i",{class:"mdi mdi-alert-circle"},null,-1)),e("p",null,c(_.value),1),e("button",{onClick:xe,class:"btn-secondary"}," Try Again ")])):(i=ae.value)!=null&&i.installed?(l(),n("div",wi,[w.value?(l(),n("div",$i,[C.value.recommendation?(l(),n("div",Ci,[e("p",null,c(C.value.recommendation.message),1),C.value.recommendation.next_steps?(l(),n("div",_i,[y[24]||(y[24]=e("strong",null,"Next Steps:",-1)),e("ul",null,[(l(!0),n(ve,null,ke(C.value.recommendation.next_steps,(N,De)=>(l(),n("li",{key:De},c(N),1))),128))])])):T("",!0)])):T("",!0),e("div",Si,[e("button",{onClick:y[4]||(y[4]=(...N)=>f.viewDocumentation&&f.viewDocumentation(...N)),class:"btn-secondary"},[...y[25]||(y[25]=[e("i",{class:"mdi mdi-book-open-variant"},null,-1),I(" View Documentation ",-1)])])])])):T("",!0),X.value.length>0&&!M.value?(l(),n("div",Ii,[e("div",Di,[e("button",{class:Y(["filter-toggle-button",{active:x.value||pe.value}]),onClick:y[5]||(y[5]=N=>x.value=!x.value),title:x.value?"Hide filters":"Show filters"},[y[26]||(y[26]=e("i",{class:"mdi mdi-filter-variant"},null,-1)),pe.value?(l(),n("span",Ti,c(Ie.value),1)):T("",!0)],10,xi),e("div",Mi,[y[27]||(y[27]=e("i",{class:"mdi mdi-magnify search-icon"},null,-1)),K(e("input",{"onUpdate:modelValue":y[6]||(y[6]=N=>a.value.search=N),type:"text",placeholder:"Search profiles...",class:"search-input"},null,512),[[Le,a.value.search]])])]),K(e("div",Ri,[e("div",Li,[e("div",Ai,[e("label",null,[y[29]||(y[29]=e("i",{class:"mdi mdi-shape"},null,-1)),K(e("select",{"onUpdate:modelValue":y[7]||(y[7]=N=>a.value.platform=N)},[...y[28]||(y[28]=[Pe('<option value="" data-v-a0d71787>All Platforms</option><option value="climate" data-v-a0d71787>Climate</option><option value="media_player" data-v-a0d71787>Media Player</option><option value="fan" data-v-a0d71787>Fan</option><option value="light" data-v-a0d71787>Light</option>',5)])],512),[[Se,a.value.platform]])])]),pe.value?(l(),n("button",{key:0,onClick:Me,class:"btn-clear-filters"},[...y[30]||(y[30]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),I(" Clear ",-1)])])):T("",!0),$e(u)?T("",!0):(l(),n("div",Ei,[e("button",{onClick:y[8]||(y[8]=N=>z.value="grid"),class:Y(["view-toggle-btn",{active:z.value==="grid"}]),title:"Grid View"},[...y[31]||(y[31]=[e("i",{class:"mdi mdi-view-grid"},null,-1),I(" Grid ",-1)])],2),e("button",{onClick:y[9]||(y[9]=N=>z.value="list"),class:Y(["view-toggle-btn",{active:z.value==="list"}]),title:"List View"},[...y[32]||(y[32]=[e("i",{class:"mdi mdi-view-list"},null,-1),I(" List ",-1)])],2)])),e("div",Oi,c(ce.value.length)+" of "+c(X.value.length),1)])],512),[[ze,x.value]])])):T("",!0),U.value?(l(),n("div",Vi,[...y[33]||(y[33]=[e("i",{class:"mdi mdi-loading mdi-spin"},null,-1),e("p",null,"Loading profiles...",-1)])])):X.value.length===0?(l(),n("div",Ui,[...y[34]||(y[34]=[e("i",{class:"mdi mdi-file-document-outline"},null,-1),e("h3",null,"No Profiles Yet",-1),e("p",null,"Create your first SmartIR profile to get started",-1)])])):T("",!0),z.value==="grid"&&!M.value?(l(),n("div",Pi,[(l(!0),n(ve,null,ke(ce.value,N=>(l(),Oe(ra,{key:`${N.platform}-${N.code}`,profile:N,onEdit:De=>L(N.platform,N),onCommands:De=>L(N.platform,N,2),onDownload:De=>Q(N.platform,N),onDelete:De=>se(N.platform,N)},null,8,["profile","onEdit","onCommands","onDownload","onDelete"]))),128))])):z.value==="list"&&!M.value&&ce.value.length>0?(l(),Oe(Ra,{key:5,profiles:ce.value,onEdit:y[10]||(y[10]=N=>L(N.platform,N)),onCommands:y[11]||(y[11]=N=>L(N.platform,N,2)),onDownload:y[12]||(y[12]=N=>Q(N.platform,N)),onDelete:y[13]||(y[13]=N=>se(N.platform,N))},null,8,["profiles"])):T("",!0),X.value.length>0&&ce.value.length===0&&!M.value?(l(),n("div",Fi,[...y[35]||(y[35]=[e("i",{class:"mdi mdi-filter-off"},null,-1),e("h3",null,"No profiles match your filters",-1),e("p",null,"Try adjusting your search or filter criteria",-1)])])):T("",!0)])):(l(),n("div",ji,[y[39]||(y[39]=e("div",{class:"status-badge warning"},[e("i",{class:"mdi mdi-information"}),e("span",null,"Not Installed")],-1)),e("div",Ni,[y[37]||(y[37]=e("h4",null,"Why Install SmartIR?",-1)),e("ul",Bi,[(l(!0),n(ve,null,ke(((Z=(P=C.value)==null?void 0:P.recommendation)==null?void 0:Z.benefits)||ee,(N,De)=>(l(),n("li",{key:De},[y[36]||(y[36]=e("i",{class:"mdi mdi-check"},null,-1)),e("span",null,c(N),1)]))),128))])]),e("div",Hi,[e("p",null,c(((ue=(ie=C.value)==null?void 0:ie.recommendation)==null?void 0:ue.message)||"Install SmartIR to unlock climate device support!"),1)]),e("div",{class:"card-actions"},[e("button",{onClick:Ee,class:"btn-primary"},[...y[38]||(y[38]=[e("i",{class:"mdi mdi-github"},null,-1),I(" Install SmartIR ",-1)])])])]))],512),[[ze,R.value]]),be(Ue,{isOpen:b.value.show,title:b.value.title,message:b.value.message,confirmText:b.value.canDelete===!1?null:"Delete",cancelText:"Close",dangerMode:!0,confirmDisabled:b.value.canDelete===!1,onConfirm:G,onCancel:y[14]||(y[14]=N=>b.value.show=!1)},null,8,["isOpen","title","message","confirmText","confirmDisabled"]),be(ri,{isOpen:v.value,onClose:y[15]||(y[15]=N=>v.value=!1)},null,8,["isOpen"])])}}},zi=we(qi,[["__scopeId","data-v-a0d71787"]]),Ji={class:"climate-form"},Wi={class:"learning-mode-section"},Gi={class:"mode-toggle"},Ki={class:"mode-content"},Xi={class:"mode-stats"},Yi={class:"stat-badge"},Zi={class:"stat-badge time"},Qi={class:"mode-content"},er={class:"mode-stats"},tr={class:"stat-badge"},or={class:"stat-badge time warning"},lr={key:0,class:"command-breakdown"},nr={class:"warning-text"},sr={class:"form-section"},ar={key:0,class:"help-text"},ir={key:1,class:"help-text"},rr={class:"form-row"},dr={class:"form-group"},ur={class:"form-group"},cr={class:"form-group"},mr={key:2,class:"representative-temp-section"},vr={class:"form-group"},pr=["value"],fr={class:"form-section"},gr={class:"checkbox-grid"},yr={class:"checkbox-item"},br={class:"checkbox-item"},hr={class:"checkbox-item"},kr={class:"checkbox-item"},wr={class:"checkbox-item"},$r={class:"checkbox-item"},Cr={class:"form-section"},_r={class:"checkbox-grid"},Sr={class:"checkbox-item"},Ir={class:"checkbox-item"},Dr={class:"checkbox-item"},xr={class:"checkbox-item"},Tr={class:"form-section"},Mr={class:"checkbox-grid"},Rr={class:"checkbox-item"},Lr={class:"checkbox-item"},Ar={class:"checkbox-item"},Er={class:"checkbox-item"},Or={class:"form-section"},Vr={class:"form-group"},Ur={class:"form-group"},Pr={class:"form-group"},Fr={key:0,class:"validation-summary"},jr={__name:"ClimateProfileForm",props:{modelValue:{type:Object,default:()=>({})}},emits:["update:modelValue"],setup(o,{emit:m}){const r=o,$=m,h=g("quick"),s=g({minTemp:16,maxTemp:30,precision:1,representativeTemp:24,modes:["off","auto","cool","heat"],fanModes:["auto","low","medium","high"],swingModes:[],tempSensor:"",humiditySensor:"",powerSensor:"",learningMode:"quick",...r.modelValue}),u=W(()=>{const x=[],a=s.value.minTemp||16,b=s.value.maxTemp||30,v=s.value.precision||1;for(let O=a;O<=b;O+=v)x.push(O);return x}),p=W(()=>s.value.modes.filter(x=>x!=="off").length),_=W(()=>s.value.fanModes.length||1),C=W(()=>s.value.swingModes.length||1),M=W(()=>{const x=s.value.minTemp||16,a=s.value.maxTemp||30,b=s.value.precision||1;return Math.floor((a-x)/b)+1}),w=W(()=>{const x=s.value.modes.includes("off")?1:0;return p.value*_.value*C.value+x}),t=W(()=>Math.ceil(w.value*30/60)),R=W(()=>{const x=s.value.modes.includes("off")?1:0;return p.value*M.value*_.value*C.value+x}),X=W(()=>Math.ceil(R.value*30/60)),U=W(()=>{const x=[];return(!s.value.minTemp||s.value.minTemp<10||s.value.minTemp>35)&&x.push("Minimum temperature must be between 10Â°C and 35Â°C"),(!s.value.maxTemp||s.value.maxTemp<10||s.value.maxTemp>35)&&x.push("Maximum temperature must be between 10Â°C and 35Â°C"),s.value.minTemp>=s.value.maxTemp&&x.push("Minimum temperature must be less than maximum temperature"),(!s.value.modes||s.value.modes.length===0)&&x.push("At least one HVAC mode must be selected"),x});return de(h,x=>{s.value.learningMode=x}),de(s,x=>{$("update:modelValue",x)},{deep:!0,immediate:!0}),(x,a)=>(l(),n("div",Ji,[a[63]||(a[63]=e("h3",null,"Climate Device Configuration",-1)),e("div",Wi,[e("div",Gi,[e("label",{class:Y(["mode-option",{active:h.value==="quick"}])},[K(e("input",{type:"radio",value:"quick","onUpdate:modelValue":a[0]||(a[0]=b=>h.value=b)},null,512),[[qe,h.value]]),e("div",Ki,[a[23]||(a[23]=e("div",{class:"mode-header"},[e("i",{class:"mdi mdi-flash"}),e("strong",null,"Quick Mode (Recommended)")],-1)),a[24]||(a[24]=e("p",null,"Learn one temperature per mode combination",-1)),e("div",Xi,[e("span",Yi,c(w.value)+" commands",1),e("span",Zi,"~"+c(t.value)+" min",1)])])],2),e("label",{class:Y(["mode-option",{active:h.value==="complete"}])},[K(e("input",{type:"radio",value:"complete","onUpdate:modelValue":a[1]||(a[1]=b=>h.value=b)},null,512),[[qe,h.value]]),e("div",Qi,[a[25]||(a[25]=e("div",{class:"mode-header"},[e("i",{class:"mdi mdi-check-all"}),e("strong",null,"Complete Mode")],-1)),a[26]||(a[26]=e("p",null,"Learn all temperature combinations",-1)),e("div",er,[e("span",tr,c(R.value)+" commands",1),e("span",or,"~"+c(X.value)+" min",1)])])],2)]),h.value==="complete"?(l(),n("div",lr,[a[27]||(a[27]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[e("strong",null,"Complete mode will require learning "+c(R.value)+" commands",1),e("p",null,"This includes all combinations of modes ("+c(p.value)+"), temperatures ("+c(M.value)+"), fan speeds ("+c(_.value)+"), and swing modes ("+c(C.value)+").",1),e("p",nr,"â±ï¸ Estimated time: "+c(X.value)+" minutes at ~30 seconds per command",1)])])):T("",!0)]),e("div",sr,[a[33]||(a[33]=e("h4",null,"Temperature Range",-1)),h.value==="quick"?(l(),n("p",ar," Define the full temperature range your device supports. You'll select one temperature to learn below. ")):(l(),n("p",ir," Define the temperature range. All temperatures in this range will be learned. ")),e("div",rr,[e("div",dr,[a[28]||(a[28]=e("label",null,"Minimum Temperature (Â°C) *",-1)),K(e("input",{"onUpdate:modelValue":a[2]||(a[2]=b=>s.value.minTemp=b),type:"number",min:"10",max:"35",placeholder:"16"},null,512),[[Le,s.value.minTemp,void 0,{number:!0}]])]),e("div",ur,[a[29]||(a[29]=e("label",null,"Maximum Temperature (Â°C) *",-1)),K(e("input",{"onUpdate:modelValue":a[3]||(a[3]=b=>s.value.maxTemp=b),type:"number",min:"10",max:"35",placeholder:"30"},null,512),[[Le,s.value.maxTemp,void 0,{number:!0}]])]),e("div",cr,[a[31]||(a[31]=e("label",null,"Precision",-1)),K(e("select",{"onUpdate:modelValue":a[4]||(a[4]=b=>s.value.precision=b)},[...a[30]||(a[30]=[e("option",{value:1},"1Â°C (Whole degrees)",-1),e("option",{value:.5},"0.5Â°C (Half degrees)",-1)])],512),[[Se,s.value.precision,void 0,{number:!0}]])])]),h.value==="quick"?(l(),n("div",mr,[e("div",vr,[a[32]||(a[32]=e("label",null,"Representative Temperature to Learn *",-1)),K(e("select",{"onUpdate:modelValue":a[5]||(a[5]=b=>s.value.representativeTemp=b)},[(l(!0),n(ve,null,ke(u.value,b=>(l(),n("option",{key:b,value:b},c(b)+"Â°C ",9,pr))),128))],512),[[Se,s.value.representativeTemp,void 0,{number:!0}]]),e("small",null,"This temperature will be learned for all mode combinations. The device profile will still show the full range ("+c(s.value.minTemp)+"Â°C - "+c(s.value.maxTemp)+"Â°C).",1)])])):T("",!0)]),e("div",fr,[a[40]||(a[40]=e("h4",null,"Supported HVAC Modes *",-1)),a[41]||(a[41]=e("p",{class:"help-text"},"Select all modes your device supports",-1)),e("div",gr,[e("label",yr,[K(e("input",{type:"checkbox",value:"off","onUpdate:modelValue":a[6]||(a[6]=b=>s.value.modes=b)},null,512),[[fe,s.value.modes]]),a[34]||(a[34]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),I(" Off ")],-1))]),e("label",br,[K(e("input",{type:"checkbox",value:"auto","onUpdate:modelValue":a[7]||(a[7]=b=>s.value.modes=b)},null,512),[[fe,s.value.modes]]),a[35]||(a[35]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-autorenew"}),I(" Auto ")],-1))]),e("label",hr,[K(e("input",{type:"checkbox",value:"cool","onUpdate:modelValue":a[8]||(a[8]=b=>s.value.modes=b)},null,512),[[fe,s.value.modes]]),a[36]||(a[36]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-snowflake"}),I(" Cool ")],-1))]),e("label",kr,[K(e("input",{type:"checkbox",value:"heat","onUpdate:modelValue":a[9]||(a[9]=b=>s.value.modes=b)},null,512),[[fe,s.value.modes]]),a[37]||(a[37]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fire"}),I(" Heat ")],-1))]),e("label",wr,[K(e("input",{type:"checkbox",value:"dry","onUpdate:modelValue":a[10]||(a[10]=b=>s.value.modes=b)},null,512),[[fe,s.value.modes]]),a[38]||(a[38]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-water-percent"}),I(" Dry ")],-1))]),e("label",$r,[K(e("input",{type:"checkbox",value:"fan_only","onUpdate:modelValue":a[11]||(a[11]=b=>s.value.modes=b)},null,512),[[fe,s.value.modes]]),a[39]||(a[39]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan"}),I(" Fan Only ")],-1))])])]),e("div",Cr,[a[46]||(a[46]=e("h4",null,"Fan Modes",-1)),a[47]||(a[47]=e("p",{class:"help-text"},"Select all fan speeds your device supports",-1)),e("div",_r,[e("label",Sr,[K(e("input",{type:"checkbox",value:"auto","onUpdate:modelValue":a[12]||(a[12]=b=>s.value.fanModes=b)},null,512),[[fe,s.value.fanModes]]),a[42]||(a[42]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-autorenew"}),I(" Auto ")],-1))]),e("label",Ir,[K(e("input",{type:"checkbox",value:"low","onUpdate:modelValue":a[13]||(a[13]=b=>s.value.fanModes=b)},null,512),[[fe,s.value.fanModes]]),a[43]||(a[43]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-1"}),I(" Low ")],-1))]),e("label",Dr,[K(e("input",{type:"checkbox",value:"medium","onUpdate:modelValue":a[14]||(a[14]=b=>s.value.fanModes=b)},null,512),[[fe,s.value.fanModes]]),a[44]||(a[44]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-2"}),I(" Medium ")],-1))]),e("label",xr,[K(e("input",{type:"checkbox",value:"high","onUpdate:modelValue":a[15]||(a[15]=b=>s.value.fanModes=b)},null,512),[[fe,s.value.fanModes]]),a[45]||(a[45]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-3"}),I(" High ")],-1))])])]),e("div",Tr,[a[52]||(a[52]=e("h4",null,"Swing Modes (Optional)",-1)),a[53]||(a[53]=e("p",{class:"help-text"},"Select if your device has swing/oscillation",-1)),e("div",Mr,[e("label",Rr,[K(e("input",{type:"checkbox",value:"off","onUpdate:modelValue":a[16]||(a[16]=b=>s.value.swingModes=b)},null,512),[[fe,s.value.swingModes]]),a[48]||(a[48]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-horizontal"}),I(" Off ")],-1))]),e("label",Lr,[K(e("input",{type:"checkbox",value:"vertical","onUpdate:modelValue":a[17]||(a[17]=b=>s.value.swingModes=b)},null,512),[[fe,s.value.swingModes]]),a[49]||(a[49]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-vertical"}),I(" Vertical ")],-1))]),e("label",Ar,[K(e("input",{type:"checkbox",value:"horizontal","onUpdate:modelValue":a[18]||(a[18]=b=>s.value.swingModes=b)},null,512),[[fe,s.value.swingModes]]),a[50]||(a[50]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-horizontal"}),I(" Horizontal ")],-1))]),e("label",Er,[K(e("input",{type:"checkbox",value:"both","onUpdate:modelValue":a[19]||(a[19]=b=>s.value.swingModes=b)},null,512),[[fe,s.value.swingModes]]),a[51]||(a[51]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-arrow-all"}),I(" Both ")],-1))])])]),e("div",Or,[a[60]||(a[60]=e("h4",null,"Sensors (Optional)",-1)),a[61]||(a[61]=e("p",{class:"help-text"},"Link external sensors for better climate control",-1)),e("div",Vr,[a[54]||(a[54]=e("label",null,"Temperature Sensor",-1)),K(e("input",{"onUpdate:modelValue":a[20]||(a[20]=b=>s.value.tempSensor=b),type:"text",placeholder:"sensor.living_room_temperature"},null,512),[[Le,s.value.tempSensor]]),a[55]||(a[55]=e("small",null,"Entity ID of temperature sensor",-1))]),e("div",Ur,[a[56]||(a[56]=e("label",null,"Humidity Sensor",-1)),K(e("input",{"onUpdate:modelValue":a[21]||(a[21]=b=>s.value.humiditySensor=b),type:"text",placeholder:"sensor.living_room_humidity"},null,512),[[Le,s.value.humiditySensor]]),a[57]||(a[57]=e("small",null,"Entity ID of humidity sensor",-1))]),e("div",Pr,[a[58]||(a[58]=e("label",null,"Power Sensor",-1)),K(e("input",{"onUpdate:modelValue":a[22]||(a[22]=b=>s.value.powerSensor=b),type:"text",placeholder:"binary_sensor.ac_power"},null,512),[[Le,s.value.powerSensor]]),a[59]||(a[59]=e("small",null,"Entity ID of power sensor (to detect on/off state)",-1))])]),U.value.length>0?(l(),n("div",Fr,[a[62]||(a[62]=e("h4",null,[e("i",{class:"mdi mdi-alert-circle"}),I(" Please fix the following: ")],-1)),e("ul",null,[(l(!0),n(ve,null,ke(U.value,(b,v)=>(l(),n("li",{key:v},c(b),1))),128))])])):T("",!0)]))}},Nr=we(jr,[["__scopeId","data-v-c44d7198"]]),Br={class:"command-wizard"},Hr={class:"device-selection-section"},qr={class:"input-wrapper"},zr=["value"],Jr={key:0,class:"validation-tooltip"},Wr={class:"form-group"},Gr=["disabled"],Kr={key:0},Xr={key:1},Yr={key:0,class:"edit-mode-banner"},Zr={class:"wizard-info"},Qr={key:0},ed={key:1},td={class:"progress-info"},od={class:"progress-bar"},ld={class:"progress-text"},nd={class:"commands-grid"},sd={class:"command-header"},ad={class:"command-icon"},id={class:"command-info"},rd={key:0,class:"learning-indicator"},dd={key:0,class:"ir-learning-steps"},ud={key:1,class:"rf-learning-steps"},cd={class:"command-actions"},md=["onClick","disabled"],vd={key:1,class:"learned-status"},pd=["onClick","disabled"],fd=["onClick"],gd={class:"quick-actions"},yd=["disabled"],bd=["disabled"],hd={__name:"CommandLearningWizard",props:{modelValue:{type:Object,default:()=>({})},platform:{type:String,required:!0},config:{type:Object,required:!0},broadlinkDevice:{type:String,default:""},manufacturer:{type:String,required:!0},model:{type:String,required:!0},commandType:{type:String,default:"ir"}},emits:["update:modelValue","update:broadlinkDevice","update:commandType"],setup(o,{emit:m}){const r=je(),$=o,h=m,s=g({...$.modelValue}),u=g(null),p=g(null),_=g([]),C=g($.broadlinkDevice),M=g($.commandType),w=g(!1),t=g([]),R=g(!1),X=g(!1),U=g({show:!1,commandKey:null,commandLabel:""}),x=g(!1),a=W(()=>{const D=[];if($.platform==="climate"){const d=$.config.modes||[],V=$.config.fanModes||[],ge=$.config.minTemp||16,Ee=$.config.maxTemp||30;d.forEach(q=>{if(q==="off")D.push({key:"off",label:"Power Off",description:"Turn device off",icon:"mdi mdi-power",mode:"off"});else for(let L=ge;L<=Ee;L++)V.forEach(Q=>{const se=`${q}_${L}_${Q}`;D.push({key:se,label:`${q.toUpperCase()} ${L}Â°C ${Q}`,description:`Mode: ${q}, Temp: ${L}Â°C, Fan: ${Q}`,icon:z(q),mode:q,temp:L,fanMode:Q})})})}else if($.platform==="media_player"){const d=$.config.features||[];d.includes("turn_on")&&(D.push({key:"turn_on",label:"Power On",description:"Turn on the device",icon:"mdi mdi-power"}),D.push({key:"turn_off",label:"Power Off",description:"Turn off the device",icon:"mdi mdi-power-off"})),d.includes("volume")&&(D.push({key:"volume_up",label:"Volume Up",description:"Increase volume",icon:"mdi mdi-volume-plus"}),D.push({key:"volume_down",label:"Volume Down",description:"Decrease volume",icon:"mdi mdi-volume-minus"})),d.includes("mute")&&D.push({key:"mute",label:"Mute",description:"Toggle mute",icon:"mdi mdi-volume-mute"}),d.includes("source")&&(D.push({key:"source_hdmi1",label:"Source: HDMI 1",description:"Switch to HDMI 1",icon:"mdi mdi-import"}),D.push({key:"source_hdmi2",label:"Source: HDMI 2",description:"Switch to HDMI 2",icon:"mdi mdi-import"}),D.push({key:"source_hdmi3",label:"Source: HDMI 3",description:"Switch to HDMI 3",icon:"mdi mdi-import"})),d.includes("channel")&&(D.push({key:"channel_up",label:"Channel Up",description:"Next channel",icon:"mdi mdi-chevron-up"}),D.push({key:"channel_down",label:"Channel Down",description:"Previous channel",icon:"mdi mdi-chevron-down"}))}else if($.platform==="fan"){const d=$.config.speedLevels||3,V=$.config.features||[];D.push({key:"turn_on",label:"Power On",description:"Turn on the fan",icon:"mdi mdi-power"}),D.push({key:"turn_off",label:"Power Off",description:"Turn off the fan",icon:"mdi mdi-power-off"});for(let ge=1;ge<=d;ge++){const Ee=ge===1?"Low":ge===d?"High":ge===2&&d===3?"Medium":`Speed ${ge}`;D.push({key:`speed_${ge}`,label:`${Ee}`,description:`Set fan to speed level ${ge}`,icon:"mdi mdi-fan"})}V.includes("oscillate")&&(D.push({key:"oscillate_on",label:"Oscillate On",description:"Enable oscillation",icon:"mdi mdi-sync"}),D.push({key:"oscillate_off",label:"Oscillate Off",description:"Disable oscillation",icon:"mdi mdi-sync-off"})),V.includes("direction")&&(D.push({key:"direction_forward",label:"Direction: Forward",description:"Set direction to forward",icon:"mdi mdi-rotate-right"}),D.push({key:"direction_reverse",label:"Direction: Reverse",description:"Set direction to reverse",icon:"mdi mdi-rotate-left"}))}else if($.platform==="light"){const d=$.config.features||[];d.includes("turn_on")&&(D.push({key:"turn_on",label:"Power On",description:"Turn on the light",icon:"mdi mdi-lightbulb-on"}),D.push({key:"turn_off",label:"Power Off",description:"Turn off the light",icon:"mdi mdi-lightbulb-off"})),d.includes("brightness")&&(D.push({key:"brightness_up",label:"Brightness Up",description:"Increase brightness",icon:"mdi mdi-brightness-7"}),D.push({key:"brightness_down",label:"Brightness Down",description:"Decrease brightness",icon:"mdi mdi-brightness-5"})),d.includes("color_temp")&&(D.push({key:"color_temp_warm",label:"Warm White",description:"Set to warm white",icon:"mdi mdi-weather-sunset"}),D.push({key:"color_temp_cool",label:"Cool White",description:"Set to cool white",icon:"mdi mdi-weather-sunny"})),d.includes("rgb")&&(D.push({key:"color_red",label:"Color: Red",description:"Set color to red",icon:"mdi mdi-palette"}),D.push({key:"color_green",label:"Color: Green",description:"Set color to green",icon:"mdi mdi-palette"}),D.push({key:"color_blue",label:"Color: Blue",description:"Set color to blue",icon:"mdi mdi-palette"}))}return D}),b=W(()=>a.value.length),v=W(()=>Object.keys(s.value).length),O=W(()=>b.value===0?0:Math.round(v.value/b.value*100));function z(D){return{off:"mdi mdi-power",auto:"mdi mdi-autorenew",cool:"mdi mdi-snowflake",heat:"mdi mdi-fire",dry:"mdi mdi-water-percent",fan_only:"mdi mdi-fan"}[D]||"mdi mdi-remote"}async function ee(D){if(!u.value){if(!C.value){X.value=!0,window.scrollTo({top:0,behavior:"smooth"});return}X.value=!1,u.value=D.key;try{const d=$.manufacturer.toLowerCase().replace(/[^a-z0-9]+/g,"_"),V=$.model.toLowerCase().replace(/[^a-z0-9]+/g,"_"),ge=`${d}_${V}`,q=(await ne.post("/api/commands/learn",{entity_id:C.value,device:ge,command:D.key,command_type:M.value})).data;if(q.success&&q.code)s.value[D.key]=q.code,h("update:modelValue",s.value),R.value=!0,q.code==="pending"&&console.log(`â³ Command '${D.key}' learned, code will be fetched from storage when saving`),w.value&&t.value.length>0&&setTimeout(()=>{const L=t.value.shift();L?ee(L):w.value=!1},1e3);else throw new Error(q.error||"Failed to learn command")}catch(d){console.error("Error learning command:",d),r.error(`Error learning command: ${d.message}`),w.value=!1,t.value=[]}finally{w.value||(u.value=null)}}}async function H(D){var d;if(!C.value){X.value=!0,window.scrollTo({top:0,behavior:"smooth"});return}if(!s.value[D]){(d=r.value)==null||d.error("Command not learned yet");return}p.value=D;try{const V=s.value[D];await ne.post("/api/commands/send-raw",{entity_id:C.value,command:V,command_type:M.value}),r.success("Command sent successfully")}catch(V){console.error("Error testing command:",V),r.error(`Error testing command: ${V.message}`)}finally{p.value=null}}function ae(D){const d=a.value.find(V=>V.key===D);U.value={show:!0,commandKey:D,commandLabel:d?d.label:D}}function E(){const D=U.value.commandKey;delete s.value[D],h("update:modelValue",s.value),U.value.show=!1}function j(){const D=a.value.filter(V=>!s.value[V.key]);if(D.length===0)return;w.value=!0,t.value=[...D];const d=t.value.shift();d&&ee(d)}function le(){x.value=!0}function ce(){s.value={},h("update:modelValue",s.value),x.value=!1}de(()=>$.modelValue,D=>{s.value={...D}},{deep:!0}),Ae(async()=>{await pe()});async function pe(){try{console.log("SmartIR device - commands will be loaded from SmartIR JSON file, not Broadlink storage")}catch(D){console.error("Error in loadExistingCommands:",D)}}function Ie(){h("update:broadlinkDevice",C.value)}function Me(){h("update:commandType",M.value)}async function xe(){try{console.log("ğŸ” Loading Broadlink devices from /api/remote/devices");const D=await ne.get("/api/remote/devices");console.log("ğŸ“¦ Response data:",D.data);const d=D.data.devices||[];console.log(`âœ… Found ${d.length} devices:`,d),_.value=d}catch(D){console.error("âŒ Error loading remote devices:",D),_.value=[]}}return de(()=>$.broadlinkDevice,D=>{C.value=D}),de(C,D=>{D&&(X.value=!1)}),de(()=>$.commandType,D=>{M.value=D}),Ae(async()=>{await xe(),await pe()}),(D,d)=>(l(),n("div",Br,[d[22]||(d[22]=e("h3",null,"Learn IR Commands",-1)),e("div",Hr,[e("div",{class:Y(["form-group",{"has-error":X.value}])},[d[6]||(d[6]=e("label",null,"Broadlink Device *",-1)),e("div",qr,[K(e("select",{"onUpdate:modelValue":d[0]||(d[0]=V=>C.value=V),onChange:Ie},[d[4]||(d[4]=e("option",{value:""},"Select Broadlink device...",-1)),(l(!0),n(ve,null,ke(_.value,V=>(l(),n("option",{key:V.entity_id,value:V.entity_id},c(V.name||V.entity_id),9,zr))),128))],544),[[Se,C.value]]),X.value?(l(),n("div",Jr,[...d[5]||(d[5]=[e("i",{class:"mdi mdi-alert"},null,-1),I(" Device is required ",-1)])])):T("",!0)]),e("small",null,"This device will be used to learn commands ("+c(_.value.length)+" devices found)",1)],2),e("div",Wr,[d[8]||(d[8]=e("label",null,"Command Type *",-1)),K(e("select",{"onUpdate:modelValue":d[1]||(d[1]=V=>M.value=V),onChange:Me,disabled:v.value>0},[...d[7]||(d[7]=[e("option",{value:"ir"},"ğŸ“¡ Infrared (IR) - Most common for AC, TV, etc.",-1),e("option",{value:"rf"},"ğŸ“» Radio Frequency (RF) - For RF remotes",-1)])],40,Gr),[[Se,M.value]]),v.value>0?(l(),n("small",Kr,"Command type cannot be changed after learning commands")):(l(),n("small",Xr,"Select the type of commands your device uses"))])]),v.value>0&&!R.value?(l(),n("div",Yr,[d[10]||(d[10]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[d[9]||(d[9]=e("strong",null,"Editing Existing Profile",-1)),e("p",null,c(v.value)+" command"+c(v.value!==1?"s":"")+' already learned. You can re-learn any command by clicking the delete icon and then "Learn Command".',1)])])):T("",!0),e("div",Zr,[d[14]||(d[14]=e("i",{class:"mdi mdi-information"},null,-1)),e("div",null,[d[13]||(d[13]=e("p",null,[e("strong",null,"How it works:")],-1)),o.commandType==="ir"?(l(),n("ol",Qr,[...d[11]||(d[11]=[e("li",null,'Click "Learn Command" for each combination',-1),e("li",null,[e("strong",null,"Point your IR remote directly at the Broadlink device")],-1),e("li",null,"Press the button on your remote",-1),e("li",null,"Wait for confirmation (up to 30 seconds)",-1)])])):(l(),n("ol",ed,[...d[12]||(d[12]=[e("li",null,'Click "Learn Command" for each combination',-1),e("li",null,[e("strong",null,"Step 1:"),I(" Hold button on remote - Broadlink scans for RF frequency")],-1),e("li",null,[e("strong",null,"Step 2:"),I(" Watch for Home Assistant notification, then press and release button")],-1),e("li",null,"Keep remote within 5cm of Broadlink (RF doesn't need line-of-sight)",-1),e("li",null,"Wait for confirmation (may take up to 30 seconds)",-1)])]))])]),e("div",td,[e("div",od,[e("div",{class:"progress-fill",style:rt({width:O.value+"%"})},null,4)]),e("span",ld,c(v.value)+" / "+c(b.value)+" commands learned ("+c(O.value)+"%) ",1)]),e("div",nd,[(l(!0),n(ve,null,ke(a.value,V=>(l(),n("div",{key:V.key,class:Y(["command-card",{learned:s.value[V.key],learning:u.value===V.key}])},[e("div",sd,[e("div",ad,[e("i",{class:Y(V.icon)},null,2)]),e("div",id,[e("h4",null,c(V.label),1),e("p",null,c(V.description),1)])]),u.value===V.key?(l(),n("div",rd,[o.commandType==="ir"?(l(),n("div",dd,[...d[15]||(d[15]=[e("p",null,[e("strong",null,"Point your remote directly at the Broadlink device and press the button.")],-1),e("small",null,"Listening for up to 30 seconds...",-1)])])):(l(),n("div",ud,[...d[16]||(d[16]=[e("p",{class:"rf-title"},[e("strong",null,"Learning request sent to device.")],-1),e("p",{class:"rf-subtitle"},[I("RF learning is a "),e("strong",null,"two-step process"),I(":")],-1),e("ol",null,[e("li",null,[e("strong",null,"Step 1 - Frequency Sweep (~10-15 seconds):"),I(" Press and hold the button on your remote until the notification updates. ")]),e("li",null,[e("strong",null,"Step 2 - Learn Signal:"),I(" Press and release the button once. ")])],-1),e("p",{class:"rf-note"},"Follow the Home Assistant notifications (ğŸ””) for real-time instructions.",-1)])]))])):T("",!0),e("div",cd,[s.value[V.key]?(l(),n("div",vd,[d[18]||(d[18]=e("i",{class:"mdi mdi-check-circle"},null,-1)),d[19]||(d[19]=e("span",null,"Learned",-1)),e("span",{class:Y(["command-type-badge",M.value])},c(M.value.toUpperCase()),3),e("button",{onClick:ge=>H(V.key),class:"icon-btn",title:"Test command",disabled:p.value===V.key,style:{"margin-left":"auto"}},[e("i",{class:Y(["mdi mdi-play",{"mdi-spin":p.value===V.key}])},null,2)],8,pd),e("button",{onClick:ge=>ae(V.key),class:"icon-btn danger",title:"Delete and re-learn"},[...d[17]||(d[17]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,fd)])):(l(),n("button",{key:0,onClick:ge=>ee(V),class:Y(["btn-learn",{learning:u.value===V.key}]),disabled:u.value!==null},[e("i",{class:Y(["mdi mdi-radio-tower",{"mdi-spin":u.value===V.key}])},null,2),I(" "+c(u.value===V.key?"Listening...":"Learn Command"),1)],10,md))])],2))),128))]),e("div",gd,[e("button",{onClick:j,class:"btn-secondary",disabled:u.value!==null||v.value===b.value},[...d[20]||(d[20]=[e("i",{class:"mdi mdi-play-circle"},null,-1),I(" Learn All Remaining ",-1)])],8,yd),e("button",{onClick:le,class:"btn-text",disabled:v.value===0},[...d[21]||(d[21]=[e("i",{class:"mdi mdi-delete-sweep"},null,-1),I(" Clear All ",-1)])],8,bd)]),be(Ue,{isOpen:U.value.show,title:"Delete Learned Command?",message:`Are you sure you want to delete the '${U.value.commandLabel}' command?

You will need to re-learn this command.`,confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,onConfirm:E,onCancel:d[2]||(d[2]=V=>U.value.show=!1)},null,8,["isOpen","message"]),be(Ue,{isOpen:x.value,title:"Delete All Learned Commands?",message:"Are you sure you want to delete all learned commands? This cannot be undone.\\n\\nYou will need to re-learn all commands.",confirmText:"Delete All",cancelText:"Cancel",dangerMode:!0,onConfirm:ce,onCancel:d[3]||(d[3]=V=>x.value=!1)},null,8,["isOpen"])]))}},kd=we(hd,[["__scopeId","data-v-9a9e9e51"]]),wd={class:"profile-preview"},$d={class:"preview-summary"},Cd={class:"summary-card"},_d={class:"stats-grid"},Sd={class:"stat-item"},Id={class:"stat-value"},Dd={class:"stat-item"},xd={class:"stat-value"},Td={class:"stat-item"},Md={class:"stat-value"},Rd={class:"preview-tabs"},Ld={class:"preview-content"},Ad={key:0,class:"tab-content"},Ed={class:"code-header"},Od={class:"code-block"},Vd={key:1,class:"tab-content"},Ud={class:"code-header"},Pd={class:"code-block"},Fd={key:2,class:"tab-content"},jd={class:"instructions"},Nd={class:"step-item"},Bd={class:"step-content"},Hd={class:"code-path"},qd={__name:"ProfilePreview",props:{profile:{type:Object,required:!0},jsonData:{type:Object,required:!0},yamlConfig:{type:String,required:!0}},setup(o){const m=je(),r=o,$=g("json"),h=g(!1),s=g(!1),u=W(()=>Object.keys(r.profile.commands||{}).length),p=W(()=>JSON.stringify(r.jsonData,null,2));async function _(){try{await navigator.clipboard.writeText(p.value),h.value=!0,setTimeout(()=>{h.value=!1},2e3)}catch(M){console.error("Failed to copy JSON:",M),m.error("Failed to copy to clipboard")}}async function C(){try{await navigator.clipboard.writeText(r.yamlConfig),s.value=!0,setTimeout(()=>{s.value=!1},2e3)}catch(M){console.error("Failed to copy YAML:",M),m.error("Failed to copy to clipboard")}}return(M,w)=>{var t;return l(),n("div",wd,[w[22]||(w[22]=e("h3",null,"Preview & Save",-1)),e("div",$d,[e("div",Cd,[w[4]||(w[4]=e("i",{class:"mdi mdi-check-circle"},null,-1)),e("div",null,[w[3]||(w[3]=e("h4",null,"Profile Ready!",-1)),e("p",null,c(o.profile.manufacturer)+" "+c(o.profile.model),1)])]),e("div",_d,[e("div",Sd,[e("span",Id,c(u.value),1),w[5]||(w[5]=e("span",{class:"stat-label"},"Commands Learned",-1))]),e("div",Dd,[e("span",xd,c(o.profile.platform),1),w[6]||(w[6]=e("span",{class:"stat-label"},"Platform",-1))]),e("div",Td,[e("span",Md,c(((t=o.profile.config.modes)==null?void 0:t.length)||0),1),w[7]||(w[7]=e("span",{class:"stat-label"},"HVAC Modes",-1))])])]),e("div",Rd,[e("button",{onClick:w[0]||(w[0]=R=>$.value="json"),class:Y(["tab-button",{active:$.value==="json"}])},[...w[8]||(w[8]=[e("i",{class:"mdi mdi-code-json"},null,-1),I(" SmartIR JSON ",-1)])],2),e("button",{onClick:w[1]||(w[1]=R=>$.value="yaml"),class:Y(["tab-button",{active:$.value==="yaml"}])},[...w[9]||(w[9]=[e("i",{class:"mdi mdi-file-code"},null,-1),I(" YAML Config ",-1)])],2),e("button",{onClick:w[2]||(w[2]=R=>$.value="instructions"),class:Y(["tab-button",{active:$.value==="instructions"}])},[...w[10]||(w[10]=[e("i",{class:"mdi mdi-information"},null,-1),I(" Instructions ",-1)])],2)]),e("div",Ld,[$.value==="json"?(l(),n("div",Ad,[e("div",Ed,[w[12]||(w[12]=e("h4",null,"SmartIR Device Code JSON",-1)),e("button",{onClick:_,class:"btn-copy"},[w[11]||(w[11]=e("i",{class:"mdi mdi-content-copy"},null,-1)),I(" "+c(h.value?"Copied!":"Copy"),1)])]),e("pre",Od,[e("code",null,c(p.value),1)]),w[13]||(w[13]=e("p",{class:"code-note"},[e("i",{class:"mdi mdi-information"}),I(" Save this as "),e("code",null,"10000.json"),I(" in your SmartIR codes directory ")],-1))])):T("",!0),$.value==="yaml"?(l(),n("div",Vd,[e("div",Ud,[w[15]||(w[15]=e("h4",null,"Home Assistant Configuration",-1)),e("button",{onClick:C,class:"btn-copy"},[w[14]||(w[14]=e("i",{class:"mdi mdi-content-copy"},null,-1)),I(" "+c(s.value?"Copied!":"Copy"),1)])]),e("pre",Pd,[e("code",null,c(o.yamlConfig),1)]),w[16]||(w[16]=e("p",{class:"code-note"},[e("i",{class:"mdi mdi-information"}),I(" Add this to your "),e("code",null,"configuration.yaml"),I(" file ")],-1))])):T("",!0),$.value==="instructions"?(l(),n("div",Fd,[e("div",jd,[w[20]||(w[20]=e("h4",null,"Installation Steps",-1)),e("div",Nd,[w[19]||(w[19]=e("div",{class:"step-number"},"1",-1)),e("div",Bd,[w[17]||(w[17]=e("h5",null,"Get Next Code Number",-1)),w[18]||(w[18]=e("p",null,"Custom device codes start at 10000. Check your SmartIR codes directory to find the next available number.",-1)),e("div",Hd,[e("code",null,"/config/custom_components/smartir/codes/"+c(o.profile.platform)+"/",1)])])]),w[21]||(w[21]=Pe('<div class="step-item" data-v-e7b997c8><div class="step-number" data-v-e7b997c8>2</div><div class="step-content" data-v-e7b997c8><h5 data-v-e7b997c8>Save JSON File</h5><p data-v-e7b997c8>Copy the JSON from the &quot;SmartIR JSON&quot; tab and save it as <code data-v-e7b997c8>10000.json</code> (or your next available number) in the codes directory.</p></div></div><div class="step-item" data-v-e7b997c8><div class="step-number" data-v-e7b997c8>3</div><div class="step-content" data-v-e7b997c8><h5 data-v-e7b997c8>Update Configuration</h5><p data-v-e7b997c8>Copy the YAML from the &quot;YAML Config&quot; tab and add it to your <code data-v-e7b997c8>configuration.yaml</code> file. Update the <code data-v-e7b997c8>device_code</code> to match your JSON filename.</p></div></div><div class="step-item" data-v-e7b997c8><div class="step-number" data-v-e7b997c8>4</div><div class="step-content" data-v-e7b997c8><h5 data-v-e7b997c8>Restart Home Assistant</h5><p data-v-e7b997c8>Restart Home Assistant to load the new configuration. Your climate entity will appear in the UI.</p></div></div><div class="step-item" data-v-e7b997c8><div class="step-number" data-v-e7b997c8>5</div><div class="step-content" data-v-e7b997c8><h5 data-v-e7b997c8>Test Your Device</h5><p data-v-e7b997c8>Go to your climate entity and test different modes, temperatures, and fan speeds to ensure everything works correctly.</p></div></div><div class="tips-section" data-v-e7b997c8><h4 data-v-e7b997c8><i class="mdi mdi-lightbulb" data-v-e7b997c8></i> Tips </h4><ul data-v-e7b997c8><li data-v-e7b997c8>Keep a backup of your JSON file in case you need to modify it</li><li data-v-e7b997c8>Test all commands to ensure they work as expected</li><li data-v-e7b997c8>You can share your profile with the SmartIR community on GitHub</li><li data-v-e7b997c8>If a command doesn&#39;t work, you can re-learn it and update the JSON</li></ul></div>',5))])])):T("",!0)])])}}},zd=we(qd,[["__scopeId","data-v-e7b997c8"]]),Jd={class:"wizard-body"},Wd={key:0,class:"warning-section"},Gd={class:"warning-box"},Kd={class:"instructions"},Xd={class:"code-block"},Yd={class:"steps"},Zd={key:0},Qd={class:"help-section"},eu={key:0,class:"help-content"},tu={class:"help-step"},ou={key:0,class:"help-step"},lu={class:"help-step"},nu={class:"help-step"},su={class:"checklist"},au={class:"checkbox-label"},iu={key:0,class:"checkbox-label"},ru={class:"wizard-footer"},du=["disabled"],uu={__name:"SmartIRSetupWizard",props:{show:{type:Boolean,default:!1},platform:{type:String,required:!0},warnings:{type:Array,default:()=>[]},configPath:{type:String,default:"/config"}},emits:["close","complete"],setup(o,{emit:m}){const r=o,$=m,h=Te("toast"),s=g(!1),u=g(!1),p=g(!1),_=W(()=>r.warnings.length>0?s.value&&u.value:s.value);function C(){const w=`${r.platform}: !include smartir/${r.platform}.yaml`;navigator.clipboard.writeText(w).then(()=>{var t;(t=h.value)==null||t.success("Include line copied to clipboard!","âœ… Copied")}).catch(t=>{var R;console.error("Failed to copy:",t),(R=h.value)==null||R.error("Failed to copy to clipboard","âŒ Copy Failed")})}function M(){$("complete")}return(w,t)=>o.show?(l(),n("div",{key:0,class:"modal-overlay",onClick:t[5]||(t[5]=he(()=>{},["stop"]))},[e("div",{class:"setup-wizard",onClick:t[4]||(t[4]=he(()=>{},["stop"]))},[t[31]||(t[31]=e("div",{class:"wizard-header"},[e("h2",null,[e("i",{class:"mdi mdi-cog"}),I(" SmartIR Configuration Setup ")])],-1)),e("div",Jd,[o.warnings.length>0?(l(),n("div",Wd,[e("div",Gd,[t[11]||(t[11]=e("i",{class:"mdi mdi-alert"},null,-1)),e("div",null,[t[9]||(t[9]=e("h3",null,"âš ï¸ Configuration Migration Needed",-1)),t[10]||(t[10]=e("p",null,"We detected existing platform entries in your configuration.yaml:",-1)),e("ul",null,[(l(!0),n(ve,null,ke(o.warnings,R=>(l(),n("li",{key:R.platform},[e("strong",null,c(R.platform)+":",1),I(" "+c(R.message),1)]))),128))]),e("p",null,[t[6]||(t[6]=e("strong",null,"Action Required:",-1)),t[7]||(t[7]=I(" Move these entries to ",-1)),e("code",null,"smartir/"+c(o.platform)+".yaml",1),t[8]||(t[8]=I(" before continuing.",-1))])])])])):T("",!0),e("div",Kd,[t[27]||(t[27]=e("h3",null,"ğŸ“ One-Time Setup",-1)),t[28]||(t[28]=e("p",null,[I("To enable SmartIR device management, add this line to your "),e("code",null,"configuration.yaml"),I(":")],-1)),e("div",Xd,[e("code",null,c(o.platform)+": !include smartir/"+c(o.platform)+".yaml",1),e("button",{onClick:C,class:"copy-btn",title:"Copy to clipboard"},[...t[12]||(t[12]=[e("i",{class:"mdi mdi-content-copy"},null,-1)])])]),e("div",Yd,[t[19]||(t[19]=e("h4",null,"Steps:",-1)),e("ol",null,[o.warnings.length>0?(l(),n("li",Zd,[t[13]||(t[13]=e("strong",null,"Move existing entries:",-1)),t[14]||(t[14]=I(" Copy any existing ",-1)),e("code",null,c(o.platform)+":",1),t[15]||(t[15]=I(" entries from configuration.yaml to ",-1)),e("code",null,"smartir/"+c(o.platform)+".yaml",1)])):T("",!0),t[16]||(t[16]=e("li",null,[e("strong",null,"Add include line:"),I(" Add the line above to your configuration.yaml ")],-1)),t[17]||(t[17]=e("li",null,[e("strong",null,"Save changes:"),I(" Save configuration.yaml ")],-1)),t[18]||(t[18]=e("li",null,[e("strong",null,"Continue here:"),I(` Click "I've Completed Setup" below `)],-1))])]),e("div",Qd,[e("button",{onClick:t[0]||(t[0]=R=>p.value=!p.value),class:"help-toggle"},[e("i",{class:Y(["mdi",p.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2),I(" "+c(p.value?"Hide":"Show")+" Detailed Instructions ",1)]),p.value?(l(),n("div",eu,[t[26]||(t[26]=e("h4",null,"Detailed Setup Guide:",-1)),e("div",tu,[t[21]||(t[21]=e("h5",null,"1. Open configuration.yaml",-1)),e("p",null,[t[20]||(t[20]=I("Location: ",-1)),e("code",null,c(o.configPath)+"/configuration.yaml",1)])]),o.warnings.length>0?(l(),n("div",ou,[t[22]||(t[22]=e("h5",null,"2. Migrate Existing Entries (If Any)",-1)),e("p",null,"If you have existing "+c(o.platform)+" entries, cut them from configuration.yaml and paste into:",1),e("p",null,[e("code",null,c(o.configPath)+"/smartir/"+c(o.platform)+".yaml",1)]),t[23]||(t[23]=e("p",{class:"note"},"Broadlink Manager will create this file automatically.",-1))])):T("",!0),e("div",lu,[e("h5",null,c(o.warnings.length>0?"3":"2")+". Add Include Line",1),t[24]||(t[24]=e("p",null,"Add this to configuration.yaml:",-1)),e("pre",null,c(o.platform)+": !include smartir/"+c(o.platform)+".yaml",1)]),e("div",nu,[e("h5",null,c(o.warnings.length>0?"4":"3")+". Restart Home Assistant",1),t[25]||(t[25]=e("p",null,"After saving, you'll need to restart HA for changes to take effect.",-1))])])):T("",!0)])]),e("div",su,[e("label",au,[K(e("input",{type:"checkbox","onUpdate:modelValue":t[1]||(t[1]=R=>s.value=R)},null,512),[[fe,s.value]]),t[29]||(t[29]=e("span",null,"I've added the include line to configuration.yaml",-1))]),o.warnings.length>0?(l(),n("label",iu,[K(e("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=R=>u.value=R)},null,512),[[fe,u.value]]),e("span",null,"I've migrated existing "+c(o.platform)+" entries (if any)",1)])):T("",!0)])]),e("div",ru,[e("button",{onClick:t[3]||(t[3]=R=>w.$emit("close")),class:"btn-secondary"}," Cancel "),e("button",{onClick:M,class:"btn-primary",disabled:!_.value},[...t[30]||(t[30]=[e("i",{class:"mdi mdi-check"},null,-1),I(" I've Completed Setup ",-1)])],8,du)])])])):T("",!0)}},cu=we(uu,[["__scopeId","data-v-f6fe4c03"]]),mu={class:"modal-header"},vu={class:"progress-steps"},pu={class:"step-number"},fu={key:0,class:"mdi mdi-check"},gu={key:1},yu={class:"step-label"},bu={class:"modal-body"},hu={key:0,class:"step-content"},ku={class:"form-group"},wu={class:"form-group"},$u={class:"form-group"},Cu={key:1,class:"step-content"},_u={key:1,class:"platform-form"},Su={class:"form-section"},Iu={class:"checkbox-grid"},Du={class:"checkbox-item"},xu={class:"checkbox-item"},Tu={class:"checkbox-item"},Mu={class:"checkbox-item"},Ru={class:"checkbox-item"},Lu={key:2,class:"platform-form"},Au={class:"form-section"},Eu={class:"form-group"},Ou={class:"form-section"},Vu={class:"checkbox-grid"},Uu={class:"checkbox-item"},Pu={class:"checkbox-item"},Fu={key:3,class:"platform-form"},ju={class:"form-section"},Nu={class:"checkbox-grid"},Bu={class:"checkbox-item"},Hu={class:"checkbox-item"},qu={class:"checkbox-item"},zu={class:"checkbox-item"},Ju={key:2,class:"step-content"},Wu={key:3,class:"step-content"},Gu={class:"modal-footer"},Ku=["disabled"],Xu={key:2,class:"save-buttons"},Yu=["disabled"],Zu=["disabled"],Qu={__name:"SmartIRProfileBuilder",props:{show:{type:Boolean,default:!1},editMode:{type:Boolean,default:!1},editData:{type:Object,default:null},startStep:{type:Number,default:0}},emits:["close","save"],setup(o,{emit:m}){const r=o,$=m,h=Te("toast"),s=g(0),u=g(!1),p=g([]),_=g(!1),C=g([]),M=g("/config"),w=g(!1),t=g(null),R=g(!1),X=g(!1),U=g(""),x=g("ir"),a=g(!1),b=[{label:"Device Info",key:"info"},{label:"Configuration",key:"config"},{label:"Learn Commands",key:"commands"},{label:"Preview & Save",key:"preview"}],v=g({platform:"",manufacturer:"",model:"",broadlinkDevice:"",commandType:"ir",config:{},commands:{}}),O=g(["turn_on"]),z=g(3),ee=g([]),H=g(["turn_on"]);de(()=>v.value.platform,A=>{A==="media_player"?v.value.config={features:O.value}:A==="fan"?v.value.config={speedLevels:z.value,features:ee.value}:A==="light"&&(v.value.config={features:H.value})}),de(O,A=>{v.value.platform==="media_player"&&(v.value.config={features:A})},{deep:!0}),de(z,A=>{v.value.platform==="fan"&&(v.value.config={speedLevels:A,features:ee.value})}),de(ee,A=>{v.value.platform==="fan"&&(v.value.config={speedLevels:z.value,features:A})},{deep:!0}),de(H,A=>{v.value.platform==="light"&&(v.value.config={features:A})},{deep:!0});function ae(A){const i=new Set,P=Object.keys(A);return P.some(Z=>Z==="off"||Z.includes("_off"))&&i.add("off"),P.some(Z=>Z.includes("auto"))&&i.add("auto"),P.some(Z=>Z.includes("cool"))&&i.add("cool"),P.some(Z=>Z.includes("heat"))&&i.add("heat"),P.some(Z=>Z.includes("dry"))&&i.add("dry"),P.some(Z=>Z.includes("fan_only"))&&i.add("fan_only"),Array.from(i)}function E(A){const i=new Set,P=Object.keys(A);return P.some(Z=>Z.includes("auto"))&&i.add("auto"),P.some(Z=>Z.includes("low"))&&i.add("low"),P.some(Z=>Z.includes("medium")||Z.includes("mid"))&&i.add("medium"),P.some(Z=>Z.includes("high"))&&i.add("high"),Array.from(i)}function j(A){const i=new Set,P=Object.keys(A);return P.some(Z=>Z.includes("swing_off")||Z.includes("_off"))&&i.add("off"),P.some(Z=>Z.includes("vertical"))&&i.add("vertical"),P.some(Z=>Z.includes("horizontal"))&&i.add("horizontal"),P.some(Z=>Z.includes("both"))&&i.add("both"),Array.from(i)}function le(A){for(const i of Object.values(A))if(typeof i=="string"&&i.startsWith("sc")||Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0].startsWith("sc"))return"rf";return"ir"}de(()=>v.value.commandType,(A,i)=>{!i||R.value||a.value||(Object.keys(v.value.commands).length>0&&A!==i?(U.value=A,v.value.commandType=i,R.value=!0):A!==i&&(x.value=A))}),de(()=>r.editData,async A=>{var i,P,Z;if(A&&r.editMode){console.log("ğŸ”§ Edit mode activated, loading profile data:",A),a.value=!0,p.value.length===0&&(console.log("ğŸ“¡ Loading Broadlink devices..."),await te(),console.log("ğŸ“¡ Devices loaded:",p.value.length));const ie=A.profile,ue=ie.controller_data;console.log("ğŸ® Controller data from profile:",ue),console.log("ğŸ® Available devices:",p.value.map(S=>S.entity_id));const N=ie.commands||{},De=ie.commandType||le(N);console.log("ğŸ” Command type (stored):",ie.commandType),console.log("ğŸ” Command type (final):",De);let Ce={};if(A.platform==="climate"){const S=ie.operationModes||ae(N),k=ie.fanModes||E(N),F=ie.swingModes||j(N);console.log("ğŸ” Inferred modes:",S),console.log("ğŸ” Inferred fan modes:",k),console.log("ğŸ” Inferred swing modes:",F),Ce={minTemp:ie.minTemperature,maxTemp:ie.maxTemperature,precision:ie.precision,modes:S,fanModes:k,swingModes:F}}else if(A.platform==="media_player"){const S=[];(N.on||N.off)&&S.push("turn_on"),(N.volumeUp||N.volumeDown)&&S.push("volume"),N.mute&&S.push("mute"),N.sources&&S.push("source"),(N.channelUp||N.channelDown)&&S.push("channel"),Ce={features:S},O.value=S,console.log("ğŸ” Inferred media player features:",S)}else if(A.platform==="fan"){const S=((i=ie.speed)==null?void 0:i.length)||Object.keys(N.default||{}).length||3,k=[];(N.oscillate_on||N.oscillate_off)&&k.push("oscillate"),(N.direction_forward||N.direction_reverse)&&k.push("direction"),Ce={speedLevels:S,features:k},z.value=S,ee.value=k,console.log("ğŸ” Inferred fan config:",Ce)}else if(A.platform==="light"){const S=[];Ce={features:S},H.value=S,console.log("ğŸ” Inferred light features:",S)}const Re=await f(ie.manufacturer,(P=ie.supportedModels)==null?void 0:P[0],N);v.value={platform:A.platform,manufacturer:ie.manufacturer||"",model:((Z=ie.supportedModels)==null?void 0:Z[0])||"",broadlinkDevice:ue||"",commandType:De,config:Ce,commands:Re},console.log("âœ… Profile populated:",v.value),console.log("âœ… Selected device:",v.value.broadlinkDevice),console.log("âœ… Command type:",v.value.commandType),console.log("âœ… Commands (with learned codes):",Re),x.value=De,setTimeout(()=>{a.value=!1},100)}},{immediate:!0});const ce=W(()=>{var A;switch(s.value){case 0:return v.value.platform&&v.value.manufacturer&&v.value.model;case 1:return v.value.platform==="climate"?v.value.config.minTemp&&v.value.config.maxTemp&&((A=v.value.config.modes)==null?void 0:A.length)>0:!0;case 2:return v.value.broadlinkDevice&&v.value.commandType&&Object.keys(v.value.commands).length>0;case 3:return!0;default:return!1}}),pe=g(null);async function Ie(){if(s.value!==3){pe.value=null;return}if(console.log("ğŸ” Generating JSON with commands:",v.value.commands),Object.values(v.value.commands).some(i=>typeof i=="string"?i==="pending":typeof i=="object"?Object.values(i).some(P=>typeof P=="string"?P==="pending":typeof P=="object"?Object.values(P).some(Z=>Z==="pending"):!1):!1)){console.warn('âš ï¸ Commands still contain "pending" placeholders!'),console.log("ğŸ“¦ Attempting to fetch from Broadlink storage...");const i=await f(v.value.manufacturer,v.value.model,v.value.commands);v.value.commands=i,console.log("âœ… Updated commands:",i)}pe.value=y(v.value),console.log("ğŸ“„ Generated JSON:",pe.value)}const Me=W(()=>s.value!==3?null:B(v.value));function xe(){v.value.config={},v.value.commands={}}function D(){R.value=!1,v.value.commandType=U.value,x.value=U.value,v.value.commands={},U.value=""}function d(){R.value=!1,U.value=""}async function V(){s.value<b.length-1&&(s.value++,s.value===3&&await Ie())}function ge(){s.value>0&&s.value--}function Ee(){R.value||(X.value=!0)}function q(){X.value=!1,L()}function L(){$("close"),setTimeout(()=>{s.value=0,v.value={platform:"",manufacturer:"",model:"",broadlinkDevice:"",commandType:"ir",config:{},commands:{}},x.value="ir"},300)}async function Q(){var A,i,P,Z,ie,ue;u.value=!0;try{if(!w.value){const k=(await ne.get("/api/smartir/config/check")).data;if(k&&!((A=k.platforms[v.value.platform])==null?void 0:A.file_exists)){C.value=k.configuration_warnings||[],M.value=k.config_path||"/config",t.value={platform:v.value.platform,json:pe.value},_.value=!0,u.value=!1;return}}let N;r.editMode&&((i=r.editData)!=null&&i.code)?(N=parseInt(r.editData.code),console.log("ğŸ“ Edit mode: Using existing code",N)):(N=(await ne.get(`/api/smartir/platforms/${v.value.platform}/next-code`)).data.next_code,console.log("âœ¨ New profile: Using next code",N));const Ce=(await ne.post("/api/smartir/profiles",{platform:v.value.platform,json:pe.value,code_number:N})).data,Re={platform:"smartir",name:`${v.value.manufacturer} ${v.value.model}`,unique_id:`${v.value.manufacturer.toLowerCase().replace(/[^a-z0-9]+/g,"_")}_${v.value.model.toLowerCase().replace(/[^a-z0-9]+/g,"_")}`,device_code:N,controller_data:v.value.broadlinkDevice};try{await ne.post("/api/smartir/config/add-device",{platform:v.value.platform,device_config:{platform:"smartir",name:Re.name,unique_id:Re.unique_id,device_code:Re.device_code,controller_data:Re.controller_data}})}catch(S){console.error("Failed to add device to config:",S);const k=((P=S.response)==null?void 0:P.data)||{};let F=k.error||"Unknown error";k.validation_errors&&k.validation_errors.length>0&&(F=`Device configuration validation failed:
`+k.validation_errors.map(J=>`  â€¢ ${J}`).join(`
`)),(Z=h.value)==null||Z.warning(`Profile saved but failed to add to config file:
${F}`,"âš ï¸ Partial Success")}$("save",{json:pe.value,yaml:Me.value,profile:v.value,saved_to:Ce.path}),(ie=h.value)==null||ie.success(`File: ${Ce.filename}
Device Code: ${N}
Added to: smartir/${v.value.platform}.yaml

âš ï¸ Restart Home Assistant to activate`,"âœ… Profile Saved Successfully!"),L()}catch(N){console.error("Error saving profile:",N),(ue=h.value)==null||ue.error(N.message,"âŒ Error Saving Profile")}finally{u.value=!1}}async function se(){w.value=!0,_.value=!1,t.value&&(await Q(),t.value=null)}function G(){var A,i;try{const P=JSON.stringify(pe.value,null,2),Z=new Blob([P],{type:"application/json"}),ie=URL.createObjectURL(Z),ue=document.createElement("a");ue.href=ie;const N=v.value.manufacturer.toLowerCase().replace(/\s+/g,"_"),De=v.value.model.toLowerCase().replace(/\s+/g,"_");ue.download=`smartir_${v.value.platform}_${N}_${De}.json`,document.body.appendChild(ue),ue.click(),document.body.removeChild(ue),URL.revokeObjectURL(ie),(A=h.value)==null||A.success("You can manually upload this file to your SmartIR codes directory.","âœ… Profile Downloaded")}catch(P){console.error("Error downloading profile:",P),(i=h.value)==null||i.error(P.message,"âŒ Error Downloading Profile")}}async function f(A,i,P){const Z=A.toLowerCase().replace(/[^a-z0-9]+/g,"_"),ie=i.toLowerCase().replace(/[^a-z0-9]+/g,"_"),ue=`${Z}_${ie}`;try{const Ce=(await ne.get("/api/commands/all")).data[ue]||{};console.log(`ğŸ” Fetching learned commands for device: ${ue}`),console.log("ğŸ“¦ Device commands from storage:",Ce);const Re={...P};for(const[S,k]of Object.entries(Re))if(k==="pending"&&Ce[S])Re[S]=Ce[S];else if(typeof k=="object"){for(const[F,J]of Object.entries(k))if(typeof J=="object")for(const[oe,ye]of Object.entries(J)){const me=`${S}_${F}_${oe}`;ye==="pending"&&Ce[me]&&(Re[S][F][oe]=Ce[me])}else if(J==="pending"){const oe=`${S}_${F}`;Ce[oe]&&(Re[S][F]=Ce[oe])}}return console.log("âœ… Merged commands:",Re),Re}catch(N){return console.error("Error fetching learned commands:",N),P}}function y(A){const i={manufacturer:A.manufacturer,supportedModels:[A.model],supportedController:"Broadlink",commandsEncoding:"Base64",commandType:A.commandType||"ir",commands:{}};return A.platform==="climate"&&(i.minTemperature=A.config.minTemp,i.maxTemperature=A.config.maxTemp,i.precision=A.config.precision||1,i.operationModes=A.config.modes||[],i.fanModes=A.config.fanModes&&A.config.fanModes.length>0?A.config.fanModes:["auto"],A.config.swingModes&&A.config.swingModes.length>0&&(i.swingModes=A.config.swingModes),i.commands=A.commands),i}function B(A){let i=`# SmartIR ${A.platform} configuration
`;return i+=`# Generated by Broadlink Manager v2

`,A.platform==="climate"&&(i+=`climate:
`,i+=`  - platform: smartir
`,i+=`    name: ${A.manufacturer} ${A.model}
`,i+=`    unique_id: ${A.manufacturer.toLowerCase()}_${A.model.toLowerCase().replace(/\s+/g,"_")}
`,i+=`    device_code: 10000  # Change this to your custom code number
`,i+=`    controller_data: ${A.broadlinkDevice}
`,A.config.tempSensor&&(i+=`    temperature_sensor: ${A.config.tempSensor}
`),A.config.humiditySensor&&(i+=`    humidity_sensor: ${A.config.humiditySensor}
`),A.config.powerSensor&&(i+=`    power_sensor: ${A.config.powerSensor}
`)),i}async function te(){try{console.log("Fetching remote devices from /api/remote/devices...");const A=await ne.get("/api/remote/devices");console.log("Loaded remote devices response:",A.data);const i=A.data.devices||[];console.log("Extracted devices array:",i),console.log("Device count:",i.length),p.value=i,console.log("broadlinkDevices.value set to:",p.value),console.log("Final device count:",p.value.length)}catch(A){console.error("Error loading remote devices:",A),p.value=[]}}return de(()=>r.show,A=>{if(A){const i=Number.isInteger(r.startStep)?r.startStep:0;s.value=Math.min(Math.max(i,0),b.length-1)}}),de(()=>r.startStep,A=>{if(r.show){const i=Number.isInteger(A)?A:0;s.value=Math.min(Math.max(i,0),b.length-1)}}),Ae(()=>{r.show&&te()}),(A,i)=>o.show?(l(),n("div",{key:0,class:"modal-overlay",onClick:Ee},[e("div",{class:"modal-container",onClick:i[19]||(i[19]=he(()=>{},["stop"]))},[e("div",mu,[e("h2",null,[i[22]||(i[22]=e("i",{class:"mdi mdi-file-document-edit"},null,-1)),I(" "+c(o.editMode?"Edit SmartIR Profile":"Create SmartIR Profile"),1)]),e("button",{onClick:L,class:"close-button"},[...i[23]||(i[23]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",vu,[(l(),n(ve,null,ke(b,(P,Z)=>e("div",{key:Z,class:Y(["step",{active:s.value===Z,completed:s.value>Z}])},[e("div",pu,[s.value>Z?(l(),n("i",fu)):(l(),n("span",gu,c(Z+1),1))]),e("span",yu,c(P.label),1)],2)),64))]),e("div",bu,[s.value===0?(l(),n("div",hu,[i[29]||(i[29]=e("h3",null,"Device Information",-1)),e("div",ku,[i[25]||(i[25]=e("label",null,"Platform Type *",-1)),K(e("select",{"onUpdate:modelValue":i[0]||(i[0]=P=>v.value.platform=P),onChange:xe},[...i[24]||(i[24]=[Pe('<option value="" data-v-2e218e9d>Select platform...</option><option value="climate" data-v-2e218e9d>ğŸŒ¡ï¸ Climate (AC, Heater, Heat Pump)</option><option value="media_player" data-v-2e218e9d>ğŸ“º Media Player (TV, Receiver)</option><option value="fan" data-v-2e218e9d>ğŸŒ€ Fan</option><option value="light" data-v-2e218e9d>ğŸ’¡ Light (LED Strip, IR Light)</option>',5)])],544),[[Se,v.value.platform]])]),e("div",wu,[i[26]||(i[26]=e("label",null,"Manufacturer *",-1)),K(e("input",{"onUpdate:modelValue":i[1]||(i[1]=P=>v.value.manufacturer=P),type:"text",placeholder:"e.g., Daikin, LG, Samsung"},null,512),[[Le,v.value.manufacturer]])]),e("div",$u,[i[27]||(i[27]=e("label",null,"Model(s) *",-1)),K(e("input",{"onUpdate:modelValue":i[2]||(i[2]=P=>v.value.model=P),type:"text",placeholder:"e.g., FTXS35K, Multiple models"},null,512),[[Le,v.value.model]]),i[28]||(i[28]=e("small",null,'Enter model number or "Multiple" if it works with many models',-1))])])):T("",!0),s.value===1?(l(),n("div",Cu,[v.value.platform==="climate"?(l(),Oe(Nr,{key:0,modelValue:v.value.config,"onUpdate:modelValue":i[3]||(i[3]=P=>v.value.config=P)},null,8,["modelValue"])):v.value.platform==="media_player"?(l(),n("div",_u,[i[36]||(i[36]=e("h3",null,"Media Player Configuration",-1)),i[37]||(i[37]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),I(" Configure the features your media player supports. You'll learn the IR commands in the next step. ")],-1)),e("div",Su,[i[35]||(i[35]=e("h4",null,"Supported Features",-1)),e("div",Iu,[e("label",Du,[K(e("input",{type:"checkbox",value:"turn_on","onUpdate:modelValue":i[4]||(i[4]=P=>O.value=P)},null,512),[[fe,O.value]]),i[30]||(i[30]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),I(" Power On/Off ")],-1))]),e("label",xu,[K(e("input",{type:"checkbox",value:"volume","onUpdate:modelValue":i[5]||(i[5]=P=>O.value=P)},null,512),[[fe,O.value]]),i[31]||(i[31]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-volume-high"}),I(" Volume Control ")],-1))]),e("label",Tu,[K(e("input",{type:"checkbox",value:"mute","onUpdate:modelValue":i[6]||(i[6]=P=>O.value=P)},null,512),[[fe,O.value]]),i[32]||(i[32]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-volume-mute"}),I(" Mute ")],-1))]),e("label",Mu,[K(e("input",{type:"checkbox",value:"source","onUpdate:modelValue":i[7]||(i[7]=P=>O.value=P)},null,512),[[fe,O.value]]),i[33]||(i[33]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-import"}),I(" Source Selection ")],-1))]),e("label",Ru,[K(e("input",{type:"checkbox",value:"channel","onUpdate:modelValue":i[8]||(i[8]=P=>O.value=P)},null,512),[[fe,O.value]]),i[34]||(i[34]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-numeric"}),I(" Channel Control ")],-1))])])])])):v.value.platform==="fan"?(l(),n("div",Lu,[i[44]||(i[44]=e("h3",null,"Fan Configuration",-1)),i[45]||(i[45]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),I(" Configure the features your fan supports. You'll learn the IR commands in the next step. ")],-1)),e("div",Au,[i[40]||(i[40]=e("h4",null,"Fan Speed Levels",-1)),e("div",Eu,[i[39]||(i[39]=e("label",null,"Number of Speed Levels *",-1)),K(e("select",{"onUpdate:modelValue":i[9]||(i[9]=P=>z.value=P)},[...i[38]||(i[38]=[e("option",{value:1},"1 Speed",-1),e("option",{value:2},"2 Speeds",-1),e("option",{value:3},"3 Speeds (Low/Med/High)",-1),e("option",{value:4},"4 Speeds",-1),e("option",{value:5},"5 Speeds",-1),e("option",{value:6},"6 Speeds",-1)])],512),[[Se,z.value,void 0,{number:!0}]])])]),e("div",Ou,[i[43]||(i[43]=e("h4",null,"Additional Features",-1)),e("div",Vu,[e("label",Uu,[K(e("input",{type:"checkbox",value:"oscillate","onUpdate:modelValue":i[10]||(i[10]=P=>ee.value=P)},null,512),[[fe,ee.value]]),i[41]||(i[41]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-sync"}),I(" Oscillation ")],-1))]),e("label",Pu,[K(e("input",{type:"checkbox",value:"direction","onUpdate:modelValue":i[11]||(i[11]=P=>ee.value=P)},null,512),[[fe,ee.value]]),i[42]||(i[42]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-rotate-3d-variant"}),I(" Direction (Forward/Reverse) ")],-1))])])])])):v.value.platform==="light"?(l(),n("div",Fu,[i[51]||(i[51]=e("h3",null,"Light Configuration",-1)),i[52]||(i[52]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),I(" Configure the features your light supports. You'll learn the IR commands in the next step. ")],-1)),e("div",ju,[i[50]||(i[50]=e("h4",null,"Supported Features",-1)),e("div",Nu,[e("label",Bu,[K(e("input",{type:"checkbox",value:"turn_on","onUpdate:modelValue":i[12]||(i[12]=P=>H.value=P)},null,512),[[fe,H.value]]),i[46]||(i[46]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),I(" Power On/Off ")],-1))]),e("label",Hu,[K(e("input",{type:"checkbox",value:"brightness","onUpdate:modelValue":i[13]||(i[13]=P=>H.value=P)},null,512),[[fe,H.value]]),i[47]||(i[47]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-brightness-6"}),I(" Brightness Control ")],-1))]),e("label",qu,[K(e("input",{type:"checkbox",value:"color_temp","onUpdate:modelValue":i[14]||(i[14]=P=>H.value=P)},null,512),[[fe,H.value]]),i[48]||(i[48]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-thermometer"}),I(" Color Temperature ")],-1))]),e("label",zu,[K(e("input",{type:"checkbox",value:"rgb","onUpdate:modelValue":i[15]||(i[15]=P=>H.value=P)},null,512),[[fe,H.value]]),i[49]||(i[49]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-palette"}),I(" RGB Color ")],-1))])])])])):T("",!0)])):T("",!0),s.value===2?(l(),n("div",Ju,[be(kd,{modelValue:v.value.commands,"onUpdate:modelValue":i[16]||(i[16]=P=>v.value.commands=P),platform:v.value.platform,config:v.value.config,broadlinkDevice:v.value.broadlinkDevice,"onUpdate:broadlinkDevice":i[17]||(i[17]=P=>v.value.broadlinkDevice=P),manufacturer:v.value.manufacturer,model:v.value.model,commandType:v.value.commandType,"onUpdate:commandType":i[18]||(i[18]=P=>v.value.commandType=P)},null,8,["modelValue","platform","config","broadlinkDevice","manufacturer","model","commandType"])])):T("",!0),s.value===3?(l(),n("div",Wu,[be(zd,{profile:v.value,"json-data":pe.value,"yaml-config":Me.value},null,8,["profile","json-data","yaml-config"])])):T("",!0)]),e("div",Gu,[s.value>0?(l(),n("button",{key:0,onClick:ge,class:"btn-secondary"},[...i[53]||(i[53]=[e("i",{class:"mdi mdi-arrow-left"},null,-1),I(" Back ",-1)])])):T("",!0),i[57]||(i[57]=e("div",{class:"spacer"},null,-1)),e("button",{onClick:L,class:"btn-text"}," Cancel "),s.value<b.length-1?(l(),n("button",{key:1,onClick:V,class:"btn-primary",disabled:!ce.value},[...i[54]||(i[54]=[I(" Next ",-1),e("i",{class:"mdi mdi-arrow-right"},null,-1)])],8,Ku)):(l(),n("div",Xu,[e("button",{onClick:Q,class:"btn-primary",disabled:u.value},[i[55]||(i[55]=e("i",{class:"mdi mdi-cloud-upload"},null,-1)),I(" "+c(u.value?"Saving...":"Save to SmartIR"),1)],8,Yu),e("button",{onClick:G,class:"btn-secondary",disabled:u.value},[...i[56]||(i[56]=[e("i",{class:"mdi mdi-download"},null,-1),I(" Download JSON ",-1)])],8,Zu)]))])]),be(cu,{show:_.value,platform:v.value.platform,warnings:C.value,"config-path":M.value,onClose:i[20]||(i[20]=P=>_.value=!1),onComplete:se},null,8,["show","platform","warnings","config-path"]),be(Ue,{isOpen:R.value,title:"Change Command Type?",message:"Changing the command type will clear all learned commands. Continue?",confirmText:"Continue",cancelText:"Cancel",dangerMode:!0,onConfirm:D,onCancel:d},null,8,["isOpen"]),be(Ue,{isOpen:X.value,title:"Close Profile Builder?",message:"Are you sure you want to close? Your progress will be lost.",confirmText:"Close",cancelText:"Keep Editing",dangerMode:!0,onConfirm:q,onCancel:i[21]||(i[21]=P=>X.value=!1)},null,8,["isOpen"])])):T("",!0)}},ec=we(Qu,[["__scopeId","data-v-2e218e9d"]]),tc={class:"dashboard"},oc={key:1,class:"welcome-banner"},lc={__name:"Dashboard",setup(o){const m=je(),r=Te("smartirEnabled"),{isMobile:$}=Xe(),h=g(!1),s=g(!1),u=g(null),p=g(0),_=g(null),C=g(localStorage.getItem("welcome_banner_dismissed")==="true");function M(){C.value=!0,localStorage.setItem("welcome_banner_dismissed","true")}function w(){s.value=!1,u.value=null,p.value=0,h.value=!0}async function t({platform:U,profile:x,startStep:a}){p.value=Number.isInteger(a)?a:0;try{const b=await fetch(`api/smartir/platforms/${U}/profiles/${x.code}`);if(!b.ok)throw new Error("Failed to load profile");const v=await b.json();let O="";try{const z=await fetch(`api/smartir/config/get-device?platform=${U}&code=${x.code}`);z.ok?(O=(await z.json()).controller_data||"",console.log("âœ… Found controller_data from YAML:",O)):console.warn("âš ï¸ No YAML entry found for this profile (this is OK for profiles not yet added to config)")}catch(z){console.warn("âš ï¸ Could not fetch controller_data from config:",z)}s.value=!0,u.value={platform:U,code:x.code,profile:{...v.profile,controller_data:O}},h.value=!0}catch(b){console.error("Error loading profile for edit:",b),m.error("Failed to load profile for editing")}}function R(){h.value=!1,s.value=!1,u.value=null}async function X(U){console.log("Profile saved:",U),R(),_.value&&_.value.loadAllProfiles&&(await _.value.loadAllProfiles(),console.log("âœ… Profiles list refreshed"))}return(U,x)=>(l(),n("div",tc,[$e(r)?(l(),Oe(Ws,{key:0})):T("",!0),!$e($)&&!C.value?(l(),n("div",oc,[e("button",{class:"dismiss-button",onClick:M,title:"Dismiss"},[...x[0]||(x[0]=[e("i",{class:"mdi mdi-close"},null,-1)])]),x[1]||(x[1]=Pe('<div class="banner-content" data-v-12185d74><div class="banner-icon" data-v-12185d74><i class="mdi mdi-rocket-launch" data-v-12185d74></i></div><div class="banner-text" data-v-12185d74><h2 data-v-12185d74>Welcome to Broadlink Manager v2!</h2><p data-v-12185d74>Manage your IR/RF devices with a modern Vue 3 interface</p></div></div><div class="status-badges" data-v-12185d74><span class="badge success" data-v-12185d74><i class="mdi mdi-check-circle" data-v-12185d74></i> Vue 3 Ready </span><span class="badge warning" data-v-12185d74><i class="mdi mdi-beta" data-v-12185d74></i> Beta </span></div>',2))])):T("",!0),be(Ns),$e(r)?(l(),Oe(zi,{key:2,ref_key:"smartirStatusCard",ref:_,onCreateProfile:w,onEditProfile:t},null,512)):T("",!0),be(ec,{show:h.value,editMode:s.value,editData:u.value,startStep:p.value,onClose:R,onSave:X},null,8,["show","editMode","editData","startStep"])]))}},nc=we(lc,[["__scopeId","data-v-12185d74"]]),sc={class:"toast-container"},ac={class:"toast-content"},ic={key:0,class:"toast-title"},rc={class:"toast-message"},dc={key:1,class:"toast-description"},uc=["onClick","title"],cc={__name:"Toast",setup(o,{expose:m}){const r=g([]);let $=0;function h(p){const _={success:"mdi-check-circle",error:"mdi-alert-circle",warning:"mdi-alert",info:"mdi-information"};return _[p]||_.info}function s({message:p,title:_,description:C,type:M="info",duration:w=5e3}){const t=$++,R={id:t,message:p,title:_,description:C,type:M};return r.value.push(R),w>0&&setTimeout(()=>{u(t)},w),t}function u(p){const _=r.value.findIndex(C=>C.id===p);_>-1&&r.value.splice(_,1)}return m({addToast:s,removeToast:u,show:s,success:(p,_)=>s({message:p,title:_,type:"success"}),error:(p,_)=>s({message:p,title:_,type:"error",duration:0}),warning:(p,_)=>s({message:p,title:_,type:"warning",duration:0}),info:(p,_)=>s({message:p,title:_,type:"info"})}),(p,_)=>(l(),Oe(ot,{to:"body"},[e("div",sc,[be(dt,{name:"toast"},{default:Ke(()=>[(l(!0),n(ve,null,ke(r.value,C=>(l(),n("div",{key:C.id,class:Y(["toast",[`toast-${C.type}`,{"toast-persistent":C.type==="error"||C.type==="warning"}]])},[e("i",{class:Y(["mdi",h(C.type)])},null,2),e("div",ac,[C.title?(l(),n("div",ic,c(C.title),1)):T("",!0),e("div",rc,c(C.message),1),C.description?(l(),n("div",dc,c(C.description),1)):T("",!0)]),e("button",{onClick:M=>u(C.id),class:Y(["toast-close",{"toast-close-prominent":C.type==="error"||C.type==="warning"}]),title:C.type==="error"||C.type==="warning"?"Click to dismiss":"Close"},[..._[0]||(_[0]=[e("i",{class:"mdi mdi-close"},null,-1)])],10,uc)],2))),128))]),_:1})])]))}},mc=we(cc,[["__scopeId","data-v-3948c088"]]),vc="0.3.0-alpha.2",pc={version:vc},fc={id:"app",class:"app-container"},gc={class:"app-header"},yc={class:"header-content"},bc={class:"header-right"},hc=["title"],kc={class:"settings-menu-container"},wc={key:0,class:"settings-menu"},$c=["title"],Cc={class:"toggle-content"},_c={key:0,class:"not-installed-label"},Sc={key:0,href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"menu-item menu-link menu-subitem"},Ic=["disabled"],Dc=["disabled"],xc=["disabled"],Tc={class:"app-main"},Mc={class:"app-footer"},Rc={__name:"App",setup(o){const m=g(null),r=pc.version,$=g("light"),h=g(null),s=g(!1),u=g(!1),p=g(!1),_=g(localStorage.getItem("smartir_enabled")!=="false"),C=W(()=>{var v;return((v=h.value)==null?void 0:v.installed)||!1}),M=W(()=>({light:"mdi mdi-weather-sunny",medium:"mdi mdi-weather-partly-cloudy",dark:"mdi mdi-weather-night"})[$.value]),w=W(()=>({light:"Switch to Medium Theme",medium:"Switch to Dark Theme",dark:"Switch to Light Theme"})[$.value]),t=()=>{const v=["light","medium","dark"],z=(v.indexOf($.value)+1)%v.length;$.value=v[z],document.body.classList.remove("medium-mode","dark-mode"),$.value==="medium"?document.body.classList.add("medium-mode"):$.value==="dark"&&document.body.classList.add("dark-mode"),localStorage.setItem("theme",$.value)},R=async()=>{try{const v=await nt.getStatus();h.value=v,v.installed?console.log("âœ… SmartIR detected:",v.version):console.log("â„¹ï¸ SmartIR not detected")}catch(v){console.error("Error checking SmartIR:",v),h.value={installed:!1,error:v.message}}},X=async()=>{var v,O,z;u.value=!0;try{const H=(await ne.get("/api/diagnostics/markdown")).data.markdown;if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(H),(v=m.value)==null||v.success("Diagnostic summary copied to clipboard!");else{const ae=document.createElement("textarea");ae.value=H,ae.style.position="fixed",ae.style.left="-999999px",ae.style.top="-999999px",document.body.appendChild(ae),ae.focus(),ae.select();try{if(document.execCommand("copy"))(O=m.value)==null||O.success("Diagnostic summary copied to clipboard!");else throw new Error("execCommand failed")}finally{document.body.removeChild(ae)}}s.value=!1}catch(ee){console.error("Error copying diagnostics:",ee),(z=m.value)==null||z.error("Failed to copy diagnostics: "+ee.message)}finally{u.value=!1}},U=async()=>{var v,O;u.value=!0;try{const z=await ne.get("/api/diagnostics/download",{responseType:"blob"}),ee=window.URL.createObjectURL(new Blob([z.data])),H=document.createElement("a");H.href=ee;const ae=z.headers["content-disposition"];let E="broadlink_manager_diagnostics.zip";if(ae){const j=ae.match(/filename="?(.+)"?/);j&&(E=j[1])}H.setAttribute("download",E),document.body.appendChild(H),H.click(),H.remove(),window.URL.revokeObjectURL(ee),(v=m.value)==null||v.success("Diagnostic bundle downloaded!"),s.value=!1}catch(z){console.error("Error downloading diagnostics:",z),(O=m.value)==null||O.error("Failed to download diagnostics")}finally{u.value=!1}},x=()=>{C.value&&(_.value=!_.value,localStorage.setItem("smartir_enabled",_.value.toString()),window.location.reload())},a=async()=>{var v,O,z;p.value=!0;try{const ee=await ne.post("/api/smartir/refresh-index");ee.data.success?(v=m.value)==null||v.success(`Updated to v${ee.data.version} (${ee.data.total_devices} devices)`,"âœ… Index Updated"):(O=m.value)==null||O.error(ee.data.error||"Unknown error","âŒ Update Failed")}catch(ee){console.error("Error updating SmartIR index:",ee),(z=m.value)==null||z.error("Failed to update device index","âŒ Update Error")}finally{p.value=!1,s.value=!1}},b=v=>{v.target.closest(".settings-menu-container")||(s.value=!1)};return Ae(async()=>{const v=localStorage.getItem("theme");v&&["light","medium","dark"].includes(v)?($.value=v,v==="medium"?document.body.classList.add("medium-mode"):v==="dark"&&document.body.classList.add("dark-mode")):localStorage.getItem("darkMode")==="true"&&($.value="dark",document.body.classList.add("dark-mode"),localStorage.setItem("theme","dark")),await R();const O=Qe();O&&m.value&&(O.appContext.config.globalProperties.$toast=m.value),document.addEventListener("click",b)}),Ge(()=>{document.removeEventListener("click",b)}),He("smartirStatus",h),He("smartirEnabled",_),He("refreshSmartIR",R),He("toast",m),(v,O)=>(l(),n("div",fc,[e("header",gc,[e("div",yc,[O[13]||(O[13]=e("div",{class:"header-left"},[e("i",{class:"mdi mdi-remote"}),e("h1",null,"Broadlink Manager v2"),e("span",{class:"beta-badge"},"BETA")],-1)),e("div",bc,[e("button",{onClick:t,class:"icon-button",title:w.value},[e("i",{class:Y(M.value)},null,2)],8,hc),e("div",kc,[e("button",{onClick:O[0]||(O[0]=z=>s.value=!s.value),class:"icon-button",title:"Settings"},[...O[2]||(O[2]=[e("i",{class:"mdi mdi-cog"},null,-1)])]),s.value?(l(),n("div",wc,[O[9]||(O[9]=e("div",{class:"menu-section-title"},"Integration Settings",-1)),e("div",{class:Y(["menu-item toggle-item",{disabled:!C.value}]),onClick:O[1]||(O[1]=z=>C.value?x():null),title:C.value?"":"SmartIR is not installed"},[e("div",Cc,[O[3]||(O[3]=e("i",{class:"mdi mdi-air-conditioner"},null,-1)),O[4]||(O[4]=e("span",null,"SmartIR Integration",-1)),C.value?T("",!0):(l(),n("span",_c,"(Not Installed)"))]),e("div",{class:Y(["toggle-switch",{active:_.value&&C.value,disabled:!C.value}])},[...O[5]||(O[5]=[e("div",{class:"toggle-slider"},null,-1)])],2)],10,$c),_.value?(l(),n("a",Sc,[...O[6]||(O[6]=[e("i",{class:"mdi mdi-github"},null,-1),e("span",null,"SmartIR on GitHub",-1)])])):T("",!0),_.value?(l(),n("button",{key:1,onClick:a,class:"menu-item menu-subitem",disabled:p.value},[e("i",{class:Y(["mdi",p.value?"mdi-loading mdi-spin":"mdi-refresh"])},null,2),e("span",null,c(p.value?"Updating...":"Update Device Index"),1)],8,Ic)):T("",!0),O[10]||(O[10]=e("div",{class:"menu-divider"},null,-1)),O[11]||(O[11]=e("div",{class:"menu-section-title"},"Diagnostics",-1)),e("button",{onClick:X,class:"menu-item",disabled:u.value},[...O[7]||(O[7]=[e("i",{class:"mdi mdi-content-copy"},null,-1),e("span",null,"Copy Diagnostics",-1)])],8,Dc),e("button",{onClick:U,class:"menu-item",disabled:u.value},[...O[8]||(O[8]=[e("i",{class:"mdi mdi-download"},null,-1),e("span",null,"Download Diagnostics",-1)])],8,xc),O[12]||(O[12]=Pe('<div class="menu-divider" data-v-4bc2c39f></div><div class="menu-section-title" data-v-4bc2c39f>Help &amp; Support</div><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2#readme" target="_blank" class="menu-item menu-link" data-v-4bc2c39f><i class="mdi mdi-book-open-variant" data-v-4bc2c39f></i><span data-v-4bc2c39f>Documentation</span></a><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2/issues" target="_blank" class="menu-item menu-link" data-v-4bc2c39f><i class="mdi mdi-bug" data-v-4bc2c39f></i><span data-v-4bc2c39f>Report Issue</span></a><div class="menu-divider" data-v-4bc2c39f></div><div class="menu-section-title" data-v-4bc2c39f>Community</div><a href="https://community.home-assistant.io/t/broadlink-manager-modern-web-interface-for-broadlink-devices/938473" target="_blank" class="menu-item menu-link" data-v-4bc2c39f><i class="mdi mdi-forum" data-v-4bc2c39f></i><span data-v-4bc2c39f>HA Forum Discussion</span></a><a href="https://www.reddit.com/r/homeassistant/comments/1o1q3kf/release_broadlink_manager_addon_a_modern_web_ui/" target="_blank" class="menu-item menu-link" data-v-4bc2c39f><i class="mdi mdi-reddit" data-v-4bc2c39f></i><span data-v-4bc2c39f>Reddit Discussion</span></a><div class="menu-divider" data-v-4bc2c39f></div><div class="menu-section-title" data-v-4bc2c39f>Project</div><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2" target="_blank" class="menu-item menu-link" data-v-4bc2c39f><i class="mdi mdi-github" data-v-4bc2c39f></i><span data-v-4bc2c39f>GitHub Repository</span></a><a href="https://ko-fi.com/tonyperkins" target="_blank" class="menu-item menu-link menu-item-sponsor" data-v-4bc2c39f><i class="mdi mdi-coffee" data-v-4bc2c39f></i><span data-v-4bc2c39f>Support on Ko-fi</span></a>',12))])):T("",!0)])])])]),e("main",Tc,[be(nc)]),e("footer",Mc,[e("p",null,"Broadlink Manager v"+c($e(r))+" | Built with Vue "+c(ut),1)]),be(mc,{ref_key:"toastRef",ref:m},null,512)]))}},Lc=we(Rc,[["__scopeId","data-v-4bc2c39f"]]),st=ct(Lc),Ac=mt();st.use(Ac);st.mount("#app");
