import{g as nt,r as y,o as xe,a as We,b as vt,d as pt,c as G,e as i,f as n,h as e,i as R,n as W,u as _e,t as p,j as x,F as me,k as he,w as se,l as z,v as Le,m as ce,p as ge,q as Ke,s as tt,T as st,x as Ie,y as Me,z as He,A as ve,B as at,C as ze,D as Fe,E as it,G as Ye,H as ft,I as gt,J as yt,K as Xe,L as bt,M as ht}from"./vendor-DGiFqQ_g.js";(function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const w of document.querySelectorAll('link[rel="modulepreload"]'))$(w);new MutationObserver(w=>{for(const d of w)if(d.type==="childList")for(const v of d.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&$(v)}).observe(document,{childList:!0,subtree:!0});function r(w){const d={};return w.integrity&&(d.integrity=w.integrity),w.referrerPolicy&&(d.referrerPolicy=w.referrerPolicy),w.crossOrigin==="use-credentials"?d.credentials="include":w.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function $(w){if(w.ep)return;w.ep=!0;const d=r(w);fetch(w.href,d)}})();let lt=!1;function Ge(){const t=nt(),u=t==null?void 0:t.appContext.config.globalProperties.$toast;return u||(lt||(console.warn("Toast notification system not yet initialized - using console fallback"),lt=!0),{success:r=>console.log("âœ“",r),error:r=>console.error("âœ—",r),warning:r=>console.warn("âš ",r),info:r=>console.info("â„¹",r)})}function ot(){const t=y(!1),u=y(!1),r=y(!1),$=y(0),w=767,d=768,v=1023,g=1024,D=()=>{const S=window.innerWidth;$.value=S,t.value=S<=w,u.value=S>=d&&S<=v,r.value=S>=g};return xe(()=>{D(),window.addEventListener("resize",D)}),We(()=>{window.removeEventListener("resize",D)}),{isMobile:t,isTablet:u,isDesktop:r,screenWidth:$,isMobileOrTablet:()=>t.value||u.value,isTabletOrDesktop:()=>u.value||r.value}}const Qe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAHBUlEQVR4nOxZC1BTVxo+9+aNZI2LNsgjWR4hgoIiRVDBslKnIKPbx1jqTrtYoakat1a6dNsdd7t1X8XHyAbEhdUu1u2mXdbasqJbtsaMIqBBECiPBmqEICEBEx4xJLlJ7s6lw6rJDeQ2FzLM+M1kBs7/3+/83zn/Oee/51JRFAXzGbCvA/AWjwX4GvNeANWXnXffHQ4+K6/dYbHeD+IFhjRkb1wn9WPQbEQ4IF/tQlXX2p5+/8OyczY74j/VxuMG3Sh/Oz9jaQDb4CmPT1LIbLXBfzrz0cmHg8fQpx1Yc1Ra+TsiXD4R0PqtRmAyj/LxbJeaujKIcPlEAINOM7vLXBaTZibCRWgRq3WGJZWX63aoNDpB8BJOX/bGlIqwpUv6iXBgWBHG7eUF8urUWvU6Z9sLGxI/IsLl8SJu6u4XigqPXkVspiVTbTQqU1/6Vn7ammh+G5FOMZyqludIKqUVU/9jcaSuTCo/unfHbiad4iBdwMu/P1bV1tO1xbk9NDC0/vwHB1xGcjqYLAh16zsHW3R6XXTu1mfFdAqMrIoSKNbGhLcQ4QGeppDJ7ACtPcqNEI6tT9O3Vqm+tygqNMDjrU9Sef6tIYM2JjUuuXzfC5knCEXsBI8WMZUCAxiCrfhWyMZkMNzYXNHVpwmXXqp5j0Hz0/1m57a3PQ8VHx4JoNMASIl9shLPFsB5ooO7iDXhCY/dAcCvT/79LwC1s/K2bDnAXcQeJRqwMzzeRt/bua0gLChcDsCDNQNBkEU/qot7o6j0kzETQpuJ40ZnT6xSrUoNWhyseHVz2ikv4n4QA5FSArE5IFlTZ0r3XU1MWODib6NCl3a9dkhSYxgbjo4XLq8sL9j7Ip36YEwMRjMNQazMhf7+RgYNnuyo7bY6ArFaWKuXRX495wLwoLk39sO9RaVnM5OTP8zLSjtjsljpp6ovi6pqr706eE8XBwGUSqEy9Guihf/92TMZhetjI5rJCHwKpBRzZqsNYtKp6KD+Pvv1w5ILdzR3UvD8HA4YefOl7N25JKUPIKuUwIJH7A5of/GJf7oLfrIz2EH786fSss+uKFzOk+8L0mqh6rpbmR0q5YyFGAQBSuHHlcUWxEaZyXfMhFD0Rgt9Oh/SBMiam58HAO+oc4XZMsK/1taT6M6uHjJw8w6VSNfvemM8TbzPlFlwsP5KyzfJeL6kCejXDgo894aASqOZ9O/uHwzq6B3ijhitkzOC7XS7j0g+V3S0vQTDDhYEoZSBobvJ+yXFNZ29gy4lOGmvlDBMIfQqSKV8539EWvXHhvbGHBSFrAwGW+vvxzLoR7RxzrNpsyPs0xcv7/lg1/ZfPtKvuw7MVhulUakWdvRq+XY3tWFT90Bk+52BCOzvyOBgjytSFKAgms+b9F/2o+BbKwUrvgjhhjSjKLAPG4YE7lJxfEIf5dyGOwMXrren/eF0RYXRNMrHDt4QbmjDEbHop9F8rqpddZd3sV6R/aWiabtWr41PW534V8m+PFHW+qSPL9TX7oM8WAaBi4IbE4S8yYNs/7asIgBA0ZStRqFM/MXxIzcgHBEBP+C6DJKLgJvK3uXvniitBsDmNzkSEAD9uv5k0aFjXy1gMQ0DQ5p4CAIwNuXLwyL/ExcpqMWeS42NUmxKXFf8VWPdz6cLnkqhGd/Pe+U1Cow/+ekJUYr4qJgvbik7f/Jw+0J/tjpvS3qxs7/LQZZfcrrkUmOdGI/cgUKIkB8pz0xK+CQjKf6z4MWckYftZqsderfsTInsZt0evDRgMRYMHhaLnk+NW1Y/nchxk5lZ+I/Pf/vl9RvbLYiVlSBcJv/VK9sKBCHc3hkF7D12/NzVltZn8YhzNj/3ev6LGeXTdQ6+uzLZ+C+5XNza05Nsd1gXcNgBvekJK/+du3lTUSiXMzzT80TgkkK8wJAGgCMAE5ooFFz3hHTr+lgZ9iMryOngkoi5WZuOc9hPtDu3r4198nTqygjCr3wYmrvVkSerZXljJoT0m0DcYm5g2Mg5WV39zrVWZZofkzaRnhB/bufm9FI/JpXQXj8F8bHyitqWxhzJmwUJT60SNJER+P+BCZjt34lzNbvickRoWVWNmGzuObnYWhER3oAdX41dPbj1jDeYEwGrInltKKCNtatub6hRfJOEnfJkcc+JgE9ltS/DkINuNI3xCo4fbXgm/0CnouvOcjK4Z/16/ZKia+3+kqIrEIQ+sgNx2Jzb5wsPxrD9GBZv+Gd9BqSXr4icg8cwMj4SLmv6+mlv+WddgGlilOPOZkEmFnrLP+sCVgtXyPHaHShkiw0XXPWWf9YF5Gb9uGzp4sCbj7ai4LkNTx2O5nPV3vLPyTeye6P32X+7KNujVKtSYJg+viEu/mx2etJZCgnD57OPfGRh3n8nfizA15j3Av4XAAD//5k1S2w3zfwVAAAAAElFTkSuQmCC",te=vt.create({baseURL:"./",timeout:3e4,headers:{"Content-Type":"application/json","Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"}});te.interceptors.request.use(t=>t,t=>Promise.reject(t));te.interceptors.response.use(t=>t,t=>(console.error("API Error:",t),t.response?console.error("Response error:",t.response.data):t.request?console.error("No response received"):console.error("Request setup error:",t.message),Promise.reject(t)));const kt=pt("devices",{state:()=>({devices:[],loading:!1,error:null,selectedDevice:null}),getters:{deviceById:t=>u=>t.devices.find(r=>r.id===u),devicesByType:t=>u=>t.devices.filter(r=>r.entity_type===u),deviceCount:t=>t.devices.length,hasDevices:t=>t.devices.length>0},actions:{async loadDevices(t=!1){this.loading=!0,this.error=null;try{const u=t?`/api/devices/managed?_t=${Date.now()}`:"/api/devices/managed",r=await te.get(u);this.devices=r.data.devices||[],console.log("ðŸ“¥ Loaded devices:",this.devices),this.devices.forEach($=>{console.log(`ðŸ“¥ Device "${$.name}":`,{id:$.id,device:$.device,commands:$.commands,commandCount:$.commands?Object.keys($.commands).length:0})})}catch(u){this.error=u.message,console.error("Error loading devices:",u)}finally{this.loading=!1}},async createDevice(t){this.loading=!0,this.error=null;try{console.log("ðŸª Store: Creating device with data:",t),console.log("ðŸª Store: Device commands being sent:",t.commands);const u={device_name:t.name,device:t.device,area_id:t.area||"",area_name:t.area||"",entity_type:t.entity_type,icon:t.icon,broadlink_entity:t.broadlink_entity,device_type:t.device_type||"broadlink",commands:t.commands||{}};t.device_type==="smartir"&&t.smartir_config&&(u.smartir_config=t.smartir_config),console.log("ðŸª Store: Transformed data for backend:",u);const r=await te.post("/api/devices/managed",u);return console.log("ðŸª Store: Create response:",r.data),await this.loadDevices(),r.data}catch(u){throw console.error("Error creating device:",u),u}finally{this.loading=!1}},async updateDevice(t,u){this.loading=!0,this.error=null;try{const r=await te.put(`/api/devices/managed/${t}`,u);return await this.loadDevices(),r.data}catch(r){throw console.error("Error updating device:",r),r}finally{this.loading=!1}},async deleteDevice(t,u=!1){this.loading=!0,this.error=null;try{await te.delete(`/api/devices/managed/${t}`,{data:{delete_commands:u}}),this.devices=this.devices.filter(r=>r.id!==t)}catch(r){throw this.error=r.message,console.error("Error deleting device:",r),r}finally{this.loading=!1}},selectDevice(t){this.selectedDevice=t},clearSelection(){this.selectedDevice=null},clearError(){this.error=null},updateDeviceCommands(t,u){const r=this.devices.findIndex($=>$.id===t);if(r!==-1){const $={...this.devices[r],commands:u};this.devices.splice(r,1,$),console.log(`âœ… Store: Updated commands for ${t}, count: ${Object.keys(u).length}`)}else console.warn(`âš ï¸ Store: Device ${t} not found for command update`)},async syncAllAreas(){if(!this.devices||this.devices.length===0){console.log("âš ï¸ No devices to sync");return}console.log(`ðŸ”„ Syncing areas from Home Assistant for ${this.devices.length} devices...`);try{const t=await Promise.all(this.devices.map($=>(console.log(`ðŸ”„ Syncing device: ${$.id} (${$.name})`),te.post(`/api/devices/${$.id}/sync-area`).then(w=>w.data.success&&w.data.area?(console.log(`âœ… Synced area for ${$.name}: ${w.data.area}`),{status:"synced",device:$.name}):{status:"no_area"}).catch(w=>{var d;return((d=w.response)==null?void 0:d.status)===404?(console.log(`âŒ Device not found in HA: ${$.id}`),{status:"not_found"}):(console.warn(`âš ï¸ Failed to sync area for ${$.id}:`,w.message),{status:"error",error:w.message})})))),u=t.filter($=>$.status==="synced").length,r=t.filter($=>$.status==="not_found").length;await this.loadDevices(!0),u>0?console.log(`âœ… Area sync complete: ${u} synced, ${r} not found in HA`):r>0&&console.log(`â„¹ï¸ No areas synced - ${r} entities not found in HA registry (generate entities first)`)}catch(t){console.debug("Area sync error:",t)}}}});function rt(t){const u=G(()=>t.value||t),r=G(()=>{switch(u.value){case"climate":return"mdi:air-conditioner";case"fan":return"mdi:fan";case"light":return"mdi:lightbulb";case"media_player":return"mdi:television";case"switch":return"mdi:light-switch";default:return"mdi:devices"}}),$=G(()=>`device-type-${u.value}-color`),w=G(()=>`tag-${u.value}-bg`);return{icon:r,colorClass:$,tagBgClass:w}}const dt=""+new URL("broadlink-logo-BDjImjRY.png",import.meta.url).href,$e=(t,u)=>{const r=t.__vccOpts||t;for(const[$,w]of u)r[$]=w;return r},wt={class:"device-header"},$t={class:"device-info"},Ct=["title"],_t={class:"device-labels"},St={class:"device-type"},It=["src","alt","title"],Dt={class:"device-body"},Tt={class:"device-stats"},xt={class:"stat",title:"Learned command count"},Rt={class:"stat",title:"HA Assigned Area"},Mt={class:"device-meta"},Et={class:"device-id",title:"Device ID"},At={key:0,class:"storage-name"},Lt={key:1,class:"broadlink-entity",title:"Controller Device"},Ot={key:2,class:"controller-device"},Pt={class:"device-actions"},Vt=["disabled"],Ut=["disabled"],jt=["disabled"],Ft={key:0,class:"disabled-overlay"},Nt={__name:"DeviceCard",props:{device:{type:Object,required:!0},broadlinkDevices:{type:Array,default:()=>[]}},emits:["edit","delete","learn"],setup(t){const u=t,r=G(()=>localStorage.getItem("smartir_simulate_not_installed")==="true"),$=G(()=>u.device.device_type==="smartir"&&r.value),w=y(null),d=rt(G(()=>u.device.entity_type)),v=G(()=>u.device.icon?u.device.icon:d.icon.value),g=s=>s&&s.startsWith("mdi:")?`mdi ${s.replace(":"," mdi-")}`:`mdi mdi-${s}`,D=G(()=>({light:"Light",fan:"Fan",switch:"Switch",media_player:"Media Player",cover:"Cover"})[u.device.entity_type]||u.device.entity_type),S=G(()=>(u.device.device_type||"broadlink")==="smartir"?"SmartIR":"Broadlink"),O=G(()=>(u.device.device_type||"broadlink")==="smartir"?Qe:dt),h=G(()=>(u.device.device_type||"broadlink")==="smartir"?w.value!==null?w.value:0:Object.keys(u.device.commands||{}).length),o=s=>{if(!s)return"";const k=u.broadlinkDevices.find(f=>f.entity_id===s);return k&&k.name||s},P=G(()=>{if(!u.device.device)return!1;const s=u.device.id.includes(".")?u.device.id.split(".")[1]:u.device.id;return u.device.device!==s}),F=G(()=>{if(!u.device.broadlink_entity)return"";const s=u.broadlinkDevices.find(k=>k.entity_id===u.device.broadlink_entity);return s&&s.name||u.device.broadlink_entity}),U=s=>{if(!s||typeof s!="object")return 0;let k=0;for(const f of Object.values(s))typeof f=="string"?k++:typeof f=="object"&&(k+=U(f));return k},_=async()=>{if(!(!u.device.device_code||!u.device.entity_type))try{const s=await te.get("/api/smartir/codes/code",{params:{entity_type:u.device.entity_type,code_id:u.device.device_code}});if(s.data.success&&s.data.code){const k=s.data.code;k.commands&&(w.value=U(k.commands))}}catch(s){console.error("Error fetching SmartIR command count:",s)}};return xe(async()=>{(u.device.device_type||"broadlink")==="smartir"&&await _()}),(s,k)=>(n(),i("div",{class:W(["device-card",{disabled:$.value}])},[e("div",wt,[e("div",{class:W(["device-icon",_e(d).colorClass.value])},[e("i",{class:W(g(v.value))},null,2)],2),e("div",$t,[e("h3",{title:t.device.name},p(t.device.name),9,Ct),e("div",_t,[e("span",St,p(D.value),1)])]),e("img",{src:O.value,alt:S.value,title:S.value,class:"device-source-logo"},null,8,It)]),e("div",Dt,[e("div",Tt,[e("div",xt,[k[3]||(k[3]=e("i",{class:"mdi mdi-remote"},null,-1)),e("span",null,p(h.value)+" command"+p(h.value!==1?"s":""),1)]),e("div",Rt,[k[4]||(k[4]=e("i",{class:"mdi mdi-map-marker"},null,-1)),e("span",null,p(t.device.area||"No area"),1)])]),e("div",Mt,[e("span",Et,[k[5]||(k[5]=e("i",{class:"mdi mdi-identifier"},null,-1)),x(" "+p(t.device.id),1)]),P.value?(n(),i("span",At,[k[6]||(k[6]=e("i",{class:"mdi mdi-code-tags"},null,-1)),x(" "+p(t.device.device),1)])):R("",!0),t.device.broadlink_entity?(n(),i("span",Lt,[k[7]||(k[7]=e("i",{class:"mdi mdi-access-point"},null,-1)),x(" "+p(F.value),1)])):R("",!0),t.device.controller_device?(n(),i("span",Ot,[k[8]||(k[8]=e("i",{class:"mdi mdi-access-point"},null,-1)),x(" "+p(o(t.device.controller_device)),1)])):R("",!0)])]),e("div",Pt,[e("button",{onClick:k[0]||(k[0]=f=>!$.value&&s.$emit("learn",t.device)),class:"icon-btn",title:"Manage Commands",disabled:$.value},[...k[9]||(k[9]=[e("i",{class:"mdi mdi-remote-tv"},null,-1)])],8,Vt),e("button",{onClick:k[1]||(k[1]=f=>!$.value&&s.$emit("edit",t.device)),class:"icon-btn",title:"Edit",disabled:$.value},[...k[10]||(k[10]=[e("i",{class:"mdi mdi-pencil"},null,-1)])],8,Ut),e("button",{onClick:k[2]||(k[2]=f=>!$.value&&s.$emit("delete",t.device)),class:"icon-btn danger",title:"Delete",disabled:$.value},[...k[11]||(k[11]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,jt)]),$.value?(n(),i("div",Ft,[...k[12]||(k[12]=[e("div",{class:"disabled-message"},[e("i",{class:"mdi mdi-eye-off"}),e("span",null,"SmartIR Not Installed")],-1)])])):R("",!0)],2))}},Bt=$e(Nt,[["__scopeId","data-v-7a7f5c18"]]),Ht={name:"DeviceListView",props:{devices:{type:Array,required:!0}},methods:{getDeviceSourceLogo(t){return(t.device_type||"broadlink")==="smartir"?Qe:dt},getDeviceCommands(t){return t.commands&&typeof t.commands=="object"?Object.keys(t.commands):[]},getCommandType(t,u){return t.commands&&t.commands[u]&&t.commands[u].type||"ir"},getCommandTypeClass(t,u){return this.getCommandType(t,u)==="rf"?"command-rf":"command-ir"},getCommandTypeLabel(t,u){return this.getCommandType(t,u)==="rf"?"RF Command":"IR Command"},sendCommand(t,u){this.$emit("send-command",{device:t,command:u})},openCommands(t){this.$emit("open-commands",t)},editDevice(t){this.$emit("edit-device",t)},deleteDevice(t){this.$emit("delete-device",t)}}},qt={class:"device-list-view"},zt={class:"device-table"},Jt={class:"device-info"},Wt={class:"device-name"},Gt={class:"device-entity"},Kt={class:"device-area"},Xt={class:"device-type"},Yt=["src","alt","title"],Zt={class:"device-commands"},Qt={key:0,class:"command-list"},eo=["onClick","title"],to={key:0,class:"no-commands"},oo={key:1,class:"smartir-info"},lo={class:"profile-code"},no={class:"device-actions"},so=["onClick"],ao=["onClick"],io=["onClick"];function ro(t,u,r,$,w,d){return n(),i("div",qt,[e("table",zt,[u[3]||(u[3]=e("thead",null,[e("tr",null,[e("th",null,"Device"),e("th",null,"Room/Area"),e("th",null,"Type"),e("th",null,[e("div",{class:"commands-header"},[e("span",null,"Commands"),e("div",{class:"command-legend"},[e("span",{class:"legend-badge command-rf"},"RF"),e("span",{class:"legend-badge command-ir"},"IR")])])]),e("th",null,"Actions")])],-1)),e("tbody",null,[(n(!0),i(me,null,he(r.devices,v=>(n(),i("tr",{key:v.entity_id,class:"device-row"},[e("td",Jt,[e("div",Wt,p(v.friendly_name||v.name),1),e("div",Gt,p(v.entity_id),1)]),e("td",Kt,p(v.area||"No Area"),1),e("td",Xt,[e("img",{src:d.getDeviceSourceLogo(v),alt:v.device_type==="smartir"?"SmartIR":"Broadlink",title:v.device_type==="smartir"?"SmartIR":"Broadlink",class:"device-source-logo"},null,8,Yt)]),e("td",Zt,[(v.device_type||"broadlink")==="broadlink"?(n(),i("div",Qt,[(n(!0),i(me,null,he(d.getDeviceCommands(v),g=>(n(),i("button",{key:g,class:W(["command-btn",d.getCommandTypeClass(v,g)]),onClick:D=>d.sendCommand(v,g),title:d.getCommandTypeLabel(v,g)},p(g),11,eo))),128)),d.getDeviceCommands(v).length===0?(n(),i("span",to," No commands ")):R("",!0)])):v.device_type==="smartir"?(n(),i("div",oo,[e("span",lo,"Profile: "+p(v.device_code),1)])):R("",!0)]),e("td",no,[e("button",{class:"action-btn commands",onClick:g=>d.openCommands(v),title:"Manage Commands"},[...u[0]||(u[0]=[e("i",{class:"mdi mdi-remote-tv"},null,-1)])],8,so),e("button",{class:"action-btn edit",onClick:g=>d.editDevice(v),title:"Edit"},[...u[1]||(u[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})],-1)])],8,ao),e("button",{class:"action-btn delete",onClick:g=>d.deleteDevice(v),title:"Delete"},[...u[2]||(u[2]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"3 6 5 6 21 6"}),e("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})],-1)])],8,io)])]))),128))])])])}const uo=$e(Ht,[["render",ro],["__scopeId","data-v-2895a204"]]),co={class:"icon-picker"},mo={class:"icon-input-wrapper"},vo=["id","placeholder"],po={key:0,class:"icon-preview"},fo={key:0,class:"icon-dropdown"},go={class:"icon-grid"},yo=["onMousedown","title"],bo={__name:"IconPicker",props:{modelValue:{type:String,default:""},inputId:{type:String,default:"icon-input"},placeholder:{type:String,default:"e.g., mdi:television"}},emits:["update:modelValue"],setup(t,{emit:u}){const r=t,$=u,w=y(r.modelValue),d=y(!1),v=["television","speaker","radio","music","video","movie","play","pause","stop","skip-next","skip-previous","volume-high","volume-medium","volume-low","volume-off","remote","remote-tv","cast","chromecast","spotify","netflix","youtube","lightbulb","lightbulb-on","lightbulb-off","lamp","floor-lamp","ceiling-light","light-switch","led-strip","led-strip-variant","wall-sconce","chandelier","spotlight","track-light","vanity-light","desk-lamp","fan","ceiling-fan","air-conditioner","thermometer","thermostat","heat-wave","snowflake","fire","radiator","water-boiler","hvac","blinds","blinds-open","window-shutter","window-shutter-open","curtains","curtains-closed","roller-shade","roller-shade-closed","garage","garage-open","gate","door","door-open","window-open","window-closed","washing-machine","tumble-dryer","dishwasher","refrigerator","stove","microwave","oven","toaster","kettle","coffee","coffee-maker","blender","robot-vacuum","robot-vacuum-variant","vacuum","broom","spray-bottle","lock","lock-open","lock-smart","key","shield","shield-check","alarm-light","bell","doorbell","camera","cctv","motion-sensor","smoke-detector","fire-extinguisher","water-alert","gas-cylinder","sofa","bed","bed-double","desk","chair","table","bookshelf","home","home-outline","home-assistant","floor-plan","room","weather-sunny","weather-night","weather-cloudy","weather-rainy","weather-snowy","weather-lightning","weather-windy","weather-fog","weather-partly-cloudy","umbrella","water","water-percent","phone","cellphone","tablet","laptop","desktop-tower","monitor","keyboard","mouse","printer","router","router-wireless","access-point","wifi","bluetooth","usb","hdmi-port","ethernet","power","power-plug","power-socket","battery","battery-charging","lightning-bolt","flash","solar-panel","solar-power","leaf","tree","flower","sprout","grass","watering-can","shovel","fence","pool","hot-tub","silverware","silverware-fork-knife","food","food-apple","glass-wine","glass-cocktail","bottle-wine","pot","pot-steam","shower","shower-head","bathtub","toilet","sink","faucet","hand-wash","car","car-side","garage-variant","tools","hammer","wrench","screwdriver","toolbox","ladder","heart","heart-pulse","run","walk","bike","dumbbell","yoga","scale-bathroom","thermometer-lines","clock","clock-outline","timer","alarm","calendar","calendar-today","calendar-clock","history","bell-ring","bell-alert","alert","alert-circle","information","help-circle","check","check-circle","close-circle","minus-circle","plus-circle","arrow-up","arrow-down","arrow-left","arrow-right","chevron-up","chevron-down","menu","dots-vertical","dots-horizontal","cog","tune","circle","square","triangle","hexagon","star","star-outline","heart-outline","plus","minus","close","check-bold","eye","eye-off","account","account-group","baby","dog","cat","paw","gift","balloon","party-popper","candle","book","book-open","newspaper","email","message","phone-classic"];se(()=>r.modelValue,h=>{w.value=h});const g=G(()=>{if(!w.value)return v.slice(0,50);const h=w.value.toLowerCase().replace("mdi:","");return v.filter(o=>o.toLowerCase().includes(h)).slice(0,50)}),D=()=>{d.value=!0,$("update:modelValue",w.value)},S=()=>{setTimeout(()=>{d.value=!1},200)},O=h=>{w.value=`mdi:${h}`,$("update:modelValue",w.value),d.value=!1};return(h,o)=>(n(),i("div",co,[e("div",mo,[z(e("input",{id:t.inputId,"onUpdate:modelValue":o[0]||(o[0]=P=>w.value=P),type:"text",placeholder:t.placeholder,onInput:D,onFocus:o[1]||(o[1]=P=>d.value=!0),onBlur:S},null,40,vo),[[Le,w.value]]),w.value?(n(),i("div",po,[e("i",{class:W(`mdi mdi-${w.value.replace("mdi:","")}`)},null,2)])):R("",!0)]),d.value&&g.value.length>0?(n(),i("div",fo,[e("div",go,[(n(!0),i(me,null,he(g.value,P=>(n(),i("div",{key:P,class:"icon-option",onMousedown:ce(F=>O(P),["prevent"]),title:P},[e("i",{class:W(`mdi mdi-${P}`)},null,2),e("span",null,p(P),1)],40,yo))),128))])])):R("",!0)]))}},ho=$e(bo,[["__scopeId","data-v-a64f5011"]]),ko={key:0,class:"dropdown-label"},wo={key:0,class:"required"},$o=["placeholder","disabled","onKeydown"],Co={class:"dropdown-icons"},_o={key:0,class:"mdi mdi-loading mdi-spin"},So={key:2,class:"mdi mdi-chevron-down"},Io={key:1,class:"error-message"},Do={key:2,class:"hint-message"},To={key:0,class:"dropdown-menu"},xo=["onMousedown","onMouseenter"],Ro={class:"option-content"},Mo={class:"option-label"},Eo={key:0,class:"option-description"},Ao={key:0,class:"mdi mdi-check selected-icon"},Lo={key:3,class:"dropdown-menu"},Oo={__name:"SearchableDropdown",props:{modelValue:{type:[String,Number,Object],default:null},options:{type:Array,required:!0,default:()=>[]},label:{type:String,default:""},placeholder:{type:String,default:"Search..."},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},error:{type:String,default:""},hint:{type:String,default:""},optionLabel:{type:String,default:"label"},optionValue:{type:String,default:"value"},optionDescription:{type:String,default:"description"},filterMethod:{type:Function,default:null}},emits:["update:modelValue","change","search"],setup(t,{emit:u}){const r=t,$=u,w=y(null),d=y(null),v=y(""),g=y(!1),D=y(0),S=y(!1),O=E=>typeof E=="string"||typeof E=="number"?E:E[r.optionLabel]||E.label||E.name||String(E),h=E=>typeof E=="string"||typeof E=="number"?E:E[r.optionValue]||E.value||E.id||E,o=E=>typeof E=="string"||typeof E=="number"?"":E[r.optionDescription]||E.description||"",P=E=>{const j=h(E);return typeof r.modelValue=="object"?h(r.modelValue)===j:r.modelValue===j},F=G(()=>{if(!v.value)return r.options;if(r.filterMethod)return r.options.filter(j=>r.filterMethod(j,v.value));const E=v.value.toLowerCase();return r.options.filter(j=>{const oe=O(j).toLowerCase(),ie=o(j).toLowerCase();return oe.includes(E)||ie.includes(E)})}),U=G(()=>{if(!r.modelValue)return"";const E=r.options.find(j=>{const oe=h(j);return typeof r.modelValue=="object"?oe===h(r.modelValue):oe===r.modelValue});return E?O(E):""});se(()=>r.modelValue,E=>{S.value||(v.value=U.value)}),se(()=>r.options,()=>{!S.value&&r.modelValue&&(v.value=U.value)},{deep:!0}),se(v,E=>{$("search",E),D.value=0}),xe(()=>{v.value=U.value});const _=()=>{var E;S.value=!0,g.value=!0,(E=d.value)==null||E.select()},s=()=>{S.value=!1,setTimeout(()=>{g.value=!1,r.modelValue?v.value=U.value:v.value=""},200)},k=()=>{var E;g.value=!1,(E=d.value)==null||E.blur()},f=E=>{const j=h(E);$("update:modelValue",j),$("change",j,E),v.value=O(E),k()},A=()=>{var E;$("update:modelValue",null),$("change",null,null),v.value="",(E=d.value)==null||E.focus()},J=()=>{if(!g.value){g.value=!0;return}D.value<F.value.length-1&&D.value++},Y=()=>{D.value>0&&D.value--},Q=()=>{F.value.length>0&&D.value>=0&&f(F.value[D.value])},H=E=>{w.value&&!w.value.contains(E.target)&&(g.value=!1,r.modelValue?v.value=U.value:v.value="")};return xe(()=>{document.addEventListener("click",H)}),We(()=>{document.removeEventListener("click",H)}),(E,j)=>(n(),i("div",{class:"searchable-dropdown",ref_key:"dropdownRef",ref:w},[t.label?(n(),i("label",ko,[x(p(t.label)+" ",1),t.required?(n(),i("span",wo,"*")):R("",!0)])):R("",!0),e("div",{class:W(["dropdown-input-wrapper",{"has-error":t.error,disabled:t.disabled}])},[z(e("input",{ref_key:"inputRef",ref:d,type:"text","onUpdate:modelValue":j[0]||(j[0]=oe=>v.value=oe),placeholder:t.placeholder,disabled:t.disabled||t.loading,onFocus:_,onBlur:s,onKeydown:[Ke(ce(J,["prevent"]),["down"]),Ke(ce(Y,["prevent"]),["up"]),Ke(ce(Q,["prevent"]),["enter"]),Ke(k,["escape"])],class:"dropdown-input"},null,40,$o),[[Le,v.value]]),e("div",Co,[t.loading?(n(),i("i",_o)):t.modelValue&&!t.disabled?(n(),i("i",{key:1,class:"mdi mdi-close-circle clear-icon",onClick:A})):(n(),i("i",So))])],2),t.error?(n(),i("div",Io,p(t.error),1)):R("",!0),t.hint&&!t.error?(n(),i("div",Do,p(t.hint),1)):R("",!0),ge(st,{name:"dropdown"},{default:tt(()=>[g.value&&F.value.length>0?(n(),i("div",To,[(n(!0),i(me,null,he(F.value,(oe,ie)=>(n(),i("div",{key:h(oe),class:W(["dropdown-item",{highlighted:ie===D.value,selected:P(oe)}]),onMousedown:ce(ye=>f(oe),["prevent"]),onMouseenter:ye=>D.value=ie},[e("div",Ro,[e("div",Mo,p(O(oe)),1),o(oe)?(n(),i("div",Eo,p(o(oe)),1)):R("",!0)]),P(oe)?(n(),i("i",Ao)):R("",!0)],42,xo))),128))])):R("",!0)]),_:1}),g.value&&F.value.length===0&&!t.loading?(n(),i("div",Lo,[...j[1]||(j[1]=[e("div",{class:"dropdown-item no-results"},[e("i",{class:"mdi mdi-magnify"}),x(" No results found ")],-1)])])):R("",!0)],512))}},Ze=$e(Oo,[["__scopeId","data-v-679ce35f"]]),Po={class:"smartir-selector"},Vo={class:"form-group"},Uo={class:"form-group"},jo={class:"form-group"},Fo=["value"],No={key:0,class:"error-message"},Bo={class:"form-group"},Ho={class:"form-group"},qo={key:1,class:"code-info"},zo={class:"info-content"},Jo={class:"info-row"},Wo={class:"info-value"},Go={class:"info-row"},Ko={class:"info-value"},Xo={key:0,class:"info-row"},Yo={class:"info-value"},Zo={class:"info-row"},Qo={class:"info-value"},el={__name:"SmartIRDeviceSelector",props:{entityType:{type:String,required:!0},modelValue:{type:Object,default:()=>({})},broadlinkDevices:{type:Array,default:()=>[]}},emits:["update:modelValue","change"],setup(t,{expose:u,emit:r}){const $=t,w=r,d=y([]),v=y([]),g=y(""),D=y(""),S=y(""),O=y(""),h=y(""),o=y(null),P=y(!1),F=y(!1),U=y({manufacturer:"",model:"",controller:""});xe(async()=>{if(await _(),$.modelValue&&(g.value=$.modelValue.manufacturer||"",D.value=$.modelValue.device_code||"",S.value=$.modelValue.controller_device||"",O.value=$.modelValue.temperature_sensor||"",h.value=$.modelValue.humidity_sensor||"",g.value&&(await s(g.value),D.value&&v.value.length>0))){const E=v.value.find(j=>j.code===D.value);E&&(o.value={code:E.code,manufacturer:g.value,models:E.models,controller:E.controller})}}),se(()=>$.entityType,async E=>{E&&(g.value="",D.value="",v.value=[],o.value=null,await _())});const _=async()=>{if($.entityType){P.value=!0,U.value.manufacturer="";try{const E=await te.get("/api/smartir/codes/manufacturers",{params:{entity_type:$.entityType}});if(E.data.success)d.value=E.data.manufacturers||[];else throw new Error(E.data.error||"Failed to load manufacturers")}catch(E){console.error("Error loading manufacturers:",E),U.value.manufacturer="Failed to load manufacturers. Please try again.",d.value=[]}finally{P.value=!1}}},s=async E=>{if(!(!E||!$.entityType)){F.value=!0,U.value.model="";try{const j=await te.get("/api/smartir/codes/models",{params:{entity_type:$.entityType,manufacturer:E}});if(j.data.success){const oe=j.data.models||[];v.value=oe.map(ie=>{const ye=ie.models&&ie.models.length>0?ie.models.join(", "):`Code ${ie.code}`;return{code:ie.code,label:ye,description:`Code: ${ie.code}`,models:ie.models,controller:ie.controller}})}else throw new Error(j.data.error||"Failed to load models")}catch(j){console.error("Error loading models:",j),U.value.model="Failed to load models. Please try again.",v.value=[]}finally{F.value=!1}}},k=async E=>{g.value=E,D.value="",o.value=null,v.value=[],E&&await s(E),Q()},f=()=>{const E=v.value.find(j=>j.code===D.value);E&&(o.value={code:E.code,manufacturer:g.value,models:E.models,controller:E.controller}),Q()},A=()=>{Q()},J=()=>{Q()},Y=()=>{Q()},Q=()=>{var j,oe;const E={manufacturer:g.value,model:((oe=(j=o.value)==null?void 0:j.models)==null?void 0:oe[0])||"",device_code:D.value,controller_device:S.value};$.entityType==="climate"&&(O.value&&(E.temperature_sensor=O.value),h.value&&(E.humidity_sensor=h.value)),w("update:modelValue",E),w("change",E)};return u({validate:()=>{let E=!0;return U.value={manufacturer:"",model:"",controller:""},g.value||(U.value.manufacturer="Manufacturer is required",E=!1),D.value||(U.value.model="Model is required",E=!1),S.value||(U.value.controller="Broadlink controller is required",E=!1),E}}),(E,j)=>(n(),i("div",Po,[e("div",Vo,[ge(Ze,{modelValue:g.value,"onUpdate:modelValue":j[0]||(j[0]=oe=>g.value=oe),options:d.value,label:"Manufacturer",placeholder:"Search manufacturers...",required:"",loading:P.value,error:U.value.manufacturer,hint:"Select the device manufacturer",onChange:k},null,8,["modelValue","options","loading","error"])]),e("div",Uo,[ge(Ze,{modelValue:D.value,"onUpdate:modelValue":j[1]||(j[1]=oe=>D.value=oe),options:v.value,"option-label":"label","option-value":"code","option-description":"description",label:"Model",placeholder:"Search models...",required:"",disabled:!g.value,loading:F.value,error:U.value.model,hint:"Select the device model",onChange:f},null,8,["modelValue","options","disabled","loading","error"])]),e("div",jo,[j[6]||(j[6]=e("label",{for:"controller-device"},[e("i",{class:"mdi mdi-remote"}),x(" Controller Device * ")],-1)),z(e("select",{id:"controller-device","onUpdate:modelValue":j[2]||(j[2]=oe=>S.value=oe),required:"",onChange:A},[j[5]||(j[5]=e("option",{value:""},"-- Select Controller Device --",-1)),(n(!0),i(me,null,he(t.broadlinkDevices,oe=>(n(),i("option",{key:oe.entity_id,value:oe.entity_id},[x(p(oe.name||oe.entity_id)+" ",1),oe.area_name?(n(),i(me,{key:0},[x(" - "+p(oe.area_name),1)],64)):R("",!0)],8,Fo))),128))],544),[[Ie,S.value]]),j[7]||(j[7]=e("small",null,"Which remote device will send the IR/RF commands",-1)),U.value.controller?(n(),i("div",No,p(U.value.controller),1)):R("",!0)]),t.entityType==="climate"?(n(),i(me,{key:0},[e("div",Bo,[j[8]||(j[8]=e("label",{for:"temperature-sensor"},"Temperature Sensor",-1)),z(e("input",{id:"temperature-sensor","onUpdate:modelValue":j[3]||(j[3]=oe=>O.value=oe),type:"text",placeholder:"e.g., sensor.living_room_temperature",onInput:J},null,544),[[Le,O.value]]),j[9]||(j[9]=e("small",null,"Optional: Temperature sensor entity for current temperature",-1))]),e("div",Ho,[j[10]||(j[10]=e("label",{for:"humidity-sensor"},"Humidity Sensor",-1)),z(e("input",{id:"humidity-sensor","onUpdate:modelValue":j[4]||(j[4]=oe=>h.value=oe),type:"text",placeholder:"e.g., sensor.living_room_humidity",onInput:Y},null,544),[[Le,h.value]]),j[11]||(j[11]=e("small",null,"Optional: Humidity sensor entity for current humidity",-1))])],64)):R("",!0),o.value?(n(),i("div",qo,[j[16]||(j[16]=e("div",{class:"info-header"},[e("i",{class:"mdi mdi-information"}),e("span",null,"Selected Device Code")],-1)),e("div",zo,[e("div",Jo,[j[12]||(j[12]=e("span",{class:"info-label"},"Code ID:",-1)),e("span",Wo,p(o.value.code_id),1)]),e("div",Go,[j[13]||(j[13]=e("span",{class:"info-label"},"Manufacturer:",-1)),e("span",Ko,p(o.value.manufacturer),1)]),o.value.models&&o.value.models.length>0?(n(),i("div",Xo,[j[14]||(j[14]=e("span",{class:"info-label"},"Supported Models:",-1)),e("span",Yo,p(o.value.models.join(", ")),1)])):R("",!0),e("div",Zo,[j[15]||(j[15]=e("span",{class:"info-label"},"Controller:",-1)),e("span",Qo,p(o.value.controller||"Broadlink"),1)])])])):R("",!0)]))}},tl=$e(el,[["__scopeId","data-v-1911c8f6"]]),ol={class:"modal-content"},ll={class:"modal-header"},nl={class:"input-wrapper"},sl={key:0,class:"validation-tooltip"},al={class:"input-wrapper"},il=["disabled"],rl={key:0,class:"validation-tooltip"},dl={key:0,class:"smartir-notice"},ul={key:0,class:"notice-success"},cl={key:1,class:"notice-warning"},ml={key:1,class:"smartir-notice"},vl={key:2},pl={class:"form-group"},fl=["disabled"],gl=["disabled"],yl={key:0},bl={key:1},hl={key:2},kl={key:3},wl={key:0,class:"form-group"},$l={class:"area-display-readonly"},Cl=["value"],_l=["disabled"],Sl=["href"],Il={key:1,class:"form-group"},Dl={class:"form-group"},Tl={class:"input-wrapper"},xl=["value"],Rl=["value"],Ml={key:2,class:"validation-tooltip"},El={key:0},Al={key:1},Ll={key:3,class:"smartir-section"},Ol={class:"modal-footer"},Pl={type:"submit",form:"device-form",class:"btn btn-primary"},Vl={__name:"DeviceForm",props:{device:{type:Object,default:null}},emits:["save","cancel"],setup(t,{emit:u}){const r=t,$=u,w=Me("smartirStatus"),d=Me("smartirEnabled"),v=G(()=>{var m;return localStorage.getItem("smartir_simulate_not_installed")==="true"?!1:((m=w==null?void 0:w.value)==null?void 0:m.installed)||!1}),g=G(()=>!!r.device),D=G(()=>["climate","media_player","fan","light"].includes(o.value.entity_type)),S=G(()=>v.value?!D.value&&o.value.entity_type?"(Not supported for this type)":"(Pre-configured Codes)":"(Requires SmartIR)"),O=G(()=>{var m;const T=((m=r.device)==null?void 0:m.commands)||{};return Object.keys(T).length>0}),h=G(()=>{if(!o.value.broadlink_entity)return"";const T=s.value.find(m=>m.entity_id===o.value.broadlink_entity);return T&&T.name||o.value.broadlink_entity}),o=y({name:"",entity_type:"",device_type:"broadlink",device:"",area:"",icon:"",broadlink_entity:"",enabled:!0,commands:{}}),P=y({name:"",entity_type:"",broadlink_entity:""}),F=y({}),U=y(null),_=y([]),s=y([]),k=y(null),f=y(null),A=y(null),J=y(!1);xe(async()=>{r.device&&(o.value={...r.device,device_type:r.device.device_type||"broadlink"},o.value.device_type==="smartir"&&(F.value={manufacturer:r.device.manufacturer,model:r.device.model,device_code:r.device.device_code,controller_device:r.device.controller_device,temperature_sensor:r.device.temperature_sensor,humidity_sensor:r.device.humidity_sensor})),await Promise.all([Y(),Q()])});const Y=async()=>{try{const T=await te.get("/api/areas");_.value=T.data.areas||[]}catch(T){console.error("Error loading areas:",T),_.value=[]}},Q=async()=>{try{const m=(await te.get("/api/remote/devices")).data.devices||[];s.value=m,console.log("Loaded remote devices:",m)}catch(T){console.error("Error loading remote devices:",T),s.value=[]}},H=T=>{if(!T)return"";const m=T.toLowerCase();for(const V of _.value){const pe=V.toLowerCase();if(m.includes(pe))return V}return""},E=(T,m="")=>{const V=m.toLowerCase();return V.includes("tv")?"mdi:television":V.includes("lamp")?"mdi:lamp":V.includes("ceiling")?"mdi:ceiling-light":V.includes("floor")?"mdi:floor-lamp":V.includes("desk")?"mdi:desk-lamp":V.includes("fan")?"mdi:fan":V.includes("ac")||V.includes("air con")?"mdi:air-conditioner":V.includes("heater")?"mdi:radiator":V.includes("blind")?"mdi:blinds":V.includes("curtain")?"mdi:curtains":V.includes("garage")?"mdi:garage":V.includes("speaker")||V.includes("stereo")?"mdi:speaker":V.includes("receiver")?"mdi:audio-video":{light:"mdi:lightbulb",fan:"mdi:fan",switch:"mdi:light-switch",media_player:"mdi:television",cover:"mdi:window-shutter",climate:"mdi:thermostat"}[T]||"mdi:devices"};se(()=>o.value.name,T=>{if(!g.value&&T&&!o.value.area){const m=H(T);m&&(o.value.area=m)}!g.value&&T&&o.value.entity_type&&(J.value||!o.value.icon)&&(o.value.icon=E(o.value.entity_type,T),J.value=!0)}),se(()=>o.value.entity_type,T=>{!g.value&&T&&(J.value||!o.value.icon)&&(o.value.icon=E(T,o.value.name),J.value=!0)}),se(()=>o.value.icon,(T,m)=>{m!==void 0&&T!==m&&!J.value&&(J.value=!1),T||(J.value=!1)});const j=y(!1),oe=async()=>{var T;if((T=r.device)!=null&&T.id){j.value=!0;try{const m=await te.post(`/api/devices/${r.device.id}/sync-area`);m.data.success?(o.value.area=m.data.area||"",m.data.area?console.log(`Area synced: ${m.data.area}`):console.log("No area assigned in Home Assistant")):console.warn(m.data.message||"Entity not found in HA")}catch(m){console.error("Failed to sync area:",m)}finally{j.value=!1}}},ie=()=>{var V;return!((V=r.device)!=null&&V.id)||!o.value.entity_type?"#":`/config/entities/entity/${`${o.value.entity_type}.${r.device.id}`}`},ye=()=>{P.value={name:"",entity_type:"",broadlink_entity:""};let T=!0;return(!o.value.name||o.value.name.trim()==="")&&(P.value.name="Device name is required",T=!1),o.value.entity_type||(P.value.entity_type="Entity type is required",T=!1),o.value.device_type==="broadlink"&&!o.value.broadlink_entity&&(P.value.broadlink_entity="Broadlink device is required",T=!1),T},Ee=T=>{P.value[T]=""},Te=async()=>{if(o.value.device_type==="smartir"){if(U.value&&!U.value.validate())return;const T={...o.value,smartir_config:{manufacturer:F.value.manufacturer,model:F.value.model,code_id:F.value.device_code,controller_device:F.value.controller_device}};$("save",T)}else{if(!ye())return;$("save",{...o.value})}},De=T=>{F.value=T};return(T,m)=>(n(),i("div",{class:"modal-overlay",onClick:m[11]||(m[11]=ce(V=>T.$emit("cancel"),["self"]))},[e("div",ol,[e("div",ll,[e("h2",null,p(g.value?"Edit Device":"Add New Device"),1),e("button",{onClick:m[0]||(m[0]=V=>T.$emit("cancel")),class:"close-btn"},[...m[12]||(m[12]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("form",{id:"device-form",onSubmit:ce(Te,["prevent"]),class:"modal-body"},[e("div",{class:W(["form-group",{"has-error":P.value.name}])},[m[14]||(m[14]=e("label",{for:"device-name"},"Device Name *",-1)),e("div",nl,[z(e("input",{id:"device-name",ref_key:"nameInput",ref:k,"onUpdate:modelValue":m[1]||(m[1]=V=>o.value.name=V),type:"text",placeholder:"e.g., Living Room TV",onInput:m[2]||(m[2]=V=>Ee("name"))},null,544),[[Le,o.value.name]]),P.value.name?(n(),i("div",sl,[m[13]||(m[13]=e("i",{class:"mdi mdi-alert"},null,-1)),x(" "+p(P.value.name),1)])):R("",!0)]),m[15]||(m[15]=e("small",null,"Friendly name for this device",-1))],2),e("div",{class:W(["form-group",{"has-error":P.value.entity_type}])},[m[23]||(m[23]=e("label",{for:"entity-type"},"Entity Type *",-1)),e("div",al,[z(e("select",{id:"entity-type",ref_key:"typeSelect",ref:f,"onUpdate:modelValue":m[3]||(m[3]=V=>o.value.entity_type=V),onChange:m[4]||(m[4]=V=>Ee("entity_type"))},[m[16]||(m[16]=He('<option value="" data-v-94bc1fe5>-- Select Type --</option><option value="light" data-v-94bc1fe5>ðŸ’¡ Light</option><option value="fan" data-v-94bc1fe5>ðŸŒ€ Fan</option><option value="switch" data-v-94bc1fe5>ðŸ”Œ Switch</option><option value="media_player" data-v-94bc1fe5>ðŸ“º Media Player</option><option value="cover" data-v-94bc1fe5>ðŸªŸ Cover (Blinds/Curtains)</option>',6)),e("option",{value:"climate",disabled:!v.value}," ðŸŒ¡ï¸ Climate "+p(v.value?"":"(Requires SmartIR)"),9,il)],544),[[Ie,o.value.entity_type]]),P.value.entity_type?(n(),i("div",rl,[m[17]||(m[17]=e("i",{class:"mdi mdi-alert"},null,-1)),x(" "+p(P.value.entity_type),1)])):R("",!0)]),o.value.entity_type==="climate"?(n(),i("div",dl,[v.value?(n(),i("div",ul,[...m[18]||(m[18]=[e("i",{class:"mdi mdi-check-circle"},null,-1),e("span",null,"SmartIR detected! Climate entities will be created via SmartIR profiles.",-1)])])):(n(),i("div",cl,[...m[19]||(m[19]=[e("i",{class:"mdi mdi-alert"},null,-1),e("div",null,[e("strong",null,"SmartIR Required"),e("p",null,"Climate entities (AC, heaters) require SmartIR integration."),e("a",{href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"smartir-link"}," Install SmartIR â†’ ")],-1)])]))])):v.value&&["media_player","fan","light"].includes(o.value.entity_type)?(n(),i("div",ml,[...m[20]||(m[20]=[e("div",{class:"notice-info"},[e("i",{class:"mdi mdi-information"}),e("span",null,"ðŸ’¡ SmartIR available! You can use pre-configured codes or learn your own.")],-1)])])):!v.value&&o.value.entity_type?(n(),i("small",vl,[m[21]||(m[21]=x(" ðŸ’¡ Tip: Install ",-1)),m[22]||(m[22]=e("a",{href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"inline-link"},"SmartIR",-1)),x(" for pre-configured "+p(o.value.entity_type==="climate"?"climate":o.value.entity_type)+" device codes ",1)])):R("",!0)],2),e("div",pl,[m[26]||(m[26]=e("label",{for:"device-type"},"Device Type *",-1)),z(e("select",{id:"device-type","onUpdate:modelValue":m[5]||(m[5]=V=>o.value.device_type=V),required:"",disabled:g.value},[m[24]||(m[24]=e("option",{value:""},"-- Select Device Type --",-1)),m[25]||(m[25]=e("option",{value:"broadlink"},"ðŸ“¡ Broadlink Device (Learn IR Codes)",-1)),_e(d)?(n(),i("option",{key:0,value:"smartir",disabled:!v.value||!D.value}," ðŸŒ SmartIR Device "+p(S.value),9,gl)):R("",!0)],8,fl),[[Ie,o.value.device_type]]),g.value?(n(),i("small",yl,"Cannot change device type after creation")):o.value.device_type==="smartir"?(n(),i("small",bl,"Using pre-configured codes from SmartIR repository")):o.value.device_type==="broadlink"?(n(),i("small",hl,"Learn and store your own IR codes")):(n(),i("small",kl,"Choose how to configure this device"))]),g.value?(n(),i("div",wl,[m[29]||(m[29]=e("label",{for:"device-area"},"Area",-1)),e("div",$l,[e("input",{id:"device-area",value:o.value.area||"Not assigned",type:"text",readonly:"",class:"readonly-input"},null,8,Cl),e("button",{type:"button",onClick:oe,disabled:j.value,class:"sync-area-btn",title:"Sync area from Home Assistant"},[e("i",{class:W(j.value?"mdi mdi-loading mdi-spin":"mdi mdi-refresh")},null,2)],8,_l)]),e("small",null,[m[27]||(m[27]=e("i",{class:"mdi mdi-information-outline"},null,-1)),m[28]||(m[28]=x(" Set area in Home Assistant, then click sync. ",-1)),e("a",{href:ie(),target:"_blank",class:"inline-link"},"Open in HA â†’",8,Sl)])])):(n(),i("div",Il,[...m[30]||(m[30]=[e("div",{class:"info-notice"},[e("i",{class:"mdi mdi-information-outline"}),e("span",null,[e("strong",null,"Area Assignment:"),x(" After generating entities and restarting Home Assistant, you can assign areas in HA and sync them here.")])],-1)])])),e("div",Dl,[m[31]||(m[31]=e("label",{for:"device-icon"},"Icon",-1)),ge(ho,{modelValue:o.value.icon,"onUpdate:modelValue":m[6]||(m[6]=V=>o.value.icon=V),inputId:"device-icon",placeholder:"e.g., mdi:television"},null,8,["modelValue"]),m[32]||(m[32]=e("small",null,"Optional: Material Design Icon name",-1))]),o.value.device_type==="broadlink"?(n(),i("div",{key:2,class:W(["form-group",{"has-error":P.value.broadlink_entity}])},[m[35]||(m[35]=e("label",{for:"broadlink-entity"},"Remote Device *",-1)),e("div",Tl,[!g.value||!O.value?z((n(),i("select",{key:0,id:"broadlink-entity",ref_key:"broadlinkSelect",ref:A,"onUpdate:modelValue":m[7]||(m[7]=V=>o.value.broadlink_entity=V),onChange:m[8]||(m[8]=V=>Ee("broadlink_entity"))},[m[33]||(m[33]=e("option",{value:""},"-- Select Remote Device --",-1)),(n(!0),i(me,null,he(s.value,V=>(n(),i("option",{key:V.entity_id,value:V.entity_id},[x(p(V.name||V.entity_id)+" ",1),V.area_name?(n(),i(me,{key:0},[x(" - "+p(V.area_name),1)],64)):R("",!0)],8,xl))),128))],544)),[[Ie,o.value.broadlink_entity]]):(n(),i("input",{key:1,id:"broadlink-entity",value:h.value,type:"text",readonly:"",disabled:""},null,8,Rl)),P.value.broadlink_entity?(n(),i("div",Ml,[m[34]||(m[34]=e("i",{class:"mdi mdi-alert"},null,-1)),x(" "+p(P.value.broadlink_entity),1)])):R("",!0)]),!g.value||!O.value?(n(),i("small",El,"Required: Select which remote device to use for sending commands")):(n(),i("small",Al,"Cannot change remote device after commands are learned"))],2)):R("",!0),o.value.device_type==="smartir"?(n(),i("div",Ll,[m[36]||(m[36]=e("div",{class:"section-header"},[e("i",{class:"mdi mdi-cloud-download"}),e("span",null,"SmartIR Device Configuration")],-1)),ge(tl,{ref_key:"smartirSelector",ref:U,"entity-type":o.value.entity_type,modelValue:F.value,"onUpdate:modelValue":m[9]||(m[9]=V=>F.value=V),"broadlink-devices":s.value,onChange:De},null,8,["entity-type","modelValue","broadlink-devices"])])):R("",!0)],32),e("div",Ol,[e("button",{type:"button",onClick:m[10]||(m[10]=V=>T.$emit("cancel")),class:"btn btn-secondary"}," Cancel "),e("button",Pl,[m[37]||(m[37]=e("i",{class:"mdi mdi-check"},null,-1)),x(" "+p(g.value?"Update":"Create"),1)])])])]))}},Ul=$e(Vl,[["__scopeId","data-v-94bc1fe5"]]),jl={class:"modal-header"},Fl={class:"modal-body"},Nl={class:"message-text"},Bl={key:0,class:"checkbox-option"},Hl={class:"modal-footer"},ql=["disabled"],zl={__name:"ConfirmDialog",props:{isOpen:{type:Boolean,default:!1},title:{type:String,default:"Confirm"},message:{type:String,required:!0},confirmText:{type:String,default:"OK"},cancelText:{type:String,default:"Cancel"},showCancel:{type:Boolean,default:!0},dangerMode:{type:Boolean,default:!1},confirmDisabled:{type:Boolean,default:!1},checkboxLabel:{type:String,default:""}},emits:["confirm","cancel"],setup(t,{emit:u}){const r=t,$=u,w=y(!1);se(()=>r.isOpen,g=>{g&&(w.value=!1)});const d=()=>{$("confirm",w.value)},v=()=>{$("cancel")};return(g,D)=>t.isOpen?(n(),i("div",{key:0,class:"modal-overlay",onClick:ce(v,["self","stop"])},[e("div",{class:"modal-dialog confirm-dialog",onClick:D[1]||(D[1]=ce(()=>{},["stop"]))},[e("div",jl,[e("h2",null,p(t.title),1)]),e("div",Fl,[e("p",Nl,p(t.message),1),t.checkboxLabel?(n(),i("div",Bl,[e("label",null,[z(e("input",{type:"checkbox","onUpdate:modelValue":D[0]||(D[0]=S=>w.value=S)},null,512),[[ve,w.value]]),e("span",null,p(t.checkboxLabel),1)])])):R("",!0)]),e("div",Hl,[t.showCancel?(n(),i("button",{key:0,onClick:ce(v,["stop"]),class:"btn btn-secondary"},p(t.cancelText),1)):R("",!0),t.confirmText?(n(),i("button",{key:1,onClick:ce(d,["stop"]),class:W(["btn",t.dangerMode?"btn-danger":"btn-primary"]),disabled:t.confirmDisabled},p(t.confirmText),11,ql)):R("",!0)])])])):R("",!0)}},Be=$e(zl,[["__scopeId","data-v-9cea6cb3"]]),Jl={class:"modal-content"},Wl={class:"modal-header"},Gl={class:"modal-body"},Kl={key:0,class:"smartir-info"},Xl={key:0,class:"climate-note"},Yl={class:"form-group"},Zl=["value"],Ql={class:"form-group"},en=["disabled"],tn={label:"Suggested Commands"},on=["value"],ln=["disabled"],nn={class:"form-group"},sn={class:"radio-card-group"},an=["disabled"],rn={class:"radio-indicator"},dn=["disabled"],un={class:"radio-indicator"},cn={class:"form-group"},mn={class:"radio-card-group"},vn=["disabled"],pn={class:"radio-indicator"},fn=["disabled"],gn={class:"radio-indicator"},yn=["disabled"],bn={class:"radio-indicator"},hn={key:0,class:"help-box"},kn={class:"learn-action"},wn=["disabled"],$n={key:0,class:"mdi mdi-loading mdi-spin"},Cn={key:1,class:"mdi mdi-remote-tv"},_n={key:0,class:"learning-status"},Sn={key:0},In={key:1},Dn={key:2},Tn={key:1,class:"result-message success"},xn={key:2,class:"section-divider"},Rn={key:3,class:"loading-commands"},Mn={key:4,class:"learned-commands"},En={class:"commands-header"},An=["disabled"],Ln={class:"command-list"},On={class:"command-info"},Pn={class:"command-name"},Vn={class:"command-right"},Un={key:0,class:"mdi mdi-alert-circle error-icon",title:"Error: Command failed to learn. Delete and try again."},jn={key:1,class:"mdi mdi-clock-outline pending-icon",title:"Pending: Waiting for code from storage..."},Fn=["title"],Nn={class:"command-actions"},Bn=["onClick","title","disabled"],Hn=["onClick","title"],qn={key:5,class:"untracked-commands"},zn={class:"command-list"},Jn={class:"command-name"},Wn=["onClick"],Gn={class:"modal-footer"},Kn=["disabled"],Xn={__name:"CommandLearner",props:{device:{type:Object,required:!0}},emits:["cancel","learned"],setup(t,{emit:u}){const r=t,$=u,w=y([]),d=y(""),v=y(""),g=y(""),D=y("ir"),S=y("manager_only"),O=y(!1),h=y(!1),o=y(""),P=y(""),F=y(""),U=y("success"),_=y([]),s=y([]),k=y(!1),f=y(!1),A=y(""),J=y(!1),Y=y(null),Q=y(null),H=y(""),E=y(""),j=G(()=>r.device.device_type==="smartir");G(()=>{if(j.value)return!1;const b=v.value==="__custom__"?g.value:v.value;return d.value&&b.trim()});const oe=()=>{Y.value&&Y.value.setCustomValidity("")},ie=()=>{Q.value&&Q.value.setCustomValidity("")},ye=G(()=>{const b=w.value.find(c=>c.entity_id===d.value);return b?b.name||b.entity_id:d.value}),Ee={light:["turn_on","turn_off","toggle","brightness_up","brightness_down","dim","bright"],fan:["turn_on","turn_off","toggle","speed_low","speed_medium","speed_high","speed_1","speed_2","speed_3","speed_4","speed_5","oscillate_on","oscillate_off","direction_forward","direction_reverse"],switch:["turn_on","turn_off","toggle"],media_player:["turn_on","turn_off","toggle","volume_up","volume_down","volume_mute","play","pause","stop","play_pause","next_track","previous_track","channel_up","channel_down","source_hdmi1","source_hdmi2","source_hdmi3","source_tv","source_aux","source_bluetooth","menu","home","back","select","arrow_up","arrow_down","arrow_left","arrow_right"],cover:["open","close","stop","open_tilt","close_tilt","position_0","position_25","position_50","position_75","position_100"]},Te=G(()=>{const b=r.device.entity_type||"switch";return Ee[b]||Ee.switch});se(()=>r.device,async(b,c)=>{if(b&&c&&b.id===c.id){const l=Object.keys(b.commands||{}).length,N=Object.keys(c.commands||{}).length;l!==N&&(console.log(`ðŸ”„ Device commands changed (${N} -> ${l}), reloading...`),await T(!0))}},{deep:!0}),xe(async()=>{await De(),await T(),await ue(),Y.value&&(Y.value.setCustomValidity(""),Y.value.oninvalid=()=>{Y.value.setCustomValidity("Command name is required")}),r.device.broadlink_entity&&(d.value=r.device.broadlink_entity)}),se(v,async b=>{b==="__custom__"&&(await at(),Q.value&&(Q.value.setCustomValidity(""),Q.value.oninvalid=()=>{Q.value.setCustomValidity("Custom command name is required")}))});const De=async()=>{try{const b=await te.get("/api/broadlink/devices");w.value=b.data.devices||[]}catch(b){console.error("Error loading Broadlink devices:",b)}},T=async(b=!1)=>{var c,l;k.value=!0;try{if(j.value){const N=await te.get("/api/smartir/codes/code",{params:{entity_type:r.device.entity_type,code_id:r.device.device_code}});if(N.data.success&&N.data.code){const C=N.data.code.commands||{},a=N.data.code.commandType||"ir";if(r.device.entity_type==="climate"){const M=[];for(const[K,le]of Object.entries(C))typeof le=="string"?M.push({name:K,type:a}):typeof le=="object"&&le!==null&&Object.keys(le).sort((Z,Re)=>parseInt(Z)-parseInt(Re)).forEach(Z=>{M.push({name:`${K}_${Z}`,type:a,label:`${K.charAt(0).toUpperCase()+K.slice(1)} ${Z}Â°C`})});_.value=M}else _.value=Object.keys(C).map(M=>({name:M,type:a}))}}else{if(console.log("ðŸ“‹ Loading commands for device:",r.device),console.log("ðŸ“‹ Device ID:",r.device.id),console.log("ðŸ“‹ Force reload:",b),b&&r.device.id){console.log("ðŸ”„ Force reloading commands from API after sync");try{const C=(await te.get(`/api/commands/${r.device.id}`)).data.commands||{};console.log("ðŸ“¦ Raw commands from API:",C),_.value=Object.entries(C).map(([a,M])=>{console.log(`  Command '${a}':`,M,`(type: ${typeof M})`);const K=typeof M=="object"&&M!==null&&(M.command_type||M.type)||"ir",le=typeof M=="object"&&M!==null?M.data:M;return{name:a,type:K,data:le,hasError:le==="error",isPending:le==="pending"}}),console.log("ðŸ“‹ Reloaded commands:",_.value)}catch(N){if(console.error("âŒ Error loading commands:",N),((c=N.response)==null?void 0:c.status)===404)console.log("â„¹ï¸ No commands found for device"),_.value=[];else throw N}}else if(r.device.commands&&Object.keys(r.device.commands).length>0)console.log("âœ… Using commands from device object"),_.value=Object.entries(r.device.commands).map(([N,C])=>{const a=C.data||C;return{name:N,type:C.command_type||C.type||"ir",data:a,hasError:a==="error",isPending:a==="pending"}});else if(r.device.commands!==void 0)console.log("â„¹ï¸ Device has empty commands object - skipping API call"),_.value=[];else if(r.device.id){console.log("ðŸŒ Fetching commands from API for device ID:",r.device.id);try{const C=(await te.get(`/api/commands/${r.device.id}`)).data.commands||{};_.value=Object.entries(C).map(([a,M])=>({name:a,type:M.command_type||M.type||"ir"}))}catch(N){if(((l=N.response)==null?void 0:l.status)===404)console.log("â„¹ï¸ No commands found for device (this is normal for new devices)"),_.value=[];else throw N}}else console.log("âš ï¸ No commands found and no device ID");console.log("ðŸ“‹ Final learned commands:",_.value)}}catch(N){console.error("Error loading commands:",N)}finally{k.value=!1}},m=async()=>{F.value="",U.value="",P.value="",h.value=!0,o.value="preparing";try{const b=v.value==="__custom__"?g.value:v.value;D.value==="rf"?(o.value="learning",F.value="âš ï¸ Learning request sent to device. Check Home Assistant notifications (ðŸ””) for instructions. Note: If the device is offline or times out, you will see a notification but this dialog will still show success.",U.value="warning",await new Promise(l=>setTimeout(l,50))):o.value="learning";const c=await te.post("/api/commands/learn",{device_id:r.device.id,entity_id:d.value||r.device.broadlink_entity,device:r.device.device||r.device.id,command:b.trim(),command_type:D.value,save_destination:S.value});if(c.data.success){if(o.value="complete",F.value="",U.value="",S.value==="manager_only"||S.value==="both"){_.value.find(C=>C.name===b)||_.value.push({name:b,type:D.value});const N=s.value.indexOf(b);N>-1&&s.value.splice(N,1)}await ue(),v.value="",g.value="",$("learned",{deviceId:r.device.id,commandName:b,commandType:D.value}),h.value=!1,o.value=""}else throw new Error(c.data.error||"Failed to learn command")}catch(b){console.error("Learning error:",b),F.value=b.message||"Error learning command",U.value="error",h.value=!1,o.value=""}},V=async b=>{var c,l;try{E.value=b,H.value="";let N=r.device.id.split(".")[1];r.device.device&&(N=r.device.device);const C=j.value?r.device.controller_device:d.value||r.device.broadlink_entity;if(!C){console.error("Missing entity_id for test command:",{isSmartIR:j.value,controller_device:r.device.controller_device,broadlink_entity:r.device.broadlink_entity,selectedBroadlink:d.value,device:r.device}),F.value="Missing Broadlink remote entity. Please select a Broadlink device.",U.value="error",E.value="";return}const a={device_id:r.device.id,entity_id:C,command:b,device:r.device.device||r.device.id};console.log("ðŸ§ª Testing command:",a),(await te.post("/api/commands/test",a)).data.success&&(H.value=b,setTimeout(()=>{H.value===b&&(H.value="")},2e3))}catch(N){console.error("âŒ Test command error:",N);const C=((l=(c=N.response)==null?void 0:c.data)==null?void 0:l.error)||N.message||"Unknown error";F.value=`Failed to send command: ${C}`,U.value="error"}finally{E.value=""}},pe=b=>{A.value=b,f.value=!0},Oe=()=>{f.value=!1,A.value=""},fe=async b=>{const c=A.value;f.value=!1;try{if(console.log(`ðŸ—‘ï¸ Deleting command: ${c}, alsoDeleteFromIntegration: ${b}`),await te.delete(`/api/commands/${r.device.id}/${c}`),b)try{const l=r.device.device||r.device.id;await te.post("/api/commands/delete-from-storage",{device:l,command:c}),console.log("âœ… Also deleted from Broadlink Integration storage")}catch(l){console.warn("âš ï¸ Failed to delete from Broadlink Integration storage:",l)}await T(!0),await ue(),F.value=`Command "${c}" deleted`,U.value="success",$("learned",{deviceId:r.device.id,commandName:c,action:"deleted"})}catch(l){console.error("âŒ Delete error:",l),F.value=`Failed to delete command: ${l.message}`,U.value="error",await T(!0)}finally{A.value=""}},ue=async()=>{try{let b=r.device.device;b||(b=r.device.id.includes(".")?r.device.id.split(".")[1]:r.device.id),console.log("ðŸ” Looking for untracked commands for device:",b);const l=(await te.get("/api/commands/untracked")).data.untracked||{};console.log("ðŸ“¦ All untracked commands:",Object.keys(l)),console.log("ðŸ“¦ Untracked for this device:",l[b]),l[b]?s.value=Object.keys(l[b].commands):s.value=[]}catch(b){console.error("Error loading untracked commands:",b),s.value=[]}},Ae=()=>{s.value.length!==0&&(J.value=!0)},Pe=async b=>{var c,l,N;console.log("ðŸ”µ [IMPORT SINGLE] Importing command:",b);try{const C=r.device.device||r.device.id||((c=r.device.id)!=null&&c.includes(".")?r.device.id.split(".")[1]:null);if(!C)throw new Error("Could not determine device name for import");console.log("ðŸ”µ [IMPORT SINGLE] Calling API to import command...");const a=await te.post("/api/commands/import",{device_id:r.device.id,source_device:C,commands:[b]});console.log("ðŸ”µ [IMPORT SINGLE] API response:",a.data),a.data.success?(F.value=`Imported command '${b}' successfully!`,U.value="success",await T(!0),await ue()):(F.value=a.data.error||"Failed to import command",U.value="error")}catch(C){console.error("ðŸ”´ [IMPORT SINGLE] Error:",C),F.value=((N=(l=C.response)==null?void 0:l.data)==null?void 0:N.error)||C.message||"Failed to import command",U.value="error"}},ee=async()=>{var b;console.log("ðŸ”µ [IMPORT] Starting import process..."),console.log("ðŸ”µ [IMPORT] Current learned commands:",_.value.length),console.log("ðŸ”µ [IMPORT] Current untracked commands:",s.value.length),J.value=!1;try{const c=r.device.device||r.device.id||((b=r.device.id)!=null&&b.includes(".")?r.device.id.split(".")[1]:null);if(console.log("ðŸ”µ [IMPORT] Device object:",r.device),console.log("ðŸ”µ [IMPORT] Extracted device name:",c),!c)throw new Error("Could not determine device name for import");console.log("ðŸ”µ [IMPORT] Calling API to import commands...");const l=await te.post("/api/commands/import",{device_id:r.device.id,source_device:c,commands:s.value});console.log("ðŸ”µ [IMPORT] API response:",l.data),l.data.success&&(F.value=`Imported ${l.data.imported_count} commands successfully!`,U.value="success",console.log("ðŸ”µ [IMPORT] Import successful, now reloading commands..."),console.log("ðŸ”µ [IMPORT] BEFORE reload - learned:",_.value.length,"untracked:",s.value.length),await T(!0),console.log("ðŸ”µ [IMPORT] AFTER loadLearnedCommands - learned:",_.value.length),await ue(),console.log("ðŸ”µ [IMPORT] AFTER loadUntrackedCommands - untracked:",s.value.length),console.log("ðŸ”µ [IMPORT] Final state - learned:",_.value,"untracked:",s.value),console.log("ðŸ”µ [IMPORT] Emitting learned event to parent..."),$("learned",{deviceId:r.device.id,action:"imported",count:l.data.imported_count}),console.log("ðŸ”µ [IMPORT] âœ… Import process complete!"))}catch(c){console.error("ðŸ”µ [IMPORT] âŒ Import failed:",c),F.value=`Failed to import commands: ${c.message}`,U.value="error"}};return(b,c)=>(n(),i("div",{class:"modal-overlay",onClick:c[12]||(c[12]=ce(l=>b.$emit("cancel"),["self"]))},[e("div",Jl,[e("div",Wl,[e("h2",null,p(j.value?"Commands for":"Learn Commands for")+" "+p(t.device.name),1),e("button",{onClick:c[0]||(c[0]=l=>b.$emit("cancel")),class:"close-btn"},[...c[13]||(c[13]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Gl,[j.value?(n(),i("div",Kl,[c[18]||(c[18]=e("i",{class:"mdi mdi-information"},null,-1)),e("div",null,[c[17]||(c[17]=e("h3",null,"SmartIR Device",-1)),e("p",null,[c[14]||(c[14]=x("This device uses SmartIR code file ",-1)),e("strong",null,p(t.device.device_code),1),c[15]||(c[15]=x(". Commands are pre-configured and cannot be learned.",-1))]),t.device.entity_type==="climate"?(n(),i("p",Xl,[...c[16]||(c[16]=[e("i",{class:"mdi mdi-alert-circle-outline"},null,-1),e("strong",null,"Note:",-1),x(" Climate device commands are temperature-based. Testing individual modes may not work as expected. Use the Home Assistant climate card to control your device. ",-1)])])):R("",!0)])])):(n(),i("form",{key:1,onSubmit:ce(m,["prevent"])},[e("div",Yl,[c[19]||(c[19]=e("label",{for:"broadlink-entity"},"Broadlink Device",-1)),e("input",{id:"broadlink-entity",value:ye.value,type:"text",readonly:"",disabled:""},null,8,Zl),c[20]||(c[20]=e("small",null,"Commands will be learned using this device (set when device was created)",-1))]),e("div",Ql,[c[23]||(c[23]=e("label",{for:"command-name"},"Command Name *",-1)),z(e("select",{id:"command-name",ref_key:"commandSelect",ref:Y,"onUpdate:modelValue":c[1]||(c[1]=l=>v.value=l),disabled:h.value,required:"",onChange:oe},[c[21]||(c[21]=e("option",{value:""},"-- Select or type command --",-1)),e("optgroup",tn,[(n(!0),i(me,null,he(Te.value,l=>(n(),i("option",{key:l,value:l},p(l),9,on))),128))]),c[22]||(c[22]=e("option",{value:"__custom__"},"Custom command...",-1))],40,en),[[Ie,v.value]]),v.value==="__custom__"?z((n(),i("input",{key:0,ref_key:"customCommandInput",ref:Q,"onUpdate:modelValue":c[2]||(c[2]=l=>g.value=l),type:"text",placeholder:"Enter custom command name",disabled:h.value,required:"",class:"custom-command-input",onInput:ie},null,40,ln)),[[Le,g.value]]):R("",!0),e("small",null,"Select a suggested command for "+p(t.device.entity_type||"this device")+", or enter a custom one.",1)]),e("div",nn,[c[26]||(c[26]=e("label",null,"Command Type",-1)),e("div",sn,[e("label",{class:W(["radio-card",{active:D.value==="ir",disabled:h.value}])},[z(e("input",{type:"radio","onUpdate:modelValue":c[3]||(c[3]=l=>D.value=l),value:"ir",disabled:h.value},null,8,an),[[ze,D.value]]),e("span",rn,[e("i",{class:W(["mdi",D.value==="ir"?"mdi-radiobox-marked":"mdi-radiobox-blank"])},null,2)]),c[24]||(c[24]=e("div",{class:"icon-text-group"},[e("i",{class:"mdi mdi-remote card-icon"}),e("span",{class:"card-text"},"IR (Infrared)")],-1))],2),e("label",{class:W(["radio-card",{active:D.value==="rf",disabled:h.value}])},[z(e("input",{type:"radio","onUpdate:modelValue":c[4]||(c[4]=l=>D.value=l),value:"rf",disabled:h.value},null,8,dn),[[ze,D.value]]),e("span",un,[e("i",{class:W(["mdi",D.value==="rf"?"mdi-radiobox-marked":"mdi-radiobox-blank"])},null,2)]),c[25]||(c[25]=e("div",{class:"icon-text-group"},[e("i",{class:"mdi mdi-radio-tower card-icon"}),e("span",{class:"card-text"},"RF (Radio Frequency)")],-1))],2)])]),e("div",cn,[e("label",null,[c[28]||(c[28]=x(" Save Destination ",-1)),e("button",{type:"button",class:"help-btn",onClick:c[5]||(c[5]=l=>O.value=!O.value),title:"Learn more"},[...c[27]||(c[27]=[e("i",{class:"mdi mdi-help-circle-outline"},null,-1)])])]),e("div",mn,[e("label",{class:W(["radio-card",{active:S.value==="manager_only",disabled:h.value}])},[z(e("input",{type:"radio","onUpdate:modelValue":c[6]||(c[6]=l=>S.value=l),value:"manager_only",disabled:h.value},null,8,vn),[[ze,S.value]]),e("span",pn,[e("i",{class:W(["mdi",S.value==="manager_only"?"mdi-radiobox-marked":"mdi-radiobox-blank"])},null,2)]),c[29]||(c[29]=e("div",{class:"icon-text-group"},[e("i",{class:"mdi mdi-application card-icon"}),e("span",{class:"card-text"},"Broadlink Manager")],-1))],2),e("label",{class:W(["radio-card",{active:S.value==="integration_only",disabled:h.value}])},[z(e("input",{type:"radio","onUpdate:modelValue":c[7]||(c[7]=l=>S.value=l),value:"integration_only",disabled:h.value},null,8,fn),[[ze,S.value]]),e("span",gn,[e("i",{class:W(["mdi",S.value==="integration_only"?"mdi-radiobox-marked":"mdi-radiobox-blank"])},null,2)]),c[30]||(c[30]=e("div",{class:"icon-text-group"},[e("i",{class:"mdi mdi-home-assistant card-icon"}),e("span",{class:"card-text"},"Broadlink Integration")],-1))],2),e("label",{class:W(["radio-card",{active:S.value==="both",disabled:h.value}])},[z(e("input",{type:"radio","onUpdate:modelValue":c[8]||(c[8]=l=>S.value=l),value:"both",disabled:h.value},null,8,yn),[[ze,S.value]]),e("span",bn,[e("i",{class:W(["mdi",S.value==="both"?"mdi-radiobox-marked":"mdi-radiobox-blank"])},null,2)]),c[31]||(c[31]=e("div",{class:"icon-text-group"},[e("i",{class:"mdi mdi-swap-horizontal card-icon"}),e("span",{class:"card-text"},"Both")],-1))],2)]),O.value?(n(),i("div",hn,[...c[32]||(c[32]=[e("h4",null,"Save Destination Options",-1),e("ul",null,[e("li",null,[e("strong",null,"Broadlink Manager (Recommended):"),x(" Commands are saved only in this app's database (devices.json). This gives you full control and makes commands portable. The Broadlink Integration won't see these commands.")]),e("li",null,[e("strong",null,"Broadlink Integration:"),x(" Commands are saved only in Home Assistant's Broadlink Integration storage. This app won't track these commands, but they'll be available to the Broadlink Integration's remote.send_command service.")]),e("li",null,[e("strong",null,"Both:"),x(" Commands are saved in both places. Use this if you want commands available in both this app and the Broadlink Integration.")])],-1)])])):R("",!0)]),e("div",kn,[e("button",{type:"submit",class:"btn btn-primary btn-large",disabled:h.value},[h.value?(n(),i("i",$n)):(n(),i("i",Cn)),x(" "+p(h.value?"Learning...":"Learn Command"),1)],8,wn)]),h.value?(n(),i("div",_n,[c[36]||(c[36]=e("i",{class:"mdi mdi-loading mdi-spin"},null,-1)),o.value==="preparing"?(n(),i("div",Sn,[...c[33]||(c[33]=[e("p",null,[e("strong",null,"Preparing device...")],-1),e("small",null,"Connecting and authenticating with Broadlink device (this takes a few seconds)",-1)])])):D.value==="ir"?(n(),i("div",In,[...c[34]||(c[34]=[e("p",null,[e("strong",null,"Ready!"),x(" Point your remote at the Broadlink device and press the button...")],-1),e("small",null,"This may take up to 30 seconds",-1)])])):D.value==="rf"?(n(),i("div",Dn,[...c[35]||(c[35]=[e("p",null,[e("strong",null,"Learning RF command...")],-1),e("small",null,"Check Home Assistant notifications (ðŸ””) for instructions",-1)])])):R("",!0)])):R("",!0),F.value&&U.value==="success"&&!F.value.includes("sent successfully")&&!h.value?(n(),i("div",Tn,[c[37]||(c[37]=e("i",{class:"mdi mdi-check-circle"},null,-1)),e("p",null,p(F.value),1)])):R("",!0)],32)),_.value.length>0||s.value.length>0?(n(),i("div",xn)):R("",!0),k.value?(n(),i("div",Rn,[...c[38]||(c[38]=[e("div",{class:"loading-spinner"},[e("i",{class:"mdi mdi-loading mdi-spin"}),e("p",null,"Loading commands...")],-1)])])):_.value.length>0?(n(),i("div",Mn,[e("div",En,[e("h3",null,"Tracked Commands ("+p(_.value.length)+")",1),e("button",{type:"button",onClick:c[9]||(c[9]=l=>T(!0)),class:"icon-btn refresh-btn",title:"Refresh commands",disabled:k.value},[e("i",{class:W(["mdi mdi-refresh",{"mdi-spin":k.value}])},null,2)],8,An)]),e("div",Ln,[(n(!0),i(me,null,he(_.value,l=>(n(),i("div",{key:l.name,class:W(["command-item",{"error-state":l.hasError,"pending-state":l.isPending}])},[e("div",On,[e("span",Pn,p(l.label||l.name),1)]),e("div",Vn,[l.hasError?(n(),i("i",Un)):l.isPending?(n(),i("i",jn)):(n(),i("i",{key:2,class:"mdi mdi-check-circle learned-icon",title:`Learned (${(l.type||"ir").toUpperCase()})`},null,8,Fn)),e("span",{class:W(["command-type-badge",l.type||"ir"])},p((l.type||"ir").toUpperCase()),3),e("div",Nn,[e("button",{type:"button",onClick:N=>V(l.name),class:"icon-btn",title:l.hasError?"Cannot test - command failed to learn":l.isPending?"Cannot test - waiting for code":"Test command",disabled:E.value===l.name||l.hasError||l.isPending},[e("i",{class:W(["mdi mdi-play",{"mdi-spin":E.value===l.name}])},null,2)],8,Bn),e("button",{type:"button",onClick:N=>pe(l.name),class:"icon-btn danger",title:l.hasError?"Delete and re-learn":"Delete command"},[...c[39]||(c[39]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,Hn)])])],2))),128))])])):R("",!0),s.value.length>0?(n(),i("div",qn,[e("h3",null,[c[40]||(c[40]=e("i",{class:"mdi mdi-alert"},null,-1)),x(" Untracked Commands ("+p(s.value.length)+") ",1)]),c[43]||(c[43]=e("p",{class:"untracked-info"}," These commands exist in Broadlink storage but are not tracked in this device. ",-1)),e("div",zn,[(n(!0),i(me,null,he(s.value,l=>(n(),i("div",{key:l,class:"command-item untracked"},[e("span",Jn,p(l),1),e("button",{type:"button",onClick:N=>Pe(l),class:"btn-icon",title:"Import this command"},[...c[41]||(c[41]=[e("i",{class:"mdi mdi-import"},null,-1)])],8,Wn)]))),128))]),c[44]||(c[44]=e("br",null,null,-1)),e("button",{type:"button",onClick:Ae,class:"btn btn-secondary"},[...c[42]||(c[42]=[e("i",{class:"mdi mdi-import"},null,-1),x(" Import All Untracked Commands ",-1)])])])):R("",!0)]),e("div",Gn,[e("button",{type:"button",onClick:c[10]||(c[10]=l=>b.$emit("cancel")),class:"btn btn-secondary",disabled:h.value}," Close ",8,Kn)])]),ge(Be,{isOpen:f.value,title:"Delete Command?",message:`Delete command '${A.value}' from Broadlink Manager?`,checkboxLabel:"Also delete from Broadlink Integration storage",confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,onConfirm:fe,onCancel:Oe},null,8,["isOpen","message"]),ge(Be,{isOpen:J.value,title:"Import Commands?",message:`Import ${s.value.length} untracked command${s.value.length>1?"s":""} into this device?`,confirmText:"Import",cancelText:"Cancel",onConfirm:ee,onCancel:c[11]||(c[11]=l=>J.value=!1)},null,8,["isOpen","message"])]))}},Yn=$e(Xn,[["__scopeId","data-v-ac37de7c"]]),Zn={class:"modal-container error-dialog"},Qn={class:"modal-header"},es={class:"modal-body"},ts={class:"error-message"},os={key:0,class:"error-suggestion"},ls=["open"],ns={class:"debug-content"},ss={class:"debug-info"},as={key:0,class:"debug-section-title"},is={key:1},rs={__name:"ErrorDialog",props:{isOpen:{type:Boolean,default:!1},title:{type:String,default:"Error"},message:{type:String,required:!0},suggestion:{type:String,default:""},details:{type:String,default:""},error:{type:Object,default:null},context:{type:Object,default:()=>({})}},emits:["close"],setup(t,{emit:u}){const r=t,$=u,w=Me("toast"),d=y(!1),v=()=>{$("close")},g=G(()=>{var P,F,U,_,s,k,f,A,J,Y,Q;const h=new Date().toISOString(),o=r.error||{};return{error:JSON.stringify({message:r.message,title:r.title,details:r.details,errorObject:o.message||o.toString(),timestamp:h},null,2),request:JSON.stringify({method:((F=(P=o.config)==null?void 0:P.method)==null?void 0:F.toUpperCase())||"N/A",url:((U=o.config)==null?void 0:U.url)||"N/A",baseURL:((_=o.config)==null?void 0:_.baseURL)||"N/A",headers:((s=o.config)==null?void 0:s.headers)||{},data:(k=o.config)!=null&&k.data?JSON.parse(o.config.data):"N/A",params:((f=o.config)==null?void 0:f.params)||{}},null,2),response:JSON.stringify({status:((A=o.response)==null?void 0:A.status)||"N/A",statusText:((J=o.response)==null?void 0:J.statusText)||"N/A",data:((Y=o.response)==null?void 0:Y.data)||"N/A",headers:((Q=o.response)==null?void 0:Q.headers)||{}},null,2),browser:JSON.stringify({userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language,cookieEnabled:navigator.cookieEnabled,onLine:navigator.onLine,viewport:`${window.innerWidth}x${window.innerHeight}`,screenResolution:`${window.screen.width}x${window.screen.height}`,colorDepth:window.screen.colorDepth,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,timestamp:h},null,2),appState:JSON.stringify({currentRoute:window.location.pathname,currentURL:window.location.href,referrer:document.referrer||"N/A",context:r.context||{},localStorage:{smartir_simulate:localStorage.getItem("smartir_simulate_not_installed"),theme:localStorage.getItem("theme")}},null,2),stackTrace:o.stack||null}}),D=async()=>{const h=O();try{await navigator.clipboard.writeText(h),w==null||w.success("Debug information copied to clipboard","âœ… Copied")}catch(o){console.error("Failed to copy:",o),w==null||w.error("Failed to copy to clipboard","âŒ Copy Failed")}},S=()=>{const h=O(),o=new Blob([h],{type:"text/plain"}),P=URL.createObjectURL(o),F=document.createElement("a");F.href=P;const U=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5);F.download=`broadlink-manager-error-${U}.txt`,document.body.appendChild(F),F.click(),document.body.removeChild(F),URL.revokeObjectURL(P),w==null||w.success("Debug report downloaded","âœ… Downloaded")},O=()=>`Broadlink Manager - Error Report
${"=".repeat(60)}

Generated: ${new Date().toISOString()}
Title: ${r.title}
Message: ${r.message}
${r.suggestion?`Suggestion: ${r.suggestion}
`:""}
${"=".repeat(60)}

ERROR DETAILS
${"-".repeat(60)}
${g.value.error}

REQUEST INFORMATION
${"-".repeat(60)}
${g.value.request}

RESPONSE INFORMATION
${"-".repeat(60)}
${g.value.response}

BROWSER INFORMATION
${"-".repeat(60)}
${g.value.browser}

APPLICATION STATE
${"-".repeat(60)}
${g.value.appState}

${g.value.stackTrace?`STACK TRACE
${"-".repeat(60)}
${g.value.stackTrace}

`:""}
${"=".repeat(60)}
End of Report
`;return se(()=>r.isOpen,h=>{if(h){const o=P=>{P.key==="Escape"&&v()};return document.addEventListener("keydown",o),()=>document.removeEventListener("keydown",o)}}),(h,o)=>(n(),Fe(it,{to:"body"},[ge(st,{name:"modal"},{default:tt(()=>[t.isOpen?(n(),i("div",{key:0,class:"modal-overlay",onClick:ce(v,["self"])},[e("div",Zn,[e("div",Qn,[o[2]||(o[2]=e("div",{class:"header-icon error-icon"},[e("i",{class:"mdi mdi-alert-circle"})],-1)),e("h3",null,p(t.title),1),e("button",{onClick:v,class:"close-button"},[...o[1]||(o[1]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",es,[e("p",ts,p(t.message),1),t.suggestion?(n(),i("p",os,[o[3]||(o[3]=e("i",{class:"mdi mdi-lightbulb-on"},null,-1)),x(" "+p(t.suggestion),1)])):R("",!0),e("details",{class:"debug-section",open:d.value},[e("summary",{onClick:o[0]||(o[0]=P=>d.value=!d.value)},[e("i",{class:W(["mdi",d.value?"mdi-chevron-down":"mdi-chevron-right"])},null,2),o[4]||(o[4]=x(" Debug Information ",-1))]),e("div",ns,[e("div",{class:"debug-actions"},[e("button",{onClick:D,class:"btn-debug btn-copy"},[...o[5]||(o[5]=[e("i",{class:"mdi mdi-content-copy"},null,-1),x(" Copy to Clipboard ",-1)])]),e("button",{onClick:S,class:"btn-debug btn-download"},[...o[6]||(o[6]=[e("i",{class:"mdi mdi-download"},null,-1),x(" Download Report ",-1)])])]),e("div",ss,[o[7]||(o[7]=e("div",{class:"debug-section-title"},"Error Details",-1)),e("pre",null,p(g.value.error),1),o[8]||(o[8]=e("div",{class:"debug-section-title"},"Request Information",-1)),e("pre",null,p(g.value.request),1),o[9]||(o[9]=e("div",{class:"debug-section-title"},"Response Information",-1)),e("pre",null,p(g.value.response),1),o[10]||(o[10]=e("div",{class:"debug-section-title"},"Browser Information",-1)),e("pre",null,p(g.value.browser),1),o[11]||(o[11]=e("div",{class:"debug-section-title"},"Application State",-1)),e("pre",null,p(g.value.appState),1),g.value.stackTrace?(n(),i("div",as,"Stack Trace")):R("",!0),g.value.stackTrace?(n(),i("pre",is,p(g.value.stackTrace),1)):R("",!0)])])],8,ls)]),e("div",{class:"modal-footer"},[e("button",{onClick:v,class:"btn btn-primary"}," OK ")])])])):R("",!0)]),_:1})]))}},ds=$e(rs,[["__scopeId","data-v-23858149"]]),us={class:"modal-dialog"},cs={class:"modal-header"},ms={class:"modal-body"},vs={class:"device-list"},ps={class:"device-info"},fs={class:"device-details"},gs={class:"command-count"},ys={class:"device-actions"},bs=["onClick"],hs=["onClick"],ks={class:"modal-footer"},ws={class:"modal-dialog modal-dialog-small"},$s={class:"modal-header"},Cs={class:"modal-body"},_s={class:"warning-message"},Ss={class:"modal-footer"},Is=["disabled"],Ds=["disabled"],Ts={__name:"DeviceDiscovery",emits:["adopt"],setup(t,{expose:u,emit:r}){const $=Ge(),w=r,d=y([]),v=y(!1),g=y(!1),D=y(null),S=y(!1);y(!1),G(()=>d.value.length>0),xe(async()=>{await O()});const O=async()=>{try{const U=await te.get("/api/devices/discover");d.value=U.data.untracked_devices||[]}catch(U){console.error("Error loading untracked devices:",U),d.value=[]}},h=()=>{v.value=!0},o=U=>{v.value=!1,w("adopt",U)},P=U=>{D.value=U,g.value=!0},F=async()=>{if(!D.value)return;const U=D.value.device_name;S.value=!0;try{const _=await te.delete(`/api/devices/untracked/${encodeURIComponent(U)}`);if(_.data.success)d.value=d.value.filter(s=>s.device_name!==U),g.value=!1,D.value=null,d.value.length===0&&(v.value=!1),$.success(`Deleted all commands for '${U}'`);else throw new Error(_.data.error||"Failed to delete device")}catch(_){console.error("Error deleting device:",_),$.error(`Failed to delete device: ${_.message}`)}finally{S.value=!1}};return u({refresh:O,openDiscovery:h}),(U,_)=>{var s,k,f;return n(),i("div",null,[R("",!0),v.value?(n(),i("div",{key:1,class:"modal-overlay",onClick:_[2]||(_[2]=ce(A=>v.value=!1,["self"]))},[e("div",us,[e("div",cs,[_[9]||(_[9]=e("h2",null,"Discovered Devices",-1)),e("button",{onClick:_[0]||(_[0]=A=>v.value=!1),class:"close-btn"},[..._[8]||(_[8]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",ms,[_[14]||(_[14]=e("p",{class:"info-text"}," These devices have learned commands in Broadlink storage but are not being tracked. Adopt them to manage their commands and generate Home Assistant entities. ",-1)),e("div",vs,[(n(!0),i(me,null,he(d.value,A=>(n(),i("div",{key:A.device_name,class:"discovered-device"},[e("div",ps,[_[11]||(_[11]=e("div",{class:"device-icon"},[e("i",{class:"mdi mdi-devices"})],-1)),e("div",fs,[e("h4",null,p(A.device_name),1),e("span",gs,[_[10]||(_[10]=e("i",{class:"mdi mdi-remote"},null,-1)),x(" "+p(A.command_count)+" command"+p(A.command_count>1?"s":""),1)])])]),e("div",ys,[e("button",{onClick:J=>o(A),class:"btn btn-primary"},[..._[12]||(_[12]=[e("i",{class:"mdi mdi-plus"},null,-1),x(" Adopt ",-1)])],8,bs),e("button",{onClick:J=>P(A),class:"btn btn-danger",title:"Delete all commands"},[..._[13]||(_[13]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,hs)])]))),128))])]),e("div",ks,[R("",!0),e("button",{onClick:_[1]||(_[1]=A=>v.value=!1),class:"btn btn-secondary"}," Close ")])])])):R("",!0),g.value?(n(),i("div",{key:2,class:"modal-overlay",onClick:_[5]||(_[5]=ce(A=>g.value=!1,["self"]))},[e("div",ws,[e("div",$s,[_[16]||(_[16]=e("h2",null,"Delete Untracked Device",-1)),e("button",{onClick:_[3]||(_[3]=A=>g.value=!1),class:"close-btn"},[..._[15]||(_[15]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Cs,[e("div",_s,[_[18]||(_[18]=e("i",{class:"mdi mdi-alert"},null,-1)),e("div",null,[e("p",null,[e("strong",null,'Are you sure you want to delete "'+p((s=D.value)==null?void 0:s.device_name)+'"?',1)]),e("p",null,"This will permanently delete all "+p((k=D.value)==null?void 0:k.command_count)+" command"+p(((f=D.value)==null?void 0:f.command_count)>1?"s":"")+" from Broadlink storage.",1),_[17]||(_[17]=e("p",{class:"warning-text"},"This action cannot be undone.",-1))])])]),e("div",Ss,[e("button",{onClick:_[4]||(_[4]=A=>g.value=!1),class:"btn btn-secondary",disabled:S.value}," Cancel ",8,Is),e("button",{onClick:F,class:"btn btn-danger",disabled:S.value},[e("i",{class:W(["mdi",S.value?"mdi-loading mdi-spin":"mdi-delete"])},null,2),x(" "+p(S.value?"Deleting...":"Delete"),1)],8,Ds)])])])):R("",!0)])}}},xs=$e(Ts,[["__scopeId","data-v-78e5b712"]]),Rs={class:"device-list-card"},Ms={class:"card-header"},Es={class:"header-badges"},As={class:"header-info"},Ls=["title"],Os={class:"header-right"},Ps={key:0,class:"view-toggle-group header-view-toggle"},Vs={class:"settings-menu-container"},Us=["disabled"],js=["disabled"],Fs={class:"card-body"},Ns={key:0,class:"filter-bar"},Bs={class:"filter-search-row"},Hs=["title"],qs={key:0,class:"filter-badge"},zs={class:"search-input-wrapper"},Js={class:"filter-content"},Ws={class:"filter-row filter-row-dropdowns"},Gs={class:"filter-group"},Ks=["value"],Xs={class:"filter-group"},Ys=["value"],Zs={class:"filter-group"},Qs={key:0,class:"filter-group filter-toggle"},ea={class:"toggle-label"},ta={class:"filter-results"},oa={key:1,class:"loading-state"},la={key:2,class:"error-state"},na={key:3,class:"empty-state"},sa={key:4,class:"device-grid"},aa={key:6,class:"no-results"},ia={__name:"DeviceList",setup(t){const u=kt(),r=Ge(),{isMobile:$}=ot(),w=y(!1),d=y(!1),v=y(null),g=y(!1),D=y(!1),S=y(null),O=y(null),h=y(!0),o=y(!1),P=y(!1),F=y(0),_=y(window.innerWidth<=767?"grid":localStorage.getItem("device_view_mode")||"grid");se($,L=>{L&&_.value==="list"&&(_.value="grid")}),se(_,L=>{localStorage.setItem("device_view_mode",L)});const s=()=>{h.value=!h.value,h.value||(D.value=!1)},k=()=>{h.value||(h.value=!0),D.value=!D.value},f=y(!1),A=y({title:"Error",message:"",suggestion:"",details:"",error:null,context:{}}),J=y(!1),Y=y({success:!1,title:"",message:""}),Q=y(!1),H=y({search:"",broadlinkDevice:"",area:"",entityType:"",showSmartIROnly:!1}),E=y([]),j=Me("smartirStatus"),oe=Me("smartirEnabled"),ie=G(()=>{var I;return localStorage.getItem("smartir_simulate_not_installed")==="true"?!1:((I=j==null?void 0:j.value)==null?void 0:I.installed)||!1}),ye=G(()=>{const L=new Map;return u.devices.forEach(I=>{if(I.broadlink_entity){const B=E.value.find(ne=>ne.entity_id===I.broadlink_entity),q=B&&B.name||I.broadlink_entity;L.set(I.broadlink_entity,{entity_id:I.broadlink_entity,friendly_name:q})}}),Array.from(L.values()).sort((I,B)=>I.friendly_name.localeCompare(B.friendly_name))}),Ee=G(()=>{const L=new Set;return u.devices.forEach(I=>{I.area&&L.add(I.area)}),Array.from(L).sort()}),Te=G(()=>{let L=u.devices;if(H.value.search){const B=H.value.search.toLowerCase();L=L.filter(q=>{var be,de,Se,Ue,Ne;if((be=q.name)!=null&&be.toLowerCase().includes(B)||(de=q.entity_type)!=null&&de.toLowerCase().includes(B)||(Se=q.area)!=null&&Se.toLowerCase().includes(B)||(Ue=q.id)!=null&&Ue.toLowerCase().includes(B)||Object.keys(q.commands||{}).some(je=>je.toLowerCase().includes(B)))return!0;const ke=E.value.find(je=>je.entity_id===q.broadlink_entity);return!!((Ne=ke==null?void 0:ke.name)!=null&&Ne.toLowerCase().includes(B))})}H.value.broadlinkDevice&&(L=L.filter(B=>B.broadlink_entity===H.value.broadlinkDevice||B.controller_device===H.value.broadlinkDevice)),H.value.area&&(L=L.filter(B=>B.area===H.value.area)),H.value.entityType&&(L=L.filter(B=>B.entity_type===H.value.entityType)),H.value.showSmartIROnly&&(L=L.filter(B=>B.device_type==="smartir"));const I=localStorage.getItem("smartir_simulate_not_installed")==="true";return(!(oe!=null&&oe.value)||I)&&(L=L.filter(B=>B.device_type!=="smartir")),L}),De=G(()=>H.value.search||H.value.broadlinkDevice||H.value.area||H.value.entityType||H.value.showSmartIROnly),T=G(()=>{let L=0;return H.value.search&&L++,H.value.broadlinkDevice&&L++,H.value.area&&L++,H.value.entityType&&L++,H.value.showSmartIROnly&&L++,L}),m=L=>{L.target.closest(".settings-container")||(D.value=!1)};xe(()=>{document.addEventListener("click",m)}),We(()=>{document.removeEventListener("click",m)});const V=()=>{H.value.search="",H.value.broadlinkDevice="",H.value.area="",H.value.entityType="",H.value.showSmartIROnly=!1},pe=()=>{O.value&&O.value.openDiscovery()},Oe=async()=>{try{const L=await te.get("/api/remote/devices");E.value=L.data.devices||[]}catch(L){console.error("Error loading remote devices:",L)}};se(_,L=>{localStorage.setItem("device_view_mode",L)});const fe=async()=>{var L;try{const I=await te.get("/api/devices/discover");F.value=((L=I.data.untracked_devices)==null?void 0:L.length)||0}catch(I){console.error("Error loading untracked count:",I),F.value=0}};xe(async()=>{await Promise.all([u.loadDevices(),Oe(),fe()])});const ue=L=>{v.value=L,w.value=!0},Ae=G(()=>{if(!S.value)return"";const L=Object.keys(S.value.commands||{}).length;return L===0?"This device has no commands. The device will be removed from tracking.":`This device has ${L} learned command${L>1?"s":""}. What would you like to do?`}),Pe=G(()=>{if(!S.value)return"";const L=Object.keys(S.value.commands||{}).length;return L===0?"":`Also delete all ${L} command${L>1?"s":""} from Broadlink storage`}),ee=L=>{S.value=L,g.value=!0},b=()=>{g.value=!1,S.value=null},c=async L=>{var B,q;const I=S.value;g.value=!1;try{await u.deleteDevice(I.id,L),O.value&&await O.value.refresh()}catch(ne){const ke=((q=(B=ne.response)==null?void 0:B.data)==null?void 0:q.error)||ne.message||"Unknown error";M("Failed to Delete Device",ke)}finally{S.value=null}},l=async L=>{var I,B,q,ne,ke;try{console.log("ðŸ’¾ Saving device data:",L),console.log("ðŸ’¾ Device commands:",L.commands),console.log("ðŸ’¾ Selected device:",v.value),(I=v.value)!=null&&I.id&&v.value.id!==null?await u.updateDevice(v.value.id,L):await u.createDevice(L),N(),O.value&&await O.value.refresh()}catch(be){let de="Failed to save device",Se="",Ue="";(q=(B=be.response)==null?void 0:B.data)!=null&&q.error?(de=be.response.data.error,Se=be.response.data.suggestion||""):be.message&&(de=be.message),be.response&&(Ue=`Status: ${be.response.status}
URL: ${((ne=be.config)==null?void 0:ne.url)||"N/A"}`),M("Failed to Save Device",de,Se,Ue,be,{action:"save_device",deviceData:L,isEdit:!!((ke=v.value)!=null&&ke.id)})}},N=()=>{w.value=!1,v.value=null},C=L=>{v.value=L,d.value=!0},a=()=>{d.value=!1,v.value=null},M=(L,I,B="",q="",ne=null,ke={})=>{A.value={title:L,message:I,suggestion:B,details:q,error:ne,context:ke},f.value=!0},K=()=>{f.value=!1},le=()=>{J.value=!1},re=async L=>{var I;if(console.log("ðŸŸ¢ [PARENT] Received learned event:",L),!L||!L.deviceId){console.warn("âš ï¸ [PARENT] Missing required data in learned event");return}if(console.log("ðŸŸ¢ [PARENT] Current selectedDevice commands:",Object.keys(((I=v.value)==null?void 0:I.commands)||{}).length),console.log("ðŸŸ¢ [PARENT] Current store device count:",u.devices.length),console.log("ðŸŸ¢ [PARENT] Force reloading all devices from API with cache bust..."),await u.loadDevices(!0),console.log("ðŸŸ¢ [PARENT] After reload - store device count:",u.devices.length),v.value){console.log("ðŸŸ¢ [PARENT] Looking for device:",L.deviceId);const B=u.devices.find(q=>q.id===L.deviceId);B?(console.log("ðŸŸ¢ [PARENT] Found fresh device with",Object.keys(B.commands||{}).length,"commands"),v.value={...B},console.log("ðŸŸ¢ [PARENT] âœ… Updated selectedDevice - now has",Object.keys(v.value.commands||{}).length,"commands")):console.error("ðŸŸ¢ [PARENT] âŒ Device not found in store after reload!")}O.value&&(console.log("ðŸŸ¢ [PARENT] Refreshing discovery..."),O.value.refresh()),console.log("ðŸŸ¢ [PARENT] âœ… handleCommandLearned complete!")},Z=L=>{const I=L.split("_"),B=[];for(let q=0;q<I.length;q++){const ne=I[q],ke=I[q+1];ne&&ke==="s"&&I[q+2]?(B.push(ne.charAt(0).toUpperCase()+ne.slice(1)+"'s"),q++):ne!=="s"&&B.push(ne.charAt(0).toUpperCase()+ne.slice(1))}return B.join(" ")},Re=(L,I)=>{const B=L.toLowerCase(),q=I.map(de=>de.toLowerCase());return B.includes("lamp")||B.includes("light")?"light":B.includes("fan")?"fan":B.includes("tv")||B.includes("stereo")||B.includes("speaker")||B.includes("receiver")?"media_player":B.includes("blind")||B.includes("curtain")||B.includes("shade")||B.includes("garage")?"cover":q.some(de=>de.includes("volume")||de.includes("channel")||de.includes("play")||de.includes("pause")||de.includes("mute"))?"media_player":q.some(de=>de.includes("fan_speed")||de.includes("fan_low")||de.includes("fan_high"))?"fan":q.some(de=>de.includes("open")||de.includes("close")||de.includes("stop"))?"cover":"switch"},X=(L,I)=>{const B=L.toLowerCase();return B.includes("tv")?"mdi:television":B.includes("stereo")||B.includes("receiver")||B.includes("speaker")?"mdi:speaker":B.includes("lamp")?"mdi:lamp":B.includes("light")?"mdi:lightbulb":B.includes("fan")?"mdi:fan":B.includes("blind")?"mdi:blinds":B.includes("curtain")?"mdi:curtains":B.includes("garage")?"mdi:garage":{light:"mdi:lightbulb",fan:"mdi:fan",switch:"mdi:light-switch",media_player:"mdi:speaker",cover:"mdi:window-shutter"}[I]||"mdi:devices"},we=L=>{const I=L.toLowerCase().split("_");for(let ne=0;ne<I.length-2;ne++)if(I[ne+1]==="s"){const ke=I.slice(ne,ne+3),be=Z(ke.join("_"));return console.log("Detected possessive area:",be,"from",L),be}const B=[["living","room"],["dining","room"],["master","bedroom"],["guest","bedroom"],["family","room"],["laundry","room"],["home","office"]];for(let ne=0;ne<I.length-1;ne++){const ke=[I[ne],I[ne+1]],be=B.find(de=>de[0]===ke[0]&&de[1]===ke[1]);if(be)return Z(be.join("_"))}const q=["kitchen","bedroom","bathroom","garage","office","basement","attic","hallway","entryway","patio","deck","yard","garden"];for(const ne of I)if(q.includes(ne))return ne.charAt(0).toUpperCase()+ne.slice(1);return""},ae=async L=>{var I,B;try{const q=Z(L.device_name),ne=we(L.device_name),ke=Re(L.device_name,L.commands),be=X(L.device_name,ke);let de="";try{console.log("Finding Broadlink owner for:",L.device_name);const je=await te.post("/api/devices/find-broadlink-owner",{device_name:L.device_name});console.log("Broadlink owner response:",je.data),de=je.data.broadlink_entity||"",console.log("Detected Broadlink entity:",de)}catch(je){console.error("Error finding Broadlink owner:",je)}console.log("Fetching command data from Broadlink storage...");const Ue=(await te.get(`/api/commands/broadlink/${L.device_name}`)).data.commands||{};console.log("Fetched command data:",Ue);const Ne={};for(const[je,et]of Object.entries(Ue)){const mt=typeof et=="string"&&et.length>200;Ne[je]={data:et,type:mt?"rf":"ir",name:je,learned_at:new Date().toISOString()}}console.log("Transformed commands:",Ne),v.value={id:null,device:L.device_name,name:q,entity_type:ke,commands:Ne,area:ne,icon:be,broadlink_entity:de,enabled:!0},w.value=!0,r.success(`Imported ${Object.keys(Ne).length} commands from Broadlink storage`),await fe()}catch(q){console.error("Error adopting device:",q),r.error("Failed to adopt device: "+(((B=(I=q.response)==null?void 0:I.data)==null?void 0:B.error)||q.message))}},Ce=async()=>{P.value=!0;try{await u.syncAllAreas(),r.success("Areas synced from Home Assistant")}catch(L){console.error("Error syncing areas:",L),r.error("Failed to sync areas")}finally{P.value=!1}},Ve=async()=>{var L,I;o.value=!0;try{const B=await te.post("/api/entities/generate",{});if(B.data.success){const q=B.data.broadlink_count||0,ne=B.data.smartir_count||0,ke=B.data.total_count||0,be=B.data.errors||[];let de="âœ… Entity Generation Successful",Se=[];const Ue=[];q>0&&Ue.push(`${q} Broadlink native`),ne>0&&Ue.push(`${ne} SmartIR`),Ue.length>0&&Se.push(`Generated ${Ue.join(" and ")} entity configuration${ke!==1?"s":""}.`),q>0&&(Se.push(`
ðŸ“ Broadlink entities created in:`),Se.push("  â€¢ broadlink_manager/entities.yaml"),Se.push("  â€¢ broadlink_manager/helpers.yaml")),ne>0&&(Se.push(`
ðŸ“ SmartIR entities created in:`),Se.push("  â€¢ smartir/climate.yaml"),Se.push("  â€¢ smartir/media_player.yaml"),Se.push("  â€¢ smartir/fan.yaml")),Se.push(`
ðŸ“ Next steps:`),Se.push("1. Check your configuration.yaml includes the generated files"),Se.push("2. Restart Home Assistant to load the new entities"),be.length>0&&(de="âš ï¸ Entity Generation Completed with Errors",Se.push(`
âš ï¸ ${be.length} error${be.length!==1?"s":""} occurred:`),be.forEach(Ne=>{Se.push(`  â€¢ ${Ne}`)})),Y.value={success:!0,title:de,message:Se.join(`
`)},J.value=!0}else Y.value={success:!1,title:"âŒ Entity Generation Failed",message:B.data.message||`Failed to generate entities.

Please check that you have at least one device configured.`},J.value=!0}catch(B){console.error("Error generating entities:",B);const q=((I=(L=B.response)==null?void 0:L.data)==null?void 0:I.error)||B.message||"Unknown error occurred";Y.value={success:!1,title:"âŒ Entity Generation Error",message:`Failed to generate entities:

${q}

Please check the logs for more details.`},J.value=!0}finally{o.value=!1}},qe=async({device:L,command:I})=>{var B,q;try{const ne={device_id:L.id,command:I,device:L.device||L.id,entity_id:L.broadlink_entity||L.controller_device};await te.post("/api/commands/test",ne),r.success(`Sent ${I} to ${L.name}`)}catch(ne){console.error("Error sending command:",ne);const ke=((q=(B=ne.response)==null?void 0:B.data)==null?void 0:q.error)||ne.message||"Unknown error";r.error(`Failed to send ${I}: ${ke}`)}};return(L,I)=>{var B;return n(),i("div",Rs,[e("div",Ms,[e("button",{class:"icon-button chevron-button",onClick:s},[e("i",{class:W(["mdi",h.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2)]),e("div",{class:"header-left",onClick:s},[I[15]||(I[15]=e("div",{class:"header-icon"},[e("i",{class:"mdi mdi-devices"})],-1)),e("h3",null,p(_e($)?"Devices":"Managed Devices"),1),e("div",Es,[e("span",As,p(_e(u).deviceCount)+" devices",1),F.value>0?(n(),i("span",{key:0,class:"header-info untracked-badge",title:`${F.value} device${F.value>1?"s":""} with learned commands found in Broadlink storage. Use the settings menu (âš™ï¸) to view and adopt them.`},p(F.value)+" untracked ",9,Ls)):R("",!0)])]),e("div",Os,[_e($)?R("",!0):(n(),i("div",Ps,[e("button",{onClick:I[0]||(I[0]=ce(q=>_.value="grid",["stop"])),class:W(["view-toggle-btn",{active:_.value==="grid"}]),title:"Grid View"},[...I[16]||(I[16]=[e("i",{class:"mdi mdi-view-grid"},null,-1)])],2),e("button",{onClick:I[1]||(I[1]=ce(q=>_.value="list",["stop"])),class:W(["view-toggle-btn",{active:_.value==="list"}]),title:"List View"},[...I[17]||(I[17]=[e("i",{class:"mdi mdi-view-list"},null,-1)])],2)])),e("button",{onClick:I[2]||(I[2]=ce(q=>w.value=!0,["stop"])),class:"btn btn-primary new-button"},[...I[18]||(I[18]=[e("i",{class:"mdi mdi-plus"},null,-1),e("span",null,"New",-1)])]),e("div",Vs,[e("button",{onClick:ce(k,["stop"]),class:W(["icon-button settings-button",{active:D.value}]),title:"Settings"},[...I[19]||(I[19]=[e("i",{class:"mdi mdi-cog"},null,-1)])],2),D.value?(n(),i("div",{key:0,class:"settings-dropdown",onClick:I[6]||(I[6]=ce(()=>{},["stop"]))},[e("button",{onClick:I[3]||(I[3]=q=>{pe(),D.value=!1}),class:"menu-item"},[...I[20]||(I[20]=[e("i",{class:"mdi mdi-radar"},null,-1),e("span",null,"Untracked Devices",-1)])]),e("button",{onClick:I[4]||(I[4]=q=>{Ce(),D.value=!1}),class:"menu-item",disabled:P.value},[e("i",{class:W(["mdi",P.value?"mdi-loading mdi-spin":"mdi-refresh"])},null,2),e("span",null,p(P.value?"Syncing Areas...":"Sync Areas"),1)],8,Us),e("button",{onClick:I[5]||(I[5]=q=>{Ve(),D.value=!1}),class:"menu-item",disabled:o.value},[e("i",{class:W(["mdi",o.value?"mdi-loading mdi-spin":"mdi-file-code"])},null,2),e("span",null,p(o.value?"Generating...":"Generate Entities"),1)],8,js)])):R("",!0)])])]),z(e("div",Fs,[ge(xs,{ref_key:"discoveryRef",ref:O,onAdopt:ae},null,512),_e(u).hasDevices?(n(),i("div",Ns,[e("div",Bs,[e("button",{class:W(["filter-toggle-button",{active:Q.value||De.value}]),onClick:I[7]||(I[7]=q=>Q.value=!Q.value),title:Q.value?"Hide filters":"Show filters"},[I[21]||(I[21]=e("i",{class:"mdi mdi-filter-variant"},null,-1)),De.value?(n(),i("span",qs,p(T.value),1)):R("",!0)],10,Hs),e("div",zs,[I[22]||(I[22]=e("i",{class:"mdi mdi-magnify search-icon"},null,-1)),z(e("input",{"onUpdate:modelValue":I[8]||(I[8]=q=>H.value.search=q),type:"text",placeholder:"Search devices, commands...",class:"search-input"},null,512),[[Le,H.value.search]])])]),z(e("div",Js,[e("div",Ws,[e("div",Gs,[e("label",null,[I[24]||(I[24]=e("i",{class:"mdi mdi-access-point"},null,-1)),z(e("select",{"onUpdate:modelValue":I[9]||(I[9]=q=>H.value.broadlinkDevice=q)},[I[23]||(I[23]=e("option",{value:""},"All Controller Devices",-1)),(n(!0),i(me,null,he(ye.value,q=>(n(),i("option",{key:q.entity_id,value:q.entity_id},p(q.friendly_name),9,Ks))),128))],512),[[Ie,H.value.broadlinkDevice]])])]),e("div",Xs,[e("label",null,[I[26]||(I[26]=e("i",{class:"mdi mdi-home-map-marker"},null,-1)),z(e("select",{"onUpdate:modelValue":I[10]||(I[10]=q=>H.value.area=q)},[I[25]||(I[25]=e("option",{value:""},"All Areas",-1)),(n(!0),i(me,null,he(Ee.value,q=>(n(),i("option",{key:q,value:q},p(q),9,Ys))),128))],512),[[Ie,H.value.area]])])]),e("div",Zs,[e("label",null,[I[28]||(I[28]=e("i",{class:"mdi mdi-shape"},null,-1)),z(e("select",{"onUpdate:modelValue":I[11]||(I[11]=q=>H.value.entityType=q)},[...I[27]||(I[27]=[He('<option value="" data-v-f2f60df3>All Types</option><option value="light" data-v-f2f60df3>Light</option><option value="fan" data-v-f2f60df3>Fan</option><option value="switch" data-v-f2f60df3>Switch</option><option value="media_player" data-v-f2f60df3>Media Player</option><option value="cover" data-v-f2f60df3>Cover</option><option value="climate" data-v-f2f60df3>Climate</option>',7)])],512),[[Ie,H.value.entityType]])])]),ie.value?(n(),i("div",Qs,[e("label",ea,[I[29]||(I[29]=e("span",{class:"toggle-text"},[e("img",{src:Qe,alt:"SmartIR",class:"smartir-icon"}),x(" SmartIR Only ")],-1)),z(e("input",{type:"checkbox","onUpdate:modelValue":I[12]||(I[12]=q=>H.value.showSmartIROnly=q),class:"toggle-checkbox"},null,512),[[ve,H.value.showSmartIROnly]]),I[30]||(I[30]=e("span",{class:"toggle-slider"},null,-1))])])):R("",!0),De.value?(n(),i("button",{key:1,onClick:V,class:"btn-clear-filters"},[...I[31]||(I[31]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),x(" Clear ",-1)])])):R("",!0),e("div",ta,p(Te.value.length)+" of "+p(_e(u).deviceCount),1)])],512),[[Ye,Q.value]])])):R("",!0),_e(u).loading?(n(),i("div",oa,[...I[32]||(I[32]=[e("i",{class:"mdi mdi-loading mdi-spin"},null,-1),e("p",null,"Loading devices...",-1)])])):_e(u).error?(n(),i("div",la,[I[33]||(I[33]=e("i",{class:"mdi mdi-alert-circle"},null,-1)),e("p",null,p(_e(u).error),1),e("button",{onClick:I[13]||(I[13]=q=>_e(u).loadDevices()),class:"btn btn-secondary"}," Retry ")])):_e(u).hasDevices?R("",!0):(n(),i("div",na,[I[35]||(I[35]=e("i",{class:"mdi mdi-devices"},null,-1)),I[36]||(I[36]=e("h3",null,"No Devices Yet",-1)),I[37]||(I[37]=e("p",null,"Get started by adding your first managed device",-1)),e("button",{onClick:I[14]||(I[14]=q=>w.value=!0),class:"btn btn-primary"},[...I[34]||(I[34]=[e("i",{class:"mdi mdi-plus"},null,-1),x(" Add Your First Device ",-1)])])])),_.value==="grid"?(n(),i("div",sa,[(n(!0),i(me,null,he(Te.value,q=>(n(),Fe(Bt,{key:q.id,device:q,"broadlink-devices":E.value,onEdit:ue,onDelete:ee,onLearn:C},null,8,["device","broadlink-devices"]))),128))])):_.value==="list"&&Te.value.length>0?(n(),Fe(uo,{key:5,devices:Te.value,onSendCommand:qe,onOpenCommands:C,onEditDevice:ue,onDeleteDevice:ee},null,8,["devices"])):R("",!0),_e(u).hasDevices&&Te.value.length===0?(n(),i("div",aa,[...I[38]||(I[38]=[e("i",{class:"mdi mdi-filter-off"},null,-1),e("h3",null,"No devices match your filters",-1),e("p",null,"Try adjusting your search or filter criteria",-1)])])):R("",!0)],512),[[Ye,h.value]]),w.value?(n(),Fe(Ul,{key:0,device:v.value,onSave:l,onCancel:N},null,8,["device"])):R("",!0),d.value?(n(),Fe(Yn,{key:1,device:v.value,onLearned:re,onCancel:a},null,8,["device"])):R("",!0),ge(Be,{isOpen:g.value,title:`Delete ${(B=S.value)==null?void 0:B.name}?`,message:Ae.value,confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,checkboxLabel:Pe.value,onConfirm:c,onCancel:b},null,8,["isOpen","title","message","checkboxLabel"]),ge(ds,{isOpen:f.value,title:A.value.title,message:A.value.message,suggestion:A.value.suggestion,details:A.value.details,error:A.value.error,context:A.value.context,onClose:K},null,8,["isOpen","title","message","suggestion","details","error","context"]),ge(Be,{isOpen:J.value,title:Y.value.title,message:Y.value.message,confirmText:"OK",showCancel:!1,dangerMode:!Y.value.success,onConfirm:le,onCancel:le},null,8,["isOpen","title","message","dangerMode"])])}}},ra=$e(ia,[["__scopeId","data-v-f2f60df3"]]),da={class:"banner-content"},ua={class:"banner-icon"},ca={class:"banner-message"},ma={class:"banner-actions"},va={__name:"SmartIRBanner",setup(t){const u=Me("smartirStatus"),r=y(!1),$=G(()=>!(!u.value||r.value||localStorage.getItem("smartir_banner_dismissed")==="true")),w=G(()=>{var O;return(O=u.value)!=null&&O.installed?"banner-success":"banner-info"}),d=G(()=>{var O;return(O=u.value)!=null&&O.installed?"mdi mdi-check-circle":"mdi mdi-information"}),v=G(()=>{var O;return(O=u.value)!=null&&O.installed?`SmartIR Detected (v${u.value.version})`:"Want Climate Device Support?"}),g=G(()=>{var O;return(O=u.value)!=null&&O.installed?"You can now create climate device profiles with full temperature and HVAC mode control.":"Install SmartIR to unlock AC/heater control with temperature settings, HVAC modes, and 120+ pre-configured device profiles."});function D(){window.open("https://github.com/smartHomeHub/SmartIR","_blank")}function S(){var O;if(r.value=!0,(O=u.value)!=null&&O.installed)localStorage.setItem("smartir_banner_dismissed","true");else{const h=parseInt(localStorage.getItem("smartir_banner_dismiss_count")||"0");h>=2?localStorage.setItem("smartir_banner_dismissed","true"):localStorage.setItem("smartir_banner_dismiss_count",String(h+1))}}return xe(()=>{var o;const O=localStorage.getItem("smartir_last_status"),h=(o=u.value)!=null&&o.installed?"installed":"not_installed";O!==h&&(localStorage.removeItem("smartir_banner_dismissed"),localStorage.removeItem("smartir_banner_dismiss_count"),localStorage.setItem("smartir_last_status",h))}),(O,h)=>{var o,P;return $.value?(n(),i("div",{key:0,class:W(["smartir-banner",w.value])},[e("div",da,[e("div",ua,[e("i",{class:W(d.value)},null,2)]),e("div",ca,[e("strong",null,p(v.value),1),e("p",null,p(g.value),1)]),e("div",ma,[(o=O.status)!=null&&o.installed?R("",!0):(n(),i("button",{key:0,onClick:D,class:"btn-primary"}," Learn More ")),e("button",{onClick:S,class:"btn-text"},p((P=O.status)!=null&&P.installed?"Got it":"Dismiss"),1)])])],2)):R("",!0)}}},pa=$e(va,[["__scopeId","data-v-7bbcbcd7"]]),Je="api/smartir",ut={async getStatus(){try{const t=await fetch(`${Je}/status`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return await t.json()}catch(t){return console.error("Error fetching SmartIR status:",t),{installed:!1,version:null,error:t.message}}},async getInstallInstructions(){try{const t=await fetch(`${Je}/install-instructions`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return await t.json()}catch(t){throw console.error("Error fetching install instructions:",t),t}},async getPlatforms(){try{const t=await fetch(`${Je}/platforms`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return await t.json()}catch(t){throw console.error("Error fetching platforms:",t),t}},async getPlatformCodes(t){try{const u=await fetch(`${Je}/platforms/${t}/codes`);if(!u.ok)throw new Error(`HTTP error! status: ${u.status}`);return await u.json()}catch(u){throw console.error(`Error fetching codes for ${t}:`,u),u}},async getNextCode(t){try{const u=await fetch(`${Je}/platforms/${t}/next-code`);if(!u.ok)throw new Error(`HTTP error! status: ${u.status}`);return await u.json()}catch(u){throw console.error(`Error fetching next code for ${t}:`,u),u}},async validateCode(t,u){try{const r=await fetch(`${Je}/validate-code`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({platform:t,code:u})});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);return await r.json()}catch(r){throw console.error("Error validating code:",r),r}}},fa={class:"profile-card"},ga={class:"profile-card-header"},ya=["title"],ba={class:"profile-details"},ha=["title"],ka={class:"profile-meta"},wa=["title"],$a=["title"],Ca=["title"],_a={class:"profile-card-footer"},Sa=["title"],Ia={key:0,class:"learned-indicator"},Da={class:"profile-actions"},Ta={__name:"SmartIRProfileCard",props:{profile:{type:Object,required:!0}},emits:["edit","download","delete","commands"],setup(t){const u=t,r=rt(G(()=>u.profile.platform)),$=v=>v.replace(/_/g," ").replace(/\b\w/g,g=>g.toUpperCase()),w=v=>v&&v.startsWith("mdi:")?`mdi ${v.replace(":"," mdi-")}`:`mdi mdi-${v}`,d=v=>{if(!v)return"";const g=v.toLowerCase();return g.includes("broadlink")?"broadlink-tag":g.includes("not set")?"not-set-tag":"default-controller-tag"};return(v,g)=>(n(),i("div",fa,[e("div",ga,[e("div",{class:W(["profile-icon",_e(r).colorClass.value]),title:$(t.profile.platform)},[e("i",{class:W(w(_e(r).icon.value))},null,2)],10,ya),e("div",ba,[e("h4",{title:`${t.profile.manufacturer} ${t.profile.model}`},p(t.profile.manufacturer)+" "+p(t.profile.model),9,ha),e("div",ka,[e("span",{class:"tag platform-tag",title:$(t.profile.platform)},p($(t.profile.platform)),9,wa),t.profile.controllerBrand?(n(),i("span",{key:0,class:W(["tag controller-tag",d(t.profile.controllerBrand)]),title:"Controller: "+t.profile.controllerBrand},[g[4]||(g[4]=e("i",{class:"mdi mdi-remote-tv"},null,-1)),x(" "+p(t.profile.controllerBrand),1)],10,$a)):R("",!0)])]),e("div",{class:"code-badge",title:"Device Code: "+t.profile.code},p(t.profile.code),9,Ca)]),e("div",_a,[e("div",{class:"profile-stats",title:t.profile.commandCount+" total commands"+(t.profile.learnedCount>0?", "+t.profile.learnedCount+" learned":"")},[g[5]||(g[5]=e("i",{class:"mdi mdi-remote"},null,-1)),e("span",null,p(t.profile.commandCount)+" command"+p(t.profile.commandCount!==1?"s":""),1),t.profile.learnedCount>0?(n(),i("span",Ia,"( "+p(t.profile.learnedCount)+" learned )",1)):R("",!0)],8,Sa),e("div",Da,[e("button",{onClick:g[0]||(g[0]=D=>v.$emit("commands")),class:"action-btn",title:"Commands"},[...g[6]||(g[6]=[e("i",{class:"mdi mdi-remote"},null,-1)])]),e("button",{onClick:g[1]||(g[1]=D=>v.$emit("edit")),class:"action-btn",title:"Edit Profile"},[...g[7]||(g[7]=[e("i",{class:"mdi mdi-pencil"},null,-1)])]),e("button",{onClick:g[2]||(g[2]=D=>v.$emit("download")),class:"action-btn",title:"Download JSON"},[...g[8]||(g[8]=[e("i",{class:"mdi mdi-download"},null,-1)])]),e("button",{onClick:g[3]||(g[3]=D=>v.$emit("delete")),class:"action-btn delete",title:"Delete Profile"},[...g[9]||(g[9]=[e("i",{class:"mdi mdi-delete"},null,-1)])])])])]))}},xa=$e(Ta,[["__scopeId","data-v-aad9720f"]]),Ra={name:"SmartIRProfileListView",props:{profiles:{type:Array,required:!0}},methods:{getPlatformIcon(t){return{climate:"mdi-thermostat",media_player:"mdi-television",fan:"mdi-fan",light:"mdi-lightbulb"}[t]||"mdi-devices"},formatPlatform(t){return{climate:"Climate",media_player:"Media Player",fan:"Fan",light:"Light"}[t]||t},editProfile(t){this.$emit("edit",t)},viewCommands(t){this.$emit("commands",t)},downloadProfile(t){this.$emit("download",t)},deleteProfile(t){this.$emit("delete",t)}}},Ma={class:"profile-list-view"},Ea={class:"profile-table"},Aa={class:"profile-code"},La={class:"code-badge"},Oa={class:"profile-manufacturer"},Pa={class:"profile-model"},Va={class:"model-info"},Ua={class:"model-name"},ja={key:0,class:"model-count"},Fa={class:"profile-platform"},Na={class:"profile-controller"},Ba={class:"profile-commands"},Ha={class:"command-stats"},qa={class:"stat-item"},za={key:0,class:"stat-item learned"},Ja={class:"profile-actions"},Wa=["onClick"],Ga=["onClick"],Ka=["onClick"],Xa=["onClick"];function Ya(t,u,r,$,w,d){return n(),i("div",Ma,[e("table",Ea,[u[6]||(u[6]=e("thead",null,[e("tr",null,[e("th",null,"Code"),e("th",null,"Manufacturer"),e("th",null,"Model"),e("th",null,"Platform"),e("th",null,"Controller"),e("th",null,"Commands"),e("th",null,"Actions")])],-1)),e("tbody",null,[(n(!0),i(me,null,he(r.profiles,v=>(n(),i("tr",{key:`${v.platform}-${v.code}`,class:"profile-row"},[e("td",Aa,[e("span",La,p(v.code),1)]),e("td",Oa,p(v.manufacturer||"Unknown"),1),e("td",Pa,[e("div",Va,[e("div",Ua,p(v.model||"Unknown"),1),v.models&&v.models.length>1?(n(),i("div",ja," +"+p(v.models.length-1)+" more ",1)):R("",!0)])]),e("td",Fa,[e("span",{class:W(["platform-badge",v.platform])},[e("i",{class:W(["mdi",d.getPlatformIcon(v.platform)])},null,2),x(" "+p(d.formatPlatform(v.platform)),1)],2)]),e("td",Na,p(v.controller_brand||"N/A"),1),e("td",Ba,[e("div",Ha,[e("span",qa,[u[0]||(u[0]=e("i",{class:"mdi mdi-remote"},null,-1)),x(" "+p(v.command_count||0),1)]),v.learned_count>0?(n(),i("span",za,[u[1]||(u[1]=e("i",{class:"mdi mdi-school"},null,-1)),x(" "+p(v.learned_count),1)])):R("",!0)])]),e("td",Ja,[e("button",{class:"action-btn edit",onClick:g=>d.editProfile(v),title:"Edit Profile"},[...u[2]||(u[2]=[e("i",{class:"mdi mdi-pencil"},null,-1)])],8,Wa),e("button",{class:"action-btn commands",onClick:g=>d.viewCommands(v),title:"View Commands"},[...u[3]||(u[3]=[e("i",{class:"mdi mdi-remote"},null,-1)])],8,Ga),e("button",{class:"action-btn download",onClick:g=>d.downloadProfile(v),title:"Download"},[...u[4]||(u[4]=[e("i",{class:"mdi mdi-download"},null,-1)])],8,Ka),e("button",{class:"action-btn delete",onClick:g=>d.deleteProfile(v),title:"Delete"},[...u[5]||(u[5]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,Xa)])]))),128))])])])}const Za=$e(Ra,[["render",Ya],["__scopeId","data-v-d3773038"]]),Qa={class:"modal-container"},ei={class:"modal-body"},ti={key:0,class:"selection-section"},oi={class:"form-group"},li={class:"form-group"},ni={class:"form-group"},si={key:0,class:"code-info"},ai={class:"form-actions"},ii=["disabled"],ri={key:1,class:"testing-section"},di={class:"code-header"},ui={class:"code-details"},ci={class:"code-badge"},mi={class:"device-selector"},vi=["value"],pi={key:0,class:"helper-text"},fi={class:"commands-section"},gi={class:"commands-header"},yi={key:0,class:"tested-count"},bi={key:0,class:"filters-section"},hi={class:"filter-row"},ki={class:"filter-row"},wi={key:1,class:"empty-state"},$i={key:2,class:"empty-state"},Ci={key:3,class:"commands-list"},_i={class:"command-name"},Si={class:"command-actions"},Ii={key:0,class:"status-badge success"},Di=["onClick","disabled","title"],Ti={__name:"SmartIRCodeTester",props:{isOpen:{type:Boolean,default:!1}},emits:["close","clone"],setup(t,{emit:u}){const r=t,$=u,w=Me("toast"),d=y("climate"),v=y(""),g=y([]),D=y(!1),S=y(null),O=y(""),h=y([]),o=y(!1),P=G(()=>h.value.map(ee=>({code:ee.code,label:`${ee.models.join(", ")} (Code: ${ee.code})`,value:ee.code}))),F=y(null),U=y(null),_=y(!1),s=y([]),k=y(""),f=y([]),A=y(new Set),J=y(null),Y=y(""),Q=y(""),H=y(""),E=y(""),j=G(()=>{let ee=f.value;if(Y.value){const b=Y.value.toLowerCase();ee=ee.filter(c=>(c.label||c.name).toLowerCase().includes(b))}return Q.value&&(ee=ee.filter(b=>b.mode===Q.value)),H.value&&(ee=ee.filter(b=>b.fanSpeed===H.value)),E.value&&(ee=ee.filter(b=>b.swingMode===E.value)),ee}),oe=G(()=>Y.value||Q.value||H.value||E.value);se(()=>r.isOpen,ee=>{ee&&(ie(),Ee())}),se(d,()=>{r.isOpen&&(v.value="",S.value=null,h.value=[],ie())});async function ie(){var ee;D.value=!0;try{const b=await te.get("/api/smartir/codes/manufacturers",{params:{entity_type:d.value}});g.value=b.data.manufacturers||[]}catch(b){console.error("Error loading manufacturers:",b),(ee=w.value)==null||ee.error("Failed to load manufacturers","âŒ Error")}finally{D.value=!1}}async function ye(){var ee;if(v.value){o.value=!0;try{const b=await te.get("/api/smartir/codes/models",{params:{entity_type:d.value,manufacturer:v.value}});h.value=b.data.models||[]}catch(b){console.error("Error loading models:",b),(ee=w.value)==null||ee.error("Failed to load models","âŒ Error")}finally{o.value=!1}}}async function Ee(){try{const ee=await te.get("/api/remote/devices");s.value=ee.data.devices||[]}catch(ee){console.error("Error loading Broadlink devices:",ee)}}async function Te(){var ee,b;if(S.value){_.value=!0;try{const c=await te.get("/api/smartir/codes/code",{params:{entity_type:d.value,code_id:S.value.code}});U.value=c.data.code,F.value=S.value.code,De(c.data.code),(ee=w.value)==null||ee.success(`Loaded ${f.value.length} commands`,"âœ… Code Loaded")}catch(c){console.error("Error loading code:",c),(b=w.value)==null||b.error(c.message||"Failed to load code","âŒ Error")}finally{_.value=!1}}}function De(ee){const b=[];if(!ee.commands){f.value=b;return}if(d.value==="climate"){const l=ee.commands;for(const[N,C]of Object.entries(l)){if(N==="off"){typeof C=="string"&&b.push({name:"off",label:"OFF",data:C,mode:"off"});continue}if(typeof C=="object"){for(const[a,M]of Object.entries(C))if(typeof M=="object")for(const[K,le]of Object.entries(M)){if(typeof le!="object")continue;const re=Object.keys(le),Z=re.includes("24")?"24":re[0];if(Z&&typeof le[Z]=="string"){const Re=`${N}_${Z}_${a}_${K}`,X=`${N.toUpperCase()} ${Z}Â°C ${a} ${K}`;b.push({name:Re,label:X,data:le[Z],mode:N,temperature:Z,fanSpeed:a,swingMode:K})}}}}}else for(const[l,N]of Object.entries(ee.commands))typeof N=="string"&&b.push({name:l,label:l.toUpperCase().replace(/_/g," "),data:N});f.value=b}async function T(ee){var b,c,l;if(!k.value){(b=w.value)==null||b.warning("Please select a Broadlink device first","âš ï¸ No Device");return}J.value=ee;try{const N=f.value.find(C=>C.name===ee);if(!N||!N.data)throw new Error(`Command "${ee}" not found`);await te.post("/api/commands/send-raw",{entity_id:k.value,command:N.data,command_type:"ir"}),A.value.add(ee),(c=w.value)==null||c.success(`Command sent: ${N.label||ee}`,"âœ… Tested")}catch(N){console.error("Error testing command:",N),(l=w.value)==null||l.error("Failed to test command","âŒ Error")}finally{J.value=null}}function m(){var ee,b,c,l;if(!U.value){(ee=w.value)==null||ee.error("No profile data to download","âŒ Error");return}try{const N=U.value.manufacturer||"unknown",C=((b=U.value.supportedModels)==null?void 0:b[0])||F.value,a=`${N.toLowerCase().replace(/\s+/g,"_")}_${C.toLowerCase().replace(/\s+/g,"_")}.json`,M=JSON.stringify(U.value,null,2),K=new Blob([M],{type:"application/json"}),le=URL.createObjectURL(K),re=document.createElement("a");re.href=le,re.download=a,document.body.appendChild(re),re.click(),document.body.removeChild(re),URL.revokeObjectURL(le),(c=w.value)==null||c.success(`Downloaded ${a}`,"âœ… Download Complete")}catch(N){console.error("Error downloading JSON:",N),(l=w.value)==null||l.error(N.message||"Failed to download JSON","âŒ Download Error")}}function V(){v.value="",S.value=null,O.value="",h.value=[]}function pe(){S.value=null,O.value="",ye()}function Oe(){O.value?S.value=h.value.find(ee=>ee.code===O.value):S.value=null}function fe(){Y.value="",Q.value="",H.value="",E.value=""}function ue(){F.value=null,U.value=null,f.value=[],A.value.clear(),J.value=null,fe()}function Ae(ee){const b=ee.toLowerCase();return b.includes("power")||b.includes("off")||b==="off"?"mdi-power":b.includes("cool")?"mdi-snowflake":b.includes("heat")?"mdi-fire":b.includes("fan")?"mdi-fan":b.includes("auto")?"mdi-auto-fix":b.includes("dry")?"mdi-water-percent":b.includes("temp")?"mdi-thermometer":b.includes("swing")?"mdi-swap-vertical":"mdi-remote"}function Pe(){ue(),v.value="",S.value=null,$("close")}return(ee,b)=>{var c;return t.isOpen?(n(),i("div",{key:0,class:"modal-overlay",onClick:ce(Pe,["self"])},[e("div",Qa,[e("div",{class:"modal-header"},[b[9]||(b[9]=e("h3",null,[e("i",{class:"mdi mdi-test-tube"}),x(" Test SmartIR Code ")],-1)),e("button",{onClick:Pe,class:"close-btn"},[...b[8]||(b[8]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",ei,[F.value?(n(),i("div",ri,[e("div",di,[e("div",ui,[e("h4",null,p(U.value.manufacturer)+" - "+p(((c=U.value.supportedModels)==null?void 0:c[0])||"Unknown"),1),e("span",ci,"Code: "+p(F.value),1)]),e("button",{onClick:ue,class:"btn-secondary-small"},[...b[14]||(b[14]=[e("i",{class:"mdi mdi-arrow-left"},null,-1),x(" Change Code ",-1)])])]),e("div",mi,[b[17]||(b[17]=e("label",null,[e("i",{class:"mdi mdi-remote"}),x(" Broadlink Device ")],-1)),z(e("select",{"onUpdate:modelValue":b[3]||(b[3]=l=>k.value=l),class:"form-select"},[b[15]||(b[15]=e("option",{value:""},"Select device to test with...",-1)),(n(!0),i(me,null,he(s.value,l=>(n(),i("option",{key:l.entity_id,value:l.entity_id},p(l.friendly_name||l.entity_id),9,vi))),128))],512),[[Ie,k.value]]),k.value?R("",!0):(n(),i("p",pi,[...b[16]||(b[16]=[e("i",{class:"mdi mdi-information-outline"},null,-1),x(" Select a Broadlink device to enable command testing ",-1)])]))]),e("div",fi,[e("div",gi,[e("h5",null,"Sample Commands ("+p(j.value.length)+" / "+p(f.value.length)+")",1),A.value.size>0?(n(),i("span",yi,p(A.value.size)+" tested ",1)):R("",!0)]),d.value==="climate"&&f.value.length>0?(n(),i("div",bi,[e("div",hi,[z(e("input",{"onUpdate:modelValue":b[4]||(b[4]=l=>Y.value=l),type:"text",placeholder:"Search commands...",class:"search-input"},null,512),[[Le,Y.value]])]),e("div",ki,[z(e("select",{"onUpdate:modelValue":b[5]||(b[5]=l=>Q.value=l),class:"filter-select"},[...b[18]||(b[18]=[e("option",{value:""},"All Modes",-1),e("option",{value:"cool"},"Cool",-1),e("option",{value:"heat"},"Heat",-1),e("option",{value:"off"},"Off",-1)])],512),[[Ie,Q.value]]),z(e("select",{"onUpdate:modelValue":b[6]||(b[6]=l=>H.value=l),class:"filter-select"},[...b[19]||(b[19]=[He('<option value="" data-v-66569200>All Fan Speeds</option><option value="low" data-v-66569200>Low</option><option value="mid" data-v-66569200>Mid</option><option value="high" data-v-66569200>High</option><option value="auto" data-v-66569200>Auto</option>',5)])],512),[[Ie,H.value]]),z(e("select",{"onUpdate:modelValue":b[7]||(b[7]=l=>E.value=l),class:"filter-select"},[...b[20]||(b[20]=[e("option",{value:""},"All Swing",-1),e("option",{value:"stop"},"Stop",-1),e("option",{value:"swing"},"Swing",-1)])],512),[[Ie,E.value]]),oe.value?(n(),i("button",{key:0,onClick:fe,class:"btn-clear-filters"},[...b[21]||(b[21]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),x(" Clear ",-1)])])):R("",!0)])])):R("",!0),f.value.length===0?(n(),i("div",wi,[...b[22]||(b[22]=[e("i",{class:"mdi mdi-alert-circle"},null,-1),e("p",null,"No commands found in this code",-1)])])):j.value.length===0?(n(),i("div",$i,[b[23]||(b[23]=e("i",{class:"mdi mdi-filter-off"},null,-1)),b[24]||(b[24]=e("p",null,"No commands match your filters",-1)),e("button",{onClick:fe,class:"btn-secondary-small"}," Clear Filters ")])):(n(),i("div",Ci,[(n(!0),i(me,null,he(j.value,l=>(n(),i("div",{key:l.name,class:W(["command-item",{tested:A.value.has(l.name),testing:J.value===l.name}])},[e("div",_i,[e("i",{class:W(["mdi",Ae(l.mode||l.name)])},null,2),e("span",null,p(l.label||l.name),1)]),e("div",Si,[A.value.has(l.name)?(n(),i("span",Ii,[...b[25]||(b[25]=[e("i",{class:"mdi mdi-check"},null,-1),x(" Tested ",-1)])])):R("",!0),e("button",{onClick:N=>T(l.name),disabled:!k.value||J.value===l.name,title:k.value?"Test this command":"Select a Broadlink device first",class:"btn-test"},[e("i",{class:W(["mdi",J.value===l.name?"mdi-loading mdi-spin":"mdi-play"])},null,2),b[26]||(b[26]=x(" Test ",-1))],8,Di)])],2))),128))]))]),e("div",{class:"modal-actions"},[e("button",{onClick:m,class:"btn-primary"},[...b[27]||(b[27]=[e("i",{class:"mdi mdi-download"},null,-1),x(" Download JSON ",-1)])]),e("button",{onClick:Pe,class:"btn-secondary"}," Close ")])])):(n(),i("div",ti,[b[13]||(b[13]=e("div",{class:"info-banner"},[e("i",{class:"mdi mdi-information"}),e("p",null,"Select a SmartIR code from the index to test commands with your Broadlink device.")],-1)),e("div",oi,[b[11]||(b[11]=e("label",null,[e("i",{class:"mdi mdi-shape"}),x(" Platform ")],-1)),z(e("select",{"onUpdate:modelValue":b[0]||(b[0]=l=>d.value=l),onChange:V,class:"form-select"},[...b[10]||(b[10]=[e("option",{value:"climate"},"Climate (AC/Heater)",-1),e("option",{value:"media_player"},"Media Player (TV/Audio)",-1),e("option",{value:"fan"},"Fan",-1),e("option",{value:"light"},"Light",-1)])],544),[[Ie,d.value]])]),e("div",li,[ge(Ze,{modelValue:v.value,"onUpdate:modelValue":b[1]||(b[1]=l=>v.value=l),options:g.value,label:"Manufacturer",placeholder:"Search manufacturers...",loading:D.value,disabled:D.value,onChange:pe},null,8,["modelValue","options","loading","disabled"])]),e("div",ni,[ge(Ze,{modelValue:O.value,"onUpdate:modelValue":b[2]||(b[2]=l=>O.value=l),options:P.value,"option-label":"label","option-value":"code",label:"Model",placeholder:"Search models...",loading:o.value,disabled:!v.value||o.value,onChange:Oe},null,8,["modelValue","options","loading","disabled"])]),S.value?(n(),i("div",si,[b[12]||(b[12]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[e("strong",null,p(v.value)+" - "+p(S.value.models[0]),1),e("p",null,"Code: "+p(S.value.code),1)])])):R("",!0),e("div",ai,[e("button",{onClick:Te,disabled:!S.value||_.value,class:"btn-primary"},[e("i",{class:W(["mdi",_.value?"mdi-loading mdi-spin":"mdi-download"])},null,2),x(" "+p(_.value?"Loading...":"Load Commands"),1)],8,ii)])]))])])])):R("",!0)}}},xi=$e(Ti,[["__scopeId","data-v-66569200"]]),Ri={class:"smartir-status-card"},Mi={class:"card-header"},Ei=["src"],Ai={class:"header-badges"},Li=["title"],Oi={class:"header-info"},Pi={class:"header-info"},Vi={class:"header-info"},Ui={class:"header-right"},ji={key:0,class:"view-toggle-group header-view-toggle"},Fi={key:2,class:"settings-menu-container"},Ni={key:0,class:"card-body loading-state"},Bi={key:1,class:"card-body error-state"},Hi={key:2,class:"card-body installed-state"},qi={key:0,class:"help-panel"},zi={key:0,class:"recommendation"},Ji={key:0,class:"next-steps"},Wi={class:"help-actions"},Gi={key:1,class:"filter-bar"},Ki={class:"filter-search-row"},Xi=["title"],Yi={key:0,class:"filter-badge"},Zi={class:"search-input-wrapper"},Qi={class:"filter-content"},er={class:"filter-row"},tr={class:"filter-group"},or={class:"filter-results"},lr={key:2,class:"loading-state"},nr={key:3,class:"empty-state"},sr={key:4,class:"profiles-grid"},ar={key:6,class:"no-results"},ir={key:3,class:"card-body not-installed-state"},rr={class:"benefits-section"},dr={class:"benefits-list"},ur={class:"recommendation"},cr={__name:"SmartIRStatusCard",emits:["create-profile","edit-profile"],setup(t,{expose:u,emit:r}){const $=r,w=Me("smartirStatus");Me("smartirEnabled");const d=Me("refreshSmartIR"),{isMobile:v}=ot(),g=y(!1),D=y(null),S=y((w==null?void 0:w.value)||null),O=y(localStorage.getItem("smartir_simulate_not_installed")==="true"),h=y(!1),o=y(!1),P=y(!0),F=y([]),U=y(!1),_=y(!1),s=y({search:"",platform:""}),k=y({show:!1,title:"",message:"",platform:null,profile:null}),f=y(!1),J=y(window.innerWidth<=767?"grid":localStorage.getItem("profile_view_mode")||"grid");se(v,c=>{c&&J.value==="list"&&(J.value="grid")}),se(J,c=>{localStorage.setItem("profile_view_mode",c)}),se(P,c=>{c||(o.value=!1)});const Y=["Full climate entity support (AC, heaters)","120+ pre-configured device profiles","Temperature and humidity sensor integration","HVAC mode control (heat, cool, auto, dry, fan)"],Q=["climate","media_player","fan","light"],H=G(()=>O.value?{installed:!1,recommendation:{message:"Install SmartIR to unlock climate device support!",benefits:["Full climate entity support (AC, heaters)","120+ pre-configured device profiles","Temperature and humidity sensor integration","HVAC mode control (heat, cool, auto, dry, fan)"]}}:S.value),E=G(()=>{var c,l;return((l=(c=H.value)==null?void 0:c.platforms)==null?void 0:l.length)||0}),j=G(()=>{var c;return(c=H.value)!=null&&c.device_counts?Object.values(H.value.device_counts).reduce((l,N)=>l+N,0):0});function oe(){var c;O.value=!O.value,localStorage.setItem("smartir_simulate_not_installed",O.value.toString()),!O.value&&((c=S.value)!=null&&c.installed)&&fe()}const ie=G(()=>{let c=F.value;if(s.value.search){const l=s.value.search.toLowerCase();c=c.filter(N=>{var C,a,M,K;return((C=N.manufacturer)==null?void 0:C.toLowerCase().includes(l))||((a=N.model)==null?void 0:a.toLowerCase().includes(l))||((M=N.code)==null?void 0:M.toString().includes(l))||((K=N.platform)==null?void 0:K.toLowerCase().includes(l))})}return s.value.platform&&(c=c.filter(l=>l.platform===s.value.platform)),c}),ye=G(()=>s.value.search||s.value.platform),Ee=G(()=>{let c=0;return s.value.search&&c++,s.value.platform&&c++,c});function Te(){s.value.search="",s.value.platform=""}async function De(){g.value=!0,D.value=null;try{if(d)await d();else{const c=await ut.getStatus();S.value=c}}catch(c){D.value=c.message||"Failed to refresh SmartIR status",console.error("Error refreshing SmartIR status:",c)}finally{g.value=!1}}function T(){$("create-profile")}function m(){h.value=!h.value,o.value=!1}function V(){P.value||(P.value=!0),o.value=!o.value}function pe(){f.value=!0,o.value=!1}function Oe(){window.open("https://github.com/smartHomeHub/SmartIR","_blank")}async function fe(){U.value=!0;const c=[];try{for(const l of Q)try{const C=((await te.get(`/api/smartir/platforms/${l}/profiles`)).data.profiles||[]).map(a=>({...a,platform:l}));c.push(...C)}catch(N){console.warn(`Network error loading ${l} profiles (using bundled index):`,N.message)}F.value=c}catch(l){console.error("Unexpected error loading profiles:",l)}finally{U.value=!1}}function ue(c,l,N){$("edit-profile",{platform:c,profile:l,startStep:N})}async function Ae(c,l){var N,C;try{const M=(await te.get(`/api/smartir/platforms/${c}/profiles/${l.code}`)).data,K=JSON.stringify(M.profile,null,2),le=new Blob([K],{type:"application/json"}),re=URL.createObjectURL(le),Z=document.createElement("a");Z.href=re,Z.download=`smartir_${c}_${l.manufacturer}_${l.model}_${l.code}.json`,document.body.appendChild(Z),Z.click(),document.body.removeChild(Z),URL.revokeObjectURL(re),(N=Me("toast").value)==null||N.success(`Downloaded ${l.manufacturer} ${l.model}`,"âœ… Profile Downloaded")}catch(a){console.error("Error downloading profile:",a),(C=Me("toast").value)==null||C.error("Failed to download profile","âŒ Download Error")}}const Pe=c=>{c.target.closest(".settings-container")||(o.value=!1)};xe(()=>{document.addEventListener("click",Pe)}),We(()=>{document.removeEventListener("click",Pe)});async function ee(c,l){Me("toast");try{const C=(await te.post(`/api/smartir/profiles/${l.code}/check-usage`,{platform:c})).data;if(C&&C.in_use){k.value={show:!0,title:`Cannot Delete ${l.manufacturer} ${l.model}`,message:`This profile is currently in use by ${C.device_count} device(s):

${C.devices.join(`
`)}

Please remove or reassign these devices before deleting the profile.`,platform:c,profile:l,canDelete:!1,devices:C.devices};return}}catch(N){console.error("Error checking profile usage:",N)}k.value={show:!0,title:`Delete ${l.manufacturer} ${l.model}?`,message:`Device Code: ${l.code}

This will remove the profile and update your configuration.`,platform:c,profile:l,canDelete:!0}}async function b(){var C,a;const c=Me("toast"),{platform:l,profile:N}=k.value;k.value.show=!1;try{await te.delete(`/api/smartir/profiles/${N.code}`,{data:{platform:l}}),await fe(),await at(),await De(),(C=c.value)==null||C.success(`${N.manufacturer} ${N.model} has been removed`,"âœ… Profile Deleted")}catch(M){console.error("Error deleting profile:",M),(a=c.value)==null||a.error("Failed to delete profile","âŒ Delete Error")}}return se(w,c=>{c&&(S.value=c)},{immediate:!0}),se(J,c=>{localStorage.setItem("profile_view_mode",c)}),xe(async()=>{var c;w!=null&&w.value&&(S.value=w.value),S.value||await De(),(c=S.value)!=null&&c.installed&&await fe()}),u({loadAllProfiles:fe,refreshStatus:De}),(c,l)=>{var N,C,a,M,K,le,re,Z,Re;return n(),i("div",Ri,[e("div",Mi,[e("button",{class:"icon-button chevron-button",onClick:l[0]||(l[0]=X=>P.value=!P.value)},[e("i",{class:W(["mdi",P.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2)]),e("div",{class:"header-left",onClick:l[1]||(l[1]=X=>P.value=!P.value)},[e("img",{src:_e(Qe),alt:"SmartIR",class:"smartir-logo"},null,8,Ei),e("h3",null,p(_e(v)?"SmartIR":"SmartIR Integration"),1),e("div",Ai,[e("div",{class:W(["simulation-toggle-pill",{active:O.value}]),onClick:ce(oe,["stop"]),title:O.value?"Click to show as installed":"Click to simulate not-installed"},[e("i",{class:W(["mdi",O.value?"mdi-eye-off":"mdi-eye"])},null,2),e("span",null,p(O.value?"Simulating: Not Installed":"Simulation Mode"),1)],10,Li),(N=H.value)!=null&&N.installed?(n(),i(me,{key:0},[l[16]||(l[16]=e("div",{class:"status-badge-mini success"},[e("i",{class:"mdi mdi-check-circle"}),e("span",null,"Installed")],-1)),e("span",Oi,"v"+p(H.value.version||"Unknown"),1),e("span",Pi,p(E.value)+" platform"+p(E.value!==1?"s":""),1),e("span",Vi,p(j.value)+" device"+p(j.value!==1?"s":""),1)],64)):R("",!0)])]),e("div",Ui,[!_e(v)&&((C=H.value)!=null&&C.installed)?(n(),i("div",ji,[e("button",{onClick:l[2]||(l[2]=ce(X=>J.value="grid",["stop"])),class:W(["view-toggle-btn",{active:J.value==="grid"}]),title:"Grid View"},[...l[17]||(l[17]=[e("i",{class:"mdi mdi-view-grid"},null,-1)])],2),e("button",{onClick:l[3]||(l[3]=ce(X=>J.value="list",["stop"])),class:W(["view-toggle-btn",{active:J.value==="list"}]),title:"List View"},[...l[18]||(l[18]=[e("i",{class:"mdi mdi-view-list"},null,-1)])],2)])):R("",!0),(a=H.value)!=null&&a.installed?(n(),i("button",{key:1,onClick:ce(T,["stop"]),class:"btn btn-primary new-button"},[...l[19]||(l[19]=[e("i",{class:"mdi mdi-plus"},null,-1),e("span",null,"New",-1)])])):R("",!0),(M=H.value)!=null&&M.installed?(n(),i("div",Fi,[e("button",{onClick:ce(V,["stop"]),class:W(["icon-button settings-button",{active:o.value}]),title:"Settings"},[...l[20]||(l[20]=[e("i",{class:"mdi mdi-cog"},null,-1)])],2),o.value?(n(),i("div",{key:0,class:"settings-dropdown",onClick:l[5]||(l[5]=ce(()=>{},["stop"]))},[e("button",{onClick:m,class:"menu-item"},[l[21]||(l[21]=e("i",{class:"mdi mdi-help-circle"},null,-1)),e("span",null,p(h.value?"Hide Help":"Show Help"),1)]),e("button",{onClick:l[4]||(l[4]=X=>{o.value=!1,De()}),class:"menu-item"},[...l[22]||(l[22]=[e("i",{class:"mdi mdi-refresh"},null,-1),e("span",null,"Refresh Status",-1)])]),e("button",{onClick:pe,class:"menu-item"},[...l[23]||(l[23]=[e("i",{class:"mdi mdi-test-tube"},null,-1),e("span",null,"Test Codes",-1)])])])):R("",!0)])):R("",!0)])]),z(e("div",null,[g.value?(n(),i("div",Ni,[...l[24]||(l[24]=[e("div",{class:"spinner"},null,-1),e("p",null,"Checking SmartIR installation...",-1)])])):D.value?(n(),i("div",Bi,[l[25]||(l[25]=e("i",{class:"mdi mdi-alert-circle"},null,-1)),e("p",null,p(D.value),1),e("button",{onClick:De,class:"btn-secondary"}," Try Again ")])):(K=H.value)!=null&&K.installed?(n(),i("div",Hi,[h.value?(n(),i("div",qi,[S.value.recommendation?(n(),i("div",zi,[e("p",null,p(S.value.recommendation.message),1),S.value.recommendation.next_steps?(n(),i("div",Ji,[l[26]||(l[26]=e("strong",null,"Next Steps:",-1)),e("ul",null,[(n(!0),i(me,null,he(S.value.recommendation.next_steps,(X,we)=>(n(),i("li",{key:we},p(X),1))),128))])])):R("",!0)])):R("",!0),e("div",Wi,[e("button",{onClick:l[6]||(l[6]=(...X)=>c.viewDocumentation&&c.viewDocumentation(...X)),class:"btn-secondary"},[...l[27]||(l[27]=[e("i",{class:"mdi mdi-book-open-variant"},null,-1),x(" View Documentation ",-1)])])])])):R("",!0),F.value.length>0&&!O.value?(n(),i("div",Gi,[e("div",Ki,[e("button",{class:W(["filter-toggle-button",{active:_.value||ye.value}]),onClick:l[7]||(l[7]=X=>_.value=!_.value),title:_.value?"Hide filters":"Show filters"},[l[28]||(l[28]=e("i",{class:"mdi mdi-filter-variant"},null,-1)),ye.value?(n(),i("span",Yi,p(Ee.value),1)):R("",!0)],10,Xi),e("div",Zi,[l[29]||(l[29]=e("i",{class:"mdi mdi-magnify search-icon"},null,-1)),z(e("input",{"onUpdate:modelValue":l[8]||(l[8]=X=>s.value.search=X),type:"text",placeholder:"Search profiles...",class:"search-input"},null,512),[[Le,s.value.search]])])]),z(e("div",Qi,[e("div",er,[e("div",tr,[e("label",null,[l[31]||(l[31]=e("i",{class:"mdi mdi-shape"},null,-1)),z(e("select",{"onUpdate:modelValue":l[9]||(l[9]=X=>s.value.platform=X)},[...l[30]||(l[30]=[He('<option value="" data-v-b48342da>All Platforms</option><option value="climate" data-v-b48342da>Climate</option><option value="media_player" data-v-b48342da>Media Player</option><option value="fan" data-v-b48342da>Fan</option><option value="light" data-v-b48342da>Light</option>',5)])],512),[[Ie,s.value.platform]])])]),ye.value?(n(),i("button",{key:0,onClick:Te,class:"btn-clear-filters"},[...l[32]||(l[32]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),x(" Clear ",-1)])])):R("",!0),e("div",or,p(ie.value.length)+" of "+p(F.value.length),1)])],512),[[Ye,_.value]])])):R("",!0),U.value?(n(),i("div",lr,[...l[33]||(l[33]=[e("i",{class:"mdi mdi-loading mdi-spin"},null,-1),e("p",null,"Loading profiles...",-1)])])):F.value.length===0?(n(),i("div",nr,[...l[34]||(l[34]=[e("i",{class:"mdi mdi-file-document-outline"},null,-1),e("h3",null,"No Profiles Yet",-1),e("p",null,"Create your first SmartIR profile to get started",-1)])])):R("",!0),J.value==="grid"&&!O.value?(n(),i("div",sr,[(n(!0),i(me,null,he(ie.value,X=>(n(),Fe(xa,{key:`${X.platform}-${X.code}`,profile:X,onEdit:we=>ue(X.platform,X),onCommands:we=>ue(X.platform,X,2),onDownload:we=>Ae(X.platform,X),onDelete:we=>ee(X.platform,X)},null,8,["profile","onEdit","onCommands","onDownload","onDelete"]))),128))])):J.value==="list"&&!O.value&&ie.value.length>0?(n(),Fe(Za,{key:5,profiles:ie.value,onEdit:l[10]||(l[10]=X=>ue(X.platform,X)),onCommands:l[11]||(l[11]=X=>ue(X.platform,X,2)),onDownload:l[12]||(l[12]=X=>Ae(X.platform,X)),onDelete:l[13]||(l[13]=X=>ee(X.platform,X))},null,8,["profiles"])):R("",!0),F.value.length>0&&ie.value.length===0&&!O.value?(n(),i("div",ar,[...l[35]||(l[35]=[e("i",{class:"mdi mdi-filter-off"},null,-1),e("h3",null,"No profiles match your filters",-1),e("p",null,"Try adjusting your search or filter criteria",-1)])])):R("",!0)])):(n(),i("div",ir,[l[39]||(l[39]=e("div",{class:"status-badge warning"},[e("i",{class:"mdi mdi-information"}),e("span",null,"Not Installed")],-1)),e("div",rr,[l[37]||(l[37]=e("h4",null,"Why Install SmartIR?",-1)),e("ul",dr,[(n(!0),i(me,null,he(((re=(le=S.value)==null?void 0:le.recommendation)==null?void 0:re.benefits)||Y,(X,we)=>(n(),i("li",{key:we},[l[36]||(l[36]=e("i",{class:"mdi mdi-check"},null,-1)),e("span",null,p(X),1)]))),128))])]),e("div",ur,[e("p",null,p(((Re=(Z=S.value)==null?void 0:Z.recommendation)==null?void 0:Re.message)||"Install SmartIR to unlock climate device support!"),1)]),e("div",{class:"card-actions"},[e("button",{onClick:Oe,class:"btn-primary"},[...l[38]||(l[38]=[e("i",{class:"mdi mdi-github"},null,-1),x(" Install SmartIR ",-1)])])])]))],512),[[Ye,P.value]]),ge(Be,{isOpen:k.value.show,title:k.value.title,message:k.value.message,confirmText:k.value.canDelete===!1?null:"Delete",cancelText:"Close",dangerMode:!0,confirmDisabled:k.value.canDelete===!1,onConfirm:b,onCancel:l[14]||(l[14]=X=>k.value.show=!1)},null,8,["isOpen","title","message","confirmText","confirmDisabled"]),ge(xi,{isOpen:f.value,onClose:l[15]||(l[15]=X=>f.value=!1)},null,8,["isOpen"])])}}},mr=$e(cr,[["__scopeId","data-v-b48342da"]]),vr={class:"climate-form"},pr={class:"learning-mode-section"},fr={class:"mode-toggle"},gr={class:"mode-content"},yr={class:"mode-stats"},br={class:"stat-badge"},hr={class:"stat-badge time"},kr={class:"mode-content"},wr={class:"mode-stats"},$r={class:"stat-badge"},Cr={class:"stat-badge time warning"},_r={key:0,class:"command-breakdown"},Sr={class:"warning-text"},Ir={class:"form-section"},Dr={key:0,class:"help-text"},Tr={key:1,class:"help-text"},xr={class:"form-row"},Rr={class:"form-group"},Mr={class:"form-group"},Er={class:"form-group"},Ar={key:2,class:"representative-temp-section"},Lr={class:"form-group"},Or=["value"],Pr={class:"form-section"},Vr={class:"checkbox-grid"},Ur={class:"checkbox-item"},jr={class:"checkbox-item"},Fr={class:"checkbox-item"},Nr={class:"checkbox-item"},Br={class:"checkbox-item"},Hr={class:"checkbox-item"},qr={class:"form-section"},zr={class:"checkbox-grid"},Jr={class:"checkbox-item"},Wr={class:"checkbox-item"},Gr={class:"checkbox-item"},Kr={class:"checkbox-item"},Xr={class:"form-section"},Yr={class:"checkbox-grid"},Zr={class:"checkbox-item"},Qr={class:"checkbox-item"},ed={class:"checkbox-item"},td={class:"checkbox-item"},od={class:"form-section"},ld={class:"form-group"},nd={class:"form-group"},sd={class:"form-group"},ad={key:0,class:"validation-summary"},id={__name:"ClimateProfileForm",props:{modelValue:{type:Object,default:()=>({})}},emits:["update:modelValue"],setup(t,{emit:u}){const r=t,$=u,w=y("quick"),d=y({minTemp:16,maxTemp:30,precision:1,representativeTemp:24,modes:["off","auto","cool","heat"],fanModes:["auto","low","medium","high"],swingModes:[],tempSensor:"",humiditySensor:"",powerSensor:"",learningMode:"quick",...r.modelValue}),v=G(()=>{const _=[],s=d.value.minTemp||16,k=d.value.maxTemp||30,f=d.value.precision||1;for(let A=s;A<=k;A+=f)_.push(A);return _}),g=G(()=>d.value.modes.filter(_=>_!=="off").length),D=G(()=>d.value.fanModes.length||1),S=G(()=>d.value.swingModes.length||1),O=G(()=>{const _=d.value.minTemp||16,s=d.value.maxTemp||30,k=d.value.precision||1;return Math.floor((s-_)/k)+1}),h=G(()=>{const _=d.value.modes.includes("off")?1:0;return g.value*D.value*S.value+_}),o=G(()=>Math.ceil(h.value*30/60)),P=G(()=>{const _=d.value.modes.includes("off")?1:0;return g.value*O.value*D.value*S.value+_}),F=G(()=>Math.ceil(P.value*30/60)),U=G(()=>{const _=[];return(!d.value.minTemp||d.value.minTemp<10||d.value.minTemp>35)&&_.push("Minimum temperature must be between 10Â°C and 35Â°C"),(!d.value.maxTemp||d.value.maxTemp<10||d.value.maxTemp>35)&&_.push("Maximum temperature must be between 10Â°C and 35Â°C"),d.value.minTemp>=d.value.maxTemp&&_.push("Minimum temperature must be less than maximum temperature"),(!d.value.modes||d.value.modes.length===0)&&_.push("At least one HVAC mode must be selected"),_});return se(w,_=>{d.value.learningMode=_}),se(d,_=>{$("update:modelValue",_)},{deep:!0,immediate:!0}),(_,s)=>(n(),i("div",vr,[s[63]||(s[63]=e("h3",null,"Climate Device Configuration",-1)),e("div",pr,[e("div",fr,[e("label",{class:W(["mode-option",{active:w.value==="quick"}])},[z(e("input",{type:"radio",value:"quick","onUpdate:modelValue":s[0]||(s[0]=k=>w.value=k)},null,512),[[ze,w.value]]),e("div",gr,[s[23]||(s[23]=e("div",{class:"mode-header"},[e("i",{class:"mdi mdi-flash"}),e("strong",null,"Quick Mode (Recommended)")],-1)),s[24]||(s[24]=e("p",null,"Learn one temperature per mode combination",-1)),e("div",yr,[e("span",br,p(h.value)+" commands",1),e("span",hr,"~"+p(o.value)+" min",1)])])],2),e("label",{class:W(["mode-option",{active:w.value==="complete"}])},[z(e("input",{type:"radio",value:"complete","onUpdate:modelValue":s[1]||(s[1]=k=>w.value=k)},null,512),[[ze,w.value]]),e("div",kr,[s[25]||(s[25]=e("div",{class:"mode-header"},[e("i",{class:"mdi mdi-check-all"}),e("strong",null,"Complete Mode")],-1)),s[26]||(s[26]=e("p",null,"Learn all temperature combinations",-1)),e("div",wr,[e("span",$r,p(P.value)+" commands",1),e("span",Cr,"~"+p(F.value)+" min",1)])])],2)]),w.value==="complete"?(n(),i("div",_r,[s[27]||(s[27]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[e("strong",null,"Complete mode will require learning "+p(P.value)+" commands",1),e("p",null,"This includes all combinations of modes ("+p(g.value)+"), temperatures ("+p(O.value)+"), fan speeds ("+p(D.value)+"), and swing modes ("+p(S.value)+").",1),e("p",Sr,"â±ï¸ Estimated time: "+p(F.value)+" minutes at ~30 seconds per command",1)])])):R("",!0)]),e("div",Ir,[s[33]||(s[33]=e("h4",null,"Temperature Range",-1)),w.value==="quick"?(n(),i("p",Dr," Define the full temperature range your device supports. You'll select one temperature to learn below. ")):(n(),i("p",Tr," Define the temperature range. All temperatures in this range will be learned. ")),e("div",xr,[e("div",Rr,[s[28]||(s[28]=e("label",null,"Minimum Temperature (Â°C) *",-1)),z(e("input",{"onUpdate:modelValue":s[2]||(s[2]=k=>d.value.minTemp=k),type:"number",min:"10",max:"35",placeholder:"16"},null,512),[[Le,d.value.minTemp,void 0,{number:!0}]])]),e("div",Mr,[s[29]||(s[29]=e("label",null,"Maximum Temperature (Â°C) *",-1)),z(e("input",{"onUpdate:modelValue":s[3]||(s[3]=k=>d.value.maxTemp=k),type:"number",min:"10",max:"35",placeholder:"30"},null,512),[[Le,d.value.maxTemp,void 0,{number:!0}]])]),e("div",Er,[s[31]||(s[31]=e("label",null,"Precision",-1)),z(e("select",{"onUpdate:modelValue":s[4]||(s[4]=k=>d.value.precision=k)},[...s[30]||(s[30]=[e("option",{value:1},"1Â°C (Whole degrees)",-1),e("option",{value:.5},"0.5Â°C (Half degrees)",-1)])],512),[[Ie,d.value.precision,void 0,{number:!0}]])])]),w.value==="quick"?(n(),i("div",Ar,[e("div",Lr,[s[32]||(s[32]=e("label",null,"Representative Temperature to Learn *",-1)),z(e("select",{"onUpdate:modelValue":s[5]||(s[5]=k=>d.value.representativeTemp=k)},[(n(!0),i(me,null,he(v.value,k=>(n(),i("option",{key:k,value:k},p(k)+"Â°C ",9,Or))),128))],512),[[Ie,d.value.representativeTemp,void 0,{number:!0}]]),e("small",null,"This temperature will be learned for all mode combinations. The device profile will still show the full range ("+p(d.value.minTemp)+"Â°C - "+p(d.value.maxTemp)+"Â°C).",1)])])):R("",!0)]),e("div",Pr,[s[40]||(s[40]=e("h4",null,"Supported HVAC Modes *",-1)),s[41]||(s[41]=e("p",{class:"help-text"},"Select all modes your device supports",-1)),e("div",Vr,[e("label",Ur,[z(e("input",{type:"checkbox",value:"off","onUpdate:modelValue":s[6]||(s[6]=k=>d.value.modes=k)},null,512),[[ve,d.value.modes]]),s[34]||(s[34]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),x(" Off ")],-1))]),e("label",jr,[z(e("input",{type:"checkbox",value:"auto","onUpdate:modelValue":s[7]||(s[7]=k=>d.value.modes=k)},null,512),[[ve,d.value.modes]]),s[35]||(s[35]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-autorenew"}),x(" Auto ")],-1))]),e("label",Fr,[z(e("input",{type:"checkbox",value:"cool","onUpdate:modelValue":s[8]||(s[8]=k=>d.value.modes=k)},null,512),[[ve,d.value.modes]]),s[36]||(s[36]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-snowflake"}),x(" Cool ")],-1))]),e("label",Nr,[z(e("input",{type:"checkbox",value:"heat","onUpdate:modelValue":s[9]||(s[9]=k=>d.value.modes=k)},null,512),[[ve,d.value.modes]]),s[37]||(s[37]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fire"}),x(" Heat ")],-1))]),e("label",Br,[z(e("input",{type:"checkbox",value:"dry","onUpdate:modelValue":s[10]||(s[10]=k=>d.value.modes=k)},null,512),[[ve,d.value.modes]]),s[38]||(s[38]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-water-percent"}),x(" Dry ")],-1))]),e("label",Hr,[z(e("input",{type:"checkbox",value:"fan_only","onUpdate:modelValue":s[11]||(s[11]=k=>d.value.modes=k)},null,512),[[ve,d.value.modes]]),s[39]||(s[39]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan"}),x(" Fan Only ")],-1))])])]),e("div",qr,[s[46]||(s[46]=e("h4",null,"Fan Modes",-1)),s[47]||(s[47]=e("p",{class:"help-text"},"Select all fan speeds your device supports",-1)),e("div",zr,[e("label",Jr,[z(e("input",{type:"checkbox",value:"auto","onUpdate:modelValue":s[12]||(s[12]=k=>d.value.fanModes=k)},null,512),[[ve,d.value.fanModes]]),s[42]||(s[42]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-autorenew"}),x(" Auto ")],-1))]),e("label",Wr,[z(e("input",{type:"checkbox",value:"low","onUpdate:modelValue":s[13]||(s[13]=k=>d.value.fanModes=k)},null,512),[[ve,d.value.fanModes]]),s[43]||(s[43]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-1"}),x(" Low ")],-1))]),e("label",Gr,[z(e("input",{type:"checkbox",value:"medium","onUpdate:modelValue":s[14]||(s[14]=k=>d.value.fanModes=k)},null,512),[[ve,d.value.fanModes]]),s[44]||(s[44]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-2"}),x(" Medium ")],-1))]),e("label",Kr,[z(e("input",{type:"checkbox",value:"high","onUpdate:modelValue":s[15]||(s[15]=k=>d.value.fanModes=k)},null,512),[[ve,d.value.fanModes]]),s[45]||(s[45]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-3"}),x(" High ")],-1))])])]),e("div",Xr,[s[52]||(s[52]=e("h4",null,"Swing Modes (Optional)",-1)),s[53]||(s[53]=e("p",{class:"help-text"},"Select if your device has swing/oscillation",-1)),e("div",Yr,[e("label",Zr,[z(e("input",{type:"checkbox",value:"off","onUpdate:modelValue":s[16]||(s[16]=k=>d.value.swingModes=k)},null,512),[[ve,d.value.swingModes]]),s[48]||(s[48]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-horizontal"}),x(" Off ")],-1))]),e("label",Qr,[z(e("input",{type:"checkbox",value:"vertical","onUpdate:modelValue":s[17]||(s[17]=k=>d.value.swingModes=k)},null,512),[[ve,d.value.swingModes]]),s[49]||(s[49]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-vertical"}),x(" Vertical ")],-1))]),e("label",ed,[z(e("input",{type:"checkbox",value:"horizontal","onUpdate:modelValue":s[18]||(s[18]=k=>d.value.swingModes=k)},null,512),[[ve,d.value.swingModes]]),s[50]||(s[50]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-horizontal"}),x(" Horizontal ")],-1))]),e("label",td,[z(e("input",{type:"checkbox",value:"both","onUpdate:modelValue":s[19]||(s[19]=k=>d.value.swingModes=k)},null,512),[[ve,d.value.swingModes]]),s[51]||(s[51]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-arrow-all"}),x(" Both ")],-1))])])]),e("div",od,[s[60]||(s[60]=e("h4",null,"Sensors (Optional)",-1)),s[61]||(s[61]=e("p",{class:"help-text"},"Link external sensors for better climate control",-1)),e("div",ld,[s[54]||(s[54]=e("label",null,"Temperature Sensor",-1)),z(e("input",{"onUpdate:modelValue":s[20]||(s[20]=k=>d.value.tempSensor=k),type:"text",placeholder:"sensor.living_room_temperature"},null,512),[[Le,d.value.tempSensor]]),s[55]||(s[55]=e("small",null,"Entity ID of temperature sensor",-1))]),e("div",nd,[s[56]||(s[56]=e("label",null,"Humidity Sensor",-1)),z(e("input",{"onUpdate:modelValue":s[21]||(s[21]=k=>d.value.humiditySensor=k),type:"text",placeholder:"sensor.living_room_humidity"},null,512),[[Le,d.value.humiditySensor]]),s[57]||(s[57]=e("small",null,"Entity ID of humidity sensor",-1))]),e("div",sd,[s[58]||(s[58]=e("label",null,"Power Sensor",-1)),z(e("input",{"onUpdate:modelValue":s[22]||(s[22]=k=>d.value.powerSensor=k),type:"text",placeholder:"binary_sensor.ac_power"},null,512),[[Le,d.value.powerSensor]]),s[59]||(s[59]=e("small",null,"Entity ID of power sensor (to detect on/off state)",-1))])]),U.value.length>0?(n(),i("div",ad,[s[62]||(s[62]=e("h4",null,[e("i",{class:"mdi mdi-alert-circle"}),x(" Please fix the following: ")],-1)),e("ul",null,[(n(!0),i(me,null,he(U.value,(k,f)=>(n(),i("li",{key:f},p(k),1))),128))])])):R("",!0)]))}},rd=$e(id,[["__scopeId","data-v-c44d7198"]]),dd={class:"command-wizard"},ud={class:"device-selection-section"},cd={class:"input-wrapper"},md=["value"],vd={key:0,class:"validation-tooltip"},pd={class:"form-group"},fd=["disabled"],gd={key:0},yd={key:1},bd={key:0,class:"edit-mode-banner"},hd={class:"wizard-info"},kd={key:0},wd={key:1},$d={class:"progress-info"},Cd={class:"progress-bar"},_d={class:"progress-text"},Sd={class:"commands-grid"},Id={class:"command-header"},Dd={class:"command-icon"},Td={class:"command-info"},xd={key:0,class:"learning-indicator"},Rd={key:0,class:"ir-learning-steps"},Md={key:1,class:"rf-learning-steps"},Ed={class:"command-actions"},Ad=["onClick","disabled"],Ld={key:1,class:"learned-status"},Od=["onClick","disabled"],Pd=["onClick"],Vd={class:"quick-actions"},Ud=["disabled"],jd=["disabled"],Fd={__name:"CommandLearningWizard",props:{modelValue:{type:Object,default:()=>({})},platform:{type:String,required:!0},config:{type:Object,required:!0},broadlinkDevice:{type:String,default:""},manufacturer:{type:String,required:!0},model:{type:String,required:!0},commandType:{type:String,default:"ir"}},emits:["update:modelValue","update:broadlinkDevice","update:commandType"],setup(t,{emit:u}){const r=Ge(),$=t,w=u,d=y({...$.modelValue}),v=y(null),g=y(null),D=y([]),S=y($.broadlinkDevice),O=y($.commandType),h=y(!1),o=y([]),P=y(!1),F=y(!1),U=y({show:!1,commandKey:null,commandLabel:""}),_=y(!1),s=G(()=>{const T=[];if($.platform==="climate"){const m=$.config.modes||[],V=$.config.fanModes||[],pe=$.config.minTemp||16,Oe=$.config.maxTemp||30;m.forEach(fe=>{if(fe==="off")T.push({key:"off",label:"Power Off",description:"Turn device off",icon:"mdi mdi-power",mode:"off"});else for(let ue=pe;ue<=Oe;ue++)V.forEach(Ae=>{const Pe=`${fe}_${ue}_${Ae}`;T.push({key:Pe,label:`${fe.toUpperCase()} ${ue}Â°C ${Ae}`,description:`Mode: ${fe}, Temp: ${ue}Â°C, Fan: ${Ae}`,icon:J(fe),mode:fe,temp:ue,fanMode:Ae})})})}else if($.platform==="media_player"){const m=$.config.features||[];m.includes("turn_on")&&(T.push({key:"turn_on",label:"Power On",description:"Turn on the device",icon:"mdi mdi-power"}),T.push({key:"turn_off",label:"Power Off",description:"Turn off the device",icon:"mdi mdi-power-off"})),m.includes("volume")&&(T.push({key:"volume_up",label:"Volume Up",description:"Increase volume",icon:"mdi mdi-volume-plus"}),T.push({key:"volume_down",label:"Volume Down",description:"Decrease volume",icon:"mdi mdi-volume-minus"})),m.includes("mute")&&T.push({key:"mute",label:"Mute",description:"Toggle mute",icon:"mdi mdi-volume-mute"}),m.includes("source")&&(T.push({key:"source_hdmi1",label:"Source: HDMI 1",description:"Switch to HDMI 1",icon:"mdi mdi-import"}),T.push({key:"source_hdmi2",label:"Source: HDMI 2",description:"Switch to HDMI 2",icon:"mdi mdi-import"}),T.push({key:"source_hdmi3",label:"Source: HDMI 3",description:"Switch to HDMI 3",icon:"mdi mdi-import"})),m.includes("channel")&&(T.push({key:"channel_up",label:"Channel Up",description:"Next channel",icon:"mdi mdi-chevron-up"}),T.push({key:"channel_down",label:"Channel Down",description:"Previous channel",icon:"mdi mdi-chevron-down"}))}else if($.platform==="fan"){const m=$.config.speedLevels||3,V=$.config.features||[];T.push({key:"turn_on",label:"Power On",description:"Turn on the fan",icon:"mdi mdi-power"}),T.push({key:"turn_off",label:"Power Off",description:"Turn off the fan",icon:"mdi mdi-power-off"});for(let pe=1;pe<=m;pe++){const Oe=pe===1?"Low":pe===m?"High":pe===2&&m===3?"Medium":`Speed ${pe}`;T.push({key:`speed_${pe}`,label:`${Oe}`,description:`Set fan to speed level ${pe}`,icon:"mdi mdi-fan"})}V.includes("oscillate")&&(T.push({key:"oscillate_on",label:"Oscillate On",description:"Enable oscillation",icon:"mdi mdi-sync"}),T.push({key:"oscillate_off",label:"Oscillate Off",description:"Disable oscillation",icon:"mdi mdi-sync-off"})),V.includes("direction")&&(T.push({key:"direction_forward",label:"Direction: Forward",description:"Set direction to forward",icon:"mdi mdi-rotate-right"}),T.push({key:"direction_reverse",label:"Direction: Reverse",description:"Set direction to reverse",icon:"mdi mdi-rotate-left"}))}else if($.platform==="light"){const m=$.config.features||[];m.includes("turn_on")&&(T.push({key:"turn_on",label:"Power On",description:"Turn on the light",icon:"mdi mdi-lightbulb-on"}),T.push({key:"turn_off",label:"Power Off",description:"Turn off the light",icon:"mdi mdi-lightbulb-off"})),m.includes("brightness")&&(T.push({key:"brightness_up",label:"Brightness Up",description:"Increase brightness",icon:"mdi mdi-brightness-7"}),T.push({key:"brightness_down",label:"Brightness Down",description:"Decrease brightness",icon:"mdi mdi-brightness-5"})),m.includes("color_temp")&&(T.push({key:"color_temp_warm",label:"Warm White",description:"Set to warm white",icon:"mdi mdi-weather-sunset"}),T.push({key:"color_temp_cool",label:"Cool White",description:"Set to cool white",icon:"mdi mdi-weather-sunny"})),m.includes("rgb")&&(T.push({key:"color_red",label:"Color: Red",description:"Set color to red",icon:"mdi mdi-palette"}),T.push({key:"color_green",label:"Color: Green",description:"Set color to green",icon:"mdi mdi-palette"}),T.push({key:"color_blue",label:"Color: Blue",description:"Set color to blue",icon:"mdi mdi-palette"}))}return T}),k=G(()=>s.value.length),f=G(()=>Object.keys(d.value).length),A=G(()=>k.value===0?0:Math.round(f.value/k.value*100));function J(T){return{off:"mdi mdi-power",auto:"mdi mdi-autorenew",cool:"mdi mdi-snowflake",heat:"mdi mdi-fire",dry:"mdi mdi-water-percent",fan_only:"mdi mdi-fan"}[T]||"mdi mdi-remote"}async function Y(T){if(!v.value){if(!S.value){F.value=!0,window.scrollTo({top:0,behavior:"smooth"});return}F.value=!1,v.value=T.key;try{const m=$.manufacturer.toLowerCase().replace(/[^a-z0-9]+/g,"_"),V=$.model.toLowerCase().replace(/[^a-z0-9]+/g,"_"),pe=`${m}_${V}`,fe=(await te.post("/api/commands/learn",{entity_id:S.value,device:pe,command:T.key,command_type:O.value})).data;if(fe.success&&fe.code)d.value[T.key]=fe.code,w("update:modelValue",d.value),P.value=!0,fe.code==="pending"&&console.log(`â³ Command '${T.key}' learned, code will be fetched from storage when saving`),h.value&&o.value.length>0&&setTimeout(()=>{const ue=o.value.shift();ue?Y(ue):h.value=!1},1e3);else throw new Error(fe.error||"Failed to learn command")}catch(m){console.error("Error learning command:",m),r.error(`Error learning command: ${m.message}`),h.value=!1,o.value=[]}finally{h.value||(v.value=null)}}}async function Q(T){var m;if(!S.value){F.value=!0,window.scrollTo({top:0,behavior:"smooth"});return}if(!d.value[T]){(m=r.value)==null||m.error("Command not learned yet");return}g.value=T;try{const V=d.value[T];await te.post("/api/commands/send-raw",{entity_id:S.value,command:V,command_type:O.value}),r.success("Command sent successfully")}catch(V){console.error("Error testing command:",V),r.error(`Error testing command: ${V.message}`)}finally{g.value=null}}function H(T){const m=s.value.find(V=>V.key===T);U.value={show:!0,commandKey:T,commandLabel:m?m.label:T}}function E(){const T=U.value.commandKey;delete d.value[T],w("update:modelValue",d.value),U.value.show=!1}function j(){const T=s.value.filter(V=>!d.value[V.key]);if(T.length===0)return;h.value=!0,o.value=[...T];const m=o.value.shift();m&&Y(m)}function oe(){_.value=!0}function ie(){d.value={},w("update:modelValue",d.value),_.value=!1}se(()=>$.modelValue,T=>{d.value={...T}},{deep:!0}),xe(async()=>{await ye()});async function ye(){try{console.log("SmartIR device - commands will be loaded from SmartIR JSON file, not Broadlink storage")}catch(T){console.error("Error in loadExistingCommands:",T)}}function Ee(){w("update:broadlinkDevice",S.value)}function Te(){w("update:commandType",O.value)}async function De(){try{console.log("ðŸ” Loading Broadlink devices from /api/remote/devices");const T=await te.get("/api/remote/devices");console.log("ðŸ“¦ Response data:",T.data);const m=T.data.devices||[];console.log(`âœ… Found ${m.length} devices:`,m),D.value=m}catch(T){console.error("âŒ Error loading remote devices:",T),D.value=[]}}return se(()=>$.broadlinkDevice,T=>{S.value=T}),se(S,T=>{T&&(F.value=!1)}),se(()=>$.commandType,T=>{O.value=T}),xe(async()=>{await De(),await ye()}),(T,m)=>(n(),i("div",dd,[m[22]||(m[22]=e("h3",null,"Learn IR Commands",-1)),e("div",ud,[e("div",{class:W(["form-group",{"has-error":F.value}])},[m[6]||(m[6]=e("label",null,"Broadlink Device *",-1)),e("div",cd,[z(e("select",{"onUpdate:modelValue":m[0]||(m[0]=V=>S.value=V),onChange:Ee},[m[4]||(m[4]=e("option",{value:""},"Select Broadlink device...",-1)),(n(!0),i(me,null,he(D.value,V=>(n(),i("option",{key:V.entity_id,value:V.entity_id},p(V.name||V.entity_id),9,md))),128))],544),[[Ie,S.value]]),F.value?(n(),i("div",vd,[...m[5]||(m[5]=[e("i",{class:"mdi mdi-alert"},null,-1),x(" Device is required ",-1)])])):R("",!0)]),e("small",null,"This device will be used to learn commands ("+p(D.value.length)+" devices found)",1)],2),e("div",pd,[m[8]||(m[8]=e("label",null,"Command Type *",-1)),z(e("select",{"onUpdate:modelValue":m[1]||(m[1]=V=>O.value=V),onChange:Te,disabled:f.value>0},[...m[7]||(m[7]=[e("option",{value:"ir"},"ðŸ“¡ Infrared (IR) - Most common for AC, TV, etc.",-1),e("option",{value:"rf"},"ðŸ“» Radio Frequency (RF) - For RF remotes",-1)])],40,fd),[[Ie,O.value]]),f.value>0?(n(),i("small",gd,"Command type cannot be changed after learning commands")):(n(),i("small",yd,"Select the type of commands your device uses"))])]),f.value>0&&!P.value?(n(),i("div",bd,[m[10]||(m[10]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[m[9]||(m[9]=e("strong",null,"Editing Existing Profile",-1)),e("p",null,p(f.value)+" command"+p(f.value!==1?"s":"")+' already learned. You can re-learn any command by clicking the delete icon and then "Learn Command".',1)])])):R("",!0),e("div",hd,[m[14]||(m[14]=e("i",{class:"mdi mdi-information"},null,-1)),e("div",null,[m[13]||(m[13]=e("p",null,[e("strong",null,"How it works:")],-1)),t.commandType==="ir"?(n(),i("ol",kd,[...m[11]||(m[11]=[e("li",null,'Click "Learn Command" for each combination',-1),e("li",null,[e("strong",null,"Point your IR remote directly at the Broadlink device")],-1),e("li",null,"Press the button on your remote",-1),e("li",null,"Wait for confirmation (up to 30 seconds)",-1)])])):(n(),i("ol",wd,[...m[12]||(m[12]=[e("li",null,'Click "Learn Command" for each combination',-1),e("li",null,[e("strong",null,"Step 1:"),x(" Hold button on remote - Broadlink scans for RF frequency")],-1),e("li",null,[e("strong",null,"Step 2:"),x(" Watch for Home Assistant notification, then press and release button")],-1),e("li",null,"Keep remote within 5cm of Broadlink (RF doesn't need line-of-sight)",-1),e("li",null,"Wait for confirmation (may take up to 30 seconds)",-1)])]))])]),e("div",$d,[e("div",Cd,[e("div",{class:"progress-fill",style:ft({width:A.value+"%"})},null,4)]),e("span",_d,p(f.value)+" / "+p(k.value)+" commands learned ("+p(A.value)+"%) ",1)]),e("div",Sd,[(n(!0),i(me,null,he(s.value,V=>(n(),i("div",{key:V.key,class:W(["command-card",{learned:d.value[V.key],learning:v.value===V.key}])},[e("div",Id,[e("div",Dd,[e("i",{class:W(V.icon)},null,2)]),e("div",Td,[e("h4",null,p(V.label),1),e("p",null,p(V.description),1)])]),v.value===V.key?(n(),i("div",xd,[t.commandType==="ir"?(n(),i("div",Rd,[...m[15]||(m[15]=[e("p",null,[e("strong",null,"Point your remote directly at the Broadlink device and press the button.")],-1),e("small",null,"Listening for up to 30 seconds...",-1)])])):(n(),i("div",Md,[...m[16]||(m[16]=[e("p",{class:"rf-title"},[e("strong",null,"Learning request sent to device.")],-1),e("p",{class:"rf-subtitle"},[x("RF learning is a "),e("strong",null,"two-step process"),x(":")],-1),e("ol",null,[e("li",null,[e("strong",null,"Step 1 - Frequency Sweep (~10-15 seconds):"),x(" Press and hold the button on your remote until the notification updates. ")]),e("li",null,[e("strong",null,"Step 2 - Learn Signal:"),x(" Press and release the button once. ")])],-1),e("p",{class:"rf-note"},"Follow the Home Assistant notifications (ðŸ””) for real-time instructions.",-1)])]))])):R("",!0),e("div",Ed,[d.value[V.key]?(n(),i("div",Ld,[m[18]||(m[18]=e("i",{class:"mdi mdi-check-circle"},null,-1)),m[19]||(m[19]=e("span",null,"Learned",-1)),e("span",{class:W(["command-type-badge",O.value])},p(O.value.toUpperCase()),3),e("button",{onClick:pe=>Q(V.key),class:"icon-btn",title:"Test command",disabled:g.value===V.key,style:{"margin-left":"auto"}},[e("i",{class:W(["mdi mdi-play",{"mdi-spin":g.value===V.key}])},null,2)],8,Od),e("button",{onClick:pe=>H(V.key),class:"icon-btn danger",title:"Delete and re-learn"},[...m[17]||(m[17]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,Pd)])):(n(),i("button",{key:0,onClick:pe=>Y(V),class:W(["btn-learn",{learning:v.value===V.key}]),disabled:v.value!==null},[e("i",{class:W(["mdi mdi-radio-tower",{"mdi-spin":v.value===V.key}])},null,2),x(" "+p(v.value===V.key?"Listening...":"Learn Command"),1)],10,Ad))])],2))),128))]),e("div",Vd,[e("button",{onClick:j,class:"btn-secondary",disabled:v.value!==null||f.value===k.value},[...m[20]||(m[20]=[e("i",{class:"mdi mdi-play-circle"},null,-1),x(" Learn All Remaining ",-1)])],8,Ud),e("button",{onClick:oe,class:"btn-text",disabled:f.value===0},[...m[21]||(m[21]=[e("i",{class:"mdi mdi-delete-sweep"},null,-1),x(" Clear All ",-1)])],8,jd)]),ge(Be,{isOpen:U.value.show,title:"Delete Learned Command?",message:`Are you sure you want to delete the '${U.value.commandLabel}' command?

You will need to re-learn this command.`,confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,onConfirm:E,onCancel:m[2]||(m[2]=V=>U.value.show=!1)},null,8,["isOpen","message"]),ge(Be,{isOpen:_.value,title:"Delete All Learned Commands?",message:"Are you sure you want to delete all learned commands? This cannot be undone.\\n\\nYou will need to re-learn all commands.",confirmText:"Delete All",cancelText:"Cancel",dangerMode:!0,onConfirm:ie,onCancel:m[3]||(m[3]=V=>_.value=!1)},null,8,["isOpen"])]))}},Nd=$e(Fd,[["__scopeId","data-v-9a9e9e51"]]),Bd={class:"profile-preview"},Hd={class:"preview-summary"},qd={class:"summary-card"},zd={class:"stats-grid"},Jd={class:"stat-item"},Wd={class:"stat-value"},Gd={class:"stat-item"},Kd={class:"stat-value"},Xd={class:"stat-item"},Yd={class:"stat-value"},Zd={class:"preview-tabs"},Qd={class:"preview-content"},eu={key:0,class:"tab-content"},tu={class:"code-header"},ou={class:"code-block"},lu={key:1,class:"tab-content"},nu={class:"code-header"},su={class:"code-block"},au={key:2,class:"tab-content"},iu={class:"instructions"},ru={class:"step-item"},du={class:"step-content"},uu={class:"code-path"},cu={__name:"ProfilePreview",props:{profile:{type:Object,required:!0},jsonData:{type:Object,required:!0},yamlConfig:{type:String,required:!0}},setup(t){const u=Ge(),r=t,$=y("json"),w=y(!1),d=y(!1),v=G(()=>Object.keys(r.profile.commands||{}).length),g=G(()=>JSON.stringify(r.jsonData,null,2));async function D(){try{await navigator.clipboard.writeText(g.value),w.value=!0,setTimeout(()=>{w.value=!1},2e3)}catch(O){console.error("Failed to copy JSON:",O),u.error("Failed to copy to clipboard")}}async function S(){try{await navigator.clipboard.writeText(r.yamlConfig),d.value=!0,setTimeout(()=>{d.value=!1},2e3)}catch(O){console.error("Failed to copy YAML:",O),u.error("Failed to copy to clipboard")}}return(O,h)=>{var o;return n(),i("div",Bd,[h[22]||(h[22]=e("h3",null,"Preview & Save",-1)),e("div",Hd,[e("div",qd,[h[4]||(h[4]=e("i",{class:"mdi mdi-check-circle"},null,-1)),e("div",null,[h[3]||(h[3]=e("h4",null,"Profile Ready!",-1)),e("p",null,p(t.profile.manufacturer)+" "+p(t.profile.model),1)])]),e("div",zd,[e("div",Jd,[e("span",Wd,p(v.value),1),h[5]||(h[5]=e("span",{class:"stat-label"},"Commands Learned",-1))]),e("div",Gd,[e("span",Kd,p(t.profile.platform),1),h[6]||(h[6]=e("span",{class:"stat-label"},"Platform",-1))]),e("div",Xd,[e("span",Yd,p(((o=t.profile.config.modes)==null?void 0:o.length)||0),1),h[7]||(h[7]=e("span",{class:"stat-label"},"HVAC Modes",-1))])])]),e("div",Zd,[e("button",{onClick:h[0]||(h[0]=P=>$.value="json"),class:W(["tab-button",{active:$.value==="json"}])},[...h[8]||(h[8]=[e("i",{class:"mdi mdi-code-json"},null,-1),x(" SmartIR JSON ",-1)])],2),e("button",{onClick:h[1]||(h[1]=P=>$.value="yaml"),class:W(["tab-button",{active:$.value==="yaml"}])},[...h[9]||(h[9]=[e("i",{class:"mdi mdi-file-code"},null,-1),x(" YAML Config ",-1)])],2),e("button",{onClick:h[2]||(h[2]=P=>$.value="instructions"),class:W(["tab-button",{active:$.value==="instructions"}])},[...h[10]||(h[10]=[e("i",{class:"mdi mdi-information"},null,-1),x(" Instructions ",-1)])],2)]),e("div",Qd,[$.value==="json"?(n(),i("div",eu,[e("div",tu,[h[12]||(h[12]=e("h4",null,"SmartIR Device Code JSON",-1)),e("button",{onClick:D,class:"btn-copy"},[h[11]||(h[11]=e("i",{class:"mdi mdi-content-copy"},null,-1)),x(" "+p(w.value?"Copied!":"Copy"),1)])]),e("pre",ou,[e("code",null,p(g.value),1)]),h[13]||(h[13]=e("p",{class:"code-note"},[e("i",{class:"mdi mdi-information"}),x(" Save this as "),e("code",null,"10000.json"),x(" in your SmartIR codes directory ")],-1))])):R("",!0),$.value==="yaml"?(n(),i("div",lu,[e("div",nu,[h[15]||(h[15]=e("h4",null,"Home Assistant Configuration",-1)),e("button",{onClick:S,class:"btn-copy"},[h[14]||(h[14]=e("i",{class:"mdi mdi-content-copy"},null,-1)),x(" "+p(d.value?"Copied!":"Copy"),1)])]),e("pre",su,[e("code",null,p(t.yamlConfig),1)]),h[16]||(h[16]=e("p",{class:"code-note"},[e("i",{class:"mdi mdi-information"}),x(" Add this to your "),e("code",null,"configuration.yaml"),x(" file ")],-1))])):R("",!0),$.value==="instructions"?(n(),i("div",au,[e("div",iu,[h[20]||(h[20]=e("h4",null,"Installation Steps",-1)),e("div",ru,[h[19]||(h[19]=e("div",{class:"step-number"},"1",-1)),e("div",du,[h[17]||(h[17]=e("h5",null,"Get Next Code Number",-1)),h[18]||(h[18]=e("p",null,"Custom device codes start at 10000. Check your SmartIR codes directory to find the next available number.",-1)),e("div",uu,[e("code",null,"/config/custom_components/smartir/codes/"+p(t.profile.platform)+"/",1)])])]),h[21]||(h[21]=He('<div class="step-item" data-v-e7b997c8><div class="step-number" data-v-e7b997c8>2</div><div class="step-content" data-v-e7b997c8><h5 data-v-e7b997c8>Save JSON File</h5><p data-v-e7b997c8>Copy the JSON from the &quot;SmartIR JSON&quot; tab and save it as <code data-v-e7b997c8>10000.json</code> (or your next available number) in the codes directory.</p></div></div><div class="step-item" data-v-e7b997c8><div class="step-number" data-v-e7b997c8>3</div><div class="step-content" data-v-e7b997c8><h5 data-v-e7b997c8>Update Configuration</h5><p data-v-e7b997c8>Copy the YAML from the &quot;YAML Config&quot; tab and add it to your <code data-v-e7b997c8>configuration.yaml</code> file. Update the <code data-v-e7b997c8>device_code</code> to match your JSON filename.</p></div></div><div class="step-item" data-v-e7b997c8><div class="step-number" data-v-e7b997c8>4</div><div class="step-content" data-v-e7b997c8><h5 data-v-e7b997c8>Restart Home Assistant</h5><p data-v-e7b997c8>Restart Home Assistant to load the new configuration. Your climate entity will appear in the UI.</p></div></div><div class="step-item" data-v-e7b997c8><div class="step-number" data-v-e7b997c8>5</div><div class="step-content" data-v-e7b997c8><h5 data-v-e7b997c8>Test Your Device</h5><p data-v-e7b997c8>Go to your climate entity and test different modes, temperatures, and fan speeds to ensure everything works correctly.</p></div></div><div class="tips-section" data-v-e7b997c8><h4 data-v-e7b997c8><i class="mdi mdi-lightbulb" data-v-e7b997c8></i> Tips </h4><ul data-v-e7b997c8><li data-v-e7b997c8>Keep a backup of your JSON file in case you need to modify it</li><li data-v-e7b997c8>Test all commands to ensure they work as expected</li><li data-v-e7b997c8>You can share your profile with the SmartIR community on GitHub</li><li data-v-e7b997c8>If a command doesn&#39;t work, you can re-learn it and update the JSON</li></ul></div>',5))])])):R("",!0)])])}}},mu=$e(cu,[["__scopeId","data-v-e7b997c8"]]),vu={class:"wizard-body"},pu={key:0,class:"warning-section"},fu={class:"warning-box"},gu={class:"instructions"},yu={class:"code-block"},bu={class:"steps"},hu={key:0},ku={class:"help-section"},wu={key:0,class:"help-content"},$u={class:"help-step"},Cu={key:0,class:"help-step"},_u={class:"help-step"},Su={class:"help-step"},Iu={class:"checklist"},Du={class:"checkbox-label"},Tu={key:0,class:"checkbox-label"},xu={class:"wizard-footer"},Ru=["disabled"],Mu={__name:"SmartIRSetupWizard",props:{show:{type:Boolean,default:!1},platform:{type:String,required:!0},warnings:{type:Array,default:()=>[]},configPath:{type:String,default:"/config"}},emits:["close","complete"],setup(t,{emit:u}){const r=t,$=u,w=Me("toast"),d=y(!1),v=y(!1),g=y(!1),D=G(()=>r.warnings.length>0?d.value&&v.value:d.value);function S(){const h=`${r.platform}: !include smartir/${r.platform}.yaml`;navigator.clipboard.writeText(h).then(()=>{var o;(o=w.value)==null||o.success("Include line copied to clipboard!","âœ… Copied")}).catch(o=>{var P;console.error("Failed to copy:",o),(P=w.value)==null||P.error("Failed to copy to clipboard","âŒ Copy Failed")})}function O(){$("complete")}return(h,o)=>t.show?(n(),i("div",{key:0,class:"modal-overlay",onClick:o[5]||(o[5]=ce(()=>{},["stop"]))},[e("div",{class:"setup-wizard",onClick:o[4]||(o[4]=ce(()=>{},["stop"]))},[o[31]||(o[31]=e("div",{class:"wizard-header"},[e("h2",null,[e("i",{class:"mdi mdi-cog"}),x(" SmartIR Configuration Setup ")])],-1)),e("div",vu,[t.warnings.length>0?(n(),i("div",pu,[e("div",fu,[o[11]||(o[11]=e("i",{class:"mdi mdi-alert"},null,-1)),e("div",null,[o[9]||(o[9]=e("h3",null,"âš ï¸ Configuration Migration Needed",-1)),o[10]||(o[10]=e("p",null,"We detected existing platform entries in your configuration.yaml:",-1)),e("ul",null,[(n(!0),i(me,null,he(t.warnings,P=>(n(),i("li",{key:P.platform},[e("strong",null,p(P.platform)+":",1),x(" "+p(P.message),1)]))),128))]),e("p",null,[o[6]||(o[6]=e("strong",null,"Action Required:",-1)),o[7]||(o[7]=x(" Move these entries to ",-1)),e("code",null,"smartir/"+p(t.platform)+".yaml",1),o[8]||(o[8]=x(" before continuing.",-1))])])])])):R("",!0),e("div",gu,[o[27]||(o[27]=e("h3",null,"ðŸ“ One-Time Setup",-1)),o[28]||(o[28]=e("p",null,[x("To enable SmartIR device management, add this line to your "),e("code",null,"configuration.yaml"),x(":")],-1)),e("div",yu,[e("code",null,p(t.platform)+": !include smartir/"+p(t.platform)+".yaml",1),e("button",{onClick:S,class:"copy-btn",title:"Copy to clipboard"},[...o[12]||(o[12]=[e("i",{class:"mdi mdi-content-copy"},null,-1)])])]),e("div",bu,[o[19]||(o[19]=e("h4",null,"Steps:",-1)),e("ol",null,[t.warnings.length>0?(n(),i("li",hu,[o[13]||(o[13]=e("strong",null,"Move existing entries:",-1)),o[14]||(o[14]=x(" Copy any existing ",-1)),e("code",null,p(t.platform)+":",1),o[15]||(o[15]=x(" entries from configuration.yaml to ",-1)),e("code",null,"smartir/"+p(t.platform)+".yaml",1)])):R("",!0),o[16]||(o[16]=e("li",null,[e("strong",null,"Add include line:"),x(" Add the line above to your configuration.yaml ")],-1)),o[17]||(o[17]=e("li",null,[e("strong",null,"Save changes:"),x(" Save configuration.yaml ")],-1)),o[18]||(o[18]=e("li",null,[e("strong",null,"Continue here:"),x(` Click "I've Completed Setup" below `)],-1))])]),e("div",ku,[e("button",{onClick:o[0]||(o[0]=P=>g.value=!g.value),class:"help-toggle"},[e("i",{class:W(["mdi",g.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2),x(" "+p(g.value?"Hide":"Show")+" Detailed Instructions ",1)]),g.value?(n(),i("div",wu,[o[26]||(o[26]=e("h4",null,"Detailed Setup Guide:",-1)),e("div",$u,[o[21]||(o[21]=e("h5",null,"1. Open configuration.yaml",-1)),e("p",null,[o[20]||(o[20]=x("Location: ",-1)),e("code",null,p(t.configPath)+"/configuration.yaml",1)])]),t.warnings.length>0?(n(),i("div",Cu,[o[22]||(o[22]=e("h5",null,"2. Migrate Existing Entries (If Any)",-1)),e("p",null,"If you have existing "+p(t.platform)+" entries, cut them from configuration.yaml and paste into:",1),e("p",null,[e("code",null,p(t.configPath)+"/smartir/"+p(t.platform)+".yaml",1)]),o[23]||(o[23]=e("p",{class:"note"},"Broadlink Manager will create this file automatically.",-1))])):R("",!0),e("div",_u,[e("h5",null,p(t.warnings.length>0?"3":"2")+". Add Include Line",1),o[24]||(o[24]=e("p",null,"Add this to configuration.yaml:",-1)),e("pre",null,p(t.platform)+": !include smartir/"+p(t.platform)+".yaml",1)]),e("div",Su,[e("h5",null,p(t.warnings.length>0?"4":"3")+". Restart Home Assistant",1),o[25]||(o[25]=e("p",null,"After saving, you'll need to restart HA for changes to take effect.",-1))])])):R("",!0)])]),e("div",Iu,[e("label",Du,[z(e("input",{type:"checkbox","onUpdate:modelValue":o[1]||(o[1]=P=>d.value=P)},null,512),[[ve,d.value]]),o[29]||(o[29]=e("span",null,"I've added the include line to configuration.yaml",-1))]),t.warnings.length>0?(n(),i("label",Tu,[z(e("input",{type:"checkbox","onUpdate:modelValue":o[2]||(o[2]=P=>v.value=P)},null,512),[[ve,v.value]]),e("span",null,"I've migrated existing "+p(t.platform)+" entries (if any)",1)])):R("",!0)])]),e("div",xu,[e("button",{onClick:o[3]||(o[3]=P=>h.$emit("close")),class:"btn-secondary"}," Cancel "),e("button",{onClick:O,class:"btn-primary",disabled:!D.value},[...o[30]||(o[30]=[e("i",{class:"mdi mdi-check"},null,-1),x(" I've Completed Setup ",-1)])],8,Ru)])])])):R("",!0)}},Eu=$e(Mu,[["__scopeId","data-v-f6fe4c03"]]),Au={class:"modal-header"},Lu={class:"progress-steps"},Ou={class:"step-number"},Pu={key:0,class:"mdi mdi-check"},Vu={key:1},Uu={class:"step-label"},ju={class:"modal-body"},Fu={key:0,class:"step-content"},Nu={class:"form-group"},Bu={class:"form-group"},Hu={class:"form-group"},qu={key:1,class:"step-content"},zu={key:1,class:"platform-form"},Ju={class:"form-section"},Wu={class:"checkbox-grid"},Gu={class:"checkbox-item"},Ku={class:"checkbox-item"},Xu={class:"checkbox-item"},Yu={class:"checkbox-item"},Zu={class:"checkbox-item"},Qu={key:2,class:"platform-form"},ec={class:"form-section"},tc={class:"form-group"},oc={class:"form-section"},lc={class:"checkbox-grid"},nc={class:"checkbox-item"},sc={class:"checkbox-item"},ac={key:3,class:"platform-form"},ic={class:"form-section"},rc={class:"checkbox-grid"},dc={class:"checkbox-item"},uc={class:"checkbox-item"},cc={class:"checkbox-item"},mc={class:"checkbox-item"},vc={key:2,class:"step-content"},pc={key:3,class:"step-content"},fc={class:"modal-footer"},gc=["disabled"],yc={key:2,class:"save-buttons"},bc=["disabled"],hc=["disabled"],kc={__name:"SmartIRProfileBuilder",props:{show:{type:Boolean,default:!1},editMode:{type:Boolean,default:!1},editData:{type:Object,default:null},startStep:{type:Number,default:0}},emits:["close","save"],setup(t,{emit:u}){const r=t,$=u,w=Me("toast"),d=y(0),v=y(!1),g=y([]),D=y(!1),S=y([]),O=y("/config"),h=y(!1),o=y(null),P=y(!1),F=y(!1),U=y(""),_=y("ir"),s=y(!1),k=[{label:"Device Info",key:"info"},{label:"Configuration",key:"config"},{label:"Learn Commands",key:"commands"},{label:"Preview & Save",key:"preview"}],f=y({platform:"",manufacturer:"",model:"",broadlinkDevice:"",commandType:"ir",config:{},commands:{}}),A=y(["turn_on"]),J=y(3),Y=y([]),Q=y(["turn_on"]);se(()=>f.value.platform,C=>{C==="media_player"?f.value.config={features:A.value}:C==="fan"?f.value.config={speedLevels:J.value,features:Y.value}:C==="light"&&(f.value.config={features:Q.value})}),se(A,C=>{f.value.platform==="media_player"&&(f.value.config={features:C})},{deep:!0}),se(J,C=>{f.value.platform==="fan"&&(f.value.config={speedLevels:C,features:Y.value})}),se(Y,C=>{f.value.platform==="fan"&&(f.value.config={speedLevels:J.value,features:C})},{deep:!0}),se(Q,C=>{f.value.platform==="light"&&(f.value.config={features:C})},{deep:!0});function H(C){const a=new Set,M=Object.keys(C);return M.some(K=>K==="off"||K.includes("_off"))&&a.add("off"),M.some(K=>K.includes("auto"))&&a.add("auto"),M.some(K=>K.includes("cool"))&&a.add("cool"),M.some(K=>K.includes("heat"))&&a.add("heat"),M.some(K=>K.includes("dry"))&&a.add("dry"),M.some(K=>K.includes("fan_only"))&&a.add("fan_only"),Array.from(a)}function E(C){const a=new Set,M=Object.keys(C);return M.some(K=>K.includes("auto"))&&a.add("auto"),M.some(K=>K.includes("low"))&&a.add("low"),M.some(K=>K.includes("medium")||K.includes("mid"))&&a.add("medium"),M.some(K=>K.includes("high"))&&a.add("high"),Array.from(a)}function j(C){const a=new Set,M=Object.keys(C);return M.some(K=>K.includes("swing_off")||K.includes("_off"))&&a.add("off"),M.some(K=>K.includes("vertical"))&&a.add("vertical"),M.some(K=>K.includes("horizontal"))&&a.add("horizontal"),M.some(K=>K.includes("both"))&&a.add("both"),Array.from(a)}function oe(C){for(const a of Object.values(C))if(typeof a=="string"&&a.startsWith("sc")||Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0].startsWith("sc"))return"rf";return"ir"}se(()=>f.value.commandType,(C,a)=>{!a||P.value||s.value||(Object.keys(f.value.commands).length>0&&C!==a?(U.value=C,f.value.commandType=a,P.value=!0):C!==a&&(_.value=C))}),se(()=>r.editData,async C=>{var a,M,K;if(C&&r.editMode){console.log("ðŸ”§ Edit mode activated, loading profile data:",C),s.value=!0,g.value.length===0&&(console.log("ðŸ“¡ Loading Broadlink devices..."),await N(),console.log("ðŸ“¡ Devices loaded:",g.value.length));const le=C.profile,re=le.controller_data;console.log("ðŸŽ® Controller data from profile:",re),console.log("ðŸŽ® Available devices:",g.value.map(ae=>ae.entity_id));const Z=le.commands||{},Re=le.commandType||oe(Z);console.log("ðŸ” Command type (stored):",le.commandType),console.log("ðŸ” Command type (final):",Re);let X={};if(C.platform==="climate"){const ae=le.operationModes||H(Z),Ce=le.fanModes||E(Z),Ve=le.swingModes||j(Z);console.log("ðŸ” Inferred modes:",ae),console.log("ðŸ” Inferred fan modes:",Ce),console.log("ðŸ” Inferred swing modes:",Ve),X={minTemp:le.minTemperature,maxTemp:le.maxTemperature,precision:le.precision,modes:ae,fanModes:Ce,swingModes:Ve}}else if(C.platform==="media_player"){const ae=[];(Z.on||Z.off)&&ae.push("turn_on"),(Z.volumeUp||Z.volumeDown)&&ae.push("volume"),Z.mute&&ae.push("mute"),Z.sources&&ae.push("source"),(Z.channelUp||Z.channelDown)&&ae.push("channel"),X={features:ae},A.value=ae,console.log("ðŸ” Inferred media player features:",ae)}else if(C.platform==="fan"){const ae=((a=le.speed)==null?void 0:a.length)||Object.keys(Z.default||{}).length||3,Ce=[];(Z.oscillate_on||Z.oscillate_off)&&Ce.push("oscillate"),(Z.direction_forward||Z.direction_reverse)&&Ce.push("direction"),X={speedLevels:ae,features:Ce},J.value=ae,Y.value=Ce,console.log("ðŸ” Inferred fan config:",X)}else if(C.platform==="light"){const ae=[];X={features:ae},Q.value=ae,console.log("ðŸ” Inferred light features:",ae)}const we=await b(le.manufacturer,(M=le.supportedModels)==null?void 0:M[0],Z);f.value={platform:C.platform,manufacturer:le.manufacturer||"",model:((K=le.supportedModels)==null?void 0:K[0])||"",broadlinkDevice:re||"",commandType:Re,config:X,commands:we},console.log("âœ… Profile populated:",f.value),console.log("âœ… Selected device:",f.value.broadlinkDevice),console.log("âœ… Command type:",f.value.commandType),console.log("âœ… Commands (with learned codes):",we),_.value=Re,setTimeout(()=>{s.value=!1},100)}},{immediate:!0});const ie=G(()=>{var C;switch(d.value){case 0:return f.value.platform&&f.value.manufacturer&&f.value.model;case 1:return f.value.platform==="climate"?f.value.config.minTemp&&f.value.config.maxTemp&&((C=f.value.config.modes)==null?void 0:C.length)>0:!0;case 2:return f.value.broadlinkDevice&&f.value.commandType&&Object.keys(f.value.commands).length>0;case 3:return!0;default:return!1}}),ye=y(null);async function Ee(){if(d.value!==3){ye.value=null;return}if(console.log("ðŸ” Generating JSON with commands:",f.value.commands),Object.values(f.value.commands).some(a=>typeof a=="string"?a==="pending":typeof a=="object"?Object.values(a).some(M=>typeof M=="string"?M==="pending":typeof M=="object"?Object.values(M).some(K=>K==="pending"):!1):!1)){console.warn('âš ï¸ Commands still contain "pending" placeholders!'),console.log("ðŸ“¦ Attempting to fetch from Broadlink storage...");const a=await b(f.value.manufacturer,f.value.model,f.value.commands);f.value.commands=a,console.log("âœ… Updated commands:",a)}ye.value=c(f.value),console.log("ðŸ“„ Generated JSON:",ye.value)}const Te=G(()=>d.value!==3?null:l(f.value));function De(){f.value.config={},f.value.commands={}}function T(){P.value=!1,f.value.commandType=U.value,_.value=U.value,f.value.commands={},U.value=""}function m(){P.value=!1,U.value=""}async function V(){d.value<k.length-1&&(d.value++,d.value===3&&await Ee())}function pe(){d.value>0&&d.value--}function Oe(){P.value||(F.value=!0)}function fe(){F.value=!1,ue()}function ue(){$("close"),setTimeout(()=>{d.value=0,f.value={platform:"",manufacturer:"",model:"",broadlinkDevice:"",commandType:"ir",config:{},commands:{}},_.value="ir"},300)}async function Ae(){var C,a,M,K,le,re;v.value=!0;try{if(!h.value){const Ce=(await te.get("/api/smartir/config/check")).data;if(Ce&&!((C=Ce.platforms[f.value.platform])==null?void 0:C.file_exists)){S.value=Ce.configuration_warnings||[],O.value=Ce.config_path||"/config",o.value={platform:f.value.platform,json:ye.value},D.value=!0,v.value=!1;return}}let Z;r.editMode&&((a=r.editData)!=null&&a.code)?(Z=parseInt(r.editData.code),console.log("ðŸ“ Edit mode: Using existing code",Z)):(Z=(await te.get(`/api/smartir/platforms/${f.value.platform}/next-code`)).data.next_code,console.log("âœ¨ New profile: Using next code",Z));const X=(await te.post("/api/smartir/profiles",{platform:f.value.platform,json:ye.value,code_number:Z})).data,we={platform:"smartir",name:`${f.value.manufacturer} ${f.value.model}`,unique_id:`${f.value.manufacturer.toLowerCase().replace(/[^a-z0-9]+/g,"_")}_${f.value.model.toLowerCase().replace(/[^a-z0-9]+/g,"_")}`,device_code:Z,controller_data:f.value.broadlinkDevice};try{await te.post("/api/smartir/config/add-device",{platform:f.value.platform,device_config:{platform:"smartir",name:we.name,unique_id:we.unique_id,device_code:we.device_code,controller_data:we.controller_data}})}catch(ae){console.error("Failed to add device to config:",ae);const Ce=((M=ae.response)==null?void 0:M.data)||{};let Ve=Ce.error||"Unknown error";Ce.validation_errors&&Ce.validation_errors.length>0&&(Ve=`Device configuration validation failed:
`+Ce.validation_errors.map(qe=>`  â€¢ ${qe}`).join(`
`)),(K=w.value)==null||K.warning(`Profile saved but failed to add to config file:
${Ve}`,"âš ï¸ Partial Success")}$("save",{json:ye.value,yaml:Te.value,profile:f.value,saved_to:X.path}),(le=w.value)==null||le.success(`File: ${X.filename}
Device Code: ${Z}
Added to: smartir/${f.value.platform}.yaml

âš ï¸ Restart Home Assistant to activate`,"âœ… Profile Saved Successfully!"),ue()}catch(Z){console.error("Error saving profile:",Z),(re=w.value)==null||re.error(Z.message,"âŒ Error Saving Profile")}finally{v.value=!1}}async function Pe(){h.value=!0,D.value=!1,o.value&&(await Ae(),o.value=null)}function ee(){var C,a;try{const M=JSON.stringify(ye.value,null,2),K=new Blob([M],{type:"application/json"}),le=URL.createObjectURL(K),re=document.createElement("a");re.href=le;const Z=f.value.manufacturer.toLowerCase().replace(/\s+/g,"_"),Re=f.value.model.toLowerCase().replace(/\s+/g,"_");re.download=`smartir_${f.value.platform}_${Z}_${Re}.json`,document.body.appendChild(re),re.click(),document.body.removeChild(re),URL.revokeObjectURL(le),(C=w.value)==null||C.success("You can manually upload this file to your SmartIR codes directory.","âœ… Profile Downloaded")}catch(M){console.error("Error downloading profile:",M),(a=w.value)==null||a.error(M.message,"âŒ Error Downloading Profile")}}async function b(C,a,M){const K=C.toLowerCase().replace(/[^a-z0-9]+/g,"_"),le=a.toLowerCase().replace(/[^a-z0-9]+/g,"_"),re=`${K}_${le}`;try{const X=(await te.get("/api/commands/all")).data[re]||{};console.log(`ðŸ” Fetching learned commands for device: ${re}`),console.log("ðŸ“¦ Device commands from storage:",X);const we={...M};for(const[ae,Ce]of Object.entries(we))if(Ce==="pending"&&X[ae])we[ae]=X[ae];else if(typeof Ce=="object"){for(const[Ve,qe]of Object.entries(Ce))if(typeof qe=="object")for(const[L,I]of Object.entries(qe)){const B=`${ae}_${Ve}_${L}`;I==="pending"&&X[B]&&(we[ae][Ve][L]=X[B])}else if(qe==="pending"){const L=`${ae}_${Ve}`;X[L]&&(we[ae][Ve]=X[L])}}return console.log("âœ… Merged commands:",we),we}catch(Z){return console.error("Error fetching learned commands:",Z),M}}function c(C){const a={manufacturer:C.manufacturer,supportedModels:[C.model],supportedController:"Broadlink",commandsEncoding:"Base64",commandType:C.commandType||"ir",commands:{}};return C.platform==="climate"&&(a.minTemperature=C.config.minTemp,a.maxTemperature=C.config.maxTemp,a.precision=C.config.precision||1,a.operationModes=C.config.modes||[],a.fanModes=C.config.fanModes&&C.config.fanModes.length>0?C.config.fanModes:["auto"],C.config.swingModes&&C.config.swingModes.length>0&&(a.swingModes=C.config.swingModes),a.commands=C.commands),a}function l(C){let a=`# SmartIR ${C.platform} configuration
`;return a+=`# Generated by Broadlink Manager v2

`,C.platform==="climate"&&(a+=`climate:
`,a+=`  - platform: smartir
`,a+=`    name: ${C.manufacturer} ${C.model}
`,a+=`    unique_id: ${C.manufacturer.toLowerCase()}_${C.model.toLowerCase().replace(/\s+/g,"_")}
`,a+=`    device_code: 10000  # Change this to your custom code number
`,a+=`    controller_data: ${C.broadlinkDevice}
`,C.config.tempSensor&&(a+=`    temperature_sensor: ${C.config.tempSensor}
`),C.config.humiditySensor&&(a+=`    humidity_sensor: ${C.config.humiditySensor}
`),C.config.powerSensor&&(a+=`    power_sensor: ${C.config.powerSensor}
`)),a}async function N(){try{console.log("Fetching remote devices from /api/remote/devices...");const C=await te.get("/api/remote/devices");console.log("Loaded remote devices response:",C.data);const a=C.data.devices||[];console.log("Extracted devices array:",a),console.log("Device count:",a.length),g.value=a,console.log("broadlinkDevices.value set to:",g.value),console.log("Final device count:",g.value.length)}catch(C){console.error("Error loading remote devices:",C),g.value=[]}}return se(()=>r.show,C=>{if(C){const a=Number.isInteger(r.startStep)?r.startStep:0;d.value=Math.min(Math.max(a,0),k.length-1)}}),se(()=>r.startStep,C=>{if(r.show){const a=Number.isInteger(C)?C:0;d.value=Math.min(Math.max(a,0),k.length-1)}}),xe(()=>{r.show&&N()}),(C,a)=>t.show?(n(),i("div",{key:0,class:"modal-overlay",onClick:Oe},[e("div",{class:"modal-container",onClick:a[19]||(a[19]=ce(()=>{},["stop"]))},[e("div",Au,[e("h2",null,[a[22]||(a[22]=e("i",{class:"mdi mdi-file-document-edit"},null,-1)),x(" "+p(t.editMode?"Edit SmartIR Profile":"Create SmartIR Profile"),1)]),e("button",{onClick:ue,class:"close-button"},[...a[23]||(a[23]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Lu,[(n(),i(me,null,he(k,(M,K)=>e("div",{key:K,class:W(["step",{active:d.value===K,completed:d.value>K}])},[e("div",Ou,[d.value>K?(n(),i("i",Pu)):(n(),i("span",Vu,p(K+1),1))]),e("span",Uu,p(M.label),1)],2)),64))]),e("div",ju,[d.value===0?(n(),i("div",Fu,[a[29]||(a[29]=e("h3",null,"Device Information",-1)),e("div",Nu,[a[25]||(a[25]=e("label",null,"Platform Type *",-1)),z(e("select",{"onUpdate:modelValue":a[0]||(a[0]=M=>f.value.platform=M),onChange:De},[...a[24]||(a[24]=[He('<option value="" data-v-2e218e9d>Select platform...</option><option value="climate" data-v-2e218e9d>ðŸŒ¡ï¸ Climate (AC, Heater, Heat Pump)</option><option value="media_player" data-v-2e218e9d>ðŸ“º Media Player (TV, Receiver)</option><option value="fan" data-v-2e218e9d>ðŸŒ€ Fan</option><option value="light" data-v-2e218e9d>ðŸ’¡ Light (LED Strip, IR Light)</option>',5)])],544),[[Ie,f.value.platform]])]),e("div",Bu,[a[26]||(a[26]=e("label",null,"Manufacturer *",-1)),z(e("input",{"onUpdate:modelValue":a[1]||(a[1]=M=>f.value.manufacturer=M),type:"text",placeholder:"e.g., Daikin, LG, Samsung"},null,512),[[Le,f.value.manufacturer]])]),e("div",Hu,[a[27]||(a[27]=e("label",null,"Model(s) *",-1)),z(e("input",{"onUpdate:modelValue":a[2]||(a[2]=M=>f.value.model=M),type:"text",placeholder:"e.g., FTXS35K, Multiple models"},null,512),[[Le,f.value.model]]),a[28]||(a[28]=e("small",null,'Enter model number or "Multiple" if it works with many models',-1))])])):R("",!0),d.value===1?(n(),i("div",qu,[f.value.platform==="climate"?(n(),Fe(rd,{key:0,modelValue:f.value.config,"onUpdate:modelValue":a[3]||(a[3]=M=>f.value.config=M)},null,8,["modelValue"])):f.value.platform==="media_player"?(n(),i("div",zu,[a[36]||(a[36]=e("h3",null,"Media Player Configuration",-1)),a[37]||(a[37]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),x(" Configure the features your media player supports. You'll learn the IR commands in the next step. ")],-1)),e("div",Ju,[a[35]||(a[35]=e("h4",null,"Supported Features",-1)),e("div",Wu,[e("label",Gu,[z(e("input",{type:"checkbox",value:"turn_on","onUpdate:modelValue":a[4]||(a[4]=M=>A.value=M)},null,512),[[ve,A.value]]),a[30]||(a[30]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),x(" Power On/Off ")],-1))]),e("label",Ku,[z(e("input",{type:"checkbox",value:"volume","onUpdate:modelValue":a[5]||(a[5]=M=>A.value=M)},null,512),[[ve,A.value]]),a[31]||(a[31]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-volume-high"}),x(" Volume Control ")],-1))]),e("label",Xu,[z(e("input",{type:"checkbox",value:"mute","onUpdate:modelValue":a[6]||(a[6]=M=>A.value=M)},null,512),[[ve,A.value]]),a[32]||(a[32]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-volume-mute"}),x(" Mute ")],-1))]),e("label",Yu,[z(e("input",{type:"checkbox",value:"source","onUpdate:modelValue":a[7]||(a[7]=M=>A.value=M)},null,512),[[ve,A.value]]),a[33]||(a[33]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-import"}),x(" Source Selection ")],-1))]),e("label",Zu,[z(e("input",{type:"checkbox",value:"channel","onUpdate:modelValue":a[8]||(a[8]=M=>A.value=M)},null,512),[[ve,A.value]]),a[34]||(a[34]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-numeric"}),x(" Channel Control ")],-1))])])])])):f.value.platform==="fan"?(n(),i("div",Qu,[a[44]||(a[44]=e("h3",null,"Fan Configuration",-1)),a[45]||(a[45]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),x(" Configure the features your fan supports. You'll learn the IR commands in the next step. ")],-1)),e("div",ec,[a[40]||(a[40]=e("h4",null,"Fan Speed Levels",-1)),e("div",tc,[a[39]||(a[39]=e("label",null,"Number of Speed Levels *",-1)),z(e("select",{"onUpdate:modelValue":a[9]||(a[9]=M=>J.value=M)},[...a[38]||(a[38]=[e("option",{value:1},"1 Speed",-1),e("option",{value:2},"2 Speeds",-1),e("option",{value:3},"3 Speeds (Low/Med/High)",-1),e("option",{value:4},"4 Speeds",-1),e("option",{value:5},"5 Speeds",-1),e("option",{value:6},"6 Speeds",-1)])],512),[[Ie,J.value,void 0,{number:!0}]])])]),e("div",oc,[a[43]||(a[43]=e("h4",null,"Additional Features",-1)),e("div",lc,[e("label",nc,[z(e("input",{type:"checkbox",value:"oscillate","onUpdate:modelValue":a[10]||(a[10]=M=>Y.value=M)},null,512),[[ve,Y.value]]),a[41]||(a[41]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-sync"}),x(" Oscillation ")],-1))]),e("label",sc,[z(e("input",{type:"checkbox",value:"direction","onUpdate:modelValue":a[11]||(a[11]=M=>Y.value=M)},null,512),[[ve,Y.value]]),a[42]||(a[42]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-rotate-3d-variant"}),x(" Direction (Forward/Reverse) ")],-1))])])])])):f.value.platform==="light"?(n(),i("div",ac,[a[51]||(a[51]=e("h3",null,"Light Configuration",-1)),a[52]||(a[52]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),x(" Configure the features your light supports. You'll learn the IR commands in the next step. ")],-1)),e("div",ic,[a[50]||(a[50]=e("h4",null,"Supported Features",-1)),e("div",rc,[e("label",dc,[z(e("input",{type:"checkbox",value:"turn_on","onUpdate:modelValue":a[12]||(a[12]=M=>Q.value=M)},null,512),[[ve,Q.value]]),a[46]||(a[46]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),x(" Power On/Off ")],-1))]),e("label",uc,[z(e("input",{type:"checkbox",value:"brightness","onUpdate:modelValue":a[13]||(a[13]=M=>Q.value=M)},null,512),[[ve,Q.value]]),a[47]||(a[47]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-brightness-6"}),x(" Brightness Control ")],-1))]),e("label",cc,[z(e("input",{type:"checkbox",value:"color_temp","onUpdate:modelValue":a[14]||(a[14]=M=>Q.value=M)},null,512),[[ve,Q.value]]),a[48]||(a[48]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-thermometer"}),x(" Color Temperature ")],-1))]),e("label",mc,[z(e("input",{type:"checkbox",value:"rgb","onUpdate:modelValue":a[15]||(a[15]=M=>Q.value=M)},null,512),[[ve,Q.value]]),a[49]||(a[49]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-palette"}),x(" RGB Color ")],-1))])])])])):R("",!0)])):R("",!0),d.value===2?(n(),i("div",vc,[ge(Nd,{modelValue:f.value.commands,"onUpdate:modelValue":a[16]||(a[16]=M=>f.value.commands=M),platform:f.value.platform,config:f.value.config,broadlinkDevice:f.value.broadlinkDevice,"onUpdate:broadlinkDevice":a[17]||(a[17]=M=>f.value.broadlinkDevice=M),manufacturer:f.value.manufacturer,model:f.value.model,commandType:f.value.commandType,"onUpdate:commandType":a[18]||(a[18]=M=>f.value.commandType=M)},null,8,["modelValue","platform","config","broadlinkDevice","manufacturer","model","commandType"])])):R("",!0),d.value===3?(n(),i("div",pc,[ge(mu,{profile:f.value,"json-data":ye.value,"yaml-config":Te.value},null,8,["profile","json-data","yaml-config"])])):R("",!0)]),e("div",fc,[d.value>0?(n(),i("button",{key:0,onClick:pe,class:"btn-secondary"},[...a[53]||(a[53]=[e("i",{class:"mdi mdi-arrow-left"},null,-1),x(" Back ",-1)])])):R("",!0),a[57]||(a[57]=e("div",{class:"spacer"},null,-1)),e("button",{onClick:ue,class:"btn-text"}," Cancel "),d.value<k.length-1?(n(),i("button",{key:1,onClick:V,class:"btn-primary",disabled:!ie.value},[...a[54]||(a[54]=[x(" Next ",-1),e("i",{class:"mdi mdi-arrow-right"},null,-1)])],8,gc)):(n(),i("div",yc,[e("button",{onClick:Ae,class:"btn-primary",disabled:v.value},[a[55]||(a[55]=e("i",{class:"mdi mdi-cloud-upload"},null,-1)),x(" "+p(v.value?"Saving...":"Save to SmartIR"),1)],8,bc),e("button",{onClick:ee,class:"btn-secondary",disabled:v.value},[...a[56]||(a[56]=[e("i",{class:"mdi mdi-download"},null,-1),x(" Download JSON ",-1)])],8,hc)]))])]),ge(Eu,{show:D.value,platform:f.value.platform,warnings:S.value,"config-path":O.value,onClose:a[20]||(a[20]=M=>D.value=!1),onComplete:Pe},null,8,["show","platform","warnings","config-path"]),ge(Be,{isOpen:P.value,title:"Change Command Type?",message:"Changing the command type will clear all learned commands. Continue?",confirmText:"Continue",cancelText:"Cancel",dangerMode:!0,onConfirm:T,onCancel:m},null,8,["isOpen"]),ge(Be,{isOpen:F.value,title:"Close Profile Builder?",message:"Are you sure you want to close? Your progress will be lost.",confirmText:"Close",cancelText:"Keep Editing",dangerMode:!0,onConfirm:fe,onCancel:a[21]||(a[21]=M=>F.value=!1)},null,8,["isOpen"])])):R("",!0)}},wc=$e(kc,[["__scopeId","data-v-2e218e9d"]]),$c={class:"dashboard"},Cc={key:1,class:"welcome-banner"},_c={__name:"Dashboard",setup(t){const u=Ge(),r=Me("smartirEnabled"),{isMobile:$}=ot(),w=y(!1),d=y(!1),v=y(null),g=y(0),D=y(null),S=y(localStorage.getItem("welcome_banner_dismissed")==="true");function O(){S.value=!0,localStorage.setItem("welcome_banner_dismissed","true")}function h(){d.value=!1,v.value=null,g.value=0,w.value=!0}async function o({platform:U,profile:_,startStep:s}){g.value=Number.isInteger(s)?s:0;try{const k=await fetch(`api/smartir/platforms/${U}/profiles/${_.code}`);if(!k.ok)throw new Error("Failed to load profile");const f=await k.json();let A="";try{const J=await fetch(`api/smartir/config/get-device?platform=${U}&code=${_.code}`);J.ok?(A=(await J.json()).controller_data||"",console.log("âœ… Found controller_data from YAML:",A)):console.warn("âš ï¸ No YAML entry found for this profile (this is OK for profiles not yet added to config)")}catch(J){console.warn("âš ï¸ Could not fetch controller_data from config:",J)}d.value=!0,v.value={platform:U,code:_.code,profile:{...f.profile,controller_data:A}},w.value=!0}catch(k){console.error("Error loading profile for edit:",k),u.error("Failed to load profile for editing")}}function P(){w.value=!1,d.value=!1,v.value=null}async function F(U){console.log("Profile saved:",U),P(),D.value&&D.value.loadAllProfiles&&(await D.value.loadAllProfiles(),console.log("âœ… Profiles list refreshed"))}return(U,_)=>(n(),i("div",$c,[_e(r)?(n(),Fe(pa,{key:0})):R("",!0),!_e($)&&!S.value?(n(),i("div",Cc,[e("button",{class:"dismiss-button",onClick:O,title:"Dismiss"},[..._[0]||(_[0]=[e("i",{class:"mdi mdi-close"},null,-1)])]),_[1]||(_[1]=He('<div class="banner-content" data-v-12185d74><div class="banner-icon" data-v-12185d74><i class="mdi mdi-rocket-launch" data-v-12185d74></i></div><div class="banner-text" data-v-12185d74><h2 data-v-12185d74>Welcome to Broadlink Manager v2!</h2><p data-v-12185d74>Manage your IR/RF devices with a modern Vue 3 interface</p></div></div><div class="status-badges" data-v-12185d74><span class="badge success" data-v-12185d74><i class="mdi mdi-check-circle" data-v-12185d74></i> Vue 3 Ready </span><span class="badge warning" data-v-12185d74><i class="mdi mdi-beta" data-v-12185d74></i> Beta </span></div>',2))])):R("",!0),ge(ra),_e(r)?(n(),Fe(mr,{key:2,ref_key:"smartirStatusCard",ref:D,onCreateProfile:h,onEditProfile:o},null,512)):R("",!0),ge(wc,{show:w.value,editMode:d.value,editData:v.value,startStep:g.value,onClose:P,onSave:F},null,8,["show","editMode","editData","startStep"])]))}},Sc=$e(_c,[["__scopeId","data-v-12185d74"]]),Ic={class:"toast-container"},Dc={class:"toast-content"},Tc={key:0,class:"toast-title"},xc={class:"toast-message"},Rc={key:1,class:"toast-description"},Mc=["onClick","title"],Ec={__name:"Toast",setup(t,{expose:u}){const r=y([]);let $=0;function w(g){const D={success:"mdi-check-circle",error:"mdi-alert-circle",warning:"mdi-alert",info:"mdi-information"};return D[g]||D.info}function d({message:g,title:D,description:S,type:O="info",duration:h=5e3}){const o=$++,P={id:o,message:g,title:D,description:S,type:O};return r.value.push(P),h>0&&setTimeout(()=>{v(o)},h),o}function v(g){const D=r.value.findIndex(S=>S.id===g);D>-1&&r.value.splice(D,1)}return u({addToast:d,removeToast:v,show:d,success:(g,D)=>d({message:g,title:D,type:"success"}),error:(g,D)=>d({message:g,title:D,type:"error",duration:0}),warning:(g,D)=>d({message:g,title:D,type:"warning",duration:0}),info:(g,D)=>d({message:g,title:D,type:"info"})}),(g,D)=>(n(),Fe(it,{to:"body"},[e("div",Ic,[ge(gt,{name:"toast"},{default:tt(()=>[(n(!0),i(me,null,he(r.value,S=>(n(),i("div",{key:S.id,class:W(["toast",[`toast-${S.type}`,{"toast-persistent":S.type==="error"||S.type==="warning"}]])},[e("i",{class:W(["mdi",w(S.type)])},null,2),e("div",Dc,[S.title?(n(),i("div",Tc,p(S.title),1)):R("",!0),e("div",xc,p(S.message),1),S.description?(n(),i("div",Rc,p(S.description),1)):R("",!0)]),e("button",{onClick:O=>v(S.id),class:W(["toast-close",{"toast-close-prominent":S.type==="error"||S.type==="warning"}]),title:S.type==="error"||S.type==="warning"?"Click to dismiss":"Close"},[...D[0]||(D[0]=[e("i",{class:"mdi mdi-close"},null,-1)])],10,Mc)],2))),128))]),_:1})])]))}},Ac=$e(Ec,[["__scopeId","data-v-3948c088"]]),Lc="0.3.0-alpha.2",Oc={version:Lc},Pc={id:"app",class:"app-container"},Vc={class:"app-header"},Uc={class:"header-content"},jc={class:"header-right"},Fc=["title"],Nc={class:"settings-menu-container"},Bc={key:0,class:"settings-menu"},Hc=["title"],qc={class:"toggle-content"},zc={key:0,class:"not-installed-label"},Jc={key:0,href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"menu-item menu-link menu-subitem"},Wc=["disabled"],Gc=["disabled"],Kc=["disabled"],Xc={class:"app-main"},Yc={class:"app-footer"},Zc={__name:"App",setup(t){const u=y(null),r=Oc.version,$=y("light"),w=y(null),d=y(!1),v=y(!1),g=y(!1),D=y(localStorage.getItem("smartir_enabled")!=="false"),S=G(()=>{var f;return((f=w.value)==null?void 0:f.installed)||!1}),O=G(()=>({light:"mdi mdi-weather-sunny",medium:"mdi mdi-weather-partly-cloudy",dark:"mdi mdi-weather-night"})[$.value]),h=G(()=>({light:"Switch to Medium Theme",medium:"Switch to Dark Theme",dark:"Switch to Light Theme"})[$.value]),o=()=>{const f=["light","medium","dark"],J=(f.indexOf($.value)+1)%f.length;$.value=f[J],document.body.classList.remove("medium-mode","dark-mode"),$.value==="medium"?document.body.classList.add("medium-mode"):$.value==="dark"&&document.body.classList.add("dark-mode"),localStorage.setItem("theme",$.value)},P=async()=>{try{const f=await ut.getStatus();w.value=f,f.installed?console.log("âœ… SmartIR detected:",f.version):console.log("â„¹ï¸ SmartIR not detected")}catch(f){console.error("Error checking SmartIR:",f),w.value={installed:!1,error:f.message}}},F=async()=>{var f,A,J;v.value=!0;try{const Q=(await te.get("/api/diagnostics/markdown")).data.markdown;if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(Q),(f=u.value)==null||f.success("Diagnostic summary copied to clipboard!");else{const H=document.createElement("textarea");H.value=Q,H.style.position="fixed",H.style.left="-999999px",H.style.top="-999999px",document.body.appendChild(H),H.focus(),H.select();try{if(document.execCommand("copy"))(A=u.value)==null||A.success("Diagnostic summary copied to clipboard!");else throw new Error("execCommand failed")}finally{document.body.removeChild(H)}}d.value=!1}catch(Y){console.error("Error copying diagnostics:",Y),(J=u.value)==null||J.error("Failed to copy diagnostics: "+Y.message)}finally{v.value=!1}},U=async()=>{var f,A;v.value=!0;try{const J=await te.get("/api/diagnostics/download",{responseType:"blob"}),Y=window.URL.createObjectURL(new Blob([J.data])),Q=document.createElement("a");Q.href=Y;const H=J.headers["content-disposition"];let E="broadlink_manager_diagnostics.zip";if(H){const j=H.match(/filename="?(.+)"?/);j&&(E=j[1])}Q.setAttribute("download",E),document.body.appendChild(Q),Q.click(),Q.remove(),window.URL.revokeObjectURL(Y),(f=u.value)==null||f.success("Diagnostic bundle downloaded!"),d.value=!1}catch(J){console.error("Error downloading diagnostics:",J),(A=u.value)==null||A.error("Failed to download diagnostics")}finally{v.value=!1}},_=f=>{f.target.closest(".settings-menu-container")||(d.value=!1)};xe(()=>{document.addEventListener("click",_)}),We(()=>{document.removeEventListener("click",_)});const s=()=>{S.value&&(D.value=!D.value,localStorage.setItem("smartir_enabled",D.value.toString()),window.location.reload())},k=async()=>{var f,A,J;g.value=!0;try{const Y=await te.post("/api/smartir/refresh-index");Y.data.success?(f=u.value)==null||f.success(`Updated to v${Y.data.version} (${Y.data.total_devices} devices)`,"âœ… Index Updated"):(A=u.value)==null||A.error(Y.data.error||"Unknown error","âŒ Update Failed")}catch(Y){console.error("Error updating SmartIR index:",Y),(J=u.value)==null||J.error("Failed to update device index","âŒ Update Error")}finally{g.value=!1,d.value=!1}};return xe(async()=>{const f=localStorage.getItem("theme");f&&["light","medium","dark"].includes(f)?($.value=f,f==="medium"?document.body.classList.add("medium-mode"):f==="dark"&&document.body.classList.add("dark-mode")):localStorage.getItem("darkMode")==="true"&&($.value="dark",document.body.classList.add("dark-mode"),localStorage.setItem("theme","dark")),await P();const A=nt();A&&u.value&&(A.appContext.config.globalProperties.$toast=u.value),document.addEventListener("click",_)}),We(()=>{document.removeEventListener("click",_)}),Xe("smartirStatus",w),Xe("smartirEnabled",D),Xe("refreshSmartIR",P),Xe("toast",u),(f,A)=>(n(),i("div",Pc,[e("header",Vc,[e("div",Uc,[A[13]||(A[13]=e("div",{class:"header-left"},[e("i",{class:"mdi mdi-remote"}),e("h1",null,"Broadlink Manager v2"),e("span",{class:"beta-badge"},"BETA")],-1)),e("div",jc,[e("button",{onClick:o,class:"icon-button",title:h.value},[e("i",{class:W(O.value)},null,2)],8,Fc),e("div",Nc,[e("button",{onClick:A[0]||(A[0]=J=>d.value=!d.value),class:"icon-button",title:"Settings"},[...A[2]||(A[2]=[e("i",{class:"mdi mdi-cog"},null,-1)])]),d.value?(n(),i("div",Bc,[A[9]||(A[9]=e("div",{class:"menu-section-title"},"Integration Settings",-1)),e("div",{class:W(["menu-item toggle-item",{disabled:!S.value}]),onClick:A[1]||(A[1]=J=>S.value?s():null),title:S.value?"":"SmartIR is not installed"},[e("div",qc,[A[3]||(A[3]=e("i",{class:"mdi mdi-air-conditioner"},null,-1)),A[4]||(A[4]=e("span",null,"SmartIR Integration",-1)),S.value?R("",!0):(n(),i("span",zc,"(Not Installed)"))]),e("div",{class:W(["toggle-switch",{active:D.value&&S.value,disabled:!S.value}])},[...A[5]||(A[5]=[e("div",{class:"toggle-slider"},null,-1)])],2)],10,Hc),D.value?(n(),i("a",Jc,[...A[6]||(A[6]=[e("i",{class:"mdi mdi-github"},null,-1),e("span",null,"SmartIR on GitHub",-1)])])):R("",!0),D.value?(n(),i("button",{key:1,onClick:k,class:"menu-item menu-subitem",disabled:g.value},[e("i",{class:W(["mdi",g.value?"mdi-loading mdi-spin":"mdi-refresh"])},null,2),e("span",null,p(g.value?"Updating...":"Update Device Index"),1)],8,Wc)):R("",!0),A[10]||(A[10]=e("div",{class:"menu-divider"},null,-1)),A[11]||(A[11]=e("div",{class:"menu-section-title"},"Diagnostics",-1)),e("button",{onClick:F,class:"menu-item",disabled:v.value},[...A[7]||(A[7]=[e("i",{class:"mdi mdi-content-copy"},null,-1),e("span",null,"Copy Diagnostics",-1)])],8,Gc),e("button",{onClick:U,class:"menu-item",disabled:v.value},[...A[8]||(A[8]=[e("i",{class:"mdi mdi-download"},null,-1),e("span",null,"Download Diagnostics",-1)])],8,Kc),A[12]||(A[12]=He('<div class="menu-divider" data-v-96564cf9></div><div class="menu-section-title" data-v-96564cf9>Help &amp; Support</div><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2#readme" target="_blank" class="menu-item menu-link" data-v-96564cf9><i class="mdi mdi-book-open-variant" data-v-96564cf9></i><span data-v-96564cf9>Documentation</span></a><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2/issues" target="_blank" class="menu-item menu-link" data-v-96564cf9><i class="mdi mdi-bug" data-v-96564cf9></i><span data-v-96564cf9>Report Issue</span></a><div class="menu-divider" data-v-96564cf9></div><div class="menu-section-title" data-v-96564cf9>Community</div><a href="https://community.home-assistant.io/t/broadlink-manager-modern-web-interface-for-broadlink-devices/938473" target="_blank" class="menu-item menu-link" data-v-96564cf9><i class="mdi mdi-forum" data-v-96564cf9></i><span data-v-96564cf9>HA Forum Discussion</span></a><a href="https://www.reddit.com/r/homeassistant/comments/1o1q3kf/release_broadlink_manager_addon_a_modern_web_ui/" target="_blank" class="menu-item menu-link" data-v-96564cf9><i class="mdi mdi-reddit" data-v-96564cf9></i><span data-v-96564cf9>Reddit Discussion</span></a><div class="menu-divider" data-v-96564cf9></div><div class="menu-section-title" data-v-96564cf9>Project</div><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2" target="_blank" class="menu-item menu-link" data-v-96564cf9><i class="mdi mdi-github" data-v-96564cf9></i><span data-v-96564cf9>GitHub Repository</span></a><a href="https://ko-fi.com/tonyperkins" target="_blank" class="menu-item menu-link menu-item-sponsor" data-v-96564cf9><i class="mdi mdi-coffee" data-v-96564cf9></i><span data-v-96564cf9>Support on Ko-fi</span></a>',12))])):R("",!0)])])])]),e("main",Xc,[ge(Sc)]),e("footer",Yc,[e("p",null,"Broadlink Manager v"+p(_e(r))+" | Built with Vue "+p(yt),1)]),ge(Ac,{ref_key:"toastRef",ref:u},null,512)]))}},Qc=$e(Zc,[["__scopeId","data-v-96564cf9"]]),ct=bt(Qc),em=ht();ct.use(em);ct.mount("#app");
