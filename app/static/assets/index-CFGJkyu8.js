import{g as He,a as et,d as tt,c as J,r as y,o as xe,b as a,e as n,f as e,h as T,n as Z,u as _e,t as u,i as S,F as me,j as be,w as de,k as W,v as Ie,l as pe,m as ze,p as fe,q as Ve,s as Fe,T as Je,x as ke,y as Se,z as Le,A as ve,B as We,C as Pe,D as Te,E as Ke,G as Xe,H as ot,I as lt,J as nt,K as Ue,L as st,M as at}from"./vendor-DHe6d6Ka.js";(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const w of document.querySelectorAll('link[rel="modulepreload"]'))k(w);new MutationObserver(w=>{for(const s of w)if(s.type==="childList")for(const m of s.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&k(m)}).observe(document,{childList:!0,subtree:!0});function r(w){const s={};return w.integrity&&(s.integrity=w.integrity),w.referrerPolicy&&(s.referrerPolicy=w.referrerPolicy),w.crossOrigin==="use-credentials"?s.credentials="include":w.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function k(w){if(w.ep)return;w.ep=!0;const s=r(w);fetch(w.href,s)}})();let qe=!1;function Ee(){const o=He(),c=o==null?void 0:o.appContext.config.globalProperties.$toast;return c||(qe||(console.warn("Toast notification system not yet initialized - using console fallback"),qe=!0),{success:r=>console.log("âœ“",r),error:r=>console.error("âœ—",r),warning:r=>console.warn("âš ",r),info:r=>console.info("â„¹",r)})}const Ne="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAHBUlEQVR4nOxZC1BTVxo+9+aNZI2LNsgjWR4hgoIiRVDBslKnIKPbx1jqTrtYoakat1a6dNsdd7t1X8XHyAbEhdUu1u2mXdbasqJbtsaMIqBBECiPBmqEICEBEx4xJLlJ7s6lw6rJDeQ2FzLM+M1kBs7/3+/83zn/Oee/51JRFAXzGbCvA/AWjwX4GvNeANWXnXffHQ4+K6/dYbHeD+IFhjRkb1wn9WPQbEQ4IF/tQlXX2p5+/8OyczY74j/VxuMG3Sh/Oz9jaQDb4CmPT1LIbLXBfzrz0cmHg8fQpx1Yc1Ra+TsiXD4R0PqtRmAyj/LxbJeaujKIcPlEAINOM7vLXBaTZibCRWgRq3WGJZWX63aoNDpB8BJOX/bGlIqwpUv6iXBgWBHG7eUF8urUWvU6Z9sLGxI/IsLl8SJu6u4XigqPXkVspiVTbTQqU1/6Vn7ammh+G5FOMZyqludIKqUVU/9jcaSuTCo/unfHbiad4iBdwMu/P1bV1tO1xbk9NDC0/vwHB1xGcjqYLAh16zsHW3R6XXTu1mfFdAqMrIoSKNbGhLcQ4QGeppDJ7ACtPcqNEI6tT9O3Vqm+tygqNMDjrU9Sef6tIYM2JjUuuXzfC5knCEXsBI8WMZUCAxiCrfhWyMZkMNzYXNHVpwmXXqp5j0Hz0/1m57a3PQ8VHx4JoNMASIl9shLPFsB5ooO7iDXhCY/dAcCvT/79LwC1s/K2bDnAXcQeJRqwMzzeRt/bua0gLChcDsCDNQNBkEU/qot7o6j0kzETQpuJ40ZnT6xSrUoNWhyseHVz2ikv4n4QA5FSArE5IFlTZ0r3XU1MWODib6NCl3a9dkhSYxgbjo4XLq8sL9j7Ip36YEwMRjMNQazMhf7+RgYNnuyo7bY6ArFaWKuXRX495wLwoLk39sO9RaVnM5OTP8zLSjtjsljpp6ovi6pqr706eE8XBwGUSqEy9Guihf/92TMZhetjI5rJCHwKpBRzZqsNYtKp6KD+Pvv1w5ILdzR3UvD8HA4YefOl7N25JKUPIKuUwIJH7A5of/GJf7oLfrIz2EH786fSss+uKFzOk+8L0mqh6rpbmR0q5YyFGAQBSuHHlcUWxEaZyXfMhFD0Rgt9Oh/SBMiam58HAO+oc4XZMsK/1taT6M6uHjJw8w6VSNfvemM8TbzPlFlwsP5KyzfJeL6kCejXDgo894aASqOZ9O/uHwzq6B3ijhitkzOC7XS7j0g+V3S0vQTDDhYEoZSBobvJ+yXFNZ29gy4lOGmvlDBMIfQqSKV8539EWvXHhvbGHBSFrAwGW+vvxzLoR7RxzrNpsyPs0xcv7/lg1/ZfPtKvuw7MVhulUakWdvRq+XY3tWFT90Bk+52BCOzvyOBgjytSFKAgms+b9F/2o+BbKwUrvgjhhjSjKLAPG4YE7lJxfEIf5dyGOwMXrren/eF0RYXRNMrHDt4QbmjDEbHop9F8rqpddZd3sV6R/aWiabtWr41PW534V8m+PFHW+qSPL9TX7oM8WAaBi4IbE4S8yYNs/7asIgBA0ZStRqFM/MXxIzcgHBEBP+C6DJKLgJvK3uXvniitBsDmNzkSEAD9uv5k0aFjXy1gMQ0DQ5p4CAIwNuXLwyL/ExcpqMWeS42NUmxKXFf8VWPdz6cLnkqhGd/Pe+U1Cow/+ekJUYr4qJgvbik7f/Jw+0J/tjpvS3qxs7/LQZZfcrrkUmOdGI/cgUKIkB8pz0xK+CQjKf6z4MWckYftZqsderfsTInsZt0evDRgMRYMHhaLnk+NW1Y/nchxk5lZ+I/Pf/vl9RvbLYiVlSBcJv/VK9sKBCHc3hkF7D12/NzVltZn8YhzNj/3ev6LGeXTdQ6+uzLZ+C+5XNza05Nsd1gXcNgBvekJK/+du3lTUSiXMzzT80TgkkK8wJAGgCMAE5ooFFz3hHTr+lgZ9iMryOngkoi5WZuOc9hPtDu3r4198nTqygjCr3wYmrvVkSerZXljJoT0m0DcYm5g2Mg5WV39zrVWZZofkzaRnhB/bufm9FI/JpXQXj8F8bHyitqWxhzJmwUJT60SNJER+P+BCZjt34lzNbvickRoWVWNmGzuObnYWhER3oAdX41dPbj1jDeYEwGrInltKKCNtatub6hRfJOEnfJkcc+JgE9ltS/DkINuNI3xCo4fbXgm/0CnouvOcjK4Z/16/ZKia+3+kqIrEIQ+sgNx2Jzb5wsPxrD9GBZv+Gd9BqSXr4icg8cwMj4SLmv6+mlv+WddgGlilOPOZkEmFnrLP+sCVgtXyPHaHShkiw0XXPWWf9YF5Gb9uGzp4sCbj7ai4LkNTx2O5nPV3vLPyTeye6P32X+7KNujVKtSYJg+viEu/mx2etJZCgnD57OPfGRh3n8nfizA15j3Av4XAAD//5k1S2w3zfwVAAAAAElFTkSuQmCC",oe=et.create({baseURL:"./",timeout:3e4,headers:{"Content-Type":"application/json"}});oe.interceptors.request.use(o=>o,o=>Promise.reject(o));oe.interceptors.response.use(o=>o,o=>(console.error("API Error:",o),o.response?console.error("Response error:",o.response.data):o.request?console.error("No response received"):console.error("Request setup error:",o.message),Promise.reject(o)));const it=tt("devices",{state:()=>({devices:[],loading:!1,error:null,selectedDevice:null}),getters:{deviceById:o=>c=>o.devices.find(r=>r.id===c),devicesByType:o=>c=>o.devices.filter(r=>r.entity_type===c),deviceCount:o=>o.devices.length,hasDevices:o=>o.devices.length>0},actions:{async loadDevices(o=!1){this.loading=!0,this.error=null;try{const c=o?`/api/devices/managed?_t=${Date.now()}`:"/api/devices/managed",r=await oe.get(c);this.devices=r.data.devices||[],console.log("ðŸ“¥ Loaded devices:",this.devices),this.devices.forEach(k=>{console.log(`ðŸ“¥ Device "${k.name}":`,{id:k.id,device:k.device,commands:k.commands,commandCount:k.commands?Object.keys(k.commands).length:0})})}catch(c){this.error=c.message,console.error("Error loading devices:",c)}finally{this.loading=!1}},async createDevice(o){this.loading=!0,this.error=null;try{console.log("ðŸª Store: Creating device with data:",o),console.log("ðŸª Store: Device commands being sent:",o.commands);const c={device_name:o.name,device:o.device,area_id:o.area||"",area_name:o.area||"",entity_type:o.entity_type,icon:o.icon,broadlink_entity:o.broadlink_entity,device_type:o.device_type||"broadlink",commands:o.commands||{}};o.device_type==="smartir"&&o.smartir_config&&(c.smartir_config=o.smartir_config),console.log("ðŸª Store: Transformed data for backend:",c);const r=await oe.post("/api/devices/managed",c);return console.log("ðŸª Store: Create response:",r.data),await this.loadDevices(),r.data}catch(c){throw console.error("Error creating device:",c),c}finally{this.loading=!1}},async updateDevice(o,c){this.loading=!0,this.error=null;try{const r=await oe.put(`/api/devices/managed/${o}`,c);return await this.loadDevices(),r.data}catch(r){throw console.error("Error updating device:",r),r}finally{this.loading=!1}},async deleteDevice(o,c=!1){this.loading=!0,this.error=null;try{await oe.delete(`/api/devices/managed/${o}`,{data:{delete_commands:c}}),this.devices=this.devices.filter(r=>r.id!==o)}catch(r){throw this.error=r.message,console.error("Error deleting device:",r),r}finally{this.loading=!1}},selectDevice(o){this.selectedDevice=o},clearSelection(){this.selectedDevice=null},clearError(){this.error=null},async syncAllAreas(){if(!this.devices||this.devices.length===0){console.log("âš ï¸ No devices to sync");return}console.log(`ðŸ”„ Syncing areas from Home Assistant for ${this.devices.length} devices...`);try{const o=await Promise.all(this.devices.map(k=>(console.log(`ðŸ”„ Syncing device: ${k.id} (${k.name})`),oe.post(`/api/devices/${k.id}/sync-area`).then(w=>w.data.success&&w.data.area?(console.log(`âœ… Synced area for ${k.name}: ${w.data.area}`),{status:"synced",device:k.name}):{status:"no_area"}).catch(w=>{var s;return((s=w.response)==null?void 0:s.status)===404?(console.log(`âŒ Device not found in HA: ${k.id}`),{status:"not_found"}):(console.warn(`âš ï¸ Failed to sync area for ${k.id}:`,w.message),{status:"error",error:w.message})})))),c=o.filter(k=>k.status==="synced").length,r=o.filter(k=>k.status==="not_found").length;await this.loadDevices(!0),c>0?console.log(`âœ… Area sync complete: ${c} synced, ${r} not found in HA`):r>0&&console.log(`â„¹ï¸ No areas synced - ${r} entities not found in HA registry (generate entities first)`)}catch(o){console.debug("Area sync error:",o)}}}});function Ge(o){const c=J(()=>o.value||o),r=J(()=>{switch(c.value){case"climate":return"mdi:air-conditioner";case"fan":return"mdi:fan";case"light":return"mdi:lightbulb";case"media_player":return"mdi:television";case"switch":return"mdi:light-switch";default:return"mdi:devices"}}),k=J(()=>`device-type-${c.value}-color`),w=J(()=>`tag-${c.value}-bg`);return{icon:r,colorClass:k,tagBgClass:w}}const rt=""+new URL("broadlink-logo-BDjImjRY.png",import.meta.url).href,he=(o,c)=>{const r=o.__vccOpts||o;for(const[k,w]of c)r[k]=w;return r},dt={class:"device-header"},ut={class:"device-info"},ct=["title"],mt={class:"device-labels"},vt={class:"device-type"},pt=["src","alt","title"],ft={class:"device-body"},gt={class:"device-stats"},yt={class:"stat",title:"Learned command count"},bt={class:"stat",title:"HA Assigned Area"},ht={class:"device-meta"},kt={class:"device-id",title:"Device ID"},wt={key:0,class:"storage-name"},$t={key:1,class:"broadlink-entity",title:"Controller Device"},Ct={key:2,class:"controller-device"},_t={class:"device-actions"},St=["disabled"],It=["disabled"],Dt=["disabled"],xt={key:0,class:"disabled-overlay"},Tt={__name:"DeviceCard",props:{device:{type:Object,required:!0},broadlinkDevices:{type:Array,default:()=>[]}},emits:["edit","delete","learn"],setup(o){const c=o,r=J(()=>localStorage.getItem("smartir_simulate_not_installed")==="true"),k=J(()=>c.device.device_type==="smartir"&&r.value),w=y(null),s=Ge(J(()=>c.device.entity_type)),m=J(()=>c.device.icon?c.device.icon:s.icon.value),v=i=>i&&i.startsWith("mdi:")?`mdi ${i.replace(":"," mdi-")}`:`mdi mdi-${i}`,_=J(()=>({light:"Light",fan:"Fan",switch:"Switch",media_player:"Media Player",cover:"Cover"})[c.device.entity_type]||c.device.entity_type),I=J(()=>(c.device.device_type||"broadlink")==="smartir"?"SmartIR":"Broadlink"),V=J(()=>(c.device.device_type||"broadlink")==="smartir"?Ne:rt),b=J(()=>(c.device.device_type||"broadlink")==="smartir"?w.value!==null?w.value:0:Object.keys(c.device.commands||{}).length),t=i=>{if(!i)return"";const g=c.broadlinkDevices.find(p=>p.entity_id===i);return g&&g.name||i},L=J(()=>{if(!c.device.device)return!1;const i=c.device.id.includes(".")?c.device.id.split(".")[1]:c.device.id;return c.device.device!==i}),q=J(()=>{if(!c.device.broadlink_entity)return"";const i=c.broadlinkDevices.find(g=>g.entity_id===c.device.broadlink_entity);return i&&i.name||c.device.broadlink_entity}),U=i=>{if(!i||typeof i!="object")return 0;let g=0;for(const p of Object.values(i))typeof p=="string"?g++:typeof p=="object"&&(g+=U(p));return g},M=async()=>{if(!(!c.device.device_code||!c.device.entity_type))try{const i=await oe.get("/api/smartir/codes/code",{params:{entity_type:c.device.entity_type,code_id:c.device.device_code}});if(i.data.success&&i.data.code){const g=i.data.code;g.commands&&(w.value=U(g.commands))}}catch(i){console.error("Error fetching SmartIR command count:",i)}};return xe(async()=>{(c.device.device_type||"broadlink")==="smartir"&&await M()}),(i,g)=>(n(),a("div",{class:Z(["device-card",{disabled:k.value}])},[e("div",dt,[e("div",{class:Z(["device-icon",_e(s).colorClass.value])},[e("i",{class:Z(v(m.value))},null,2)],2),e("div",ut,[e("h3",{title:o.device.name},u(o.device.name),9,ct),e("div",mt,[e("span",vt,u(_.value),1)])]),e("img",{src:V.value,alt:I.value,title:I.value,class:"device-source-logo"},null,8,pt)]),e("div",ft,[e("div",gt,[e("div",yt,[g[3]||(g[3]=e("i",{class:"mdi mdi-remote"},null,-1)),e("span",null,u(b.value)+" command"+u(b.value!==1?"s":""),1)]),e("div",bt,[g[4]||(g[4]=e("i",{class:"mdi mdi-map-marker"},null,-1)),e("span",null,u(o.device.area||"No area"),1)])]),e("div",ht,[e("span",kt,[g[5]||(g[5]=e("i",{class:"mdi mdi-identifier"},null,-1)),S(" "+u(o.device.id),1)]),L.value?(n(),a("span",wt,[g[6]||(g[6]=e("i",{class:"mdi mdi-code-tags"},null,-1)),S(" "+u(o.device.device),1)])):T("",!0),o.device.broadlink_entity?(n(),a("span",$t,[g[7]||(g[7]=e("i",{class:"mdi mdi-access-point"},null,-1)),S(" "+u(q.value),1)])):T("",!0),o.device.controller_device?(n(),a("span",Ct,[g[8]||(g[8]=e("i",{class:"mdi mdi-access-point"},null,-1)),S(" "+u(t(o.device.controller_device)),1)])):T("",!0)])]),e("div",_t,[e("button",{onClick:g[0]||(g[0]=p=>!k.value&&i.$emit("learn",o.device)),class:"icon-btn",title:"Manage Commands",disabled:k.value},[...g[9]||(g[9]=[e("i",{class:"mdi mdi-remote-tv"},null,-1)])],8,St),e("button",{onClick:g[1]||(g[1]=p=>!k.value&&i.$emit("edit",o.device)),class:"icon-btn",title:"Edit",disabled:k.value},[...g[10]||(g[10]=[e("i",{class:"mdi mdi-pencil"},null,-1)])],8,It),e("button",{onClick:g[2]||(g[2]=p=>!k.value&&i.$emit("delete",o.device)),class:"icon-btn danger",title:"Delete",disabled:k.value},[...g[11]||(g[11]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,Dt)]),k.value?(n(),a("div",xt,[...g[12]||(g[12]=[e("div",{class:"disabled-message"},[e("i",{class:"mdi mdi-eye-off"}),e("span",null,"SmartIR Not Installed")],-1)])])):T("",!0)],2))}},Rt=he(Tt,[["__scopeId","data-v-7a7f5c18"]]),Mt={name:"DeviceListView",props:{devices:{type:Array,required:!0}},methods:{getDeviceCommands(o){return o.commands&&typeof o.commands=="object"?Object.keys(o.commands):[]},sendCommand(o,c){this.$emit("send-command",{device:o,command:c})},editDevice(o){this.$emit("edit-device",o)},deleteDevice(o){this.$emit("delete-device",o)}}},At={class:"device-list-view"},Lt={class:"device-table"},Ot={class:"device-info"},Et={class:"device-name"},Vt={class:"device-entity"},Ut={class:"device-area"},Pt={class:"device-type"},jt={class:"device-commands"},Ft={key:0,class:"command-list"},Nt=["onClick"],Bt={key:0,class:"no-commands"},qt={key:1,class:"smartir-info"},Ht={class:"profile-code"},zt={class:"device-actions"},Jt=["onClick"],Wt=["onClick"];function Kt(o,c,r,k,w,s){return n(),a("div",At,[e("table",Lt,[c[2]||(c[2]=e("thead",null,[e("tr",null,[e("th",null,"Device"),e("th",null,"Room/Area"),e("th",null,"Type"),e("th",null,"Commands"),e("th",null,"Actions")])],-1)),e("tbody",null,[(n(!0),a(me,null,be(r.devices,m=>(n(),a("tr",{key:m.entity_id,class:"device-row"},[e("td",Ot,[e("div",Et,u(m.friendly_name||m.name),1),e("div",Vt,u(m.entity_id),1)]),e("td",Ut,u(m.area||"No Area"),1),e("td",Pt,[e("span",{class:Z(["type-badge",m.device_type])},u(m.device_type==="smartir"?"SmartIR":"Broadlink"),3)]),e("td",jt,[m.device_type==="broadlink"?(n(),a("div",Ft,[(n(!0),a(me,null,be(s.getDeviceCommands(m),v=>(n(),a("button",{key:v,class:"command-btn",onClick:_=>s.sendCommand(m,v)},u(v),9,Nt))),128)),s.getDeviceCommands(m).length===0?(n(),a("span",Bt," No commands ")):T("",!0)])):m.device_type==="smartir"?(n(),a("div",qt,[e("span",Ht,"Profile: "+u(m.device_code),1)])):T("",!0)]),e("td",zt,[e("button",{class:"action-btn edit",onClick:v=>s.editDevice(m),title:"Edit"},[...c[0]||(c[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})],-1)])],8,Jt),e("button",{class:"action-btn delete",onClick:v=>s.deleteDevice(m),title:"Delete"},[...c[1]||(c[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"3 6 5 6 21 6"}),e("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})],-1)])],8,Wt)])]))),128))])])])}const Xt=he(Mt,[["render",Kt],["__scopeId","data-v-34e538b4"]]),Gt={class:"icon-picker"},Yt={class:"icon-input-wrapper"},Zt=["id","placeholder"],Qt={key:0,class:"icon-preview"},eo={key:0,class:"icon-dropdown"},to={class:"icon-grid"},oo=["onMousedown","title"],lo={__name:"IconPicker",props:{modelValue:{type:String,default:""},inputId:{type:String,default:"icon-input"},placeholder:{type:String,default:"e.g., mdi:television"}},emits:["update:modelValue"],setup(o,{emit:c}){const r=o,k=c,w=y(r.modelValue),s=y(!1),m=["television","speaker","radio","music","video","movie","play","pause","stop","skip-next","skip-previous","volume-high","volume-medium","volume-low","volume-off","remote","remote-tv","cast","chromecast","spotify","netflix","youtube","lightbulb","lightbulb-on","lightbulb-off","lamp","floor-lamp","ceiling-light","light-switch","led-strip","led-strip-variant","wall-sconce","chandelier","spotlight","track-light","vanity-light","desk-lamp","fan","ceiling-fan","air-conditioner","thermometer","thermostat","heat-wave","snowflake","fire","radiator","water-boiler","hvac","blinds","blinds-open","window-shutter","window-shutter-open","curtains","curtains-closed","roller-shade","roller-shade-closed","garage","garage-open","gate","door","door-open","window-open","window-closed","washing-machine","tumble-dryer","dishwasher","refrigerator","stove","microwave","oven","toaster","kettle","coffee","coffee-maker","blender","robot-vacuum","robot-vacuum-variant","vacuum","broom","spray-bottle","lock","lock-open","lock-smart","key","shield","shield-check","alarm-light","bell","doorbell","camera","cctv","motion-sensor","smoke-detector","fire-extinguisher","water-alert","gas-cylinder","sofa","bed","bed-double","desk","chair","table","bookshelf","home","home-outline","home-assistant","floor-plan","room","weather-sunny","weather-night","weather-cloudy","weather-rainy","weather-snowy","weather-lightning","weather-windy","weather-fog","weather-partly-cloudy","umbrella","water","water-percent","phone","cellphone","tablet","laptop","desktop-tower","monitor","keyboard","mouse","printer","router","router-wireless","access-point","wifi","bluetooth","usb","hdmi-port","ethernet","power","power-plug","power-socket","battery","battery-charging","lightning-bolt","flash","solar-panel","solar-power","leaf","tree","flower","sprout","grass","watering-can","shovel","fence","pool","hot-tub","silverware","silverware-fork-knife","food","food-apple","glass-wine","glass-cocktail","bottle-wine","pot","pot-steam","shower","shower-head","bathtub","toilet","sink","faucet","hand-wash","car","car-side","garage-variant","tools","hammer","wrench","screwdriver","toolbox","ladder","heart","heart-pulse","run","walk","bike","dumbbell","yoga","scale-bathroom","thermometer-lines","clock","clock-outline","timer","alarm","calendar","calendar-today","calendar-clock","history","bell-ring","bell-alert","alert","alert-circle","information","help-circle","check","check-circle","close-circle","minus-circle","plus-circle","arrow-up","arrow-down","arrow-left","arrow-right","chevron-up","chevron-down","menu","dots-vertical","dots-horizontal","cog","tune","circle","square","triangle","hexagon","star","star-outline","heart-outline","plus","minus","close","check-bold","eye","eye-off","account","account-group","baby","dog","cat","paw","gift","balloon","party-popper","candle","book","book-open","newspaper","email","message","phone-classic"];de(()=>r.modelValue,b=>{w.value=b});const v=J(()=>{if(!w.value)return m.slice(0,50);const b=w.value.toLowerCase().replace("mdi:","");return m.filter(t=>t.toLowerCase().includes(b)).slice(0,50)}),_=()=>{s.value=!0,k("update:modelValue",w.value)},I=()=>{setTimeout(()=>{s.value=!1},200)},V=b=>{w.value=`mdi:${b}`,k("update:modelValue",w.value),s.value=!1};return(b,t)=>(n(),a("div",Gt,[e("div",Yt,[W(e("input",{id:o.inputId,"onUpdate:modelValue":t[0]||(t[0]=L=>w.value=L),type:"text",placeholder:o.placeholder,onInput:_,onFocus:t[1]||(t[1]=L=>s.value=!0),onBlur:I},null,40,Zt),[[Ie,w.value]]),w.value?(n(),a("div",Qt,[e("i",{class:Z(`mdi mdi-${w.value.replace("mdi:","")}`)},null,2)])):T("",!0)]),s.value&&v.value.length>0?(n(),a("div",eo,[e("div",to,[(n(!0),a(me,null,be(v.value,L=>(n(),a("div",{key:L,class:"icon-option",onMousedown:pe(q=>V(L),["prevent"]),title:L},[e("i",{class:Z(`mdi mdi-${L}`)},null,2),e("span",null,u(L),1)],40,oo))),128))])])):T("",!0)]))}},no=he(lo,[["__scopeId","data-v-a64f5011"]]),so={key:0,class:"dropdown-label"},ao={key:0,class:"required"},io=["placeholder","disabled","onKeydown"],ro={class:"dropdown-icons"},uo={key:0,class:"mdi mdi-loading mdi-spin"},co={key:2,class:"mdi mdi-chevron-down"},mo={key:1,class:"error-message"},vo={key:2,class:"hint-message"},po={key:0,class:"dropdown-menu"},fo=["onMousedown","onMouseenter"],go={class:"option-content"},yo={class:"option-label"},bo={key:0,class:"option-description"},ho={key:0,class:"mdi mdi-check selected-icon"},ko={key:3,class:"dropdown-menu"},wo={__name:"SearchableDropdown",props:{modelValue:{type:[String,Number,Object],default:null},options:{type:Array,required:!0,default:()=>[]},label:{type:String,default:""},placeholder:{type:String,default:"Search..."},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},error:{type:String,default:""},hint:{type:String,default:""},optionLabel:{type:String,default:"label"},optionValue:{type:String,default:"value"},optionDescription:{type:String,default:"description"},filterMethod:{type:Function,default:null}},emits:["update:modelValue","change","search"],setup(o,{emit:c}){const r=o,k=c,w=y(null),s=y(null),m=y(""),v=y(!1),_=y(0),I=y(!1),V=A=>typeof A=="string"||typeof A=="number"?A:A[r.optionLabel]||A.label||A.name||String(A),b=A=>typeof A=="string"||typeof A=="number"?A:A[r.optionValue]||A.value||A.id||A,t=A=>typeof A=="string"||typeof A=="number"?"":A[r.optionDescription]||A.description||"",L=A=>{const N=b(A);return typeof r.modelValue=="object"?b(r.modelValue)===N:r.modelValue===N},q=J(()=>{if(!m.value)return r.options;if(r.filterMethod)return r.options.filter(N=>r.filterMethod(N,m.value));const A=m.value.toLowerCase();return r.options.filter(N=>{const Q=V(N).toLowerCase(),ue=t(N).toLowerCase();return Q.includes(A)||ue.includes(A)})}),U=J(()=>{if(!r.modelValue)return"";const A=r.options.find(N=>{const Q=b(N);return typeof r.modelValue=="object"?Q===b(r.modelValue):Q===r.modelValue});return A?V(A):""});de(()=>r.modelValue,A=>{I.value||(m.value=U.value)}),de(()=>r.options,()=>{!I.value&&r.modelValue&&(m.value=U.value)},{deep:!0}),de(m,A=>{k("search",A),_.value=0}),xe(()=>{m.value=U.value});const M=()=>{var A;I.value=!0,v.value=!0,(A=s.value)==null||A.select()},i=()=>{I.value=!1,setTimeout(()=>{v.value=!1,r.modelValue?m.value=U.value:m.value=""},200)},g=()=>{var A;v.value=!1,(A=s.value)==null||A.blur()},p=A=>{const N=b(A);k("update:modelValue",N),k("change",N,A),m.value=V(A),g()},R=()=>{var A;k("update:modelValue",null),k("change",null,null),m.value="",(A=s.value)==null||A.focus()},X=()=>{if(!v.value){v.value=!0;return}_.value<q.value.length-1&&_.value++},te=()=>{_.value>0&&_.value--},le=()=>{q.value.length>0&&_.value>=0&&p(q.value[_.value])},ae=A=>{w.value&&!w.value.contains(A.target)&&(v.value=!1,r.modelValue?m.value=U.value:m.value="")};return xe(()=>{document.addEventListener("click",ae)}),ze(()=>{document.removeEventListener("click",ae)}),(A,N)=>(n(),a("div",{class:"searchable-dropdown",ref_key:"dropdownRef",ref:w},[o.label?(n(),a("label",so,[S(u(o.label)+" ",1),o.required?(n(),a("span",ao,"*")):T("",!0)])):T("",!0),e("div",{class:Z(["dropdown-input-wrapper",{"has-error":o.error,disabled:o.disabled}])},[W(e("input",{ref_key:"inputRef",ref:s,type:"text","onUpdate:modelValue":N[0]||(N[0]=Q=>m.value=Q),placeholder:o.placeholder,disabled:o.disabled||o.loading,onFocus:M,onBlur:i,onKeydown:[Ve(pe(X,["prevent"]),["down"]),Ve(pe(te,["prevent"]),["up"]),Ve(pe(le,["prevent"]),["enter"]),Ve(g,["escape"])],class:"dropdown-input"},null,40,io),[[Ie,m.value]]),e("div",ro,[o.loading?(n(),a("i",uo)):o.modelValue&&!o.disabled?(n(),a("i",{key:1,class:"mdi mdi-close-circle clear-icon",onClick:R})):(n(),a("i",co))])],2),o.error?(n(),a("div",mo,u(o.error),1)):T("",!0),o.hint&&!o.error?(n(),a("div",vo,u(o.hint),1)):T("",!0),fe(Je,{name:"dropdown"},{default:Fe(()=>[v.value&&q.value.length>0?(n(),a("div",po,[(n(!0),a(me,null,be(q.value,(Q,ue)=>(n(),a("div",{key:b(Q),class:Z(["dropdown-item",{highlighted:ue===_.value,selected:L(Q)}]),onMousedown:pe(ye=>p(Q),["prevent"]),onMouseenter:ye=>_.value=ue},[e("div",go,[e("div",yo,u(V(Q)),1),t(Q)?(n(),a("div",bo,u(t(Q)),1)):T("",!0)]),L(Q)?(n(),a("i",ho)):T("",!0)],42,fo))),128))])):T("",!0)]),_:1}),v.value&&q.value.length===0&&!o.loading?(n(),a("div",ko,[...N[1]||(N[1]=[e("div",{class:"dropdown-item no-results"},[e("i",{class:"mdi mdi-magnify"}),S(" No results found ")],-1)])])):T("",!0)],512))}},je=he(wo,[["__scopeId","data-v-679ce35f"]]),$o={class:"smartir-selector"},Co={class:"form-group"},_o={class:"form-group"},So={class:"form-group"},Io=["value"],Do={key:0,class:"error-message"},xo={class:"form-group"},To={class:"form-group"},Ro={key:1,class:"code-info"},Mo={class:"info-content"},Ao={class:"info-row"},Lo={class:"info-value"},Oo={class:"info-row"},Eo={class:"info-value"},Vo={key:0,class:"info-row"},Uo={class:"info-value"},Po={class:"info-row"},jo={class:"info-value"},Fo={__name:"SmartIRDeviceSelector",props:{entityType:{type:String,required:!0},modelValue:{type:Object,default:()=>({})},broadlinkDevices:{type:Array,default:()=>[]}},emits:["update:modelValue","change"],setup(o,{expose:c,emit:r}){const k=o,w=r,s=y([]),m=y([]),v=y(""),_=y(""),I=y(""),V=y(""),b=y(""),t=y(null),L=y(!1),q=y(!1),U=y({manufacturer:"",model:"",controller:""});xe(async()=>{if(await M(),k.modelValue&&(v.value=k.modelValue.manufacturer||"",_.value=k.modelValue.device_code||"",I.value=k.modelValue.controller_device||"",V.value=k.modelValue.temperature_sensor||"",b.value=k.modelValue.humidity_sensor||"",v.value&&(await i(v.value),_.value&&m.value.length>0))){const A=m.value.find(N=>N.code===_.value);A&&(t.value={code:A.code,manufacturer:v.value,models:A.models,controller:A.controller})}}),de(()=>k.entityType,async A=>{A&&(v.value="",_.value="",m.value=[],t.value=null,await M())});const M=async()=>{if(k.entityType){L.value=!0,U.value.manufacturer="";try{const A=await oe.get("/api/smartir/codes/manufacturers",{params:{entity_type:k.entityType}});if(A.data.success)s.value=A.data.manufacturers||[];else throw new Error(A.data.error||"Failed to load manufacturers")}catch(A){console.error("Error loading manufacturers:",A),U.value.manufacturer="Failed to load manufacturers. Please try again.",s.value=[]}finally{L.value=!1}}},i=async A=>{if(!(!A||!k.entityType)){q.value=!0,U.value.model="";try{const N=await oe.get("/api/smartir/codes/models",{params:{entity_type:k.entityType,manufacturer:A}});if(N.data.success){const Q=N.data.models||[];m.value=Q.map(ue=>{const ye=ue.models&&ue.models.length>0?ue.models.join(", "):`Code ${ue.code}`;return{code:ue.code,label:ye,description:`Code: ${ue.code}`,models:ue.models,controller:ue.controller}})}else throw new Error(N.data.error||"Failed to load models")}catch(N){console.error("Error loading models:",N),U.value.model="Failed to load models. Please try again.",m.value=[]}finally{q.value=!1}}},g=async A=>{v.value=A,_.value="",t.value=null,m.value=[],A&&await i(A),le()},p=()=>{const A=m.value.find(N=>N.code===_.value);A&&(t.value={code:A.code,manufacturer:v.value,models:A.models,controller:A.controller}),le()},R=()=>{le()},X=()=>{le()},te=()=>{le()},le=()=>{var N,Q;const A={manufacturer:v.value,model:((Q=(N=t.value)==null?void 0:N.models)==null?void 0:Q[0])||"",device_code:_.value,controller_device:I.value};k.entityType==="climate"&&(V.value&&(A.temperature_sensor=V.value),b.value&&(A.humidity_sensor=b.value)),w("update:modelValue",A),w("change",A)};return c({validate:()=>{let A=!0;return U.value={manufacturer:"",model:"",controller:""},v.value||(U.value.manufacturer="Manufacturer is required",A=!1),_.value||(U.value.model="Model is required",A=!1),I.value||(U.value.controller="Broadlink controller is required",A=!1),A}}),(A,N)=>(n(),a("div",$o,[e("div",Co,[fe(je,{modelValue:v.value,"onUpdate:modelValue":N[0]||(N[0]=Q=>v.value=Q),options:s.value,label:"Manufacturer",placeholder:"Search manufacturers...",required:"",loading:L.value,error:U.value.manufacturer,hint:"Select the device manufacturer",onChange:g},null,8,["modelValue","options","loading","error"])]),e("div",_o,[fe(je,{modelValue:_.value,"onUpdate:modelValue":N[1]||(N[1]=Q=>_.value=Q),options:m.value,"option-label":"label","option-value":"code","option-description":"description",label:"Model",placeholder:"Search models...",required:"",disabled:!v.value,loading:q.value,error:U.value.model,hint:"Select the device model",onChange:p},null,8,["modelValue","options","disabled","loading","error"])]),e("div",So,[N[6]||(N[6]=e("label",{for:"controller-device"},[e("i",{class:"mdi mdi-remote"}),S(" Controller Device * ")],-1)),W(e("select",{id:"controller-device","onUpdate:modelValue":N[2]||(N[2]=Q=>I.value=Q),required:"",onChange:R},[N[5]||(N[5]=e("option",{value:""},"-- Select Controller Device --",-1)),(n(!0),a(me,null,be(o.broadlinkDevices,Q=>(n(),a("option",{key:Q.entity_id,value:Q.entity_id},[S(u(Q.name||Q.entity_id)+" ",1),Q.area_name?(n(),a(me,{key:0},[S(" - "+u(Q.area_name),1)],64)):T("",!0)],8,Io))),128))],544),[[ke,I.value]]),N[7]||(N[7]=e("small",null,"Which remote device will send the IR/RF commands",-1)),U.value.controller?(n(),a("div",Do,u(U.value.controller),1)):T("",!0)]),o.entityType==="climate"?(n(),a(me,{key:0},[e("div",xo,[N[8]||(N[8]=e("label",{for:"temperature-sensor"},"Temperature Sensor",-1)),W(e("input",{id:"temperature-sensor","onUpdate:modelValue":N[3]||(N[3]=Q=>V.value=Q),type:"text",placeholder:"e.g., sensor.living_room_temperature",onInput:X},null,544),[[Ie,V.value]]),N[9]||(N[9]=e("small",null,"Optional: Temperature sensor entity for current temperature",-1))]),e("div",To,[N[10]||(N[10]=e("label",{for:"humidity-sensor"},"Humidity Sensor",-1)),W(e("input",{id:"humidity-sensor","onUpdate:modelValue":N[4]||(N[4]=Q=>b.value=Q),type:"text",placeholder:"e.g., sensor.living_room_humidity",onInput:te},null,544),[[Ie,b.value]]),N[11]||(N[11]=e("small",null,"Optional: Humidity sensor entity for current humidity",-1))])],64)):T("",!0),t.value?(n(),a("div",Ro,[N[16]||(N[16]=e("div",{class:"info-header"},[e("i",{class:"mdi mdi-information"}),e("span",null,"Selected Device Code")],-1)),e("div",Mo,[e("div",Ao,[N[12]||(N[12]=e("span",{class:"info-label"},"Code ID:",-1)),e("span",Lo,u(t.value.code_id),1)]),e("div",Oo,[N[13]||(N[13]=e("span",{class:"info-label"},"Manufacturer:",-1)),e("span",Eo,u(t.value.manufacturer),1)]),t.value.models&&t.value.models.length>0?(n(),a("div",Vo,[N[14]||(N[14]=e("span",{class:"info-label"},"Supported Models:",-1)),e("span",Uo,u(t.value.models.join(", ")),1)])):T("",!0),e("div",Po,[N[15]||(N[15]=e("span",{class:"info-label"},"Controller:",-1)),e("span",jo,u(t.value.controller||"Broadlink"),1)])])])):T("",!0)]))}},No=he(Fo,[["__scopeId","data-v-1911c8f6"]]),Bo={class:"modal-content"},qo={class:"modal-header"},Ho={class:"input-wrapper"},zo={key:0,class:"validation-tooltip"},Jo={class:"input-wrapper"},Wo=["disabled"],Ko={key:0,class:"validation-tooltip"},Xo={key:0,class:"smartir-notice"},Go={key:0,class:"notice-success"},Yo={key:1,class:"notice-warning"},Zo={key:1,class:"smartir-notice"},Qo={key:2},el={class:"form-group"},tl=["disabled"],ol=["disabled"],ll={key:0},nl={key:1},sl={key:2},al={key:3},il={key:0,class:"form-group"},rl={class:"area-display-readonly"},dl=["value"],ul=["disabled"],cl=["href"],ml={key:1,class:"form-group"},vl={class:"form-group"},pl={class:"input-wrapper"},fl=["value"],gl=["value"],yl={key:2,class:"validation-tooltip"},bl={key:0},hl={key:1},kl={key:3,class:"smartir-section"},wl={class:"modal-footer"},$l={type:"submit",form:"device-form",class:"btn btn-primary"},Cl={__name:"DeviceForm",props:{device:{type:Object,default:null}},emits:["save","cancel"],setup(o,{emit:c}){const r=o,k=c,w=Se("smartirStatus"),s=Se("smartirEnabled"),m=J(()=>{var d;return localStorage.getItem("smartir_simulate_not_installed")==="true"?!1:((d=w==null?void 0:w.value)==null?void 0:d.installed)||!1}),v=J(()=>!!r.device),_=J(()=>["climate","media_player","fan","light"].includes(t.value.entity_type)),I=J(()=>m.value?!_.value&&t.value.entity_type?"(Not supported for this type)":"(Pre-configured Codes)":"(Requires SmartIR)"),V=J(()=>{var d;const x=((d=r.device)==null?void 0:d.commands)||{};return Object.keys(x).length>0}),b=J(()=>{if(!t.value.broadlink_entity)return"";const x=i.value.find(d=>d.entity_id===t.value.broadlink_entity);return x&&x.name||t.value.broadlink_entity}),t=y({name:"",entity_type:"",device_type:"broadlink",device:"",area:"",icon:"",broadlink_entity:"",enabled:!0,commands:{}}),L=y({name:"",entity_type:"",broadlink_entity:""}),q=y({}),U=y(null),M=y([]),i=y([]),g=y(null),p=y(null),R=y(null),X=y(!1);xe(async()=>{r.device&&(t.value={...r.device,device_type:r.device.device_type||"broadlink"},t.value.device_type==="smartir"&&(q.value={manufacturer:r.device.manufacturer,model:r.device.model,device_code:r.device.device_code,controller_device:r.device.controller_device,temperature_sensor:r.device.temperature_sensor,humidity_sensor:r.device.humidity_sensor})),await Promise.all([te(),le()])});const te=async()=>{try{const x=await oe.get("/api/areas");M.value=x.data.areas||[]}catch(x){console.error("Error loading areas:",x),M.value=[]}},le=async()=>{try{const d=(await oe.get("/api/remote/devices")).data.devices||[];i.value=d,console.log("Loaded remote devices:",d)}catch(x){console.error("Error loading remote devices:",x),i.value=[]}},ae=x=>{if(!x)return"";const d=x.toLowerCase();for(const P of M.value){const H=P.toLowerCase();if(d.includes(H))return P}return""},A=(x,d="")=>{const P=d.toLowerCase();return P.includes("tv")?"mdi:television":P.includes("lamp")?"mdi:lamp":P.includes("ceiling")?"mdi:ceiling-light":P.includes("floor")?"mdi:floor-lamp":P.includes("desk")?"mdi:desk-lamp":P.includes("fan")?"mdi:fan":P.includes("ac")||P.includes("air con")?"mdi:air-conditioner":P.includes("heater")?"mdi:radiator":P.includes("blind")?"mdi:blinds":P.includes("curtain")?"mdi:curtains":P.includes("garage")?"mdi:garage":P.includes("speaker")||P.includes("stereo")?"mdi:speaker":P.includes("receiver")?"mdi:audio-video":{light:"mdi:lightbulb",fan:"mdi:fan",switch:"mdi:light-switch",media_player:"mdi:television",cover:"mdi:window-shutter",climate:"mdi:thermostat"}[x]||"mdi:devices"};de(()=>t.value.name,x=>{if(!v.value&&x&&!t.value.area){const d=ae(x);d&&(t.value.area=d)}!v.value&&x&&t.value.entity_type&&(X.value||!t.value.icon)&&(t.value.icon=A(t.value.entity_type,x),X.value=!0)}),de(()=>t.value.entity_type,x=>{!v.value&&x&&(X.value||!t.value.icon)&&(t.value.icon=A(x,t.value.name),X.value=!0)}),de(()=>t.value.icon,(x,d)=>{d!==void 0&&x!==d&&!X.value&&(X.value=!1),x||(X.value=!1)});const N=y(!1),Q=async()=>{var x;if((x=r.device)!=null&&x.id){N.value=!0;try{const d=await oe.post(`/api/devices/${r.device.id}/sync-area`);d.data.success?(t.value.area=d.data.area||"",d.data.area?console.log(`Area synced: ${d.data.area}`):console.log("No area assigned in Home Assistant")):console.warn(d.data.message||"Entity not found in HA")}catch(d){console.error("Failed to sync area:",d)}finally{N.value=!1}}},ue=()=>{var P;return!((P=r.device)!=null&&P.id)||!t.value.entity_type?"#":`/config/entities/entity/${`${t.value.entity_type}.${r.device.id}`}`},ye=()=>{L.value={name:"",entity_type:"",broadlink_entity:""};let x=!0;return(!t.value.name||t.value.name.trim()==="")&&(L.value.name="Device name is required",x=!1),t.value.entity_type||(L.value.entity_type="Entity type is required",x=!1),t.value.device_type==="broadlink"&&!t.value.broadlink_entity&&(L.value.broadlink_entity="Broadlink device is required",x=!1),x},De=x=>{L.value[x]=""},we=async()=>{if(t.value.device_type==="smartir"){if(U.value&&!U.value.validate())return;const x={...t.value,smartir_config:{manufacturer:q.value.manufacturer,model:q.value.model,code_id:q.value.device_code,controller_device:q.value.controller_device}};k("save",x)}else{if(!ye())return;k("save",{...t.value})}},$e=x=>{q.value=x};return(x,d)=>(n(),a("div",{class:"modal-overlay",onClick:d[11]||(d[11]=pe(P=>x.$emit("cancel"),["self"]))},[e("div",Bo,[e("div",qo,[e("h2",null,u(v.value?"Edit Device":"Add New Device"),1),e("button",{onClick:d[0]||(d[0]=P=>x.$emit("cancel")),class:"close-btn"},[...d[12]||(d[12]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("form",{id:"device-form",onSubmit:pe(we,["prevent"]),class:"modal-body"},[e("div",{class:Z(["form-group",{"has-error":L.value.name}])},[d[14]||(d[14]=e("label",{for:"device-name"},"Device Name *",-1)),e("div",Ho,[W(e("input",{id:"device-name",ref_key:"nameInput",ref:g,"onUpdate:modelValue":d[1]||(d[1]=P=>t.value.name=P),type:"text",placeholder:"e.g., Living Room TV",onInput:d[2]||(d[2]=P=>De("name"))},null,544),[[Ie,t.value.name]]),L.value.name?(n(),a("div",zo,[d[13]||(d[13]=e("i",{class:"mdi mdi-alert"},null,-1)),S(" "+u(L.value.name),1)])):T("",!0)]),d[15]||(d[15]=e("small",null,"Friendly name for this device",-1))],2),e("div",{class:Z(["form-group",{"has-error":L.value.entity_type}])},[d[23]||(d[23]=e("label",{for:"entity-type"},"Entity Type *",-1)),e("div",Jo,[W(e("select",{id:"entity-type",ref_key:"typeSelect",ref:p,"onUpdate:modelValue":d[3]||(d[3]=P=>t.value.entity_type=P),onChange:d[4]||(d[4]=P=>De("entity_type"))},[d[16]||(d[16]=Le('<option value="" data-v-94bc1fe5>-- Select Type --</option><option value="light" data-v-94bc1fe5>ðŸ’¡ Light</option><option value="fan" data-v-94bc1fe5>ðŸŒ€ Fan</option><option value="switch" data-v-94bc1fe5>ðŸ”Œ Switch</option><option value="media_player" data-v-94bc1fe5>ðŸ“º Media Player</option><option value="cover" data-v-94bc1fe5>ðŸªŸ Cover (Blinds/Curtains)</option>',6)),e("option",{value:"climate",disabled:!m.value}," ðŸŒ¡ï¸ Climate "+u(m.value?"":"(Requires SmartIR)"),9,Wo)],544),[[ke,t.value.entity_type]]),L.value.entity_type?(n(),a("div",Ko,[d[17]||(d[17]=e("i",{class:"mdi mdi-alert"},null,-1)),S(" "+u(L.value.entity_type),1)])):T("",!0)]),t.value.entity_type==="climate"?(n(),a("div",Xo,[m.value?(n(),a("div",Go,[...d[18]||(d[18]=[e("i",{class:"mdi mdi-check-circle"},null,-1),e("span",null,"SmartIR detected! Climate entities will be created via SmartIR profiles.",-1)])])):(n(),a("div",Yo,[...d[19]||(d[19]=[e("i",{class:"mdi mdi-alert"},null,-1),e("div",null,[e("strong",null,"SmartIR Required"),e("p",null,"Climate entities (AC, heaters) require SmartIR integration."),e("a",{href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"smartir-link"}," Install SmartIR â†’ ")],-1)])]))])):m.value&&["media_player","fan","light"].includes(t.value.entity_type)?(n(),a("div",Zo,[...d[20]||(d[20]=[e("div",{class:"notice-info"},[e("i",{class:"mdi mdi-information"}),e("span",null,"ðŸ’¡ SmartIR available! You can use pre-configured codes or learn your own.")],-1)])])):!m.value&&t.value.entity_type?(n(),a("small",Qo,[d[21]||(d[21]=S(" ðŸ’¡ Tip: Install ",-1)),d[22]||(d[22]=e("a",{href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"inline-link"},"SmartIR",-1)),S(" for pre-configured "+u(t.value.entity_type==="climate"?"climate":t.value.entity_type)+" device codes ",1)])):T("",!0)],2),e("div",el,[d[26]||(d[26]=e("label",{for:"device-type"},"Device Type *",-1)),W(e("select",{id:"device-type","onUpdate:modelValue":d[5]||(d[5]=P=>t.value.device_type=P),required:"",disabled:v.value},[d[24]||(d[24]=e("option",{value:""},"-- Select Device Type --",-1)),d[25]||(d[25]=e("option",{value:"broadlink"},"ðŸ“¡ Broadlink Device (Learn IR Codes)",-1)),_e(s)?(n(),a("option",{key:0,value:"smartir",disabled:!m.value||!_.value}," ðŸŒ SmartIR Device "+u(I.value),9,ol)):T("",!0)],8,tl),[[ke,t.value.device_type]]),v.value?(n(),a("small",ll,"Cannot change device type after creation")):t.value.device_type==="smartir"?(n(),a("small",nl,"Using pre-configured codes from SmartIR repository")):t.value.device_type==="broadlink"?(n(),a("small",sl,"Learn and store your own IR codes")):(n(),a("small",al,"Choose how to configure this device"))]),v.value?(n(),a("div",il,[d[29]||(d[29]=e("label",{for:"device-area"},"Area",-1)),e("div",rl,[e("input",{id:"device-area",value:t.value.area||"Not assigned",type:"text",readonly:"",class:"readonly-input"},null,8,dl),e("button",{type:"button",onClick:Q,disabled:N.value,class:"sync-area-btn",title:"Sync area from Home Assistant"},[e("i",{class:Z(N.value?"mdi mdi-loading mdi-spin":"mdi mdi-refresh")},null,2)],8,ul)]),e("small",null,[d[27]||(d[27]=e("i",{class:"mdi mdi-information-outline"},null,-1)),d[28]||(d[28]=S(" Set area in Home Assistant, then click sync. ",-1)),e("a",{href:ue(),target:"_blank",class:"inline-link"},"Open in HA â†’",8,cl)])])):(n(),a("div",ml,[...d[30]||(d[30]=[e("div",{class:"info-notice"},[e("i",{class:"mdi mdi-information-outline"}),e("span",null,[e("strong",null,"Area Assignment:"),S(" After generating entities and restarting Home Assistant, you can assign areas in HA and sync them here.")])],-1)])])),e("div",vl,[d[31]||(d[31]=e("label",{for:"device-icon"},"Icon",-1)),fe(no,{modelValue:t.value.icon,"onUpdate:modelValue":d[6]||(d[6]=P=>t.value.icon=P),inputId:"device-icon",placeholder:"e.g., mdi:television"},null,8,["modelValue"]),d[32]||(d[32]=e("small",null,"Optional: Material Design Icon name",-1))]),t.value.device_type==="broadlink"?(n(),a("div",{key:2,class:Z(["form-group",{"has-error":L.value.broadlink_entity}])},[d[35]||(d[35]=e("label",{for:"broadlink-entity"},"Remote Device *",-1)),e("div",pl,[!v.value||!V.value?W((n(),a("select",{key:0,id:"broadlink-entity",ref_key:"broadlinkSelect",ref:R,"onUpdate:modelValue":d[7]||(d[7]=P=>t.value.broadlink_entity=P),onChange:d[8]||(d[8]=P=>De("broadlink_entity"))},[d[33]||(d[33]=e("option",{value:""},"-- Select Remote Device --",-1)),(n(!0),a(me,null,be(i.value,P=>(n(),a("option",{key:P.entity_id,value:P.entity_id},[S(u(P.name||P.entity_id)+" ",1),P.area_name?(n(),a(me,{key:0},[S(" - "+u(P.area_name),1)],64)):T("",!0)],8,fl))),128))],544)),[[ke,t.value.broadlink_entity]]):(n(),a("input",{key:1,id:"broadlink-entity",value:b.value,type:"text",readonly:"",disabled:""},null,8,gl)),L.value.broadlink_entity?(n(),a("div",yl,[d[34]||(d[34]=e("i",{class:"mdi mdi-alert"},null,-1)),S(" "+u(L.value.broadlink_entity),1)])):T("",!0)]),!v.value||!V.value?(n(),a("small",bl,"Required: Select which remote device to use for sending commands")):(n(),a("small",hl,"Cannot change remote device after commands are learned"))],2)):T("",!0),t.value.device_type==="smartir"?(n(),a("div",kl,[d[36]||(d[36]=e("div",{class:"section-header"},[e("i",{class:"mdi mdi-cloud-download"}),e("span",null,"SmartIR Device Configuration")],-1)),fe(No,{ref_key:"smartirSelector",ref:U,"entity-type":t.value.entity_type,modelValue:q.value,"onUpdate:modelValue":d[9]||(d[9]=P=>q.value=P),"broadlink-devices":i.value,onChange:$e},null,8,["entity-type","modelValue","broadlink-devices"])])):T("",!0)],32),e("div",wl,[e("button",{type:"button",onClick:d[10]||(d[10]=P=>x.$emit("cancel")),class:"btn btn-secondary"}," Cancel "),e("button",$l,[d[37]||(d[37]=e("i",{class:"mdi mdi-check"},null,-1)),S(" "+u(v.value?"Update":"Create"),1)])])])]))}},_l=he(Cl,[["__scopeId","data-v-94bc1fe5"]]),Sl={class:"modal-header"},Il={class:"modal-body"},Dl={class:"message-text"},xl={key:0,class:"checkbox-option"},Tl={class:"modal-footer"},Rl=["disabled"],Ml={__name:"ConfirmDialog",props:{isOpen:{type:Boolean,default:!1},title:{type:String,default:"Confirm"},message:{type:String,required:!0},confirmText:{type:String,default:"OK"},cancelText:{type:String,default:"Cancel"},showCancel:{type:Boolean,default:!0},dangerMode:{type:Boolean,default:!1},confirmDisabled:{type:Boolean,default:!1},checkboxLabel:{type:String,default:""}},emits:["confirm","cancel"],setup(o,{emit:c}){const r=o,k=c,w=y(!1);de(()=>r.isOpen,v=>{v&&(w.value=!1)});const s=()=>{k("confirm",w.value)},m=()=>{k("cancel")};return(v,_)=>o.isOpen?(n(),a("div",{key:0,class:"modal-overlay",onClick:pe(m,["self","stop"])},[e("div",{class:"modal-dialog confirm-dialog",onClick:_[1]||(_[1]=pe(()=>{},["stop"]))},[e("div",Sl,[e("h2",null,u(o.title),1)]),e("div",Il,[e("p",Dl,u(o.message),1),o.checkboxLabel?(n(),a("div",xl,[e("label",null,[W(e("input",{type:"checkbox","onUpdate:modelValue":_[0]||(_[0]=I=>w.value=I)},null,512),[[ve,w.value]]),e("span",null,u(o.checkboxLabel),1)])])):T("",!0)]),e("div",Tl,[o.showCancel?(n(),a("button",{key:0,onClick:pe(m,["stop"]),class:"btn btn-secondary"},u(o.cancelText),1)):T("",!0),o.confirmText?(n(),a("button",{key:1,onClick:pe(s,["stop"]),class:Z(["btn",o.dangerMode?"btn-danger":"btn-primary"]),disabled:o.confirmDisabled},u(o.confirmText),11,Rl)):T("",!0)])])])):T("",!0)}},Me=he(Ml,[["__scopeId","data-v-80a9de08"]]),Al={class:"modal-content"},Ll={class:"modal-header"},Ol={class:"modal-body"},El={key:0,class:"smartir-info"},Vl={key:0,class:"climate-note"},Ul={class:"form-group"},Pl=["value"],jl={class:"form-group"},Fl=["disabled"],Nl={label:"Suggested Commands"},Bl=["value"],ql=["disabled"],Hl={class:"form-group"},zl={class:"radio-group"},Jl={class:"radio-label"},Wl=["disabled"],Kl={class:"radio-label"},Xl=["disabled"],Gl={class:"learn-action"},Yl=["disabled"],Zl={key:0,class:"mdi mdi-loading mdi-spin"},Ql={key:1,class:"mdi mdi-remote-tv"},en={key:0,class:"learning-status"},tn={key:0},on={key:1,class:"rf-instructions"},ln={key:1,class:"result-message success"},nn={key:2,class:"section-divider"},sn={key:3,class:"learned-commands"},an={class:"command-list"},rn={class:"command-info"},dn={class:"command-name"},un={class:"learned-status"},cn={class:"command-actions"},mn=["onClick","disabled"],vn=["onClick"],pn={key:4,class:"untracked-commands"},fn={class:"command-list"},gn={class:"command-name"},yn={class:"modal-footer"},bn=["disabled"],hn={__name:"CommandLearner",props:{device:{type:Object,required:!0}},emits:["cancel","learned"],setup(o,{emit:c}){const r=o,k=c,w=y([]),s=y(""),m=y(""),v=y(""),_=y("ir"),I=y(!1),V=y(""),b=y("success"),t=y([]),L=y([]),q=y(!1),U=y(""),M=y(!1),i=y(null),g=y(null),p=y(""),R=y(""),X=J(()=>r.device.device_type==="smartir");J(()=>{if(X.value)return!1;const f=m.value==="__custom__"?v.value:m.value;return s.value&&f.trim()});const te=()=>{i.value&&i.value.setCustomValidity("")},le=()=>{g.value&&g.value.setCustomValidity("")},ae=J(()=>{const f=w.value.find(C=>C.entity_id===s.value);return f?f.name||f.entity_id:s.value}),A={light:["turn_on","turn_off","toggle","brightness_up","brightness_down","dim","bright"],fan:["turn_on","turn_off","toggle","speed_low","speed_medium","speed_high","speed_1","speed_2","speed_3","speed_4","speed_5","oscillate_on","oscillate_off","direction_forward","direction_reverse"],switch:["turn_on","turn_off","toggle"],media_player:["turn_on","turn_off","toggle","volume_up","volume_down","volume_mute","play","pause","stop","play_pause","next_track","previous_track","channel_up","channel_down","source_hdmi1","source_hdmi2","source_hdmi3","source_tv","source_aux","source_bluetooth","menu","home","back","select","arrow_up","arrow_down","arrow_left","arrow_right"],cover:["open","close","stop","open_tilt","close_tilt","position_0","position_25","position_50","position_75","position_100"]},N=J(()=>{const f=r.device.entity_type||"switch";return A[f]||A.switch});xe(async()=>{await Q();try{console.log("ðŸ”„ Syncing command types...");const C=await oe.post("/api/commands/sync");console.log("âœ… Command types synced:",C.data)}catch(C){console.error("âš ï¸ Failed to sync command types:",C)}const f=!X.value;console.log(`ðŸ“‹ Will ${f?"FORCE RELOAD":"use cached"} commands`),await ue(f),i.value&&(i.value.setCustomValidity(""),i.value.oninvalid=()=>{i.value.setCustomValidity("Command name is required")}),r.device.broadlink_entity&&(s.value=r.device.broadlink_entity)}),de(m,async f=>{f==="__custom__"&&(await We(),g.value&&(g.value.setCustomValidity(""),g.value.oninvalid=()=>{g.value.setCustomValidity("Custom command name is required")}))});const Q=async()=>{try{const f=await oe.get("/api/broadlink/devices");w.value=f.data.devices||[]}catch(f){console.error("Error loading Broadlink devices:",f)}},ue=async(f=!1)=>{var C,B;try{if(X.value){const Y=await oe.get("/api/smartir/codes/code",{params:{entity_type:r.device.entity_type,code_id:r.device.device_code}});if(Y.data.success&&Y.data.code){const se=Y.data.code.commands||{},z=Y.data.code.commandType||"ir";if(r.device.entity_type==="climate"){const D=[];for(const[ie,G]of Object.entries(se))typeof G=="string"?D.push({name:ie,type:z}):typeof G=="object"&&G!==null&&Object.keys(G).sort((E,l)=>parseInt(E)-parseInt(l)).forEach(E=>{D.push({name:`${ie}_${E}`,type:z,label:`${ie.charAt(0).toUpperCase()+ie.slice(1)} ${E}Â°C`})});t.value=D}else t.value=Object.keys(se).map(D=>({name:D,type:z}))}}else{if(console.log("ðŸ“‹ Loading commands for device:",r.device),console.log("ðŸ“‹ Device ID:",r.device.id),console.log("ðŸ“‹ Force reload:",f),f&&r.device.id){console.log("ðŸ”„ Force reloading commands from API after sync");try{const se=(await oe.get(`/api/commands/${r.device.id}`)).data.commands||{};console.log("ðŸ“¦ Raw commands from API:",se),t.value=Object.entries(se).map(([z,D])=>{console.log(`  Command '${z}':`,D,`(type: ${typeof D})`);const ie=typeof D=="object"&&D!==null&&(D.command_type||D.type)||"ir";return{name:z,type:ie}}),console.log("ðŸ“‹ Reloaded commands:",t.value)}catch(Y){if(console.error("âŒ Error loading commands:",Y),((C=Y.response)==null?void 0:C.status)===404)console.log("â„¹ï¸ No commands found for device"),t.value=[];else throw Y}}else if(r.device.commands&&Object.keys(r.device.commands).length>0)console.log("âœ… Using commands from device object"),t.value=Object.entries(r.device.commands).map(([Y,se])=>({name:Y,type:se.command_type||se.type||"ir"}));else if(r.device.commands!==void 0)console.log("â„¹ï¸ Device has empty commands object - skipping API call"),t.value=[];else if(r.device.id){console.log("ðŸŒ Fetching commands from API for device ID:",r.device.id);try{const se=(await oe.get(`/api/commands/${r.device.id}`)).data.commands||{};t.value=Object.entries(se).map(([z,D])=>({name:z,type:D.command_type||D.type||"ir"}))}catch(Y){if(((B=Y.response)==null?void 0:B.status)===404)console.log("â„¹ï¸ No commands found for device (this is normal for new devices)"),t.value=[];else throw Y}}else console.log("âš ï¸ No commands found and no device ID");console.log("ðŸ“‹ Final learned commands:",t.value)}}catch(Y){console.error("Error loading commands:",Y)}},ye=async()=>{var f,C;V.value="",b.value="",I.value=!0;try{let B=r.device.id.split(".")[1];r.device.device&&(B=r.device.device);const Y=m.value==="__custom__"?v.value:m.value,se=await oe.post("/api/commands/learn",{entity_id:s.value,device:B,device_id:r.device.id,command:Y.trim(),command_type:_.value});if(se.data.success){V.value=`Command "${Y}" learned successfully!`,b.value="success",t.value.find(G=>G.name===Y)||t.value.push({name:Y,type:_.value});const D=L.value.indexOf(Y);D>-1&&L.value.splice(D,1);const ie={...r.device.commands};ie[Y]={command_type:_.value,type:_.value},await d(),m.value="",v.value="",k("learned",{commands:ie,commandName:Y})}else V.value=se.data.error||"Failed to learn command",b.value="error"}catch(B){V.value=((C=(f=B.response)==null?void 0:f.data)==null?void 0:C.error)||"Error learning command",b.value="error"}finally{I.value=!1}},De=async f=>{var C,B;try{R.value=f,p.value="";let Y=r.device.id.split(".")[1];r.device.device&&(Y=r.device.device);const se=X.value?r.device.controller_device:s.value||r.device.broadlink_entity;if(!se){console.error("Missing entity_id for test command:",{isSmartIR:X.value,controller_device:r.device.controller_device,broadlink_entity:r.device.broadlink_entity,selectedBroadlink:s.value,device:r.device}),V.value="Missing Broadlink remote entity. Please select a Broadlink device.",b.value="error",R.value="";return}const z={entity_id:se,device:Y,command:f,device_id:r.device.id};console.log("ðŸ§ª Testing command:",z),(await oe.post("/api/commands/test",z)).data.success&&(p.value=f,setTimeout(()=>{p.value===f&&(p.value="")},2e3))}catch(Y){console.error("âŒ Test command error:",Y);const se=((B=(C=Y.response)==null?void 0:C.data)==null?void 0:B.error)||Y.message||"Unknown error";V.value=`Failed to send command: ${se}`,b.value="error"}finally{R.value=""}},we=f=>{U.value=f,q.value=!0},$e=()=>{q.value=!1,U.value=""},x=async()=>{const f=U.value;q.value=!1;try{console.log(`ðŸ—‘ï¸ Deleting command: ${f}`),await oe.delete(`/api/commands/${r.device.id}/${f}`),t.value=t.value.filter(C=>C.name!==f),await ue(),await d(),V.value=`Command "${f}" deleted`,b.value="success",k("learned")}catch(C){console.error("âŒ Delete error:",C),V.value=`Failed to delete command: ${C.message}`,b.value="error"}finally{U.value=""}},d=async()=>{try{let f=r.device.device;f||(f=r.device.id.includes(".")?r.device.id.split(".")[1]:r.device.id),console.log("ðŸ” Looking for untracked commands for device:",f);const B=(await oe.get("/api/commands/untracked")).data.untracked||{};console.log("ðŸ“¦ All untracked commands:",Object.keys(B)),console.log("ðŸ“¦ Untracked for this device:",B[f]),B[f]?L.value=Object.keys(B[f].commands):L.value=[]}catch(f){console.error("Error loading untracked commands:",f),L.value=[]}},P=()=>{L.value.length!==0&&(M.value=!0)},H=async()=>{M.value=!1;try{const f=r.device.device||r.device.id.split(".")[1],C=await oe.post("/api/commands/import",{device_id:r.device.id,source_device:f,commands:L.value});C.data.success&&(V.value=`Imported ${C.data.imported_count} commands successfully!`,b.value="success",await ue(),await d(),k("learned"))}catch(f){V.value=`Failed to import commands: ${f.message}`,b.value="error"}};return(f,C)=>(n(),a("div",{class:"modal-overlay",onClick:C[7]||(C[7]=pe(B=>f.$emit("cancel"),["self"]))},[e("div",Al,[e("div",Ll,[e("h2",null,u(X.value?"Commands for":"Learn Commands for")+" "+u(o.device.name),1),e("button",{onClick:C[0]||(C[0]=B=>f.$emit("cancel")),class:"close-btn"},[...C[8]||(C[8]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Ol,[X.value?(n(),a("div",El,[C[13]||(C[13]=e("i",{class:"mdi mdi-information"},null,-1)),e("div",null,[C[12]||(C[12]=e("h3",null,"SmartIR Device",-1)),e("p",null,[C[9]||(C[9]=S("This device uses SmartIR code file ",-1)),e("strong",null,u(o.device.device_code),1),C[10]||(C[10]=S(". Commands are pre-configured and cannot be learned.",-1))]),o.device.entity_type==="climate"?(n(),a("p",Vl,[...C[11]||(C[11]=[e("i",{class:"mdi mdi-alert-circle-outline"},null,-1),e("strong",null,"Note:",-1),S(" Climate device commands are temperature-based. Testing individual modes may not work as expected. Use the Home Assistant climate card to control your device. ",-1)])])):T("",!0)])])):(n(),a("form",{key:1,onSubmit:pe(ye,["prevent"])},[e("div",Ul,[C[14]||(C[14]=e("label",{for:"broadlink-entity"},"Broadlink Device",-1)),e("input",{id:"broadlink-entity",value:ae.value,type:"text",readonly:"",disabled:""},null,8,Pl),C[15]||(C[15]=e("small",null,"Commands will be learned using this device (set when device was created)",-1))]),e("div",jl,[C[18]||(C[18]=e("label",{for:"command-name"},"Command Name *",-1)),W(e("select",{id:"command-name",ref_key:"commandSelect",ref:i,"onUpdate:modelValue":C[1]||(C[1]=B=>m.value=B),disabled:I.value,required:"",onChange:te},[C[16]||(C[16]=e("option",{value:""},"-- Select or type command --",-1)),e("optgroup",Nl,[(n(!0),a(me,null,be(N.value,B=>(n(),a("option",{key:B,value:B},u(B),9,Bl))),128))]),C[17]||(C[17]=e("option",{value:"__custom__"},"Custom command...",-1))],40,Fl),[[ke,m.value]]),m.value==="__custom__"?W((n(),a("input",{key:0,ref_key:"customCommandInput",ref:g,"onUpdate:modelValue":C[2]||(C[2]=B=>v.value=B),type:"text",placeholder:"Enter custom command name",disabled:I.value,required:"",class:"custom-command-input",onInput:le},null,40,ql)),[[Ie,v.value]]):T("",!0),e("small",null,"Select a suggested command for "+u(o.device.entity_type||"this device")+", or enter a custom one.",1)]),e("div",Hl,[C[21]||(C[21]=e("label",null,"Command Type",-1)),e("div",zl,[e("label",Jl,[W(e("input",{type:"radio","onUpdate:modelValue":C[3]||(C[3]=B=>_.value=B),value:"ir",disabled:I.value},null,8,Wl),[[Pe,_.value]]),C[19]||(C[19]=e("span",null,"IR (Infrared)",-1))]),e("label",Kl,[W(e("input",{type:"radio","onUpdate:modelValue":C[4]||(C[4]=B=>_.value=B),value:"rf",disabled:I.value},null,8,Xl),[[Pe,_.value]]),C[20]||(C[20]=e("span",null,"RF (Radio Frequency)",-1))])])]),e("div",Gl,[e("button",{type:"submit",class:"btn btn-primary btn-large",disabled:I.value},[I.value?(n(),a("i",Zl)):(n(),a("i",Ql)),S(" "+u(I.value?"Learning...":"Learn Command"),1)],8,Yl)]),I.value?(n(),a("div",en,[C[24]||(C[24]=e("i",{class:"mdi mdi-loading mdi-spin"},null,-1)),_.value==="ir"?(n(),a("div",tn,[...C[22]||(C[22]=[e("p",null,"Point your remote at the Broadlink device and press the button...",-1),e("small",null,"This may take up to 30 seconds",-1)])])):_.value==="rf"?(n(),a("div",on,[...C[23]||(C[23]=[e("p",null,[e("strong",null,"Learning request sent to device.")],-1),e("p",null,"RF learning is a two-step process:",-1),e("ol",null,[e("li",null,[e("strong",null,"Step 1 - Frequency Sweep (~10-15 seconds):"),S(" Press and hold the button on your remote until the notification updates.")]),e("li",null,[e("strong",null,"Step 2 - Learn Signal:"),S(" Press and release the button once.")])],-1),e("p",{class:"ha-note"},[S(" Follow the Home Assistant notifications ("),e("i",{class:"mdi mdi-bell"}),S(") for real-time instructions. ")],-1)])])):T("",!0)])):T("",!0),V.value&&b.value==="success"&&!V.value.includes("sent successfully")?(n(),a("div",ln,[C[25]||(C[25]=e("i",{class:"mdi mdi-check-circle"},null,-1)),e("p",null,u(V.value),1)])):T("",!0)],32)),t.value.length>0||L.value.length>0?(n(),a("div",nn)):T("",!0),t.value.length>0?(n(),a("div",sn,[e("h3",null,"Tracked Commands ("+u(t.value.length)+")",1),e("div",an,[(n(!0),a(me,null,be(t.value,B=>(n(),a("div",{key:B.name,class:"command-item"},[e("div",rn,[e("span",dn,u(B.label||B.name),1)]),e("div",un,[C[26]||(C[26]=e("i",{class:"mdi mdi-check-circle"},null,-1)),C[27]||(C[27]=e("span",null,"Learned",-1)),e("span",{class:Z(["command-type-badge",B.type||"ir"])},u((B.type||"ir").toUpperCase()),3)]),e("div",cn,[e("button",{type:"button",onClick:Y=>De(B.name),class:"icon-btn",title:"Test command",disabled:R.value===B.name},[e("i",{class:Z(["mdi mdi-play",{"mdi-spin":R.value===B.name}])},null,2)],8,mn),e("button",{type:"button",onClick:Y=>we(B.name),class:"icon-btn danger",title:"Delete and re-learn"},[...C[28]||(C[28]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,vn)])]))),128))])])):T("",!0),L.value.length>0?(n(),a("div",pn,[e("h3",null,[C[29]||(C[29]=e("i",{class:"mdi mdi-alert"},null,-1)),S(" Untracked Commands ("+u(L.value.length)+") ",1)]),C[32]||(C[32]=e("p",{class:"untracked-info"}," These commands exist in Broadlink storage but are not tracked in this device. ",-1)),e("div",fn,[(n(!0),a(me,null,be(L.value,B=>(n(),a("div",{key:B,class:"command-item untracked"},[e("span",gn,u(B),1),C[30]||(C[30]=e("span",{class:"untracked-badge"},"Not tracked",-1))]))),128))]),e("button",{type:"button",onClick:P,class:"btn btn-secondary"},[...C[31]||(C[31]=[e("i",{class:"mdi mdi-import"},null,-1),S(" Import All Untracked Commands ",-1)])])])):T("",!0)]),e("div",yn,[e("button",{type:"button",onClick:C[5]||(C[5]=B=>f.$emit("cancel")),class:"btn btn-secondary",disabled:I.value}," Close ",8,bn)])]),fe(Me,{isOpen:q.value,title:"Delete Command?",message:`Delete command '${U.value}'? This will remove it from Broadlink storage.`,confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,onConfirm:x,onCancel:$e},null,8,["isOpen","message"]),fe(Me,{isOpen:M.value,title:"Import Commands?",message:`Import ${L.value.length} untracked command${L.value.length>1?"s":""} into this device?`,confirmText:"Import",cancelText:"Cancel",onConfirm:H,onCancel:C[6]||(C[6]=B=>M.value=!1)},null,8,["isOpen","message"])]))}},kn=he(hn,[["__scopeId","data-v-5d279b7f"]]),wn={class:"modal-container error-dialog"},$n={class:"modal-header"},Cn={class:"modal-body"},_n={class:"error-message"},Sn={key:0,class:"error-suggestion"},In=["open"],Dn={class:"debug-content"},xn={class:"debug-info"},Tn={key:0,class:"debug-section-title"},Rn={key:1},Mn={__name:"ErrorDialog",props:{isOpen:{type:Boolean,default:!1},title:{type:String,default:"Error"},message:{type:String,required:!0},suggestion:{type:String,default:""},details:{type:String,default:""},error:{type:Object,default:null},context:{type:Object,default:()=>({})}},emits:["close"],setup(o,{emit:c}){const r=o,k=c,w=Se("toast"),s=y(!1),m=()=>{k("close")},v=J(()=>{var L,q,U,M,i,g,p,R,X,te,le;const b=new Date().toISOString(),t=r.error||{};return{error:JSON.stringify({message:r.message,title:r.title,details:r.details,errorObject:t.message||t.toString(),timestamp:b},null,2),request:JSON.stringify({method:((q=(L=t.config)==null?void 0:L.method)==null?void 0:q.toUpperCase())||"N/A",url:((U=t.config)==null?void 0:U.url)||"N/A",baseURL:((M=t.config)==null?void 0:M.baseURL)||"N/A",headers:((i=t.config)==null?void 0:i.headers)||{},data:(g=t.config)!=null&&g.data?JSON.parse(t.config.data):"N/A",params:((p=t.config)==null?void 0:p.params)||{}},null,2),response:JSON.stringify({status:((R=t.response)==null?void 0:R.status)||"N/A",statusText:((X=t.response)==null?void 0:X.statusText)||"N/A",data:((te=t.response)==null?void 0:te.data)||"N/A",headers:((le=t.response)==null?void 0:le.headers)||{}},null,2),browser:JSON.stringify({userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language,cookieEnabled:navigator.cookieEnabled,onLine:navigator.onLine,viewport:`${window.innerWidth}x${window.innerHeight}`,screenResolution:`${window.screen.width}x${window.screen.height}`,colorDepth:window.screen.colorDepth,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,timestamp:b},null,2),appState:JSON.stringify({currentRoute:window.location.pathname,currentURL:window.location.href,referrer:document.referrer||"N/A",context:r.context||{},localStorage:{smartir_simulate:localStorage.getItem("smartir_simulate_not_installed"),theme:localStorage.getItem("theme")}},null,2),stackTrace:t.stack||null}}),_=async()=>{const b=V();try{await navigator.clipboard.writeText(b),w==null||w.success("Debug information copied to clipboard","âœ… Copied")}catch(t){console.error("Failed to copy:",t),w==null||w.error("Failed to copy to clipboard","âŒ Copy Failed")}},I=()=>{const b=V(),t=new Blob([b],{type:"text/plain"}),L=URL.createObjectURL(t),q=document.createElement("a");q.href=L;const U=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5);q.download=`broadlink-manager-error-${U}.txt`,document.body.appendChild(q),q.click(),document.body.removeChild(q),URL.revokeObjectURL(L),w==null||w.success("Debug report downloaded","âœ… Downloaded")},V=()=>`Broadlink Manager - Error Report
${"=".repeat(60)}

Generated: ${new Date().toISOString()}
Title: ${r.title}
Message: ${r.message}
${r.suggestion?`Suggestion: ${r.suggestion}
`:""}
${"=".repeat(60)}

ERROR DETAILS
${"-".repeat(60)}
${v.value.error}

REQUEST INFORMATION
${"-".repeat(60)}
${v.value.request}

RESPONSE INFORMATION
${"-".repeat(60)}
${v.value.response}

BROWSER INFORMATION
${"-".repeat(60)}
${v.value.browser}

APPLICATION STATE
${"-".repeat(60)}
${v.value.appState}

${v.value.stackTrace?`STACK TRACE
${"-".repeat(60)}
${v.value.stackTrace}

`:""}
${"=".repeat(60)}
End of Report
`;return de(()=>r.isOpen,b=>{if(b){const t=L=>{L.key==="Escape"&&m()};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)}}),(b,t)=>(n(),Te(Ke,{to:"body"},[fe(Je,{name:"modal"},{default:Fe(()=>[o.isOpen?(n(),a("div",{key:0,class:"modal-overlay",onClick:pe(m,["self"])},[e("div",wn,[e("div",$n,[t[2]||(t[2]=e("div",{class:"header-icon error-icon"},[e("i",{class:"mdi mdi-alert-circle"})],-1)),e("h3",null,u(o.title),1),e("button",{onClick:m,class:"close-button"},[...t[1]||(t[1]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Cn,[e("p",_n,u(o.message),1),o.suggestion?(n(),a("p",Sn,[t[3]||(t[3]=e("i",{class:"mdi mdi-lightbulb-on"},null,-1)),S(" "+u(o.suggestion),1)])):T("",!0),e("details",{class:"debug-section",open:s.value},[e("summary",{onClick:t[0]||(t[0]=L=>s.value=!s.value)},[e("i",{class:Z(["mdi",s.value?"mdi-chevron-down":"mdi-chevron-right"])},null,2),t[4]||(t[4]=S(" Debug Information ",-1))]),e("div",Dn,[e("div",{class:"debug-actions"},[e("button",{onClick:_,class:"btn-debug btn-copy"},[...t[5]||(t[5]=[e("i",{class:"mdi mdi-content-copy"},null,-1),S(" Copy to Clipboard ",-1)])]),e("button",{onClick:I,class:"btn-debug btn-download"},[...t[6]||(t[6]=[e("i",{class:"mdi mdi-download"},null,-1),S(" Download Report ",-1)])])]),e("div",xn,[t[7]||(t[7]=e("div",{class:"debug-section-title"},"Error Details",-1)),e("pre",null,u(v.value.error),1),t[8]||(t[8]=e("div",{class:"debug-section-title"},"Request Information",-1)),e("pre",null,u(v.value.request),1),t[9]||(t[9]=e("div",{class:"debug-section-title"},"Response Information",-1)),e("pre",null,u(v.value.response),1),t[10]||(t[10]=e("div",{class:"debug-section-title"},"Browser Information",-1)),e("pre",null,u(v.value.browser),1),t[11]||(t[11]=e("div",{class:"debug-section-title"},"Application State",-1)),e("pre",null,u(v.value.appState),1),v.value.stackTrace?(n(),a("div",Tn,"Stack Trace")):T("",!0),v.value.stackTrace?(n(),a("pre",Rn,u(v.value.stackTrace),1)):T("",!0)])])],8,In)]),e("div",{class:"modal-footer"},[e("button",{onClick:m,class:"btn btn-primary"}," OK ")])])])):T("",!0)]),_:1})]))}},An=he(Mn,[["__scopeId","data-v-23858149"]]),Ln={key:0,class:"discovery-banner"},On={class:"banner-content"},En={class:"banner-text"},Vn={class:"modal-dialog"},Un={class:"modal-header"},Pn={class:"modal-body"},jn={class:"device-list"},Fn={class:"device-info"},Nn={class:"device-details"},Bn={class:"command-count"},qn={class:"device-actions"},Hn=["onClick"],zn=["onClick"],Jn={class:"modal-footer"},Wn={class:"modal-dialog modal-dialog-small"},Kn={class:"modal-header"},Xn={class:"modal-body"},Gn={class:"warning-message"},Yn={class:"modal-footer"},Zn=["disabled"],Qn=["disabled"],es={__name:"DeviceDiscovery",emits:["adopt"],setup(o,{expose:c,emit:r}){const k=Ee(),w=r,s=y([]),m=y(!1),v=y(!1),_=y(null),I=y(!1),V=J(()=>s.value.length>0);xe(async()=>{await b()});const b=async()=>{try{const U=await oe.get("/api/devices/discover");s.value=U.data.untracked_devices||[]}catch(U){console.error("Error loading untracked devices:",U),s.value=[]}},t=U=>{m.value=!1,w("adopt",U)},L=U=>{_.value=U,v.value=!0},q=async()=>{if(_.value){I.value=!0;try{const U=await oe.delete(`/api/devices/untracked/${encodeURIComponent(_.value.device_name)}`);if(U.data.success)s.value=s.value.filter(M=>M.device_name!==_.value.device_name),v.value=!1,_.value=null,console.log("Device deleted successfully");else throw new Error(U.data.error||"Failed to delete device")}catch(U){console.error("Error deleting device:",U),k.error(`Failed to delete device: ${U.message}`)}finally{I.value=!1}}};return c({refresh:b}),(U,M)=>{var i,g,p;return V.value?(n(),a("div",Ln,[e("div",On,[M[9]||(M[9]=e("div",{class:"banner-icon"},[e("i",{class:"mdi mdi-radar"})],-1)),e("div",En,[M[7]||(M[7]=e("h3",null,"Untracked Devices Found",-1)),e("p",null,u(s.value.length)+" device"+u(s.value.length>1?"s":"")+" with learned commands found in Broadlink storage",1)]),e("button",{onClick:M[0]||(M[0]=R=>m.value=!0),class:"btn btn-primary"},[...M[8]||(M[8]=[e("i",{class:"mdi mdi-eye"},null,-1),S(" View Devices ",-1)])])]),m.value?(n(),a("div",{key:0,class:"modal-overlay",onClick:M[3]||(M[3]=pe(R=>m.value=!1,["self"]))},[e("div",Vn,[e("div",Un,[M[11]||(M[11]=e("h2",null,"Discovered Devices",-1)),e("button",{onClick:M[1]||(M[1]=R=>m.value=!1),class:"close-btn"},[...M[10]||(M[10]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Pn,[M[16]||(M[16]=e("p",{class:"info-text"}," These devices have learned commands in Broadlink storage but are not being tracked. Adopt them to manage their commands and generate Home Assistant entities. ",-1)),e("div",jn,[(n(!0),a(me,null,be(s.value,R=>(n(),a("div",{key:R.device_name,class:"discovered-device"},[e("div",Fn,[M[13]||(M[13]=e("div",{class:"device-icon"},[e("i",{class:"mdi mdi-devices"})],-1)),e("div",Nn,[e("h4",null,u(R.device_name),1),e("span",Bn,[M[12]||(M[12]=e("i",{class:"mdi mdi-remote"},null,-1)),S(" "+u(R.command_count)+" command"+u(R.command_count>1?"s":""),1)])])]),e("div",qn,[e("button",{onClick:X=>t(R),class:"btn btn-primary"},[...M[14]||(M[14]=[e("i",{class:"mdi mdi-plus"},null,-1),S(" Adopt ",-1)])],8,Hn),e("button",{onClick:X=>L(R),class:"btn btn-danger",title:"Delete all commands"},[...M[15]||(M[15]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,zn)])]))),128))])]),e("div",Jn,[e("button",{onClick:M[2]||(M[2]=R=>m.value=!1),class:"btn btn-secondary"}," Close ")])])])):T("",!0),v.value?(n(),a("div",{key:1,class:"modal-overlay",onClick:M[6]||(M[6]=pe(R=>v.value=!1,["self"]))},[e("div",Wn,[e("div",Kn,[M[18]||(M[18]=e("h2",null,"Delete Untracked Device",-1)),e("button",{onClick:M[4]||(M[4]=R=>v.value=!1),class:"close-btn"},[...M[17]||(M[17]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Xn,[e("div",Gn,[M[20]||(M[20]=e("i",{class:"mdi mdi-alert"},null,-1)),e("div",null,[e("p",null,[e("strong",null,'Are you sure you want to delete "'+u((i=_.value)==null?void 0:i.device_name)+'"?',1)]),e("p",null,"This will permanently delete all "+u((g=_.value)==null?void 0:g.command_count)+" command"+u(((p=_.value)==null?void 0:p.command_count)>1?"s":"")+" from Broadlink storage.",1),M[19]||(M[19]=e("p",{class:"warning-text"},"This action cannot be undone.",-1))])])]),e("div",Yn,[e("button",{onClick:M[5]||(M[5]=R=>v.value=!1),class:"btn btn-secondary",disabled:I.value}," Cancel ",8,Zn),e("button",{onClick:q,class:"btn btn-danger",disabled:I.value},[e("i",{class:Z(["mdi",I.value?"mdi-loading mdi-spin":"mdi-delete"])},null,2),S(" "+u(I.value?"Deleting...":"Delete"),1)],8,Qn)])])])):T("",!0)])):T("",!0)}}},ts=he(es,[["__scopeId","data-v-24463050"]]),os={class:"device-list-card"},ls={class:"card-header"},ns={class:"header-badges"},ss={class:"header-info"},as={class:"header-right"},is=["disabled"],rs=["disabled"],ds={class:"card-body"},us={key:0,class:"filter-bar"},cs={class:"filter-row filter-row-search"},ms={class:"filter-group filter-search"},vs={class:"filter-row filter-row-dropdowns"},ps={class:"filter-group"},fs=["value"],gs={class:"filter-group"},ys=["value"],bs={class:"filter-group"},hs={key:0,class:"filter-group filter-toggle"},ks={class:"toggle-label"},ws={class:"view-toggle-group"},$s={class:"filter-results"},Cs={key:1,class:"loading-state"},_s={key:2,class:"error-state"},Ss={key:3,class:"empty-state"},Is={key:4,class:"device-grid"},Ds={key:6,class:"no-results"},xs={__name:"DeviceList",setup(o){const c=it(),r=Ee(),k=y(!1),w=y(!1),s=y(null),m=y(!1),v=y(null),_=y(null),I=y(!0),V=y(!1),b=y(!1),t=y(localStorage.getItem("device_view_mode")||"grid"),L=()=>{I.value=!I.value},q=y(!1),U=y({title:"Error",message:"",suggestion:"",details:"",error:null,context:{}}),M=y(!1),i=y({success:!1,title:"",message:""}),g=y({search:"",broadlinkDevice:"",area:"",entityType:"",showSmartIROnly:!1}),p=y([]),R=Se("smartirStatus"),X=Se("smartirEnabled"),te=J(()=>{var h;return localStorage.getItem("smartir_simulate_not_installed")==="true"?!1:((h=R==null?void 0:R.value)==null?void 0:h.installed)||!1}),le=J(()=>{const $=new Map;return c.devices.forEach(h=>{if(h.broadlink_entity){const j=p.value.find(ee=>ee.entity_id===h.broadlink_entity),O=j&&j.name||h.broadlink_entity;$.set(h.broadlink_entity,{entity_id:h.broadlink_entity,friendly_name:O})}}),Array.from($.values()).sort((h,j)=>h.friendly_name.localeCompare(j.friendly_name))}),ae=J(()=>{const $=new Set;return c.devices.forEach(h=>{h.area&&$.add(h.area)}),Array.from($).sort()}),A=J(()=>{let $=c.devices;if(g.value.search){const j=g.value.search.toLowerCase();$=$.filter(O=>{var re,K,ge,Ce,Ae;if((re=O.name)!=null&&re.toLowerCase().includes(j)||(K=O.entity_type)!=null&&K.toLowerCase().includes(j)||(ge=O.area)!=null&&ge.toLowerCase().includes(j)||(Ce=O.id)!=null&&Ce.toLowerCase().includes(j)||Object.keys(O.commands||{}).some(Re=>Re.toLowerCase().includes(j)))return!0;const ne=p.value.find(Re=>Re.entity_id===O.broadlink_entity);return!!((Ae=ne==null?void 0:ne.name)!=null&&Ae.toLowerCase().includes(j))})}g.value.broadlinkDevice&&($=$.filter(j=>j.broadlink_entity===g.value.broadlinkDevice||j.controller_device===g.value.broadlinkDevice)),g.value.area&&($=$.filter(j=>j.area===g.value.area)),g.value.entityType&&($=$.filter(j=>j.entity_type===g.value.entityType)),g.value.showSmartIROnly&&($=$.filter(j=>j.device_type==="smartir"));const h=localStorage.getItem("smartir_simulate_not_installed")==="true";return(!(X!=null&&X.value)||h)&&($=$.filter(j=>j.device_type!=="smartir")),$}),N=J(()=>g.value.search||g.value.broadlinkDevice||g.value.area||g.value.entityType||g.value.showSmartIROnly),Q=()=>{g.value.search="",g.value.broadlinkDevice="",g.value.area="",g.value.entityType="",g.value.showSmartIROnly=!1},ue=async()=>{try{const $=await oe.get("/api/remote/devices");p.value=$.data.devices||[]}catch($){console.error("Error loading remote devices:",$)}};de(t,$=>{localStorage.setItem("device_view_mode",$)}),xe(async()=>{await Promise.all([c.loadDevices(),ue()])});const ye=$=>{s.value=$,k.value=!0},De=J(()=>{if(!v.value)return"";const $=Object.keys(v.value.commands||{}).length;return $===0?"This device has no commands. The device will be removed from tracking.":`This device has ${$} learned command${$>1?"s":""}. What would you like to do?`}),we=J(()=>{if(!v.value)return"";const $=Object.keys(v.value.commands||{}).length;return $===0?"":`Also delete all ${$} command${$>1?"s":""} from Broadlink storage`}),$e=$=>{v.value=$,m.value=!0},x=()=>{m.value=!1,v.value=null},d=async $=>{var j,O;const h=v.value;m.value=!1;try{await c.deleteDevice(h.id,$),_.value&&await _.value.refresh()}catch(ee){const ne=((O=(j=ee.response)==null?void 0:j.data)==null?void 0:O.error)||ee.message||"Unknown error";B("Failed to Delete Device",ne)}finally{v.value=null}},P=async $=>{var h,j,O,ee,ne;try{console.log("ðŸ’¾ Saving device data:",$),console.log("ðŸ’¾ Device commands:",$.commands),console.log("ðŸ’¾ Selected device:",s.value),(h=s.value)!=null&&h.id&&s.value.id!==null?await c.updateDevice(s.value.id,$):await c.createDevice($),H(),_.value&&await _.value.refresh()}catch(re){let K="Failed to save device",ge="",Ce="";(O=(j=re.response)==null?void 0:j.data)!=null&&O.error?(K=re.response.data.error,ge=re.response.data.suggestion||""):re.message&&(K=re.message),re.response&&(Ce=`Status: ${re.response.status}
URL: ${((ee=re.config)==null?void 0:ee.url)||"N/A"}`),B("Failed to Save Device",K,ge,Ce,re,{action:"save_device",deviceData:$,isEdit:!!((ne=s.value)!=null&&ne.id)})}},H=()=>{k.value=!1,s.value=null},f=$=>{s.value=$,w.value=!0},C=()=>{w.value=!1,s.value=null},B=($,h,j="",O="",ee=null,ne={})=>{U.value={title:$,message:h,suggestion:j,details:O,error:ee,context:ne},q.value=!0},Y=()=>{q.value=!1},se=()=>{M.value=!1},z=async $=>{if($&&$.commands&&s.value){const h=c.devices.findIndex(j=>j.id===s.value.id);h!==-1&&(c.devices[h].commands=$.commands,console.log(`Optimistically updated device ${s.value.id} with new command: ${$.commandName}`))}c.loadDevices(),_.value&&_.value.refresh()},D=$=>{const h=$.split("_"),j=[];for(let O=0;O<h.length;O++){const ee=h[O],ne=h[O+1];ee&&ne==="s"&&h[O+2]?(j.push(ee.charAt(0).toUpperCase()+ee.slice(1)+"'s"),O++):ee!=="s"&&j.push(ee.charAt(0).toUpperCase()+ee.slice(1))}return j.join(" ")},ie=($,h)=>{const j=$.toLowerCase(),O=h.map(K=>K.toLowerCase());return j.includes("lamp")||j.includes("light")?"light":j.includes("fan")?"fan":j.includes("tv")||j.includes("stereo")||j.includes("speaker")||j.includes("receiver")?"media_player":j.includes("blind")||j.includes("curtain")||j.includes("shade")||j.includes("garage")?"cover":O.some(K=>K.includes("volume")||K.includes("channel")||K.includes("play")||K.includes("pause")||K.includes("mute"))?"media_player":O.some(K=>K.includes("fan_speed")||K.includes("fan_low")||K.includes("fan_high"))?"fan":O.some(K=>K.includes("open")||K.includes("close")||K.includes("stop"))?"cover":"switch"},G=($,h)=>{const j=$.toLowerCase();return j.includes("tv")?"mdi:television":j.includes("stereo")||j.includes("receiver")||j.includes("speaker")?"mdi:speaker":j.includes("lamp")?"mdi:lamp":j.includes("light")?"mdi:lightbulb":j.includes("fan")?"mdi:fan":j.includes("blind")?"mdi:blinds":j.includes("curtain")?"mdi:curtains":j.includes("garage")?"mdi:garage":{light:"mdi:lightbulb",fan:"mdi:fan",switch:"mdi:light-switch",media_player:"mdi:speaker",cover:"mdi:window-shutter"}[h]||"mdi:devices"},ce=$=>{const h=$.toLowerCase().split("_");for(let ee=0;ee<h.length-2;ee++)if(h[ee+1]==="s"){const ne=h.slice(ee,ee+3),re=D(ne.join("_"));return console.log("Detected possessive area:",re,"from",$),re}const j=[["living","room"],["dining","room"],["master","bedroom"],["guest","bedroom"],["family","room"],["laundry","room"],["home","office"]];for(let ee=0;ee<h.length-1;ee++){const ne=[h[ee],h[ee+1]],re=j.find(K=>K[0]===ne[0]&&K[1]===ne[1]);if(re)return D(re.join("_"))}const O=["kitchen","bedroom","bathroom","garage","office","basement","attic","hallway","entryway","patio","deck","yard","garden"];for(const ee of h)if(O.includes(ee))return ee.charAt(0).toUpperCase()+ee.slice(1);return""},E=async $=>{const h=D($.device_name),j=ce($.device_name),O=ie($.device_name,$.commands),ee=G($.device_name,O);let ne="";try{console.log("Finding Broadlink owner for:",$.device_name);const K=await oe.post("/api/devices/find-broadlink-owner",{device_name:$.device_name});console.log("Broadlink owner response:",K.data),ne=K.data.broadlink_entity||"",console.log("Detected Broadlink entity:",ne)}catch(K){console.error("Error finding Broadlink owner:",K)}s.value={id:null,device:$.device_name,name:h,entity_type:O,commands:{},area:j,icon:ee,broadlink_entity:ne,enabled:!0};const re={};$.commands.forEach(K=>{re[K]=K}),s.value.commands=re,k.value=!0},l=async()=>{b.value=!0;try{await c.syncAllAreas(),r.success("Areas synced from Home Assistant")}catch($){console.error("Error syncing areas:",$),r.error("Failed to sync areas")}finally{b.value=!1}},F=async({device:$,command:h})=>{var j,O;try{const ee={device_id:$.id,command:h,entity_id:$.broadlink_entity,device:$.device};await oe.post("/api/commands/test",ee),r.success(`Sent ${h} to ${$.name}`)}catch(ee){console.error("Error sending command:",ee);const ne=((O=(j=ee.response)==null?void 0:j.data)==null?void 0:O.error)||ee.message||"Unknown error";r.error(`Failed to send ${h}: ${ne}`)}};return($,h)=>{var j;return n(),a("div",os,[e("div",ls,[e("button",{class:"icon-button chevron-button",onClick:L},[e("i",{class:Z(["mdi",I.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2)]),e("div",{class:"header-left",onClick:L},[h[11]||(h[11]=e("div",{class:"header-icon"},[e("i",{class:"mdi mdi-devices"})],-1)),h[12]||(h[12]=e("h3",null,"Managed Devices",-1)),e("div",ns,[e("span",ss,u(_e(c).deviceCount)+" devices",1)])]),e("div",as,[I.value?(n(),a("button",{key:0,onClick:pe(l,["stop"]),class:"btn btn-secondary",disabled:b.value,title:"Sync all areas from Home Assistant"},[e("i",{class:Z(["mdi",b.value?"mdi-loading mdi-spin":"mdi-refresh"])},null,2),S(" "+u(b.value?"Syncing...":"Sync Areas"),1)],8,is)):T("",!0),I.value?(n(),a("button",{key:1,onClick:h[0]||(h[0]=pe((...O)=>$.generateAllEntities&&$.generateAllEntities(...O),["stop"])),class:"btn btn-secondary",disabled:V.value,title:"Generate entities for all devices"},[e("i",{class:Z(["mdi",V.value?"mdi-loading mdi-spin":"mdi-file-code"])},null,2),S(" "+u(V.value?"Generating...":"Generate Entities"),1)],8,rs)):T("",!0),I.value?(n(),a("button",{key:2,onClick:h[1]||(h[1]=pe(O=>k.value=!0,["stop"])),class:"btn btn-primary"},[...h[13]||(h[13]=[e("i",{class:"mdi mdi-plus"},null,-1),S(" Add Device ",-1)])])):T("",!0)])]),W(e("div",ds,[fe(ts,{ref_key:"discoveryRef",ref:_,onAdopt:E},null,512),_e(c).hasDevices?(n(),a("div",us,[e("div",cs,[e("div",ms,[e("label",null,[h[14]||(h[14]=e("i",{class:"mdi mdi-magnify"},null,-1)),W(e("input",{"onUpdate:modelValue":h[2]||(h[2]=O=>g.value.search=O),type:"text",placeholder:"Search devices, commands...",class:"search-input"},null,512),[[Ie,g.value.search]])])])]),e("div",vs,[e("div",ps,[e("label",null,[h[16]||(h[16]=e("i",{class:"mdi mdi-access-point"},null,-1)),W(e("select",{"onUpdate:modelValue":h[3]||(h[3]=O=>g.value.broadlinkDevice=O)},[h[15]||(h[15]=e("option",{value:""},"All Controller Devices",-1)),(n(!0),a(me,null,be(le.value,O=>(n(),a("option",{key:O.entity_id,value:O.entity_id},u(O.friendly_name),9,fs))),128))],512),[[ke,g.value.broadlinkDevice]])])]),e("div",gs,[e("label",null,[h[18]||(h[18]=e("i",{class:"mdi mdi-home-map-marker"},null,-1)),W(e("select",{"onUpdate:modelValue":h[4]||(h[4]=O=>g.value.area=O)},[h[17]||(h[17]=e("option",{value:""},"All Areas",-1)),(n(!0),a(me,null,be(ae.value,O=>(n(),a("option",{key:O,value:O},u(O),9,ys))),128))],512),[[ke,g.value.area]])])]),e("div",bs,[e("label",null,[h[20]||(h[20]=e("i",{class:"mdi mdi-shape"},null,-1)),W(e("select",{"onUpdate:modelValue":h[5]||(h[5]=O=>g.value.entityType=O)},[...h[19]||(h[19]=[Le('<option value="" data-v-ed5a04a8>All Types</option><option value="light" data-v-ed5a04a8>Light</option><option value="fan" data-v-ed5a04a8>Fan</option><option value="switch" data-v-ed5a04a8>Switch</option><option value="media_player" data-v-ed5a04a8>Media Player</option><option value="cover" data-v-ed5a04a8>Cover</option><option value="climate" data-v-ed5a04a8>Climate</option>',7)])],512),[[ke,g.value.entityType]])])]),te.value?(n(),a("div",hs,[e("label",ks,[h[21]||(h[21]=e("span",{class:"toggle-text"},[e("img",{src:Ne,alt:"SmartIR",class:"smartir-icon"}),S(" SmartIR Only ")],-1)),W(e("input",{type:"checkbox","onUpdate:modelValue":h[6]||(h[6]=O=>g.value.showSmartIROnly=O),class:"toggle-checkbox"},null,512),[[ve,g.value.showSmartIROnly]]),h[22]||(h[22]=e("span",{class:"toggle-slider"},null,-1))])])):T("",!0),N.value?(n(),a("button",{key:1,onClick:Q,class:"btn-clear-filters"},[...h[23]||(h[23]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),S(" Clear ",-1)])])):T("",!0),e("div",ws,[e("button",{onClick:h[7]||(h[7]=O=>t.value="grid"),class:Z(["view-toggle-btn",{active:t.value==="grid"}]),title:"Grid View"},[...h[24]||(h[24]=[e("i",{class:"mdi mdi-view-grid"},null,-1),S(" Grid ",-1)])],2),e("button",{onClick:h[8]||(h[8]=O=>t.value="list"),class:Z(["view-toggle-btn",{active:t.value==="list"}]),title:"List View"},[...h[25]||(h[25]=[e("i",{class:"mdi mdi-view-list"},null,-1),S(" List ",-1)])],2)]),e("div",$s,u(A.value.length)+" of "+u(_e(c).deviceCount),1)])])):T("",!0),_e(c).loading?(n(),a("div",Cs,[...h[26]||(h[26]=[e("i",{class:"mdi mdi-loading mdi-spin"},null,-1),e("p",null,"Loading devices...",-1)])])):_e(c).error?(n(),a("div",_s,[h[27]||(h[27]=e("i",{class:"mdi mdi-alert-circle"},null,-1)),e("p",null,u(_e(c).error),1),e("button",{onClick:h[9]||(h[9]=O=>_e(c).loadDevices()),class:"btn btn-secondary"}," Retry ")])):_e(c).hasDevices?T("",!0):(n(),a("div",Ss,[h[29]||(h[29]=e("i",{class:"mdi mdi-devices"},null,-1)),h[30]||(h[30]=e("h3",null,"No Devices Yet",-1)),h[31]||(h[31]=e("p",null,"Get started by adding your first managed device",-1)),e("button",{onClick:h[10]||(h[10]=O=>k.value=!0),class:"btn btn-primary"},[...h[28]||(h[28]=[e("i",{class:"mdi mdi-plus"},null,-1),S(" Add Your First Device ",-1)])])])),t.value==="grid"?(n(),a("div",Is,[(n(!0),a(me,null,be(A.value,O=>(n(),Te(Rt,{key:O.id,device:O,"broadlink-devices":p.value,onEdit:ye,onDelete:$e,onLearn:f},null,8,["device","broadlink-devices"]))),128))])):t.value==="list"&&A.value.length>0?(n(),Te(Xt,{key:5,devices:A.value,onSendCommand:F,onEditDevice:ye,onDeleteDevice:$e},null,8,["devices"])):T("",!0),_e(c).hasDevices&&A.value.length===0?(n(),a("div",Ds,[...h[32]||(h[32]=[e("i",{class:"mdi mdi-filter-off"},null,-1),e("h3",null,"No devices match your filters",-1),e("p",null,"Try adjusting your search or filter criteria",-1)])])):T("",!0)],512),[[Xe,I.value]]),k.value?(n(),Te(_l,{key:0,device:s.value,onSave:P,onCancel:H},null,8,["device"])):T("",!0),w.value?(n(),Te(kn,{key:1,device:s.value,onLearned:z,onCancel:C},null,8,["device"])):T("",!0),fe(Me,{isOpen:m.value,title:`Delete ${(j=v.value)==null?void 0:j.name}?`,message:De.value,confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,checkboxLabel:we.value,onConfirm:d,onCancel:x},null,8,["isOpen","title","message","checkboxLabel"]),fe(An,{isOpen:q.value,title:U.value.title,message:U.value.message,suggestion:U.value.suggestion,details:U.value.details,error:U.value.error,context:U.value.context,onClose:Y},null,8,["isOpen","title","message","suggestion","details","error","context"]),fe(Me,{isOpen:M.value,title:i.value.title,message:i.value.message,confirmText:"OK",showCancel:!1,dangerMode:!i.value.success,onConfirm:se,onCancel:se},null,8,["isOpen","title","message","dangerMode"])])}}},Ts=he(xs,[["__scopeId","data-v-ed5a04a8"]]),Rs={class:"banner-content"},Ms={class:"banner-icon"},As={class:"banner-message"},Ls={class:"banner-actions"},Os={__name:"SmartIRBanner",setup(o){const c=Se("smartirStatus"),r=y(!1),k=J(()=>!(!c.value||r.value||localStorage.getItem("smartir_banner_dismissed")==="true")),w=J(()=>{var V;return(V=c.value)!=null&&V.installed?"banner-success":"banner-info"}),s=J(()=>{var V;return(V=c.value)!=null&&V.installed?"mdi mdi-check-circle":"mdi mdi-information"}),m=J(()=>{var V;return(V=c.value)!=null&&V.installed?`SmartIR Detected (v${c.value.version})`:"Want Climate Device Support?"}),v=J(()=>{var V;return(V=c.value)!=null&&V.installed?"You can now create climate device profiles with full temperature and HVAC mode control.":"Install SmartIR to unlock AC/heater control with temperature settings, HVAC modes, and 120+ pre-configured device profiles."});function _(){window.open("https://github.com/smartHomeHub/SmartIR","_blank")}function I(){var V;if(r.value=!0,(V=c.value)!=null&&V.installed)localStorage.setItem("smartir_banner_dismissed","true");else{const b=parseInt(localStorage.getItem("smartir_banner_dismiss_count")||"0");b>=2?localStorage.setItem("smartir_banner_dismissed","true"):localStorage.setItem("smartir_banner_dismiss_count",String(b+1))}}return xe(()=>{var t;const V=localStorage.getItem("smartir_last_status"),b=(t=c.value)!=null&&t.installed?"installed":"not_installed";V!==b&&(localStorage.removeItem("smartir_banner_dismissed"),localStorage.removeItem("smartir_banner_dismiss_count"),localStorage.setItem("smartir_last_status",b))}),(V,b)=>{var t,L;return k.value?(n(),a("div",{key:0,class:Z(["smartir-banner",w.value])},[e("div",Rs,[e("div",Ms,[e("i",{class:Z(s.value)},null,2)]),e("div",As,[e("strong",null,u(m.value),1),e("p",null,u(v.value),1)]),e("div",Ls,[(t=V.status)!=null&&t.installed?T("",!0):(n(),a("button",{key:0,onClick:_,class:"btn-primary"}," Learn More ")),e("button",{onClick:I,class:"btn-text"},u((L=V.status)!=null&&L.installed?"Got it":"Dismiss"),1)])])],2)):T("",!0)}}},Es=he(Os,[["__scopeId","data-v-7bbcbcd7"]]),Oe="api/smartir",Ye={async getStatus(){try{const o=await fetch(`${Oe}/status`);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return await o.json()}catch(o){return console.error("Error fetching SmartIR status:",o),{installed:!1,version:null,error:o.message}}},async getInstallInstructions(){try{const o=await fetch(`${Oe}/install-instructions`);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return await o.json()}catch(o){throw console.error("Error fetching install instructions:",o),o}},async getPlatforms(){try{const o=await fetch(`${Oe}/platforms`);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return await o.json()}catch(o){throw console.error("Error fetching platforms:",o),o}},async getPlatformCodes(o){try{const c=await fetch(`${Oe}/platforms/${o}/codes`);if(!c.ok)throw new Error(`HTTP error! status: ${c.status}`);return await c.json()}catch(c){throw console.error(`Error fetching codes for ${o}:`,c),c}},async getNextCode(o){try{const c=await fetch(`${Oe}/platforms/${o}/next-code`);if(!c.ok)throw new Error(`HTTP error! status: ${c.status}`);return await c.json()}catch(c){throw console.error(`Error fetching next code for ${o}:`,c),c}},async validateCode(o,c){try{const r=await fetch(`${Oe}/validate-code`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({platform:o,code:c})});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);return await r.json()}catch(r){throw console.error("Error validating code:",r),r}}},Vs={class:"profile-card"},Us={class:"profile-card-header"},Ps=["title"],js={class:"profile-details"},Fs=["title"],Ns={class:"profile-meta"},Bs=["title"],qs=["title"],Hs=["title"],zs={class:"profile-card-footer"},Js=["title"],Ws={key:0,class:"learned-indicator"},Ks={class:"profile-actions"},Xs={__name:"SmartIRProfileCard",props:{profile:{type:Object,required:!0}},emits:["edit","download","delete","commands"],setup(o){const c=o,r=Ge(J(()=>c.profile.platform)),k=m=>m.replace(/_/g," ").replace(/\b\w/g,v=>v.toUpperCase()),w=m=>m&&m.startsWith("mdi:")?`mdi ${m.replace(":"," mdi-")}`:`mdi mdi-${m}`,s=m=>{if(!m)return"";const v=m.toLowerCase();return v.includes("broadlink")?"broadlink-tag":v.includes("not set")?"not-set-tag":"default-controller-tag"};return(m,v)=>(n(),a("div",Vs,[e("div",Us,[e("div",{class:Z(["profile-icon",_e(r).colorClass.value]),title:k(o.profile.platform)},[e("i",{class:Z(w(_e(r).icon.value))},null,2)],10,Ps),e("div",js,[e("h4",{title:`${o.profile.manufacturer} ${o.profile.model}`},u(o.profile.manufacturer)+" "+u(o.profile.model),9,Fs),e("div",Ns,[e("span",{class:"tag platform-tag",title:k(o.profile.platform)},u(k(o.profile.platform)),9,Bs),o.profile.controllerBrand?(n(),a("span",{key:0,class:Z(["tag controller-tag",s(o.profile.controllerBrand)]),title:"Controller: "+o.profile.controllerBrand},[v[4]||(v[4]=e("i",{class:"mdi mdi-remote-tv"},null,-1)),S(" "+u(o.profile.controllerBrand),1)],10,qs)):T("",!0)])]),e("div",{class:"code-badge",title:"Device Code: "+o.profile.code},u(o.profile.code),9,Hs)]),e("div",zs,[e("div",{class:"profile-stats",title:o.profile.commandCount+" total commands"+(o.profile.learnedCount>0?", "+o.profile.learnedCount+" learned":"")},[v[5]||(v[5]=e("i",{class:"mdi mdi-remote"},null,-1)),e("span",null,u(o.profile.commandCount)+" command"+u(o.profile.commandCount!==1?"s":""),1),o.profile.learnedCount>0?(n(),a("span",Ws,"( "+u(o.profile.learnedCount)+" learned )",1)):T("",!0)],8,Js),e("div",Ks,[e("button",{onClick:v[0]||(v[0]=_=>m.$emit("commands")),class:"action-btn",title:"Commands"},[...v[6]||(v[6]=[e("i",{class:"mdi mdi-remote"},null,-1)])]),e("button",{onClick:v[1]||(v[1]=_=>m.$emit("edit")),class:"action-btn",title:"Edit Profile"},[...v[7]||(v[7]=[e("i",{class:"mdi mdi-pencil"},null,-1)])]),e("button",{onClick:v[2]||(v[2]=_=>m.$emit("download")),class:"action-btn",title:"Download JSON"},[...v[8]||(v[8]=[e("i",{class:"mdi mdi-download"},null,-1)])]),e("button",{onClick:v[3]||(v[3]=_=>m.$emit("delete")),class:"action-btn delete",title:"Delete Profile"},[...v[9]||(v[9]=[e("i",{class:"mdi mdi-delete"},null,-1)])])])])]))}},Gs=he(Xs,[["__scopeId","data-v-b72a1955"]]),Ys={name:"SmartIRProfileListView",props:{profiles:{type:Array,required:!0}},methods:{getPlatformIcon(o){return{climate:"mdi-thermostat",media_player:"mdi-television",fan:"mdi-fan",light:"mdi-lightbulb"}[o]||"mdi-devices"},formatPlatform(o){return{climate:"Climate",media_player:"Media Player",fan:"Fan",light:"Light"}[o]||o},editProfile(o){this.$emit("edit",o)},viewCommands(o){this.$emit("commands",o)},downloadProfile(o){this.$emit("download",o)},deleteProfile(o){this.$emit("delete",o)}}},Zs={class:"profile-list-view"},Qs={class:"profile-table"},ea={class:"profile-code"},ta={class:"code-badge"},oa={class:"profile-manufacturer"},la={class:"profile-model"},na={class:"model-info"},sa={class:"model-name"},aa={key:0,class:"model-count"},ia={class:"profile-platform"},ra={class:"profile-controller"},da={class:"profile-commands"},ua={class:"command-stats"},ca={class:"stat-item"},ma={key:0,class:"stat-item learned"},va={class:"profile-actions"},pa=["onClick"],fa=["onClick"],ga=["onClick"],ya=["onClick"];function ba(o,c,r,k,w,s){return n(),a("div",Zs,[e("table",Qs,[c[6]||(c[6]=e("thead",null,[e("tr",null,[e("th",null,"Code"),e("th",null,"Manufacturer"),e("th",null,"Model"),e("th",null,"Platform"),e("th",null,"Controller"),e("th",null,"Commands"),e("th",null,"Actions")])],-1)),e("tbody",null,[(n(!0),a(me,null,be(r.profiles,m=>(n(),a("tr",{key:`${m.platform}-${m.code}`,class:"profile-row"},[e("td",ea,[e("span",ta,u(m.code),1)]),e("td",oa,u(m.manufacturer||"Unknown"),1),e("td",la,[e("div",na,[e("div",sa,u(m.model||"Unknown"),1),m.models&&m.models.length>1?(n(),a("div",aa," +"+u(m.models.length-1)+" more ",1)):T("",!0)])]),e("td",ia,[e("span",{class:Z(["platform-badge",m.platform])},[e("i",{class:Z(["mdi",s.getPlatformIcon(m.platform)])},null,2),S(" "+u(s.formatPlatform(m.platform)),1)],2)]),e("td",ra,u(m.controller_brand||"N/A"),1),e("td",da,[e("div",ua,[e("span",ca,[c[0]||(c[0]=e("i",{class:"mdi mdi-remote"},null,-1)),S(" "+u(m.command_count||0),1)]),m.learned_count>0?(n(),a("span",ma,[c[1]||(c[1]=e("i",{class:"mdi mdi-school"},null,-1)),S(" "+u(m.learned_count),1)])):T("",!0)])]),e("td",va,[e("button",{class:"action-btn edit",onClick:v=>s.editProfile(m),title:"Edit Profile"},[...c[2]||(c[2]=[e("i",{class:"mdi mdi-pencil"},null,-1)])],8,pa),e("button",{class:"action-btn commands",onClick:v=>s.viewCommands(m),title:"View Commands"},[...c[3]||(c[3]=[e("i",{class:"mdi mdi-remote"},null,-1)])],8,fa),e("button",{class:"action-btn download",onClick:v=>s.downloadProfile(m),title:"Download"},[...c[4]||(c[4]=[e("i",{class:"mdi mdi-download"},null,-1)])],8,ga),e("button",{class:"action-btn delete",onClick:v=>s.deleteProfile(m),title:"Delete"},[...c[5]||(c[5]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,ya)])]))),128))])])])}const ha=he(Ys,[["render",ba],["__scopeId","data-v-8e144275"]]),ka={class:"modal-container"},wa={class:"modal-body"},$a={key:0,class:"selection-section"},Ca={class:"form-group"},_a={class:"form-group"},Sa={class:"form-group"},Ia={key:0,class:"code-info"},Da={class:"form-actions"},xa=["disabled"],Ta={key:1,class:"testing-section"},Ra={class:"code-header"},Ma={class:"code-details"},Aa={class:"code-badge"},La={class:"device-selector"},Oa=["value"],Ea={class:"commands-section"},Va={class:"commands-header"},Ua={key:0,class:"tested-count"},Pa={key:0,class:"filters-section"},ja={class:"filter-row"},Fa={class:"filter-row"},Na={key:1,class:"empty-state"},Ba={key:2,class:"empty-state"},qa={key:3,class:"commands-list"},Ha={class:"command-name"},za={class:"command-actions"},Ja={key:0,class:"status-badge success"},Wa=["onClick","disabled"],Ka={__name:"SmartIRCodeTester",props:{isOpen:{type:Boolean,default:!1}},emits:["close","clone"],setup(o,{emit:c}){const r=o,k=c,w=Se("toast"),s=y("climate"),m=y(""),v=y([]),_=y(!1),I=y(null),V=y(""),b=y([]),t=y(!1),L=J(()=>b.value.map(z=>({code:z.code,label:`${z.models.join(", ")} (Code: ${z.code})`,value:z.code}))),q=y(null),U=y(null),M=y(!1),i=y([]),g=y(""),p=y([]),R=y(new Set),X=y(null),te=y(""),le=y(""),ae=y(""),A=y(""),N=J(()=>{let z=p.value;if(te.value){const D=te.value.toLowerCase();z=z.filter(ie=>(ie.label||ie.name).toLowerCase().includes(D))}return le.value&&(z=z.filter(D=>D.mode===le.value)),ae.value&&(z=z.filter(D=>D.fanSpeed===ae.value)),A.value&&(z=z.filter(D=>D.swingMode===A.value)),z}),Q=J(()=>te.value||le.value||ae.value||A.value);de(()=>r.isOpen,z=>{z&&(ue(),De())}),de(s,()=>{r.isOpen&&(m.value="",I.value=null,b.value=[],ue())});async function ue(){var z;_.value=!0;try{const D=await oe.get("/api/smartir/codes/manufacturers",{params:{entity_type:s.value}});v.value=D.data.manufacturers||[]}catch(D){console.error("Error loading manufacturers:",D),(z=w.value)==null||z.error("Failed to load manufacturers","âŒ Error")}finally{_.value=!1}}async function ye(){var z;if(m.value){t.value=!0;try{const D=await oe.get("/api/smartir/codes/models",{params:{entity_type:s.value,manufacturer:m.value}});b.value=D.data.models||[]}catch(D){console.error("Error loading models:",D),(z=w.value)==null||z.error("Failed to load models","âŒ Error")}finally{t.value=!1}}}async function De(){try{const z=await oe.get("/api/remote/devices");i.value=z.data.devices||[]}catch(z){console.error("Error loading Broadlink devices:",z)}}async function we(){var z,D;if(I.value){M.value=!0;try{const ie=await oe.get("/api/smartir/codes/code",{params:{entity_type:s.value,code_id:I.value.code}});U.value=ie.data.code,q.value=I.value.code,$e(ie.data.code),(z=w.value)==null||z.success(`Loaded ${p.value.length} commands`,"âœ… Code Loaded")}catch(ie){console.error("Error loading code:",ie),(D=w.value)==null||D.error(ie.message||"Failed to load code","âŒ Error")}finally{M.value=!1}}}function $e(z){const D=[];if(!z.commands){p.value=D;return}if(s.value==="climate"){const G=z.commands;for(const[ce,E]of Object.entries(G)){if(ce==="off"){typeof E=="string"&&D.push({name:"off",label:"OFF",data:E,mode:"off"});continue}if(typeof E=="object"){for(const[l,F]of Object.entries(E))if(typeof F=="object")for(const[$,h]of Object.entries(F)){if(typeof h!="object")continue;const j=Object.keys(h),O=j.includes("24")?"24":j[0];if(O&&typeof h[O]=="string"){const ee=`${ce}_${O}_${l}_${$}`,ne=`${ce.toUpperCase()} ${O}Â°C ${l} ${$}`;D.push({name:ee,label:ne,data:h[O],mode:ce,temperature:O,fanSpeed:l,swingMode:$})}}}}}else for(const[G,ce]of Object.entries(z.commands))typeof ce=="string"&&D.push({name:G,label:G.toUpperCase().replace(/_/g," "),data:ce});p.value=D}async function x(z){var D,ie,G;if(!g.value){(D=w.value)==null||D.warning("Please select a Broadlink device first","âš ï¸ No Device");return}X.value=z;try{const ce=p.value.find(E=>E.name===z);if(!ce||!ce.data)throw new Error(`Command "${z}" not found`);await oe.post("/api/commands/send-raw",{entity_id:g.value,command:ce.data,command_type:"ir"}),R.value.add(z),(ie=w.value)==null||ie.success(`Command sent: ${ce.label||z}`,"âœ… Tested")}catch(ce){console.error("Error testing command:",ce),(G=w.value)==null||G.error("Failed to test command","âŒ Error")}finally{X.value=null}}function d(){var z,D,ie,G;if(!U.value){(z=w.value)==null||z.error("No profile data to download","âŒ Error");return}try{const ce=U.value.manufacturer||"unknown",E=((D=U.value.supportedModels)==null?void 0:D[0])||q.value,l=`${ce.toLowerCase().replace(/\s+/g,"_")}_${E.toLowerCase().replace(/\s+/g,"_")}.json`,F=JSON.stringify(U.value,null,2),$=new Blob([F],{type:"application/json"}),h=URL.createObjectURL($),j=document.createElement("a");j.href=h,j.download=l,document.body.appendChild(j),j.click(),document.body.removeChild(j),URL.revokeObjectURL(h),(ie=w.value)==null||ie.success(`Downloaded ${l}`,"âœ… Download Complete")}catch(ce){console.error("Error downloading JSON:",ce),(G=w.value)==null||G.error(ce.message||"Failed to download JSON","âŒ Download Error")}}function P(){m.value="",I.value=null,V.value="",b.value=[]}function H(){I.value=null,V.value="",ye()}function f(){V.value?I.value=b.value.find(z=>z.code===V.value):I.value=null}function C(){te.value="",le.value="",ae.value="",A.value=""}function B(){q.value=null,U.value=null,p.value=[],R.value.clear(),X.value=null,C()}function Y(z){const D=z.toLowerCase();return D.includes("power")||D.includes("off")||D==="off"?"mdi-power":D.includes("cool")?"mdi-snowflake":D.includes("heat")?"mdi-fire":D.includes("fan")?"mdi-fan":D.includes("auto")?"mdi-auto-fix":D.includes("dry")?"mdi-water-percent":D.includes("temp")?"mdi-thermometer":D.includes("swing")?"mdi-swap-vertical":"mdi-remote"}function se(){B(),m.value="",I.value=null,k("close")}return(z,D)=>{var ie;return o.isOpen?(n(),a("div",{key:0,class:"modal-overlay",onClick:pe(se,["self"])},[e("div",ka,[e("div",{class:"modal-header"},[D[9]||(D[9]=e("h3",null,[e("i",{class:"mdi mdi-test-tube"}),S(" Test SmartIR Code ")],-1)),e("button",{onClick:se,class:"close-btn"},[...D[8]||(D[8]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",wa,[q.value?(n(),a("div",Ta,[e("div",Ra,[e("div",Ma,[e("h4",null,u(U.value.manufacturer)+" - "+u(((ie=U.value.supportedModels)==null?void 0:ie[0])||"Unknown"),1),e("span",Aa,"Code: "+u(q.value),1)]),e("button",{onClick:B,class:"btn-secondary-small"},[...D[14]||(D[14]=[e("i",{class:"mdi mdi-arrow-left"},null,-1),S(" Change Code ",-1)])])]),e("div",La,[D[16]||(D[16]=e("label",null,[e("i",{class:"mdi mdi-remote"}),S(" Broadlink Device ")],-1)),W(e("select",{"onUpdate:modelValue":D[3]||(D[3]=G=>g.value=G),class:"form-select"},[D[15]||(D[15]=e("option",{value:""},"Select device to test with...",-1)),(n(!0),a(me,null,be(i.value,G=>(n(),a("option",{key:G.entity_id,value:G.entity_id},u(G.friendly_name||G.entity_id),9,Oa))),128))],512),[[ke,g.value]])]),e("div",Ea,[e("div",Va,[e("h5",null,"Sample Commands ("+u(N.value.length)+" / "+u(p.value.length)+")",1),R.value.size>0?(n(),a("span",Ua,u(R.value.size)+" tested ",1)):T("",!0)]),s.value==="climate"&&p.value.length>0?(n(),a("div",Pa,[e("div",ja,[W(e("input",{"onUpdate:modelValue":D[4]||(D[4]=G=>te.value=G),type:"text",placeholder:"Search commands...",class:"search-input"},null,512),[[Ie,te.value]])]),e("div",Fa,[W(e("select",{"onUpdate:modelValue":D[5]||(D[5]=G=>le.value=G),class:"filter-select"},[...D[17]||(D[17]=[e("option",{value:""},"All Modes",-1),e("option",{value:"cool"},"Cool",-1),e("option",{value:"heat"},"Heat",-1),e("option",{value:"off"},"Off",-1)])],512),[[ke,le.value]]),W(e("select",{"onUpdate:modelValue":D[6]||(D[6]=G=>ae.value=G),class:"filter-select"},[...D[18]||(D[18]=[Le('<option value="" data-v-d1d8935f>All Fan Speeds</option><option value="low" data-v-d1d8935f>Low</option><option value="mid" data-v-d1d8935f>Mid</option><option value="high" data-v-d1d8935f>High</option><option value="auto" data-v-d1d8935f>Auto</option>',5)])],512),[[ke,ae.value]]),W(e("select",{"onUpdate:modelValue":D[7]||(D[7]=G=>A.value=G),class:"filter-select"},[...D[19]||(D[19]=[e("option",{value:""},"All Swing",-1),e("option",{value:"stop"},"Stop",-1),e("option",{value:"swing"},"Swing",-1)])],512),[[ke,A.value]]),Q.value?(n(),a("button",{key:0,onClick:C,class:"btn-clear-filters"},[...D[20]||(D[20]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),S(" Clear ",-1)])])):T("",!0)])])):T("",!0),p.value.length===0?(n(),a("div",Na,[...D[21]||(D[21]=[e("i",{class:"mdi mdi-alert-circle"},null,-1),e("p",null,"No commands found in this code",-1)])])):N.value.length===0?(n(),a("div",Ba,[D[22]||(D[22]=e("i",{class:"mdi mdi-filter-off"},null,-1)),D[23]||(D[23]=e("p",null,"No commands match your filters",-1)),e("button",{onClick:C,class:"btn-secondary-small"}," Clear Filters ")])):(n(),a("div",qa,[(n(!0),a(me,null,be(N.value,G=>(n(),a("div",{key:G.name,class:Z(["command-item",{tested:R.value.has(G.name),testing:X.value===G.name}])},[e("div",Ha,[e("i",{class:Z(["mdi",Y(G.mode||G.name)])},null,2),e("span",null,u(G.label||G.name),1)]),e("div",za,[R.value.has(G.name)?(n(),a("span",Ja,[...D[24]||(D[24]=[e("i",{class:"mdi mdi-check"},null,-1),S(" Tested ",-1)])])):T("",!0),e("button",{onClick:ce=>x(G.name),disabled:!g.value||X.value===G.name,class:"btn-test"},[e("i",{class:Z(["mdi",X.value===G.name?"mdi-loading mdi-spin":"mdi-play"])},null,2),D[25]||(D[25]=S(" Test ",-1))],8,Wa)])],2))),128))]))]),e("div",{class:"modal-actions"},[e("button",{onClick:d,class:"btn-primary"},[...D[26]||(D[26]=[e("i",{class:"mdi mdi-download"},null,-1),S(" Download JSON ",-1)])]),e("button",{onClick:se,class:"btn-secondary"}," Close ")])])):(n(),a("div",$a,[D[13]||(D[13]=e("div",{class:"info-banner"},[e("i",{class:"mdi mdi-information"}),e("p",null,"Select a SmartIR code from the index to test commands with your Broadlink device.")],-1)),e("div",Ca,[D[11]||(D[11]=e("label",null,[e("i",{class:"mdi mdi-shape"}),S(" Platform ")],-1)),W(e("select",{"onUpdate:modelValue":D[0]||(D[0]=G=>s.value=G),onChange:P,class:"form-select"},[...D[10]||(D[10]=[e("option",{value:"climate"},"Climate (AC/Heater)",-1),e("option",{value:"media_player"},"Media Player (TV/Audio)",-1),e("option",{value:"fan"},"Fan",-1),e("option",{value:"light"},"Light",-1)])],544),[[ke,s.value]])]),e("div",_a,[fe(je,{modelValue:m.value,"onUpdate:modelValue":D[1]||(D[1]=G=>m.value=G),options:v.value,label:"Manufacturer",placeholder:"Search manufacturers...",loading:_.value,disabled:_.value,onChange:H},null,8,["modelValue","options","loading","disabled"])]),e("div",Sa,[fe(je,{modelValue:V.value,"onUpdate:modelValue":D[2]||(D[2]=G=>V.value=G),options:L.value,"option-label":"label","option-value":"code",label:"Model",placeholder:"Search models...",loading:t.value,disabled:!m.value||t.value,onChange:f},null,8,["modelValue","options","loading","disabled"])]),I.value?(n(),a("div",Ia,[D[12]||(D[12]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[e("strong",null,u(m.value)+" - "+u(I.value.models[0]),1),e("p",null,"Code: "+u(I.value.code),1)])])):T("",!0),e("div",Da,[e("button",{onClick:we,disabled:!I.value||M.value,class:"btn-primary"},[e("i",{class:Z(["mdi",M.value?"mdi-loading mdi-spin":"mdi-download"])},null,2),S(" "+u(M.value?"Loading...":"Load Commands"),1)],8,xa)])]))])])])):T("",!0)}}},Xa=he(Ka,[["__scopeId","data-v-d1d8935f"]]),Ga={class:"smartir-status-card"},Ya={class:"card-header"},Za=["src"],Qa={class:"header-badges"},ei=["title"],ti={class:"header-info"},oi={class:"header-info"},li={class:"header-info"},ni={class:"header-right"},si={key:0,class:"card-body loading-state"},ai={key:1,class:"card-body error-state"},ii={key:2,class:"card-body installed-state"},ri={key:0,class:"help-panel"},di={key:0,class:"recommendation"},ui={key:0,class:"next-steps"},ci={class:"help-actions"},mi={key:1,class:"filter-bar"},vi={class:"filter-row"},pi={class:"filter-group filter-search"},fi={class:"filter-group"},gi={class:"view-toggle-group"},yi={class:"filter-results"},bi={key:2,class:"loading-state"},hi={key:3,class:"empty-state"},ki={key:4,class:"profiles-grid"},wi={key:6,class:"no-results"},$i={key:3,class:"card-body not-installed-state"},Ci={class:"benefits-section"},_i={class:"benefits-list"},Si={class:"recommendation"},Ii={__name:"SmartIRStatusCard",emits:["create-profile","edit-profile"],setup(o,{expose:c,emit:r}){const k=r,w=Se("smartirStatus");Se("smartirEnabled");const s=Se("refreshSmartIR"),m=y(!1),v=y(null),_=y((w==null?void 0:w.value)||null),I=y(localStorage.getItem("smartir_simulate_not_installed")==="true"),V=y(!1),b=y(!0),t=y([]),L=y(!1),q=y({search:"",platform:""}),U=y({show:!1,title:"",message:"",platform:null,profile:null}),M=y(!1),i=y(localStorage.getItem("profile_view_mode")||"grid"),g=["Full climate entity support (AC, heaters)","120+ pre-configured device profiles","Temperature and humidity sensor integration","HVAC mode control (heat, cool, auto, dry, fan)"],p=["climate","media_player","fan","light"],R=J(()=>I.value?{installed:!1,recommendation:{message:"Install SmartIR to unlock climate device support!",benefits:["Full climate entity support (AC, heaters)","120+ pre-configured device profiles","Temperature and humidity sensor integration","HVAC mode control (heat, cool, auto, dry, fan)"]}}:_.value),X=J(()=>{var H,f;return((f=(H=R.value)==null?void 0:H.platforms)==null?void 0:f.length)||0}),te=J(()=>{var H;return(H=R.value)!=null&&H.device_counts?Object.values(R.value.device_counts).reduce((f,C)=>f+C,0):0});function le(){var H;I.value=!I.value,localStorage.setItem("smartir_simulate_not_installed",I.value.toString()),!I.value&&((H=_.value)!=null&&H.installed)&&we()}const ae=J(()=>{let H=t.value;if(q.value.search){const f=q.value.search.toLowerCase();H=H.filter(C=>{var B,Y,se,z;return((B=C.manufacturer)==null?void 0:B.toLowerCase().includes(f))||((Y=C.model)==null?void 0:Y.toLowerCase().includes(f))||((se=C.code)==null?void 0:se.toString().includes(f))||((z=C.platform)==null?void 0:z.toLowerCase().includes(f))})}return q.value.platform&&(H=H.filter(f=>f.platform===q.value.platform)),H}),A=J(()=>q.value.search||q.value.platform);function N(){q.value.search="",q.value.platform=""}async function Q(){m.value=!0,v.value=null;try{if(s)await s();else{const H=await Ye.getStatus();_.value=H}}catch(H){v.value=H.message||"Failed to refresh SmartIR status",console.error("Error refreshing SmartIR status:",H)}finally{m.value=!1}}function ue(){k("create-profile")}function ye(){M.value=!0}function De(){window.open("https://github.com/smartHomeHub/SmartIR","_blank")}async function we(){L.value=!0;const H=[];try{for(const f of p)try{const B=((await oe.get(`/api/smartir/platforms/${f}/profiles`)).data.profiles||[]).map(Y=>({...Y,platform:f}));H.push(...B)}catch(C){console.warn(`Network error loading ${f} profiles (using bundled index):`,C.message)}t.value=H}catch(f){console.error("Unexpected error loading profiles:",f)}finally{L.value=!1}}function $e(H,f,C){k("edit-profile",{platform:H,profile:f,startStep:C})}async function x(H,f){var C,B;try{const se=(await oe.get(`/api/smartir/platforms/${H}/profiles/${f.code}`)).data,z=JSON.stringify(se.profile,null,2),D=new Blob([z],{type:"application/json"}),ie=URL.createObjectURL(D),G=document.createElement("a");G.href=ie,G.download=`smartir_${H}_${f.manufacturer}_${f.model}_${f.code}.json`,document.body.appendChild(G),G.click(),document.body.removeChild(G),URL.revokeObjectURL(ie),(C=Se("toast").value)==null||C.success(`Downloaded ${f.manufacturer} ${f.model}`,"âœ… Profile Downloaded")}catch(Y){console.error("Error downloading profile:",Y),(B=Se("toast").value)==null||B.error("Failed to download profile","âŒ Download Error")}}async function d(H,f){Se("toast");try{const B=(await oe.post(`/api/smartir/profiles/${f.code}/check-usage`,{platform:H})).data;if(B&&B.in_use){U.value={show:!0,title:`Cannot Delete ${f.manufacturer} ${f.model}`,message:`This profile is currently in use by ${B.device_count} device(s):

${B.devices.join(`
`)}

Please remove or reassign these devices before deleting the profile.`,platform:H,profile:f,canDelete:!1,devices:B.devices};return}}catch(C){console.error("Error checking profile usage:",C)}U.value={show:!0,title:`Delete ${f.manufacturer} ${f.model}?`,message:`Device Code: ${f.code}

This will remove the profile and update your configuration.`,platform:H,profile:f,canDelete:!0}}async function P(){var B,Y;const H=Se("toast"),{platform:f,profile:C}=U.value;U.value.show=!1;try{await oe.delete(`/api/smartir/profiles/${C.code}`,{data:{platform:f}}),await we(),await We(),await Q(),(B=H.value)==null||B.success(`${C.manufacturer} ${C.model} has been removed`,"âœ… Profile Deleted")}catch(se){console.error("Error deleting profile:",se),(Y=H.value)==null||Y.error("Failed to delete profile","âŒ Delete Error")}}return de(w,H=>{H&&(_.value=H)},{immediate:!0}),de(i,H=>{localStorage.setItem("profile_view_mode",H)}),xe(async()=>{var H;w!=null&&w.value&&(_.value=w.value),_.value||await Q(),(H=_.value)!=null&&H.installed&&await we()}),c({loadAllProfiles:we,refreshStatus:Q}),(H,f)=>{var C,B,Y,se,z,D,ie,G,ce,E;return n(),a("div",Ga,[e("div",Ya,[e("button",{class:"icon-button chevron-button",onClick:f[0]||(f[0]=l=>b.value=!b.value)},[e("i",{class:Z(["mdi",b.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2)]),e("div",{class:"header-left",onClick:f[1]||(f[1]=l=>b.value=!b.value)},[e("img",{src:_e(Ne),alt:"SmartIR",class:"smartir-logo"},null,8,Za),f[15]||(f[15]=e("h3",null,"SmartIR Integration",-1)),e("div",Qa,[e("div",{class:Z(["simulation-toggle-pill",{active:I.value}]),onClick:pe(le,["stop"]),title:I.value?"Click to show as installed":"Click to simulate not-installed"},[e("i",{class:Z(["mdi",I.value?"mdi-eye-off":"mdi-eye"])},null,2),e("span",null,u(I.value?"Simulating: Not Installed":"Simulation Mode"),1)],10,ei),(C=R.value)!=null&&C.installed?(n(),a(me,{key:0},[f[14]||(f[14]=e("div",{class:"status-badge-mini success"},[e("i",{class:"mdi mdi-check-circle"}),e("span",null,"Installed")],-1)),e("span",ti,"v"+u(R.value.version||"Unknown"),1),e("span",oi,u(X.value)+" platform"+u(X.value!==1?"s":""),1),e("span",li,u(te.value)+" device"+u(te.value!==1?"s":""),1)],64)):T("",!0)])]),e("div",ni,[(B=R.value)!=null&&B.installed&&b.value?(n(),a("button",{key:0,onClick:f[2]||(f[2]=pe(l=>V.value=!V.value,["stop"])),class:Z(["icon-button",{active:V.value}]),title:"Show help"},[...f[16]||(f[16]=[e("i",{class:"mdi mdi-help-circle"},null,-1)])],2)):T("",!0),(Y=R.value)!=null&&Y.installed&&b.value?(n(),a("button",{key:1,onClick:pe(Q,["stop"]),class:"icon-button",title:"Refresh status"},[...f[17]||(f[17]=[e("i",{class:"mdi mdi-refresh"},null,-1)])])):T("",!0),(se=R.value)!=null&&se.installed&&b.value?(n(),a("button",{key:2,onClick:pe(ye,["stop"]),class:"btn btn-secondary"},[...f[18]||(f[18]=[e("i",{class:"mdi mdi-test-tube"},null,-1),S(" Test Codes ",-1)])])):T("",!0),(z=R.value)!=null&&z.installed&&b.value?(n(),a("button",{key:3,onClick:pe(ue,["stop"]),class:"btn btn-primary"},[...f[19]||(f[19]=[e("i",{class:"mdi mdi-plus"},null,-1),S(" Create SmartIR Profile ",-1)])])):T("",!0)])]),W(e("div",null,[m.value?(n(),a("div",si,[...f[20]||(f[20]=[e("div",{class:"spinner"},null,-1),e("p",null,"Checking SmartIR installation...",-1)])])):v.value?(n(),a("div",ai,[f[21]||(f[21]=e("i",{class:"mdi mdi-alert-circle"},null,-1)),e("p",null,u(v.value),1),e("button",{onClick:Q,class:"btn-secondary"}," Try Again ")])):(D=R.value)!=null&&D.installed?(n(),a("div",ii,[V.value?(n(),a("div",ri,[_.value.recommendation?(n(),a("div",di,[e("p",null,u(_.value.recommendation.message),1),_.value.recommendation.next_steps?(n(),a("div",ui,[f[22]||(f[22]=e("strong",null,"Next Steps:",-1)),e("ul",null,[(n(!0),a(me,null,be(_.value.recommendation.next_steps,(l,F)=>(n(),a("li",{key:F},u(l),1))),128))])])):T("",!0)])):T("",!0),e("div",ci,[e("button",{onClick:f[3]||(f[3]=(...l)=>H.viewDocumentation&&H.viewDocumentation(...l)),class:"btn-secondary"},[...f[23]||(f[23]=[e("i",{class:"mdi mdi-book-open-variant"},null,-1),S(" View Documentation ",-1)])])])])):T("",!0),t.value.length>0&&!I.value?(n(),a("div",mi,[e("div",vi,[e("div",pi,[e("label",null,[f[24]||(f[24]=e("i",{class:"mdi mdi-magnify"},null,-1)),W(e("input",{"onUpdate:modelValue":f[4]||(f[4]=l=>q.value.search=l),type:"text",placeholder:"Search profiles...",class:"search-input"},null,512),[[Ie,q.value.search]])])]),e("div",fi,[e("label",null,[f[26]||(f[26]=e("i",{class:"mdi mdi-shape"},null,-1)),W(e("select",{"onUpdate:modelValue":f[5]||(f[5]=l=>q.value.platform=l)},[...f[25]||(f[25]=[Le('<option value="" data-v-10700524>All Platforms</option><option value="climate" data-v-10700524>Climate</option><option value="media_player" data-v-10700524>Media Player</option><option value="fan" data-v-10700524>Fan</option><option value="light" data-v-10700524>Light</option>',5)])],512),[[ke,q.value.platform]])])]),A.value?(n(),a("button",{key:0,onClick:N,class:"btn-clear-filters"},[...f[27]||(f[27]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),S(" Clear ",-1)])])):T("",!0),e("div",gi,[e("button",{onClick:f[6]||(f[6]=l=>i.value="grid"),class:Z(["view-toggle-btn",{active:i.value==="grid"}]),title:"Grid View"},[...f[28]||(f[28]=[e("i",{class:"mdi mdi-view-grid"},null,-1),S(" Grid ",-1)])],2),e("button",{onClick:f[7]||(f[7]=l=>i.value="list"),class:Z(["view-toggle-btn",{active:i.value==="list"}]),title:"List View"},[...f[29]||(f[29]=[e("i",{class:"mdi mdi-view-list"},null,-1),S(" List ",-1)])],2)]),e("div",yi,u(ae.value.length)+" of "+u(t.value.length),1)])])):T("",!0),L.value?(n(),a("div",bi,[...f[30]||(f[30]=[e("i",{class:"mdi mdi-loading mdi-spin"},null,-1),e("p",null,"Loading profiles...",-1)])])):t.value.length===0?(n(),a("div",hi,[...f[31]||(f[31]=[e("i",{class:"mdi mdi-file-document-outline"},null,-1),e("h3",null,"No Profiles Yet",-1),e("p",null,"Create your first SmartIR profile to get started",-1)])])):T("",!0),i.value==="grid"&&!I.value?(n(),a("div",ki,[(n(!0),a(me,null,be(ae.value,l=>(n(),Te(Gs,{key:`${l.platform}-${l.code}`,profile:l,onEdit:F=>$e(l.platform,l),onCommands:F=>$e(l.platform,l,2),onDownload:F=>x(l.platform,l),onDelete:F=>d(l.platform,l)},null,8,["profile","onEdit","onCommands","onDownload","onDelete"]))),128))])):i.value==="list"&&!I.value&&ae.value.length>0?(n(),Te(ha,{key:5,profiles:ae.value,onEdit:f[8]||(f[8]=l=>$e(l.platform,l)),onCommands:f[9]||(f[9]=l=>$e(l.platform,l,2)),onDownload:f[10]||(f[10]=l=>x(l.platform,l)),onDelete:f[11]||(f[11]=l=>d(l.platform,l))},null,8,["profiles"])):T("",!0),t.value.length>0&&ae.value.length===0&&!I.value?(n(),a("div",wi,[...f[32]||(f[32]=[e("i",{class:"mdi mdi-filter-off"},null,-1),e("h3",null,"No profiles match your filters",-1),e("p",null,"Try adjusting your search or filter criteria",-1)])])):T("",!0)])):(n(),a("div",$i,[f[36]||(f[36]=e("div",{class:"status-badge warning"},[e("i",{class:"mdi mdi-information"}),e("span",null,"Not Installed")],-1)),e("div",Ci,[f[34]||(f[34]=e("h4",null,"Why Install SmartIR?",-1)),e("ul",_i,[(n(!0),a(me,null,be(((G=(ie=_.value)==null?void 0:ie.recommendation)==null?void 0:G.benefits)||g,(l,F)=>(n(),a("li",{key:F},[f[33]||(f[33]=e("i",{class:"mdi mdi-check"},null,-1)),e("span",null,u(l),1)]))),128))])]),e("div",Si,[e("p",null,u(((E=(ce=_.value)==null?void 0:ce.recommendation)==null?void 0:E.message)||"Install SmartIR to unlock climate device support!"),1)]),e("div",{class:"card-actions"},[e("button",{onClick:De,class:"btn-primary"},[...f[35]||(f[35]=[e("i",{class:"mdi mdi-github"},null,-1),S(" Install SmartIR ",-1)])])])]))],512),[[Xe,b.value]]),fe(Me,{isOpen:U.value.show,title:U.value.title,message:U.value.message,confirmText:U.value.canDelete===!1?null:"Delete",cancelText:"Close",dangerMode:!0,confirmDisabled:U.value.canDelete===!1,onConfirm:P,onCancel:f[12]||(f[12]=l=>U.value.show=!1)},null,8,["isOpen","title","message","confirmText","confirmDisabled"]),fe(Xa,{isOpen:M.value,onClose:f[13]||(f[13]=l=>M.value=!1)},null,8,["isOpen"])])}}},Di=he(Ii,[["__scopeId","data-v-10700524"]]),xi={class:"climate-form"},Ti={class:"learning-mode-section"},Ri={class:"mode-toggle"},Mi={class:"mode-content"},Ai={class:"mode-stats"},Li={class:"stat-badge"},Oi={class:"stat-badge time"},Ei={class:"mode-content"},Vi={class:"mode-stats"},Ui={class:"stat-badge"},Pi={class:"stat-badge time warning"},ji={key:0,class:"command-breakdown"},Fi={class:"warning-text"},Ni={class:"form-section"},Bi={key:0,class:"help-text"},qi={key:1,class:"help-text"},Hi={class:"form-row"},zi={class:"form-group"},Ji={class:"form-group"},Wi={class:"form-group"},Ki={key:2,class:"representative-temp-section"},Xi={class:"form-group"},Gi=["value"],Yi={class:"form-section"},Zi={class:"checkbox-grid"},Qi={class:"checkbox-item"},er={class:"checkbox-item"},tr={class:"checkbox-item"},or={class:"checkbox-item"},lr={class:"checkbox-item"},nr={class:"checkbox-item"},sr={class:"form-section"},ar={class:"checkbox-grid"},ir={class:"checkbox-item"},rr={class:"checkbox-item"},dr={class:"checkbox-item"},ur={class:"checkbox-item"},cr={class:"form-section"},mr={class:"checkbox-grid"},vr={class:"checkbox-item"},pr={class:"checkbox-item"},fr={class:"checkbox-item"},gr={class:"checkbox-item"},yr={class:"form-section"},br={class:"form-group"},hr={class:"form-group"},kr={class:"form-group"},wr={key:0,class:"validation-summary"},$r={__name:"ClimateProfileForm",props:{modelValue:{type:Object,default:()=>({})}},emits:["update:modelValue"],setup(o,{emit:c}){const r=o,k=c,w=y("quick"),s=y({minTemp:16,maxTemp:30,precision:1,representativeTemp:24,modes:["off","auto","cool","heat"],fanModes:["auto","low","medium","high"],swingModes:[],tempSensor:"",humiditySensor:"",powerSensor:"",learningMode:"quick",...r.modelValue}),m=J(()=>{const M=[],i=s.value.minTemp||16,g=s.value.maxTemp||30,p=s.value.precision||1;for(let R=i;R<=g;R+=p)M.push(R);return M}),v=J(()=>s.value.modes.filter(M=>M!=="off").length),_=J(()=>s.value.fanModes.length||1),I=J(()=>s.value.swingModes.length||1),V=J(()=>{const M=s.value.minTemp||16,i=s.value.maxTemp||30,g=s.value.precision||1;return Math.floor((i-M)/g)+1}),b=J(()=>{const M=s.value.modes.includes("off")?1:0;return v.value*_.value*I.value+M}),t=J(()=>Math.ceil(b.value*30/60)),L=J(()=>{const M=s.value.modes.includes("off")?1:0;return v.value*V.value*_.value*I.value+M}),q=J(()=>Math.ceil(L.value*30/60)),U=J(()=>{const M=[];return(!s.value.minTemp||s.value.minTemp<10||s.value.minTemp>35)&&M.push("Minimum temperature must be between 10Â°C and 35Â°C"),(!s.value.maxTemp||s.value.maxTemp<10||s.value.maxTemp>35)&&M.push("Maximum temperature must be between 10Â°C and 35Â°C"),s.value.minTemp>=s.value.maxTemp&&M.push("Minimum temperature must be less than maximum temperature"),(!s.value.modes||s.value.modes.length===0)&&M.push("At least one HVAC mode must be selected"),M});return de(w,M=>{s.value.learningMode=M}),de(s,M=>{k("update:modelValue",M)},{deep:!0,immediate:!0}),(M,i)=>(n(),a("div",xi,[i[63]||(i[63]=e("h3",null,"Climate Device Configuration",-1)),e("div",Ti,[e("div",Ri,[e("label",{class:Z(["mode-option",{active:w.value==="quick"}])},[W(e("input",{type:"radio",value:"quick","onUpdate:modelValue":i[0]||(i[0]=g=>w.value=g)},null,512),[[Pe,w.value]]),e("div",Mi,[i[23]||(i[23]=e("div",{class:"mode-header"},[e("i",{class:"mdi mdi-flash"}),e("strong",null,"Quick Mode (Recommended)")],-1)),i[24]||(i[24]=e("p",null,"Learn one temperature per mode combination",-1)),e("div",Ai,[e("span",Li,u(b.value)+" commands",1),e("span",Oi,"~"+u(t.value)+" min",1)])])],2),e("label",{class:Z(["mode-option",{active:w.value==="complete"}])},[W(e("input",{type:"radio",value:"complete","onUpdate:modelValue":i[1]||(i[1]=g=>w.value=g)},null,512),[[Pe,w.value]]),e("div",Ei,[i[25]||(i[25]=e("div",{class:"mode-header"},[e("i",{class:"mdi mdi-check-all"}),e("strong",null,"Complete Mode")],-1)),i[26]||(i[26]=e("p",null,"Learn all temperature combinations",-1)),e("div",Vi,[e("span",Ui,u(L.value)+" commands",1),e("span",Pi,"~"+u(q.value)+" min",1)])])],2)]),w.value==="complete"?(n(),a("div",ji,[i[27]||(i[27]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[e("strong",null,"Complete mode will require learning "+u(L.value)+" commands",1),e("p",null,"This includes all combinations of modes ("+u(v.value)+"), temperatures ("+u(V.value)+"), fan speeds ("+u(_.value)+"), and swing modes ("+u(I.value)+").",1),e("p",Fi,"â±ï¸ Estimated time: "+u(q.value)+" minutes at ~30 seconds per command",1)])])):T("",!0)]),e("div",Ni,[i[33]||(i[33]=e("h4",null,"Temperature Range",-1)),w.value==="quick"?(n(),a("p",Bi," Define the full temperature range your device supports. You'll select one temperature to learn below. ")):(n(),a("p",qi," Define the temperature range. All temperatures in this range will be learned. ")),e("div",Hi,[e("div",zi,[i[28]||(i[28]=e("label",null,"Minimum Temperature (Â°C) *",-1)),W(e("input",{"onUpdate:modelValue":i[2]||(i[2]=g=>s.value.minTemp=g),type:"number",min:"10",max:"35",placeholder:"16"},null,512),[[Ie,s.value.minTemp,void 0,{number:!0}]])]),e("div",Ji,[i[29]||(i[29]=e("label",null,"Maximum Temperature (Â°C) *",-1)),W(e("input",{"onUpdate:modelValue":i[3]||(i[3]=g=>s.value.maxTemp=g),type:"number",min:"10",max:"35",placeholder:"30"},null,512),[[Ie,s.value.maxTemp,void 0,{number:!0}]])]),e("div",Wi,[i[31]||(i[31]=e("label",null,"Precision",-1)),W(e("select",{"onUpdate:modelValue":i[4]||(i[4]=g=>s.value.precision=g)},[...i[30]||(i[30]=[e("option",{value:1},"1Â°C (Whole degrees)",-1),e("option",{value:.5},"0.5Â°C (Half degrees)",-1)])],512),[[ke,s.value.precision,void 0,{number:!0}]])])]),w.value==="quick"?(n(),a("div",Ki,[e("div",Xi,[i[32]||(i[32]=e("label",null,"Representative Temperature to Learn *",-1)),W(e("select",{"onUpdate:modelValue":i[5]||(i[5]=g=>s.value.representativeTemp=g)},[(n(!0),a(me,null,be(m.value,g=>(n(),a("option",{key:g,value:g},u(g)+"Â°C ",9,Gi))),128))],512),[[ke,s.value.representativeTemp,void 0,{number:!0}]]),e("small",null,"This temperature will be learned for all mode combinations. The device profile will still show the full range ("+u(s.value.minTemp)+"Â°C - "+u(s.value.maxTemp)+"Â°C).",1)])])):T("",!0)]),e("div",Yi,[i[40]||(i[40]=e("h4",null,"Supported HVAC Modes *",-1)),i[41]||(i[41]=e("p",{class:"help-text"},"Select all modes your device supports",-1)),e("div",Zi,[e("label",Qi,[W(e("input",{type:"checkbox",value:"off","onUpdate:modelValue":i[6]||(i[6]=g=>s.value.modes=g)},null,512),[[ve,s.value.modes]]),i[34]||(i[34]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),S(" Off ")],-1))]),e("label",er,[W(e("input",{type:"checkbox",value:"auto","onUpdate:modelValue":i[7]||(i[7]=g=>s.value.modes=g)},null,512),[[ve,s.value.modes]]),i[35]||(i[35]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-autorenew"}),S(" Auto ")],-1))]),e("label",tr,[W(e("input",{type:"checkbox",value:"cool","onUpdate:modelValue":i[8]||(i[8]=g=>s.value.modes=g)},null,512),[[ve,s.value.modes]]),i[36]||(i[36]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-snowflake"}),S(" Cool ")],-1))]),e("label",or,[W(e("input",{type:"checkbox",value:"heat","onUpdate:modelValue":i[9]||(i[9]=g=>s.value.modes=g)},null,512),[[ve,s.value.modes]]),i[37]||(i[37]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fire"}),S(" Heat ")],-1))]),e("label",lr,[W(e("input",{type:"checkbox",value:"dry","onUpdate:modelValue":i[10]||(i[10]=g=>s.value.modes=g)},null,512),[[ve,s.value.modes]]),i[38]||(i[38]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-water-percent"}),S(" Dry ")],-1))]),e("label",nr,[W(e("input",{type:"checkbox",value:"fan_only","onUpdate:modelValue":i[11]||(i[11]=g=>s.value.modes=g)},null,512),[[ve,s.value.modes]]),i[39]||(i[39]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan"}),S(" Fan Only ")],-1))])])]),e("div",sr,[i[46]||(i[46]=e("h4",null,"Fan Modes",-1)),i[47]||(i[47]=e("p",{class:"help-text"},"Select all fan speeds your device supports",-1)),e("div",ar,[e("label",ir,[W(e("input",{type:"checkbox",value:"auto","onUpdate:modelValue":i[12]||(i[12]=g=>s.value.fanModes=g)},null,512),[[ve,s.value.fanModes]]),i[42]||(i[42]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-autorenew"}),S(" Auto ")],-1))]),e("label",rr,[W(e("input",{type:"checkbox",value:"low","onUpdate:modelValue":i[13]||(i[13]=g=>s.value.fanModes=g)},null,512),[[ve,s.value.fanModes]]),i[43]||(i[43]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-1"}),S(" Low ")],-1))]),e("label",dr,[W(e("input",{type:"checkbox",value:"medium","onUpdate:modelValue":i[14]||(i[14]=g=>s.value.fanModes=g)},null,512),[[ve,s.value.fanModes]]),i[44]||(i[44]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-2"}),S(" Medium ")],-1))]),e("label",ur,[W(e("input",{type:"checkbox",value:"high","onUpdate:modelValue":i[15]||(i[15]=g=>s.value.fanModes=g)},null,512),[[ve,s.value.fanModes]]),i[45]||(i[45]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-3"}),S(" High ")],-1))])])]),e("div",cr,[i[52]||(i[52]=e("h4",null,"Swing Modes (Optional)",-1)),i[53]||(i[53]=e("p",{class:"help-text"},"Select if your device has swing/oscillation",-1)),e("div",mr,[e("label",vr,[W(e("input",{type:"checkbox",value:"off","onUpdate:modelValue":i[16]||(i[16]=g=>s.value.swingModes=g)},null,512),[[ve,s.value.swingModes]]),i[48]||(i[48]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-horizontal"}),S(" Off ")],-1))]),e("label",pr,[W(e("input",{type:"checkbox",value:"vertical","onUpdate:modelValue":i[17]||(i[17]=g=>s.value.swingModes=g)},null,512),[[ve,s.value.swingModes]]),i[49]||(i[49]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-vertical"}),S(" Vertical ")],-1))]),e("label",fr,[W(e("input",{type:"checkbox",value:"horizontal","onUpdate:modelValue":i[18]||(i[18]=g=>s.value.swingModes=g)},null,512),[[ve,s.value.swingModes]]),i[50]||(i[50]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-horizontal"}),S(" Horizontal ")],-1))]),e("label",gr,[W(e("input",{type:"checkbox",value:"both","onUpdate:modelValue":i[19]||(i[19]=g=>s.value.swingModes=g)},null,512),[[ve,s.value.swingModes]]),i[51]||(i[51]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-arrow-all"}),S(" Both ")],-1))])])]),e("div",yr,[i[60]||(i[60]=e("h4",null,"Sensors (Optional)",-1)),i[61]||(i[61]=e("p",{class:"help-text"},"Link external sensors for better climate control",-1)),e("div",br,[i[54]||(i[54]=e("label",null,"Temperature Sensor",-1)),W(e("input",{"onUpdate:modelValue":i[20]||(i[20]=g=>s.value.tempSensor=g),type:"text",placeholder:"sensor.living_room_temperature"},null,512),[[Ie,s.value.tempSensor]]),i[55]||(i[55]=e("small",null,"Entity ID of temperature sensor",-1))]),e("div",hr,[i[56]||(i[56]=e("label",null,"Humidity Sensor",-1)),W(e("input",{"onUpdate:modelValue":i[21]||(i[21]=g=>s.value.humiditySensor=g),type:"text",placeholder:"sensor.living_room_humidity"},null,512),[[Ie,s.value.humiditySensor]]),i[57]||(i[57]=e("small",null,"Entity ID of humidity sensor",-1))]),e("div",kr,[i[58]||(i[58]=e("label",null,"Power Sensor",-1)),W(e("input",{"onUpdate:modelValue":i[22]||(i[22]=g=>s.value.powerSensor=g),type:"text",placeholder:"binary_sensor.ac_power"},null,512),[[Ie,s.value.powerSensor]]),i[59]||(i[59]=e("small",null,"Entity ID of power sensor (to detect on/off state)",-1))])]),U.value.length>0?(n(),a("div",wr,[i[62]||(i[62]=e("h4",null,[e("i",{class:"mdi mdi-alert-circle"}),S(" Please fix the following: ")],-1)),e("ul",null,[(n(!0),a(me,null,be(U.value,(g,p)=>(n(),a("li",{key:p},u(g),1))),128))])])):T("",!0)]))}},Cr=he($r,[["__scopeId","data-v-5674f3f7"]]),_r={class:"command-wizard"},Sr={class:"device-selection-section"},Ir={class:"input-wrapper"},Dr=["value"],xr={key:0,class:"validation-tooltip"},Tr={class:"form-group"},Rr=["disabled"],Mr={key:0},Ar={key:1},Lr={key:0,class:"edit-mode-banner"},Or={class:"wizard-info"},Er={key:0},Vr={key:1},Ur={class:"progress-info"},Pr={class:"progress-bar"},jr={class:"progress-text"},Fr={class:"commands-grid"},Nr={class:"command-header"},Br={class:"command-icon"},qr={class:"command-info"},Hr={key:0,class:"learning-indicator"},zr={key:0,class:"ir-learning-steps"},Jr={key:1,class:"rf-learning-steps"},Wr={class:"command-actions"},Kr=["onClick","disabled"],Xr={key:1,class:"learned-status"},Gr=["onClick","disabled"],Yr=["onClick"],Zr={class:"quick-actions"},Qr=["disabled"],ed=["disabled"],td={__name:"CommandLearningWizard",props:{modelValue:{type:Object,default:()=>({})},platform:{type:String,required:!0},config:{type:Object,required:!0},broadlinkDevice:{type:String,default:""},manufacturer:{type:String,required:!0},model:{type:String,required:!0},commandType:{type:String,default:"ir"}},emits:["update:modelValue","update:broadlinkDevice","update:commandType"],setup(o,{emit:c}){const r=Ee(),k=o,w=c,s=y({...k.modelValue}),m=y(null),v=y(null),_=y([]),I=y(k.broadlinkDevice),V=y(k.commandType),b=y(!1),t=y([]),L=y(!1),q=y(!1),U=y({show:!1,commandKey:null,commandLabel:""}),M=y(!1),i=J(()=>{const x=[];if(k.platform==="climate"){const d=k.config.modes||[],P=k.config.fanModes||[],H=k.config.minTemp||16,f=k.config.maxTemp||30;d.forEach(C=>{if(C==="off")x.push({key:"off",label:"Power Off",description:"Turn device off",icon:"mdi mdi-power",mode:"off"});else for(let B=H;B<=f;B++)P.forEach(Y=>{const se=`${C}_${B}_${Y}`;x.push({key:se,label:`${C.toUpperCase()} ${B}Â°C ${Y}`,description:`Mode: ${C}, Temp: ${B}Â°C, Fan: ${Y}`,icon:X(C),mode:C,temp:B,fanMode:Y})})})}else if(k.platform==="media_player"){const d=k.config.features||[];d.includes("turn_on")&&(x.push({key:"turn_on",label:"Power On",description:"Turn on the device",icon:"mdi mdi-power"}),x.push({key:"turn_off",label:"Power Off",description:"Turn off the device",icon:"mdi mdi-power-off"})),d.includes("volume")&&(x.push({key:"volume_up",label:"Volume Up",description:"Increase volume",icon:"mdi mdi-volume-plus"}),x.push({key:"volume_down",label:"Volume Down",description:"Decrease volume",icon:"mdi mdi-volume-minus"})),d.includes("mute")&&x.push({key:"mute",label:"Mute",description:"Toggle mute",icon:"mdi mdi-volume-mute"}),d.includes("source")&&(x.push({key:"source_hdmi1",label:"Source: HDMI 1",description:"Switch to HDMI 1",icon:"mdi mdi-import"}),x.push({key:"source_hdmi2",label:"Source: HDMI 2",description:"Switch to HDMI 2",icon:"mdi mdi-import"}),x.push({key:"source_hdmi3",label:"Source: HDMI 3",description:"Switch to HDMI 3",icon:"mdi mdi-import"})),d.includes("channel")&&(x.push({key:"channel_up",label:"Channel Up",description:"Next channel",icon:"mdi mdi-chevron-up"}),x.push({key:"channel_down",label:"Channel Down",description:"Previous channel",icon:"mdi mdi-chevron-down"}))}else if(k.platform==="fan"){const d=k.config.speedLevels||3,P=k.config.features||[];x.push({key:"turn_on",label:"Power On",description:"Turn on the fan",icon:"mdi mdi-power"}),x.push({key:"turn_off",label:"Power Off",description:"Turn off the fan",icon:"mdi mdi-power-off"});for(let H=1;H<=d;H++){const f=H===1?"Low":H===d?"High":H===2&&d===3?"Medium":`Speed ${H}`;x.push({key:`speed_${H}`,label:`${f}`,description:`Set fan to speed level ${H}`,icon:"mdi mdi-fan"})}P.includes("oscillate")&&(x.push({key:"oscillate_on",label:"Oscillate On",description:"Enable oscillation",icon:"mdi mdi-sync"}),x.push({key:"oscillate_off",label:"Oscillate Off",description:"Disable oscillation",icon:"mdi mdi-sync-off"})),P.includes("direction")&&(x.push({key:"direction_forward",label:"Direction: Forward",description:"Set direction to forward",icon:"mdi mdi-rotate-right"}),x.push({key:"direction_reverse",label:"Direction: Reverse",description:"Set direction to reverse",icon:"mdi mdi-rotate-left"}))}else if(k.platform==="light"){const d=k.config.features||[];d.includes("turn_on")&&(x.push({key:"turn_on",label:"Power On",description:"Turn on the light",icon:"mdi mdi-lightbulb-on"}),x.push({key:"turn_off",label:"Power Off",description:"Turn off the light",icon:"mdi mdi-lightbulb-off"})),d.includes("brightness")&&(x.push({key:"brightness_up",label:"Brightness Up",description:"Increase brightness",icon:"mdi mdi-brightness-7"}),x.push({key:"brightness_down",label:"Brightness Down",description:"Decrease brightness",icon:"mdi mdi-brightness-5"})),d.includes("color_temp")&&(x.push({key:"color_temp_warm",label:"Warm White",description:"Set to warm white",icon:"mdi mdi-weather-sunset"}),x.push({key:"color_temp_cool",label:"Cool White",description:"Set to cool white",icon:"mdi mdi-weather-sunny"})),d.includes("rgb")&&(x.push({key:"color_red",label:"Color: Red",description:"Set color to red",icon:"mdi mdi-palette"}),x.push({key:"color_green",label:"Color: Green",description:"Set color to green",icon:"mdi mdi-palette"}),x.push({key:"color_blue",label:"Color: Blue",description:"Set color to blue",icon:"mdi mdi-palette"}))}return x}),g=J(()=>i.value.length),p=J(()=>Object.keys(s.value).length),R=J(()=>g.value===0?0:Math.round(p.value/g.value*100));function X(x){return{off:"mdi mdi-power",auto:"mdi mdi-autorenew",cool:"mdi mdi-snowflake",heat:"mdi mdi-fire",dry:"mdi mdi-water-percent",fan_only:"mdi mdi-fan"}[x]||"mdi mdi-remote"}async function te(x){if(!m.value){if(!I.value){q.value=!0,window.scrollTo({top:0,behavior:"smooth"});return}q.value=!1,m.value=x.key;try{const d=k.manufacturer.toLowerCase().replace(/[^a-z0-9]+/g,"_"),P=k.model.toLowerCase().replace(/[^a-z0-9]+/g,"_"),H=`${d}_${P}`,C=(await oe.post("/api/commands/learn",{entity_id:I.value,device:H,command:x.key,command_type:V.value})).data;if(C.success&&C.code)s.value[x.key]=C.code,w("update:modelValue",s.value),L.value=!0,C.code==="pending"&&console.log(`â³ Command '${x.key}' learned, code will be fetched from storage when saving`),b.value&&t.value.length>0&&setTimeout(()=>{const B=t.value.shift();B?te(B):b.value=!1},1e3);else throw new Error(C.error||"Failed to learn command")}catch(d){console.error("Error learning command:",d),r.error(`Error learning command: ${d.message}`),b.value=!1,t.value=[]}finally{b.value||(m.value=null)}}}async function le(x){var d;if(!I.value){q.value=!0,window.scrollTo({top:0,behavior:"smooth"});return}if(!s.value[x]){(d=r.value)==null||d.error("Command not learned yet");return}v.value=x;try{const P=s.value[x];await oe.post("/api/commands/send-raw",{entity_id:I.value,command:P,command_type:V.value}),r.success("Command sent successfully")}catch(P){console.error("Error testing command:",P),r.error(`Error testing command: ${P.message}`)}finally{v.value=null}}function ae(x){const d=i.value.find(P=>P.key===x);U.value={show:!0,commandKey:x,commandLabel:d?d.label:x}}function A(){const x=U.value.commandKey;delete s.value[x],w("update:modelValue",s.value),U.value.show=!1}function N(){const x=i.value.filter(P=>!s.value[P.key]);if(x.length===0)return;b.value=!0,t.value=[...x];const d=t.value.shift();d&&te(d)}function Q(){M.value=!0}function ue(){s.value={},w("update:modelValue",s.value),M.value=!1}de(()=>k.modelValue,x=>{s.value={...x}},{deep:!0}),xe(async()=>{await ye()});async function ye(){try{console.log("SmartIR device - commands will be loaded from SmartIR JSON file, not Broadlink storage")}catch(x){console.error("Error in loadExistingCommands:",x)}}function De(){w("update:broadlinkDevice",I.value)}function we(){w("update:commandType",V.value)}async function $e(){try{console.log("ðŸ” Loading Broadlink devices from /api/remote/devices");const x=await oe.get("/api/remote/devices");console.log("ðŸ“¦ Response data:",x.data);const d=x.data.devices||[];console.log(`âœ… Found ${d.length} devices:`,d),_.value=d}catch(x){console.error("âŒ Error loading remote devices:",x),_.value=[]}}return de(()=>k.broadlinkDevice,x=>{I.value=x}),de(I,x=>{x&&(q.value=!1)}),de(()=>k.commandType,x=>{V.value=x}),xe(async()=>{await $e(),await ye()}),(x,d)=>(n(),a("div",_r,[d[22]||(d[22]=e("h3",null,"Learn IR Commands",-1)),e("div",Sr,[e("div",{class:Z(["form-group",{"has-error":q.value}])},[d[6]||(d[6]=e("label",null,"Broadlink Device *",-1)),e("div",Ir,[W(e("select",{"onUpdate:modelValue":d[0]||(d[0]=P=>I.value=P),onChange:De},[d[4]||(d[4]=e("option",{value:""},"Select Broadlink device...",-1)),(n(!0),a(me,null,be(_.value,P=>(n(),a("option",{key:P.entity_id,value:P.entity_id},u(P.name||P.entity_id),9,Dr))),128))],544),[[ke,I.value]]),q.value?(n(),a("div",xr,[...d[5]||(d[5]=[e("i",{class:"mdi mdi-alert"},null,-1),S(" Device is required ",-1)])])):T("",!0)]),e("small",null,"This device will be used to learn commands ("+u(_.value.length)+" devices found)",1)],2),e("div",Tr,[d[8]||(d[8]=e("label",null,"Command Type *",-1)),W(e("select",{"onUpdate:modelValue":d[1]||(d[1]=P=>V.value=P),onChange:we,disabled:p.value>0},[...d[7]||(d[7]=[e("option",{value:"ir"},"ðŸ“¡ Infrared (IR) - Most common for AC, TV, etc.",-1),e("option",{value:"rf"},"ðŸ“» Radio Frequency (RF) - For RF remotes",-1)])],40,Rr),[[ke,V.value]]),p.value>0?(n(),a("small",Mr,"Command type cannot be changed after learning commands")):(n(),a("small",Ar,"Select the type of commands your device uses"))])]),p.value>0&&!L.value?(n(),a("div",Lr,[d[10]||(d[10]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[d[9]||(d[9]=e("strong",null,"Editing Existing Profile",-1)),e("p",null,u(p.value)+" command"+u(p.value!==1?"s":"")+' already learned. You can re-learn any command by clicking the delete icon and then "Learn Command".',1)])])):T("",!0),e("div",Or,[d[14]||(d[14]=e("i",{class:"mdi mdi-information"},null,-1)),e("div",null,[d[13]||(d[13]=e("p",null,[e("strong",null,"How it works:")],-1)),o.commandType==="ir"?(n(),a("ol",Er,[...d[11]||(d[11]=[e("li",null,'Click "Learn Command" for each combination',-1),e("li",null,[e("strong",null,"Point your IR remote directly at the Broadlink device")],-1),e("li",null,"Press the button on your remote",-1),e("li",null,"Wait for confirmation (up to 30 seconds)",-1)])])):(n(),a("ol",Vr,[...d[12]||(d[12]=[e("li",null,'Click "Learn Command" for each combination',-1),e("li",null,[e("strong",null,"Step 1:"),S(" Hold button on remote - Broadlink scans for RF frequency")],-1),e("li",null,[e("strong",null,"Step 2:"),S(" Watch for Home Assistant notification, then press and release button")],-1),e("li",null,"Keep remote within 5cm of Broadlink (RF doesn't need line-of-sight)",-1),e("li",null,"Wait for confirmation (may take up to 30 seconds)",-1)])]))])]),e("div",Ur,[e("div",Pr,[e("div",{class:"progress-fill",style:ot({width:R.value+"%"})},null,4)]),e("span",jr,u(p.value)+" / "+u(g.value)+" commands learned ("+u(R.value)+"%) ",1)]),e("div",Fr,[(n(!0),a(me,null,be(i.value,P=>(n(),a("div",{key:P.key,class:Z(["command-card",{learned:s.value[P.key],learning:m.value===P.key}])},[e("div",Nr,[e("div",Br,[e("i",{class:Z(P.icon)},null,2)]),e("div",qr,[e("h4",null,u(P.label),1),e("p",null,u(P.description),1)])]),m.value===P.key?(n(),a("div",Hr,[o.commandType==="ir"?(n(),a("div",zr,[...d[15]||(d[15]=[e("p",null,[e("strong",null,"Point your remote directly at the Broadlink device and press the button.")],-1),e("small",null,"Listening for up to 30 seconds...",-1)])])):(n(),a("div",Jr,[...d[16]||(d[16]=[e("p",{class:"rf-title"},[e("strong",null,"Learning request sent to device.")],-1),e("p",{class:"rf-subtitle"},[S("RF learning is a "),e("strong",null,"two-step process"),S(":")],-1),e("ol",null,[e("li",null,[e("strong",null,"Step 1 - Frequency Sweep (~10-15 seconds):"),S(" Press and hold the button on your remote until the notification updates. ")]),e("li",null,[e("strong",null,"Step 2 - Learn Signal:"),S(" Press and release the button once. ")])],-1),e("p",{class:"rf-note"},"Follow the Home Assistant notifications (ðŸ””) for real-time instructions.",-1)])]))])):T("",!0),e("div",Wr,[s.value[P.key]?(n(),a("div",Xr,[d[18]||(d[18]=e("i",{class:"mdi mdi-check-circle"},null,-1)),d[19]||(d[19]=e("span",null,"Learned",-1)),e("span",{class:Z(["command-type-badge",V.value])},u(V.value.toUpperCase()),3),e("button",{onClick:H=>le(P.key),class:"icon-btn",title:"Test command",disabled:v.value===P.key,style:{"margin-left":"auto"}},[e("i",{class:Z(["mdi mdi-play",{"mdi-spin":v.value===P.key}])},null,2)],8,Gr),e("button",{onClick:H=>ae(P.key),class:"icon-btn danger",title:"Delete and re-learn"},[...d[17]||(d[17]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,Yr)])):(n(),a("button",{key:0,onClick:H=>te(P),class:Z(["btn-learn",{learning:m.value===P.key}]),disabled:m.value!==null},[e("i",{class:Z(["mdi mdi-radio-tower",{"mdi-spin":m.value===P.key}])},null,2),S(" "+u(m.value===P.key?"Listening...":"Learn Command"),1)],10,Kr))])],2))),128))]),e("div",Zr,[e("button",{onClick:N,class:"btn-secondary",disabled:m.value!==null||p.value===g.value},[...d[20]||(d[20]=[e("i",{class:"mdi mdi-play-circle"},null,-1),S(" Learn All Remaining ",-1)])],8,Qr),e("button",{onClick:Q,class:"btn-text",disabled:p.value===0},[...d[21]||(d[21]=[e("i",{class:"mdi mdi-delete-sweep"},null,-1),S(" Clear All ",-1)])],8,ed)]),fe(Me,{isOpen:U.value.show,title:"Delete Learned Command?",message:`Are you sure you want to delete the '${U.value.commandLabel}' command?

You will need to re-learn this command.`,confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,onConfirm:A,onCancel:d[2]||(d[2]=P=>U.value.show=!1)},null,8,["isOpen","message"]),fe(Me,{isOpen:M.value,title:"Delete All Learned Commands?",message:"Are you sure you want to delete all learned commands? This cannot be undone.\\n\\nYou will need to re-learn all commands.",confirmText:"Delete All",cancelText:"Cancel",dangerMode:!0,onConfirm:ue,onCancel:d[3]||(d[3]=P=>M.value=!1)},null,8,["isOpen"])]))}},od=he(td,[["__scopeId","data-v-84fe090b"]]),ld={class:"profile-preview"},nd={class:"preview-summary"},sd={class:"summary-card"},ad={class:"stats-grid"},id={class:"stat-item"},rd={class:"stat-value"},dd={class:"stat-item"},ud={class:"stat-value"},cd={class:"stat-item"},md={class:"stat-value"},vd={class:"preview-tabs"},pd={class:"preview-content"},fd={key:0,class:"tab-content"},gd={class:"code-header"},yd={class:"code-block"},bd={key:1,class:"tab-content"},hd={class:"code-header"},kd={class:"code-block"},wd={key:2,class:"tab-content"},$d={class:"instructions"},Cd={class:"step-item"},_d={class:"step-content"},Sd={class:"code-path"},Id={__name:"ProfilePreview",props:{profile:{type:Object,required:!0},jsonData:{type:Object,required:!0},yamlConfig:{type:String,required:!0}},setup(o){const c=Ee(),r=o,k=y("json"),w=y(!1),s=y(!1),m=J(()=>Object.keys(r.profile.commands||{}).length),v=J(()=>JSON.stringify(r.jsonData,null,2));async function _(){try{await navigator.clipboard.writeText(v.value),w.value=!0,setTimeout(()=>{w.value=!1},2e3)}catch(V){console.error("Failed to copy JSON:",V),c.error("Failed to copy to clipboard")}}async function I(){try{await navigator.clipboard.writeText(r.yamlConfig),s.value=!0,setTimeout(()=>{s.value=!1},2e3)}catch(V){console.error("Failed to copy YAML:",V),c.error("Failed to copy to clipboard")}}return(V,b)=>{var t;return n(),a("div",ld,[b[22]||(b[22]=e("h3",null,"Preview & Save",-1)),e("div",nd,[e("div",sd,[b[4]||(b[4]=e("i",{class:"mdi mdi-check-circle"},null,-1)),e("div",null,[b[3]||(b[3]=e("h4",null,"Profile Ready!",-1)),e("p",null,u(o.profile.manufacturer)+" "+u(o.profile.model),1)])]),e("div",ad,[e("div",id,[e("span",rd,u(m.value),1),b[5]||(b[5]=e("span",{class:"stat-label"},"Commands Learned",-1))]),e("div",dd,[e("span",ud,u(o.profile.platform),1),b[6]||(b[6]=e("span",{class:"stat-label"},"Platform",-1))]),e("div",cd,[e("span",md,u(((t=o.profile.config.modes)==null?void 0:t.length)||0),1),b[7]||(b[7]=e("span",{class:"stat-label"},"HVAC Modes",-1))])])]),e("div",vd,[e("button",{onClick:b[0]||(b[0]=L=>k.value="json"),class:Z(["tab-button",{active:k.value==="json"}])},[...b[8]||(b[8]=[e("i",{class:"mdi mdi-code-json"},null,-1),S(" SmartIR JSON ",-1)])],2),e("button",{onClick:b[1]||(b[1]=L=>k.value="yaml"),class:Z(["tab-button",{active:k.value==="yaml"}])},[...b[9]||(b[9]=[e("i",{class:"mdi mdi-file-code"},null,-1),S(" YAML Config ",-1)])],2),e("button",{onClick:b[2]||(b[2]=L=>k.value="instructions"),class:Z(["tab-button",{active:k.value==="instructions"}])},[...b[10]||(b[10]=[e("i",{class:"mdi mdi-information"},null,-1),S(" Instructions ",-1)])],2)]),e("div",pd,[k.value==="json"?(n(),a("div",fd,[e("div",gd,[b[12]||(b[12]=e("h4",null,"SmartIR Device Code JSON",-1)),e("button",{onClick:_,class:"btn-copy"},[b[11]||(b[11]=e("i",{class:"mdi mdi-content-copy"},null,-1)),S(" "+u(w.value?"Copied!":"Copy"),1)])]),e("pre",yd,[e("code",null,u(v.value),1)]),b[13]||(b[13]=e("p",{class:"code-note"},[e("i",{class:"mdi mdi-information"}),S(" Save this as "),e("code",null,"10000.json"),S(" in your SmartIR codes directory ")],-1))])):T("",!0),k.value==="yaml"?(n(),a("div",bd,[e("div",hd,[b[15]||(b[15]=e("h4",null,"Home Assistant Configuration",-1)),e("button",{onClick:I,class:"btn-copy"},[b[14]||(b[14]=e("i",{class:"mdi mdi-content-copy"},null,-1)),S(" "+u(s.value?"Copied!":"Copy"),1)])]),e("pre",kd,[e("code",null,u(o.yamlConfig),1)]),b[16]||(b[16]=e("p",{class:"code-note"},[e("i",{class:"mdi mdi-information"}),S(" Add this to your "),e("code",null,"configuration.yaml"),S(" file ")],-1))])):T("",!0),k.value==="instructions"?(n(),a("div",wd,[e("div",$d,[b[20]||(b[20]=e("h4",null,"Installation Steps",-1)),e("div",Cd,[b[19]||(b[19]=e("div",{class:"step-number"},"1",-1)),e("div",_d,[b[17]||(b[17]=e("h5",null,"Get Next Code Number",-1)),b[18]||(b[18]=e("p",null,"Custom device codes start at 10000. Check your SmartIR codes directory to find the next available number.",-1)),e("div",Sd,[e("code",null,"/config/custom_components/smartir/codes/"+u(o.profile.platform)+"/",1)])])]),b[21]||(b[21]=Le('<div class="step-item" data-v-cbf0874d><div class="step-number" data-v-cbf0874d>2</div><div class="step-content" data-v-cbf0874d><h5 data-v-cbf0874d>Save JSON File</h5><p data-v-cbf0874d>Copy the JSON from the &quot;SmartIR JSON&quot; tab and save it as <code data-v-cbf0874d>10000.json</code> (or your next available number) in the codes directory.</p></div></div><div class="step-item" data-v-cbf0874d><div class="step-number" data-v-cbf0874d>3</div><div class="step-content" data-v-cbf0874d><h5 data-v-cbf0874d>Update Configuration</h5><p data-v-cbf0874d>Copy the YAML from the &quot;YAML Config&quot; tab and add it to your <code data-v-cbf0874d>configuration.yaml</code> file. Update the <code data-v-cbf0874d>device_code</code> to match your JSON filename.</p></div></div><div class="step-item" data-v-cbf0874d><div class="step-number" data-v-cbf0874d>4</div><div class="step-content" data-v-cbf0874d><h5 data-v-cbf0874d>Restart Home Assistant</h5><p data-v-cbf0874d>Restart Home Assistant to load the new configuration. Your climate entity will appear in the UI.</p></div></div><div class="step-item" data-v-cbf0874d><div class="step-number" data-v-cbf0874d>5</div><div class="step-content" data-v-cbf0874d><h5 data-v-cbf0874d>Test Your Device</h5><p data-v-cbf0874d>Go to your climate entity and test different modes, temperatures, and fan speeds to ensure everything works correctly.</p></div></div><div class="tips-section" data-v-cbf0874d><h4 data-v-cbf0874d><i class="mdi mdi-lightbulb" data-v-cbf0874d></i> Tips </h4><ul data-v-cbf0874d><li data-v-cbf0874d>Keep a backup of your JSON file in case you need to modify it</li><li data-v-cbf0874d>Test all commands to ensure they work as expected</li><li data-v-cbf0874d>You can share your profile with the SmartIR community on GitHub</li><li data-v-cbf0874d>If a command doesn&#39;t work, you can re-learn it and update the JSON</li></ul></div>',5))])])):T("",!0)])])}}},Dd=he(Id,[["__scopeId","data-v-cbf0874d"]]),xd={class:"wizard-body"},Td={key:0,class:"warning-section"},Rd={class:"warning-box"},Md={class:"instructions"},Ad={class:"code-block"},Ld={class:"steps"},Od={key:0},Ed={class:"help-section"},Vd={key:0,class:"help-content"},Ud={class:"help-step"},Pd={key:0,class:"help-step"},jd={class:"help-step"},Fd={class:"help-step"},Nd={class:"checklist"},Bd={class:"checkbox-label"},qd={key:0,class:"checkbox-label"},Hd={class:"wizard-footer"},zd=["disabled"],Jd={__name:"SmartIRSetupWizard",props:{show:{type:Boolean,default:!1},platform:{type:String,required:!0},warnings:{type:Array,default:()=>[]},configPath:{type:String,default:"/config"}},emits:["close","complete"],setup(o,{emit:c}){const r=o,k=c,w=Se("toast"),s=y(!1),m=y(!1),v=y(!1),_=J(()=>r.warnings.length>0?s.value&&m.value:s.value);function I(){const b=`${r.platform}: !include smartir/${r.platform}.yaml`;navigator.clipboard.writeText(b).then(()=>{var t;(t=w.value)==null||t.success("Include line copied to clipboard!","âœ… Copied")}).catch(t=>{var L;console.error("Failed to copy:",t),(L=w.value)==null||L.error("Failed to copy to clipboard","âŒ Copy Failed")})}function V(){k("complete")}return(b,t)=>o.show?(n(),a("div",{key:0,class:"modal-overlay",onClick:t[5]||(t[5]=pe(()=>{},["stop"]))},[e("div",{class:"setup-wizard",onClick:t[4]||(t[4]=pe(()=>{},["stop"]))},[t[31]||(t[31]=e("div",{class:"wizard-header"},[e("h2",null,[e("i",{class:"mdi mdi-cog"}),S(" SmartIR Configuration Setup ")])],-1)),e("div",xd,[o.warnings.length>0?(n(),a("div",Td,[e("div",Rd,[t[11]||(t[11]=e("i",{class:"mdi mdi-alert"},null,-1)),e("div",null,[t[9]||(t[9]=e("h3",null,"âš ï¸ Configuration Migration Needed",-1)),t[10]||(t[10]=e("p",null,"We detected existing platform entries in your configuration.yaml:",-1)),e("ul",null,[(n(!0),a(me,null,be(o.warnings,L=>(n(),a("li",{key:L.platform},[e("strong",null,u(L.platform)+":",1),S(" "+u(L.message),1)]))),128))]),e("p",null,[t[6]||(t[6]=e("strong",null,"Action Required:",-1)),t[7]||(t[7]=S(" Move these entries to ",-1)),e("code",null,"smartir/"+u(o.platform)+".yaml",1),t[8]||(t[8]=S(" before continuing.",-1))])])])])):T("",!0),e("div",Md,[t[27]||(t[27]=e("h3",null,"ðŸ“ One-Time Setup",-1)),t[28]||(t[28]=e("p",null,[S("To enable SmartIR device management, add this line to your "),e("code",null,"configuration.yaml"),S(":")],-1)),e("div",Ad,[e("code",null,u(o.platform)+": !include smartir/"+u(o.platform)+".yaml",1),e("button",{onClick:I,class:"copy-btn",title:"Copy to clipboard"},[...t[12]||(t[12]=[e("i",{class:"mdi mdi-content-copy"},null,-1)])])]),e("div",Ld,[t[19]||(t[19]=e("h4",null,"Steps:",-1)),e("ol",null,[o.warnings.length>0?(n(),a("li",Od,[t[13]||(t[13]=e("strong",null,"Move existing entries:",-1)),t[14]||(t[14]=S(" Copy any existing ",-1)),e("code",null,u(o.platform)+":",1),t[15]||(t[15]=S(" entries from configuration.yaml to ",-1)),e("code",null,"smartir/"+u(o.platform)+".yaml",1)])):T("",!0),t[16]||(t[16]=e("li",null,[e("strong",null,"Add include line:"),S(" Add the line above to your configuration.yaml ")],-1)),t[17]||(t[17]=e("li",null,[e("strong",null,"Save changes:"),S(" Save configuration.yaml ")],-1)),t[18]||(t[18]=e("li",null,[e("strong",null,"Continue here:"),S(` Click "I've Completed Setup" below `)],-1))])]),e("div",Ed,[e("button",{onClick:t[0]||(t[0]=L=>v.value=!v.value),class:"help-toggle"},[e("i",{class:Z(["mdi",v.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2),S(" "+u(v.value?"Hide":"Show")+" Detailed Instructions ",1)]),v.value?(n(),a("div",Vd,[t[26]||(t[26]=e("h4",null,"Detailed Setup Guide:",-1)),e("div",Ud,[t[21]||(t[21]=e("h5",null,"1. Open configuration.yaml",-1)),e("p",null,[t[20]||(t[20]=S("Location: ",-1)),e("code",null,u(o.configPath)+"/configuration.yaml",1)])]),o.warnings.length>0?(n(),a("div",Pd,[t[22]||(t[22]=e("h5",null,"2. Migrate Existing Entries (If Any)",-1)),e("p",null,"If you have existing "+u(o.platform)+" entries, cut them from configuration.yaml and paste into:",1),e("p",null,[e("code",null,u(o.configPath)+"/smartir/"+u(o.platform)+".yaml",1)]),t[23]||(t[23]=e("p",{class:"note"},"Broadlink Manager will create this file automatically.",-1))])):T("",!0),e("div",jd,[e("h5",null,u(o.warnings.length>0?"3":"2")+". Add Include Line",1),t[24]||(t[24]=e("p",null,"Add this to configuration.yaml:",-1)),e("pre",null,u(o.platform)+": !include smartir/"+u(o.platform)+".yaml",1)]),e("div",Fd,[e("h5",null,u(o.warnings.length>0?"4":"3")+". Restart Home Assistant",1),t[25]||(t[25]=e("p",null,"After saving, you'll need to restart HA for changes to take effect.",-1))])])):T("",!0)])]),e("div",Nd,[e("label",Bd,[W(e("input",{type:"checkbox","onUpdate:modelValue":t[1]||(t[1]=L=>s.value=L)},null,512),[[ve,s.value]]),t[29]||(t[29]=e("span",null,"I've added the include line to configuration.yaml",-1))]),o.warnings.length>0?(n(),a("label",qd,[W(e("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=L=>m.value=L)},null,512),[[ve,m.value]]),e("span",null,"I've migrated existing "+u(o.platform)+" entries (if any)",1)])):T("",!0)])]),e("div",Hd,[e("button",{onClick:t[3]||(t[3]=L=>b.$emit("close")),class:"btn-secondary"}," Cancel "),e("button",{onClick:V,class:"btn-primary",disabled:!_.value},[...t[30]||(t[30]=[e("i",{class:"mdi mdi-check"},null,-1),S(" I've Completed Setup ",-1)])],8,zd)])])])):T("",!0)}},Wd=he(Jd,[["__scopeId","data-v-f6fe4c03"]]),Kd={class:"modal-header"},Xd={class:"progress-steps"},Gd={class:"step-number"},Yd={key:0,class:"mdi mdi-check"},Zd={key:1},Qd={class:"step-label"},eu={class:"modal-body"},tu={key:0,class:"step-content"},ou={class:"form-group"},lu={class:"form-group"},nu={class:"form-group"},su={key:1,class:"step-content"},au={key:1,class:"platform-form"},iu={class:"form-section"},ru={class:"checkbox-grid"},du={class:"checkbox-item"},uu={class:"checkbox-item"},cu={class:"checkbox-item"},mu={class:"checkbox-item"},vu={class:"checkbox-item"},pu={key:2,class:"platform-form"},fu={class:"form-section"},gu={class:"form-group"},yu={class:"form-section"},bu={class:"checkbox-grid"},hu={class:"checkbox-item"},ku={class:"checkbox-item"},wu={key:3,class:"platform-form"},$u={class:"form-section"},Cu={class:"checkbox-grid"},_u={class:"checkbox-item"},Su={class:"checkbox-item"},Iu={class:"checkbox-item"},Du={class:"checkbox-item"},xu={key:2,class:"step-content"},Tu={key:3,class:"step-content"},Ru={class:"modal-footer"},Mu=["disabled"],Au={key:2,class:"save-buttons"},Lu=["disabled"],Ou=["disabled"],Eu={__name:"SmartIRProfileBuilder",props:{show:{type:Boolean,default:!1},editMode:{type:Boolean,default:!1},editData:{type:Object,default:null},startStep:{type:Number,default:0}},emits:["close","save"],setup(o,{emit:c}){const r=o,k=c,w=Se("toast"),s=y(0),m=y(!1),v=y([]),_=y(!1),I=y([]),V=y("/config"),b=y(!1),t=y(null),L=y(!1),q=y(!1),U=y(""),M=y("ir"),i=y(!1),g=[{label:"Device Info",key:"info"},{label:"Configuration",key:"config"},{label:"Learn Commands",key:"commands"},{label:"Preview & Save",key:"preview"}],p=y({platform:"",manufacturer:"",model:"",broadlinkDevice:"",commandType:"ir",config:{},commands:{}}),R=y(["turn_on"]),X=y(3),te=y([]),le=y(["turn_on"]);de(()=>p.value.platform,E=>{E==="media_player"?p.value.config={features:R.value}:E==="fan"?p.value.config={speedLevels:X.value,features:te.value}:E==="light"&&(p.value.config={features:le.value})}),de(R,E=>{p.value.platform==="media_player"&&(p.value.config={features:E})},{deep:!0}),de(X,E=>{p.value.platform==="fan"&&(p.value.config={speedLevels:E,features:te.value})}),de(te,E=>{p.value.platform==="fan"&&(p.value.config={speedLevels:X.value,features:E})},{deep:!0}),de(le,E=>{p.value.platform==="light"&&(p.value.config={features:E})},{deep:!0});function ae(E){const l=new Set,F=Object.keys(E);return F.some($=>$==="off"||$.includes("_off"))&&l.add("off"),F.some($=>$.includes("auto"))&&l.add("auto"),F.some($=>$.includes("cool"))&&l.add("cool"),F.some($=>$.includes("heat"))&&l.add("heat"),F.some($=>$.includes("dry"))&&l.add("dry"),F.some($=>$.includes("fan_only"))&&l.add("fan_only"),Array.from(l)}function A(E){const l=new Set,F=Object.keys(E);return F.some($=>$.includes("auto"))&&l.add("auto"),F.some($=>$.includes("low"))&&l.add("low"),F.some($=>$.includes("medium")||$.includes("mid"))&&l.add("medium"),F.some($=>$.includes("high"))&&l.add("high"),Array.from(l)}function N(E){const l=new Set,F=Object.keys(E);return F.some($=>$.includes("swing_off")||$.includes("_off"))&&l.add("off"),F.some($=>$.includes("vertical"))&&l.add("vertical"),F.some($=>$.includes("horizontal"))&&l.add("horizontal"),F.some($=>$.includes("both"))&&l.add("both"),Array.from(l)}function Q(E){for(const l of Object.values(E))if(typeof l=="string"&&l.startsWith("sc")||Array.isArray(l)&&l.length>0&&typeof l[0]=="string"&&l[0].startsWith("sc"))return"rf";return"ir"}de(()=>p.value.commandType,(E,l)=>{!l||L.value||i.value||(Object.keys(p.value.commands).length>0&&E!==l?(U.value=E,p.value.commandType=l,L.value=!0):E!==l&&(M.value=E))}),de(()=>r.editData,async E=>{var l,F,$;if(E&&r.editMode){console.log("ðŸ”§ Edit mode activated, loading profile data:",E),i.value=!0,v.value.length===0&&(console.log("ðŸ“¡ Loading Broadlink devices..."),await ce(),console.log("ðŸ“¡ Devices loaded:",v.value.length));const h=E.profile,j=h.controller_data;console.log("ðŸŽ® Controller data from profile:",j),console.log("ðŸŽ® Available devices:",v.value.map(K=>K.entity_id));const O=h.commands||{},ee=h.commandType||Q(O);console.log("ðŸ” Command type (stored):",h.commandType),console.log("ðŸ” Command type (final):",ee);let ne={};if(E.platform==="climate"){const K=h.operationModes||ae(O),ge=h.fanModes||A(O),Ce=h.swingModes||N(O);console.log("ðŸ” Inferred modes:",K),console.log("ðŸ” Inferred fan modes:",ge),console.log("ðŸ” Inferred swing modes:",Ce),ne={minTemp:h.minTemperature,maxTemp:h.maxTemperature,precision:h.precision,modes:K,fanModes:ge,swingModes:Ce}}else if(E.platform==="media_player"){const K=[];(O.on||O.off)&&K.push("turn_on"),(O.volumeUp||O.volumeDown)&&K.push("volume"),O.mute&&K.push("mute"),O.sources&&K.push("source"),(O.channelUp||O.channelDown)&&K.push("channel"),ne={features:K},R.value=K,console.log("ðŸ” Inferred media player features:",K)}else if(E.platform==="fan"){const K=((l=h.speed)==null?void 0:l.length)||Object.keys(O.default||{}).length||3,ge=[];(O.oscillate_on||O.oscillate_off)&&ge.push("oscillate"),(O.direction_forward||O.direction_reverse)&&ge.push("direction"),ne={speedLevels:K,features:ge},X.value=K,te.value=ge,console.log("ðŸ” Inferred fan config:",ne)}else if(E.platform==="light"){const K=[];ne={features:K},le.value=K,console.log("ðŸ” Inferred light features:",K)}const re=await D(h.manufacturer,(F=h.supportedModels)==null?void 0:F[0],O);p.value={platform:E.platform,manufacturer:h.manufacturer||"",model:(($=h.supportedModels)==null?void 0:$[0])||"",broadlinkDevice:j||"",commandType:ee,config:ne,commands:re},console.log("âœ… Profile populated:",p.value),console.log("âœ… Selected device:",p.value.broadlinkDevice),console.log("âœ… Command type:",p.value.commandType),console.log("âœ… Commands (with learned codes):",re),M.value=ee,setTimeout(()=>{i.value=!1},100)}},{immediate:!0});const ue=J(()=>{var E;switch(s.value){case 0:return p.value.platform&&p.value.manufacturer&&p.value.model;case 1:return p.value.platform==="climate"?p.value.config.minTemp&&p.value.config.maxTemp&&((E=p.value.config.modes)==null?void 0:E.length)>0:!0;case 2:return p.value.broadlinkDevice&&p.value.commandType&&Object.keys(p.value.commands).length>0;case 3:return!0;default:return!1}}),ye=y(null);async function De(){if(s.value!==3){ye.value=null;return}if(console.log("ðŸ” Generating JSON with commands:",p.value.commands),Object.values(p.value.commands).some(l=>typeof l=="string"?l==="pending":typeof l=="object"?Object.values(l).some(F=>typeof F=="string"?F==="pending":typeof F=="object"?Object.values(F).some($=>$==="pending"):!1):!1)){console.warn('âš ï¸ Commands still contain "pending" placeholders!'),console.log("ðŸ“¦ Attempting to fetch from Broadlink storage...");const l=await D(p.value.manufacturer,p.value.model,p.value.commands);p.value.commands=l,console.log("âœ… Updated commands:",l)}ye.value=ie(p.value),console.log("ðŸ“„ Generated JSON:",ye.value)}const we=J(()=>s.value!==3?null:G(p.value));function $e(){p.value.config={},p.value.commands={}}function x(){L.value=!1,p.value.commandType=U.value,M.value=U.value,p.value.commands={},U.value=""}function d(){L.value=!1,U.value=""}async function P(){s.value<g.length-1&&(s.value++,s.value===3&&await De())}function H(){s.value>0&&s.value--}function f(){L.value||(q.value=!0)}function C(){q.value=!1,B()}function B(){k("close"),setTimeout(()=>{s.value=0,p.value={platform:"",manufacturer:"",model:"",broadlinkDevice:"",commandType:"ir",config:{},commands:{}},M.value="ir"},300)}async function Y(){var E,l,F,$,h,j;m.value=!0;try{if(!b.value){const ge=(await oe.get("/api/smartir/config/check")).data;if(ge&&!((E=ge.platforms[p.value.platform])==null?void 0:E.file_exists)){I.value=ge.configuration_warnings||[],V.value=ge.config_path||"/config",t.value={platform:p.value.platform,json:ye.value},_.value=!0,m.value=!1;return}}let O;r.editMode&&((l=r.editData)!=null&&l.code)?(O=parseInt(r.editData.code),console.log("ðŸ“ Edit mode: Using existing code",O)):(O=(await oe.get(`/api/smartir/platforms/${p.value.platform}/next-code`)).data.next_code,console.log("âœ¨ New profile: Using next code",O));const ne=(await oe.post("/api/smartir/profiles",{platform:p.value.platform,json:ye.value,code_number:O})).data,re={platform:"smartir",name:`${p.value.manufacturer} ${p.value.model}`,unique_id:`${p.value.manufacturer.toLowerCase().replace(/[^a-z0-9]+/g,"_")}_${p.value.model.toLowerCase().replace(/[^a-z0-9]+/g,"_")}`,device_code:O,controller_data:p.value.broadlinkDevice};try{await oe.post("/api/smartir/config/add-device",{platform:p.value.platform,entity_type:p.value.platform,name:re.name,unique_id:re.unique_id,device_code:re.device_code,controller_data:re.controller_data})}catch(K){console.error("Failed to add device to config:",K);const ge=((F=K.response)==null?void 0:F.data)||{};let Ce=ge.error||"Unknown error";ge.validation_errors&&ge.validation_errors.length>0&&(Ce=`Device configuration validation failed:
`+ge.validation_errors.map(Ae=>`  â€¢ ${Ae}`).join(`
`)),($=w.value)==null||$.warning(`Profile saved but failed to add to config file:
${Ce}`,"âš ï¸ Partial Success")}k("save",{json:ye.value,yaml:we.value,profile:p.value,saved_to:ne.path}),(h=w.value)==null||h.success(`File: ${ne.filename}
Device Code: ${O}
Added to: smartir/${p.value.platform}.yaml

âš ï¸ Restart Home Assistant to activate`,"âœ… Profile Saved Successfully!"),B()}catch(O){console.error("Error saving profile:",O),(j=w.value)==null||j.error(O.message,"âŒ Error Saving Profile")}finally{m.value=!1}}async function se(){b.value=!0,_.value=!1,t.value&&(await Y(),t.value=null)}function z(){var E,l;try{const F=JSON.stringify(ye.value,null,2),$=new Blob([F],{type:"application/json"}),h=URL.createObjectURL($),j=document.createElement("a");j.href=h;const O=p.value.manufacturer.toLowerCase().replace(/\s+/g,"_"),ee=p.value.model.toLowerCase().replace(/\s+/g,"_");j.download=`smartir_${p.value.platform}_${O}_${ee}.json`,document.body.appendChild(j),j.click(),document.body.removeChild(j),URL.revokeObjectURL(h),(E=w.value)==null||E.success("You can manually upload this file to your SmartIR codes directory.","âœ… Profile Downloaded")}catch(F){console.error("Error downloading profile:",F),(l=w.value)==null||l.error(F.message,"âŒ Error Downloading Profile")}}async function D(E,l,F){const $=E.toLowerCase().replace(/[^a-z0-9]+/g,"_"),h=l.toLowerCase().replace(/[^a-z0-9]+/g,"_"),j=`${$}_${h}`;try{const ne=(await oe.get("/api/commands/all")).data[j]||{};console.log(`ðŸ” Fetching learned commands for device: ${j}`),console.log("ðŸ“¦ Device commands from storage:",ne);const re={...F};for(const[K,ge]of Object.entries(re))if(ge==="pending"&&ne[K])re[K]=ne[K];else if(typeof ge=="object"){for(const[Ce,Ae]of Object.entries(ge))if(typeof Ae=="object")for(const[Re,Qe]of Object.entries(Ae)){const Be=`${K}_${Ce}_${Re}`;Qe==="pending"&&ne[Be]&&(re[K][Ce][Re]=ne[Be])}else if(Ae==="pending"){const Re=`${K}_${Ce}`;ne[Re]&&(re[K][Ce]=ne[Re])}}return console.log("âœ… Merged commands:",re),re}catch(O){return console.error("Error fetching learned commands:",O),F}}function ie(E){const l={manufacturer:E.manufacturer,supportedModels:[E.model],supportedController:"Broadlink",commandsEncoding:"Base64",commandType:E.commandType||"ir",commands:{}};return E.platform==="climate"&&(l.minTemperature=E.config.minTemp,l.maxTemperature=E.config.maxTemp,l.precision=E.config.precision||1,l.operationModes=E.config.modes||[],l.fanModes=E.config.fanModes&&E.config.fanModes.length>0?E.config.fanModes:["auto"],E.config.swingModes&&E.config.swingModes.length>0&&(l.swingModes=E.config.swingModes),l.commands=E.commands),l}function G(E){let l=`# SmartIR ${E.platform} configuration
`;return l+=`# Generated by Broadlink Manager v2

`,E.platform==="climate"&&(l+=`climate:
`,l+=`  - platform: smartir
`,l+=`    name: ${E.manufacturer} ${E.model}
`,l+=`    unique_id: ${E.manufacturer.toLowerCase()}_${E.model.toLowerCase().replace(/\s+/g,"_")}
`,l+=`    device_code: 10000  # Change this to your custom code number
`,l+=`    controller_data: ${E.broadlinkDevice}
`,E.config.tempSensor&&(l+=`    temperature_sensor: ${E.config.tempSensor}
`),E.config.humiditySensor&&(l+=`    humidity_sensor: ${E.config.humiditySensor}
`),E.config.powerSensor&&(l+=`    power_sensor: ${E.config.powerSensor}
`)),l}async function ce(){try{console.log("Fetching remote devices from /api/remote/devices...");const E=await oe.get("/api/remote/devices");console.log("Loaded remote devices response:",E.data);const l=E.data.devices||[];console.log("Extracted devices array:",l),console.log("Device count:",l.length),v.value=l,console.log("broadlinkDevices.value set to:",v.value),console.log("Final device count:",v.value.length)}catch(E){console.error("Error loading remote devices:",E),v.value=[]}}return de(()=>r.show,E=>{if(E){const l=Number.isInteger(r.startStep)?r.startStep:0;s.value=Math.min(Math.max(l,0),g.length-1)}}),de(()=>r.startStep,E=>{if(r.show){const l=Number.isInteger(E)?E:0;s.value=Math.min(Math.max(l,0),g.length-1)}}),xe(()=>{r.show&&ce()}),(E,l)=>o.show?(n(),a("div",{key:0,class:"modal-overlay",onClick:f},[e("div",{class:"modal-container",onClick:l[19]||(l[19]=pe(()=>{},["stop"]))},[e("div",Kd,[e("h2",null,[l[22]||(l[22]=e("i",{class:"mdi mdi-file-document-edit"},null,-1)),S(" "+u(o.editMode?"Edit SmartIR Profile":"Create SmartIR Profile"),1)]),e("button",{onClick:B,class:"close-button"},[...l[23]||(l[23]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Xd,[(n(),a(me,null,be(g,(F,$)=>e("div",{key:$,class:Z(["step",{active:s.value===$,completed:s.value>$}])},[e("div",Gd,[s.value>$?(n(),a("i",Yd)):(n(),a("span",Zd,u($+1),1))]),e("span",Qd,u(F.label),1)],2)),64))]),e("div",eu,[s.value===0?(n(),a("div",tu,[l[29]||(l[29]=e("h3",null,"Device Information",-1)),e("div",ou,[l[25]||(l[25]=e("label",null,"Platform Type *",-1)),W(e("select",{"onUpdate:modelValue":l[0]||(l[0]=F=>p.value.platform=F),onChange:$e},[...l[24]||(l[24]=[Le('<option value="" data-v-e9a50cce>Select platform...</option><option value="climate" data-v-e9a50cce>ðŸŒ¡ï¸ Climate (AC, Heater, Heat Pump)</option><option value="media_player" data-v-e9a50cce>ðŸ“º Media Player (TV, Receiver)</option><option value="fan" data-v-e9a50cce>ðŸŒ€ Fan</option><option value="light" data-v-e9a50cce>ðŸ’¡ Light (LED Strip, IR Light)</option>',5)])],544),[[ke,p.value.platform]])]),e("div",lu,[l[26]||(l[26]=e("label",null,"Manufacturer *",-1)),W(e("input",{"onUpdate:modelValue":l[1]||(l[1]=F=>p.value.manufacturer=F),type:"text",placeholder:"e.g., Daikin, LG, Samsung"},null,512),[[Ie,p.value.manufacturer]])]),e("div",nu,[l[27]||(l[27]=e("label",null,"Model(s) *",-1)),W(e("input",{"onUpdate:modelValue":l[2]||(l[2]=F=>p.value.model=F),type:"text",placeholder:"e.g., FTXS35K, Multiple models"},null,512),[[Ie,p.value.model]]),l[28]||(l[28]=e("small",null,'Enter model number or "Multiple" if it works with many models',-1))])])):T("",!0),s.value===1?(n(),a("div",su,[p.value.platform==="climate"?(n(),Te(Cr,{key:0,modelValue:p.value.config,"onUpdate:modelValue":l[3]||(l[3]=F=>p.value.config=F)},null,8,["modelValue"])):p.value.platform==="media_player"?(n(),a("div",au,[l[36]||(l[36]=e("h3",null,"Media Player Configuration",-1)),l[37]||(l[37]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),S(" Configure the features your media player supports. You'll learn the IR commands in the next step. ")],-1)),e("div",iu,[l[35]||(l[35]=e("h4",null,"Supported Features",-1)),e("div",ru,[e("label",du,[W(e("input",{type:"checkbox",value:"turn_on","onUpdate:modelValue":l[4]||(l[4]=F=>R.value=F)},null,512),[[ve,R.value]]),l[30]||(l[30]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),S(" Power On/Off ")],-1))]),e("label",uu,[W(e("input",{type:"checkbox",value:"volume","onUpdate:modelValue":l[5]||(l[5]=F=>R.value=F)},null,512),[[ve,R.value]]),l[31]||(l[31]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-volume-high"}),S(" Volume Control ")],-1))]),e("label",cu,[W(e("input",{type:"checkbox",value:"mute","onUpdate:modelValue":l[6]||(l[6]=F=>R.value=F)},null,512),[[ve,R.value]]),l[32]||(l[32]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-volume-mute"}),S(" Mute ")],-1))]),e("label",mu,[W(e("input",{type:"checkbox",value:"source","onUpdate:modelValue":l[7]||(l[7]=F=>R.value=F)},null,512),[[ve,R.value]]),l[33]||(l[33]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-import"}),S(" Source Selection ")],-1))]),e("label",vu,[W(e("input",{type:"checkbox",value:"channel","onUpdate:modelValue":l[8]||(l[8]=F=>R.value=F)},null,512),[[ve,R.value]]),l[34]||(l[34]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-numeric"}),S(" Channel Control ")],-1))])])])])):p.value.platform==="fan"?(n(),a("div",pu,[l[44]||(l[44]=e("h3",null,"Fan Configuration",-1)),l[45]||(l[45]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),S(" Configure the features your fan supports. You'll learn the IR commands in the next step. ")],-1)),e("div",fu,[l[40]||(l[40]=e("h4",null,"Fan Speed Levels",-1)),e("div",gu,[l[39]||(l[39]=e("label",null,"Number of Speed Levels *",-1)),W(e("select",{"onUpdate:modelValue":l[9]||(l[9]=F=>X.value=F)},[...l[38]||(l[38]=[e("option",{value:1},"1 Speed",-1),e("option",{value:2},"2 Speeds",-1),e("option",{value:3},"3 Speeds (Low/Med/High)",-1),e("option",{value:4},"4 Speeds",-1),e("option",{value:5},"5 Speeds",-1),e("option",{value:6},"6 Speeds",-1)])],512),[[ke,X.value,void 0,{number:!0}]])])]),e("div",yu,[l[43]||(l[43]=e("h4",null,"Additional Features",-1)),e("div",bu,[e("label",hu,[W(e("input",{type:"checkbox",value:"oscillate","onUpdate:modelValue":l[10]||(l[10]=F=>te.value=F)},null,512),[[ve,te.value]]),l[41]||(l[41]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-sync"}),S(" Oscillation ")],-1))]),e("label",ku,[W(e("input",{type:"checkbox",value:"direction","onUpdate:modelValue":l[11]||(l[11]=F=>te.value=F)},null,512),[[ve,te.value]]),l[42]||(l[42]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-rotate-3d-variant"}),S(" Direction (Forward/Reverse) ")],-1))])])])])):p.value.platform==="light"?(n(),a("div",wu,[l[51]||(l[51]=e("h3",null,"Light Configuration",-1)),l[52]||(l[52]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),S(" Configure the features your light supports. You'll learn the IR commands in the next step. ")],-1)),e("div",$u,[l[50]||(l[50]=e("h4",null,"Supported Features",-1)),e("div",Cu,[e("label",_u,[W(e("input",{type:"checkbox",value:"turn_on","onUpdate:modelValue":l[12]||(l[12]=F=>le.value=F)},null,512),[[ve,le.value]]),l[46]||(l[46]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),S(" Power On/Off ")],-1))]),e("label",Su,[W(e("input",{type:"checkbox",value:"brightness","onUpdate:modelValue":l[13]||(l[13]=F=>le.value=F)},null,512),[[ve,le.value]]),l[47]||(l[47]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-brightness-6"}),S(" Brightness Control ")],-1))]),e("label",Iu,[W(e("input",{type:"checkbox",value:"color_temp","onUpdate:modelValue":l[14]||(l[14]=F=>le.value=F)},null,512),[[ve,le.value]]),l[48]||(l[48]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-thermometer"}),S(" Color Temperature ")],-1))]),e("label",Du,[W(e("input",{type:"checkbox",value:"rgb","onUpdate:modelValue":l[15]||(l[15]=F=>le.value=F)},null,512),[[ve,le.value]]),l[49]||(l[49]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-palette"}),S(" RGB Color ")],-1))])])])])):T("",!0)])):T("",!0),s.value===2?(n(),a("div",xu,[fe(od,{modelValue:p.value.commands,"onUpdate:modelValue":l[16]||(l[16]=F=>p.value.commands=F),platform:p.value.platform,config:p.value.config,broadlinkDevice:p.value.broadlinkDevice,"onUpdate:broadlinkDevice":l[17]||(l[17]=F=>p.value.broadlinkDevice=F),manufacturer:p.value.manufacturer,model:p.value.model,commandType:p.value.commandType,"onUpdate:commandType":l[18]||(l[18]=F=>p.value.commandType=F)},null,8,["modelValue","platform","config","broadlinkDevice","manufacturer","model","commandType"])])):T("",!0),s.value===3?(n(),a("div",Tu,[fe(Dd,{profile:p.value,"json-data":ye.value,"yaml-config":we.value},null,8,["profile","json-data","yaml-config"])])):T("",!0)]),e("div",Ru,[s.value>0?(n(),a("button",{key:0,onClick:H,class:"btn-secondary"},[...l[53]||(l[53]=[e("i",{class:"mdi mdi-arrow-left"},null,-1),S(" Back ",-1)])])):T("",!0),l[57]||(l[57]=e("div",{class:"spacer"},null,-1)),e("button",{onClick:B,class:"btn-text"}," Cancel "),s.value<g.length-1?(n(),a("button",{key:1,onClick:P,class:"btn-primary",disabled:!ue.value},[...l[54]||(l[54]=[S(" Next ",-1),e("i",{class:"mdi mdi-arrow-right"},null,-1)])],8,Mu)):(n(),a("div",Au,[e("button",{onClick:Y,class:"btn-primary",disabled:m.value},[l[55]||(l[55]=e("i",{class:"mdi mdi-cloud-upload"},null,-1)),S(" "+u(m.value?"Saving...":"Save to SmartIR"),1)],8,Lu),e("button",{onClick:z,class:"btn-secondary",disabled:m.value},[...l[56]||(l[56]=[e("i",{class:"mdi mdi-download"},null,-1),S(" Download JSON ",-1)])],8,Ou)]))])]),fe(Wd,{show:_.value,platform:p.value.platform,warnings:I.value,"config-path":V.value,onClose:l[20]||(l[20]=F=>_.value=!1),onComplete:se},null,8,["show","platform","warnings","config-path"]),fe(Me,{isOpen:L.value,title:"Change Command Type?",message:"Changing the command type will clear all learned commands. Continue?",confirmText:"Continue",cancelText:"Cancel",dangerMode:!0,onConfirm:x,onCancel:d},null,8,["isOpen"]),fe(Me,{isOpen:q.value,title:"Close Profile Builder?",message:"Are you sure you want to close? Your progress will be lost.",confirmText:"Close",cancelText:"Keep Editing",dangerMode:!0,onConfirm:C,onCancel:l[21]||(l[21]=F=>q.value=!1)},null,8,["isOpen"])])):T("",!0)}},Vu=he(Eu,[["__scopeId","data-v-e9a50cce"]]),Uu={class:"dashboard"},Pu={__name:"Dashboard",setup(o){const c=Ee(),r=Se("smartirEnabled"),k=y(!1),w=y(!1),s=y(null),m=y(0),v=y(null);function _(){w.value=!1,s.value=null,m.value=0,k.value=!0}async function I({platform:t,profile:L,startStep:q}){m.value=Number.isInteger(q)?q:0;try{const U=await fetch(`api/smartir/platforms/${t}/profiles/${L.code}`);if(!U.ok)throw new Error("Failed to load profile");const M=await U.json();let i="";try{const g=await fetch(`api/smartir/config/get-device?platform=${t}&code=${L.code}`);g.ok?(i=(await g.json()).controller_data||"",console.log("âœ… Found controller_data from YAML:",i)):console.warn("âš ï¸ No YAML entry found for this profile (this is OK for profiles not yet added to config)")}catch(g){console.warn("âš ï¸ Could not fetch controller_data from config:",g)}w.value=!0,s.value={platform:t,code:L.code,profile:{...M.profile,controller_data:i}},k.value=!0}catch(U){console.error("Error loading profile for edit:",U),c.error("Failed to load profile for editing")}}function V(){k.value=!1,w.value=!1,s.value=null}async function b(t){console.log("Profile saved:",t),V(),v.value&&v.value.loadAllProfiles&&(await v.value.loadAllProfiles(),console.log("âœ… Profiles list refreshed"))}return(t,L)=>(n(),a("div",Uu,[_e(r)?(n(),Te(Es,{key:0})):T("",!0),L[0]||(L[0]=Le('<div class="welcome-banner" data-v-f324d01b><div class="banner-content" data-v-f324d01b><div class="banner-icon" data-v-f324d01b><i class="mdi mdi-rocket-launch" data-v-f324d01b></i></div><div class="banner-text" data-v-f324d01b><h2 data-v-f324d01b>Welcome to Broadlink Manager v2!</h2><p data-v-f324d01b>Manage your IR/RF devices with a modern Vue 3 interface</p></div></div><div class="status-badges" data-v-f324d01b><span class="badge success" data-v-f324d01b><i class="mdi mdi-check-circle" data-v-f324d01b></i> Vue 3 Ready </span><span class="badge warning" data-v-f324d01b><i class="mdi mdi-beta" data-v-f324d01b></i> Beta </span></div></div>',1)),fe(Ts),_e(r)?(n(),Te(Di,{key:1,ref_key:"smartirStatusCard",ref:v,onCreateProfile:_,onEditProfile:I},null,512)):T("",!0),fe(Vu,{show:k.value,editMode:w.value,editData:s.value,startStep:m.value,onClose:V,onSave:b},null,8,["show","editMode","editData","startStep"])]))}},ju=he(Pu,[["__scopeId","data-v-f324d01b"]]),Fu={class:"toast-container"},Nu={class:"toast-content"},Bu={key:0,class:"toast-title"},qu={class:"toast-message"},Hu={key:1,class:"toast-description"},zu=["onClick","title"],Ju={__name:"Toast",setup(o,{expose:c}){const r=y([]);let k=0;function w(v){const _={success:"mdi-check-circle",error:"mdi-alert-circle",warning:"mdi-alert",info:"mdi-information"};return _[v]||_.info}function s({message:v,title:_,description:I,type:V="info",duration:b=5e3}){const t=k++,L={id:t,message:v,title:_,description:I,type:V};return r.value.push(L),b>0&&setTimeout(()=>{m(t)},b),t}function m(v){const _=r.value.findIndex(I=>I.id===v);_>-1&&r.value.splice(_,1)}return c({addToast:s,removeToast:m,show:s,success:(v,_)=>s({message:v,title:_,type:"success"}),error:(v,_)=>s({message:v,title:_,type:"error",duration:0}),warning:(v,_)=>s({message:v,title:_,type:"warning",duration:0}),info:(v,_)=>s({message:v,title:_,type:"info"})}),(v,_)=>(n(),Te(Ke,{to:"body"},[e("div",Fu,[fe(lt,{name:"toast"},{default:Fe(()=>[(n(!0),a(me,null,be(r.value,I=>(n(),a("div",{key:I.id,class:Z(["toast",[`toast-${I.type}`,{"toast-persistent":I.type==="error"||I.type==="warning"}]])},[e("i",{class:Z(["mdi",w(I.type)])},null,2),e("div",Nu,[I.title?(n(),a("div",Bu,u(I.title),1)):T("",!0),e("div",qu,u(I.message),1),I.description?(n(),a("div",Hu,u(I.description),1)):T("",!0)]),e("button",{onClick:V=>m(I.id),class:Z(["toast-close",{"toast-close-prominent":I.type==="error"||I.type==="warning"}]),title:I.type==="error"||I.type==="warning"?"Click to dismiss":"Close"},[..._[0]||(_[0]=[e("i",{class:"mdi mdi-close"},null,-1)])],10,zu)],2))),128))]),_:1})])]))}},Wu=he(Ju,[["__scopeId","data-v-f0587837"]]),Ku="0.3.0-alpha.1",Xu={version:Ku},Gu={id:"app",class:"app-container"},Yu={class:"app-header"},Zu={class:"header-content"},Qu={class:"header-right"},ec=["title"],tc={class:"settings-menu-container"},oc={key:0,class:"settings-menu"},lc=["title"],nc={class:"toggle-content"},sc={key:0,class:"not-installed-label"},ac={key:0,href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"menu-item menu-link menu-subitem"},ic=["disabled"],rc=["disabled"],dc=["disabled"],uc={class:"app-main"},cc={class:"app-footer"},mc={__name:"App",setup(o){const c=y(null),r=Xu.version,k=y("light"),w=y(null),s=y(!1),m=y(!1),v=y(!1),_=y(localStorage.getItem("smartir_enabled")!=="false"),I=J(()=>{var p;return((p=w.value)==null?void 0:p.installed)||!1}),V=J(()=>({light:"mdi mdi-weather-sunny",medium:"mdi mdi-weather-partly-cloudy",dark:"mdi mdi-weather-night"})[k.value]),b=J(()=>({light:"Switch to Medium Theme",medium:"Switch to Dark Theme",dark:"Switch to Light Theme"})[k.value]),t=()=>{const p=["light","medium","dark"],X=(p.indexOf(k.value)+1)%p.length;k.value=p[X],document.body.classList.remove("medium-mode","dark-mode"),k.value==="medium"?document.body.classList.add("medium-mode"):k.value==="dark"&&document.body.classList.add("dark-mode"),localStorage.setItem("theme",k.value)},L=async()=>{try{const p=await Ye.getStatus();w.value=p,p.installed?console.log("âœ… SmartIR detected:",p.version):console.log("â„¹ï¸ SmartIR not detected")}catch(p){console.error("Error checking SmartIR:",p),w.value={installed:!1,error:p.message}}},q=async()=>{var p,R,X;m.value=!0;try{const le=(await oe.get("/api/diagnostics/markdown")).data.markdown;if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(le),(p=c.value)==null||p.success("Diagnostic summary copied to clipboard!");else{const ae=document.createElement("textarea");ae.value=le,ae.style.position="fixed",ae.style.left="-999999px",ae.style.top="-999999px",document.body.appendChild(ae),ae.focus(),ae.select();try{if(document.execCommand("copy"))(R=c.value)==null||R.success("Diagnostic summary copied to clipboard!");else throw new Error("execCommand failed")}finally{document.body.removeChild(ae)}}s.value=!1}catch(te){console.error("Error copying diagnostics:",te),(X=c.value)==null||X.error("Failed to copy diagnostics: "+te.message)}finally{m.value=!1}},U=async()=>{var p,R;m.value=!0;try{const X=await oe.get("/api/diagnostics/download",{responseType:"blob"}),te=window.URL.createObjectURL(new Blob([X.data])),le=document.createElement("a");le.href=te;const ae=X.headers["content-disposition"];let A="broadlink_manager_diagnostics.zip";if(ae){const N=ae.match(/filename="?(.+)"?/);N&&(A=N[1])}le.setAttribute("download",A),document.body.appendChild(le),le.click(),le.remove(),window.URL.revokeObjectURL(te),(p=c.value)==null||p.success("Diagnostic bundle downloaded!"),s.value=!1}catch(X){console.error("Error downloading diagnostics:",X),(R=c.value)==null||R.error("Failed to download diagnostics")}finally{m.value=!1}},M=()=>{I.value&&(_.value=!_.value,localStorage.setItem("smartir_enabled",_.value.toString()),window.location.reload())},i=async()=>{var p,R,X;v.value=!0;try{const te=await oe.post("/api/smartir/refresh-index");te.data.success?(p=c.value)==null||p.success(`Updated to v${te.data.version} (${te.data.total_devices} devices)`,"âœ… Index Updated"):(R=c.value)==null||R.error(te.data.error||"Unknown error","âŒ Update Failed")}catch(te){console.error("Error updating SmartIR index:",te),(X=c.value)==null||X.error("Failed to update device index","âŒ Update Error")}finally{v.value=!1,s.value=!1}},g=p=>{p.target.closest(".settings-menu-container")||(s.value=!1)};return xe(async()=>{const p=localStorage.getItem("theme");p&&["light","medium","dark"].includes(p)?(k.value=p,p==="medium"?document.body.classList.add("medium-mode"):p==="dark"&&document.body.classList.add("dark-mode")):localStorage.getItem("darkMode")==="true"&&(k.value="dark",document.body.classList.add("dark-mode"),localStorage.setItem("theme","dark")),await L();const R=He();R&&c.value&&(R.appContext.config.globalProperties.$toast=c.value),document.addEventListener("click",g)}),ze(()=>{document.removeEventListener("click",g)}),Ue("smartirStatus",w),Ue("smartirEnabled",_),Ue("refreshSmartIR",L),Ue("toast",c),(p,R)=>(n(),a("div",Gu,[e("header",Yu,[e("div",Zu,[R[13]||(R[13]=e("div",{class:"header-left"},[e("i",{class:"mdi mdi-remote"}),e("h1",null,"Broadlink Manager v2"),e("span",{class:"beta-badge"},"BETA")],-1)),e("div",Qu,[e("button",{onClick:t,class:"icon-button",title:b.value},[e("i",{class:Z(V.value)},null,2)],8,ec),e("div",tc,[e("button",{onClick:R[0]||(R[0]=X=>s.value=!s.value),class:"icon-button",title:"Settings"},[...R[2]||(R[2]=[e("i",{class:"mdi mdi-cog"},null,-1)])]),s.value?(n(),a("div",oc,[R[9]||(R[9]=e("div",{class:"menu-section-title"},"Integration Settings",-1)),e("div",{class:Z(["menu-item toggle-item",{disabled:!I.value}]),onClick:R[1]||(R[1]=X=>I.value?M():null),title:I.value?"":"SmartIR is not installed"},[e("div",nc,[R[3]||(R[3]=e("i",{class:"mdi mdi-air-conditioner"},null,-1)),R[4]||(R[4]=e("span",null,"SmartIR Integration",-1)),I.value?T("",!0):(n(),a("span",sc,"(Not Installed)"))]),e("div",{class:Z(["toggle-switch",{active:_.value&&I.value,disabled:!I.value}])},[...R[5]||(R[5]=[e("div",{class:"toggle-slider"},null,-1)])],2)],10,lc),_.value?(n(),a("a",ac,[...R[6]||(R[6]=[e("i",{class:"mdi mdi-github"},null,-1),e("span",null,"SmartIR on GitHub",-1)])])):T("",!0),_.value?(n(),a("button",{key:1,onClick:i,class:"menu-item menu-subitem",disabled:v.value},[e("i",{class:Z(["mdi",v.value?"mdi-loading mdi-spin":"mdi-refresh"])},null,2),e("span",null,u(v.value?"Updating...":"Update Device Index"),1)],8,ic)):T("",!0),R[10]||(R[10]=e("div",{class:"menu-divider"},null,-1)),R[11]||(R[11]=e("div",{class:"menu-section-title"},"Diagnostics",-1)),e("button",{onClick:q,class:"menu-item",disabled:m.value},[...R[7]||(R[7]=[e("i",{class:"mdi mdi-content-copy"},null,-1),e("span",null,"Copy Diagnostics",-1)])],8,rc),e("button",{onClick:U,class:"menu-item",disabled:m.value},[...R[8]||(R[8]=[e("i",{class:"mdi mdi-download"},null,-1),e("span",null,"Download Diagnostics",-1)])],8,dc),R[12]||(R[12]=Le('<div class="menu-divider" data-v-70b7366b></div><div class="menu-section-title" data-v-70b7366b>Help &amp; Support</div><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2#readme" target="_blank" class="menu-item menu-link" data-v-70b7366b><i class="mdi mdi-book-open-variant" data-v-70b7366b></i><span data-v-70b7366b>Documentation</span></a><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2/issues" target="_blank" class="menu-item menu-link" data-v-70b7366b><i class="mdi mdi-bug" data-v-70b7366b></i><span data-v-70b7366b>Report Issue</span></a><div class="menu-divider" data-v-70b7366b></div><div class="menu-section-title" data-v-70b7366b>Community</div><a href="https://community.home-assistant.io/t/broadlink-manager-modern-web-interface-for-broadlink-devices/938473" target="_blank" class="menu-item menu-link" data-v-70b7366b><i class="mdi mdi-forum" data-v-70b7366b></i><span data-v-70b7366b>HA Forum Discussion</span></a><a href="https://www.reddit.com/r/homeassistant/comments/1o1q3kf/release_broadlink_manager_addon_a_modern_web_ui/" target="_blank" class="menu-item menu-link" data-v-70b7366b><i class="mdi mdi-reddit" data-v-70b7366b></i><span data-v-70b7366b>Reddit Discussion</span></a><div class="menu-divider" data-v-70b7366b></div><div class="menu-section-title" data-v-70b7366b>Project</div><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2" target="_blank" class="menu-item menu-link" data-v-70b7366b><i class="mdi mdi-github" data-v-70b7366b></i><span data-v-70b7366b>GitHub Repository</span></a><a href="https://ko-fi.com/tonyperkins" target="_blank" class="menu-item menu-link menu-item-sponsor" data-v-70b7366b><i class="mdi mdi-coffee" data-v-70b7366b></i><span data-v-70b7366b>Support on Ko-fi</span></a>',12))])):T("",!0)])])])]),e("main",uc,[fe(ju)]),e("footer",cc,[e("p",null,"Broadlink Manager v"+u(_e(r))+" | Built with Vue "+u(nt),1)]),fe(Wu,{ref_key:"toastRef",ref:c},null,512)]))}},vc=he(mc,[["__scopeId","data-v-70b7366b"]]),Ze=st(vc),pc=at();Ze.use(pc);Ze.mount("#app");
