import{g as nt,r as g,o as Ee,a as qe,b as vt,d as pt,c as X,e as r,f as a,h as e,i as O,n as G,u as Ie,t as v,j as x,F as he,k as $e,w as ue,l as W,v as Ve,m as be,p as ke,q as Ke,s as tt,T as st,x as Me,y as Le,z as ze,A as me,B as at,C as Je,D as Ne,E as it,G as Ye,H as ft,I as gt,J as yt,K as Xe,L as bt,M as ht}from"./vendor-DGiFqQ_g.js";(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const w of document.querySelectorAll('link[rel="modulepreload"]'))h(w);new MutationObserver(w=>{for(const s of w)if(s.type==="childList")for(const m of s.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&h(m)}).observe(document,{childList:!0,subtree:!0});function i(w){const s={};return w.integrity&&(s.integrity=w.integrity),w.referrerPolicy&&(s.referrerPolicy=w.referrerPolicy),w.crossOrigin==="use-credentials"?s.credentials="include":w.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function h(w){if(w.ep)return;w.ep=!0;const s=i(w);fetch(w.href,s)}})();let lt=!1;function Ge(){const t=nt(),c=t==null?void 0:t.appContext.config.globalProperties.$toast;return c||(lt||(console.warn("Toast notification system not yet initialized - using console fallback"),lt=!0),{success:i=>console.log("âœ“",i),error:i=>console.error("âœ—",i),warning:i=>console.warn("âš ",i),info:i=>console.info("â„¹",i)})}function ot(){const t=g(!1),c=g(!1),i=g(!1),h=g(0),w=767,s=768,m=1023,f=1024,S=()=>{const _=window.innerWidth;h.value=_,t.value=_<=w,c.value=_>=s&&_<=m,i.value=_>=f};return Ee(()=>{S(),window.addEventListener("resize",S)}),qe(()=>{window.removeEventListener("resize",S)}),{isMobile:t,isTablet:c,isDesktop:i,screenWidth:h,isMobileOrTablet:()=>t.value||c.value,isTabletOrDesktop:()=>c.value||i.value}}const Qe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAHBUlEQVR4nOxZC1BTVxo+9+aNZI2LNsgjWR4hgoIiRVDBslKnIKPbx1jqTrtYoakat1a6dNsdd7t1X8XHyAbEhdUu1u2mXdbasqJbtsaMIqBBECiPBmqEICEBEx4xJLlJ7s6lw6rJDeQ2FzLM+M1kBs7/3+/83zn/Oee/51JRFAXzGbCvA/AWjwX4GvNeANWXnXffHQ4+K6/dYbHeD+IFhjRkb1wn9WPQbEQ4IF/tQlXX2p5+/8OyczY74j/VxuMG3Sh/Oz9jaQDb4CmPT1LIbLXBfzrz0cmHg8fQpx1Yc1Ra+TsiXD4R0PqtRmAyj/LxbJeaujKIcPlEAINOM7vLXBaTZibCRWgRq3WGJZWX63aoNDpB8BJOX/bGlIqwpUv6iXBgWBHG7eUF8urUWvU6Z9sLGxI/IsLl8SJu6u4XigqPXkVspiVTbTQqU1/6Vn7ammh+G5FOMZyqludIKqUVU/9jcaSuTCo/unfHbiad4iBdwMu/P1bV1tO1xbk9NDC0/vwHB1xGcjqYLAh16zsHW3R6XXTu1mfFdAqMrIoSKNbGhLcQ4QGeppDJ7ACtPcqNEI6tT9O3Vqm+tygqNMDjrU9Sef6tIYM2JjUuuXzfC5knCEXsBI8WMZUCAxiCrfhWyMZkMNzYXNHVpwmXXqp5j0Hz0/1m57a3PQ8VHx4JoNMASIl9shLPFsB5ooO7iDXhCY/dAcCvT/79LwC1s/K2bDnAXcQeJRqwMzzeRt/bua0gLChcDsCDNQNBkEU/qot7o6j0kzETQpuJ40ZnT6xSrUoNWhyseHVz2ikv4n4QA5FSArE5IFlTZ0r3XU1MWODib6NCl3a9dkhSYxgbjo4XLq8sL9j7Ip36YEwMRjMNQazMhf7+RgYNnuyo7bY6ArFaWKuXRX495wLwoLk39sO9RaVnM5OTP8zLSjtjsljpp6ovi6pqr706eE8XBwGUSqEy9Guihf/92TMZhetjI5rJCHwKpBRzZqsNYtKp6KD+Pvv1w5ILdzR3UvD8HA4YefOl7N25JKUPIKuUwIJH7A5of/GJf7oLfrIz2EH786fSss+uKFzOk+8L0mqh6rpbmR0q5YyFGAQBSuHHlcUWxEaZyXfMhFD0Rgt9Oh/SBMiam58HAO+oc4XZMsK/1taT6M6uHjJw8w6VSNfvemM8TbzPlFlwsP5KyzfJeL6kCejXDgo894aASqOZ9O/uHwzq6B3ijhitkzOC7XS7j0g+V3S0vQTDDhYEoZSBobvJ+yXFNZ29gy4lOGmvlDBMIfQqSKV8539EWvXHhvbGHBSFrAwGW+vvxzLoR7RxzrNpsyPs0xcv7/lg1/ZfPtKvuw7MVhulUakWdvRq+XY3tWFT90Bk+52BCOzvyOBgjytSFKAgms+b9F/2o+BbKwUrvgjhhjSjKLAPG4YE7lJxfEIf5dyGOwMXrren/eF0RYXRNMrHDt4QbmjDEbHop9F8rqpddZd3sV6R/aWiabtWr41PW534V8m+PFHW+qSPL9TX7oM8WAaBi4IbE4S8yYNs/7asIgBA0ZStRqFM/MXxIzcgHBEBP+C6DJKLgJvK3uXvniitBsDmNzkSEAD9uv5k0aFjXy1gMQ0DQ5p4CAIwNuXLwyL/ExcpqMWeS42NUmxKXFf8VWPdz6cLnkqhGd/Pe+U1Cow/+ekJUYr4qJgvbik7f/Jw+0J/tjpvS3qxs7/LQZZfcrrkUmOdGI/cgUKIkB8pz0xK+CQjKf6z4MWckYftZqsderfsTInsZt0evDRgMRYMHhaLnk+NW1Y/nchxk5lZ+I/Pf/vl9RvbLYiVlSBcJv/VK9sKBCHc3hkF7D12/NzVltZn8YhzNj/3ev6LGeXTdQ6+uzLZ+C+5XNza05Nsd1gXcNgBvekJK/+du3lTUSiXMzzT80TgkkK8wJAGgCMAE5ooFFz3hHTr+lgZ9iMryOngkoi5WZuOc9hPtDu3r4198nTqygjCr3wYmrvVkSerZXljJoT0m0DcYm5g2Mg5WV39zrVWZZofkzaRnhB/bufm9FI/JpXQXj8F8bHyitqWxhzJmwUJT60SNJER+P+BCZjt34lzNbvickRoWVWNmGzuObnYWhER3oAdX41dPbj1jDeYEwGrInltKKCNtatub6hRfJOEnfJkcc+JgE9ltS/DkINuNI3xCo4fbXgm/0CnouvOcjK4Z/16/ZKia+3+kqIrEIQ+sgNx2Jzb5wsPxrD9GBZv+Gd9BqSXr4icg8cwMj4SLmv6+mlv+WddgGlilOPOZkEmFnrLP+sCVgtXyPHaHShkiw0XXPWWf9YF5Gb9uGzp4sCbj7ai4LkNTx2O5nPV3vLPyTeye6P32X+7KNujVKtSYJg+viEu/mx2etJZCgnD57OPfGRh3n8nfizA15j3Av4XAAD//5k1S2w3zfwVAAAAAElFTkSuQmCC",oe=vt.create({baseURL:"./",timeout:3e4,headers:{"Content-Type":"application/json","Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"}});oe.interceptors.request.use(t=>t,t=>Promise.reject(t));oe.interceptors.response.use(t=>t,t=>(console.error("API Error:",t),t.response?console.error("Response error:",t.response.data):t.request?console.error("No response received"):console.error("Request setup error:",t.message),Promise.reject(t)));const kt=pt("devices",{state:()=>({devices:[],loading:!1,error:null,selectedDevice:null}),getters:{deviceById:t=>c=>t.devices.find(i=>i.id===c),devicesByType:t=>c=>t.devices.filter(i=>i.entity_type===c),deviceCount:t=>t.devices.length,hasDevices:t=>t.devices.length>0},actions:{async loadDevices(t=!1){this.loading=!0,this.error=null;try{const c=t?`/api/devices/managed?_t=${Date.now()}`:"/api/devices/managed",i=await oe.get(c);this.devices=i.data.devices||[],console.log("ğŸ“¥ Loaded devices:",this.devices),this.devices.forEach(h=>{console.log(`ğŸ“¥ Device "${h.name}":`,{id:h.id,device:h.device,commands:h.commands,commandCount:h.commands?Object.keys(h.commands).length:0})})}catch(c){this.error=c.message,console.error("Error loading devices:",c)}finally{this.loading=!1}},async createDevice(t){this.loading=!0,this.error=null;try{console.log("ğŸª Store: Creating device with data:",t),console.log("ğŸª Store: Device commands being sent:",t.commands);const c={device_name:t.name,device:t.device,area_id:t.area||"",area_name:t.area||"",entity_type:t.entity_type,icon:t.icon,broadlink_entity:t.broadlink_entity,device_type:t.device_type||"broadlink",commands:t.commands||{}};t.device_type==="smartir"&&t.smartir_config&&(c.smartir_config=t.smartir_config),console.log("ğŸª Store: Transformed data for backend:",c);const i=await oe.post("/api/devices/managed",c);return console.log("ğŸª Store: Create response:",i.data),await this.loadDevices(),i.data}catch(c){throw console.error("Error creating device:",c),c}finally{this.loading=!1}},async updateDevice(t,c){this.loading=!0,this.error=null;try{const i=await oe.put(`/api/devices/managed/${t}`,c);return await this.loadDevices(),i.data}catch(i){throw console.error("Error updating device:",i),i}finally{this.loading=!1}},async deleteDevice(t,c=!1){this.loading=!0,this.error=null;try{await oe.delete(`/api/devices/managed/${t}`,{data:{delete_commands:c}}),this.devices=this.devices.filter(i=>i.id!==t)}catch(i){throw this.error=i.message,console.error("Error deleting device:",i),i}finally{this.loading=!1}},selectDevice(t){this.selectedDevice=t},clearSelection(){this.selectedDevice=null},clearError(){this.error=null},updateDeviceCommands(t,c){const i=this.devices.findIndex(h=>h.id===t);if(i!==-1){const h={...this.devices[i],commands:c};this.devices.splice(i,1,h),console.log(`âœ… Store: Updated commands for ${t}, count: ${Object.keys(c).length}`)}else console.warn(`âš ï¸ Store: Device ${t} not found for command update`)},async syncAllAreas(){if(!this.devices||this.devices.length===0){console.log("âš ï¸ No devices to sync");return}console.log(`ğŸ”„ Syncing areas from Home Assistant for ${this.devices.length} devices...`);try{const t=await Promise.all(this.devices.map(h=>(console.log(`ğŸ”„ Syncing device: ${h.id} (${h.name})`),oe.post(`/api/devices/${h.id}/sync-area`).then(w=>w.data.success&&w.data.area?(console.log(`âœ… Synced area for ${h.name}: ${w.data.area}`),{status:"synced",device:h.name}):{status:"no_area"}).catch(w=>{var s;return((s=w.response)==null?void 0:s.status)===404?(console.log(`âŒ Device not found in HA: ${h.id}`),{status:"not_found"}):(console.warn(`âš ï¸ Failed to sync area for ${h.id}:`,w.message),{status:"error",error:w.message})})))),c=t.filter(h=>h.status==="synced").length,i=t.filter(h=>h.status==="not_found").length;await this.loadDevices(!0),c>0?console.log(`âœ… Area sync complete: ${c} synced, ${i} not found in HA`):i>0&&console.log(`â„¹ï¸ No areas synced - ${i} entities not found in HA registry (generate entities first)`)}catch(t){console.debug("Area sync error:",t)}}}});function rt(t){const c=X(()=>t.value||t),i=X(()=>{switch(c.value){case"climate":return"mdi:air-conditioner";case"fan":return"mdi:fan";case"light":return"mdi:lightbulb";case"media_player":return"mdi:television";case"switch":return"mdi:light-switch";default:return"mdi:devices"}}),h=X(()=>`device-type-${c.value}-color`),w=X(()=>`tag-${c.value}-bg`);return{icon:i,colorClass:h,tagBgClass:w}}const dt=""+new URL("broadlink-logo-BDjImjRY.png",import.meta.url).href,Se=(t,c)=>{const i=t.__vccOpts||t;for(const[h,w]of c)i[h]=w;return i},wt={class:"device-header"},$t={class:"device-info"},Ct=["title"],_t={class:"device-labels"},St={class:"device-type"},It=["src","alt","title"],Dt={class:"device-body"},xt={class:"device-stats"},Tt={class:"stat",title:"Learned command count"},Mt={class:"stat",title:"HA Assigned Area"},Rt={class:"device-meta"},Et={class:"device-id",title:"Device ID"},Ot={key:0,class:"storage-name"},At={key:1,class:"broadlink-entity",title:"Controller Device"},Lt={key:2,class:"controller-device"},Pt={class:"device-actions"},Vt=["disabled"],jt=["disabled"],Ut=["disabled"],Ft={key:0,class:"disabled-overlay"},Nt={__name:"DeviceCard",props:{device:{type:Object,required:!0},broadlinkDevices:{type:Array,default:()=>[]}},emits:["edit","delete","learn"],setup(t){const c=t,i=X(()=>localStorage.getItem("smartir_simulate_not_installed")==="true"),h=X(()=>c.device.device_type==="smartir"&&i.value),w=g(null),s=rt(X(()=>c.device.entity_type)),m=X(()=>c.device.icon?c.device.icon:s.icon.value),f=D=>D&&D.startsWith("mdi:")?`mdi ${D.replace(":"," mdi-")}`:`mdi mdi-${D}`,S=X(()=>({light:"Light",fan:"Fan",switch:"Switch",media_player:"Media Player",cover:"Cover"})[c.device.entity_type]||c.device.entity_type),_=X(()=>(c.device.device_type||"broadlink")==="smartir"?"SmartIR":"Broadlink"),L=X(()=>(c.device.device_type||"broadlink")==="smartir"?Qe:dt),k=X(()=>(c.device.device_type||"broadlink")==="smartir"?w.value!==null?w.value:0:Object.keys(c.device.commands||{}).length),n=D=>{if(!D)return"";const o=c.broadlinkDevices.find(b=>b.entity_id===D);return o&&o.name||D},V=X(()=>{if(!c.device.device)return!1;const D=c.device.id.includes(".")?c.device.id.split(".")[1]:c.device.id;return c.device.device!==D}),q=X(()=>{if(!c.device.broadlink_entity)return"";const D=c.broadlinkDevices.find(o=>o.entity_id===c.device.broadlink_entity);return D&&D.name||c.device.broadlink_entity}),F=D=>{if(!D||typeof D!="object")return 0;let o=0;for(const b of Object.values(D))typeof b=="string"?o++:typeof b=="object"&&(o+=F(b));return o},R=async()=>{if(!(!c.device.device_code||!c.device.entity_type))try{const D=await oe.get("/api/smartir/codes/code",{params:{entity_type:c.device.entity_type,code_id:c.device.device_code}});if(D.data.success&&D.data.code){const o=D.data.code;o.commands&&(w.value=F(o.commands))}}catch(D){console.error("Error fetching SmartIR command count:",D)}};return Ee(async()=>{(c.device.device_type||"broadlink")==="smartir"&&await R()}),(D,o)=>(a(),r("div",{class:G(["device-card",{disabled:h.value}])},[e("div",wt,[e("div",{class:G(["device-icon",Ie(s).colorClass.value])},[e("i",{class:G(f(m.value))},null,2)],2),e("div",$t,[e("h3",{title:t.device.name},v(t.device.name),9,Ct),e("div",_t,[e("span",St,v(S.value),1)])]),e("img",{src:L.value,alt:_.value,title:_.value,class:"device-source-logo"},null,8,It)]),e("div",Dt,[e("div",xt,[e("div",Tt,[o[3]||(o[3]=e("i",{class:"mdi mdi-remote"},null,-1)),e("span",null,v(k.value)+" command"+v(k.value!==1?"s":""),1)]),e("div",Mt,[o[4]||(o[4]=e("i",{class:"mdi mdi-map-marker"},null,-1)),e("span",null,v(t.device.area||"No area"),1)])]),e("div",Rt,[e("span",Et,[o[5]||(o[5]=e("i",{class:"mdi mdi-identifier"},null,-1)),x(" "+v(t.device.id),1)]),V.value?(a(),r("span",Ot,[o[6]||(o[6]=e("i",{class:"mdi mdi-code-tags"},null,-1)),x(" "+v(t.device.device),1)])):O("",!0),t.device.broadlink_entity?(a(),r("span",At,[o[7]||(o[7]=e("i",{class:"mdi mdi-access-point"},null,-1)),x(" "+v(q.value),1)])):O("",!0),t.device.controller_device?(a(),r("span",Lt,[o[8]||(o[8]=e("i",{class:"mdi mdi-access-point"},null,-1)),x(" "+v(n(t.device.controller_device)),1)])):O("",!0)])]),e("div",Pt,[e("button",{onClick:o[0]||(o[0]=b=>!h.value&&D.$emit("learn",t.device)),class:"icon-btn",title:"Manage Commands",disabled:h.value},[...o[9]||(o[9]=[e("i",{class:"mdi mdi-remote-tv"},null,-1)])],8,Vt),e("button",{onClick:o[1]||(o[1]=b=>!h.value&&D.$emit("edit",t.device)),class:"icon-btn",title:"Edit",disabled:h.value},[...o[10]||(o[10]=[e("i",{class:"mdi mdi-pencil"},null,-1)])],8,jt),e("button",{onClick:o[2]||(o[2]=b=>!h.value&&D.$emit("delete",t.device)),class:"icon-btn danger",title:"Delete",disabled:h.value},[...o[11]||(o[11]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,Ut)]),h.value?(a(),r("div",Ft,[...o[12]||(o[12]=[e("div",{class:"disabled-message"},[e("i",{class:"mdi mdi-eye-off"}),e("span",null,"SmartIR Not Installed")],-1)])])):O("",!0)],2))}},Bt=Se(Nt,[["__scopeId","data-v-7a7f5c18"]]),Ht={name:"DeviceListView",props:{devices:{type:Array,required:!0}},methods:{getDeviceSourceLogo(t){return(t.device_type||"broadlink")==="smartir"?Qe:dt},getDeviceCommands(t){return t.commands&&typeof t.commands=="object"?Object.keys(t.commands):[]},getCommandType(t,c){return t.commands&&t.commands[c]&&t.commands[c].type||"ir"},getCommandTypeClass(t,c){return this.getCommandType(t,c)==="rf"?"command-rf":"command-ir"},getCommandTypeLabel(t,c){return this.getCommandType(t,c)==="rf"?"RF Command":"IR Command"},sendCommand(t,c){this.$emit("send-command",{device:t,command:c})},openCommands(t){this.$emit("open-commands",t)},editDevice(t){this.$emit("edit-device",t)},deleteDevice(t){this.$emit("delete-device",t)}}},qt={class:"device-list-view"},zt={class:"device-table"},Jt={class:"device-info"},Wt={class:"device-name"},Gt={class:"device-entity"},Kt={class:"device-area"},Xt={class:"device-type"},Yt=["src","alt","title"],Zt={class:"device-commands"},Qt={key:0,class:"command-list"},eo=["onClick","title"],to={key:0,class:"no-commands"},oo={key:1,class:"smartir-info"},lo={class:"profile-code"},no={class:"device-actions"},so=["onClick"],ao=["onClick"],io=["onClick"];function ro(t,c,i,h,w,s){return a(),r("div",qt,[e("table",zt,[c[3]||(c[3]=e("thead",null,[e("tr",null,[e("th",null,"Device"),e("th",null,"Room/Area"),e("th",null,"Type"),e("th",null,[e("div",{class:"commands-header"},[e("span",null,"Commands"),e("div",{class:"command-legend"},[e("span",{class:"legend-badge command-rf"},"RF"),e("span",{class:"legend-badge command-ir"},"IR")])])]),e("th",null,"Actions")])],-1)),e("tbody",null,[(a(!0),r(he,null,$e(i.devices,m=>(a(),r("tr",{key:m.entity_id,class:"device-row"},[e("td",Jt,[e("div",Wt,v(m.friendly_name||m.name),1),e("div",Gt,v(m.entity_id),1)]),e("td",Kt,v(m.area||"No Area"),1),e("td",Xt,[e("img",{src:s.getDeviceSourceLogo(m),alt:m.device_type==="smartir"?"SmartIR":"Broadlink",title:m.device_type==="smartir"?"SmartIR":"Broadlink",class:"device-source-logo"},null,8,Yt)]),e("td",Zt,[(m.device_type||"broadlink")==="broadlink"?(a(),r("div",Qt,[(a(!0),r(he,null,$e(s.getDeviceCommands(m),f=>(a(),r("button",{key:f,class:G(["command-btn",s.getCommandTypeClass(m,f)]),onClick:S=>s.sendCommand(m,f),title:s.getCommandTypeLabel(m,f)},v(f),11,eo))),128)),s.getDeviceCommands(m).length===0?(a(),r("span",to," No commands ")):O("",!0)])):m.device_type==="smartir"?(a(),r("div",oo,[e("span",lo,"Profile: "+v(m.device_code),1)])):O("",!0)]),e("td",no,[e("button",{class:"action-btn commands",onClick:f=>s.openCommands(m),title:"Manage Commands"},[...c[0]||(c[0]=[e("i",{class:"mdi mdi-remote-tv"},null,-1)])],8,so),e("button",{class:"action-btn edit",onClick:f=>s.editDevice(m),title:"Edit"},[...c[1]||(c[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})],-1)])],8,ao),e("button",{class:"action-btn delete",onClick:f=>s.deleteDevice(m),title:"Delete"},[...c[2]||(c[2]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"3 6 5 6 21 6"}),e("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})],-1)])],8,io)])]))),128))])])])}const uo=Se(Ht,[["render",ro],["__scopeId","data-v-2895a204"]]),co={class:"icon-picker"},mo={class:"icon-input-wrapper"},vo=["id","placeholder"],po={key:0,class:"icon-preview"},fo={key:0,class:"icon-dropdown"},go={class:"icon-grid"},yo=["onMousedown","title"],bo={__name:"IconPicker",props:{modelValue:{type:String,default:""},inputId:{type:String,default:"icon-input"},placeholder:{type:String,default:"e.g., mdi:television"}},emits:["update:modelValue"],setup(t,{emit:c}){const i=t,h=c,w=g(i.modelValue),s=g(!1),m=["television","speaker","radio","music","video","movie","play","pause","stop","skip-next","skip-previous","volume-high","volume-medium","volume-low","volume-off","remote","remote-tv","cast","chromecast","spotify","netflix","youtube","lightbulb","lightbulb-on","lightbulb-off","lamp","floor-lamp","ceiling-light","light-switch","led-strip","led-strip-variant","wall-sconce","chandelier","spotlight","track-light","vanity-light","desk-lamp","fan","ceiling-fan","air-conditioner","thermometer","thermostat","heat-wave","snowflake","fire","radiator","water-boiler","hvac","blinds","blinds-open","window-shutter","window-shutter-open","curtains","curtains-closed","roller-shade","roller-shade-closed","garage","garage-open","gate","door","door-open","window-open","window-closed","washing-machine","tumble-dryer","dishwasher","refrigerator","stove","microwave","oven","toaster","kettle","coffee","coffee-maker","blender","robot-vacuum","robot-vacuum-variant","vacuum","broom","spray-bottle","lock","lock-open","lock-smart","key","shield","shield-check","alarm-light","bell","doorbell","camera","cctv","motion-sensor","smoke-detector","fire-extinguisher","water-alert","gas-cylinder","sofa","bed","bed-double","desk","chair","table","bookshelf","home","home-outline","home-assistant","floor-plan","room","weather-sunny","weather-night","weather-cloudy","weather-rainy","weather-snowy","weather-lightning","weather-windy","weather-fog","weather-partly-cloudy","umbrella","water","water-percent","phone","cellphone","tablet","laptop","desktop-tower","monitor","keyboard","mouse","printer","router","router-wireless","access-point","wifi","bluetooth","usb","hdmi-port","ethernet","power","power-plug","power-socket","battery","battery-charging","lightning-bolt","flash","solar-panel","solar-power","leaf","tree","flower","sprout","grass","watering-can","shovel","fence","pool","hot-tub","silverware","silverware-fork-knife","food","food-apple","glass-wine","glass-cocktail","bottle-wine","pot","pot-steam","shower","shower-head","bathtub","toilet","sink","faucet","hand-wash","car","car-side","garage-variant","tools","hammer","wrench","screwdriver","toolbox","ladder","heart","heart-pulse","run","walk","bike","dumbbell","yoga","scale-bathroom","thermometer-lines","clock","clock-outline","timer","alarm","calendar","calendar-today","calendar-clock","history","bell-ring","bell-alert","alert","alert-circle","information","help-circle","check","check-circle","close-circle","minus-circle","plus-circle","arrow-up","arrow-down","arrow-left","arrow-right","chevron-up","chevron-down","menu","dots-vertical","dots-horizontal","cog","tune","circle","square","triangle","hexagon","star","star-outline","heart-outline","plus","minus","close","check-bold","eye","eye-off","account","account-group","baby","dog","cat","paw","gift","balloon","party-popper","candle","book","book-open","newspaper","email","message","phone-classic"];ue(()=>i.modelValue,k=>{w.value=k});const f=X(()=>{if(!w.value)return m.slice(0,50);const k=w.value.toLowerCase().replace("mdi:","");return m.filter(n=>n.toLowerCase().includes(k)).slice(0,50)}),S=()=>{s.value=!0,h("update:modelValue",w.value)},_=()=>{setTimeout(()=>{s.value=!1},200)},L=k=>{w.value=`mdi:${k}`,h("update:modelValue",w.value),s.value=!1};return(k,n)=>(a(),r("div",co,[e("div",mo,[W(e("input",{id:t.inputId,"onUpdate:modelValue":n[0]||(n[0]=V=>w.value=V),type:"text",placeholder:t.placeholder,onInput:S,onFocus:n[1]||(n[1]=V=>s.value=!0),onBlur:_},null,40,vo),[[Ve,w.value]]),w.value?(a(),r("div",po,[e("i",{class:G(`mdi mdi-${w.value.replace("mdi:","")}`)},null,2)])):O("",!0)]),s.value&&f.value.length>0?(a(),r("div",fo,[e("div",go,[(a(!0),r(he,null,$e(f.value,V=>(a(),r("div",{key:V,class:"icon-option",onMousedown:be(q=>L(V),["prevent"]),title:V},[e("i",{class:G(`mdi mdi-${V}`)},null,2),e("span",null,v(V),1)],40,yo))),128))])])):O("",!0)]))}},ho=Se(bo,[["__scopeId","data-v-a64f5011"]]),ko={key:0,class:"dropdown-label"},wo={key:0,class:"required"},$o=["placeholder","disabled","onKeydown"],Co={class:"dropdown-icons"},_o={key:0,class:"mdi mdi-loading mdi-spin"},So={key:2,class:"mdi mdi-chevron-down"},Io={key:1,class:"error-message"},Do={key:2,class:"hint-message"},xo={key:0,class:"dropdown-menu"},To=["onMousedown","onMouseenter"],Mo={class:"option-content"},Ro={class:"option-label"},Eo={key:0,class:"option-description"},Oo={key:0,class:"mdi mdi-check selected-icon"},Ao={key:3,class:"dropdown-menu"},Lo={__name:"SearchableDropdown",props:{modelValue:{type:[String,Number,Object],default:null},options:{type:Array,required:!0,default:()=>[]},label:{type:String,default:""},placeholder:{type:String,default:"Search..."},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},error:{type:String,default:""},hint:{type:String,default:""},optionLabel:{type:String,default:"label"},optionValue:{type:String,default:"value"},optionDescription:{type:String,default:"description"},filterMethod:{type:Function,default:null}},emits:["update:modelValue","change","search"],setup(t,{emit:c}){const i=t,h=c,w=g(null),s=g(null),m=g(""),f=g(!1),S=g(0),_=g(!1),L=T=>typeof T=="string"||typeof T=="number"?T:T[i.optionLabel]||T.label||T.name||String(T),k=T=>typeof T=="string"||typeof T=="number"?T:T[i.optionValue]||T.value||T.id||T,n=T=>typeof T=="string"||typeof T=="number"?"":T[i.optionDescription]||T.description||"",V=T=>{const N=k(T);return typeof i.modelValue=="object"?k(i.modelValue)===N:i.modelValue===N},q=X(()=>{if(!m.value)return i.options;if(i.filterMethod)return i.options.filter(N=>i.filterMethod(N,m.value));const T=m.value.toLowerCase();return i.options.filter(N=>{const se=L(N).toLowerCase(),fe=n(N).toLowerCase();return se.includes(T)||fe.includes(T)})}),F=X(()=>{if(!i.modelValue)return"";const T=i.options.find(N=>{const se=k(N);return typeof i.modelValue=="object"?se===k(i.modelValue):se===i.modelValue});return T?L(T):""});ue(()=>i.modelValue,T=>{_.value||(m.value=F.value)}),ue(()=>i.options,()=>{!_.value&&i.modelValue&&(m.value=F.value)},{deep:!0}),ue(m,T=>{h("search",T),S.value=0}),Ee(()=>{m.value=F.value});const R=()=>{var T;_.value=!0,f.value=!0,(T=s.value)==null||T.select()},D=()=>{_.value=!1,setTimeout(()=>{f.value=!1,i.modelValue?m.value=F.value:m.value=""},200)},o=()=>{var T;f.value=!1,(T=s.value)==null||T.blur()},b=T=>{const N=k(T);h("update:modelValue",N),h("change",N,T),m.value=L(T),o()},P=()=>{var T;h("update:modelValue",null),h("change",null,null),m.value="",(T=s.value)==null||T.focus()},p=()=>{if(!f.value){f.value=!0;return}S.value<q.value.length-1&&S.value++},Z=()=>{S.value>0&&S.value--},ne=()=>{q.value.length>0&&S.value>=0&&b(q.value[S.value])},z=T=>{w.value&&!w.value.contains(T.target)&&(f.value=!1,i.modelValue?m.value=F.value:m.value="")};return Ee(()=>{document.addEventListener("click",z)}),qe(()=>{document.removeEventListener("click",z)}),(T,N)=>(a(),r("div",{class:"searchable-dropdown",ref_key:"dropdownRef",ref:w},[t.label?(a(),r("label",ko,[x(v(t.label)+" ",1),t.required?(a(),r("span",wo,"*")):O("",!0)])):O("",!0),e("div",{class:G(["dropdown-input-wrapper",{"has-error":t.error,disabled:t.disabled}])},[W(e("input",{ref_key:"inputRef",ref:s,type:"text","onUpdate:modelValue":N[0]||(N[0]=se=>m.value=se),placeholder:t.placeholder,disabled:t.disabled||t.loading,onFocus:R,onBlur:D,onKeydown:[Ke(be(p,["prevent"]),["down"]),Ke(be(Z,["prevent"]),["up"]),Ke(be(ne,["prevent"]),["enter"]),Ke(o,["escape"])],class:"dropdown-input"},null,40,$o),[[Ve,m.value]]),e("div",Co,[t.loading?(a(),r("i",_o)):t.modelValue&&!t.disabled?(a(),r("i",{key:1,class:"mdi mdi-close-circle clear-icon",onClick:P})):(a(),r("i",So))])],2),t.error?(a(),r("div",Io,v(t.error),1)):O("",!0),t.hint&&!t.error?(a(),r("div",Do,v(t.hint),1)):O("",!0),ke(st,{name:"dropdown"},{default:tt(()=>[f.value&&q.value.length>0?(a(),r("div",xo,[(a(!0),r(he,null,$e(q.value,(se,fe)=>(a(),r("div",{key:k(se),class:G(["dropdown-item",{highlighted:fe===S.value,selected:V(se)}]),onMousedown:be(Re=>b(se),["prevent"]),onMouseenter:Re=>S.value=fe},[e("div",Mo,[e("div",Ro,v(L(se)),1),n(se)?(a(),r("div",Eo,v(n(se)),1)):O("",!0)]),V(se)?(a(),r("i",Oo)):O("",!0)],42,To))),128))])):O("",!0)]),_:1}),f.value&&q.value.length===0&&!t.loading?(a(),r("div",Ao,[...N[1]||(N[1]=[e("div",{class:"dropdown-item no-results"},[e("i",{class:"mdi mdi-magnify"}),x(" No results found ")],-1)])])):O("",!0)],512))}},Ze=Se(Lo,[["__scopeId","data-v-679ce35f"]]),Po={class:"smartir-selector"},Vo={class:"form-group"},jo={class:"form-group"},Uo={class:"form-group"},Fo=["value"],No={key:0,class:"error-message"},Bo={class:"form-group"},Ho={class:"form-group"},qo={key:1,class:"code-info"},zo={class:"info-content"},Jo={class:"info-row"},Wo={class:"info-value"},Go={class:"info-row"},Ko={class:"info-value"},Xo={key:0,class:"info-row"},Yo={class:"info-value"},Zo={class:"info-row"},Qo={class:"info-value"},el={__name:"SmartIRDeviceSelector",props:{entityType:{type:String,required:!0},modelValue:{type:Object,default:()=>({})},broadlinkDevices:{type:Array,default:()=>[]}},emits:["update:modelValue","change"],setup(t,{expose:c,emit:i}){const h=t,w=i,s=g([]),m=g([]),f=g(""),S=g(""),_=g(""),L=g(""),k=g(""),n=g(null),V=g(!1),q=g(!1),F=g({manufacturer:"",model:"",controller:""});Ee(async()=>{if(await R(),h.modelValue&&(f.value=h.modelValue.manufacturer||"",S.value=h.modelValue.device_code||"",_.value=h.modelValue.controller_device||"",L.value=h.modelValue.temperature_sensor||"",k.value=h.modelValue.humidity_sensor||"",f.value&&(await D(f.value),S.value&&m.value.length>0))){const T=m.value.find(N=>N.code===S.value);T&&(n.value={code:T.code,manufacturer:f.value,models:T.models,controller:T.controller})}}),ue(()=>h.entityType,async T=>{T&&(f.value="",S.value="",m.value=[],n.value=null,await R())});const R=async()=>{if(h.entityType){V.value=!0,F.value.manufacturer="";try{const T=await oe.get("/api/smartir/codes/manufacturers",{params:{entity_type:h.entityType}});if(T.data.success)s.value=T.data.manufacturers||[];else throw new Error(T.data.error||"Failed to load manufacturers")}catch(T){console.error("Error loading manufacturers:",T),F.value.manufacturer="Failed to load manufacturers. Please try again.",s.value=[]}finally{V.value=!1}}},D=async T=>{if(!(!T||!h.entityType)){q.value=!0,F.value.model="";try{const N=await oe.get("/api/smartir/codes/models",{params:{entity_type:h.entityType,manufacturer:T}});if(N.data.success){const se=N.data.models||[];m.value=se.map(fe=>{const Re=fe.models&&fe.models.length>0?fe.models.join(", "):`Code ${fe.code}`;return{code:fe.code,label:Re,description:`Code: ${fe.code}`,models:fe.models,controller:fe.controller}})}else throw new Error(N.data.error||"Failed to load models")}catch(N){console.error("Error loading models:",N),F.value.model="Failed to load models. Please try again.",m.value=[]}finally{q.value=!1}}},o=async T=>{f.value=T,S.value="",n.value=null,m.value=[],T&&await D(T),ne()},b=()=>{const T=m.value.find(N=>N.code===S.value);T&&(n.value={code:T.code,manufacturer:f.value,models:T.models,controller:T.controller}),ne()},P=()=>{ne()},p=()=>{ne()},Z=()=>{ne()},ne=()=>{var N,se;const T={manufacturer:f.value,model:((se=(N=n.value)==null?void 0:N.models)==null?void 0:se[0])||"",device_code:S.value,controller_device:_.value};h.entityType==="climate"&&(L.value&&(T.temperature_sensor=L.value),k.value&&(T.humidity_sensor=k.value)),w("update:modelValue",T),w("change",T)};return c({validate:()=>{let T=!0;return F.value={manufacturer:"",model:"",controller:""},f.value||(F.value.manufacturer="Manufacturer is required",T=!1),S.value||(F.value.model="Model is required",T=!1),_.value||(F.value.controller="Broadlink controller is required",T=!1),T}}),(T,N)=>(a(),r("div",Po,[e("div",Vo,[ke(Ze,{modelValue:f.value,"onUpdate:modelValue":N[0]||(N[0]=se=>f.value=se),options:s.value,label:"Manufacturer",placeholder:"Search manufacturers...",required:"",loading:V.value,error:F.value.manufacturer,hint:"Select the device manufacturer",onChange:o},null,8,["modelValue","options","loading","error"])]),e("div",jo,[ke(Ze,{modelValue:S.value,"onUpdate:modelValue":N[1]||(N[1]=se=>S.value=se),options:m.value,"option-label":"label","option-value":"code","option-description":"description",label:"Model",placeholder:"Search models...",required:"",disabled:!f.value,loading:q.value,error:F.value.model,hint:"Select the device model",onChange:b},null,8,["modelValue","options","disabled","loading","error"])]),e("div",Uo,[N[6]||(N[6]=e("label",{for:"controller-device"},[e("i",{class:"mdi mdi-remote"}),x(" Controller Device * ")],-1)),W(e("select",{id:"controller-device","onUpdate:modelValue":N[2]||(N[2]=se=>_.value=se),required:"",onChange:P},[N[5]||(N[5]=e("option",{value:""},"-- Select Controller Device --",-1)),(a(!0),r(he,null,$e(t.broadlinkDevices,se=>(a(),r("option",{key:se.entity_id,value:se.entity_id},[x(v(se.name||se.entity_id)+" ",1),se.area_name?(a(),r(he,{key:0},[x(" - "+v(se.area_name),1)],64)):O("",!0)],8,Fo))),128))],544),[[Me,_.value]]),N[7]||(N[7]=e("small",null,"Which remote device will send the IR/RF commands",-1)),F.value.controller?(a(),r("div",No,v(F.value.controller),1)):O("",!0)]),t.entityType==="climate"?(a(),r(he,{key:0},[e("div",Bo,[N[8]||(N[8]=e("label",{for:"temperature-sensor"},"Temperature Sensor",-1)),W(e("input",{id:"temperature-sensor","onUpdate:modelValue":N[3]||(N[3]=se=>L.value=se),type:"text",placeholder:"e.g., sensor.living_room_temperature",onInput:p},null,544),[[Ve,L.value]]),N[9]||(N[9]=e("small",null,"Optional: Temperature sensor entity for current temperature",-1))]),e("div",Ho,[N[10]||(N[10]=e("label",{for:"humidity-sensor"},"Humidity Sensor",-1)),W(e("input",{id:"humidity-sensor","onUpdate:modelValue":N[4]||(N[4]=se=>k.value=se),type:"text",placeholder:"e.g., sensor.living_room_humidity",onInput:Z},null,544),[[Ve,k.value]]),N[11]||(N[11]=e("small",null,"Optional: Humidity sensor entity for current humidity",-1))])],64)):O("",!0),n.value?(a(),r("div",qo,[N[16]||(N[16]=e("div",{class:"info-header"},[e("i",{class:"mdi mdi-information"}),e("span",null,"Selected Device Code")],-1)),e("div",zo,[e("div",Jo,[N[12]||(N[12]=e("span",{class:"info-label"},"Code ID:",-1)),e("span",Wo,v(n.value.code_id),1)]),e("div",Go,[N[13]||(N[13]=e("span",{class:"info-label"},"Manufacturer:",-1)),e("span",Ko,v(n.value.manufacturer),1)]),n.value.models&&n.value.models.length>0?(a(),r("div",Xo,[N[14]||(N[14]=e("span",{class:"info-label"},"Supported Models:",-1)),e("span",Yo,v(n.value.models.join(", ")),1)])):O("",!0),e("div",Zo,[N[15]||(N[15]=e("span",{class:"info-label"},"Controller:",-1)),e("span",Qo,v(n.value.controller||"Broadlink"),1)])])])):O("",!0)]))}},tl=Se(el,[["__scopeId","data-v-1911c8f6"]]),ol={class:"modal-content"},ll={class:"modal-header"},nl={class:"input-wrapper"},sl={key:0,class:"validation-tooltip"},al={class:"input-wrapper"},il=["disabled"],rl={key:0,class:"validation-tooltip"},dl={key:0,class:"smartir-notice"},ul={key:0,class:"notice-success"},cl={key:1,class:"notice-warning"},ml={key:1,class:"smartir-notice"},vl={key:2},pl={class:"form-group"},fl=["disabled"],gl=["disabled"],yl={key:0},bl={key:1},hl={key:2},kl={key:3},wl={key:0,class:"form-group"},$l={class:"area-display-readonly"},Cl=["value"],_l=["disabled"],Sl=["href"],Il={key:1,class:"form-group"},Dl={class:"form-group"},xl={class:"input-wrapper"},Tl=["value"],Ml=["value"],Rl={key:2,class:"validation-tooltip"},El={key:0},Ol={key:1},Al={key:3,class:"smartir-section"},Ll={class:"modal-footer"},Pl={type:"submit",form:"device-form",class:"btn btn-primary"},Vl={__name:"DeviceForm",props:{device:{type:Object,default:null}},emits:["save","cancel"],setup(t,{emit:c}){const i=t,h=c,w=Le("smartirStatus"),s=Le("smartirEnabled"),m=X(()=>{var M;return localStorage.getItem("smartir_simulate_not_installed")==="true"?!1:((M=w==null?void 0:w.value)==null?void 0:M.installed)||!1}),f=X(()=>!!i.device),S=X(()=>["climate","media_player","fan","light"].includes(n.value.entity_type)),_=X(()=>m.value?!S.value&&n.value.entity_type?"(Not supported for this type)":"(Pre-configured Codes)":"(Requires SmartIR)"),L=X(()=>{var M;const Y=((M=i.device)==null?void 0:M.commands)||{};return Object.keys(Y).length>0}),k=X(()=>{if(!n.value.broadlink_entity)return"";const Y=D.value.find(M=>M.entity_id===n.value.broadlink_entity);return Y&&Y.name||n.value.broadlink_entity}),n=g({name:"",entity_type:"",device_type:"broadlink",device:"",area:"",icon:"",broadlink_entity:"",enabled:!0,commands:{}}),V=g({name:"",entity_type:"",broadlink_entity:""}),q=g({}),F=g(null),R=g([]),D=g([]),o=g(null),b=g(null),P=g(null),p=g(!1);Ee(async()=>{i.device&&(n.value={...i.device,device_type:i.device.device_type||"broadlink"},n.value.device_type==="smartir"&&(q.value={manufacturer:i.device.manufacturer,model:i.device.model,device_code:i.device.device_code,controller_device:i.device.controller_device,temperature_sensor:i.device.temperature_sensor,humidity_sensor:i.device.humidity_sensor})),await Promise.all([Z(),ne()])});const Z=async()=>{try{const Y=await oe.get("/api/areas");R.value=Y.data.areas||[]}catch(Y){console.error("Error loading areas:",Y),R.value=[]}},ne=async()=>{try{const M=(await oe.get("/api/remote/devices")).data.devices||[];D.value=M,console.log("Loaded remote devices:",M)}catch(Y){console.error("Error loading remote devices:",Y),D.value=[]}},z=Y=>{if(!Y)return"";const M=Y.toLowerCase();for(const te of R.value){const H=te.toLowerCase();if(M.includes(H))return te}return""},T=(Y,M="")=>{const te=M.toLowerCase();return te.includes("tv")?"mdi:television":te.includes("lamp")?"mdi:lamp":te.includes("ceiling")?"mdi:ceiling-light":te.includes("floor")?"mdi:floor-lamp":te.includes("desk")?"mdi:desk-lamp":te.includes("fan")?"mdi:fan":te.includes("ac")||te.includes("air con")?"mdi:air-conditioner":te.includes("heater")?"mdi:radiator":te.includes("blind")?"mdi:blinds":te.includes("curtain")?"mdi:curtains":te.includes("garage")?"mdi:garage":te.includes("speaker")||te.includes("stereo")?"mdi:speaker":te.includes("receiver")?"mdi:audio-video":{light:"mdi:lightbulb",fan:"mdi:fan",switch:"mdi:light-switch",media_player:"mdi:television",cover:"mdi:window-shutter",climate:"mdi:thermostat"}[Y]||"mdi:devices"};ue(()=>n.value.name,Y=>{if(!f.value&&Y&&!n.value.area){const M=z(Y);M&&(n.value.area=M)}!f.value&&Y&&n.value.entity_type&&(p.value||!n.value.icon)&&(n.value.icon=T(n.value.entity_type,Y),p.value=!0)}),ue(()=>n.value.entity_type,Y=>{!f.value&&Y&&(p.value||!n.value.icon)&&(n.value.icon=T(Y,n.value.name),p.value=!0)}),ue(()=>n.value.icon,(Y,M)=>{M!==void 0&&Y!==M&&!p.value&&(p.value=!1),Y||(p.value=!1)});const N=g(!1),se=async()=>{var Y;if((Y=i.device)!=null&&Y.id){N.value=!0;try{const M=await oe.post(`/api/devices/${i.device.id}/sync-area`);M.data.success?(n.value.area=M.data.area||"",M.data.area?console.log(`Area synced: ${M.data.area}`):console.log("No area assigned in Home Assistant")):console.warn(M.data.message||"Entity not found in HA")}catch(M){console.error("Failed to sync area:",M)}finally{N.value=!1}}},fe=()=>{var te;return!((te=i.device)!=null&&te.id)||!n.value.entity_type?"#":`/config/entities/entity/${`${n.value.entity_type}.${i.device.id}`}`},Re=()=>{V.value={name:"",entity_type:"",broadlink_entity:""};let Y=!0;return(!n.value.name||n.value.name.trim()==="")&&(V.value.name="Device name is required",Y=!1),n.value.entity_type||(V.value.entity_type="Entity type is required",Y=!1),n.value.device_type==="broadlink"&&!n.value.broadlink_entity&&(V.value.broadlink_entity="Broadlink device is required",Y=!1),Y},Oe=Y=>{V.value[Y]=""},Ae=async()=>{if(n.value.device_type==="smartir"){if(F.value&&!F.value.validate())return;const Y={...n.value,smartir_config:{manufacturer:q.value.manufacturer,model:q.value.model,code_id:q.value.device_code,controller_device:q.value.controller_device}};h("save",Y)}else{if(!Re())return;h("save",{...n.value})}},De=Y=>{q.value=Y};return(Y,M)=>(a(),r("div",{class:"modal-overlay",onClick:M[11]||(M[11]=be(te=>Y.$emit("cancel"),["self"]))},[e("div",ol,[e("div",ll,[e("h2",null,v(f.value?"Edit Device":"Add New Device"),1),e("button",{onClick:M[0]||(M[0]=te=>Y.$emit("cancel")),class:"close-btn"},[...M[12]||(M[12]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("form",{id:"device-form",onSubmit:be(Ae,["prevent"]),class:"modal-body"},[e("div",{class:G(["form-group",{"has-error":V.value.name}])},[M[14]||(M[14]=e("label",{for:"device-name"},"Device Name *",-1)),e("div",nl,[W(e("input",{id:"device-name",ref_key:"nameInput",ref:o,"onUpdate:modelValue":M[1]||(M[1]=te=>n.value.name=te),type:"text",placeholder:"e.g., Living Room TV",onInput:M[2]||(M[2]=te=>Oe("name"))},null,544),[[Ve,n.value.name]]),V.value.name?(a(),r("div",sl,[M[13]||(M[13]=e("i",{class:"mdi mdi-alert"},null,-1)),x(" "+v(V.value.name),1)])):O("",!0)]),M[15]||(M[15]=e("small",null,"Friendly name for this device",-1))],2),e("div",{class:G(["form-group",{"has-error":V.value.entity_type}])},[M[23]||(M[23]=e("label",{for:"entity-type"},"Entity Type *",-1)),e("div",al,[W(e("select",{id:"entity-type",ref_key:"typeSelect",ref:b,"onUpdate:modelValue":M[3]||(M[3]=te=>n.value.entity_type=te),onChange:M[4]||(M[4]=te=>Oe("entity_type"))},[M[16]||(M[16]=ze('<option value="" data-v-94bc1fe5>-- Select Type --</option><option value="light" data-v-94bc1fe5>ğŸ’¡ Light</option><option value="fan" data-v-94bc1fe5>ğŸŒ€ Fan</option><option value="switch" data-v-94bc1fe5>ğŸ”Œ Switch</option><option value="media_player" data-v-94bc1fe5>ğŸ“º Media Player</option><option value="cover" data-v-94bc1fe5>ğŸªŸ Cover (Blinds/Curtains)</option>',6)),e("option",{value:"climate",disabled:!m.value}," ğŸŒ¡ï¸ Climate "+v(m.value?"":"(Requires SmartIR)"),9,il)],544),[[Me,n.value.entity_type]]),V.value.entity_type?(a(),r("div",rl,[M[17]||(M[17]=e("i",{class:"mdi mdi-alert"},null,-1)),x(" "+v(V.value.entity_type),1)])):O("",!0)]),n.value.entity_type==="climate"?(a(),r("div",dl,[m.value?(a(),r("div",ul,[...M[18]||(M[18]=[e("i",{class:"mdi mdi-check-circle"},null,-1),e("span",null,"SmartIR detected! Climate entities will be created via SmartIR profiles.",-1)])])):(a(),r("div",cl,[...M[19]||(M[19]=[e("i",{class:"mdi mdi-alert"},null,-1),e("div",null,[e("strong",null,"SmartIR Required"),e("p",null,"Climate entities (AC, heaters) require SmartIR integration."),e("a",{href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"smartir-link"}," Install SmartIR â†’ ")],-1)])]))])):m.value&&["media_player","fan","light"].includes(n.value.entity_type)?(a(),r("div",ml,[...M[20]||(M[20]=[e("div",{class:"notice-info"},[e("i",{class:"mdi mdi-information"}),e("span",null,"ğŸ’¡ SmartIR available! You can use pre-configured codes or learn your own.")],-1)])])):!m.value&&n.value.entity_type?(a(),r("small",vl,[M[21]||(M[21]=x(" ğŸ’¡ Tip: Install ",-1)),M[22]||(M[22]=e("a",{href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"inline-link"},"SmartIR",-1)),x(" for pre-configured "+v(n.value.entity_type==="climate"?"climate":n.value.entity_type)+" device codes ",1)])):O("",!0)],2),e("div",pl,[M[26]||(M[26]=e("label",{for:"device-type"},"Device Type *",-1)),W(e("select",{id:"device-type","onUpdate:modelValue":M[5]||(M[5]=te=>n.value.device_type=te),required:"",disabled:f.value},[M[24]||(M[24]=e("option",{value:""},"-- Select Device Type --",-1)),M[25]||(M[25]=e("option",{value:"broadlink"},"ğŸ“¡ Broadlink Device (Learn IR Codes)",-1)),Ie(s)?(a(),r("option",{key:0,value:"smartir",disabled:!m.value||!S.value}," ğŸŒ SmartIR Device "+v(_.value),9,gl)):O("",!0)],8,fl),[[Me,n.value.device_type]]),f.value?(a(),r("small",yl,"Cannot change device type after creation")):n.value.device_type==="smartir"?(a(),r("small",bl,"Using pre-configured codes from SmartIR repository")):n.value.device_type==="broadlink"?(a(),r("small",hl,"Learn and store your own IR codes")):(a(),r("small",kl,"Choose how to configure this device"))]),f.value?(a(),r("div",wl,[M[29]||(M[29]=e("label",{for:"device-area"},"Area",-1)),e("div",$l,[e("input",{id:"device-area",value:n.value.area||"Not assigned",type:"text",readonly:"",class:"readonly-input"},null,8,Cl),e("button",{type:"button",onClick:se,disabled:N.value,class:"sync-area-btn",title:"Sync area from Home Assistant"},[e("i",{class:G(N.value?"mdi mdi-loading mdi-spin":"mdi mdi-refresh")},null,2)],8,_l)]),e("small",null,[M[27]||(M[27]=e("i",{class:"mdi mdi-information-outline"},null,-1)),M[28]||(M[28]=x(" Set area in Home Assistant, then click sync. ",-1)),e("a",{href:fe(),target:"_blank",class:"inline-link"},"Open in HA â†’",8,Sl)])])):(a(),r("div",Il,[...M[30]||(M[30]=[e("div",{class:"info-notice"},[e("i",{class:"mdi mdi-information-outline"}),e("span",null,[e("strong",null,"Area Assignment:"),x(" After generating entities and restarting Home Assistant, you can assign areas in HA and sync them here.")])],-1)])])),e("div",Dl,[M[31]||(M[31]=e("label",{for:"device-icon"},"Icon",-1)),ke(ho,{modelValue:n.value.icon,"onUpdate:modelValue":M[6]||(M[6]=te=>n.value.icon=te),inputId:"device-icon",placeholder:"e.g., mdi:television"},null,8,["modelValue"]),M[32]||(M[32]=e("small",null,"Optional: Material Design Icon name",-1))]),n.value.device_type==="broadlink"?(a(),r("div",{key:2,class:G(["form-group",{"has-error":V.value.broadlink_entity}])},[M[35]||(M[35]=e("label",{for:"broadlink-entity"},"Remote Device *",-1)),e("div",xl,[!f.value||!L.value?W((a(),r("select",{key:0,id:"broadlink-entity",ref_key:"broadlinkSelect",ref:P,"onUpdate:modelValue":M[7]||(M[7]=te=>n.value.broadlink_entity=te),onChange:M[8]||(M[8]=te=>Oe("broadlink_entity"))},[M[33]||(M[33]=e("option",{value:""},"-- Select Remote Device --",-1)),(a(!0),r(he,null,$e(D.value,te=>(a(),r("option",{key:te.entity_id,value:te.entity_id},[x(v(te.name||te.entity_id)+" ",1),te.area_name?(a(),r(he,{key:0},[x(" - "+v(te.area_name),1)],64)):O("",!0)],8,Tl))),128))],544)),[[Me,n.value.broadlink_entity]]):(a(),r("input",{key:1,id:"broadlink-entity",value:k.value,type:"text",readonly:"",disabled:""},null,8,Ml)),V.value.broadlink_entity?(a(),r("div",Rl,[M[34]||(M[34]=e("i",{class:"mdi mdi-alert"},null,-1)),x(" "+v(V.value.broadlink_entity),1)])):O("",!0)]),!f.value||!L.value?(a(),r("small",El,"Required: Select which remote device to use for sending commands")):(a(),r("small",Ol,"Cannot change remote device after commands are learned"))],2)):O("",!0),n.value.device_type==="smartir"?(a(),r("div",Al,[M[36]||(M[36]=e("div",{class:"section-header"},[e("i",{class:"mdi mdi-cloud-download"}),e("span",null,"SmartIR Device Configuration")],-1)),ke(tl,{ref_key:"smartirSelector",ref:F,"entity-type":n.value.entity_type,modelValue:q.value,"onUpdate:modelValue":M[9]||(M[9]=te=>q.value=te),"broadlink-devices":D.value,onChange:De},null,8,["entity-type","modelValue","broadlink-devices"])])):O("",!0)],32),e("div",Ll,[e("button",{type:"button",onClick:M[10]||(M[10]=te=>Y.$emit("cancel")),class:"btn btn-secondary"}," Cancel "),e("button",Pl,[M[37]||(M[37]=e("i",{class:"mdi mdi-check"},null,-1)),x(" "+v(f.value?"Update":"Create"),1)])])])]))}},jl=Se(Vl,[["__scopeId","data-v-94bc1fe5"]]),Ul={class:"modal-header"},Fl={class:"modal-body"},Nl={class:"message-text"},Bl={key:0,class:"checkbox-option"},Hl={class:"modal-footer"},ql=["disabled"],zl={__name:"ConfirmDialog",props:{isOpen:{type:Boolean,default:!1},title:{type:String,default:"Confirm"},message:{type:String,required:!0},confirmText:{type:String,default:"OK"},cancelText:{type:String,default:"Cancel"},showCancel:{type:Boolean,default:!0},dangerMode:{type:Boolean,default:!1},confirmDisabled:{type:Boolean,default:!1},checkboxLabel:{type:String,default:""}},emits:["confirm","cancel"],setup(t,{emit:c}){const i=t,h=c,w=g(!1);ue(()=>i.isOpen,f=>{f&&(w.value=!1)});const s=()=>{h("confirm",w.value)},m=()=>{h("cancel")};return(f,S)=>t.isOpen?(a(),r("div",{key:0,class:"modal-overlay",onClick:be(m,["self","stop"])},[e("div",{class:"modal-dialog confirm-dialog",onClick:S[1]||(S[1]=be(()=>{},["stop"]))},[e("div",Ul,[e("h2",null,v(t.title),1)]),e("div",Fl,[e("p",Nl,v(t.message),1),t.checkboxLabel?(a(),r("div",Bl,[e("label",null,[W(e("input",{type:"checkbox","onUpdate:modelValue":S[0]||(S[0]=_=>w.value=_)},null,512),[[me,w.value]]),e("span",null,v(t.checkboxLabel),1)])])):O("",!0)]),e("div",Hl,[t.showCancel?(a(),r("button",{key:0,onClick:be(m,["stop"]),class:"btn btn-secondary"},v(t.cancelText),1)):O("",!0),t.confirmText?(a(),r("button",{key:1,onClick:be(s,["stop"]),class:G(["btn",t.dangerMode?"btn-danger":"btn-primary"]),disabled:t.confirmDisabled},v(t.confirmText),11,ql)):O("",!0)])])])):O("",!0)}},He=Se(zl,[["__scopeId","data-v-9cea6cb3"]]),Jl={class:"modal-content"},Wl={class:"modal-header"},Gl={class:"modal-body"},Kl={key:0,class:"smartir-info"},Xl={key:0,class:"climate-note"},Yl={class:"form-group"},Zl=["value"],Ql={class:"form-group"},en=["disabled"],tn={label:"Suggested Commands"},on=["value"],ln=["disabled"],nn={class:"form-group"},sn={class:"radio-card-group"},an=["disabled"],rn=["disabled"],dn={class:"form-group"},un={class:"radio-card-group"},cn=["disabled"],mn=["disabled"],vn=["disabled"],pn={key:0,class:"help-box"},fn={class:"learn-action"},gn=["disabled"],yn={key:0,class:"mdi mdi-loading mdi-spin"},bn={key:1,class:"mdi mdi-remote-tv"},hn={key:0,class:"learning-status"},kn={key:0},wn={key:1},$n={key:2},Cn={key:1,class:"result-message success"},_n={key:2,class:"section-divider"},Sn={key:3,class:"loading-commands"},In={key:4,class:"learned-commands"},Dn={class:"commands-header"},xn=["disabled"],Tn={class:"command-list"},Mn={class:"command-info"},Rn={class:"command-name"},En={class:"command-right"},On={key:0,class:"mdi mdi-alert-circle error-icon",title:"Error: Command failed to learn. Delete and try again."},An={key:1,class:"mdi mdi-clock-outline pending-icon",title:"Pending: Waiting for code from storage..."},Ln=["title"],Pn={class:"command-actions"},Vn=["onClick","title","disabled"],jn=["onClick","title"],Un={key:5,class:"untracked-commands"},Fn={class:"command-list"},Nn={class:"command-name"},Bn=["onClick"],Hn={class:"modal-footer"},qn=["disabled"],zn={__name:"CommandLearner",props:{device:{type:Object,required:!0}},emits:["cancel","learned"],setup(t,{emit:c}){const i=t,h=c,w=g([]),s=g(""),m=g(""),f=g(""),S=g("ir"),_=g("manager_only"),L=g(!1),k=g(!1),n=g(""),V=g(""),q=g(""),F=g("success"),R=g([]),D=g([]),o=g(!1),b=g(!1),P=g(""),p=g(!1),Z=g(null),ne=g(null),z=g(""),T=g(""),N=X(()=>i.device.device_type==="smartir");X(()=>{if(N.value)return!1;const y=m.value==="__custom__"?f.value:m.value;return s.value&&y.trim()});const se=()=>{Z.value&&Z.value.setCustomValidity("")},fe=()=>{ne.value&&ne.value.setCustomValidity("")},Re=X(()=>{const y=w.value.find(u=>u.entity_id===s.value);return y?y.name||y.entity_id:s.value}),Oe={light:["turn_on","turn_off","toggle","brightness_up","brightness_down","dim","bright"],fan:["turn_on","turn_off","toggle","speed_low","speed_medium","speed_high","speed_1","speed_2","speed_3","speed_4","speed_5","oscillate_on","oscillate_off","direction_forward","direction_reverse"],switch:["turn_on","turn_off","toggle"],media_player:["turn_on","turn_off","toggle","volume_up","volume_down","volume_mute","play","pause","stop","play_pause","next_track","previous_track","channel_up","channel_down","source_hdmi1","source_hdmi2","source_hdmi3","source_tv","source_aux","source_bluetooth","menu","home","back","select","arrow_up","arrow_down","arrow_left","arrow_right"],cover:["open","close","stop","open_tilt","close_tilt","position_0","position_25","position_50","position_75","position_100"]},Ae=X(()=>{const y=i.device.entity_type||"switch";return Oe[y]||Oe.switch});ue(()=>i.device,async(y,u)=>{if(y&&u&&y.id===u.id){const l=Object.keys(y.commands||{}).length,B=Object.keys(u.commands||{}).length;l!==B&&(console.log(`ğŸ”„ Device commands changed (${B} -> ${l}), reloading...`),await Y(!0))}},{deep:!0}),Ee(async()=>{await De(),await Y(),await ce(),Z.value&&(Z.value.setCustomValidity(""),Z.value.oninvalid=()=>{Z.value.setCustomValidity("Command name is required")}),i.device.broadlink_entity&&(s.value=i.device.broadlink_entity)}),ue(m,async y=>{y==="__custom__"&&(await at(),ne.value&&(ne.value.setCustomValidity(""),ne.value.oninvalid=()=>{ne.value.setCustomValidity("Custom command name is required")}))});const De=async()=>{try{const y=await oe.get("/api/broadlink/devices");w.value=y.data.devices||[]}catch(y){console.error("Error loading Broadlink devices:",y)}},Y=async(y=!1)=>{var u,l;o.value=!0;try{if(y&&!N.value)try{await oe.post("/api/commands/check-pending"),console.log("ğŸ”„ Triggered backend polling check")}catch(B){console.warn("âš ï¸ Could not trigger polling check:",B)}if(N.value){const B=await oe.get("/api/smartir/codes/code",{params:{entity_type:i.device.entity_type,code_id:i.device.device_code}});if(B.data.success&&B.data.code){const Q=B.data.code.commands||{},re=B.data.code.commandType||"ir";if(i.device.entity_type==="climate"){const ae=[];for(const[Ce,ge]of Object.entries(Q))typeof ge=="string"?ae.push({name:Ce,type:re}):typeof ge=="object"&&ge!==null&&Object.keys(ge).sort((I,d)=>parseInt(I)-parseInt(d)).forEach(I=>{ae.push({name:`${Ce}_${I}`,type:re,label:`${Ce.charAt(0).toUpperCase()+Ce.slice(1)} ${I}Â°C`})});R.value=ae}else R.value=Object.keys(Q).map(ae=>({name:ae,type:re}))}}else{if(console.log("ğŸ“‹ Loading commands for device:",i.device),console.log("ğŸ“‹ Device ID:",i.device.id),console.log("ğŸ“‹ Force reload:",y),y&&i.device.id){console.log("ğŸ”„ Force reloading commands from API after sync");try{const Q=(await oe.get(`/api/commands/${i.device.id}`)).data.commands||{};console.log("ğŸ“¦ Raw commands from API:",Q),R.value=Object.entries(Q).map(([re,ae])=>{console.log(`  Command '${re}':`,ae,`(type: ${typeof ae})`);const Ce=typeof ae=="object"&&ae!==null&&(ae.command_type||ae.type)||"ir",ge=typeof ae=="object"&&ae!==null?ae.data:ae;return{name:re,type:Ce,data:ge,hasError:ge==="error",isPending:ge==="pending"}}),console.log("ğŸ“‹ Reloaded commands:",R.value)}catch(B){if(console.error("âŒ Error loading commands:",B),((u=B.response)==null?void 0:u.status)===404)console.log("â„¹ï¸ No commands found for device"),R.value=[];else throw B}}else if(i.device.commands&&Object.keys(i.device.commands).length>0)console.log("âœ… Using commands from device object"),R.value=Object.entries(i.device.commands).map(([B,Q])=>{const re=Q.data||Q;return{name:B,type:Q.command_type||Q.type||"ir",data:re,hasError:re==="error",isPending:re==="pending"}});else if(i.device.commands!==void 0)console.log("â„¹ï¸ Device has empty commands object - skipping API call"),R.value=[];else if(i.device.id){console.log("ğŸŒ Fetching commands from API for device ID:",i.device.id);try{const Q=(await oe.get(`/api/commands/${i.device.id}`)).data.commands||{};R.value=Object.entries(Q).map(([re,ae])=>({name:re,type:ae.command_type||ae.type||"ir"}))}catch(B){if(((l=B.response)==null?void 0:l.status)===404)console.log("â„¹ï¸ No commands found for device (this is normal for new devices)"),R.value=[];else throw B}}else console.log("âš ï¸ No commands found and no device ID");console.log("ğŸ“‹ Final learned commands:",R.value)}}catch(B){console.error("Error loading commands:",B)}finally{o.value=!1}},M=async()=>{q.value="",F.value="",V.value="",k.value=!0,n.value="preparing";try{const y=m.value==="__custom__"?f.value:m.value;S.value==="rf"?(n.value="learning",q.value="âš ï¸ Learning request sent to device. Check Home Assistant notifications (ğŸ””) for instructions. Note: If the device is offline or times out, you will see a notification but this dialog will still show success.",F.value="warning",await new Promise(l=>setTimeout(l,50))):n.value="learning";const u=await oe.post("/api/commands/learn",{device_id:i.device.id,entity_id:s.value||i.device.broadlink_entity,device:i.device.device||i.device.id,command:y.trim(),command_type:S.value,save_destination:_.value});if(u.data.success){if(n.value="complete",q.value="",F.value="",_.value==="manager_only"||_.value==="both"){R.value.find(Q=>Q.name===y)||R.value.push({name:y,type:S.value});const B=D.value.indexOf(y);B>-1&&D.value.splice(B,1)}await ce(),m.value="",f.value="",h("learned",{deviceId:i.device.id,commandName:y,commandType:S.value}),k.value=!1,n.value=""}else throw new Error(u.data.error||"Failed to learn command")}catch(y){console.error("Learning error:",y),q.value=y.message||"Error learning command",F.value="error",k.value=!1,n.value=""}},te=async y=>{var u,l;try{T.value=y,z.value="";let B=i.device.id.split(".")[1];i.device.device&&(B=i.device.device);const Q=N.value?i.device.controller_device:s.value||i.device.broadlink_entity;if(!Q){console.error("Missing entity_id for test command:",{isSmartIR:N.value,controller_device:i.device.controller_device,broadlink_entity:i.device.broadlink_entity,selectedBroadlink:s.value,device:i.device}),q.value="Missing Broadlink remote entity. Please select a Broadlink device.",F.value="error",T.value="";return}const re={device_id:i.device.id,entity_id:Q,command:y,device:i.device.device||i.device.id};console.log("ğŸ§ª Testing command:",re),(await oe.post("/api/commands/test",re)).data.success&&(z.value=y,setTimeout(()=>{z.value===y&&(z.value="")},2e3))}catch(B){console.error("âŒ Test command error:",B);const Q=((l=(u=B.response)==null?void 0:u.data)==null?void 0:l.error)||B.message||"Unknown error";q.value=`Failed to send command: ${Q}`,F.value="error"}finally{T.value=""}},H=y=>{P.value=y,b.value=!0},j=()=>{b.value=!1,P.value=""},K=async y=>{const u=P.value;b.value=!1;try{if(console.log(`ğŸ—‘ï¸ Deleting command: ${u}, alsoDeleteFromIntegration: ${y}`),await oe.delete(`/api/commands/${i.device.id}/${u}`),y)try{const l=i.device.device||i.device.id;await oe.post("/api/commands/delete-from-storage",{device:l,command:u}),console.log("âœ… Also deleted from Broadlink Integration storage")}catch(l){console.warn("âš ï¸ Failed to delete from Broadlink Integration storage:",l)}await Y(!0),await ce(),q.value=`Command "${u}" deleted`,F.value="success",h("learned",{deviceId:i.device.id,commandName:u,action:"deleted"})}catch(l){console.error("âŒ Delete error:",l),q.value=`Failed to delete command: ${l.message}`,F.value="error",await Y(!0)}finally{P.value=""}},ce=async()=>{try{let y=i.device.device;y||(y=i.device.id.includes(".")?i.device.id.split(".")[1]:i.device.id),console.log("ğŸ” Looking for untracked commands for device:",y);const l=(await oe.get("/api/commands/untracked")).data.untracked||{};console.log("ğŸ“¦ All untracked commands:",Object.keys(l)),console.log("ğŸ“¦ Untracked for this device:",l[y]),l[y]?D.value=Object.keys(l[y].commands):D.value=[]}catch(y){console.error("Error loading untracked commands:",y),D.value=[]}},Pe=()=>{D.value.length!==0&&(p.value=!0)},Te=async y=>{var u,l,B;console.log("ğŸ”µ [IMPORT SINGLE] Importing command:",y);try{const Q=i.device.device||i.device.id||((u=i.device.id)!=null&&u.includes(".")?i.device.id.split(".")[1]:null);if(!Q)throw new Error("Could not determine device name for import");console.log("ğŸ”µ [IMPORT SINGLE] Calling API to import command...");const re=await oe.post("/api/commands/import",{device_id:i.device.id,source_device:Q,commands:[y]});console.log("ğŸ”µ [IMPORT SINGLE] API response:",re.data),re.data.success?(q.value=`Imported command '${y}' successfully!`,F.value="success",await Y(!0),await ce()):(q.value=re.data.error||"Failed to import command",F.value="error")}catch(Q){console.error("ğŸ”´ [IMPORT SINGLE] Error:",Q),q.value=((B=(l=Q.response)==null?void 0:l.data)==null?void 0:B.error)||Q.message||"Failed to import command",F.value="error"}},ee=async()=>{var y;console.log("ğŸ”µ [IMPORT] Starting import process..."),console.log("ğŸ”µ [IMPORT] Current learned commands:",R.value.length),console.log("ğŸ”µ [IMPORT] Current untracked commands:",D.value.length),p.value=!1;try{const u=i.device.device||i.device.id||((y=i.device.id)!=null&&y.includes(".")?i.device.id.split(".")[1]:null);if(console.log("ğŸ”µ [IMPORT] Device object:",i.device),console.log("ğŸ”µ [IMPORT] Extracted device name:",u),!u)throw new Error("Could not determine device name for import");console.log("ğŸ”µ [IMPORT] Calling API to import commands...");const l=await oe.post("/api/commands/import",{device_id:i.device.id,source_device:u,commands:D.value});console.log("ğŸ”µ [IMPORT] API response:",l.data),l.data.success&&(q.value=`Imported ${l.data.imported_count} commands successfully!`,F.value="success",console.log("ğŸ”µ [IMPORT] Import successful, now reloading commands..."),console.log("ğŸ”µ [IMPORT] BEFORE reload - learned:",R.value.length,"untracked:",D.value.length),await Y(!0),console.log("ğŸ”µ [IMPORT] AFTER loadLearnedCommands - learned:",R.value.length),await ce(),console.log("ğŸ”µ [IMPORT] AFTER loadUntrackedCommands - untracked:",D.value.length),console.log("ğŸ”µ [IMPORT] Final state - learned:",R.value,"untracked:",D.value),console.log("ğŸ”µ [IMPORT] Emitting learned event to parent..."),h("learned",{deviceId:i.device.id,action:"imported",count:l.data.imported_count}),console.log("ğŸ”µ [IMPORT] âœ… Import process complete!"))}catch(u){console.error("ğŸ”µ [IMPORT] âŒ Import failed:",u),q.value=`Failed to import commands: ${u.message}`,F.value="error"}};return(y,u)=>(a(),r("div",{class:"modal-overlay",onClick:u[12]||(u[12]=be(l=>y.$emit("cancel"),["self"]))},[e("div",Jl,[e("div",Wl,[e("h2",null,v(N.value?"Commands for":"Learn Commands for")+" "+v(t.device.name),1),e("button",{onClick:u[0]||(u[0]=l=>y.$emit("cancel")),class:"close-btn"},[...u[13]||(u[13]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Gl,[N.value?(a(),r("div",Kl,[u[18]||(u[18]=e("i",{class:"mdi mdi-information"},null,-1)),e("div",null,[u[17]||(u[17]=e("h3",null,"SmartIR Device",-1)),e("p",null,[u[14]||(u[14]=x("This device uses SmartIR code file ",-1)),e("strong",null,v(t.device.device_code),1),u[15]||(u[15]=x(". Commands are pre-configured and cannot be learned.",-1))]),t.device.entity_type==="climate"?(a(),r("p",Xl,[...u[16]||(u[16]=[e("i",{class:"mdi mdi-alert-circle-outline"},null,-1),e("strong",null,"Note:",-1),x(" Climate device commands are temperature-based. Testing individual modes may not work as expected. Use the Home Assistant climate card to control your device. ",-1)])])):O("",!0)])])):(a(),r("form",{key:1,onSubmit:be(M,["prevent"])},[e("div",Yl,[u[19]||(u[19]=e("label",{for:"broadlink-entity"},"Broadlink Device",-1)),e("input",{id:"broadlink-entity",value:Re.value,type:"text",readonly:"",disabled:""},null,8,Zl),u[20]||(u[20]=e("small",null,"Commands will be learned using this device (set when device was created)",-1))]),e("div",Ql,[u[23]||(u[23]=e("label",{for:"command-name"},"Command Name *",-1)),W(e("select",{id:"command-name",ref_key:"commandSelect",ref:Z,"onUpdate:modelValue":u[1]||(u[1]=l=>m.value=l),disabled:k.value,required:"",onChange:se},[u[21]||(u[21]=e("option",{value:""},"-- Select or type command --",-1)),e("optgroup",tn,[(a(!0),r(he,null,$e(Ae.value,l=>(a(),r("option",{key:l,value:l},v(l),9,on))),128))]),u[22]||(u[22]=e("option",{value:"__custom__"},"Custom command...",-1))],40,en),[[Me,m.value]]),m.value==="__custom__"?W((a(),r("input",{key:0,ref_key:"customCommandInput",ref:ne,"onUpdate:modelValue":u[2]||(u[2]=l=>f.value=l),type:"text",placeholder:"Enter custom command name",disabled:k.value,required:"",class:"custom-command-input",onInput:fe},null,40,ln)),[[Ve,f.value]]):O("",!0),e("small",null,"Select a suggested command for "+v(t.device.entity_type||"this device")+", or enter a custom one.",1)]),e("div",nn,[u[28]||(u[28]=e("label",null,"Command Type",-1)),e("div",sn,[e("label",{class:G(["radio-card",{active:S.value==="ir",disabled:k.value}])},[W(e("input",{type:"radio","onUpdate:modelValue":u[3]||(u[3]=l=>S.value=l),value:"ir",disabled:k.value},null,8,an),[[Je,S.value]]),e("i",{class:G(["mdi radio-indicator",S.value==="ir"?"mdi-radiobox-marked":"mdi-radiobox-blank"])},null,2),u[24]||(u[24]=e("i",{class:"mdi mdi-remote card-icon"},null,-1)),u[25]||(u[25]=e("span",{class:"card-text"},"IR (Infrared)",-1))],2),e("label",{class:G(["radio-card",{active:S.value==="rf",disabled:k.value}])},[W(e("input",{type:"radio","onUpdate:modelValue":u[4]||(u[4]=l=>S.value=l),value:"rf",disabled:k.value},null,8,rn),[[Je,S.value]]),e("i",{class:G(["mdi radio-indicator",S.value==="rf"?"mdi-radiobox-marked":"mdi-radiobox-blank"])},null,2),u[26]||(u[26]=e("i",{class:"mdi mdi-radio-tower card-icon"},null,-1)),u[27]||(u[27]=e("span",{class:"card-text"},"RF (Radio Frequency)",-1))],2)])]),e("div",dn,[e("label",null,[u[30]||(u[30]=x(" Save Destination ",-1)),e("button",{type:"button",class:"help-btn",onClick:u[5]||(u[5]=l=>L.value=!L.value),title:"Learn more"},[...u[29]||(u[29]=[e("i",{class:"mdi mdi-help-circle-outline"},null,-1)])])]),e("div",un,[e("label",{class:G(["radio-card",{active:_.value==="manager_only",disabled:k.value}])},[W(e("input",{type:"radio","onUpdate:modelValue":u[6]||(u[6]=l=>_.value=l),value:"manager_only",disabled:k.value},null,8,cn),[[Je,_.value]]),e("i",{class:G(["mdi radio-indicator",_.value==="manager_only"?"mdi-radiobox-marked":"mdi-radiobox-blank"])},null,2),u[31]||(u[31]=e("i",{class:"mdi mdi-application card-icon"},null,-1)),u[32]||(u[32]=e("span",{class:"card-text"},"Broadlink Manager",-1))],2),e("label",{class:G(["radio-card",{active:_.value==="integration_only",disabled:k.value}])},[W(e("input",{type:"radio","onUpdate:modelValue":u[7]||(u[7]=l=>_.value=l),value:"integration_only",disabled:k.value},null,8,mn),[[Je,_.value]]),e("i",{class:G(["mdi radio-indicator",_.value==="integration_only"?"mdi-radiobox-marked":"mdi-radiobox-blank"])},null,2),u[33]||(u[33]=e("i",{class:"mdi mdi-home-assistant card-icon"},null,-1)),u[34]||(u[34]=e("span",{class:"card-text"},"HA Broadlink",-1))],2),e("label",{class:G(["radio-card",{active:_.value==="both",disabled:k.value}])},[W(e("input",{type:"radio","onUpdate:modelValue":u[8]||(u[8]=l=>_.value=l),value:"both",disabled:k.value},null,8,vn),[[Je,_.value]]),e("i",{class:G(["mdi radio-indicator",_.value==="both"?"mdi-radiobox-marked":"mdi-radiobox-blank"])},null,2),u[35]||(u[35]=e("i",{class:"mdi mdi-swap-horizontal card-icon"},null,-1)),u[36]||(u[36]=e("span",{class:"card-text"},"Both",-1))],2)]),L.value?(a(),r("div",pn,[...u[37]||(u[37]=[e("h4",null,"Save Destination Options",-1),e("ul",null,[e("li",null,[e("strong",null,"Broadlink Manager (Recommended):"),x(" Commands are saved only in this app's database (devices.json). This gives you full control and makes commands portable. The Broadlink Integration won't see these commands.")]),e("li",null,[e("strong",null,"HA Broadlink:"),x(" Commands are saved only in Home Assistant's Broadlink Integration storage. This app won't track these commands, but they'll be available to the Broadlink Integration's remote.send_command service.")]),e("li",null,[e("strong",null,"Both:"),x(" Commands are saved in both places. Use this if you want commands available in both this app and the Broadlink Integration.")])],-1)])])):O("",!0)]),e("div",fn,[e("button",{type:"submit",class:"btn btn-primary btn-large",disabled:k.value},[k.value?(a(),r("i",yn)):(a(),r("i",bn)),x(" "+v(k.value?"Learning...":"Learn Command"),1)],8,gn)]),k.value?(a(),r("div",hn,[u[41]||(u[41]=e("i",{class:"mdi mdi-loading mdi-spin"},null,-1)),n.value==="preparing"?(a(),r("div",kn,[...u[38]||(u[38]=[e("p",null,[e("strong",null,"Preparing device...")],-1),e("small",null,"Connecting and authenticating with Broadlink device (this takes a few seconds)",-1)])])):S.value==="ir"?(a(),r("div",wn,[...u[39]||(u[39]=[e("p",null,[e("strong",null,"Ready!"),x(" Point your remote at the Broadlink device and press the button...")],-1),e("small",null,"This may take up to 30 seconds",-1)])])):S.value==="rf"?(a(),r("div",$n,[...u[40]||(u[40]=[e("p",null,[e("strong",null,"Learning RF command...")],-1),e("small",null,"Check Home Assistant notifications (ğŸ””) for instructions",-1)])])):O("",!0)])):O("",!0),q.value&&F.value==="success"&&!q.value.includes("sent successfully")&&!k.value?(a(),r("div",Cn,[u[42]||(u[42]=e("i",{class:"mdi mdi-check-circle"},null,-1)),e("p",null,v(q.value),1)])):O("",!0)],32)),R.value.length>0||D.value.length>0?(a(),r("div",_n)):O("",!0),o.value?(a(),r("div",Sn,[...u[43]||(u[43]=[e("div",{class:"loading-spinner"},[e("i",{class:"mdi mdi-loading mdi-spin"}),e("p",null,"Loading commands...")],-1)])])):R.value.length>0?(a(),r("div",In,[e("div",Dn,[e("h3",null,"Tracked Commands ("+v(R.value.length)+")",1),e("button",{type:"button",onClick:u[9]||(u[9]=l=>Y(!0)),class:"icon-btn refresh-btn",title:"Refresh commands",disabled:o.value},[e("i",{class:G(["mdi mdi-refresh",{"mdi-spin":o.value}])},null,2)],8,xn)]),e("div",Tn,[(a(!0),r(he,null,$e(R.value,l=>(a(),r("div",{key:l.name,class:G(["command-item",{"error-state":l.hasError,"pending-state":l.isPending}])},[e("div",Mn,[e("span",Rn,v(l.label||l.name),1)]),e("div",En,[l.hasError?(a(),r("i",On)):l.isPending?(a(),r("i",An)):(a(),r("i",{key:2,class:"mdi mdi-check-circle learned-icon",title:`Learned (${(l.type||"ir").toUpperCase()})`},null,8,Ln)),e("span",{class:G(["command-type-badge",l.type||"ir"])},v((l.type||"ir").toUpperCase()),3),e("div",Pn,[e("button",{type:"button",onClick:B=>te(l.name),class:"icon-btn",title:l.hasError?"Cannot test - command failed to learn":l.isPending?"Cannot test - waiting for code":"Test command",disabled:T.value===l.name||l.hasError||l.isPending},[e("i",{class:G(["mdi mdi-play",{"mdi-spin":T.value===l.name}])},null,2)],8,Vn),e("button",{type:"button",onClick:B=>H(l.name),class:"icon-btn danger",title:l.hasError?"Delete and re-learn":"Delete command"},[...u[44]||(u[44]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,jn)])])],2))),128))])])):O("",!0),D.value.length>0?(a(),r("div",Un,[e("h3",null,[u[45]||(u[45]=e("i",{class:"mdi mdi-alert"},null,-1)),x(" Untracked Commands ("+v(D.value.length)+") ",1)]),u[48]||(u[48]=e("p",{class:"untracked-info"}," These commands exist in Broadlink storage but are not tracked in this device. ",-1)),e("div",Fn,[(a(!0),r(he,null,$e(D.value,l=>(a(),r("div",{key:l,class:"command-item untracked"},[e("span",Nn,v(l),1),e("button",{type:"button",onClick:B=>Te(l),class:"btn-icon",title:"Import this command"},[...u[46]||(u[46]=[e("i",{class:"mdi mdi-import"},null,-1)])],8,Bn)]))),128))]),u[49]||(u[49]=e("br",null,null,-1)),e("button",{type:"button",onClick:Pe,class:"btn btn-secondary"},[...u[47]||(u[47]=[e("i",{class:"mdi mdi-import"},null,-1),x(" Import All Untracked Commands ",-1)])])])):O("",!0)]),e("div",Hn,[e("button",{type:"button",onClick:u[10]||(u[10]=l=>y.$emit("cancel")),class:"btn btn-secondary",disabled:k.value}," Close ",8,qn)])]),ke(He,{isOpen:b.value,title:"Delete Command?",message:`Delete command '${P.value}' from Broadlink Manager?`,checkboxLabel:"Also delete from Broadlink Integration storage",confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,onConfirm:K,onCancel:j},null,8,["isOpen","message"]),ke(He,{isOpen:p.value,title:"Import Commands?",message:`Import ${D.value.length} untracked command${D.value.length>1?"s":""} into this device?`,confirmText:"Import",cancelText:"Cancel",onConfirm:ee,onCancel:u[11]||(u[11]=l=>p.value=!1)},null,8,["isOpen","message"])]))}},Jn=Se(zn,[["__scopeId","data-v-511d0e01"]]),Wn={class:"modal-container error-dialog"},Gn={class:"modal-header"},Kn={class:"modal-body"},Xn={class:"error-message"},Yn={key:0,class:"error-suggestion"},Zn=["open"],Qn={class:"debug-content"},es={class:"debug-info"},ts={key:0,class:"debug-section-title"},os={key:1},ls={__name:"ErrorDialog",props:{isOpen:{type:Boolean,default:!1},title:{type:String,default:"Error"},message:{type:String,required:!0},suggestion:{type:String,default:""},details:{type:String,default:""},error:{type:Object,default:null},context:{type:Object,default:()=>({})}},emits:["close"],setup(t,{emit:c}){const i=t,h=c,w=Le("toast"),s=g(!1),m=()=>{h("close")},f=X(()=>{var V,q,F,R,D,o,b,P,p,Z,ne;const k=new Date().toISOString(),n=i.error||{};return{error:JSON.stringify({message:i.message,title:i.title,details:i.details,errorObject:n.message||n.toString(),timestamp:k},null,2),request:JSON.stringify({method:((q=(V=n.config)==null?void 0:V.method)==null?void 0:q.toUpperCase())||"N/A",url:((F=n.config)==null?void 0:F.url)||"N/A",baseURL:((R=n.config)==null?void 0:R.baseURL)||"N/A",headers:((D=n.config)==null?void 0:D.headers)||{},data:(o=n.config)!=null&&o.data?JSON.parse(n.config.data):"N/A",params:((b=n.config)==null?void 0:b.params)||{}},null,2),response:JSON.stringify({status:((P=n.response)==null?void 0:P.status)||"N/A",statusText:((p=n.response)==null?void 0:p.statusText)||"N/A",data:((Z=n.response)==null?void 0:Z.data)||"N/A",headers:((ne=n.response)==null?void 0:ne.headers)||{}},null,2),browser:JSON.stringify({userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language,cookieEnabled:navigator.cookieEnabled,onLine:navigator.onLine,viewport:`${window.innerWidth}x${window.innerHeight}`,screenResolution:`${window.screen.width}x${window.screen.height}`,colorDepth:window.screen.colorDepth,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,timestamp:k},null,2),appState:JSON.stringify({currentRoute:window.location.pathname,currentURL:window.location.href,referrer:document.referrer||"N/A",context:i.context||{},localStorage:{smartir_simulate:localStorage.getItem("smartir_simulate_not_installed"),theme:localStorage.getItem("theme")}},null,2),stackTrace:n.stack||null}}),S=async()=>{const k=L();try{await navigator.clipboard.writeText(k),w==null||w.success("Debug information copied to clipboard","âœ… Copied")}catch(n){console.error("Failed to copy:",n),w==null||w.error("Failed to copy to clipboard","âŒ Copy Failed")}},_=()=>{const k=L(),n=new Blob([k],{type:"text/plain"}),V=URL.createObjectURL(n),q=document.createElement("a");q.href=V;const F=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5);q.download=`broadlink-manager-error-${F}.txt`,document.body.appendChild(q),q.click(),document.body.removeChild(q),URL.revokeObjectURL(V),w==null||w.success("Debug report downloaded","âœ… Downloaded")},L=()=>`Broadlink Manager - Error Report
${"=".repeat(60)}

Generated: ${new Date().toISOString()}
Title: ${i.title}
Message: ${i.message}
${i.suggestion?`Suggestion: ${i.suggestion}
`:""}
${"=".repeat(60)}

ERROR DETAILS
${"-".repeat(60)}
${f.value.error}

REQUEST INFORMATION
${"-".repeat(60)}
${f.value.request}

RESPONSE INFORMATION
${"-".repeat(60)}
${f.value.response}

BROWSER INFORMATION
${"-".repeat(60)}
${f.value.browser}

APPLICATION STATE
${"-".repeat(60)}
${f.value.appState}

${f.value.stackTrace?`STACK TRACE
${"-".repeat(60)}
${f.value.stackTrace}

`:""}
${"=".repeat(60)}
End of Report
`;return ue(()=>i.isOpen,k=>{if(k){const n=V=>{V.key==="Escape"&&m()};return document.addEventListener("keydown",n),()=>document.removeEventListener("keydown",n)}}),(k,n)=>(a(),Ne(it,{to:"body"},[ke(st,{name:"modal"},{default:tt(()=>[t.isOpen?(a(),r("div",{key:0,class:"modal-overlay",onClick:be(m,["self"])},[e("div",Wn,[e("div",Gn,[n[2]||(n[2]=e("div",{class:"header-icon error-icon"},[e("i",{class:"mdi mdi-alert-circle"})],-1)),e("h3",null,v(t.title),1),e("button",{onClick:m,class:"close-button"},[...n[1]||(n[1]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Kn,[e("p",Xn,v(t.message),1),t.suggestion?(a(),r("p",Yn,[n[3]||(n[3]=e("i",{class:"mdi mdi-lightbulb-on"},null,-1)),x(" "+v(t.suggestion),1)])):O("",!0),e("details",{class:"debug-section",open:s.value},[e("summary",{onClick:n[0]||(n[0]=V=>s.value=!s.value)},[e("i",{class:G(["mdi",s.value?"mdi-chevron-down":"mdi-chevron-right"])},null,2),n[4]||(n[4]=x(" Debug Information ",-1))]),e("div",Qn,[e("div",{class:"debug-actions"},[e("button",{onClick:S,class:"btn-debug btn-copy"},[...n[5]||(n[5]=[e("i",{class:"mdi mdi-content-copy"},null,-1),x(" Copy to Clipboard ",-1)])]),e("button",{onClick:_,class:"btn-debug btn-download"},[...n[6]||(n[6]=[e("i",{class:"mdi mdi-download"},null,-1),x(" Download Report ",-1)])])]),e("div",es,[n[7]||(n[7]=e("div",{class:"debug-section-title"},"Error Details",-1)),e("pre",null,v(f.value.error),1),n[8]||(n[8]=e("div",{class:"debug-section-title"},"Request Information",-1)),e("pre",null,v(f.value.request),1),n[9]||(n[9]=e("div",{class:"debug-section-title"},"Response Information",-1)),e("pre",null,v(f.value.response),1),n[10]||(n[10]=e("div",{class:"debug-section-title"},"Browser Information",-1)),e("pre",null,v(f.value.browser),1),n[11]||(n[11]=e("div",{class:"debug-section-title"},"Application State",-1)),e("pre",null,v(f.value.appState),1),f.value.stackTrace?(a(),r("div",ts,"Stack Trace")):O("",!0),f.value.stackTrace?(a(),r("pre",os,v(f.value.stackTrace),1)):O("",!0)])])],8,Zn)]),e("div",{class:"modal-footer"},[e("button",{onClick:m,class:"btn btn-primary"}," OK ")])])])):O("",!0)]),_:1})]))}},ns=Se(ls,[["__scopeId","data-v-23858149"]]),ss={class:"modal-dialog"},as={class:"modal-header"},is={class:"modal-body"},rs={class:"device-list"},ds={class:"device-info"},us={class:"device-details"},cs={class:"command-count"},ms={class:"device-actions"},vs=["onClick"],ps=["onClick"],fs={class:"modal-footer"},gs={class:"modal-dialog modal-dialog-small"},ys={class:"modal-header"},bs={class:"modal-body"},hs={class:"warning-message"},ks={class:"modal-footer"},ws=["disabled"],$s=["disabled"],Cs={__name:"DeviceDiscovery",emits:["adopt"],setup(t,{expose:c,emit:i}){const h=Ge(),w=i,s=g([]),m=g(!1),f=g(!1),S=g(null),_=g(!1);g(!1),X(()=>s.value.length>0),Ee(async()=>{await L()});const L=async()=>{try{const F=await oe.get("/api/devices/discover");s.value=F.data.untracked_devices||[]}catch(F){console.error("Error loading untracked devices:",F),s.value=[]}},k=()=>{m.value=!0},n=F=>{m.value=!1,w("adopt",F)},V=F=>{S.value=F,f.value=!0},q=async()=>{if(!S.value)return;const F=S.value.device_name;_.value=!0;try{const R=await oe.delete(`/api/devices/untracked/${encodeURIComponent(F)}`);if(R.data.success)s.value=s.value.filter(D=>D.device_name!==F),f.value=!1,S.value=null,s.value.length===0&&(m.value=!1),h.success(`Deleted all commands for '${F}'`);else throw new Error(R.data.error||"Failed to delete device")}catch(R){console.error("Error deleting device:",R),h.error(`Failed to delete device: ${R.message}`)}finally{_.value=!1}};return c({refresh:L,openDiscovery:k}),(F,R)=>{var D,o,b;return a(),r("div",null,[O("",!0),m.value?(a(),r("div",{key:1,class:"modal-overlay",onClick:R[2]||(R[2]=be(P=>m.value=!1,["self"]))},[e("div",ss,[e("div",as,[R[9]||(R[9]=e("h2",null,"Discovered Devices",-1)),e("button",{onClick:R[0]||(R[0]=P=>m.value=!1),class:"close-btn"},[...R[8]||(R[8]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",is,[R[14]||(R[14]=e("p",{class:"info-text"}," These devices have learned commands in Broadlink storage but are not being tracked. Adopt them to manage their commands and generate Home Assistant entities. ",-1)),e("div",rs,[(a(!0),r(he,null,$e(s.value,P=>(a(),r("div",{key:P.device_name,class:"discovered-device"},[e("div",ds,[R[11]||(R[11]=e("div",{class:"device-icon"},[e("i",{class:"mdi mdi-devices"})],-1)),e("div",us,[e("h4",null,v(P.device_name),1),e("span",cs,[R[10]||(R[10]=e("i",{class:"mdi mdi-remote"},null,-1)),x(" "+v(P.command_count)+" command"+v(P.command_count>1?"s":""),1)])])]),e("div",ms,[e("button",{onClick:p=>n(P),class:"btn btn-primary"},[...R[12]||(R[12]=[e("i",{class:"mdi mdi-plus"},null,-1),x(" Adopt ",-1)])],8,vs),e("button",{onClick:p=>V(P),class:"btn btn-danger",title:"Delete all commands"},[...R[13]||(R[13]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,ps)])]))),128))])]),e("div",fs,[O("",!0),e("button",{onClick:R[1]||(R[1]=P=>m.value=!1),class:"btn btn-secondary"}," Close ")])])])):O("",!0),f.value?(a(),r("div",{key:2,class:"modal-overlay",onClick:R[5]||(R[5]=be(P=>f.value=!1,["self"]))},[e("div",gs,[e("div",ys,[R[16]||(R[16]=e("h2",null,"Delete Untracked Device",-1)),e("button",{onClick:R[3]||(R[3]=P=>f.value=!1),class:"close-btn"},[...R[15]||(R[15]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",bs,[e("div",hs,[R[18]||(R[18]=e("i",{class:"mdi mdi-alert"},null,-1)),e("div",null,[e("p",null,[e("strong",null,'Are you sure you want to delete "'+v((D=S.value)==null?void 0:D.device_name)+'"?',1)]),e("p",null,"This will permanently delete all "+v((o=S.value)==null?void 0:o.command_count)+" command"+v(((b=S.value)==null?void 0:b.command_count)>1?"s":"")+" from Broadlink storage.",1),R[17]||(R[17]=e("p",{class:"warning-text"},"This action cannot be undone.",-1))])])]),e("div",ks,[e("button",{onClick:R[4]||(R[4]=P=>f.value=!1),class:"btn btn-secondary",disabled:_.value}," Cancel ",8,ws),e("button",{onClick:q,class:"btn btn-danger",disabled:_.value},[e("i",{class:G(["mdi",_.value?"mdi-loading mdi-spin":"mdi-delete"])},null,2),x(" "+v(_.value?"Deleting...":"Delete"),1)],8,$s)])])])):O("",!0)])}}},_s=Se(Cs,[["__scopeId","data-v-78e5b712"]]),Ss={class:"device-list-card"},Is={class:"card-header"},Ds={class:"header-badges"},xs={class:"header-info"},Ts=["title"],Ms={class:"header-right"},Rs={key:0,class:"view-toggle-group header-view-toggle"},Es={class:"settings-menu-container"},Os=["disabled"],As=["disabled"],Ls={class:"card-body"},Ps={key:0,class:"filter-bar"},Vs={class:"filter-search-row"},js=["title"],Us={key:0,class:"filter-badge"},Fs={class:"search-input-wrapper"},Ns={class:"filter-content"},Bs={class:"filter-row filter-row-dropdowns"},Hs={class:"filter-group"},qs=["value"],zs={class:"filter-group"},Js=["value"],Ws={class:"filter-group"},Gs={key:0,class:"filter-group filter-toggle"},Ks={class:"toggle-label"},Xs={class:"filter-results"},Ys={key:1,class:"loading-state"},Zs={key:2,class:"error-state"},Qs={key:3,class:"empty-state"},ea={key:4,class:"device-grid"},ta={key:6,class:"no-results"},oa={__name:"DeviceList",setup(t){const c=kt(),i=Ge(),{isMobile:h}=ot(),w=g(!1),s=g(!1),m=g(null),f=g(!1),S=g(!1),_=g(null),L=g(null),k=g(!0),n=g(!1),V=g(!1),q=g(0),R=g(window.innerWidth<=767?"grid":localStorage.getItem("device_view_mode")||"grid");ue(h,E=>{E&&R.value==="list"&&(R.value="grid")}),ue(R,E=>{localStorage.setItem("device_view_mode",E)});const D=()=>{k.value=!k.value,k.value||(S.value=!1)},o=()=>{k.value||(k.value=!0),S.value=!S.value},b=g(!1),P=g({title:"Error",message:"",suggestion:"",details:"",error:null,context:{}}),p=g(!1),Z=g({success:!1,title:"",message:""}),ne=g(!1),z=g({search:"",broadlinkDevice:"",area:"",entityType:"",showSmartIROnly:!1}),T=g([]),N=Le("smartirStatus"),se=Le("smartirEnabled"),fe=X(()=>{var $;return localStorage.getItem("smartir_simulate_not_installed")==="true"||!(se!=null&&se.value)?!1:(($=N==null?void 0:N.value)==null?void 0:$.installed)||!1}),Re=X(()=>{const E=new Map;return c.devices.forEach($=>{if($.broadlink_entity){const A=T.value.find(le=>le.entity_id===$.broadlink_entity),U=A&&A.name||$.broadlink_entity;E.set($.broadlink_entity,{entity_id:$.broadlink_entity,friendly_name:U})}}),Array.from(E.values()).sort(($,A)=>$.friendly_name.localeCompare(A.friendly_name))}),Oe=X(()=>{const E=new Set;return c.devices.forEach($=>{$.area&&E.add($.area)}),Array.from(E).sort()}),Ae=X(()=>{let E=c.devices;if(z.value.search){const A=z.value.search.toLowerCase();E=E.filter(U=>{var ye,pe,we,je,Be;if((ye=U.name)!=null&&ye.toLowerCase().includes(A)||(pe=U.entity_type)!=null&&pe.toLowerCase().includes(A)||(we=U.area)!=null&&we.toLowerCase().includes(A)||(je=U.id)!=null&&je.toLowerCase().includes(A)||Object.keys(U.commands||{}).some(Fe=>Fe.toLowerCase().includes(A)))return!0;const ve=T.value.find(Fe=>Fe.entity_id===U.broadlink_entity);return!!((Be=ve==null?void 0:ve.name)!=null&&Be.toLowerCase().includes(A))})}z.value.broadlinkDevice&&(E=E.filter(A=>A.broadlink_entity===z.value.broadlinkDevice||A.controller_device===z.value.broadlinkDevice)),z.value.area&&(E=E.filter(A=>A.area===z.value.area)),z.value.entityType&&(E=E.filter(A=>A.entity_type===z.value.entityType)),z.value.showSmartIROnly&&(E=E.filter(A=>A.device_type==="smartir"));const $=localStorage.getItem("smartir_simulate_not_installed")==="true";return(!(se!=null&&se.value)||$)&&(E=E.filter(A=>A.device_type!=="smartir")),E}),De=X(()=>z.value.search||z.value.broadlinkDevice||z.value.area||z.value.entityType||z.value.showSmartIROnly),Y=X(()=>{let E=0;return z.value.search&&E++,z.value.broadlinkDevice&&E++,z.value.area&&E++,z.value.entityType&&E++,z.value.showSmartIROnly&&E++,E}),M=E=>{E.target.closest(".settings-container")||(S.value=!1)};Ee(()=>{document.addEventListener("click",M)}),qe(()=>{document.removeEventListener("click",M)});const te=()=>{z.value.search="",z.value.broadlinkDevice="",z.value.area="",z.value.entityType="",z.value.showSmartIROnly=!1},H=()=>{L.value&&L.value.openDiscovery()},j=async()=>{try{const E=await oe.get("/api/remote/devices");T.value=E.data.devices||[]}catch(E){console.error("Error loading remote devices:",E)}};ue(R,E=>{localStorage.setItem("device_view_mode",E)});const K=async()=>{var E;try{const $=await oe.get("/api/devices/discover");q.value=((E=$.data.untracked_devices)==null?void 0:E.length)||0}catch($){console.error("Error loading untracked count:",$),q.value=0}};Ee(async()=>{await Promise.all([c.loadDevices(),j(),K()])});const ce=E=>{m.value=E,w.value=!0},Pe=X(()=>{if(!_.value)return"";const E=Object.keys(_.value.commands||{}).length;return E===0?"This device has no commands. The device will be removed from tracking.":`This device has ${E} learned command${E>1?"s":""}. What would you like to do?`}),Te=X(()=>{if(!_.value)return"";const E=Object.keys(_.value.commands||{}).length;return E===0?"":`Also delete all ${E} command${E>1?"s":""} from Broadlink storage`}),ee=E=>{_.value=E,f.value=!0},y=()=>{f.value=!1,_.value=null},u=async E=>{var A,U;const $=_.value;f.value=!1;try{await c.deleteDevice($.id,E),L.value&&await L.value.refresh()}catch(le){const ve=((U=(A=le.response)==null?void 0:A.data)==null?void 0:U.error)||le.message||"Unknown error";ae("Failed to Delete Device",ve)}finally{_.value=null}},l=async E=>{var $,A,U,le,ve;try{console.log("ğŸ’¾ Saving device data:",E),console.log("ğŸ’¾ Device commands:",E.commands),console.log("ğŸ’¾ Selected device:",m.value),($=m.value)!=null&&$.id&&m.value.id!==null?await c.updateDevice(m.value.id,E):await c.createDevice(E),B(),L.value&&await L.value.refresh()}catch(ye){let pe="Failed to save device",we="",je="";(U=(A=ye.response)==null?void 0:A.data)!=null&&U.error?(pe=ye.response.data.error,we=ye.response.data.suggestion||""):ye.message&&(pe=ye.message),ye.response&&(je=`Status: ${ye.response.status}
URL: ${((le=ye.config)==null?void 0:le.url)||"N/A"}`),ae("Failed to Save Device",pe,we,je,ye,{action:"save_device",deviceData:E,isEdit:!!((ve=m.value)!=null&&ve.id)})}},B=()=>{w.value=!1,m.value=null},Q=E=>{m.value=E,s.value=!0},re=()=>{s.value=!1,m.value=null},ae=(E,$,A="",U="",le=null,ve={})=>{P.value={title:E,message:$,suggestion:A,details:U,error:le,context:ve},b.value=!0},Ce=()=>{b.value=!1},ge=()=>{p.value=!1},_e=async E=>{var $;if(console.log("ğŸŸ¢ [PARENT] Received learned event:",E),!E||!E.deviceId){console.warn("âš ï¸ [PARENT] Missing required data in learned event");return}if(console.log("ğŸŸ¢ [PARENT] Current selectedDevice commands:",Object.keys((($=m.value)==null?void 0:$.commands)||{}).length),console.log("ğŸŸ¢ [PARENT] Current store device count:",c.devices.length),console.log("ğŸŸ¢ [PARENT] Force reloading all devices from API with cache bust..."),await c.loadDevices(!0),console.log("ğŸŸ¢ [PARENT] After reload - store device count:",c.devices.length),m.value){console.log("ğŸŸ¢ [PARENT] Looking for device:",E.deviceId);const A=c.devices.find(U=>U.id===E.deviceId);A?(console.log("ğŸŸ¢ [PARENT] Found fresh device with",Object.keys(A.commands||{}).length,"commands"),m.value={...A},console.log("ğŸŸ¢ [PARENT] âœ… Updated selectedDevice - now has",Object.keys(m.value.commands||{}).length,"commands")):console.error("ğŸŸ¢ [PARENT] âŒ Device not found in store after reload!")}L.value&&(console.log("ğŸŸ¢ [PARENT] Refreshing discovery..."),L.value.refresh()),console.log("ğŸŸ¢ [PARENT] âœ… handleCommandLearned complete!")},I=E=>{const $=E.split("_"),A=[];for(let U=0;U<$.length;U++){const le=$[U],ve=$[U+1];le&&ve==="s"&&$[U+2]?(A.push(le.charAt(0).toUpperCase()+le.slice(1)+"'s"),U++):le!=="s"&&A.push(le.charAt(0).toUpperCase()+le.slice(1))}return A.join(" ")},d=(E,$)=>{const A=E.toLowerCase(),U=$.map(pe=>pe.toLowerCase());return A.includes("lamp")||A.includes("light")?"light":A.includes("fan")?"fan":A.includes("tv")||A.includes("stereo")||A.includes("speaker")||A.includes("receiver")?"media_player":A.includes("blind")||A.includes("curtain")||A.includes("shade")||A.includes("garage")?"cover":U.some(pe=>pe.includes("volume")||pe.includes("channel")||pe.includes("play")||pe.includes("pause")||pe.includes("mute"))?"media_player":U.some(pe=>pe.includes("fan_speed")||pe.includes("fan_low")||pe.includes("fan_high"))?"fan":U.some(pe=>pe.includes("open")||pe.includes("close")||pe.includes("stop"))?"cover":"switch"},C=(E,$)=>{const A=E.toLowerCase();return A.includes("tv")?"mdi:television":A.includes("stereo")||A.includes("receiver")||A.includes("speaker")?"mdi:speaker":A.includes("lamp")?"mdi:lamp":A.includes("light")?"mdi:lightbulb":A.includes("fan")?"mdi:fan":A.includes("blind")?"mdi:blinds":A.includes("curtain")?"mdi:curtains":A.includes("garage")?"mdi:garage":{light:"mdi:lightbulb",fan:"mdi:fan",switch:"mdi:light-switch",media_player:"mdi:speaker",cover:"mdi:window-shutter"}[$]||"mdi:devices"},J=E=>{const $=E.toLowerCase().split("_");for(let le=0;le<$.length-2;le++)if($[le+1]==="s"){const ve=$.slice(le,le+3),ye=I(ve.join("_"));return console.log("Detected possessive area:",ye,"from",E),ye}const A=[["living","room"],["dining","room"],["master","bedroom"],["guest","bedroom"],["family","room"],["laundry","room"],["home","office"]];for(let le=0;le<$.length-1;le++){const ve=[$[le],$[le+1]],ye=A.find(pe=>pe[0]===ve[0]&&pe[1]===ve[1]);if(ye)return I(ye.join("_"))}const U=["kitchen","bedroom","bathroom","garage","office","basement","attic","hallway","entryway","patio","deck","yard","garden"];for(const le of $)if(U.includes(le))return le.charAt(0).toUpperCase()+le.slice(1);return""},de=async E=>{var $,A;try{const U=I(E.device_name),le=J(E.device_name),ve=d(E.device_name,E.commands),ye=C(E.device_name,ve);let pe="";try{console.log("Finding Broadlink owner for:",E.device_name);const Fe=await oe.post("/api/devices/find-broadlink-owner",{device_name:E.device_name});console.log("Broadlink owner response:",Fe.data),pe=Fe.data.broadlink_entity||"",console.log("Detected Broadlink entity:",pe)}catch(Fe){console.error("Error finding Broadlink owner:",Fe)}console.log("Fetching command data from Broadlink storage...");const je=(await oe.get(`/api/commands/broadlink/${E.device_name}`)).data.commands||{};console.log("Fetched command data:",je);const Be={};for(const[Fe,et]of Object.entries(je)){const mt=typeof et=="string"&&et.length>200;Be[Fe]={data:et,type:mt?"rf":"ir",name:Fe,learned_at:new Date().toISOString()}}console.log("Transformed commands:",Be),m.value={id:null,device:E.device_name,name:U,entity_type:ve,commands:Be,area:le,icon:ye,broadlink_entity:pe,enabled:!0},w.value=!0,i.success(`Imported ${Object.keys(Be).length} commands from Broadlink storage`),await K()}catch(U){console.error("Error adopting device:",U),i.error("Failed to adopt device: "+(((A=($=U.response)==null?void 0:$.data)==null?void 0:A.error)||U.message))}},xe=async()=>{V.value=!0;try{await c.syncAllAreas(),i.success("Areas synced from Home Assistant")}catch(E){console.error("Error syncing areas:",E),i.error("Failed to sync areas")}finally{V.value=!1}},ie=async()=>{var E,$;n.value=!0;try{const A=await oe.post("/api/entities/generate",{});if(A.data.success){const U=A.data.broadlink_count||0,le=A.data.smartir_count||0,ve=A.data.total_count||0,ye=A.data.errors||[];let pe="âœ… Entity Generation Successful",we=[];const je=[];U>0&&je.push(`${U} Broadlink native`),le>0&&je.push(`${le} SmartIR`),je.length>0&&we.push(`Generated ${je.join(" and ")} entity configuration${ve!==1?"s":""}.`),U>0&&(we.push(`
ğŸ“ Broadlink entities created in:`),we.push("  â€¢ broadlink_manager/package.yaml")),le>0&&(we.push(`
ğŸ“ SmartIR entities created in:`),we.push("  â€¢ smartir/climate.yaml"),we.push("  â€¢ smartir/media_player.yaml"),we.push("  â€¢ smartir/fan.yaml")),we.push(`
ğŸ“ Next steps:`),we.push("1. Add to configuration.yaml:"),we.push("   homeassistant:"),we.push("     packages:"),we.push("       broadlink_manager: !include broadlink_manager/package.yaml"),we.push("2. Restart Home Assistant to load the new entities"),ye.length>0&&(pe="âš ï¸ Entity Generation Completed with Errors",we.push(`
âš ï¸ ${ye.length} error${ye.length!==1?"s":""} occurred:`),ye.forEach(Be=>{we.push(`  â€¢ ${Be}`)})),Z.value={success:!0,title:pe,message:we.join(`
`)},p.value=!0}else Z.value={success:!1,title:"âŒ Entity Generation Failed",message:A.data.message||`Failed to generate entities.

Please check that you have at least one device configured.`},p.value=!0}catch(A){console.error("Error generating entities:",A);const U=(($=(E=A.response)==null?void 0:E.data)==null?void 0:$.error)||A.message||"Unknown error occurred";Z.value={success:!1,title:"âŒ Entity Generation Error",message:`Failed to generate entities:

${U}

Please check the logs for more details.`},p.value=!0}finally{n.value=!1}},Ue=async({device:E,command:$})=>{var A,U;try{const le={device_id:E.id,command:$,device:E.device||E.id,entity_id:E.broadlink_entity||E.controller_device};await oe.post("/api/commands/test",le),i.success(`Sent ${$} to ${E.name}`)}catch(le){console.error("Error sending command:",le);const ve=((U=(A=le.response)==null?void 0:A.data)==null?void 0:U.error)||le.message||"Unknown error";i.error(`Failed to send ${$}: ${ve}`)}};return(E,$)=>{var A;return a(),r("div",Ss,[e("div",Is,[e("button",{class:"icon-button chevron-button",onClick:D},[e("i",{class:G(["mdi",k.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2)]),e("div",{class:"header-left",onClick:D},[$[15]||($[15]=e("div",{class:"header-icon"},[e("i",{class:"mdi mdi-devices"})],-1)),e("h3",null,v(Ie(h)?"Devices":"Managed Devices"),1),e("div",Ds,[e("span",xs,v(Ie(c).deviceCount)+" devices",1),q.value>0?(a(),r("span",{key:0,class:"header-info untracked-badge",title:`${q.value} device${q.value>1?"s":""} with learned commands found in Broadlink storage. Use the settings menu (âš™ï¸) to view and adopt them.`},v(q.value)+" untracked ",9,Ts)):O("",!0)])]),e("div",Ms,[Ie(h)?O("",!0):(a(),r("div",Rs,[e("button",{onClick:$[0]||($[0]=be(U=>R.value="grid",["stop"])),class:G(["view-toggle-btn",{active:R.value==="grid"}]),title:"Grid View"},[...$[16]||($[16]=[e("i",{class:"mdi mdi-view-grid"},null,-1)])],2),e("button",{onClick:$[1]||($[1]=be(U=>R.value="list",["stop"])),class:G(["view-toggle-btn",{active:R.value==="list"}]),title:"List View"},[...$[17]||($[17]=[e("i",{class:"mdi mdi-view-list"},null,-1)])],2)])),e("button",{onClick:$[2]||($[2]=be(U=>w.value=!0,["stop"])),class:"btn btn-primary new-button"},[...$[18]||($[18]=[e("i",{class:"mdi mdi-plus"},null,-1),e("span",null,"New",-1)])]),e("div",Es,[e("button",{onClick:be(o,["stop"]),class:G(["icon-button settings-button",{active:S.value}]),title:"Settings"},[...$[19]||($[19]=[e("i",{class:"mdi mdi-cog"},null,-1)])],2),S.value?(a(),r("div",{key:0,class:"settings-dropdown",onClick:$[6]||($[6]=be(()=>{},["stop"]))},[e("button",{onClick:$[3]||($[3]=U=>{H(),S.value=!1}),class:"menu-item"},[...$[20]||($[20]=[e("i",{class:"mdi mdi-radar"},null,-1),e("span",null,"Untracked Devices",-1)])]),e("button",{onClick:$[4]||($[4]=U=>{xe(),S.value=!1}),class:"menu-item",disabled:V.value},[e("i",{class:G(["mdi",V.value?"mdi-loading mdi-spin":"mdi-refresh"])},null,2),e("span",null,v(V.value?"Syncing Areas...":"Sync Areas"),1)],8,Os),e("button",{onClick:$[5]||($[5]=U=>{ie(),S.value=!1}),class:"menu-item",disabled:n.value},[e("i",{class:G(["mdi",n.value?"mdi-loading mdi-spin":"mdi-file-code"])},null,2),e("span",null,v(n.value?"Generating...":"Generate Entities"),1)],8,As)])):O("",!0)])])]),W(e("div",Ls,[ke(_s,{ref_key:"discoveryRef",ref:L,onAdopt:de},null,512),Ie(c).hasDevices?(a(),r("div",Ps,[e("div",Vs,[e("button",{class:G(["filter-toggle-button",{active:ne.value||De.value}]),onClick:$[7]||($[7]=U=>ne.value=!ne.value),title:ne.value?"Hide filters":"Show filters"},[$[21]||($[21]=e("i",{class:"mdi mdi-filter-variant"},null,-1)),De.value?(a(),r("span",Us,v(Y.value),1)):O("",!0)],10,js),e("div",Fs,[$[22]||($[22]=e("i",{class:"mdi mdi-magnify search-icon"},null,-1)),W(e("input",{"onUpdate:modelValue":$[8]||($[8]=U=>z.value.search=U),type:"text",placeholder:"Search devices, commands...",class:"search-input"},null,512),[[Ve,z.value.search]])])]),W(e("div",Ns,[e("div",Bs,[e("div",Hs,[e("label",null,[$[24]||($[24]=e("i",{class:"mdi mdi-access-point"},null,-1)),W(e("select",{"onUpdate:modelValue":$[9]||($[9]=U=>z.value.broadlinkDevice=U)},[$[23]||($[23]=e("option",{value:""},"All Controller Devices",-1)),(a(!0),r(he,null,$e(Re.value,U=>(a(),r("option",{key:U.entity_id,value:U.entity_id},v(U.friendly_name),9,qs))),128))],512),[[Me,z.value.broadlinkDevice]])])]),e("div",zs,[e("label",null,[$[26]||($[26]=e("i",{class:"mdi mdi-home-map-marker"},null,-1)),W(e("select",{"onUpdate:modelValue":$[10]||($[10]=U=>z.value.area=U)},[$[25]||($[25]=e("option",{value:""},"All Areas",-1)),(a(!0),r(he,null,$e(Oe.value,U=>(a(),r("option",{key:U,value:U},v(U),9,Js))),128))],512),[[Me,z.value.area]])])]),e("div",Ws,[e("label",null,[$[28]||($[28]=e("i",{class:"mdi mdi-shape"},null,-1)),W(e("select",{"onUpdate:modelValue":$[11]||($[11]=U=>z.value.entityType=U)},[...$[27]||($[27]=[ze('<option value="" data-v-12a1d608>All Types</option><option value="light" data-v-12a1d608>Light</option><option value="fan" data-v-12a1d608>Fan</option><option value="switch" data-v-12a1d608>Switch</option><option value="media_player" data-v-12a1d608>Media Player</option><option value="cover" data-v-12a1d608>Cover</option><option value="climate" data-v-12a1d608>Climate</option>',7)])],512),[[Me,z.value.entityType]])])]),fe.value?(a(),r("div",Gs,[e("label",Ks,[$[29]||($[29]=e("span",{class:"toggle-text"},[e("img",{src:Qe,alt:"SmartIR",class:"smartir-icon"}),x(" SmartIR Only ")],-1)),W(e("input",{type:"checkbox","onUpdate:modelValue":$[12]||($[12]=U=>z.value.showSmartIROnly=U),class:"toggle-checkbox"},null,512),[[me,z.value.showSmartIROnly]]),$[30]||($[30]=e("span",{class:"toggle-slider"},null,-1))])])):O("",!0),De.value?(a(),r("button",{key:1,onClick:te,class:"btn-clear-filters"},[...$[31]||($[31]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),x(" Clear ",-1)])])):O("",!0),e("div",Xs,v(Ae.value.length)+" of "+v(Ie(c).deviceCount),1)])],512),[[Ye,ne.value]])])):O("",!0),Ie(c).loading?(a(),r("div",Ys,[...$[32]||($[32]=[e("i",{class:"mdi mdi-loading mdi-spin"},null,-1),e("p",null,"Loading devices...",-1)])])):Ie(c).error?(a(),r("div",Zs,[$[33]||($[33]=e("i",{class:"mdi mdi-alert-circle"},null,-1)),e("p",null,v(Ie(c).error),1),e("button",{onClick:$[13]||($[13]=U=>Ie(c).loadDevices()),class:"btn btn-secondary"}," Retry ")])):Ie(c).hasDevices?O("",!0):(a(),r("div",Qs,[$[35]||($[35]=e("i",{class:"mdi mdi-devices"},null,-1)),$[36]||($[36]=e("h3",null,"No Devices Yet",-1)),$[37]||($[37]=e("p",null,"Get started by adding your first managed device",-1)),e("button",{onClick:$[14]||($[14]=U=>w.value=!0),class:"btn btn-primary"},[...$[34]||($[34]=[e("i",{class:"mdi mdi-plus"},null,-1),x(" Add Your First Device ",-1)])])])),R.value==="grid"?(a(),r("div",ea,[(a(!0),r(he,null,$e(Ae.value,U=>(a(),Ne(Bt,{key:U.id,device:U,"broadlink-devices":T.value,onEdit:ce,onDelete:ee,onLearn:Q},null,8,["device","broadlink-devices"]))),128))])):R.value==="list"&&Ae.value.length>0?(a(),Ne(uo,{key:5,devices:Ae.value,onSendCommand:Ue,onOpenCommands:Q,onEditDevice:ce,onDeleteDevice:ee},null,8,["devices"])):O("",!0),Ie(c).hasDevices&&Ae.value.length===0?(a(),r("div",ta,[...$[38]||($[38]=[e("i",{class:"mdi mdi-filter-off"},null,-1),e("h3",null,"No devices match your filters",-1),e("p",null,"Try adjusting your search or filter criteria",-1)])])):O("",!0)],512),[[Ye,k.value]]),w.value?(a(),Ne(jl,{key:0,device:m.value,onSave:l,onCancel:B},null,8,["device"])):O("",!0),s.value?(a(),Ne(Jn,{key:1,device:m.value,onLearned:_e,onCancel:re},null,8,["device"])):O("",!0),ke(He,{isOpen:f.value,title:`Delete ${(A=_.value)==null?void 0:A.name}?`,message:Pe.value,confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,checkboxLabel:Te.value,onConfirm:u,onCancel:y},null,8,["isOpen","title","message","checkboxLabel"]),ke(ns,{isOpen:b.value,title:P.value.title,message:P.value.message,suggestion:P.value.suggestion,details:P.value.details,error:P.value.error,context:P.value.context,onClose:Ce},null,8,["isOpen","title","message","suggestion","details","error","context"]),ke(He,{isOpen:p.value,title:Z.value.title,message:Z.value.message,confirmText:"OK",showCancel:!1,dangerMode:!Z.value.success,onConfirm:ge,onCancel:ge},null,8,["isOpen","title","message","dangerMode"])])}}},la=Se(oa,[["__scopeId","data-v-12a1d608"]]),na={class:"banner-content"},sa={class:"banner-icon"},aa={class:"banner-message"},ia={class:"banner-actions"},ra={__name:"SmartIRBanner",setup(t){const c=Le("smartirStatus"),i=g(!1),h=X(()=>!(!c.value||i.value||localStorage.getItem("smartir_banner_dismissed")==="true")),w=X(()=>{var L;return(L=c.value)!=null&&L.installed?"banner-success":"banner-info"}),s=X(()=>{var L;return(L=c.value)!=null&&L.installed?"mdi mdi-check-circle":"mdi mdi-information"}),m=X(()=>{var L;return(L=c.value)!=null&&L.installed?`SmartIR Detected (v${c.value.version})`:"Want Climate Device Support?"}),f=X(()=>{var L;return(L=c.value)!=null&&L.installed?"You can now create climate device profiles with full temperature and HVAC mode control.":"Install SmartIR to unlock AC/heater control with temperature settings, HVAC modes, and 120+ pre-configured device profiles."});function S(){window.open("https://github.com/smartHomeHub/SmartIR","_blank")}function _(){var L;if(i.value=!0,(L=c.value)!=null&&L.installed)localStorage.setItem("smartir_banner_dismissed","true");else{const k=parseInt(localStorage.getItem("smartir_banner_dismiss_count")||"0");k>=2?localStorage.setItem("smartir_banner_dismissed","true"):localStorage.setItem("smartir_banner_dismiss_count",String(k+1))}}return Ee(()=>{var n;const L=localStorage.getItem("smartir_last_status"),k=(n=c.value)!=null&&n.installed?"installed":"not_installed";L!==k&&(localStorage.removeItem("smartir_banner_dismissed"),localStorage.removeItem("smartir_banner_dismiss_count"),localStorage.setItem("smartir_last_status",k))}),(L,k)=>{var n,V;return h.value?(a(),r("div",{key:0,class:G(["smartir-banner",w.value])},[e("div",na,[e("div",sa,[e("i",{class:G(s.value)},null,2)]),e("div",aa,[e("strong",null,v(m.value),1),e("p",null,v(f.value),1)]),e("div",ia,[(n=L.status)!=null&&n.installed?O("",!0):(a(),r("button",{key:0,onClick:S,class:"btn-primary"}," Learn More ")),e("button",{onClick:_,class:"btn-text"},v((V=L.status)!=null&&V.installed?"Got it":"Dismiss"),1)])])],2)):O("",!0)}}},da=Se(ra,[["__scopeId","data-v-7bbcbcd7"]]),We="api/smartir",ut={async getStatus(){try{const t=await fetch(`${We}/status`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return await t.json()}catch(t){return console.error("Error fetching SmartIR status:",t),{installed:!1,version:null,error:t.message}}},async getInstallInstructions(){try{const t=await fetch(`${We}/install-instructions`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return await t.json()}catch(t){throw console.error("Error fetching install instructions:",t),t}},async getPlatforms(){try{const t=await fetch(`${We}/platforms`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return await t.json()}catch(t){throw console.error("Error fetching platforms:",t),t}},async getPlatformCodes(t){try{const c=await fetch(`${We}/platforms/${t}/codes`);if(!c.ok)throw new Error(`HTTP error! status: ${c.status}`);return await c.json()}catch(c){throw console.error(`Error fetching codes for ${t}:`,c),c}},async getNextCode(t){try{const c=await fetch(`${We}/platforms/${t}/next-code`);if(!c.ok)throw new Error(`HTTP error! status: ${c.status}`);return await c.json()}catch(c){throw console.error(`Error fetching next code for ${t}:`,c),c}},async validateCode(t,c){try{const i=await fetch(`${We}/validate-code`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({platform:t,code:c})});if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);return await i.json()}catch(i){throw console.error("Error validating code:",i),i}}},ua={class:"profile-card"},ca={class:"profile-card-header"},ma=["title"],va={class:"profile-details"},pa=["title"],fa={class:"profile-meta"},ga=["title"],ya=["title"],ba=["title"],ha={class:"profile-card-footer"},ka=["title"],wa={key:0,class:"learned-indicator"},$a={class:"profile-actions"},Ca={__name:"SmartIRProfileCard",props:{profile:{type:Object,required:!0}},emits:["edit","download","delete","commands"],setup(t){const c=t,i=rt(X(()=>c.profile.platform)),h=m=>m.replace(/_/g," ").replace(/\b\w/g,f=>f.toUpperCase()),w=m=>m&&m.startsWith("mdi:")?`mdi ${m.replace(":"," mdi-")}`:`mdi mdi-${m}`,s=m=>{if(!m)return"";const f=m.toLowerCase();return f.includes("broadlink")?"broadlink-tag":f.includes("not set")?"not-set-tag":"default-controller-tag"};return(m,f)=>(a(),r("div",ua,[e("div",ca,[e("div",{class:G(["profile-icon",Ie(i).colorClass.value]),title:h(t.profile.platform)},[e("i",{class:G(w(Ie(i).icon.value))},null,2)],10,ma),e("div",va,[e("h4",{title:`${t.profile.manufacturer} ${t.profile.model}`},v(t.profile.manufacturer)+" "+v(t.profile.model),9,pa),e("div",fa,[e("span",{class:"tag platform-tag",title:h(t.profile.platform)},v(h(t.profile.platform)),9,ga),t.profile.controllerBrand?(a(),r("span",{key:0,class:G(["tag controller-tag",s(t.profile.controllerBrand)]),title:"Controller: "+t.profile.controllerBrand},[f[4]||(f[4]=e("i",{class:"mdi mdi-remote-tv"},null,-1)),x(" "+v(t.profile.controllerBrand),1)],10,ya)):O("",!0)])]),e("div",{class:"code-badge",title:"Device Code: "+t.profile.code},v(t.profile.code),9,ba)]),e("div",ha,[e("div",{class:"profile-stats",title:t.profile.commandCount+" total commands"+(t.profile.learnedCount>0?", "+t.profile.learnedCount+" learned":"")},[f[5]||(f[5]=e("i",{class:"mdi mdi-remote"},null,-1)),e("span",null,v(t.profile.commandCount)+" command"+v(t.profile.commandCount!==1?"s":""),1),t.profile.learnedCount>0?(a(),r("span",wa,"( "+v(t.profile.learnedCount)+" learned )",1)):O("",!0)],8,ka),e("div",$a,[e("button",{onClick:f[0]||(f[0]=S=>m.$emit("commands")),class:"action-btn",title:"Commands"},[...f[6]||(f[6]=[e("i",{class:"mdi mdi-remote"},null,-1)])]),e("button",{onClick:f[1]||(f[1]=S=>m.$emit("edit")),class:"action-btn",title:"Edit Profile"},[...f[7]||(f[7]=[e("i",{class:"mdi mdi-pencil"},null,-1)])]),e("button",{onClick:f[2]||(f[2]=S=>m.$emit("download")),class:"action-btn",title:"Download JSON"},[...f[8]||(f[8]=[e("i",{class:"mdi mdi-download"},null,-1)])]),e("button",{onClick:f[3]||(f[3]=S=>m.$emit("delete")),class:"action-btn delete",title:"Delete Profile"},[...f[9]||(f[9]=[e("i",{class:"mdi mdi-delete"},null,-1)])])])])]))}},_a=Se(Ca,[["__scopeId","data-v-aad9720f"]]),Sa={name:"SmartIRProfileListView",props:{profiles:{type:Array,required:!0}},methods:{getPlatformIcon(t){return{climate:"mdi-thermostat",media_player:"mdi-television",fan:"mdi-fan",light:"mdi-lightbulb"}[t]||"mdi-devices"},formatPlatform(t){return{climate:"Climate",media_player:"Media Player",fan:"Fan",light:"Light"}[t]||t},editProfile(t){this.$emit("edit",t)},viewCommands(t){this.$emit("commands",t)},downloadProfile(t){this.$emit("download",t)},deleteProfile(t){this.$emit("delete",t)}}},Ia={class:"profile-list-view"},Da={class:"profile-table"},xa={class:"profile-code"},Ta={class:"code-badge"},Ma={class:"profile-manufacturer"},Ra={class:"profile-model"},Ea={class:"model-info"},Oa={class:"model-name"},Aa={key:0,class:"model-count"},La={class:"profile-platform"},Pa={class:"profile-controller"},Va={class:"profile-commands"},ja={class:"command-stats"},Ua={class:"stat-item"},Fa={key:0,class:"stat-item learned"},Na={class:"profile-actions"},Ba=["onClick"],Ha=["onClick"],qa=["onClick"],za=["onClick"];function Ja(t,c,i,h,w,s){return a(),r("div",Ia,[e("table",Da,[c[6]||(c[6]=e("thead",null,[e("tr",null,[e("th",null,"Code"),e("th",null,"Manufacturer"),e("th",null,"Model"),e("th",null,"Platform"),e("th",null,"Controller"),e("th",null,"Commands"),e("th",null,"Actions")])],-1)),e("tbody",null,[(a(!0),r(he,null,$e(i.profiles,m=>(a(),r("tr",{key:`${m.platform}-${m.code}`,class:"profile-row"},[e("td",xa,[e("span",Ta,v(m.code),1)]),e("td",Ma,v(m.manufacturer||"Unknown"),1),e("td",Ra,[e("div",Ea,[e("div",Oa,v(m.model||"Unknown"),1),m.models&&m.models.length>1?(a(),r("div",Aa," +"+v(m.models.length-1)+" more ",1)):O("",!0)])]),e("td",La,[e("span",{class:G(["platform-badge",m.platform])},[e("i",{class:G(["mdi",s.getPlatformIcon(m.platform)])},null,2),x(" "+v(s.formatPlatform(m.platform)),1)],2)]),e("td",Pa,v(m.controller_brand||"N/A"),1),e("td",Va,[e("div",ja,[e("span",Ua,[c[0]||(c[0]=e("i",{class:"mdi mdi-remote"},null,-1)),x(" "+v(m.command_count||0),1)]),m.learned_count>0?(a(),r("span",Fa,[c[1]||(c[1]=e("i",{class:"mdi mdi-school"},null,-1)),x(" "+v(m.learned_count),1)])):O("",!0)])]),e("td",Na,[e("button",{class:"action-btn edit",onClick:f=>s.editProfile(m),title:"Edit Profile"},[...c[2]||(c[2]=[e("i",{class:"mdi mdi-pencil"},null,-1)])],8,Ba),e("button",{class:"action-btn commands",onClick:f=>s.viewCommands(m),title:"View Commands"},[...c[3]||(c[3]=[e("i",{class:"mdi mdi-remote"},null,-1)])],8,Ha),e("button",{class:"action-btn download",onClick:f=>s.downloadProfile(m),title:"Download"},[...c[4]||(c[4]=[e("i",{class:"mdi mdi-download"},null,-1)])],8,qa),e("button",{class:"action-btn delete",onClick:f=>s.deleteProfile(m),title:"Delete"},[...c[5]||(c[5]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,za)])]))),128))])])])}const Wa=Se(Sa,[["render",Ja],["__scopeId","data-v-d3773038"]]),Ga={class:"modal-container"},Ka={class:"modal-body"},Xa={key:0,class:"selection-section"},Ya={class:"form-group"},Za={class:"form-group"},Qa={class:"form-group"},ei={key:0,class:"code-info"},ti={class:"form-actions"},oi=["disabled"],li={key:1,class:"testing-section"},ni={class:"code-header"},si={class:"code-details"},ai={class:"code-badge"},ii={class:"device-selector"},ri=["value"],di={key:0,class:"helper-text"},ui={class:"commands-section"},ci={class:"commands-header"},mi={key:0,class:"tested-count"},vi={key:0,class:"filters-section"},pi={class:"filter-row"},fi={class:"filter-row"},gi={key:1,class:"empty-state"},yi={key:2,class:"empty-state"},bi={key:3,class:"commands-list"},hi={class:"command-name"},ki={class:"command-actions"},wi={key:0,class:"status-badge success"},$i=["onClick","disabled","title"],Ci={__name:"SmartIRCodeTester",props:{isOpen:{type:Boolean,default:!1}},emits:["close","clone"],setup(t,{emit:c}){const i=t,h=c,w=Le("toast"),s=g("climate"),m=g(""),f=g([]),S=g(!1),_=g(null),L=g(""),k=g([]),n=g(!1),V=X(()=>k.value.map(ee=>({code:ee.code,label:`${ee.models.join(", ")} (Code: ${ee.code})`,value:ee.code}))),q=g(null),F=g(null),R=g(!1),D=g([]),o=g(""),b=g([]),P=g(new Set),p=g(null),Z=g(""),ne=g(""),z=g(""),T=g(""),N=X(()=>{let ee=b.value;if(Z.value){const y=Z.value.toLowerCase();ee=ee.filter(u=>(u.label||u.name).toLowerCase().includes(y))}return ne.value&&(ee=ee.filter(y=>y.mode===ne.value)),z.value&&(ee=ee.filter(y=>y.fanSpeed===z.value)),T.value&&(ee=ee.filter(y=>y.swingMode===T.value)),ee}),se=X(()=>Z.value||ne.value||z.value||T.value);ue(()=>i.isOpen,ee=>{ee&&(fe(),Oe())}),ue(s,()=>{i.isOpen&&(m.value="",_.value=null,k.value=[],fe())});async function fe(){var ee;S.value=!0;try{const y=await oe.get("/api/smartir/codes/manufacturers",{params:{entity_type:s.value}});f.value=y.data.manufacturers||[]}catch(y){console.error("Error loading manufacturers:",y),(ee=w.value)==null||ee.error("Failed to load manufacturers","âŒ Error")}finally{S.value=!1}}async function Re(){var ee;if(m.value){n.value=!0;try{const y=await oe.get("/api/smartir/codes/models",{params:{entity_type:s.value,manufacturer:m.value}});k.value=y.data.models||[]}catch(y){console.error("Error loading models:",y),(ee=w.value)==null||ee.error("Failed to load models","âŒ Error")}finally{n.value=!1}}}async function Oe(){try{const ee=await oe.get("/api/remote/devices");D.value=ee.data.devices||[]}catch(ee){console.error("Error loading Broadlink devices:",ee)}}async function Ae(){var ee,y;if(_.value){R.value=!0;try{const u=await oe.get("/api/smartir/codes/code",{params:{entity_type:s.value,code_id:_.value.code}});F.value=u.data.code,q.value=_.value.code,De(u.data.code),(ee=w.value)==null||ee.success(`Loaded ${b.value.length} commands`,"âœ… Code Loaded")}catch(u){console.error("Error loading code:",u),(y=w.value)==null||y.error(u.message||"Failed to load code","âŒ Error")}finally{R.value=!1}}}function De(ee){const y=[];if(!ee.commands){b.value=y;return}if(s.value==="climate"){const l=ee.commands;for(const[B,Q]of Object.entries(l)){if(B==="off"){typeof Q=="string"&&y.push({name:"off",label:"OFF",data:Q,mode:"off"});continue}if(typeof Q=="object"){for(const[re,ae]of Object.entries(Q))if(typeof ae=="object")for(const[Ce,ge]of Object.entries(ae)){if(typeof ge!="object")continue;const _e=Object.keys(ge),I=_e.includes("24")?"24":_e[0];if(I&&typeof ge[I]=="string"){const d=`${B}_${I}_${re}_${Ce}`,C=`${B.toUpperCase()} ${I}Â°C ${re} ${Ce}`;y.push({name:d,label:C,data:ge[I],mode:B,temperature:I,fanSpeed:re,swingMode:Ce})}}}}}else for(const[l,B]of Object.entries(ee.commands))typeof B=="string"&&y.push({name:l,label:l.toUpperCase().replace(/_/g," "),data:B});b.value=y}async function Y(ee){var y,u,l;if(!o.value){(y=w.value)==null||y.warning("Please select a Broadlink device first","âš ï¸ No Device");return}p.value=ee;try{const B=b.value.find(Q=>Q.name===ee);if(!B||!B.data)throw new Error(`Command "${ee}" not found`);await oe.post("/api/commands/send-raw",{entity_id:o.value,command:B.data,command_type:"ir"}),P.value.add(ee),(u=w.value)==null||u.success(`Command sent: ${B.label||ee}`,"âœ… Tested")}catch(B){console.error("Error testing command:",B),(l=w.value)==null||l.error("Failed to test command","âŒ Error")}finally{p.value=null}}function M(){var ee,y,u,l;if(!F.value){(ee=w.value)==null||ee.error("No profile data to download","âŒ Error");return}try{const B=F.value.manufacturer||"unknown",Q=((y=F.value.supportedModels)==null?void 0:y[0])||q.value,re=`${B.toLowerCase().replace(/\s+/g,"_")}_${Q.toLowerCase().replace(/\s+/g,"_")}.json`,ae=JSON.stringify(F.value,null,2),Ce=new Blob([ae],{type:"application/json"}),ge=URL.createObjectURL(Ce),_e=document.createElement("a");_e.href=ge,_e.download=re,document.body.appendChild(_e),_e.click(),document.body.removeChild(_e),URL.revokeObjectURL(ge),(u=w.value)==null||u.success(`Downloaded ${re}`,"âœ… Download Complete")}catch(B){console.error("Error downloading JSON:",B),(l=w.value)==null||l.error(B.message||"Failed to download JSON","âŒ Download Error")}}function te(){m.value="",_.value=null,L.value="",k.value=[]}function H(){_.value=null,L.value="",Re()}function j(){L.value?_.value=k.value.find(ee=>ee.code===L.value):_.value=null}function K(){Z.value="",ne.value="",z.value="",T.value=""}function ce(){q.value=null,F.value=null,b.value=[],P.value.clear(),p.value=null,K()}function Pe(ee){const y=ee.toLowerCase();return y.includes("power")||y.includes("off")||y==="off"?"mdi-power":y.includes("cool")?"mdi-snowflake":y.includes("heat")?"mdi-fire":y.includes("fan")?"mdi-fan":y.includes("auto")?"mdi-auto-fix":y.includes("dry")?"mdi-water-percent":y.includes("temp")?"mdi-thermometer":y.includes("swing")?"mdi-swap-vertical":"mdi-remote"}function Te(){ce(),m.value="",_.value=null,h("close")}return(ee,y)=>{var u;return t.isOpen?(a(),r("div",{key:0,class:"modal-overlay",onClick:be(Te,["self"])},[e("div",Ga,[e("div",{class:"modal-header"},[y[9]||(y[9]=e("h3",null,[e("i",{class:"mdi mdi-test-tube"}),x(" Test SmartIR Code ")],-1)),e("button",{onClick:Te,class:"close-btn"},[...y[8]||(y[8]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Ka,[q.value?(a(),r("div",li,[e("div",ni,[e("div",si,[e("h4",null,v(F.value.manufacturer)+" - "+v(((u=F.value.supportedModels)==null?void 0:u[0])||"Unknown"),1),e("span",ai,"Code: "+v(q.value),1)]),e("button",{onClick:ce,class:"btn-secondary-small"},[...y[14]||(y[14]=[e("i",{class:"mdi mdi-arrow-left"},null,-1),x(" Change Code ",-1)])])]),e("div",ii,[y[17]||(y[17]=e("label",null,[e("i",{class:"mdi mdi-remote"}),x(" Broadlink Device ")],-1)),W(e("select",{"onUpdate:modelValue":y[3]||(y[3]=l=>o.value=l),class:"form-select"},[y[15]||(y[15]=e("option",{value:""},"Select device to test with...",-1)),(a(!0),r(he,null,$e(D.value,l=>(a(),r("option",{key:l.entity_id,value:l.entity_id},v(l.friendly_name||l.entity_id),9,ri))),128))],512),[[Me,o.value]]),o.value?O("",!0):(a(),r("p",di,[...y[16]||(y[16]=[e("i",{class:"mdi mdi-information-outline"},null,-1),x(" Select a Broadlink device to enable command testing ",-1)])]))]),e("div",ui,[e("div",ci,[e("h5",null,"Sample Commands ("+v(N.value.length)+" / "+v(b.value.length)+")",1),P.value.size>0?(a(),r("span",mi,v(P.value.size)+" tested ",1)):O("",!0)]),s.value==="climate"&&b.value.length>0?(a(),r("div",vi,[e("div",pi,[W(e("input",{"onUpdate:modelValue":y[4]||(y[4]=l=>Z.value=l),type:"text",placeholder:"Search commands...",class:"search-input"},null,512),[[Ve,Z.value]])]),e("div",fi,[W(e("select",{"onUpdate:modelValue":y[5]||(y[5]=l=>ne.value=l),class:"filter-select"},[...y[18]||(y[18]=[e("option",{value:""},"All Modes",-1),e("option",{value:"cool"},"Cool",-1),e("option",{value:"heat"},"Heat",-1),e("option",{value:"off"},"Off",-1)])],512),[[Me,ne.value]]),W(e("select",{"onUpdate:modelValue":y[6]||(y[6]=l=>z.value=l),class:"filter-select"},[...y[19]||(y[19]=[ze('<option value="" data-v-66569200>All Fan Speeds</option><option value="low" data-v-66569200>Low</option><option value="mid" data-v-66569200>Mid</option><option value="high" data-v-66569200>High</option><option value="auto" data-v-66569200>Auto</option>',5)])],512),[[Me,z.value]]),W(e("select",{"onUpdate:modelValue":y[7]||(y[7]=l=>T.value=l),class:"filter-select"},[...y[20]||(y[20]=[e("option",{value:""},"All Swing",-1),e("option",{value:"stop"},"Stop",-1),e("option",{value:"swing"},"Swing",-1)])],512),[[Me,T.value]]),se.value?(a(),r("button",{key:0,onClick:K,class:"btn-clear-filters"},[...y[21]||(y[21]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),x(" Clear ",-1)])])):O("",!0)])])):O("",!0),b.value.length===0?(a(),r("div",gi,[...y[22]||(y[22]=[e("i",{class:"mdi mdi-alert-circle"},null,-1),e("p",null,"No commands found in this code",-1)])])):N.value.length===0?(a(),r("div",yi,[y[23]||(y[23]=e("i",{class:"mdi mdi-filter-off"},null,-1)),y[24]||(y[24]=e("p",null,"No commands match your filters",-1)),e("button",{onClick:K,class:"btn-secondary-small"}," Clear Filters ")])):(a(),r("div",bi,[(a(!0),r(he,null,$e(N.value,l=>(a(),r("div",{key:l.name,class:G(["command-item",{tested:P.value.has(l.name),testing:p.value===l.name}])},[e("div",hi,[e("i",{class:G(["mdi",Pe(l.mode||l.name)])},null,2),e("span",null,v(l.label||l.name),1)]),e("div",ki,[P.value.has(l.name)?(a(),r("span",wi,[...y[25]||(y[25]=[e("i",{class:"mdi mdi-check"},null,-1),x(" Tested ",-1)])])):O("",!0),e("button",{onClick:B=>Y(l.name),disabled:!o.value||p.value===l.name,title:o.value?"Test this command":"Select a Broadlink device first",class:"btn-test"},[e("i",{class:G(["mdi",p.value===l.name?"mdi-loading mdi-spin":"mdi-play"])},null,2),y[26]||(y[26]=x(" Test ",-1))],8,$i)])],2))),128))]))]),e("div",{class:"modal-actions"},[e("button",{onClick:M,class:"btn-primary"},[...y[27]||(y[27]=[e("i",{class:"mdi mdi-download"},null,-1),x(" Download JSON ",-1)])]),e("button",{onClick:Te,class:"btn-secondary"}," Close ")])])):(a(),r("div",Xa,[y[13]||(y[13]=e("div",{class:"info-banner"},[e("i",{class:"mdi mdi-information"}),e("p",null,"Select a SmartIR code from the index to test commands with your Broadlink device.")],-1)),e("div",Ya,[y[11]||(y[11]=e("label",null,[e("i",{class:"mdi mdi-shape"}),x(" Platform ")],-1)),W(e("select",{"onUpdate:modelValue":y[0]||(y[0]=l=>s.value=l),onChange:te,class:"form-select"},[...y[10]||(y[10]=[e("option",{value:"climate"},"Climate (AC/Heater)",-1),e("option",{value:"media_player"},"Media Player (TV/Audio)",-1),e("option",{value:"fan"},"Fan",-1),e("option",{value:"light"},"Light",-1)])],544),[[Me,s.value]])]),e("div",Za,[ke(Ze,{modelValue:m.value,"onUpdate:modelValue":y[1]||(y[1]=l=>m.value=l),options:f.value,label:"Manufacturer",placeholder:"Search manufacturers...",loading:S.value,disabled:S.value,onChange:H},null,8,["modelValue","options","loading","disabled"])]),e("div",Qa,[ke(Ze,{modelValue:L.value,"onUpdate:modelValue":y[2]||(y[2]=l=>L.value=l),options:V.value,"option-label":"label","option-value":"code",label:"Model",placeholder:"Search models...",loading:n.value,disabled:!m.value||n.value,onChange:j},null,8,["modelValue","options","loading","disabled"])]),_.value?(a(),r("div",ei,[y[12]||(y[12]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[e("strong",null,v(m.value)+" - "+v(_.value.models[0]),1),e("p",null,"Code: "+v(_.value.code),1)])])):O("",!0),e("div",ti,[e("button",{onClick:Ae,disabled:!_.value||R.value,class:"btn-primary"},[e("i",{class:G(["mdi",R.value?"mdi-loading mdi-spin":"mdi-download"])},null,2),x(" "+v(R.value?"Loading...":"Load Commands"),1)],8,oi)])]))])])])):O("",!0)}}},_i=Se(Ci,[["__scopeId","data-v-66569200"]]),Si={class:"smartir-status-card"},Ii={class:"card-header"},Di=["src"],xi={class:"header-badges"},Ti=["title"],Mi={class:"header-info"},Ri={class:"header-info"},Ei={class:"header-info"},Oi={class:"header-right"},Ai={key:0,class:"view-toggle-group header-view-toggle"},Li={key:2,class:"settings-menu-container"},Pi={key:0,class:"card-body loading-state"},Vi={key:1,class:"card-body error-state"},ji={key:2,class:"card-body installed-state"},Ui={key:0,class:"help-panel"},Fi={key:0,class:"recommendation"},Ni={key:0,class:"next-steps"},Bi={class:"help-actions"},Hi={key:1,class:"filter-bar"},qi={class:"filter-search-row"},zi=["title"],Ji={key:0,class:"filter-badge"},Wi={class:"search-input-wrapper"},Gi={class:"filter-content"},Ki={class:"filter-row"},Xi={class:"filter-group"},Yi={class:"filter-results"},Zi={key:2,class:"loading-state"},Qi={key:3,class:"empty-state"},er={key:4,class:"profiles-grid"},tr={key:6,class:"no-results"},or={key:3,class:"card-body not-installed-state"},lr={class:"benefits-section"},nr={class:"benefits-list"},sr={class:"recommendation"},ar={__name:"SmartIRStatusCard",emits:["create-profile","edit-profile"],setup(t,{expose:c,emit:i}){const h=i,w=Le("smartirStatus");Le("smartirEnabled");const s=Le("refreshSmartIR"),{isMobile:m}=ot(),f=g(!1),S=g(null),_=g((w==null?void 0:w.value)||null),L=g(localStorage.getItem("smartir_simulate_not_installed")==="true"),k=g(!1),n=g(!1),V=g(!0),q=g([]),F=g(!1),R=g(!1),D=g({search:"",platform:""}),o=g({show:!1,title:"",message:"",platform:null,profile:null}),b=g(!1),p=g(window.innerWidth<=767?"grid":localStorage.getItem("profile_view_mode")||"grid");ue(m,u=>{u&&p.value==="list"&&(p.value="grid")}),ue(p,u=>{localStorage.setItem("profile_view_mode",u)}),ue(V,u=>{u||(n.value=!1)});const Z=["Full climate entity support (AC, heaters)","120+ pre-configured device profiles","Temperature and humidity sensor integration","HVAC mode control (heat, cool, auto, dry, fan)"],ne=["climate","media_player","fan","light"],z=X(()=>L.value?{installed:!1,recommendation:{message:"Install SmartIR to unlock climate device support!",benefits:["Full climate entity support (AC, heaters)","120+ pre-configured device profiles","Temperature and humidity sensor integration","HVAC mode control (heat, cool, auto, dry, fan)"]}}:_.value),T=X(()=>{var u,l;return((l=(u=z.value)==null?void 0:u.platforms)==null?void 0:l.length)||0}),N=X(()=>{var u;return(u=z.value)!=null&&u.device_counts?Object.values(z.value.device_counts).reduce((l,B)=>l+B,0):0});function se(){var u;L.value=!L.value,localStorage.setItem("smartir_simulate_not_installed",L.value.toString()),!L.value&&((u=_.value)!=null&&u.installed)&&K()}const fe=X(()=>{let u=q.value;if(D.value.search){const l=D.value.search.toLowerCase();u=u.filter(B=>{var Q,re,ae,Ce;return((Q=B.manufacturer)==null?void 0:Q.toLowerCase().includes(l))||((re=B.model)==null?void 0:re.toLowerCase().includes(l))||((ae=B.code)==null?void 0:ae.toString().includes(l))||((Ce=B.platform)==null?void 0:Ce.toLowerCase().includes(l))})}return D.value.platform&&(u=u.filter(l=>l.platform===D.value.platform)),u}),Re=X(()=>D.value.search||D.value.platform),Oe=X(()=>{let u=0;return D.value.search&&u++,D.value.platform&&u++,u});function Ae(){D.value.search="",D.value.platform=""}async function De(){f.value=!0,S.value=null;try{if(s)await s();else{const u=await ut.getStatus();_.value=u}}catch(u){S.value=u.message||"Failed to refresh SmartIR status",console.error("Error refreshing SmartIR status:",u)}finally{f.value=!1}}function Y(){h("create-profile")}function M(){k.value=!k.value,n.value=!1}function te(){V.value||(V.value=!0),n.value=!n.value}function H(){b.value=!0,n.value=!1}function j(){window.open("https://github.com/smartHomeHub/SmartIR","_blank")}async function K(){F.value=!0;const u=[];try{for(const l of ne)try{const Q=((await oe.get(`/api/smartir/platforms/${l}/profiles`)).data.profiles||[]).map(re=>({...re,platform:l}));u.push(...Q)}catch(B){console.warn(`Network error loading ${l} profiles (using bundled index):`,B.message)}q.value=u}catch(l){console.error("Unexpected error loading profiles:",l)}finally{F.value=!1}}function ce(u,l,B){h("edit-profile",{platform:u,profile:l,startStep:B})}async function Pe(u,l){var B,Q;try{const ae=(await oe.get(`/api/smartir/platforms/${u}/profiles/${l.code}`)).data,Ce=JSON.stringify(ae.profile,null,2),ge=new Blob([Ce],{type:"application/json"}),_e=URL.createObjectURL(ge),I=document.createElement("a");I.href=_e,I.download=`smartir_${u}_${l.manufacturer}_${l.model}_${l.code}.json`,document.body.appendChild(I),I.click(),document.body.removeChild(I),URL.revokeObjectURL(_e),(B=Le("toast").value)==null||B.success(`Downloaded ${l.manufacturer} ${l.model}`,"âœ… Profile Downloaded")}catch(re){console.error("Error downloading profile:",re),(Q=Le("toast").value)==null||Q.error("Failed to download profile","âŒ Download Error")}}const Te=u=>{u.target.closest(".settings-container")||(n.value=!1)};Ee(()=>{document.addEventListener("click",Te)}),qe(()=>{document.removeEventListener("click",Te)});async function ee(u,l){Le("toast");try{const Q=(await oe.post(`/api/smartir/profiles/${l.code}/check-usage`,{platform:u})).data;if(Q&&Q.in_use){o.value={show:!0,title:`Cannot Delete ${l.manufacturer} ${l.model}`,message:`This profile is currently in use by ${Q.device_count} device(s):

${Q.devices.join(`
`)}

Please remove or reassign these devices before deleting the profile.`,platform:u,profile:l,canDelete:!1,devices:Q.devices};return}}catch(B){console.error("Error checking profile usage:",B)}o.value={show:!0,title:`Delete ${l.manufacturer} ${l.model}?`,message:`Device Code: ${l.code}

This will remove the profile and update your configuration.`,platform:u,profile:l,canDelete:!0}}async function y(){var Q,re;const u=Le("toast"),{platform:l,profile:B}=o.value;o.value.show=!1;try{await oe.delete(`/api/smartir/profiles/${B.code}`,{data:{platform:l}}),await K(),await at(),await De(),(Q=u.value)==null||Q.success(`${B.manufacturer} ${B.model} has been removed`,"âœ… Profile Deleted")}catch(ae){console.error("Error deleting profile:",ae),(re=u.value)==null||re.error("Failed to delete profile","âŒ Delete Error")}}return ue(w,u=>{u&&(_.value=u)},{immediate:!0}),ue(p,u=>{localStorage.setItem("profile_view_mode",u)}),Ee(async()=>{var u;w!=null&&w.value&&(_.value=w.value),_.value||await De(),(u=_.value)!=null&&u.installed&&await K()}),c({loadAllProfiles:K,refreshStatus:De}),(u,l)=>{var B,Q,re,ae,Ce,ge,_e,I,d;return a(),r("div",Si,[e("div",Ii,[e("button",{class:"icon-button chevron-button",onClick:l[0]||(l[0]=C=>V.value=!V.value)},[e("i",{class:G(["mdi",V.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2)]),e("div",{class:"header-left",onClick:l[1]||(l[1]=C=>V.value=!V.value)},[e("img",{src:Ie(Qe),alt:"SmartIR",class:"smartir-logo"},null,8,Di),e("h3",null,v(Ie(m)?"SmartIR":"SmartIR Integration"),1),e("div",xi,[e("div",{class:G(["simulation-toggle-pill",{active:L.value}]),onClick:be(se,["stop"]),title:L.value?"Click to show as installed":"Click to simulate not-installed"},[e("i",{class:G(["mdi",L.value?"mdi-eye-off":"mdi-eye"])},null,2),e("span",null,v(L.value?"Simulating: Not Installed":"Simulation Mode"),1)],10,Ti),(B=z.value)!=null&&B.installed?(a(),r(he,{key:0},[l[16]||(l[16]=e("div",{class:"status-badge-mini success"},[e("i",{class:"mdi mdi-check-circle"}),e("span",null,"Installed")],-1)),e("span",Mi,"v"+v(z.value.version||"Unknown"),1),e("span",Ri,v(T.value)+" platform"+v(T.value!==1?"s":""),1),e("span",Ei,v(N.value)+" device"+v(N.value!==1?"s":""),1)],64)):O("",!0)])]),e("div",Oi,[!Ie(m)&&((Q=z.value)!=null&&Q.installed)?(a(),r("div",Ai,[e("button",{onClick:l[2]||(l[2]=be(C=>p.value="grid",["stop"])),class:G(["view-toggle-btn",{active:p.value==="grid"}]),title:"Grid View"},[...l[17]||(l[17]=[e("i",{class:"mdi mdi-view-grid"},null,-1)])],2),e("button",{onClick:l[3]||(l[3]=be(C=>p.value="list",["stop"])),class:G(["view-toggle-btn",{active:p.value==="list"}]),title:"List View"},[...l[18]||(l[18]=[e("i",{class:"mdi mdi-view-list"},null,-1)])],2)])):O("",!0),(re=z.value)!=null&&re.installed?(a(),r("button",{key:1,onClick:be(Y,["stop"]),class:"btn btn-primary new-button"},[...l[19]||(l[19]=[e("i",{class:"mdi mdi-plus"},null,-1),e("span",null,"New",-1)])])):O("",!0),(ae=z.value)!=null&&ae.installed?(a(),r("div",Li,[e("button",{onClick:be(te,["stop"]),class:G(["icon-button settings-button",{active:n.value}]),title:"Settings"},[...l[20]||(l[20]=[e("i",{class:"mdi mdi-cog"},null,-1)])],2),n.value?(a(),r("div",{key:0,class:"settings-dropdown",onClick:l[5]||(l[5]=be(()=>{},["stop"]))},[e("button",{onClick:M,class:"menu-item"},[l[21]||(l[21]=e("i",{class:"mdi mdi-help-circle"},null,-1)),e("span",null,v(k.value?"Hide Help":"Show Help"),1)]),e("button",{onClick:l[4]||(l[4]=C=>{n.value=!1,De()}),class:"menu-item"},[...l[22]||(l[22]=[e("i",{class:"mdi mdi-refresh"},null,-1),e("span",null,"Refresh Status",-1)])]),e("button",{onClick:H,class:"menu-item"},[...l[23]||(l[23]=[e("i",{class:"mdi mdi-test-tube"},null,-1),e("span",null,"Test Codes",-1)])])])):O("",!0)])):O("",!0)])]),W(e("div",null,[f.value?(a(),r("div",Pi,[...l[24]||(l[24]=[e("div",{class:"spinner"},null,-1),e("p",null,"Checking SmartIR installation...",-1)])])):S.value?(a(),r("div",Vi,[l[25]||(l[25]=e("i",{class:"mdi mdi-alert-circle"},null,-1)),e("p",null,v(S.value),1),e("button",{onClick:De,class:"btn-secondary"}," Try Again ")])):(Ce=z.value)!=null&&Ce.installed?(a(),r("div",ji,[k.value?(a(),r("div",Ui,[_.value.recommendation?(a(),r("div",Fi,[e("p",null,v(_.value.recommendation.message),1),_.value.recommendation.next_steps?(a(),r("div",Ni,[l[26]||(l[26]=e("strong",null,"Next Steps:",-1)),e("ul",null,[(a(!0),r(he,null,$e(_.value.recommendation.next_steps,(C,J)=>(a(),r("li",{key:J},v(C),1))),128))])])):O("",!0)])):O("",!0),e("div",Bi,[e("button",{onClick:l[6]||(l[6]=(...C)=>u.viewDocumentation&&u.viewDocumentation(...C)),class:"btn-secondary"},[...l[27]||(l[27]=[e("i",{class:"mdi mdi-book-open-variant"},null,-1),x(" View Documentation ",-1)])])])])):O("",!0),q.value.length>0&&!L.value?(a(),r("div",Hi,[e("div",qi,[e("button",{class:G(["filter-toggle-button",{active:R.value||Re.value}]),onClick:l[7]||(l[7]=C=>R.value=!R.value),title:R.value?"Hide filters":"Show filters"},[l[28]||(l[28]=e("i",{class:"mdi mdi-filter-variant"},null,-1)),Re.value?(a(),r("span",Ji,v(Oe.value),1)):O("",!0)],10,zi),e("div",Wi,[l[29]||(l[29]=e("i",{class:"mdi mdi-magnify search-icon"},null,-1)),W(e("input",{"onUpdate:modelValue":l[8]||(l[8]=C=>D.value.search=C),type:"text",placeholder:"Search profiles...",class:"search-input"},null,512),[[Ve,D.value.search]])])]),W(e("div",Gi,[e("div",Ki,[e("div",Xi,[e("label",null,[l[31]||(l[31]=e("i",{class:"mdi mdi-shape"},null,-1)),W(e("select",{"onUpdate:modelValue":l[9]||(l[9]=C=>D.value.platform=C)},[...l[30]||(l[30]=[ze('<option value="" data-v-d3566817>All Platforms</option><option value="climate" data-v-d3566817>Climate</option><option value="media_player" data-v-d3566817>Media Player</option><option value="fan" data-v-d3566817>Fan</option><option value="light" data-v-d3566817>Light</option>',5)])],512),[[Me,D.value.platform]])])]),Re.value?(a(),r("button",{key:0,onClick:Ae,class:"btn-clear-filters"},[...l[32]||(l[32]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),x(" Clear ",-1)])])):O("",!0),e("div",Yi,v(fe.value.length)+" of "+v(q.value.length),1)])],512),[[Ye,R.value]])])):O("",!0),F.value?(a(),r("div",Zi,[...l[33]||(l[33]=[e("i",{class:"mdi mdi-loading mdi-spin"},null,-1),e("p",null,"Loading profiles...",-1)])])):q.value.length===0?(a(),r("div",Qi,[...l[34]||(l[34]=[e("i",{class:"mdi mdi-file-document-outline"},null,-1),e("h3",null,"No Profiles Yet",-1),e("p",null,"Create your first SmartIR profile to get started",-1)])])):O("",!0),p.value==="grid"&&!L.value?(a(),r("div",er,[(a(!0),r(he,null,$e(fe.value,C=>(a(),Ne(_a,{key:`${C.platform}-${C.code}`,profile:C,onEdit:J=>ce(C.platform,C),onCommands:J=>ce(C.platform,C,1),onDownload:J=>Pe(C.platform,C),onDelete:J=>ee(C.platform,C)},null,8,["profile","onEdit","onCommands","onDownload","onDelete"]))),128))])):p.value==="list"&&!L.value&&fe.value.length>0?(a(),Ne(Wa,{key:5,profiles:fe.value,onEdit:l[10]||(l[10]=C=>ce(C.platform,C)),onCommands:l[11]||(l[11]=C=>ce(C.platform,C,1)),onDownload:l[12]||(l[12]=C=>Pe(C.platform,C)),onDelete:l[13]||(l[13]=C=>ee(C.platform,C))},null,8,["profiles"])):O("",!0),q.value.length>0&&fe.value.length===0&&!L.value?(a(),r("div",tr,[...l[35]||(l[35]=[e("i",{class:"mdi mdi-filter-off"},null,-1),e("h3",null,"No profiles match your filters",-1),e("p",null,"Try adjusting your search or filter criteria",-1)])])):O("",!0)])):(a(),r("div",or,[l[39]||(l[39]=e("div",{class:"status-badge warning"},[e("i",{class:"mdi mdi-information"}),e("span",null,"Not Installed")],-1)),e("div",lr,[l[37]||(l[37]=e("h4",null,"Why Install SmartIR?",-1)),e("ul",nr,[(a(!0),r(he,null,$e(((_e=(ge=_.value)==null?void 0:ge.recommendation)==null?void 0:_e.benefits)||Z,(C,J)=>(a(),r("li",{key:J},[l[36]||(l[36]=e("i",{class:"mdi mdi-check"},null,-1)),e("span",null,v(C),1)]))),128))])]),e("div",sr,[e("p",null,v(((d=(I=_.value)==null?void 0:I.recommendation)==null?void 0:d.message)||"Install SmartIR to unlock climate device support!"),1)]),e("div",{class:"card-actions"},[e("button",{onClick:j,class:"btn-primary"},[...l[38]||(l[38]=[e("i",{class:"mdi mdi-github"},null,-1),x(" Install SmartIR ",-1)])])])]))],512),[[Ye,V.value]]),ke(He,{isOpen:o.value.show,title:o.value.title,message:o.value.message,confirmText:o.value.canDelete===!1?null:"Delete",cancelText:"Close",dangerMode:!0,confirmDisabled:o.value.canDelete===!1,onConfirm:y,onCancel:l[14]||(l[14]=C=>o.value.show=!1)},null,8,["isOpen","title","message","confirmText","confirmDisabled"]),ke(_i,{isOpen:b.value,onClose:l[15]||(l[15]=C=>b.value=!1)},null,8,["isOpen"])])}}},ir=Se(ar,[["__scopeId","data-v-d3566817"]]),rr={class:"climate-form"},dr={class:"learning-mode-section"},ur={class:"mode-toggle"},cr={class:"mode-content"},mr={class:"mode-stats"},vr={class:"stat-badge"},pr={class:"stat-badge time"},fr={class:"mode-content"},gr={class:"mode-stats"},yr={class:"stat-badge"},br={class:"stat-badge time warning"},hr={key:0,class:"command-breakdown"},kr={class:"warning-text"},wr={class:"form-section"},$r={key:0,class:"help-text"},Cr={key:1,class:"help-text"},_r={class:"form-row"},Sr={class:"form-group"},Ir={class:"form-group"},Dr={class:"form-group"},xr={key:2,class:"representative-temp-section"},Tr={class:"form-group"},Mr=["value"],Rr={class:"form-section"},Er={class:"checkbox-grid"},Or={class:"checkbox-item"},Ar={class:"checkbox-item"},Lr={class:"checkbox-item"},Pr={class:"checkbox-item"},Vr={class:"checkbox-item"},jr={class:"checkbox-item"},Ur={class:"form-section"},Fr={class:"checkbox-grid"},Nr={class:"checkbox-item"},Br={class:"checkbox-item"},Hr={class:"checkbox-item"},qr={class:"checkbox-item"},zr={class:"form-section"},Jr={class:"checkbox-grid"},Wr={class:"checkbox-item"},Gr={class:"checkbox-item"},Kr={class:"checkbox-item"},Xr={class:"checkbox-item"},Yr={class:"form-section"},Zr={class:"checkbox-grid"},Qr={class:"checkbox-item"},ed={class:"checkbox-item"},td={class:"checkbox-item"},od={class:"checkbox-item"},ld={class:"checkbox-item"},nd={class:"checkbox-item"},sd={class:"form-section"},ad={class:"form-group"},id={class:"form-group"},rd={class:"form-group"},dd={key:0,class:"validation-summary"},ud={__name:"ClimateProfileForm",props:{modelValue:{type:Object,default:()=>({})}},emits:["update:modelValue"],setup(t,{emit:c}){const i=t,h=c,w=g("quick"),s=g({minTemp:16,maxTemp:30,precision:1,representativeTemp:24,modes:["off","auto","cool","heat"],fanModes:["auto","low","medium","high"],swingModes:[],presetModes:[],tempSensor:"",humiditySensor:"",powerSensor:"",learningMode:"quick",...i.modelValue}),m=X(()=>{const D=[],o=s.value.minTemp||16,b=s.value.maxTemp||30,P=s.value.precision||1;for(let p=o;p<=b;p+=P)D.push(p);return D}),f=X(()=>s.value.modes.filter(D=>D!=="off").length),S=X(()=>s.value.fanModes.length||1),_=X(()=>s.value.swingModes.length||1),L=X(()=>s.value.presetModes.length||1),k=X(()=>{const D=s.value.minTemp||16,o=s.value.maxTemp||30,b=s.value.precision||1;return Math.floor((o-D)/b)+1}),n=X(()=>{const D=s.value.modes.includes("off")?1:0;return f.value*S.value*_.value*L.value+D}),V=X(()=>Math.ceil(n.value*30/60)),q=X(()=>{const D=s.value.modes.includes("off")?1:0;return f.value*k.value*S.value*_.value*L.value+D}),F=X(()=>Math.ceil(q.value*30/60)),R=X(()=>{const D=[];return(!s.value.minTemp||s.value.minTemp<10||s.value.minTemp>35)&&D.push("Minimum temperature must be between 10Â°C and 35Â°C"),(!s.value.maxTemp||s.value.maxTemp<10||s.value.maxTemp>35)&&D.push("Maximum temperature must be between 10Â°C and 35Â°C"),s.value.minTemp>=s.value.maxTemp&&D.push("Minimum temperature must be less than maximum temperature"),(!s.value.modes||s.value.modes.length===0)&&D.push("At least one HVAC mode must be selected"),D});return ue(w,D=>{s.value.learningMode=D}),ue(s,D=>{h("update:modelValue",D)},{deep:!0,immediate:!0}),(D,o)=>(a(),r("div",rr,[o[77]||(o[77]=e("h3",null,"Climate Device Configuration",-1)),e("div",dr,[e("div",ur,[e("label",{class:G(["mode-option",{active:w.value==="quick"}])},[W(e("input",{type:"radio",value:"quick","onUpdate:modelValue":o[0]||(o[0]=b=>w.value=b)},null,512),[[Je,w.value]]),e("div",cr,[o[29]||(o[29]=e("div",{class:"mode-header"},[e("i",{class:"mdi mdi-flash"}),e("strong",null,"Quick Mode (Recommended)")],-1)),o[30]||(o[30]=e("p",null,"Learn one temperature per mode combination",-1)),e("div",mr,[e("span",vr,v(n.value)+" commands",1),e("span",pr,"~"+v(V.value)+" min",1)])])],2),e("label",{class:G(["mode-option",{active:w.value==="complete"}])},[W(e("input",{type:"radio",value:"complete","onUpdate:modelValue":o[1]||(o[1]=b=>w.value=b)},null,512),[[Je,w.value]]),e("div",fr,[o[31]||(o[31]=e("div",{class:"mode-header"},[e("i",{class:"mdi mdi-check-all"}),e("strong",null,"Complete Mode")],-1)),o[32]||(o[32]=e("p",null,"Learn all temperature combinations",-1)),e("div",gr,[e("span",yr,v(q.value)+" commands",1),e("span",br,"~"+v(F.value)+" min",1)])])],2)]),w.value==="complete"?(a(),r("div",hr,[o[33]||(o[33]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[e("strong",null,"Complete mode will require learning "+v(q.value)+" commands",1),e("p",null,"This includes all combinations of modes ("+v(f.value)+"), temperatures ("+v(k.value)+"), fan speeds ("+v(S.value)+"), swing modes ("+v(_.value)+"), and preset modes ("+v(L.value)+").",1),e("p",kr,"â±ï¸ Estimated time: "+v(F.value)+" minutes at ~30 seconds per command",1)])])):O("",!0)]),e("div",wr,[o[39]||(o[39]=e("h4",null,"Temperature Range",-1)),w.value==="quick"?(a(),r("p",$r," Define the full temperature range your device supports. You'll select one temperature to learn below. ")):(a(),r("p",Cr," Define the temperature range. All temperatures in this range will be learned. ")),e("div",_r,[e("div",Sr,[o[34]||(o[34]=e("label",null,"Minimum Temperature (Â°C) *",-1)),W(e("input",{"onUpdate:modelValue":o[2]||(o[2]=b=>s.value.minTemp=b),type:"number",min:"10",max:"35",placeholder:"16"},null,512),[[Ve,s.value.minTemp,void 0,{number:!0}]])]),e("div",Ir,[o[35]||(o[35]=e("label",null,"Maximum Temperature (Â°C) *",-1)),W(e("input",{"onUpdate:modelValue":o[3]||(o[3]=b=>s.value.maxTemp=b),type:"number",min:"10",max:"35",placeholder:"30"},null,512),[[Ve,s.value.maxTemp,void 0,{number:!0}]])]),e("div",Dr,[o[37]||(o[37]=e("label",null,"Precision",-1)),W(e("select",{"onUpdate:modelValue":o[4]||(o[4]=b=>s.value.precision=b)},[...o[36]||(o[36]=[e("option",{value:1},"1Â°C (Whole degrees)",-1),e("option",{value:.5},"0.5Â°C (Half degrees)",-1)])],512),[[Me,s.value.precision,void 0,{number:!0}]])])]),w.value==="quick"?(a(),r("div",xr,[e("div",Tr,[o[38]||(o[38]=e("label",null,"Representative Temperature to Learn *",-1)),W(e("select",{"onUpdate:modelValue":o[5]||(o[5]=b=>s.value.representativeTemp=b)},[(a(!0),r(he,null,$e(m.value,b=>(a(),r("option",{key:b,value:b},v(b)+"Â°C ",9,Mr))),128))],512),[[Me,s.value.representativeTemp,void 0,{number:!0}]]),e("small",null,"This temperature will be learned for all mode combinations. The device profile will still show the full range ("+v(s.value.minTemp)+"Â°C - "+v(s.value.maxTemp)+"Â°C).",1)])])):O("",!0)]),e("div",Rr,[o[46]||(o[46]=e("h4",null,"Supported HVAC Modes *",-1)),o[47]||(o[47]=e("p",{class:"help-text"},"Select all modes your device supports",-1)),e("div",Er,[e("label",Or,[W(e("input",{type:"checkbox",value:"off","onUpdate:modelValue":o[6]||(o[6]=b=>s.value.modes=b)},null,512),[[me,s.value.modes]]),o[40]||(o[40]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),x(" Off ")],-1))]),e("label",Ar,[W(e("input",{type:"checkbox",value:"auto","onUpdate:modelValue":o[7]||(o[7]=b=>s.value.modes=b)},null,512),[[me,s.value.modes]]),o[41]||(o[41]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-autorenew"}),x(" Auto ")],-1))]),e("label",Lr,[W(e("input",{type:"checkbox",value:"cool","onUpdate:modelValue":o[8]||(o[8]=b=>s.value.modes=b)},null,512),[[me,s.value.modes]]),o[42]||(o[42]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-snowflake"}),x(" Cool ")],-1))]),e("label",Pr,[W(e("input",{type:"checkbox",value:"heat","onUpdate:modelValue":o[9]||(o[9]=b=>s.value.modes=b)},null,512),[[me,s.value.modes]]),o[43]||(o[43]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fire"}),x(" Heat ")],-1))]),e("label",Vr,[W(e("input",{type:"checkbox",value:"dry","onUpdate:modelValue":o[10]||(o[10]=b=>s.value.modes=b)},null,512),[[me,s.value.modes]]),o[44]||(o[44]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-water-percent"}),x(" Dry ")],-1))]),e("label",jr,[W(e("input",{type:"checkbox",value:"fan_only","onUpdate:modelValue":o[11]||(o[11]=b=>s.value.modes=b)},null,512),[[me,s.value.modes]]),o[45]||(o[45]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan"}),x(" Fan Only ")],-1))])])]),e("div",Ur,[o[52]||(o[52]=e("h4",null,"Fan Modes",-1)),o[53]||(o[53]=e("p",{class:"help-text"},"Select all fan speeds your device supports",-1)),e("div",Fr,[e("label",Nr,[W(e("input",{type:"checkbox",value:"auto","onUpdate:modelValue":o[12]||(o[12]=b=>s.value.fanModes=b)},null,512),[[me,s.value.fanModes]]),o[48]||(o[48]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-autorenew"}),x(" Auto ")],-1))]),e("label",Br,[W(e("input",{type:"checkbox",value:"low","onUpdate:modelValue":o[13]||(o[13]=b=>s.value.fanModes=b)},null,512),[[me,s.value.fanModes]]),o[49]||(o[49]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-1"}),x(" Low ")],-1))]),e("label",Hr,[W(e("input",{type:"checkbox",value:"medium","onUpdate:modelValue":o[14]||(o[14]=b=>s.value.fanModes=b)},null,512),[[me,s.value.fanModes]]),o[50]||(o[50]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-2"}),x(" Medium ")],-1))]),e("label",qr,[W(e("input",{type:"checkbox",value:"high","onUpdate:modelValue":o[15]||(o[15]=b=>s.value.fanModes=b)},null,512),[[me,s.value.fanModes]]),o[51]||(o[51]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-3"}),x(" High ")],-1))])])]),e("div",zr,[o[58]||(o[58]=e("h4",null,"Swing Modes (Optional)",-1)),o[59]||(o[59]=e("p",{class:"help-text"},"Select if your device has swing/oscillation",-1)),e("div",Jr,[e("label",Wr,[W(e("input",{type:"checkbox",value:"off","onUpdate:modelValue":o[16]||(o[16]=b=>s.value.swingModes=b)},null,512),[[me,s.value.swingModes]]),o[54]||(o[54]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-horizontal"}),x(" Off ")],-1))]),e("label",Gr,[W(e("input",{type:"checkbox",value:"vertical","onUpdate:modelValue":o[17]||(o[17]=b=>s.value.swingModes=b)},null,512),[[me,s.value.swingModes]]),o[55]||(o[55]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-vertical"}),x(" Vertical ")],-1))]),e("label",Kr,[W(e("input",{type:"checkbox",value:"horizontal","onUpdate:modelValue":o[18]||(o[18]=b=>s.value.swingModes=b)},null,512),[[me,s.value.swingModes]]),o[56]||(o[56]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-horizontal"}),x(" Horizontal ")],-1))]),e("label",Xr,[W(e("input",{type:"checkbox",value:"both","onUpdate:modelValue":o[19]||(o[19]=b=>s.value.swingModes=b)},null,512),[[me,s.value.swingModes]]),o[57]||(o[57]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-arrow-all"}),x(" Both ")],-1))])])]),e("div",Yr,[o[66]||(o[66]=e("h4",null,"Preset Modes (Optional)",-1)),o[67]||(o[67]=e("p",{class:"help-text"},"Select special modes your device supports",-1)),e("div",Zr,[e("label",Qr,[W(e("input",{type:"checkbox",value:"none","onUpdate:modelValue":o[20]||(o[20]=b=>s.value.presetModes=b)},null,512),[[me,s.value.presetModes]]),o[60]||(o[60]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-circle-outline"}),x(" None ")],-1))]),e("label",ed,[W(e("input",{type:"checkbox",value:"eco","onUpdate:modelValue":o[21]||(o[21]=b=>s.value.presetModes=b)},null,512),[[me,s.value.presetModes]]),o[61]||(o[61]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-leaf"}),x(" Eco ")],-1))]),e("label",td,[W(e("input",{type:"checkbox",value:"boost","onUpdate:modelValue":o[22]||(o[22]=b=>s.value.presetModes=b)},null,512),[[me,s.value.presetModes]]),o[62]||(o[62]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-rocket-launch"}),x(" Boost ")],-1))]),e("label",od,[W(e("input",{type:"checkbox",value:"sleep","onUpdate:modelValue":o[23]||(o[23]=b=>s.value.presetModes=b)},null,512),[[me,s.value.presetModes]]),o[63]||(o[63]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power-sleep"}),x(" Sleep ")],-1))]),e("label",ld,[W(e("input",{type:"checkbox",value:"away","onUpdate:modelValue":o[24]||(o[24]=b=>s.value.presetModes=b)},null,512),[[me,s.value.presetModes]]),o[64]||(o[64]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-home-export-outline"}),x(" Away ")],-1))]),e("label",nd,[W(e("input",{type:"checkbox",value:"comfort","onUpdate:modelValue":o[25]||(o[25]=b=>s.value.presetModes=b)},null,512),[[me,s.value.presetModes]]),o[65]||(o[65]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-sofa"}),x(" Comfort ")],-1))])])]),e("div",sd,[o[74]||(o[74]=e("h4",null,"Sensors (Optional)",-1)),o[75]||(o[75]=e("p",{class:"help-text"},"Link external sensors for better climate control",-1)),e("div",ad,[o[68]||(o[68]=e("label",null,"Temperature Sensor",-1)),W(e("input",{"onUpdate:modelValue":o[26]||(o[26]=b=>s.value.tempSensor=b),type:"text",placeholder:"sensor.living_room_temperature"},null,512),[[Ve,s.value.tempSensor]]),o[69]||(o[69]=e("small",null,"Entity ID of temperature sensor",-1))]),e("div",id,[o[70]||(o[70]=e("label",null,"Humidity Sensor",-1)),W(e("input",{"onUpdate:modelValue":o[27]||(o[27]=b=>s.value.humiditySensor=b),type:"text",placeholder:"sensor.living_room_humidity"},null,512),[[Ve,s.value.humiditySensor]]),o[71]||(o[71]=e("small",null,"Entity ID of humidity sensor",-1))]),e("div",rd,[o[72]||(o[72]=e("label",null,"Power Sensor",-1)),W(e("input",{"onUpdate:modelValue":o[28]||(o[28]=b=>s.value.powerSensor=b),type:"text",placeholder:"binary_sensor.ac_power"},null,512),[[Ve,s.value.powerSensor]]),o[73]||(o[73]=e("small",null,"Entity ID of power sensor (to detect on/off state)",-1))])]),R.value.length>0?(a(),r("div",dd,[o[76]||(o[76]=e("h4",null,[e("i",{class:"mdi mdi-alert-circle"}),x(" Please fix the following: ")],-1)),e("ul",null,[(a(!0),r(he,null,$e(R.value,(b,P)=>(a(),r("li",{key:P},v(b),1))),128))])])):O("",!0)]))}},cd=Se(ud,[["__scopeId","data-v-e22a3983"]]),md={class:"command-wizard"},vd={class:"device-selection-section"},pd={class:"input-wrapper"},fd=["value"],gd={key:0,class:"validation-tooltip"},yd={class:"form-group"},bd=["disabled"],hd={key:0},kd={key:1},wd={key:0,class:"edit-mode-banner"},$d={class:"wizard-info"},Cd={key:0},_d={key:1},Sd={class:"progress-info"},Id={class:"progress-bar"},Dd={class:"progress-text"},xd={class:"commands-grid"},Td={class:"command-header"},Md={class:"command-icon"},Rd={class:"command-info"},Ed={key:0,class:"learning-indicator"},Od={key:0,class:"ir-learning-steps"},Ad={key:1,class:"rf-learning-steps"},Ld={class:"command-actions"},Pd=["onClick","disabled"],Vd=["onClick","disabled"],jd=["onClick"],Ud={class:"quick-actions"},Fd=["disabled"],Nd=["disabled"],Bd={__name:"CommandLearningWizard",props:{modelValue:{type:Object,default:()=>({})},platform:{type:String,required:!0},config:{type:Object,required:!0},broadlinkDevice:{type:String,default:""},manufacturer:{type:String,required:!0},model:{type:String,required:!0},commandType:{type:String,default:"ir"}},emits:["update:modelValue","update:broadlinkDevice","update:commandType"],setup(t,{emit:c}){const i=Ge(),h=t,w=c,s=g({...h.modelValue}),m=g(null),f=g(null),S=g([]),_=g(h.broadlinkDevice),L=g(h.commandType),k=g(!1),n=g([]),V=g(!1),q=g(!1),F=g({show:!1,commandKey:null,commandLabel:""}),R=g(!1),D=g(null),o=X(()=>{console.log("ğŸ® CommandList computed - platform:",h.platform,"config:",h.config);const H=[];if(h.platform==="climate"){const j=h.config.modes||[],K=h.config.fanModes||[],ce=h.config.swingModes||[],Pe=h.config.presetModes||[],Te=h.config.minTemp||16,ee=h.config.maxTemp||30,y=j.includes("off"),u=h.modelValue&&h.modelValue.off;!y&&u&&H.push({key:"off",label:"Power Off",description:"Turn device off (standalone command)",icon:"mdi mdi-power",mode:"off"}),j.forEach(l=>{if(l==="off")H.push({key:"off",label:"Power Off",description:"Turn device off",icon:"mdi mdi-power",mode:"off"});else for(let B=Te;B<=ee;B++)K.forEach(Q=>{(ce.length>0?ce:[null]).forEach(ae=>{(Pe.length>0?Pe:[null]).forEach(ge=>{let _e=`${l}_${B}_${Q}`,I=`${l.toUpperCase()} ${B}Â°C ${Q}`,d=`Mode: ${l}, Temp: ${B}Â°C, Fan: ${Q}`;ae&&(_e+=`_${ae}`,I+=` ${ae}`,d+=`, Swing: ${ae}`),ge&&(_e+=`_${ge}`,I+=` [${ge}]`,d+=`, Preset: ${ge}`),H.push({key:_e,label:I,description:d,icon:Z(l),mode:l,temp:B,fanMode:Q,swingMode:ae,presetMode:ge})})})})})}else if(h.platform==="media_player"){const j=h.config.features||[];console.log("ğŸ“º Media player - config.features:",h.config.features,"features array:",j,"features length:",j.length),j.includes("turn_on")&&(H.push({key:"turn_on",label:"Power On",description:"Turn on the device",icon:"mdi mdi-power"}),H.push({key:"turn_off",label:"Power Off",description:"Turn off the device",icon:"mdi mdi-power-off"})),j.includes("volume")&&(H.push({key:"volume_up",label:"Volume Up",description:"Increase volume",icon:"mdi mdi-volume-plus"}),H.push({key:"volume_down",label:"Volume Down",description:"Decrease volume",icon:"mdi mdi-volume-minus"})),j.includes("mute")&&H.push({key:"mute",label:"Mute",description:"Toggle mute",icon:"mdi mdi-volume-mute"}),j.includes("source")&&(H.push({key:"source_hdmi1",label:"Source: HDMI 1",description:"Switch to HDMI 1",icon:"mdi mdi-import"}),H.push({key:"source_hdmi2",label:"Source: HDMI 2",description:"Switch to HDMI 2",icon:"mdi mdi-import"}),H.push({key:"source_hdmi3",label:"Source: HDMI 3",description:"Switch to HDMI 3",icon:"mdi mdi-import"})),j.includes("channel")&&(H.push({key:"channel_up",label:"Channel Up",description:"Next channel",icon:"mdi mdi-chevron-up"}),H.push({key:"channel_down",label:"Channel Down",description:"Previous channel",icon:"mdi mdi-chevron-down"}))}else if(h.platform==="fan"){const j=h.config.speedLevels||3,K=h.config.features||[];H.push({key:"turn_on",label:"Power On",description:"Turn on the fan",icon:"mdi mdi-power"}),H.push({key:"turn_off",label:"Power Off",description:"Turn off the fan",icon:"mdi mdi-power-off"});for(let ce=1;ce<=j;ce++){const Pe=ce===1?"Low":ce===j?"High":ce===2&&j===3?"Medium":`Speed ${ce}`;H.push({key:`speed_${ce}`,label:`${Pe}`,description:`Set fan to speed level ${ce}`,icon:"mdi mdi-fan"})}K.includes("oscillate")&&(H.push({key:"oscillate_on",label:"Oscillate On",description:"Enable oscillation",icon:"mdi mdi-sync"}),H.push({key:"oscillate_off",label:"Oscillate Off",description:"Disable oscillation",icon:"mdi mdi-sync-off"})),K.includes("direction")&&(H.push({key:"direction_forward",label:"Direction: Forward",description:"Set direction to forward",icon:"mdi mdi-rotate-right"}),H.push({key:"direction_reverse",label:"Direction: Reverse",description:"Set direction to reverse",icon:"mdi mdi-rotate-left"}))}else if(h.platform==="light"){const j=h.config.features||[];j.includes("turn_on")&&(H.push({key:"turn_on",label:"Power On",description:"Turn on the light",icon:"mdi mdi-lightbulb-on"}),H.push({key:"turn_off",label:"Power Off",description:"Turn off the light",icon:"mdi mdi-lightbulb-off"})),j.includes("brightness")&&(H.push({key:"brightness_up",label:"Brightness Up",description:"Increase brightness",icon:"mdi mdi-brightness-7"}),H.push({key:"brightness_down",label:"Brightness Down",description:"Decrease brightness",icon:"mdi mdi-brightness-5"})),j.includes("color_temp")&&(H.push({key:"color_temp_warm",label:"Warm White",description:"Set to warm white",icon:"mdi mdi-weather-sunset"}),H.push({key:"color_temp_cool",label:"Cool White",description:"Set to cool white",icon:"mdi mdi-weather-sunny"})),j.includes("rgb")&&(H.push({key:"color_red",label:"Color: Red",description:"Set color to red",icon:"mdi mdi-palette"}),H.push({key:"color_green",label:"Color: Green",description:"Set color to green",icon:"mdi mdi-palette"}),H.push({key:"color_blue",label:"Color: Blue",description:"Set color to blue",icon:"mdi mdi-palette"}))}return H}),b=X(()=>o.value.length),P=X(()=>Object.keys(s.value).length),p=X(()=>b.value===0?0:Math.round(P.value/b.value*100));function Z(H){return{off:"mdi mdi-power",auto:"mdi mdi-autorenew",cool:"mdi mdi-snowflake",heat:"mdi mdi-fire",dry:"mdi mdi-water-percent",fan_only:"mdi mdi-fan"}[H]||"mdi mdi-remote"}async function ne(H){if(!m.value){if(!_.value){q.value=!0,window.scrollTo({top:0,behavior:"smooth"});return}q.value=!1,m.value=H.key;try{const j=h.manufacturer.toLowerCase().replace(/[^a-z0-9]+/g,"_"),K=h.model.toLowerCase().replace(/[^a-z0-9]+/g,"_"),ce=`${j}_${K}`,Te=(await oe.post("/api/commands/learn",{entity_id:_.value,device:ce,command:H.key,command_type:L.value})).data;if(Te.success&&Te.code)s.value[H.key]=Te.code,w("update:modelValue",s.value),V.value=!0,Te.code==="pending"&&(console.log(`â³ Command '${H.key}' learned, backend will fetch code from storage automatically`),D.value||(console.log("ğŸ”„ Starting polling because command is pending"),M())),k.value&&n.value.length>0&&setTimeout(()=>{const ee=n.value.shift();ee?ne(ee):k.value=!1},1e3);else throw new Error(Te.error||"Failed to learn command")}catch(j){console.error("Error learning command:",j),i.error(`Error learning command: ${j.message}`),k.value=!1,n.value=[]}finally{k.value||(m.value=null)}}}async function z(H){var j;if(!_.value){q.value=!0,window.scrollTo({top:0,behavior:"smooth"});return}if(!s.value[H]){(j=i.value)==null||j.error("Command not learned yet");return}f.value=H;try{const K=s.value[H];await oe.post("/api/commands/send-raw",{entity_id:_.value,command:K,command_type:L.value}),i.success("Command sent successfully")}catch(K){console.error("Error testing command:",K),i.error(`Error testing command: ${K.message}`)}finally{f.value=null}}function T(H){const j=o.value.find(K=>K.key===H);F.value={show:!0,commandKey:H,commandLabel:j?j.label:H}}function N(){const H=F.value.commandKey;delete s.value[H],w("update:modelValue",s.value),F.value.show=!1}function se(){const H=o.value.filter(K=>!s.value[K.key]);if(H.length===0)return;k.value=!0,n.value=[...H];const j=n.value.shift();j&&ne(j)}function fe(){R.value=!0}function Re(){s.value={},w("update:modelValue",s.value),R.value=!1}ue(()=>h.modelValue,H=>{s.value={...H}},{deep:!0}),Ee(async()=>{await Oe()});async function Oe(){try{console.log("SmartIR device - commands will be loaded from SmartIR JSON file, not Broadlink storage")}catch(H){console.error("Error in loadExistingCommands:",H)}}function Ae(){w("update:broadlinkDevice",_.value)}function De(){w("update:commandType",L.value)}async function Y(){try{console.log("ğŸ” Loading Broadlink devices from /api/remote/devices");const H=await oe.get("/api/remote/devices");console.log("ğŸ“¦ Response data:",H.data);const j=H.data.devices||[];console.log(`âœ… Found ${j.length} devices:`,j),S.value=j}catch(H){console.error("âŒ Error loading remote devices:",H),S.value=[]}}ue(()=>h.broadlinkDevice,H=>{_.value=H}),ue(_,H=>{H&&(q.value=!1)}),ue(()=>h.commandType,H=>{L.value=H});function M(){D.value||(console.log("ğŸ”„ Starting polling for pending commands"),D.value=setInterval(async()=>{try{const H=Object.entries(s.value).filter(([K,ce])=>ce==="pending");if(H.length===0){te();return}console.log(`ğŸ”„ Polling for ${H.length} pending command(s)...`);let j=!1;for(const[K,ce]of H)h.modelValue[K]&&h.modelValue[K]!=="pending"&&(console.log(`âœ… Command '${K}' resolved: ${h.modelValue[K].substring(0,20)}...`),s.value[K]=h.modelValue[K],j=!0);j&&(w("update:modelValue",s.value),i.success("Commands updated successfully!"))}catch(H){console.error("Error polling for pending commands:",H)}},3e3),setTimeout(()=>{D.value&&(console.log("â±ï¸ Pending commands polling timeout reached (60s)"),te(),Object.entries(s.value).forEach(([H,j])=>{j==="pending"&&console.warn(`âš ï¸ Command '${H}' still pending after timeout`)}))},6e4))}function te(){D.value&&(clearInterval(D.value),D.value=null,console.log("ğŸ›‘ Stopped polling for pending commands"))}return ue(()=>s.value,H=>{const j=Object.values(H).some(K=>K==="pending");j&&!D.value?console.log(`â³ ${Object.values(H).filter(K=>K==="pending").length} command(s) pending - waiting for backend to resolve`):!j&&D.value&&te()},{deep:!0}),Ee(async()=>{await Y(),await Oe()}),qe(()=>{te()}),(H,j)=>(a(),r("div",md,[j[20]||(j[20]=e("h3",null,"Learn IR Commands",-1)),e("div",vd,[e("div",{class:G(["form-group",{"has-error":q.value}])},[j[6]||(j[6]=e("label",null,"Broadlink Device *",-1)),e("div",pd,[W(e("select",{"onUpdate:modelValue":j[0]||(j[0]=K=>_.value=K),onChange:Ae},[j[4]||(j[4]=e("option",{value:""},"Select Broadlink device...",-1)),(a(!0),r(he,null,$e(S.value,K=>(a(),r("option",{key:K.entity_id,value:K.entity_id},v(K.name||K.entity_id),9,fd))),128))],544),[[Me,_.value]]),q.value?(a(),r("div",gd,[...j[5]||(j[5]=[e("i",{class:"mdi mdi-alert"},null,-1),x(" Device is required ",-1)])])):O("",!0)]),e("small",null,"This device will be used to learn commands ("+v(S.value.length)+" devices found)",1)],2),e("div",yd,[j[8]||(j[8]=e("label",null,"Command Type *",-1)),W(e("select",{"onUpdate:modelValue":j[1]||(j[1]=K=>L.value=K),onChange:De,disabled:P.value>0},[...j[7]||(j[7]=[e("option",{value:"ir"},"ğŸ“¡ Infrared (IR) - Most common for AC, TV, etc.",-1),e("option",{value:"rf"},"ğŸ“» Radio Frequency (RF) - For RF remotes",-1)])],40,bd),[[Me,L.value]]),P.value>0?(a(),r("small",hd,"Command type cannot be changed after learning commands")):(a(),r("small",kd,"Select the type of commands your device uses"))])]),P.value>0&&!V.value?(a(),r("div",wd,[j[10]||(j[10]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[j[9]||(j[9]=e("strong",null,"Editing Existing Profile",-1)),e("p",null,v(P.value)+" command"+v(P.value!==1?"s":"")+' already learned. You can re-learn any command by clicking the delete icon and then "Learn Command".',1)])])):O("",!0),e("div",$d,[j[14]||(j[14]=e("i",{class:"mdi mdi-information"},null,-1)),e("div",null,[j[13]||(j[13]=e("p",null,[e("strong",null,"How it works:")],-1)),t.commandType==="ir"?(a(),r("ol",Cd,[...j[11]||(j[11]=[e("li",null,'Click "Learn Command" for each combination',-1),e("li",null,[e("strong",null,"Point your IR remote directly at the Broadlink device")],-1),e("li",null,"Press the button on your remote",-1),e("li",null,"Wait for confirmation (up to 30 seconds)",-1)])])):(a(),r("ol",_d,[...j[12]||(j[12]=[e("li",null,'Click "Learn Command" for each combination',-1),e("li",null,[e("strong",null,"Step 1:"),x(" Hold button on remote - Broadlink scans for RF frequency")],-1),e("li",null,[e("strong",null,"Step 2:"),x(" Watch for Home Assistant notification, then press and release button")],-1),e("li",null,"Keep remote within 5cm of Broadlink (RF doesn't need line-of-sight)",-1),e("li",null,"Wait for confirmation (may take up to 30 seconds)",-1)])]))])]),e("div",Sd,[e("div",Id,[e("div",{class:"progress-fill",style:ft({width:p.value+"%"})},null,4)]),e("span",Dd,v(P.value)+" / "+v(b.value)+" commands learned ("+v(p.value)+"%) ",1)]),e("div",xd,[(a(!0),r(he,null,$e(o.value,K=>(a(),r("div",{key:K.key,class:G(["command-card",{learned:s.value[K.key],learning:m.value===K.key}])},[e("div",Td,[e("div",Md,[e("i",{class:G(K.icon)},null,2)]),e("div",Rd,[e("h4",null,v(K.label),1),e("p",null,v(K.description),1)])]),m.value===K.key?(a(),r("div",Ed,[t.commandType==="ir"?(a(),r("div",Od,[...j[15]||(j[15]=[e("p",null,[e("strong",null,"Point your remote directly at the Broadlink device and press the button.")],-1),e("small",null,"Listening for up to 30 seconds...",-1)])])):(a(),r("div",Ad,[...j[16]||(j[16]=[e("p",{class:"rf-title"},[e("strong",null,"Learning request sent to device.")],-1),e("p",{class:"rf-subtitle"},[x("RF learning is a "),e("strong",null,"two-step process"),x(":")],-1),e("ol",null,[e("li",null,[e("strong",null,"Step 1 - Frequency Sweep (~10-15 seconds):"),x(" Press and hold the button on your remote until the notification updates. ")]),e("li",null,[e("strong",null,"Step 2 - Learn Signal:"),x(" Press and release the button once. ")])],-1),e("p",{class:"rf-note"},"Follow the Home Assistant notifications (ğŸ””) for real-time instructions.",-1)])]))])):O("",!0),e("div",Ld,[s.value[K.key]?(a(),r("div",{key:1,class:G(["learned-status",{pending:s.value[K.key]==="pending"}])},[e("i",{class:G(["mdi",s.value[K.key]==="pending"?"mdi-clock-outline":"mdi-check-circle"])},null,2),e("span",null,v(s.value[K.key]==="pending"?"Pending":"Learned"),1),e("span",{class:G(["command-type-badge",L.value])},v(L.value.toUpperCase()),3),e("button",{onClick:ce=>z(K.key),class:"icon-btn",title:"Test command",disabled:f.value===K.key||s.value[K.key]==="pending",style:{"margin-left":"auto"}},[e("i",{class:G(["mdi mdi-play",{"mdi-spin":f.value===K.key}])},null,2)],8,Vd),e("button",{onClick:ce=>T(K.key),class:"icon-btn danger",title:"Delete and re-learn"},[...j[17]||(j[17]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,jd)],2)):(a(),r("button",{key:0,onClick:ce=>ne(K),class:G(["btn-learn",{learning:m.value===K.key}]),disabled:m.value!==null},[e("i",{class:G(["mdi mdi-radio-tower",{"mdi-spin":m.value===K.key}])},null,2),x(" "+v(m.value===K.key?"Listening...":"Learn Command"),1)],10,Pd))])],2))),128))]),e("div",Ud,[e("button",{onClick:se,class:"btn-secondary",disabled:m.value!==null||P.value===b.value},[...j[18]||(j[18]=[e("i",{class:"mdi mdi-play-circle"},null,-1),x(" Learn All Remaining ",-1)])],8,Fd),e("button",{onClick:fe,class:"btn-text",disabled:P.value===0},[...j[19]||(j[19]=[e("i",{class:"mdi mdi-delete-sweep"},null,-1),x(" Clear All ",-1)])],8,Nd)]),ke(He,{isOpen:F.value.show,title:"Delete Learned Command?",message:`Are you sure you want to delete the '${F.value.commandLabel}' command?

You will need to re-learn this command.`,confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,onConfirm:N,onCancel:j[2]||(j[2]=K=>F.value.show=!1)},null,8,["isOpen","message"]),ke(He,{isOpen:R.value,title:"Delete All Learned Commands?",message:"Are you sure you want to delete all learned commands? This cannot be undone.\\n\\nYou will need to re-learn all commands.",confirmText:"Delete All",cancelText:"Cancel",dangerMode:!0,onConfirm:Re,onCancel:j[3]||(j[3]=K=>R.value=!1)},null,8,["isOpen"])]))}},Hd=Se(Bd,[["__scopeId","data-v-4567eea7"]]),qd={class:"profile-preview"},zd={class:"preview-summary"},Jd={class:"summary-card"},Wd={class:"stats-grid"},Gd={class:"stat-item"},Kd={class:"stat-value"},Xd={class:"stat-item"},Yd={class:"stat-value"},Zd={class:"stat-item"},Qd={class:"stat-value"},eu={class:"preview-tabs"},tu={class:"preview-content"},ou={key:0,class:"tab-content"},lu={class:"code-header"},nu={class:"code-block"},su={key:1,class:"tab-content"},au={class:"code-header"},iu={class:"code-block"},ru={key:2,class:"tab-content"},du={class:"instructions"},uu={class:"step-item"},cu={class:"step-content"},mu={class:"code-path"},vu={__name:"ProfilePreview",props:{profile:{type:Object,required:!0},jsonData:{type:Object,required:!0},yamlConfig:{type:String,required:!0}},setup(t){const c=Ge(),i=t,h=g("json"),w=g(!1),s=g(!1),m=X(()=>Object.keys(i.profile.commands||{}).length),f=X(()=>JSON.stringify(i.jsonData,null,2));async function S(){try{await navigator.clipboard.writeText(f.value),w.value=!0,setTimeout(()=>{w.value=!1},2e3)}catch(L){console.error("Failed to copy JSON:",L),c.error("Failed to copy to clipboard")}}async function _(){try{await navigator.clipboard.writeText(i.yamlConfig),s.value=!0,setTimeout(()=>{s.value=!1},2e3)}catch(L){console.error("Failed to copy YAML:",L),c.error("Failed to copy to clipboard")}}return(L,k)=>{var n;return a(),r("div",qd,[k[22]||(k[22]=e("h3",null,"Preview & Save",-1)),e("div",zd,[e("div",Jd,[k[4]||(k[4]=e("i",{class:"mdi mdi-check-circle"},null,-1)),e("div",null,[k[3]||(k[3]=e("h4",null,"Profile Ready!",-1)),e("p",null,v(t.profile.manufacturer)+" "+v(t.profile.model),1)])]),e("div",Wd,[e("div",Gd,[e("span",Kd,v(m.value),1),k[5]||(k[5]=e("span",{class:"stat-label"},"Commands Learned",-1))]),e("div",Xd,[e("span",Yd,v(t.profile.platform),1),k[6]||(k[6]=e("span",{class:"stat-label"},"Platform",-1))]),e("div",Zd,[e("span",Qd,v(((n=t.profile.config.modes)==null?void 0:n.length)||0),1),k[7]||(k[7]=e("span",{class:"stat-label"},"HVAC Modes",-1))])])]),e("div",eu,[e("button",{onClick:k[0]||(k[0]=V=>h.value="json"),class:G(["tab-button",{active:h.value==="json"}])},[...k[8]||(k[8]=[e("i",{class:"mdi mdi-code-json"},null,-1),x(" SmartIR JSON ",-1)])],2),e("button",{onClick:k[1]||(k[1]=V=>h.value="yaml"),class:G(["tab-button",{active:h.value==="yaml"}])},[...k[9]||(k[9]=[e("i",{class:"mdi mdi-file-code"},null,-1),x(" YAML Config ",-1)])],2),e("button",{onClick:k[2]||(k[2]=V=>h.value="instructions"),class:G(["tab-button",{active:h.value==="instructions"}])},[...k[10]||(k[10]=[e("i",{class:"mdi mdi-information"},null,-1),x(" Instructions ",-1)])],2)]),e("div",tu,[h.value==="json"?(a(),r("div",ou,[e("div",lu,[k[12]||(k[12]=e("h4",null,"SmartIR Device Code JSON",-1)),e("button",{onClick:S,class:"btn-copy"},[k[11]||(k[11]=e("i",{class:"mdi mdi-content-copy"},null,-1)),x(" "+v(w.value?"Copied!":"Copy"),1)])]),e("pre",nu,[e("code",null,v(f.value),1)]),k[13]||(k[13]=e("p",{class:"code-note"},[e("i",{class:"mdi mdi-information"}),x(" Save this as "),e("code",null,"10000.json"),x(" in your SmartIR codes directory ")],-1))])):O("",!0),h.value==="yaml"?(a(),r("div",su,[e("div",au,[k[15]||(k[15]=e("h4",null,"Home Assistant Configuration",-1)),e("button",{onClick:_,class:"btn-copy"},[k[14]||(k[14]=e("i",{class:"mdi mdi-content-copy"},null,-1)),x(" "+v(s.value?"Copied!":"Copy"),1)])]),e("pre",iu,[e("code",null,v(t.yamlConfig),1)]),k[16]||(k[16]=e("p",{class:"code-note"},[e("i",{class:"mdi mdi-information"}),x(" Add this to your "),e("code",null,"configuration.yaml"),x(" file ")],-1))])):O("",!0),h.value==="instructions"?(a(),r("div",ru,[e("div",du,[k[20]||(k[20]=e("h4",null,"Installation Steps",-1)),e("div",uu,[k[19]||(k[19]=e("div",{class:"step-number"},"1",-1)),e("div",cu,[k[17]||(k[17]=e("h5",null,"Get Next Code Number",-1)),k[18]||(k[18]=e("p",null,"Custom device codes start at 10000. Check your SmartIR codes directory to find the next available number.",-1)),e("div",mu,[e("code",null,"/config/custom_components/smartir/codes/"+v(t.profile.platform)+"/",1)])])]),k[21]||(k[21]=ze('<div class="step-item" data-v-e7b997c8><div class="step-number" data-v-e7b997c8>2</div><div class="step-content" data-v-e7b997c8><h5 data-v-e7b997c8>Save JSON File</h5><p data-v-e7b997c8>Copy the JSON from the &quot;SmartIR JSON&quot; tab and save it as <code data-v-e7b997c8>10000.json</code> (or your next available number) in the codes directory.</p></div></div><div class="step-item" data-v-e7b997c8><div class="step-number" data-v-e7b997c8>3</div><div class="step-content" data-v-e7b997c8><h5 data-v-e7b997c8>Update Configuration</h5><p data-v-e7b997c8>Copy the YAML from the &quot;YAML Config&quot; tab and add it to your <code data-v-e7b997c8>configuration.yaml</code> file. Update the <code data-v-e7b997c8>device_code</code> to match your JSON filename.</p></div></div><div class="step-item" data-v-e7b997c8><div class="step-number" data-v-e7b997c8>4</div><div class="step-content" data-v-e7b997c8><h5 data-v-e7b997c8>Restart Home Assistant</h5><p data-v-e7b997c8>Restart Home Assistant to load the new configuration. Your climate entity will appear in the UI.</p></div></div><div class="step-item" data-v-e7b997c8><div class="step-number" data-v-e7b997c8>5</div><div class="step-content" data-v-e7b997c8><h5 data-v-e7b997c8>Test Your Device</h5><p data-v-e7b997c8>Go to your climate entity and test different modes, temperatures, and fan speeds to ensure everything works correctly.</p></div></div><div class="tips-section" data-v-e7b997c8><h4 data-v-e7b997c8><i class="mdi mdi-lightbulb" data-v-e7b997c8></i> Tips </h4><ul data-v-e7b997c8><li data-v-e7b997c8>Keep a backup of your JSON file in case you need to modify it</li><li data-v-e7b997c8>Test all commands to ensure they work as expected</li><li data-v-e7b997c8>You can share your profile with the SmartIR community on GitHub</li><li data-v-e7b997c8>If a command doesn&#39;t work, you can re-learn it and update the JSON</li></ul></div>',5))])])):O("",!0)])])}}},pu=Se(vu,[["__scopeId","data-v-e7b997c8"]]),fu={class:"wizard-body"},gu={key:0,class:"warning-section"},yu={class:"warning-box"},bu={class:"instructions"},hu={class:"code-block"},ku={class:"steps"},wu={key:0},$u={class:"help-section"},Cu={key:0,class:"help-content"},_u={class:"help-step"},Su={key:0,class:"help-step"},Iu={class:"help-step"},Du={class:"help-step"},xu={class:"checklist"},Tu={class:"checkbox-label"},Mu={key:0,class:"checkbox-label"},Ru={class:"wizard-footer"},Eu=["disabled"],Ou={__name:"SmartIRSetupWizard",props:{show:{type:Boolean,default:!1},platform:{type:String,required:!0},warnings:{type:Array,default:()=>[]},configPath:{type:String,default:"/config"}},emits:["close","complete"],setup(t,{emit:c}){const i=t,h=c,w=Le("toast"),s=g(!1),m=g(!1),f=g(!1),S=X(()=>i.warnings.length>0?s.value&&m.value:s.value);function _(){const k=`${i.platform}: !include smartir/${i.platform}.yaml`;navigator.clipboard.writeText(k).then(()=>{var n;(n=w.value)==null||n.success("Include line copied to clipboard!","âœ… Copied")}).catch(n=>{var V;console.error("Failed to copy:",n),(V=w.value)==null||V.error("Failed to copy to clipboard","âŒ Copy Failed")})}function L(){h("complete")}return(k,n)=>t.show?(a(),r("div",{key:0,class:"modal-overlay",onClick:n[5]||(n[5]=be(()=>{},["stop"]))},[e("div",{class:"setup-wizard",onClick:n[4]||(n[4]=be(()=>{},["stop"]))},[n[31]||(n[31]=e("div",{class:"wizard-header"},[e("h2",null,[e("i",{class:"mdi mdi-cog"}),x(" SmartIR Configuration Setup ")])],-1)),e("div",fu,[t.warnings.length>0?(a(),r("div",gu,[e("div",yu,[n[11]||(n[11]=e("i",{class:"mdi mdi-alert"},null,-1)),e("div",null,[n[9]||(n[9]=e("h3",null,"âš ï¸ Configuration Migration Needed",-1)),n[10]||(n[10]=e("p",null,"We detected existing platform entries in your configuration.yaml:",-1)),e("ul",null,[(a(!0),r(he,null,$e(t.warnings,V=>(a(),r("li",{key:V.platform},[e("strong",null,v(V.platform)+":",1),x(" "+v(V.message),1)]))),128))]),e("p",null,[n[6]||(n[6]=e("strong",null,"Action Required:",-1)),n[7]||(n[7]=x(" Move these entries to ",-1)),e("code",null,"smartir/"+v(t.platform)+".yaml",1),n[8]||(n[8]=x(" before continuing.",-1))])])])])):O("",!0),e("div",bu,[n[27]||(n[27]=e("h3",null,"ğŸ“ One-Time Setup",-1)),n[28]||(n[28]=e("p",null,[x("To enable SmartIR device management, add this line to your "),e("code",null,"configuration.yaml"),x(":")],-1)),e("div",hu,[e("code",null,v(t.platform)+": !include smartir/"+v(t.platform)+".yaml",1),e("button",{onClick:_,class:"copy-btn",title:"Copy to clipboard"},[...n[12]||(n[12]=[e("i",{class:"mdi mdi-content-copy"},null,-1)])])]),e("div",ku,[n[19]||(n[19]=e("h4",null,"Steps:",-1)),e("ol",null,[t.warnings.length>0?(a(),r("li",wu,[n[13]||(n[13]=e("strong",null,"Move existing entries:",-1)),n[14]||(n[14]=x(" Copy any existing ",-1)),e("code",null,v(t.platform)+":",1),n[15]||(n[15]=x(" entries from configuration.yaml to ",-1)),e("code",null,"smartir/"+v(t.platform)+".yaml",1)])):O("",!0),n[16]||(n[16]=e("li",null,[e("strong",null,"Add include line:"),x(" Add the line above to your configuration.yaml ")],-1)),n[17]||(n[17]=e("li",null,[e("strong",null,"Save changes:"),x(" Save configuration.yaml ")],-1)),n[18]||(n[18]=e("li",null,[e("strong",null,"Continue here:"),x(` Click "I've Completed Setup" below `)],-1))])]),e("div",$u,[e("button",{onClick:n[0]||(n[0]=V=>f.value=!f.value),class:"help-toggle"},[e("i",{class:G(["mdi",f.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2),x(" "+v(f.value?"Hide":"Show")+" Detailed Instructions ",1)]),f.value?(a(),r("div",Cu,[n[26]||(n[26]=e("h4",null,"Detailed Setup Guide:",-1)),e("div",_u,[n[21]||(n[21]=e("h5",null,"1. Open configuration.yaml",-1)),e("p",null,[n[20]||(n[20]=x("Location: ",-1)),e("code",null,v(t.configPath)+"/configuration.yaml",1)])]),t.warnings.length>0?(a(),r("div",Su,[n[22]||(n[22]=e("h5",null,"2. Migrate Existing Entries (If Any)",-1)),e("p",null,"If you have existing "+v(t.platform)+" entries, cut them from configuration.yaml and paste into:",1),e("p",null,[e("code",null,v(t.configPath)+"/smartir/"+v(t.platform)+".yaml",1)]),n[23]||(n[23]=e("p",{class:"note"},"Broadlink Manager will create this file automatically.",-1))])):O("",!0),e("div",Iu,[e("h5",null,v(t.warnings.length>0?"3":"2")+". Add Include Line",1),n[24]||(n[24]=e("p",null,"Add this to configuration.yaml:",-1)),e("pre",null,v(t.platform)+": !include smartir/"+v(t.platform)+".yaml",1)]),e("div",Du,[e("h5",null,v(t.warnings.length>0?"4":"3")+". Restart Home Assistant",1),n[25]||(n[25]=e("p",null,"After saving, you'll need to restart HA for changes to take effect.",-1))])])):O("",!0)])]),e("div",xu,[e("label",Tu,[W(e("input",{type:"checkbox","onUpdate:modelValue":n[1]||(n[1]=V=>s.value=V)},null,512),[[me,s.value]]),n[29]||(n[29]=e("span",null,"I've added the include line to configuration.yaml",-1))]),t.warnings.length>0?(a(),r("label",Mu,[W(e("input",{type:"checkbox","onUpdate:modelValue":n[2]||(n[2]=V=>m.value=V)},null,512),[[me,m.value]]),e("span",null,"I've migrated existing "+v(t.platform)+" entries (if any)",1)])):O("",!0)])]),e("div",Ru,[e("button",{onClick:n[3]||(n[3]=V=>k.$emit("close")),class:"btn-secondary"}," Cancel "),e("button",{onClick:L,class:"btn-primary",disabled:!S.value},[...n[30]||(n[30]=[e("i",{class:"mdi mdi-check"},null,-1),x(" I've Completed Setup ",-1)])],8,Eu)])])])):O("",!0)}},Au=Se(Ou,[["__scopeId","data-v-f6fe4c03"]]),Lu={class:"modal-header"},Pu={class:"progress-steps"},Vu={class:"step-number"},ju={key:0,class:"mdi mdi-check"},Uu={key:1},Fu={class:"step-label"},Nu={class:"modal-body"},Bu={key:0,class:"step-content"},Hu={class:"form-group"},qu={class:"form-group"},zu={class:"form-group"},Ju={key:1,class:"step-content"},Wu={key:1,class:"platform-form"},Gu={class:"form-section"},Ku={class:"checkbox-grid"},Xu={class:"checkbox-item"},Yu={class:"checkbox-item"},Zu={class:"checkbox-item"},Qu={class:"checkbox-item"},ec={class:"checkbox-item"},tc={key:2,class:"platform-form"},oc={class:"form-section"},lc={class:"form-group"},nc={class:"form-section"},sc={class:"checkbox-grid"},ac={class:"checkbox-item"},ic={class:"checkbox-item"},rc={key:3,class:"platform-form"},dc={class:"form-section"},uc={class:"checkbox-grid"},cc={class:"checkbox-item"},mc={class:"checkbox-item"},vc={class:"checkbox-item"},pc={class:"checkbox-item"},fc={key:2,class:"step-content"},gc={key:3,class:"step-content"},yc={class:"modal-footer"},bc=["disabled"],hc={key:2,class:"save-buttons"},kc=["disabled"],wc=["disabled"],$c={__name:"SmartIRProfileBuilder",props:{show:{type:Boolean,default:!1},editMode:{type:Boolean,default:!1},editData:{type:Object,default:null},startStep:{type:Number,default:0}},emits:["close","save"],setup(t,{emit:c}){const i=t,h=c,w=Le("toast"),s=g(0),m=g(!1),f=g([]),S=g(!1),_=g([]),L=g("/config"),k=g(!1),n=g(null),V=g(!1),q=g(!1),F=g(""),R=g("ir"),D=g(!1),o=g(null),b=g(null),P=[{label:"Device Info",key:"info"},{label:"Configuration",key:"config"},{label:"Learn Commands",key:"commands"},{label:"Preview & Save",key:"preview"}],p=g({platform:"",manufacturer:"",model:"",broadlinkDevice:"",commandType:"ir",config:{features:["turn_on"]},commands:{}}),Z=g(["turn_on"]),ne=g(3),z=g([]),T=g(["turn_on"]);ue(()=>p.value.platform,I=>{console.log("ğŸ¯ Platform changed to:",I,"mediaPlayerFeatures:",Z.value),I==="media_player"?(p.value.config={features:Z.value},console.log("ğŸ“º Set media_player config:",p.value.config,"features array:",p.value.config.features)):I==="fan"?(p.value.config={speedLevels:ne.value,features:z.value},console.log("ğŸŒ€ Set fan config:",p.value.config)):I==="light"?(p.value.config={features:T.value},console.log("ğŸ’¡ Set light config:",p.value.config)):I===""&&console.log("âš ï¸ Platform is empty string, skipping config initialization")},{immediate:!0}),ue(Z,I=>{p.value.platform==="media_player"&&(p.value.config={features:I})},{deep:!0}),ue(ne,I=>{p.value.platform==="fan"&&(p.value.config={speedLevels:I,features:z.value})}),ue(z,I=>{p.value.platform==="fan"&&(p.value.config={speedLevels:ne.value,features:I})},{deep:!0}),ue(T,I=>{p.value.platform==="light"&&(p.value.config={features:I})},{deep:!0});function N(I){const d=new Set,C=Object.keys(I);return C.some(J=>J==="off"||J.includes("_off"))&&d.add("off"),C.some(J=>J.includes("auto"))&&d.add("auto"),C.some(J=>J.includes("cool"))&&d.add("cool"),C.some(J=>J.includes("heat"))&&d.add("heat"),C.some(J=>J.includes("dry"))&&d.add("dry"),C.some(J=>J.includes("fan_only"))&&d.add("fan_only"),Array.from(d)}function se(I){const d=new Set,C=Object.keys(I);return C.some(J=>J.includes("auto"))&&d.add("auto"),C.some(J=>J.includes("low"))&&d.add("low"),C.some(J=>J.includes("medium")||J.includes("mid"))&&d.add("medium"),C.some(J=>J.includes("high"))&&d.add("high"),Array.from(d)}function fe(I){const d=new Set,C=Object.keys(I);return C.some(J=>J.includes("swing_off")||J.includes("_off"))&&d.add("off"),C.some(J=>J.includes("vertical"))&&d.add("vertical"),C.some(J=>J.includes("horizontal"))&&d.add("horizontal"),C.some(J=>J.includes("both"))&&d.add("both"),Array.from(d)}function Re(I){const d=new Set,C=Object.keys(I);return C.some(J=>J.includes("none"))&&d.add("none"),C.some(J=>J.includes("eco"))&&d.add("eco"),C.some(J=>J.includes("boost"))&&d.add("boost"),C.some(J=>J.includes("sleep"))&&d.add("sleep"),C.some(J=>J.includes("away"))&&d.add("away"),C.some(J=>J.includes("comfort"))&&d.add("comfort"),Array.from(d)}function Oe(I){for(const d of Object.values(I))if(typeof d=="string"&&d.startsWith("sc")||Array.isArray(d)&&d.length>0&&typeof d[0]=="string"&&d[0].startsWith("sc"))return"rf";return"ir"}ue(()=>p.value.commandType,(I,d)=>{!d||V.value||D.value||(Object.keys(p.value.commands).length>0&&I!==d?(F.value=I,p.value.commandType=d,V.value=!0):I!==d&&(R.value=I))}),ue(()=>p.value.commands,I=>{if(!I||!i.editMode&&!b.value||i.editMode&&!i.editData)return;const d=Object.values(I).some(C=>typeof C=="string"?C==="pending":typeof C=="object"?Object.values(C).some(J=>typeof J=="string"?J==="pending":typeof J=="object"?Object.values(J).some(de=>de==="pending"):!1):!1);d?o.value?console.log("ğŸ”„ Polling already running, will pick up new pending commands"):(console.log("ğŸ”„ Starting polling to reload profile data from backend"),Ae()):!d&&o.value&&(console.log("âœ… All commands resolved, stopping polling"),De())},{deep:!0});function Ae(){if(o.value)return;let I,d;if(i.editMode&&i.editData)I=i.editData.platform,d=i.editData.code;else if(!i.editMode&&b.value)I=p.value.platform,d=b.value;else{console.warn("Cannot start polling: missing platform or code");return}o.value=setInterval(async()=>{try{console.log(`ğŸ”„ Polling profile ${I}/${d} for updated commands...`);const de=(await oe.get(`/api/smartir/platforms/${I}/profiles/${d}`)).data.profile.commands||{};let xe=!1;for(const[ie,Ue]of Object.entries(p.value.commands))Ue==="pending"&&(de[ie]&&de[ie]!=="pending"?(console.log(`âœ… Command '${ie}' resolved in profile: ${de[ie].substring(0,20)}...`),p.value.commands[ie]=de[ie],xe=!0):console.log(`â³ Command '${ie}' still pending in backend`));xe&&console.log("âœ… Updated commands from backend")}catch(C){console.error("Error polling for profile updates:",C)}},3e3),setTimeout(()=>{o.value&&(console.log("â±ï¸ Profile polling timeout reached (60s)"),De())},6e4)}function De(){o.value&&(clearInterval(o.value),o.value=null,console.log("ğŸ›‘ Stopped polling for profile updates"))}ue(()=>i.editData,async I=>{var d,C,J;if(I&&i.editMode){console.log("ğŸ”§ Edit mode activated, loading profile data:",I),D.value=!0,f.value.length===0&&(console.log("ğŸ“¡ Loading Broadlink devices..."),await _e(),console.log("ğŸ“¡ Devices loaded:",f.value.length));const de=I.profile,xe=de.controller_data;console.log("ğŸ® Controller data from profile:",xe),console.log("ğŸ® Available devices:",f.value.map(A=>A.entity_id));const ie=de.commands||{},Ue=de.commandType||Oe(ie);console.log("ğŸ” Command type (stored):",de.commandType),console.log("ğŸ” Command type (final):",Ue);let E={};if(I.platform==="climate"){const A=de.operationModes||N(ie),U=de.fanModes||se(ie),le=de.swingModes||fe(ie),ve=de.presetModes||Re(ie);console.log("ğŸ” Inferred modes:",A),console.log("ğŸ” Inferred fan modes:",U),console.log("ğŸ” Inferred swing modes:",le),console.log("ğŸ” Inferred preset modes:",ve),E={minTemp:de.minTemperature,maxTemp:de.maxTemperature,precision:de.precision,modes:A,fanModes:U,swingModes:le,presetModes:ve}}else if(I.platform==="media_player"){const A=[];(ie.on||ie.off)&&A.push("turn_on"),(ie.volumeUp||ie.volumeDown)&&A.push("volume"),ie.mute&&A.push("mute"),ie.sources&&A.push("source"),(ie.channelUp||ie.channelDown)&&A.push("channel"),E={features:A},Z.value=A,console.log("ğŸ” Inferred media player features:",A)}else if(I.platform==="fan"){const A=((d=de.speed)==null?void 0:d.length)||Object.keys(ie.default||{}).length||3,U=[];(ie.oscillate_on||ie.oscillate_off)&&U.push("oscillate"),(ie.direction_forward||ie.direction_reverse)&&U.push("direction"),E={speedLevels:A,features:U},ne.value=A,z.value=U,console.log("ğŸ” Inferred fan config:",E)}else if(I.platform==="light"){const A=[];E={features:A},T.value=A,console.log("ğŸ” Inferred light features:",A)}const $=await ae(de.manufacturer,(C=de.supportedModels)==null?void 0:C[0],ie);p.value={platform:I.platform,manufacturer:de.manufacturer||"",model:((J=de.supportedModels)==null?void 0:J[0])||"",broadlinkDevice:xe||"",commandType:Ue,config:E,commands:$},console.log("âœ… Profile populated:",p.value),console.log("âœ… Selected device:",p.value.broadlinkDevice),console.log("âœ… Command type:",p.value.commandType),console.log("âœ… Commands (with learned codes):",$),R.value=Ue,setTimeout(()=>{D.value=!1},100)}},{immediate:!0});const Y=X(()=>{var I;switch(s.value){case 0:return p.value.platform&&p.value.manufacturer&&p.value.model;case 1:return p.value.platform==="climate"?p.value.config.minTemp&&p.value.config.maxTemp&&((I=p.value.config.modes)==null?void 0:I.length)>0:!0;case 2:const d=Object.keys(p.value.commands).length>0,C=Object.values(p.value.commands).some(J=>typeof J=="string"?J==="pending":typeof J=="object"?Object.values(J).some(de=>typeof de=="string"?de==="pending":typeof de=="object"?Object.values(de).some(xe=>xe==="pending"):!1):!1);return p.value.broadlinkDevice&&p.value.commandType&&d&&!C;case 3:return!0;default:return!1}}),M=g(null);async function te(){if(s.value!==3){M.value=null;return}if(console.log("ğŸ” Generating JSON with commands:",p.value.commands),Object.values(p.value.commands).some(d=>typeof d=="string"?d==="pending":typeof d=="object"?Object.values(d).some(C=>typeof C=="string"?C==="pending":typeof C=="object"?Object.values(C).some(J=>J==="pending"):!1):!1)){console.warn('âš ï¸ Commands still contain "pending" placeholders!'),console.log("ğŸ“¦ Attempting to fetch from Broadlink storage...");const d=await ae(p.value.manufacturer,p.value.model,p.value.commands);p.value.commands=d,console.log("âœ… Updated commands:",d)}M.value=Ce(p.value),console.log("ğŸ“„ Generated JSON:",M.value)}const H=X(()=>s.value!==3?null:ge(p.value));function j(){p.value.config={},p.value.commands={}}function K(){V.value=!1,p.value.commandType=F.value,R.value=F.value,p.value.commands={},F.value=""}function ce(){V.value=!1,F.value=""}async function Pe(){s.value<P.length-1&&(s.value===0&&!i.editMode&&await Te(),s.value===1&&(console.log("ğŸ“‹ Moving to Learn Commands - ensuring config is set"),p.value.platform==="media_player"?(p.value.config={features:Z.value},console.log("ğŸ“º Set media_player config:",p.value.config)):p.value.platform==="fan"?(p.value.config={speedLevels:ne.value,features:z.value},console.log("ğŸŒ€ Set fan config:",p.value.config)):p.value.platform==="light"&&(p.value.config={features:T.value},console.log("ğŸ’¡ Set light config:",p.value.config))),s.value++,s.value===3&&await te())}async function Te(){var I,d;try{const J=(await oe.get(`/api/smartir/platforms/${p.value.platform}/next-code`)).data.next_code;console.log(`ğŸ†• Initializing profile file with code ${J}`);const de=await oe.post("/api/smartir/profiles/initialize",{platform:p.value.platform,manufacturer:p.value.manufacturer,model:p.value.model,code_number:J});de.data.success&&(b.value=J,console.log(`âœ… Profile file initialized: ${de.data.filename}`),(I=w.value)==null||I.success(`Profile file created: ${de.data.filename}`))}catch(C){console.error("Error initializing profile file:",C),(d=w.value)==null||d.error("Failed to initialize profile file")}}function ee(){s.value>0&&s.value--}function y(){V.value||(q.value=!0)}async function u(){q.value=!1,await l()}async function l(){if(b.value&&!i.editMode)try{console.log(`ğŸ—‘ï¸ Deleting initialized profile ${b.value} (user cancelled)`),await oe.delete(`/api/smartir/profiles/${b.value}`,{data:{platform:p.value.platform}}),console.log("âœ… Cleaned up initialized profile file")}catch(I){console.error("Error cleaning up profile file:",I)}h("close"),setTimeout(()=>{s.value=0,p.value={platform:"",manufacturer:"",model:"",broadlinkDevice:"",commandType:"ir",config:{},commands:{}},R.value="ir",b.value=null},300)}async function B(){var I,d,C,J,de,xe;m.value=!0;try{if(!k.value){const U=(await oe.get("/api/smartir/config/check")).data;if(U&&!((I=U.platforms[p.value.platform])==null?void 0:I.file_exists)){_.value=U.configuration_warnings||[],L.value=U.config_path||"/config",n.value={platform:p.value.platform,json:M.value},S.value=!0,m.value=!1;return}}let ie;i.editMode&&((d=i.editData)!=null&&d.code)?(ie=parseInt(i.editData.code),console.log("ğŸ“ Edit mode: Using existing code",ie)):b.value?(ie=b.value,console.log("âœ¨ New profile: Using initialized code",ie)):(ie=(await oe.get(`/api/smartir/platforms/${p.value.platform}/next-code`)).data.next_code,console.log("âš ï¸ Fallback: Using next code",ie));const E=(await oe.post("/api/smartir/profiles",{platform:p.value.platform,json:M.value,code_number:ie})).data,$={platform:"smartir",name:`${p.value.manufacturer} ${p.value.model}`,unique_id:`${p.value.manufacturer.toLowerCase().replace(/[^a-z0-9]+/g,"_")}_${p.value.model.toLowerCase().replace(/[^a-z0-9]+/g,"_")}`,device_code:ie,controller_data:p.value.broadlinkDevice};try{await oe.post("/api/smartir/config/add-device",{platform:p.value.platform,device_config:{platform:"smartir",name:$.name,unique_id:$.unique_id,device_code:$.device_code,controller_data:$.controller_data}})}catch(A){console.error("Failed to add device to config:",A);const U=((C=A.response)==null?void 0:C.data)||{};let le=U.error||"Unknown error";U.validation_errors&&U.validation_errors.length>0&&(le=`Device configuration validation failed:
`+U.validation_errors.map(ve=>`  â€¢ ${ve}`).join(`
`)),(J=w.value)==null||J.warning(`Profile saved but failed to add to config file:
${le}`,"âš ï¸ Partial Success")}h("save",{json:M.value,yaml:H.value,profile:p.value,saved_to:E.path}),(de=w.value)==null||de.success(`âœ… Profile saved to custom_codes/${p.value.platform}/${E.filename}
âœ… Device added to smartir/${p.value.platform}.yaml
âœ… Profile visible in Broadlink Manager immediately

âš ï¸ Restart Home Assistant for SmartIR integration to use this profile`,"âœ… Profile Saved Successfully!"),b.value=null,l()}catch(ie){console.error("Error saving profile:",ie),(xe=w.value)==null||xe.error(ie.message,"âŒ Error Saving Profile")}finally{m.value=!1}}async function Q(){k.value=!0,S.value=!1,n.value&&(await B(),n.value=null)}function re(){var I,d;try{const C=JSON.stringify(M.value,null,2),J=new Blob([C],{type:"application/json"}),de=URL.createObjectURL(J),xe=document.createElement("a");xe.href=de;const ie=p.value.manufacturer.toLowerCase().replace(/\s+/g,"_"),Ue=p.value.model.toLowerCase().replace(/\s+/g,"_");xe.download=`smartir_${p.value.platform}_${ie}_${Ue}.json`,document.body.appendChild(xe),xe.click(),document.body.removeChild(xe),URL.revokeObjectURL(de),(I=w.value)==null||I.success("You can manually upload this file to your SmartIR codes directory.","âœ… Profile Downloaded")}catch(C){console.error("Error downloading profile:",C),(d=w.value)==null||d.error(C.message,"âŒ Error Downloading Profile")}}async function ae(I,d,C){const J=I.toLowerCase().replace(/[^a-z0-9]+/g,"_"),de=d.toLowerCase().replace(/[^a-z0-9]+/g,"_"),xe=`${J}_${de}`;try{const E=(await oe.get("/api/commands/all")).data[xe]||{};console.log(`ğŸ” Fetching learned commands for device: ${xe}`),console.log("ğŸ“¦ Device commands from storage:",E);const $={...C};for(const[A,U]of Object.entries($))if(U==="pending"&&E[A])$[A]=E[A];else if(typeof U=="object"){for(const[le,ve]of Object.entries(U))if(typeof ve=="object")for(const[ye,pe]of Object.entries(ve)){const we=`${A}_${le}_${ye}`;pe==="pending"&&E[we]&&($[A][le][ye]=E[we])}else if(ve==="pending"){const ye=`${A}_${le}`;E[ye]&&($[A][le]=E[ye])}}return console.log("âœ… Merged commands:",$),$}catch(ie){return console.error("Error fetching learned commands:",ie),C}}function Ce(I){const d={manufacturer:I.manufacturer,supportedModels:[I.model],supportedController:"Broadlink",commandsEncoding:"Base64",commandType:I.commandType||"ir",commands:I.commands||{}};return I.platform==="climate"&&(d.minTemperature=I.config.minTemp,d.maxTemperature=I.config.maxTemp,d.precision=I.config.precision||1,d.operationModes=I.config.modes||[],d.fanModes=I.config.fanModes&&I.config.fanModes.length>0?I.config.fanModes:["auto"],I.config.swingModes&&I.config.swingModes.length>0&&(d.swingModes=I.config.swingModes),I.config.presetModes&&I.config.presetModes.length>0&&(d.presetModes=I.config.presetModes)),d}function ge(I){let d=`# SmartIR ${I.platform} configuration
`;return d+=`# Generated by Broadlink Manager v2

`,I.platform==="climate"&&(d+=`climate:
`,d+=`  - platform: smartir
`,d+=`    name: ${I.manufacturer} ${I.model}
`,d+=`    unique_id: ${I.manufacturer.toLowerCase()}_${I.model.toLowerCase().replace(/\s+/g,"_")}
`,d+=`    device_code: 10000  # Change this to your custom code number
`,d+=`    controller_data: ${I.broadlinkDevice}
`,I.config.tempSensor&&(d+=`    temperature_sensor: ${I.config.tempSensor}
`),I.config.humiditySensor&&(d+=`    humidity_sensor: ${I.config.humiditySensor}
`),I.config.powerSensor&&(d+=`    power_sensor: ${I.config.powerSensor}
`)),d}async function _e(){try{console.log("Fetching remote devices from /api/remote/devices...");const I=await oe.get("/api/remote/devices");console.log("Loaded remote devices response:",I.data);const d=I.data.devices||[];console.log("Extracted devices array:",d),console.log("Device count:",d.length),f.value=d,console.log("broadlinkDevices.value set to:",f.value),console.log("Final device count:",f.value.length)}catch(I){console.error("Error loading remote devices:",I),f.value=[]}}return ue(()=>i.show,I=>{if(I){const d=Number.isInteger(i.startStep)?i.startStep:0;s.value=Math.min(Math.max(d,0),P.length-1)}}),ue(()=>i.startStep,I=>{if(i.show){const d=Number.isInteger(I)?I:0;s.value=Math.min(Math.max(d,0),P.length-1)}}),Ee(()=>{i.show&&_e()}),qe(()=>{De()}),(I,d)=>t.show?(a(),r("div",{key:0,class:"modal-overlay",onClick:y},[e("div",{class:"modal-container",onClick:d[19]||(d[19]=be(()=>{},["stop"]))},[e("div",Lu,[e("h2",null,[d[22]||(d[22]=e("i",{class:"mdi mdi-file-document-edit"},null,-1)),x(" "+v(t.editMode?"Edit SmartIR Profile":"Create SmartIR Profile"),1)]),e("button",{onClick:l,class:"close-button"},[...d[23]||(d[23]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Pu,[(a(),r(he,null,$e(P,(C,J)=>e("div",{key:J,class:G(["step",{active:s.value===J,completed:s.value>J}])},[e("div",Vu,[s.value>J?(a(),r("i",ju)):(a(),r("span",Uu,v(J+1),1))]),e("span",Fu,v(C.label),1)],2)),64))]),e("div",Nu,[s.value===0?(a(),r("div",Bu,[d[29]||(d[29]=e("h3",null,"Device Information",-1)),e("div",Hu,[d[25]||(d[25]=e("label",null,"Platform Type *",-1)),W(e("select",{"onUpdate:modelValue":d[0]||(d[0]=C=>p.value.platform=C),onChange:j},[...d[24]||(d[24]=[ze('<option value="" data-v-5b86b417>Select platform...</option><option value="climate" data-v-5b86b417>ğŸŒ¡ï¸ Climate (AC, Heater, Heat Pump)</option><option value="media_player" data-v-5b86b417>ğŸ“º Media Player (TV, Receiver)</option><option value="fan" data-v-5b86b417>ğŸŒ€ Fan</option><option value="light" data-v-5b86b417>ğŸ’¡ Light (LED Strip, IR Light)</option>',5)])],544),[[Me,p.value.platform]])]),e("div",qu,[d[26]||(d[26]=e("label",null,"Manufacturer *",-1)),W(e("input",{"onUpdate:modelValue":d[1]||(d[1]=C=>p.value.manufacturer=C),type:"text",placeholder:"e.g., Daikin, LG, Samsung"},null,512),[[Ve,p.value.manufacturer]])]),e("div",zu,[d[27]||(d[27]=e("label",null,"Model(s) *",-1)),W(e("input",{"onUpdate:modelValue":d[2]||(d[2]=C=>p.value.model=C),type:"text",placeholder:"e.g., FTXS35K, Multiple models"},null,512),[[Ve,p.value.model]]),d[28]||(d[28]=e("small",null,'Enter model number or "Multiple" if it works with many models',-1))])])):O("",!0),s.value===1?(a(),r("div",Ju,[p.value.platform==="climate"?(a(),Ne(cd,{key:0,modelValue:p.value.config,"onUpdate:modelValue":d[3]||(d[3]=C=>p.value.config=C)},null,8,["modelValue"])):p.value.platform==="media_player"?(a(),r("div",Wu,[d[36]||(d[36]=e("h3",null,"Media Player Configuration",-1)),d[37]||(d[37]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),x(" Configure the features your media player supports. You'll learn the IR commands in the next step. ")],-1)),e("div",Gu,[d[35]||(d[35]=e("h4",null,"Supported Features",-1)),e("div",Ku,[e("label",Xu,[W(e("input",{type:"checkbox",value:"turn_on","onUpdate:modelValue":d[4]||(d[4]=C=>Z.value=C)},null,512),[[me,Z.value]]),d[30]||(d[30]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),x(" Power On/Off ")],-1))]),e("label",Yu,[W(e("input",{type:"checkbox",value:"volume","onUpdate:modelValue":d[5]||(d[5]=C=>Z.value=C)},null,512),[[me,Z.value]]),d[31]||(d[31]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-volume-high"}),x(" Volume Control ")],-1))]),e("label",Zu,[W(e("input",{type:"checkbox",value:"mute","onUpdate:modelValue":d[6]||(d[6]=C=>Z.value=C)},null,512),[[me,Z.value]]),d[32]||(d[32]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-volume-mute"}),x(" Mute ")],-1))]),e("label",Qu,[W(e("input",{type:"checkbox",value:"source","onUpdate:modelValue":d[7]||(d[7]=C=>Z.value=C)},null,512),[[me,Z.value]]),d[33]||(d[33]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-import"}),x(" Source Selection ")],-1))]),e("label",ec,[W(e("input",{type:"checkbox",value:"channel","onUpdate:modelValue":d[8]||(d[8]=C=>Z.value=C)},null,512),[[me,Z.value]]),d[34]||(d[34]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-numeric"}),x(" Channel Control ")],-1))])])])])):p.value.platform==="fan"?(a(),r("div",tc,[d[44]||(d[44]=e("h3",null,"Fan Configuration",-1)),d[45]||(d[45]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),x(" Configure the features your fan supports. You'll learn the IR commands in the next step. ")],-1)),e("div",oc,[d[40]||(d[40]=e("h4",null,"Fan Speed Levels",-1)),e("div",lc,[d[39]||(d[39]=e("label",null,"Number of Speed Levels *",-1)),W(e("select",{"onUpdate:modelValue":d[9]||(d[9]=C=>ne.value=C)},[...d[38]||(d[38]=[e("option",{value:1},"1 Speed",-1),e("option",{value:2},"2 Speeds",-1),e("option",{value:3},"3 Speeds (Low/Med/High)",-1),e("option",{value:4},"4 Speeds",-1),e("option",{value:5},"5 Speeds",-1),e("option",{value:6},"6 Speeds",-1)])],512),[[Me,ne.value,void 0,{number:!0}]])])]),e("div",nc,[d[43]||(d[43]=e("h4",null,"Additional Features",-1)),e("div",sc,[e("label",ac,[W(e("input",{type:"checkbox",value:"oscillate","onUpdate:modelValue":d[10]||(d[10]=C=>z.value=C)},null,512),[[me,z.value]]),d[41]||(d[41]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-sync"}),x(" Oscillation ")],-1))]),e("label",ic,[W(e("input",{type:"checkbox",value:"direction","onUpdate:modelValue":d[11]||(d[11]=C=>z.value=C)},null,512),[[me,z.value]]),d[42]||(d[42]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-rotate-3d-variant"}),x(" Direction (Forward/Reverse) ")],-1))])])])])):p.value.platform==="light"?(a(),r("div",rc,[d[51]||(d[51]=e("h3",null,"Light Configuration",-1)),d[52]||(d[52]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),x(" Configure the features your light supports. You'll learn the IR commands in the next step. ")],-1)),e("div",dc,[d[50]||(d[50]=e("h4",null,"Supported Features",-1)),e("div",uc,[e("label",cc,[W(e("input",{type:"checkbox",value:"turn_on","onUpdate:modelValue":d[12]||(d[12]=C=>T.value=C)},null,512),[[me,T.value]]),d[46]||(d[46]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),x(" Power On/Off ")],-1))]),e("label",mc,[W(e("input",{type:"checkbox",value:"brightness","onUpdate:modelValue":d[13]||(d[13]=C=>T.value=C)},null,512),[[me,T.value]]),d[47]||(d[47]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-brightness-6"}),x(" Brightness Control ")],-1))]),e("label",vc,[W(e("input",{type:"checkbox",value:"color_temp","onUpdate:modelValue":d[14]||(d[14]=C=>T.value=C)},null,512),[[me,T.value]]),d[48]||(d[48]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-thermometer"}),x(" Color Temperature ")],-1))]),e("label",pc,[W(e("input",{type:"checkbox",value:"rgb","onUpdate:modelValue":d[15]||(d[15]=C=>T.value=C)},null,512),[[me,T.value]]),d[49]||(d[49]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-palette"}),x(" RGB Color ")],-1))])])])])):O("",!0)])):O("",!0),s.value===2?(a(),r("div",fc,[ke(Hd,{modelValue:p.value.commands,"onUpdate:modelValue":d[16]||(d[16]=C=>p.value.commands=C),platform:p.value.platform,config:p.value.config,broadlinkDevice:p.value.broadlinkDevice,"onUpdate:broadlinkDevice":d[17]||(d[17]=C=>p.value.broadlinkDevice=C),manufacturer:p.value.manufacturer,model:p.value.model,commandType:p.value.commandType,"onUpdate:commandType":d[18]||(d[18]=C=>p.value.commandType=C)},null,8,["modelValue","platform","config","broadlinkDevice","manufacturer","model","commandType"])])):O("",!0),s.value===3?(a(),r("div",gc,[ke(pu,{profile:p.value,"json-data":M.value,"yaml-config":H.value},null,8,["profile","json-data","yaml-config"])])):O("",!0)]),e("div",yc,[s.value>0?(a(),r("button",{key:0,onClick:ee,class:"btn-secondary"},[...d[53]||(d[53]=[e("i",{class:"mdi mdi-arrow-left"},null,-1),x(" Back ",-1)])])):O("",!0),d[57]||(d[57]=e("div",{class:"spacer"},null,-1)),e("button",{onClick:l,class:"btn-text"}," Cancel "),s.value<P.length-1?(a(),r("button",{key:1,onClick:Pe,class:"btn-primary",disabled:!Y.value},[...d[54]||(d[54]=[x(" Next ",-1),e("i",{class:"mdi mdi-arrow-right"},null,-1)])],8,bc)):(a(),r("div",hc,[e("button",{onClick:B,class:"btn-primary",disabled:m.value},[d[55]||(d[55]=e("i",{class:"mdi mdi-cloud-upload"},null,-1)),x(" "+v(m.value?"Saving...":"Save to SmartIR"),1)],8,kc),e("button",{onClick:re,class:"btn-secondary",disabled:m.value},[...d[56]||(d[56]=[e("i",{class:"mdi mdi-download"},null,-1),x(" Download JSON ",-1)])],8,wc)]))])]),ke(Au,{show:S.value,platform:p.value.platform,warnings:_.value,"config-path":L.value,onClose:d[20]||(d[20]=C=>S.value=!1),onComplete:Q},null,8,["show","platform","warnings","config-path"]),ke(He,{isOpen:V.value,title:"Change Command Type?",message:"Changing the command type will clear all learned commands. Continue?",confirmText:"Continue",cancelText:"Cancel",dangerMode:!0,onConfirm:K,onCancel:ce},null,8,["isOpen"]),ke(He,{isOpen:q.value,title:"Close Profile Builder?",message:"Are you sure you want to close? Your progress will be lost.",confirmText:"Close",cancelText:"Keep Editing",dangerMode:!0,onConfirm:u,onCancel:d[21]||(d[21]=C=>q.value=!1)},null,8,["isOpen"])])):O("",!0)}},Cc=Se($c,[["__scopeId","data-v-5b86b417"]]),_c={class:"dashboard"},Sc={key:1,class:"welcome-banner"},Ic={__name:"Dashboard",setup(t){const c=Ge(),i=Le("smartirEnabled"),{isMobile:h}=ot(),w=g(!1),s=g(!1),m=g(null),f=g(0),S=g(null),_=g(localStorage.getItem("welcome_banner_dismissed")==="true");function L(){_.value=!0,localStorage.setItem("welcome_banner_dismissed","true")}function k(){s.value=!1,m.value=null,f.value=0,w.value=!0}async function n({platform:F,profile:R,startStep:D}){f.value=Number.isInteger(D)?D:0;try{const o=await fetch(`api/smartir/platforms/${F}/profiles/${R.code}`);if(!o.ok)throw new Error("Failed to load profile");const b=await o.json();let P="";try{const p=await fetch(`api/smartir/config/get-device?platform=${F}&code=${R.code}`);p.ok?(P=(await p.json()).controller_data||"",console.log("âœ… Found controller_data from YAML:",P)):console.warn("âš ï¸ No YAML entry found for this profile (this is OK for profiles not yet added to config)")}catch(p){console.warn("âš ï¸ Could not fetch controller_data from config:",p)}s.value=!0,m.value={platform:F,code:R.code,profile:{...b.profile,controller_data:P}},w.value=!0}catch(o){console.error("Error loading profile for edit:",o),c.error("Failed to load profile for editing")}}function V(){w.value=!1,s.value=!1,m.value=null}async function q(F){console.log("Profile saved:",F),V(),S.value&&S.value.loadAllProfiles&&(await S.value.loadAllProfiles(),console.log("âœ… Profiles list refreshed"))}return(F,R)=>(a(),r("div",_c,[Ie(i)?(a(),Ne(da,{key:0})):O("",!0),!Ie(h)&&!_.value?(a(),r("div",Sc,[e("button",{class:"dismiss-button",onClick:L,title:"Dismiss"},[...R[0]||(R[0]=[e("i",{class:"mdi mdi-close"},null,-1)])]),R[1]||(R[1]=ze('<div class="banner-content" data-v-12185d74><div class="banner-icon" data-v-12185d74><i class="mdi mdi-rocket-launch" data-v-12185d74></i></div><div class="banner-text" data-v-12185d74><h2 data-v-12185d74>Welcome to Broadlink Manager v2!</h2><p data-v-12185d74>Manage your IR/RF devices with a modern Vue 3 interface</p></div></div><div class="status-badges" data-v-12185d74><span class="badge success" data-v-12185d74><i class="mdi mdi-check-circle" data-v-12185d74></i> Vue 3 Ready </span><span class="badge warning" data-v-12185d74><i class="mdi mdi-beta" data-v-12185d74></i> Beta </span></div>',2))])):O("",!0),ke(la),Ie(i)?(a(),Ne(ir,{key:2,ref_key:"smartirStatusCard",ref:S,onCreateProfile:k,onEditProfile:n},null,512)):O("",!0),ke(Cc,{show:w.value,editMode:s.value,editData:m.value,startStep:f.value,onClose:V,onSave:q},null,8,["show","editMode","editData","startStep"])]))}},Dc=Se(Ic,[["__scopeId","data-v-12185d74"]]),xc={class:"toast-container"},Tc={class:"toast-content"},Mc={key:0,class:"toast-title"},Rc={class:"toast-message"},Ec={key:1,class:"toast-description"},Oc=["onClick","title"],Ac={__name:"Toast",setup(t,{expose:c}){const i=g([]);let h=0;function w(f){const S={success:"mdi-check-circle",error:"mdi-alert-circle",warning:"mdi-alert",info:"mdi-information"};return S[f]||S.info}function s({message:f,title:S,description:_,type:L="info",duration:k=5e3}){const n=h++,V={id:n,message:f,title:S,description:_,type:L};return i.value.push(V),k>0&&setTimeout(()=>{m(n)},k),n}function m(f){const S=i.value.findIndex(_=>_.id===f);S>-1&&i.value.splice(S,1)}return c({addToast:s,removeToast:m,show:s,success:(f,S)=>s({message:f,title:S,type:"success"}),error:(f,S)=>s({message:f,title:S,type:"error",duration:0}),warning:(f,S)=>s({message:f,title:S,type:"warning",duration:0}),info:(f,S)=>s({message:f,title:S,type:"info"})}),(f,S)=>(a(),Ne(it,{to:"body"},[e("div",xc,[ke(gt,{name:"toast"},{default:tt(()=>[(a(!0),r(he,null,$e(i.value,_=>(a(),r("div",{key:_.id,class:G(["toast",[`toast-${_.type}`,{"toast-persistent":_.type==="error"||_.type==="warning"}]])},[e("i",{class:G(["mdi",w(_.type)])},null,2),e("div",Tc,[_.title?(a(),r("div",Mc,v(_.title),1)):O("",!0),e("div",Rc,v(_.message),1),_.description?(a(),r("div",Ec,v(_.description),1)):O("",!0)]),e("button",{onClick:L=>m(_.id),class:G(["toast-close",{"toast-close-prominent":_.type==="error"||_.type==="warning"}]),title:_.type==="error"||_.type==="warning"?"Click to dismiss":"Close"},[...S[0]||(S[0]=[e("i",{class:"mdi mdi-close"},null,-1)])],10,Oc)],2))),128))]),_:1})])]))}},Lc=Se(Ac,[["__scopeId","data-v-3948c088"]]),Pc="0.3.0-alpha.34",Vc={version:Pc},jc={id:"app",class:"app-container"},Uc={class:"app-header"},Fc={class:"header-content"},Nc={class:"header-right"},Bc=["title"],Hc={class:"settings-menu-container"},qc={key:0,class:"settings-menu"},zc=["title"],Jc={class:"toggle-content"},Wc={key:0,class:"not-installed-label"},Gc={key:0,href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"menu-item menu-link menu-subitem"},Kc=["disabled"],Xc=["disabled"],Yc=["disabled"],Zc={class:"app-main"},Qc={class:"app-footer"},em={__name:"App",setup(t){const c=g(null),i=Vc.version,h=g("light"),w=g(null),s=g(!1),m=g(!1),f=g(!1),S=g(localStorage.getItem("smartir_enabled")!=="false"),_=X(()=>{var b;return((b=w.value)==null?void 0:b.installed)||!1}),L=X(()=>({light:"mdi mdi-weather-sunny",medium:"mdi mdi-weather-partly-cloudy",dark:"mdi mdi-weather-night"})[h.value]),k=X(()=>({light:"Switch to Medium Theme",medium:"Switch to Dark Theme",dark:"Switch to Light Theme"})[h.value]),n=()=>{const b=["light","medium","dark"],p=(b.indexOf(h.value)+1)%b.length;h.value=b[p],document.body.classList.remove("medium-mode","dark-mode"),h.value==="medium"?document.body.classList.add("medium-mode"):h.value==="dark"&&document.body.classList.add("dark-mode"),localStorage.setItem("theme",h.value)},V=async()=>{try{const b=await ut.getStatus();w.value=b,b.installed?console.log("âœ… SmartIR detected:",b.version):console.log("â„¹ï¸ SmartIR not detected")}catch(b){console.error("Error checking SmartIR:",b),w.value={installed:!1,error:b.message}}},q=async()=>{var b,P,p;m.value=!0;try{const ne=(await oe.get("/api/diagnostics/markdown")).data.markdown;if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(ne),(b=c.value)==null||b.success("Diagnostic summary copied to clipboard!");else{const z=document.createElement("textarea");z.value=ne,z.style.position="fixed",z.style.left="-999999px",z.style.top="-999999px",document.body.appendChild(z),z.focus(),z.select();try{if(document.execCommand("copy"))(P=c.value)==null||P.success("Diagnostic summary copied to clipboard!");else throw new Error("execCommand failed")}finally{document.body.removeChild(z)}}s.value=!1}catch(Z){console.error("Error copying diagnostics:",Z),(p=c.value)==null||p.error("Failed to copy diagnostics: "+Z.message)}finally{m.value=!1}},F=async()=>{var b,P;m.value=!0;try{const p=await oe.get("/api/diagnostics/download",{responseType:"blob"}),Z=window.URL.createObjectURL(new Blob([p.data])),ne=document.createElement("a");ne.href=Z;const z=p.headers["content-disposition"];let T="broadlink_manager_diagnostics.zip";if(z){const N=z.match(/filename="?(.+)"?/);N&&(T=N[1])}ne.setAttribute("download",T),document.body.appendChild(ne),ne.click(),ne.remove(),window.URL.revokeObjectURL(Z),(b=c.value)==null||b.success("Diagnostic bundle downloaded!"),s.value=!1}catch(p){console.error("Error downloading diagnostics:",p),(P=c.value)==null||P.error("Failed to download diagnostics")}finally{m.value=!1}},R=b=>{b.target.closest(".settings-menu-container")||(s.value=!1)};Ee(()=>{document.addEventListener("click",R)}),qe(()=>{document.removeEventListener("click",R)});const D=()=>{_.value&&(S.value=!S.value,localStorage.setItem("smartir_enabled",S.value.toString()),window.location.reload())},o=async()=>{var b,P,p;f.value=!0;try{const Z=await oe.post("/api/smartir/refresh-index");Z.data.success?(b=c.value)==null||b.success(`Updated to v${Z.data.version} (${Z.data.total_devices} devices)`,"âœ… Index Updated"):(P=c.value)==null||P.error(Z.data.error||"Unknown error","âŒ Update Failed")}catch(Z){console.error("Error updating SmartIR index:",Z),(p=c.value)==null||p.error("Failed to update device index","âŒ Update Error")}finally{f.value=!1,s.value=!1}};return Ee(async()=>{const b=localStorage.getItem("theme");b&&["light","medium","dark"].includes(b)?(h.value=b,b==="medium"?document.body.classList.add("medium-mode"):b==="dark"&&document.body.classList.add("dark-mode")):localStorage.getItem("darkMode")==="true"&&(h.value="dark",document.body.classList.add("dark-mode"),localStorage.setItem("theme","dark")),await V();const P=nt();P&&c.value&&(P.appContext.config.globalProperties.$toast=c.value),document.addEventListener("click",R)}),qe(()=>{document.removeEventListener("click",R)}),Xe("smartirStatus",w),Xe("smartirEnabled",S),Xe("refreshSmartIR",V),Xe("toast",c),(b,P)=>(a(),r("div",jc,[e("header",Uc,[e("div",Fc,[P[13]||(P[13]=e("div",{class:"header-left"},[e("i",{class:"mdi mdi-remote"}),e("h1",null,"Broadlink Manager v2"),e("span",{class:"beta-badge"},"BETA")],-1)),e("div",Nc,[e("button",{onClick:n,class:"icon-button",title:k.value},[e("i",{class:G(L.value)},null,2)],8,Bc),e("div",Hc,[e("button",{onClick:P[0]||(P[0]=p=>s.value=!s.value),class:"icon-button",title:"Settings"},[...P[2]||(P[2]=[e("i",{class:"mdi mdi-cog"},null,-1)])]),s.value?(a(),r("div",qc,[P[9]||(P[9]=e("div",{class:"menu-section-title"},"Integration Settings",-1)),e("div",{class:G(["menu-item toggle-item",{disabled:!_.value}]),onClick:P[1]||(P[1]=p=>_.value?D():null),title:_.value?"":"SmartIR is not installed"},[e("div",Jc,[P[3]||(P[3]=e("i",{class:"mdi mdi-air-conditioner"},null,-1)),P[4]||(P[4]=e("span",null,"SmartIR Integration",-1)),_.value?O("",!0):(a(),r("span",Wc,"(Not Installed)"))]),e("div",{class:G(["toggle-switch",{active:S.value&&_.value,disabled:!_.value}])},[...P[5]||(P[5]=[e("div",{class:"toggle-slider"},null,-1)])],2)],10,zc),S.value?(a(),r("a",Gc,[...P[6]||(P[6]=[e("i",{class:"mdi mdi-github"},null,-1),e("span",null,"SmartIR on GitHub",-1)])])):O("",!0),S.value?(a(),r("button",{key:1,onClick:o,class:"menu-item menu-subitem",disabled:f.value},[e("i",{class:G(["mdi",f.value?"mdi-loading mdi-spin":"mdi-refresh"])},null,2),e("span",null,v(f.value?"Updating...":"Update Device Index"),1)],8,Kc)):O("",!0),P[10]||(P[10]=e("div",{class:"menu-divider"},null,-1)),P[11]||(P[11]=e("div",{class:"menu-section-title"},"Diagnostics",-1)),e("button",{onClick:q,class:"menu-item",disabled:m.value},[...P[7]||(P[7]=[e("i",{class:"mdi mdi-content-copy"},null,-1),e("span",null,"Copy Diagnostics",-1)])],8,Xc),e("button",{onClick:F,class:"menu-item",disabled:m.value},[...P[8]||(P[8]=[e("i",{class:"mdi mdi-download"},null,-1),e("span",null,"Download Diagnostics",-1)])],8,Yc),P[12]||(P[12]=ze('<div class="menu-divider" data-v-96564cf9></div><div class="menu-section-title" data-v-96564cf9>Help &amp; Support</div><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2#readme" target="_blank" class="menu-item menu-link" data-v-96564cf9><i class="mdi mdi-book-open-variant" data-v-96564cf9></i><span data-v-96564cf9>Documentation</span></a><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2/issues" target="_blank" class="menu-item menu-link" data-v-96564cf9><i class="mdi mdi-bug" data-v-96564cf9></i><span data-v-96564cf9>Report Issue</span></a><div class="menu-divider" data-v-96564cf9></div><div class="menu-section-title" data-v-96564cf9>Community</div><a href="https://community.home-assistant.io/t/broadlink-manager-modern-web-interface-for-broadlink-devices/938473" target="_blank" class="menu-item menu-link" data-v-96564cf9><i class="mdi mdi-forum" data-v-96564cf9></i><span data-v-96564cf9>HA Forum Discussion</span></a><a href="https://www.reddit.com/r/homeassistant/comments/1o1q3kf/release_broadlink_manager_addon_a_modern_web_ui/" target="_blank" class="menu-item menu-link" data-v-96564cf9><i class="mdi mdi-reddit" data-v-96564cf9></i><span data-v-96564cf9>Reddit Discussion</span></a><div class="menu-divider" data-v-96564cf9></div><div class="menu-section-title" data-v-96564cf9>Project</div><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2" target="_blank" class="menu-item menu-link" data-v-96564cf9><i class="mdi mdi-github" data-v-96564cf9></i><span data-v-96564cf9>GitHub Repository</span></a><a href="https://ko-fi.com/tonyperkins" target="_blank" class="menu-item menu-link menu-item-sponsor" data-v-96564cf9><i class="mdi mdi-coffee" data-v-96564cf9></i><span data-v-96564cf9>Support on Ko-fi</span></a>',12))])):O("",!0)])])])]),e("main",Zc,[ke(Dc)]),e("footer",Qc,[e("p",null,"Broadlink Manager v"+v(Ie(i))+" | Built with Vue "+v(yt),1)]),ke(Lc,{ref_key:"toastRef",ref:c},null,512)]))}},tm=Se(em,[["__scopeId","data-v-96564cf9"]]),ct=bt(tm),om=ht();ct.use(om);ct.mount("#app");
