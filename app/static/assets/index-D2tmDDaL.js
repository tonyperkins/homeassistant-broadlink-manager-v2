import{g as Ge,r as y,o as Te,a as qe,b as ot,d as lt,c as J,e as n,f as l,h as e,i as L,n as Z,u as _e,t as m,j as S,F as ve,k as ke,w as ue,l as G,v as Ie,m as ye,p as be,q as Ue,s as He,T as Ke,x as Ce,y as Se,z as Ee,A as ge,B as Xe,C as Fe,D as Le,E as Ye,G as Ze,H as nt,I as st,J as at,K as je,L as it,M as rt}from"./vendor-DGiFqQ_g.js";(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const b of document.querySelectorAll('link[rel="modulepreload"]'))k(b);new MutationObserver(b=>{for(const s of b)if(s.type==="childList")for(const u of s.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&k(u)}).observe(document,{childList:!0,subtree:!0});function r(b){const s={};return b.integrity&&(s.integrity=b.integrity),b.referrerPolicy&&(s.referrerPolicy=b.referrerPolicy),b.crossOrigin==="use-credentials"?s.credentials="include":b.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function k(b){if(b.ep)return;b.ep=!0;const s=r(b);fetch(b.href,s)}})();let We=!1;function Pe(){const o=Ge(),c=o==null?void 0:o.appContext.config.globalProperties.$toast;return c||(We||(console.warn("Toast notification system not yet initialized - using console fallback"),We=!0),{success:r=>console.log("✓",r),error:r=>console.error("✗",r),warning:r=>console.warn("⚠",r),info:r=>console.info("ℹ",r)})}function ze(){const o=y(!1),c=y(!1),r=y(!1),k=y(0),b=767,s=768,u=1023,f=1024,_=()=>{const $=window.innerWidth;k.value=$,o.value=$<=b,c.value=$>=s&&$<=u,r.value=$>=f};return Te(()=>{_(),window.addEventListener("resize",_)}),qe(()=>{window.removeEventListener("resize",_)}),{isMobile:o,isTablet:c,isDesktop:r,screenWidth:k,isMobileOrTablet:()=>o.value||c.value,isTabletOrDesktop:()=>c.value||r.value}}const Je="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAHBUlEQVR4nOxZC1BTVxo+9+aNZI2LNsgjWR4hgoIiRVDBslKnIKPbx1jqTrtYoakat1a6dNsdd7t1X8XHyAbEhdUu1u2mXdbasqJbtsaMIqBBECiPBmqEICEBEx4xJLlJ7s6lw6rJDeQ2FzLM+M1kBs7/3+/83zn/Oee/51JRFAXzGbCvA/AWjwX4GvNeANWXnXffHQ4+K6/dYbHeD+IFhjRkb1wn9WPQbEQ4IF/tQlXX2p5+/8OyczY74j/VxuMG3Sh/Oz9jaQDb4CmPT1LIbLXBfzrz0cmHg8fQpx1Yc1Ra+TsiXD4R0PqtRmAyj/LxbJeaujKIcPlEAINOM7vLXBaTZibCRWgRq3WGJZWX63aoNDpB8BJOX/bGlIqwpUv6iXBgWBHG7eUF8urUWvU6Z9sLGxI/IsLl8SJu6u4XigqPXkVspiVTbTQqU1/6Vn7ammh+G5FOMZyqludIKqUVU/9jcaSuTCo/unfHbiad4iBdwMu/P1bV1tO1xbk9NDC0/vwHB1xGcjqYLAh16zsHW3R6XXTu1mfFdAqMrIoSKNbGhLcQ4QGeppDJ7ACtPcqNEI6tT9O3Vqm+tygqNMDjrU9Sef6tIYM2JjUuuXzfC5knCEXsBI8WMZUCAxiCrfhWyMZkMNzYXNHVpwmXXqp5j0Hz0/1m57a3PQ8VHx4JoNMASIl9shLPFsB5ooO7iDXhCY/dAcCvT/79LwC1s/K2bDnAXcQeJRqwMzzeRt/bua0gLChcDsCDNQNBkEU/qot7o6j0kzETQpuJ40ZnT6xSrUoNWhyseHVz2ikv4n4QA5FSArE5IFlTZ0r3XU1MWODib6NCl3a9dkhSYxgbjo4XLq8sL9j7Ip36YEwMRjMNQazMhf7+RgYNnuyo7bY6ArFaWKuXRX495wLwoLk39sO9RaVnM5OTP8zLSjtjsljpp6ovi6pqr706eE8XBwGUSqEy9Guihf/92TMZhetjI5rJCHwKpBRzZqsNYtKp6KD+Pvv1w5ILdzR3UvD8HA4YefOl7N25JKUPIKuUwIJH7A5of/GJf7oLfrIz2EH786fSss+uKFzOk+8L0mqh6rpbmR0q5YyFGAQBSuHHlcUWxEaZyXfMhFD0Rgt9Oh/SBMiam58HAO+oc4XZMsK/1taT6M6uHjJw8w6VSNfvemM8TbzPlFlwsP5KyzfJeL6kCejXDgo894aASqOZ9O/uHwzq6B3ijhitkzOC7XS7j0g+V3S0vQTDDhYEoZSBobvJ+yXFNZ29gy4lOGmvlDBMIfQqSKV8539EWvXHhvbGHBSFrAwGW+vvxzLoR7RxzrNpsyPs0xcv7/lg1/ZfPtKvuw7MVhulUakWdvRq+XY3tWFT90Bk+52BCOzvyOBgjytSFKAgms+b9F/2o+BbKwUrvgjhhjSjKLAPG4YE7lJxfEIf5dyGOwMXrren/eF0RYXRNMrHDt4QbmjDEbHop9F8rqpddZd3sV6R/aWiabtWr41PW534V8m+PFHW+qSPL9TX7oM8WAaBi4IbE4S8yYNs/7asIgBA0ZStRqFM/MXxIzcgHBEBP+C6DJKLgJvK3uXvniitBsDmNzkSEAD9uv5k0aFjXy1gMQ0DQ5p4CAIwNuXLwyL/ExcpqMWeS42NUmxKXFf8VWPdz6cLnkqhGd/Pe+U1Cow/+ekJUYr4qJgvbik7f/Jw+0J/tjpvS3qxs7/LQZZfcrrkUmOdGI/cgUKIkB8pz0xK+CQjKf6z4MWckYftZqsderfsTInsZt0evDRgMRYMHhaLnk+NW1Y/nchxk5lZ+I/Pf/vl9RvbLYiVlSBcJv/VK9sKBCHc3hkF7D12/NzVltZn8YhzNj/3ev6LGeXTdQ6+uzLZ+C+5XNza05Nsd1gXcNgBvekJK/+du3lTUSiXMzzT80TgkkK8wJAGgCMAE5ooFFz3hHTr+lgZ9iMryOngkoi5WZuOc9hPtDu3r4198nTqygjCr3wYmrvVkSerZXljJoT0m0DcYm5g2Mg5WV39zrVWZZofkzaRnhB/bufm9FI/JpXQXj8F8bHyitqWxhzJmwUJT60SNJER+P+BCZjt34lzNbvickRoWVWNmGzuObnYWhER3oAdX41dPbj1jDeYEwGrInltKKCNtatub6hRfJOEnfJkcc+JgE9ltS/DkINuNI3xCo4fbXgm/0CnouvOcjK4Z/16/ZKia+3+kqIrEIQ+sgNx2Jzb5wsPxrD9GBZv+Gd9BqSXr4icg8cwMj4SLmv6+mlv+WddgGlilOPOZkEmFnrLP+sCVgtXyPHaHShkiw0XXPWWf9YF5Gb9uGzp4sCbj7ai4LkNTx2O5nPV3vLPyTeye6P32X+7KNujVKtSYJg+viEu/mx2etJZCgnD57OPfGRh3n8nfizA15j3Av4XAAD//5k1S2w3zfwVAAAAAElFTkSuQmCC",oe=ot.create({baseURL:"./",timeout:3e4,headers:{"Content-Type":"application/json"}});oe.interceptors.request.use(o=>o,o=>Promise.reject(o));oe.interceptors.response.use(o=>o,o=>(console.error("API Error:",o),o.response?console.error("Response error:",o.response.data):o.request?console.error("No response received"):console.error("Request setup error:",o.message),Promise.reject(o)));const dt=lt("devices",{state:()=>({devices:[],loading:!1,error:null,selectedDevice:null}),getters:{deviceById:o=>c=>o.devices.find(r=>r.id===c),devicesByType:o=>c=>o.devices.filter(r=>r.entity_type===c),deviceCount:o=>o.devices.length,hasDevices:o=>o.devices.length>0},actions:{async loadDevices(o=!1){this.loading=!0,this.error=null;try{const c=o?`/api/devices/managed?_t=${Date.now()}`:"/api/devices/managed",r=await oe.get(c);this.devices=r.data.devices||[],console.log("📥 Loaded devices:",this.devices),this.devices.forEach(k=>{console.log(`📥 Device "${k.name}":`,{id:k.id,device:k.device,commands:k.commands,commandCount:k.commands?Object.keys(k.commands).length:0})})}catch(c){this.error=c.message,console.error("Error loading devices:",c)}finally{this.loading=!1}},async createDevice(o){this.loading=!0,this.error=null;try{console.log("🏪 Store: Creating device with data:",o),console.log("🏪 Store: Device commands being sent:",o.commands);const c={device_name:o.name,device:o.device,area_id:o.area||"",area_name:o.area||"",entity_type:o.entity_type,icon:o.icon,broadlink_entity:o.broadlink_entity,device_type:o.device_type||"broadlink",commands:o.commands||{}};o.device_type==="smartir"&&o.smartir_config&&(c.smartir_config=o.smartir_config),console.log("🏪 Store: Transformed data for backend:",c);const r=await oe.post("/api/devices/managed",c);return console.log("🏪 Store: Create response:",r.data),await this.loadDevices(),r.data}catch(c){throw console.error("Error creating device:",c),c}finally{this.loading=!1}},async updateDevice(o,c){this.loading=!0,this.error=null;try{const r=await oe.put(`/api/devices/managed/${o}`,c);return await this.loadDevices(),r.data}catch(r){throw console.error("Error updating device:",r),r}finally{this.loading=!1}},async deleteDevice(o,c=!1){this.loading=!0,this.error=null;try{await oe.delete(`/api/devices/managed/${o}`,{data:{delete_commands:c}}),this.devices=this.devices.filter(r=>r.id!==o)}catch(r){throw this.error=r.message,console.error("Error deleting device:",r),r}finally{this.loading=!1}},selectDevice(o){this.selectedDevice=o},clearSelection(){this.selectedDevice=null},clearError(){this.error=null},async syncAllAreas(){if(!this.devices||this.devices.length===0){console.log("⚠️ No devices to sync");return}console.log(`🔄 Syncing areas from Home Assistant for ${this.devices.length} devices...`);try{const o=await Promise.all(this.devices.map(k=>(console.log(`🔄 Syncing device: ${k.id} (${k.name})`),oe.post(`/api/devices/${k.id}/sync-area`).then(b=>b.data.success&&b.data.area?(console.log(`✅ Synced area for ${k.name}: ${b.data.area}`),{status:"synced",device:k.name}):{status:"no_area"}).catch(b=>{var s;return((s=b.response)==null?void 0:s.status)===404?(console.log(`❌ Device not found in HA: ${k.id}`),{status:"not_found"}):(console.warn(`⚠️ Failed to sync area for ${k.id}:`,b.message),{status:"error",error:b.message})})))),c=o.filter(k=>k.status==="synced").length,r=o.filter(k=>k.status==="not_found").length;await this.loadDevices(!0),c>0?console.log(`✅ Area sync complete: ${c} synced, ${r} not found in HA`):r>0&&console.log(`ℹ️ No areas synced - ${r} entities not found in HA registry (generate entities first)`)}catch(o){console.debug("Area sync error:",o)}}}});function Qe(o){const c=J(()=>o.value||o),r=J(()=>{switch(c.value){case"climate":return"mdi:air-conditioner";case"fan":return"mdi:fan";case"light":return"mdi:lightbulb";case"media_player":return"mdi:television";case"switch":return"mdi:light-switch";default:return"mdi:devices"}}),k=J(()=>`device-type-${c.value}-color`),b=J(()=>`tag-${c.value}-bg`);return{icon:r,colorClass:k,tagBgClass:b}}const ut=""+new URL("broadlink-logo-BDjImjRY.png",import.meta.url).href,$e=(o,c)=>{const r=o.__vccOpts||o;for(const[k,b]of c)r[k]=b;return r},ct={class:"device-header"},mt={class:"device-info"},vt=["title"],pt={class:"device-labels"},ft={class:"device-type"},gt=["src","alt","title"],yt={class:"device-body"},bt={class:"device-stats"},ht={class:"stat",title:"Learned command count"},kt={class:"stat",title:"HA Assigned Area"},wt={class:"device-meta"},$t={class:"device-id",title:"Device ID"},Ct={key:0,class:"storage-name"},_t={key:1,class:"broadlink-entity",title:"Controller Device"},St={key:2,class:"controller-device"},It={class:"device-actions"},Dt=["disabled"],xt=["disabled"],Tt=["disabled"],Mt={key:0,class:"disabled-overlay"},Rt={__name:"DeviceCard",props:{device:{type:Object,required:!0},broadlinkDevices:{type:Array,default:()=>[]}},emits:["edit","delete","learn"],setup(o){const c=o,r=J(()=>localStorage.getItem("smartir_simulate_not_installed")==="true"),k=J(()=>c.device.device_type==="smartir"&&r.value),b=y(null),s=Qe(J(()=>c.device.entity_type)),u=J(()=>c.device.icon?c.device.icon:s.icon.value),f=a=>a&&a.startsWith("mdi:")?`mdi ${a.replace(":"," mdi-")}`:`mdi mdi-${a}`,_=J(()=>({light:"Light",fan:"Fan",switch:"Switch",media_player:"Media Player",cover:"Cover"})[c.device.entity_type]||c.device.entity_type),$=J(()=>(c.device.device_type||"broadlink")==="smartir"?"SmartIR":"Broadlink"),R=J(()=>(c.device.device_type||"broadlink")==="smartir"?Je:ut),w=J(()=>(c.device.device_type||"broadlink")==="smartir"?b.value!==null?b.value:0:Object.keys(c.device.commands||{}).length),t=a=>{if(!a)return"";const h=c.broadlinkDevices.find(v=>v.entity_id===a);return h&&h.name||a},A=J(()=>{if(!c.device.device)return!1;const a=c.device.id.includes(".")?c.device.id.split(".")[1]:c.device.id;return c.device.device!==a}),q=J(()=>{if(!c.device.broadlink_entity)return"";const a=c.broadlinkDevices.find(h=>h.entity_id===c.device.broadlink_entity);return a&&a.name||c.device.broadlink_entity}),U=a=>{if(!a||typeof a!="object")return 0;let h=0;for(const v of Object.values(a))typeof v=="string"?h++:typeof v=="object"&&(h+=U(v));return h},M=async()=>{if(!(!c.device.device_code||!c.device.entity_type))try{const a=await oe.get("/api/smartir/codes/code",{params:{entity_type:c.device.entity_type,code_id:c.device.device_code}});if(a.data.success&&a.data.code){const h=a.data.code;h.commands&&(b.value=U(h.commands))}}catch(a){console.error("Error fetching SmartIR command count:",a)}};return Te(async()=>{(c.device.device_type||"broadlink")==="smartir"&&await M()}),(a,h)=>(l(),n("div",{class:Z(["device-card",{disabled:k.value}])},[e("div",ct,[e("div",{class:Z(["device-icon",_e(s).colorClass.value])},[e("i",{class:Z(f(u.value))},null,2)],2),e("div",mt,[e("h3",{title:o.device.name},m(o.device.name),9,vt),e("div",pt,[e("span",ft,m(_.value),1)])]),e("img",{src:R.value,alt:$.value,title:$.value,class:"device-source-logo"},null,8,gt)]),e("div",yt,[e("div",bt,[e("div",ht,[h[3]||(h[3]=e("i",{class:"mdi mdi-remote"},null,-1)),e("span",null,m(w.value)+" command"+m(w.value!==1?"s":""),1)]),e("div",kt,[h[4]||(h[4]=e("i",{class:"mdi mdi-map-marker"},null,-1)),e("span",null,m(o.device.area||"No area"),1)])]),e("div",wt,[e("span",$t,[h[5]||(h[5]=e("i",{class:"mdi mdi-identifier"},null,-1)),S(" "+m(o.device.id),1)]),A.value?(l(),n("span",Ct,[h[6]||(h[6]=e("i",{class:"mdi mdi-code-tags"},null,-1)),S(" "+m(o.device.device),1)])):L("",!0),o.device.broadlink_entity?(l(),n("span",_t,[h[7]||(h[7]=e("i",{class:"mdi mdi-access-point"},null,-1)),S(" "+m(q.value),1)])):L("",!0),o.device.controller_device?(l(),n("span",St,[h[8]||(h[8]=e("i",{class:"mdi mdi-access-point"},null,-1)),S(" "+m(t(o.device.controller_device)),1)])):L("",!0)])]),e("div",It,[e("button",{onClick:h[0]||(h[0]=v=>!k.value&&a.$emit("learn",o.device)),class:"icon-btn",title:"Manage Commands",disabled:k.value},[...h[9]||(h[9]=[e("i",{class:"mdi mdi-remote-tv"},null,-1)])],8,Dt),e("button",{onClick:h[1]||(h[1]=v=>!k.value&&a.$emit("edit",o.device)),class:"icon-btn",title:"Edit",disabled:k.value},[...h[10]||(h[10]=[e("i",{class:"mdi mdi-pencil"},null,-1)])],8,xt),e("button",{onClick:h[2]||(h[2]=v=>!k.value&&a.$emit("delete",o.device)),class:"icon-btn danger",title:"Delete",disabled:k.value},[...h[11]||(h[11]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,Tt)]),k.value?(l(),n("div",Mt,[...h[12]||(h[12]=[e("div",{class:"disabled-message"},[e("i",{class:"mdi mdi-eye-off"}),e("span",null,"SmartIR Not Installed")],-1)])])):L("",!0)],2))}},Lt=$e(Rt,[["__scopeId","data-v-7a7f5c18"]]),At={name:"DeviceListView",props:{devices:{type:Array,required:!0}},methods:{getDeviceCommands(o){return o.commands&&typeof o.commands=="object"?Object.keys(o.commands):[]},sendCommand(o,c){this.$emit("send-command",{device:o,command:c})},editDevice(o){this.$emit("edit-device",o)},deleteDevice(o){this.$emit("delete-device",o)}}},Et={class:"device-list-view"},Ot={class:"device-table"},Vt={class:"device-info"},Pt={class:"device-name"},Ut={class:"device-entity"},jt={class:"device-area"},Ft={class:"device-type"},Nt={class:"device-commands"},Bt={key:0,class:"command-list"},qt=["onClick"],Ht={key:0,class:"no-commands"},zt={key:1,class:"smartir-info"},Jt={class:"profile-code"},Wt={class:"device-actions"},Gt=["onClick"],Kt=["onClick"];function Xt(o,c,r,k,b,s){return l(),n("div",Et,[e("table",Ot,[c[2]||(c[2]=e("thead",null,[e("tr",null,[e("th",null,"Device"),e("th",null,"Room/Area"),e("th",null,"Type"),e("th",null,"Commands"),e("th",null,"Actions")])],-1)),e("tbody",null,[(l(!0),n(ve,null,ke(r.devices,u=>(l(),n("tr",{key:u.entity_id,class:"device-row"},[e("td",Vt,[e("div",Pt,m(u.friendly_name||u.name),1),e("div",Ut,m(u.entity_id),1)]),e("td",jt,m(u.area||"No Area"),1),e("td",Ft,[e("span",{class:Z(["type-badge",u.device_type])},m(u.device_type==="smartir"?"SmartIR":"Broadlink"),3)]),e("td",Nt,[u.device_type==="broadlink"?(l(),n("div",Bt,[(l(!0),n(ve,null,ke(s.getDeviceCommands(u),f=>(l(),n("button",{key:f,class:"command-btn",onClick:_=>s.sendCommand(u,f)},m(f),9,qt))),128)),s.getDeviceCommands(u).length===0?(l(),n("span",Ht," No commands ")):L("",!0)])):u.device_type==="smartir"?(l(),n("div",zt,[e("span",Jt,"Profile: "+m(u.device_code),1)])):L("",!0)]),e("td",Wt,[e("button",{class:"action-btn edit",onClick:f=>s.editDevice(u),title:"Edit"},[...c[0]||(c[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})],-1)])],8,Gt),e("button",{class:"action-btn delete",onClick:f=>s.deleteDevice(u),title:"Delete"},[...c[1]||(c[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"3 6 5 6 21 6"}),e("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})],-1)])],8,Kt)])]))),128))])])])}const Yt=$e(At,[["render",Xt],["__scopeId","data-v-952596a6"]]),Zt={class:"icon-picker"},Qt={class:"icon-input-wrapper"},eo=["id","placeholder"],to={key:0,class:"icon-preview"},oo={key:0,class:"icon-dropdown"},lo={class:"icon-grid"},no=["onMousedown","title"],so={__name:"IconPicker",props:{modelValue:{type:String,default:""},inputId:{type:String,default:"icon-input"},placeholder:{type:String,default:"e.g., mdi:television"}},emits:["update:modelValue"],setup(o,{emit:c}){const r=o,k=c,b=y(r.modelValue),s=y(!1),u=["television","speaker","radio","music","video","movie","play","pause","stop","skip-next","skip-previous","volume-high","volume-medium","volume-low","volume-off","remote","remote-tv","cast","chromecast","spotify","netflix","youtube","lightbulb","lightbulb-on","lightbulb-off","lamp","floor-lamp","ceiling-light","light-switch","led-strip","led-strip-variant","wall-sconce","chandelier","spotlight","track-light","vanity-light","desk-lamp","fan","ceiling-fan","air-conditioner","thermometer","thermostat","heat-wave","snowflake","fire","radiator","water-boiler","hvac","blinds","blinds-open","window-shutter","window-shutter-open","curtains","curtains-closed","roller-shade","roller-shade-closed","garage","garage-open","gate","door","door-open","window-open","window-closed","washing-machine","tumble-dryer","dishwasher","refrigerator","stove","microwave","oven","toaster","kettle","coffee","coffee-maker","blender","robot-vacuum","robot-vacuum-variant","vacuum","broom","spray-bottle","lock","lock-open","lock-smart","key","shield","shield-check","alarm-light","bell","doorbell","camera","cctv","motion-sensor","smoke-detector","fire-extinguisher","water-alert","gas-cylinder","sofa","bed","bed-double","desk","chair","table","bookshelf","home","home-outline","home-assistant","floor-plan","room","weather-sunny","weather-night","weather-cloudy","weather-rainy","weather-snowy","weather-lightning","weather-windy","weather-fog","weather-partly-cloudy","umbrella","water","water-percent","phone","cellphone","tablet","laptop","desktop-tower","monitor","keyboard","mouse","printer","router","router-wireless","access-point","wifi","bluetooth","usb","hdmi-port","ethernet","power","power-plug","power-socket","battery","battery-charging","lightning-bolt","flash","solar-panel","solar-power","leaf","tree","flower","sprout","grass","watering-can","shovel","fence","pool","hot-tub","silverware","silverware-fork-knife","food","food-apple","glass-wine","glass-cocktail","bottle-wine","pot","pot-steam","shower","shower-head","bathtub","toilet","sink","faucet","hand-wash","car","car-side","garage-variant","tools","hammer","wrench","screwdriver","toolbox","ladder","heart","heart-pulse","run","walk","bike","dumbbell","yoga","scale-bathroom","thermometer-lines","clock","clock-outline","timer","alarm","calendar","calendar-today","calendar-clock","history","bell-ring","bell-alert","alert","alert-circle","information","help-circle","check","check-circle","close-circle","minus-circle","plus-circle","arrow-up","arrow-down","arrow-left","arrow-right","chevron-up","chevron-down","menu","dots-vertical","dots-horizontal","cog","tune","circle","square","triangle","hexagon","star","star-outline","heart-outline","plus","minus","close","check-bold","eye","eye-off","account","account-group","baby","dog","cat","paw","gift","balloon","party-popper","candle","book","book-open","newspaper","email","message","phone-classic"];ue(()=>r.modelValue,w=>{b.value=w});const f=J(()=>{if(!b.value)return u.slice(0,50);const w=b.value.toLowerCase().replace("mdi:","");return u.filter(t=>t.toLowerCase().includes(w)).slice(0,50)}),_=()=>{s.value=!0,k("update:modelValue",b.value)},$=()=>{setTimeout(()=>{s.value=!1},200)},R=w=>{b.value=`mdi:${w}`,k("update:modelValue",b.value),s.value=!1};return(w,t)=>(l(),n("div",Zt,[e("div",Qt,[G(e("input",{id:o.inputId,"onUpdate:modelValue":t[0]||(t[0]=A=>b.value=A),type:"text",placeholder:o.placeholder,onInput:_,onFocus:t[1]||(t[1]=A=>s.value=!0),onBlur:$},null,40,eo),[[Ie,b.value]]),b.value?(l(),n("div",to,[e("i",{class:Z(`mdi mdi-${b.value.replace("mdi:","")}`)},null,2)])):L("",!0)]),s.value&&f.value.length>0?(l(),n("div",oo,[e("div",lo,[(l(!0),n(ve,null,ke(f.value,A=>(l(),n("div",{key:A,class:"icon-option",onMousedown:ye(q=>R(A),["prevent"]),title:A},[e("i",{class:Z(`mdi mdi-${A}`)},null,2),e("span",null,m(A),1)],40,no))),128))])])):L("",!0)]))}},ao=$e(so,[["__scopeId","data-v-a64f5011"]]),io={key:0,class:"dropdown-label"},ro={key:0,class:"required"},uo=["placeholder","disabled","onKeydown"],co={class:"dropdown-icons"},mo={key:0,class:"mdi mdi-loading mdi-spin"},vo={key:2,class:"mdi mdi-chevron-down"},po={key:1,class:"error-message"},fo={key:2,class:"hint-message"},go={key:0,class:"dropdown-menu"},yo=["onMousedown","onMouseenter"],bo={class:"option-content"},ho={class:"option-label"},ko={key:0,class:"option-description"},wo={key:0,class:"mdi mdi-check selected-icon"},$o={key:3,class:"dropdown-menu"},Co={__name:"SearchableDropdown",props:{modelValue:{type:[String,Number,Object],default:null},options:{type:Array,required:!0,default:()=>[]},label:{type:String,default:""},placeholder:{type:String,default:"Search..."},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},error:{type:String,default:""},hint:{type:String,default:""},optionLabel:{type:String,default:"label"},optionValue:{type:String,default:"value"},optionDescription:{type:String,default:"description"},filterMethod:{type:Function,default:null}},emits:["update:modelValue","change","search"],setup(o,{emit:c}){const r=o,k=c,b=y(null),s=y(null),u=y(""),f=y(!1),_=y(0),$=y(!1),R=O=>typeof O=="string"||typeof O=="number"?O:O[r.optionLabel]||O.label||O.name||String(O),w=O=>typeof O=="string"||typeof O=="number"?O:O[r.optionValue]||O.value||O.id||O,t=O=>typeof O=="string"||typeof O=="number"?"":O[r.optionDescription]||O.description||"",A=O=>{const F=w(O);return typeof r.modelValue=="object"?w(r.modelValue)===F:r.modelValue===F},q=J(()=>{if(!u.value)return r.options;if(r.filterMethod)return r.options.filter(F=>r.filterMethod(F,u.value));const O=u.value.toLowerCase();return r.options.filter(F=>{const ee=R(F).toLowerCase(),me=t(F).toLowerCase();return ee.includes(O)||me.includes(O)})}),U=J(()=>{if(!r.modelValue)return"";const O=r.options.find(F=>{const ee=w(F);return typeof r.modelValue=="object"?ee===w(r.modelValue):ee===r.modelValue});return O?R(O):""});ue(()=>r.modelValue,O=>{$.value||(u.value=U.value)}),ue(()=>r.options,()=>{!$.value&&r.modelValue&&(u.value=U.value)},{deep:!0}),ue(u,O=>{k("search",O),_.value=0}),Te(()=>{u.value=U.value});const M=()=>{var O;$.value=!0,f.value=!0,(O=s.value)==null||O.select()},a=()=>{$.value=!1,setTimeout(()=>{f.value=!1,r.modelValue?u.value=U.value:u.value=""},200)},h=()=>{var O;f.value=!1,(O=s.value)==null||O.blur()},v=O=>{const F=w(O);k("update:modelValue",F),k("change",F,O),u.value=R(O),h()},I=()=>{var O;k("update:modelValue",null),k("change",null,null),u.value="",(O=s.value)==null||O.focus()},X=()=>{if(!f.value){f.value=!0;return}_.value<q.value.length-1&&_.value++},Q=()=>{_.value>0&&_.value--},te=()=>{q.value.length>0&&_.value>=0&&v(q.value[_.value])},de=O=>{b.value&&!b.value.contains(O.target)&&(f.value=!1,r.modelValue?u.value=U.value:u.value="")};return Te(()=>{document.addEventListener("click",de)}),qe(()=>{document.removeEventListener("click",de)}),(O,F)=>(l(),n("div",{class:"searchable-dropdown",ref_key:"dropdownRef",ref:b},[o.label?(l(),n("label",io,[S(m(o.label)+" ",1),o.required?(l(),n("span",ro,"*")):L("",!0)])):L("",!0),e("div",{class:Z(["dropdown-input-wrapper",{"has-error":o.error,disabled:o.disabled}])},[G(e("input",{ref_key:"inputRef",ref:s,type:"text","onUpdate:modelValue":F[0]||(F[0]=ee=>u.value=ee),placeholder:o.placeholder,disabled:o.disabled||o.loading,onFocus:M,onBlur:a,onKeydown:[Ue(ye(X,["prevent"]),["down"]),Ue(ye(Q,["prevent"]),["up"]),Ue(ye(te,["prevent"]),["enter"]),Ue(h,["escape"])],class:"dropdown-input"},null,40,uo),[[Ie,u.value]]),e("div",co,[o.loading?(l(),n("i",mo)):o.modelValue&&!o.disabled?(l(),n("i",{key:1,class:"mdi mdi-close-circle clear-icon",onClick:I})):(l(),n("i",vo))])],2),o.error?(l(),n("div",po,m(o.error),1)):L("",!0),o.hint&&!o.error?(l(),n("div",fo,m(o.hint),1)):L("",!0),be(Ke,{name:"dropdown"},{default:He(()=>[f.value&&q.value.length>0?(l(),n("div",go,[(l(!0),n(ve,null,ke(q.value,(ee,me)=>(l(),n("div",{key:w(ee),class:Z(["dropdown-item",{highlighted:me===_.value,selected:A(ee)}]),onMousedown:ye(pe=>v(ee),["prevent"]),onMouseenter:pe=>_.value=me},[e("div",bo,[e("div",ho,m(R(ee)),1),t(ee)?(l(),n("div",ko,m(t(ee)),1)):L("",!0)]),A(ee)?(l(),n("i",wo)):L("",!0)],42,yo))),128))])):L("",!0)]),_:1}),f.value&&q.value.length===0&&!o.loading?(l(),n("div",$o,[...F[1]||(F[1]=[e("div",{class:"dropdown-item no-results"},[e("i",{class:"mdi mdi-magnify"}),S(" No results found ")],-1)])])):L("",!0)],512))}},Ne=$e(Co,[["__scopeId","data-v-679ce35f"]]),_o={class:"smartir-selector"},So={class:"form-group"},Io={class:"form-group"},Do={class:"form-group"},xo=["value"],To={key:0,class:"error-message"},Mo={class:"form-group"},Ro={class:"form-group"},Lo={key:1,class:"code-info"},Ao={class:"info-content"},Eo={class:"info-row"},Oo={class:"info-value"},Vo={class:"info-row"},Po={class:"info-value"},Uo={key:0,class:"info-row"},jo={class:"info-value"},Fo={class:"info-row"},No={class:"info-value"},Bo={__name:"SmartIRDeviceSelector",props:{entityType:{type:String,required:!0},modelValue:{type:Object,default:()=>({})},broadlinkDevices:{type:Array,default:()=>[]}},emits:["update:modelValue","change"],setup(o,{expose:c,emit:r}){const k=o,b=r,s=y([]),u=y([]),f=y(""),_=y(""),$=y(""),R=y(""),w=y(""),t=y(null),A=y(!1),q=y(!1),U=y({manufacturer:"",model:"",controller:""});Te(async()=>{if(await M(),k.modelValue&&(f.value=k.modelValue.manufacturer||"",_.value=k.modelValue.device_code||"",$.value=k.modelValue.controller_device||"",R.value=k.modelValue.temperature_sensor||"",w.value=k.modelValue.humidity_sensor||"",f.value&&(await a(f.value),_.value&&u.value.length>0))){const O=u.value.find(F=>F.code===_.value);O&&(t.value={code:O.code,manufacturer:f.value,models:O.models,controller:O.controller})}}),ue(()=>k.entityType,async O=>{O&&(f.value="",_.value="",u.value=[],t.value=null,await M())});const M=async()=>{if(k.entityType){A.value=!0,U.value.manufacturer="";try{const O=await oe.get("/api/smartir/codes/manufacturers",{params:{entity_type:k.entityType}});if(O.data.success)s.value=O.data.manufacturers||[];else throw new Error(O.data.error||"Failed to load manufacturers")}catch(O){console.error("Error loading manufacturers:",O),U.value.manufacturer="Failed to load manufacturers. Please try again.",s.value=[]}finally{A.value=!1}}},a=async O=>{if(!(!O||!k.entityType)){q.value=!0,U.value.model="";try{const F=await oe.get("/api/smartir/codes/models",{params:{entity_type:k.entityType,manufacturer:O}});if(F.data.success){const ee=F.data.models||[];u.value=ee.map(me=>{const pe=me.models&&me.models.length>0?me.models.join(", "):`Code ${me.code}`;return{code:me.code,label:pe,description:`Code: ${me.code}`,models:me.models,controller:me.controller}})}else throw new Error(F.data.error||"Failed to load models")}catch(F){console.error("Error loading models:",F),U.value.model="Failed to load models. Please try again.",u.value=[]}finally{q.value=!1}}},h=async O=>{f.value=O,_.value="",t.value=null,u.value=[],O&&await a(O),te()},v=()=>{const O=u.value.find(F=>F.code===_.value);O&&(t.value={code:O.code,manufacturer:f.value,models:O.models,controller:O.controller}),te()},I=()=>{te()},X=()=>{te()},Q=()=>{te()},te=()=>{var F,ee;const O={manufacturer:f.value,model:((ee=(F=t.value)==null?void 0:F.models)==null?void 0:ee[0])||"",device_code:_.value,controller_device:$.value};k.entityType==="climate"&&(R.value&&(O.temperature_sensor=R.value),w.value&&(O.humidity_sensor=w.value)),b("update:modelValue",O),b("change",O)};return c({validate:()=>{let O=!0;return U.value={manufacturer:"",model:"",controller:""},f.value||(U.value.manufacturer="Manufacturer is required",O=!1),_.value||(U.value.model="Model is required",O=!1),$.value||(U.value.controller="Broadlink controller is required",O=!1),O}}),(O,F)=>(l(),n("div",_o,[e("div",So,[be(Ne,{modelValue:f.value,"onUpdate:modelValue":F[0]||(F[0]=ee=>f.value=ee),options:s.value,label:"Manufacturer",placeholder:"Search manufacturers...",required:"",loading:A.value,error:U.value.manufacturer,hint:"Select the device manufacturer",onChange:h},null,8,["modelValue","options","loading","error"])]),e("div",Io,[be(Ne,{modelValue:_.value,"onUpdate:modelValue":F[1]||(F[1]=ee=>_.value=ee),options:u.value,"option-label":"label","option-value":"code","option-description":"description",label:"Model",placeholder:"Search models...",required:"",disabled:!f.value,loading:q.value,error:U.value.model,hint:"Select the device model",onChange:v},null,8,["modelValue","options","disabled","loading","error"])]),e("div",Do,[F[6]||(F[6]=e("label",{for:"controller-device"},[e("i",{class:"mdi mdi-remote"}),S(" Controller Device * ")],-1)),G(e("select",{id:"controller-device","onUpdate:modelValue":F[2]||(F[2]=ee=>$.value=ee),required:"",onChange:I},[F[5]||(F[5]=e("option",{value:""},"-- Select Controller Device --",-1)),(l(!0),n(ve,null,ke(o.broadlinkDevices,ee=>(l(),n("option",{key:ee.entity_id,value:ee.entity_id},[S(m(ee.name||ee.entity_id)+" ",1),ee.area_name?(l(),n(ve,{key:0},[S(" - "+m(ee.area_name),1)],64)):L("",!0)],8,xo))),128))],544),[[Ce,$.value]]),F[7]||(F[7]=e("small",null,"Which remote device will send the IR/RF commands",-1)),U.value.controller?(l(),n("div",To,m(U.value.controller),1)):L("",!0)]),o.entityType==="climate"?(l(),n(ve,{key:0},[e("div",Mo,[F[8]||(F[8]=e("label",{for:"temperature-sensor"},"Temperature Sensor",-1)),G(e("input",{id:"temperature-sensor","onUpdate:modelValue":F[3]||(F[3]=ee=>R.value=ee),type:"text",placeholder:"e.g., sensor.living_room_temperature",onInput:X},null,544),[[Ie,R.value]]),F[9]||(F[9]=e("small",null,"Optional: Temperature sensor entity for current temperature",-1))]),e("div",Ro,[F[10]||(F[10]=e("label",{for:"humidity-sensor"},"Humidity Sensor",-1)),G(e("input",{id:"humidity-sensor","onUpdate:modelValue":F[4]||(F[4]=ee=>w.value=ee),type:"text",placeholder:"e.g., sensor.living_room_humidity",onInput:Q},null,544),[[Ie,w.value]]),F[11]||(F[11]=e("small",null,"Optional: Humidity sensor entity for current humidity",-1))])],64)):L("",!0),t.value?(l(),n("div",Lo,[F[16]||(F[16]=e("div",{class:"info-header"},[e("i",{class:"mdi mdi-information"}),e("span",null,"Selected Device Code")],-1)),e("div",Ao,[e("div",Eo,[F[12]||(F[12]=e("span",{class:"info-label"},"Code ID:",-1)),e("span",Oo,m(t.value.code_id),1)]),e("div",Vo,[F[13]||(F[13]=e("span",{class:"info-label"},"Manufacturer:",-1)),e("span",Po,m(t.value.manufacturer),1)]),t.value.models&&t.value.models.length>0?(l(),n("div",Uo,[F[14]||(F[14]=e("span",{class:"info-label"},"Supported Models:",-1)),e("span",jo,m(t.value.models.join(", ")),1)])):L("",!0),e("div",Fo,[F[15]||(F[15]=e("span",{class:"info-label"},"Controller:",-1)),e("span",No,m(t.value.controller||"Broadlink"),1)])])])):L("",!0)]))}},qo=$e(Bo,[["__scopeId","data-v-1911c8f6"]]),Ho={class:"modal-content"},zo={class:"modal-header"},Jo={class:"input-wrapper"},Wo={key:0,class:"validation-tooltip"},Go={class:"input-wrapper"},Ko=["disabled"],Xo={key:0,class:"validation-tooltip"},Yo={key:0,class:"smartir-notice"},Zo={key:0,class:"notice-success"},Qo={key:1,class:"notice-warning"},el={key:1,class:"smartir-notice"},tl={key:2},ol={class:"form-group"},ll=["disabled"],nl=["disabled"],sl={key:0},al={key:1},il={key:2},rl={key:3},dl={key:0,class:"form-group"},ul={class:"area-display-readonly"},cl=["value"],ml=["disabled"],vl=["href"],pl={key:1,class:"form-group"},fl={class:"form-group"},gl={class:"input-wrapper"},yl=["value"],bl=["value"],hl={key:2,class:"validation-tooltip"},kl={key:0},wl={key:1},$l={key:3,class:"smartir-section"},Cl={class:"modal-footer"},_l={type:"submit",form:"device-form",class:"btn btn-primary"},Sl={__name:"DeviceForm",props:{device:{type:Object,default:null}},emits:["save","cancel"],setup(o,{emit:c}){const r=o,k=c,b=Se("smartirStatus"),s=Se("smartirEnabled"),u=J(()=>{var d;return localStorage.getItem("smartir_simulate_not_installed")==="true"?!1:((d=b==null?void 0:b.value)==null?void 0:d.installed)||!1}),f=J(()=>!!r.device),_=J(()=>["climate","media_player","fan","light"].includes(t.value.entity_type)),$=J(()=>u.value?!_.value&&t.value.entity_type?"(Not supported for this type)":"(Pre-configured Codes)":"(Requires SmartIR)"),R=J(()=>{var d;const x=((d=r.device)==null?void 0:d.commands)||{};return Object.keys(x).length>0}),w=J(()=>{if(!t.value.broadlink_entity)return"";const x=a.value.find(d=>d.entity_id===t.value.broadlink_entity);return x&&x.name||t.value.broadlink_entity}),t=y({name:"",entity_type:"",device_type:"broadlink",device:"",area:"",icon:"",broadlink_entity:"",enabled:!0,commands:{}}),A=y({name:"",entity_type:"",broadlink_entity:""}),q=y({}),U=y(null),M=y([]),a=y([]),h=y(null),v=y(null),I=y(null),X=y(!1);Te(async()=>{r.device&&(t.value={...r.device,device_type:r.device.device_type||"broadlink"},t.value.device_type==="smartir"&&(q.value={manufacturer:r.device.manufacturer,model:r.device.model,device_code:r.device.device_code,controller_device:r.device.controller_device,temperature_sensor:r.device.temperature_sensor,humidity_sensor:r.device.humidity_sensor})),await Promise.all([Q(),te()])});const Q=async()=>{try{const x=await oe.get("/api/areas");M.value=x.data.areas||[]}catch(x){console.error("Error loading areas:",x),M.value=[]}},te=async()=>{try{const d=(await oe.get("/api/remote/devices")).data.devices||[];a.value=d,console.log("Loaded remote devices:",d)}catch(x){console.error("Error loading remote devices:",x),a.value=[]}},de=x=>{if(!x)return"";const d=x.toLowerCase();for(const V of M.value){const fe=V.toLowerCase();if(d.includes(fe))return V}return""},O=(x,d="")=>{const V=d.toLowerCase();return V.includes("tv")?"mdi:television":V.includes("lamp")?"mdi:lamp":V.includes("ceiling")?"mdi:ceiling-light":V.includes("floor")?"mdi:floor-lamp":V.includes("desk")?"mdi:desk-lamp":V.includes("fan")?"mdi:fan":V.includes("ac")||V.includes("air con")?"mdi:air-conditioner":V.includes("heater")?"mdi:radiator":V.includes("blind")?"mdi:blinds":V.includes("curtain")?"mdi:curtains":V.includes("garage")?"mdi:garage":V.includes("speaker")||V.includes("stereo")?"mdi:speaker":V.includes("receiver")?"mdi:audio-video":{light:"mdi:lightbulb",fan:"mdi:fan",switch:"mdi:light-switch",media_player:"mdi:television",cover:"mdi:window-shutter",climate:"mdi:thermostat"}[x]||"mdi:devices"};ue(()=>t.value.name,x=>{if(!f.value&&x&&!t.value.area){const d=de(x);d&&(t.value.area=d)}!f.value&&x&&t.value.entity_type&&(X.value||!t.value.icon)&&(t.value.icon=O(t.value.entity_type,x),X.value=!0)}),ue(()=>t.value.entity_type,x=>{!f.value&&x&&(X.value||!t.value.icon)&&(t.value.icon=O(x,t.value.name),X.value=!0)}),ue(()=>t.value.icon,(x,d)=>{d!==void 0&&x!==d&&!X.value&&(X.value=!1),x||(X.value=!1)});const F=y(!1),ee=async()=>{var x;if((x=r.device)!=null&&x.id){F.value=!0;try{const d=await oe.post(`/api/devices/${r.device.id}/sync-area`);d.data.success?(t.value.area=d.data.area||"",d.data.area?console.log(`Area synced: ${d.data.area}`):console.log("No area assigned in Home Assistant")):console.warn(d.data.message||"Entity not found in HA")}catch(d){console.error("Failed to sync area:",d)}finally{F.value=!1}}},me=()=>{var V;return!((V=r.device)!=null&&V.id)||!t.value.entity_type?"#":`/config/entities/entity/${`${t.value.entity_type}.${r.device.id}`}`},pe=()=>{A.value={name:"",entity_type:"",broadlink_entity:""};let x=!0;return(!t.value.name||t.value.name.trim()==="")&&(A.value.name="Device name is required",x=!1),t.value.entity_type||(A.value.entity_type="Entity type is required",x=!1),t.value.device_type==="broadlink"&&!t.value.broadlink_entity&&(A.value.broadlink_entity="Broadlink device is required",x=!1),x},De=x=>{A.value[x]=""},xe=async()=>{if(t.value.device_type==="smartir"){if(U.value&&!U.value.validate())return;const x={...t.value,smartir_config:{manufacturer:q.value.manufacturer,model:q.value.model,code_id:q.value.device_code,controller_device:q.value.controller_device}};k("save",x)}else{if(!pe())return;k("save",{...t.value})}},Me=x=>{q.value=x};return(x,d)=>(l(),n("div",{class:"modal-overlay",onClick:d[11]||(d[11]=ye(V=>x.$emit("cancel"),["self"]))},[e("div",Ho,[e("div",zo,[e("h2",null,m(f.value?"Edit Device":"Add New Device"),1),e("button",{onClick:d[0]||(d[0]=V=>x.$emit("cancel")),class:"close-btn"},[...d[12]||(d[12]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("form",{id:"device-form",onSubmit:ye(xe,["prevent"]),class:"modal-body"},[e("div",{class:Z(["form-group",{"has-error":A.value.name}])},[d[14]||(d[14]=e("label",{for:"device-name"},"Device Name *",-1)),e("div",Jo,[G(e("input",{id:"device-name",ref_key:"nameInput",ref:h,"onUpdate:modelValue":d[1]||(d[1]=V=>t.value.name=V),type:"text",placeholder:"e.g., Living Room TV",onInput:d[2]||(d[2]=V=>De("name"))},null,544),[[Ie,t.value.name]]),A.value.name?(l(),n("div",Wo,[d[13]||(d[13]=e("i",{class:"mdi mdi-alert"},null,-1)),S(" "+m(A.value.name),1)])):L("",!0)]),d[15]||(d[15]=e("small",null,"Friendly name for this device",-1))],2),e("div",{class:Z(["form-group",{"has-error":A.value.entity_type}])},[d[23]||(d[23]=e("label",{for:"entity-type"},"Entity Type *",-1)),e("div",Go,[G(e("select",{id:"entity-type",ref_key:"typeSelect",ref:v,"onUpdate:modelValue":d[3]||(d[3]=V=>t.value.entity_type=V),onChange:d[4]||(d[4]=V=>De("entity_type"))},[d[16]||(d[16]=Ee('<option value="" data-v-94bc1fe5>-- Select Type --</option><option value="light" data-v-94bc1fe5>💡 Light</option><option value="fan" data-v-94bc1fe5>🌀 Fan</option><option value="switch" data-v-94bc1fe5>🔌 Switch</option><option value="media_player" data-v-94bc1fe5>📺 Media Player</option><option value="cover" data-v-94bc1fe5>🪟 Cover (Blinds/Curtains)</option>',6)),e("option",{value:"climate",disabled:!u.value}," 🌡️ Climate "+m(u.value?"":"(Requires SmartIR)"),9,Ko)],544),[[Ce,t.value.entity_type]]),A.value.entity_type?(l(),n("div",Xo,[d[17]||(d[17]=e("i",{class:"mdi mdi-alert"},null,-1)),S(" "+m(A.value.entity_type),1)])):L("",!0)]),t.value.entity_type==="climate"?(l(),n("div",Yo,[u.value?(l(),n("div",Zo,[...d[18]||(d[18]=[e("i",{class:"mdi mdi-check-circle"},null,-1),e("span",null,"SmartIR detected! Climate entities will be created via SmartIR profiles.",-1)])])):(l(),n("div",Qo,[...d[19]||(d[19]=[e("i",{class:"mdi mdi-alert"},null,-1),e("div",null,[e("strong",null,"SmartIR Required"),e("p",null,"Climate entities (AC, heaters) require SmartIR integration."),e("a",{href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"smartir-link"}," Install SmartIR → ")],-1)])]))])):u.value&&["media_player","fan","light"].includes(t.value.entity_type)?(l(),n("div",el,[...d[20]||(d[20]=[e("div",{class:"notice-info"},[e("i",{class:"mdi mdi-information"}),e("span",null,"💡 SmartIR available! You can use pre-configured codes or learn your own.")],-1)])])):!u.value&&t.value.entity_type?(l(),n("small",tl,[d[21]||(d[21]=S(" 💡 Tip: Install ",-1)),d[22]||(d[22]=e("a",{href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"inline-link"},"SmartIR",-1)),S(" for pre-configured "+m(t.value.entity_type==="climate"?"climate":t.value.entity_type)+" device codes ",1)])):L("",!0)],2),e("div",ol,[d[26]||(d[26]=e("label",{for:"device-type"},"Device Type *",-1)),G(e("select",{id:"device-type","onUpdate:modelValue":d[5]||(d[5]=V=>t.value.device_type=V),required:"",disabled:f.value},[d[24]||(d[24]=e("option",{value:""},"-- Select Device Type --",-1)),d[25]||(d[25]=e("option",{value:"broadlink"},"📡 Broadlink Device (Learn IR Codes)",-1)),_e(s)?(l(),n("option",{key:0,value:"smartir",disabled:!u.value||!_.value}," 🌐 SmartIR Device "+m($.value),9,nl)):L("",!0)],8,ll),[[Ce,t.value.device_type]]),f.value?(l(),n("small",sl,"Cannot change device type after creation")):t.value.device_type==="smartir"?(l(),n("small",al,"Using pre-configured codes from SmartIR repository")):t.value.device_type==="broadlink"?(l(),n("small",il,"Learn and store your own IR codes")):(l(),n("small",rl,"Choose how to configure this device"))]),f.value?(l(),n("div",dl,[d[29]||(d[29]=e("label",{for:"device-area"},"Area",-1)),e("div",ul,[e("input",{id:"device-area",value:t.value.area||"Not assigned",type:"text",readonly:"",class:"readonly-input"},null,8,cl),e("button",{type:"button",onClick:ee,disabled:F.value,class:"sync-area-btn",title:"Sync area from Home Assistant"},[e("i",{class:Z(F.value?"mdi mdi-loading mdi-spin":"mdi mdi-refresh")},null,2)],8,ml)]),e("small",null,[d[27]||(d[27]=e("i",{class:"mdi mdi-information-outline"},null,-1)),d[28]||(d[28]=S(" Set area in Home Assistant, then click sync. ",-1)),e("a",{href:me(),target:"_blank",class:"inline-link"},"Open in HA →",8,vl)])])):(l(),n("div",pl,[...d[30]||(d[30]=[e("div",{class:"info-notice"},[e("i",{class:"mdi mdi-information-outline"}),e("span",null,[e("strong",null,"Area Assignment:"),S(" After generating entities and restarting Home Assistant, you can assign areas in HA and sync them here.")])],-1)])])),e("div",fl,[d[31]||(d[31]=e("label",{for:"device-icon"},"Icon",-1)),be(ao,{modelValue:t.value.icon,"onUpdate:modelValue":d[6]||(d[6]=V=>t.value.icon=V),inputId:"device-icon",placeholder:"e.g., mdi:television"},null,8,["modelValue"]),d[32]||(d[32]=e("small",null,"Optional: Material Design Icon name",-1))]),t.value.device_type==="broadlink"?(l(),n("div",{key:2,class:Z(["form-group",{"has-error":A.value.broadlink_entity}])},[d[35]||(d[35]=e("label",{for:"broadlink-entity"},"Remote Device *",-1)),e("div",gl,[!f.value||!R.value?G((l(),n("select",{key:0,id:"broadlink-entity",ref_key:"broadlinkSelect",ref:I,"onUpdate:modelValue":d[7]||(d[7]=V=>t.value.broadlink_entity=V),onChange:d[8]||(d[8]=V=>De("broadlink_entity"))},[d[33]||(d[33]=e("option",{value:""},"-- Select Remote Device --",-1)),(l(!0),n(ve,null,ke(a.value,V=>(l(),n("option",{key:V.entity_id,value:V.entity_id},[S(m(V.name||V.entity_id)+" ",1),V.area_name?(l(),n(ve,{key:0},[S(" - "+m(V.area_name),1)],64)):L("",!0)],8,yl))),128))],544)),[[Ce,t.value.broadlink_entity]]):(l(),n("input",{key:1,id:"broadlink-entity",value:w.value,type:"text",readonly:"",disabled:""},null,8,bl)),A.value.broadlink_entity?(l(),n("div",hl,[d[34]||(d[34]=e("i",{class:"mdi mdi-alert"},null,-1)),S(" "+m(A.value.broadlink_entity),1)])):L("",!0)]),!f.value||!R.value?(l(),n("small",kl,"Required: Select which remote device to use for sending commands")):(l(),n("small",wl,"Cannot change remote device after commands are learned"))],2)):L("",!0),t.value.device_type==="smartir"?(l(),n("div",$l,[d[36]||(d[36]=e("div",{class:"section-header"},[e("i",{class:"mdi mdi-cloud-download"}),e("span",null,"SmartIR Device Configuration")],-1)),be(qo,{ref_key:"smartirSelector",ref:U,"entity-type":t.value.entity_type,modelValue:q.value,"onUpdate:modelValue":d[9]||(d[9]=V=>q.value=V),"broadlink-devices":a.value,onChange:Me},null,8,["entity-type","modelValue","broadlink-devices"])])):L("",!0)],32),e("div",Cl,[e("button",{type:"button",onClick:d[10]||(d[10]=V=>x.$emit("cancel")),class:"btn btn-secondary"}," Cancel "),e("button",_l,[d[37]||(d[37]=e("i",{class:"mdi mdi-check"},null,-1)),S(" "+m(f.value?"Update":"Create"),1)])])])]))}},Il=$e(Sl,[["__scopeId","data-v-94bc1fe5"]]),Dl={class:"modal-header"},xl={class:"modal-body"},Tl={class:"message-text"},Ml={key:0,class:"checkbox-option"},Rl={class:"modal-footer"},Ll=["disabled"],Al={__name:"ConfirmDialog",props:{isOpen:{type:Boolean,default:!1},title:{type:String,default:"Confirm"},message:{type:String,required:!0},confirmText:{type:String,default:"OK"},cancelText:{type:String,default:"Cancel"},showCancel:{type:Boolean,default:!0},dangerMode:{type:Boolean,default:!1},confirmDisabled:{type:Boolean,default:!1},checkboxLabel:{type:String,default:""}},emits:["confirm","cancel"],setup(o,{emit:c}){const r=o,k=c,b=y(!1);ue(()=>r.isOpen,f=>{f&&(b.value=!1)});const s=()=>{k("confirm",b.value)},u=()=>{k("cancel")};return(f,_)=>o.isOpen?(l(),n("div",{key:0,class:"modal-overlay",onClick:ye(u,["self","stop"])},[e("div",{class:"modal-dialog confirm-dialog",onClick:_[1]||(_[1]=ye(()=>{},["stop"]))},[e("div",Dl,[e("h2",null,m(o.title),1)]),e("div",xl,[e("p",Tl,m(o.message),1),o.checkboxLabel?(l(),n("div",Ml,[e("label",null,[G(e("input",{type:"checkbox","onUpdate:modelValue":_[0]||(_[0]=$=>b.value=$)},null,512),[[ge,b.value]]),e("span",null,m(o.checkboxLabel),1)])])):L("",!0)]),e("div",Rl,[o.showCancel?(l(),n("button",{key:0,onClick:ye(u,["stop"]),class:"btn btn-secondary"},m(o.cancelText),1)):L("",!0),o.confirmText?(l(),n("button",{key:1,onClick:ye(s,["stop"]),class:Z(["btn",o.dangerMode?"btn-danger":"btn-primary"]),disabled:o.confirmDisabled},m(o.confirmText),11,Ll)):L("",!0)])])])):L("",!0)}},Ae=$e(Al,[["__scopeId","data-v-9cea6cb3"]]),El={class:"modal-content"},Ol={class:"modal-header"},Vl={class:"modal-body"},Pl={key:0,class:"smartir-info"},Ul={key:0,class:"climate-note"},jl={class:"form-group"},Fl=["value"],Nl={class:"form-group"},Bl=["disabled"],ql={label:"Suggested Commands"},Hl=["value"],zl=["disabled"],Jl={class:"form-group"},Wl={class:"radio-group"},Gl={class:"radio-label"},Kl=["disabled"],Xl={class:"radio-label"},Yl=["disabled"],Zl={class:"learn-action"},Ql=["disabled"],en={key:0,class:"mdi mdi-loading mdi-spin"},tn={key:1,class:"mdi mdi-remote-tv"},on={key:0,class:"learning-status"},ln={key:0},nn={key:1,class:"rf-instructions"},sn={key:1,class:"result-message success"},an={key:2,class:"section-divider"},rn={key:3,class:"learned-commands"},dn={class:"command-list"},un={class:"command-info"},cn={class:"command-name"},mn={class:"learned-status"},vn={class:"command-actions"},pn=["onClick","disabled"],fn=["onClick"],gn={key:4,class:"untracked-commands"},yn={class:"command-list"},bn={class:"command-name"},hn={class:"modal-footer"},kn=["disabled"],wn={__name:"CommandLearner",props:{device:{type:Object,required:!0}},emits:["cancel","learned"],setup(o,{emit:c}){const r=o,k=c,b=y([]),s=y(""),u=y(""),f=y(""),_=y("ir"),$=y(!1),R=y(""),w=y("success"),t=y([]),A=y([]),q=y(!1),U=y(""),M=y(!1),a=y(null),h=y(null),v=y(""),I=y(""),X=J(()=>r.device.device_type==="smartir");J(()=>{if(X.value)return!1;const K=u.value==="__custom__"?f.value:u.value;return s.value&&K.trim()});const Q=()=>{a.value&&a.value.setCustomValidity("")},te=()=>{h.value&&h.value.setCustomValidity("")},de=J(()=>{const K=b.value.find(g=>g.entity_id===s.value);return K?K.name||K.entity_id:s.value}),O={light:["turn_on","turn_off","toggle","brightness_up","brightness_down","dim","bright"],fan:["turn_on","turn_off","toggle","speed_low","speed_medium","speed_high","speed_1","speed_2","speed_3","speed_4","speed_5","oscillate_on","oscillate_off","direction_forward","direction_reverse"],switch:["turn_on","turn_off","toggle"],media_player:["turn_on","turn_off","toggle","volume_up","volume_down","volume_mute","play","pause","stop","play_pause","next_track","previous_track","channel_up","channel_down","source_hdmi1","source_hdmi2","source_hdmi3","source_tv","source_aux","source_bluetooth","menu","home","back","select","arrow_up","arrow_down","arrow_left","arrow_right"],cover:["open","close","stop","open_tilt","close_tilt","position_0","position_25","position_50","position_75","position_100"]},F=J(()=>{const K=r.device.entity_type||"switch";return O[K]||O.switch});Te(async()=>{await ee();try{console.log("🔄 Syncing command types...");const g=await oe.post("/api/commands/sync");console.log("✅ Command types synced:",g.data)}catch(g){console.error("⚠️ Failed to sync command types:",g)}const K=!X.value;console.log(`📋 Will ${K?"FORCE RELOAD":"use cached"} commands`),await me(K),a.value&&(a.value.setCustomValidity(""),a.value.oninvalid=()=>{a.value.setCustomValidity("Command name is required")}),r.device.broadlink_entity&&(s.value=r.device.broadlink_entity)}),ue(u,async K=>{K==="__custom__"&&(await Xe(),h.value&&(h.value.setCustomValidity(""),h.value.oninvalid=()=>{h.value.setCustomValidity("Custom command name is required")}))});const ee=async()=>{try{const K=await oe.get("/api/broadlink/devices");b.value=K.data.devices||[]}catch(K){console.error("Error loading Broadlink devices:",K)}},me=async(K=!1)=>{var g,p;try{if(X.value){const W=await oe.get("/api/smartir/codes/code",{params:{entity_type:r.device.entity_type,code_id:r.device.device_code}});if(W.data.success&&W.data.code){const le=W.data.code.commands||{},z=W.data.code.commandType||"ir";if(r.device.entity_type==="climate"){const C=[];for(const[ie,Y]of Object.entries(le))typeof Y=="string"?C.push({name:ie,type:z}):typeof Y=="object"&&Y!==null&&Object.keys(Y).sort((E,i)=>parseInt(E)-parseInt(i)).forEach(E=>{C.push({name:`${ie}_${E}`,type:z,label:`${ie.charAt(0).toUpperCase()+ie.slice(1)} ${E}°C`})});t.value=C}else t.value=Object.keys(le).map(C=>({name:C,type:z}))}}else{if(console.log("📋 Loading commands for device:",r.device),console.log("📋 Device ID:",r.device.id),console.log("📋 Force reload:",K),K&&r.device.id){console.log("🔄 Force reloading commands from API after sync");try{const le=(await oe.get(`/api/commands/${r.device.id}`)).data.commands||{};console.log("📦 Raw commands from API:",le),t.value=Object.entries(le).map(([z,C])=>{console.log(`  Command '${z}':`,C,`(type: ${typeof C})`);const ie=typeof C=="object"&&C!==null&&(C.command_type||C.type)||"ir";return{name:z,type:ie}}),console.log("📋 Reloaded commands:",t.value)}catch(W){if(console.error("❌ Error loading commands:",W),((g=W.response)==null?void 0:g.status)===404)console.log("ℹ️ No commands found for device"),t.value=[];else throw W}}else if(r.device.commands&&Object.keys(r.device.commands).length>0)console.log("✅ Using commands from device object"),t.value=Object.entries(r.device.commands).map(([W,le])=>({name:W,type:le.command_type||le.type||"ir"}));else if(r.device.commands!==void 0)console.log("ℹ️ Device has empty commands object - skipping API call"),t.value=[];else if(r.device.id){console.log("🌐 Fetching commands from API for device ID:",r.device.id);try{const le=(await oe.get(`/api/commands/${r.device.id}`)).data.commands||{};t.value=Object.entries(le).map(([z,C])=>({name:z,type:C.command_type||C.type||"ir"}))}catch(W){if(((p=W.response)==null?void 0:p.status)===404)console.log("ℹ️ No commands found for device (this is normal for new devices)"),t.value=[];else throw W}}else console.log("⚠️ No commands found and no device ID");console.log("📋 Final learned commands:",t.value)}}catch(W){console.error("Error loading commands:",W)}},pe=async()=>{var K,g;R.value="",w.value="",$.value=!0;try{let p=r.device.id.split(".")[1];r.device.device&&(p=r.device.device);const W=u.value==="__custom__"?f.value:u.value,le=await oe.post("/api/commands/learn",{entity_id:s.value,device:p,device_id:r.device.id,command:W.trim(),command_type:_.value});if(le.data.success){R.value=`Command "${W}" learned successfully!`,w.value="success",t.value.find(Y=>Y.name===W)||t.value.push({name:W,type:_.value});const C=A.value.indexOf(W);C>-1&&A.value.splice(C,1);const ie={...r.device.commands};ie[W]={command_type:_.value,type:_.value},await d(),u.value="",f.value="",k("learned",{commands:ie,commandName:W})}else R.value=le.data.error||"Failed to learn command",w.value="error"}catch(p){R.value=((g=(K=p.response)==null?void 0:K.data)==null?void 0:g.error)||"Error learning command",w.value="error"}finally{$.value=!1}},De=async K=>{var g,p;try{I.value=K,v.value="";let W=r.device.id.split(".")[1];r.device.device&&(W=r.device.device);const le=X.value?r.device.controller_device:s.value||r.device.broadlink_entity;if(!le){console.error("Missing entity_id for test command:",{isSmartIR:X.value,controller_device:r.device.controller_device,broadlink_entity:r.device.broadlink_entity,selectedBroadlink:s.value,device:r.device}),R.value="Missing Broadlink remote entity. Please select a Broadlink device.",w.value="error",I.value="";return}const z={entity_id:le,device:W,command:K,device_id:r.device.id};console.log("🧪 Testing command:",z),(await oe.post("/api/commands/test",z)).data.success&&(v.value=K,setTimeout(()=>{v.value===K&&(v.value="")},2e3))}catch(W){console.error("❌ Test command error:",W);const le=((p=(g=W.response)==null?void 0:g.data)==null?void 0:p.error)||W.message||"Unknown error";R.value=`Failed to send command: ${le}`,w.value="error"}finally{I.value=""}},xe=K=>{U.value=K,q.value=!0},Me=()=>{q.value=!1,U.value=""},x=async()=>{const K=U.value;q.value=!1;try{console.log(`🗑️ Deleting command: ${K}`),await oe.delete(`/api/commands/${r.device.id}/${K}`),t.value=t.value.filter(g=>g.name!==K),await me(),await d(),R.value=`Command "${K}" deleted`,w.value="success",k("learned")}catch(g){console.error("❌ Delete error:",g),R.value=`Failed to delete command: ${g.message}`,w.value="error"}finally{U.value=""}},d=async()=>{try{let K=r.device.device;K||(K=r.device.id.includes(".")?r.device.id.split(".")[1]:r.device.id),console.log("🔍 Looking for untracked commands for device:",K);const p=(await oe.get("/api/commands/untracked")).data.untracked||{};console.log("📦 All untracked commands:",Object.keys(p)),console.log("📦 Untracked for this device:",p[K]),p[K]?A.value=Object.keys(p[K].commands):A.value=[]}catch(K){console.error("Error loading untracked commands:",K),A.value=[]}},V=()=>{A.value.length!==0&&(M.value=!0)},fe=async()=>{M.value=!1;try{const K=r.device.device||r.device.id.split(".")[1],g=await oe.post("/api/commands/import",{device_id:r.device.id,source_device:K,commands:A.value});g.data.success&&(R.value=`Imported ${g.data.imported_count} commands successfully!`,w.value="success",await me(),await d(),k("learned"))}catch(K){R.value=`Failed to import commands: ${K.message}`,w.value="error"}};return(K,g)=>(l(),n("div",{class:"modal-overlay",onClick:g[7]||(g[7]=ye(p=>K.$emit("cancel"),["self"]))},[e("div",El,[e("div",Ol,[e("h2",null,m(X.value?"Commands for":"Learn Commands for")+" "+m(o.device.name),1),e("button",{onClick:g[0]||(g[0]=p=>K.$emit("cancel")),class:"close-btn"},[...g[8]||(g[8]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Vl,[X.value?(l(),n("div",Pl,[g[13]||(g[13]=e("i",{class:"mdi mdi-information"},null,-1)),e("div",null,[g[12]||(g[12]=e("h3",null,"SmartIR Device",-1)),e("p",null,[g[9]||(g[9]=S("This device uses SmartIR code file ",-1)),e("strong",null,m(o.device.device_code),1),g[10]||(g[10]=S(". Commands are pre-configured and cannot be learned.",-1))]),o.device.entity_type==="climate"?(l(),n("p",Ul,[...g[11]||(g[11]=[e("i",{class:"mdi mdi-alert-circle-outline"},null,-1),e("strong",null,"Note:",-1),S(" Climate device commands are temperature-based. Testing individual modes may not work as expected. Use the Home Assistant climate card to control your device. ",-1)])])):L("",!0)])])):(l(),n("form",{key:1,onSubmit:ye(pe,["prevent"])},[e("div",jl,[g[14]||(g[14]=e("label",{for:"broadlink-entity"},"Broadlink Device",-1)),e("input",{id:"broadlink-entity",value:de.value,type:"text",readonly:"",disabled:""},null,8,Fl),g[15]||(g[15]=e("small",null,"Commands will be learned using this device (set when device was created)",-1))]),e("div",Nl,[g[18]||(g[18]=e("label",{for:"command-name"},"Command Name *",-1)),G(e("select",{id:"command-name",ref_key:"commandSelect",ref:a,"onUpdate:modelValue":g[1]||(g[1]=p=>u.value=p),disabled:$.value,required:"",onChange:Q},[g[16]||(g[16]=e("option",{value:""},"-- Select or type command --",-1)),e("optgroup",ql,[(l(!0),n(ve,null,ke(F.value,p=>(l(),n("option",{key:p,value:p},m(p),9,Hl))),128))]),g[17]||(g[17]=e("option",{value:"__custom__"},"Custom command...",-1))],40,Bl),[[Ce,u.value]]),u.value==="__custom__"?G((l(),n("input",{key:0,ref_key:"customCommandInput",ref:h,"onUpdate:modelValue":g[2]||(g[2]=p=>f.value=p),type:"text",placeholder:"Enter custom command name",disabled:$.value,required:"",class:"custom-command-input",onInput:te},null,40,zl)),[[Ie,f.value]]):L("",!0),e("small",null,"Select a suggested command for "+m(o.device.entity_type||"this device")+", or enter a custom one.",1)]),e("div",Jl,[g[21]||(g[21]=e("label",null,"Command Type",-1)),e("div",Wl,[e("label",Gl,[G(e("input",{type:"radio","onUpdate:modelValue":g[3]||(g[3]=p=>_.value=p),value:"ir",disabled:$.value},null,8,Kl),[[Fe,_.value]]),g[19]||(g[19]=e("span",null,"IR (Infrared)",-1))]),e("label",Xl,[G(e("input",{type:"radio","onUpdate:modelValue":g[4]||(g[4]=p=>_.value=p),value:"rf",disabled:$.value},null,8,Yl),[[Fe,_.value]]),g[20]||(g[20]=e("span",null,"RF (Radio Frequency)",-1))])])]),e("div",Zl,[e("button",{type:"submit",class:"btn btn-primary btn-large",disabled:$.value},[$.value?(l(),n("i",en)):(l(),n("i",tn)),S(" "+m($.value?"Learning...":"Learn Command"),1)],8,Ql)]),$.value?(l(),n("div",on,[g[24]||(g[24]=e("i",{class:"mdi mdi-loading mdi-spin"},null,-1)),_.value==="ir"?(l(),n("div",ln,[...g[22]||(g[22]=[e("p",null,"Point your remote at the Broadlink device and press the button...",-1),e("small",null,"This may take up to 30 seconds",-1)])])):_.value==="rf"?(l(),n("div",nn,[...g[23]||(g[23]=[e("p",null,[e("strong",null,"Learning request sent to device.")],-1),e("p",null,"RF learning is a two-step process:",-1),e("ol",null,[e("li",null,[e("strong",null,"Step 1 - Frequency Sweep (~10-15 seconds):"),S(" Press and hold the button on your remote until the notification updates.")]),e("li",null,[e("strong",null,"Step 2 - Learn Signal:"),S(" Press and release the button once.")])],-1),e("p",{class:"ha-note"},[S(" Follow the Home Assistant notifications ("),e("i",{class:"mdi mdi-bell"}),S(") for real-time instructions. ")],-1)])])):L("",!0)])):L("",!0),R.value&&w.value==="success"&&!R.value.includes("sent successfully")?(l(),n("div",sn,[g[25]||(g[25]=e("i",{class:"mdi mdi-check-circle"},null,-1)),e("p",null,m(R.value),1)])):L("",!0)],32)),t.value.length>0||A.value.length>0?(l(),n("div",an)):L("",!0),t.value.length>0?(l(),n("div",rn,[e("h3",null,"Tracked Commands ("+m(t.value.length)+")",1),e("div",dn,[(l(!0),n(ve,null,ke(t.value,p=>(l(),n("div",{key:p.name,class:"command-item"},[e("div",un,[e("span",cn,m(p.label||p.name),1)]),e("div",mn,[g[26]||(g[26]=e("i",{class:"mdi mdi-check-circle"},null,-1)),g[27]||(g[27]=e("span",null,"Learned",-1)),e("span",{class:Z(["command-type-badge",p.type||"ir"])},m((p.type||"ir").toUpperCase()),3)]),e("div",vn,[e("button",{type:"button",onClick:W=>De(p.name),class:"icon-btn",title:"Test command",disabled:I.value===p.name},[e("i",{class:Z(["mdi mdi-play",{"mdi-spin":I.value===p.name}])},null,2)],8,pn),e("button",{type:"button",onClick:W=>xe(p.name),class:"icon-btn danger",title:"Delete and re-learn"},[...g[28]||(g[28]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,fn)])]))),128))])])):L("",!0),A.value.length>0?(l(),n("div",gn,[e("h3",null,[g[29]||(g[29]=e("i",{class:"mdi mdi-alert"},null,-1)),S(" Untracked Commands ("+m(A.value.length)+") ",1)]),g[32]||(g[32]=e("p",{class:"untracked-info"}," These commands exist in Broadlink storage but are not tracked in this device. ",-1)),e("div",yn,[(l(!0),n(ve,null,ke(A.value,p=>(l(),n("div",{key:p,class:"command-item untracked"},[e("span",bn,m(p),1),g[30]||(g[30]=e("span",{class:"untracked-badge"},"Not tracked",-1))]))),128))]),e("button",{type:"button",onClick:V,class:"btn btn-secondary"},[...g[31]||(g[31]=[e("i",{class:"mdi mdi-import"},null,-1),S(" Import All Untracked Commands ",-1)])])])):L("",!0)]),e("div",hn,[e("button",{type:"button",onClick:g[5]||(g[5]=p=>K.$emit("cancel")),class:"btn btn-secondary",disabled:$.value}," Close ",8,kn)])]),be(Ae,{isOpen:q.value,title:"Delete Command?",message:`Delete command '${U.value}'? This will remove it from Broadlink storage.`,confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,onConfirm:x,onCancel:Me},null,8,["isOpen","message"]),be(Ae,{isOpen:M.value,title:"Import Commands?",message:`Import ${A.value.length} untracked command${A.value.length>1?"s":""} into this device?`,confirmText:"Import",cancelText:"Cancel",onConfirm:fe,onCancel:g[6]||(g[6]=p=>M.value=!1)},null,8,["isOpen","message"])]))}},$n=$e(wn,[["__scopeId","data-v-8c3c338a"]]),Cn={class:"modal-container error-dialog"},_n={class:"modal-header"},Sn={class:"modal-body"},In={class:"error-message"},Dn={key:0,class:"error-suggestion"},xn=["open"],Tn={class:"debug-content"},Mn={class:"debug-info"},Rn={key:0,class:"debug-section-title"},Ln={key:1},An={__name:"ErrorDialog",props:{isOpen:{type:Boolean,default:!1},title:{type:String,default:"Error"},message:{type:String,required:!0},suggestion:{type:String,default:""},details:{type:String,default:""},error:{type:Object,default:null},context:{type:Object,default:()=>({})}},emits:["close"],setup(o,{emit:c}){const r=o,k=c,b=Se("toast"),s=y(!1),u=()=>{k("close")},f=J(()=>{var A,q,U,M,a,h,v,I,X,Q,te;const w=new Date().toISOString(),t=r.error||{};return{error:JSON.stringify({message:r.message,title:r.title,details:r.details,errorObject:t.message||t.toString(),timestamp:w},null,2),request:JSON.stringify({method:((q=(A=t.config)==null?void 0:A.method)==null?void 0:q.toUpperCase())||"N/A",url:((U=t.config)==null?void 0:U.url)||"N/A",baseURL:((M=t.config)==null?void 0:M.baseURL)||"N/A",headers:((a=t.config)==null?void 0:a.headers)||{},data:(h=t.config)!=null&&h.data?JSON.parse(t.config.data):"N/A",params:((v=t.config)==null?void 0:v.params)||{}},null,2),response:JSON.stringify({status:((I=t.response)==null?void 0:I.status)||"N/A",statusText:((X=t.response)==null?void 0:X.statusText)||"N/A",data:((Q=t.response)==null?void 0:Q.data)||"N/A",headers:((te=t.response)==null?void 0:te.headers)||{}},null,2),browser:JSON.stringify({userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language,cookieEnabled:navigator.cookieEnabled,onLine:navigator.onLine,viewport:`${window.innerWidth}x${window.innerHeight}`,screenResolution:`${window.screen.width}x${window.screen.height}`,colorDepth:window.screen.colorDepth,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,timestamp:w},null,2),appState:JSON.stringify({currentRoute:window.location.pathname,currentURL:window.location.href,referrer:document.referrer||"N/A",context:r.context||{},localStorage:{smartir_simulate:localStorage.getItem("smartir_simulate_not_installed"),theme:localStorage.getItem("theme")}},null,2),stackTrace:t.stack||null}}),_=async()=>{const w=R();try{await navigator.clipboard.writeText(w),b==null||b.success("Debug information copied to clipboard","✅ Copied")}catch(t){console.error("Failed to copy:",t),b==null||b.error("Failed to copy to clipboard","❌ Copy Failed")}},$=()=>{const w=R(),t=new Blob([w],{type:"text/plain"}),A=URL.createObjectURL(t),q=document.createElement("a");q.href=A;const U=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5);q.download=`broadlink-manager-error-${U}.txt`,document.body.appendChild(q),q.click(),document.body.removeChild(q),URL.revokeObjectURL(A),b==null||b.success("Debug report downloaded","✅ Downloaded")},R=()=>`Broadlink Manager - Error Report
${"=".repeat(60)}

Generated: ${new Date().toISOString()}
Title: ${r.title}
Message: ${r.message}
${r.suggestion?`Suggestion: ${r.suggestion}
`:""}
${"=".repeat(60)}

ERROR DETAILS
${"-".repeat(60)}
${f.value.error}

REQUEST INFORMATION
${"-".repeat(60)}
${f.value.request}

RESPONSE INFORMATION
${"-".repeat(60)}
${f.value.response}

BROWSER INFORMATION
${"-".repeat(60)}
${f.value.browser}

APPLICATION STATE
${"-".repeat(60)}
${f.value.appState}

${f.value.stackTrace?`STACK TRACE
${"-".repeat(60)}
${f.value.stackTrace}

`:""}
${"=".repeat(60)}
End of Report
`;return ue(()=>r.isOpen,w=>{if(w){const t=A=>{A.key==="Escape"&&u()};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)}}),(w,t)=>(l(),Le(Ye,{to:"body"},[be(Ke,{name:"modal"},{default:He(()=>[o.isOpen?(l(),n("div",{key:0,class:"modal-overlay",onClick:ye(u,["self"])},[e("div",Cn,[e("div",_n,[t[2]||(t[2]=e("div",{class:"header-icon error-icon"},[e("i",{class:"mdi mdi-alert-circle"})],-1)),e("h3",null,m(o.title),1),e("button",{onClick:u,class:"close-button"},[...t[1]||(t[1]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Sn,[e("p",In,m(o.message),1),o.suggestion?(l(),n("p",Dn,[t[3]||(t[3]=e("i",{class:"mdi mdi-lightbulb-on"},null,-1)),S(" "+m(o.suggestion),1)])):L("",!0),e("details",{class:"debug-section",open:s.value},[e("summary",{onClick:t[0]||(t[0]=A=>s.value=!s.value)},[e("i",{class:Z(["mdi",s.value?"mdi-chevron-down":"mdi-chevron-right"])},null,2),t[4]||(t[4]=S(" Debug Information ",-1))]),e("div",Tn,[e("div",{class:"debug-actions"},[e("button",{onClick:_,class:"btn-debug btn-copy"},[...t[5]||(t[5]=[e("i",{class:"mdi mdi-content-copy"},null,-1),S(" Copy to Clipboard ",-1)])]),e("button",{onClick:$,class:"btn-debug btn-download"},[...t[6]||(t[6]=[e("i",{class:"mdi mdi-download"},null,-1),S(" Download Report ",-1)])])]),e("div",Mn,[t[7]||(t[7]=e("div",{class:"debug-section-title"},"Error Details",-1)),e("pre",null,m(f.value.error),1),t[8]||(t[8]=e("div",{class:"debug-section-title"},"Request Information",-1)),e("pre",null,m(f.value.request),1),t[9]||(t[9]=e("div",{class:"debug-section-title"},"Response Information",-1)),e("pre",null,m(f.value.response),1),t[10]||(t[10]=e("div",{class:"debug-section-title"},"Browser Information",-1)),e("pre",null,m(f.value.browser),1),t[11]||(t[11]=e("div",{class:"debug-section-title"},"Application State",-1)),e("pre",null,m(f.value.appState),1),f.value.stackTrace?(l(),n("div",Rn,"Stack Trace")):L("",!0),f.value.stackTrace?(l(),n("pre",Ln,m(f.value.stackTrace),1)):L("",!0)])])],8,xn)]),e("div",{class:"modal-footer"},[e("button",{onClick:u,class:"btn btn-primary"}," OK ")])])])):L("",!0)]),_:1})]))}},En=$e(An,[["__scopeId","data-v-23858149"]]),On={key:0,class:"discovery-banner"},Vn={class:"banner-content"},Pn={class:"banner-text"},Un={class:"modal-dialog"},jn={class:"modal-header"},Fn={class:"modal-body"},Nn={class:"device-list"},Bn={class:"device-info"},qn={class:"device-details"},Hn={class:"command-count"},zn={class:"device-actions"},Jn=["onClick"],Wn=["onClick"],Gn={class:"modal-footer"},Kn={class:"modal-dialog modal-dialog-small"},Xn={class:"modal-header"},Yn={class:"modal-body"},Zn={class:"warning-message"},Qn={class:"modal-footer"},es=["disabled"],ts=["disabled"],os={__name:"DeviceDiscovery",emits:["adopt"],setup(o,{expose:c,emit:r}){const k=Pe(),b=r,s=y([]),u=y(!1),f=y(!1),_=y(null),$=y(!1),R=J(()=>s.value.length>0);Te(async()=>{await w()});const w=async()=>{try{const U=await oe.get("/api/devices/discover");s.value=U.data.untracked_devices||[]}catch(U){console.error("Error loading untracked devices:",U),s.value=[]}},t=U=>{u.value=!1,b("adopt",U)},A=U=>{_.value=U,f.value=!0},q=async()=>{if(_.value){$.value=!0;try{const U=await oe.delete(`/api/devices/untracked/${encodeURIComponent(_.value.device_name)}`);if(U.data.success)s.value=s.value.filter(M=>M.device_name!==_.value.device_name),f.value=!1,_.value=null,console.log("Device deleted successfully");else throw new Error(U.data.error||"Failed to delete device")}catch(U){console.error("Error deleting device:",U),k.error(`Failed to delete device: ${U.message}`)}finally{$.value=!1}}};return c({refresh:w}),(U,M)=>{var a,h,v;return R.value?(l(),n("div",On,[e("div",Vn,[M[9]||(M[9]=e("div",{class:"banner-icon"},[e("i",{class:"mdi mdi-radar"})],-1)),e("div",Pn,[M[7]||(M[7]=e("h3",null,"Untracked Devices Found",-1)),e("p",null,m(s.value.length)+" device"+m(s.value.length>1?"s":"")+" with learned commands found in Broadlink storage",1)]),e("button",{onClick:M[0]||(M[0]=I=>u.value=!0),class:"btn btn-primary"},[...M[8]||(M[8]=[e("i",{class:"mdi mdi-eye"},null,-1),S(" View Devices ",-1)])])]),u.value?(l(),n("div",{key:0,class:"modal-overlay",onClick:M[3]||(M[3]=ye(I=>u.value=!1,["self"]))},[e("div",Un,[e("div",jn,[M[11]||(M[11]=e("h2",null,"Discovered Devices",-1)),e("button",{onClick:M[1]||(M[1]=I=>u.value=!1),class:"close-btn"},[...M[10]||(M[10]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Fn,[M[16]||(M[16]=e("p",{class:"info-text"}," These devices have learned commands in Broadlink storage but are not being tracked. Adopt them to manage their commands and generate Home Assistant entities. ",-1)),e("div",Nn,[(l(!0),n(ve,null,ke(s.value,I=>(l(),n("div",{key:I.device_name,class:"discovered-device"},[e("div",Bn,[M[13]||(M[13]=e("div",{class:"device-icon"},[e("i",{class:"mdi mdi-devices"})],-1)),e("div",qn,[e("h4",null,m(I.device_name),1),e("span",Hn,[M[12]||(M[12]=e("i",{class:"mdi mdi-remote"},null,-1)),S(" "+m(I.command_count)+" command"+m(I.command_count>1?"s":""),1)])])]),e("div",zn,[e("button",{onClick:X=>t(I),class:"btn btn-primary"},[...M[14]||(M[14]=[e("i",{class:"mdi mdi-plus"},null,-1),S(" Adopt ",-1)])],8,Jn),e("button",{onClick:X=>A(I),class:"btn btn-danger",title:"Delete all commands"},[...M[15]||(M[15]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,Wn)])]))),128))])]),e("div",Gn,[e("button",{onClick:M[2]||(M[2]=I=>u.value=!1),class:"btn btn-secondary"}," Close ")])])])):L("",!0),f.value?(l(),n("div",{key:1,class:"modal-overlay",onClick:M[6]||(M[6]=ye(I=>f.value=!1,["self"]))},[e("div",Kn,[e("div",Xn,[M[18]||(M[18]=e("h2",null,"Delete Untracked Device",-1)),e("button",{onClick:M[4]||(M[4]=I=>f.value=!1),class:"close-btn"},[...M[17]||(M[17]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Yn,[e("div",Zn,[M[20]||(M[20]=e("i",{class:"mdi mdi-alert"},null,-1)),e("div",null,[e("p",null,[e("strong",null,'Are you sure you want to delete "'+m((a=_.value)==null?void 0:a.device_name)+'"?',1)]),e("p",null,"This will permanently delete all "+m((h=_.value)==null?void 0:h.command_count)+" command"+m(((v=_.value)==null?void 0:v.command_count)>1?"s":"")+" from Broadlink storage.",1),M[19]||(M[19]=e("p",{class:"warning-text"},"This action cannot be undone.",-1))])])]),e("div",Qn,[e("button",{onClick:M[5]||(M[5]=I=>f.value=!1),class:"btn btn-secondary",disabled:$.value}," Cancel ",8,es),e("button",{onClick:q,class:"btn btn-danger",disabled:$.value},[e("i",{class:Z(["mdi",$.value?"mdi-loading mdi-spin":"mdi-delete"])},null,2),S(" "+m($.value?"Deleting...":"Delete"),1)],8,ts)])])])):L("",!0)])):L("",!0)}}},ls=$e(os,[["__scopeId","data-v-24463050"]]),ns={class:"device-list-card"},ss={class:"card-header"},as={class:"header-badges"},is={class:"header-info"},rs={class:"header-right"},ds=["disabled"],us=["disabled"],cs={class:"card-body"},ms={key:0,class:"filter-bar"},vs={class:"filter-row filter-row-search"},ps={class:"filter-group filter-search"},fs={class:"filter-row filter-row-dropdowns"},gs={class:"filter-group"},ys=["value"],bs={class:"filter-group"},hs=["value"],ks={class:"filter-group"},ws={key:0,class:"filter-group filter-toggle"},$s={class:"toggle-label"},Cs={key:2,class:"view-toggle-group"},_s={class:"filter-results"},Ss={key:1,class:"loading-state"},Is={key:2,class:"error-state"},Ds={key:3,class:"empty-state"},xs={key:4,class:"device-grid"},Ts={key:6,class:"no-results"},Ms={__name:"DeviceList",setup(o){const c=dt(),r=Pe(),{isMobile:k}=ze(),b=y(!1),s=y(!1),u=y(null),f=y(!1),_=y(null),$=y(null),R=y(!0),w=y(!1),t=y(!1),q=y(window.innerWidth<=767?"grid":localStorage.getItem("device_view_mode")||"grid");ue(k,D=>{D&&q.value==="list"&&(q.value="grid")}),ue(q,D=>{localStorage.setItem("device_view_mode",D)});const U=()=>{R.value=!R.value},M=y(!1),a=y({title:"Error",message:"",suggestion:"",details:"",error:null,context:{}}),h=y(!1),v=y({success:!1,title:"",message:""}),I=y({search:"",broadlinkDevice:"",area:"",entityType:"",showSmartIROnly:!1}),X=y([]),Q=Se("smartirStatus"),te=Se("smartirEnabled"),de=J(()=>{var T;return localStorage.getItem("smartir_simulate_not_installed")==="true"?!1:((T=Q==null?void 0:Q.value)==null?void 0:T.installed)||!1}),O=J(()=>{const D=new Map;return c.devices.forEach(T=>{if(T.broadlink_entity){const P=X.value.find(H=>H.entity_id===T.broadlink_entity),B=P&&P.name||T.broadlink_entity;D.set(T.broadlink_entity,{entity_id:T.broadlink_entity,friendly_name:B})}}),Array.from(D.values()).sort((T,P)=>T.friendly_name.localeCompare(P.friendly_name))}),F=J(()=>{const D=new Set;return c.devices.forEach(T=>{T.area&&D.add(T.area)}),Array.from(D).sort()}),ee=J(()=>{let D=c.devices;if(I.value.search){const P=I.value.search.toLowerCase();D=D.filter(B=>{var re,se,he,Re,Oe;if((re=B.name)!=null&&re.toLowerCase().includes(P)||(se=B.entity_type)!=null&&se.toLowerCase().includes(P)||(he=B.area)!=null&&he.toLowerCase().includes(P)||(Re=B.id)!=null&&Re.toLowerCase().includes(P)||Object.keys(B.commands||{}).some(Be=>Be.toLowerCase().includes(P)))return!0;const ne=X.value.find(Be=>Be.entity_id===B.broadlink_entity);return!!((Oe=ne==null?void 0:ne.name)!=null&&Oe.toLowerCase().includes(P))})}I.value.broadlinkDevice&&(D=D.filter(P=>P.broadlink_entity===I.value.broadlinkDevice||P.controller_device===I.value.broadlinkDevice)),I.value.area&&(D=D.filter(P=>P.area===I.value.area)),I.value.entityType&&(D=D.filter(P=>P.entity_type===I.value.entityType)),I.value.showSmartIROnly&&(D=D.filter(P=>P.device_type==="smartir"));const T=localStorage.getItem("smartir_simulate_not_installed")==="true";return(!(te!=null&&te.value)||T)&&(D=D.filter(P=>P.device_type!=="smartir")),D}),me=J(()=>I.value.search||I.value.broadlinkDevice||I.value.area||I.value.entityType||I.value.showSmartIROnly),pe=()=>{I.value.search="",I.value.broadlinkDevice="",I.value.area="",I.value.entityType="",I.value.showSmartIROnly=!1},De=async()=>{try{const D=await oe.get("/api/remote/devices");X.value=D.data.devices||[]}catch(D){console.error("Error loading remote devices:",D)}};ue(q,D=>{localStorage.setItem("device_view_mode",D)}),Te(async()=>{await Promise.all([c.loadDevices(),De()])});const xe=D=>{u.value=D,b.value=!0},Me=J(()=>{if(!_.value)return"";const D=Object.keys(_.value.commands||{}).length;return D===0?"This device has no commands. The device will be removed from tracking.":`This device has ${D} learned command${D>1?"s":""}. What would you like to do?`}),x=J(()=>{if(!_.value)return"";const D=Object.keys(_.value.commands||{}).length;return D===0?"":`Also delete all ${D} command${D>1?"s":""} from Broadlink storage`}),d=D=>{_.value=D,f.value=!0},V=()=>{f.value=!1,_.value=null},fe=async D=>{var P,B;const T=_.value;f.value=!1;try{await c.deleteDevice(T.id,D),$.value&&await $.value.refresh()}catch(H){const ne=((B=(P=H.response)==null?void 0:P.data)==null?void 0:B.error)||H.message||"Unknown error";le("Failed to Delete Device",ne)}finally{_.value=null}},K=async D=>{var T,P,B,H,ne;try{console.log("💾 Saving device data:",D),console.log("💾 Device commands:",D.commands),console.log("💾 Selected device:",u.value),(T=u.value)!=null&&T.id&&u.value.id!==null?await c.updateDevice(u.value.id,D):await c.createDevice(D),g(),$.value&&await $.value.refresh()}catch(re){let se="Failed to save device",he="",Re="";(B=(P=re.response)==null?void 0:P.data)!=null&&B.error?(se=re.response.data.error,he=re.response.data.suggestion||""):re.message&&(se=re.message),re.response&&(Re=`Status: ${re.response.status}
URL: ${((H=re.config)==null?void 0:H.url)||"N/A"}`),le("Failed to Save Device",se,he,Re,re,{action:"save_device",deviceData:D,isEdit:!!((ne=u.value)!=null&&ne.id)})}},g=()=>{b.value=!1,u.value=null},p=D=>{u.value=D,s.value=!0},W=()=>{s.value=!1,u.value=null},le=(D,T,P="",B="",H=null,ne={})=>{a.value={title:D,message:T,suggestion:P,details:B,error:H,context:ne},M.value=!0},z=()=>{M.value=!1},C=()=>{h.value=!1},ie=async D=>{if(D&&D.commands&&u.value){const T=c.devices.findIndex(P=>P.id===u.value.id);T!==-1&&(c.devices[T].commands=D.commands,console.log(`Optimistically updated device ${u.value.id} with new command: ${D.commandName}`))}c.loadDevices(),$.value&&$.value.refresh()},Y=D=>{const T=D.split("_"),P=[];for(let B=0;B<T.length;B++){const H=T[B],ne=T[B+1];H&&ne==="s"&&T[B+2]?(P.push(H.charAt(0).toUpperCase()+H.slice(1)+"'s"),B++):H!=="s"&&P.push(H.charAt(0).toUpperCase()+H.slice(1))}return P.join(" ")},ce=(D,T)=>{const P=D.toLowerCase(),B=T.map(se=>se.toLowerCase());return P.includes("lamp")||P.includes("light")?"light":P.includes("fan")?"fan":P.includes("tv")||P.includes("stereo")||P.includes("speaker")||P.includes("receiver")?"media_player":P.includes("blind")||P.includes("curtain")||P.includes("shade")||P.includes("garage")?"cover":B.some(se=>se.includes("volume")||se.includes("channel")||se.includes("play")||se.includes("pause")||se.includes("mute"))?"media_player":B.some(se=>se.includes("fan_speed")||se.includes("fan_low")||se.includes("fan_high"))?"fan":B.some(se=>se.includes("open")||se.includes("close")||se.includes("stop"))?"cover":"switch"},E=(D,T)=>{const P=D.toLowerCase();return P.includes("tv")?"mdi:television":P.includes("stereo")||P.includes("receiver")||P.includes("speaker")?"mdi:speaker":P.includes("lamp")?"mdi:lamp":P.includes("light")?"mdi:lightbulb":P.includes("fan")?"mdi:fan":P.includes("blind")?"mdi:blinds":P.includes("curtain")?"mdi:curtains":P.includes("garage")?"mdi:garage":{light:"mdi:lightbulb",fan:"mdi:fan",switch:"mdi:light-switch",media_player:"mdi:speaker",cover:"mdi:window-shutter"}[T]||"mdi:devices"},i=D=>{const T=D.toLowerCase().split("_");for(let H=0;H<T.length-2;H++)if(T[H+1]==="s"){const ne=T.slice(H,H+3),re=Y(ne.join("_"));return console.log("Detected possessive area:",re,"from",D),re}const P=[["living","room"],["dining","room"],["master","bedroom"],["guest","bedroom"],["family","room"],["laundry","room"],["home","office"]];for(let H=0;H<T.length-1;H++){const ne=[T[H],T[H+1]],re=P.find(se=>se[0]===ne[0]&&se[1]===ne[1]);if(re)return Y(re.join("_"))}const B=["kitchen","bedroom","bathroom","garage","office","basement","attic","hallway","entryway","patio","deck","yard","garden"];for(const H of T)if(B.includes(H))return H.charAt(0).toUpperCase()+H.slice(1);return""},N=async D=>{const T=Y(D.device_name),P=i(D.device_name),B=ce(D.device_name,D.commands),H=E(D.device_name,B);let ne="";try{console.log("Finding Broadlink owner for:",D.device_name);const se=await oe.post("/api/devices/find-broadlink-owner",{device_name:D.device_name});console.log("Broadlink owner response:",se.data),ne=se.data.broadlink_entity||"",console.log("Detected Broadlink entity:",ne)}catch(se){console.error("Error finding Broadlink owner:",se)}u.value={id:null,device:D.device_name,name:T,entity_type:B,commands:{},area:P,icon:H,broadlink_entity:ne,enabled:!0};const re={};D.commands.forEach(se=>{re[se]=se}),u.value.commands=re,b.value=!0},j=async()=>{t.value=!0;try{await c.syncAllAreas(),r.success("Areas synced from Home Assistant")}catch(D){console.error("Error syncing areas:",D),r.error("Failed to sync areas")}finally{t.value=!1}},ae=async()=>{var D,T;w.value=!0;try{const P=await oe.post("/api/entities/generate",{});if(P.data.success){const B=P.data.broadlink_count||0,H=P.data.smartir_count||0,ne=P.data.total_count||0,re=P.data.errors||[];let se="✅ Entity Generation Successful",he=[];const Re=[];B>0&&Re.push(`${B} Broadlink native`),H>0&&Re.push(`${H} SmartIR`),Re.length>0&&he.push(`Generated ${Re.join(" and ")} entity configuration${ne!==1?"s":""}.`),B>0&&(he.push(`
📁 Broadlink entities created in:`),he.push("  • broadlink_manager/entities.yaml"),he.push("  • broadlink_manager/helpers.yaml")),H>0&&(he.push(`
📁 SmartIR entities created in:`),he.push("  • smartir/climate.yaml"),he.push("  • smartir/media_player.yaml"),he.push("  • smartir/fan.yaml")),he.push(`
📝 Next steps:`),he.push("1. Check your configuration.yaml includes the generated files"),he.push("2. Restart Home Assistant to load the new entities"),re.length>0&&(se="⚠️ Entity Generation Completed with Errors",he.push(`
⚠️ ${re.length} error${re.length!==1?"s":""} occurred:`),re.forEach(Oe=>{he.push(`  • ${Oe}`)})),v.value={success:!0,title:se,message:he.join(`
`)},h.value=!0}else v.value={success:!1,title:"❌ Entity Generation Failed",message:P.data.message||`Failed to generate entities.

Please check that you have at least one device configured.`},h.value=!0}catch(P){console.error("Error generating entities:",P);const B=((T=(D=P.response)==null?void 0:D.data)==null?void 0:T.error)||P.message||"Unknown error occurred";v.value={success:!1,title:"❌ Entity Generation Error",message:`Failed to generate entities:

${B}

Please check the logs for more details.`},h.value=!0}finally{w.value=!1}},we=async({device:D,command:T})=>{var P,B;try{const H={device_id:D.id,command:T,entity_id:D.broadlink_entity,device:D.device};await oe.post("/api/commands/test",H),r.success(`Sent ${T} to ${D.name}`)}catch(H){console.error("Error sending command:",H);const ne=((B=(P=H.response)==null?void 0:P.data)==null?void 0:B.error)||H.message||"Unknown error";r.error(`Failed to send ${T}: ${ne}`)}};return(D,T)=>{var P;return l(),n("div",ns,[e("div",ss,[e("button",{class:"icon-button chevron-button",onClick:U},[e("i",{class:Z(["mdi",R.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2)]),e("div",{class:"header-left",onClick:U},[T[10]||(T[10]=e("div",{class:"header-icon"},[e("i",{class:"mdi mdi-devices"})],-1)),T[11]||(T[11]=e("h3",null,"Managed Devices",-1)),e("div",as,[e("span",is,m(_e(c).deviceCount)+" devices",1)])]),e("div",rs,[R.value?(l(),n("button",{key:0,onClick:ye(j,["stop"]),class:"btn btn-secondary",disabled:t.value,title:"Sync all areas from Home Assistant"},[e("i",{class:Z(["mdi",t.value?"mdi-loading mdi-spin":"mdi-refresh"])},null,2),S(" "+m(t.value?"Syncing...":"Sync Areas"),1)],8,ds)):L("",!0),R.value?(l(),n("button",{key:1,onClick:ye(ae,["stop"]),class:"btn btn-secondary",disabled:w.value,title:"Generate entities for all devices"},[e("i",{class:Z(["mdi",w.value?"mdi-loading mdi-spin":"mdi-file-code"])},null,2),S(" "+m(w.value?"Generating...":"Generate Entities"),1)],8,us)):L("",!0),R.value?(l(),n("button",{key:2,onClick:T[0]||(T[0]=ye(B=>b.value=!0,["stop"])),class:"btn btn-primary"},[...T[12]||(T[12]=[e("i",{class:"mdi mdi-plus"},null,-1),S(" Add Device ",-1)])])):L("",!0)])]),G(e("div",cs,[be(ls,{ref_key:"discoveryRef",ref:$,onAdopt:N},null,512),_e(c).hasDevices?(l(),n("div",ms,[e("div",vs,[e("div",ps,[e("label",null,[T[13]||(T[13]=e("i",{class:"mdi mdi-magnify"},null,-1)),G(e("input",{"onUpdate:modelValue":T[1]||(T[1]=B=>I.value.search=B),type:"text",placeholder:"Search devices, commands...",class:"search-input"},null,512),[[Ie,I.value.search]])])])]),e("div",fs,[e("div",gs,[e("label",null,[T[15]||(T[15]=e("i",{class:"mdi mdi-access-point"},null,-1)),G(e("select",{"onUpdate:modelValue":T[2]||(T[2]=B=>I.value.broadlinkDevice=B)},[T[14]||(T[14]=e("option",{value:""},"All Controller Devices",-1)),(l(!0),n(ve,null,ke(O.value,B=>(l(),n("option",{key:B.entity_id,value:B.entity_id},m(B.friendly_name),9,ys))),128))],512),[[Ce,I.value.broadlinkDevice]])])]),e("div",bs,[e("label",null,[T[17]||(T[17]=e("i",{class:"mdi mdi-home-map-marker"},null,-1)),G(e("select",{"onUpdate:modelValue":T[3]||(T[3]=B=>I.value.area=B)},[T[16]||(T[16]=e("option",{value:""},"All Areas",-1)),(l(!0),n(ve,null,ke(F.value,B=>(l(),n("option",{key:B,value:B},m(B),9,hs))),128))],512),[[Ce,I.value.area]])])]),e("div",ks,[e("label",null,[T[19]||(T[19]=e("i",{class:"mdi mdi-shape"},null,-1)),G(e("select",{"onUpdate:modelValue":T[4]||(T[4]=B=>I.value.entityType=B)},[...T[18]||(T[18]=[Ee('<option value="" data-v-01a568ac>All Types</option><option value="light" data-v-01a568ac>Light</option><option value="fan" data-v-01a568ac>Fan</option><option value="switch" data-v-01a568ac>Switch</option><option value="media_player" data-v-01a568ac>Media Player</option><option value="cover" data-v-01a568ac>Cover</option><option value="climate" data-v-01a568ac>Climate</option>',7)])],512),[[Ce,I.value.entityType]])])]),de.value?(l(),n("div",ws,[e("label",$s,[T[20]||(T[20]=e("span",{class:"toggle-text"},[e("img",{src:Je,alt:"SmartIR",class:"smartir-icon"}),S(" SmartIR Only ")],-1)),G(e("input",{type:"checkbox","onUpdate:modelValue":T[5]||(T[5]=B=>I.value.showSmartIROnly=B),class:"toggle-checkbox"},null,512),[[ge,I.value.showSmartIROnly]]),T[21]||(T[21]=e("span",{class:"toggle-slider"},null,-1))])])):L("",!0),me.value?(l(),n("button",{key:1,onClick:pe,class:"btn-clear-filters"},[...T[22]||(T[22]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),S(" Clear ",-1)])])):L("",!0),_e(k)?L("",!0):(l(),n("div",Cs,[e("button",{onClick:T[6]||(T[6]=B=>q.value="grid"),class:Z(["view-toggle-btn",{active:q.value==="grid"}]),title:"Grid View"},[...T[23]||(T[23]=[e("i",{class:"mdi mdi-view-grid"},null,-1),S(" Grid ",-1)])],2),e("button",{onClick:T[7]||(T[7]=B=>q.value="list"),class:Z(["view-toggle-btn",{active:q.value==="list"}]),title:"List View"},[...T[24]||(T[24]=[e("i",{class:"mdi mdi-view-list"},null,-1),S(" List ",-1)])],2)])),e("div",_s,m(ee.value.length)+" of "+m(_e(c).deviceCount),1)])])):L("",!0),_e(c).loading?(l(),n("div",Ss,[...T[25]||(T[25]=[e("i",{class:"mdi mdi-loading mdi-spin"},null,-1),e("p",null,"Loading devices...",-1)])])):_e(c).error?(l(),n("div",Is,[T[26]||(T[26]=e("i",{class:"mdi mdi-alert-circle"},null,-1)),e("p",null,m(_e(c).error),1),e("button",{onClick:T[8]||(T[8]=B=>_e(c).loadDevices()),class:"btn btn-secondary"}," Retry ")])):_e(c).hasDevices?L("",!0):(l(),n("div",Ds,[T[28]||(T[28]=e("i",{class:"mdi mdi-devices"},null,-1)),T[29]||(T[29]=e("h3",null,"No Devices Yet",-1)),T[30]||(T[30]=e("p",null,"Get started by adding your first managed device",-1)),e("button",{onClick:T[9]||(T[9]=B=>b.value=!0),class:"btn btn-primary"},[...T[27]||(T[27]=[e("i",{class:"mdi mdi-plus"},null,-1),S(" Add Your First Device ",-1)])])])),q.value==="grid"?(l(),n("div",xs,[(l(!0),n(ve,null,ke(ee.value,B=>(l(),Le(Lt,{key:B.id,device:B,"broadlink-devices":X.value,onEdit:xe,onDelete:d,onLearn:p},null,8,["device","broadlink-devices"]))),128))])):q.value==="list"&&ee.value.length>0?(l(),Le(Yt,{key:5,devices:ee.value,onSendCommand:we,onEditDevice:xe,onDeleteDevice:d},null,8,["devices"])):L("",!0),_e(c).hasDevices&&ee.value.length===0?(l(),n("div",Ts,[...T[31]||(T[31]=[e("i",{class:"mdi mdi-filter-off"},null,-1),e("h3",null,"No devices match your filters",-1),e("p",null,"Try adjusting your search or filter criteria",-1)])])):L("",!0)],512),[[Ze,R.value]]),b.value?(l(),Le(Il,{key:0,device:u.value,onSave:K,onCancel:g},null,8,["device"])):L("",!0),s.value?(l(),Le($n,{key:1,device:u.value,onLearned:ie,onCancel:W},null,8,["device"])):L("",!0),be(Ae,{isOpen:f.value,title:`Delete ${(P=_.value)==null?void 0:P.name}?`,message:Me.value,confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,checkboxLabel:x.value,onConfirm:fe,onCancel:V},null,8,["isOpen","title","message","checkboxLabel"]),be(En,{isOpen:M.value,title:a.value.title,message:a.value.message,suggestion:a.value.suggestion,details:a.value.details,error:a.value.error,context:a.value.context,onClose:z},null,8,["isOpen","title","message","suggestion","details","error","context"]),be(Ae,{isOpen:h.value,title:v.value.title,message:v.value.message,confirmText:"OK",showCancel:!1,dangerMode:!v.value.success,onConfirm:C,onCancel:C},null,8,["isOpen","title","message","dangerMode"])])}}},Rs=$e(Ms,[["__scopeId","data-v-01a568ac"]]),Ls={class:"banner-content"},As={class:"banner-icon"},Es={class:"banner-message"},Os={class:"banner-actions"},Vs={__name:"SmartIRBanner",setup(o){const c=Se("smartirStatus"),r=y(!1),k=J(()=>!(!c.value||r.value||localStorage.getItem("smartir_banner_dismissed")==="true")),b=J(()=>{var R;return(R=c.value)!=null&&R.installed?"banner-success":"banner-info"}),s=J(()=>{var R;return(R=c.value)!=null&&R.installed?"mdi mdi-check-circle":"mdi mdi-information"}),u=J(()=>{var R;return(R=c.value)!=null&&R.installed?`SmartIR Detected (v${c.value.version})`:"Want Climate Device Support?"}),f=J(()=>{var R;return(R=c.value)!=null&&R.installed?"You can now create climate device profiles with full temperature and HVAC mode control.":"Install SmartIR to unlock AC/heater control with temperature settings, HVAC modes, and 120+ pre-configured device profiles."});function _(){window.open("https://github.com/smartHomeHub/SmartIR","_blank")}function $(){var R;if(r.value=!0,(R=c.value)!=null&&R.installed)localStorage.setItem("smartir_banner_dismissed","true");else{const w=parseInt(localStorage.getItem("smartir_banner_dismiss_count")||"0");w>=2?localStorage.setItem("smartir_banner_dismissed","true"):localStorage.setItem("smartir_banner_dismiss_count",String(w+1))}}return Te(()=>{var t;const R=localStorage.getItem("smartir_last_status"),w=(t=c.value)!=null&&t.installed?"installed":"not_installed";R!==w&&(localStorage.removeItem("smartir_banner_dismissed"),localStorage.removeItem("smartir_banner_dismiss_count"),localStorage.setItem("smartir_last_status",w))}),(R,w)=>{var t,A;return k.value?(l(),n("div",{key:0,class:Z(["smartir-banner",b.value])},[e("div",Ls,[e("div",As,[e("i",{class:Z(s.value)},null,2)]),e("div",Es,[e("strong",null,m(u.value),1),e("p",null,m(f.value),1)]),e("div",Os,[(t=R.status)!=null&&t.installed?L("",!0):(l(),n("button",{key:0,onClick:_,class:"btn-primary"}," Learn More ")),e("button",{onClick:$,class:"btn-text"},m((A=R.status)!=null&&A.installed?"Got it":"Dismiss"),1)])])],2)):L("",!0)}}},Ps=$e(Vs,[["__scopeId","data-v-7bbcbcd7"]]),Ve="api/smartir",et={async getStatus(){try{const o=await fetch(`${Ve}/status`);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return await o.json()}catch(o){return console.error("Error fetching SmartIR status:",o),{installed:!1,version:null,error:o.message}}},async getInstallInstructions(){try{const o=await fetch(`${Ve}/install-instructions`);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return await o.json()}catch(o){throw console.error("Error fetching install instructions:",o),o}},async getPlatforms(){try{const o=await fetch(`${Ve}/platforms`);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return await o.json()}catch(o){throw console.error("Error fetching platforms:",o),o}},async getPlatformCodes(o){try{const c=await fetch(`${Ve}/platforms/${o}/codes`);if(!c.ok)throw new Error(`HTTP error! status: ${c.status}`);return await c.json()}catch(c){throw console.error(`Error fetching codes for ${o}:`,c),c}},async getNextCode(o){try{const c=await fetch(`${Ve}/platforms/${o}/next-code`);if(!c.ok)throw new Error(`HTTP error! status: ${c.status}`);return await c.json()}catch(c){throw console.error(`Error fetching next code for ${o}:`,c),c}},async validateCode(o,c){try{const r=await fetch(`${Ve}/validate-code`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({platform:o,code:c})});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);return await r.json()}catch(r){throw console.error("Error validating code:",r),r}}},Us={class:"profile-card"},js={class:"profile-card-header"},Fs=["title"],Ns={class:"profile-details"},Bs=["title"],qs={class:"profile-meta"},Hs=["title"],zs=["title"],Js=["title"],Ws={class:"profile-card-footer"},Gs=["title"],Ks={key:0,class:"learned-indicator"},Xs={class:"profile-actions"},Ys={__name:"SmartIRProfileCard",props:{profile:{type:Object,required:!0}},emits:["edit","download","delete","commands"],setup(o){const c=o,r=Qe(J(()=>c.profile.platform)),k=u=>u.replace(/_/g," ").replace(/\b\w/g,f=>f.toUpperCase()),b=u=>u&&u.startsWith("mdi:")?`mdi ${u.replace(":"," mdi-")}`:`mdi mdi-${u}`,s=u=>{if(!u)return"";const f=u.toLowerCase();return f.includes("broadlink")?"broadlink-tag":f.includes("not set")?"not-set-tag":"default-controller-tag"};return(u,f)=>(l(),n("div",Us,[e("div",js,[e("div",{class:Z(["profile-icon",_e(r).colorClass.value]),title:k(o.profile.platform)},[e("i",{class:Z(b(_e(r).icon.value))},null,2)],10,Fs),e("div",Ns,[e("h4",{title:`${o.profile.manufacturer} ${o.profile.model}`},m(o.profile.manufacturer)+" "+m(o.profile.model),9,Bs),e("div",qs,[e("span",{class:"tag platform-tag",title:k(o.profile.platform)},m(k(o.profile.platform)),9,Hs),o.profile.controllerBrand?(l(),n("span",{key:0,class:Z(["tag controller-tag",s(o.profile.controllerBrand)]),title:"Controller: "+o.profile.controllerBrand},[f[4]||(f[4]=e("i",{class:"mdi mdi-remote-tv"},null,-1)),S(" "+m(o.profile.controllerBrand),1)],10,zs)):L("",!0)])]),e("div",{class:"code-badge",title:"Device Code: "+o.profile.code},m(o.profile.code),9,Js)]),e("div",Ws,[e("div",{class:"profile-stats",title:o.profile.commandCount+" total commands"+(o.profile.learnedCount>0?", "+o.profile.learnedCount+" learned":"")},[f[5]||(f[5]=e("i",{class:"mdi mdi-remote"},null,-1)),e("span",null,m(o.profile.commandCount)+" command"+m(o.profile.commandCount!==1?"s":""),1),o.profile.learnedCount>0?(l(),n("span",Ks,"( "+m(o.profile.learnedCount)+" learned )",1)):L("",!0)],8,Gs),e("div",Xs,[e("button",{onClick:f[0]||(f[0]=_=>u.$emit("commands")),class:"action-btn",title:"Commands"},[...f[6]||(f[6]=[e("i",{class:"mdi mdi-remote"},null,-1)])]),e("button",{onClick:f[1]||(f[1]=_=>u.$emit("edit")),class:"action-btn",title:"Edit Profile"},[...f[7]||(f[7]=[e("i",{class:"mdi mdi-pencil"},null,-1)])]),e("button",{onClick:f[2]||(f[2]=_=>u.$emit("download")),class:"action-btn",title:"Download JSON"},[...f[8]||(f[8]=[e("i",{class:"mdi mdi-download"},null,-1)])]),e("button",{onClick:f[3]||(f[3]=_=>u.$emit("delete")),class:"action-btn delete",title:"Delete Profile"},[...f[9]||(f[9]=[e("i",{class:"mdi mdi-delete"},null,-1)])])])])]))}},Zs=$e(Ys,[["__scopeId","data-v-b72a1955"]]),Qs={name:"SmartIRProfileListView",props:{profiles:{type:Array,required:!0}},methods:{getPlatformIcon(o){return{climate:"mdi-thermostat",media_player:"mdi-television",fan:"mdi-fan",light:"mdi-lightbulb"}[o]||"mdi-devices"},formatPlatform(o){return{climate:"Climate",media_player:"Media Player",fan:"Fan",light:"Light"}[o]||o},editProfile(o){this.$emit("edit",o)},viewCommands(o){this.$emit("commands",o)},downloadProfile(o){this.$emit("download",o)},deleteProfile(o){this.$emit("delete",o)}}},ea={class:"profile-list-view"},ta={class:"profile-table"},oa={class:"profile-code"},la={class:"code-badge"},na={class:"profile-manufacturer"},sa={class:"profile-model"},aa={class:"model-info"},ia={class:"model-name"},ra={key:0,class:"model-count"},da={class:"profile-platform"},ua={class:"profile-controller"},ca={class:"profile-commands"},ma={class:"command-stats"},va={class:"stat-item"},pa={key:0,class:"stat-item learned"},fa={class:"profile-actions"},ga=["onClick"],ya=["onClick"],ba=["onClick"],ha=["onClick"];function ka(o,c,r,k,b,s){return l(),n("div",ea,[e("table",ta,[c[6]||(c[6]=e("thead",null,[e("tr",null,[e("th",null,"Code"),e("th",null,"Manufacturer"),e("th",null,"Model"),e("th",null,"Platform"),e("th",null,"Controller"),e("th",null,"Commands"),e("th",null,"Actions")])],-1)),e("tbody",null,[(l(!0),n(ve,null,ke(r.profiles,u=>(l(),n("tr",{key:`${u.platform}-${u.code}`,class:"profile-row"},[e("td",oa,[e("span",la,m(u.code),1)]),e("td",na,m(u.manufacturer||"Unknown"),1),e("td",sa,[e("div",aa,[e("div",ia,m(u.model||"Unknown"),1),u.models&&u.models.length>1?(l(),n("div",ra," +"+m(u.models.length-1)+" more ",1)):L("",!0)])]),e("td",da,[e("span",{class:Z(["platform-badge",u.platform])},[e("i",{class:Z(["mdi",s.getPlatformIcon(u.platform)])},null,2),S(" "+m(s.formatPlatform(u.platform)),1)],2)]),e("td",ua,m(u.controller_brand||"N/A"),1),e("td",ca,[e("div",ma,[e("span",va,[c[0]||(c[0]=e("i",{class:"mdi mdi-remote"},null,-1)),S(" "+m(u.command_count||0),1)]),u.learned_count>0?(l(),n("span",pa,[c[1]||(c[1]=e("i",{class:"mdi mdi-school"},null,-1)),S(" "+m(u.learned_count),1)])):L("",!0)])]),e("td",fa,[e("button",{class:"action-btn edit",onClick:f=>s.editProfile(u),title:"Edit Profile"},[...c[2]||(c[2]=[e("i",{class:"mdi mdi-pencil"},null,-1)])],8,ga),e("button",{class:"action-btn commands",onClick:f=>s.viewCommands(u),title:"View Commands"},[...c[3]||(c[3]=[e("i",{class:"mdi mdi-remote"},null,-1)])],8,ya),e("button",{class:"action-btn download",onClick:f=>s.downloadProfile(u),title:"Download"},[...c[4]||(c[4]=[e("i",{class:"mdi mdi-download"},null,-1)])],8,ba),e("button",{class:"action-btn delete",onClick:f=>s.deleteProfile(u),title:"Delete"},[...c[5]||(c[5]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,ha)])]))),128))])])])}const wa=$e(Qs,[["render",ka],["__scopeId","data-v-d3773038"]]),$a={class:"modal-container"},Ca={class:"modal-body"},_a={key:0,class:"selection-section"},Sa={class:"form-group"},Ia={class:"form-group"},Da={class:"form-group"},xa={key:0,class:"code-info"},Ta={class:"form-actions"},Ma=["disabled"],Ra={key:1,class:"testing-section"},La={class:"code-header"},Aa={class:"code-details"},Ea={class:"code-badge"},Oa={class:"device-selector"},Va=["value"],Pa={class:"commands-section"},Ua={class:"commands-header"},ja={key:0,class:"tested-count"},Fa={key:0,class:"filters-section"},Na={class:"filter-row"},Ba={class:"filter-row"},qa={key:1,class:"empty-state"},Ha={key:2,class:"empty-state"},za={key:3,class:"commands-list"},Ja={class:"command-name"},Wa={class:"command-actions"},Ga={key:0,class:"status-badge success"},Ka=["onClick","disabled"],Xa={__name:"SmartIRCodeTester",props:{isOpen:{type:Boolean,default:!1}},emits:["close","clone"],setup(o,{emit:c}){const r=o,k=c,b=Se("toast"),s=y("climate"),u=y(""),f=y([]),_=y(!1),$=y(null),R=y(""),w=y([]),t=y(!1),A=J(()=>w.value.map(z=>({code:z.code,label:`${z.models.join(", ")} (Code: ${z.code})`,value:z.code}))),q=y(null),U=y(null),M=y(!1),a=y([]),h=y(""),v=y([]),I=y(new Set),X=y(null),Q=y(""),te=y(""),de=y(""),O=y(""),F=J(()=>{let z=v.value;if(Q.value){const C=Q.value.toLowerCase();z=z.filter(ie=>(ie.label||ie.name).toLowerCase().includes(C))}return te.value&&(z=z.filter(C=>C.mode===te.value)),de.value&&(z=z.filter(C=>C.fanSpeed===de.value)),O.value&&(z=z.filter(C=>C.swingMode===O.value)),z}),ee=J(()=>Q.value||te.value||de.value||O.value);ue(()=>r.isOpen,z=>{z&&(me(),De())}),ue(s,()=>{r.isOpen&&(u.value="",$.value=null,w.value=[],me())});async function me(){var z;_.value=!0;try{const C=await oe.get("/api/smartir/codes/manufacturers",{params:{entity_type:s.value}});f.value=C.data.manufacturers||[]}catch(C){console.error("Error loading manufacturers:",C),(z=b.value)==null||z.error("Failed to load manufacturers","❌ Error")}finally{_.value=!1}}async function pe(){var z;if(u.value){t.value=!0;try{const C=await oe.get("/api/smartir/codes/models",{params:{entity_type:s.value,manufacturer:u.value}});w.value=C.data.models||[]}catch(C){console.error("Error loading models:",C),(z=b.value)==null||z.error("Failed to load models","❌ Error")}finally{t.value=!1}}}async function De(){try{const z=await oe.get("/api/remote/devices");a.value=z.data.devices||[]}catch(z){console.error("Error loading Broadlink devices:",z)}}async function xe(){var z,C;if($.value){M.value=!0;try{const ie=await oe.get("/api/smartir/codes/code",{params:{entity_type:s.value,code_id:$.value.code}});U.value=ie.data.code,q.value=$.value.code,Me(ie.data.code),(z=b.value)==null||z.success(`Loaded ${v.value.length} commands`,"✅ Code Loaded")}catch(ie){console.error("Error loading code:",ie),(C=b.value)==null||C.error(ie.message||"Failed to load code","❌ Error")}finally{M.value=!1}}}function Me(z){const C=[];if(!z.commands){v.value=C;return}if(s.value==="climate"){const Y=z.commands;for(const[ce,E]of Object.entries(Y)){if(ce==="off"){typeof E=="string"&&C.push({name:"off",label:"OFF",data:E,mode:"off"});continue}if(typeof E=="object"){for(const[i,N]of Object.entries(E))if(typeof N=="object")for(const[j,ae]of Object.entries(N)){if(typeof ae!="object")continue;const we=Object.keys(ae),D=we.includes("24")?"24":we[0];if(D&&typeof ae[D]=="string"){const T=`${ce}_${D}_${i}_${j}`,P=`${ce.toUpperCase()} ${D}°C ${i} ${j}`;C.push({name:T,label:P,data:ae[D],mode:ce,temperature:D,fanSpeed:i,swingMode:j})}}}}}else for(const[Y,ce]of Object.entries(z.commands))typeof ce=="string"&&C.push({name:Y,label:Y.toUpperCase().replace(/_/g," "),data:ce});v.value=C}async function x(z){var C,ie,Y;if(!h.value){(C=b.value)==null||C.warning("Please select a Broadlink device first","⚠️ No Device");return}X.value=z;try{const ce=v.value.find(E=>E.name===z);if(!ce||!ce.data)throw new Error(`Command "${z}" not found`);await oe.post("/api/commands/send-raw",{entity_id:h.value,command:ce.data,command_type:"ir"}),I.value.add(z),(ie=b.value)==null||ie.success(`Command sent: ${ce.label||z}`,"✅ Tested")}catch(ce){console.error("Error testing command:",ce),(Y=b.value)==null||Y.error("Failed to test command","❌ Error")}finally{X.value=null}}function d(){var z,C,ie,Y;if(!U.value){(z=b.value)==null||z.error("No profile data to download","❌ Error");return}try{const ce=U.value.manufacturer||"unknown",E=((C=U.value.supportedModels)==null?void 0:C[0])||q.value,i=`${ce.toLowerCase().replace(/\s+/g,"_")}_${E.toLowerCase().replace(/\s+/g,"_")}.json`,N=JSON.stringify(U.value,null,2),j=new Blob([N],{type:"application/json"}),ae=URL.createObjectURL(j),we=document.createElement("a");we.href=ae,we.download=i,document.body.appendChild(we),we.click(),document.body.removeChild(we),URL.revokeObjectURL(ae),(ie=b.value)==null||ie.success(`Downloaded ${i}`,"✅ Download Complete")}catch(ce){console.error("Error downloading JSON:",ce),(Y=b.value)==null||Y.error(ce.message||"Failed to download JSON","❌ Download Error")}}function V(){u.value="",$.value=null,R.value="",w.value=[]}function fe(){$.value=null,R.value="",pe()}function K(){R.value?$.value=w.value.find(z=>z.code===R.value):$.value=null}function g(){Q.value="",te.value="",de.value="",O.value=""}function p(){q.value=null,U.value=null,v.value=[],I.value.clear(),X.value=null,g()}function W(z){const C=z.toLowerCase();return C.includes("power")||C.includes("off")||C==="off"?"mdi-power":C.includes("cool")?"mdi-snowflake":C.includes("heat")?"mdi-fire":C.includes("fan")?"mdi-fan":C.includes("auto")?"mdi-auto-fix":C.includes("dry")?"mdi-water-percent":C.includes("temp")?"mdi-thermometer":C.includes("swing")?"mdi-swap-vertical":"mdi-remote"}function le(){p(),u.value="",$.value=null,k("close")}return(z,C)=>{var ie;return o.isOpen?(l(),n("div",{key:0,class:"modal-overlay",onClick:ye(le,["self"])},[e("div",$a,[e("div",{class:"modal-header"},[C[9]||(C[9]=e("h3",null,[e("i",{class:"mdi mdi-test-tube"}),S(" Test SmartIR Code ")],-1)),e("button",{onClick:le,class:"close-btn"},[...C[8]||(C[8]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Ca,[q.value?(l(),n("div",Ra,[e("div",La,[e("div",Aa,[e("h4",null,m(U.value.manufacturer)+" - "+m(((ie=U.value.supportedModels)==null?void 0:ie[0])||"Unknown"),1),e("span",Ea,"Code: "+m(q.value),1)]),e("button",{onClick:p,class:"btn-secondary-small"},[...C[14]||(C[14]=[e("i",{class:"mdi mdi-arrow-left"},null,-1),S(" Change Code ",-1)])])]),e("div",Oa,[C[16]||(C[16]=e("label",null,[e("i",{class:"mdi mdi-remote"}),S(" Broadlink Device ")],-1)),G(e("select",{"onUpdate:modelValue":C[3]||(C[3]=Y=>h.value=Y),class:"form-select"},[C[15]||(C[15]=e("option",{value:""},"Select device to test with...",-1)),(l(!0),n(ve,null,ke(a.value,Y=>(l(),n("option",{key:Y.entity_id,value:Y.entity_id},m(Y.friendly_name||Y.entity_id),9,Va))),128))],512),[[Ce,h.value]])]),e("div",Pa,[e("div",Ua,[e("h5",null,"Sample Commands ("+m(F.value.length)+" / "+m(v.value.length)+")",1),I.value.size>0?(l(),n("span",ja,m(I.value.size)+" tested ",1)):L("",!0)]),s.value==="climate"&&v.value.length>0?(l(),n("div",Fa,[e("div",Na,[G(e("input",{"onUpdate:modelValue":C[4]||(C[4]=Y=>Q.value=Y),type:"text",placeholder:"Search commands...",class:"search-input"},null,512),[[Ie,Q.value]])]),e("div",Ba,[G(e("select",{"onUpdate:modelValue":C[5]||(C[5]=Y=>te.value=Y),class:"filter-select"},[...C[17]||(C[17]=[e("option",{value:""},"All Modes",-1),e("option",{value:"cool"},"Cool",-1),e("option",{value:"heat"},"Heat",-1),e("option",{value:"off"},"Off",-1)])],512),[[Ce,te.value]]),G(e("select",{"onUpdate:modelValue":C[6]||(C[6]=Y=>de.value=Y),class:"filter-select"},[...C[18]||(C[18]=[Ee('<option value="" data-v-d1d8935f>All Fan Speeds</option><option value="low" data-v-d1d8935f>Low</option><option value="mid" data-v-d1d8935f>Mid</option><option value="high" data-v-d1d8935f>High</option><option value="auto" data-v-d1d8935f>Auto</option>',5)])],512),[[Ce,de.value]]),G(e("select",{"onUpdate:modelValue":C[7]||(C[7]=Y=>O.value=Y),class:"filter-select"},[...C[19]||(C[19]=[e("option",{value:""},"All Swing",-1),e("option",{value:"stop"},"Stop",-1),e("option",{value:"swing"},"Swing",-1)])],512),[[Ce,O.value]]),ee.value?(l(),n("button",{key:0,onClick:g,class:"btn-clear-filters"},[...C[20]||(C[20]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),S(" Clear ",-1)])])):L("",!0)])])):L("",!0),v.value.length===0?(l(),n("div",qa,[...C[21]||(C[21]=[e("i",{class:"mdi mdi-alert-circle"},null,-1),e("p",null,"No commands found in this code",-1)])])):F.value.length===0?(l(),n("div",Ha,[C[22]||(C[22]=e("i",{class:"mdi mdi-filter-off"},null,-1)),C[23]||(C[23]=e("p",null,"No commands match your filters",-1)),e("button",{onClick:g,class:"btn-secondary-small"}," Clear Filters ")])):(l(),n("div",za,[(l(!0),n(ve,null,ke(F.value,Y=>(l(),n("div",{key:Y.name,class:Z(["command-item",{tested:I.value.has(Y.name),testing:X.value===Y.name}])},[e("div",Ja,[e("i",{class:Z(["mdi",W(Y.mode||Y.name)])},null,2),e("span",null,m(Y.label||Y.name),1)]),e("div",Wa,[I.value.has(Y.name)?(l(),n("span",Ga,[...C[24]||(C[24]=[e("i",{class:"mdi mdi-check"},null,-1),S(" Tested ",-1)])])):L("",!0),e("button",{onClick:ce=>x(Y.name),disabled:!h.value||X.value===Y.name,class:"btn-test"},[e("i",{class:Z(["mdi",X.value===Y.name?"mdi-loading mdi-spin":"mdi-play"])},null,2),C[25]||(C[25]=S(" Test ",-1))],8,Ka)])],2))),128))]))]),e("div",{class:"modal-actions"},[e("button",{onClick:d,class:"btn-primary"},[...C[26]||(C[26]=[e("i",{class:"mdi mdi-download"},null,-1),S(" Download JSON ",-1)])]),e("button",{onClick:le,class:"btn-secondary"}," Close ")])])):(l(),n("div",_a,[C[13]||(C[13]=e("div",{class:"info-banner"},[e("i",{class:"mdi mdi-information"}),e("p",null,"Select a SmartIR code from the index to test commands with your Broadlink device.")],-1)),e("div",Sa,[C[11]||(C[11]=e("label",null,[e("i",{class:"mdi mdi-shape"}),S(" Platform ")],-1)),G(e("select",{"onUpdate:modelValue":C[0]||(C[0]=Y=>s.value=Y),onChange:V,class:"form-select"},[...C[10]||(C[10]=[e("option",{value:"climate"},"Climate (AC/Heater)",-1),e("option",{value:"media_player"},"Media Player (TV/Audio)",-1),e("option",{value:"fan"},"Fan",-1),e("option",{value:"light"},"Light",-1)])],544),[[Ce,s.value]])]),e("div",Ia,[be(Ne,{modelValue:u.value,"onUpdate:modelValue":C[1]||(C[1]=Y=>u.value=Y),options:f.value,label:"Manufacturer",placeholder:"Search manufacturers...",loading:_.value,disabled:_.value,onChange:fe},null,8,["modelValue","options","loading","disabled"])]),e("div",Da,[be(Ne,{modelValue:R.value,"onUpdate:modelValue":C[2]||(C[2]=Y=>R.value=Y),options:A.value,"option-label":"label","option-value":"code",label:"Model",placeholder:"Search models...",loading:t.value,disabled:!u.value||t.value,onChange:K},null,8,["modelValue","options","loading","disabled"])]),$.value?(l(),n("div",xa,[C[12]||(C[12]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[e("strong",null,m(u.value)+" - "+m($.value.models[0]),1),e("p",null,"Code: "+m($.value.code),1)])])):L("",!0),e("div",Ta,[e("button",{onClick:xe,disabled:!$.value||M.value,class:"btn-primary"},[e("i",{class:Z(["mdi",M.value?"mdi-loading mdi-spin":"mdi-download"])},null,2),S(" "+m(M.value?"Loading...":"Load Commands"),1)],8,Ma)])]))])])])):L("",!0)}}},Ya=$e(Xa,[["__scopeId","data-v-d1d8935f"]]),Za={class:"smartir-status-card"},Qa={class:"card-header"},ei=["src"],ti={class:"header-badges"},oi=["title"],li={class:"header-info"},ni={class:"header-info"},si={class:"header-info"},ai={class:"header-right"},ii={key:0,class:"card-body loading-state"},ri={key:1,class:"card-body error-state"},di={key:2,class:"card-body installed-state"},ui={key:0,class:"help-panel"},ci={key:0,class:"recommendation"},mi={key:0,class:"next-steps"},vi={class:"help-actions"},pi={key:1,class:"filter-bar"},fi={class:"filter-row"},gi={class:"filter-group filter-search"},yi={class:"filter-group"},bi={key:1,class:"view-toggle-group"},hi={class:"filter-results"},ki={key:2,class:"loading-state"},wi={key:3,class:"empty-state"},$i={key:4,class:"profiles-grid"},Ci={key:6,class:"no-results"},_i={key:3,class:"card-body not-installed-state"},Si={class:"benefits-section"},Ii={class:"benefits-list"},Di={class:"recommendation"},xi={__name:"SmartIRStatusCard",emits:["create-profile","edit-profile"],setup(o,{expose:c,emit:r}){const k=r,b=Se("smartirStatus");Se("smartirEnabled");const s=Se("refreshSmartIR"),{isMobile:u}=ze(),f=y(!1),_=y(null),$=y((b==null?void 0:b.value)||null),R=y(localStorage.getItem("smartir_simulate_not_installed")==="true"),w=y(!1),t=y(!0),A=y([]),q=y(!1),U=y({search:"",platform:""}),M=y({show:!1,title:"",message:"",platform:null,profile:null}),a=y(!1),v=y(window.innerWidth<=767?"grid":localStorage.getItem("profile_view_mode")||"grid");ue(u,g=>{g&&v.value==="list"&&(v.value="grid")}),ue(v,g=>{localStorage.setItem("profile_view_mode",g)});const I=["Full climate entity support (AC, heaters)","120+ pre-configured device profiles","Temperature and humidity sensor integration","HVAC mode control (heat, cool, auto, dry, fan)"],X=["climate","media_player","fan","light"],Q=J(()=>R.value?{installed:!1,recommendation:{message:"Install SmartIR to unlock climate device support!",benefits:["Full climate entity support (AC, heaters)","120+ pre-configured device profiles","Temperature and humidity sensor integration","HVAC mode control (heat, cool, auto, dry, fan)"]}}:$.value),te=J(()=>{var g,p;return((p=(g=Q.value)==null?void 0:g.platforms)==null?void 0:p.length)||0}),de=J(()=>{var g;return(g=Q.value)!=null&&g.device_counts?Object.values(Q.value.device_counts).reduce((p,W)=>p+W,0):0});function O(){var g;R.value=!R.value,localStorage.setItem("smartir_simulate_not_installed",R.value.toString()),!R.value&&((g=$.value)!=null&&g.installed)&&x()}const F=J(()=>{let g=A.value;if(U.value.search){const p=U.value.search.toLowerCase();g=g.filter(W=>{var le,z,C,ie;return((le=W.manufacturer)==null?void 0:le.toLowerCase().includes(p))||((z=W.model)==null?void 0:z.toLowerCase().includes(p))||((C=W.code)==null?void 0:C.toString().includes(p))||((ie=W.platform)==null?void 0:ie.toLowerCase().includes(p))})}return U.value.platform&&(g=g.filter(p=>p.platform===U.value.platform)),g}),ee=J(()=>U.value.search||U.value.platform);function me(){U.value.search="",U.value.platform=""}async function pe(){f.value=!0,_.value=null;try{if(s)await s();else{const g=await et.getStatus();$.value=g}}catch(g){_.value=g.message||"Failed to refresh SmartIR status",console.error("Error refreshing SmartIR status:",g)}finally{f.value=!1}}function De(){k("create-profile")}function xe(){a.value=!0}function Me(){window.open("https://github.com/smartHomeHub/SmartIR","_blank")}async function x(){q.value=!0;const g=[];try{for(const p of X)try{const le=((await oe.get(`/api/smartir/platforms/${p}/profiles`)).data.profiles||[]).map(z=>({...z,platform:p}));g.push(...le)}catch(W){console.warn(`Network error loading ${p} profiles (using bundled index):`,W.message)}A.value=g}catch(p){console.error("Unexpected error loading profiles:",p)}finally{q.value=!1}}function d(g,p,W){k("edit-profile",{platform:g,profile:p,startStep:W})}async function V(g,p){var W,le;try{const C=(await oe.get(`/api/smartir/platforms/${g}/profiles/${p.code}`)).data,ie=JSON.stringify(C.profile,null,2),Y=new Blob([ie],{type:"application/json"}),ce=URL.createObjectURL(Y),E=document.createElement("a");E.href=ce,E.download=`smartir_${g}_${p.manufacturer}_${p.model}_${p.code}.json`,document.body.appendChild(E),E.click(),document.body.removeChild(E),URL.revokeObjectURL(ce),(W=Se("toast").value)==null||W.success(`Downloaded ${p.manufacturer} ${p.model}`,"✅ Profile Downloaded")}catch(z){console.error("Error downloading profile:",z),(le=Se("toast").value)==null||le.error("Failed to download profile","❌ Download Error")}}async function fe(g,p){Se("toast");try{const le=(await oe.post(`/api/smartir/profiles/${p.code}/check-usage`,{platform:g})).data;if(le&&le.in_use){M.value={show:!0,title:`Cannot Delete ${p.manufacturer} ${p.model}`,message:`This profile is currently in use by ${le.device_count} device(s):

${le.devices.join(`
`)}

Please remove or reassign these devices before deleting the profile.`,platform:g,profile:p,canDelete:!1,devices:le.devices};return}}catch(W){console.error("Error checking profile usage:",W)}M.value={show:!0,title:`Delete ${p.manufacturer} ${p.model}?`,message:`Device Code: ${p.code}

This will remove the profile and update your configuration.`,platform:g,profile:p,canDelete:!0}}async function K(){var le,z;const g=Se("toast"),{platform:p,profile:W}=M.value;M.value.show=!1;try{await oe.delete(`/api/smartir/profiles/${W.code}`,{data:{platform:p}}),await x(),await Xe(),await pe(),(le=g.value)==null||le.success(`${W.manufacturer} ${W.model} has been removed`,"✅ Profile Deleted")}catch(C){console.error("Error deleting profile:",C),(z=g.value)==null||z.error("Failed to delete profile","❌ Delete Error")}}return ue(b,g=>{g&&($.value=g)},{immediate:!0}),ue(v,g=>{localStorage.setItem("profile_view_mode",g)}),Te(async()=>{var g;b!=null&&b.value&&($.value=b.value),$.value||await pe(),(g=$.value)!=null&&g.installed&&await x()}),c({loadAllProfiles:x,refreshStatus:pe}),(g,p)=>{var W,le,z,C,ie,Y,ce,E,i,N;return l(),n("div",Za,[e("div",Qa,[e("button",{class:"icon-button chevron-button",onClick:p[0]||(p[0]=j=>t.value=!t.value)},[e("i",{class:Z(["mdi",t.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2)]),e("div",{class:"header-left",onClick:p[1]||(p[1]=j=>t.value=!t.value)},[e("img",{src:_e(Je),alt:"SmartIR",class:"smartir-logo"},null,8,ei),p[15]||(p[15]=e("h3",null,"SmartIR Integration",-1)),e("div",ti,[e("div",{class:Z(["simulation-toggle-pill",{active:R.value}]),onClick:ye(O,["stop"]),title:R.value?"Click to show as installed":"Click to simulate not-installed"},[e("i",{class:Z(["mdi",R.value?"mdi-eye-off":"mdi-eye"])},null,2),e("span",null,m(R.value?"Simulating: Not Installed":"Simulation Mode"),1)],10,oi),(W=Q.value)!=null&&W.installed?(l(),n(ve,{key:0},[p[14]||(p[14]=e("div",{class:"status-badge-mini success"},[e("i",{class:"mdi mdi-check-circle"}),e("span",null,"Installed")],-1)),e("span",li,"v"+m(Q.value.version||"Unknown"),1),e("span",ni,m(te.value)+" platform"+m(te.value!==1?"s":""),1),e("span",si,m(de.value)+" device"+m(de.value!==1?"s":""),1)],64)):L("",!0)])]),e("div",ai,[(le=Q.value)!=null&&le.installed&&t.value?(l(),n("button",{key:0,onClick:p[2]||(p[2]=ye(j=>w.value=!w.value,["stop"])),class:Z(["icon-button",{active:w.value}]),title:"Show help"},[...p[16]||(p[16]=[e("i",{class:"mdi mdi-help-circle"},null,-1)])],2)):L("",!0),(z=Q.value)!=null&&z.installed&&t.value?(l(),n("button",{key:1,onClick:ye(pe,["stop"]),class:"icon-button",title:"Refresh status"},[...p[17]||(p[17]=[e("i",{class:"mdi mdi-refresh"},null,-1)])])):L("",!0),(C=Q.value)!=null&&C.installed&&t.value?(l(),n("button",{key:2,onClick:ye(xe,["stop"]),class:"btn btn-secondary"},[...p[18]||(p[18]=[e("i",{class:"mdi mdi-test-tube"},null,-1),S(" Test Codes ",-1)])])):L("",!0),(ie=Q.value)!=null&&ie.installed&&t.value?(l(),n("button",{key:3,onClick:ye(De,["stop"]),class:"btn btn-primary"},[...p[19]||(p[19]=[e("i",{class:"mdi mdi-plus"},null,-1),S(" Create SmartIR Profile ",-1)])])):L("",!0)])]),G(e("div",null,[f.value?(l(),n("div",ii,[...p[20]||(p[20]=[e("div",{class:"spinner"},null,-1),e("p",null,"Checking SmartIR installation...",-1)])])):_.value?(l(),n("div",ri,[p[21]||(p[21]=e("i",{class:"mdi mdi-alert-circle"},null,-1)),e("p",null,m(_.value),1),e("button",{onClick:pe,class:"btn-secondary"}," Try Again ")])):(Y=Q.value)!=null&&Y.installed?(l(),n("div",di,[w.value?(l(),n("div",ui,[$.value.recommendation?(l(),n("div",ci,[e("p",null,m($.value.recommendation.message),1),$.value.recommendation.next_steps?(l(),n("div",mi,[p[22]||(p[22]=e("strong",null,"Next Steps:",-1)),e("ul",null,[(l(!0),n(ve,null,ke($.value.recommendation.next_steps,(j,ae)=>(l(),n("li",{key:ae},m(j),1))),128))])])):L("",!0)])):L("",!0),e("div",vi,[e("button",{onClick:p[3]||(p[3]=(...j)=>g.viewDocumentation&&g.viewDocumentation(...j)),class:"btn-secondary"},[...p[23]||(p[23]=[e("i",{class:"mdi mdi-book-open-variant"},null,-1),S(" View Documentation ",-1)])])])])):L("",!0),A.value.length>0&&!R.value?(l(),n("div",pi,[e("div",fi,[e("div",gi,[e("label",null,[p[24]||(p[24]=e("i",{class:"mdi mdi-magnify"},null,-1)),G(e("input",{"onUpdate:modelValue":p[4]||(p[4]=j=>U.value.search=j),type:"text",placeholder:"Search profiles...",class:"search-input"},null,512),[[Ie,U.value.search]])])]),e("div",yi,[e("label",null,[p[26]||(p[26]=e("i",{class:"mdi mdi-shape"},null,-1)),G(e("select",{"onUpdate:modelValue":p[5]||(p[5]=j=>U.value.platform=j)},[...p[25]||(p[25]=[Ee('<option value="" data-v-4e9a3123>All Platforms</option><option value="climate" data-v-4e9a3123>Climate</option><option value="media_player" data-v-4e9a3123>Media Player</option><option value="fan" data-v-4e9a3123>Fan</option><option value="light" data-v-4e9a3123>Light</option>',5)])],512),[[Ce,U.value.platform]])])]),ee.value?(l(),n("button",{key:0,onClick:me,class:"btn-clear-filters"},[...p[27]||(p[27]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),S(" Clear ",-1)])])):L("",!0),_e(u)?L("",!0):(l(),n("div",bi,[e("button",{onClick:p[6]||(p[6]=j=>v.value="grid"),class:Z(["view-toggle-btn",{active:v.value==="grid"}]),title:"Grid View"},[...p[28]||(p[28]=[e("i",{class:"mdi mdi-view-grid"},null,-1),S(" Grid ",-1)])],2),e("button",{onClick:p[7]||(p[7]=j=>v.value="list"),class:Z(["view-toggle-btn",{active:v.value==="list"}]),title:"List View"},[...p[29]||(p[29]=[e("i",{class:"mdi mdi-view-list"},null,-1),S(" List ",-1)])],2)])),e("div",hi,m(F.value.length)+" of "+m(A.value.length),1)])])):L("",!0),q.value?(l(),n("div",ki,[...p[30]||(p[30]=[e("i",{class:"mdi mdi-loading mdi-spin"},null,-1),e("p",null,"Loading profiles...",-1)])])):A.value.length===0?(l(),n("div",wi,[...p[31]||(p[31]=[e("i",{class:"mdi mdi-file-document-outline"},null,-1),e("h3",null,"No Profiles Yet",-1),e("p",null,"Create your first SmartIR profile to get started",-1)])])):L("",!0),v.value==="grid"&&!R.value?(l(),n("div",$i,[(l(!0),n(ve,null,ke(F.value,j=>(l(),Le(Zs,{key:`${j.platform}-${j.code}`,profile:j,onEdit:ae=>d(j.platform,j),onCommands:ae=>d(j.platform,j,2),onDownload:ae=>V(j.platform,j),onDelete:ae=>fe(j.platform,j)},null,8,["profile","onEdit","onCommands","onDownload","onDelete"]))),128))])):v.value==="list"&&!R.value&&F.value.length>0?(l(),Le(wa,{key:5,profiles:F.value,onEdit:p[8]||(p[8]=j=>d(j.platform,j)),onCommands:p[9]||(p[9]=j=>d(j.platform,j,2)),onDownload:p[10]||(p[10]=j=>V(j.platform,j)),onDelete:p[11]||(p[11]=j=>fe(j.platform,j))},null,8,["profiles"])):L("",!0),A.value.length>0&&F.value.length===0&&!R.value?(l(),n("div",Ci,[...p[32]||(p[32]=[e("i",{class:"mdi mdi-filter-off"},null,-1),e("h3",null,"No profiles match your filters",-1),e("p",null,"Try adjusting your search or filter criteria",-1)])])):L("",!0)])):(l(),n("div",_i,[p[36]||(p[36]=e("div",{class:"status-badge warning"},[e("i",{class:"mdi mdi-information"}),e("span",null,"Not Installed")],-1)),e("div",Si,[p[34]||(p[34]=e("h4",null,"Why Install SmartIR?",-1)),e("ul",Ii,[(l(!0),n(ve,null,ke(((E=(ce=$.value)==null?void 0:ce.recommendation)==null?void 0:E.benefits)||I,(j,ae)=>(l(),n("li",{key:ae},[p[33]||(p[33]=e("i",{class:"mdi mdi-check"},null,-1)),e("span",null,m(j),1)]))),128))])]),e("div",Di,[e("p",null,m(((N=(i=$.value)==null?void 0:i.recommendation)==null?void 0:N.message)||"Install SmartIR to unlock climate device support!"),1)]),e("div",{class:"card-actions"},[e("button",{onClick:Me,class:"btn-primary"},[...p[35]||(p[35]=[e("i",{class:"mdi mdi-github"},null,-1),S(" Install SmartIR ",-1)])])])]))],512),[[Ze,t.value]]),be(Ae,{isOpen:M.value.show,title:M.value.title,message:M.value.message,confirmText:M.value.canDelete===!1?null:"Delete",cancelText:"Close",dangerMode:!0,confirmDisabled:M.value.canDelete===!1,onConfirm:K,onCancel:p[12]||(p[12]=j=>M.value.show=!1)},null,8,["isOpen","title","message","confirmText","confirmDisabled"]),be(Ya,{isOpen:a.value,onClose:p[13]||(p[13]=j=>a.value=!1)},null,8,["isOpen"])])}}},Ti=$e(xi,[["__scopeId","data-v-4e9a3123"]]),Mi={class:"climate-form"},Ri={class:"learning-mode-section"},Li={class:"mode-toggle"},Ai={class:"mode-content"},Ei={class:"mode-stats"},Oi={class:"stat-badge"},Vi={class:"stat-badge time"},Pi={class:"mode-content"},Ui={class:"mode-stats"},ji={class:"stat-badge"},Fi={class:"stat-badge time warning"},Ni={key:0,class:"command-breakdown"},Bi={class:"warning-text"},qi={class:"form-section"},Hi={key:0,class:"help-text"},zi={key:1,class:"help-text"},Ji={class:"form-row"},Wi={class:"form-group"},Gi={class:"form-group"},Ki={class:"form-group"},Xi={key:2,class:"representative-temp-section"},Yi={class:"form-group"},Zi=["value"],Qi={class:"form-section"},er={class:"checkbox-grid"},tr={class:"checkbox-item"},or={class:"checkbox-item"},lr={class:"checkbox-item"},nr={class:"checkbox-item"},sr={class:"checkbox-item"},ar={class:"checkbox-item"},ir={class:"form-section"},rr={class:"checkbox-grid"},dr={class:"checkbox-item"},ur={class:"checkbox-item"},cr={class:"checkbox-item"},mr={class:"checkbox-item"},vr={class:"form-section"},pr={class:"checkbox-grid"},fr={class:"checkbox-item"},gr={class:"checkbox-item"},yr={class:"checkbox-item"},br={class:"checkbox-item"},hr={class:"form-section"},kr={class:"form-group"},wr={class:"form-group"},$r={class:"form-group"},Cr={key:0,class:"validation-summary"},_r={__name:"ClimateProfileForm",props:{modelValue:{type:Object,default:()=>({})}},emits:["update:modelValue"],setup(o,{emit:c}){const r=o,k=c,b=y("quick"),s=y({minTemp:16,maxTemp:30,precision:1,representativeTemp:24,modes:["off","auto","cool","heat"],fanModes:["auto","low","medium","high"],swingModes:[],tempSensor:"",humiditySensor:"",powerSensor:"",learningMode:"quick",...r.modelValue}),u=J(()=>{const M=[],a=s.value.minTemp||16,h=s.value.maxTemp||30,v=s.value.precision||1;for(let I=a;I<=h;I+=v)M.push(I);return M}),f=J(()=>s.value.modes.filter(M=>M!=="off").length),_=J(()=>s.value.fanModes.length||1),$=J(()=>s.value.swingModes.length||1),R=J(()=>{const M=s.value.minTemp||16,a=s.value.maxTemp||30,h=s.value.precision||1;return Math.floor((a-M)/h)+1}),w=J(()=>{const M=s.value.modes.includes("off")?1:0;return f.value*_.value*$.value+M}),t=J(()=>Math.ceil(w.value*30/60)),A=J(()=>{const M=s.value.modes.includes("off")?1:0;return f.value*R.value*_.value*$.value+M}),q=J(()=>Math.ceil(A.value*30/60)),U=J(()=>{const M=[];return(!s.value.minTemp||s.value.minTemp<10||s.value.minTemp>35)&&M.push("Minimum temperature must be between 10°C and 35°C"),(!s.value.maxTemp||s.value.maxTemp<10||s.value.maxTemp>35)&&M.push("Maximum temperature must be between 10°C and 35°C"),s.value.minTemp>=s.value.maxTemp&&M.push("Minimum temperature must be less than maximum temperature"),(!s.value.modes||s.value.modes.length===0)&&M.push("At least one HVAC mode must be selected"),M});return ue(b,M=>{s.value.learningMode=M}),ue(s,M=>{k("update:modelValue",M)},{deep:!0,immediate:!0}),(M,a)=>(l(),n("div",Mi,[a[63]||(a[63]=e("h3",null,"Climate Device Configuration",-1)),e("div",Ri,[e("div",Li,[e("label",{class:Z(["mode-option",{active:b.value==="quick"}])},[G(e("input",{type:"radio",value:"quick","onUpdate:modelValue":a[0]||(a[0]=h=>b.value=h)},null,512),[[Fe,b.value]]),e("div",Ai,[a[23]||(a[23]=e("div",{class:"mode-header"},[e("i",{class:"mdi mdi-flash"}),e("strong",null,"Quick Mode (Recommended)")],-1)),a[24]||(a[24]=e("p",null,"Learn one temperature per mode combination",-1)),e("div",Ei,[e("span",Oi,m(w.value)+" commands",1),e("span",Vi,"~"+m(t.value)+" min",1)])])],2),e("label",{class:Z(["mode-option",{active:b.value==="complete"}])},[G(e("input",{type:"radio",value:"complete","onUpdate:modelValue":a[1]||(a[1]=h=>b.value=h)},null,512),[[Fe,b.value]]),e("div",Pi,[a[25]||(a[25]=e("div",{class:"mode-header"},[e("i",{class:"mdi mdi-check-all"}),e("strong",null,"Complete Mode")],-1)),a[26]||(a[26]=e("p",null,"Learn all temperature combinations",-1)),e("div",Ui,[e("span",ji,m(A.value)+" commands",1),e("span",Fi,"~"+m(q.value)+" min",1)])])],2)]),b.value==="complete"?(l(),n("div",Ni,[a[27]||(a[27]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[e("strong",null,"Complete mode will require learning "+m(A.value)+" commands",1),e("p",null,"This includes all combinations of modes ("+m(f.value)+"), temperatures ("+m(R.value)+"), fan speeds ("+m(_.value)+"), and swing modes ("+m($.value)+").",1),e("p",Bi,"⏱️ Estimated time: "+m(q.value)+" minutes at ~30 seconds per command",1)])])):L("",!0)]),e("div",qi,[a[33]||(a[33]=e("h4",null,"Temperature Range",-1)),b.value==="quick"?(l(),n("p",Hi," Define the full temperature range your device supports. You'll select one temperature to learn below. ")):(l(),n("p",zi," Define the temperature range. All temperatures in this range will be learned. ")),e("div",Ji,[e("div",Wi,[a[28]||(a[28]=e("label",null,"Minimum Temperature (°C) *",-1)),G(e("input",{"onUpdate:modelValue":a[2]||(a[2]=h=>s.value.minTemp=h),type:"number",min:"10",max:"35",placeholder:"16"},null,512),[[Ie,s.value.minTemp,void 0,{number:!0}]])]),e("div",Gi,[a[29]||(a[29]=e("label",null,"Maximum Temperature (°C) *",-1)),G(e("input",{"onUpdate:modelValue":a[3]||(a[3]=h=>s.value.maxTemp=h),type:"number",min:"10",max:"35",placeholder:"30"},null,512),[[Ie,s.value.maxTemp,void 0,{number:!0}]])]),e("div",Ki,[a[31]||(a[31]=e("label",null,"Precision",-1)),G(e("select",{"onUpdate:modelValue":a[4]||(a[4]=h=>s.value.precision=h)},[...a[30]||(a[30]=[e("option",{value:1},"1°C (Whole degrees)",-1),e("option",{value:.5},"0.5°C (Half degrees)",-1)])],512),[[Ce,s.value.precision,void 0,{number:!0}]])])]),b.value==="quick"?(l(),n("div",Xi,[e("div",Yi,[a[32]||(a[32]=e("label",null,"Representative Temperature to Learn *",-1)),G(e("select",{"onUpdate:modelValue":a[5]||(a[5]=h=>s.value.representativeTemp=h)},[(l(!0),n(ve,null,ke(u.value,h=>(l(),n("option",{key:h,value:h},m(h)+"°C ",9,Zi))),128))],512),[[Ce,s.value.representativeTemp,void 0,{number:!0}]]),e("small",null,"This temperature will be learned for all mode combinations. The device profile will still show the full range ("+m(s.value.minTemp)+"°C - "+m(s.value.maxTemp)+"°C).",1)])])):L("",!0)]),e("div",Qi,[a[40]||(a[40]=e("h4",null,"Supported HVAC Modes *",-1)),a[41]||(a[41]=e("p",{class:"help-text"},"Select all modes your device supports",-1)),e("div",er,[e("label",tr,[G(e("input",{type:"checkbox",value:"off","onUpdate:modelValue":a[6]||(a[6]=h=>s.value.modes=h)},null,512),[[ge,s.value.modes]]),a[34]||(a[34]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),S(" Off ")],-1))]),e("label",or,[G(e("input",{type:"checkbox",value:"auto","onUpdate:modelValue":a[7]||(a[7]=h=>s.value.modes=h)},null,512),[[ge,s.value.modes]]),a[35]||(a[35]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-autorenew"}),S(" Auto ")],-1))]),e("label",lr,[G(e("input",{type:"checkbox",value:"cool","onUpdate:modelValue":a[8]||(a[8]=h=>s.value.modes=h)},null,512),[[ge,s.value.modes]]),a[36]||(a[36]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-snowflake"}),S(" Cool ")],-1))]),e("label",nr,[G(e("input",{type:"checkbox",value:"heat","onUpdate:modelValue":a[9]||(a[9]=h=>s.value.modes=h)},null,512),[[ge,s.value.modes]]),a[37]||(a[37]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fire"}),S(" Heat ")],-1))]),e("label",sr,[G(e("input",{type:"checkbox",value:"dry","onUpdate:modelValue":a[10]||(a[10]=h=>s.value.modes=h)},null,512),[[ge,s.value.modes]]),a[38]||(a[38]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-water-percent"}),S(" Dry ")],-1))]),e("label",ar,[G(e("input",{type:"checkbox",value:"fan_only","onUpdate:modelValue":a[11]||(a[11]=h=>s.value.modes=h)},null,512),[[ge,s.value.modes]]),a[39]||(a[39]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan"}),S(" Fan Only ")],-1))])])]),e("div",ir,[a[46]||(a[46]=e("h4",null,"Fan Modes",-1)),a[47]||(a[47]=e("p",{class:"help-text"},"Select all fan speeds your device supports",-1)),e("div",rr,[e("label",dr,[G(e("input",{type:"checkbox",value:"auto","onUpdate:modelValue":a[12]||(a[12]=h=>s.value.fanModes=h)},null,512),[[ge,s.value.fanModes]]),a[42]||(a[42]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-autorenew"}),S(" Auto ")],-1))]),e("label",ur,[G(e("input",{type:"checkbox",value:"low","onUpdate:modelValue":a[13]||(a[13]=h=>s.value.fanModes=h)},null,512),[[ge,s.value.fanModes]]),a[43]||(a[43]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-1"}),S(" Low ")],-1))]),e("label",cr,[G(e("input",{type:"checkbox",value:"medium","onUpdate:modelValue":a[14]||(a[14]=h=>s.value.fanModes=h)},null,512),[[ge,s.value.fanModes]]),a[44]||(a[44]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-2"}),S(" Medium ")],-1))]),e("label",mr,[G(e("input",{type:"checkbox",value:"high","onUpdate:modelValue":a[15]||(a[15]=h=>s.value.fanModes=h)},null,512),[[ge,s.value.fanModes]]),a[45]||(a[45]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-3"}),S(" High ")],-1))])])]),e("div",vr,[a[52]||(a[52]=e("h4",null,"Swing Modes (Optional)",-1)),a[53]||(a[53]=e("p",{class:"help-text"},"Select if your device has swing/oscillation",-1)),e("div",pr,[e("label",fr,[G(e("input",{type:"checkbox",value:"off","onUpdate:modelValue":a[16]||(a[16]=h=>s.value.swingModes=h)},null,512),[[ge,s.value.swingModes]]),a[48]||(a[48]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-horizontal"}),S(" Off ")],-1))]),e("label",gr,[G(e("input",{type:"checkbox",value:"vertical","onUpdate:modelValue":a[17]||(a[17]=h=>s.value.swingModes=h)},null,512),[[ge,s.value.swingModes]]),a[49]||(a[49]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-vertical"}),S(" Vertical ")],-1))]),e("label",yr,[G(e("input",{type:"checkbox",value:"horizontal","onUpdate:modelValue":a[18]||(a[18]=h=>s.value.swingModes=h)},null,512),[[ge,s.value.swingModes]]),a[50]||(a[50]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-horizontal"}),S(" Horizontal ")],-1))]),e("label",br,[G(e("input",{type:"checkbox",value:"both","onUpdate:modelValue":a[19]||(a[19]=h=>s.value.swingModes=h)},null,512),[[ge,s.value.swingModes]]),a[51]||(a[51]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-arrow-all"}),S(" Both ")],-1))])])]),e("div",hr,[a[60]||(a[60]=e("h4",null,"Sensors (Optional)",-1)),a[61]||(a[61]=e("p",{class:"help-text"},"Link external sensors for better climate control",-1)),e("div",kr,[a[54]||(a[54]=e("label",null,"Temperature Sensor",-1)),G(e("input",{"onUpdate:modelValue":a[20]||(a[20]=h=>s.value.tempSensor=h),type:"text",placeholder:"sensor.living_room_temperature"},null,512),[[Ie,s.value.tempSensor]]),a[55]||(a[55]=e("small",null,"Entity ID of temperature sensor",-1))]),e("div",wr,[a[56]||(a[56]=e("label",null,"Humidity Sensor",-1)),G(e("input",{"onUpdate:modelValue":a[21]||(a[21]=h=>s.value.humiditySensor=h),type:"text",placeholder:"sensor.living_room_humidity"},null,512),[[Ie,s.value.humiditySensor]]),a[57]||(a[57]=e("small",null,"Entity ID of humidity sensor",-1))]),e("div",$r,[a[58]||(a[58]=e("label",null,"Power Sensor",-1)),G(e("input",{"onUpdate:modelValue":a[22]||(a[22]=h=>s.value.powerSensor=h),type:"text",placeholder:"binary_sensor.ac_power"},null,512),[[Ie,s.value.powerSensor]]),a[59]||(a[59]=e("small",null,"Entity ID of power sensor (to detect on/off state)",-1))])]),U.value.length>0?(l(),n("div",Cr,[a[62]||(a[62]=e("h4",null,[e("i",{class:"mdi mdi-alert-circle"}),S(" Please fix the following: ")],-1)),e("ul",null,[(l(!0),n(ve,null,ke(U.value,(h,v)=>(l(),n("li",{key:v},m(h),1))),128))])])):L("",!0)]))}},Sr=$e(_r,[["__scopeId","data-v-5674f3f7"]]),Ir={class:"command-wizard"},Dr={class:"device-selection-section"},xr={class:"input-wrapper"},Tr=["value"],Mr={key:0,class:"validation-tooltip"},Rr={class:"form-group"},Lr=["disabled"],Ar={key:0},Er={key:1},Or={key:0,class:"edit-mode-banner"},Vr={class:"wizard-info"},Pr={key:0},Ur={key:1},jr={class:"progress-info"},Fr={class:"progress-bar"},Nr={class:"progress-text"},Br={class:"commands-grid"},qr={class:"command-header"},Hr={class:"command-icon"},zr={class:"command-info"},Jr={key:0,class:"learning-indicator"},Wr={key:0,class:"ir-learning-steps"},Gr={key:1,class:"rf-learning-steps"},Kr={class:"command-actions"},Xr=["onClick","disabled"],Yr={key:1,class:"learned-status"},Zr=["onClick","disabled"],Qr=["onClick"],ed={class:"quick-actions"},td=["disabled"],od=["disabled"],ld={__name:"CommandLearningWizard",props:{modelValue:{type:Object,default:()=>({})},platform:{type:String,required:!0},config:{type:Object,required:!0},broadlinkDevice:{type:String,default:""},manufacturer:{type:String,required:!0},model:{type:String,required:!0},commandType:{type:String,default:"ir"}},emits:["update:modelValue","update:broadlinkDevice","update:commandType"],setup(o,{emit:c}){const r=Pe(),k=o,b=c,s=y({...k.modelValue}),u=y(null),f=y(null),_=y([]),$=y(k.broadlinkDevice),R=y(k.commandType),w=y(!1),t=y([]),A=y(!1),q=y(!1),U=y({show:!1,commandKey:null,commandLabel:""}),M=y(!1),a=J(()=>{const x=[];if(k.platform==="climate"){const d=k.config.modes||[],V=k.config.fanModes||[],fe=k.config.minTemp||16,K=k.config.maxTemp||30;d.forEach(g=>{if(g==="off")x.push({key:"off",label:"Power Off",description:"Turn device off",icon:"mdi mdi-power",mode:"off"});else for(let p=fe;p<=K;p++)V.forEach(W=>{const le=`${g}_${p}_${W}`;x.push({key:le,label:`${g.toUpperCase()} ${p}°C ${W}`,description:`Mode: ${g}, Temp: ${p}°C, Fan: ${W}`,icon:X(g),mode:g,temp:p,fanMode:W})})})}else if(k.platform==="media_player"){const d=k.config.features||[];d.includes("turn_on")&&(x.push({key:"turn_on",label:"Power On",description:"Turn on the device",icon:"mdi mdi-power"}),x.push({key:"turn_off",label:"Power Off",description:"Turn off the device",icon:"mdi mdi-power-off"})),d.includes("volume")&&(x.push({key:"volume_up",label:"Volume Up",description:"Increase volume",icon:"mdi mdi-volume-plus"}),x.push({key:"volume_down",label:"Volume Down",description:"Decrease volume",icon:"mdi mdi-volume-minus"})),d.includes("mute")&&x.push({key:"mute",label:"Mute",description:"Toggle mute",icon:"mdi mdi-volume-mute"}),d.includes("source")&&(x.push({key:"source_hdmi1",label:"Source: HDMI 1",description:"Switch to HDMI 1",icon:"mdi mdi-import"}),x.push({key:"source_hdmi2",label:"Source: HDMI 2",description:"Switch to HDMI 2",icon:"mdi mdi-import"}),x.push({key:"source_hdmi3",label:"Source: HDMI 3",description:"Switch to HDMI 3",icon:"mdi mdi-import"})),d.includes("channel")&&(x.push({key:"channel_up",label:"Channel Up",description:"Next channel",icon:"mdi mdi-chevron-up"}),x.push({key:"channel_down",label:"Channel Down",description:"Previous channel",icon:"mdi mdi-chevron-down"}))}else if(k.platform==="fan"){const d=k.config.speedLevels||3,V=k.config.features||[];x.push({key:"turn_on",label:"Power On",description:"Turn on the fan",icon:"mdi mdi-power"}),x.push({key:"turn_off",label:"Power Off",description:"Turn off the fan",icon:"mdi mdi-power-off"});for(let fe=1;fe<=d;fe++){const K=fe===1?"Low":fe===d?"High":fe===2&&d===3?"Medium":`Speed ${fe}`;x.push({key:`speed_${fe}`,label:`${K}`,description:`Set fan to speed level ${fe}`,icon:"mdi mdi-fan"})}V.includes("oscillate")&&(x.push({key:"oscillate_on",label:"Oscillate On",description:"Enable oscillation",icon:"mdi mdi-sync"}),x.push({key:"oscillate_off",label:"Oscillate Off",description:"Disable oscillation",icon:"mdi mdi-sync-off"})),V.includes("direction")&&(x.push({key:"direction_forward",label:"Direction: Forward",description:"Set direction to forward",icon:"mdi mdi-rotate-right"}),x.push({key:"direction_reverse",label:"Direction: Reverse",description:"Set direction to reverse",icon:"mdi mdi-rotate-left"}))}else if(k.platform==="light"){const d=k.config.features||[];d.includes("turn_on")&&(x.push({key:"turn_on",label:"Power On",description:"Turn on the light",icon:"mdi mdi-lightbulb-on"}),x.push({key:"turn_off",label:"Power Off",description:"Turn off the light",icon:"mdi mdi-lightbulb-off"})),d.includes("brightness")&&(x.push({key:"brightness_up",label:"Brightness Up",description:"Increase brightness",icon:"mdi mdi-brightness-7"}),x.push({key:"brightness_down",label:"Brightness Down",description:"Decrease brightness",icon:"mdi mdi-brightness-5"})),d.includes("color_temp")&&(x.push({key:"color_temp_warm",label:"Warm White",description:"Set to warm white",icon:"mdi mdi-weather-sunset"}),x.push({key:"color_temp_cool",label:"Cool White",description:"Set to cool white",icon:"mdi mdi-weather-sunny"})),d.includes("rgb")&&(x.push({key:"color_red",label:"Color: Red",description:"Set color to red",icon:"mdi mdi-palette"}),x.push({key:"color_green",label:"Color: Green",description:"Set color to green",icon:"mdi mdi-palette"}),x.push({key:"color_blue",label:"Color: Blue",description:"Set color to blue",icon:"mdi mdi-palette"}))}return x}),h=J(()=>a.value.length),v=J(()=>Object.keys(s.value).length),I=J(()=>h.value===0?0:Math.round(v.value/h.value*100));function X(x){return{off:"mdi mdi-power",auto:"mdi mdi-autorenew",cool:"mdi mdi-snowflake",heat:"mdi mdi-fire",dry:"mdi mdi-water-percent",fan_only:"mdi mdi-fan"}[x]||"mdi mdi-remote"}async function Q(x){if(!u.value){if(!$.value){q.value=!0,window.scrollTo({top:0,behavior:"smooth"});return}q.value=!1,u.value=x.key;try{const d=k.manufacturer.toLowerCase().replace(/[^a-z0-9]+/g,"_"),V=k.model.toLowerCase().replace(/[^a-z0-9]+/g,"_"),fe=`${d}_${V}`,g=(await oe.post("/api/commands/learn",{entity_id:$.value,device:fe,command:x.key,command_type:R.value})).data;if(g.success&&g.code)s.value[x.key]=g.code,b("update:modelValue",s.value),A.value=!0,g.code==="pending"&&console.log(`⏳ Command '${x.key}' learned, code will be fetched from storage when saving`),w.value&&t.value.length>0&&setTimeout(()=>{const p=t.value.shift();p?Q(p):w.value=!1},1e3);else throw new Error(g.error||"Failed to learn command")}catch(d){console.error("Error learning command:",d),r.error(`Error learning command: ${d.message}`),w.value=!1,t.value=[]}finally{w.value||(u.value=null)}}}async function te(x){var d;if(!$.value){q.value=!0,window.scrollTo({top:0,behavior:"smooth"});return}if(!s.value[x]){(d=r.value)==null||d.error("Command not learned yet");return}f.value=x;try{const V=s.value[x];await oe.post("/api/commands/send-raw",{entity_id:$.value,command:V,command_type:R.value}),r.success("Command sent successfully")}catch(V){console.error("Error testing command:",V),r.error(`Error testing command: ${V.message}`)}finally{f.value=null}}function de(x){const d=a.value.find(V=>V.key===x);U.value={show:!0,commandKey:x,commandLabel:d?d.label:x}}function O(){const x=U.value.commandKey;delete s.value[x],b("update:modelValue",s.value),U.value.show=!1}function F(){const x=a.value.filter(V=>!s.value[V.key]);if(x.length===0)return;w.value=!0,t.value=[...x];const d=t.value.shift();d&&Q(d)}function ee(){M.value=!0}function me(){s.value={},b("update:modelValue",s.value),M.value=!1}ue(()=>k.modelValue,x=>{s.value={...x}},{deep:!0}),Te(async()=>{await pe()});async function pe(){try{console.log("SmartIR device - commands will be loaded from SmartIR JSON file, not Broadlink storage")}catch(x){console.error("Error in loadExistingCommands:",x)}}function De(){b("update:broadlinkDevice",$.value)}function xe(){b("update:commandType",R.value)}async function Me(){try{console.log("🔍 Loading Broadlink devices from /api/remote/devices");const x=await oe.get("/api/remote/devices");console.log("📦 Response data:",x.data);const d=x.data.devices||[];console.log(`✅ Found ${d.length} devices:`,d),_.value=d}catch(x){console.error("❌ Error loading remote devices:",x),_.value=[]}}return ue(()=>k.broadlinkDevice,x=>{$.value=x}),ue($,x=>{x&&(q.value=!1)}),ue(()=>k.commandType,x=>{R.value=x}),Te(async()=>{await Me(),await pe()}),(x,d)=>(l(),n("div",Ir,[d[22]||(d[22]=e("h3",null,"Learn IR Commands",-1)),e("div",Dr,[e("div",{class:Z(["form-group",{"has-error":q.value}])},[d[6]||(d[6]=e("label",null,"Broadlink Device *",-1)),e("div",xr,[G(e("select",{"onUpdate:modelValue":d[0]||(d[0]=V=>$.value=V),onChange:De},[d[4]||(d[4]=e("option",{value:""},"Select Broadlink device...",-1)),(l(!0),n(ve,null,ke(_.value,V=>(l(),n("option",{key:V.entity_id,value:V.entity_id},m(V.name||V.entity_id),9,Tr))),128))],544),[[Ce,$.value]]),q.value?(l(),n("div",Mr,[...d[5]||(d[5]=[e("i",{class:"mdi mdi-alert"},null,-1),S(" Device is required ",-1)])])):L("",!0)]),e("small",null,"This device will be used to learn commands ("+m(_.value.length)+" devices found)",1)],2),e("div",Rr,[d[8]||(d[8]=e("label",null,"Command Type *",-1)),G(e("select",{"onUpdate:modelValue":d[1]||(d[1]=V=>R.value=V),onChange:xe,disabled:v.value>0},[...d[7]||(d[7]=[e("option",{value:"ir"},"📡 Infrared (IR) - Most common for AC, TV, etc.",-1),e("option",{value:"rf"},"📻 Radio Frequency (RF) - For RF remotes",-1)])],40,Lr),[[Ce,R.value]]),v.value>0?(l(),n("small",Ar,"Command type cannot be changed after learning commands")):(l(),n("small",Er,"Select the type of commands your device uses"))])]),v.value>0&&!A.value?(l(),n("div",Or,[d[10]||(d[10]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[d[9]||(d[9]=e("strong",null,"Editing Existing Profile",-1)),e("p",null,m(v.value)+" command"+m(v.value!==1?"s":"")+' already learned. You can re-learn any command by clicking the delete icon and then "Learn Command".',1)])])):L("",!0),e("div",Vr,[d[14]||(d[14]=e("i",{class:"mdi mdi-information"},null,-1)),e("div",null,[d[13]||(d[13]=e("p",null,[e("strong",null,"How it works:")],-1)),o.commandType==="ir"?(l(),n("ol",Pr,[...d[11]||(d[11]=[e("li",null,'Click "Learn Command" for each combination',-1),e("li",null,[e("strong",null,"Point your IR remote directly at the Broadlink device")],-1),e("li",null,"Press the button on your remote",-1),e("li",null,"Wait for confirmation (up to 30 seconds)",-1)])])):(l(),n("ol",Ur,[...d[12]||(d[12]=[e("li",null,'Click "Learn Command" for each combination',-1),e("li",null,[e("strong",null,"Step 1:"),S(" Hold button on remote - Broadlink scans for RF frequency")],-1),e("li",null,[e("strong",null,"Step 2:"),S(" Watch for Home Assistant notification, then press and release button")],-1),e("li",null,"Keep remote within 5cm of Broadlink (RF doesn't need line-of-sight)",-1),e("li",null,"Wait for confirmation (may take up to 30 seconds)",-1)])]))])]),e("div",jr,[e("div",Fr,[e("div",{class:"progress-fill",style:nt({width:I.value+"%"})},null,4)]),e("span",Nr,m(v.value)+" / "+m(h.value)+" commands learned ("+m(I.value)+"%) ",1)]),e("div",Br,[(l(!0),n(ve,null,ke(a.value,V=>(l(),n("div",{key:V.key,class:Z(["command-card",{learned:s.value[V.key],learning:u.value===V.key}])},[e("div",qr,[e("div",Hr,[e("i",{class:Z(V.icon)},null,2)]),e("div",zr,[e("h4",null,m(V.label),1),e("p",null,m(V.description),1)])]),u.value===V.key?(l(),n("div",Jr,[o.commandType==="ir"?(l(),n("div",Wr,[...d[15]||(d[15]=[e("p",null,[e("strong",null,"Point your remote directly at the Broadlink device and press the button.")],-1),e("small",null,"Listening for up to 30 seconds...",-1)])])):(l(),n("div",Gr,[...d[16]||(d[16]=[e("p",{class:"rf-title"},[e("strong",null,"Learning request sent to device.")],-1),e("p",{class:"rf-subtitle"},[S("RF learning is a "),e("strong",null,"two-step process"),S(":")],-1),e("ol",null,[e("li",null,[e("strong",null,"Step 1 - Frequency Sweep (~10-15 seconds):"),S(" Press and hold the button on your remote until the notification updates. ")]),e("li",null,[e("strong",null,"Step 2 - Learn Signal:"),S(" Press and release the button once. ")])],-1),e("p",{class:"rf-note"},"Follow the Home Assistant notifications (🔔) for real-time instructions.",-1)])]))])):L("",!0),e("div",Kr,[s.value[V.key]?(l(),n("div",Yr,[d[18]||(d[18]=e("i",{class:"mdi mdi-check-circle"},null,-1)),d[19]||(d[19]=e("span",null,"Learned",-1)),e("span",{class:Z(["command-type-badge",R.value])},m(R.value.toUpperCase()),3),e("button",{onClick:fe=>te(V.key),class:"icon-btn",title:"Test command",disabled:f.value===V.key,style:{"margin-left":"auto"}},[e("i",{class:Z(["mdi mdi-play",{"mdi-spin":f.value===V.key}])},null,2)],8,Zr),e("button",{onClick:fe=>de(V.key),class:"icon-btn danger",title:"Delete and re-learn"},[...d[17]||(d[17]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,Qr)])):(l(),n("button",{key:0,onClick:fe=>Q(V),class:Z(["btn-learn",{learning:u.value===V.key}]),disabled:u.value!==null},[e("i",{class:Z(["mdi mdi-radio-tower",{"mdi-spin":u.value===V.key}])},null,2),S(" "+m(u.value===V.key?"Listening...":"Learn Command"),1)],10,Xr))])],2))),128))]),e("div",ed,[e("button",{onClick:F,class:"btn-secondary",disabled:u.value!==null||v.value===h.value},[...d[20]||(d[20]=[e("i",{class:"mdi mdi-play-circle"},null,-1),S(" Learn All Remaining ",-1)])],8,td),e("button",{onClick:ee,class:"btn-text",disabled:v.value===0},[...d[21]||(d[21]=[e("i",{class:"mdi mdi-delete-sweep"},null,-1),S(" Clear All ",-1)])],8,od)]),be(Ae,{isOpen:U.value.show,title:"Delete Learned Command?",message:`Are you sure you want to delete the '${U.value.commandLabel}' command?

You will need to re-learn this command.`,confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,onConfirm:O,onCancel:d[2]||(d[2]=V=>U.value.show=!1)},null,8,["isOpen","message"]),be(Ae,{isOpen:M.value,title:"Delete All Learned Commands?",message:"Are you sure you want to delete all learned commands? This cannot be undone.\\n\\nYou will need to re-learn all commands.",confirmText:"Delete All",cancelText:"Cancel",dangerMode:!0,onConfirm:me,onCancel:d[3]||(d[3]=V=>M.value=!1)},null,8,["isOpen"])]))}},nd=$e(ld,[["__scopeId","data-v-84fe090b"]]),sd={class:"profile-preview"},ad={class:"preview-summary"},id={class:"summary-card"},rd={class:"stats-grid"},dd={class:"stat-item"},ud={class:"stat-value"},cd={class:"stat-item"},md={class:"stat-value"},vd={class:"stat-item"},pd={class:"stat-value"},fd={class:"preview-tabs"},gd={class:"preview-content"},yd={key:0,class:"tab-content"},bd={class:"code-header"},hd={class:"code-block"},kd={key:1,class:"tab-content"},wd={class:"code-header"},$d={class:"code-block"},Cd={key:2,class:"tab-content"},_d={class:"instructions"},Sd={class:"step-item"},Id={class:"step-content"},Dd={class:"code-path"},xd={__name:"ProfilePreview",props:{profile:{type:Object,required:!0},jsonData:{type:Object,required:!0},yamlConfig:{type:String,required:!0}},setup(o){const c=Pe(),r=o,k=y("json"),b=y(!1),s=y(!1),u=J(()=>Object.keys(r.profile.commands||{}).length),f=J(()=>JSON.stringify(r.jsonData,null,2));async function _(){try{await navigator.clipboard.writeText(f.value),b.value=!0,setTimeout(()=>{b.value=!1},2e3)}catch(R){console.error("Failed to copy JSON:",R),c.error("Failed to copy to clipboard")}}async function $(){try{await navigator.clipboard.writeText(r.yamlConfig),s.value=!0,setTimeout(()=>{s.value=!1},2e3)}catch(R){console.error("Failed to copy YAML:",R),c.error("Failed to copy to clipboard")}}return(R,w)=>{var t;return l(),n("div",sd,[w[22]||(w[22]=e("h3",null,"Preview & Save",-1)),e("div",ad,[e("div",id,[w[4]||(w[4]=e("i",{class:"mdi mdi-check-circle"},null,-1)),e("div",null,[w[3]||(w[3]=e("h4",null,"Profile Ready!",-1)),e("p",null,m(o.profile.manufacturer)+" "+m(o.profile.model),1)])]),e("div",rd,[e("div",dd,[e("span",ud,m(u.value),1),w[5]||(w[5]=e("span",{class:"stat-label"},"Commands Learned",-1))]),e("div",cd,[e("span",md,m(o.profile.platform),1),w[6]||(w[6]=e("span",{class:"stat-label"},"Platform",-1))]),e("div",vd,[e("span",pd,m(((t=o.profile.config.modes)==null?void 0:t.length)||0),1),w[7]||(w[7]=e("span",{class:"stat-label"},"HVAC Modes",-1))])])]),e("div",fd,[e("button",{onClick:w[0]||(w[0]=A=>k.value="json"),class:Z(["tab-button",{active:k.value==="json"}])},[...w[8]||(w[8]=[e("i",{class:"mdi mdi-code-json"},null,-1),S(" SmartIR JSON ",-1)])],2),e("button",{onClick:w[1]||(w[1]=A=>k.value="yaml"),class:Z(["tab-button",{active:k.value==="yaml"}])},[...w[9]||(w[9]=[e("i",{class:"mdi mdi-file-code"},null,-1),S(" YAML Config ",-1)])],2),e("button",{onClick:w[2]||(w[2]=A=>k.value="instructions"),class:Z(["tab-button",{active:k.value==="instructions"}])},[...w[10]||(w[10]=[e("i",{class:"mdi mdi-information"},null,-1),S(" Instructions ",-1)])],2)]),e("div",gd,[k.value==="json"?(l(),n("div",yd,[e("div",bd,[w[12]||(w[12]=e("h4",null,"SmartIR Device Code JSON",-1)),e("button",{onClick:_,class:"btn-copy"},[w[11]||(w[11]=e("i",{class:"mdi mdi-content-copy"},null,-1)),S(" "+m(b.value?"Copied!":"Copy"),1)])]),e("pre",hd,[e("code",null,m(f.value),1)]),w[13]||(w[13]=e("p",{class:"code-note"},[e("i",{class:"mdi mdi-information"}),S(" Save this as "),e("code",null,"10000.json"),S(" in your SmartIR codes directory ")],-1))])):L("",!0),k.value==="yaml"?(l(),n("div",kd,[e("div",wd,[w[15]||(w[15]=e("h4",null,"Home Assistant Configuration",-1)),e("button",{onClick:$,class:"btn-copy"},[w[14]||(w[14]=e("i",{class:"mdi mdi-content-copy"},null,-1)),S(" "+m(s.value?"Copied!":"Copy"),1)])]),e("pre",$d,[e("code",null,m(o.yamlConfig),1)]),w[16]||(w[16]=e("p",{class:"code-note"},[e("i",{class:"mdi mdi-information"}),S(" Add this to your "),e("code",null,"configuration.yaml"),S(" file ")],-1))])):L("",!0),k.value==="instructions"?(l(),n("div",Cd,[e("div",_d,[w[20]||(w[20]=e("h4",null,"Installation Steps",-1)),e("div",Sd,[w[19]||(w[19]=e("div",{class:"step-number"},"1",-1)),e("div",Id,[w[17]||(w[17]=e("h5",null,"Get Next Code Number",-1)),w[18]||(w[18]=e("p",null,"Custom device codes start at 10000. Check your SmartIR codes directory to find the next available number.",-1)),e("div",Dd,[e("code",null,"/config/custom_components/smartir/codes/"+m(o.profile.platform)+"/",1)])])]),w[21]||(w[21]=Ee('<div class="step-item" data-v-cbf0874d><div class="step-number" data-v-cbf0874d>2</div><div class="step-content" data-v-cbf0874d><h5 data-v-cbf0874d>Save JSON File</h5><p data-v-cbf0874d>Copy the JSON from the &quot;SmartIR JSON&quot; tab and save it as <code data-v-cbf0874d>10000.json</code> (or your next available number) in the codes directory.</p></div></div><div class="step-item" data-v-cbf0874d><div class="step-number" data-v-cbf0874d>3</div><div class="step-content" data-v-cbf0874d><h5 data-v-cbf0874d>Update Configuration</h5><p data-v-cbf0874d>Copy the YAML from the &quot;YAML Config&quot; tab and add it to your <code data-v-cbf0874d>configuration.yaml</code> file. Update the <code data-v-cbf0874d>device_code</code> to match your JSON filename.</p></div></div><div class="step-item" data-v-cbf0874d><div class="step-number" data-v-cbf0874d>4</div><div class="step-content" data-v-cbf0874d><h5 data-v-cbf0874d>Restart Home Assistant</h5><p data-v-cbf0874d>Restart Home Assistant to load the new configuration. Your climate entity will appear in the UI.</p></div></div><div class="step-item" data-v-cbf0874d><div class="step-number" data-v-cbf0874d>5</div><div class="step-content" data-v-cbf0874d><h5 data-v-cbf0874d>Test Your Device</h5><p data-v-cbf0874d>Go to your climate entity and test different modes, temperatures, and fan speeds to ensure everything works correctly.</p></div></div><div class="tips-section" data-v-cbf0874d><h4 data-v-cbf0874d><i class="mdi mdi-lightbulb" data-v-cbf0874d></i> Tips </h4><ul data-v-cbf0874d><li data-v-cbf0874d>Keep a backup of your JSON file in case you need to modify it</li><li data-v-cbf0874d>Test all commands to ensure they work as expected</li><li data-v-cbf0874d>You can share your profile with the SmartIR community on GitHub</li><li data-v-cbf0874d>If a command doesn&#39;t work, you can re-learn it and update the JSON</li></ul></div>',5))])])):L("",!0)])])}}},Td=$e(xd,[["__scopeId","data-v-cbf0874d"]]),Md={class:"wizard-body"},Rd={key:0,class:"warning-section"},Ld={class:"warning-box"},Ad={class:"instructions"},Ed={class:"code-block"},Od={class:"steps"},Vd={key:0},Pd={class:"help-section"},Ud={key:0,class:"help-content"},jd={class:"help-step"},Fd={key:0,class:"help-step"},Nd={class:"help-step"},Bd={class:"help-step"},qd={class:"checklist"},Hd={class:"checkbox-label"},zd={key:0,class:"checkbox-label"},Jd={class:"wizard-footer"},Wd=["disabled"],Gd={__name:"SmartIRSetupWizard",props:{show:{type:Boolean,default:!1},platform:{type:String,required:!0},warnings:{type:Array,default:()=>[]},configPath:{type:String,default:"/config"}},emits:["close","complete"],setup(o,{emit:c}){const r=o,k=c,b=Se("toast"),s=y(!1),u=y(!1),f=y(!1),_=J(()=>r.warnings.length>0?s.value&&u.value:s.value);function $(){const w=`${r.platform}: !include smartir/${r.platform}.yaml`;navigator.clipboard.writeText(w).then(()=>{var t;(t=b.value)==null||t.success("Include line copied to clipboard!","✅ Copied")}).catch(t=>{var A;console.error("Failed to copy:",t),(A=b.value)==null||A.error("Failed to copy to clipboard","❌ Copy Failed")})}function R(){k("complete")}return(w,t)=>o.show?(l(),n("div",{key:0,class:"modal-overlay",onClick:t[5]||(t[5]=ye(()=>{},["stop"]))},[e("div",{class:"setup-wizard",onClick:t[4]||(t[4]=ye(()=>{},["stop"]))},[t[31]||(t[31]=e("div",{class:"wizard-header"},[e("h2",null,[e("i",{class:"mdi mdi-cog"}),S(" SmartIR Configuration Setup ")])],-1)),e("div",Md,[o.warnings.length>0?(l(),n("div",Rd,[e("div",Ld,[t[11]||(t[11]=e("i",{class:"mdi mdi-alert"},null,-1)),e("div",null,[t[9]||(t[9]=e("h3",null,"⚠️ Configuration Migration Needed",-1)),t[10]||(t[10]=e("p",null,"We detected existing platform entries in your configuration.yaml:",-1)),e("ul",null,[(l(!0),n(ve,null,ke(o.warnings,A=>(l(),n("li",{key:A.platform},[e("strong",null,m(A.platform)+":",1),S(" "+m(A.message),1)]))),128))]),e("p",null,[t[6]||(t[6]=e("strong",null,"Action Required:",-1)),t[7]||(t[7]=S(" Move these entries to ",-1)),e("code",null,"smartir/"+m(o.platform)+".yaml",1),t[8]||(t[8]=S(" before continuing.",-1))])])])])):L("",!0),e("div",Ad,[t[27]||(t[27]=e("h3",null,"📝 One-Time Setup",-1)),t[28]||(t[28]=e("p",null,[S("To enable SmartIR device management, add this line to your "),e("code",null,"configuration.yaml"),S(":")],-1)),e("div",Ed,[e("code",null,m(o.platform)+": !include smartir/"+m(o.platform)+".yaml",1),e("button",{onClick:$,class:"copy-btn",title:"Copy to clipboard"},[...t[12]||(t[12]=[e("i",{class:"mdi mdi-content-copy"},null,-1)])])]),e("div",Od,[t[19]||(t[19]=e("h4",null,"Steps:",-1)),e("ol",null,[o.warnings.length>0?(l(),n("li",Vd,[t[13]||(t[13]=e("strong",null,"Move existing entries:",-1)),t[14]||(t[14]=S(" Copy any existing ",-1)),e("code",null,m(o.platform)+":",1),t[15]||(t[15]=S(" entries from configuration.yaml to ",-1)),e("code",null,"smartir/"+m(o.platform)+".yaml",1)])):L("",!0),t[16]||(t[16]=e("li",null,[e("strong",null,"Add include line:"),S(" Add the line above to your configuration.yaml ")],-1)),t[17]||(t[17]=e("li",null,[e("strong",null,"Save changes:"),S(" Save configuration.yaml ")],-1)),t[18]||(t[18]=e("li",null,[e("strong",null,"Continue here:"),S(` Click "I've Completed Setup" below `)],-1))])]),e("div",Pd,[e("button",{onClick:t[0]||(t[0]=A=>f.value=!f.value),class:"help-toggle"},[e("i",{class:Z(["mdi",f.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2),S(" "+m(f.value?"Hide":"Show")+" Detailed Instructions ",1)]),f.value?(l(),n("div",Ud,[t[26]||(t[26]=e("h4",null,"Detailed Setup Guide:",-1)),e("div",jd,[t[21]||(t[21]=e("h5",null,"1. Open configuration.yaml",-1)),e("p",null,[t[20]||(t[20]=S("Location: ",-1)),e("code",null,m(o.configPath)+"/configuration.yaml",1)])]),o.warnings.length>0?(l(),n("div",Fd,[t[22]||(t[22]=e("h5",null,"2. Migrate Existing Entries (If Any)",-1)),e("p",null,"If you have existing "+m(o.platform)+" entries, cut them from configuration.yaml and paste into:",1),e("p",null,[e("code",null,m(o.configPath)+"/smartir/"+m(o.platform)+".yaml",1)]),t[23]||(t[23]=e("p",{class:"note"},"Broadlink Manager will create this file automatically.",-1))])):L("",!0),e("div",Nd,[e("h5",null,m(o.warnings.length>0?"3":"2")+". Add Include Line",1),t[24]||(t[24]=e("p",null,"Add this to configuration.yaml:",-1)),e("pre",null,m(o.platform)+": !include smartir/"+m(o.platform)+".yaml",1)]),e("div",Bd,[e("h5",null,m(o.warnings.length>0?"4":"3")+". Restart Home Assistant",1),t[25]||(t[25]=e("p",null,"After saving, you'll need to restart HA for changes to take effect.",-1))])])):L("",!0)])]),e("div",qd,[e("label",Hd,[G(e("input",{type:"checkbox","onUpdate:modelValue":t[1]||(t[1]=A=>s.value=A)},null,512),[[ge,s.value]]),t[29]||(t[29]=e("span",null,"I've added the include line to configuration.yaml",-1))]),o.warnings.length>0?(l(),n("label",zd,[G(e("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=A=>u.value=A)},null,512),[[ge,u.value]]),e("span",null,"I've migrated existing "+m(o.platform)+" entries (if any)",1)])):L("",!0)])]),e("div",Jd,[e("button",{onClick:t[3]||(t[3]=A=>w.$emit("close")),class:"btn-secondary"}," Cancel "),e("button",{onClick:R,class:"btn-primary",disabled:!_.value},[...t[30]||(t[30]=[e("i",{class:"mdi mdi-check"},null,-1),S(" I've Completed Setup ",-1)])],8,Wd)])])])):L("",!0)}},Kd=$e(Gd,[["__scopeId","data-v-f6fe4c03"]]),Xd={class:"modal-header"},Yd={class:"progress-steps"},Zd={class:"step-number"},Qd={key:0,class:"mdi mdi-check"},eu={key:1},tu={class:"step-label"},ou={class:"modal-body"},lu={key:0,class:"step-content"},nu={class:"form-group"},su={class:"form-group"},au={class:"form-group"},iu={key:1,class:"step-content"},ru={key:1,class:"platform-form"},du={class:"form-section"},uu={class:"checkbox-grid"},cu={class:"checkbox-item"},mu={class:"checkbox-item"},vu={class:"checkbox-item"},pu={class:"checkbox-item"},fu={class:"checkbox-item"},gu={key:2,class:"platform-form"},yu={class:"form-section"},bu={class:"form-group"},hu={class:"form-section"},ku={class:"checkbox-grid"},wu={class:"checkbox-item"},$u={class:"checkbox-item"},Cu={key:3,class:"platform-form"},_u={class:"form-section"},Su={class:"checkbox-grid"},Iu={class:"checkbox-item"},Du={class:"checkbox-item"},xu={class:"checkbox-item"},Tu={class:"checkbox-item"},Mu={key:2,class:"step-content"},Ru={key:3,class:"step-content"},Lu={class:"modal-footer"},Au=["disabled"],Eu={key:2,class:"save-buttons"},Ou=["disabled"],Vu=["disabled"],Pu={__name:"SmartIRProfileBuilder",props:{show:{type:Boolean,default:!1},editMode:{type:Boolean,default:!1},editData:{type:Object,default:null},startStep:{type:Number,default:0}},emits:["close","save"],setup(o,{emit:c}){const r=o,k=c,b=Se("toast"),s=y(0),u=y(!1),f=y([]),_=y(!1),$=y([]),R=y("/config"),w=y(!1),t=y(null),A=y(!1),q=y(!1),U=y(""),M=y("ir"),a=y(!1),h=[{label:"Device Info",key:"info"},{label:"Configuration",key:"config"},{label:"Learn Commands",key:"commands"},{label:"Preview & Save",key:"preview"}],v=y({platform:"",manufacturer:"",model:"",broadlinkDevice:"",commandType:"ir",config:{},commands:{}}),I=y(["turn_on"]),X=y(3),Q=y([]),te=y(["turn_on"]);ue(()=>v.value.platform,E=>{E==="media_player"?v.value.config={features:I.value}:E==="fan"?v.value.config={speedLevels:X.value,features:Q.value}:E==="light"&&(v.value.config={features:te.value})}),ue(I,E=>{v.value.platform==="media_player"&&(v.value.config={features:E})},{deep:!0}),ue(X,E=>{v.value.platform==="fan"&&(v.value.config={speedLevels:E,features:Q.value})}),ue(Q,E=>{v.value.platform==="fan"&&(v.value.config={speedLevels:X.value,features:E})},{deep:!0}),ue(te,E=>{v.value.platform==="light"&&(v.value.config={features:E})},{deep:!0});function de(E){const i=new Set,N=Object.keys(E);return N.some(j=>j==="off"||j.includes("_off"))&&i.add("off"),N.some(j=>j.includes("auto"))&&i.add("auto"),N.some(j=>j.includes("cool"))&&i.add("cool"),N.some(j=>j.includes("heat"))&&i.add("heat"),N.some(j=>j.includes("dry"))&&i.add("dry"),N.some(j=>j.includes("fan_only"))&&i.add("fan_only"),Array.from(i)}function O(E){const i=new Set,N=Object.keys(E);return N.some(j=>j.includes("auto"))&&i.add("auto"),N.some(j=>j.includes("low"))&&i.add("low"),N.some(j=>j.includes("medium")||j.includes("mid"))&&i.add("medium"),N.some(j=>j.includes("high"))&&i.add("high"),Array.from(i)}function F(E){const i=new Set,N=Object.keys(E);return N.some(j=>j.includes("swing_off")||j.includes("_off"))&&i.add("off"),N.some(j=>j.includes("vertical"))&&i.add("vertical"),N.some(j=>j.includes("horizontal"))&&i.add("horizontal"),N.some(j=>j.includes("both"))&&i.add("both"),Array.from(i)}function ee(E){for(const i of Object.values(E))if(typeof i=="string"&&i.startsWith("sc")||Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0].startsWith("sc"))return"rf";return"ir"}ue(()=>v.value.commandType,(E,i)=>{!i||A.value||a.value||(Object.keys(v.value.commands).length>0&&E!==i?(U.value=E,v.value.commandType=i,A.value=!0):E!==i&&(M.value=E))}),ue(()=>r.editData,async E=>{var i,N,j;if(E&&r.editMode){console.log("🔧 Edit mode activated, loading profile data:",E),a.value=!0,f.value.length===0&&(console.log("📡 Loading Broadlink devices..."),await ce(),console.log("📡 Devices loaded:",f.value.length));const ae=E.profile,we=ae.controller_data;console.log("🎮 Controller data from profile:",we),console.log("🎮 Available devices:",f.value.map(H=>H.entity_id));const D=ae.commands||{},T=ae.commandType||ee(D);console.log("🔍 Command type (stored):",ae.commandType),console.log("🔍 Command type (final):",T);let P={};if(E.platform==="climate"){const H=ae.operationModes||de(D),ne=ae.fanModes||O(D),re=ae.swingModes||F(D);console.log("🔍 Inferred modes:",H),console.log("🔍 Inferred fan modes:",ne),console.log("🔍 Inferred swing modes:",re),P={minTemp:ae.minTemperature,maxTemp:ae.maxTemperature,precision:ae.precision,modes:H,fanModes:ne,swingModes:re}}else if(E.platform==="media_player"){const H=[];(D.on||D.off)&&H.push("turn_on"),(D.volumeUp||D.volumeDown)&&H.push("volume"),D.mute&&H.push("mute"),D.sources&&H.push("source"),(D.channelUp||D.channelDown)&&H.push("channel"),P={features:H},I.value=H,console.log("🔍 Inferred media player features:",H)}else if(E.platform==="fan"){const H=((i=ae.speed)==null?void 0:i.length)||Object.keys(D.default||{}).length||3,ne=[];(D.oscillate_on||D.oscillate_off)&&ne.push("oscillate"),(D.direction_forward||D.direction_reverse)&&ne.push("direction"),P={speedLevels:H,features:ne},X.value=H,Q.value=ne,console.log("🔍 Inferred fan config:",P)}else if(E.platform==="light"){const H=[];P={features:H},te.value=H,console.log("🔍 Inferred light features:",H)}const B=await C(ae.manufacturer,(N=ae.supportedModels)==null?void 0:N[0],D);v.value={platform:E.platform,manufacturer:ae.manufacturer||"",model:((j=ae.supportedModels)==null?void 0:j[0])||"",broadlinkDevice:we||"",commandType:T,config:P,commands:B},console.log("✅ Profile populated:",v.value),console.log("✅ Selected device:",v.value.broadlinkDevice),console.log("✅ Command type:",v.value.commandType),console.log("✅ Commands (with learned codes):",B),M.value=T,setTimeout(()=>{a.value=!1},100)}},{immediate:!0});const me=J(()=>{var E;switch(s.value){case 0:return v.value.platform&&v.value.manufacturer&&v.value.model;case 1:return v.value.platform==="climate"?v.value.config.minTemp&&v.value.config.maxTemp&&((E=v.value.config.modes)==null?void 0:E.length)>0:!0;case 2:return v.value.broadlinkDevice&&v.value.commandType&&Object.keys(v.value.commands).length>0;case 3:return!0;default:return!1}}),pe=y(null);async function De(){if(s.value!==3){pe.value=null;return}if(console.log("🔍 Generating JSON with commands:",v.value.commands),Object.values(v.value.commands).some(i=>typeof i=="string"?i==="pending":typeof i=="object"?Object.values(i).some(N=>typeof N=="string"?N==="pending":typeof N=="object"?Object.values(N).some(j=>j==="pending"):!1):!1)){console.warn('⚠️ Commands still contain "pending" placeholders!'),console.log("📦 Attempting to fetch from Broadlink storage...");const i=await C(v.value.manufacturer,v.value.model,v.value.commands);v.value.commands=i,console.log("✅ Updated commands:",i)}pe.value=ie(v.value),console.log("📄 Generated JSON:",pe.value)}const xe=J(()=>s.value!==3?null:Y(v.value));function Me(){v.value.config={},v.value.commands={}}function x(){A.value=!1,v.value.commandType=U.value,M.value=U.value,v.value.commands={},U.value=""}function d(){A.value=!1,U.value=""}async function V(){s.value<h.length-1&&(s.value++,s.value===3&&await De())}function fe(){s.value>0&&s.value--}function K(){A.value||(q.value=!0)}function g(){q.value=!1,p()}function p(){k("close"),setTimeout(()=>{s.value=0,v.value={platform:"",manufacturer:"",model:"",broadlinkDevice:"",commandType:"ir",config:{},commands:{}},M.value="ir"},300)}async function W(){var E,i,N,j,ae,we;u.value=!0;try{if(!w.value){const ne=(await oe.get("/api/smartir/config/check")).data;if(ne&&!((E=ne.platforms[v.value.platform])==null?void 0:E.file_exists)){$.value=ne.configuration_warnings||[],R.value=ne.config_path||"/config",t.value={platform:v.value.platform,json:pe.value},_.value=!0,u.value=!1;return}}let D;r.editMode&&((i=r.editData)!=null&&i.code)?(D=parseInt(r.editData.code),console.log("📝 Edit mode: Using existing code",D)):(D=(await oe.get(`/api/smartir/platforms/${v.value.platform}/next-code`)).data.next_code,console.log("✨ New profile: Using next code",D));const P=(await oe.post("/api/smartir/profiles",{platform:v.value.platform,json:pe.value,code_number:D})).data,B={platform:"smartir",name:`${v.value.manufacturer} ${v.value.model}`,unique_id:`${v.value.manufacturer.toLowerCase().replace(/[^a-z0-9]+/g,"_")}_${v.value.model.toLowerCase().replace(/[^a-z0-9]+/g,"_")}`,device_code:D,controller_data:v.value.broadlinkDevice};try{await oe.post("/api/smartir/config/add-device",{platform:v.value.platform,device_config:{platform:"smartir",name:B.name,unique_id:B.unique_id,device_code:B.device_code,controller_data:B.controller_data}})}catch(H){console.error("Failed to add device to config:",H);const ne=((N=H.response)==null?void 0:N.data)||{};let re=ne.error||"Unknown error";ne.validation_errors&&ne.validation_errors.length>0&&(re=`Device configuration validation failed:
`+ne.validation_errors.map(se=>`  • ${se}`).join(`
`)),(j=b.value)==null||j.warning(`Profile saved but failed to add to config file:
${re}`,"⚠️ Partial Success")}k("save",{json:pe.value,yaml:xe.value,profile:v.value,saved_to:P.path}),(ae=b.value)==null||ae.success(`File: ${P.filename}
Device Code: ${D}
Added to: smartir/${v.value.platform}.yaml

⚠️ Restart Home Assistant to activate`,"✅ Profile Saved Successfully!"),p()}catch(D){console.error("Error saving profile:",D),(we=b.value)==null||we.error(D.message,"❌ Error Saving Profile")}finally{u.value=!1}}async function le(){w.value=!0,_.value=!1,t.value&&(await W(),t.value=null)}function z(){var E,i;try{const N=JSON.stringify(pe.value,null,2),j=new Blob([N],{type:"application/json"}),ae=URL.createObjectURL(j),we=document.createElement("a");we.href=ae;const D=v.value.manufacturer.toLowerCase().replace(/\s+/g,"_"),T=v.value.model.toLowerCase().replace(/\s+/g,"_");we.download=`smartir_${v.value.platform}_${D}_${T}.json`,document.body.appendChild(we),we.click(),document.body.removeChild(we),URL.revokeObjectURL(ae),(E=b.value)==null||E.success("You can manually upload this file to your SmartIR codes directory.","✅ Profile Downloaded")}catch(N){console.error("Error downloading profile:",N),(i=b.value)==null||i.error(N.message,"❌ Error Downloading Profile")}}async function C(E,i,N){const j=E.toLowerCase().replace(/[^a-z0-9]+/g,"_"),ae=i.toLowerCase().replace(/[^a-z0-9]+/g,"_"),we=`${j}_${ae}`;try{const P=(await oe.get("/api/commands/all")).data[we]||{};console.log(`🔍 Fetching learned commands for device: ${we}`),console.log("📦 Device commands from storage:",P);const B={...N};for(const[H,ne]of Object.entries(B))if(ne==="pending"&&P[H])B[H]=P[H];else if(typeof ne=="object"){for(const[re,se]of Object.entries(ne))if(typeof se=="object")for(const[he,Re]of Object.entries(se)){const Oe=`${H}_${re}_${he}`;Re==="pending"&&P[Oe]&&(B[H][re][he]=P[Oe])}else if(se==="pending"){const he=`${H}_${re}`;P[he]&&(B[H][re]=P[he])}}return console.log("✅ Merged commands:",B),B}catch(D){return console.error("Error fetching learned commands:",D),N}}function ie(E){const i={manufacturer:E.manufacturer,supportedModels:[E.model],supportedController:"Broadlink",commandsEncoding:"Base64",commandType:E.commandType||"ir",commands:{}};return E.platform==="climate"&&(i.minTemperature=E.config.minTemp,i.maxTemperature=E.config.maxTemp,i.precision=E.config.precision||1,i.operationModes=E.config.modes||[],i.fanModes=E.config.fanModes&&E.config.fanModes.length>0?E.config.fanModes:["auto"],E.config.swingModes&&E.config.swingModes.length>0&&(i.swingModes=E.config.swingModes),i.commands=E.commands),i}function Y(E){let i=`# SmartIR ${E.platform} configuration
`;return i+=`# Generated by Broadlink Manager v2

`,E.platform==="climate"&&(i+=`climate:
`,i+=`  - platform: smartir
`,i+=`    name: ${E.manufacturer} ${E.model}
`,i+=`    unique_id: ${E.manufacturer.toLowerCase()}_${E.model.toLowerCase().replace(/\s+/g,"_")}
`,i+=`    device_code: 10000  # Change this to your custom code number
`,i+=`    controller_data: ${E.broadlinkDevice}
`,E.config.tempSensor&&(i+=`    temperature_sensor: ${E.config.tempSensor}
`),E.config.humiditySensor&&(i+=`    humidity_sensor: ${E.config.humiditySensor}
`),E.config.powerSensor&&(i+=`    power_sensor: ${E.config.powerSensor}
`)),i}async function ce(){try{console.log("Fetching remote devices from /api/remote/devices...");const E=await oe.get("/api/remote/devices");console.log("Loaded remote devices response:",E.data);const i=E.data.devices||[];console.log("Extracted devices array:",i),console.log("Device count:",i.length),f.value=i,console.log("broadlinkDevices.value set to:",f.value),console.log("Final device count:",f.value.length)}catch(E){console.error("Error loading remote devices:",E),f.value=[]}}return ue(()=>r.show,E=>{if(E){const i=Number.isInteger(r.startStep)?r.startStep:0;s.value=Math.min(Math.max(i,0),h.length-1)}}),ue(()=>r.startStep,E=>{if(r.show){const i=Number.isInteger(E)?E:0;s.value=Math.min(Math.max(i,0),h.length-1)}}),Te(()=>{r.show&&ce()}),(E,i)=>o.show?(l(),n("div",{key:0,class:"modal-overlay",onClick:K},[e("div",{class:"modal-container",onClick:i[19]||(i[19]=ye(()=>{},["stop"]))},[e("div",Xd,[e("h2",null,[i[22]||(i[22]=e("i",{class:"mdi mdi-file-document-edit"},null,-1)),S(" "+m(o.editMode?"Edit SmartIR Profile":"Create SmartIR Profile"),1)]),e("button",{onClick:p,class:"close-button"},[...i[23]||(i[23]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Yd,[(l(),n(ve,null,ke(h,(N,j)=>e("div",{key:j,class:Z(["step",{active:s.value===j,completed:s.value>j}])},[e("div",Zd,[s.value>j?(l(),n("i",Qd)):(l(),n("span",eu,m(j+1),1))]),e("span",tu,m(N.label),1)],2)),64))]),e("div",ou,[s.value===0?(l(),n("div",lu,[i[29]||(i[29]=e("h3",null,"Device Information",-1)),e("div",nu,[i[25]||(i[25]=e("label",null,"Platform Type *",-1)),G(e("select",{"onUpdate:modelValue":i[0]||(i[0]=N=>v.value.platform=N),onChange:Me},[...i[24]||(i[24]=[Ee('<option value="" data-v-c6cdbf90>Select platform...</option><option value="climate" data-v-c6cdbf90>🌡️ Climate (AC, Heater, Heat Pump)</option><option value="media_player" data-v-c6cdbf90>📺 Media Player (TV, Receiver)</option><option value="fan" data-v-c6cdbf90>🌀 Fan</option><option value="light" data-v-c6cdbf90>💡 Light (LED Strip, IR Light)</option>',5)])],544),[[Ce,v.value.platform]])]),e("div",su,[i[26]||(i[26]=e("label",null,"Manufacturer *",-1)),G(e("input",{"onUpdate:modelValue":i[1]||(i[1]=N=>v.value.manufacturer=N),type:"text",placeholder:"e.g., Daikin, LG, Samsung"},null,512),[[Ie,v.value.manufacturer]])]),e("div",au,[i[27]||(i[27]=e("label",null,"Model(s) *",-1)),G(e("input",{"onUpdate:modelValue":i[2]||(i[2]=N=>v.value.model=N),type:"text",placeholder:"e.g., FTXS35K, Multiple models"},null,512),[[Ie,v.value.model]]),i[28]||(i[28]=e("small",null,'Enter model number or "Multiple" if it works with many models',-1))])])):L("",!0),s.value===1?(l(),n("div",iu,[v.value.platform==="climate"?(l(),Le(Sr,{key:0,modelValue:v.value.config,"onUpdate:modelValue":i[3]||(i[3]=N=>v.value.config=N)},null,8,["modelValue"])):v.value.platform==="media_player"?(l(),n("div",ru,[i[36]||(i[36]=e("h3",null,"Media Player Configuration",-1)),i[37]||(i[37]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),S(" Configure the features your media player supports. You'll learn the IR commands in the next step. ")],-1)),e("div",du,[i[35]||(i[35]=e("h4",null,"Supported Features",-1)),e("div",uu,[e("label",cu,[G(e("input",{type:"checkbox",value:"turn_on","onUpdate:modelValue":i[4]||(i[4]=N=>I.value=N)},null,512),[[ge,I.value]]),i[30]||(i[30]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),S(" Power On/Off ")],-1))]),e("label",mu,[G(e("input",{type:"checkbox",value:"volume","onUpdate:modelValue":i[5]||(i[5]=N=>I.value=N)},null,512),[[ge,I.value]]),i[31]||(i[31]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-volume-high"}),S(" Volume Control ")],-1))]),e("label",vu,[G(e("input",{type:"checkbox",value:"mute","onUpdate:modelValue":i[6]||(i[6]=N=>I.value=N)},null,512),[[ge,I.value]]),i[32]||(i[32]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-volume-mute"}),S(" Mute ")],-1))]),e("label",pu,[G(e("input",{type:"checkbox",value:"source","onUpdate:modelValue":i[7]||(i[7]=N=>I.value=N)},null,512),[[ge,I.value]]),i[33]||(i[33]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-import"}),S(" Source Selection ")],-1))]),e("label",fu,[G(e("input",{type:"checkbox",value:"channel","onUpdate:modelValue":i[8]||(i[8]=N=>I.value=N)},null,512),[[ge,I.value]]),i[34]||(i[34]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-numeric"}),S(" Channel Control ")],-1))])])])])):v.value.platform==="fan"?(l(),n("div",gu,[i[44]||(i[44]=e("h3",null,"Fan Configuration",-1)),i[45]||(i[45]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),S(" Configure the features your fan supports. You'll learn the IR commands in the next step. ")],-1)),e("div",yu,[i[40]||(i[40]=e("h4",null,"Fan Speed Levels",-1)),e("div",bu,[i[39]||(i[39]=e("label",null,"Number of Speed Levels *",-1)),G(e("select",{"onUpdate:modelValue":i[9]||(i[9]=N=>X.value=N)},[...i[38]||(i[38]=[e("option",{value:1},"1 Speed",-1),e("option",{value:2},"2 Speeds",-1),e("option",{value:3},"3 Speeds (Low/Med/High)",-1),e("option",{value:4},"4 Speeds",-1),e("option",{value:5},"5 Speeds",-1),e("option",{value:6},"6 Speeds",-1)])],512),[[Ce,X.value,void 0,{number:!0}]])])]),e("div",hu,[i[43]||(i[43]=e("h4",null,"Additional Features",-1)),e("div",ku,[e("label",wu,[G(e("input",{type:"checkbox",value:"oscillate","onUpdate:modelValue":i[10]||(i[10]=N=>Q.value=N)},null,512),[[ge,Q.value]]),i[41]||(i[41]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-sync"}),S(" Oscillation ")],-1))]),e("label",$u,[G(e("input",{type:"checkbox",value:"direction","onUpdate:modelValue":i[11]||(i[11]=N=>Q.value=N)},null,512),[[ge,Q.value]]),i[42]||(i[42]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-rotate-3d-variant"}),S(" Direction (Forward/Reverse) ")],-1))])])])])):v.value.platform==="light"?(l(),n("div",Cu,[i[51]||(i[51]=e("h3",null,"Light Configuration",-1)),i[52]||(i[52]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),S(" Configure the features your light supports. You'll learn the IR commands in the next step. ")],-1)),e("div",_u,[i[50]||(i[50]=e("h4",null,"Supported Features",-1)),e("div",Su,[e("label",Iu,[G(e("input",{type:"checkbox",value:"turn_on","onUpdate:modelValue":i[12]||(i[12]=N=>te.value=N)},null,512),[[ge,te.value]]),i[46]||(i[46]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),S(" Power On/Off ")],-1))]),e("label",Du,[G(e("input",{type:"checkbox",value:"brightness","onUpdate:modelValue":i[13]||(i[13]=N=>te.value=N)},null,512),[[ge,te.value]]),i[47]||(i[47]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-brightness-6"}),S(" Brightness Control ")],-1))]),e("label",xu,[G(e("input",{type:"checkbox",value:"color_temp","onUpdate:modelValue":i[14]||(i[14]=N=>te.value=N)},null,512),[[ge,te.value]]),i[48]||(i[48]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-thermometer"}),S(" Color Temperature ")],-1))]),e("label",Tu,[G(e("input",{type:"checkbox",value:"rgb","onUpdate:modelValue":i[15]||(i[15]=N=>te.value=N)},null,512),[[ge,te.value]]),i[49]||(i[49]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-palette"}),S(" RGB Color ")],-1))])])])])):L("",!0)])):L("",!0),s.value===2?(l(),n("div",Mu,[be(nd,{modelValue:v.value.commands,"onUpdate:modelValue":i[16]||(i[16]=N=>v.value.commands=N),platform:v.value.platform,config:v.value.config,broadlinkDevice:v.value.broadlinkDevice,"onUpdate:broadlinkDevice":i[17]||(i[17]=N=>v.value.broadlinkDevice=N),manufacturer:v.value.manufacturer,model:v.value.model,commandType:v.value.commandType,"onUpdate:commandType":i[18]||(i[18]=N=>v.value.commandType=N)},null,8,["modelValue","platform","config","broadlinkDevice","manufacturer","model","commandType"])])):L("",!0),s.value===3?(l(),n("div",Ru,[be(Td,{profile:v.value,"json-data":pe.value,"yaml-config":xe.value},null,8,["profile","json-data","yaml-config"])])):L("",!0)]),e("div",Lu,[s.value>0?(l(),n("button",{key:0,onClick:fe,class:"btn-secondary"},[...i[53]||(i[53]=[e("i",{class:"mdi mdi-arrow-left"},null,-1),S(" Back ",-1)])])):L("",!0),i[57]||(i[57]=e("div",{class:"spacer"},null,-1)),e("button",{onClick:p,class:"btn-text"}," Cancel "),s.value<h.length-1?(l(),n("button",{key:1,onClick:V,class:"btn-primary",disabled:!me.value},[...i[54]||(i[54]=[S(" Next ",-1),e("i",{class:"mdi mdi-arrow-right"},null,-1)])],8,Au)):(l(),n("div",Eu,[e("button",{onClick:W,class:"btn-primary",disabled:u.value},[i[55]||(i[55]=e("i",{class:"mdi mdi-cloud-upload"},null,-1)),S(" "+m(u.value?"Saving...":"Save to SmartIR"),1)],8,Ou),e("button",{onClick:z,class:"btn-secondary",disabled:u.value},[...i[56]||(i[56]=[e("i",{class:"mdi mdi-download"},null,-1),S(" Download JSON ",-1)])],8,Vu)]))])]),be(Kd,{show:_.value,platform:v.value.platform,warnings:$.value,"config-path":R.value,onClose:i[20]||(i[20]=N=>_.value=!1),onComplete:le},null,8,["show","platform","warnings","config-path"]),be(Ae,{isOpen:A.value,title:"Change Command Type?",message:"Changing the command type will clear all learned commands. Continue?",confirmText:"Continue",cancelText:"Cancel",dangerMode:!0,onConfirm:x,onCancel:d},null,8,["isOpen"]),be(Ae,{isOpen:q.value,title:"Close Profile Builder?",message:"Are you sure you want to close? Your progress will be lost.",confirmText:"Close",cancelText:"Keep Editing",dangerMode:!0,onConfirm:g,onCancel:i[21]||(i[21]=N=>q.value=!1)},null,8,["isOpen"])])):L("",!0)}},Uu=$e(Pu,[["__scopeId","data-v-c6cdbf90"]]),ju={class:"dashboard"},Fu={__name:"Dashboard",setup(o){const c=Pe(),r=Se("smartirEnabled");ze();const k=y(!1),b=y(!1),s=y(null),u=y(0),f=y(null);function _(){b.value=!1,s.value=null,u.value=0,k.value=!0}async function $({platform:t,profile:A,startStep:q}){u.value=Number.isInteger(q)?q:0;try{const U=await fetch(`api/smartir/platforms/${t}/profiles/${A.code}`);if(!U.ok)throw new Error("Failed to load profile");const M=await U.json();let a="";try{const h=await fetch(`api/smartir/config/get-device?platform=${t}&code=${A.code}`);h.ok?(a=(await h.json()).controller_data||"",console.log("✅ Found controller_data from YAML:",a)):console.warn("⚠️ No YAML entry found for this profile (this is OK for profiles not yet added to config)")}catch(h){console.warn("⚠️ Could not fetch controller_data from config:",h)}b.value=!0,s.value={platform:t,code:A.code,profile:{...M.profile,controller_data:a}},k.value=!0}catch(U){console.error("Error loading profile for edit:",U),c.error("Failed to load profile for editing")}}function R(){k.value=!1,b.value=!1,s.value=null}async function w(t){console.log("Profile saved:",t),R(),f.value&&f.value.loadAllProfiles&&(await f.value.loadAllProfiles(),console.log("✅ Profiles list refreshed"))}return(t,A)=>(l(),n("div",ju,[_e(r)?(l(),Le(Ps,{key:0})):L("",!0),A[0]||(A[0]=Ee('<div class="welcome-banner" data-v-c3efa930><div class="banner-content" data-v-c3efa930><div class="banner-icon" data-v-c3efa930><i class="mdi mdi-rocket-launch" data-v-c3efa930></i></div><div class="banner-text" data-v-c3efa930><h2 data-v-c3efa930>Welcome to Broadlink Manager v2!</h2><p data-v-c3efa930>Manage your IR/RF devices with a modern Vue 3 interface</p></div></div><div class="status-badges" data-v-c3efa930><span class="badge success" data-v-c3efa930><i class="mdi mdi-check-circle" data-v-c3efa930></i> Vue 3 Ready </span><span class="badge warning" data-v-c3efa930><i class="mdi mdi-beta" data-v-c3efa930></i> Beta </span></div></div>',1)),be(Rs),_e(r)?(l(),Le(Ti,{key:1,ref_key:"smartirStatusCard",ref:f,onCreateProfile:_,onEditProfile:$},null,512)):L("",!0),be(Uu,{show:k.value,editMode:b.value,editData:s.value,startStep:u.value,onClose:R,onSave:w},null,8,["show","editMode","editData","startStep"])]))}},Nu=$e(Fu,[["__scopeId","data-v-c3efa930"]]),Bu={class:"toast-container"},qu={class:"toast-content"},Hu={key:0,class:"toast-title"},zu={class:"toast-message"},Ju={key:1,class:"toast-description"},Wu=["onClick","title"],Gu={__name:"Toast",setup(o,{expose:c}){const r=y([]);let k=0;function b(f){const _={success:"mdi-check-circle",error:"mdi-alert-circle",warning:"mdi-alert",info:"mdi-information"};return _[f]||_.info}function s({message:f,title:_,description:$,type:R="info",duration:w=5e3}){const t=k++,A={id:t,message:f,title:_,description:$,type:R};return r.value.push(A),w>0&&setTimeout(()=>{u(t)},w),t}function u(f){const _=r.value.findIndex($=>$.id===f);_>-1&&r.value.splice(_,1)}return c({addToast:s,removeToast:u,show:s,success:(f,_)=>s({message:f,title:_,type:"success"}),error:(f,_)=>s({message:f,title:_,type:"error",duration:0}),warning:(f,_)=>s({message:f,title:_,type:"warning",duration:0}),info:(f,_)=>s({message:f,title:_,type:"info"})}),(f,_)=>(l(),Le(Ye,{to:"body"},[e("div",Bu,[be(st,{name:"toast"},{default:He(()=>[(l(!0),n(ve,null,ke(r.value,$=>(l(),n("div",{key:$.id,class:Z(["toast",[`toast-${$.type}`,{"toast-persistent":$.type==="error"||$.type==="warning"}]])},[e("i",{class:Z(["mdi",b($.type)])},null,2),e("div",qu,[$.title?(l(),n("div",Hu,m($.title),1)):L("",!0),e("div",zu,m($.message),1),$.description?(l(),n("div",Ju,m($.description),1)):L("",!0)]),e("button",{onClick:R=>u($.id),class:Z(["toast-close",{"toast-close-prominent":$.type==="error"||$.type==="warning"}]),title:$.type==="error"||$.type==="warning"?"Click to dismiss":"Close"},[..._[0]||(_[0]=[e("i",{class:"mdi mdi-close"},null,-1)])],10,Wu)],2))),128))]),_:1})])]))}},Ku=$e(Gu,[["__scopeId","data-v-3948c088"]]),Xu="0.3.0-alpha.1",Yu={version:Xu},Zu={id:"app",class:"app-container"},Qu={class:"app-header"},ec={class:"header-content"},tc={class:"header-right"},oc=["title"],lc={class:"settings-menu-container"},nc={key:0,class:"settings-menu"},sc=["title"],ac={class:"toggle-content"},ic={key:0,class:"not-installed-label"},rc={key:0,href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"menu-item menu-link menu-subitem"},dc=["disabled"],uc=["disabled"],cc=["disabled"],mc={class:"app-main"},vc={class:"app-footer"},pc={__name:"App",setup(o){const c=y(null),r=Yu.version,k=y("light"),b=y(null),s=y(!1),u=y(!1),f=y(!1),_=y(localStorage.getItem("smartir_enabled")!=="false"),$=J(()=>{var v;return((v=b.value)==null?void 0:v.installed)||!1}),R=J(()=>({light:"mdi mdi-weather-sunny",medium:"mdi mdi-weather-partly-cloudy",dark:"mdi mdi-weather-night"})[k.value]),w=J(()=>({light:"Switch to Medium Theme",medium:"Switch to Dark Theme",dark:"Switch to Light Theme"})[k.value]),t=()=>{const v=["light","medium","dark"],X=(v.indexOf(k.value)+1)%v.length;k.value=v[X],document.body.classList.remove("medium-mode","dark-mode"),k.value==="medium"?document.body.classList.add("medium-mode"):k.value==="dark"&&document.body.classList.add("dark-mode"),localStorage.setItem("theme",k.value)},A=async()=>{try{const v=await et.getStatus();b.value=v,v.installed?console.log("✅ SmartIR detected:",v.version):console.log("ℹ️ SmartIR not detected")}catch(v){console.error("Error checking SmartIR:",v),b.value={installed:!1,error:v.message}}},q=async()=>{var v,I,X;u.value=!0;try{const te=(await oe.get("/api/diagnostics/markdown")).data.markdown;if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(te),(v=c.value)==null||v.success("Diagnostic summary copied to clipboard!");else{const de=document.createElement("textarea");de.value=te,de.style.position="fixed",de.style.left="-999999px",de.style.top="-999999px",document.body.appendChild(de),de.focus(),de.select();try{if(document.execCommand("copy"))(I=c.value)==null||I.success("Diagnostic summary copied to clipboard!");else throw new Error("execCommand failed")}finally{document.body.removeChild(de)}}s.value=!1}catch(Q){console.error("Error copying diagnostics:",Q),(X=c.value)==null||X.error("Failed to copy diagnostics: "+Q.message)}finally{u.value=!1}},U=async()=>{var v,I;u.value=!0;try{const X=await oe.get("/api/diagnostics/download",{responseType:"blob"}),Q=window.URL.createObjectURL(new Blob([X.data])),te=document.createElement("a");te.href=Q;const de=X.headers["content-disposition"];let O="broadlink_manager_diagnostics.zip";if(de){const F=de.match(/filename="?(.+)"?/);F&&(O=F[1])}te.setAttribute("download",O),document.body.appendChild(te),te.click(),te.remove(),window.URL.revokeObjectURL(Q),(v=c.value)==null||v.success("Diagnostic bundle downloaded!"),s.value=!1}catch(X){console.error("Error downloading diagnostics:",X),(I=c.value)==null||I.error("Failed to download diagnostics")}finally{u.value=!1}},M=()=>{$.value&&(_.value=!_.value,localStorage.setItem("smartir_enabled",_.value.toString()),window.location.reload())},a=async()=>{var v,I,X;f.value=!0;try{const Q=await oe.post("/api/smartir/refresh-index");Q.data.success?(v=c.value)==null||v.success(`Updated to v${Q.data.version} (${Q.data.total_devices} devices)`,"✅ Index Updated"):(I=c.value)==null||I.error(Q.data.error||"Unknown error","❌ Update Failed")}catch(Q){console.error("Error updating SmartIR index:",Q),(X=c.value)==null||X.error("Failed to update device index","❌ Update Error")}finally{f.value=!1,s.value=!1}},h=v=>{v.target.closest(".settings-menu-container")||(s.value=!1)};return Te(async()=>{const v=localStorage.getItem("theme");v&&["light","medium","dark"].includes(v)?(k.value=v,v==="medium"?document.body.classList.add("medium-mode"):v==="dark"&&document.body.classList.add("dark-mode")):localStorage.getItem("darkMode")==="true"&&(k.value="dark",document.body.classList.add("dark-mode"),localStorage.setItem("theme","dark")),await A();const I=Ge();I&&c.value&&(I.appContext.config.globalProperties.$toast=c.value),document.addEventListener("click",h)}),qe(()=>{document.removeEventListener("click",h)}),je("smartirStatus",b),je("smartirEnabled",_),je("refreshSmartIR",A),je("toast",c),(v,I)=>(l(),n("div",Zu,[e("header",Qu,[e("div",ec,[I[13]||(I[13]=e("div",{class:"header-left"},[e("i",{class:"mdi mdi-remote"}),e("h1",null,"Broadlink Manager v2"),e("span",{class:"beta-badge"},"BETA")],-1)),e("div",tc,[e("button",{onClick:t,class:"icon-button",title:w.value},[e("i",{class:Z(R.value)},null,2)],8,oc),e("div",lc,[e("button",{onClick:I[0]||(I[0]=X=>s.value=!s.value),class:"icon-button",title:"Settings"},[...I[2]||(I[2]=[e("i",{class:"mdi mdi-cog"},null,-1)])]),s.value?(l(),n("div",nc,[I[9]||(I[9]=e("div",{class:"menu-section-title"},"Integration Settings",-1)),e("div",{class:Z(["menu-item toggle-item",{disabled:!$.value}]),onClick:I[1]||(I[1]=X=>$.value?M():null),title:$.value?"":"SmartIR is not installed"},[e("div",ac,[I[3]||(I[3]=e("i",{class:"mdi mdi-air-conditioner"},null,-1)),I[4]||(I[4]=e("span",null,"SmartIR Integration",-1)),$.value?L("",!0):(l(),n("span",ic,"(Not Installed)"))]),e("div",{class:Z(["toggle-switch",{active:_.value&&$.value,disabled:!$.value}])},[...I[5]||(I[5]=[e("div",{class:"toggle-slider"},null,-1)])],2)],10,sc),_.value?(l(),n("a",rc,[...I[6]||(I[6]=[e("i",{class:"mdi mdi-github"},null,-1),e("span",null,"SmartIR on GitHub",-1)])])):L("",!0),_.value?(l(),n("button",{key:1,onClick:a,class:"menu-item menu-subitem",disabled:f.value},[e("i",{class:Z(["mdi",f.value?"mdi-loading mdi-spin":"mdi-refresh"])},null,2),e("span",null,m(f.value?"Updating...":"Update Device Index"),1)],8,dc)):L("",!0),I[10]||(I[10]=e("div",{class:"menu-divider"},null,-1)),I[11]||(I[11]=e("div",{class:"menu-section-title"},"Diagnostics",-1)),e("button",{onClick:q,class:"menu-item",disabled:u.value},[...I[7]||(I[7]=[e("i",{class:"mdi mdi-content-copy"},null,-1),e("span",null,"Copy Diagnostics",-1)])],8,uc),e("button",{onClick:U,class:"menu-item",disabled:u.value},[...I[8]||(I[8]=[e("i",{class:"mdi mdi-download"},null,-1),e("span",null,"Download Diagnostics",-1)])],8,cc),I[12]||(I[12]=Ee('<div class="menu-divider" data-v-73e31407></div><div class="menu-section-title" data-v-73e31407>Help &amp; Support</div><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2#readme" target="_blank" class="menu-item menu-link" data-v-73e31407><i class="mdi mdi-book-open-variant" data-v-73e31407></i><span data-v-73e31407>Documentation</span></a><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2/issues" target="_blank" class="menu-item menu-link" data-v-73e31407><i class="mdi mdi-bug" data-v-73e31407></i><span data-v-73e31407>Report Issue</span></a><div class="menu-divider" data-v-73e31407></div><div class="menu-section-title" data-v-73e31407>Community</div><a href="https://community.home-assistant.io/t/broadlink-manager-modern-web-interface-for-broadlink-devices/938473" target="_blank" class="menu-item menu-link" data-v-73e31407><i class="mdi mdi-forum" data-v-73e31407></i><span data-v-73e31407>HA Forum Discussion</span></a><a href="https://www.reddit.com/r/homeassistant/comments/1o1q3kf/release_broadlink_manager_addon_a_modern_web_ui/" target="_blank" class="menu-item menu-link" data-v-73e31407><i class="mdi mdi-reddit" data-v-73e31407></i><span data-v-73e31407>Reddit Discussion</span></a><div class="menu-divider" data-v-73e31407></div><div class="menu-section-title" data-v-73e31407>Project</div><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2" target="_blank" class="menu-item menu-link" data-v-73e31407><i class="mdi mdi-github" data-v-73e31407></i><span data-v-73e31407>GitHub Repository</span></a><a href="https://ko-fi.com/tonyperkins" target="_blank" class="menu-item menu-link menu-item-sponsor" data-v-73e31407><i class="mdi mdi-coffee" data-v-73e31407></i><span data-v-73e31407>Support on Ko-fi</span></a>',12))])):L("",!0)])])])]),e("main",mc,[be(Nu)]),e("footer",vc,[e("p",null,"Broadlink Manager v"+m(_e(r))+" | Built with Vue "+m(at),1)]),be(Ku,{ref_key:"toastRef",ref:c},null,512)]))}},fc=$e(pc,[["__scopeId","data-v-73e31407"]]),tt=it(fc),gc=rt();tt.use(gc);tt.mount("#app");
