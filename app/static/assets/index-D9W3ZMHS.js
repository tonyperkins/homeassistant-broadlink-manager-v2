import{g as qe,a as Qe,d as et,c as J,r as y,o as Te,b as a,e as n,f as e,h as M,n as Z,u as Ce,t as m,i as _,F as ce,j as he,w as pe,k as z,v as _e,l as ge,m as Je,p as ye,q as je,s as Ne,T as ze,x as we,y as $e,z as Oe,A as fe,B as Ge,C as Ue,D as Re,E as We,G as Ke,H as tt,I as ot,J as Pe,K as lt,L as nt}from"./vendor-CbSuqcOf.js";(function(){const v=document.createElement("link").relList;if(v&&v.supports&&v.supports("modulepreload"))return;for(const w of document.querySelectorAll('link[rel="modulepreload"]'))$(w);new MutationObserver(w=>{for(const l of w)if(l.type==="childList")for(const g of l.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&$(g)}).observe(document,{childList:!0,subtree:!0});function r(w){const l={};return w.integrity&&(l.integrity=w.integrity),w.referrerPolicy&&(l.referrerPolicy=w.referrerPolicy),w.crossOrigin==="use-credentials"?l.credentials="include":w.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function $(w){if(w.ep)return;w.ep=!0;const l=r(w);fetch(w.href,l)}})();function Ve(){const o=qe(),v=o==null?void 0:o.appContext.config.globalProperties.$toast;return v||(console.warn("Toast not available"),{success:r=>console.log("Success:",r),error:r=>console.error("Error:",r),warning:r=>console.warn("Warning:",r),info:r=>console.info("Info:",r)})}const Be="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAHBUlEQVR4nOxZC1BTVxo+9+aNZI2LNsgjWR4hgoIiRVDBslKnIKPbx1jqTrtYoakat1a6dNsdd7t1X8XHyAbEhdUu1u2mXdbasqJbtsaMIqBBECiPBmqEICEBEx4xJLlJ7s6lw6rJDeQ2FzLM+M1kBs7/3+/83zn/Oee/51JRFAXzGbCvA/AWjwX4GvNeANWXnXffHQ4+K6/dYbHeD+IFhjRkb1wn9WPQbEQ4IF/tQlXX2p5+/8OyczY74j/VxuMG3Sh/Oz9jaQDb4CmPT1LIbLXBfzrz0cmHg8fQpx1Yc1Ra+TsiXD4R0PqtRmAyj/LxbJeaujKIcPlEAINOM7vLXBaTZibCRWgRq3WGJZWX63aoNDpB8BJOX/bGlIqwpUv6iXBgWBHG7eUF8urUWvU6Z9sLGxI/IsLl8SJu6u4XigqPXkVspiVTbTQqU1/6Vn7ammh+G5FOMZyqludIKqUVU/9jcaSuTCo/unfHbiad4iBdwMu/P1bV1tO1xbk9NDC0/vwHB1xGcjqYLAh16zsHW3R6XXTu1mfFdAqMrIoSKNbGhLcQ4QGeppDJ7ACtPcqNEI6tT9O3Vqm+tygqNMDjrU9Sef6tIYM2JjUuuXzfC5knCEXsBI8WMZUCAxiCrfhWyMZkMNzYXNHVpwmXXqp5j0Hz0/1m57a3PQ8VHx4JoNMASIl9shLPFsB5ooO7iDXhCY/dAcCvT/79LwC1s/K2bDnAXcQeJRqwMzzeRt/bua0gLChcDsCDNQNBkEU/qot7o6j0kzETQpuJ40ZnT6xSrUoNWhyseHVz2ikv4n4QA5FSArE5IFlTZ0r3XU1MWODib6NCl3a9dkhSYxgbjo4XLq8sL9j7Ip36YEwMRjMNQazMhf7+RgYNnuyo7bY6ArFaWKuXRX495wLwoLk39sO9RaVnM5OTP8zLSjtjsljpp6ovi6pqr706eE8XBwGUSqEy9Guihf/92TMZhetjI5rJCHwKpBRzZqsNYtKp6KD+Pvv1w5ILdzR3UvD8HA4YefOl7N25JKUPIKuUwIJH7A5of/GJf7oLfrIz2EH786fSss+uKFzOk+8L0mqh6rpbmR0q5YyFGAQBSuHHlcUWxEaZyXfMhFD0Rgt9Oh/SBMiam58HAO+oc4XZMsK/1taT6M6uHjJw8w6VSNfvemM8TbzPlFlwsP5KyzfJeL6kCejXDgo894aASqOZ9O/uHwzq6B3ijhitkzOC7XS7j0g+V3S0vQTDDhYEoZSBobvJ+yXFNZ29gy4lOGmvlDBMIfQqSKV8539EWvXHhvbGHBSFrAwGW+vvxzLoR7RxzrNpsyPs0xcv7/lg1/ZfPtKvuw7MVhulUakWdvRq+XY3tWFT90Bk+52BCOzvyOBgjytSFKAgms+b9F/2o+BbKwUrvgjhhjSjKLAPG4YE7lJxfEIf5dyGOwMXrren/eF0RYXRNMrHDt4QbmjDEbHop9F8rqpddZd3sV6R/aWiabtWr41PW534V8m+PFHW+qSPL9TX7oM8WAaBi4IbE4S8yYNs/7asIgBA0ZStRqFM/MXxIzcgHBEBP+C6DJKLgJvK3uXvniitBsDmNzkSEAD9uv5k0aFjXy1gMQ0DQ5p4CAIwNuXLwyL/ExcpqMWeS42NUmxKXFf8VWPdz6cLnkqhGd/Pe+U1Cow/+ekJUYr4qJgvbik7f/Jw+0J/tjpvS3qxs7/LQZZfcrrkUmOdGI/cgUKIkB8pz0xK+CQjKf6z4MWckYftZqsderfsTInsZt0evDRgMRYMHhaLnk+NW1Y/nchxk5lZ+I/Pf/vl9RvbLYiVlSBcJv/VK9sKBCHc3hkF7D12/NzVltZn8YhzNj/3ev6LGeXTdQ6+uzLZ+C+5XNza05Nsd1gXcNgBvekJK/+du3lTUSiXMzzT80TgkkK8wJAGgCMAE5ooFFz3hHTr+lgZ9iMryOngkoi5WZuOc9hPtDu3r4198nTqygjCr3wYmrvVkSerZXljJoT0m0DcYm5g2Mg5WV39zrVWZZofkzaRnhB/bufm9FI/JpXQXj8F8bHyitqWxhzJmwUJT60SNJER+P+BCZjt34lzNbvickRoWVWNmGzuObnYWhER3oAdX41dPbj1jDeYEwGrInltKKCNtatub6hRfJOEnfJkcc+JgE9ltS/DkINuNI3xCo4fbXgm/0CnouvOcjK4Z/16/ZKia+3+kqIrEIQ+sgNx2Jzb5wsPxrD9GBZv+Gd9BqSXr4icg8cwMj4SLmv6+mlv+WddgGlilOPOZkEmFnrLP+sCVgtXyPHaHShkiw0XXPWWf9YF5Gb9uGzp4sCbj7ai4LkNTx2O5nPV3vLPyTeye6P32X+7KNujVKtSYJg+viEu/mx2etJZCgnD57OPfGRh3n8nfizA15j3Av4XAAD//5k1S2w3zfwVAAAAAElFTkSuQmCC",ue=Qe.create({baseURL:"./",timeout:3e4,headers:{"Content-Type":"application/json"}});ue.interceptors.request.use(o=>o,o=>Promise.reject(o));ue.interceptors.response.use(o=>o,o=>(console.error("API Error:",o),o.response?console.error("Response error:",o.response.data):o.request?console.error("No response received"):console.error("Request setup error:",o.message),Promise.reject(o)));const st=et("devices",{state:()=>({devices:[],loading:!1,error:null,selectedDevice:null}),getters:{deviceById:o=>v=>o.devices.find(r=>r.id===v),devicesByType:o=>v=>o.devices.filter(r=>r.entity_type===v),deviceCount:o=>o.devices.length,hasDevices:o=>o.devices.length>0},actions:{async loadDevices(o=!1){this.loading=!0,this.error=null;try{const v=o?`/api/devices/managed?_t=${Date.now()}`:"/api/devices/managed",r=await ue.get(v);this.devices=r.data.devices||[],console.log("ğŸ“¥ Loaded devices:",this.devices),this.devices.forEach($=>{console.log(`ğŸ“¥ Device "${$.name}":`,{id:$.id,device:$.device,commands:$.commands,commandCount:$.commands?Object.keys($.commands).length:0})})}catch(v){this.error=v.message,console.error("Error loading devices:",v)}finally{this.loading=!1}},async createDevice(o){this.loading=!0,this.error=null;try{console.log("ğŸª Store: Creating device with data:",o),console.log("ğŸª Store: Device commands being sent:",o.commands);const v={device_name:o.name,device:o.device,area_id:o.area||"",area_name:o.area||"",entity_type:o.entity_type,icon:o.icon,broadlink_entity:o.broadlink_entity,device_type:o.device_type||"broadlink",commands:o.commands||{}};o.device_type==="smartir"&&o.smartir_config&&(v.smartir_config=o.smartir_config),console.log("ğŸª Store: Transformed data for backend:",v);const r=await ue.post("/api/devices/managed",v);return console.log("ğŸª Store: Create response:",r.data),await this.loadDevices(),r.data}catch(v){throw console.error("Error creating device:",v),v}finally{this.loading=!1}},async updateDevice(o,v){this.loading=!0,this.error=null;try{const r=await ue.put(`/api/devices/managed/${o}`,v);return await this.loadDevices(),r.data}catch(r){throw console.error("Error updating device:",r),r}finally{this.loading=!1}},async deleteDevice(o,v=!1){this.loading=!0,this.error=null;try{await ue.delete(`/api/devices/managed/${o}`,{data:{delete_commands:v}}),this.devices=this.devices.filter(r=>r.id!==o)}catch(r){throw this.error=r.message,console.error("Error deleting device:",r),r}finally{this.loading=!1}},selectDevice(o){this.selectedDevice=o},clearSelection(){this.selectedDevice=null},clearError(){this.error=null},async syncAllAreas(){if(!this.devices||this.devices.length===0){console.log("âš ï¸ No devices to sync");return}console.log(`ğŸ”„ Syncing areas from Home Assistant for ${this.devices.length} devices...`);try{const o=await Promise.all(this.devices.map($=>(console.log(`ğŸ”„ Syncing device: ${$.id} (${$.name})`),ue.post(`/api/devices/${$.id}/sync-area`).then(w=>w.data.success&&w.data.area?(console.log(`âœ… Synced area for ${$.name}: ${w.data.area}`),{status:"synced",device:$.name}):{status:"no_area"}).catch(w=>{var l;return((l=w.response)==null?void 0:l.status)===404?(console.log(`âŒ Device not found in HA: ${$.id}`),{status:"not_found"}):(console.warn(`âš ï¸ Failed to sync area for ${$.id}:`,w.message),{status:"error",error:w.message})})))),v=o.filter($=>$.status==="synced").length,r=o.filter($=>$.status==="not_found").length;await this.loadDevices(!0),v>0?console.log(`âœ… Area sync complete: ${v} synced, ${r} not found in HA`):r>0&&console.log(`â„¹ï¸ No areas synced - ${r} entities not found in HA registry (generate entities first)`)}catch(o){console.debug("Area sync error:",o)}}}});function Xe(o){const v=J(()=>o.value||o),r=J(()=>{switch(v.value){case"climate":return"mdi:air-conditioner";case"fan":return"mdi:fan";case"light":return"mdi:lightbulb";case"media_player":return"mdi:television";case"switch":return"mdi:light-switch";default:return"mdi:devices"}}),$=J(()=>`device-type-${v.value}-color`),w=J(()=>`tag-${v.value}-bg`);return{icon:r,colorClass:$,tagBgClass:w}}const at=""+new URL("broadlink-logo-BDjImjRY.png",import.meta.url).href,ke=(o,v)=>{const r=o.__vccOpts||o;for(const[$,w]of v)r[$]=w;return r},it={class:"device-header"},rt={class:"device-info"},dt=["title"],ut={class:"device-labels"},ct={class:"device-type"},mt=["src","alt","title"],vt={class:"device-body"},ft={class:"device-stats"},pt={class:"stat",title:"Learned command count"},gt={class:"stat",title:"HA Assigned Area"},yt={class:"device-meta"},bt={class:"device-id",title:"Device ID"},ht={key:0,class:"storage-name"},kt={key:1,class:"broadlink-entity",title:"Controller Device"},wt={key:2,class:"controller-device"},$t={class:"device-actions"},Ct=["disabled"],_t=["disabled"],St=["disabled"],It={key:0,class:"disabled-overlay"},Dt={__name:"DeviceCard",props:{device:{type:Object,required:!0},broadlinkDevices:{type:Array,default:()=>[]}},emits:["edit","delete","learn"],setup(o){const v=o,r=J(()=>localStorage.getItem("smartir_simulate_not_installed")==="true"),$=J(()=>v.device.device_type==="smartir"&&r.value),w=y(null),l=Xe(J(()=>v.device.entity_type)),g=J(()=>v.device.icon?v.device.icon:l.icon.value),f=s=>s&&s.startsWith("mdi:")?`mdi ${s.replace(":"," mdi-")}`:`mdi mdi-${s}`,C=J(()=>({light:"Light",fan:"Fan",switch:"Switch",media_player:"Media Player",cover:"Cover"})[v.device.entity_type]||v.device.entity_type),T=J(()=>(v.device.device_type||"broadlink")==="smartir"?"SmartIR":"Broadlink"),E=J(()=>(v.device.device_type||"broadlink")==="smartir"?Be:at),h=J(()=>(v.device.device_type||"broadlink")==="smartir"?w.value!==null?w.value:0:Object.keys(v.device.commands||{}).length),t=s=>{if(!s)return"";const d=v.broadlinkDevices.find(c=>c.entity_id===s);return d&&d.name||s},A=J(()=>{if(!v.device.device)return!1;const s=v.device.id.includes(".")?v.device.id.split(".")[1]:v.device.id;return v.device.device!==s}),F=J(()=>{if(!v.device.broadlink_entity)return"";const s=v.broadlinkDevices.find(d=>d.entity_id===v.device.broadlink_entity);return s&&s.name||v.device.broadlink_entity}),j=s=>{if(!s||typeof s!="object")return 0;let d=0;for(const c of Object.values(s))typeof c=="string"?d++:typeof c=="object"&&(d+=j(c));return d},x=async()=>{if(!(!v.device.device_code||!v.device.entity_type))try{const s=await ue.get("/api/smartir/codes/code",{params:{entity_type:v.device.entity_type,code_id:v.device.device_code}});if(s.data.success&&s.data.code){const d=s.data.code;d.commands&&(w.value=j(d.commands))}}catch(s){console.error("Error fetching SmartIR command count:",s)}};return Te(async()=>{(v.device.device_type||"broadlink")==="smartir"&&await x()}),(s,d)=>(n(),a("div",{class:Z(["device-card",{disabled:$.value}])},[e("div",it,[e("div",{class:Z(["device-icon",Ce(l).colorClass.value])},[e("i",{class:Z(f(g.value))},null,2)],2),e("div",rt,[e("h3",{title:o.device.name},m(o.device.name),9,dt),e("div",ut,[e("span",ct,m(C.value),1)])]),e("img",{src:E.value,alt:T.value,title:T.value,class:"device-source-logo"},null,8,mt)]),e("div",vt,[e("div",ft,[e("div",pt,[d[3]||(d[3]=e("i",{class:"mdi mdi-remote"},null,-1)),e("span",null,m(h.value)+" command"+m(h.value!==1?"s":""),1)]),e("div",gt,[d[4]||(d[4]=e("i",{class:"mdi mdi-map-marker"},null,-1)),e("span",null,m(o.device.area||"No area"),1)])]),e("div",yt,[e("span",bt,[d[5]||(d[5]=e("i",{class:"mdi mdi-identifier"},null,-1)),_(" "+m(o.device.id),1)]),A.value?(n(),a("span",ht,[d[6]||(d[6]=e("i",{class:"mdi mdi-code-tags"},null,-1)),_(" "+m(o.device.device),1)])):M("",!0),o.device.broadlink_entity?(n(),a("span",kt,[d[7]||(d[7]=e("i",{class:"mdi mdi-access-point"},null,-1)),_(" "+m(F.value),1)])):M("",!0),o.device.controller_device?(n(),a("span",wt,[d[8]||(d[8]=e("i",{class:"mdi mdi-access-point"},null,-1)),_(" "+m(t(o.device.controller_device)),1)])):M("",!0)])]),e("div",$t,[e("button",{onClick:d[0]||(d[0]=c=>!$.value&&s.$emit("learn",o.device)),class:"icon-btn",title:"Manage Commands",disabled:$.value},[...d[9]||(d[9]=[e("i",{class:"mdi mdi-remote-tv"},null,-1)])],8,Ct),e("button",{onClick:d[1]||(d[1]=c=>!$.value&&s.$emit("edit",o.device)),class:"icon-btn",title:"Edit",disabled:$.value},[...d[10]||(d[10]=[e("i",{class:"mdi mdi-pencil"},null,-1)])],8,_t),e("button",{onClick:d[2]||(d[2]=c=>!$.value&&s.$emit("delete",o.device)),class:"icon-btn danger",title:"Delete",disabled:$.value},[...d[11]||(d[11]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,St)]),$.value?(n(),a("div",It,[...d[12]||(d[12]=[e("div",{class:"disabled-message"},[e("i",{class:"mdi mdi-eye-off"}),e("span",null,"SmartIR Not Installed")],-1)])])):M("",!0)],2))}},xt=ke(Dt,[["__scopeId","data-v-7a7f5c18"]]),Tt={name:"DeviceListView",props:{devices:{type:Array,required:!0}},methods:{getDeviceCommands(o){return o.commands&&typeof o.commands=="object"?Object.keys(o.commands):[]},sendCommand(o,v){this.$emit("send-command",{device:o,command:v})},editDevice(o){this.$emit("edit-device",o)},deleteDevice(o){this.$emit("delete-device",o)}}},Rt={class:"device-list-view"},Mt={class:"device-table"},Lt={class:"device-info"},Ot={class:"device-name"},At={class:"device-entity"},Et={class:"device-area"},Vt={class:"device-type"},jt={class:"device-commands"},Pt={key:0,class:"command-list"},Ut=["onClick"],Ft={key:0,class:"no-commands"},Nt={key:1,class:"smartir-info"},Bt={class:"profile-code"},Ht={class:"device-actions"},qt=["onClick"],Jt=["onClick"];function zt(o,v,r,$,w,l){return n(),a("div",Rt,[e("table",Mt,[v[2]||(v[2]=e("thead",null,[e("tr",null,[e("th",null,"Device"),e("th",null,"Room/Area"),e("th",null,"Type"),e("th",null,"Commands"),e("th",null,"Actions")])],-1)),e("tbody",null,[(n(!0),a(ce,null,he(r.devices,g=>(n(),a("tr",{key:g.entity_id,class:"device-row"},[e("td",Lt,[e("div",Ot,m(g.friendly_name||g.name),1),e("div",At,m(g.entity_id),1)]),e("td",Et,m(g.area||"No Area"),1),e("td",Vt,[e("span",{class:Z(["type-badge",g.device_type])},m(g.device_type==="smartir"?"SmartIR":"Broadlink"),3)]),e("td",jt,[g.device_type==="broadlink"?(n(),a("div",Pt,[(n(!0),a(ce,null,he(l.getDeviceCommands(g),f=>(n(),a("button",{key:f,class:"command-btn",onClick:C=>l.sendCommand(g,f)},m(f),9,Ut))),128)),l.getDeviceCommands(g).length===0?(n(),a("span",Ft," No commands ")):M("",!0)])):g.device_type==="smartir"?(n(),a("div",Nt,[e("span",Bt,"Profile: "+m(g.device_code),1)])):M("",!0)]),e("td",Ht,[e("button",{class:"action-btn edit",onClick:f=>l.editDevice(g),title:"Edit"},[...v[0]||(v[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})],-1)])],8,qt),e("button",{class:"action-btn delete",onClick:f=>l.deleteDevice(g),title:"Delete"},[...v[1]||(v[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"3 6 5 6 21 6"}),e("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})],-1)])],8,Jt)])]))),128))])])])}const Gt=ke(Tt,[["render",zt],["__scopeId","data-v-34e538b4"]]),Wt={class:"icon-picker"},Kt={class:"icon-input-wrapper"},Xt=["id","placeholder"],Yt={key:0,class:"icon-preview"},Zt={key:0,class:"icon-dropdown"},Qt={class:"icon-grid"},eo=["onMousedown","title"],to={__name:"IconPicker",props:{modelValue:{type:String,default:""},inputId:{type:String,default:"icon-input"},placeholder:{type:String,default:"e.g., mdi:television"}},emits:["update:modelValue"],setup(o,{emit:v}){const r=o,$=v,w=y(r.modelValue),l=y(!1),g=["television","speaker","radio","music","video","movie","play","pause","stop","skip-next","skip-previous","volume-high","volume-medium","volume-low","volume-off","remote","remote-tv","cast","chromecast","spotify","netflix","youtube","lightbulb","lightbulb-on","lightbulb-off","lamp","floor-lamp","ceiling-light","light-switch","led-strip","led-strip-variant","wall-sconce","chandelier","spotlight","track-light","vanity-light","desk-lamp","fan","ceiling-fan","air-conditioner","thermometer","thermostat","heat-wave","snowflake","fire","radiator","water-boiler","hvac","blinds","blinds-open","window-shutter","window-shutter-open","curtains","curtains-closed","roller-shade","roller-shade-closed","garage","garage-open","gate","door","door-open","window-open","window-closed","washing-machine","tumble-dryer","dishwasher","refrigerator","stove","microwave","oven","toaster","kettle","coffee","coffee-maker","blender","robot-vacuum","robot-vacuum-variant","vacuum","broom","spray-bottle","lock","lock-open","lock-smart","key","shield","shield-check","alarm-light","bell","doorbell","camera","cctv","motion-sensor","smoke-detector","fire-extinguisher","water-alert","gas-cylinder","sofa","bed","bed-double","desk","chair","table","bookshelf","home","home-outline","home-assistant","floor-plan","room","weather-sunny","weather-night","weather-cloudy","weather-rainy","weather-snowy","weather-lightning","weather-windy","weather-fog","weather-partly-cloudy","umbrella","water","water-percent","phone","cellphone","tablet","laptop","desktop-tower","monitor","keyboard","mouse","printer","router","router-wireless","access-point","wifi","bluetooth","usb","hdmi-port","ethernet","power","power-plug","power-socket","battery","battery-charging","lightning-bolt","flash","solar-panel","solar-power","leaf","tree","flower","sprout","grass","watering-can","shovel","fence","pool","hot-tub","silverware","silverware-fork-knife","food","food-apple","glass-wine","glass-cocktail","bottle-wine","pot","pot-steam","shower","shower-head","bathtub","toilet","sink","faucet","hand-wash","car","car-side","garage-variant","tools","hammer","wrench","screwdriver","toolbox","ladder","heart","heart-pulse","run","walk","bike","dumbbell","yoga","scale-bathroom","thermometer-lines","clock","clock-outline","timer","alarm","calendar","calendar-today","calendar-clock","history","bell-ring","bell-alert","alert","alert-circle","information","help-circle","check","check-circle","close-circle","minus-circle","plus-circle","arrow-up","arrow-down","arrow-left","arrow-right","chevron-up","chevron-down","menu","dots-vertical","dots-horizontal","cog","tune","circle","square","triangle","hexagon","star","star-outline","heart-outline","plus","minus","close","check-bold","eye","eye-off","account","account-group","baby","dog","cat","paw","gift","balloon","party-popper","candle","book","book-open","newspaper","email","message","phone-classic"];pe(()=>r.modelValue,h=>{w.value=h});const f=J(()=>{if(!w.value)return g.slice(0,50);const h=w.value.toLowerCase().replace("mdi:","");return g.filter(t=>t.toLowerCase().includes(h)).slice(0,50)}),C=()=>{l.value=!0,$("update:modelValue",w.value)},T=()=>{setTimeout(()=>{l.value=!1},200)},E=h=>{w.value=`mdi:${h}`,$("update:modelValue",w.value),l.value=!1};return(h,t)=>(n(),a("div",Wt,[e("div",Kt,[z(e("input",{id:o.inputId,"onUpdate:modelValue":t[0]||(t[0]=A=>w.value=A),type:"text",placeholder:o.placeholder,onInput:C,onFocus:t[1]||(t[1]=A=>l.value=!0),onBlur:T},null,40,Xt),[[_e,w.value]]),w.value?(n(),a("div",Yt,[e("i",{class:Z(`mdi mdi-${w.value.replace("mdi:","")}`)},null,2)])):M("",!0)]),l.value&&f.value.length>0?(n(),a("div",Zt,[e("div",Qt,[(n(!0),a(ce,null,he(f.value,A=>(n(),a("div",{key:A,class:"icon-option",onMousedown:ge(F=>E(A),["prevent"]),title:A},[e("i",{class:Z(`mdi mdi-${A}`)},null,2),e("span",null,m(A),1)],40,eo))),128))])])):M("",!0)]))}},oo=ke(to,[["__scopeId","data-v-a64f5011"]]),lo={key:0,class:"dropdown-label"},no={key:0,class:"required"},so=["placeholder","disabled","onKeydown"],ao={class:"dropdown-icons"},io={key:0,class:"mdi mdi-loading mdi-spin"},ro={key:2,class:"mdi mdi-chevron-down"},uo={key:1,class:"error-message"},co={key:2,class:"hint-message"},mo={key:0,class:"dropdown-menu"},vo=["onMousedown","onMouseenter"],fo={class:"option-content"},po={class:"option-label"},go={key:0,class:"option-description"},yo={key:0,class:"mdi mdi-check selected-icon"},bo={key:3,class:"dropdown-menu"},ho={__name:"SearchableDropdown",props:{modelValue:{type:[String,Number,Object],default:null},options:{type:Array,required:!0,default:()=>[]},label:{type:String,default:""},placeholder:{type:String,default:"Search..."},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},error:{type:String,default:""},hint:{type:String,default:""},optionLabel:{type:String,default:"label"},optionValue:{type:String,default:"value"},optionDescription:{type:String,default:"description"},filterMethod:{type:Function,default:null}},emits:["update:modelValue","change","search"],setup(o,{emit:v}){const r=o,$=v,w=y(null),l=y(null),g=y(""),f=y(!1),C=y(0),T=y(!1),E=L=>typeof L=="string"||typeof L=="number"?L:L[r.optionLabel]||L.label||L.name||String(L),h=L=>typeof L=="string"||typeof L=="number"?L:L[r.optionValue]||L.value||L.id||L,t=L=>typeof L=="string"||typeof L=="number"?"":L[r.optionDescription]||L.description||"",A=L=>{const B=h(L);return typeof r.modelValue=="object"?h(r.modelValue)===B:r.modelValue===B},F=J(()=>{if(!g.value)return r.options;if(r.filterMethod)return r.options.filter(B=>r.filterMethod(B,g.value));const L=g.value.toLowerCase();return r.options.filter(B=>{const ee=E(B).toLowerCase(),de=t(B).toLowerCase();return ee.includes(L)||de.includes(L)})}),j=J(()=>{if(!r.modelValue)return"";const L=r.options.find(B=>{const ee=h(B);return typeof r.modelValue=="object"?ee===h(r.modelValue):ee===r.modelValue});return L?E(L):""});pe(()=>r.modelValue,L=>{T.value||(g.value=j.value)}),pe(()=>r.options,()=>{!T.value&&r.modelValue&&(g.value=j.value)},{deep:!0}),pe(g,L=>{$("search",L),C.value=0}),Te(()=>{g.value=j.value});const x=()=>{var L;T.value=!0,f.value=!0,(L=l.value)==null||L.select()},s=()=>{T.value=!1,setTimeout(()=>{f.value=!1,r.modelValue?g.value=j.value:g.value=""},200)},d=()=>{var L;f.value=!1,(L=l.value)==null||L.blur()},c=L=>{const B=h(L);$("update:modelValue",B),$("change",B,L),g.value=E(L),d()},N=()=>{var L;$("update:modelValue",null),$("change",null,null),g.value="",(L=l.value)==null||L.focus()},Q=()=>{if(!f.value){f.value=!0;return}C.value<F.value.length-1&&C.value++},ne=()=>{C.value>0&&C.value--},le=()=>{F.value.length>0&&C.value>=0&&c(F.value[C.value])},me=L=>{w.value&&!w.value.contains(L.target)&&(f.value=!1,r.modelValue?g.value=j.value:g.value="")};return Te(()=>{document.addEventListener("click",me)}),Je(()=>{document.removeEventListener("click",me)}),(L,B)=>(n(),a("div",{class:"searchable-dropdown",ref_key:"dropdownRef",ref:w},[o.label?(n(),a("label",lo,[_(m(o.label)+" ",1),o.required?(n(),a("span",no,"*")):M("",!0)])):M("",!0),e("div",{class:Z(["dropdown-input-wrapper",{"has-error":o.error,disabled:o.disabled}])},[z(e("input",{ref_key:"inputRef",ref:l,type:"text","onUpdate:modelValue":B[0]||(B[0]=ee=>g.value=ee),placeholder:o.placeholder,disabled:o.disabled||o.loading,onFocus:x,onBlur:s,onKeydown:[je(ge(Q,["prevent"]),["down"]),je(ge(ne,["prevent"]),["up"]),je(ge(le,["prevent"]),["enter"]),je(d,["escape"])],class:"dropdown-input"},null,40,so),[[_e,g.value]]),e("div",ao,[o.loading?(n(),a("i",io)):o.modelValue&&!o.disabled?(n(),a("i",{key:1,class:"mdi mdi-close-circle clear-icon",onClick:N})):(n(),a("i",ro))])],2),o.error?(n(),a("div",uo,m(o.error),1)):M("",!0),o.hint&&!o.error?(n(),a("div",co,m(o.hint),1)):M("",!0),ye(ze,{name:"dropdown"},{default:Ne(()=>[f.value&&F.value.length>0?(n(),a("div",mo,[(n(!0),a(ce,null,he(F.value,(ee,de)=>(n(),a("div",{key:h(ee),class:Z(["dropdown-item",{highlighted:de===C.value,selected:A(ee)}]),onMousedown:ge(be=>c(ee),["prevent"]),onMouseenter:be=>C.value=de},[e("div",fo,[e("div",po,m(E(ee)),1),t(ee)?(n(),a("div",go,m(t(ee)),1)):M("",!0)]),A(ee)?(n(),a("i",yo)):M("",!0)],42,vo))),128))])):M("",!0)]),_:1}),f.value&&F.value.length===0&&!o.loading?(n(),a("div",bo,[...B[1]||(B[1]=[e("div",{class:"dropdown-item no-results"},[e("i",{class:"mdi mdi-magnify"}),_(" No results found ")],-1)])])):M("",!0)],512))}},Fe=ke(ho,[["__scopeId","data-v-679ce35f"]]),ko={class:"smartir-selector"},wo={class:"form-group"},$o={class:"form-group"},Co={class:"form-group"},_o=["value"],So={key:0,class:"error-message"},Io={class:"form-group"},Do={class:"form-group"},xo={key:1,class:"code-info"},To={class:"info-content"},Ro={class:"info-row"},Mo={class:"info-value"},Lo={class:"info-row"},Oo={class:"info-value"},Ao={key:0,class:"info-row"},Eo={class:"info-value"},Vo={class:"info-row"},jo={class:"info-value"},Po={__name:"SmartIRDeviceSelector",props:{entityType:{type:String,required:!0},modelValue:{type:Object,default:()=>({})},broadlinkDevices:{type:Array,default:()=>[]}},emits:["update:modelValue","change"],setup(o,{expose:v,emit:r}){const $=o,w=r,l=y([]),g=y([]),f=y(""),C=y(""),T=y(""),E=y(""),h=y(""),t=y(null),A=y(!1),F=y(!1),j=y({manufacturer:"",model:"",controller:""});Te(async()=>{if(await x(),$.modelValue&&(f.value=$.modelValue.manufacturer||"",C.value=$.modelValue.device_code||"",T.value=$.modelValue.controller_device||"",E.value=$.modelValue.temperature_sensor||"",h.value=$.modelValue.humidity_sensor||"",f.value&&(await s(f.value),C.value&&g.value.length>0))){const L=g.value.find(B=>B.code===C.value);L&&(t.value={code:L.code,manufacturer:f.value,models:L.models,controller:L.controller})}}),pe(()=>$.entityType,async L=>{L&&(f.value="",C.value="",g.value=[],t.value=null,await x())});const x=async()=>{if($.entityType){A.value=!0,j.value.manufacturer="";try{const L=await ue.get("/api/smartir/codes/manufacturers",{params:{entity_type:$.entityType}});if(L.data.success)l.value=L.data.manufacturers||[];else throw new Error(L.data.error||"Failed to load manufacturers")}catch(L){console.error("Error loading manufacturers:",L),j.value.manufacturer="Failed to load manufacturers. Please try again.",l.value=[]}finally{A.value=!1}}},s=async L=>{if(!(!L||!$.entityType)){F.value=!0,j.value.model="";try{const B=await ue.get("/api/smartir/codes/models",{params:{entity_type:$.entityType,manufacturer:L}});if(B.data.success){const ee=B.data.models||[];g.value=ee.map(de=>{const be=de.models&&de.models.length>0?de.models.join(", "):`Code ${de.code}`;return{code:de.code,label:be,description:`Code: ${de.code}`,models:de.models,controller:de.controller}})}else throw new Error(B.data.error||"Failed to load models")}catch(B){console.error("Error loading models:",B),j.value.model="Failed to load models. Please try again.",g.value=[]}finally{F.value=!1}}},d=async L=>{f.value=L,C.value="",t.value=null,g.value=[],L&&await s(L),le()},c=()=>{const L=g.value.find(B=>B.code===C.value);L&&(t.value={code:L.code,manufacturer:f.value,models:L.models,controller:L.controller}),le()},N=()=>{le()},Q=()=>{le()},ne=()=>{le()},le=()=>{var B,ee;const L={manufacturer:f.value,model:((ee=(B=t.value)==null?void 0:B.models)==null?void 0:ee[0])||"",device_code:C.value,controller_device:T.value};$.entityType==="climate"&&(E.value&&(L.temperature_sensor=E.value),h.value&&(L.humidity_sensor=h.value)),w("update:modelValue",L),w("change",L)};return v({validate:()=>{let L=!0;return j.value={manufacturer:"",model:"",controller:""},f.value||(j.value.manufacturer="Manufacturer is required",L=!1),C.value||(j.value.model="Model is required",L=!1),T.value||(j.value.controller="Broadlink controller is required",L=!1),L}}),(L,B)=>(n(),a("div",ko,[e("div",wo,[ye(Fe,{modelValue:f.value,"onUpdate:modelValue":B[0]||(B[0]=ee=>f.value=ee),options:l.value,label:"Manufacturer",placeholder:"Search manufacturers...",required:"",loading:A.value,error:j.value.manufacturer,hint:"Select the device manufacturer",onChange:d},null,8,["modelValue","options","loading","error"])]),e("div",$o,[ye(Fe,{modelValue:C.value,"onUpdate:modelValue":B[1]||(B[1]=ee=>C.value=ee),options:g.value,"option-label":"label","option-value":"code","option-description":"description",label:"Model",placeholder:"Search models...",required:"",disabled:!f.value,loading:F.value,error:j.value.model,hint:"Select the device model",onChange:c},null,8,["modelValue","options","disabled","loading","error"])]),e("div",Co,[B[6]||(B[6]=e("label",{for:"controller-device"},[e("i",{class:"mdi mdi-remote"}),_(" Controller Device * ")],-1)),z(e("select",{id:"controller-device","onUpdate:modelValue":B[2]||(B[2]=ee=>T.value=ee),required:"",onChange:N},[B[5]||(B[5]=e("option",{value:""},"-- Select Controller Device --",-1)),(n(!0),a(ce,null,he(o.broadlinkDevices,ee=>(n(),a("option",{key:ee.entity_id,value:ee.entity_id},[_(m(ee.name||ee.entity_id)+" ",1),ee.area_name?(n(),a(ce,{key:0},[_(" - "+m(ee.area_name),1)],64)):M("",!0)],8,_o))),128))],544),[[we,T.value]]),B[7]||(B[7]=e("small",null,"Which remote device will send the IR/RF commands",-1)),j.value.controller?(n(),a("div",So,m(j.value.controller),1)):M("",!0)]),o.entityType==="climate"?(n(),a(ce,{key:0},[e("div",Io,[B[8]||(B[8]=e("label",{for:"temperature-sensor"},"Temperature Sensor",-1)),z(e("input",{id:"temperature-sensor","onUpdate:modelValue":B[3]||(B[3]=ee=>E.value=ee),type:"text",placeholder:"e.g., sensor.living_room_temperature",onInput:Q},null,544),[[_e,E.value]]),B[9]||(B[9]=e("small",null,"Optional: Temperature sensor entity for current temperature",-1))]),e("div",Do,[B[10]||(B[10]=e("label",{for:"humidity-sensor"},"Humidity Sensor",-1)),z(e("input",{id:"humidity-sensor","onUpdate:modelValue":B[4]||(B[4]=ee=>h.value=ee),type:"text",placeholder:"e.g., sensor.living_room_humidity",onInput:ne},null,544),[[_e,h.value]]),B[11]||(B[11]=e("small",null,"Optional: Humidity sensor entity for current humidity",-1))])],64)):M("",!0),t.value?(n(),a("div",xo,[B[16]||(B[16]=e("div",{class:"info-header"},[e("i",{class:"mdi mdi-information"}),e("span",null,"Selected Device Code")],-1)),e("div",To,[e("div",Ro,[B[12]||(B[12]=e("span",{class:"info-label"},"Code ID:",-1)),e("span",Mo,m(t.value.code_id),1)]),e("div",Lo,[B[13]||(B[13]=e("span",{class:"info-label"},"Manufacturer:",-1)),e("span",Oo,m(t.value.manufacturer),1)]),t.value.models&&t.value.models.length>0?(n(),a("div",Ao,[B[14]||(B[14]=e("span",{class:"info-label"},"Supported Models:",-1)),e("span",Eo,m(t.value.models.join(", ")),1)])):M("",!0),e("div",Vo,[B[15]||(B[15]=e("span",{class:"info-label"},"Controller:",-1)),e("span",jo,m(t.value.controller||"Broadlink"),1)])])])):M("",!0)]))}},Uo=ke(Po,[["__scopeId","data-v-1911c8f6"]]),Fo={class:"modal-content"},No={class:"modal-header"},Bo={class:"input-wrapper"},Ho={key:0,class:"validation-tooltip"},qo={class:"input-wrapper"},Jo=["disabled"],zo={key:0,class:"validation-tooltip"},Go={key:0,class:"smartir-notice"},Wo={key:0,class:"notice-success"},Ko={key:1,class:"notice-warning"},Xo={key:1,class:"smartir-notice"},Yo={key:2},Zo={class:"form-group"},Qo=["disabled"],el=["disabled"],tl={key:0},ol={key:1},ll={key:2},nl={key:3},sl={key:0,class:"form-group"},al={class:"area-display-readonly"},il=["value"],rl=["disabled"],dl=["href"],ul={key:1,class:"form-group"},cl={class:"form-group"},ml={class:"input-wrapper"},vl=["value"],fl=["value"],pl={key:2,class:"validation-tooltip"},gl={key:0},yl={key:1},bl={key:3,class:"smartir-section"},hl={class:"modal-footer"},kl={type:"submit",form:"device-form",class:"btn btn-primary"},wl={__name:"DeviceForm",props:{device:{type:Object,default:null}},emits:["save","cancel"],setup(o,{emit:v}){const r=o,$=v,w=$e("smartirStatus"),l=$e("smartirEnabled"),g=J(()=>{var u;return localStorage.getItem("smartir_simulate_not_installed")==="true"?!1:((u=w==null?void 0:w.value)==null?void 0:u.installed)||!1}),f=J(()=>!!r.device),C=J(()=>["climate","media_player","fan","light"].includes(t.value.entity_type)),T=J(()=>g.value?!C.value&&t.value.entity_type?"(Not supported for this type)":"(Pre-configured Codes)":"(Requires SmartIR)"),E=J(()=>{var u;const S=((u=r.device)==null?void 0:u.commands)||{};return Object.keys(S).length>0}),h=J(()=>{if(!t.value.broadlink_entity)return"";const S=s.value.find(u=>u.entity_id===t.value.broadlink_entity);return S&&S.name||t.value.broadlink_entity}),t=y({name:"",entity_type:"",device_type:"broadlink",device:"",area:"",icon:"",broadlink_entity:"",enabled:!0,commands:{}}),A=y({name:"",entity_type:"",broadlink_entity:""}),F=y({}),j=y(null),x=y([]),s=y([]),d=y(null),c=y(null),N=y(null),Q=y(!1);Te(async()=>{r.device&&(t.value={...r.device,device_type:r.device.device_type||"broadlink"},t.value.device_type==="smartir"&&(F.value={manufacturer:r.device.manufacturer,model:r.device.model,device_code:r.device.device_code,controller_device:r.device.controller_device,temperature_sensor:r.device.temperature_sensor,humidity_sensor:r.device.humidity_sensor})),await Promise.all([ne(),le()])});const ne=async()=>{try{const S=await ue.get("/api/areas");x.value=S.data.areas||[]}catch(S){console.error("Error loading areas:",S),x.value=[]}},le=async()=>{try{const u=(await ue.get("/api/remote/devices")).data.devices||[];s.value=u,console.log("Loaded remote devices:",u)}catch(S){console.error("Error loading remote devices:",S),s.value=[]}},me=S=>{if(!S)return"";const u=S.toLowerCase();for(const V of x.value){const ie=V.toLowerCase();if(u.includes(ie))return V}return""},L=(S,u="")=>{const V=u.toLowerCase();return V.includes("tv")?"mdi:television":V.includes("lamp")?"mdi:lamp":V.includes("ceiling")?"mdi:ceiling-light":V.includes("floor")?"mdi:floor-lamp":V.includes("desk")?"mdi:desk-lamp":V.includes("fan")?"mdi:fan":V.includes("ac")||V.includes("air con")?"mdi:air-conditioner":V.includes("heater")?"mdi:radiator":V.includes("blind")?"mdi:blinds":V.includes("curtain")?"mdi:curtains":V.includes("garage")?"mdi:garage":V.includes("speaker")||V.includes("stereo")?"mdi:speaker":V.includes("receiver")?"mdi:audio-video":{light:"mdi:lightbulb",fan:"mdi:fan",switch:"mdi:light-switch",media_player:"mdi:television",cover:"mdi:window-shutter",climate:"mdi:thermostat"}[S]||"mdi:devices"};pe(()=>t.value.name,S=>{if(!f.value&&S&&!t.value.area){const u=me(S);u&&(t.value.area=u)}!f.value&&S&&t.value.entity_type&&(Q.value||!t.value.icon)&&(t.value.icon=L(t.value.entity_type,S),Q.value=!0)}),pe(()=>t.value.entity_type,S=>{!f.value&&S&&(Q.value||!t.value.icon)&&(t.value.icon=L(S,t.value.name),Q.value=!0)}),pe(()=>t.value.icon,(S,u)=>{u!==void 0&&S!==u&&!Q.value&&(Q.value=!1),S||(Q.value=!1)});const B=y(!1),ee=async()=>{var S;if((S=r.device)!=null&&S.id){B.value=!0;try{const u=await ue.post(`/api/devices/${r.device.id}/sync-area`);u.data.success?(t.value.area=u.data.area||"",u.data.area?console.log(`Area synced: ${u.data.area}`):console.log("No area assigned in Home Assistant")):console.warn(u.data.message||"Entity not found in HA")}catch(u){console.error("Failed to sync area:",u)}finally{B.value=!1}}},de=()=>{var V;return!((V=r.device)!=null&&V.id)||!t.value.entity_type?"#":`/config/entities/entity/${`${t.value.entity_type}.${r.device.id}`}`},be=()=>{A.value={name:"",entity_type:"",broadlink_entity:""};let S=!0;return(!t.value.name||t.value.name.trim()==="")&&(A.value.name="Device name is required",S=!1),t.value.entity_type||(A.value.entity_type="Entity type is required",S=!1),t.value.device_type==="broadlink"&&!t.value.broadlink_entity&&(A.value.broadlink_entity="Broadlink device is required",S=!1),S},Se=S=>{A.value[S]=""},Ie=async()=>{if(t.value.device_type==="smartir"){if(j.value&&!j.value.validate())return;const S={...t.value,smartir_config:{manufacturer:F.value.manufacturer,model:F.value.model,code_id:F.value.device_code,controller_device:F.value.controller_device}};$("save",S)}else{if(!be())return;$("save",{...t.value})}},De=S=>{F.value=S};return(S,u)=>(n(),a("div",{class:"modal-overlay",onClick:u[11]||(u[11]=ge(V=>S.$emit("cancel"),["self"]))},[e("div",Fo,[e("div",No,[e("h2",null,m(f.value?"Edit Device":"Add New Device"),1),e("button",{onClick:u[0]||(u[0]=V=>S.$emit("cancel")),class:"close-btn"},[...u[12]||(u[12]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("form",{id:"device-form",onSubmit:ge(Ie,["prevent"]),class:"modal-body"},[e("div",{class:Z(["form-group",{"has-error":A.value.name}])},[u[14]||(u[14]=e("label",{for:"device-name"},"Device Name *",-1)),e("div",Bo,[z(e("input",{id:"device-name",ref_key:"nameInput",ref:d,"onUpdate:modelValue":u[1]||(u[1]=V=>t.value.name=V),type:"text",placeholder:"e.g., Living Room TV",onInput:u[2]||(u[2]=V=>Se("name"))},null,544),[[_e,t.value.name]]),A.value.name?(n(),a("div",Ho,[u[13]||(u[13]=e("i",{class:"mdi mdi-alert"},null,-1)),_(" "+m(A.value.name),1)])):M("",!0)]),u[15]||(u[15]=e("small",null,"Friendly name for this device",-1))],2),e("div",{class:Z(["form-group",{"has-error":A.value.entity_type}])},[u[23]||(u[23]=e("label",{for:"entity-type"},"Entity Type *",-1)),e("div",qo,[z(e("select",{id:"entity-type",ref_key:"typeSelect",ref:c,"onUpdate:modelValue":u[3]||(u[3]=V=>t.value.entity_type=V),onChange:u[4]||(u[4]=V=>Se("entity_type"))},[u[16]||(u[16]=Oe('<option value="" data-v-94bc1fe5>-- Select Type --</option><option value="light" data-v-94bc1fe5>ğŸ’¡ Light</option><option value="fan" data-v-94bc1fe5>ğŸŒ€ Fan</option><option value="switch" data-v-94bc1fe5>ğŸ”Œ Switch</option><option value="media_player" data-v-94bc1fe5>ğŸ“º Media Player</option><option value="cover" data-v-94bc1fe5>ğŸªŸ Cover (Blinds/Curtains)</option>',6)),e("option",{value:"climate",disabled:!g.value}," ğŸŒ¡ï¸ Climate "+m(g.value?"":"(Requires SmartIR)"),9,Jo)],544),[[we,t.value.entity_type]]),A.value.entity_type?(n(),a("div",zo,[u[17]||(u[17]=e("i",{class:"mdi mdi-alert"},null,-1)),_(" "+m(A.value.entity_type),1)])):M("",!0)]),t.value.entity_type==="climate"?(n(),a("div",Go,[g.value?(n(),a("div",Wo,[...u[18]||(u[18]=[e("i",{class:"mdi mdi-check-circle"},null,-1),e("span",null,"SmartIR detected! Climate entities will be created via SmartIR profiles.",-1)])])):(n(),a("div",Ko,[...u[19]||(u[19]=[e("i",{class:"mdi mdi-alert"},null,-1),e("div",null,[e("strong",null,"SmartIR Required"),e("p",null,"Climate entities (AC, heaters) require SmartIR integration."),e("a",{href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"smartir-link"}," Install SmartIR â†’ ")],-1)])]))])):g.value&&["media_player","fan","light"].includes(t.value.entity_type)?(n(),a("div",Xo,[...u[20]||(u[20]=[e("div",{class:"notice-info"},[e("i",{class:"mdi mdi-information"}),e("span",null,"ğŸ’¡ SmartIR available! You can use pre-configured codes or learn your own.")],-1)])])):!g.value&&t.value.entity_type?(n(),a("small",Yo,[u[21]||(u[21]=_(" ğŸ’¡ Tip: Install ",-1)),u[22]||(u[22]=e("a",{href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"inline-link"},"SmartIR",-1)),_(" for pre-configured "+m(t.value.entity_type==="climate"?"climate":t.value.entity_type)+" device codes ",1)])):M("",!0)],2),e("div",Zo,[u[26]||(u[26]=e("label",{for:"device-type"},"Device Type *",-1)),z(e("select",{id:"device-type","onUpdate:modelValue":u[5]||(u[5]=V=>t.value.device_type=V),required:"",disabled:f.value},[u[24]||(u[24]=e("option",{value:""},"-- Select Device Type --",-1)),u[25]||(u[25]=e("option",{value:"broadlink"},"ğŸ“¡ Broadlink Device (Learn IR Codes)",-1)),Ce(l)?(n(),a("option",{key:0,value:"smartir",disabled:!g.value||!C.value}," ğŸŒ SmartIR Device "+m(T.value),9,el)):M("",!0)],8,Qo),[[we,t.value.device_type]]),f.value?(n(),a("small",tl,"Cannot change device type after creation")):t.value.device_type==="smartir"?(n(),a("small",ol,"Using pre-configured codes from SmartIR repository")):t.value.device_type==="broadlink"?(n(),a("small",ll,"Learn and store your own IR codes")):(n(),a("small",nl,"Choose how to configure this device"))]),f.value?(n(),a("div",sl,[u[29]||(u[29]=e("label",{for:"device-area"},"Area",-1)),e("div",al,[e("input",{id:"device-area",value:t.value.area||"Not assigned",type:"text",readonly:"",class:"readonly-input"},null,8,il),e("button",{type:"button",onClick:ee,disabled:B.value,class:"sync-area-btn",title:"Sync area from Home Assistant"},[e("i",{class:Z(B.value?"mdi mdi-loading mdi-spin":"mdi mdi-refresh")},null,2)],8,rl)]),e("small",null,[u[27]||(u[27]=e("i",{class:"mdi mdi-information-outline"},null,-1)),u[28]||(u[28]=_(" Set area in Home Assistant, then click sync. ",-1)),e("a",{href:de(),target:"_blank",class:"inline-link"},"Open in HA â†’",8,dl)])])):(n(),a("div",ul,[...u[30]||(u[30]=[e("div",{class:"info-notice"},[e("i",{class:"mdi mdi-information-outline"}),e("span",null,[e("strong",null,"Area Assignment:"),_(" After generating entities and restarting Home Assistant, you can assign areas in HA and sync them here.")])],-1)])])),e("div",cl,[u[31]||(u[31]=e("label",{for:"device-icon"},"Icon",-1)),ye(oo,{modelValue:t.value.icon,"onUpdate:modelValue":u[6]||(u[6]=V=>t.value.icon=V),inputId:"device-icon",placeholder:"e.g., mdi:television"},null,8,["modelValue"]),u[32]||(u[32]=e("small",null,"Optional: Material Design Icon name",-1))]),t.value.device_type==="broadlink"?(n(),a("div",{key:2,class:Z(["form-group",{"has-error":A.value.broadlink_entity}])},[u[35]||(u[35]=e("label",{for:"broadlink-entity"},"Remote Device *",-1)),e("div",ml,[!f.value||!E.value?z((n(),a("select",{key:0,id:"broadlink-entity",ref_key:"broadlinkSelect",ref:N,"onUpdate:modelValue":u[7]||(u[7]=V=>t.value.broadlink_entity=V),onChange:u[8]||(u[8]=V=>Se("broadlink_entity"))},[u[33]||(u[33]=e("option",{value:""},"-- Select Remote Device --",-1)),(n(!0),a(ce,null,he(s.value,V=>(n(),a("option",{key:V.entity_id,value:V.entity_id},[_(m(V.name||V.entity_id)+" ",1),V.area_name?(n(),a(ce,{key:0},[_(" - "+m(V.area_name),1)],64)):M("",!0)],8,vl))),128))],544)),[[we,t.value.broadlink_entity]]):(n(),a("input",{key:1,id:"broadlink-entity",value:h.value,type:"text",readonly:"",disabled:""},null,8,fl)),A.value.broadlink_entity?(n(),a("div",pl,[u[34]||(u[34]=e("i",{class:"mdi mdi-alert"},null,-1)),_(" "+m(A.value.broadlink_entity),1)])):M("",!0)]),!f.value||!E.value?(n(),a("small",gl,"Required: Select which remote device to use for sending commands")):(n(),a("small",yl,"Cannot change remote device after commands are learned"))],2)):M("",!0),t.value.device_type==="smartir"?(n(),a("div",bl,[u[36]||(u[36]=e("div",{class:"section-header"},[e("i",{class:"mdi mdi-cloud-download"}),e("span",null,"SmartIR Device Configuration")],-1)),ye(Uo,{ref_key:"smartirSelector",ref:j,"entity-type":t.value.entity_type,modelValue:F.value,"onUpdate:modelValue":u[9]||(u[9]=V=>F.value=V),"broadlink-devices":s.value,onChange:De},null,8,["entity-type","modelValue","broadlink-devices"])])):M("",!0)],32),e("div",hl,[e("button",{type:"button",onClick:u[10]||(u[10]=V=>S.$emit("cancel")),class:"btn btn-secondary"}," Cancel "),e("button",kl,[u[37]||(u[37]=e("i",{class:"mdi mdi-check"},null,-1)),_(" "+m(f.value?"Update":"Create"),1)])])])]))}},$l=ke(wl,[["__scopeId","data-v-94bc1fe5"]]),Cl={class:"modal-header"},_l={class:"modal-body"},Sl={class:"message-text"},Il={key:0,class:"checkbox-option"},Dl={class:"modal-footer"},xl=["disabled"],Tl={__name:"ConfirmDialog",props:{isOpen:{type:Boolean,default:!1},title:{type:String,default:"Confirm"},message:{type:String,required:!0},confirmText:{type:String,default:"OK"},cancelText:{type:String,default:"Cancel"},showCancel:{type:Boolean,default:!0},dangerMode:{type:Boolean,default:!1},confirmDisabled:{type:Boolean,default:!1},checkboxLabel:{type:String,default:""}},emits:["confirm","cancel"],setup(o,{emit:v}){const r=o,$=v,w=y(!1);pe(()=>r.isOpen,f=>{f&&(w.value=!1)});const l=()=>{$("confirm",w.value)},g=()=>{$("cancel")};return(f,C)=>o.isOpen?(n(),a("div",{key:0,class:"modal-overlay",onClick:ge(g,["self","stop"])},[e("div",{class:"modal-dialog confirm-dialog",onClick:C[1]||(C[1]=ge(()=>{},["stop"]))},[e("div",Cl,[e("h2",null,m(o.title),1)]),e("div",_l,[e("p",Sl,m(o.message),1),o.checkboxLabel?(n(),a("div",Il,[e("label",null,[z(e("input",{type:"checkbox","onUpdate:modelValue":C[0]||(C[0]=T=>w.value=T)},null,512),[[fe,w.value]]),e("span",null,m(o.checkboxLabel),1)])])):M("",!0)]),e("div",Dl,[o.showCancel?(n(),a("button",{key:0,onClick:ge(g,["stop"]),class:"btn btn-secondary"},m(o.cancelText),1)):M("",!0),o.confirmText?(n(),a("button",{key:1,onClick:ge(l,["stop"]),class:Z(["btn",o.dangerMode?"btn-danger":"btn-primary"]),disabled:o.confirmDisabled},m(o.confirmText),11,xl)):M("",!0)])])])):M("",!0)}},Le=ke(Tl,[["__scopeId","data-v-80a9de08"]]),Rl={class:"modal-content"},Ml={class:"modal-header"},Ll={class:"modal-body"},Ol={key:0,class:"smartir-info"},Al={key:0,class:"climate-note"},El={class:"form-group"},Vl=["value"],jl={class:"form-group"},Pl=["disabled"],Ul={label:"Suggested Commands"},Fl=["value"],Nl=["disabled"],Bl={class:"form-group"},Hl={class:"radio-group"},ql={class:"radio-label"},Jl=["disabled"],zl={class:"radio-label"},Gl=["disabled"],Wl={class:"learn-action"},Kl=["disabled"],Xl={key:0,class:"mdi mdi-loading mdi-spin"},Yl={key:1,class:"mdi mdi-remote-tv"},Zl={key:0,class:"learning-status"},Ql={key:1,class:"result-message success"},en={key:2,class:"section-divider"},tn={key:3,class:"learned-commands"},on={class:"command-list"},ln={class:"command-info"},nn={class:"command-name"},sn={class:"learned-status"},an={class:"command-actions"},rn=["onClick","disabled"],dn=["onClick"],un={key:4,class:"untracked-commands"},cn={class:"command-list"},mn={class:"command-name"},vn={class:"modal-footer"},fn=["disabled"],pn={__name:"CommandLearner",props:{device:{type:Object,required:!0}},emits:["cancel","learned"],setup(o,{emit:v}){const r=o,$=v,w=y([]),l=y(""),g=y(""),f=y(""),C=y("ir"),T=y(!1),E=y(""),h=y("success"),t=y([]),A=y([]),F=y(!1),j=y(""),x=y(!1),s=y(null),d=y(null),c=y(""),N=y(""),Q=J(()=>r.device.device_type==="smartir");J(()=>{if(Q.value)return!1;const G=g.value==="__custom__"?f.value:g.value;return l.value&&G.trim()});const ne=()=>{s.value&&s.value.setCustomValidity("")},le=()=>{d.value&&d.value.setCustomValidity("")},me=J(()=>{const G=w.value.find(b=>b.entity_id===l.value);return G?G.name||G.entity_id:l.value}),L={light:["turn_on","turn_off","toggle","brightness_up","brightness_down","dim","bright"],fan:["turn_on","turn_off","toggle","speed_low","speed_medium","speed_high","speed_1","speed_2","speed_3","speed_4","speed_5","oscillate_on","oscillate_off","direction_forward","direction_reverse"],switch:["turn_on","turn_off","toggle"],media_player:["turn_on","turn_off","toggle","volume_up","volume_down","volume_mute","play","pause","stop","play_pause","next_track","previous_track","channel_up","channel_down","source_hdmi1","source_hdmi2","source_hdmi3","source_tv","source_aux","source_bluetooth","menu","home","back","select","arrow_up","arrow_down","arrow_left","arrow_right"],cover:["open","close","stop","open_tilt","close_tilt","position_0","position_25","position_50","position_75","position_100"]},B=J(()=>{const G=r.device.entity_type||"switch";return L[G]||L.switch});Te(async()=>{await ee(),await de(),await u(),s.value&&(s.value.setCustomValidity(""),s.value.oninvalid=()=>{s.value.setCustomValidity("Command name is required")}),r.device.broadlink_entity&&(l.value=r.device.broadlink_entity)}),pe(g,async G=>{G==="__custom__"&&(await Ge(),d.value&&(d.value.setCustomValidity(""),d.value.oninvalid=()=>{d.value.setCustomValidity("Custom command name is required")}))});const ee=async()=>{try{const G=await ue.get("/api/broadlink/devices");w.value=G.data.devices||[]}catch(G){console.error("Error loading Broadlink devices:",G)}},de=async()=>{try{if(Q.value){const G=await ue.get("/api/smartir/codes/code",{params:{entity_type:r.device.entity_type,code_id:r.device.device_code}});if(G.data.success&&G.data.code){const b=G.data.code.commands||{},p=G.data.code.commandType||"ir";if(r.device.entity_type==="climate"){const X=[];for(const[ae,q]of Object.entries(b))typeof q=="string"?X.push({name:ae,type:p}):typeof q=="object"&&q!==null&&Object.keys(q).sort((oe,Y)=>parseInt(oe)-parseInt(Y)).forEach(oe=>{X.push({name:`${ae}_${oe}`,type:p,label:`${ae.charAt(0).toUpperCase()+ae.slice(1)} ${oe}Â°C`})});t.value=X}else t.value=Object.keys(b).map(X=>({name:X,type:p}))}}else{if(console.log("ğŸ“‹ Loading commands for device:",r.device),console.log("ğŸ“‹ Device commands:",r.device.commands),console.log("ğŸ“‹ Device ID:",r.device.id),r.device.commands&&Object.keys(r.device.commands).length>0)console.log("âœ… Using commands from device object"),t.value=Object.entries(r.device.commands).map(([G,b])=>({name:G,type:b.command_type||b.type||"ir"}));else if(r.device.id){console.log("ğŸŒ Fetching commands from API for device ID:",r.device.id);const b=(await ue.get(`/api/commands/${r.device.id}`)).data.commands||{};t.value=Object.entries(b).map(([p,X])=>({name:p,type:X.command_type||X.type||"ir"}))}else console.log("âš ï¸ No commands found and no device ID");console.log("ğŸ“‹ Final learned commands:",t.value)}}catch(G){console.error("Error loading commands:",G)}},be=async()=>{var G,b;E.value="",h.value="",T.value=!0;try{let p=r.device.id.split(".")[1];r.device.device&&(p=r.device.device);const X=g.value==="__custom__"?f.value:g.value,ae=await ue.post("/api/commands/learn",{entity_id:l.value,device:p,device_id:r.device.id,command:X.trim(),command_type:C.value});if(ae.data.success){E.value=`Command "${X}" learned successfully!`,h.value="success",t.value.includes(X)||t.value.push(X);const q=A.value.indexOf(X);q>-1&&A.value.splice(q,1);const I={...r.device.commands};I[X]=!0,g.value="",f.value="",$("learned",{commands:I,commandName:X})}else E.value=ae.data.error||"Failed to learn command",h.value="error"}catch(p){E.value=((b=(G=p.response)==null?void 0:G.data)==null?void 0:b.error)||"Error learning command",h.value="error"}finally{T.value=!1}},Se=async G=>{try{N.value=G,c.value="";let b=r.device.id.split(".")[1];r.device.device&&(b=r.device.device);const p=Q.value?r.device.controller_device:l.value||r.device.broadlink_entity;if(!p){console.error("Missing entity_id for test command:",{isSmartIR:Q.value,controller_device:r.device.controller_device,broadlink_entity:r.device.broadlink_entity,selectedBroadlink:l.value,device:r.device}),E.value="Missing Broadlink remote entity. Please select a Broadlink device.",h.value="error",N.value="";return}(await ue.post("/api/commands/test",{entity_id:p,device:b,command:G,device_id:r.device.id})).data.success&&(c.value=G,setTimeout(()=>{c.value===G&&(c.value="")},2e3))}catch(b){E.value=`Failed to send command: ${b.message}`,h.value="error"}finally{N.value=""}},Ie=G=>{j.value=G,F.value=!0},De=()=>{F.value=!1,j.value=""},S=async()=>{const G=j.value;F.value=!1;try{await ue.delete(`/api/commands/${r.device.id}/${G}`),await de(),await u(),E.value=`Command "${G}" deleted`,h.value="success",$("learned")}catch(b){E.value=`Failed to delete command: ${b.message}`,h.value="error"}finally{j.value=""}},u=async()=>{try{const G=r.device.device||r.device.id.split(".")[1],p=(await ue.get("/api/commands/untracked")).data.untracked||{};p[G]?A.value=Object.keys(p[G].commands):A.value=[]}catch(G){console.error("Error loading untracked commands:",G),A.value=[]}},V=()=>{A.value.length!==0&&(x.value=!0)},ie=async()=>{x.value=!1;try{const G=r.device.device||r.device.id.split(".")[1],b=await ue.post("/api/commands/import",{device_id:r.device.id,source_device:G,commands:A.value});b.data.success&&(E.value=`Imported ${b.data.imported_count} commands successfully!`,h.value="success",await de(),await u(),$("learned"))}catch(G){E.value=`Failed to import commands: ${G.message}`,h.value="error"}};return(G,b)=>(n(),a("div",{class:"modal-overlay",onClick:b[7]||(b[7]=ge(p=>G.$emit("cancel"),["self"]))},[e("div",Rl,[e("div",Ml,[e("h2",null,m(Q.value?"Commands for":"Learn Commands for")+" "+m(o.device.name),1),e("button",{onClick:b[0]||(b[0]=p=>G.$emit("cancel")),class:"close-btn"},[...b[8]||(b[8]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Ll,[Q.value?(n(),a("div",Ol,[b[13]||(b[13]=e("i",{class:"mdi mdi-information"},null,-1)),e("div",null,[b[12]||(b[12]=e("h3",null,"SmartIR Device",-1)),e("p",null,[b[9]||(b[9]=_("This device uses SmartIR code file ",-1)),e("strong",null,m(o.device.device_code),1),b[10]||(b[10]=_(". Commands are pre-configured and cannot be learned.",-1))]),o.device.entity_type==="climate"?(n(),a("p",Al,[...b[11]||(b[11]=[e("i",{class:"mdi mdi-alert-circle-outline"},null,-1),e("strong",null,"Note:",-1),_(" Climate device commands are temperature-based. Testing individual modes may not work as expected. Use the Home Assistant climate card to control your device. ",-1)])])):M("",!0)])])):(n(),a("form",{key:1,onSubmit:ge(be,["prevent"])},[e("div",El,[b[14]||(b[14]=e("label",{for:"broadlink-entity"},"Broadlink Device",-1)),e("input",{id:"broadlink-entity",value:me.value,type:"text",readonly:"",disabled:""},null,8,Vl),b[15]||(b[15]=e("small",null,"Commands will be learned using this device (set when device was created)",-1))]),e("div",jl,[b[18]||(b[18]=e("label",{for:"command-name"},"Command Name *",-1)),z(e("select",{id:"command-name",ref_key:"commandSelect",ref:s,"onUpdate:modelValue":b[1]||(b[1]=p=>g.value=p),disabled:T.value,required:"",onChange:ne},[b[16]||(b[16]=e("option",{value:""},"-- Select or type command --",-1)),e("optgroup",Ul,[(n(!0),a(ce,null,he(B.value,p=>(n(),a("option",{key:p,value:p},m(p),9,Fl))),128))]),b[17]||(b[17]=e("option",{value:"__custom__"},"Custom command...",-1))],40,Pl),[[we,g.value]]),g.value==="__custom__"?z((n(),a("input",{key:0,ref_key:"customCommandInput",ref:d,"onUpdate:modelValue":b[2]||(b[2]=p=>f.value=p),type:"text",placeholder:"Enter custom command name",disabled:T.value,required:"",class:"custom-command-input",onInput:le},null,40,Nl)),[[_e,f.value]]):M("",!0),e("small",null,"Select a suggested command for "+m(o.device.entity_type||"this device")+", or enter a custom one.",1)]),e("div",Bl,[b[21]||(b[21]=e("label",null,"Command Type",-1)),e("div",Hl,[e("label",ql,[z(e("input",{type:"radio","onUpdate:modelValue":b[3]||(b[3]=p=>C.value=p),value:"ir",disabled:T.value},null,8,Jl),[[Ue,C.value]]),b[19]||(b[19]=e("span",null,"IR (Infrared)",-1))]),e("label",zl,[z(e("input",{type:"radio","onUpdate:modelValue":b[4]||(b[4]=p=>C.value=p),value:"rf",disabled:T.value},null,8,Gl),[[Ue,C.value]]),b[20]||(b[20]=e("span",null,"RF (Radio Frequency)",-1))])])]),e("div",Wl,[e("button",{type:"submit",class:"btn btn-primary btn-large",disabled:T.value},[T.value?(n(),a("i",Xl)):(n(),a("i",Yl)),_(" "+m(T.value?"Learning...":"Learn Command"),1)],8,Kl)]),T.value?(n(),a("div",Zl,[...b[22]||(b[22]=[e("i",{class:"mdi mdi-loading mdi-spin"},null,-1),e("p",null,"Point your remote at the Broadlink device and press the button...",-1),e("small",null,"This may take up to 30 seconds",-1)])])):M("",!0),E.value&&h.value==="success"&&!E.value.includes("sent successfully")?(n(),a("div",Ql,[b[23]||(b[23]=e("i",{class:"mdi mdi-check-circle"},null,-1)),e("p",null,m(E.value),1)])):M("",!0)],32)),t.value.length>0||A.value.length>0?(n(),a("div",en)):M("",!0),t.value.length>0?(n(),a("div",tn,[e("h3",null,"Tracked Commands ("+m(t.value.length)+")",1),e("div",on,[(n(!0),a(ce,null,he(t.value,p=>(n(),a("div",{key:p.name,class:"command-item"},[e("div",ln,[e("span",nn,m(p.label||p.name),1)]),e("div",sn,[b[24]||(b[24]=e("i",{class:"mdi mdi-check-circle"},null,-1)),b[25]||(b[25]=e("span",null,"Learned",-1)),e("span",{class:Z(["command-type-badge",p.type||"ir"])},m((p.type||"ir").toUpperCase()),3)]),e("div",an,[e("button",{type:"button",onClick:X=>Se(p.name),class:"icon-btn",title:"Test command",disabled:N.value===p.name},[e("i",{class:Z(["mdi mdi-play",{"mdi-spin":N.value===p.name}])},null,2)],8,rn),e("button",{type:"button",onClick:X=>Ie(p.name),class:"icon-btn danger",title:"Delete and re-learn"},[...b[26]||(b[26]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,dn)])]))),128))])])):M("",!0),A.value.length>0?(n(),a("div",un,[e("h3",null,[b[27]||(b[27]=e("i",{class:"mdi mdi-alert"},null,-1)),_(" Untracked Commands ("+m(A.value.length)+") ",1)]),b[30]||(b[30]=e("p",{class:"untracked-info"}," These commands exist in Broadlink storage but are not tracked in this device. ",-1)),e("div",cn,[(n(!0),a(ce,null,he(A.value,p=>(n(),a("div",{key:p,class:"command-item untracked"},[e("span",mn,m(p),1),b[28]||(b[28]=e("span",{class:"untracked-badge"},"Not tracked",-1))]))),128))]),e("button",{type:"button",onClick:V,class:"btn btn-secondary"},[...b[29]||(b[29]=[e("i",{class:"mdi mdi-import"},null,-1),_(" Import All Untracked Commands ",-1)])])])):M("",!0)]),e("div",vn,[e("button",{type:"button",onClick:b[5]||(b[5]=p=>G.$emit("cancel")),class:"btn btn-secondary",disabled:T.value}," Close ",8,fn)])]),ye(Le,{isOpen:F.value,title:"Delete Command?",message:`Delete command '${j.value}'? This will remove it from Broadlink storage.`,confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,onConfirm:S,onCancel:De},null,8,["isOpen","message"]),ye(Le,{isOpen:x.value,title:"Import Commands?",message:`Import ${A.value.length} untracked command${A.value.length>1?"s":""} into this device?`,confirmText:"Import",cancelText:"Cancel",onConfirm:ie,onCancel:b[6]||(b[6]=p=>x.value=!1)},null,8,["isOpen","message"])]))}},gn=ke(pn,[["__scopeId","data-v-6fd4627e"]]),yn={class:"modal-container error-dialog"},bn={class:"modal-header"},hn={class:"modal-body"},kn={class:"error-message"},wn={key:0,class:"error-suggestion"},$n=["open"],Cn={class:"debug-content"},_n={class:"debug-info"},Sn={key:0,class:"debug-section-title"},In={key:1},Dn={__name:"ErrorDialog",props:{isOpen:{type:Boolean,default:!1},title:{type:String,default:"Error"},message:{type:String,required:!0},suggestion:{type:String,default:""},details:{type:String,default:""},error:{type:Object,default:null},context:{type:Object,default:()=>({})}},emits:["close"],setup(o,{emit:v}){const r=o,$=v,w=$e("toast"),l=y(!1),g=()=>{$("close")},f=J(()=>{var A,F,j,x,s,d,c,N,Q,ne,le;const h=new Date().toISOString(),t=r.error||{};return{error:JSON.stringify({message:r.message,title:r.title,details:r.details,errorObject:t.message||t.toString(),timestamp:h},null,2),request:JSON.stringify({method:((F=(A=t.config)==null?void 0:A.method)==null?void 0:F.toUpperCase())||"N/A",url:((j=t.config)==null?void 0:j.url)||"N/A",baseURL:((x=t.config)==null?void 0:x.baseURL)||"N/A",headers:((s=t.config)==null?void 0:s.headers)||{},data:(d=t.config)!=null&&d.data?JSON.parse(t.config.data):"N/A",params:((c=t.config)==null?void 0:c.params)||{}},null,2),response:JSON.stringify({status:((N=t.response)==null?void 0:N.status)||"N/A",statusText:((Q=t.response)==null?void 0:Q.statusText)||"N/A",data:((ne=t.response)==null?void 0:ne.data)||"N/A",headers:((le=t.response)==null?void 0:le.headers)||{}},null,2),browser:JSON.stringify({userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language,cookieEnabled:navigator.cookieEnabled,onLine:navigator.onLine,viewport:`${window.innerWidth}x${window.innerHeight}`,screenResolution:`${window.screen.width}x${window.screen.height}`,colorDepth:window.screen.colorDepth,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,timestamp:h},null,2),appState:JSON.stringify({currentRoute:window.location.pathname,currentURL:window.location.href,referrer:document.referrer||"N/A",context:r.context||{},localStorage:{smartir_simulate:localStorage.getItem("smartir_simulate_not_installed"),theme:localStorage.getItem("theme")}},null,2),stackTrace:t.stack||null}}),C=async()=>{const h=E();try{await navigator.clipboard.writeText(h),w==null||w.success("Debug information copied to clipboard","âœ… Copied")}catch(t){console.error("Failed to copy:",t),w==null||w.error("Failed to copy to clipboard","âŒ Copy Failed")}},T=()=>{const h=E(),t=new Blob([h],{type:"text/plain"}),A=URL.createObjectURL(t),F=document.createElement("a");F.href=A;const j=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5);F.download=`broadlink-manager-error-${j}.txt`,document.body.appendChild(F),F.click(),document.body.removeChild(F),URL.revokeObjectURL(A),w==null||w.success("Debug report downloaded","âœ… Downloaded")},E=()=>`Broadlink Manager - Error Report
${"=".repeat(60)}

Generated: ${new Date().toISOString()}
Title: ${r.title}
Message: ${r.message}
${r.suggestion?`Suggestion: ${r.suggestion}
`:""}
${"=".repeat(60)}

ERROR DETAILS
${"-".repeat(60)}
${f.value.error}

REQUEST INFORMATION
${"-".repeat(60)}
${f.value.request}

RESPONSE INFORMATION
${"-".repeat(60)}
${f.value.response}

BROWSER INFORMATION
${"-".repeat(60)}
${f.value.browser}

APPLICATION STATE
${"-".repeat(60)}
${f.value.appState}

${f.value.stackTrace?`STACK TRACE
${"-".repeat(60)}
${f.value.stackTrace}

`:""}
${"=".repeat(60)}
End of Report
`;return pe(()=>r.isOpen,h=>{if(h){const t=A=>{A.key==="Escape"&&g()};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)}}),(h,t)=>(n(),Re(We,{to:"body"},[ye(ze,{name:"modal"},{default:Ne(()=>[o.isOpen?(n(),a("div",{key:0,class:"modal-overlay",onClick:ge(g,["self"])},[e("div",yn,[e("div",bn,[t[2]||(t[2]=e("div",{class:"header-icon error-icon"},[e("i",{class:"mdi mdi-alert-circle"})],-1)),e("h3",null,m(o.title),1),e("button",{onClick:g,class:"close-button"},[...t[1]||(t[1]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",hn,[e("p",kn,m(o.message),1),o.suggestion?(n(),a("p",wn,[t[3]||(t[3]=e("i",{class:"mdi mdi-lightbulb-on"},null,-1)),_(" "+m(o.suggestion),1)])):M("",!0),e("details",{class:"debug-section",open:l.value},[e("summary",{onClick:t[0]||(t[0]=A=>l.value=!l.value)},[e("i",{class:Z(["mdi",l.value?"mdi-chevron-down":"mdi-chevron-right"])},null,2),t[4]||(t[4]=_(" Debug Information ",-1))]),e("div",Cn,[e("div",{class:"debug-actions"},[e("button",{onClick:C,class:"btn-debug btn-copy"},[...t[5]||(t[5]=[e("i",{class:"mdi mdi-content-copy"},null,-1),_(" Copy to Clipboard ",-1)])]),e("button",{onClick:T,class:"btn-debug btn-download"},[...t[6]||(t[6]=[e("i",{class:"mdi mdi-download"},null,-1),_(" Download Report ",-1)])])]),e("div",_n,[t[7]||(t[7]=e("div",{class:"debug-section-title"},"Error Details",-1)),e("pre",null,m(f.value.error),1),t[8]||(t[8]=e("div",{class:"debug-section-title"},"Request Information",-1)),e("pre",null,m(f.value.request),1),t[9]||(t[9]=e("div",{class:"debug-section-title"},"Response Information",-1)),e("pre",null,m(f.value.response),1),t[10]||(t[10]=e("div",{class:"debug-section-title"},"Browser Information",-1)),e("pre",null,m(f.value.browser),1),t[11]||(t[11]=e("div",{class:"debug-section-title"},"Application State",-1)),e("pre",null,m(f.value.appState),1),f.value.stackTrace?(n(),a("div",Sn,"Stack Trace")):M("",!0),f.value.stackTrace?(n(),a("pre",In,m(f.value.stackTrace),1)):M("",!0)])])],8,$n)]),e("div",{class:"modal-footer"},[e("button",{onClick:g,class:"btn btn-primary"}," OK ")])])])):M("",!0)]),_:1})]))}},xn=ke(Dn,[["__scopeId","data-v-23858149"]]),Tn={key:0,class:"discovery-banner"},Rn={class:"banner-content"},Mn={class:"banner-text"},Ln={class:"modal-dialog"},On={class:"modal-header"},An={class:"modal-body"},En={class:"device-list"},Vn={class:"device-info"},jn={class:"device-details"},Pn={class:"command-count"},Un={class:"device-actions"},Fn=["onClick"],Nn=["onClick"],Bn={class:"modal-footer"},Hn={class:"modal-dialog modal-dialog-small"},qn={class:"modal-header"},Jn={class:"modal-body"},zn={class:"warning-message"},Gn={class:"modal-footer"},Wn=["disabled"],Kn=["disabled"],Xn={__name:"DeviceDiscovery",emits:["adopt"],setup(o,{expose:v,emit:r}){const $=Ve(),w=r,l=y([]),g=y(!1),f=y(!1),C=y(null),T=y(!1),E=J(()=>l.value.length>0);Te(async()=>{await h()});const h=async()=>{try{const j=await ue.get("/api/devices/discover");l.value=j.data.untracked_devices||[]}catch(j){console.error("Error loading untracked devices:",j),l.value=[]}},t=j=>{g.value=!1,w("adopt",j)},A=j=>{C.value=j,f.value=!0},F=async()=>{if(C.value){T.value=!0;try{const j=await ue.delete(`/api/devices/untracked/${encodeURIComponent(C.value.device_name)}`);if(j.data.success)l.value=l.value.filter(x=>x.device_name!==C.value.device_name),f.value=!1,C.value=null,console.log("Device deleted successfully");else throw new Error(j.data.error||"Failed to delete device")}catch(j){console.error("Error deleting device:",j),$.error(`Failed to delete device: ${j.message}`)}finally{T.value=!1}}};return v({refresh:h}),(j,x)=>{var s,d,c;return E.value?(n(),a("div",Tn,[e("div",Rn,[x[9]||(x[9]=e("div",{class:"banner-icon"},[e("i",{class:"mdi mdi-radar"})],-1)),e("div",Mn,[x[7]||(x[7]=e("h3",null,"Untracked Devices Found",-1)),e("p",null,m(l.value.length)+" device"+m(l.value.length>1?"s":"")+" with learned commands found in Broadlink storage",1)]),e("button",{onClick:x[0]||(x[0]=N=>g.value=!0),class:"btn btn-primary"},[...x[8]||(x[8]=[e("i",{class:"mdi mdi-eye"},null,-1),_(" View Devices ",-1)])])]),g.value?(n(),a("div",{key:0,class:"modal-overlay",onClick:x[3]||(x[3]=ge(N=>g.value=!1,["self"]))},[e("div",Ln,[e("div",On,[x[11]||(x[11]=e("h2",null,"Discovered Devices",-1)),e("button",{onClick:x[1]||(x[1]=N=>g.value=!1),class:"close-btn"},[...x[10]||(x[10]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",An,[x[16]||(x[16]=e("p",{class:"info-text"}," These devices have learned commands in Broadlink storage but are not being tracked. Adopt them to manage their commands and generate Home Assistant entities. ",-1)),e("div",En,[(n(!0),a(ce,null,he(l.value,N=>(n(),a("div",{key:N.device_name,class:"discovered-device"},[e("div",Vn,[x[13]||(x[13]=e("div",{class:"device-icon"},[e("i",{class:"mdi mdi-devices"})],-1)),e("div",jn,[e("h4",null,m(N.device_name),1),e("span",Pn,[x[12]||(x[12]=e("i",{class:"mdi mdi-remote"},null,-1)),_(" "+m(N.command_count)+" command"+m(N.command_count>1?"s":""),1)])])]),e("div",Un,[e("button",{onClick:Q=>t(N),class:"btn btn-primary"},[...x[14]||(x[14]=[e("i",{class:"mdi mdi-plus"},null,-1),_(" Adopt ",-1)])],8,Fn),e("button",{onClick:Q=>A(N),class:"btn btn-danger",title:"Delete all commands"},[...x[15]||(x[15]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,Nn)])]))),128))])]),e("div",Bn,[e("button",{onClick:x[2]||(x[2]=N=>g.value=!1),class:"btn btn-secondary"}," Close ")])])])):M("",!0),f.value?(n(),a("div",{key:1,class:"modal-overlay",onClick:x[6]||(x[6]=ge(N=>f.value=!1,["self"]))},[e("div",Hn,[e("div",qn,[x[18]||(x[18]=e("h2",null,"Delete Untracked Device",-1)),e("button",{onClick:x[4]||(x[4]=N=>f.value=!1),class:"close-btn"},[...x[17]||(x[17]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Jn,[e("div",zn,[x[20]||(x[20]=e("i",{class:"mdi mdi-alert"},null,-1)),e("div",null,[e("p",null,[e("strong",null,'Are you sure you want to delete "'+m((s=C.value)==null?void 0:s.device_name)+'"?',1)]),e("p",null,"This will permanently delete all "+m((d=C.value)==null?void 0:d.command_count)+" command"+m(((c=C.value)==null?void 0:c.command_count)>1?"s":"")+" from Broadlink storage.",1),x[19]||(x[19]=e("p",{class:"warning-text"},"This action cannot be undone.",-1))])])]),e("div",Gn,[e("button",{onClick:x[5]||(x[5]=N=>f.value=!1),class:"btn btn-secondary",disabled:T.value}," Cancel ",8,Wn),e("button",{onClick:F,class:"btn btn-danger",disabled:T.value},[e("i",{class:Z(["mdi",T.value?"mdi-loading mdi-spin":"mdi-delete"])},null,2),_(" "+m(T.value?"Deleting...":"Delete"),1)],8,Kn)])])])):M("",!0)])):M("",!0)}}},Yn=ke(Xn,[["__scopeId","data-v-24463050"]]),Zn={class:"device-list-card"},Qn={class:"card-header"},es={class:"header-badges"},ts={class:"header-info"},os={class:"header-right"},ls=["disabled"],ns=["disabled"],ss={class:"card-body"},as={key:0,class:"filter-bar"},is={class:"filter-row filter-row-search"},rs={class:"filter-group filter-search"},ds={class:"filter-row filter-row-dropdowns"},us={class:"filter-group"},cs=["value"],ms={class:"filter-group"},vs=["value"],fs={class:"filter-group"},ps={key:0,class:"filter-group filter-toggle"},gs={class:"toggle-label"},ys={class:"view-toggle-group"},bs={class:"filter-results"},hs={key:1,class:"loading-state"},ks={key:2,class:"error-state"},ws={key:3,class:"empty-state"},$s={key:4,class:"device-grid"},Cs={key:6,class:"no-results"},_s={__name:"DeviceList",setup(o){const v=st(),r=Ve(),$=y(!1),w=y(!1),l=y(null),g=y(!1),f=y(null),C=y(null),T=y(!0),E=y(!1),h=y(!1),t=y(localStorage.getItem("device_view_mode")||"grid"),A=()=>{T.value=!T.value},F=y(!1),j=y({title:"Error",message:"",suggestion:"",details:"",error:null,context:{}}),x=y(!1),s=y({success:!1,title:"",message:""}),d=y({search:"",broadlinkDevice:"",area:"",entityType:"",showSmartIROnly:!1}),c=y([]),N=$e("smartirStatus"),Q=$e("smartirEnabled"),ne=J(()=>{var k;return localStorage.getItem("smartir_simulate_not_installed")==="true"?!1:((k=N==null?void 0:N.value)==null?void 0:k.installed)||!1}),le=J(()=>{const D=new Map;return v.devices.forEach(k=>{if(k.broadlink_entity){const R=c.value.find(K=>K.entity_id===k.broadlink_entity),H=R&&R.name||k.broadlink_entity;D.set(k.broadlink_entity,{entity_id:k.broadlink_entity,friendly_name:H})}}),Array.from(D.values()).sort((k,R)=>k.friendly_name.localeCompare(R.friendly_name))}),me=J(()=>{const D=new Set;return v.devices.forEach(k=>{k.area&&D.add(k.area)}),Array.from(D).sort()}),L=J(()=>{let D=v.devices;if(d.value.search){const R=d.value.search.toLowerCase();D=D.filter(H=>{var W,te,ve,xe,Me;if((W=H.name)!=null&&W.toLowerCase().includes(R)||(te=H.entity_type)!=null&&te.toLowerCase().includes(R)||(ve=H.area)!=null&&ve.toLowerCase().includes(R)||(xe=H.id)!=null&&xe.toLowerCase().includes(R)||Object.keys(H.commands||{}).some(Ee=>Ee.toLowerCase().includes(R)))return!0;const se=c.value.find(Ee=>Ee.entity_id===H.broadlink_entity);return!!((Me=se==null?void 0:se.name)!=null&&Me.toLowerCase().includes(R))})}d.value.broadlinkDevice&&(D=D.filter(R=>R.broadlink_entity===d.value.broadlinkDevice||R.controller_device===d.value.broadlinkDevice)),d.value.area&&(D=D.filter(R=>R.area===d.value.area)),d.value.entityType&&(D=D.filter(R=>R.entity_type===d.value.entityType)),d.value.showSmartIROnly&&(D=D.filter(R=>R.device_type==="smartir"));const k=localStorage.getItem("smartir_simulate_not_installed")==="true";return(!(Q!=null&&Q.value)||k)&&(D=D.filter(R=>R.device_type!=="smartir")),D}),B=J(()=>d.value.search||d.value.broadlinkDevice||d.value.area||d.value.entityType||d.value.showSmartIROnly),ee=()=>{d.value.search="",d.value.broadlinkDevice="",d.value.area="",d.value.entityType="",d.value.showSmartIROnly=!1},de=async()=>{try{const D=await ue.get("/api/remote/devices");c.value=D.data.devices||[]}catch(D){console.error("Error loading remote devices:",D)}};Te(async()=>{await Promise.all([v.loadDevices(),de()])});const be=D=>{l.value=D,$.value=!0},Se=J(()=>{if(!f.value)return"";const D=Object.keys(f.value.commands||{}).length;return D===0?"This device has no commands. The device will be removed from tracking.":`This device has ${D} learned command${D>1?"s":""}. What would you like to do?`}),Ie=J(()=>{if(!f.value)return"";const D=Object.keys(f.value.commands||{}).length;return D===0?"":`Also delete all ${D} command${D>1?"s":""} from Broadlink storage`}),De=D=>{f.value=D,g.value=!0},S=()=>{g.value=!1,f.value=null},u=async D=>{var R,H;const k=f.value;g.value=!1;try{await v.deleteDevice(k.id,D),C.value&&await C.value.refresh()}catch(K){const se=((H=(R=K.response)==null?void 0:R.data)==null?void 0:H.error)||K.message||"Unknown error";p("Failed to Delete Device",se)}finally{f.value=null}},V=async D=>{var k,R,H,K,se;try{console.log("ğŸ’¾ Saving device data:",D),console.log("ğŸ’¾ Device commands:",D.commands),console.log("ğŸ’¾ Selected device:",l.value),(k=l.value)!=null&&k.id&&l.value.id!==null?await v.updateDevice(l.value.id,D):await v.createDevice(D),ie(),C.value&&await C.value.refresh()}catch(W){let te="Failed to save device",ve="",xe="";(H=(R=W.response)==null?void 0:R.data)!=null&&H.error?(te=W.response.data.error,ve=W.response.data.suggestion||""):W.message&&(te=W.message),W.response&&(xe=`Status: ${W.response.status}
URL: ${((K=W.config)==null?void 0:K.url)||"N/A"}`),p("Failed to Save Device",te,ve,xe,W,{action:"save_device",deviceData:D,isEdit:!!((se=l.value)!=null&&se.id)})}},ie=()=>{$.value=!1,l.value=null},G=D=>{l.value=D,w.value=!0},b=()=>{w.value=!1,l.value=null},p=(D,k,R="",H="",K=null,se={})=>{j.value={title:D,message:k,suggestion:R,details:H,error:K,context:se},F.value=!0},X=()=>{F.value=!1},ae=()=>{x.value=!1},q=async D=>{if(D&&D.commands&&l.value){const k=v.devices.findIndex(R=>R.id===l.value.id);k!==-1&&(v.devices[k].commands=D.commands,console.log(`Optimistically updated device ${l.value.id} with new command: ${D.commandName}`))}v.loadDevices(),C.value&&C.value.refresh()},I=D=>{const k=D.split("_"),R=[];for(let H=0;H<k.length;H++){const K=k[H],se=k[H+1];K&&se==="s"&&k[H+2]?(R.push(K.charAt(0).toUpperCase()+K.slice(1)+"'s"),H++):K!=="s"&&R.push(K.charAt(0).toUpperCase()+K.slice(1))}return R.join(" ")},oe=(D,k)=>{const R=D.toLowerCase(),H=k.map(te=>te.toLowerCase());return R.includes("lamp")||R.includes("light")?"light":R.includes("fan")?"fan":R.includes("tv")||R.includes("stereo")||R.includes("speaker")||R.includes("receiver")?"media_player":R.includes("blind")||R.includes("curtain")||R.includes("shade")||R.includes("garage")?"cover":H.some(te=>te.includes("volume")||te.includes("channel")||te.includes("play")||te.includes("pause")||te.includes("mute"))?"media_player":H.some(te=>te.includes("fan_speed")||te.includes("fan_low")||te.includes("fan_high"))?"fan":H.some(te=>te.includes("open")||te.includes("close")||te.includes("stop"))?"cover":"switch"},Y=(D,k)=>{const R=D.toLowerCase();return R.includes("tv")?"mdi:television":R.includes("stereo")||R.includes("receiver")||R.includes("speaker")?"mdi:speaker":R.includes("lamp")?"mdi:lamp":R.includes("light")?"mdi:lightbulb":R.includes("fan")?"mdi:fan":R.includes("blind")?"mdi:blinds":R.includes("curtain")?"mdi:curtains":R.includes("garage")?"mdi:garage":{light:"mdi:lightbulb",fan:"mdi:fan",switch:"mdi:light-switch",media_player:"mdi:speaker",cover:"mdi:window-shutter"}[k]||"mdi:devices"},re=D=>{const k=D.toLowerCase().split("_");for(let K=0;K<k.length-2;K++)if(k[K+1]==="s"){const se=k.slice(K,K+3),W=I(se.join("_"));return console.log("Detected possessive area:",W,"from",D),W}const R=[["living","room"],["dining","room"],["master","bedroom"],["guest","bedroom"],["family","room"],["laundry","room"],["home","office"]];for(let K=0;K<k.length-1;K++){const se=[k[K],k[K+1]],W=R.find(te=>te[0]===se[0]&&te[1]===se[1]);if(W)return I(W.join("_"))}const H=["kitchen","bedroom","bathroom","garage","office","basement","attic","hallway","entryway","patio","deck","yard","garden"];for(const K of k)if(H.includes(K))return K.charAt(0).toUpperCase()+K.slice(1);return""},O=async D=>{const k=I(D.device_name),R=re(D.device_name),H=oe(D.device_name,D.commands),K=Y(D.device_name,H);let se="";try{console.log("Finding Broadlink owner for:",D.device_name);const te=await ue.post("/api/devices/find-broadlink-owner",{device_name:D.device_name});console.log("Broadlink owner response:",te.data),se=te.data.broadlink_entity||"",console.log("Detected Broadlink entity:",se)}catch(te){console.error("Error finding Broadlink owner:",te)}l.value={id:null,device:D.device_name,name:k,entity_type:H,commands:{},area:R,icon:K,broadlink_entity:se,enabled:!0};const W={};D.commands.forEach(te=>{W[te]=te}),l.value.commands=W,$.value=!0},i=async()=>{h.value=!0;try{await v.syncAllAreas(),r.success("Areas synced from Home Assistant")}catch(D){console.error("Error syncing areas:",D),r.error("Failed to sync areas")}finally{h.value=!1}},U=async()=>{var D,k;E.value=!0;try{const R=await ue.post("/api/entities/generate",{});if(R.data.success){const H=R.data.broadlink_count||0,K=R.data.smartir_count||0,se=R.data.total_count||0,W=R.data.errors||[];let te="âœ… Entity Generation Successful",ve=[];const xe=[];H>0&&xe.push(`${H} Broadlink native`),K>0&&xe.push(`${K} SmartIR`),xe.length>0&&ve.push(`Generated ${xe.join(" and ")} entity configuration${se!==1?"s":""}.`),H>0&&(ve.push(`
ğŸ“ Broadlink entities created in:`),ve.push("  â€¢ broadlink_manager/entities.yaml"),ve.push("  â€¢ broadlink_manager/helpers.yaml")),K>0&&(ve.push(`
ğŸ“ SmartIR entities created in:`),ve.push("  â€¢ smartir/climate.yaml"),ve.push("  â€¢ smartir/media_player.yaml"),ve.push("  â€¢ smartir/fan.yaml")),ve.push(`
ğŸ“ Next steps:`),ve.push("1. Check your configuration.yaml includes the generated files"),ve.push("2. Restart Home Assistant to load the new entities"),W.length>0&&(te="âš ï¸ Entity Generation Completed with Errors",ve.push(`
âš ï¸ ${W.length} error${W.length!==1?"s":""} occurred:`),W.forEach(Me=>{ve.push(`  â€¢ ${Me}`)})),s.value={success:!0,title:te,message:ve.join(`
`)},x.value=!0}else s.value={success:!1,title:"âŒ Entity Generation Failed",message:R.data.message||`Failed to generate entities.

Please check that you have at least one device configured.`},x.value=!0}catch(R){console.error("Error generating entities:",R);const H=((k=(D=R.response)==null?void 0:D.data)==null?void 0:k.error)||R.message||"Unknown error occurred";s.value={success:!1,title:"âŒ Entity Generation Error",message:`Failed to generate entities:

${H}

Please check the logs for more details.`},x.value=!0}finally{E.value=!1}},P=async({device:D,command:k})=>{var R,H;try{const K={device_id:D.id,command:k,entity_id:D.broadlink_entity,device:D.device};await ue.post("/api/commands/test",K),r.success(`Sent ${k} to ${D.name}`)}catch(K){console.error("Error sending command:",K);const se=((H=(R=K.response)==null?void 0:R.data)==null?void 0:H.error)||K.message||"Unknown error";r.error(`Failed to send ${k}: ${se}`)}};return(D,k)=>{var R;return n(),a("div",Zn,[e("div",Qn,[e("button",{class:"icon-button chevron-button",onClick:A},[e("i",{class:Z(["mdi",T.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2)]),e("div",{class:"header-left",onClick:A},[k[10]||(k[10]=e("div",{class:"header-icon"},[e("i",{class:"mdi mdi-devices"})],-1)),k[11]||(k[11]=e("h3",null,"Managed Devices",-1)),e("div",es,[e("span",ts,m(Ce(v).deviceCount)+" devices",1)])]),e("div",os,[T.value?(n(),a("button",{key:0,onClick:ge(i,["stop"]),class:"btn btn-secondary",disabled:h.value,title:"Sync all areas from Home Assistant"},[e("i",{class:Z(["mdi",h.value?"mdi-loading mdi-spin":"mdi-refresh"])},null,2),_(" "+m(h.value?"Syncing...":"Sync Areas"),1)],8,ls)):M("",!0),T.value?(n(),a("button",{key:1,onClick:ge(U,["stop"]),class:"btn btn-secondary",disabled:E.value,title:"Generate entities for all devices"},[e("i",{class:Z(["mdi",E.value?"mdi-loading mdi-spin":"mdi-file-code"])},null,2),_(" "+m(E.value?"Generating...":"Generate Entities"),1)],8,ns)):M("",!0),T.value?(n(),a("button",{key:2,onClick:k[0]||(k[0]=ge(H=>$.value=!0,["stop"])),class:"btn btn-primary"},[...k[12]||(k[12]=[e("i",{class:"mdi mdi-plus"},null,-1),_(" Add Device ",-1)])])):M("",!0)])]),z(e("div",ss,[ye(Yn,{ref_key:"discoveryRef",ref:C,onAdopt:O},null,512),Ce(v).hasDevices?(n(),a("div",as,[e("div",is,[e("div",rs,[e("label",null,[k[13]||(k[13]=e("i",{class:"mdi mdi-magnify"},null,-1)),z(e("input",{"onUpdate:modelValue":k[1]||(k[1]=H=>d.value.search=H),type:"text",placeholder:"Search devices, commands...",class:"search-input"},null,512),[[_e,d.value.search]])])])]),e("div",ds,[e("div",us,[e("label",null,[k[15]||(k[15]=e("i",{class:"mdi mdi-access-point"},null,-1)),z(e("select",{"onUpdate:modelValue":k[2]||(k[2]=H=>d.value.broadlinkDevice=H)},[k[14]||(k[14]=e("option",{value:""},"All Controller Devices",-1)),(n(!0),a(ce,null,he(le.value,H=>(n(),a("option",{key:H.entity_id,value:H.entity_id},m(H.friendly_name),9,cs))),128))],512),[[we,d.value.broadlinkDevice]])])]),e("div",ms,[e("label",null,[k[17]||(k[17]=e("i",{class:"mdi mdi-home-map-marker"},null,-1)),z(e("select",{"onUpdate:modelValue":k[3]||(k[3]=H=>d.value.area=H)},[k[16]||(k[16]=e("option",{value:""},"All Areas",-1)),(n(!0),a(ce,null,he(me.value,H=>(n(),a("option",{key:H,value:H},m(H),9,vs))),128))],512),[[we,d.value.area]])])]),e("div",fs,[e("label",null,[k[19]||(k[19]=e("i",{class:"mdi mdi-shape"},null,-1)),z(e("select",{"onUpdate:modelValue":k[4]||(k[4]=H=>d.value.entityType=H)},[...k[18]||(k[18]=[Oe('<option value="" data-v-320d08f3>All Types</option><option value="light" data-v-320d08f3>Light</option><option value="fan" data-v-320d08f3>Fan</option><option value="switch" data-v-320d08f3>Switch</option><option value="media_player" data-v-320d08f3>Media Player</option><option value="cover" data-v-320d08f3>Cover</option><option value="climate" data-v-320d08f3>Climate</option>',7)])],512),[[we,d.value.entityType]])])]),ne.value?(n(),a("div",ps,[e("label",gs,[k[20]||(k[20]=e("span",{class:"toggle-text"},[e("img",{src:Be,alt:"SmartIR",class:"smartir-icon"}),_(" SmartIR Only ")],-1)),z(e("input",{type:"checkbox","onUpdate:modelValue":k[5]||(k[5]=H=>d.value.showSmartIROnly=H),class:"toggle-checkbox"},null,512),[[fe,d.value.showSmartIROnly]]),k[21]||(k[21]=e("span",{class:"toggle-slider"},null,-1))])])):M("",!0),B.value?(n(),a("button",{key:1,onClick:ee,class:"btn-clear-filters"},[...k[22]||(k[22]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),_(" Clear ",-1)])])):M("",!0),e("div",ys,[e("button",{onClick:k[6]||(k[6]=H=>t.value="grid"),class:Z(["view-toggle-btn",{active:t.value==="grid"}]),title:"Grid View"},[...k[23]||(k[23]=[e("i",{class:"mdi mdi-view-grid"},null,-1),_(" Grid ",-1)])],2),e("button",{onClick:k[7]||(k[7]=H=>t.value="list"),class:Z(["view-toggle-btn",{active:t.value==="list"}]),title:"List View"},[...k[24]||(k[24]=[e("i",{class:"mdi mdi-view-list"},null,-1),_(" List ",-1)])],2)]),e("div",bs,m(L.value.length)+" of "+m(Ce(v).deviceCount),1)])])):M("",!0),Ce(v).loading?(n(),a("div",hs,[...k[25]||(k[25]=[e("i",{class:"mdi mdi-loading mdi-spin"},null,-1),e("p",null,"Loading devices...",-1)])])):Ce(v).error?(n(),a("div",ks,[k[26]||(k[26]=e("i",{class:"mdi mdi-alert-circle"},null,-1)),e("p",null,m(Ce(v).error),1),e("button",{onClick:k[8]||(k[8]=H=>Ce(v).loadDevices()),class:"btn btn-secondary"}," Retry ")])):Ce(v).hasDevices?M("",!0):(n(),a("div",ws,[k[28]||(k[28]=e("i",{class:"mdi mdi-devices"},null,-1)),k[29]||(k[29]=e("h3",null,"No Devices Yet",-1)),k[30]||(k[30]=e("p",null,"Get started by adding your first managed device",-1)),e("button",{onClick:k[9]||(k[9]=H=>$.value=!0),class:"btn btn-primary"},[...k[27]||(k[27]=[e("i",{class:"mdi mdi-plus"},null,-1),_(" Add Your First Device ",-1)])])])),t.value==="grid"?(n(),a("div",$s,[(n(!0),a(ce,null,he(L.value,H=>(n(),Re(xt,{key:H.id,device:H,"broadlink-devices":c.value,onEdit:be,onDelete:De,onLearn:G},null,8,["device","broadlink-devices"]))),128))])):t.value==="list"&&L.value.length>0?(n(),Re(Gt,{key:5,devices:L.value,onSendCommand:P,onEditDevice:be,onDeleteDevice:De},null,8,["devices"])):M("",!0),Ce(v).hasDevices&&L.value.length===0?(n(),a("div",Cs,[...k[31]||(k[31]=[e("i",{class:"mdi mdi-filter-off"},null,-1),e("h3",null,"No devices match your filters",-1),e("p",null,"Try adjusting your search or filter criteria",-1)])])):M("",!0)],512),[[Ke,T.value]]),$.value?(n(),Re($l,{key:0,device:l.value,onSave:V,onCancel:ie},null,8,["device"])):M("",!0),w.value?(n(),Re(gn,{key:1,device:l.value,onLearned:q,onCancel:b},null,8,["device"])):M("",!0),ye(Le,{isOpen:g.value,title:`Delete ${(R=f.value)==null?void 0:R.name}?`,message:Se.value,confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,checkboxLabel:Ie.value,onConfirm:u,onCancel:S},null,8,["isOpen","title","message","checkboxLabel"]),ye(xn,{isOpen:F.value,title:j.value.title,message:j.value.message,suggestion:j.value.suggestion,details:j.value.details,error:j.value.error,context:j.value.context,onClose:X},null,8,["isOpen","title","message","suggestion","details","error","context"]),ye(Le,{isOpen:x.value,title:s.value.title,message:s.value.message,confirmText:"OK",showCancel:!1,dangerMode:!s.value.success,onConfirm:ae,onCancel:ae},null,8,["isOpen","title","message","dangerMode"])])}}},Ss=ke(_s,[["__scopeId","data-v-320d08f3"]]),Is={class:"banner-content"},Ds={class:"banner-icon"},xs={class:"banner-message"},Ts={class:"banner-actions"},Rs={__name:"SmartIRBanner",setup(o){const v=$e("smartirStatus"),r=y(!1),$=J(()=>!(!v.value||r.value||localStorage.getItem("smartir_banner_dismissed")==="true")),w=J(()=>{var E;return(E=v.value)!=null&&E.installed?"banner-success":"banner-info"}),l=J(()=>{var E;return(E=v.value)!=null&&E.installed?"mdi mdi-check-circle":"mdi mdi-information"}),g=J(()=>{var E;return(E=v.value)!=null&&E.installed?`SmartIR Detected (v${v.value.version})`:"Want Climate Device Support?"}),f=J(()=>{var E;return(E=v.value)!=null&&E.installed?"You can now create climate device profiles with full temperature and HVAC mode control.":"Install SmartIR to unlock AC/heater control with temperature settings, HVAC modes, and 120+ pre-configured device profiles."});function C(){window.open("https://github.com/smartHomeHub/SmartIR","_blank")}function T(){var E;if(r.value=!0,(E=v.value)!=null&&E.installed)localStorage.setItem("smartir_banner_dismissed","true");else{const h=parseInt(localStorage.getItem("smartir_banner_dismiss_count")||"0");h>=2?localStorage.setItem("smartir_banner_dismissed","true"):localStorage.setItem("smartir_banner_dismiss_count",String(h+1))}}return Te(()=>{var t;const E=localStorage.getItem("smartir_last_status"),h=(t=v.value)!=null&&t.installed?"installed":"not_installed";E!==h&&(localStorage.removeItem("smartir_banner_dismissed"),localStorage.removeItem("smartir_banner_dismiss_count"),localStorage.setItem("smartir_last_status",h))}),(E,h)=>{var t,A;return $.value?(n(),a("div",{key:0,class:Z(["smartir-banner",w.value])},[e("div",Is,[e("div",Ds,[e("i",{class:Z(l.value)},null,2)]),e("div",xs,[e("strong",null,m(g.value),1),e("p",null,m(f.value),1)]),e("div",Ts,[(t=E.status)!=null&&t.installed?M("",!0):(n(),a("button",{key:0,onClick:C,class:"btn-primary"}," Learn More ")),e("button",{onClick:T,class:"btn-text"},m((A=E.status)!=null&&A.installed?"Got it":"Dismiss"),1)])])],2)):M("",!0)}}},Ms=ke(Rs,[["__scopeId","data-v-7bbcbcd7"]]),Ae="api/smartir",Ye={async getStatus(){try{const o=await fetch(`${Ae}/status`);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return await o.json()}catch(o){return console.error("Error fetching SmartIR status:",o),{installed:!1,version:null,error:o.message}}},async getInstallInstructions(){try{const o=await fetch(`${Ae}/install-instructions`);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return await o.json()}catch(o){throw console.error("Error fetching install instructions:",o),o}},async getPlatforms(){try{const o=await fetch(`${Ae}/platforms`);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return await o.json()}catch(o){throw console.error("Error fetching platforms:",o),o}},async getPlatformCodes(o){try{const v=await fetch(`${Ae}/platforms/${o}/codes`);if(!v.ok)throw new Error(`HTTP error! status: ${v.status}`);return await v.json()}catch(v){throw console.error(`Error fetching codes for ${o}:`,v),v}},async getNextCode(o){try{const v=await fetch(`${Ae}/platforms/${o}/next-code`);if(!v.ok)throw new Error(`HTTP error! status: ${v.status}`);return await v.json()}catch(v){throw console.error(`Error fetching next code for ${o}:`,v),v}},async validateCode(o,v){try{const r=await fetch(`${Ae}/validate-code`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({platform:o,code:v})});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);return await r.json()}catch(r){throw console.error("Error validating code:",r),r}}},Ls={class:"profile-card"},Os={class:"profile-card-header"},As=["title"],Es={class:"profile-details"},Vs=["title"],js={class:"profile-meta"},Ps=["title"],Us=["title"],Fs=["title"],Ns={class:"profile-card-footer"},Bs=["title"],Hs={key:0,class:"learned-indicator"},qs={class:"profile-actions"},Js={__name:"SmartIRProfileCard",props:{profile:{type:Object,required:!0}},emits:["edit","download","delete","commands"],setup(o){const v=o,r=Xe(J(()=>v.profile.platform)),$=g=>g.replace(/_/g," ").replace(/\b\w/g,f=>f.toUpperCase()),w=g=>g&&g.startsWith("mdi:")?`mdi ${g.replace(":"," mdi-")}`:`mdi mdi-${g}`,l=g=>{if(!g)return"";const f=g.toLowerCase();return f.includes("broadlink")?"broadlink-tag":f.includes("not set")?"not-set-tag":"default-controller-tag"};return(g,f)=>(n(),a("div",Ls,[e("div",Os,[e("div",{class:Z(["profile-icon",Ce(r).colorClass.value]),title:$(o.profile.platform)},[e("i",{class:Z(w(Ce(r).icon.value))},null,2)],10,As),e("div",Es,[e("h4",{title:`${o.profile.manufacturer} ${o.profile.model}`},m(o.profile.manufacturer)+" "+m(o.profile.model),9,Vs),e("div",js,[e("span",{class:"tag platform-tag",title:$(o.profile.platform)},m($(o.profile.platform)),9,Ps),o.profile.controllerBrand?(n(),a("span",{key:0,class:Z(["tag controller-tag",l(o.profile.controllerBrand)]),title:"Controller: "+o.profile.controllerBrand},[f[4]||(f[4]=e("i",{class:"mdi mdi-remote-tv"},null,-1)),_(" "+m(o.profile.controllerBrand),1)],10,Us)):M("",!0)])]),e("div",{class:"code-badge",title:"Device Code: "+o.profile.code},m(o.profile.code),9,Fs)]),e("div",Ns,[e("div",{class:"profile-stats",title:o.profile.commandCount+" total commands"+(o.profile.learnedCount>0?", "+o.profile.learnedCount+" learned":"")},[f[5]||(f[5]=e("i",{class:"mdi mdi-remote"},null,-1)),e("span",null,m(o.profile.commandCount)+" command"+m(o.profile.commandCount!==1?"s":""),1),o.profile.learnedCount>0?(n(),a("span",Hs,"( "+m(o.profile.learnedCount)+" learned )",1)):M("",!0)],8,Bs),e("div",qs,[e("button",{onClick:f[0]||(f[0]=C=>g.$emit("commands")),class:"action-btn",title:"Commands"},[...f[6]||(f[6]=[e("i",{class:"mdi mdi-remote"},null,-1)])]),e("button",{onClick:f[1]||(f[1]=C=>g.$emit("edit")),class:"action-btn",title:"Edit Profile"},[...f[7]||(f[7]=[e("i",{class:"mdi mdi-pencil"},null,-1)])]),e("button",{onClick:f[2]||(f[2]=C=>g.$emit("download")),class:"action-btn",title:"Download JSON"},[...f[8]||(f[8]=[e("i",{class:"mdi mdi-download"},null,-1)])]),e("button",{onClick:f[3]||(f[3]=C=>g.$emit("delete")),class:"action-btn delete",title:"Delete Profile"},[...f[9]||(f[9]=[e("i",{class:"mdi mdi-delete"},null,-1)])])])])]))}},zs=ke(Js,[["__scopeId","data-v-b72a1955"]]),Gs={name:"SmartIRProfileListView",props:{profiles:{type:Array,required:!0}},methods:{getPlatformIcon(o){return{climate:"mdi-thermostat",media_player:"mdi-television",fan:"mdi-fan",light:"mdi-lightbulb"}[o]||"mdi-devices"},formatPlatform(o){return{climate:"Climate",media_player:"Media Player",fan:"Fan",light:"Light"}[o]||o},editProfile(o){this.$emit("edit",o)},viewCommands(o){this.$emit("commands",o)},downloadProfile(o){this.$emit("download",o)},deleteProfile(o){this.$emit("delete",o)}}},Ws={class:"profile-list-view"},Ks={class:"profile-table"},Xs={class:"profile-code"},Ys={class:"code-badge"},Zs={class:"profile-manufacturer"},Qs={class:"profile-model"},ea={class:"model-info"},ta={class:"model-name"},oa={key:0,class:"model-count"},la={class:"profile-platform"},na={class:"profile-controller"},sa={class:"profile-commands"},aa={class:"command-stats"},ia={class:"stat-item"},ra={key:0,class:"stat-item learned"},da={class:"profile-actions"},ua=["onClick"],ca=["onClick"],ma=["onClick"],va=["onClick"];function fa(o,v,r,$,w,l){return n(),a("div",Ws,[e("table",Ks,[v[6]||(v[6]=e("thead",null,[e("tr",null,[e("th",null,"Code"),e("th",null,"Manufacturer"),e("th",null,"Model"),e("th",null,"Platform"),e("th",null,"Controller"),e("th",null,"Commands"),e("th",null,"Actions")])],-1)),e("tbody",null,[(n(!0),a(ce,null,he(r.profiles,g=>(n(),a("tr",{key:`${g.platform}-${g.code}`,class:"profile-row"},[e("td",Xs,[e("span",Ys,m(g.code),1)]),e("td",Zs,m(g.manufacturer||"Unknown"),1),e("td",Qs,[e("div",ea,[e("div",ta,m(g.model||"Unknown"),1),g.models&&g.models.length>1?(n(),a("div",oa," +"+m(g.models.length-1)+" more ",1)):M("",!0)])]),e("td",la,[e("span",{class:Z(["platform-badge",g.platform])},[e("i",{class:Z(["mdi",l.getPlatformIcon(g.platform)])},null,2),_(" "+m(l.formatPlatform(g.platform)),1)],2)]),e("td",na,m(g.controller_brand||"N/A"),1),e("td",sa,[e("div",aa,[e("span",ia,[v[0]||(v[0]=e("i",{class:"mdi mdi-remote"},null,-1)),_(" "+m(g.command_count||0),1)]),g.learned_count>0?(n(),a("span",ra,[v[1]||(v[1]=e("i",{class:"mdi mdi-school"},null,-1)),_(" "+m(g.learned_count),1)])):M("",!0)])]),e("td",da,[e("button",{class:"action-btn edit",onClick:f=>l.editProfile(g),title:"Edit Profile"},[...v[2]||(v[2]=[e("i",{class:"mdi mdi-pencil"},null,-1)])],8,ua),e("button",{class:"action-btn commands",onClick:f=>l.viewCommands(g),title:"View Commands"},[...v[3]||(v[3]=[e("i",{class:"mdi mdi-remote"},null,-1)])],8,ca),e("button",{class:"action-btn download",onClick:f=>l.downloadProfile(g),title:"Download"},[...v[4]||(v[4]=[e("i",{class:"mdi mdi-download"},null,-1)])],8,ma),e("button",{class:"action-btn delete",onClick:f=>l.deleteProfile(g),title:"Delete"},[...v[5]||(v[5]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,va)])]))),128))])])])}const pa=ke(Gs,[["render",fa],["__scopeId","data-v-8e144275"]]),ga={class:"modal-container"},ya={class:"modal-body"},ba={key:0,class:"selection-section"},ha={class:"form-group"},ka={class:"form-group"},wa={class:"form-group"},$a={key:0,class:"code-info"},Ca={class:"form-actions"},_a=["disabled"],Sa={key:1,class:"testing-section"},Ia={class:"code-header"},Da={class:"code-details"},xa={class:"code-badge"},Ta={class:"device-selector"},Ra=["value"],Ma={class:"commands-section"},La={class:"commands-header"},Oa={key:0,class:"tested-count"},Aa={key:0,class:"filters-section"},Ea={class:"filter-row"},Va={class:"filter-row"},ja={key:1,class:"empty-state"},Pa={key:2,class:"empty-state"},Ua={key:3,class:"commands-list"},Fa={class:"command-name"},Na={class:"command-actions"},Ba={key:0,class:"status-badge success"},Ha=["onClick","disabled"],qa={__name:"SmartIRCodeTester",props:{isOpen:{type:Boolean,default:!1}},emits:["close","clone"],setup(o,{emit:v}){const r=o,$=v,w=$e("toast"),l=y("climate"),g=y(""),f=y([]),C=y(!1),T=y(null),E=y(""),h=y([]),t=y(!1),A=J(()=>h.value.map(q=>({code:q.code,label:`${q.models.join(", ")} (Code: ${q.code})`,value:q.code}))),F=y(null),j=y(null),x=y(!1),s=y([]),d=y(""),c=y([]),N=y(new Set),Q=y(null),ne=y(""),le=y(""),me=y(""),L=y(""),B=J(()=>{let q=c.value;if(ne.value){const I=ne.value.toLowerCase();q=q.filter(oe=>(oe.label||oe.name).toLowerCase().includes(I))}return le.value&&(q=q.filter(I=>I.mode===le.value)),me.value&&(q=q.filter(I=>I.fanSpeed===me.value)),L.value&&(q=q.filter(I=>I.swingMode===L.value)),q}),ee=J(()=>ne.value||le.value||me.value||L.value);pe(()=>r.isOpen,q=>{q&&(de(),Se())}),pe(l,()=>{r.isOpen&&(g.value="",T.value=null,h.value=[],de())});async function de(){var q;C.value=!0;try{const I=await fetch(`/api/smartir/codes/manufacturers?entity_type=${l.value}`);if(!I.ok)throw new Error("Failed to load manufacturers");const oe=await I.json();f.value=oe.manufacturers||[]}catch(I){console.error("Error loading manufacturers:",I),(q=w.value)==null||q.error("Failed to load manufacturers","âŒ Error")}finally{C.value=!1}}async function be(){var q;if(g.value){t.value=!0;try{const I=await fetch(`/api/smartir/codes/models?entity_type=${l.value}&manufacturer=${encodeURIComponent(g.value)}`);if(!I.ok)throw new Error("Failed to load models");const oe=await I.json();h.value=oe.models||[]}catch(I){console.error("Error loading models:",I),(q=w.value)==null||q.error("Failed to load models","âŒ Error")}finally{t.value=!1}}}async function Se(){try{const q=await fetch("/api/remote/devices");if(!q.ok)throw new Error("Failed to load devices");const I=await q.json();s.value=I.devices||[]}catch(q){console.error("Error loading Broadlink devices:",q)}}async function Ie(){var q,I;if(T.value){x.value=!0;try{const oe=await fetch(`/api/smartir/codes/code?entity_type=${l.value}&code_id=${T.value.code}`);if(!oe.ok)throw new Error("Failed to load code");const Y=await oe.json();j.value=Y.code,F.value=T.value.code,De(Y.code),(q=w.value)==null||q.success(`Loaded ${c.value.length} commands`,"âœ… Code Loaded")}catch(oe){console.error("Error loading code:",oe),(I=w.value)==null||I.error(oe.message||"Failed to load code","âŒ Error")}finally{x.value=!1}}}function De(q){const I=[];if(!q.commands){c.value=I;return}if(l.value==="climate"){const Y=q.commands;for(const[re,O]of Object.entries(Y)){if(re==="off"){typeof O=="string"&&I.push({name:"off",label:"OFF",data:O,mode:"off"});continue}if(typeof O=="object"){for(const[i,U]of Object.entries(O))if(typeof U=="object")for(const[P,D]of Object.entries(U)){if(typeof D!="object")continue;const k=Object.keys(D),R=k.includes("24")?"24":k[0];if(R&&typeof D[R]=="string"){const H=`${re}_${R}_${i}_${P}`,K=`${re.toUpperCase()} ${R}Â°C ${i} ${P}`;I.push({name:H,label:K,data:D[R],mode:re,temperature:R,fanSpeed:i,swingMode:P})}}}}}else for(const[Y,re]of Object.entries(q.commands))typeof re=="string"&&I.push({name:Y,label:Y.toUpperCase().replace(/_/g," "),data:re});c.value=I}async function S(q){var I,oe,Y;if(!d.value){(I=w.value)==null||I.warning("Please select a Broadlink device first","âš ï¸ No Device");return}Q.value=q;try{const re=c.value.find(i=>i.name===q);if(!re||!re.data)throw new Error(`Command "${q}" not found`);const O=await fetch("/api/commands/send-raw",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({entity_id:d.value,command:re.data,command_type:"ir"})});if(!O.ok){const i=await O.json();throw new Error(i.error||"Failed to send command")}N.value.add(q),(oe=w.value)==null||oe.success(`Command sent: ${re.label||q}`,"âœ… Tested")}catch(re){console.error("Error testing command:",re),(Y=w.value)==null||Y.error("Failed to test command","âŒ Error")}finally{Q.value=null}}function u(){var q,I,oe,Y;if(!j.value){(q=w.value)==null||q.error("No profile data to download","âŒ Error");return}try{const re=j.value.manufacturer||"unknown",O=((I=j.value.supportedModels)==null?void 0:I[0])||F.value,i=`${re.toLowerCase().replace(/\s+/g,"_")}_${O.toLowerCase().replace(/\s+/g,"_")}.json`,U=JSON.stringify(j.value,null,2),P=new Blob([U],{type:"application/json"}),D=URL.createObjectURL(P),k=document.createElement("a");k.href=D,k.download=i,document.body.appendChild(k),k.click(),document.body.removeChild(k),URL.revokeObjectURL(D),(oe=w.value)==null||oe.success(`Downloaded ${i}`,"âœ… Download Complete")}catch(re){console.error("Error downloading JSON:",re),(Y=w.value)==null||Y.error(re.message||"Failed to download JSON","âŒ Download Error")}}function V(){g.value="",T.value=null,E.value="",h.value=[]}function ie(){T.value=null,E.value="",be()}function G(){E.value?T.value=h.value.find(q=>q.code===E.value):T.value=null}function b(){ne.value="",le.value="",me.value="",L.value=""}function p(){F.value=null,j.value=null,c.value=[],N.value.clear(),Q.value=null,b()}function X(q){const I=q.toLowerCase();return I.includes("power")||I.includes("off")||I==="off"?"mdi-power":I.includes("cool")?"mdi-snowflake":I.includes("heat")?"mdi-fire":I.includes("fan")?"mdi-fan":I.includes("auto")?"mdi-auto-fix":I.includes("dry")?"mdi-water-percent":I.includes("temp")?"mdi-thermometer":I.includes("swing")?"mdi-swap-vertical":"mdi-remote"}function ae(){p(),g.value="",T.value=null,$("close")}return(q,I)=>{var oe;return o.isOpen?(n(),a("div",{key:0,class:"modal-overlay",onClick:ge(ae,["self"])},[e("div",ga,[e("div",{class:"modal-header"},[I[9]||(I[9]=e("h3",null,[e("i",{class:"mdi mdi-test-tube"}),_(" Test SmartIR Code ")],-1)),e("button",{onClick:ae,class:"close-btn"},[...I[8]||(I[8]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",ya,[F.value?(n(),a("div",Sa,[e("div",Ia,[e("div",Da,[e("h4",null,m(j.value.manufacturer)+" - "+m(((oe=j.value.supportedModels)==null?void 0:oe[0])||"Unknown"),1),e("span",xa,"Code: "+m(F.value),1)]),e("button",{onClick:p,class:"btn-secondary-small"},[...I[14]||(I[14]=[e("i",{class:"mdi mdi-arrow-left"},null,-1),_(" Change Code ",-1)])])]),e("div",Ta,[I[16]||(I[16]=e("label",null,[e("i",{class:"mdi mdi-remote"}),_(" Broadlink Device ")],-1)),z(e("select",{"onUpdate:modelValue":I[3]||(I[3]=Y=>d.value=Y),class:"form-select"},[I[15]||(I[15]=e("option",{value:""},"Select device to test with...",-1)),(n(!0),a(ce,null,he(s.value,Y=>(n(),a("option",{key:Y.entity_id,value:Y.entity_id},m(Y.friendly_name||Y.entity_id),9,Ra))),128))],512),[[we,d.value]])]),e("div",Ma,[e("div",La,[e("h5",null,"Sample Commands ("+m(B.value.length)+" / "+m(c.value.length)+")",1),N.value.size>0?(n(),a("span",Oa,m(N.value.size)+" tested ",1)):M("",!0)]),l.value==="climate"&&c.value.length>0?(n(),a("div",Aa,[e("div",Ea,[z(e("input",{"onUpdate:modelValue":I[4]||(I[4]=Y=>ne.value=Y),type:"text",placeholder:"Search commands...",class:"search-input"},null,512),[[_e,ne.value]])]),e("div",Va,[z(e("select",{"onUpdate:modelValue":I[5]||(I[5]=Y=>le.value=Y),class:"filter-select"},[...I[17]||(I[17]=[e("option",{value:""},"All Modes",-1),e("option",{value:"cool"},"Cool",-1),e("option",{value:"heat"},"Heat",-1),e("option",{value:"off"},"Off",-1)])],512),[[we,le.value]]),z(e("select",{"onUpdate:modelValue":I[6]||(I[6]=Y=>me.value=Y),class:"filter-select"},[...I[18]||(I[18]=[Oe('<option value="" data-v-64d207ed>All Fan Speeds</option><option value="low" data-v-64d207ed>Low</option><option value="mid" data-v-64d207ed>Mid</option><option value="high" data-v-64d207ed>High</option><option value="auto" data-v-64d207ed>Auto</option>',5)])],512),[[we,me.value]]),z(e("select",{"onUpdate:modelValue":I[7]||(I[7]=Y=>L.value=Y),class:"filter-select"},[...I[19]||(I[19]=[e("option",{value:""},"All Swing",-1),e("option",{value:"stop"},"Stop",-1),e("option",{value:"swing"},"Swing",-1)])],512),[[we,L.value]]),ee.value?(n(),a("button",{key:0,onClick:b,class:"btn-clear-filters"},[...I[20]||(I[20]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),_(" Clear ",-1)])])):M("",!0)])])):M("",!0),c.value.length===0?(n(),a("div",ja,[...I[21]||(I[21]=[e("i",{class:"mdi mdi-alert-circle"},null,-1),e("p",null,"No commands found in this code",-1)])])):B.value.length===0?(n(),a("div",Pa,[I[22]||(I[22]=e("i",{class:"mdi mdi-filter-off"},null,-1)),I[23]||(I[23]=e("p",null,"No commands match your filters",-1)),e("button",{onClick:b,class:"btn-secondary-small"}," Clear Filters ")])):(n(),a("div",Ua,[(n(!0),a(ce,null,he(B.value,Y=>(n(),a("div",{key:Y.name,class:Z(["command-item",{tested:N.value.has(Y.name),testing:Q.value===Y.name}])},[e("div",Fa,[e("i",{class:Z(["mdi",X(Y.mode||Y.name)])},null,2),e("span",null,m(Y.label||Y.name),1)]),e("div",Na,[N.value.has(Y.name)?(n(),a("span",Ba,[...I[24]||(I[24]=[e("i",{class:"mdi mdi-check"},null,-1),_(" Tested ",-1)])])):M("",!0),e("button",{onClick:re=>S(Y.name),disabled:!d.value||Q.value===Y.name,class:"btn-test"},[e("i",{class:Z(["mdi",Q.value===Y.name?"mdi-loading mdi-spin":"mdi-play"])},null,2),I[25]||(I[25]=_(" Test ",-1))],8,Ha)])],2))),128))]))]),e("div",{class:"modal-actions"},[e("button",{onClick:u,class:"btn-primary"},[...I[26]||(I[26]=[e("i",{class:"mdi mdi-download"},null,-1),_(" Download JSON ",-1)])]),e("button",{onClick:ae,class:"btn-secondary"}," Close ")])])):(n(),a("div",ba,[I[13]||(I[13]=e("div",{class:"info-banner"},[e("i",{class:"mdi mdi-information"}),e("p",null,"Select a SmartIR code from the index to test commands with your Broadlink device.")],-1)),e("div",ha,[I[11]||(I[11]=e("label",null,[e("i",{class:"mdi mdi-shape"}),_(" Platform ")],-1)),z(e("select",{"onUpdate:modelValue":I[0]||(I[0]=Y=>l.value=Y),onChange:V,class:"form-select"},[...I[10]||(I[10]=[e("option",{value:"climate"},"Climate (AC/Heater)",-1),e("option",{value:"media_player"},"Media Player (TV/Audio)",-1),e("option",{value:"fan"},"Fan",-1),e("option",{value:"light"},"Light",-1)])],544),[[we,l.value]])]),e("div",ka,[ye(Fe,{modelValue:g.value,"onUpdate:modelValue":I[1]||(I[1]=Y=>g.value=Y),options:f.value,label:"Manufacturer",placeholder:"Search manufacturers...",loading:C.value,disabled:C.value,onChange:ie},null,8,["modelValue","options","loading","disabled"])]),e("div",wa,[ye(Fe,{modelValue:E.value,"onUpdate:modelValue":I[2]||(I[2]=Y=>E.value=Y),options:A.value,"option-label":"label","option-value":"code",label:"Model",placeholder:"Search models...",loading:t.value,disabled:!g.value||t.value,onChange:G},null,8,["modelValue","options","loading","disabled"])]),T.value?(n(),a("div",$a,[I[12]||(I[12]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[e("strong",null,m(g.value)+" - "+m(T.value.models[0]),1),e("p",null,"Code: "+m(T.value.code),1)])])):M("",!0),e("div",Ca,[e("button",{onClick:Ie,disabled:!T.value||x.value,class:"btn-primary"},[e("i",{class:Z(["mdi",x.value?"mdi-loading mdi-spin":"mdi-download"])},null,2),_(" "+m(x.value?"Loading...":"Load Commands"),1)],8,_a)])]))])])])):M("",!0)}}},Ja=ke(qa,[["__scopeId","data-v-64d207ed"]]),za={class:"smartir-status-card"},Ga={class:"card-header"},Wa=["src"],Ka={class:"header-badges"},Xa=["title"],Ya={class:"header-info"},Za={class:"header-info"},Qa={class:"header-info"},ei={class:"header-right"},ti={key:0,class:"card-body loading-state"},oi={key:1,class:"card-body error-state"},li={key:2,class:"card-body installed-state"},ni={key:0,class:"help-panel"},si={key:0,class:"recommendation"},ai={key:0,class:"next-steps"},ii={key:1,class:"filter-bar"},ri={class:"filter-row"},di={class:"filter-group filter-search"},ui={class:"filter-group"},ci={class:"view-toggle-group"},mi={class:"filter-results"},vi={key:2,class:"loading-state"},fi={key:3,class:"empty-state"},pi={key:4,class:"profiles-grid"},gi={key:6,class:"no-results"},yi={key:3,class:"card-body not-installed-state"},bi={class:"benefits-section"},hi={class:"benefits-list"},ki={class:"recommendation"},wi={__name:"SmartIRStatusCard",emits:["create-profile","show-install-guide","edit-profile"],setup(o,{expose:v,emit:r}){const $=r,w=$e("smartirStatus");$e("smartirEnabled");const l=$e("refreshSmartIR"),g=y(!1),f=y(null),C=y((w==null?void 0:w.value)||null),T=y(localStorage.getItem("smartir_simulate_not_installed")==="true"),E=y(!1),h=y(!0),t=y([]),A=y(!1),F=y({search:"",platform:""}),j=y({show:!1,title:"",message:"",platform:null,profile:null}),x=y(!1),s=y(localStorage.getItem("profile_view_mode")||"grid"),d=["Full climate entity support (AC, heaters)","120+ pre-configured device profiles","Temperature and humidity sensor integration","HVAC mode control (heat, cool, auto, dry, fan)"],c=["climate","media_player","fan","light"],N=J(()=>T.value?{installed:!1,recommendation:{message:"Install SmartIR to unlock climate device support!",benefits:["Full climate entity support (AC, heaters)","120+ pre-configured device profiles","Temperature and humidity sensor integration","HVAC mode control (heat, cool, auto, dry, fan)"]}}:C.value),Q=J(()=>{var b,p;return((p=(b=N.value)==null?void 0:b.platforms)==null?void 0:p.length)||0}),ne=J(()=>{var b;return(b=N.value)!=null&&b.device_counts?Object.values(N.value.device_counts).reduce((p,X)=>p+X,0):0});function le(){var b;T.value=!T.value,localStorage.setItem("smartir_simulate_not_installed",T.value.toString()),!T.value&&((b=C.value)!=null&&b.installed)&&S()}const me=J(()=>{let b=t.value;if(F.value.search){const p=F.value.search.toLowerCase();b=b.filter(X=>{var ae,q,I,oe;return((ae=X.manufacturer)==null?void 0:ae.toLowerCase().includes(p))||((q=X.model)==null?void 0:q.toLowerCase().includes(p))||((I=X.code)==null?void 0:I.toString().includes(p))||((oe=X.platform)==null?void 0:oe.toLowerCase().includes(p))})}return F.value.platform&&(b=b.filter(p=>p.platform===F.value.platform)),b}),L=J(()=>F.value.search||F.value.platform);function B(){F.value.search="",F.value.platform=""}async function ee(){g.value=!0,f.value=null;try{if(l)await l();else{const b=await Ye.getStatus();C.value=b}}catch(b){f.value=b.message||"Failed to refresh SmartIR status",console.error("Error refreshing SmartIR status:",b)}finally{g.value=!1}}function de(){$("create-profile")}function be(){x.value=!0}function Se(){$("show-install-guide")}function Ie(){window.open("https://github.com/smartHomeHub/SmartIR","_blank")}function De(){window.open("https://github.com/smartHomeHub/SmartIR","_blank")}async function S(){A.value=!0;const b=[];try{for(const p of c)try{const X=await fetch(`api/smartir/platforms/${p}/profiles`);if(X.ok){const q=((await X.json()).profiles||[]).map(I=>({...I,platform:p}));b.push(...q)}}catch(X){console.error(`Error loading ${p} profiles:`,X)}t.value=b}finally{A.value=!1}}function u(b,p,X){$("edit-profile",{platform:b,profile:p,startStep:X})}async function V(b,p){var X,ae;try{const q=await fetch(`api/smartir/platforms/${b}/profiles/${p.code}`);if(!q.ok)throw new Error("Failed to fetch profile");const I=await q.json(),oe=JSON.stringify(I.profile,null,2),Y=new Blob([oe],{type:"application/json"}),re=URL.createObjectURL(Y),O=document.createElement("a");O.href=re,O.download=`smartir_${b}_${p.manufacturer}_${p.model}_${p.code}.json`,document.body.appendChild(O),O.click(),document.body.removeChild(O),URL.revokeObjectURL(re),(X=$e("toast").value)==null||X.success(`Downloaded ${p.manufacturer} ${p.model}`,"âœ… Profile Downloaded")}catch(q){console.error("Error downloading profile:",q),(ae=$e("toast").value)==null||ae.error("Failed to download profile","âŒ Download Error")}}async function ie(b,p){$e("toast");try{const X=await fetch(`api/smartir/profiles/${p.code}/check-usage`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({platform:b})});if(X.ok){const ae=await X.json();if(ae.in_use){j.value={show:!0,title:`Cannot Delete ${p.manufacturer} ${p.model}`,message:`This profile is currently in use by ${ae.device_count} device(s):

${ae.devices.join(`
`)}

Please remove or reassign these devices before deleting the profile.`,platform:b,profile:p,canDelete:!1,devices:ae.devices};return}}}catch(X){console.error("Error checking profile usage:",X)}j.value={show:!0,title:`Delete ${p.manufacturer} ${p.model}?`,message:`Device Code: ${p.code}

This will remove the profile and update your configuration.`,platform:b,profile:p,canDelete:!0}}async function G(){var ae,q,I;const b=$e("toast"),{platform:p,profile:X}=j.value;j.value.show=!1;try{const oe=await fetch(`api/smartir/profiles/${X.code}`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({platform:p})});if(oe.ok)await S(),await Ge(),await ee(),(ae=b.value)==null||ae.success(`${X.manufacturer} ${X.model} has been removed`,"âœ… Profile Deleted");else{const Y=await oe.json();(q=b.value)==null||q.error(Y.error||"Unknown error","âŒ Delete Failed")}}catch(oe){console.error("Error deleting profile:",oe),(I=b.value)==null||I.error("Failed to delete profile","âŒ Delete Error")}}return pe(w,b=>{b&&(C.value=b)},{immediate:!0}),Te(async()=>{var b;w!=null&&w.value&&(C.value=w.value),C.value||await ee(),(b=C.value)!=null&&b.installed&&await S()}),v({loadAllProfiles:S,refreshStatus:ee}),(b,p)=>{var X,ae,q,I,oe,Y,re,O,i,U;return n(),a("div",za,[e("div",Ga,[e("button",{class:"icon-button chevron-button",onClick:p[0]||(p[0]=P=>h.value=!h.value)},[e("i",{class:Z(["mdi",h.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2)]),e("div",{class:"header-left",onClick:p[1]||(p[1]=P=>h.value=!h.value)},[e("img",{src:Ce(Be),alt:"SmartIR",class:"smartir-logo"},null,8,Wa),p[14]||(p[14]=e("h3",null,"SmartIR Integration",-1)),e("div",Ka,[e("div",{class:Z(["simulation-toggle-pill",{active:T.value}]),onClick:ge(le,["stop"]),title:T.value?"Click to show as installed":"Click to simulate not-installed"},[e("i",{class:Z(["mdi",T.value?"mdi-eye-off":"mdi-eye"])},null,2),e("span",null,m(T.value?"Simulating: Not Installed":"Simulation Mode"),1)],10,Xa),(X=N.value)!=null&&X.installed?(n(),a(ce,{key:0},[p[13]||(p[13]=e("div",{class:"status-badge-mini success"},[e("i",{class:"mdi mdi-check-circle"}),e("span",null,"Installed")],-1)),e("span",Ya,"v"+m(N.value.version||"Unknown"),1),e("span",Za,m(Q.value)+" platform"+m(Q.value!==1?"s":""),1),e("span",Qa,m(ne.value)+" device"+m(ne.value!==1?"s":""),1)],64)):M("",!0)])]),e("div",ei,[(ae=C.value)!=null&&ae.installed&&h.value?(n(),a("button",{key:0,onClick:p[2]||(p[2]=ge(P=>E.value=!E.value,["stop"])),class:Z(["icon-button",{active:E.value}]),title:"Show help"},[...p[15]||(p[15]=[e("i",{class:"mdi mdi-help-circle"},null,-1)])],2)):M("",!0),(q=C.value)!=null&&q.installed&&h.value?(n(),a("button",{key:1,onClick:ge(ee,["stop"]),class:"icon-button",title:"Refresh status"},[...p[16]||(p[16]=[e("i",{class:"mdi mdi-refresh"},null,-1)])])):M("",!0),(I=C.value)!=null&&I.installed&&h.value?(n(),a("button",{key:2,onClick:ge(be,["stop"]),class:"btn btn-secondary"},[...p[17]||(p[17]=[e("i",{class:"mdi mdi-test-tube"},null,-1),_(" Test Codes ",-1)])])):M("",!0),(oe=C.value)!=null&&oe.installed&&h.value?(n(),a("button",{key:3,onClick:ge(de,["stop"]),class:"btn btn-primary"},[...p[18]||(p[18]=[e("i",{class:"mdi mdi-plus"},null,-1),_(" Create SmartIR Profile ",-1)])])):M("",!0)])]),z(e("div",null,[g.value?(n(),a("div",ti,[...p[19]||(p[19]=[e("div",{class:"spinner"},null,-1),e("p",null,"Checking SmartIR installation...",-1)])])):f.value?(n(),a("div",oi,[p[20]||(p[20]=e("i",{class:"mdi mdi-alert-circle"},null,-1)),e("p",null,m(f.value),1),e("button",{onClick:ee,class:"btn-secondary"}," Try Again ")])):(Y=N.value)!=null&&Y.installed?(n(),a("div",li,[E.value?(n(),a("div",ni,[C.value.recommendation?(n(),a("div",si,[e("p",null,m(C.value.recommendation.message),1),C.value.recommendation.next_steps?(n(),a("div",ai,[p[21]||(p[21]=e("strong",null,"Next Steps:",-1)),e("ul",null,[(n(!0),a(ce,null,he(C.value.recommendation.next_steps,(P,D)=>(n(),a("li",{key:D},m(P),1))),128))])])):M("",!0)])):M("",!0),e("div",{class:"help-actions"},[e("button",{onClick:Ie,class:"btn-secondary"},[...p[22]||(p[22]=[e("i",{class:"mdi mdi-book-open-variant"},null,-1),_(" View Documentation ",-1)])])])])):M("",!0),t.value.length>0&&!T.value?(n(),a("div",ii,[e("div",ri,[e("div",di,[e("label",null,[p[23]||(p[23]=e("i",{class:"mdi mdi-magnify"},null,-1)),z(e("input",{"onUpdate:modelValue":p[3]||(p[3]=P=>F.value.search=P),type:"text",placeholder:"Search profiles...",class:"search-input"},null,512),[[_e,F.value.search]])])]),e("div",ui,[e("label",null,[p[25]||(p[25]=e("i",{class:"mdi mdi-shape"},null,-1)),z(e("select",{"onUpdate:modelValue":p[4]||(p[4]=P=>F.value.platform=P)},[...p[24]||(p[24]=[Oe('<option value="" data-v-4e6e6058>All Platforms</option><option value="climate" data-v-4e6e6058>Climate</option><option value="media_player" data-v-4e6e6058>Media Player</option><option value="fan" data-v-4e6e6058>Fan</option><option value="light" data-v-4e6e6058>Light</option>',5)])],512),[[we,F.value.platform]])])]),L.value?(n(),a("button",{key:0,onClick:B,class:"btn-clear-filters"},[...p[26]||(p[26]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),_(" Clear ",-1)])])):M("",!0),e("div",ci,[e("button",{onClick:p[5]||(p[5]=P=>s.value="grid"),class:Z(["view-toggle-btn",{active:s.value==="grid"}]),title:"Grid View"},[...p[27]||(p[27]=[e("i",{class:"mdi mdi-view-grid"},null,-1),_(" Grid ",-1)])],2),e("button",{onClick:p[6]||(p[6]=P=>s.value="list"),class:Z(["view-toggle-btn",{active:s.value==="list"}]),title:"List View"},[...p[28]||(p[28]=[e("i",{class:"mdi mdi-view-list"},null,-1),_(" List ",-1)])],2)]),e("div",mi,m(me.value.length)+" of "+m(t.value.length),1)])])):M("",!0),A.value?(n(),a("div",vi,[...p[29]||(p[29]=[e("i",{class:"mdi mdi-loading mdi-spin"},null,-1),e("p",null,"Loading profiles...",-1)])])):t.value.length===0?(n(),a("div",fi,[...p[30]||(p[30]=[e("i",{class:"mdi mdi-file-document-outline"},null,-1),e("h3",null,"No Profiles Yet",-1),e("p",null,"Create your first SmartIR profile to get started",-1)])])):M("",!0),s.value==="grid"&&!T.value?(n(),a("div",pi,[(n(!0),a(ce,null,he(me.value,P=>(n(),Re(zs,{key:`${P.platform}-${P.code}`,profile:P,onEdit:D=>u(P.platform,P),onCommands:D=>u(P.platform,P,2),onDownload:D=>V(P.platform,P),onDelete:D=>ie(P.platform,P)},null,8,["profile","onEdit","onCommands","onDownload","onDelete"]))),128))])):s.value==="list"&&!T.value&&me.value.length>0?(n(),Re(pa,{key:5,profiles:me.value,onEdit:p[7]||(p[7]=P=>u(P.platform,P)),onCommands:p[8]||(p[8]=P=>u(P.platform,P,2)),onDownload:p[9]||(p[9]=P=>V(P.platform,P)),onDelete:p[10]||(p[10]=P=>ie(P.platform,P))},null,8,["profiles"])):M("",!0),t.value.length>0&&me.value.length===0&&!T.value?(n(),a("div",gi,[...p[31]||(p[31]=[e("i",{class:"mdi mdi-filter-off"},null,-1),e("h3",null,"No profiles match your filters",-1),e("p",null,"Try adjusting your search or filter criteria",-1)])])):M("",!0)])):(n(),a("div",yi,[p[37]||(p[37]=e("div",{class:"status-badge warning"},[e("i",{class:"mdi mdi-information"}),e("span",null,"Not Installed")],-1)),e("div",bi,[p[33]||(p[33]=e("h4",null,"Why Install SmartIR?",-1)),e("ul",hi,[(n(!0),a(ce,null,he(((O=(re=C.value)==null?void 0:re.recommendation)==null?void 0:O.benefits)||d,(P,D)=>(n(),a("li",{key:D},[p[32]||(p[32]=e("i",{class:"mdi mdi-check"},null,-1)),e("span",null,m(P),1)]))),128))])]),e("div",ki,[e("p",null,m(((U=(i=C.value)==null?void 0:i.recommendation)==null?void 0:U.message)||"Install SmartIR to unlock climate device support!"),1)]),e("div",{class:"card-actions"},[e("button",{onClick:Se,class:"btn-primary"},[...p[34]||(p[34]=[e("i",{class:"mdi mdi-download"},null,-1),_(" Install SmartIR ",-1)])]),e("button",{onClick:De,class:"btn-secondary"},[...p[35]||(p[35]=[e("i",{class:"mdi mdi-github"},null,-1),_(" View on GitHub ",-1)])]),e("button",{onClick:Ie,class:"btn-secondary"},[...p[36]||(p[36]=[e("i",{class:"mdi mdi-help-circle"},null,-1),_(" Learn More ",-1)])])])]))],512),[[Ke,h.value]]),ye(Le,{isOpen:j.value.show,title:j.value.title,message:j.value.message,confirmText:j.value.canDelete===!1?null:"Delete",cancelText:"Close",dangerMode:!0,confirmDisabled:j.value.canDelete===!1,onConfirm:G,onCancel:p[11]||(p[11]=P=>j.value.show=!1)},null,8,["isOpen","title","message","confirmText","confirmDisabled"]),ye(Ja,{isOpen:x.value,onClose:p[12]||(p[12]=P=>x.value=!1)},null,8,["isOpen"])])}}},$i=ke(wi,[["__scopeId","data-v-4e6e6058"]]),Ci={class:"climate-form"},_i={class:"learning-mode-section"},Si={class:"mode-toggle"},Ii={class:"mode-content"},Di={class:"mode-stats"},xi={class:"stat-badge"},Ti={class:"stat-badge time"},Ri={class:"mode-content"},Mi={class:"mode-stats"},Li={class:"stat-badge"},Oi={class:"stat-badge time warning"},Ai={key:0,class:"command-breakdown"},Ei={class:"warning-text"},Vi={class:"form-section"},ji={key:0,class:"help-text"},Pi={key:1,class:"help-text"},Ui={class:"form-row"},Fi={class:"form-group"},Ni={class:"form-group"},Bi={class:"form-group"},Hi={key:2,class:"representative-temp-section"},qi={class:"form-group"},Ji=["value"],zi={class:"form-section"},Gi={class:"checkbox-grid"},Wi={class:"checkbox-item"},Ki={class:"checkbox-item"},Xi={class:"checkbox-item"},Yi={class:"checkbox-item"},Zi={class:"checkbox-item"},Qi={class:"checkbox-item"},er={class:"form-section"},tr={class:"checkbox-grid"},or={class:"checkbox-item"},lr={class:"checkbox-item"},nr={class:"checkbox-item"},sr={class:"checkbox-item"},ar={class:"form-section"},ir={class:"checkbox-grid"},rr={class:"checkbox-item"},dr={class:"checkbox-item"},ur={class:"checkbox-item"},cr={class:"checkbox-item"},mr={class:"form-section"},vr={class:"form-group"},fr={class:"form-group"},pr={class:"form-group"},gr={key:0,class:"validation-summary"},yr={__name:"ClimateProfileForm",props:{modelValue:{type:Object,default:()=>({})}},emits:["update:modelValue"],setup(o,{emit:v}){const r=o,$=v,w=y("quick"),l=y({minTemp:16,maxTemp:30,precision:1,representativeTemp:24,modes:["off","auto","cool","heat"],fanModes:["auto","low","medium","high"],swingModes:[],tempSensor:"",humiditySensor:"",powerSensor:"",learningMode:"quick",...r.modelValue}),g=J(()=>{const x=[],s=l.value.minTemp||16,d=l.value.maxTemp||30,c=l.value.precision||1;for(let N=s;N<=d;N+=c)x.push(N);return x}),f=J(()=>l.value.modes.filter(x=>x!=="off").length),C=J(()=>l.value.fanModes.length||1),T=J(()=>l.value.swingModes.length||1),E=J(()=>{const x=l.value.minTemp||16,s=l.value.maxTemp||30,d=l.value.precision||1;return Math.floor((s-x)/d)+1}),h=J(()=>{const x=l.value.modes.includes("off")?1:0;return f.value*C.value*T.value+x}),t=J(()=>Math.ceil(h.value*30/60)),A=J(()=>{const x=l.value.modes.includes("off")?1:0;return f.value*E.value*C.value*T.value+x}),F=J(()=>Math.ceil(A.value*30/60)),j=J(()=>{const x=[];return(!l.value.minTemp||l.value.minTemp<10||l.value.minTemp>35)&&x.push("Minimum temperature must be between 10Â°C and 35Â°C"),(!l.value.maxTemp||l.value.maxTemp<10||l.value.maxTemp>35)&&x.push("Maximum temperature must be between 10Â°C and 35Â°C"),l.value.minTemp>=l.value.maxTemp&&x.push("Minimum temperature must be less than maximum temperature"),(!l.value.modes||l.value.modes.length===0)&&x.push("At least one HVAC mode must be selected"),x});return pe(w,x=>{l.value.learningMode=x}),pe(l,x=>{$("update:modelValue",x)},{deep:!0,immediate:!0}),(x,s)=>(n(),a("div",Ci,[s[63]||(s[63]=e("h3",null,"Climate Device Configuration",-1)),e("div",_i,[e("div",Si,[e("label",{class:Z(["mode-option",{active:w.value==="quick"}])},[z(e("input",{type:"radio",value:"quick","onUpdate:modelValue":s[0]||(s[0]=d=>w.value=d)},null,512),[[Ue,w.value]]),e("div",Ii,[s[23]||(s[23]=e("div",{class:"mode-header"},[e("i",{class:"mdi mdi-flash"}),e("strong",null,"Quick Mode (Recommended)")],-1)),s[24]||(s[24]=e("p",null,"Learn one temperature per mode combination",-1)),e("div",Di,[e("span",xi,m(h.value)+" commands",1),e("span",Ti,"~"+m(t.value)+" min",1)])])],2),e("label",{class:Z(["mode-option",{active:w.value==="complete"}])},[z(e("input",{type:"radio",value:"complete","onUpdate:modelValue":s[1]||(s[1]=d=>w.value=d)},null,512),[[Ue,w.value]]),e("div",Ri,[s[25]||(s[25]=e("div",{class:"mode-header"},[e("i",{class:"mdi mdi-check-all"}),e("strong",null,"Complete Mode")],-1)),s[26]||(s[26]=e("p",null,"Learn all temperature combinations",-1)),e("div",Mi,[e("span",Li,m(A.value)+" commands",1),e("span",Oi,"~"+m(F.value)+" min",1)])])],2)]),w.value==="complete"?(n(),a("div",Ai,[s[27]||(s[27]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[e("strong",null,"Complete mode will require learning "+m(A.value)+" commands",1),e("p",null,"This includes all combinations of modes ("+m(f.value)+"), temperatures ("+m(E.value)+"), fan speeds ("+m(C.value)+"), and swing modes ("+m(T.value)+").",1),e("p",Ei,"â±ï¸ Estimated time: "+m(F.value)+" minutes at ~30 seconds per command",1)])])):M("",!0)]),e("div",Vi,[s[33]||(s[33]=e("h4",null,"Temperature Range",-1)),w.value==="quick"?(n(),a("p",ji," Define the full temperature range your device supports. You'll select one temperature to learn below. ")):(n(),a("p",Pi," Define the temperature range. All temperatures in this range will be learned. ")),e("div",Ui,[e("div",Fi,[s[28]||(s[28]=e("label",null,"Minimum Temperature (Â°C) *",-1)),z(e("input",{"onUpdate:modelValue":s[2]||(s[2]=d=>l.value.minTemp=d),type:"number",min:"10",max:"35",placeholder:"16"},null,512),[[_e,l.value.minTemp,void 0,{number:!0}]])]),e("div",Ni,[s[29]||(s[29]=e("label",null,"Maximum Temperature (Â°C) *",-1)),z(e("input",{"onUpdate:modelValue":s[3]||(s[3]=d=>l.value.maxTemp=d),type:"number",min:"10",max:"35",placeholder:"30"},null,512),[[_e,l.value.maxTemp,void 0,{number:!0}]])]),e("div",Bi,[s[31]||(s[31]=e("label",null,"Precision",-1)),z(e("select",{"onUpdate:modelValue":s[4]||(s[4]=d=>l.value.precision=d)},[...s[30]||(s[30]=[e("option",{value:1},"1Â°C (Whole degrees)",-1),e("option",{value:.5},"0.5Â°C (Half degrees)",-1)])],512),[[we,l.value.precision,void 0,{number:!0}]])])]),w.value==="quick"?(n(),a("div",Hi,[e("div",qi,[s[32]||(s[32]=e("label",null,"Representative Temperature to Learn *",-1)),z(e("select",{"onUpdate:modelValue":s[5]||(s[5]=d=>l.value.representativeTemp=d)},[(n(!0),a(ce,null,he(g.value,d=>(n(),a("option",{key:d,value:d},m(d)+"Â°C ",9,Ji))),128))],512),[[we,l.value.representativeTemp,void 0,{number:!0}]]),e("small",null,"This temperature will be learned for all mode combinations. The device profile will still show the full range ("+m(l.value.minTemp)+"Â°C - "+m(l.value.maxTemp)+"Â°C).",1)])])):M("",!0)]),e("div",zi,[s[40]||(s[40]=e("h4",null,"Supported HVAC Modes *",-1)),s[41]||(s[41]=e("p",{class:"help-text"},"Select all modes your device supports",-1)),e("div",Gi,[e("label",Wi,[z(e("input",{type:"checkbox",value:"off","onUpdate:modelValue":s[6]||(s[6]=d=>l.value.modes=d)},null,512),[[fe,l.value.modes]]),s[34]||(s[34]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),_(" Off ")],-1))]),e("label",Ki,[z(e("input",{type:"checkbox",value:"auto","onUpdate:modelValue":s[7]||(s[7]=d=>l.value.modes=d)},null,512),[[fe,l.value.modes]]),s[35]||(s[35]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-autorenew"}),_(" Auto ")],-1))]),e("label",Xi,[z(e("input",{type:"checkbox",value:"cool","onUpdate:modelValue":s[8]||(s[8]=d=>l.value.modes=d)},null,512),[[fe,l.value.modes]]),s[36]||(s[36]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-snowflake"}),_(" Cool ")],-1))]),e("label",Yi,[z(e("input",{type:"checkbox",value:"heat","onUpdate:modelValue":s[9]||(s[9]=d=>l.value.modes=d)},null,512),[[fe,l.value.modes]]),s[37]||(s[37]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fire"}),_(" Heat ")],-1))]),e("label",Zi,[z(e("input",{type:"checkbox",value:"dry","onUpdate:modelValue":s[10]||(s[10]=d=>l.value.modes=d)},null,512),[[fe,l.value.modes]]),s[38]||(s[38]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-water-percent"}),_(" Dry ")],-1))]),e("label",Qi,[z(e("input",{type:"checkbox",value:"fan_only","onUpdate:modelValue":s[11]||(s[11]=d=>l.value.modes=d)},null,512),[[fe,l.value.modes]]),s[39]||(s[39]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan"}),_(" Fan Only ")],-1))])])]),e("div",er,[s[46]||(s[46]=e("h4",null,"Fan Modes",-1)),s[47]||(s[47]=e("p",{class:"help-text"},"Select all fan speeds your device supports",-1)),e("div",tr,[e("label",or,[z(e("input",{type:"checkbox",value:"auto","onUpdate:modelValue":s[12]||(s[12]=d=>l.value.fanModes=d)},null,512),[[fe,l.value.fanModes]]),s[42]||(s[42]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-autorenew"}),_(" Auto ")],-1))]),e("label",lr,[z(e("input",{type:"checkbox",value:"low","onUpdate:modelValue":s[13]||(s[13]=d=>l.value.fanModes=d)},null,512),[[fe,l.value.fanModes]]),s[43]||(s[43]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-1"}),_(" Low ")],-1))]),e("label",nr,[z(e("input",{type:"checkbox",value:"medium","onUpdate:modelValue":s[14]||(s[14]=d=>l.value.fanModes=d)},null,512),[[fe,l.value.fanModes]]),s[44]||(s[44]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-2"}),_(" Medium ")],-1))]),e("label",sr,[z(e("input",{type:"checkbox",value:"high","onUpdate:modelValue":s[15]||(s[15]=d=>l.value.fanModes=d)},null,512),[[fe,l.value.fanModes]]),s[45]||(s[45]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-3"}),_(" High ")],-1))])])]),e("div",ar,[s[52]||(s[52]=e("h4",null,"Swing Modes (Optional)",-1)),s[53]||(s[53]=e("p",{class:"help-text"},"Select if your device has swing/oscillation",-1)),e("div",ir,[e("label",rr,[z(e("input",{type:"checkbox",value:"off","onUpdate:modelValue":s[16]||(s[16]=d=>l.value.swingModes=d)},null,512),[[fe,l.value.swingModes]]),s[48]||(s[48]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-horizontal"}),_(" Off ")],-1))]),e("label",dr,[z(e("input",{type:"checkbox",value:"vertical","onUpdate:modelValue":s[17]||(s[17]=d=>l.value.swingModes=d)},null,512),[[fe,l.value.swingModes]]),s[49]||(s[49]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-vertical"}),_(" Vertical ")],-1))]),e("label",ur,[z(e("input",{type:"checkbox",value:"horizontal","onUpdate:modelValue":s[18]||(s[18]=d=>l.value.swingModes=d)},null,512),[[fe,l.value.swingModes]]),s[50]||(s[50]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-horizontal"}),_(" Horizontal ")],-1))]),e("label",cr,[z(e("input",{type:"checkbox",value:"both","onUpdate:modelValue":s[19]||(s[19]=d=>l.value.swingModes=d)},null,512),[[fe,l.value.swingModes]]),s[51]||(s[51]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-arrow-all"}),_(" Both ")],-1))])])]),e("div",mr,[s[60]||(s[60]=e("h4",null,"Sensors (Optional)",-1)),s[61]||(s[61]=e("p",{class:"help-text"},"Link external sensors for better climate control",-1)),e("div",vr,[s[54]||(s[54]=e("label",null,"Temperature Sensor",-1)),z(e("input",{"onUpdate:modelValue":s[20]||(s[20]=d=>l.value.tempSensor=d),type:"text",placeholder:"sensor.living_room_temperature"},null,512),[[_e,l.value.tempSensor]]),s[55]||(s[55]=e("small",null,"Entity ID of temperature sensor",-1))]),e("div",fr,[s[56]||(s[56]=e("label",null,"Humidity Sensor",-1)),z(e("input",{"onUpdate:modelValue":s[21]||(s[21]=d=>l.value.humiditySensor=d),type:"text",placeholder:"sensor.living_room_humidity"},null,512),[[_e,l.value.humiditySensor]]),s[57]||(s[57]=e("small",null,"Entity ID of humidity sensor",-1))]),e("div",pr,[s[58]||(s[58]=e("label",null,"Power Sensor",-1)),z(e("input",{"onUpdate:modelValue":s[22]||(s[22]=d=>l.value.powerSensor=d),type:"text",placeholder:"binary_sensor.ac_power"},null,512),[[_e,l.value.powerSensor]]),s[59]||(s[59]=e("small",null,"Entity ID of power sensor (to detect on/off state)",-1))])]),j.value.length>0?(n(),a("div",gr,[s[62]||(s[62]=e("h4",null,[e("i",{class:"mdi mdi-alert-circle"}),_(" Please fix the following: ")],-1)),e("ul",null,[(n(!0),a(ce,null,he(j.value,(d,c)=>(n(),a("li",{key:c},m(d),1))),128))])])):M("",!0)]))}},br=ke(yr,[["__scopeId","data-v-5674f3f7"]]),hr={class:"command-wizard"},kr={class:"device-selection-section"},wr={class:"input-wrapper"},$r=["value"],Cr={key:0,class:"validation-tooltip"},_r={class:"form-group"},Sr=["disabled"],Ir={key:0},Dr={key:1},xr={key:0,class:"edit-mode-banner"},Tr={class:"wizard-info"},Rr={key:0},Mr={key:1},Lr={class:"progress-info"},Or={class:"progress-bar"},Ar={class:"progress-text"},Er={class:"commands-grid"},Vr={class:"command-header"},jr={class:"command-icon"},Pr={class:"command-info"},Ur={key:0,class:"learning-indicator"},Fr={key:0,class:"ir-learning-steps"},Nr={key:1,class:"rf-learning-steps"},Br={class:"command-actions"},Hr=["onClick","disabled"],qr={key:1,class:"learned-status"},Jr=["onClick","disabled"],zr=["onClick"],Gr={class:"quick-actions"},Wr=["disabled"],Kr=["disabled"],Xr={__name:"CommandLearningWizard",props:{modelValue:{type:Object,default:()=>({})},platform:{type:String,required:!0},config:{type:Object,required:!0},broadlinkDevice:{type:String,default:""},manufacturer:{type:String,required:!0},model:{type:String,required:!0},commandType:{type:String,default:"ir"}},emits:["update:modelValue","update:broadlinkDevice","update:commandType"],setup(o,{emit:v}){const r=Ve(),$=o,w=v,l=y({...$.modelValue}),g=y(null),f=y(null),C=y([]),T=y($.broadlinkDevice),E=y($.commandType),h=y(!1),t=y([]),A=y(!1),F=y(!1),j=y({show:!1,commandKey:null,commandLabel:""}),x=y(!1),s=J(()=>{const S=[];if($.platform==="climate"){const u=$.config.modes||[],V=$.config.fanModes||[],ie=$.config.minTemp||16,G=$.config.maxTemp||30;u.forEach(b=>{if(b==="off")S.push({key:"off",label:"Power Off",description:"Turn device off",icon:"mdi mdi-power",mode:"off"});else for(let p=ie;p<=G;p++)V.forEach(X=>{const ae=`${b}_${p}_${X}`;S.push({key:ae,label:`${b.toUpperCase()} ${p}Â°C ${X}`,description:`Mode: ${b}, Temp: ${p}Â°C, Fan: ${X}`,icon:Q(b),mode:b,temp:p,fanMode:X})})})}else if($.platform==="media_player"){const u=$.config.features||[];u.includes("turn_on")&&(S.push({key:"turn_on",label:"Power On",description:"Turn on the device",icon:"mdi mdi-power"}),S.push({key:"turn_off",label:"Power Off",description:"Turn off the device",icon:"mdi mdi-power-off"})),u.includes("volume")&&(S.push({key:"volume_up",label:"Volume Up",description:"Increase volume",icon:"mdi mdi-volume-plus"}),S.push({key:"volume_down",label:"Volume Down",description:"Decrease volume",icon:"mdi mdi-volume-minus"})),u.includes("mute")&&S.push({key:"mute",label:"Mute",description:"Toggle mute",icon:"mdi mdi-volume-mute"}),u.includes("source")&&(S.push({key:"source_hdmi1",label:"Source: HDMI 1",description:"Switch to HDMI 1",icon:"mdi mdi-import"}),S.push({key:"source_hdmi2",label:"Source: HDMI 2",description:"Switch to HDMI 2",icon:"mdi mdi-import"}),S.push({key:"source_hdmi3",label:"Source: HDMI 3",description:"Switch to HDMI 3",icon:"mdi mdi-import"})),u.includes("channel")&&(S.push({key:"channel_up",label:"Channel Up",description:"Next channel",icon:"mdi mdi-chevron-up"}),S.push({key:"channel_down",label:"Channel Down",description:"Previous channel",icon:"mdi mdi-chevron-down"}))}else if($.platform==="fan"){const u=$.config.speedLevels||3,V=$.config.features||[];S.push({key:"turn_on",label:"Power On",description:"Turn on the fan",icon:"mdi mdi-power"}),S.push({key:"turn_off",label:"Power Off",description:"Turn off the fan",icon:"mdi mdi-power-off"});for(let ie=1;ie<=u;ie++){const G=ie===1?"Low":ie===u?"High":ie===2&&u===3?"Medium":`Speed ${ie}`;S.push({key:`speed_${ie}`,label:`${G}`,description:`Set fan to speed level ${ie}`,icon:"mdi mdi-fan"})}V.includes("oscillate")&&(S.push({key:"oscillate_on",label:"Oscillate On",description:"Enable oscillation",icon:"mdi mdi-sync"}),S.push({key:"oscillate_off",label:"Oscillate Off",description:"Disable oscillation",icon:"mdi mdi-sync-off"})),V.includes("direction")&&(S.push({key:"direction_forward",label:"Direction: Forward",description:"Set direction to forward",icon:"mdi mdi-rotate-right"}),S.push({key:"direction_reverse",label:"Direction: Reverse",description:"Set direction to reverse",icon:"mdi mdi-rotate-left"}))}else if($.platform==="light"){const u=$.config.features||[];u.includes("turn_on")&&(S.push({key:"turn_on",label:"Power On",description:"Turn on the light",icon:"mdi mdi-lightbulb-on"}),S.push({key:"turn_off",label:"Power Off",description:"Turn off the light",icon:"mdi mdi-lightbulb-off"})),u.includes("brightness")&&(S.push({key:"brightness_up",label:"Brightness Up",description:"Increase brightness",icon:"mdi mdi-brightness-7"}),S.push({key:"brightness_down",label:"Brightness Down",description:"Decrease brightness",icon:"mdi mdi-brightness-5"})),u.includes("color_temp")&&(S.push({key:"color_temp_warm",label:"Warm White",description:"Set to warm white",icon:"mdi mdi-weather-sunset"}),S.push({key:"color_temp_cool",label:"Cool White",description:"Set to cool white",icon:"mdi mdi-weather-sunny"})),u.includes("rgb")&&(S.push({key:"color_red",label:"Color: Red",description:"Set color to red",icon:"mdi mdi-palette"}),S.push({key:"color_green",label:"Color: Green",description:"Set color to green",icon:"mdi mdi-palette"}),S.push({key:"color_blue",label:"Color: Blue",description:"Set color to blue",icon:"mdi mdi-palette"}))}return S}),d=J(()=>s.value.length),c=J(()=>Object.keys(l.value).length),N=J(()=>d.value===0?0:Math.round(c.value/d.value*100));function Q(S){return{off:"mdi mdi-power",auto:"mdi mdi-autorenew",cool:"mdi mdi-snowflake",heat:"mdi mdi-fire",dry:"mdi mdi-water-percent",fan_only:"mdi mdi-fan"}[S]||"mdi mdi-remote"}async function ne(S){if(!g.value){if(!T.value){F.value=!0,window.scrollTo({top:0,behavior:"smooth"});return}F.value=!1,g.value=S.key;try{const u=$.manufacturer.toLowerCase().replace(/[^a-z0-9]+/g,"_"),V=$.model.toLowerCase().replace(/[^a-z0-9]+/g,"_"),ie=`${u}_${V}`,G=await fetch("/api/commands/learn",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({entity_id:T.value,device:ie,command:S.key,command_type:E.value})});if(!G.ok)throw new Error(`Failed to learn command: ${G.statusText}`);const b=await G.json();if(b.success&&b.code)l.value[S.key]=b.code,w("update:modelValue",l.value),A.value=!0,b.code==="pending"&&console.log(`â³ Command '${S.key}' learned, code will be fetched from storage when saving`),h.value&&t.value.length>0&&setTimeout(()=>{const p=t.value.shift();p?ne(p):h.value=!1},1e3);else throw new Error(b.error||"Failed to learn command")}catch(u){console.error("Error learning command:",u),r.error(`Error learning command: ${u.message}`),h.value=!1,t.value=[]}finally{h.value||(g.value=null)}}}async function le(S){var u;if(!T.value){F.value=!0,window.scrollTo({top:0,behavior:"smooth"});return}if(!l.value[S]){(u=r.value)==null||u.error("Command not learned yet");return}f.value=S;try{const V=l.value[S],ie=await fetch("/api/commands/send-raw",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({entity_id:T.value,command:V,command_type:E.value})});if(!ie.ok){const G=await ie.json();throw new Error(G.error||"Failed to send command")}r.success("Command sent successfully")}catch(V){console.error("Error testing command:",V),r.error(`Error testing command: ${V.message}`)}finally{f.value=null}}function me(S){const u=s.value.find(V=>V.key===S);j.value={show:!0,commandKey:S,commandLabel:u?u.label:S}}function L(){const S=j.value.commandKey;delete l.value[S],w("update:modelValue",l.value),j.value.show=!1}function B(){const S=s.value.filter(V=>!l.value[V.key]);if(S.length===0)return;h.value=!0,t.value=[...S];const u=t.value.shift();u&&ne(u)}function ee(){x.value=!0}function de(){l.value={},w("update:modelValue",l.value),x.value=!1}pe(()=>$.modelValue,S=>{l.value={...S}},{deep:!0}),Te(async()=>{await be()});async function be(){try{console.log("SmartIR device - commands will be loaded from SmartIR JSON file, not Broadlink storage")}catch(S){console.error("Error in loadExistingCommands:",S)}}function Se(){w("update:broadlinkDevice",T.value)}function Ie(){w("update:commandType",E.value)}async function De(){try{const S=await fetch("/api/remote/devices");if(S.ok){const V=(await S.json()).devices||[];C.value=V}}catch(S){console.error("Error loading remote devices:",S),C.value=[]}}return pe(()=>$.broadlinkDevice,S=>{T.value=S}),pe(T,S=>{S&&(F.value=!1)}),pe(()=>$.commandType,S=>{E.value=S}),Te(async()=>{await De(),await be()}),(S,u)=>(n(),a("div",hr,[u[22]||(u[22]=e("h3",null,"Learn IR Commands",-1)),e("div",kr,[e("div",{class:Z(["form-group",{"has-error":F.value}])},[u[6]||(u[6]=e("label",null,"Broadlink Device *",-1)),e("div",wr,[z(e("select",{"onUpdate:modelValue":u[0]||(u[0]=V=>T.value=V),onChange:Se},[u[4]||(u[4]=e("option",{value:""},"Select Broadlink device...",-1)),(n(!0),a(ce,null,he(C.value,V=>(n(),a("option",{key:V.entity_id,value:V.entity_id},m(V.name)+m(V.area_name?" ("+V.area_name+")":""),9,$r))),128))],544),[[we,T.value]]),F.value?(n(),a("div",Cr,[...u[5]||(u[5]=[e("i",{class:"mdi mdi-alert"},null,-1),_(" Device is required ",-1)])])):M("",!0)]),e("small",null,"This device will be used to learn commands ("+m(C.value.length)+" devices found)",1)],2),e("div",_r,[u[8]||(u[8]=e("label",null,"Command Type *",-1)),z(e("select",{"onUpdate:modelValue":u[1]||(u[1]=V=>E.value=V),onChange:Ie,disabled:c.value>0},[...u[7]||(u[7]=[e("option",{value:"ir"},"ğŸ“¡ Infrared (IR) - Most common for AC, TV, etc.",-1),e("option",{value:"rf"},"ğŸ“» Radio Frequency (RF) - For RF remotes",-1)])],40,Sr),[[we,E.value]]),c.value>0?(n(),a("small",Ir,"Command type cannot be changed after learning commands")):(n(),a("small",Dr,"Select the type of commands your device uses"))])]),c.value>0&&!A.value?(n(),a("div",xr,[u[10]||(u[10]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[u[9]||(u[9]=e("strong",null,"Editing Existing Profile",-1)),e("p",null,m(c.value)+" command"+m(c.value!==1?"s":"")+' already learned. You can re-learn any command by clicking the delete icon and then "Learn Command".',1)])])):M("",!0),e("div",Tr,[u[14]||(u[14]=e("i",{class:"mdi mdi-information"},null,-1)),e("div",null,[u[13]||(u[13]=e("p",null,[e("strong",null,"How it works:")],-1)),o.commandType==="ir"?(n(),a("ol",Rr,[...u[11]||(u[11]=[e("li",null,'Click "Learn Command" for each combination',-1),e("li",null,[e("strong",null,"Point your IR remote directly at the Broadlink device")],-1),e("li",null,"Press the button on your remote",-1),e("li",null,"Wait for confirmation (up to 30 seconds)",-1)])])):(n(),a("ol",Mr,[...u[12]||(u[12]=[e("li",null,'Click "Learn Command" for each combination',-1),e("li",null,[e("strong",null,"Step 1:"),_(" Hold button on remote - Broadlink scans for RF frequency")],-1),e("li",null,[e("strong",null,"Step 2:"),_(" Watch for Home Assistant notification, then press and release button")],-1),e("li",null,"Keep remote within 5cm of Broadlink (RF doesn't need line-of-sight)",-1),e("li",null,"Wait for confirmation (may take up to 30 seconds)",-1)])]))])]),e("div",Lr,[e("div",Or,[e("div",{class:"progress-fill",style:tt({width:N.value+"%"})},null,4)]),e("span",Ar,m(c.value)+" / "+m(d.value)+" commands learned ("+m(N.value)+"%) ",1)]),e("div",Er,[(n(!0),a(ce,null,he(s.value,V=>(n(),a("div",{key:V.key,class:Z(["command-card",{learned:l.value[V.key],learning:g.value===V.key}])},[e("div",Vr,[e("div",jr,[e("i",{class:Z(V.icon)},null,2)]),e("div",Pr,[e("h4",null,m(V.label),1),e("p",null,m(V.description),1)])]),g.value===V.key?(n(),a("div",Ur,[o.commandType==="ir"?(n(),a("div",Fr,[...u[15]||(u[15]=[e("p",null,[e("strong",null,"Point your remote directly at the Broadlink device and press the button.")],-1),e("small",null,"Listening for up to 30 seconds...",-1)])])):(n(),a("div",Nr,[...u[16]||(u[16]=[e("p",{class:"rf-title"},[e("strong",null,"Learning request sent to device.")],-1),e("p",{class:"rf-subtitle"},[_("RF learning is a "),e("strong",null,"two-step process"),_(":")],-1),e("ol",null,[e("li",null,[e("strong",null,"Step 1 - Frequency Sweep (~10-15 seconds):"),_(" Press and hold the button on your remote until the notification updates. ")]),e("li",null,[e("strong",null,"Step 2 - Learn Signal:"),_(" Press and release the button once. ")])],-1),e("p",{class:"rf-note"},"Follow the Home Assistant notifications (ğŸ””) for real-time instructions.",-1)])]))])):M("",!0),e("div",Br,[l.value[V.key]?(n(),a("div",qr,[u[18]||(u[18]=e("i",{class:"mdi mdi-check-circle"},null,-1)),u[19]||(u[19]=e("span",null,"Learned",-1)),e("span",{class:Z(["command-type-badge",E.value])},m(E.value.toUpperCase()),3),e("button",{onClick:ie=>le(V.key),class:"icon-btn",title:"Test command",disabled:f.value===V.key,style:{"margin-left":"auto"}},[e("i",{class:Z(["mdi mdi-play",{"mdi-spin":f.value===V.key}])},null,2)],8,Jr),e("button",{onClick:ie=>me(V.key),class:"icon-btn danger",title:"Delete and re-learn"},[...u[17]||(u[17]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,zr)])):(n(),a("button",{key:0,onClick:ie=>ne(V),class:Z(["btn-learn",{learning:g.value===V.key}]),disabled:g.value!==null},[e("i",{class:Z(["mdi mdi-radio-tower",{"mdi-spin":g.value===V.key}])},null,2),_(" "+m(g.value===V.key?"Listening...":"Learn Command"),1)],10,Hr))])],2))),128))]),e("div",Gr,[e("button",{onClick:B,class:"btn-secondary",disabled:g.value!==null||c.value===d.value},[...u[20]||(u[20]=[e("i",{class:"mdi mdi-play-circle"},null,-1),_(" Learn All Remaining ",-1)])],8,Wr),e("button",{onClick:ee,class:"btn-text",disabled:c.value===0},[...u[21]||(u[21]=[e("i",{class:"mdi mdi-delete-sweep"},null,-1),_(" Clear All ",-1)])],8,Kr)]),ye(Le,{isOpen:j.value.show,title:"Delete Learned Command?",message:`Are you sure you want to delete the '${j.value.commandLabel}' command?

You will need to re-learn this command.`,confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,onConfirm:L,onCancel:u[2]||(u[2]=V=>j.value.show=!1)},null,8,["isOpen","message"]),ye(Le,{isOpen:x.value,title:"Delete All Learned Commands?",message:"Are you sure you want to delete all learned commands? This cannot be undone.\\n\\nYou will need to re-learn all commands.",confirmText:"Delete All",cancelText:"Cancel",dangerMode:!0,onConfirm:de,onCancel:u[3]||(u[3]=V=>x.value=!1)},null,8,["isOpen"])]))}},Yr=ke(Xr,[["__scopeId","data-v-3ef02e18"]]),Zr={class:"profile-preview"},Qr={class:"preview-summary"},ed={class:"summary-card"},td={class:"stats-grid"},od={class:"stat-item"},ld={class:"stat-value"},nd={class:"stat-item"},sd={class:"stat-value"},ad={class:"stat-item"},id={class:"stat-value"},rd={class:"preview-tabs"},dd={class:"preview-content"},ud={key:0,class:"tab-content"},cd={class:"code-header"},md={class:"code-block"},vd={key:1,class:"tab-content"},fd={class:"code-header"},pd={class:"code-block"},gd={key:2,class:"tab-content"},yd={class:"instructions"},bd={class:"step-item"},hd={class:"step-content"},kd={class:"code-path"},wd={__name:"ProfilePreview",props:{profile:{type:Object,required:!0},jsonData:{type:Object,required:!0},yamlConfig:{type:String,required:!0}},setup(o){const v=Ve(),r=o,$=y("json"),w=y(!1),l=y(!1),g=J(()=>Object.keys(r.profile.commands||{}).length),f=J(()=>JSON.stringify(r.jsonData,null,2));async function C(){try{await navigator.clipboard.writeText(f.value),w.value=!0,setTimeout(()=>{w.value=!1},2e3)}catch(E){console.error("Failed to copy JSON:",E),v.error("Failed to copy to clipboard")}}async function T(){try{await navigator.clipboard.writeText(r.yamlConfig),l.value=!0,setTimeout(()=>{l.value=!1},2e3)}catch(E){console.error("Failed to copy YAML:",E),v.error("Failed to copy to clipboard")}}return(E,h)=>{var t;return n(),a("div",Zr,[h[22]||(h[22]=e("h3",null,"Preview & Save",-1)),e("div",Qr,[e("div",ed,[h[4]||(h[4]=e("i",{class:"mdi mdi-check-circle"},null,-1)),e("div",null,[h[3]||(h[3]=e("h4",null,"Profile Ready!",-1)),e("p",null,m(o.profile.manufacturer)+" "+m(o.profile.model),1)])]),e("div",td,[e("div",od,[e("span",ld,m(g.value),1),h[5]||(h[5]=e("span",{class:"stat-label"},"Commands Learned",-1))]),e("div",nd,[e("span",sd,m(o.profile.platform),1),h[6]||(h[6]=e("span",{class:"stat-label"},"Platform",-1))]),e("div",ad,[e("span",id,m(((t=o.profile.config.modes)==null?void 0:t.length)||0),1),h[7]||(h[7]=e("span",{class:"stat-label"},"HVAC Modes",-1))])])]),e("div",rd,[e("button",{onClick:h[0]||(h[0]=A=>$.value="json"),class:Z(["tab-button",{active:$.value==="json"}])},[...h[8]||(h[8]=[e("i",{class:"mdi mdi-code-json"},null,-1),_(" SmartIR JSON ",-1)])],2),e("button",{onClick:h[1]||(h[1]=A=>$.value="yaml"),class:Z(["tab-button",{active:$.value==="yaml"}])},[...h[9]||(h[9]=[e("i",{class:"mdi mdi-file-code"},null,-1),_(" YAML Config ",-1)])],2),e("button",{onClick:h[2]||(h[2]=A=>$.value="instructions"),class:Z(["tab-button",{active:$.value==="instructions"}])},[...h[10]||(h[10]=[e("i",{class:"mdi mdi-information"},null,-1),_(" Instructions ",-1)])],2)]),e("div",dd,[$.value==="json"?(n(),a("div",ud,[e("div",cd,[h[12]||(h[12]=e("h4",null,"SmartIR Device Code JSON",-1)),e("button",{onClick:C,class:"btn-copy"},[h[11]||(h[11]=e("i",{class:"mdi mdi-content-copy"},null,-1)),_(" "+m(w.value?"Copied!":"Copy"),1)])]),e("pre",md,[e("code",null,m(f.value),1)]),h[13]||(h[13]=e("p",{class:"code-note"},[e("i",{class:"mdi mdi-information"}),_(" Save this as "),e("code",null,"10000.json"),_(" in your SmartIR codes directory ")],-1))])):M("",!0),$.value==="yaml"?(n(),a("div",vd,[e("div",fd,[h[15]||(h[15]=e("h4",null,"Home Assistant Configuration",-1)),e("button",{onClick:T,class:"btn-copy"},[h[14]||(h[14]=e("i",{class:"mdi mdi-content-copy"},null,-1)),_(" "+m(l.value?"Copied!":"Copy"),1)])]),e("pre",pd,[e("code",null,m(o.yamlConfig),1)]),h[16]||(h[16]=e("p",{class:"code-note"},[e("i",{class:"mdi mdi-information"}),_(" Add this to your "),e("code",null,"configuration.yaml"),_(" file ")],-1))])):M("",!0),$.value==="instructions"?(n(),a("div",gd,[e("div",yd,[h[20]||(h[20]=e("h4",null,"Installation Steps",-1)),e("div",bd,[h[19]||(h[19]=e("div",{class:"step-number"},"1",-1)),e("div",hd,[h[17]||(h[17]=e("h5",null,"Get Next Code Number",-1)),h[18]||(h[18]=e("p",null,"Custom device codes start at 10000. Check your SmartIR codes directory to find the next available number.",-1)),e("div",kd,[e("code",null,"/config/custom_components/smartir/codes/"+m(o.profile.platform)+"/",1)])])]),h[21]||(h[21]=Oe('<div class="step-item" data-v-cbf0874d><div class="step-number" data-v-cbf0874d>2</div><div class="step-content" data-v-cbf0874d><h5 data-v-cbf0874d>Save JSON File</h5><p data-v-cbf0874d>Copy the JSON from the &quot;SmartIR JSON&quot; tab and save it as <code data-v-cbf0874d>10000.json</code> (or your next available number) in the codes directory.</p></div></div><div class="step-item" data-v-cbf0874d><div class="step-number" data-v-cbf0874d>3</div><div class="step-content" data-v-cbf0874d><h5 data-v-cbf0874d>Update Configuration</h5><p data-v-cbf0874d>Copy the YAML from the &quot;YAML Config&quot; tab and add it to your <code data-v-cbf0874d>configuration.yaml</code> file. Update the <code data-v-cbf0874d>device_code</code> to match your JSON filename.</p></div></div><div class="step-item" data-v-cbf0874d><div class="step-number" data-v-cbf0874d>4</div><div class="step-content" data-v-cbf0874d><h5 data-v-cbf0874d>Restart Home Assistant</h5><p data-v-cbf0874d>Restart Home Assistant to load the new configuration. Your climate entity will appear in the UI.</p></div></div><div class="step-item" data-v-cbf0874d><div class="step-number" data-v-cbf0874d>5</div><div class="step-content" data-v-cbf0874d><h5 data-v-cbf0874d>Test Your Device</h5><p data-v-cbf0874d>Go to your climate entity and test different modes, temperatures, and fan speeds to ensure everything works correctly.</p></div></div><div class="tips-section" data-v-cbf0874d><h4 data-v-cbf0874d><i class="mdi mdi-lightbulb" data-v-cbf0874d></i> Tips </h4><ul data-v-cbf0874d><li data-v-cbf0874d>Keep a backup of your JSON file in case you need to modify it</li><li data-v-cbf0874d>Test all commands to ensure they work as expected</li><li data-v-cbf0874d>You can share your profile with the SmartIR community on GitHub</li><li data-v-cbf0874d>If a command doesn&#39;t work, you can re-learn it and update the JSON</li></ul></div>',5))])])):M("",!0)])])}}},$d=ke(wd,[["__scopeId","data-v-cbf0874d"]]),Cd={class:"wizard-body"},_d={key:0,class:"warning-section"},Sd={class:"warning-box"},Id={class:"instructions"},Dd={class:"code-block"},xd={class:"steps"},Td={key:0},Rd={class:"help-section"},Md={key:0,class:"help-content"},Ld={class:"help-step"},Od={key:0,class:"help-step"},Ad={class:"help-step"},Ed={class:"help-step"},Vd={class:"checklist"},jd={class:"checkbox-label"},Pd={key:0,class:"checkbox-label"},Ud={class:"wizard-footer"},Fd=["disabled"],Nd={__name:"SmartIRSetupWizard",props:{show:{type:Boolean,default:!1},platform:{type:String,required:!0},warnings:{type:Array,default:()=>[]},configPath:{type:String,default:"/config"}},emits:["close","complete"],setup(o,{emit:v}){const r=o,$=v,w=$e("toast"),l=y(!1),g=y(!1),f=y(!1),C=J(()=>r.warnings.length>0?l.value&&g.value:l.value);function T(){const h=`${r.platform}: !include smartir/${r.platform}.yaml`;navigator.clipboard.writeText(h).then(()=>{var t;(t=w.value)==null||t.success("Include line copied to clipboard!","âœ… Copied")}).catch(t=>{var A;console.error("Failed to copy:",t),(A=w.value)==null||A.error("Failed to copy to clipboard","âŒ Copy Failed")})}function E(){$("complete")}return(h,t)=>o.show?(n(),a("div",{key:0,class:"modal-overlay",onClick:t[5]||(t[5]=ge(()=>{},["stop"]))},[e("div",{class:"setup-wizard",onClick:t[4]||(t[4]=ge(()=>{},["stop"]))},[t[31]||(t[31]=e("div",{class:"wizard-header"},[e("h2",null,[e("i",{class:"mdi mdi-cog"}),_(" SmartIR Configuration Setup ")])],-1)),e("div",Cd,[o.warnings.length>0?(n(),a("div",_d,[e("div",Sd,[t[11]||(t[11]=e("i",{class:"mdi mdi-alert"},null,-1)),e("div",null,[t[9]||(t[9]=e("h3",null,"âš ï¸ Configuration Migration Needed",-1)),t[10]||(t[10]=e("p",null,"We detected existing platform entries in your configuration.yaml:",-1)),e("ul",null,[(n(!0),a(ce,null,he(o.warnings,A=>(n(),a("li",{key:A.platform},[e("strong",null,m(A.platform)+":",1),_(" "+m(A.message),1)]))),128))]),e("p",null,[t[6]||(t[6]=e("strong",null,"Action Required:",-1)),t[7]||(t[7]=_(" Move these entries to ",-1)),e("code",null,"smartir/"+m(o.platform)+".yaml",1),t[8]||(t[8]=_(" before continuing.",-1))])])])])):M("",!0),e("div",Id,[t[27]||(t[27]=e("h3",null,"ğŸ“ One-Time Setup",-1)),t[28]||(t[28]=e("p",null,[_("To enable SmartIR device management, add this line to your "),e("code",null,"configuration.yaml"),_(":")],-1)),e("div",Dd,[e("code",null,m(o.platform)+": !include smartir/"+m(o.platform)+".yaml",1),e("button",{onClick:T,class:"copy-btn",title:"Copy to clipboard"},[...t[12]||(t[12]=[e("i",{class:"mdi mdi-content-copy"},null,-1)])])]),e("div",xd,[t[19]||(t[19]=e("h4",null,"Steps:",-1)),e("ol",null,[o.warnings.length>0?(n(),a("li",Td,[t[13]||(t[13]=e("strong",null,"Move existing entries:",-1)),t[14]||(t[14]=_(" Copy any existing ",-1)),e("code",null,m(o.platform)+":",1),t[15]||(t[15]=_(" entries from configuration.yaml to ",-1)),e("code",null,"smartir/"+m(o.platform)+".yaml",1)])):M("",!0),t[16]||(t[16]=e("li",null,[e("strong",null,"Add include line:"),_(" Add the line above to your configuration.yaml ")],-1)),t[17]||(t[17]=e("li",null,[e("strong",null,"Save changes:"),_(" Save configuration.yaml ")],-1)),t[18]||(t[18]=e("li",null,[e("strong",null,"Continue here:"),_(` Click "I've Completed Setup" below `)],-1))])]),e("div",Rd,[e("button",{onClick:t[0]||(t[0]=A=>f.value=!f.value),class:"help-toggle"},[e("i",{class:Z(["mdi",f.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2),_(" "+m(f.value?"Hide":"Show")+" Detailed Instructions ",1)]),f.value?(n(),a("div",Md,[t[26]||(t[26]=e("h4",null,"Detailed Setup Guide:",-1)),e("div",Ld,[t[21]||(t[21]=e("h5",null,"1. Open configuration.yaml",-1)),e("p",null,[t[20]||(t[20]=_("Location: ",-1)),e("code",null,m(o.configPath)+"/configuration.yaml",1)])]),o.warnings.length>0?(n(),a("div",Od,[t[22]||(t[22]=e("h5",null,"2. Migrate Existing Entries (If Any)",-1)),e("p",null,"If you have existing "+m(o.platform)+" entries, cut them from configuration.yaml and paste into:",1),e("p",null,[e("code",null,m(o.configPath)+"/smartir/"+m(o.platform)+".yaml",1)]),t[23]||(t[23]=e("p",{class:"note"},"Broadlink Manager will create this file automatically.",-1))])):M("",!0),e("div",Ad,[e("h5",null,m(o.warnings.length>0?"3":"2")+". Add Include Line",1),t[24]||(t[24]=e("p",null,"Add this to configuration.yaml:",-1)),e("pre",null,m(o.platform)+": !include smartir/"+m(o.platform)+".yaml",1)]),e("div",Ed,[e("h5",null,m(o.warnings.length>0?"4":"3")+". Restart Home Assistant",1),t[25]||(t[25]=e("p",null,"After saving, you'll need to restart HA for changes to take effect.",-1))])])):M("",!0)])]),e("div",Vd,[e("label",jd,[z(e("input",{type:"checkbox","onUpdate:modelValue":t[1]||(t[1]=A=>l.value=A)},null,512),[[fe,l.value]]),t[29]||(t[29]=e("span",null,"I've added the include line to configuration.yaml",-1))]),o.warnings.length>0?(n(),a("label",Pd,[z(e("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=A=>g.value=A)},null,512),[[fe,g.value]]),e("span",null,"I've migrated existing "+m(o.platform)+" entries (if any)",1)])):M("",!0)])]),e("div",Ud,[e("button",{onClick:t[3]||(t[3]=A=>h.$emit("close")),class:"btn-secondary"}," Cancel "),e("button",{onClick:E,class:"btn-primary",disabled:!C.value},[...t[30]||(t[30]=[e("i",{class:"mdi mdi-check"},null,-1),_(" I've Completed Setup ",-1)])],8,Fd)])])])):M("",!0)}},Bd=ke(Nd,[["__scopeId","data-v-f6fe4c03"]]),Hd={class:"modal-header"},qd={class:"progress-steps"},Jd={class:"step-number"},zd={key:0,class:"mdi mdi-check"},Gd={key:1},Wd={class:"step-label"},Kd={class:"modal-body"},Xd={key:0,class:"step-content"},Yd={class:"form-group"},Zd={class:"form-group"},Qd={class:"form-group"},eu={key:1,class:"step-content"},tu={key:1,class:"platform-form"},ou={class:"form-section"},lu={class:"checkbox-grid"},nu={class:"checkbox-item"},su={class:"checkbox-item"},au={class:"checkbox-item"},iu={class:"checkbox-item"},ru={class:"checkbox-item"},du={key:2,class:"platform-form"},uu={class:"form-section"},cu={class:"form-group"},mu={class:"form-section"},vu={class:"checkbox-grid"},fu={class:"checkbox-item"},pu={class:"checkbox-item"},gu={key:3,class:"platform-form"},yu={class:"form-section"},bu={class:"checkbox-grid"},hu={class:"checkbox-item"},ku={class:"checkbox-item"},wu={class:"checkbox-item"},$u={class:"checkbox-item"},Cu={key:2,class:"step-content"},_u={key:3,class:"step-content"},Su={class:"modal-footer"},Iu=["disabled"],Du={key:2,class:"save-buttons"},xu=["disabled"],Tu=["disabled"],Ru={__name:"SmartIRProfileBuilder",props:{show:{type:Boolean,default:!1},editMode:{type:Boolean,default:!1},editData:{type:Object,default:null},startStep:{type:Number,default:0}},emits:["close","save"],setup(o,{emit:v}){const r=o,$=v,w=$e("toast"),l=y(0),g=y(!1),f=y([]),C=y(!1),T=y([]),E=y("/config"),h=y(!1),t=y(null),A=y(!1),F=y(!1),j=y(""),x=y("ir"),s=y(!1),d=[{label:"Device Info",key:"info"},{label:"Configuration",key:"config"},{label:"Learn Commands",key:"commands"},{label:"Preview & Save",key:"preview"}],c=y({platform:"",manufacturer:"",model:"",broadlinkDevice:"",commandType:"ir",config:{},commands:{}}),N=y(["turn_on"]),Q=y(3),ne=y([]),le=y(["turn_on"]);pe(()=>c.value.platform,O=>{O==="media_player"?c.value.config={features:N.value}:O==="fan"?c.value.config={speedLevels:Q.value,features:ne.value}:O==="light"&&(c.value.config={features:le.value})}),pe(N,O=>{c.value.platform==="media_player"&&(c.value.config={features:O})},{deep:!0}),pe(Q,O=>{c.value.platform==="fan"&&(c.value.config={speedLevels:O,features:ne.value})}),pe(ne,O=>{c.value.platform==="fan"&&(c.value.config={speedLevels:Q.value,features:O})},{deep:!0}),pe(le,O=>{c.value.platform==="light"&&(c.value.config={features:O})},{deep:!0});function me(O){const i=new Set,U=Object.keys(O);return U.some(P=>P==="off"||P.includes("_off"))&&i.add("off"),U.some(P=>P.includes("auto"))&&i.add("auto"),U.some(P=>P.includes("cool"))&&i.add("cool"),U.some(P=>P.includes("heat"))&&i.add("heat"),U.some(P=>P.includes("dry"))&&i.add("dry"),U.some(P=>P.includes("fan_only"))&&i.add("fan_only"),Array.from(i)}function L(O){const i=new Set,U=Object.keys(O);return U.some(P=>P.includes("auto"))&&i.add("auto"),U.some(P=>P.includes("low"))&&i.add("low"),U.some(P=>P.includes("medium")||P.includes("mid"))&&i.add("medium"),U.some(P=>P.includes("high"))&&i.add("high"),Array.from(i)}function B(O){const i=new Set,U=Object.keys(O);return U.some(P=>P.includes("swing_off")||P.includes("_off"))&&i.add("off"),U.some(P=>P.includes("vertical"))&&i.add("vertical"),U.some(P=>P.includes("horizontal"))&&i.add("horizontal"),U.some(P=>P.includes("both"))&&i.add("both"),Array.from(i)}function ee(O){for(const i of Object.values(O))if(typeof i=="string"&&i.startsWith("sc")||Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0].startsWith("sc"))return"rf";return"ir"}pe(()=>c.value.commandType,(O,i)=>{!i||A.value||s.value||(Object.keys(c.value.commands).length>0&&O!==i?(j.value=O,c.value.commandType=i,A.value=!0):O!==i&&(x.value=O))}),pe(()=>r.editData,async O=>{var i,U,P;if(O&&r.editMode){console.log("ğŸ”§ Edit mode activated, loading profile data:",O),s.value=!0,f.value.length===0&&(console.log("ğŸ“¡ Loading Broadlink devices..."),await re(),console.log("ğŸ“¡ Devices loaded:",f.value.length));const D=O.profile,k=D.controller_data;console.log("ğŸ® Controller data from profile:",k),console.log("ğŸ® Available devices:",f.value.map(W=>W.entity_id));const R=D.commands||{},H=D.commandType||ee(R);console.log("ğŸ” Command type (stored):",D.commandType),console.log("ğŸ” Command type (final):",H);let K={};if(O.platform==="climate"){const W=D.operationModes||me(R),te=D.fanModes||L(R),ve=D.swingModes||B(R);console.log("ğŸ” Inferred modes:",W),console.log("ğŸ” Inferred fan modes:",te),console.log("ğŸ” Inferred swing modes:",ve),K={minTemp:D.minTemperature,maxTemp:D.maxTemperature,precision:D.precision,modes:W,fanModes:te,swingModes:ve}}else if(O.platform==="media_player"){const W=[];(R.on||R.off)&&W.push("turn_on"),(R.volumeUp||R.volumeDown)&&W.push("volume"),R.mute&&W.push("mute"),R.sources&&W.push("source"),(R.channelUp||R.channelDown)&&W.push("channel"),K={features:W},N.value=W,console.log("ğŸ” Inferred media player features:",W)}else if(O.platform==="fan"){const W=((i=D.speed)==null?void 0:i.length)||Object.keys(R.default||{}).length||3,te=[];(R.oscillate_on||R.oscillate_off)&&te.push("oscillate"),(R.direction_forward||R.direction_reverse)&&te.push("direction"),K={speedLevels:W,features:te},Q.value=W,ne.value=te,console.log("ğŸ” Inferred fan config:",K)}else if(O.platform==="light"){const W=[];K={features:W},le.value=W,console.log("ğŸ” Inferred light features:",W)}const se=await I(D.manufacturer,(U=D.supportedModels)==null?void 0:U[0],R);c.value={platform:O.platform,manufacturer:D.manufacturer||"",model:((P=D.supportedModels)==null?void 0:P[0])||"",broadlinkDevice:k||"",commandType:H,config:K,commands:se},console.log("âœ… Profile populated:",c.value),console.log("âœ… Selected device:",c.value.broadlinkDevice),console.log("âœ… Command type:",c.value.commandType),console.log("âœ… Commands (with learned codes):",se),x.value=H,setTimeout(()=>{s.value=!1},100)}},{immediate:!0});const de=J(()=>{var O;switch(l.value){case 0:return c.value.platform&&c.value.manufacturer&&c.value.model;case 1:return c.value.platform==="climate"?c.value.config.minTemp&&c.value.config.maxTemp&&((O=c.value.config.modes)==null?void 0:O.length)>0:!0;case 2:return c.value.broadlinkDevice&&c.value.commandType&&Object.keys(c.value.commands).length>0;case 3:return!0;default:return!1}}),be=y(null);async function Se(){if(l.value!==3){be.value=null;return}if(console.log("ğŸ” Generating JSON with commands:",c.value.commands),Object.values(c.value.commands).some(i=>typeof i=="string"?i==="pending":typeof i=="object"?Object.values(i).some(U=>typeof U=="string"?U==="pending":typeof U=="object"?Object.values(U).some(P=>P==="pending"):!1):!1)){console.warn('âš ï¸ Commands still contain "pending" placeholders!'),console.log("ğŸ“¦ Attempting to fetch from Broadlink storage...");const i=await I(c.value.manufacturer,c.value.model,c.value.commands);c.value.commands=i,console.log("âœ… Updated commands:",i)}be.value=oe(c.value),console.log("ğŸ“„ Generated JSON:",be.value)}const Ie=J(()=>l.value!==3?null:Y(c.value));function De(){c.value.config={},c.value.commands={}}function S(){A.value=!1,c.value.commandType=j.value,x.value=j.value,c.value.commands={},j.value=""}function u(){A.value=!1,j.value=""}async function V(){l.value<d.length-1&&(l.value++,l.value===3&&await Se())}function ie(){l.value>0&&l.value--}function G(){A.value||(F.value=!0)}function b(){F.value=!1,p()}function p(){$("close"),setTimeout(()=>{l.value=0,c.value={platform:"",manufacturer:"",model:"",broadlinkDevice:"",commandType:"ir",config:{},commands:{}},x.value="ir"},300)}async function X(){var O,i,U,P,D;g.value=!0;try{if(!h.value){const W=await fetch("api/smartir/config/check");if(W.ok){const te=await W.json();if(!((O=te.platforms[c.value.platform])==null?void 0:O.file_exists)){T.value=te.configuration_warnings||[],E.value=te.config_path||"/config",t.value={platform:c.value.platform,json:be.value},C.value=!0,g.value=!1;return}}}let k;if(r.editMode&&((i=r.editData)!=null&&i.code))k=parseInt(r.editData.code),console.log("ğŸ“ Edit mode: Using existing code",k);else{const W=await fetch(`api/smartir/platforms/${c.value.platform}/next-code`);if(!W.ok)throw new Error("Failed to get next code number");k=(await W.json()).next_code,console.log("âœ¨ New profile: Using next code",k)}const R=await fetch("api/smartir/profiles",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({platform:c.value.platform,json:be.value,code_number:k})});if(!R.ok){const W=await R.json();throw new Error(W.error||"Failed to save profile")}const H=await R.json(),K={name:`${c.value.manufacturer} ${c.value.model}`,unique_id:`${c.value.manufacturer.toLowerCase().replace(/[^a-z0-9]+/g,"_")}_${c.value.model.toLowerCase().replace(/[^a-z0-9]+/g,"_")}`,device_code:k,controller_data:c.value.broadlinkDevice},se=await fetch("api/smartir/config/add-device",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({platform:c.value.platform,device_config:K})});if(!se.ok){const W=await se.json();console.error("Failed to add device to config:",W),(U=w.value)==null||U.warning(`Profile saved but failed to add to config file: ${W.error}`,"âš ï¸ Partial Success")}$("save",{json:be.value,yaml:Ie.value,profile:c.value,saved_to:H.path}),(P=w.value)==null||P.success(`File: ${H.filename}
Device Code: ${k}
Added to: smartir/${c.value.platform}.yaml

âš ï¸ Restart Home Assistant to activate`,"âœ… Profile Saved Successfully!"),p()}catch(k){console.error("Error saving profile:",k),(D=w.value)==null||D.error(k.message,"âŒ Error Saving Profile")}finally{g.value=!1}}async function ae(){h.value=!0,C.value=!1,t.value&&(await X(),t.value=null)}function q(){var O,i;try{const U=JSON.stringify(be.value,null,2),P=new Blob([U],{type:"application/json"}),D=URL.createObjectURL(P),k=document.createElement("a");k.href=D;const R=c.value.manufacturer.toLowerCase().replace(/\s+/g,"_"),H=c.value.model.toLowerCase().replace(/\s+/g,"_");k.download=`smartir_${c.value.platform}_${R}_${H}.json`,document.body.appendChild(k),k.click(),document.body.removeChild(k),URL.revokeObjectURL(D),(O=w.value)==null||O.success("You can manually upload this file to your SmartIR codes directory.","âœ… Profile Downloaded")}catch(U){console.error("Error downloading profile:",U),(i=w.value)==null||i.error(U.message,"âŒ Error Downloading Profile")}}async function I(O,i,U){const P=O.toLowerCase().replace(/[^a-z0-9]+/g,"_"),D=i.toLowerCase().replace(/[^a-z0-9]+/g,"_"),k=`${P}_${D}`;try{const R=await fetch("/api/commands/all");if(!R.ok)return console.error("Failed to fetch commands from Broadlink storage"),U;const K=(await R.json())[k]||{};console.log(`ğŸ” Fetching learned commands for device: ${k}`),console.log("ğŸ“¦ Device commands from storage:",K);const se={...U};for(const[W,te]of Object.entries(se))if(te==="pending"&&K[W])se[W]=K[W];else if(typeof te=="object"){for(const[ve,xe]of Object.entries(te))if(typeof xe=="object")for(const[Me,Ee]of Object.entries(xe)){const He=`${W}_${ve}_${Me}`;Ee==="pending"&&K[He]&&(se[W][ve][Me]=K[He])}else if(xe==="pending"){const Me=`${W}_${ve}`;K[Me]&&(se[W][ve]=K[Me])}}return console.log("âœ… Merged commands:",se),se}catch(R){return console.error("Error fetching learned commands:",R),U}}function oe(O){const i={manufacturer:O.manufacturer,supportedModels:[O.model],supportedController:"Broadlink",commandsEncoding:"Base64",commandType:O.commandType||"ir",commands:{}};return O.platform==="climate"&&(i.minTemperature=O.config.minTemp,i.maxTemperature=O.config.maxTemp,i.precision=O.config.precision||1,i.operationModes=O.config.modes||[],i.fanModes=O.config.fanModes&&O.config.fanModes.length>0?O.config.fanModes:["auto"],O.config.swingModes&&O.config.swingModes.length>0&&(i.swingModes=O.config.swingModes),i.commands=O.commands),i}function Y(O){let i=`# SmartIR ${O.platform} configuration
`;return i+=`# Generated by Broadlink Manager v2

`,O.platform==="climate"&&(i+=`climate:
`,i+=`  - platform: smartir
`,i+=`    name: ${O.manufacturer} ${O.model}
`,i+=`    unique_id: ${O.manufacturer.toLowerCase()}_${O.model.toLowerCase().replace(/\s+/g,"_")}
`,i+=`    device_code: 10000  # Change this to your custom code number
`,i+=`    controller_data: ${O.broadlinkDevice}
`,O.config.tempSensor&&(i+=`    temperature_sensor: ${O.config.tempSensor}
`),O.config.humiditySensor&&(i+=`    humidity_sensor: ${O.config.humiditySensor}
`),O.config.powerSensor&&(i+=`    power_sensor: ${O.config.powerSensor}
`)),i}async function re(){try{console.log("Fetching remote devices from api/remote/devices...");const O=await fetch("api/remote/devices");if(console.log("Response status:",O.status,O.ok),O.ok){const i=await O.json();console.log("Loaded remote devices response:",i);const U=i.devices||[];console.log("Extracted devices array:",U),console.log("Device count:",U.length),f.value=U,console.log("broadlinkDevices.value set to:",f.value),console.log("Final device count:",f.value.length)}else console.error("Response not OK:",O.status,O.statusText),f.value=[]}catch(O){console.error("Error loading remote devices:",O),f.value=[]}}return pe(()=>r.show,O=>{if(O){const i=Number.isInteger(r.startStep)?r.startStep:0;l.value=Math.min(Math.max(i,0),d.length-1)}}),pe(()=>r.startStep,O=>{if(r.show){const i=Number.isInteger(O)?O:0;l.value=Math.min(Math.max(i,0),d.length-1)}}),Te(()=>{r.show&&re()}),(O,i)=>o.show?(n(),a("div",{key:0,class:"modal-overlay",onClick:G},[e("div",{class:"modal-container",onClick:i[19]||(i[19]=ge(()=>{},["stop"]))},[e("div",Hd,[e("h2",null,[i[22]||(i[22]=e("i",{class:"mdi mdi-file-document-edit"},null,-1)),_(" "+m(o.editMode?"Edit SmartIR Profile":"Create SmartIR Profile"),1)]),e("button",{onClick:p,class:"close-button"},[...i[23]||(i[23]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",qd,[(n(),a(ce,null,he(d,(U,P)=>e("div",{key:P,class:Z(["step",{active:l.value===P,completed:l.value>P}])},[e("div",Jd,[l.value>P?(n(),a("i",zd)):(n(),a("span",Gd,m(P+1),1))]),e("span",Wd,m(U.label),1)],2)),64))]),e("div",Kd,[l.value===0?(n(),a("div",Xd,[i[29]||(i[29]=e("h3",null,"Device Information",-1)),e("div",Yd,[i[25]||(i[25]=e("label",null,"Platform Type *",-1)),z(e("select",{"onUpdate:modelValue":i[0]||(i[0]=U=>c.value.platform=U),onChange:De},[...i[24]||(i[24]=[Oe('<option value="" data-v-fc2b754e>Select platform...</option><option value="climate" data-v-fc2b754e>ğŸŒ¡ï¸ Climate (AC, Heater, Heat Pump)</option><option value="media_player" data-v-fc2b754e>ğŸ“º Media Player (TV, Receiver)</option><option value="fan" data-v-fc2b754e>ğŸŒ€ Fan</option><option value="light" data-v-fc2b754e>ğŸ’¡ Light (LED Strip, IR Light)</option>',5)])],544),[[we,c.value.platform]])]),e("div",Zd,[i[26]||(i[26]=e("label",null,"Manufacturer *",-1)),z(e("input",{"onUpdate:modelValue":i[1]||(i[1]=U=>c.value.manufacturer=U),type:"text",placeholder:"e.g., Daikin, LG, Samsung"},null,512),[[_e,c.value.manufacturer]])]),e("div",Qd,[i[27]||(i[27]=e("label",null,"Model(s) *",-1)),z(e("input",{"onUpdate:modelValue":i[2]||(i[2]=U=>c.value.model=U),type:"text",placeholder:"e.g., FTXS35K, Multiple models"},null,512),[[_e,c.value.model]]),i[28]||(i[28]=e("small",null,'Enter model number or "Multiple" if it works with many models',-1))])])):M("",!0),l.value===1?(n(),a("div",eu,[c.value.platform==="climate"?(n(),Re(br,{key:0,modelValue:c.value.config,"onUpdate:modelValue":i[3]||(i[3]=U=>c.value.config=U)},null,8,["modelValue"])):c.value.platform==="media_player"?(n(),a("div",tu,[i[36]||(i[36]=e("h3",null,"Media Player Configuration",-1)),i[37]||(i[37]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),_(" Configure the features your media player supports. You'll learn the IR commands in the next step. ")],-1)),e("div",ou,[i[35]||(i[35]=e("h4",null,"Supported Features",-1)),e("div",lu,[e("label",nu,[z(e("input",{type:"checkbox",value:"turn_on","onUpdate:modelValue":i[4]||(i[4]=U=>N.value=U)},null,512),[[fe,N.value]]),i[30]||(i[30]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),_(" Power On/Off ")],-1))]),e("label",su,[z(e("input",{type:"checkbox",value:"volume","onUpdate:modelValue":i[5]||(i[5]=U=>N.value=U)},null,512),[[fe,N.value]]),i[31]||(i[31]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-volume-high"}),_(" Volume Control ")],-1))]),e("label",au,[z(e("input",{type:"checkbox",value:"mute","onUpdate:modelValue":i[6]||(i[6]=U=>N.value=U)},null,512),[[fe,N.value]]),i[32]||(i[32]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-volume-mute"}),_(" Mute ")],-1))]),e("label",iu,[z(e("input",{type:"checkbox",value:"source","onUpdate:modelValue":i[7]||(i[7]=U=>N.value=U)},null,512),[[fe,N.value]]),i[33]||(i[33]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-import"}),_(" Source Selection ")],-1))]),e("label",ru,[z(e("input",{type:"checkbox",value:"channel","onUpdate:modelValue":i[8]||(i[8]=U=>N.value=U)},null,512),[[fe,N.value]]),i[34]||(i[34]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-numeric"}),_(" Channel Control ")],-1))])])])])):c.value.platform==="fan"?(n(),a("div",du,[i[44]||(i[44]=e("h3",null,"Fan Configuration",-1)),i[45]||(i[45]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),_(" Configure the features your fan supports. You'll learn the IR commands in the next step. ")],-1)),e("div",uu,[i[40]||(i[40]=e("h4",null,"Fan Speed Levels",-1)),e("div",cu,[i[39]||(i[39]=e("label",null,"Number of Speed Levels *",-1)),z(e("select",{"onUpdate:modelValue":i[9]||(i[9]=U=>Q.value=U)},[...i[38]||(i[38]=[e("option",{value:1},"1 Speed",-1),e("option",{value:2},"2 Speeds",-1),e("option",{value:3},"3 Speeds (Low/Med/High)",-1),e("option",{value:4},"4 Speeds",-1),e("option",{value:5},"5 Speeds",-1),e("option",{value:6},"6 Speeds",-1)])],512),[[we,Q.value,void 0,{number:!0}]])])]),e("div",mu,[i[43]||(i[43]=e("h4",null,"Additional Features",-1)),e("div",vu,[e("label",fu,[z(e("input",{type:"checkbox",value:"oscillate","onUpdate:modelValue":i[10]||(i[10]=U=>ne.value=U)},null,512),[[fe,ne.value]]),i[41]||(i[41]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-sync"}),_(" Oscillation ")],-1))]),e("label",pu,[z(e("input",{type:"checkbox",value:"direction","onUpdate:modelValue":i[11]||(i[11]=U=>ne.value=U)},null,512),[[fe,ne.value]]),i[42]||(i[42]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-rotate-3d-variant"}),_(" Direction (Forward/Reverse) ")],-1))])])])])):c.value.platform==="light"?(n(),a("div",gu,[i[51]||(i[51]=e("h3",null,"Light Configuration",-1)),i[52]||(i[52]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),_(" Configure the features your light supports. You'll learn the IR commands in the next step. ")],-1)),e("div",yu,[i[50]||(i[50]=e("h4",null,"Supported Features",-1)),e("div",bu,[e("label",hu,[z(e("input",{type:"checkbox",value:"turn_on","onUpdate:modelValue":i[12]||(i[12]=U=>le.value=U)},null,512),[[fe,le.value]]),i[46]||(i[46]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),_(" Power On/Off ")],-1))]),e("label",ku,[z(e("input",{type:"checkbox",value:"brightness","onUpdate:modelValue":i[13]||(i[13]=U=>le.value=U)},null,512),[[fe,le.value]]),i[47]||(i[47]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-brightness-6"}),_(" Brightness Control ")],-1))]),e("label",wu,[z(e("input",{type:"checkbox",value:"color_temp","onUpdate:modelValue":i[14]||(i[14]=U=>le.value=U)},null,512),[[fe,le.value]]),i[48]||(i[48]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-thermometer"}),_(" Color Temperature ")],-1))]),e("label",$u,[z(e("input",{type:"checkbox",value:"rgb","onUpdate:modelValue":i[15]||(i[15]=U=>le.value=U)},null,512),[[fe,le.value]]),i[49]||(i[49]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-palette"}),_(" RGB Color ")],-1))])])])])):M("",!0)])):M("",!0),l.value===2?(n(),a("div",Cu,[ye(Yr,{modelValue:c.value.commands,"onUpdate:modelValue":i[16]||(i[16]=U=>c.value.commands=U),platform:c.value.platform,config:c.value.config,broadlinkDevice:c.value.broadlinkDevice,"onUpdate:broadlinkDevice":i[17]||(i[17]=U=>c.value.broadlinkDevice=U),manufacturer:c.value.manufacturer,model:c.value.model,commandType:c.value.commandType,"onUpdate:commandType":i[18]||(i[18]=U=>c.value.commandType=U)},null,8,["modelValue","platform","config","broadlinkDevice","manufacturer","model","commandType"])])):M("",!0),l.value===3?(n(),a("div",_u,[ye($d,{profile:c.value,"json-data":be.value,"yaml-config":Ie.value},null,8,["profile","json-data","yaml-config"])])):M("",!0)]),e("div",Su,[l.value>0?(n(),a("button",{key:0,onClick:ie,class:"btn-secondary"},[...i[53]||(i[53]=[e("i",{class:"mdi mdi-arrow-left"},null,-1),_(" Back ",-1)])])):M("",!0),i[57]||(i[57]=e("div",{class:"spacer"},null,-1)),e("button",{onClick:p,class:"btn-text"}," Cancel "),l.value<d.length-1?(n(),a("button",{key:1,onClick:V,class:"btn-primary",disabled:!de.value},[...i[54]||(i[54]=[_(" Next ",-1),e("i",{class:"mdi mdi-arrow-right"},null,-1)])],8,Iu)):(n(),a("div",Du,[e("button",{onClick:X,class:"btn-primary",disabled:g.value},[i[55]||(i[55]=e("i",{class:"mdi mdi-cloud-upload"},null,-1)),_(" "+m(g.value?"Saving...":"Save to SmartIR"),1)],8,xu),e("button",{onClick:q,class:"btn-secondary",disabled:g.value},[...i[56]||(i[56]=[e("i",{class:"mdi mdi-download"},null,-1),_(" Download JSON ",-1)])],8,Tu)]))])]),ye(Bd,{show:C.value,platform:c.value.platform,warnings:T.value,"config-path":E.value,onClose:i[20]||(i[20]=U=>C.value=!1),onComplete:ae},null,8,["show","platform","warnings","config-path"]),ye(Le,{isOpen:A.value,title:"Change Command Type?",message:"Changing the command type will clear all learned commands. Continue?",confirmText:"Continue",cancelText:"Cancel",dangerMode:!0,onConfirm:S,onCancel:u},null,8,["isOpen"]),ye(Le,{isOpen:F.value,title:"Close Profile Builder?",message:"Are you sure you want to close? Your progress will be lost.",confirmText:"Close",cancelText:"Keep Editing",dangerMode:!0,onConfirm:b,onCancel:i[21]||(i[21]=U=>F.value=!1)},null,8,["isOpen"])])):M("",!0)}},Mu=ke(Ru,[["__scopeId","data-v-fc2b754e"]]),Lu={class:"dashboard"},Ou={__name:"Dashboard",setup(o){const v=Ve(),r=$e("smartirEnabled"),$=y(!1),w=y(!1),l=y(null),g=y(0),f=y(null);function C(){w.value=!1,l.value=null,g.value=0,$.value=!0}async function T({platform:A,profile:F,startStep:j}){g.value=Number.isInteger(j)?j:0;try{const x=await fetch(`api/smartir/platforms/${A}/profiles/${F.code}`);if(!x.ok)throw new Error("Failed to load profile");const s=await x.json();let d="";try{const c=await fetch(`api/smartir/config/get-device?platform=${A}&code=${F.code}`);c.ok?(d=(await c.json()).controller_data||"",console.log("âœ… Found controller_data from YAML:",d)):console.warn("âš ï¸ No YAML entry found for this profile (this is OK for profiles not yet added to config)")}catch(c){console.warn("âš ï¸ Could not fetch controller_data from config:",c)}w.value=!0,l.value={platform:A,code:F.code,profile:{...s.profile,controller_data:d}},$.value=!0}catch(x){console.error("Error loading profile for edit:",x),v.error("Failed to load profile for editing")}}function E(){$.value=!1,w.value=!1,l.value=null}function h(){console.log("Show install guide clicked"),window.open("https://github.com/smartHomeHub/SmartIR","_blank")}async function t(A){console.log("Profile saved:",A),E(),f.value&&f.value.loadAllProfiles&&(await f.value.loadAllProfiles(),console.log("âœ… Profiles list refreshed"))}return(A,F)=>(n(),a("div",Lu,[Ce(r)?(n(),Re(Ms,{key:0})):M("",!0),F[0]||(F[0]=Oe('<div class="welcome-banner" data-v-fbe628f8><div class="banner-content" data-v-fbe628f8><div class="banner-icon" data-v-fbe628f8><i class="mdi mdi-rocket-launch" data-v-fbe628f8></i></div><div class="banner-text" data-v-fbe628f8><h2 data-v-fbe628f8>Welcome to Broadlink Manager v2!</h2><p data-v-fbe628f8>Manage your IR/RF devices with a modern Vue 3 interface</p></div></div><div class="status-badges" data-v-fbe628f8><span class="badge success" data-v-fbe628f8><i class="mdi mdi-check-circle" data-v-fbe628f8></i> Vue 3 Ready </span><span class="badge warning" data-v-fbe628f8><i class="mdi mdi-beta" data-v-fbe628f8></i> Beta </span></div></div>',1)),ye(Ss),Ce(r)?(n(),Re($i,{key:1,ref_key:"smartirStatusCard",ref:f,onCreateProfile:C,onEditProfile:T,onShowInstallGuide:h},null,512)):M("",!0),ye(Mu,{show:$.value,editMode:w.value,editData:l.value,startStep:g.value,onClose:E,onSave:t},null,8,["show","editMode","editData","startStep"])]))}},Au=ke(Ou,[["__scopeId","data-v-fbe628f8"]]),Eu={class:"toast-container"},Vu={class:"toast-content"},ju={key:0,class:"toast-title"},Pu={class:"toast-message"},Uu={key:1,class:"toast-description"},Fu=["onClick"],Nu={__name:"Toast",setup(o,{expose:v}){const r=y([]);let $=0;function w(f){const C={success:"mdi-check-circle",error:"mdi-alert-circle",warning:"mdi-alert",info:"mdi-information"};return C[f]||C.info}function l({message:f,title:C,description:T,type:E="info",duration:h=5e3}){const t=$++,A={id:t,message:f,title:C,description:T,type:E};return r.value.push(A),h>0&&setTimeout(()=>{g(t)},h),t}function g(f){const C=r.value.findIndex(T=>T.id===f);C>-1&&r.value.splice(C,1)}return v({addToast:l,removeToast:g,show:l,success:(f,C)=>l({message:f,title:C,type:"success"}),error:(f,C)=>l({message:f,title:C,type:"error",duration:8e3}),warning:(f,C)=>l({message:f,title:C,type:"warning",duration:6e3}),info:(f,C)=>l({message:f,title:C,type:"info"})}),(f,C)=>(n(),Re(We,{to:"body"},[e("div",Eu,[ye(ot,{name:"toast"},{default:Ne(()=>[(n(!0),a(ce,null,he(r.value,T=>(n(),a("div",{key:T.id,class:Z(["toast",[`toast-${T.type}`]])},[e("i",{class:Z(["mdi",w(T.type)])},null,2),e("div",Vu,[T.title?(n(),a("div",ju,m(T.title),1)):M("",!0),e("div",Pu,m(T.message),1),T.description?(n(),a("div",Uu,m(T.description),1)):M("",!0)]),e("button",{onClick:E=>g(T.id),class:"toast-close"},[...C[0]||(C[0]=[e("i",{class:"mdi mdi-close"},null,-1)])],8,Fu)],2))),128))]),_:1})])]))}},Bu=ke(Nu,[["__scopeId","data-v-bf1fd466"]]),Hu={id:"app",class:"app-container"},qu={class:"app-header"},Ju={class:"header-content"},zu={class:"header-right"},Gu=["title"],Wu={class:"settings-menu-container"},Ku={key:0,class:"settings-menu"},Xu=["title"],Yu={class:"toggle-content"},Zu={key:0,class:"not-installed-label"},Qu={key:0,href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"menu-item menu-link menu-subitem"},ec=["disabled"],tc=["disabled"],oc=["disabled"],lc={class:"app-main"},nc={__name:"App",setup(o){const v=y(null),r=y("light"),$=y(null),w=y(!1),l=y(!1),g=y(!1),f=y(localStorage.getItem("smartir_enabled")!=="false"),C=J(()=>{var d;return((d=$.value)==null?void 0:d.installed)||!1}),T=J(()=>({light:"mdi mdi-weather-sunny",medium:"mdi mdi-weather-partly-cloudy",dark:"mdi mdi-weather-night"})[r.value]),E=J(()=>({light:"Switch to Medium Theme",medium:"Switch to Dark Theme",dark:"Switch to Light Theme"})[r.value]),h=()=>{const d=["light","medium","dark"],N=(d.indexOf(r.value)+1)%d.length;r.value=d[N],document.body.classList.remove("medium-mode","dark-mode"),r.value==="medium"?document.body.classList.add("medium-mode"):r.value==="dark"&&document.body.classList.add("dark-mode"),localStorage.setItem("theme",r.value)},t=async()=>{try{const d=await Ye.getStatus();$.value=d,d.installed?console.log("âœ… SmartIR detected:",d.version):console.log("â„¹ï¸ SmartIR not detected")}catch(d){console.error("Error checking SmartIR:",d),$.value={installed:!1,error:d.message}}},A=async()=>{var d,c;l.value=!0;try{const Q=(await ue.get("/api/diagnostics/markdown")).data.markdown;await navigator.clipboard.writeText(Q),(d=v.value)==null||d.success("Diagnostic summary copied to clipboard!"),w.value=!1}catch(N){console.error("Error copying diagnostics:",N),(c=v.value)==null||c.error("Failed to copy diagnostics")}finally{l.value=!1}},F=async()=>{var d,c;l.value=!0;try{const N=await ue.get("/api/diagnostics/download",{responseType:"blob"}),Q=window.URL.createObjectURL(new Blob([N.data])),ne=document.createElement("a");ne.href=Q;const le=N.headers["content-disposition"];let me="broadlink_manager_diagnostics.zip";if(le){const L=le.match(/filename="?(.+)"?/);L&&(me=L[1])}ne.setAttribute("download",me),document.body.appendChild(ne),ne.click(),ne.remove(),window.URL.revokeObjectURL(Q),(d=v.value)==null||d.success("Diagnostic bundle downloaded!"),w.value=!1}catch(N){console.error("Error downloading diagnostics:",N),(c=v.value)==null||c.error("Failed to download diagnostics")}finally{l.value=!1}},j=()=>{C.value&&(f.value=!f.value,localStorage.setItem("smartir_enabled",f.value.toString()),window.location.reload())},x=async()=>{var d,c,N;g.value=!0;try{const Q=await ue.post("/api/smartir/refresh-index");Q.data.success?(d=v.value)==null||d.success(`Updated to v${Q.data.version} (${Q.data.total_devices} devices)`,"âœ… Index Updated"):(c=v.value)==null||c.error(Q.data.error||"Unknown error","âŒ Update Failed")}catch(Q){console.error("Error updating SmartIR index:",Q),(N=v.value)==null||N.error("Failed to update device index","âŒ Update Error")}finally{g.value=!1,w.value=!1}},s=d=>{d.target.closest(".settings-menu-container")||(w.value=!1)};return Te(async()=>{const d=localStorage.getItem("theme");d&&["light","medium","dark"].includes(d)?(r.value=d,d==="medium"?document.body.classList.add("medium-mode"):d==="dark"&&document.body.classList.add("dark-mode")):localStorage.getItem("darkMode")==="true"&&(r.value="dark",document.body.classList.add("dark-mode"),localStorage.setItem("theme","dark")),await t();const c=qe();c&&v.value&&(c.appContext.config.globalProperties.$toast=v.value),document.addEventListener("click",s)}),Je(()=>{document.removeEventListener("click",s)}),Pe("smartirStatus",$),Pe("smartirEnabled",f),Pe("refreshSmartIR",t),Pe("toast",v),(d,c)=>(n(),a("div",Hu,[e("header",qu,[e("div",Ju,[c[13]||(c[13]=e("div",{class:"header-left"},[e("i",{class:"mdi mdi-remote"}),e("h1",null,"Broadlink Manager v2"),e("span",{class:"beta-badge"},"BETA")],-1)),e("div",zu,[e("button",{onClick:h,class:"icon-button",title:E.value},[e("i",{class:Z(T.value)},null,2)],8,Gu),e("div",Wu,[e("button",{onClick:c[0]||(c[0]=N=>w.value=!w.value),class:"icon-button",title:"Settings"},[...c[2]||(c[2]=[e("i",{class:"mdi mdi-cog"},null,-1)])]),w.value?(n(),a("div",Ku,[c[9]||(c[9]=e("div",{class:"menu-section-title"},"Integration Settings",-1)),e("div",{class:Z(["menu-item toggle-item",{disabled:!C.value}]),onClick:c[1]||(c[1]=N=>C.value?j():null),title:C.value?"":"SmartIR is not installed"},[e("div",Yu,[c[3]||(c[3]=e("i",{class:"mdi mdi-air-conditioner"},null,-1)),c[4]||(c[4]=e("span",null,"SmartIR Integration",-1)),C.value?M("",!0):(n(),a("span",Zu,"(Not Installed)"))]),e("div",{class:Z(["toggle-switch",{active:f.value&&C.value,disabled:!C.value}])},[...c[5]||(c[5]=[e("div",{class:"toggle-slider"},null,-1)])],2)],10,Xu),f.value?(n(),a("a",Qu,[...c[6]||(c[6]=[e("i",{class:"mdi mdi-github"},null,-1),e("span",null,"SmartIR on GitHub",-1)])])):M("",!0),f.value?(n(),a("button",{key:1,onClick:x,class:"menu-item menu-subitem",disabled:g.value},[e("i",{class:Z(["mdi",g.value?"mdi-loading mdi-spin":"mdi-refresh"])},null,2),e("span",null,m(g.value?"Updating...":"Update Device Index"),1)],8,ec)):M("",!0),c[10]||(c[10]=e("div",{class:"menu-divider"},null,-1)),c[11]||(c[11]=e("div",{class:"menu-section-title"},"Diagnostics",-1)),e("button",{onClick:A,class:"menu-item",disabled:l.value},[...c[7]||(c[7]=[e("i",{class:"mdi mdi-content-copy"},null,-1),e("span",null,"Copy Diagnostics",-1)])],8,tc),e("button",{onClick:F,class:"menu-item",disabled:l.value},[...c[8]||(c[8]=[e("i",{class:"mdi mdi-download"},null,-1),e("span",null,"Download Diagnostics",-1)])],8,oc),c[12]||(c[12]=Oe('<div class="menu-divider" data-v-b6ab76ba></div><div class="menu-section-title" data-v-b6ab76ba>Help &amp; Support</div><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2#readme" target="_blank" class="menu-item menu-link" data-v-b6ab76ba><i class="mdi mdi-book-open-variant" data-v-b6ab76ba></i><span data-v-b6ab76ba>Documentation</span></a><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2/issues" target="_blank" class="menu-item menu-link" data-v-b6ab76ba><i class="mdi mdi-bug" data-v-b6ab76ba></i><span data-v-b6ab76ba>Report Issue</span></a><div class="menu-divider" data-v-b6ab76ba></div><div class="menu-section-title" data-v-b6ab76ba>Community</div><a href="https://community.home-assistant.io/t/broadlink-manager-modern-web-interface-for-broadlink-devices/938473" target="_blank" class="menu-item menu-link" data-v-b6ab76ba><i class="mdi mdi-forum" data-v-b6ab76ba></i><span data-v-b6ab76ba>HA Forum Discussion</span></a><a href="https://www.reddit.com/r/homeassistant/comments/1o1q3kf/release_broadlink_manager_addon_a_modern_web_ui/" target="_blank" class="menu-item menu-link" data-v-b6ab76ba><i class="mdi mdi-reddit" data-v-b6ab76ba></i><span data-v-b6ab76ba>Reddit Discussion</span></a><div class="menu-divider" data-v-b6ab76ba></div><div class="menu-section-title" data-v-b6ab76ba>Project</div><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2" target="_blank" class="menu-item menu-link" data-v-b6ab76ba><i class="mdi mdi-github" data-v-b6ab76ba></i><span data-v-b6ab76ba>GitHub Repository</span></a><a href="https://ko-fi.com/tonyperkins" target="_blank" class="menu-item menu-link menu-item-sponsor" data-v-b6ab76ba><i class="mdi mdi-coffee" data-v-b6ab76ba></i><span data-v-b6ab76ba>Support on Ko-fi</span></a>',12))])):M("",!0)])])])]),e("main",lc,[ye(Au)]),c[14]||(c[14]=e("footer",{class:"app-footer"},[e("p",null,"Broadlink Manager v2.0.0-beta.1 | Built with Vue 3")],-1)),ye(Bu,{ref_key:"toastRef",ref:v},null,512)]))}},sc=ke(nc,[["__scopeId","data-v-b6ab76ba"]]),Ze=lt(sc),ac=nt();Ze.use(ac);Ze.mount("#app");
