import{g as et,r as y,o as Le,a as Ke,b as at,d as it,c as J,e as n,f as o,h as e,i as T,n as K,u as Ce,t as u,j as x,F as fe,k as $e,w as re,l as z,v as xe,m as ue,p as be,q as Be,s as Ge,T as tt,x as De,y as Ie,z as Pe,A as ze,B as qe,C as ve,D as Oe,E as lt,G as Je,H as rt,I as dt,J as ut,K as He,L as ct,M as mt}from"./vendor-CSL9Ixrb.js";(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const g of document.querySelectorAll('link[rel="modulepreload"]'))k(g);new MutationObserver(g=>{for(const s of g)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&k(r)}).observe(document,{childList:!0,subtree:!0});function m(g){const s={};return g.integrity&&(s.integrity=g.integrity),g.referrerPolicy&&(s.referrerPolicy=g.referrerPolicy),g.crossOrigin==="use-credentials"?s.credentials="include":g.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function k(g){if(g.ep)return;g.ep=!0;const s=m(g);fetch(g.href,s)}})();let Qe=!1;function je(){const t=et(),c=t==null?void 0:t.appContext.config.globalProperties.$toast;return c||(Qe||(console.warn("Toast notification system not yet initialized - using console fallback"),Qe=!0),{success:m=>console.log("✓",m),error:m=>console.error("✗",m),warning:m=>console.warn("⚠",m),info:m=>console.info("ℹ",m)})}function Ye(){const t=y(!1),c=y(!1),m=y(!1),k=y(0),g=767,s=768,r=1023,p=1024,_=()=>{const C=window.innerWidth;k.value=C,t.value=C<=g,c.value=C>=s&&C<=r,m.value=C>=p};return Le(()=>{_(),window.addEventListener("resize",_)}),Ke(()=>{window.removeEventListener("resize",_)}),{isMobile:t,isTablet:c,isDesktop:m,screenWidth:k,isMobileOrTablet:()=>t.value||c.value,isTabletOrDesktop:()=>c.value||m.value}}const Ze="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAHBUlEQVR4nOxZC1BTVxo+9+aNZI2LNsgjWR4hgoIiRVDBslKnIKPbx1jqTrtYoakat1a6dNsdd7t1X8XHyAbEhdUu1u2mXdbasqJbtsaMIqBBECiPBmqEICEBEx4xJLlJ7s6lw6rJDeQ2FzLM+M1kBs7/3+/83zn/Oee/51JRFAXzGbCvA/AWjwX4GvNeANWXnXffHQ4+K6/dYbHeD+IFhjRkb1wn9WPQbEQ4IF/tQlXX2p5+/8OyczY74j/VxuMG3Sh/Oz9jaQDb4CmPT1LIbLXBfzrz0cmHg8fQpx1Yc1Ra+TsiXD4R0PqtRmAyj/LxbJeaujKIcPlEAINOM7vLXBaTZibCRWgRq3WGJZWX63aoNDpB8BJOX/bGlIqwpUv6iXBgWBHG7eUF8urUWvU6Z9sLGxI/IsLl8SJu6u4XigqPXkVspiVTbTQqU1/6Vn7ammh+G5FOMZyqludIKqUVU/9jcaSuTCo/unfHbiad4iBdwMu/P1bV1tO1xbk9NDC0/vwHB1xGcjqYLAh16zsHW3R6XXTu1mfFdAqMrIoSKNbGhLcQ4QGeppDJ7ACtPcqNEI6tT9O3Vqm+tygqNMDjrU9Sef6tIYM2JjUuuXzfC5knCEXsBI8WMZUCAxiCrfhWyMZkMNzYXNHVpwmXXqp5j0Hz0/1m57a3PQ8VHx4JoNMASIl9shLPFsB5ooO7iDXhCY/dAcCvT/79LwC1s/K2bDnAXcQeJRqwMzzeRt/bua0gLChcDsCDNQNBkEU/qot7o6j0kzETQpuJ40ZnT6xSrUoNWhyseHVz2ikv4n4QA5FSArE5IFlTZ0r3XU1MWODib6NCl3a9dkhSYxgbjo4XLq8sL9j7Ip36YEwMRjMNQazMhf7+RgYNnuyo7bY6ArFaWKuXRX495wLwoLk39sO9RaVnM5OTP8zLSjtjsljpp6ovi6pqr706eE8XBwGUSqEy9Guihf/92TMZhetjI5rJCHwKpBRzZqsNYtKp6KD+Pvv1w5ILdzR3UvD8HA4YefOl7N25JKUPIKuUwIJH7A5of/GJf7oLfrIz2EH786fSss+uKFzOk+8L0mqh6rpbmR0q5YyFGAQBSuHHlcUWxEaZyXfMhFD0Rgt9Oh/SBMiam58HAO+oc4XZMsK/1taT6M6uHjJw8w6VSNfvemM8TbzPlFlwsP5KyzfJeL6kCejXDgo894aASqOZ9O/uHwzq6B3ijhitkzOC7XS7j0g+V3S0vQTDDhYEoZSBobvJ+yXFNZ29gy4lOGmvlDBMIfQqSKV8539EWvXHhvbGHBSFrAwGW+vvxzLoR7RxzrNpsyPs0xcv7/lg1/ZfPtKvuw7MVhulUakWdvRq+XY3tWFT90Bk+52BCOzvyOBgjytSFKAgms+b9F/2o+BbKwUrvgjhhjSjKLAPG4YE7lJxfEIf5dyGOwMXrren/eF0RYXRNMrHDt4QbmjDEbHop9F8rqpddZd3sV6R/aWiabtWr41PW534V8m+PFHW+qSPL9TX7oM8WAaBi4IbE4S8yYNs/7asIgBA0ZStRqFM/MXxIzcgHBEBP+C6DJKLgJvK3uXvniitBsDmNzkSEAD9uv5k0aFjXy1gMQ0DQ5p4CAIwNuXLwyL/ExcpqMWeS42NUmxKXFf8VWPdz6cLnkqhGd/Pe+U1Cow/+ekJUYr4qJgvbik7f/Jw+0J/tjpvS3qxs7/LQZZfcrrkUmOdGI/cgUKIkB8pz0xK+CQjKf6z4MWckYftZqsderfsTInsZt0evDRgMRYMHhaLnk+NW1Y/nchxk5lZ+I/Pf/vl9RvbLYiVlSBcJv/VK9sKBCHc3hkF7D12/NzVltZn8YhzNj/3ev6LGeXTdQ6+uzLZ+C+5XNza05Nsd1gXcNgBvekJK/+du3lTUSiXMzzT80TgkkK8wJAGgCMAE5ooFFz3hHTr+lgZ9iMryOngkoi5WZuOc9hPtDu3r4198nTqygjCr3wYmrvVkSerZXljJoT0m0DcYm5g2Mg5WV39zrVWZZofkzaRnhB/bufm9FI/JpXQXj8F8bHyitqWxhzJmwUJT60SNJER+P+BCZjt34lzNbvickRoWVWNmGzuObnYWhER3oAdX41dPbj1jDeYEwGrInltKKCNtatub6hRfJOEnfJkcc+JgE9ltS/DkINuNI3xCo4fbXgm/0CnouvOcjK4Z/16/ZKia+3+kqIrEIQ+sgNx2Jzb5wsPxrD9GBZv+Gd9BqSXr4icg8cwMj4SLmv6+mlv+WddgGlilOPOZkEmFnrLP+sCVgtXyPHaHShkiw0XXPWWf9YF5Gb9uGzp4sCbj7ai4LkNTx2O5nPV3vLPyTeye6P32X+7KNujVKtSYJg+viEu/mx2etJZCgnD57OPfGRh3n8nfizA15j3Av4XAAD//5k1S2w3zfwVAAAAAElFTkSuQmCC",ne=at.create({baseURL:"./",timeout:3e4,headers:{"Content-Type":"application/json"}});ne.interceptors.request.use(t=>t,t=>Promise.reject(t));ne.interceptors.response.use(t=>t,t=>(console.error("API Error:",t),t.response?console.error("Response error:",t.response.data):t.request?console.error("No response received"):console.error("Request setup error:",t.message),Promise.reject(t)));const vt=it("devices",{state:()=>({devices:[],loading:!1,error:null,selectedDevice:null}),getters:{deviceById:t=>c=>t.devices.find(m=>m.id===c),devicesByType:t=>c=>t.devices.filter(m=>m.entity_type===c),deviceCount:t=>t.devices.length,hasDevices:t=>t.devices.length>0},actions:{async loadDevices(t=!1){this.loading=!0,this.error=null;try{const c=t?`/api/devices/managed?_t=${Date.now()}`:"/api/devices/managed",m=await ne.get(c);this.devices=m.data.devices||[],console.log("📥 Loaded devices:",this.devices),this.devices.forEach(k=>{console.log(`📥 Device "${k.name}":`,{id:k.id,device:k.device,commands:k.commands,commandCount:k.commands?Object.keys(k.commands).length:0})})}catch(c){this.error=c.message,console.error("Error loading devices:",c)}finally{this.loading=!1}},async createDevice(t){this.loading=!0,this.error=null;try{console.log("🏪 Store: Creating device with data:",t),console.log("🏪 Store: Device commands being sent:",t.commands);const c={device_name:t.name,device:t.device,area_id:t.area||"",area_name:t.area||"",entity_type:t.entity_type,icon:t.icon,broadlink_entity:t.broadlink_entity,device_type:t.device_type||"broadlink",commands:t.commands||{}};t.device_type==="smartir"&&t.smartir_config&&(c.smartir_config=t.smartir_config),console.log("🏪 Store: Transformed data for backend:",c);const m=await ne.post("/api/devices/managed",c);return console.log("🏪 Store: Create response:",m.data),await this.loadDevices(),m.data}catch(c){throw console.error("Error creating device:",c),c}finally{this.loading=!1}},async updateDevice(t,c){this.loading=!0,this.error=null;try{const m=await ne.put(`/api/devices/managed/${t}`,c);return await this.loadDevices(),m.data}catch(m){throw console.error("Error updating device:",m),m}finally{this.loading=!1}},async deleteDevice(t,c=!1){this.loading=!0,this.error=null;try{await ne.delete(`/api/devices/managed/${t}`,{data:{delete_commands:c}}),this.devices=this.devices.filter(m=>m.id!==t)}catch(m){throw this.error=m.message,console.error("Error deleting device:",m),m}finally{this.loading=!1}},selectDevice(t){this.selectedDevice=t},clearSelection(){this.selectedDevice=null},clearError(){this.error=null},updateDeviceCommands(t,c){const m=this.devices.findIndex(k=>k.id===t);if(m!==-1){const k={...this.devices[m],commands:c};this.devices.splice(m,1,k),console.log(`✅ Store: Updated commands for ${t}, count: ${Object.keys(c).length}`)}else console.warn(`⚠️ Store: Device ${t} not found for command update`)},async syncAllAreas(){if(!this.devices||this.devices.length===0){console.log("⚠️ No devices to sync");return}console.log(`🔄 Syncing areas from Home Assistant for ${this.devices.length} devices...`);try{const t=await Promise.all(this.devices.map(k=>(console.log(`🔄 Syncing device: ${k.id} (${k.name})`),ne.post(`/api/devices/${k.id}/sync-area`).then(g=>g.data.success&&g.data.area?(console.log(`✅ Synced area for ${k.name}: ${g.data.area}`),{status:"synced",device:k.name}):{status:"no_area"}).catch(g=>{var s;return((s=g.response)==null?void 0:s.status)===404?(console.log(`❌ Device not found in HA: ${k.id}`),{status:"not_found"}):(console.warn(`⚠️ Failed to sync area for ${k.id}:`,g.message),{status:"error",error:g.message})})))),c=t.filter(k=>k.status==="synced").length,m=t.filter(k=>k.status==="not_found").length;await this.loadDevices(!0),c>0?console.log(`✅ Area sync complete: ${c} synced, ${m} not found in HA`):m>0&&console.log(`ℹ️ No areas synced - ${m} entities not found in HA registry (generate entities first)`)}catch(t){console.debug("Area sync error:",t)}}}});function ot(t){const c=J(()=>t.value||t),m=J(()=>{switch(c.value){case"climate":return"mdi:air-conditioner";case"fan":return"mdi:fan";case"light":return"mdi:lightbulb";case"media_player":return"mdi:television";case"switch":return"mdi:light-switch";default:return"mdi:devices"}}),k=J(()=>`device-type-${c.value}-color`),g=J(()=>`tag-${c.value}-bg`);return{icon:m,colorClass:k,tagBgClass:g}}const pt=""+new URL("broadlink-logo-BDjImjRY.png",import.meta.url).href,ke=(t,c)=>{const m=t.__vccOpts||t;for(const[k,g]of c)m[k]=g;return m},ft={class:"device-header"},gt={class:"device-info"},yt=["title"],bt={class:"device-labels"},ht={class:"device-type"},kt=["src","alt","title"],wt={class:"device-body"},$t={class:"device-stats"},Ct={class:"stat",title:"Learned command count"},St={class:"stat",title:"HA Assigned Area"},_t={class:"device-meta"},Dt={class:"device-id",title:"Device ID"},It={key:0,class:"storage-name"},Tt={key:1,class:"broadlink-entity",title:"Controller Device"},xt={key:2,class:"controller-device"},Mt={class:"device-actions"},Rt=["disabled"],Lt=["disabled"],At=["disabled"],Et={key:0,class:"disabled-overlay"},Ot={__name:"DeviceCard",props:{device:{type:Object,required:!0},broadlinkDevices:{type:Array,default:()=>[]}},emits:["edit","delete","learn"],setup(t){const c=t,m=J(()=>localStorage.getItem("smartir_simulate_not_installed")==="true"),k=J(()=>c.device.device_type==="smartir"&&m.value),g=y(null),s=ot(J(()=>c.device.entity_type)),r=J(()=>c.device.icon?c.device.icon:s.icon.value),p=a=>a&&a.startsWith("mdi:")?`mdi ${a.replace(":"," mdi-")}`:`mdi mdi-${a}`,_=J(()=>({light:"Light",fan:"Fan",switch:"Switch",media_player:"Media Player",cover:"Cover"})[c.device.entity_type]||c.device.entity_type),C=J(()=>(c.device.device_type||"broadlink")==="smartir"?"SmartIR":"Broadlink"),O=J(()=>(c.device.device_type||"broadlink")==="smartir"?Ze:pt),w=J(()=>(c.device.device_type||"broadlink")==="smartir"?g.value!==null?g.value:0:Object.keys(c.device.commands||{}).length),l=a=>{if(!a)return"";const b=c.broadlinkDevices.find(v=>v.entity_id===a);return b&&b.name||a},R=J(()=>{if(!c.device.device)return!1;const a=c.device.id.includes(".")?c.device.id.split(".")[1]:c.device.id;return c.device.device!==a}),W=J(()=>{if(!c.device.broadlink_entity)return"";const a=c.broadlinkDevices.find(b=>b.entity_id===c.device.broadlink_entity);return a&&a.name||c.device.broadlink_entity}),P=a=>{if(!a||typeof a!="object")return 0;let b=0;for(const v of Object.values(a))typeof v=="string"?b++:typeof v=="object"&&(b+=P(v));return b},D=async()=>{if(!(!c.device.device_code||!c.device.entity_type))try{const a=await ne.get("/api/smartir/codes/code",{params:{entity_type:c.device.entity_type,code_id:c.device.device_code}});if(a.data.success&&a.data.code){const b=a.data.code;b.commands&&(g.value=P(b.commands))}}catch(a){console.error("Error fetching SmartIR command count:",a)}};return Le(async()=>{(c.device.device_type||"broadlink")==="smartir"&&await D()}),(a,b)=>(o(),n("div",{class:K(["device-card",{disabled:k.value}])},[e("div",ft,[e("div",{class:K(["device-icon",Ce(s).colorClass.value])},[e("i",{class:K(p(r.value))},null,2)],2),e("div",gt,[e("h3",{title:t.device.name},u(t.device.name),9,yt),e("div",bt,[e("span",ht,u(_.value),1)])]),e("img",{src:O.value,alt:C.value,title:C.value,class:"device-source-logo"},null,8,kt)]),e("div",wt,[e("div",$t,[e("div",Ct,[b[3]||(b[3]=e("i",{class:"mdi mdi-remote"},null,-1)),e("span",null,u(w.value)+" command"+u(w.value!==1?"s":""),1)]),e("div",St,[b[4]||(b[4]=e("i",{class:"mdi mdi-map-marker"},null,-1)),e("span",null,u(t.device.area||"No area"),1)])]),e("div",_t,[e("span",Dt,[b[5]||(b[5]=e("i",{class:"mdi mdi-identifier"},null,-1)),x(" "+u(t.device.id),1)]),R.value?(o(),n("span",It,[b[6]||(b[6]=e("i",{class:"mdi mdi-code-tags"},null,-1)),x(" "+u(t.device.device),1)])):T("",!0),t.device.broadlink_entity?(o(),n("span",Tt,[b[7]||(b[7]=e("i",{class:"mdi mdi-access-point"},null,-1)),x(" "+u(W.value),1)])):T("",!0),t.device.controller_device?(o(),n("span",xt,[b[8]||(b[8]=e("i",{class:"mdi mdi-access-point"},null,-1)),x(" "+u(l(t.device.controller_device)),1)])):T("",!0)])]),e("div",Mt,[e("button",{onClick:b[0]||(b[0]=v=>!k.value&&a.$emit("learn",t.device)),class:"icon-btn",title:"Manage Commands",disabled:k.value},[...b[9]||(b[9]=[e("i",{class:"mdi mdi-remote-tv"},null,-1)])],8,Rt),e("button",{onClick:b[1]||(b[1]=v=>!k.value&&a.$emit("edit",t.device)),class:"icon-btn",title:"Edit",disabled:k.value},[...b[10]||(b[10]=[e("i",{class:"mdi mdi-pencil"},null,-1)])],8,Lt),e("button",{onClick:b[2]||(b[2]=v=>!k.value&&a.$emit("delete",t.device)),class:"icon-btn danger",title:"Delete",disabled:k.value},[...b[11]||(b[11]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,At)]),k.value?(o(),n("div",Et,[...b[12]||(b[12]=[e("div",{class:"disabled-message"},[e("i",{class:"mdi mdi-eye-off"}),e("span",null,"SmartIR Not Installed")],-1)])])):T("",!0)],2))}},Vt=ke(Ot,[["__scopeId","data-v-7a7f5c18"]]),Pt={name:"DeviceListView",props:{devices:{type:Array,required:!0}},methods:{getDeviceCommands(t){return t.commands&&typeof t.commands=="object"?Object.keys(t.commands):[]},sendCommand(t,c){this.$emit("send-command",{device:t,command:c})},editDevice(t){this.$emit("edit-device",t)},deleteDevice(t){this.$emit("delete-device",t)}}},Ut={class:"device-list-view"},Ft={class:"device-table"},jt={class:"device-info"},Nt={class:"device-name"},Bt={class:"device-entity"},Ht={class:"device-area"},qt={class:"device-type"},zt={class:"device-commands"},Jt={key:0,class:"command-list"},Wt=["onClick"],Kt={key:0,class:"no-commands"},Xt={key:1,class:"smartir-info"},Gt={class:"profile-code"},Yt={class:"device-actions"},Zt=["onClick"],Qt=["onClick"];function el(t,c,m,k,g,s){return o(),n("div",Ut,[e("table",Ft,[c[2]||(c[2]=e("thead",null,[e("tr",null,[e("th",null,"Device"),e("th",null,"Room/Area"),e("th",null,"Type"),e("th",null,"Commands"),e("th",null,"Actions")])],-1)),e("tbody",null,[(o(!0),n(fe,null,$e(m.devices,r=>(o(),n("tr",{key:r.entity_id,class:"device-row"},[e("td",jt,[e("div",Nt,u(r.friendly_name||r.name),1),e("div",Bt,u(r.entity_id),1)]),e("td",Ht,u(r.area||"No Area"),1),e("td",qt,[e("span",{class:K(["type-badge",r.device_type||"broadlink"])},u(r.device_type==="smartir"?"SmartIR":"Broadlink"),3)]),e("td",zt,[(r.device_type||"broadlink")==="broadlink"?(o(),n("div",Jt,[(o(!0),n(fe,null,$e(s.getDeviceCommands(r),p=>(o(),n("button",{key:p,class:"command-btn",onClick:_=>s.sendCommand(r,p)},u(p),9,Wt))),128)),s.getDeviceCommands(r).length===0?(o(),n("span",Kt," No commands ")):T("",!0)])):r.device_type==="smartir"?(o(),n("div",Xt,[e("span",Gt,"Profile: "+u(r.device_code),1)])):T("",!0)]),e("td",Yt,[e("button",{class:"action-btn edit",onClick:p=>s.editDevice(r),title:"Edit"},[...c[0]||(c[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})],-1)])],8,Zt),e("button",{class:"action-btn delete",onClick:p=>s.deleteDevice(r),title:"Delete"},[...c[1]||(c[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"3 6 5 6 21 6"}),e("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})],-1)])],8,Qt)])]))),128))])])])}const tl=ke(Pt,[["render",el],["__scopeId","data-v-d1ca6f69"]]),ll={class:"icon-picker"},ol={class:"icon-input-wrapper"},sl=["id","placeholder"],nl={key:0,class:"icon-preview"},al={key:0,class:"icon-dropdown"},il={class:"icon-grid"},rl=["onMousedown","title"],dl={__name:"IconPicker",props:{modelValue:{type:String,default:""},inputId:{type:String,default:"icon-input"},placeholder:{type:String,default:"e.g., mdi:television"}},emits:["update:modelValue"],setup(t,{emit:c}){const m=t,k=c,g=y(m.modelValue),s=y(!1),r=["television","speaker","radio","music","video","movie","play","pause","stop","skip-next","skip-previous","volume-high","volume-medium","volume-low","volume-off","remote","remote-tv","cast","chromecast","spotify","netflix","youtube","lightbulb","lightbulb-on","lightbulb-off","lamp","floor-lamp","ceiling-light","light-switch","led-strip","led-strip-variant","wall-sconce","chandelier","spotlight","track-light","vanity-light","desk-lamp","fan","ceiling-fan","air-conditioner","thermometer","thermostat","heat-wave","snowflake","fire","radiator","water-boiler","hvac","blinds","blinds-open","window-shutter","window-shutter-open","curtains","curtains-closed","roller-shade","roller-shade-closed","garage","garage-open","gate","door","door-open","window-open","window-closed","washing-machine","tumble-dryer","dishwasher","refrigerator","stove","microwave","oven","toaster","kettle","coffee","coffee-maker","blender","robot-vacuum","robot-vacuum-variant","vacuum","broom","spray-bottle","lock","lock-open","lock-smart","key","shield","shield-check","alarm-light","bell","doorbell","camera","cctv","motion-sensor","smoke-detector","fire-extinguisher","water-alert","gas-cylinder","sofa","bed","bed-double","desk","chair","table","bookshelf","home","home-outline","home-assistant","floor-plan","room","weather-sunny","weather-night","weather-cloudy","weather-rainy","weather-snowy","weather-lightning","weather-windy","weather-fog","weather-partly-cloudy","umbrella","water","water-percent","phone","cellphone","tablet","laptop","desktop-tower","monitor","keyboard","mouse","printer","router","router-wireless","access-point","wifi","bluetooth","usb","hdmi-port","ethernet","power","power-plug","power-socket","battery","battery-charging","lightning-bolt","flash","solar-panel","solar-power","leaf","tree","flower","sprout","grass","watering-can","shovel","fence","pool","hot-tub","silverware","silverware-fork-knife","food","food-apple","glass-wine","glass-cocktail","bottle-wine","pot","pot-steam","shower","shower-head","bathtub","toilet","sink","faucet","hand-wash","car","car-side","garage-variant","tools","hammer","wrench","screwdriver","toolbox","ladder","heart","heart-pulse","run","walk","bike","dumbbell","yoga","scale-bathroom","thermometer-lines","clock","clock-outline","timer","alarm","calendar","calendar-today","calendar-clock","history","bell-ring","bell-alert","alert","alert-circle","information","help-circle","check","check-circle","close-circle","minus-circle","plus-circle","arrow-up","arrow-down","arrow-left","arrow-right","chevron-up","chevron-down","menu","dots-vertical","dots-horizontal","cog","tune","circle","square","triangle","hexagon","star","star-outline","heart-outline","plus","minus","close","check-bold","eye","eye-off","account","account-group","baby","dog","cat","paw","gift","balloon","party-popper","candle","book","book-open","newspaper","email","message","phone-classic"];re(()=>m.modelValue,w=>{g.value=w});const p=J(()=>{if(!g.value)return r.slice(0,50);const w=g.value.toLowerCase().replace("mdi:","");return r.filter(l=>l.toLowerCase().includes(w)).slice(0,50)}),_=()=>{s.value=!0,k("update:modelValue",g.value)},C=()=>{setTimeout(()=>{s.value=!1},200)},O=w=>{g.value=`mdi:${w}`,k("update:modelValue",g.value),s.value=!1};return(w,l)=>(o(),n("div",ll,[e("div",ol,[z(e("input",{id:t.inputId,"onUpdate:modelValue":l[0]||(l[0]=R=>g.value=R),type:"text",placeholder:t.placeholder,onInput:_,onFocus:l[1]||(l[1]=R=>s.value=!0),onBlur:C},null,40,sl),[[xe,g.value]]),g.value?(o(),n("div",nl,[e("i",{class:K(`mdi mdi-${g.value.replace("mdi:","")}`)},null,2)])):T("",!0)]),s.value&&p.value.length>0?(o(),n("div",al,[e("div",il,[(o(!0),n(fe,null,$e(p.value,R=>(o(),n("div",{key:R,class:"icon-option",onMousedown:ue(W=>O(R),["prevent"]),title:R},[e("i",{class:K(`mdi mdi-${R}`)},null,2),e("span",null,u(R),1)],40,rl))),128))])])):T("",!0)]))}},ul=ke(dl,[["__scopeId","data-v-a64f5011"]]),cl={key:0,class:"dropdown-label"},ml={key:0,class:"required"},vl=["placeholder","disabled","onKeydown"],pl={class:"dropdown-icons"},fl={key:0,class:"mdi mdi-loading mdi-spin"},gl={key:2,class:"mdi mdi-chevron-down"},yl={key:1,class:"error-message"},bl={key:2,class:"hint-message"},hl={key:0,class:"dropdown-menu"},kl=["onMousedown","onMouseenter"],wl={class:"option-content"},$l={class:"option-label"},Cl={key:0,class:"option-description"},Sl={key:0,class:"mdi mdi-check selected-icon"},_l={key:3,class:"dropdown-menu"},Dl={__name:"SearchableDropdown",props:{modelValue:{type:[String,Number,Object],default:null},options:{type:Array,required:!0,default:()=>[]},label:{type:String,default:""},placeholder:{type:String,default:"Search..."},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},error:{type:String,default:""},hint:{type:String,default:""},optionLabel:{type:String,default:"label"},optionValue:{type:String,default:"value"},optionDescription:{type:String,default:"description"},filterMethod:{type:Function,default:null}},emits:["update:modelValue","change","search"],setup(t,{emit:c}){const m=t,k=c,g=y(null),s=y(null),r=y(""),p=y(!1),_=y(0),C=y(!1),O=A=>typeof A=="string"||typeof A=="number"?A:A[m.optionLabel]||A.label||A.name||String(A),w=A=>typeof A=="string"||typeof A=="number"?A:A[m.optionValue]||A.value||A.id||A,l=A=>typeof A=="string"||typeof A=="number"?"":A[m.optionDescription]||A.description||"",R=A=>{const j=w(A);return typeof m.modelValue=="object"?w(m.modelValue)===j:m.modelValue===j},W=J(()=>{if(!r.value)return m.options;if(m.filterMethod)return m.options.filter(j=>m.filterMethod(j,r.value));const A=r.value.toLowerCase();return m.options.filter(j=>{const X=O(j).toLowerCase(),M=l(j).toLowerCase();return X.includes(A)||M.includes(A)})}),P=J(()=>{if(!m.modelValue)return"";const A=m.options.find(j=>{const X=w(j);return typeof m.modelValue=="object"?X===w(m.modelValue):X===m.modelValue});return A?O(A):""});re(()=>m.modelValue,A=>{C.value||(r.value=P.value)}),re(()=>m.options,()=>{!C.value&&m.modelValue&&(r.value=P.value)},{deep:!0}),re(r,A=>{k("search",A),_.value=0}),Le(()=>{r.value=P.value});const D=()=>{var A;C.value=!0,p.value=!0,(A=s.value)==null||A.select()},a=()=>{C.value=!1,setTimeout(()=>{p.value=!1,m.modelValue?r.value=P.value:r.value=""},200)},b=()=>{var A;p.value=!1,(A=s.value)==null||A.blur()},v=A=>{const j=w(A);k("update:modelValue",j),k("change",j,A),r.value=O(A),b()},E=()=>{var A;k("update:modelValue",null),k("change",null,null),r.value="",(A=s.value)==null||A.focus()},H=()=>{if(!p.value){p.value=!0;return}_.value<W.value.length-1&&_.value++},Z=()=>{_.value>0&&_.value--},N=()=>{W.value.length>0&&_.value>=0&&v(W.value[_.value])},oe=A=>{g.value&&!g.value.contains(A.target)&&(p.value=!1,m.modelValue?r.value=P.value:r.value="")};return Le(()=>{document.addEventListener("click",oe)}),Ke(()=>{document.removeEventListener("click",oe)}),(A,j)=>(o(),n("div",{class:"searchable-dropdown",ref_key:"dropdownRef",ref:g},[t.label?(o(),n("label",cl,[x(u(t.label)+" ",1),t.required?(o(),n("span",ml,"*")):T("",!0)])):T("",!0),e("div",{class:K(["dropdown-input-wrapper",{"has-error":t.error,disabled:t.disabled}])},[z(e("input",{ref_key:"inputRef",ref:s,type:"text","onUpdate:modelValue":j[0]||(j[0]=X=>r.value=X),placeholder:t.placeholder,disabled:t.disabled||t.loading,onFocus:D,onBlur:a,onKeydown:[Be(ue(H,["prevent"]),["down"]),Be(ue(Z,["prevent"]),["up"]),Be(ue(N,["prevent"]),["enter"]),Be(b,["escape"])],class:"dropdown-input"},null,40,vl),[[xe,r.value]]),e("div",pl,[t.loading?(o(),n("i",fl)):t.modelValue&&!t.disabled?(o(),n("i",{key:1,class:"mdi mdi-close-circle clear-icon",onClick:E})):(o(),n("i",gl))])],2),t.error?(o(),n("div",yl,u(t.error),1)):T("",!0),t.hint&&!t.error?(o(),n("div",bl,u(t.hint),1)):T("",!0),be(tt,{name:"dropdown"},{default:Ge(()=>[p.value&&W.value.length>0?(o(),n("div",hl,[(o(!0),n(fe,null,$e(W.value,(X,M)=>(o(),n("div",{key:w(X),class:K(["dropdown-item",{highlighted:M===_.value,selected:R(X)}]),onMousedown:ue(ee=>v(X),["prevent"]),onMouseenter:ee=>_.value=M},[e("div",wl,[e("div",$l,u(O(X)),1),l(X)?(o(),n("div",Cl,u(l(X)),1)):T("",!0)]),R(X)?(o(),n("i",Sl)):T("",!0)],42,kl))),128))])):T("",!0)]),_:1}),p.value&&W.value.length===0&&!t.loading?(o(),n("div",_l,[...j[1]||(j[1]=[e("div",{class:"dropdown-item no-results"},[e("i",{class:"mdi mdi-magnify"}),x(" No results found ")],-1)])])):T("",!0)],512))}},We=ke(Dl,[["__scopeId","data-v-679ce35f"]]),Il={class:"smartir-selector"},Tl={class:"form-group"},xl={class:"form-group"},Ml={class:"form-group"},Rl=["value"],Ll={key:0,class:"error-message"},Al={class:"form-group"},El={class:"form-group"},Ol={key:1,class:"code-info"},Vl={class:"info-content"},Pl={class:"info-row"},Ul={class:"info-value"},Fl={class:"info-row"},jl={class:"info-value"},Nl={key:0,class:"info-row"},Bl={class:"info-value"},Hl={class:"info-row"},ql={class:"info-value"},zl={__name:"SmartIRDeviceSelector",props:{entityType:{type:String,required:!0},modelValue:{type:Object,default:()=>({})},broadlinkDevices:{type:Array,default:()=>[]}},emits:["update:modelValue","change"],setup(t,{expose:c,emit:m}){const k=t,g=m,s=y([]),r=y([]),p=y(""),_=y(""),C=y(""),O=y(""),w=y(""),l=y(null),R=y(!1),W=y(!1),P=y({manufacturer:"",model:"",controller:""});Le(async()=>{if(await D(),k.modelValue&&(p.value=k.modelValue.manufacturer||"",_.value=k.modelValue.device_code||"",C.value=k.modelValue.controller_device||"",O.value=k.modelValue.temperature_sensor||"",w.value=k.modelValue.humidity_sensor||"",p.value&&(await a(p.value),_.value&&r.value.length>0))){const A=r.value.find(j=>j.code===_.value);A&&(l.value={code:A.code,manufacturer:p.value,models:A.models,controller:A.controller})}}),re(()=>k.entityType,async A=>{A&&(p.value="",_.value="",r.value=[],l.value=null,await D())});const D=async()=>{if(k.entityType){R.value=!0,P.value.manufacturer="";try{const A=await ne.get("/api/smartir/codes/manufacturers",{params:{entity_type:k.entityType}});if(A.data.success)s.value=A.data.manufacturers||[];else throw new Error(A.data.error||"Failed to load manufacturers")}catch(A){console.error("Error loading manufacturers:",A),P.value.manufacturer="Failed to load manufacturers. Please try again.",s.value=[]}finally{R.value=!1}}},a=async A=>{if(!(!A||!k.entityType)){W.value=!0,P.value.model="";try{const j=await ne.get("/api/smartir/codes/models",{params:{entity_type:k.entityType,manufacturer:A}});if(j.data.success){const X=j.data.models||[];r.value=X.map(M=>{const ee=M.models&&M.models.length>0?M.models.join(", "):`Code ${M.code}`;return{code:M.code,label:ee,description:`Code: ${M.code}`,models:M.models,controller:M.controller}})}else throw new Error(j.data.error||"Failed to load models")}catch(j){console.error("Error loading models:",j),P.value.model="Failed to load models. Please try again.",r.value=[]}finally{W.value=!1}}},b=async A=>{p.value=A,_.value="",l.value=null,r.value=[],A&&await a(A),N()},v=()=>{const A=r.value.find(j=>j.code===_.value);A&&(l.value={code:A.code,manufacturer:p.value,models:A.models,controller:A.controller}),N()},E=()=>{N()},H=()=>{N()},Z=()=>{N()},N=()=>{var j,X;const A={manufacturer:p.value,model:((X=(j=l.value)==null?void 0:j.models)==null?void 0:X[0])||"",device_code:_.value,controller_device:C.value};k.entityType==="climate"&&(O.value&&(A.temperature_sensor=O.value),w.value&&(A.humidity_sensor=w.value)),g("update:modelValue",A),g("change",A)};return c({validate:()=>{let A=!0;return P.value={manufacturer:"",model:"",controller:""},p.value||(P.value.manufacturer="Manufacturer is required",A=!1),_.value||(P.value.model="Model is required",A=!1),C.value||(P.value.controller="Broadlink controller is required",A=!1),A}}),(A,j)=>(o(),n("div",Il,[e("div",Tl,[be(We,{modelValue:p.value,"onUpdate:modelValue":j[0]||(j[0]=X=>p.value=X),options:s.value,label:"Manufacturer",placeholder:"Search manufacturers...",required:"",loading:R.value,error:P.value.manufacturer,hint:"Select the device manufacturer",onChange:b},null,8,["modelValue","options","loading","error"])]),e("div",xl,[be(We,{modelValue:_.value,"onUpdate:modelValue":j[1]||(j[1]=X=>_.value=X),options:r.value,"option-label":"label","option-value":"code","option-description":"description",label:"Model",placeholder:"Search models...",required:"",disabled:!p.value,loading:W.value,error:P.value.model,hint:"Select the device model",onChange:v},null,8,["modelValue","options","disabled","loading","error"])]),e("div",Ml,[j[6]||(j[6]=e("label",{for:"controller-device"},[e("i",{class:"mdi mdi-remote"}),x(" Controller Device * ")],-1)),z(e("select",{id:"controller-device","onUpdate:modelValue":j[2]||(j[2]=X=>C.value=X),required:"",onChange:E},[j[5]||(j[5]=e("option",{value:""},"-- Select Controller Device --",-1)),(o(!0),n(fe,null,$e(t.broadlinkDevices,X=>(o(),n("option",{key:X.entity_id,value:X.entity_id},[x(u(X.name||X.entity_id)+" ",1),X.area_name?(o(),n(fe,{key:0},[x(" - "+u(X.area_name),1)],64)):T("",!0)],8,Rl))),128))],544),[[De,C.value]]),j[7]||(j[7]=e("small",null,"Which remote device will send the IR/RF commands",-1)),P.value.controller?(o(),n("div",Ll,u(P.value.controller),1)):T("",!0)]),t.entityType==="climate"?(o(),n(fe,{key:0},[e("div",Al,[j[8]||(j[8]=e("label",{for:"temperature-sensor"},"Temperature Sensor",-1)),z(e("input",{id:"temperature-sensor","onUpdate:modelValue":j[3]||(j[3]=X=>O.value=X),type:"text",placeholder:"e.g., sensor.living_room_temperature",onInput:H},null,544),[[xe,O.value]]),j[9]||(j[9]=e("small",null,"Optional: Temperature sensor entity for current temperature",-1))]),e("div",El,[j[10]||(j[10]=e("label",{for:"humidity-sensor"},"Humidity Sensor",-1)),z(e("input",{id:"humidity-sensor","onUpdate:modelValue":j[4]||(j[4]=X=>w.value=X),type:"text",placeholder:"e.g., sensor.living_room_humidity",onInput:Z},null,544),[[xe,w.value]]),j[11]||(j[11]=e("small",null,"Optional: Humidity sensor entity for current humidity",-1))])],64)):T("",!0),l.value?(o(),n("div",Ol,[j[16]||(j[16]=e("div",{class:"info-header"},[e("i",{class:"mdi mdi-information"}),e("span",null,"Selected Device Code")],-1)),e("div",Vl,[e("div",Pl,[j[12]||(j[12]=e("span",{class:"info-label"},"Code ID:",-1)),e("span",Ul,u(l.value.code_id),1)]),e("div",Fl,[j[13]||(j[13]=e("span",{class:"info-label"},"Manufacturer:",-1)),e("span",jl,u(l.value.manufacturer),1)]),l.value.models&&l.value.models.length>0?(o(),n("div",Nl,[j[14]||(j[14]=e("span",{class:"info-label"},"Supported Models:",-1)),e("span",Bl,u(l.value.models.join(", ")),1)])):T("",!0),e("div",Hl,[j[15]||(j[15]=e("span",{class:"info-label"},"Controller:",-1)),e("span",ql,u(l.value.controller||"Broadlink"),1)])])])):T("",!0)]))}},Jl=ke(zl,[["__scopeId","data-v-1911c8f6"]]),Wl={class:"modal-content"},Kl={class:"modal-header"},Xl={class:"input-wrapper"},Gl={key:0,class:"validation-tooltip"},Yl={class:"input-wrapper"},Zl=["disabled"],Ql={key:0,class:"validation-tooltip"},eo={key:0,class:"smartir-notice"},to={key:0,class:"notice-success"},lo={key:1,class:"notice-warning"},oo={key:1,class:"smartir-notice"},so={key:2},no={class:"form-group"},ao=["disabled"],io=["disabled"],ro={key:0},uo={key:1},co={key:2},mo={key:3},vo={key:0,class:"form-group"},po={class:"area-display-readonly"},fo=["value"],go=["disabled"],yo=["href"],bo={key:1,class:"form-group"},ho={class:"form-group"},ko={class:"input-wrapper"},wo=["value"],$o=["value"],Co={key:2,class:"validation-tooltip"},So={key:0},_o={key:1},Do={key:3,class:"smartir-section"},Io={class:"modal-footer"},To={type:"submit",form:"device-form",class:"btn btn-primary"},xo={__name:"DeviceForm",props:{device:{type:Object,default:null}},emits:["save","cancel"],setup(t,{emit:c}){const m=t,k=c,g=Ie("smartirStatus"),s=Ie("smartirEnabled"),r=J(()=>{var d;return localStorage.getItem("smartir_simulate_not_installed")==="true"?!1:((d=g==null?void 0:g.value)==null?void 0:d.installed)||!1}),p=J(()=>!!m.device),_=J(()=>["climate","media_player","fan","light"].includes(l.value.entity_type)),C=J(()=>r.value?!_.value&&l.value.entity_type?"(Not supported for this type)":"(Pre-configured Codes)":"(Requires SmartIR)"),O=J(()=>{var d;const I=((d=m.device)==null?void 0:d.commands)||{};return Object.keys(I).length>0}),w=J(()=>{if(!l.value.broadlink_entity)return"";const I=a.value.find(d=>d.entity_id===l.value.broadlink_entity);return I&&I.name||l.value.broadlink_entity}),l=y({name:"",entity_type:"",device_type:"broadlink",device:"",area:"",icon:"",broadlink_entity:"",enabled:!0,commands:{}}),R=y({name:"",entity_type:"",broadlink_entity:""}),W=y({}),P=y(null),D=y([]),a=y([]),b=y(null),v=y(null),E=y(null),H=y(!1);Le(async()=>{m.device&&(l.value={...m.device,device_type:m.device.device_type||"broadlink"},l.value.device_type==="smartir"&&(W.value={manufacturer:m.device.manufacturer,model:m.device.model,device_code:m.device.device_code,controller_device:m.device.controller_device,temperature_sensor:m.device.temperature_sensor,humidity_sensor:m.device.humidity_sensor})),await Promise.all([Z(),N()])});const Z=async()=>{try{const I=await ne.get("/api/areas");D.value=I.data.areas||[]}catch(I){console.error("Error loading areas:",I),D.value=[]}},N=async()=>{try{const d=(await ne.get("/api/remote/devices")).data.devices||[];a.value=d,console.log("Loaded remote devices:",d)}catch(I){console.error("Error loading remote devices:",I),a.value=[]}},oe=I=>{if(!I)return"";const d=I.toLowerCase();for(const V of D.value){const ge=V.toLowerCase();if(d.includes(ge))return V}return""},A=(I,d="")=>{const V=d.toLowerCase();return V.includes("tv")?"mdi:television":V.includes("lamp")?"mdi:lamp":V.includes("ceiling")?"mdi:ceiling-light":V.includes("floor")?"mdi:floor-lamp":V.includes("desk")?"mdi:desk-lamp":V.includes("fan")?"mdi:fan":V.includes("ac")||V.includes("air con")?"mdi:air-conditioner":V.includes("heater")?"mdi:radiator":V.includes("blind")?"mdi:blinds":V.includes("curtain")?"mdi:curtains":V.includes("garage")?"mdi:garage":V.includes("speaker")||V.includes("stereo")?"mdi:speaker":V.includes("receiver")?"mdi:audio-video":{light:"mdi:lightbulb",fan:"mdi:fan",switch:"mdi:light-switch",media_player:"mdi:television",cover:"mdi:window-shutter",climate:"mdi:thermostat"}[I]||"mdi:devices"};re(()=>l.value.name,I=>{if(!p.value&&I&&!l.value.area){const d=oe(I);d&&(l.value.area=d)}!p.value&&I&&l.value.entity_type&&(H.value||!l.value.icon)&&(l.value.icon=A(l.value.entity_type,I),H.value=!0)}),re(()=>l.value.entity_type,I=>{!p.value&&I&&(H.value||!l.value.icon)&&(l.value.icon=A(I,l.value.name),H.value=!0)}),re(()=>l.value.icon,(I,d)=>{d!==void 0&&I!==d&&!H.value&&(H.value=!1),I||(H.value=!1)});const j=y(!1),X=async()=>{var I;if((I=m.device)!=null&&I.id){j.value=!0;try{const d=await ne.post(`/api/devices/${m.device.id}/sync-area`);d.data.success?(l.value.area=d.data.area||"",d.data.area?console.log(`Area synced: ${d.data.area}`):console.log("No area assigned in Home Assistant")):console.warn(d.data.message||"Entity not found in HA")}catch(d){console.error("Failed to sync area:",d)}finally{j.value=!1}}},M=()=>{var V;return!((V=m.device)!=null&&V.id)||!l.value.entity_type?"#":`/config/entities/entity/${`${l.value.entity_type}.${m.device.id}`}`},ee=()=>{R.value={name:"",entity_type:"",broadlink_entity:""};let I=!0;return(!l.value.name||l.value.name.trim()==="")&&(R.value.name="Device name is required",I=!1),l.value.entity_type||(R.value.entity_type="Entity type is required",I=!1),l.value.device_type==="broadlink"&&!l.value.broadlink_entity&&(R.value.broadlink_entity="Broadlink device is required",I=!1),I},we=I=>{R.value[I]=""},Se=async()=>{if(l.value.device_type==="smartir"){if(P.value&&!P.value.validate())return;const I={...l.value,smartir_config:{manufacturer:W.value.manufacturer,model:W.value.model,code_id:W.value.device_code,controller_device:W.value.controller_device}};k("save",I)}else{if(!ee())return;k("save",{...l.value})}},Me=I=>{W.value=I};return(I,d)=>(o(),n("div",{class:"modal-overlay",onClick:d[11]||(d[11]=ue(V=>I.$emit("cancel"),["self"]))},[e("div",Wl,[e("div",Kl,[e("h2",null,u(p.value?"Edit Device":"Add New Device"),1),e("button",{onClick:d[0]||(d[0]=V=>I.$emit("cancel")),class:"close-btn"},[...d[12]||(d[12]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("form",{id:"device-form",onSubmit:ue(Se,["prevent"]),class:"modal-body"},[e("div",{class:K(["form-group",{"has-error":R.value.name}])},[d[14]||(d[14]=e("label",{for:"device-name"},"Device Name *",-1)),e("div",Xl,[z(e("input",{id:"device-name",ref_key:"nameInput",ref:b,"onUpdate:modelValue":d[1]||(d[1]=V=>l.value.name=V),type:"text",placeholder:"e.g., Living Room TV",onInput:d[2]||(d[2]=V=>we("name"))},null,544),[[xe,l.value.name]]),R.value.name?(o(),n("div",Gl,[d[13]||(d[13]=e("i",{class:"mdi mdi-alert"},null,-1)),x(" "+u(R.value.name),1)])):T("",!0)]),d[15]||(d[15]=e("small",null,"Friendly name for this device",-1))],2),e("div",{class:K(["form-group",{"has-error":R.value.entity_type}])},[d[23]||(d[23]=e("label",{for:"entity-type"},"Entity Type *",-1)),e("div",Yl,[z(e("select",{id:"entity-type",ref_key:"typeSelect",ref:v,"onUpdate:modelValue":d[3]||(d[3]=V=>l.value.entity_type=V),onChange:d[4]||(d[4]=V=>we("entity_type"))},[d[16]||(d[16]=Pe('<option value="" data-v-94bc1fe5>-- Select Type --</option><option value="light" data-v-94bc1fe5>💡 Light</option><option value="fan" data-v-94bc1fe5>🌀 Fan</option><option value="switch" data-v-94bc1fe5>🔌 Switch</option><option value="media_player" data-v-94bc1fe5>📺 Media Player</option><option value="cover" data-v-94bc1fe5>🪟 Cover (Blinds/Curtains)</option>',6)),e("option",{value:"climate",disabled:!r.value}," 🌡️ Climate "+u(r.value?"":"(Requires SmartIR)"),9,Zl)],544),[[De,l.value.entity_type]]),R.value.entity_type?(o(),n("div",Ql,[d[17]||(d[17]=e("i",{class:"mdi mdi-alert"},null,-1)),x(" "+u(R.value.entity_type),1)])):T("",!0)]),l.value.entity_type==="climate"?(o(),n("div",eo,[r.value?(o(),n("div",to,[...d[18]||(d[18]=[e("i",{class:"mdi mdi-check-circle"},null,-1),e("span",null,"SmartIR detected! Climate entities will be created via SmartIR profiles.",-1)])])):(o(),n("div",lo,[...d[19]||(d[19]=[e("i",{class:"mdi mdi-alert"},null,-1),e("div",null,[e("strong",null,"SmartIR Required"),e("p",null,"Climate entities (AC, heaters) require SmartIR integration."),e("a",{href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"smartir-link"}," Install SmartIR → ")],-1)])]))])):r.value&&["media_player","fan","light"].includes(l.value.entity_type)?(o(),n("div",oo,[...d[20]||(d[20]=[e("div",{class:"notice-info"},[e("i",{class:"mdi mdi-information"}),e("span",null,"💡 SmartIR available! You can use pre-configured codes or learn your own.")],-1)])])):!r.value&&l.value.entity_type?(o(),n("small",so,[d[21]||(d[21]=x(" 💡 Tip: Install ",-1)),d[22]||(d[22]=e("a",{href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"inline-link"},"SmartIR",-1)),x(" for pre-configured "+u(l.value.entity_type==="climate"?"climate":l.value.entity_type)+" device codes ",1)])):T("",!0)],2),e("div",no,[d[26]||(d[26]=e("label",{for:"device-type"},"Device Type *",-1)),z(e("select",{id:"device-type","onUpdate:modelValue":d[5]||(d[5]=V=>l.value.device_type=V),required:"",disabled:p.value},[d[24]||(d[24]=e("option",{value:""},"-- Select Device Type --",-1)),d[25]||(d[25]=e("option",{value:"broadlink"},"📡 Broadlink Device (Learn IR Codes)",-1)),Ce(s)?(o(),n("option",{key:0,value:"smartir",disabled:!r.value||!_.value}," 🌐 SmartIR Device "+u(C.value),9,io)):T("",!0)],8,ao),[[De,l.value.device_type]]),p.value?(o(),n("small",ro,"Cannot change device type after creation")):l.value.device_type==="smartir"?(o(),n("small",uo,"Using pre-configured codes from SmartIR repository")):l.value.device_type==="broadlink"?(o(),n("small",co,"Learn and store your own IR codes")):(o(),n("small",mo,"Choose how to configure this device"))]),p.value?(o(),n("div",vo,[d[29]||(d[29]=e("label",{for:"device-area"},"Area",-1)),e("div",po,[e("input",{id:"device-area",value:l.value.area||"Not assigned",type:"text",readonly:"",class:"readonly-input"},null,8,fo),e("button",{type:"button",onClick:X,disabled:j.value,class:"sync-area-btn",title:"Sync area from Home Assistant"},[e("i",{class:K(j.value?"mdi mdi-loading mdi-spin":"mdi mdi-refresh")},null,2)],8,go)]),e("small",null,[d[27]||(d[27]=e("i",{class:"mdi mdi-information-outline"},null,-1)),d[28]||(d[28]=x(" Set area in Home Assistant, then click sync. ",-1)),e("a",{href:M(),target:"_blank",class:"inline-link"},"Open in HA →",8,yo)])])):(o(),n("div",bo,[...d[30]||(d[30]=[e("div",{class:"info-notice"},[e("i",{class:"mdi mdi-information-outline"}),e("span",null,[e("strong",null,"Area Assignment:"),x(" After generating entities and restarting Home Assistant, you can assign areas in HA and sync them here.")])],-1)])])),e("div",ho,[d[31]||(d[31]=e("label",{for:"device-icon"},"Icon",-1)),be(ul,{modelValue:l.value.icon,"onUpdate:modelValue":d[6]||(d[6]=V=>l.value.icon=V),inputId:"device-icon",placeholder:"e.g., mdi:television"},null,8,["modelValue"]),d[32]||(d[32]=e("small",null,"Optional: Material Design Icon name",-1))]),l.value.device_type==="broadlink"?(o(),n("div",{key:2,class:K(["form-group",{"has-error":R.value.broadlink_entity}])},[d[35]||(d[35]=e("label",{for:"broadlink-entity"},"Remote Device *",-1)),e("div",ko,[!p.value||!O.value?z((o(),n("select",{key:0,id:"broadlink-entity",ref_key:"broadlinkSelect",ref:E,"onUpdate:modelValue":d[7]||(d[7]=V=>l.value.broadlink_entity=V),onChange:d[8]||(d[8]=V=>we("broadlink_entity"))},[d[33]||(d[33]=e("option",{value:""},"-- Select Remote Device --",-1)),(o(!0),n(fe,null,$e(a.value,V=>(o(),n("option",{key:V.entity_id,value:V.entity_id},[x(u(V.name||V.entity_id)+" ",1),V.area_name?(o(),n(fe,{key:0},[x(" - "+u(V.area_name),1)],64)):T("",!0)],8,wo))),128))],544)),[[De,l.value.broadlink_entity]]):(o(),n("input",{key:1,id:"broadlink-entity",value:w.value,type:"text",readonly:"",disabled:""},null,8,$o)),R.value.broadlink_entity?(o(),n("div",Co,[d[34]||(d[34]=e("i",{class:"mdi mdi-alert"},null,-1)),x(" "+u(R.value.broadlink_entity),1)])):T("",!0)]),!p.value||!O.value?(o(),n("small",So,"Required: Select which remote device to use for sending commands")):(o(),n("small",_o,"Cannot change remote device after commands are learned"))],2)):T("",!0),l.value.device_type==="smartir"?(o(),n("div",Do,[d[36]||(d[36]=e("div",{class:"section-header"},[e("i",{class:"mdi mdi-cloud-download"}),e("span",null,"SmartIR Device Configuration")],-1)),be(Jl,{ref_key:"smartirSelector",ref:P,"entity-type":l.value.entity_type,modelValue:W.value,"onUpdate:modelValue":d[9]||(d[9]=V=>W.value=V),"broadlink-devices":a.value,onChange:Me},null,8,["entity-type","modelValue","broadlink-devices"])])):T("",!0)],32),e("div",Io,[e("button",{type:"button",onClick:d[10]||(d[10]=V=>I.$emit("cancel")),class:"btn btn-secondary"}," Cancel "),e("button",To,[d[37]||(d[37]=e("i",{class:"mdi mdi-check"},null,-1)),x(" "+u(p.value?"Update":"Create"),1)])])])]))}},Mo=ke(xo,[["__scopeId","data-v-94bc1fe5"]]),Ro={class:"modal-content"},Lo={class:"modal-header"},Ao={class:"modal-body"},Eo={class:"form-group"},Oo={class:"form-group"},Vo={class:"radio-group"},Po={class:"radio-label"},Uo={class:"radio-label"},Fo={key:1,class:"learning-state"},jo={key:2,class:"learning-state"},No={class:"progress-bar"},Bo={class:"timer"},Ho={key:3,class:"learning-state"},qo={class:"progress-bar"},zo={class:"timer"},Jo={key:4,class:"learning-state"},Wo={key:0,class:"frequency"},Ko={class:"progress-bar"},Xo={class:"timer"},Go={key:5,class:"success-state"},Yo={class:"command-details"},Zo={key:0},Qo={class:"test-options"},es={class:"test-buttons"},ts=["disabled"],ls=["disabled"],os=["disabled"],ss={key:6,class:"error-state"},ns={class:"error-message"},as={class:"error-actions"},is={key:7,class:"testing-state"},rs={key:8,class:"test-result-state"},ds={key:0},us={key:1,class:"error-message"},cs={class:"result-actions"},ms={__name:"DirectCommandLearner",props:{device:{type:Object,required:!0}},emits:["cancel","learned"],setup(t,{emit:c}){const m=t,k=c,g=y(""),s=y("ir"),r=y("ready"),p=y(0),_=J(()=>p.value/30*100),C=y(null),O=y(0),w=y(""),l=y(null),R=y(!1),W=y("");let P=null,D=null;const a=()=>{D=Date.now(),p.value=0,P=setInterval(()=>{p.value=Math.floor((Date.now()-D)/1e3)},100)},b=()=>{P&&(clearInterval(P),P=null)};Ke(()=>{b()});const v=async()=>{var X,M;if(g.value.trim())try{const ee=m.device.broadlink_entity||m.device.controller_device;if(!ee){w.value="No Broadlink entity configured for this device",r.value="error";return}r.value="preparing";const we=setTimeout(()=>{s.value==="ir"?r.value="learning-ir":r.value="learning-rf-sweep",a()},6e3),Se=await ne.post("/api/commands/learn/direct",{device_id:m.device.id,entity_id:ee,command_name:g.value.trim(),command_type:s.value});clearTimeout(we),b(),Se.data.success?(O.value=Se.data.data_length,Se.data.frequency&&(C.value=Se.data.frequency),r.value="success"):(w.value=Se.data.error||"Learning failed",r.value="error")}catch(ee){b(),w.value=((M=(X=ee.response)==null?void 0:X.data)==null?void 0:M.error)||ee.message||"Learning failed",r.value="error"}},E=()=>{b(),r.value="ready",p.value=0},H=async()=>{var X,M;l.value="direct",r.value="testing";try{const ee=m.device.broadlink_entity||m.device.controller_device,we=await ne.post("/api/commands/test/direct",{device_id:m.device.id,entity_id:ee,command_name:g.value.trim()});R.value=we.data.success,W.value="direct connection",r.value="test-result"}catch(ee){R.value=!1,w.value=((M=(X=ee.response)==null?void 0:X.data)==null?void 0:M.error)||ee.message,r.value="test-result"}finally{l.value=null}},Z=async()=>{var X,M;l.value="ha",r.value="testing";try{const ee=m.device.broadlink_entity||m.device.controller_device,we=await ne.post("/api/commands/test/ha",{device_id:m.device.id,entity_id:ee,command_name:g.value.trim()});R.value=we.data.success,W.value="Home Assistant",r.value="test-result"}catch(ee){R.value=!1,w.value=((M=(X=ee.response)==null?void 0:X.data)==null?void 0:M.error)||ee.message,r.value="test-result"}finally{l.value=null}},N=()=>{j()},oe=()=>{r.value="ready",p.value=0,C.value=null,O.value=0,w.value=""},A=()=>{k("learned",{deviceId:m.device.id,commandName:g.value.trim(),commandType:s.value}),g.value="",C.value=null,O.value=0,r.value="ready"},j=()=>{k("learned",{deviceId:m.device.id,commandName:g.value.trim(),commandType:s.value}),k("cancel")};return(X,M)=>(o(),n("div",{class:"modal-overlay",onClick:M[6]||(M[6]=ue(ee=>X.$emit("cancel"),["self"]))},[e("div",Ro,[e("div",Lo,[e("h2",null,"Learn Command: "+u(t.device.friendly_name||t.device.name),1),e("button",{onClick:M[0]||(M[0]=ee=>X.$emit("cancel")),class:"close-btn"},[...M[7]||(M[7]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Ao,[r.value==="ready"?(o(),n("form",{key:0,onSubmit:ue(v,["prevent"])},[e("div",Eo,[M[8]||(M[8]=e("label",{for:"command-name"},"Command Name *",-1)),z(e("input",{id:"command-name","onUpdate:modelValue":M[1]||(M[1]=ee=>g.value=ee),type:"text",placeholder:"e.g., power, volume_up",required:"",autofocus:""},null,512),[[xe,g.value]]),M[9]||(M[9]=e("small",null,"Enter a descriptive name for this command",-1))]),e("div",Oo,[M[12]||(M[12]=e("label",null,"Command Type *",-1)),e("div",Vo,[e("label",Po,[z(e("input",{type:"radio","onUpdate:modelValue":M[2]||(M[2]=ee=>s.value=ee),value:"ir"},null,512),[[ze,s.value]]),M[10]||(M[10]=e("span",null,"IR (Infrared)",-1))]),e("label",Uo,[z(e("input",{type:"radio","onUpdate:modelValue":M[3]||(M[3]=ee=>s.value=ee),value:"rf"},null,512),[[ze,s.value]]),M[11]||(M[11]=e("span",null,"RF (Radio Frequency)",-1))])])]),M[13]||(M[13]=e("div",{class:"form-actions"},[e("button",{type:"submit",class:"btn btn-primary"},[e("i",{class:"mdi mdi-remote-tv"}),x(" Start Learning ")])],-1))],32)):T("",!0),r.value==="preparing"?(o(),n("div",Fo,[...M[14]||(M[14]=[Pe('<div class="learning-icon" data-v-af46f27f><i class="mdi mdi-cog mdi-spin" data-v-af46f27f></i></div><h3 data-v-af46f27f>Preparing Device...</h3><p class="instruction" data-v-af46f27f>Connecting and authenticating with Broadlink device</p><p class="sub-instruction" data-v-af46f27f>Please wait, this takes a few seconds</p><div class="progress-bar" data-v-af46f27f><div class="progress-fill indeterminate" data-v-af46f27f></div></div>',5)])])):T("",!0),r.value==="learning-ir"?(o(),n("div",jo,[M[15]||(M[15]=e("div",{class:"learning-icon"},[e("i",{class:"mdi mdi-remote mdi-spin"})],-1)),M[16]||(M[16]=e("h3",null,"Learning IR Command",-1)),M[17]||(M[17]=e("p",{class:"instruction"},"Point your remote at the Broadlink device and press the button",-1)),e("div",No,[e("div",{class:"progress-fill",style:qe({width:_.value+"%"})},null,4)]),e("p",Bo,u(p.value)+"s / 30s",1),e("button",{onClick:E,class:"btn btn-secondary"},"Cancel")])):T("",!0),r.value==="learning-rf-sweep"?(o(),n("div",Ho,[M[18]||(M[18]=e("div",{class:"learning-icon"},[e("i",{class:"mdi mdi-radio-tower mdi-spin"})],-1)),M[19]||(M[19]=e("h3",null,"RF Learning - Step 1 of 2",-1)),M[20]||(M[20]=e("p",{class:"instruction"},"Press and HOLD the button for 2-3 seconds",-1)),M[21]||(M[21]=e("p",{class:"sub-instruction"},"Scanning for RF frequency...",-1)),e("div",qo,[e("div",{class:"progress-fill",style:qe({width:_.value+"%"})},null,4)]),e("p",zo,u(p.value)+"s / 30s",1),e("button",{onClick:E,class:"btn btn-secondary"},"Cancel")])):T("",!0),r.value==="learning-rf-capture"?(o(),n("div",Jo,[M[22]||(M[22]=e("div",{class:"learning-icon success"},[e("i",{class:"mdi mdi-check-circle"})],-1)),M[23]||(M[23]=e("h3",null,"RF Frequency Locked!",-1)),C.value?(o(),n("p",Wo,u(C.value)+" MHz",1)):T("",!0),M[24]||(M[24]=e("p",{class:"instruction"},"Now press the button again (short press)",-1)),e("div",Ko,[e("div",{class:"progress-fill",style:qe({width:_.value+"%"})},null,4)]),e("p",Xo,u(p.value)+"s / 30s",1),e("button",{onClick:E,class:"btn btn-secondary"},"Cancel")])):T("",!0),r.value==="success"?(o(),n("div",Go,[M[33]||(M[33]=e("div",{class:"success-icon"},[e("i",{class:"mdi mdi-check-circle"})],-1)),M[34]||(M[34]=e("h3",null,"Command Learned Successfully!",-1)),e("div",Yo,[e("p",null,[M[25]||(M[25]=e("strong",null,"Name:",-1)),x(" "+u(g.value),1)]),e("p",null,[M[26]||(M[26]=e("strong",null,"Type:",-1)),x(" "+u(s.value.toUpperCase()),1)]),C.value?(o(),n("p",Zo,[M[27]||(M[27]=e("strong",null,"Frequency:",-1)),x(" "+u(C.value)+" MHz",1)])):T("",!0),e("p",null,[M[28]||(M[28]=e("strong",null,"Data Length:",-1)),x(" "+u(O.value)+" characters",1)])]),e("div",Qo,[M[31]||(M[31]=e("h4",null,"Test Command:",-1)),e("div",es,[e("button",{onClick:H,class:"btn btn-primary",disabled:l.value},[e("i",{class:K(["mdi mdi-flash",{"mdi-spin":l.value==="direct"}])},null,2),M[29]||(M[29]=x(" Test Direct ",-1))],8,ts),e("button",{onClick:Z,class:"btn btn-primary",disabled:l.value},[e("i",{class:K(["mdi mdi-home-assistant",{"mdi-spin":l.value==="ha"}])},null,2),M[30]||(M[30]=x(" Test via HA ",-1))],8,ls),e("button",{onClick:N,class:"btn btn-secondary",disabled:l.value}," Skip Testing ",8,os)]),M[32]||(M[32]=e("small",null,"Test to verify the command works correctly",-1))])])):T("",!0),r.value==="error"?(o(),n("div",ss,[M[35]||(M[35]=e("div",{class:"error-icon"},[e("i",{class:"mdi mdi-alert-circle"})],-1)),M[36]||(M[36]=e("h3",null,"Learning Failed",-1)),e("p",ns,u(w.value),1),e("div",as,[e("button",{onClick:oe,class:"btn btn-primary"},"Try Again"),e("button",{onClick:M[4]||(M[4]=ee=>X.$emit("cancel")),class:"btn btn-secondary"},"Close")])])):T("",!0),r.value==="testing"?(o(),n("div",is,[...M[37]||(M[37]=[e("div",{class:"testing-icon"},[e("i",{class:"mdi mdi-play-circle mdi-spin"})],-1),e("h3",null,"Testing Command...",-1),e("p",null,"Sending command to device",-1),e("p",{class:"sub-instruction"},"Did your device respond?",-1)])])):T("",!0),r.value==="test-result"?(o(),n("div",rs,[e("div",{class:K(["result-icon",R.value?"success":"error"])},[e("i",{class:K(R.value?"mdi mdi-check-circle":"mdi mdi-alert-circle")},null,2)],2),e("h3",null,u(R.value?"Test Successful!":"Test Failed"),1),R.value?(o(),n("p",ds,"Command sent successfully via "+u(W.value),1)):(o(),n("p",us,u(w.value),1)),e("div",cs,[R.value?(o(),n("button",{key:0,onClick:A,class:"btn btn-primary"}," Learn Another Command ")):T("",!0),R.value?T("",!0):(o(),n("button",{key:1,onClick:M[5]||(M[5]=ee=>r.value="success"),class:"btn btn-primary"}," Try Different Test ")),e("button",{onClick:j,class:"btn btn-secondary"},u(R.value?"Done":"Close"),1)])])):T("",!0)])])]))}},vs=ke(ms,[["__scopeId","data-v-af46f27f"]]),ps={class:"modal-header"},fs={class:"modal-body"},gs={class:"message-text"},ys={key:0,class:"checkbox-option"},bs={class:"modal-footer"},hs=["disabled"],ks={__name:"ConfirmDialog",props:{isOpen:{type:Boolean,default:!1},title:{type:String,default:"Confirm"},message:{type:String,required:!0},confirmText:{type:String,default:"OK"},cancelText:{type:String,default:"Cancel"},showCancel:{type:Boolean,default:!0},dangerMode:{type:Boolean,default:!1},confirmDisabled:{type:Boolean,default:!1},checkboxLabel:{type:String,default:""}},emits:["confirm","cancel"],setup(t,{emit:c}){const m=t,k=c,g=y(!1);re(()=>m.isOpen,p=>{p&&(g.value=!1)});const s=()=>{k("confirm",g.value)},r=()=>{k("cancel")};return(p,_)=>t.isOpen?(o(),n("div",{key:0,class:"modal-overlay",onClick:ue(r,["self","stop"])},[e("div",{class:"modal-dialog confirm-dialog",onClick:_[1]||(_[1]=ue(()=>{},["stop"]))},[e("div",ps,[e("h2",null,u(t.title),1)]),e("div",fs,[e("p",gs,u(t.message),1),t.checkboxLabel?(o(),n("div",ys,[e("label",null,[z(e("input",{type:"checkbox","onUpdate:modelValue":_[0]||(_[0]=C=>g.value=C)},null,512),[[ve,g.value]]),e("span",null,u(t.checkboxLabel),1)])])):T("",!0)]),e("div",bs,[t.showCancel?(o(),n("button",{key:0,onClick:ue(r,["stop"]),class:"btn btn-secondary"},u(t.cancelText),1)):T("",!0),t.confirmText?(o(),n("button",{key:1,onClick:ue(s,["stop"]),class:K(["btn",t.dangerMode?"btn-danger":"btn-primary"]),disabled:t.confirmDisabled},u(t.confirmText),11,hs)):T("",!0)])])])):T("",!0)}},Ue=ke(ks,[["__scopeId","data-v-9cea6cb3"]]),ws={class:"modal-container error-dialog"},$s={class:"modal-header"},Cs={class:"modal-body"},Ss={class:"error-message"},_s={key:0,class:"error-suggestion"},Ds=["open"],Is={class:"debug-content"},Ts={class:"debug-info"},xs={key:0,class:"debug-section-title"},Ms={key:1},Rs={__name:"ErrorDialog",props:{isOpen:{type:Boolean,default:!1},title:{type:String,default:"Error"},message:{type:String,required:!0},suggestion:{type:String,default:""},details:{type:String,default:""},error:{type:Object,default:null},context:{type:Object,default:()=>({})}},emits:["close"],setup(t,{emit:c}){const m=t,k=c,g=Ie("toast"),s=y(!1),r=()=>{k("close")},p=J(()=>{var R,W,P,D,a,b,v,E,H,Z,N;const w=new Date().toISOString(),l=m.error||{};return{error:JSON.stringify({message:m.message,title:m.title,details:m.details,errorObject:l.message||l.toString(),timestamp:w},null,2),request:JSON.stringify({method:((W=(R=l.config)==null?void 0:R.method)==null?void 0:W.toUpperCase())||"N/A",url:((P=l.config)==null?void 0:P.url)||"N/A",baseURL:((D=l.config)==null?void 0:D.baseURL)||"N/A",headers:((a=l.config)==null?void 0:a.headers)||{},data:(b=l.config)!=null&&b.data?JSON.parse(l.config.data):"N/A",params:((v=l.config)==null?void 0:v.params)||{}},null,2),response:JSON.stringify({status:((E=l.response)==null?void 0:E.status)||"N/A",statusText:((H=l.response)==null?void 0:H.statusText)||"N/A",data:((Z=l.response)==null?void 0:Z.data)||"N/A",headers:((N=l.response)==null?void 0:N.headers)||{}},null,2),browser:JSON.stringify({userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language,cookieEnabled:navigator.cookieEnabled,onLine:navigator.onLine,viewport:`${window.innerWidth}x${window.innerHeight}`,screenResolution:`${window.screen.width}x${window.screen.height}`,colorDepth:window.screen.colorDepth,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,timestamp:w},null,2),appState:JSON.stringify({currentRoute:window.location.pathname,currentURL:window.location.href,referrer:document.referrer||"N/A",context:m.context||{},localStorage:{smartir_simulate:localStorage.getItem("smartir_simulate_not_installed"),theme:localStorage.getItem("theme")}},null,2),stackTrace:l.stack||null}}),_=async()=>{const w=O();try{await navigator.clipboard.writeText(w),g==null||g.success("Debug information copied to clipboard","✅ Copied")}catch(l){console.error("Failed to copy:",l),g==null||g.error("Failed to copy to clipboard","❌ Copy Failed")}},C=()=>{const w=O(),l=new Blob([w],{type:"text/plain"}),R=URL.createObjectURL(l),W=document.createElement("a");W.href=R;const P=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5);W.download=`broadlink-manager-error-${P}.txt`,document.body.appendChild(W),W.click(),document.body.removeChild(W),URL.revokeObjectURL(R),g==null||g.success("Debug report downloaded","✅ Downloaded")},O=()=>`Broadlink Manager - Error Report
${"=".repeat(60)}

Generated: ${new Date().toISOString()}
Title: ${m.title}
Message: ${m.message}
${m.suggestion?`Suggestion: ${m.suggestion}
`:""}
${"=".repeat(60)}

ERROR DETAILS
${"-".repeat(60)}
${p.value.error}

REQUEST INFORMATION
${"-".repeat(60)}
${p.value.request}

RESPONSE INFORMATION
${"-".repeat(60)}
${p.value.response}

BROWSER INFORMATION
${"-".repeat(60)}
${p.value.browser}

APPLICATION STATE
${"-".repeat(60)}
${p.value.appState}

${p.value.stackTrace?`STACK TRACE
${"-".repeat(60)}
${p.value.stackTrace}

`:""}
${"=".repeat(60)}
End of Report
`;return re(()=>m.isOpen,w=>{if(w){const l=R=>{R.key==="Escape"&&r()};return document.addEventListener("keydown",l),()=>document.removeEventListener("keydown",l)}}),(w,l)=>(o(),Oe(lt,{to:"body"},[be(tt,{name:"modal"},{default:Ge(()=>[t.isOpen?(o(),n("div",{key:0,class:"modal-overlay",onClick:ue(r,["self"])},[e("div",ws,[e("div",$s,[l[2]||(l[2]=e("div",{class:"header-icon error-icon"},[e("i",{class:"mdi mdi-alert-circle"})],-1)),e("h3",null,u(t.title),1),e("button",{onClick:r,class:"close-button"},[...l[1]||(l[1]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Cs,[e("p",Ss,u(t.message),1),t.suggestion?(o(),n("p",_s,[l[3]||(l[3]=e("i",{class:"mdi mdi-lightbulb-on"},null,-1)),x(" "+u(t.suggestion),1)])):T("",!0),e("details",{class:"debug-section",open:s.value},[e("summary",{onClick:l[0]||(l[0]=R=>s.value=!s.value)},[e("i",{class:K(["mdi",s.value?"mdi-chevron-down":"mdi-chevron-right"])},null,2),l[4]||(l[4]=x(" Debug Information ",-1))]),e("div",Is,[e("div",{class:"debug-actions"},[e("button",{onClick:_,class:"btn-debug btn-copy"},[...l[5]||(l[5]=[e("i",{class:"mdi mdi-content-copy"},null,-1),x(" Copy to Clipboard ",-1)])]),e("button",{onClick:C,class:"btn-debug btn-download"},[...l[6]||(l[6]=[e("i",{class:"mdi mdi-download"},null,-1),x(" Download Report ",-1)])])]),e("div",Ts,[l[7]||(l[7]=e("div",{class:"debug-section-title"},"Error Details",-1)),e("pre",null,u(p.value.error),1),l[8]||(l[8]=e("div",{class:"debug-section-title"},"Request Information",-1)),e("pre",null,u(p.value.request),1),l[9]||(l[9]=e("div",{class:"debug-section-title"},"Response Information",-1)),e("pre",null,u(p.value.response),1),l[10]||(l[10]=e("div",{class:"debug-section-title"},"Browser Information",-1)),e("pre",null,u(p.value.browser),1),l[11]||(l[11]=e("div",{class:"debug-section-title"},"Application State",-1)),e("pre",null,u(p.value.appState),1),p.value.stackTrace?(o(),n("div",xs,"Stack Trace")):T("",!0),p.value.stackTrace?(o(),n("pre",Ms,u(p.value.stackTrace),1)):T("",!0)])])],8,Ds)]),e("div",{class:"modal-footer"},[e("button",{onClick:r,class:"btn btn-primary"}," OK ")])])])):T("",!0)]),_:1})]))}},Ls=ke(Rs,[["__scopeId","data-v-23858149"]]),As={key:0,class:"discovery-banner"},Es={class:"banner-content"},Os={class:"banner-text"},Vs={class:"modal-dialog"},Ps={class:"modal-header"},Us={class:"modal-body"},Fs={class:"device-list"},js={class:"device-info"},Ns={class:"device-details"},Bs={class:"command-count"},Hs={class:"device-actions"},qs=["onClick"],zs=["onClick"],Js={class:"modal-footer"},Ws={class:"modal-dialog modal-dialog-small"},Ks={class:"modal-header"},Xs={class:"modal-body"},Gs={class:"warning-message"},Ys={class:"modal-footer"},Zs=["disabled"],Qs=["disabled"],en={__name:"DeviceDiscovery",emits:["adopt"],setup(t,{expose:c,emit:m}){const k=je(),g=m,s=y([]),r=y(!1),p=y(!1),_=y(null),C=y(!1),O=J(()=>s.value.length>0);Le(async()=>{await w()});const w=async()=>{try{const P=await ne.get("/api/devices/discover");s.value=P.data.untracked_devices||[]}catch(P){console.error("Error loading untracked devices:",P),s.value=[]}},l=P=>{r.value=!1,g("adopt",P)},R=P=>{_.value=P,p.value=!0},W=async()=>{if(!_.value)return;const P=_.value.device_name;C.value=!0;try{const D=await ne.delete(`/api/devices/untracked/${encodeURIComponent(P)}`);if(D.data.success)s.value=s.value.filter(a=>a.device_name!==P),p.value=!1,_.value=null,s.value.length===0&&(r.value=!1),k.success(`Deleted all commands for '${P}'`);else throw new Error(D.data.error||"Failed to delete device")}catch(D){console.error("Error deleting device:",D),k.error(`Failed to delete device: ${D.message}`)}finally{C.value=!1}};return c({refresh:w}),(P,D)=>{var a,b,v;return O.value?(o(),n("div",As,[e("div",Es,[D[9]||(D[9]=e("div",{class:"banner-icon"},[e("i",{class:"mdi mdi-radar"})],-1)),e("div",Os,[D[7]||(D[7]=e("h3",null,"Untracked Devices Found",-1)),e("p",null,u(s.value.length)+" device"+u(s.value.length>1?"s":"")+" with learned commands found in Broadlink storage",1)]),e("button",{onClick:D[0]||(D[0]=E=>r.value=!0),class:"btn btn-primary"},[...D[8]||(D[8]=[e("i",{class:"mdi mdi-eye"},null,-1),x(" View Devices ",-1)])])]),r.value?(o(),n("div",{key:0,class:"modal-overlay",onClick:D[3]||(D[3]=ue(E=>r.value=!1,["self"]))},[e("div",Vs,[e("div",Ps,[D[11]||(D[11]=e("h2",null,"Discovered Devices",-1)),e("button",{onClick:D[1]||(D[1]=E=>r.value=!1),class:"close-btn"},[...D[10]||(D[10]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Us,[D[16]||(D[16]=e("p",{class:"info-text"}," These devices have learned commands in Broadlink storage but are not being tracked. Adopt them to manage their commands and generate Home Assistant entities. ",-1)),e("div",Fs,[(o(!0),n(fe,null,$e(s.value,E=>(o(),n("div",{key:E.device_name,class:"discovered-device"},[e("div",js,[D[13]||(D[13]=e("div",{class:"device-icon"},[e("i",{class:"mdi mdi-devices"})],-1)),e("div",Ns,[e("h4",null,u(E.device_name),1),e("span",Bs,[D[12]||(D[12]=e("i",{class:"mdi mdi-remote"},null,-1)),x(" "+u(E.command_count)+" command"+u(E.command_count>1?"s":""),1)])])]),e("div",Hs,[e("button",{onClick:H=>l(E),class:"btn btn-primary"},[...D[14]||(D[14]=[e("i",{class:"mdi mdi-plus"},null,-1),x(" Adopt ",-1)])],8,qs),e("button",{onClick:H=>R(E),class:"btn btn-danger",title:"Delete all commands"},[...D[15]||(D[15]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,zs)])]))),128))])]),e("div",Js,[e("button",{onClick:D[2]||(D[2]=E=>r.value=!1),class:"btn btn-secondary"}," Close ")])])])):T("",!0),p.value?(o(),n("div",{key:1,class:"modal-overlay",onClick:D[6]||(D[6]=ue(E=>p.value=!1,["self"]))},[e("div",Ws,[e("div",Ks,[D[18]||(D[18]=e("h2",null,"Delete Untracked Device",-1)),e("button",{onClick:D[4]||(D[4]=E=>p.value=!1),class:"close-btn"},[...D[17]||(D[17]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Xs,[e("div",Gs,[D[20]||(D[20]=e("i",{class:"mdi mdi-alert"},null,-1)),e("div",null,[e("p",null,[e("strong",null,'Are you sure you want to delete "'+u((a=_.value)==null?void 0:a.device_name)+'"?',1)]),e("p",null,"This will permanently delete all "+u((b=_.value)==null?void 0:b.command_count)+" command"+u(((v=_.value)==null?void 0:v.command_count)>1?"s":"")+" from Broadlink storage.",1),D[19]||(D[19]=e("p",{class:"warning-text"},"This action cannot be undone.",-1))])])]),e("div",Ys,[e("button",{onClick:D[5]||(D[5]=E=>p.value=!1),class:"btn btn-secondary",disabled:C.value}," Cancel ",8,Zs),e("button",{onClick:W,class:"btn btn-danger",disabled:C.value},[e("i",{class:K(["mdi",C.value?"mdi-loading mdi-spin":"mdi-delete"])},null,2),x(" "+u(C.value?"Deleting...":"Delete"),1)],8,Qs)])])])):T("",!0)])):T("",!0)}}},tn=ke(en,[["__scopeId","data-v-783e943f"]]),ln={class:"device-list-card"},on={class:"card-header"},sn={class:"header-badges"},nn={class:"header-info"},an={class:"header-right"},rn={key:0,class:"view-toggle-group header-view-toggle"},dn={class:"settings-menu-container"},un=["disabled"],cn=["disabled"],mn={class:"card-body"},vn={key:0,class:"filter-bar"},pn={class:"filter-search-row"},fn=["title"],gn={key:0,class:"filter-badge"},yn={class:"search-input-wrapper"},bn={class:"filter-content"},hn={class:"filter-row filter-row-dropdowns"},kn={class:"filter-group"},wn=["value"],$n={class:"filter-group"},Cn=["value"],Sn={class:"filter-group"},_n={key:0,class:"filter-group filter-toggle"},Dn={class:"toggle-label"},In={class:"filter-results"},Tn={key:1,class:"loading-state"},xn={key:2,class:"error-state"},Mn={key:3,class:"empty-state"},Rn={key:4,class:"device-grid"},Ln={key:6,class:"no-results"},An={__name:"DeviceList",setup(t){const c=vt(),m=je(),{isMobile:k}=Ye(),g=y(!1),s=y(!1),r=y(null),p=y(!1),_=y(!1),C=y(null),O=y(null),w=y(!0),l=y(!1),R=y(!1),P=y(window.innerWidth<=767?"grid":localStorage.getItem("device_view_mode")||"grid");re(k,S=>{S&&P.value==="list"&&(P.value="grid")}),re(P,S=>{localStorage.setItem("device_view_mode",S)});const D=()=>{w.value=!w.value,w.value||(_.value=!1)},a=()=>{w.value||(w.value=!0),_.value=!_.value},b=y(!1),v=y({title:"Error",message:"",suggestion:"",details:"",error:null,context:{}}),E=y(!1),H=y({success:!1,title:"",message:""}),Z=y(!1),N=y({search:"",broadlinkDevice:"",area:"",entityType:"",showSmartIROnly:!1}),oe=y([]),A=Ie("smartirStatus"),j=Ie("smartirEnabled"),X=J(()=>{var h;return localStorage.getItem("smartir_simulate_not_installed")==="true"?!1:((h=A==null?void 0:A.value)==null?void 0:h.installed)||!1}),M=J(()=>{const S=new Map;return c.devices.forEach(h=>{if(h.broadlink_entity){const F=oe.value.find(te=>te.entity_id===h.broadlink_entity),B=F&&F.name||h.broadlink_entity;S.set(h.broadlink_entity,{entity_id:h.broadlink_entity,friendly_name:B})}}),Array.from(S.values()).sort((h,F)=>h.friendly_name.localeCompare(F.friendly_name))}),ee=J(()=>{const S=new Set;return c.devices.forEach(h=>{h.area&&S.add(h.area)}),Array.from(S).sort()}),we=J(()=>{let S=c.devices;if(N.value.search){const F=N.value.search.toLowerCase();S=S.filter(B=>{var ce,ie,_e,Ve,Ne;if((ce=B.name)!=null&&ce.toLowerCase().includes(F)||(ie=B.entity_type)!=null&&ie.toLowerCase().includes(F)||(_e=B.area)!=null&&_e.toLowerCase().includes(F)||(Ve=B.id)!=null&&Ve.toLowerCase().includes(F)||Object.keys(B.commands||{}).some(Xe=>Xe.toLowerCase().includes(F)))return!0;const pe=oe.value.find(Xe=>Xe.entity_id===B.broadlink_entity);return!!((Ne=pe==null?void 0:pe.name)!=null&&Ne.toLowerCase().includes(F))})}N.value.broadlinkDevice&&(S=S.filter(F=>F.broadlink_entity===N.value.broadlinkDevice||F.controller_device===N.value.broadlinkDevice)),N.value.area&&(S=S.filter(F=>F.area===N.value.area)),N.value.entityType&&(S=S.filter(F=>F.entity_type===N.value.entityType)),N.value.showSmartIROnly&&(S=S.filter(F=>F.device_type==="smartir"));const h=localStorage.getItem("smartir_simulate_not_installed")==="true";return(!(j!=null&&j.value)||h)&&(S=S.filter(F=>F.device_type!=="smartir")),S}),Se=J(()=>N.value.search||N.value.broadlinkDevice||N.value.area||N.value.entityType||N.value.showSmartIROnly),Me=J(()=>{let S=0;return N.value.search&&S++,N.value.broadlinkDevice&&S++,N.value.area&&S++,N.value.entityType&&S++,N.value.showSmartIROnly&&S++,S}),I=()=>{N.value.search="",N.value.broadlinkDevice="",N.value.area="",N.value.entityType="",N.value.showSmartIROnly=!1},d=async()=>{try{const S=await ne.get("/api/remote/devices");oe.value=S.data.devices||[]}catch(S){console.error("Error loading remote devices:",S)}};re(P,S=>{localStorage.setItem("device_view_mode",S)}),Le(async()=>{await Promise.all([c.loadDevices(),d()])});const V=S=>{r.value=S,g.value=!0},ge=J(()=>{if(!C.value)return"";const S=Object.keys(C.value.commands||{}).length;return S===0?"This device has no commands. The device will be removed from tracking.":`This device has ${S} learned command${S>1?"s":""}. What would you like to do?`}),Ae=J(()=>{if(!C.value)return"";const S=Object.keys(C.value.commands||{}).length;return S===0?"":`Also delete all ${S} command${S>1?"s":""} from Broadlink storage`}),ye=S=>{C.value=S,p.value=!0},he=()=>{p.value=!1,C.value=null},Re=async S=>{var F,B;const h=C.value;p.value=!1;try{await c.deleteDevice(h.id,S),O.value&&await O.value.refresh()}catch(te){const pe=((B=(F=te.response)==null?void 0:F.data)==null?void 0:B.error)||te.message||"Unknown error";q("Failed to Delete Device",pe)}finally{C.value=null}},Ee=async S=>{var h,F,B,te,pe;try{console.log("💾 Saving device data:",S),console.log("💾 Device commands:",S.commands),console.log("💾 Selected device:",r.value),(h=r.value)!=null&&h.id&&r.value.id!==null?await c.updateDevice(r.value.id,S):await c.createDevice(S),Y(),O.value&&await O.value.refresh()}catch(ce){let ie="Failed to save device",_e="",Ve="";(B=(F=ce.response)==null?void 0:F.data)!=null&&B.error?(ie=ce.response.data.error,_e=ce.response.data.suggestion||""):ce.message&&(ie=ce.message),ce.response&&(Ve=`Status: ${ce.response.status}
URL: ${((te=ce.config)==null?void 0:te.url)||"N/A"}`),q("Failed to Save Device",ie,_e,Ve,ce,{action:"save_device",deviceData:S,isEdit:!!((pe=r.value)!=null&&pe.id)})}},Y=()=>{g.value=!1,r.value=null},f=S=>{r.value=S,s.value=!0},$=()=>{s.value=!1,r.value=null},q=(S,h,F="",B="",te=null,pe={})=>{v.value={title:S,message:h,suggestion:F,details:B,error:te,context:pe},b.value=!0},se=()=>{b.value=!1},L=()=>{E.value=!1},i=async S=>{if(console.log("📥 DeviceList: Command learned:",S),!S||!S.deviceId||!r.value){console.warn("⚠️ DeviceList: Missing required data in learned event");return}const h=r.value.commands||{},F={...h,[S.commandName]:{command_type:S.commandType,type:S.commandType}};console.log(`✅ DeviceList: Optimistically adding command '${S.commandName}'`),console.log(`✅ DeviceList: Command count: ${Object.keys(h).length} -> ${Object.keys(F).length}`),r.value={...r.value,commands:F},console.log("🔄 DeviceList: Force reloading all devices from API"),await c.loadDevices(!0),O.value&&O.value.refresh()},U=S=>{const h=S.split("_"),F=[];for(let B=0;B<h.length;B++){const te=h[B],pe=h[B+1];te&&pe==="s"&&h[B+2]?(F.push(te.charAt(0).toUpperCase()+te.slice(1)+"'s"),B++):te!=="s"&&F.push(te.charAt(0).toUpperCase()+te.slice(1))}return F.join(" ")},G=(S,h)=>{const F=S.toLowerCase(),B=h.map(ie=>ie.toLowerCase());return F.includes("lamp")||F.includes("light")?"light":F.includes("fan")?"fan":F.includes("tv")||F.includes("stereo")||F.includes("speaker")||F.includes("receiver")?"media_player":F.includes("blind")||F.includes("curtain")||F.includes("shade")||F.includes("garage")?"cover":B.some(ie=>ie.includes("volume")||ie.includes("channel")||ie.includes("play")||ie.includes("pause")||ie.includes("mute"))?"media_player":B.some(ie=>ie.includes("fan_speed")||ie.includes("fan_low")||ie.includes("fan_high"))?"fan":B.some(ie=>ie.includes("open")||ie.includes("close")||ie.includes("stop"))?"cover":"switch"},ae=(S,h)=>{const F=S.toLowerCase();return F.includes("tv")?"mdi:television":F.includes("stereo")||F.includes("receiver")||F.includes("speaker")?"mdi:speaker":F.includes("lamp")?"mdi:lamp":F.includes("light")?"mdi:lightbulb":F.includes("fan")?"mdi:fan":F.includes("blind")?"mdi:blinds":F.includes("curtain")?"mdi:curtains":F.includes("garage")?"mdi:garage":{light:"mdi:lightbulb",fan:"mdi:fan",switch:"mdi:light-switch",media_player:"mdi:speaker",cover:"mdi:window-shutter"}[h]||"mdi:devices"},de=S=>{const h=S.toLowerCase().split("_");for(let te=0;te<h.length-2;te++)if(h[te+1]==="s"){const pe=h.slice(te,te+3),ce=U(pe.join("_"));return console.log("Detected possessive area:",ce,"from",S),ce}const F=[["living","room"],["dining","room"],["master","bedroom"],["guest","bedroom"],["family","room"],["laundry","room"],["home","office"]];for(let te=0;te<h.length-1;te++){const pe=[h[te],h[te+1]],ce=F.find(ie=>ie[0]===pe[0]&&ie[1]===pe[1]);if(ce)return U(ce.join("_"))}const B=["kitchen","bedroom","bathroom","garage","office","basement","attic","hallway","entryway","patio","deck","yard","garden"];for(const te of h)if(B.includes(te))return te.charAt(0).toUpperCase()+te.slice(1);return""},le=async S=>{const h=U(S.device_name),F=de(S.device_name),B=G(S.device_name,S.commands),te=ae(S.device_name,B);let pe="";try{console.log("Finding Broadlink owner for:",S.device_name);const ie=await ne.post("/api/devices/find-broadlink-owner",{device_name:S.device_name});console.log("Broadlink owner response:",ie.data),pe=ie.data.broadlink_entity||"",console.log("Detected Broadlink entity:",pe)}catch(ie){console.error("Error finding Broadlink owner:",ie)}r.value={id:null,device:S.device_name,name:h,entity_type:B,commands:{},area:F,icon:te,broadlink_entity:pe,enabled:!0};const ce={};S.commands.forEach(ie=>{ce[ie]=ie}),r.value.commands=ce,g.value=!0},Q=async()=>{R.value=!0;try{await c.syncAllAreas(),m.success("Areas synced from Home Assistant")}catch(S){console.error("Error syncing areas:",S),m.error("Failed to sync areas")}finally{R.value=!1}},me=async()=>{var S,h;l.value=!0;try{const F=await ne.post("/api/entities/generate",{});if(F.data.success){const B=F.data.broadlink_count||0,te=F.data.smartir_count||0,pe=F.data.total_count||0,ce=F.data.errors||[];let ie="✅ Entity Generation Successful",_e=[];const Ve=[];B>0&&Ve.push(`${B} Broadlink native`),te>0&&Ve.push(`${te} SmartIR`),Ve.length>0&&_e.push(`Generated ${Ve.join(" and ")} entity configuration${pe!==1?"s":""}.`),B>0&&(_e.push(`
📁 Broadlink entities created in:`),_e.push("  • broadlink_manager/entities.yaml"),_e.push("  • broadlink_manager/helpers.yaml")),te>0&&(_e.push(`
📁 SmartIR entities created in:`),_e.push("  • smartir/climate.yaml"),_e.push("  • smartir/media_player.yaml"),_e.push("  • smartir/fan.yaml")),_e.push(`
📝 Next steps:`),_e.push("1. Check your configuration.yaml includes the generated files"),_e.push("2. Restart Home Assistant to load the new entities"),ce.length>0&&(ie="⚠️ Entity Generation Completed with Errors",_e.push(`
⚠️ ${ce.length} error${ce.length!==1?"s":""} occurred:`),ce.forEach(Ne=>{_e.push(`  • ${Ne}`)})),H.value={success:!0,title:ie,message:_e.join(`
`)},E.value=!0}else H.value={success:!1,title:"❌ Entity Generation Failed",message:F.data.message||`Failed to generate entities.

Please check that you have at least one device configured.`},E.value=!0}catch(F){console.error("Error generating entities:",F);const B=((h=(S=F.response)==null?void 0:S.data)==null?void 0:h.error)||F.message||"Unknown error occurred";H.value={success:!1,title:"❌ Entity Generation Error",message:`Failed to generate entities:

${B}

Please check the logs for more details.`},E.value=!0}finally{l.value=!1}},Te=async({device:S,command:h})=>{var F,B;try{const te={device_id:S.id,command:h,entity_id:S.broadlink_entity,device:S.device};await ne.post("/api/commands/test",te),m.success(`Sent ${h} to ${S.name}`)}catch(te){console.error("Error sending command:",te);const pe=((B=(F=te.response)==null?void 0:F.data)==null?void 0:B.error)||te.message||"Unknown error";m.error(`Failed to send ${h}: ${pe}`)}};return(S,h)=>{var F;return o(),n("div",ln,[e("div",on,[e("button",{class:"icon-button chevron-button",onClick:D},[e("i",{class:K(["mdi",w.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2)]),e("div",{class:"header-left",onClick:D},[h[14]||(h[14]=e("div",{class:"header-icon"},[e("i",{class:"mdi mdi-devices"})],-1)),e("h3",null,u(Ce(k)?"Devices":"Managed Devices"),1),e("div",sn,[e("span",nn,u(Ce(c).deviceCount)+" devices",1)])]),e("div",an,[Ce(k)?T("",!0):(o(),n("div",rn,[e("button",{onClick:h[0]||(h[0]=ue(B=>P.value="grid",["stop"])),class:K(["view-toggle-btn",{active:P.value==="grid"}]),title:"Grid View"},[...h[15]||(h[15]=[e("i",{class:"mdi mdi-view-grid"},null,-1)])],2),e("button",{onClick:h[1]||(h[1]=ue(B=>P.value="list",["stop"])),class:K(["view-toggle-btn",{active:P.value==="list"}]),title:"List View"},[...h[16]||(h[16]=[e("i",{class:"mdi mdi-view-list"},null,-1)])],2)])),e("button",{onClick:h[2]||(h[2]=ue(B=>g.value=!0,["stop"])),class:"btn btn-primary new-button"},[...h[17]||(h[17]=[e("i",{class:"mdi mdi-plus"},null,-1),e("span",null,"New",-1)])]),e("div",dn,[e("button",{onClick:ue(a,["stop"]),class:K(["icon-button settings-button",{active:_.value}]),title:"Settings"},[...h[18]||(h[18]=[e("i",{class:"mdi mdi-cog"},null,-1)])],2),_.value?(o(),n("div",{key:0,class:"settings-dropdown",onClick:h[5]||(h[5]=ue(()=>{},["stop"]))},[e("button",{onClick:h[3]||(h[3]=B=>{Q(),_.value=!1}),class:"menu-item",disabled:R.value},[e("i",{class:K(["mdi",R.value?"mdi-loading mdi-spin":"mdi-refresh"])},null,2),e("span",null,u(R.value?"Syncing Areas...":"Sync Areas"),1)],8,un),e("button",{onClick:h[4]||(h[4]=B=>{me(),_.value=!1}),class:"menu-item",disabled:l.value},[e("i",{class:K(["mdi",l.value?"mdi-loading mdi-spin":"mdi-file-code"])},null,2),e("span",null,u(l.value?"Generating...":"Generate Entities"),1)],8,cn)])):T("",!0)])])]),z(e("div",mn,[be(tn,{ref_key:"discoveryRef",ref:O,onAdopt:le},null,512),Ce(c).hasDevices?(o(),n("div",vn,[e("div",pn,[e("button",{class:K(["filter-toggle-button",{active:Z.value||Se.value}]),onClick:h[6]||(h[6]=B=>Z.value=!Z.value),title:Z.value?"Hide filters":"Show filters"},[h[19]||(h[19]=e("i",{class:"mdi mdi-filter-variant"},null,-1)),Se.value?(o(),n("span",gn,u(Me.value),1)):T("",!0)],10,fn),e("div",yn,[h[20]||(h[20]=e("i",{class:"mdi mdi-magnify search-icon"},null,-1)),z(e("input",{"onUpdate:modelValue":h[7]||(h[7]=B=>N.value.search=B),type:"text",placeholder:"Search devices, commands...",class:"search-input"},null,512),[[xe,N.value.search]])])]),z(e("div",bn,[e("div",hn,[e("div",kn,[e("label",null,[h[22]||(h[22]=e("i",{class:"mdi mdi-access-point"},null,-1)),z(e("select",{"onUpdate:modelValue":h[8]||(h[8]=B=>N.value.broadlinkDevice=B)},[h[21]||(h[21]=e("option",{value:""},"All Controller Devices",-1)),(o(!0),n(fe,null,$e(M.value,B=>(o(),n("option",{key:B.entity_id,value:B.entity_id},u(B.friendly_name),9,wn))),128))],512),[[De,N.value.broadlinkDevice]])])]),e("div",$n,[e("label",null,[h[24]||(h[24]=e("i",{class:"mdi mdi-home-map-marker"},null,-1)),z(e("select",{"onUpdate:modelValue":h[9]||(h[9]=B=>N.value.area=B)},[h[23]||(h[23]=e("option",{value:""},"All Areas",-1)),(o(!0),n(fe,null,$e(ee.value,B=>(o(),n("option",{key:B,value:B},u(B),9,Cn))),128))],512),[[De,N.value.area]])])]),e("div",Sn,[e("label",null,[h[26]||(h[26]=e("i",{class:"mdi mdi-shape"},null,-1)),z(e("select",{"onUpdate:modelValue":h[10]||(h[10]=B=>N.value.entityType=B)},[...h[25]||(h[25]=[Pe('<option value="" data-v-1995c436>All Types</option><option value="light" data-v-1995c436>Light</option><option value="fan" data-v-1995c436>Fan</option><option value="switch" data-v-1995c436>Switch</option><option value="media_player" data-v-1995c436>Media Player</option><option value="cover" data-v-1995c436>Cover</option><option value="climate" data-v-1995c436>Climate</option>',7)])],512),[[De,N.value.entityType]])])]),X.value?(o(),n("div",_n,[e("label",Dn,[h[27]||(h[27]=e("span",{class:"toggle-text"},[e("img",{src:Ze,alt:"SmartIR",class:"smartir-icon"}),x(" SmartIR Only ")],-1)),z(e("input",{type:"checkbox","onUpdate:modelValue":h[11]||(h[11]=B=>N.value.showSmartIROnly=B),class:"toggle-checkbox"},null,512),[[ve,N.value.showSmartIROnly]]),h[28]||(h[28]=e("span",{class:"toggle-slider"},null,-1))])])):T("",!0),Se.value?(o(),n("button",{key:1,onClick:I,class:"btn-clear-filters"},[...h[29]||(h[29]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),x(" Clear ",-1)])])):T("",!0),e("div",In,u(we.value.length)+" of "+u(Ce(c).deviceCount),1)])],512),[[Je,Z.value]])])):T("",!0),Ce(c).loading?(o(),n("div",Tn,[...h[30]||(h[30]=[e("i",{class:"mdi mdi-loading mdi-spin"},null,-1),e("p",null,"Loading devices...",-1)])])):Ce(c).error?(o(),n("div",xn,[h[31]||(h[31]=e("i",{class:"mdi mdi-alert-circle"},null,-1)),e("p",null,u(Ce(c).error),1),e("button",{onClick:h[12]||(h[12]=B=>Ce(c).loadDevices()),class:"btn btn-secondary"}," Retry ")])):Ce(c).hasDevices?T("",!0):(o(),n("div",Mn,[h[33]||(h[33]=e("i",{class:"mdi mdi-devices"},null,-1)),h[34]||(h[34]=e("h3",null,"No Devices Yet",-1)),h[35]||(h[35]=e("p",null,"Get started by adding your first managed device",-1)),e("button",{onClick:h[13]||(h[13]=B=>g.value=!0),class:"btn btn-primary"},[...h[32]||(h[32]=[e("i",{class:"mdi mdi-plus"},null,-1),x(" Add Your First Device ",-1)])])])),P.value==="grid"?(o(),n("div",Rn,[(o(!0),n(fe,null,$e(we.value,B=>(o(),Oe(Vt,{key:B.id,device:B,"broadlink-devices":oe.value,onEdit:V,onDelete:ye,onLearn:f},null,8,["device","broadlink-devices"]))),128))])):P.value==="list"&&we.value.length>0?(o(),Oe(tl,{key:5,devices:we.value,onSendCommand:Te,onEditDevice:V,onDeleteDevice:ye},null,8,["devices"])):T("",!0),Ce(c).hasDevices&&we.value.length===0?(o(),n("div",Ln,[...h[36]||(h[36]=[e("i",{class:"mdi mdi-filter-off"},null,-1),e("h3",null,"No devices match your filters",-1),e("p",null,"Try adjusting your search or filter criteria",-1)])])):T("",!0)],512),[[Je,w.value]]),g.value?(o(),Oe(Mo,{key:0,device:r.value,onSave:Ee,onCancel:Y},null,8,["device"])):T("",!0),s.value?(o(),Oe(vs,{key:1,device:r.value,onLearned:i,onCancel:$},null,8,["device"])):T("",!0),be(Ue,{isOpen:p.value,title:`Delete ${(F=C.value)==null?void 0:F.name}?`,message:ge.value,confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,checkboxLabel:Ae.value,onConfirm:Re,onCancel:he},null,8,["isOpen","title","message","checkboxLabel"]),be(Ls,{isOpen:b.value,title:v.value.title,message:v.value.message,suggestion:v.value.suggestion,details:v.value.details,error:v.value.error,context:v.value.context,onClose:se},null,8,["isOpen","title","message","suggestion","details","error","context"]),be(Ue,{isOpen:E.value,title:H.value.title,message:H.value.message,confirmText:"OK",showCancel:!1,dangerMode:!H.value.success,onConfirm:L,onCancel:L},null,8,["isOpen","title","message","dangerMode"])])}}},En=ke(An,[["__scopeId","data-v-1995c436"]]),On={class:"banner-content"},Vn={class:"banner-icon"},Pn={class:"banner-message"},Un={class:"banner-actions"},Fn={__name:"SmartIRBanner",setup(t){const c=Ie("smartirStatus"),m=y(!1),k=J(()=>!(!c.value||m.value||localStorage.getItem("smartir_banner_dismissed")==="true")),g=J(()=>{var O;return(O=c.value)!=null&&O.installed?"banner-success":"banner-info"}),s=J(()=>{var O;return(O=c.value)!=null&&O.installed?"mdi mdi-check-circle":"mdi mdi-information"}),r=J(()=>{var O;return(O=c.value)!=null&&O.installed?`SmartIR Detected (v${c.value.version})`:"Want Climate Device Support?"}),p=J(()=>{var O;return(O=c.value)!=null&&O.installed?"You can now create climate device profiles with full temperature and HVAC mode control.":"Install SmartIR to unlock AC/heater control with temperature settings, HVAC modes, and 120+ pre-configured device profiles."});function _(){window.open("https://github.com/smartHomeHub/SmartIR","_blank")}function C(){var O;if(m.value=!0,(O=c.value)!=null&&O.installed)localStorage.setItem("smartir_banner_dismissed","true");else{const w=parseInt(localStorage.getItem("smartir_banner_dismiss_count")||"0");w>=2?localStorage.setItem("smartir_banner_dismissed","true"):localStorage.setItem("smartir_banner_dismiss_count",String(w+1))}}return Le(()=>{var l;const O=localStorage.getItem("smartir_last_status"),w=(l=c.value)!=null&&l.installed?"installed":"not_installed";O!==w&&(localStorage.removeItem("smartir_banner_dismissed"),localStorage.removeItem("smartir_banner_dismiss_count"),localStorage.setItem("smartir_last_status",w))}),(O,w)=>{var l,R;return k.value?(o(),n("div",{key:0,class:K(["smartir-banner",g.value])},[e("div",On,[e("div",Vn,[e("i",{class:K(s.value)},null,2)]),e("div",Pn,[e("strong",null,u(r.value),1),e("p",null,u(p.value),1)]),e("div",Un,[(l=O.status)!=null&&l.installed?T("",!0):(o(),n("button",{key:0,onClick:_,class:"btn-primary"}," Learn More ")),e("button",{onClick:C,class:"btn-text"},u((R=O.status)!=null&&R.installed?"Got it":"Dismiss"),1)])])],2)):T("",!0)}}},jn=ke(Fn,[["__scopeId","data-v-7bbcbcd7"]]),Fe="api/smartir",st={async getStatus(){try{const t=await fetch(`${Fe}/status`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return await t.json()}catch(t){return console.error("Error fetching SmartIR status:",t),{installed:!1,version:null,error:t.message}}},async getInstallInstructions(){try{const t=await fetch(`${Fe}/install-instructions`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return await t.json()}catch(t){throw console.error("Error fetching install instructions:",t),t}},async getPlatforms(){try{const t=await fetch(`${Fe}/platforms`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return await t.json()}catch(t){throw console.error("Error fetching platforms:",t),t}},async getPlatformCodes(t){try{const c=await fetch(`${Fe}/platforms/${t}/codes`);if(!c.ok)throw new Error(`HTTP error! status: ${c.status}`);return await c.json()}catch(c){throw console.error(`Error fetching codes for ${t}:`,c),c}},async getNextCode(t){try{const c=await fetch(`${Fe}/platforms/${t}/next-code`);if(!c.ok)throw new Error(`HTTP error! status: ${c.status}`);return await c.json()}catch(c){throw console.error(`Error fetching next code for ${t}:`,c),c}},async validateCode(t,c){try{const m=await fetch(`${Fe}/validate-code`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({platform:t,code:c})});if(!m.ok)throw new Error(`HTTP error! status: ${m.status}`);return await m.json()}catch(m){throw console.error("Error validating code:",m),m}}},Nn={class:"profile-card"},Bn={class:"profile-card-header"},Hn=["title"],qn={class:"profile-details"},zn=["title"],Jn={class:"profile-meta"},Wn=["title"],Kn=["title"],Xn=["title"],Gn={class:"profile-card-footer"},Yn=["title"],Zn={key:0,class:"learned-indicator"},Qn={class:"profile-actions"},ea={__name:"SmartIRProfileCard",props:{profile:{type:Object,required:!0}},emits:["edit","download","delete","commands"],setup(t){const c=t,m=ot(J(()=>c.profile.platform)),k=r=>r.replace(/_/g," ").replace(/\b\w/g,p=>p.toUpperCase()),g=r=>r&&r.startsWith("mdi:")?`mdi ${r.replace(":"," mdi-")}`:`mdi mdi-${r}`,s=r=>{if(!r)return"";const p=r.toLowerCase();return p.includes("broadlink")?"broadlink-tag":p.includes("not set")?"not-set-tag":"default-controller-tag"};return(r,p)=>(o(),n("div",Nn,[e("div",Bn,[e("div",{class:K(["profile-icon",Ce(m).colorClass.value]),title:k(t.profile.platform)},[e("i",{class:K(g(Ce(m).icon.value))},null,2)],10,Hn),e("div",qn,[e("h4",{title:`${t.profile.manufacturer} ${t.profile.model}`},u(t.profile.manufacturer)+" "+u(t.profile.model),9,zn),e("div",Jn,[e("span",{class:"tag platform-tag",title:k(t.profile.platform)},u(k(t.profile.platform)),9,Wn),t.profile.controllerBrand?(o(),n("span",{key:0,class:K(["tag controller-tag",s(t.profile.controllerBrand)]),title:"Controller: "+t.profile.controllerBrand},[p[4]||(p[4]=e("i",{class:"mdi mdi-remote-tv"},null,-1)),x(" "+u(t.profile.controllerBrand),1)],10,Kn)):T("",!0)])]),e("div",{class:"code-badge",title:"Device Code: "+t.profile.code},u(t.profile.code),9,Xn)]),e("div",Gn,[e("div",{class:"profile-stats",title:t.profile.commandCount+" total commands"+(t.profile.learnedCount>0?", "+t.profile.learnedCount+" learned":"")},[p[5]||(p[5]=e("i",{class:"mdi mdi-remote"},null,-1)),e("span",null,u(t.profile.commandCount)+" command"+u(t.profile.commandCount!==1?"s":""),1),t.profile.learnedCount>0?(o(),n("span",Zn,"( "+u(t.profile.learnedCount)+" learned )",1)):T("",!0)],8,Yn),e("div",Qn,[e("button",{onClick:p[0]||(p[0]=_=>r.$emit("commands")),class:"action-btn",title:"Commands"},[...p[6]||(p[6]=[e("i",{class:"mdi mdi-remote"},null,-1)])]),e("button",{onClick:p[1]||(p[1]=_=>r.$emit("edit")),class:"action-btn",title:"Edit Profile"},[...p[7]||(p[7]=[e("i",{class:"mdi mdi-pencil"},null,-1)])]),e("button",{onClick:p[2]||(p[2]=_=>r.$emit("download")),class:"action-btn",title:"Download JSON"},[...p[8]||(p[8]=[e("i",{class:"mdi mdi-download"},null,-1)])]),e("button",{onClick:p[3]||(p[3]=_=>r.$emit("delete")),class:"action-btn delete",title:"Delete Profile"},[...p[9]||(p[9]=[e("i",{class:"mdi mdi-delete"},null,-1)])])])])]))}},ta=ke(ea,[["__scopeId","data-v-aad9720f"]]),la={name:"SmartIRProfileListView",props:{profiles:{type:Array,required:!0}},methods:{getPlatformIcon(t){return{climate:"mdi-thermostat",media_player:"mdi-television",fan:"mdi-fan",light:"mdi-lightbulb"}[t]||"mdi-devices"},formatPlatform(t){return{climate:"Climate",media_player:"Media Player",fan:"Fan",light:"Light"}[t]||t},editProfile(t){this.$emit("edit",t)},viewCommands(t){this.$emit("commands",t)},downloadProfile(t){this.$emit("download",t)},deleteProfile(t){this.$emit("delete",t)}}},oa={class:"profile-list-view"},sa={class:"profile-table"},na={class:"profile-code"},aa={class:"code-badge"},ia={class:"profile-manufacturer"},ra={class:"profile-model"},da={class:"model-info"},ua={class:"model-name"},ca={key:0,class:"model-count"},ma={class:"profile-platform"},va={class:"profile-controller"},pa={class:"profile-commands"},fa={class:"command-stats"},ga={class:"stat-item"},ya={key:0,class:"stat-item learned"},ba={class:"profile-actions"},ha=["onClick"],ka=["onClick"],wa=["onClick"],$a=["onClick"];function Ca(t,c,m,k,g,s){return o(),n("div",oa,[e("table",sa,[c[6]||(c[6]=e("thead",null,[e("tr",null,[e("th",null,"Code"),e("th",null,"Manufacturer"),e("th",null,"Model"),e("th",null,"Platform"),e("th",null,"Controller"),e("th",null,"Commands"),e("th",null,"Actions")])],-1)),e("tbody",null,[(o(!0),n(fe,null,$e(m.profiles,r=>(o(),n("tr",{key:`${r.platform}-${r.code}`,class:"profile-row"},[e("td",na,[e("span",aa,u(r.code),1)]),e("td",ia,u(r.manufacturer||"Unknown"),1),e("td",ra,[e("div",da,[e("div",ua,u(r.model||"Unknown"),1),r.models&&r.models.length>1?(o(),n("div",ca," +"+u(r.models.length-1)+" more ",1)):T("",!0)])]),e("td",ma,[e("span",{class:K(["platform-badge",r.platform])},[e("i",{class:K(["mdi",s.getPlatformIcon(r.platform)])},null,2),x(" "+u(s.formatPlatform(r.platform)),1)],2)]),e("td",va,u(r.controller_brand||"N/A"),1),e("td",pa,[e("div",fa,[e("span",ga,[c[0]||(c[0]=e("i",{class:"mdi mdi-remote"},null,-1)),x(" "+u(r.command_count||0),1)]),r.learned_count>0?(o(),n("span",ya,[c[1]||(c[1]=e("i",{class:"mdi mdi-school"},null,-1)),x(" "+u(r.learned_count),1)])):T("",!0)])]),e("td",ba,[e("button",{class:"action-btn edit",onClick:p=>s.editProfile(r),title:"Edit Profile"},[...c[2]||(c[2]=[e("i",{class:"mdi mdi-pencil"},null,-1)])],8,ha),e("button",{class:"action-btn commands",onClick:p=>s.viewCommands(r),title:"View Commands"},[...c[3]||(c[3]=[e("i",{class:"mdi mdi-remote"},null,-1)])],8,ka),e("button",{class:"action-btn download",onClick:p=>s.downloadProfile(r),title:"Download"},[...c[4]||(c[4]=[e("i",{class:"mdi mdi-download"},null,-1)])],8,wa),e("button",{class:"action-btn delete",onClick:p=>s.deleteProfile(r),title:"Delete"},[...c[5]||(c[5]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,$a)])]))),128))])])])}const Sa=ke(la,[["render",Ca],["__scopeId","data-v-d3773038"]]),_a={class:"modal-container"},Da={class:"modal-body"},Ia={key:0,class:"selection-section"},Ta={class:"form-group"},xa={class:"form-group"},Ma={class:"form-group"},Ra={key:0,class:"code-info"},La={class:"form-actions"},Aa=["disabled"],Ea={key:1,class:"testing-section"},Oa={class:"code-header"},Va={class:"code-details"},Pa={class:"code-badge"},Ua={class:"device-selector"},Fa=["value"],ja={key:0,class:"helper-text"},Na={class:"commands-section"},Ba={class:"commands-header"},Ha={key:0,class:"tested-count"},qa={key:0,class:"filters-section"},za={class:"filter-row"},Ja={class:"filter-row"},Wa={key:1,class:"empty-state"},Ka={key:2,class:"empty-state"},Xa={key:3,class:"commands-list"},Ga={class:"command-name"},Ya={class:"command-actions"},Za={key:0,class:"status-badge success"},Qa=["onClick","disabled","title"],ei={__name:"SmartIRCodeTester",props:{isOpen:{type:Boolean,default:!1}},emits:["close","clone"],setup(t,{emit:c}){const m=t,k=c,g=Ie("toast"),s=y("climate"),r=y(""),p=y([]),_=y(!1),C=y(null),O=y(""),w=y([]),l=y(!1),R=J(()=>w.value.map(Y=>({code:Y.code,label:`${Y.models.join(", ")} (Code: ${Y.code})`,value:Y.code}))),W=y(null),P=y(null),D=y(!1),a=y([]),b=y(""),v=y([]),E=y(new Set),H=y(null),Z=y(""),N=y(""),oe=y(""),A=y(""),j=J(()=>{let Y=v.value;if(Z.value){const f=Z.value.toLowerCase();Y=Y.filter($=>($.label||$.name).toLowerCase().includes(f))}return N.value&&(Y=Y.filter(f=>f.mode===N.value)),oe.value&&(Y=Y.filter(f=>f.fanSpeed===oe.value)),A.value&&(Y=Y.filter(f=>f.swingMode===A.value)),Y}),X=J(()=>Z.value||N.value||oe.value||A.value);re(()=>m.isOpen,Y=>{Y&&(M(),we())}),re(s,()=>{m.isOpen&&(r.value="",C.value=null,w.value=[],M())});async function M(){var Y;_.value=!0;try{const f=await ne.get("/api/smartir/codes/manufacturers",{params:{entity_type:s.value}});p.value=f.data.manufacturers||[]}catch(f){console.error("Error loading manufacturers:",f),(Y=g.value)==null||Y.error("Failed to load manufacturers","❌ Error")}finally{_.value=!1}}async function ee(){var Y;if(r.value){l.value=!0;try{const f=await ne.get("/api/smartir/codes/models",{params:{entity_type:s.value,manufacturer:r.value}});w.value=f.data.models||[]}catch(f){console.error("Error loading models:",f),(Y=g.value)==null||Y.error("Failed to load models","❌ Error")}finally{l.value=!1}}}async function we(){try{const Y=await ne.get("/api/remote/devices");a.value=Y.data.devices||[]}catch(Y){console.error("Error loading Broadlink devices:",Y)}}async function Se(){var Y,f;if(C.value){D.value=!0;try{const $=await ne.get("/api/smartir/codes/code",{params:{entity_type:s.value,code_id:C.value.code}});P.value=$.data.code,W.value=C.value.code,Me($.data.code),(Y=g.value)==null||Y.success(`Loaded ${v.value.length} commands`,"✅ Code Loaded")}catch($){console.error("Error loading code:",$),(f=g.value)==null||f.error($.message||"Failed to load code","❌ Error")}finally{D.value=!1}}}function Me(Y){const f=[];if(!Y.commands){v.value=f;return}if(s.value==="climate"){const q=Y.commands;for(const[se,L]of Object.entries(q)){if(se==="off"){typeof L=="string"&&f.push({name:"off",label:"OFF",data:L,mode:"off"});continue}if(typeof L=="object"){for(const[i,U]of Object.entries(L))if(typeof U=="object")for(const[G,ae]of Object.entries(U)){if(typeof ae!="object")continue;const de=Object.keys(ae),le=de.includes("24")?"24":de[0];if(le&&typeof ae[le]=="string"){const Q=`${se}_${le}_${i}_${G}`,me=`${se.toUpperCase()} ${le}°C ${i} ${G}`;f.push({name:Q,label:me,data:ae[le],mode:se,temperature:le,fanSpeed:i,swingMode:G})}}}}}else for(const[q,se]of Object.entries(Y.commands))typeof se=="string"&&f.push({name:q,label:q.toUpperCase().replace(/_/g," "),data:se});v.value=f}async function I(Y){var f,$,q;if(!b.value){(f=g.value)==null||f.warning("Please select a Broadlink device first","⚠️ No Device");return}H.value=Y;try{const se=v.value.find(L=>L.name===Y);if(!se||!se.data)throw new Error(`Command "${Y}" not found`);await ne.post("/api/commands/send-raw",{entity_id:b.value,command:se.data,command_type:"ir"}),E.value.add(Y),($=g.value)==null||$.success(`Command sent: ${se.label||Y}`,"✅ Tested")}catch(se){console.error("Error testing command:",se),(q=g.value)==null||q.error("Failed to test command","❌ Error")}finally{H.value=null}}function d(){var Y,f,$,q;if(!P.value){(Y=g.value)==null||Y.error("No profile data to download","❌ Error");return}try{const se=P.value.manufacturer||"unknown",L=((f=P.value.supportedModels)==null?void 0:f[0])||W.value,i=`${se.toLowerCase().replace(/\s+/g,"_")}_${L.toLowerCase().replace(/\s+/g,"_")}.json`,U=JSON.stringify(P.value,null,2),G=new Blob([U],{type:"application/json"}),ae=URL.createObjectURL(G),de=document.createElement("a");de.href=ae,de.download=i,document.body.appendChild(de),de.click(),document.body.removeChild(de),URL.revokeObjectURL(ae),($=g.value)==null||$.success(`Downloaded ${i}`,"✅ Download Complete")}catch(se){console.error("Error downloading JSON:",se),(q=g.value)==null||q.error(se.message||"Failed to download JSON","❌ Download Error")}}function V(){r.value="",C.value=null,O.value="",w.value=[]}function ge(){C.value=null,O.value="",ee()}function Ae(){O.value?C.value=w.value.find(Y=>Y.code===O.value):C.value=null}function ye(){Z.value="",N.value="",oe.value="",A.value=""}function he(){W.value=null,P.value=null,v.value=[],E.value.clear(),H.value=null,ye()}function Re(Y){const f=Y.toLowerCase();return f.includes("power")||f.includes("off")||f==="off"?"mdi-power":f.includes("cool")?"mdi-snowflake":f.includes("heat")?"mdi-fire":f.includes("fan")?"mdi-fan":f.includes("auto")?"mdi-auto-fix":f.includes("dry")?"mdi-water-percent":f.includes("temp")?"mdi-thermometer":f.includes("swing")?"mdi-swap-vertical":"mdi-remote"}function Ee(){he(),r.value="",C.value=null,k("close")}return(Y,f)=>{var $;return t.isOpen?(o(),n("div",{key:0,class:"modal-overlay",onClick:ue(Ee,["self"])},[e("div",_a,[e("div",{class:"modal-header"},[f[9]||(f[9]=e("h3",null,[e("i",{class:"mdi mdi-test-tube"}),x(" Test SmartIR Code ")],-1)),e("button",{onClick:Ee,class:"close-btn"},[...f[8]||(f[8]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Da,[W.value?(o(),n("div",Ea,[e("div",Oa,[e("div",Va,[e("h4",null,u(P.value.manufacturer)+" - "+u((($=P.value.supportedModels)==null?void 0:$[0])||"Unknown"),1),e("span",Pa,"Code: "+u(W.value),1)]),e("button",{onClick:he,class:"btn-secondary-small"},[...f[14]||(f[14]=[e("i",{class:"mdi mdi-arrow-left"},null,-1),x(" Change Code ",-1)])])]),e("div",Ua,[f[17]||(f[17]=e("label",null,[e("i",{class:"mdi mdi-remote"}),x(" Broadlink Device ")],-1)),z(e("select",{"onUpdate:modelValue":f[3]||(f[3]=q=>b.value=q),class:"form-select"},[f[15]||(f[15]=e("option",{value:""},"Select device to test with...",-1)),(o(!0),n(fe,null,$e(a.value,q=>(o(),n("option",{key:q.entity_id,value:q.entity_id},u(q.friendly_name||q.entity_id),9,Fa))),128))],512),[[De,b.value]]),b.value?T("",!0):(o(),n("p",ja,[...f[16]||(f[16]=[e("i",{class:"mdi mdi-information-outline"},null,-1),x(" Select a Broadlink device to enable command testing ",-1)])]))]),e("div",Na,[e("div",Ba,[e("h5",null,"Sample Commands ("+u(j.value.length)+" / "+u(v.value.length)+")",1),E.value.size>0?(o(),n("span",Ha,u(E.value.size)+" tested ",1)):T("",!0)]),s.value==="climate"&&v.value.length>0?(o(),n("div",qa,[e("div",za,[z(e("input",{"onUpdate:modelValue":f[4]||(f[4]=q=>Z.value=q),type:"text",placeholder:"Search commands...",class:"search-input"},null,512),[[xe,Z.value]])]),e("div",Ja,[z(e("select",{"onUpdate:modelValue":f[5]||(f[5]=q=>N.value=q),class:"filter-select"},[...f[18]||(f[18]=[e("option",{value:""},"All Modes",-1),e("option",{value:"cool"},"Cool",-1),e("option",{value:"heat"},"Heat",-1),e("option",{value:"off"},"Off",-1)])],512),[[De,N.value]]),z(e("select",{"onUpdate:modelValue":f[6]||(f[6]=q=>oe.value=q),class:"filter-select"},[...f[19]||(f[19]=[Pe('<option value="" data-v-66569200>All Fan Speeds</option><option value="low" data-v-66569200>Low</option><option value="mid" data-v-66569200>Mid</option><option value="high" data-v-66569200>High</option><option value="auto" data-v-66569200>Auto</option>',5)])],512),[[De,oe.value]]),z(e("select",{"onUpdate:modelValue":f[7]||(f[7]=q=>A.value=q),class:"filter-select"},[...f[20]||(f[20]=[e("option",{value:""},"All Swing",-1),e("option",{value:"stop"},"Stop",-1),e("option",{value:"swing"},"Swing",-1)])],512),[[De,A.value]]),X.value?(o(),n("button",{key:0,onClick:ye,class:"btn-clear-filters"},[...f[21]||(f[21]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),x(" Clear ",-1)])])):T("",!0)])])):T("",!0),v.value.length===0?(o(),n("div",Wa,[...f[22]||(f[22]=[e("i",{class:"mdi mdi-alert-circle"},null,-1),e("p",null,"No commands found in this code",-1)])])):j.value.length===0?(o(),n("div",Ka,[f[23]||(f[23]=e("i",{class:"mdi mdi-filter-off"},null,-1)),f[24]||(f[24]=e("p",null,"No commands match your filters",-1)),e("button",{onClick:ye,class:"btn-secondary-small"}," Clear Filters ")])):(o(),n("div",Xa,[(o(!0),n(fe,null,$e(j.value,q=>(o(),n("div",{key:q.name,class:K(["command-item",{tested:E.value.has(q.name),testing:H.value===q.name}])},[e("div",Ga,[e("i",{class:K(["mdi",Re(q.mode||q.name)])},null,2),e("span",null,u(q.label||q.name),1)]),e("div",Ya,[E.value.has(q.name)?(o(),n("span",Za,[...f[25]||(f[25]=[e("i",{class:"mdi mdi-check"},null,-1),x(" Tested ",-1)])])):T("",!0),e("button",{onClick:se=>I(q.name),disabled:!b.value||H.value===q.name,title:b.value?"Test this command":"Select a Broadlink device first",class:"btn-test"},[e("i",{class:K(["mdi",H.value===q.name?"mdi-loading mdi-spin":"mdi-play"])},null,2),f[26]||(f[26]=x(" Test ",-1))],8,Qa)])],2))),128))]))]),e("div",{class:"modal-actions"},[e("button",{onClick:d,class:"btn-primary"},[...f[27]||(f[27]=[e("i",{class:"mdi mdi-download"},null,-1),x(" Download JSON ",-1)])]),e("button",{onClick:Ee,class:"btn-secondary"}," Close ")])])):(o(),n("div",Ia,[f[13]||(f[13]=e("div",{class:"info-banner"},[e("i",{class:"mdi mdi-information"}),e("p",null,"Select a SmartIR code from the index to test commands with your Broadlink device.")],-1)),e("div",Ta,[f[11]||(f[11]=e("label",null,[e("i",{class:"mdi mdi-shape"}),x(" Platform ")],-1)),z(e("select",{"onUpdate:modelValue":f[0]||(f[0]=q=>s.value=q),onChange:V,class:"form-select"},[...f[10]||(f[10]=[e("option",{value:"climate"},"Climate (AC/Heater)",-1),e("option",{value:"media_player"},"Media Player (TV/Audio)",-1),e("option",{value:"fan"},"Fan",-1),e("option",{value:"light"},"Light",-1)])],544),[[De,s.value]])]),e("div",xa,[be(We,{modelValue:r.value,"onUpdate:modelValue":f[1]||(f[1]=q=>r.value=q),options:p.value,label:"Manufacturer",placeholder:"Search manufacturers...",loading:_.value,disabled:_.value,onChange:ge},null,8,["modelValue","options","loading","disabled"])]),e("div",Ma,[be(We,{modelValue:O.value,"onUpdate:modelValue":f[2]||(f[2]=q=>O.value=q),options:R.value,"option-label":"label","option-value":"code",label:"Model",placeholder:"Search models...",loading:l.value,disabled:!r.value||l.value,onChange:Ae},null,8,["modelValue","options","loading","disabled"])]),C.value?(o(),n("div",Ra,[f[12]||(f[12]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[e("strong",null,u(r.value)+" - "+u(C.value.models[0]),1),e("p",null,"Code: "+u(C.value.code),1)])])):T("",!0),e("div",La,[e("button",{onClick:Se,disabled:!C.value||D.value,class:"btn-primary"},[e("i",{class:K(["mdi",D.value?"mdi-loading mdi-spin":"mdi-download"])},null,2),x(" "+u(D.value?"Loading...":"Load Commands"),1)],8,Aa)])]))])])])):T("",!0)}}},ti=ke(ei,[["__scopeId","data-v-66569200"]]),li={class:"smartir-status-card"},oi={class:"card-header"},si=["src"],ni={class:"header-badges"},ai=["title"],ii={class:"header-info"},ri={class:"header-info"},di={class:"header-info"},ui={class:"header-right"},ci={key:0,class:"view-toggle-group header-view-toggle"},mi={key:2,class:"settings-menu-container"},vi={key:0,class:"card-body loading-state"},pi={key:1,class:"card-body error-state"},fi={key:2,class:"card-body installed-state"},gi={key:0,class:"help-panel"},yi={key:0,class:"recommendation"},bi={key:0,class:"next-steps"},hi={class:"help-actions"},ki={key:1,class:"filter-bar"},wi={class:"filter-search-row"},$i=["title"],Ci={key:0,class:"filter-badge"},Si={class:"search-input-wrapper"},_i={class:"filter-content"},Di={class:"filter-row"},Ii={class:"filter-group"},Ti={class:"filter-results"},xi={key:2,class:"loading-state"},Mi={key:3,class:"empty-state"},Ri={key:4,class:"profiles-grid"},Li={key:6,class:"no-results"},Ai={key:3,class:"card-body not-installed-state"},Ei={class:"benefits-section"},Oi={class:"benefits-list"},Vi={class:"recommendation"},Pi={__name:"SmartIRStatusCard",emits:["create-profile","edit-profile"],setup(t,{expose:c,emit:m}){const k=m,g=Ie("smartirStatus");Ie("smartirEnabled");const s=Ie("refreshSmartIR"),{isMobile:r}=Ye(),p=y(!1),_=y(null),C=y((g==null?void 0:g.value)||null),O=y(localStorage.getItem("smartir_simulate_not_installed")==="true"),w=y(!1),l=y(!1),R=y(!0),W=y([]),P=y(!1),D=y(!1),a=y({search:"",platform:""}),b=y({show:!1,title:"",message:"",platform:null,profile:null}),v=y(!1),H=y(window.innerWidth<=767?"grid":localStorage.getItem("profile_view_mode")||"grid");re(r,f=>{f&&H.value==="list"&&(H.value="grid")}),re(H,f=>{localStorage.setItem("profile_view_mode",f)}),re(R,f=>{f||(l.value=!1)});const Z=["Full climate entity support (AC, heaters)","120+ pre-configured device profiles","Temperature and humidity sensor integration","HVAC mode control (heat, cool, auto, dry, fan)"],N=["climate","media_player","fan","light"],oe=J(()=>O.value?{installed:!1,recommendation:{message:"Install SmartIR to unlock climate device support!",benefits:["Full climate entity support (AC, heaters)","120+ pre-configured device profiles","Temperature and humidity sensor integration","HVAC mode control (heat, cool, auto, dry, fan)"]}}:C.value),A=J(()=>{var f,$;return(($=(f=oe.value)==null?void 0:f.platforms)==null?void 0:$.length)||0}),j=J(()=>{var f;return(f=oe.value)!=null&&f.device_counts?Object.values(oe.value.device_counts).reduce(($,q)=>$+q,0):0});function X(){var f;O.value=!O.value,localStorage.setItem("smartir_simulate_not_installed",O.value.toString()),!O.value&&((f=C.value)!=null&&f.installed)&&ye()}const M=J(()=>{let f=W.value;if(a.value.search){const $=a.value.search.toLowerCase();f=f.filter(q=>{var se,L,i,U;return((se=q.manufacturer)==null?void 0:se.toLowerCase().includes($))||((L=q.model)==null?void 0:L.toLowerCase().includes($))||((i=q.code)==null?void 0:i.toString().includes($))||((U=q.platform)==null?void 0:U.toLowerCase().includes($))})}return a.value.platform&&(f=f.filter($=>$.platform===a.value.platform)),f}),ee=J(()=>a.value.search||a.value.platform),we=J(()=>{let f=0;return a.value.search&&f++,a.value.platform&&f++,f});function Se(){a.value.search="",a.value.platform=""}async function Me(){p.value=!0,_.value=null;try{if(s)await s();else{const f=await st.getStatus();C.value=f}}catch(f){_.value=f.message||"Failed to refresh SmartIR status",console.error("Error refreshing SmartIR status:",f)}finally{p.value=!1}}function I(){k("create-profile")}function d(){w.value=!w.value,l.value=!1}function V(){R.value||(R.value=!0),l.value=!l.value}function ge(){v.value=!0,l.value=!1}function Ae(){window.open("https://github.com/smartHomeHub/SmartIR","_blank")}async function ye(){P.value=!0;const f=[];try{for(const $ of N)try{const se=((await ne.get(`/api/smartir/platforms/${$}/profiles`)).data.profiles||[]).map(L=>({...L,platform:$}));f.push(...se)}catch(q){console.warn(`Network error loading ${$} profiles (using bundled index):`,q.message)}W.value=f}catch($){console.error("Unexpected error loading profiles:",$)}finally{P.value=!1}}function he(f,$,q){k("edit-profile",{platform:f,profile:$,startStep:q})}async function Re(f,$){var q,se;try{const i=(await ne.get(`/api/smartir/platforms/${f}/profiles/${$.code}`)).data,U=JSON.stringify(i.profile,null,2),G=new Blob([U],{type:"application/json"}),ae=URL.createObjectURL(G),de=document.createElement("a");de.href=ae,de.download=`smartir_${f}_${$.manufacturer}_${$.model}_${$.code}.json`,document.body.appendChild(de),de.click(),document.body.removeChild(de),URL.revokeObjectURL(ae),(q=Ie("toast").value)==null||q.success(`Downloaded ${$.manufacturer} ${$.model}`,"✅ Profile Downloaded")}catch(L){console.error("Error downloading profile:",L),(se=Ie("toast").value)==null||se.error("Failed to download profile","❌ Download Error")}}async function Ee(f,$){Ie("toast");try{const se=(await ne.post(`/api/smartir/profiles/${$.code}/check-usage`,{platform:f})).data;if(se&&se.in_use){b.value={show:!0,title:`Cannot Delete ${$.manufacturer} ${$.model}`,message:`This profile is currently in use by ${se.device_count} device(s):

${se.devices.join(`
`)}

Please remove or reassign these devices before deleting the profile.`,platform:f,profile:$,canDelete:!1,devices:se.devices};return}}catch(q){console.error("Error checking profile usage:",q)}b.value={show:!0,title:`Delete ${$.manufacturer} ${$.model}?`,message:`Device Code: ${$.code}

This will remove the profile and update your configuration.`,platform:f,profile:$,canDelete:!0}}async function Y(){var se,L;const f=Ie("toast"),{platform:$,profile:q}=b.value;b.value.show=!1;try{await ne.delete(`/api/smartir/profiles/${q.code}`,{data:{platform:$}}),await ye(),await rt(),await Me(),(se=f.value)==null||se.success(`${q.manufacturer} ${q.model} has been removed`,"✅ Profile Deleted")}catch(i){console.error("Error deleting profile:",i),(L=f.value)==null||L.error("Failed to delete profile","❌ Delete Error")}}return re(g,f=>{f&&(C.value=f)},{immediate:!0}),re(H,f=>{localStorage.setItem("profile_view_mode",f)}),Le(async()=>{var f;g!=null&&g.value&&(C.value=g.value),C.value||await Me(),(f=C.value)!=null&&f.installed&&await ye()}),c({loadAllProfiles:ye,refreshStatus:Me}),(f,$)=>{var q,se,L,i,U,G,ae,de,le;return o(),n("div",li,[e("div",oi,[e("button",{class:"icon-button chevron-button",onClick:$[0]||($[0]=Q=>R.value=!R.value)},[e("i",{class:K(["mdi",R.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2)]),e("div",{class:"header-left",onClick:$[1]||($[1]=Q=>R.value=!R.value)},[e("img",{src:Ce(Ze),alt:"SmartIR",class:"smartir-logo"},null,8,si),e("h3",null,u(Ce(r)?"SmartIR":"SmartIR Integration"),1),e("div",ni,[e("div",{class:K(["simulation-toggle-pill",{active:O.value}]),onClick:ue(X,["stop"]),title:O.value?"Click to show as installed":"Click to simulate not-installed"},[e("i",{class:K(["mdi",O.value?"mdi-eye-off":"mdi-eye"])},null,2),e("span",null,u(O.value?"Simulating: Not Installed":"Simulation Mode"),1)],10,ai),(q=oe.value)!=null&&q.installed?(o(),n(fe,{key:0},[$[16]||($[16]=e("div",{class:"status-badge-mini success"},[e("i",{class:"mdi mdi-check-circle"}),e("span",null,"Installed")],-1)),e("span",ii,"v"+u(oe.value.version||"Unknown"),1),e("span",ri,u(A.value)+" platform"+u(A.value!==1?"s":""),1),e("span",di,u(j.value)+" device"+u(j.value!==1?"s":""),1)],64)):T("",!0)])]),e("div",ui,[!Ce(r)&&((se=oe.value)!=null&&se.installed)?(o(),n("div",ci,[e("button",{onClick:$[2]||($[2]=ue(Q=>H.value="grid",["stop"])),class:K(["view-toggle-btn",{active:H.value==="grid"}]),title:"Grid View"},[...$[17]||($[17]=[e("i",{class:"mdi mdi-view-grid"},null,-1)])],2),e("button",{onClick:$[3]||($[3]=ue(Q=>H.value="list",["stop"])),class:K(["view-toggle-btn",{active:H.value==="list"}]),title:"List View"},[...$[18]||($[18]=[e("i",{class:"mdi mdi-view-list"},null,-1)])],2)])):T("",!0),(L=oe.value)!=null&&L.installed?(o(),n("button",{key:1,onClick:ue(I,["stop"]),class:"btn btn-primary new-button"},[...$[19]||($[19]=[e("i",{class:"mdi mdi-plus"},null,-1),e("span",null,"New",-1)])])):T("",!0),(i=oe.value)!=null&&i.installed?(o(),n("div",mi,[e("button",{onClick:ue(V,["stop"]),class:K(["icon-button settings-button",{active:l.value}]),title:"Settings"},[...$[20]||($[20]=[e("i",{class:"mdi mdi-cog"},null,-1)])],2),l.value?(o(),n("div",{key:0,class:"settings-dropdown",onClick:$[5]||($[5]=ue(()=>{},["stop"]))},[e("button",{onClick:d,class:"menu-item"},[$[21]||($[21]=e("i",{class:"mdi mdi-help-circle"},null,-1)),e("span",null,u(w.value?"Hide Help":"Show Help"),1)]),e("button",{onClick:$[4]||($[4]=Q=>{l.value=!1,Me()}),class:"menu-item"},[...$[22]||($[22]=[e("i",{class:"mdi mdi-refresh"},null,-1),e("span",null,"Refresh Status",-1)])]),e("button",{onClick:ge,class:"menu-item"},[...$[23]||($[23]=[e("i",{class:"mdi mdi-test-tube"},null,-1),e("span",null,"Test Codes",-1)])])])):T("",!0)])):T("",!0)])]),z(e("div",null,[p.value?(o(),n("div",vi,[...$[24]||($[24]=[e("div",{class:"spinner"},null,-1),e("p",null,"Checking SmartIR installation...",-1)])])):_.value?(o(),n("div",pi,[$[25]||($[25]=e("i",{class:"mdi mdi-alert-circle"},null,-1)),e("p",null,u(_.value),1),e("button",{onClick:Me,class:"btn-secondary"}," Try Again ")])):(U=oe.value)!=null&&U.installed?(o(),n("div",fi,[w.value?(o(),n("div",gi,[C.value.recommendation?(o(),n("div",yi,[e("p",null,u(C.value.recommendation.message),1),C.value.recommendation.next_steps?(o(),n("div",bi,[$[26]||($[26]=e("strong",null,"Next Steps:",-1)),e("ul",null,[(o(!0),n(fe,null,$e(C.value.recommendation.next_steps,(Q,me)=>(o(),n("li",{key:me},u(Q),1))),128))])])):T("",!0)])):T("",!0),e("div",hi,[e("button",{onClick:$[6]||($[6]=(...Q)=>f.viewDocumentation&&f.viewDocumentation(...Q)),class:"btn-secondary"},[...$[27]||($[27]=[e("i",{class:"mdi mdi-book-open-variant"},null,-1),x(" View Documentation ",-1)])])])])):T("",!0),W.value.length>0&&!O.value?(o(),n("div",ki,[e("div",wi,[e("button",{class:K(["filter-toggle-button",{active:D.value||ee.value}]),onClick:$[7]||($[7]=Q=>D.value=!D.value),title:D.value?"Hide filters":"Show filters"},[$[28]||($[28]=e("i",{class:"mdi mdi-filter-variant"},null,-1)),ee.value?(o(),n("span",Ci,u(we.value),1)):T("",!0)],10,$i),e("div",Si,[$[29]||($[29]=e("i",{class:"mdi mdi-magnify search-icon"},null,-1)),z(e("input",{"onUpdate:modelValue":$[8]||($[8]=Q=>a.value.search=Q),type:"text",placeholder:"Search profiles...",class:"search-input"},null,512),[[xe,a.value.search]])])]),z(e("div",_i,[e("div",Di,[e("div",Ii,[e("label",null,[$[31]||($[31]=e("i",{class:"mdi mdi-shape"},null,-1)),z(e("select",{"onUpdate:modelValue":$[9]||($[9]=Q=>a.value.platform=Q)},[...$[30]||($[30]=[Pe('<option value="" data-v-4ef33ace>All Platforms</option><option value="climate" data-v-4ef33ace>Climate</option><option value="media_player" data-v-4ef33ace>Media Player</option><option value="fan" data-v-4ef33ace>Fan</option><option value="light" data-v-4ef33ace>Light</option>',5)])],512),[[De,a.value.platform]])])]),ee.value?(o(),n("button",{key:0,onClick:Se,class:"btn-clear-filters"},[...$[32]||($[32]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),x(" Clear ",-1)])])):T("",!0),e("div",Ti,u(M.value.length)+" of "+u(W.value.length),1)])],512),[[Je,D.value]])])):T("",!0),P.value?(o(),n("div",xi,[...$[33]||($[33]=[e("i",{class:"mdi mdi-loading mdi-spin"},null,-1),e("p",null,"Loading profiles...",-1)])])):W.value.length===0?(o(),n("div",Mi,[...$[34]||($[34]=[e("i",{class:"mdi mdi-file-document-outline"},null,-1),e("h3",null,"No Profiles Yet",-1),e("p",null,"Create your first SmartIR profile to get started",-1)])])):T("",!0),H.value==="grid"&&!O.value?(o(),n("div",Ri,[(o(!0),n(fe,null,$e(M.value,Q=>(o(),Oe(ta,{key:`${Q.platform}-${Q.code}`,profile:Q,onEdit:me=>he(Q.platform,Q),onCommands:me=>he(Q.platform,Q,2),onDownload:me=>Re(Q.platform,Q),onDelete:me=>Ee(Q.platform,Q)},null,8,["profile","onEdit","onCommands","onDownload","onDelete"]))),128))])):H.value==="list"&&!O.value&&M.value.length>0?(o(),Oe(Sa,{key:5,profiles:M.value,onEdit:$[10]||($[10]=Q=>he(Q.platform,Q)),onCommands:$[11]||($[11]=Q=>he(Q.platform,Q,2)),onDownload:$[12]||($[12]=Q=>Re(Q.platform,Q)),onDelete:$[13]||($[13]=Q=>Ee(Q.platform,Q))},null,8,["profiles"])):T("",!0),W.value.length>0&&M.value.length===0&&!O.value?(o(),n("div",Li,[...$[35]||($[35]=[e("i",{class:"mdi mdi-filter-off"},null,-1),e("h3",null,"No profiles match your filters",-1),e("p",null,"Try adjusting your search or filter criteria",-1)])])):T("",!0)])):(o(),n("div",Ai,[$[39]||($[39]=e("div",{class:"status-badge warning"},[e("i",{class:"mdi mdi-information"}),e("span",null,"Not Installed")],-1)),e("div",Ei,[$[37]||($[37]=e("h4",null,"Why Install SmartIR?",-1)),e("ul",Oi,[(o(!0),n(fe,null,$e(((ae=(G=C.value)==null?void 0:G.recommendation)==null?void 0:ae.benefits)||Z,(Q,me)=>(o(),n("li",{key:me},[$[36]||($[36]=e("i",{class:"mdi mdi-check"},null,-1)),e("span",null,u(Q),1)]))),128))])]),e("div",Vi,[e("p",null,u(((le=(de=C.value)==null?void 0:de.recommendation)==null?void 0:le.message)||"Install SmartIR to unlock climate device support!"),1)]),e("div",{class:"card-actions"},[e("button",{onClick:Ae,class:"btn-primary"},[...$[38]||($[38]=[e("i",{class:"mdi mdi-github"},null,-1),x(" Install SmartIR ",-1)])])])]))],512),[[Je,R.value]]),be(Ue,{isOpen:b.value.show,title:b.value.title,message:b.value.message,confirmText:b.value.canDelete===!1?null:"Delete",cancelText:"Close",dangerMode:!0,confirmDisabled:b.value.canDelete===!1,onConfirm:Y,onCancel:$[14]||($[14]=Q=>b.value.show=!1)},null,8,["isOpen","title","message","confirmText","confirmDisabled"]),be(ti,{isOpen:v.value,onClose:$[15]||($[15]=Q=>v.value=!1)},null,8,["isOpen"])])}}},Ui=ke(Pi,[["__scopeId","data-v-4ef33ace"]]),Fi={class:"climate-form"},ji={class:"learning-mode-section"},Ni={class:"mode-toggle"},Bi={class:"mode-content"},Hi={class:"mode-stats"},qi={class:"stat-badge"},zi={class:"stat-badge time"},Ji={class:"mode-content"},Wi={class:"mode-stats"},Ki={class:"stat-badge"},Xi={class:"stat-badge time warning"},Gi={key:0,class:"command-breakdown"},Yi={class:"warning-text"},Zi={class:"form-section"},Qi={key:0,class:"help-text"},er={key:1,class:"help-text"},tr={class:"form-row"},lr={class:"form-group"},or={class:"form-group"},sr={class:"form-group"},nr={key:2,class:"representative-temp-section"},ar={class:"form-group"},ir=["value"],rr={class:"form-section"},dr={class:"checkbox-grid"},ur={class:"checkbox-item"},cr={class:"checkbox-item"},mr={class:"checkbox-item"},vr={class:"checkbox-item"},pr={class:"checkbox-item"},fr={class:"checkbox-item"},gr={class:"form-section"},yr={class:"checkbox-grid"},br={class:"checkbox-item"},hr={class:"checkbox-item"},kr={class:"checkbox-item"},wr={class:"checkbox-item"},$r={class:"form-section"},Cr={class:"checkbox-grid"},Sr={class:"checkbox-item"},_r={class:"checkbox-item"},Dr={class:"checkbox-item"},Ir={class:"checkbox-item"},Tr={class:"form-section"},xr={class:"form-group"},Mr={class:"form-group"},Rr={class:"form-group"},Lr={key:0,class:"validation-summary"},Ar={__name:"ClimateProfileForm",props:{modelValue:{type:Object,default:()=>({})}},emits:["update:modelValue"],setup(t,{emit:c}){const m=t,k=c,g=y("quick"),s=y({minTemp:16,maxTemp:30,precision:1,representativeTemp:24,modes:["off","auto","cool","heat"],fanModes:["auto","low","medium","high"],swingModes:[],tempSensor:"",humiditySensor:"",powerSensor:"",learningMode:"quick",...m.modelValue}),r=J(()=>{const D=[],a=s.value.minTemp||16,b=s.value.maxTemp||30,v=s.value.precision||1;for(let E=a;E<=b;E+=v)D.push(E);return D}),p=J(()=>s.value.modes.filter(D=>D!=="off").length),_=J(()=>s.value.fanModes.length||1),C=J(()=>s.value.swingModes.length||1),O=J(()=>{const D=s.value.minTemp||16,a=s.value.maxTemp||30,b=s.value.precision||1;return Math.floor((a-D)/b)+1}),w=J(()=>{const D=s.value.modes.includes("off")?1:0;return p.value*_.value*C.value+D}),l=J(()=>Math.ceil(w.value*30/60)),R=J(()=>{const D=s.value.modes.includes("off")?1:0;return p.value*O.value*_.value*C.value+D}),W=J(()=>Math.ceil(R.value*30/60)),P=J(()=>{const D=[];return(!s.value.minTemp||s.value.minTemp<10||s.value.minTemp>35)&&D.push("Minimum temperature must be between 10°C and 35°C"),(!s.value.maxTemp||s.value.maxTemp<10||s.value.maxTemp>35)&&D.push("Maximum temperature must be between 10°C and 35°C"),s.value.minTemp>=s.value.maxTemp&&D.push("Minimum temperature must be less than maximum temperature"),(!s.value.modes||s.value.modes.length===0)&&D.push("At least one HVAC mode must be selected"),D});return re(g,D=>{s.value.learningMode=D}),re(s,D=>{k("update:modelValue",D)},{deep:!0,immediate:!0}),(D,a)=>(o(),n("div",Fi,[a[63]||(a[63]=e("h3",null,"Climate Device Configuration",-1)),e("div",ji,[e("div",Ni,[e("label",{class:K(["mode-option",{active:g.value==="quick"}])},[z(e("input",{type:"radio",value:"quick","onUpdate:modelValue":a[0]||(a[0]=b=>g.value=b)},null,512),[[ze,g.value]]),e("div",Bi,[a[23]||(a[23]=e("div",{class:"mode-header"},[e("i",{class:"mdi mdi-flash"}),e("strong",null,"Quick Mode (Recommended)")],-1)),a[24]||(a[24]=e("p",null,"Learn one temperature per mode combination",-1)),e("div",Hi,[e("span",qi,u(w.value)+" commands",1),e("span",zi,"~"+u(l.value)+" min",1)])])],2),e("label",{class:K(["mode-option",{active:g.value==="complete"}])},[z(e("input",{type:"radio",value:"complete","onUpdate:modelValue":a[1]||(a[1]=b=>g.value=b)},null,512),[[ze,g.value]]),e("div",Ji,[a[25]||(a[25]=e("div",{class:"mode-header"},[e("i",{class:"mdi mdi-check-all"}),e("strong",null,"Complete Mode")],-1)),a[26]||(a[26]=e("p",null,"Learn all temperature combinations",-1)),e("div",Wi,[e("span",Ki,u(R.value)+" commands",1),e("span",Xi,"~"+u(W.value)+" min",1)])])],2)]),g.value==="complete"?(o(),n("div",Gi,[a[27]||(a[27]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[e("strong",null,"Complete mode will require learning "+u(R.value)+" commands",1),e("p",null,"This includes all combinations of modes ("+u(p.value)+"), temperatures ("+u(O.value)+"), fan speeds ("+u(_.value)+"), and swing modes ("+u(C.value)+").",1),e("p",Yi,"⏱️ Estimated time: "+u(W.value)+" minutes at ~30 seconds per command",1)])])):T("",!0)]),e("div",Zi,[a[33]||(a[33]=e("h4",null,"Temperature Range",-1)),g.value==="quick"?(o(),n("p",Qi," Define the full temperature range your device supports. You'll select one temperature to learn below. ")):(o(),n("p",er," Define the temperature range. All temperatures in this range will be learned. ")),e("div",tr,[e("div",lr,[a[28]||(a[28]=e("label",null,"Minimum Temperature (°C) *",-1)),z(e("input",{"onUpdate:modelValue":a[2]||(a[2]=b=>s.value.minTemp=b),type:"number",min:"10",max:"35",placeholder:"16"},null,512),[[xe,s.value.minTemp,void 0,{number:!0}]])]),e("div",or,[a[29]||(a[29]=e("label",null,"Maximum Temperature (°C) *",-1)),z(e("input",{"onUpdate:modelValue":a[3]||(a[3]=b=>s.value.maxTemp=b),type:"number",min:"10",max:"35",placeholder:"30"},null,512),[[xe,s.value.maxTemp,void 0,{number:!0}]])]),e("div",sr,[a[31]||(a[31]=e("label",null,"Precision",-1)),z(e("select",{"onUpdate:modelValue":a[4]||(a[4]=b=>s.value.precision=b)},[...a[30]||(a[30]=[e("option",{value:1},"1°C (Whole degrees)",-1),e("option",{value:.5},"0.5°C (Half degrees)",-1)])],512),[[De,s.value.precision,void 0,{number:!0}]])])]),g.value==="quick"?(o(),n("div",nr,[e("div",ar,[a[32]||(a[32]=e("label",null,"Representative Temperature to Learn *",-1)),z(e("select",{"onUpdate:modelValue":a[5]||(a[5]=b=>s.value.representativeTemp=b)},[(o(!0),n(fe,null,$e(r.value,b=>(o(),n("option",{key:b,value:b},u(b)+"°C ",9,ir))),128))],512),[[De,s.value.representativeTemp,void 0,{number:!0}]]),e("small",null,"This temperature will be learned for all mode combinations. The device profile will still show the full range ("+u(s.value.minTemp)+"°C - "+u(s.value.maxTemp)+"°C).",1)])])):T("",!0)]),e("div",rr,[a[40]||(a[40]=e("h4",null,"Supported HVAC Modes *",-1)),a[41]||(a[41]=e("p",{class:"help-text"},"Select all modes your device supports",-1)),e("div",dr,[e("label",ur,[z(e("input",{type:"checkbox",value:"off","onUpdate:modelValue":a[6]||(a[6]=b=>s.value.modes=b)},null,512),[[ve,s.value.modes]]),a[34]||(a[34]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),x(" Off ")],-1))]),e("label",cr,[z(e("input",{type:"checkbox",value:"auto","onUpdate:modelValue":a[7]||(a[7]=b=>s.value.modes=b)},null,512),[[ve,s.value.modes]]),a[35]||(a[35]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-autorenew"}),x(" Auto ")],-1))]),e("label",mr,[z(e("input",{type:"checkbox",value:"cool","onUpdate:modelValue":a[8]||(a[8]=b=>s.value.modes=b)},null,512),[[ve,s.value.modes]]),a[36]||(a[36]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-snowflake"}),x(" Cool ")],-1))]),e("label",vr,[z(e("input",{type:"checkbox",value:"heat","onUpdate:modelValue":a[9]||(a[9]=b=>s.value.modes=b)},null,512),[[ve,s.value.modes]]),a[37]||(a[37]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fire"}),x(" Heat ")],-1))]),e("label",pr,[z(e("input",{type:"checkbox",value:"dry","onUpdate:modelValue":a[10]||(a[10]=b=>s.value.modes=b)},null,512),[[ve,s.value.modes]]),a[38]||(a[38]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-water-percent"}),x(" Dry ")],-1))]),e("label",fr,[z(e("input",{type:"checkbox",value:"fan_only","onUpdate:modelValue":a[11]||(a[11]=b=>s.value.modes=b)},null,512),[[ve,s.value.modes]]),a[39]||(a[39]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan"}),x(" Fan Only ")],-1))])])]),e("div",gr,[a[46]||(a[46]=e("h4",null,"Fan Modes",-1)),a[47]||(a[47]=e("p",{class:"help-text"},"Select all fan speeds your device supports",-1)),e("div",yr,[e("label",br,[z(e("input",{type:"checkbox",value:"auto","onUpdate:modelValue":a[12]||(a[12]=b=>s.value.fanModes=b)},null,512),[[ve,s.value.fanModes]]),a[42]||(a[42]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-autorenew"}),x(" Auto ")],-1))]),e("label",hr,[z(e("input",{type:"checkbox",value:"low","onUpdate:modelValue":a[13]||(a[13]=b=>s.value.fanModes=b)},null,512),[[ve,s.value.fanModes]]),a[43]||(a[43]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-1"}),x(" Low ")],-1))]),e("label",kr,[z(e("input",{type:"checkbox",value:"medium","onUpdate:modelValue":a[14]||(a[14]=b=>s.value.fanModes=b)},null,512),[[ve,s.value.fanModes]]),a[44]||(a[44]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-2"}),x(" Medium ")],-1))]),e("label",wr,[z(e("input",{type:"checkbox",value:"high","onUpdate:modelValue":a[15]||(a[15]=b=>s.value.fanModes=b)},null,512),[[ve,s.value.fanModes]]),a[45]||(a[45]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-3"}),x(" High ")],-1))])])]),e("div",$r,[a[52]||(a[52]=e("h4",null,"Swing Modes (Optional)",-1)),a[53]||(a[53]=e("p",{class:"help-text"},"Select if your device has swing/oscillation",-1)),e("div",Cr,[e("label",Sr,[z(e("input",{type:"checkbox",value:"off","onUpdate:modelValue":a[16]||(a[16]=b=>s.value.swingModes=b)},null,512),[[ve,s.value.swingModes]]),a[48]||(a[48]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-horizontal"}),x(" Off ")],-1))]),e("label",_r,[z(e("input",{type:"checkbox",value:"vertical","onUpdate:modelValue":a[17]||(a[17]=b=>s.value.swingModes=b)},null,512),[[ve,s.value.swingModes]]),a[49]||(a[49]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-vertical"}),x(" Vertical ")],-1))]),e("label",Dr,[z(e("input",{type:"checkbox",value:"horizontal","onUpdate:modelValue":a[18]||(a[18]=b=>s.value.swingModes=b)},null,512),[[ve,s.value.swingModes]]),a[50]||(a[50]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-horizontal"}),x(" Horizontal ")],-1))]),e("label",Ir,[z(e("input",{type:"checkbox",value:"both","onUpdate:modelValue":a[19]||(a[19]=b=>s.value.swingModes=b)},null,512),[[ve,s.value.swingModes]]),a[51]||(a[51]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-arrow-all"}),x(" Both ")],-1))])])]),e("div",Tr,[a[60]||(a[60]=e("h4",null,"Sensors (Optional)",-1)),a[61]||(a[61]=e("p",{class:"help-text"},"Link external sensors for better climate control",-1)),e("div",xr,[a[54]||(a[54]=e("label",null,"Temperature Sensor",-1)),z(e("input",{"onUpdate:modelValue":a[20]||(a[20]=b=>s.value.tempSensor=b),type:"text",placeholder:"sensor.living_room_temperature"},null,512),[[xe,s.value.tempSensor]]),a[55]||(a[55]=e("small",null,"Entity ID of temperature sensor",-1))]),e("div",Mr,[a[56]||(a[56]=e("label",null,"Humidity Sensor",-1)),z(e("input",{"onUpdate:modelValue":a[21]||(a[21]=b=>s.value.humiditySensor=b),type:"text",placeholder:"sensor.living_room_humidity"},null,512),[[xe,s.value.humiditySensor]]),a[57]||(a[57]=e("small",null,"Entity ID of humidity sensor",-1))]),e("div",Rr,[a[58]||(a[58]=e("label",null,"Power Sensor",-1)),z(e("input",{"onUpdate:modelValue":a[22]||(a[22]=b=>s.value.powerSensor=b),type:"text",placeholder:"binary_sensor.ac_power"},null,512),[[xe,s.value.powerSensor]]),a[59]||(a[59]=e("small",null,"Entity ID of power sensor (to detect on/off state)",-1))])]),P.value.length>0?(o(),n("div",Lr,[a[62]||(a[62]=e("h4",null,[e("i",{class:"mdi mdi-alert-circle"}),x(" Please fix the following: ")],-1)),e("ul",null,[(o(!0),n(fe,null,$e(P.value,(b,v)=>(o(),n("li",{key:v},u(b),1))),128))])])):T("",!0)]))}},Er=ke(Ar,[["__scopeId","data-v-c44d7198"]]),Or={class:"command-wizard"},Vr={class:"device-selection-section"},Pr={class:"input-wrapper"},Ur=["value"],Fr={key:0,class:"validation-tooltip"},jr={class:"form-group"},Nr=["disabled"],Br={key:0},Hr={key:1},qr={key:0,class:"edit-mode-banner"},zr={class:"wizard-info"},Jr={key:0},Wr={key:1},Kr={class:"progress-info"},Xr={class:"progress-bar"},Gr={class:"progress-text"},Yr={class:"commands-grid"},Zr={class:"command-header"},Qr={class:"command-icon"},ed={class:"command-info"},td={key:0,class:"learning-indicator"},ld={key:0,class:"ir-learning-steps"},od={key:1,class:"rf-learning-steps"},sd={class:"command-actions"},nd=["onClick","disabled"],ad={key:1,class:"learned-status"},id=["onClick","disabled"],rd=["onClick"],dd={class:"quick-actions"},ud=["disabled"],cd=["disabled"],md={__name:"CommandLearningWizard",props:{modelValue:{type:Object,default:()=>({})},platform:{type:String,required:!0},config:{type:Object,required:!0},broadlinkDevice:{type:String,default:""},manufacturer:{type:String,required:!0},model:{type:String,required:!0},commandType:{type:String,default:"ir"}},emits:["update:modelValue","update:broadlinkDevice","update:commandType"],setup(t,{emit:c}){const m=je(),k=t,g=c,s=y({...k.modelValue}),r=y(null),p=y(null),_=y([]),C=y(k.broadlinkDevice),O=y(k.commandType),w=y(!1),l=y([]),R=y(!1),W=y(!1),P=y({show:!1,commandKey:null,commandLabel:""}),D=y(!1),a=J(()=>{const I=[];if(k.platform==="climate"){const d=k.config.modes||[],V=k.config.fanModes||[],ge=k.config.minTemp||16,Ae=k.config.maxTemp||30;d.forEach(ye=>{if(ye==="off")I.push({key:"off",label:"Power Off",description:"Turn device off",icon:"mdi mdi-power",mode:"off"});else for(let he=ge;he<=Ae;he++)V.forEach(Re=>{const Ee=`${ye}_${he}_${Re}`;I.push({key:Ee,label:`${ye.toUpperCase()} ${he}°C ${Re}`,description:`Mode: ${ye}, Temp: ${he}°C, Fan: ${Re}`,icon:H(ye),mode:ye,temp:he,fanMode:Re})})})}else if(k.platform==="media_player"){const d=k.config.features||[];d.includes("turn_on")&&(I.push({key:"turn_on",label:"Power On",description:"Turn on the device",icon:"mdi mdi-power"}),I.push({key:"turn_off",label:"Power Off",description:"Turn off the device",icon:"mdi mdi-power-off"})),d.includes("volume")&&(I.push({key:"volume_up",label:"Volume Up",description:"Increase volume",icon:"mdi mdi-volume-plus"}),I.push({key:"volume_down",label:"Volume Down",description:"Decrease volume",icon:"mdi mdi-volume-minus"})),d.includes("mute")&&I.push({key:"mute",label:"Mute",description:"Toggle mute",icon:"mdi mdi-volume-mute"}),d.includes("source")&&(I.push({key:"source_hdmi1",label:"Source: HDMI 1",description:"Switch to HDMI 1",icon:"mdi mdi-import"}),I.push({key:"source_hdmi2",label:"Source: HDMI 2",description:"Switch to HDMI 2",icon:"mdi mdi-import"}),I.push({key:"source_hdmi3",label:"Source: HDMI 3",description:"Switch to HDMI 3",icon:"mdi mdi-import"})),d.includes("channel")&&(I.push({key:"channel_up",label:"Channel Up",description:"Next channel",icon:"mdi mdi-chevron-up"}),I.push({key:"channel_down",label:"Channel Down",description:"Previous channel",icon:"mdi mdi-chevron-down"}))}else if(k.platform==="fan"){const d=k.config.speedLevels||3,V=k.config.features||[];I.push({key:"turn_on",label:"Power On",description:"Turn on the fan",icon:"mdi mdi-power"}),I.push({key:"turn_off",label:"Power Off",description:"Turn off the fan",icon:"mdi mdi-power-off"});for(let ge=1;ge<=d;ge++){const Ae=ge===1?"Low":ge===d?"High":ge===2&&d===3?"Medium":`Speed ${ge}`;I.push({key:`speed_${ge}`,label:`${Ae}`,description:`Set fan to speed level ${ge}`,icon:"mdi mdi-fan"})}V.includes("oscillate")&&(I.push({key:"oscillate_on",label:"Oscillate On",description:"Enable oscillation",icon:"mdi mdi-sync"}),I.push({key:"oscillate_off",label:"Oscillate Off",description:"Disable oscillation",icon:"mdi mdi-sync-off"})),V.includes("direction")&&(I.push({key:"direction_forward",label:"Direction: Forward",description:"Set direction to forward",icon:"mdi mdi-rotate-right"}),I.push({key:"direction_reverse",label:"Direction: Reverse",description:"Set direction to reverse",icon:"mdi mdi-rotate-left"}))}else if(k.platform==="light"){const d=k.config.features||[];d.includes("turn_on")&&(I.push({key:"turn_on",label:"Power On",description:"Turn on the light",icon:"mdi mdi-lightbulb-on"}),I.push({key:"turn_off",label:"Power Off",description:"Turn off the light",icon:"mdi mdi-lightbulb-off"})),d.includes("brightness")&&(I.push({key:"brightness_up",label:"Brightness Up",description:"Increase brightness",icon:"mdi mdi-brightness-7"}),I.push({key:"brightness_down",label:"Brightness Down",description:"Decrease brightness",icon:"mdi mdi-brightness-5"})),d.includes("color_temp")&&(I.push({key:"color_temp_warm",label:"Warm White",description:"Set to warm white",icon:"mdi mdi-weather-sunset"}),I.push({key:"color_temp_cool",label:"Cool White",description:"Set to cool white",icon:"mdi mdi-weather-sunny"})),d.includes("rgb")&&(I.push({key:"color_red",label:"Color: Red",description:"Set color to red",icon:"mdi mdi-palette"}),I.push({key:"color_green",label:"Color: Green",description:"Set color to green",icon:"mdi mdi-palette"}),I.push({key:"color_blue",label:"Color: Blue",description:"Set color to blue",icon:"mdi mdi-palette"}))}return I}),b=J(()=>a.value.length),v=J(()=>Object.keys(s.value).length),E=J(()=>b.value===0?0:Math.round(v.value/b.value*100));function H(I){return{off:"mdi mdi-power",auto:"mdi mdi-autorenew",cool:"mdi mdi-snowflake",heat:"mdi mdi-fire",dry:"mdi mdi-water-percent",fan_only:"mdi mdi-fan"}[I]||"mdi mdi-remote"}async function Z(I){if(!r.value){if(!C.value){W.value=!0,window.scrollTo({top:0,behavior:"smooth"});return}W.value=!1,r.value=I.key;try{const d=k.manufacturer.toLowerCase().replace(/[^a-z0-9]+/g,"_"),V=k.model.toLowerCase().replace(/[^a-z0-9]+/g,"_"),ge=`${d}_${V}`,ye=(await ne.post("/api/commands/learn",{entity_id:C.value,device:ge,command:I.key,command_type:O.value})).data;if(ye.success&&ye.code)s.value[I.key]=ye.code,g("update:modelValue",s.value),R.value=!0,ye.code==="pending"&&console.log(`⏳ Command '${I.key}' learned, code will be fetched from storage when saving`),w.value&&l.value.length>0&&setTimeout(()=>{const he=l.value.shift();he?Z(he):w.value=!1},1e3);else throw new Error(ye.error||"Failed to learn command")}catch(d){console.error("Error learning command:",d),m.error(`Error learning command: ${d.message}`),w.value=!1,l.value=[]}finally{w.value||(r.value=null)}}}async function N(I){var d;if(!C.value){W.value=!0,window.scrollTo({top:0,behavior:"smooth"});return}if(!s.value[I]){(d=m.value)==null||d.error("Command not learned yet");return}p.value=I;try{const V=s.value[I];await ne.post("/api/commands/send-raw",{entity_id:C.value,command:V,command_type:O.value}),m.success("Command sent successfully")}catch(V){console.error("Error testing command:",V),m.error(`Error testing command: ${V.message}`)}finally{p.value=null}}function oe(I){const d=a.value.find(V=>V.key===I);P.value={show:!0,commandKey:I,commandLabel:d?d.label:I}}function A(){const I=P.value.commandKey;delete s.value[I],g("update:modelValue",s.value),P.value.show=!1}function j(){const I=a.value.filter(V=>!s.value[V.key]);if(I.length===0)return;w.value=!0,l.value=[...I];const d=l.value.shift();d&&Z(d)}function X(){D.value=!0}function M(){s.value={},g("update:modelValue",s.value),D.value=!1}re(()=>k.modelValue,I=>{s.value={...I}},{deep:!0}),Le(async()=>{await ee()});async function ee(){try{console.log("SmartIR device - commands will be loaded from SmartIR JSON file, not Broadlink storage")}catch(I){console.error("Error in loadExistingCommands:",I)}}function we(){g("update:broadlinkDevice",C.value)}function Se(){g("update:commandType",O.value)}async function Me(){try{console.log("🔍 Loading Broadlink devices from /api/remote/devices");const I=await ne.get("/api/remote/devices");console.log("📦 Response data:",I.data);const d=I.data.devices||[];console.log(`✅ Found ${d.length} devices:`,d),_.value=d}catch(I){console.error("❌ Error loading remote devices:",I),_.value=[]}}return re(()=>k.broadlinkDevice,I=>{C.value=I}),re(C,I=>{I&&(W.value=!1)}),re(()=>k.commandType,I=>{O.value=I}),Le(async()=>{await Me(),await ee()}),(I,d)=>(o(),n("div",Or,[d[22]||(d[22]=e("h3",null,"Learn IR Commands",-1)),e("div",Vr,[e("div",{class:K(["form-group",{"has-error":W.value}])},[d[6]||(d[6]=e("label",null,"Broadlink Device *",-1)),e("div",Pr,[z(e("select",{"onUpdate:modelValue":d[0]||(d[0]=V=>C.value=V),onChange:we},[d[4]||(d[4]=e("option",{value:""},"Select Broadlink device...",-1)),(o(!0),n(fe,null,$e(_.value,V=>(o(),n("option",{key:V.entity_id,value:V.entity_id},u(V.name||V.entity_id),9,Ur))),128))],544),[[De,C.value]]),W.value?(o(),n("div",Fr,[...d[5]||(d[5]=[e("i",{class:"mdi mdi-alert"},null,-1),x(" Device is required ",-1)])])):T("",!0)]),e("small",null,"This device will be used to learn commands ("+u(_.value.length)+" devices found)",1)],2),e("div",jr,[d[8]||(d[8]=e("label",null,"Command Type *",-1)),z(e("select",{"onUpdate:modelValue":d[1]||(d[1]=V=>O.value=V),onChange:Se,disabled:v.value>0},[...d[7]||(d[7]=[e("option",{value:"ir"},"📡 Infrared (IR) - Most common for AC, TV, etc.",-1),e("option",{value:"rf"},"📻 Radio Frequency (RF) - For RF remotes",-1)])],40,Nr),[[De,O.value]]),v.value>0?(o(),n("small",Br,"Command type cannot be changed after learning commands")):(o(),n("small",Hr,"Select the type of commands your device uses"))])]),v.value>0&&!R.value?(o(),n("div",qr,[d[10]||(d[10]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[d[9]||(d[9]=e("strong",null,"Editing Existing Profile",-1)),e("p",null,u(v.value)+" command"+u(v.value!==1?"s":"")+' already learned. You can re-learn any command by clicking the delete icon and then "Learn Command".',1)])])):T("",!0),e("div",zr,[d[14]||(d[14]=e("i",{class:"mdi mdi-information"},null,-1)),e("div",null,[d[13]||(d[13]=e("p",null,[e("strong",null,"How it works:")],-1)),t.commandType==="ir"?(o(),n("ol",Jr,[...d[11]||(d[11]=[e("li",null,'Click "Learn Command" for each combination',-1),e("li",null,[e("strong",null,"Point your IR remote directly at the Broadlink device")],-1),e("li",null,"Press the button on your remote",-1),e("li",null,"Wait for confirmation (up to 30 seconds)",-1)])])):(o(),n("ol",Wr,[...d[12]||(d[12]=[e("li",null,'Click "Learn Command" for each combination',-1),e("li",null,[e("strong",null,"Step 1:"),x(" Hold button on remote - Broadlink scans for RF frequency")],-1),e("li",null,[e("strong",null,"Step 2:"),x(" Watch for Home Assistant notification, then press and release button")],-1),e("li",null,"Keep remote within 5cm of Broadlink (RF doesn't need line-of-sight)",-1),e("li",null,"Wait for confirmation (may take up to 30 seconds)",-1)])]))])]),e("div",Kr,[e("div",Xr,[e("div",{class:"progress-fill",style:qe({width:E.value+"%"})},null,4)]),e("span",Gr,u(v.value)+" / "+u(b.value)+" commands learned ("+u(E.value)+"%) ",1)]),e("div",Yr,[(o(!0),n(fe,null,$e(a.value,V=>(o(),n("div",{key:V.key,class:K(["command-card",{learned:s.value[V.key],learning:r.value===V.key}])},[e("div",Zr,[e("div",Qr,[e("i",{class:K(V.icon)},null,2)]),e("div",ed,[e("h4",null,u(V.label),1),e("p",null,u(V.description),1)])]),r.value===V.key?(o(),n("div",td,[t.commandType==="ir"?(o(),n("div",ld,[...d[15]||(d[15]=[e("p",null,[e("strong",null,"Point your remote directly at the Broadlink device and press the button.")],-1),e("small",null,"Listening for up to 30 seconds...",-1)])])):(o(),n("div",od,[...d[16]||(d[16]=[e("p",{class:"rf-title"},[e("strong",null,"Learning request sent to device.")],-1),e("p",{class:"rf-subtitle"},[x("RF learning is a "),e("strong",null,"two-step process"),x(":")],-1),e("ol",null,[e("li",null,[e("strong",null,"Step 1 - Frequency Sweep (~10-15 seconds):"),x(" Press and hold the button on your remote until the notification updates. ")]),e("li",null,[e("strong",null,"Step 2 - Learn Signal:"),x(" Press and release the button once. ")])],-1),e("p",{class:"rf-note"},"Follow the Home Assistant notifications (🔔) for real-time instructions.",-1)])]))])):T("",!0),e("div",sd,[s.value[V.key]?(o(),n("div",ad,[d[18]||(d[18]=e("i",{class:"mdi mdi-check-circle"},null,-1)),d[19]||(d[19]=e("span",null,"Learned",-1)),e("span",{class:K(["command-type-badge",O.value])},u(O.value.toUpperCase()),3),e("button",{onClick:ge=>N(V.key),class:"icon-btn",title:"Test command",disabled:p.value===V.key,style:{"margin-left":"auto"}},[e("i",{class:K(["mdi mdi-play",{"mdi-spin":p.value===V.key}])},null,2)],8,id),e("button",{onClick:ge=>oe(V.key),class:"icon-btn danger",title:"Delete and re-learn"},[...d[17]||(d[17]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,rd)])):(o(),n("button",{key:0,onClick:ge=>Z(V),class:K(["btn-learn",{learning:r.value===V.key}]),disabled:r.value!==null},[e("i",{class:K(["mdi mdi-radio-tower",{"mdi-spin":r.value===V.key}])},null,2),x(" "+u(r.value===V.key?"Listening...":"Learn Command"),1)],10,nd))])],2))),128))]),e("div",dd,[e("button",{onClick:j,class:"btn-secondary",disabled:r.value!==null||v.value===b.value},[...d[20]||(d[20]=[e("i",{class:"mdi mdi-play-circle"},null,-1),x(" Learn All Remaining ",-1)])],8,ud),e("button",{onClick:X,class:"btn-text",disabled:v.value===0},[...d[21]||(d[21]=[e("i",{class:"mdi mdi-delete-sweep"},null,-1),x(" Clear All ",-1)])],8,cd)]),be(Ue,{isOpen:P.value.show,title:"Delete Learned Command?",message:`Are you sure you want to delete the '${P.value.commandLabel}' command?

You will need to re-learn this command.`,confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,onConfirm:A,onCancel:d[2]||(d[2]=V=>P.value.show=!1)},null,8,["isOpen","message"]),be(Ue,{isOpen:D.value,title:"Delete All Learned Commands?",message:"Are you sure you want to delete all learned commands? This cannot be undone.\\n\\nYou will need to re-learn all commands.",confirmText:"Delete All",cancelText:"Cancel",dangerMode:!0,onConfirm:M,onCancel:d[3]||(d[3]=V=>D.value=!1)},null,8,["isOpen"])]))}},vd=ke(md,[["__scopeId","data-v-9a9e9e51"]]),pd={class:"profile-preview"},fd={class:"preview-summary"},gd={class:"summary-card"},yd={class:"stats-grid"},bd={class:"stat-item"},hd={class:"stat-value"},kd={class:"stat-item"},wd={class:"stat-value"},$d={class:"stat-item"},Cd={class:"stat-value"},Sd={class:"preview-tabs"},_d={class:"preview-content"},Dd={key:0,class:"tab-content"},Id={class:"code-header"},Td={class:"code-block"},xd={key:1,class:"tab-content"},Md={class:"code-header"},Rd={class:"code-block"},Ld={key:2,class:"tab-content"},Ad={class:"instructions"},Ed={class:"step-item"},Od={class:"step-content"},Vd={class:"code-path"},Pd={__name:"ProfilePreview",props:{profile:{type:Object,required:!0},jsonData:{type:Object,required:!0},yamlConfig:{type:String,required:!0}},setup(t){const c=je(),m=t,k=y("json"),g=y(!1),s=y(!1),r=J(()=>Object.keys(m.profile.commands||{}).length),p=J(()=>JSON.stringify(m.jsonData,null,2));async function _(){try{await navigator.clipboard.writeText(p.value),g.value=!0,setTimeout(()=>{g.value=!1},2e3)}catch(O){console.error("Failed to copy JSON:",O),c.error("Failed to copy to clipboard")}}async function C(){try{await navigator.clipboard.writeText(m.yamlConfig),s.value=!0,setTimeout(()=>{s.value=!1},2e3)}catch(O){console.error("Failed to copy YAML:",O),c.error("Failed to copy to clipboard")}}return(O,w)=>{var l;return o(),n("div",pd,[w[22]||(w[22]=e("h3",null,"Preview & Save",-1)),e("div",fd,[e("div",gd,[w[4]||(w[4]=e("i",{class:"mdi mdi-check-circle"},null,-1)),e("div",null,[w[3]||(w[3]=e("h4",null,"Profile Ready!",-1)),e("p",null,u(t.profile.manufacturer)+" "+u(t.profile.model),1)])]),e("div",yd,[e("div",bd,[e("span",hd,u(r.value),1),w[5]||(w[5]=e("span",{class:"stat-label"},"Commands Learned",-1))]),e("div",kd,[e("span",wd,u(t.profile.platform),1),w[6]||(w[6]=e("span",{class:"stat-label"},"Platform",-1))]),e("div",$d,[e("span",Cd,u(((l=t.profile.config.modes)==null?void 0:l.length)||0),1),w[7]||(w[7]=e("span",{class:"stat-label"},"HVAC Modes",-1))])])]),e("div",Sd,[e("button",{onClick:w[0]||(w[0]=R=>k.value="json"),class:K(["tab-button",{active:k.value==="json"}])},[...w[8]||(w[8]=[e("i",{class:"mdi mdi-code-json"},null,-1),x(" SmartIR JSON ",-1)])],2),e("button",{onClick:w[1]||(w[1]=R=>k.value="yaml"),class:K(["tab-button",{active:k.value==="yaml"}])},[...w[9]||(w[9]=[e("i",{class:"mdi mdi-file-code"},null,-1),x(" YAML Config ",-1)])],2),e("button",{onClick:w[2]||(w[2]=R=>k.value="instructions"),class:K(["tab-button",{active:k.value==="instructions"}])},[...w[10]||(w[10]=[e("i",{class:"mdi mdi-information"},null,-1),x(" Instructions ",-1)])],2)]),e("div",_d,[k.value==="json"?(o(),n("div",Dd,[e("div",Id,[w[12]||(w[12]=e("h4",null,"SmartIR Device Code JSON",-1)),e("button",{onClick:_,class:"btn-copy"},[w[11]||(w[11]=e("i",{class:"mdi mdi-content-copy"},null,-1)),x(" "+u(g.value?"Copied!":"Copy"),1)])]),e("pre",Td,[e("code",null,u(p.value),1)]),w[13]||(w[13]=e("p",{class:"code-note"},[e("i",{class:"mdi mdi-information"}),x(" Save this as "),e("code",null,"10000.json"),x(" in your SmartIR codes directory ")],-1))])):T("",!0),k.value==="yaml"?(o(),n("div",xd,[e("div",Md,[w[15]||(w[15]=e("h4",null,"Home Assistant Configuration",-1)),e("button",{onClick:C,class:"btn-copy"},[w[14]||(w[14]=e("i",{class:"mdi mdi-content-copy"},null,-1)),x(" "+u(s.value?"Copied!":"Copy"),1)])]),e("pre",Rd,[e("code",null,u(t.yamlConfig),1)]),w[16]||(w[16]=e("p",{class:"code-note"},[e("i",{class:"mdi mdi-information"}),x(" Add this to your "),e("code",null,"configuration.yaml"),x(" file ")],-1))])):T("",!0),k.value==="instructions"?(o(),n("div",Ld,[e("div",Ad,[w[20]||(w[20]=e("h4",null,"Installation Steps",-1)),e("div",Ed,[w[19]||(w[19]=e("div",{class:"step-number"},"1",-1)),e("div",Od,[w[17]||(w[17]=e("h5",null,"Get Next Code Number",-1)),w[18]||(w[18]=e("p",null,"Custom device codes start at 10000. Check your SmartIR codes directory to find the next available number.",-1)),e("div",Vd,[e("code",null,"/config/custom_components/smartir/codes/"+u(t.profile.platform)+"/",1)])])]),w[21]||(w[21]=Pe('<div class="step-item" data-v-e7b997c8><div class="step-number" data-v-e7b997c8>2</div><div class="step-content" data-v-e7b997c8><h5 data-v-e7b997c8>Save JSON File</h5><p data-v-e7b997c8>Copy the JSON from the &quot;SmartIR JSON&quot; tab and save it as <code data-v-e7b997c8>10000.json</code> (or your next available number) in the codes directory.</p></div></div><div class="step-item" data-v-e7b997c8><div class="step-number" data-v-e7b997c8>3</div><div class="step-content" data-v-e7b997c8><h5 data-v-e7b997c8>Update Configuration</h5><p data-v-e7b997c8>Copy the YAML from the &quot;YAML Config&quot; tab and add it to your <code data-v-e7b997c8>configuration.yaml</code> file. Update the <code data-v-e7b997c8>device_code</code> to match your JSON filename.</p></div></div><div class="step-item" data-v-e7b997c8><div class="step-number" data-v-e7b997c8>4</div><div class="step-content" data-v-e7b997c8><h5 data-v-e7b997c8>Restart Home Assistant</h5><p data-v-e7b997c8>Restart Home Assistant to load the new configuration. Your climate entity will appear in the UI.</p></div></div><div class="step-item" data-v-e7b997c8><div class="step-number" data-v-e7b997c8>5</div><div class="step-content" data-v-e7b997c8><h5 data-v-e7b997c8>Test Your Device</h5><p data-v-e7b997c8>Go to your climate entity and test different modes, temperatures, and fan speeds to ensure everything works correctly.</p></div></div><div class="tips-section" data-v-e7b997c8><h4 data-v-e7b997c8><i class="mdi mdi-lightbulb" data-v-e7b997c8></i> Tips </h4><ul data-v-e7b997c8><li data-v-e7b997c8>Keep a backup of your JSON file in case you need to modify it</li><li data-v-e7b997c8>Test all commands to ensure they work as expected</li><li data-v-e7b997c8>You can share your profile with the SmartIR community on GitHub</li><li data-v-e7b997c8>If a command doesn&#39;t work, you can re-learn it and update the JSON</li></ul></div>',5))])])):T("",!0)])])}}},Ud=ke(Pd,[["__scopeId","data-v-e7b997c8"]]),Fd={class:"wizard-body"},jd={key:0,class:"warning-section"},Nd={class:"warning-box"},Bd={class:"instructions"},Hd={class:"code-block"},qd={class:"steps"},zd={key:0},Jd={class:"help-section"},Wd={key:0,class:"help-content"},Kd={class:"help-step"},Xd={key:0,class:"help-step"},Gd={class:"help-step"},Yd={class:"help-step"},Zd={class:"checklist"},Qd={class:"checkbox-label"},eu={key:0,class:"checkbox-label"},tu={class:"wizard-footer"},lu=["disabled"],ou={__name:"SmartIRSetupWizard",props:{show:{type:Boolean,default:!1},platform:{type:String,required:!0},warnings:{type:Array,default:()=>[]},configPath:{type:String,default:"/config"}},emits:["close","complete"],setup(t,{emit:c}){const m=t,k=c,g=Ie("toast"),s=y(!1),r=y(!1),p=y(!1),_=J(()=>m.warnings.length>0?s.value&&r.value:s.value);function C(){const w=`${m.platform}: !include smartir/${m.platform}.yaml`;navigator.clipboard.writeText(w).then(()=>{var l;(l=g.value)==null||l.success("Include line copied to clipboard!","✅ Copied")}).catch(l=>{var R;console.error("Failed to copy:",l),(R=g.value)==null||R.error("Failed to copy to clipboard","❌ Copy Failed")})}function O(){k("complete")}return(w,l)=>t.show?(o(),n("div",{key:0,class:"modal-overlay",onClick:l[5]||(l[5]=ue(()=>{},["stop"]))},[e("div",{class:"setup-wizard",onClick:l[4]||(l[4]=ue(()=>{},["stop"]))},[l[31]||(l[31]=e("div",{class:"wizard-header"},[e("h2",null,[e("i",{class:"mdi mdi-cog"}),x(" SmartIR Configuration Setup ")])],-1)),e("div",Fd,[t.warnings.length>0?(o(),n("div",jd,[e("div",Nd,[l[11]||(l[11]=e("i",{class:"mdi mdi-alert"},null,-1)),e("div",null,[l[9]||(l[9]=e("h3",null,"⚠️ Configuration Migration Needed",-1)),l[10]||(l[10]=e("p",null,"We detected existing platform entries in your configuration.yaml:",-1)),e("ul",null,[(o(!0),n(fe,null,$e(t.warnings,R=>(o(),n("li",{key:R.platform},[e("strong",null,u(R.platform)+":",1),x(" "+u(R.message),1)]))),128))]),e("p",null,[l[6]||(l[6]=e("strong",null,"Action Required:",-1)),l[7]||(l[7]=x(" Move these entries to ",-1)),e("code",null,"smartir/"+u(t.platform)+".yaml",1),l[8]||(l[8]=x(" before continuing.",-1))])])])])):T("",!0),e("div",Bd,[l[27]||(l[27]=e("h3",null,"📝 One-Time Setup",-1)),l[28]||(l[28]=e("p",null,[x("To enable SmartIR device management, add this line to your "),e("code",null,"configuration.yaml"),x(":")],-1)),e("div",Hd,[e("code",null,u(t.platform)+": !include smartir/"+u(t.platform)+".yaml",1),e("button",{onClick:C,class:"copy-btn",title:"Copy to clipboard"},[...l[12]||(l[12]=[e("i",{class:"mdi mdi-content-copy"},null,-1)])])]),e("div",qd,[l[19]||(l[19]=e("h4",null,"Steps:",-1)),e("ol",null,[t.warnings.length>0?(o(),n("li",zd,[l[13]||(l[13]=e("strong",null,"Move existing entries:",-1)),l[14]||(l[14]=x(" Copy any existing ",-1)),e("code",null,u(t.platform)+":",1),l[15]||(l[15]=x(" entries from configuration.yaml to ",-1)),e("code",null,"smartir/"+u(t.platform)+".yaml",1)])):T("",!0),l[16]||(l[16]=e("li",null,[e("strong",null,"Add include line:"),x(" Add the line above to your configuration.yaml ")],-1)),l[17]||(l[17]=e("li",null,[e("strong",null,"Save changes:"),x(" Save configuration.yaml ")],-1)),l[18]||(l[18]=e("li",null,[e("strong",null,"Continue here:"),x(` Click "I've Completed Setup" below `)],-1))])]),e("div",Jd,[e("button",{onClick:l[0]||(l[0]=R=>p.value=!p.value),class:"help-toggle"},[e("i",{class:K(["mdi",p.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2),x(" "+u(p.value?"Hide":"Show")+" Detailed Instructions ",1)]),p.value?(o(),n("div",Wd,[l[26]||(l[26]=e("h4",null,"Detailed Setup Guide:",-1)),e("div",Kd,[l[21]||(l[21]=e("h5",null,"1. Open configuration.yaml",-1)),e("p",null,[l[20]||(l[20]=x("Location: ",-1)),e("code",null,u(t.configPath)+"/configuration.yaml",1)])]),t.warnings.length>0?(o(),n("div",Xd,[l[22]||(l[22]=e("h5",null,"2. Migrate Existing Entries (If Any)",-1)),e("p",null,"If you have existing "+u(t.platform)+" entries, cut them from configuration.yaml and paste into:",1),e("p",null,[e("code",null,u(t.configPath)+"/smartir/"+u(t.platform)+".yaml",1)]),l[23]||(l[23]=e("p",{class:"note"},"Broadlink Manager will create this file automatically.",-1))])):T("",!0),e("div",Gd,[e("h5",null,u(t.warnings.length>0?"3":"2")+". Add Include Line",1),l[24]||(l[24]=e("p",null,"Add this to configuration.yaml:",-1)),e("pre",null,u(t.platform)+": !include smartir/"+u(t.platform)+".yaml",1)]),e("div",Yd,[e("h5",null,u(t.warnings.length>0?"4":"3")+". Restart Home Assistant",1),l[25]||(l[25]=e("p",null,"After saving, you'll need to restart HA for changes to take effect.",-1))])])):T("",!0)])]),e("div",Zd,[e("label",Qd,[z(e("input",{type:"checkbox","onUpdate:modelValue":l[1]||(l[1]=R=>s.value=R)},null,512),[[ve,s.value]]),l[29]||(l[29]=e("span",null,"I've added the include line to configuration.yaml",-1))]),t.warnings.length>0?(o(),n("label",eu,[z(e("input",{type:"checkbox","onUpdate:modelValue":l[2]||(l[2]=R=>r.value=R)},null,512),[[ve,r.value]]),e("span",null,"I've migrated existing "+u(t.platform)+" entries (if any)",1)])):T("",!0)])]),e("div",tu,[e("button",{onClick:l[3]||(l[3]=R=>w.$emit("close")),class:"btn-secondary"}," Cancel "),e("button",{onClick:O,class:"btn-primary",disabled:!_.value},[...l[30]||(l[30]=[e("i",{class:"mdi mdi-check"},null,-1),x(" I've Completed Setup ",-1)])],8,lu)])])])):T("",!0)}},su=ke(ou,[["__scopeId","data-v-f6fe4c03"]]),nu={class:"modal-header"},au={class:"progress-steps"},iu={class:"step-number"},ru={key:0,class:"mdi mdi-check"},du={key:1},uu={class:"step-label"},cu={class:"modal-body"},mu={key:0,class:"step-content"},vu={class:"form-group"},pu={class:"form-group"},fu={class:"form-group"},gu={key:1,class:"step-content"},yu={key:1,class:"platform-form"},bu={class:"form-section"},hu={class:"checkbox-grid"},ku={class:"checkbox-item"},wu={class:"checkbox-item"},$u={class:"checkbox-item"},Cu={class:"checkbox-item"},Su={class:"checkbox-item"},_u={key:2,class:"platform-form"},Du={class:"form-section"},Iu={class:"form-group"},Tu={class:"form-section"},xu={class:"checkbox-grid"},Mu={class:"checkbox-item"},Ru={class:"checkbox-item"},Lu={key:3,class:"platform-form"},Au={class:"form-section"},Eu={class:"checkbox-grid"},Ou={class:"checkbox-item"},Vu={class:"checkbox-item"},Pu={class:"checkbox-item"},Uu={class:"checkbox-item"},Fu={key:2,class:"step-content"},ju={key:3,class:"step-content"},Nu={class:"modal-footer"},Bu=["disabled"],Hu={key:2,class:"save-buttons"},qu=["disabled"],zu=["disabled"],Ju={__name:"SmartIRProfileBuilder",props:{show:{type:Boolean,default:!1},editMode:{type:Boolean,default:!1},editData:{type:Object,default:null},startStep:{type:Number,default:0}},emits:["close","save"],setup(t,{emit:c}){const m=t,k=c,g=Ie("toast"),s=y(0),r=y(!1),p=y([]),_=y(!1),C=y([]),O=y("/config"),w=y(!1),l=y(null),R=y(!1),W=y(!1),P=y(""),D=y("ir"),a=y(!1),b=[{label:"Device Info",key:"info"},{label:"Configuration",key:"config"},{label:"Learn Commands",key:"commands"},{label:"Preview & Save",key:"preview"}],v=y({platform:"",manufacturer:"",model:"",broadlinkDevice:"",commandType:"ir",config:{},commands:{}}),E=y(["turn_on"]),H=y(3),Z=y([]),N=y(["turn_on"]);re(()=>v.value.platform,L=>{L==="media_player"?v.value.config={features:E.value}:L==="fan"?v.value.config={speedLevels:H.value,features:Z.value}:L==="light"&&(v.value.config={features:N.value})}),re(E,L=>{v.value.platform==="media_player"&&(v.value.config={features:L})},{deep:!0}),re(H,L=>{v.value.platform==="fan"&&(v.value.config={speedLevels:L,features:Z.value})}),re(Z,L=>{v.value.platform==="fan"&&(v.value.config={speedLevels:H.value,features:L})},{deep:!0}),re(N,L=>{v.value.platform==="light"&&(v.value.config={features:L})},{deep:!0});function oe(L){const i=new Set,U=Object.keys(L);return U.some(G=>G==="off"||G.includes("_off"))&&i.add("off"),U.some(G=>G.includes("auto"))&&i.add("auto"),U.some(G=>G.includes("cool"))&&i.add("cool"),U.some(G=>G.includes("heat"))&&i.add("heat"),U.some(G=>G.includes("dry"))&&i.add("dry"),U.some(G=>G.includes("fan_only"))&&i.add("fan_only"),Array.from(i)}function A(L){const i=new Set,U=Object.keys(L);return U.some(G=>G.includes("auto"))&&i.add("auto"),U.some(G=>G.includes("low"))&&i.add("low"),U.some(G=>G.includes("medium")||G.includes("mid"))&&i.add("medium"),U.some(G=>G.includes("high"))&&i.add("high"),Array.from(i)}function j(L){const i=new Set,U=Object.keys(L);return U.some(G=>G.includes("swing_off")||G.includes("_off"))&&i.add("off"),U.some(G=>G.includes("vertical"))&&i.add("vertical"),U.some(G=>G.includes("horizontal"))&&i.add("horizontal"),U.some(G=>G.includes("both"))&&i.add("both"),Array.from(i)}function X(L){for(const i of Object.values(L))if(typeof i=="string"&&i.startsWith("sc")||Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0].startsWith("sc"))return"rf";return"ir"}re(()=>v.value.commandType,(L,i)=>{!i||R.value||a.value||(Object.keys(v.value.commands).length>0&&L!==i?(P.value=L,v.value.commandType=i,R.value=!0):L!==i&&(D.value=L))}),re(()=>m.editData,async L=>{var i,U,G;if(L&&m.editMode){console.log("🔧 Edit mode activated, loading profile data:",L),a.value=!0,p.value.length===0&&(console.log("📡 Loading Broadlink devices..."),await se(),console.log("📡 Devices loaded:",p.value.length));const ae=L.profile,de=ae.controller_data;console.log("🎮 Controller data from profile:",de),console.log("🎮 Available devices:",p.value.map(S=>S.entity_id));const le=ae.commands||{},Q=ae.commandType||X(le);console.log("🔍 Command type (stored):",ae.commandType),console.log("🔍 Command type (final):",Q);let me={};if(L.platform==="climate"){const S=ae.operationModes||oe(le),h=ae.fanModes||A(le),F=ae.swingModes||j(le);console.log("🔍 Inferred modes:",S),console.log("🔍 Inferred fan modes:",h),console.log("🔍 Inferred swing modes:",F),me={minTemp:ae.minTemperature,maxTemp:ae.maxTemperature,precision:ae.precision,modes:S,fanModes:h,swingModes:F}}else if(L.platform==="media_player"){const S=[];(le.on||le.off)&&S.push("turn_on"),(le.volumeUp||le.volumeDown)&&S.push("volume"),le.mute&&S.push("mute"),le.sources&&S.push("source"),(le.channelUp||le.channelDown)&&S.push("channel"),me={features:S},E.value=S,console.log("🔍 Inferred media player features:",S)}else if(L.platform==="fan"){const S=((i=ae.speed)==null?void 0:i.length)||Object.keys(le.default||{}).length||3,h=[];(le.oscillate_on||le.oscillate_off)&&h.push("oscillate"),(le.direction_forward||le.direction_reverse)&&h.push("direction"),me={speedLevels:S,features:h},H.value=S,Z.value=h,console.log("🔍 Inferred fan config:",me)}else if(L.platform==="light"){const S=[];me={features:S},N.value=S,console.log("🔍 Inferred light features:",S)}const Te=await f(ae.manufacturer,(U=ae.supportedModels)==null?void 0:U[0],le);v.value={platform:L.platform,manufacturer:ae.manufacturer||"",model:((G=ae.supportedModels)==null?void 0:G[0])||"",broadlinkDevice:de||"",commandType:Q,config:me,commands:Te},console.log("✅ Profile populated:",v.value),console.log("✅ Selected device:",v.value.broadlinkDevice),console.log("✅ Command type:",v.value.commandType),console.log("✅ Commands (with learned codes):",Te),D.value=Q,setTimeout(()=>{a.value=!1},100)}},{immediate:!0});const M=J(()=>{var L;switch(s.value){case 0:return v.value.platform&&v.value.manufacturer&&v.value.model;case 1:return v.value.platform==="climate"?v.value.config.minTemp&&v.value.config.maxTemp&&((L=v.value.config.modes)==null?void 0:L.length)>0:!0;case 2:return v.value.broadlinkDevice&&v.value.commandType&&Object.keys(v.value.commands).length>0;case 3:return!0;default:return!1}}),ee=y(null);async function we(){if(s.value!==3){ee.value=null;return}if(console.log("🔍 Generating JSON with commands:",v.value.commands),Object.values(v.value.commands).some(i=>typeof i=="string"?i==="pending":typeof i=="object"?Object.values(i).some(U=>typeof U=="string"?U==="pending":typeof U=="object"?Object.values(U).some(G=>G==="pending"):!1):!1)){console.warn('⚠️ Commands still contain "pending" placeholders!'),console.log("📦 Attempting to fetch from Broadlink storage...");const i=await f(v.value.manufacturer,v.value.model,v.value.commands);v.value.commands=i,console.log("✅ Updated commands:",i)}ee.value=$(v.value),console.log("📄 Generated JSON:",ee.value)}const Se=J(()=>s.value!==3?null:q(v.value));function Me(){v.value.config={},v.value.commands={}}function I(){R.value=!1,v.value.commandType=P.value,D.value=P.value,v.value.commands={},P.value=""}function d(){R.value=!1,P.value=""}async function V(){s.value<b.length-1&&(s.value++,s.value===3&&await we())}function ge(){s.value>0&&s.value--}function Ae(){R.value||(W.value=!0)}function ye(){W.value=!1,he()}function he(){k("close"),setTimeout(()=>{s.value=0,v.value={platform:"",manufacturer:"",model:"",broadlinkDevice:"",commandType:"ir",config:{},commands:{}},D.value="ir"},300)}async function Re(){var L,i,U,G,ae,de;r.value=!0;try{if(!w.value){const h=(await ne.get("/api/smartir/config/check")).data;if(h&&!((L=h.platforms[v.value.platform])==null?void 0:L.file_exists)){C.value=h.configuration_warnings||[],O.value=h.config_path||"/config",l.value={platform:v.value.platform,json:ee.value},_.value=!0,r.value=!1;return}}let le;m.editMode&&((i=m.editData)!=null&&i.code)?(le=parseInt(m.editData.code),console.log("📝 Edit mode: Using existing code",le)):(le=(await ne.get(`/api/smartir/platforms/${v.value.platform}/next-code`)).data.next_code,console.log("✨ New profile: Using next code",le));const me=(await ne.post("/api/smartir/profiles",{platform:v.value.platform,json:ee.value,code_number:le})).data,Te={platform:"smartir",name:`${v.value.manufacturer} ${v.value.model}`,unique_id:`${v.value.manufacturer.toLowerCase().replace(/[^a-z0-9]+/g,"_")}_${v.value.model.toLowerCase().replace(/[^a-z0-9]+/g,"_")}`,device_code:le,controller_data:v.value.broadlinkDevice};try{await ne.post("/api/smartir/config/add-device",{platform:v.value.platform,device_config:{platform:"smartir",name:Te.name,unique_id:Te.unique_id,device_code:Te.device_code,controller_data:Te.controller_data}})}catch(S){console.error("Failed to add device to config:",S);const h=((U=S.response)==null?void 0:U.data)||{};let F=h.error||"Unknown error";h.validation_errors&&h.validation_errors.length>0&&(F=`Device configuration validation failed:
`+h.validation_errors.map(B=>`  • ${B}`).join(`
`)),(G=g.value)==null||G.warning(`Profile saved but failed to add to config file:
${F}`,"⚠️ Partial Success")}k("save",{json:ee.value,yaml:Se.value,profile:v.value,saved_to:me.path}),(ae=g.value)==null||ae.success(`File: ${me.filename}
Device Code: ${le}
Added to: smartir/${v.value.platform}.yaml

⚠️ Restart Home Assistant to activate`,"✅ Profile Saved Successfully!"),he()}catch(le){console.error("Error saving profile:",le),(de=g.value)==null||de.error(le.message,"❌ Error Saving Profile")}finally{r.value=!1}}async function Ee(){w.value=!0,_.value=!1,l.value&&(await Re(),l.value=null)}function Y(){var L,i;try{const U=JSON.stringify(ee.value,null,2),G=new Blob([U],{type:"application/json"}),ae=URL.createObjectURL(G),de=document.createElement("a");de.href=ae;const le=v.value.manufacturer.toLowerCase().replace(/\s+/g,"_"),Q=v.value.model.toLowerCase().replace(/\s+/g,"_");de.download=`smartir_${v.value.platform}_${le}_${Q}.json`,document.body.appendChild(de),de.click(),document.body.removeChild(de),URL.revokeObjectURL(ae),(L=g.value)==null||L.success("You can manually upload this file to your SmartIR codes directory.","✅ Profile Downloaded")}catch(U){console.error("Error downloading profile:",U),(i=g.value)==null||i.error(U.message,"❌ Error Downloading Profile")}}async function f(L,i,U){const G=L.toLowerCase().replace(/[^a-z0-9]+/g,"_"),ae=i.toLowerCase().replace(/[^a-z0-9]+/g,"_"),de=`${G}_${ae}`;try{const me=(await ne.get("/api/commands/all")).data[de]||{};console.log(`🔍 Fetching learned commands for device: ${de}`),console.log("📦 Device commands from storage:",me);const Te={...U};for(const[S,h]of Object.entries(Te))if(h==="pending"&&me[S])Te[S]=me[S];else if(typeof h=="object"){for(const[F,B]of Object.entries(h))if(typeof B=="object")for(const[te,pe]of Object.entries(B)){const ce=`${S}_${F}_${te}`;pe==="pending"&&me[ce]&&(Te[S][F][te]=me[ce])}else if(B==="pending"){const te=`${S}_${F}`;me[te]&&(Te[S][F]=me[te])}}return console.log("✅ Merged commands:",Te),Te}catch(le){return console.error("Error fetching learned commands:",le),U}}function $(L){const i={manufacturer:L.manufacturer,supportedModels:[L.model],supportedController:"Broadlink",commandsEncoding:"Base64",commandType:L.commandType||"ir",commands:{}};return L.platform==="climate"&&(i.minTemperature=L.config.minTemp,i.maxTemperature=L.config.maxTemp,i.precision=L.config.precision||1,i.operationModes=L.config.modes||[],i.fanModes=L.config.fanModes&&L.config.fanModes.length>0?L.config.fanModes:["auto"],L.config.swingModes&&L.config.swingModes.length>0&&(i.swingModes=L.config.swingModes),i.commands=L.commands),i}function q(L){let i=`# SmartIR ${L.platform} configuration
`;return i+=`# Generated by Broadlink Manager v2

`,L.platform==="climate"&&(i+=`climate:
`,i+=`  - platform: smartir
`,i+=`    name: ${L.manufacturer} ${L.model}
`,i+=`    unique_id: ${L.manufacturer.toLowerCase()}_${L.model.toLowerCase().replace(/\s+/g,"_")}
`,i+=`    device_code: 10000  # Change this to your custom code number
`,i+=`    controller_data: ${L.broadlinkDevice}
`,L.config.tempSensor&&(i+=`    temperature_sensor: ${L.config.tempSensor}
`),L.config.humiditySensor&&(i+=`    humidity_sensor: ${L.config.humiditySensor}
`),L.config.powerSensor&&(i+=`    power_sensor: ${L.config.powerSensor}
`)),i}async function se(){try{console.log("Fetching remote devices from /api/remote/devices...");const L=await ne.get("/api/remote/devices");console.log("Loaded remote devices response:",L.data);const i=L.data.devices||[];console.log("Extracted devices array:",i),console.log("Device count:",i.length),p.value=i,console.log("broadlinkDevices.value set to:",p.value),console.log("Final device count:",p.value.length)}catch(L){console.error("Error loading remote devices:",L),p.value=[]}}return re(()=>m.show,L=>{if(L){const i=Number.isInteger(m.startStep)?m.startStep:0;s.value=Math.min(Math.max(i,0),b.length-1)}}),re(()=>m.startStep,L=>{if(m.show){const i=Number.isInteger(L)?L:0;s.value=Math.min(Math.max(i,0),b.length-1)}}),Le(()=>{m.show&&se()}),(L,i)=>t.show?(o(),n("div",{key:0,class:"modal-overlay",onClick:Ae},[e("div",{class:"modal-container",onClick:i[19]||(i[19]=ue(()=>{},["stop"]))},[e("div",nu,[e("h2",null,[i[22]||(i[22]=e("i",{class:"mdi mdi-file-document-edit"},null,-1)),x(" "+u(t.editMode?"Edit SmartIR Profile":"Create SmartIR Profile"),1)]),e("button",{onClick:he,class:"close-button"},[...i[23]||(i[23]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",au,[(o(),n(fe,null,$e(b,(U,G)=>e("div",{key:G,class:K(["step",{active:s.value===G,completed:s.value>G}])},[e("div",iu,[s.value>G?(o(),n("i",ru)):(o(),n("span",du,u(G+1),1))]),e("span",uu,u(U.label),1)],2)),64))]),e("div",cu,[s.value===0?(o(),n("div",mu,[i[29]||(i[29]=e("h3",null,"Device Information",-1)),e("div",vu,[i[25]||(i[25]=e("label",null,"Platform Type *",-1)),z(e("select",{"onUpdate:modelValue":i[0]||(i[0]=U=>v.value.platform=U),onChange:Me},[...i[24]||(i[24]=[Pe('<option value="" data-v-2e218e9d>Select platform...</option><option value="climate" data-v-2e218e9d>🌡️ Climate (AC, Heater, Heat Pump)</option><option value="media_player" data-v-2e218e9d>📺 Media Player (TV, Receiver)</option><option value="fan" data-v-2e218e9d>🌀 Fan</option><option value="light" data-v-2e218e9d>💡 Light (LED Strip, IR Light)</option>',5)])],544),[[De,v.value.platform]])]),e("div",pu,[i[26]||(i[26]=e("label",null,"Manufacturer *",-1)),z(e("input",{"onUpdate:modelValue":i[1]||(i[1]=U=>v.value.manufacturer=U),type:"text",placeholder:"e.g., Daikin, LG, Samsung"},null,512),[[xe,v.value.manufacturer]])]),e("div",fu,[i[27]||(i[27]=e("label",null,"Model(s) *",-1)),z(e("input",{"onUpdate:modelValue":i[2]||(i[2]=U=>v.value.model=U),type:"text",placeholder:"e.g., FTXS35K, Multiple models"},null,512),[[xe,v.value.model]]),i[28]||(i[28]=e("small",null,'Enter model number or "Multiple" if it works with many models',-1))])])):T("",!0),s.value===1?(o(),n("div",gu,[v.value.platform==="climate"?(o(),Oe(Er,{key:0,modelValue:v.value.config,"onUpdate:modelValue":i[3]||(i[3]=U=>v.value.config=U)},null,8,["modelValue"])):v.value.platform==="media_player"?(o(),n("div",yu,[i[36]||(i[36]=e("h3",null,"Media Player Configuration",-1)),i[37]||(i[37]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),x(" Configure the features your media player supports. You'll learn the IR commands in the next step. ")],-1)),e("div",bu,[i[35]||(i[35]=e("h4",null,"Supported Features",-1)),e("div",hu,[e("label",ku,[z(e("input",{type:"checkbox",value:"turn_on","onUpdate:modelValue":i[4]||(i[4]=U=>E.value=U)},null,512),[[ve,E.value]]),i[30]||(i[30]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),x(" Power On/Off ")],-1))]),e("label",wu,[z(e("input",{type:"checkbox",value:"volume","onUpdate:modelValue":i[5]||(i[5]=U=>E.value=U)},null,512),[[ve,E.value]]),i[31]||(i[31]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-volume-high"}),x(" Volume Control ")],-1))]),e("label",$u,[z(e("input",{type:"checkbox",value:"mute","onUpdate:modelValue":i[6]||(i[6]=U=>E.value=U)},null,512),[[ve,E.value]]),i[32]||(i[32]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-volume-mute"}),x(" Mute ")],-1))]),e("label",Cu,[z(e("input",{type:"checkbox",value:"source","onUpdate:modelValue":i[7]||(i[7]=U=>E.value=U)},null,512),[[ve,E.value]]),i[33]||(i[33]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-import"}),x(" Source Selection ")],-1))]),e("label",Su,[z(e("input",{type:"checkbox",value:"channel","onUpdate:modelValue":i[8]||(i[8]=U=>E.value=U)},null,512),[[ve,E.value]]),i[34]||(i[34]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-numeric"}),x(" Channel Control ")],-1))])])])])):v.value.platform==="fan"?(o(),n("div",_u,[i[44]||(i[44]=e("h3",null,"Fan Configuration",-1)),i[45]||(i[45]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),x(" Configure the features your fan supports. You'll learn the IR commands in the next step. ")],-1)),e("div",Du,[i[40]||(i[40]=e("h4",null,"Fan Speed Levels",-1)),e("div",Iu,[i[39]||(i[39]=e("label",null,"Number of Speed Levels *",-1)),z(e("select",{"onUpdate:modelValue":i[9]||(i[9]=U=>H.value=U)},[...i[38]||(i[38]=[e("option",{value:1},"1 Speed",-1),e("option",{value:2},"2 Speeds",-1),e("option",{value:3},"3 Speeds (Low/Med/High)",-1),e("option",{value:4},"4 Speeds",-1),e("option",{value:5},"5 Speeds",-1),e("option",{value:6},"6 Speeds",-1)])],512),[[De,H.value,void 0,{number:!0}]])])]),e("div",Tu,[i[43]||(i[43]=e("h4",null,"Additional Features",-1)),e("div",xu,[e("label",Mu,[z(e("input",{type:"checkbox",value:"oscillate","onUpdate:modelValue":i[10]||(i[10]=U=>Z.value=U)},null,512),[[ve,Z.value]]),i[41]||(i[41]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-sync"}),x(" Oscillation ")],-1))]),e("label",Ru,[z(e("input",{type:"checkbox",value:"direction","onUpdate:modelValue":i[11]||(i[11]=U=>Z.value=U)},null,512),[[ve,Z.value]]),i[42]||(i[42]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-rotate-3d-variant"}),x(" Direction (Forward/Reverse) ")],-1))])])])])):v.value.platform==="light"?(o(),n("div",Lu,[i[51]||(i[51]=e("h3",null,"Light Configuration",-1)),i[52]||(i[52]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),x(" Configure the features your light supports. You'll learn the IR commands in the next step. ")],-1)),e("div",Au,[i[50]||(i[50]=e("h4",null,"Supported Features",-1)),e("div",Eu,[e("label",Ou,[z(e("input",{type:"checkbox",value:"turn_on","onUpdate:modelValue":i[12]||(i[12]=U=>N.value=U)},null,512),[[ve,N.value]]),i[46]||(i[46]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),x(" Power On/Off ")],-1))]),e("label",Vu,[z(e("input",{type:"checkbox",value:"brightness","onUpdate:modelValue":i[13]||(i[13]=U=>N.value=U)},null,512),[[ve,N.value]]),i[47]||(i[47]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-brightness-6"}),x(" Brightness Control ")],-1))]),e("label",Pu,[z(e("input",{type:"checkbox",value:"color_temp","onUpdate:modelValue":i[14]||(i[14]=U=>N.value=U)},null,512),[[ve,N.value]]),i[48]||(i[48]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-thermometer"}),x(" Color Temperature ")],-1))]),e("label",Uu,[z(e("input",{type:"checkbox",value:"rgb","onUpdate:modelValue":i[15]||(i[15]=U=>N.value=U)},null,512),[[ve,N.value]]),i[49]||(i[49]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-palette"}),x(" RGB Color ")],-1))])])])])):T("",!0)])):T("",!0),s.value===2?(o(),n("div",Fu,[be(vd,{modelValue:v.value.commands,"onUpdate:modelValue":i[16]||(i[16]=U=>v.value.commands=U),platform:v.value.platform,config:v.value.config,broadlinkDevice:v.value.broadlinkDevice,"onUpdate:broadlinkDevice":i[17]||(i[17]=U=>v.value.broadlinkDevice=U),manufacturer:v.value.manufacturer,model:v.value.model,commandType:v.value.commandType,"onUpdate:commandType":i[18]||(i[18]=U=>v.value.commandType=U)},null,8,["modelValue","platform","config","broadlinkDevice","manufacturer","model","commandType"])])):T("",!0),s.value===3?(o(),n("div",ju,[be(Ud,{profile:v.value,"json-data":ee.value,"yaml-config":Se.value},null,8,["profile","json-data","yaml-config"])])):T("",!0)]),e("div",Nu,[s.value>0?(o(),n("button",{key:0,onClick:ge,class:"btn-secondary"},[...i[53]||(i[53]=[e("i",{class:"mdi mdi-arrow-left"},null,-1),x(" Back ",-1)])])):T("",!0),i[57]||(i[57]=e("div",{class:"spacer"},null,-1)),e("button",{onClick:he,class:"btn-text"}," Cancel "),s.value<b.length-1?(o(),n("button",{key:1,onClick:V,class:"btn-primary",disabled:!M.value},[...i[54]||(i[54]=[x(" Next ",-1),e("i",{class:"mdi mdi-arrow-right"},null,-1)])],8,Bu)):(o(),n("div",Hu,[e("button",{onClick:Re,class:"btn-primary",disabled:r.value},[i[55]||(i[55]=e("i",{class:"mdi mdi-cloud-upload"},null,-1)),x(" "+u(r.value?"Saving...":"Save to SmartIR"),1)],8,qu),e("button",{onClick:Y,class:"btn-secondary",disabled:r.value},[...i[56]||(i[56]=[e("i",{class:"mdi mdi-download"},null,-1),x(" Download JSON ",-1)])],8,zu)]))])]),be(su,{show:_.value,platform:v.value.platform,warnings:C.value,"config-path":O.value,onClose:i[20]||(i[20]=U=>_.value=!1),onComplete:Ee},null,8,["show","platform","warnings","config-path"]),be(Ue,{isOpen:R.value,title:"Change Command Type?",message:"Changing the command type will clear all learned commands. Continue?",confirmText:"Continue",cancelText:"Cancel",dangerMode:!0,onConfirm:I,onCancel:d},null,8,["isOpen"]),be(Ue,{isOpen:W.value,title:"Close Profile Builder?",message:"Are you sure you want to close? Your progress will be lost.",confirmText:"Close",cancelText:"Keep Editing",dangerMode:!0,onConfirm:ye,onCancel:i[21]||(i[21]=U=>W.value=!1)},null,8,["isOpen"])])):T("",!0)}},Wu=ke(Ju,[["__scopeId","data-v-2e218e9d"]]),Ku={class:"dashboard"},Xu={key:1,class:"welcome-banner"},Gu={__name:"Dashboard",setup(t){const c=je(),m=Ie("smartirEnabled"),{isMobile:k}=Ye(),g=y(!1),s=y(!1),r=y(null),p=y(0),_=y(null),C=y(localStorage.getItem("welcome_banner_dismissed")==="true");function O(){C.value=!0,localStorage.setItem("welcome_banner_dismissed","true")}function w(){s.value=!1,r.value=null,p.value=0,g.value=!0}async function l({platform:P,profile:D,startStep:a}){p.value=Number.isInteger(a)?a:0;try{const b=await fetch(`api/smartir/platforms/${P}/profiles/${D.code}`);if(!b.ok)throw new Error("Failed to load profile");const v=await b.json();let E="";try{const H=await fetch(`api/smartir/config/get-device?platform=${P}&code=${D.code}`);H.ok?(E=(await H.json()).controller_data||"",console.log("✅ Found controller_data from YAML:",E)):console.warn("⚠️ No YAML entry found for this profile (this is OK for profiles not yet added to config)")}catch(H){console.warn("⚠️ Could not fetch controller_data from config:",H)}s.value=!0,r.value={platform:P,code:D.code,profile:{...v.profile,controller_data:E}},g.value=!0}catch(b){console.error("Error loading profile for edit:",b),c.error("Failed to load profile for editing")}}function R(){g.value=!1,s.value=!1,r.value=null}async function W(P){console.log("Profile saved:",P),R(),_.value&&_.value.loadAllProfiles&&(await _.value.loadAllProfiles(),console.log("✅ Profiles list refreshed"))}return(P,D)=>(o(),n("div",Ku,[Ce(m)?(o(),Oe(jn,{key:0})):T("",!0),!Ce(k)&&!C.value?(o(),n("div",Xu,[e("button",{class:"dismiss-button",onClick:O,title:"Dismiss"},[...D[0]||(D[0]=[e("i",{class:"mdi mdi-close"},null,-1)])]),D[1]||(D[1]=Pe('<div class="banner-content" data-v-12185d74><div class="banner-icon" data-v-12185d74><i class="mdi mdi-rocket-launch" data-v-12185d74></i></div><div class="banner-text" data-v-12185d74><h2 data-v-12185d74>Welcome to Broadlink Manager v2!</h2><p data-v-12185d74>Manage your IR/RF devices with a modern Vue 3 interface</p></div></div><div class="status-badges" data-v-12185d74><span class="badge success" data-v-12185d74><i class="mdi mdi-check-circle" data-v-12185d74></i> Vue 3 Ready </span><span class="badge warning" data-v-12185d74><i class="mdi mdi-beta" data-v-12185d74></i> Beta </span></div>',2))])):T("",!0),be(En),Ce(m)?(o(),Oe(Ui,{key:2,ref_key:"smartirStatusCard",ref:_,onCreateProfile:w,onEditProfile:l},null,512)):T("",!0),be(Wu,{show:g.value,editMode:s.value,editData:r.value,startStep:p.value,onClose:R,onSave:W},null,8,["show","editMode","editData","startStep"])]))}},Yu=ke(Gu,[["__scopeId","data-v-12185d74"]]),Zu={class:"toast-container"},Qu={class:"toast-content"},ec={key:0,class:"toast-title"},tc={class:"toast-message"},lc={key:1,class:"toast-description"},oc=["onClick","title"],sc={__name:"Toast",setup(t,{expose:c}){const m=y([]);let k=0;function g(p){const _={success:"mdi-check-circle",error:"mdi-alert-circle",warning:"mdi-alert",info:"mdi-information"};return _[p]||_.info}function s({message:p,title:_,description:C,type:O="info",duration:w=5e3}){const l=k++,R={id:l,message:p,title:_,description:C,type:O};return m.value.push(R),w>0&&setTimeout(()=>{r(l)},w),l}function r(p){const _=m.value.findIndex(C=>C.id===p);_>-1&&m.value.splice(_,1)}return c({addToast:s,removeToast:r,show:s,success:(p,_)=>s({message:p,title:_,type:"success"}),error:(p,_)=>s({message:p,title:_,type:"error",duration:0}),warning:(p,_)=>s({message:p,title:_,type:"warning",duration:0}),info:(p,_)=>s({message:p,title:_,type:"info"})}),(p,_)=>(o(),Oe(lt,{to:"body"},[e("div",Zu,[be(dt,{name:"toast"},{default:Ge(()=>[(o(!0),n(fe,null,$e(m.value,C=>(o(),n("div",{key:C.id,class:K(["toast",[`toast-${C.type}`,{"toast-persistent":C.type==="error"||C.type==="warning"}]])},[e("i",{class:K(["mdi",g(C.type)])},null,2),e("div",Qu,[C.title?(o(),n("div",ec,u(C.title),1)):T("",!0),e("div",tc,u(C.message),1),C.description?(o(),n("div",lc,u(C.description),1)):T("",!0)]),e("button",{onClick:O=>r(C.id),class:K(["toast-close",{"toast-close-prominent":C.type==="error"||C.type==="warning"}]),title:C.type==="error"||C.type==="warning"?"Click to dismiss":"Close"},[..._[0]||(_[0]=[e("i",{class:"mdi mdi-close"},null,-1)])],10,oc)],2))),128))]),_:1})])]))}},nc=ke(sc,[["__scopeId","data-v-3948c088"]]),ac="0.3.0-alpha.2",ic={version:ac},rc={id:"app",class:"app-container"},dc={class:"app-header"},uc={class:"header-content"},cc={class:"header-right"},mc=["title"],vc={class:"settings-menu-container"},pc={key:0,class:"settings-menu"},fc=["title"],gc={class:"toggle-content"},yc={key:0,class:"not-installed-label"},bc={key:0,href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"menu-item menu-link menu-subitem"},hc=["disabled"],kc=["disabled"],wc=["disabled"],$c={class:"app-main"},Cc={class:"app-footer"},Sc={__name:"App",setup(t){const c=y(null),m=ic.version,k=y("light"),g=y(null),s=y(!1),r=y(!1),p=y(!1),_=y(localStorage.getItem("smartir_enabled")!=="false"),C=J(()=>{var v;return((v=g.value)==null?void 0:v.installed)||!1}),O=J(()=>({light:"mdi mdi-weather-sunny",medium:"mdi mdi-weather-partly-cloudy",dark:"mdi mdi-weather-night"})[k.value]),w=J(()=>({light:"Switch to Medium Theme",medium:"Switch to Dark Theme",dark:"Switch to Light Theme"})[k.value]),l=()=>{const v=["light","medium","dark"],H=(v.indexOf(k.value)+1)%v.length;k.value=v[H],document.body.classList.remove("medium-mode","dark-mode"),k.value==="medium"?document.body.classList.add("medium-mode"):k.value==="dark"&&document.body.classList.add("dark-mode"),localStorage.setItem("theme",k.value)},R=async()=>{try{const v=await st.getStatus();g.value=v,v.installed?console.log("✅ SmartIR detected:",v.version):console.log("ℹ️ SmartIR not detected")}catch(v){console.error("Error checking SmartIR:",v),g.value={installed:!1,error:v.message}}},W=async()=>{var v,E,H;r.value=!0;try{const N=(await ne.get("/api/diagnostics/markdown")).data.markdown;if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(N),(v=c.value)==null||v.success("Diagnostic summary copied to clipboard!");else{const oe=document.createElement("textarea");oe.value=N,oe.style.position="fixed",oe.style.left="-999999px",oe.style.top="-999999px",document.body.appendChild(oe),oe.focus(),oe.select();try{if(document.execCommand("copy"))(E=c.value)==null||E.success("Diagnostic summary copied to clipboard!");else throw new Error("execCommand failed")}finally{document.body.removeChild(oe)}}s.value=!1}catch(Z){console.error("Error copying diagnostics:",Z),(H=c.value)==null||H.error("Failed to copy diagnostics: "+Z.message)}finally{r.value=!1}},P=async()=>{var v,E;r.value=!0;try{const H=await ne.get("/api/diagnostics/download",{responseType:"blob"}),Z=window.URL.createObjectURL(new Blob([H.data])),N=document.createElement("a");N.href=Z;const oe=H.headers["content-disposition"];let A="broadlink_manager_diagnostics.zip";if(oe){const j=oe.match(/filename="?(.+)"?/);j&&(A=j[1])}N.setAttribute("download",A),document.body.appendChild(N),N.click(),N.remove(),window.URL.revokeObjectURL(Z),(v=c.value)==null||v.success("Diagnostic bundle downloaded!"),s.value=!1}catch(H){console.error("Error downloading diagnostics:",H),(E=c.value)==null||E.error("Failed to download diagnostics")}finally{r.value=!1}},D=()=>{C.value&&(_.value=!_.value,localStorage.setItem("smartir_enabled",_.value.toString()),window.location.reload())},a=async()=>{var v,E,H;p.value=!0;try{const Z=await ne.post("/api/smartir/refresh-index");Z.data.success?(v=c.value)==null||v.success(`Updated to v${Z.data.version} (${Z.data.total_devices} devices)`,"✅ Index Updated"):(E=c.value)==null||E.error(Z.data.error||"Unknown error","❌ Update Failed")}catch(Z){console.error("Error updating SmartIR index:",Z),(H=c.value)==null||H.error("Failed to update device index","❌ Update Error")}finally{p.value=!1,s.value=!1}},b=v=>{v.target.closest(".settings-menu-container")||(s.value=!1)};return Le(async()=>{const v=localStorage.getItem("theme");v&&["light","medium","dark"].includes(v)?(k.value=v,v==="medium"?document.body.classList.add("medium-mode"):v==="dark"&&document.body.classList.add("dark-mode")):localStorage.getItem("darkMode")==="true"&&(k.value="dark",document.body.classList.add("dark-mode"),localStorage.setItem("theme","dark")),await R();const E=et();E&&c.value&&(E.appContext.config.globalProperties.$toast=c.value),document.addEventListener("click",b)}),Ke(()=>{document.removeEventListener("click",b)}),He("smartirStatus",g),He("smartirEnabled",_),He("refreshSmartIR",R),He("toast",c),(v,E)=>(o(),n("div",rc,[e("header",dc,[e("div",uc,[E[13]||(E[13]=e("div",{class:"header-left"},[e("i",{class:"mdi mdi-remote"}),e("h1",null,"Broadlink Manager v2"),e("span",{class:"beta-badge"},"BETA")],-1)),e("div",cc,[e("button",{onClick:l,class:"icon-button",title:w.value},[e("i",{class:K(O.value)},null,2)],8,mc),e("div",vc,[e("button",{onClick:E[0]||(E[0]=H=>s.value=!s.value),class:"icon-button",title:"Settings"},[...E[2]||(E[2]=[e("i",{class:"mdi mdi-cog"},null,-1)])]),s.value?(o(),n("div",pc,[E[9]||(E[9]=e("div",{class:"menu-section-title"},"Integration Settings",-1)),e("div",{class:K(["menu-item toggle-item",{disabled:!C.value}]),onClick:E[1]||(E[1]=H=>C.value?D():null),title:C.value?"":"SmartIR is not installed"},[e("div",gc,[E[3]||(E[3]=e("i",{class:"mdi mdi-air-conditioner"},null,-1)),E[4]||(E[4]=e("span",null,"SmartIR Integration",-1)),C.value?T("",!0):(o(),n("span",yc,"(Not Installed)"))]),e("div",{class:K(["toggle-switch",{active:_.value&&C.value,disabled:!C.value}])},[...E[5]||(E[5]=[e("div",{class:"toggle-slider"},null,-1)])],2)],10,fc),_.value?(o(),n("a",bc,[...E[6]||(E[6]=[e("i",{class:"mdi mdi-github"},null,-1),e("span",null,"SmartIR on GitHub",-1)])])):T("",!0),_.value?(o(),n("button",{key:1,onClick:a,class:"menu-item menu-subitem",disabled:p.value},[e("i",{class:K(["mdi",p.value?"mdi-loading mdi-spin":"mdi-refresh"])},null,2),e("span",null,u(p.value?"Updating...":"Update Device Index"),1)],8,hc)):T("",!0),E[10]||(E[10]=e("div",{class:"menu-divider"},null,-1)),E[11]||(E[11]=e("div",{class:"menu-section-title"},"Diagnostics",-1)),e("button",{onClick:W,class:"menu-item",disabled:r.value},[...E[7]||(E[7]=[e("i",{class:"mdi mdi-content-copy"},null,-1),e("span",null,"Copy Diagnostics",-1)])],8,kc),e("button",{onClick:P,class:"menu-item",disabled:r.value},[...E[8]||(E[8]=[e("i",{class:"mdi mdi-download"},null,-1),e("span",null,"Download Diagnostics",-1)])],8,wc),E[12]||(E[12]=Pe('<div class="menu-divider" data-v-4bc2c39f></div><div class="menu-section-title" data-v-4bc2c39f>Help &amp; Support</div><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2#readme" target="_blank" class="menu-item menu-link" data-v-4bc2c39f><i class="mdi mdi-book-open-variant" data-v-4bc2c39f></i><span data-v-4bc2c39f>Documentation</span></a><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2/issues" target="_blank" class="menu-item menu-link" data-v-4bc2c39f><i class="mdi mdi-bug" data-v-4bc2c39f></i><span data-v-4bc2c39f>Report Issue</span></a><div class="menu-divider" data-v-4bc2c39f></div><div class="menu-section-title" data-v-4bc2c39f>Community</div><a href="https://community.home-assistant.io/t/broadlink-manager-modern-web-interface-for-broadlink-devices/938473" target="_blank" class="menu-item menu-link" data-v-4bc2c39f><i class="mdi mdi-forum" data-v-4bc2c39f></i><span data-v-4bc2c39f>HA Forum Discussion</span></a><a href="https://www.reddit.com/r/homeassistant/comments/1o1q3kf/release_broadlink_manager_addon_a_modern_web_ui/" target="_blank" class="menu-item menu-link" data-v-4bc2c39f><i class="mdi mdi-reddit" data-v-4bc2c39f></i><span data-v-4bc2c39f>Reddit Discussion</span></a><div class="menu-divider" data-v-4bc2c39f></div><div class="menu-section-title" data-v-4bc2c39f>Project</div><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2" target="_blank" class="menu-item menu-link" data-v-4bc2c39f><i class="mdi mdi-github" data-v-4bc2c39f></i><span data-v-4bc2c39f>GitHub Repository</span></a><a href="https://ko-fi.com/tonyperkins" target="_blank" class="menu-item menu-link menu-item-sponsor" data-v-4bc2c39f><i class="mdi mdi-coffee" data-v-4bc2c39f></i><span data-v-4bc2c39f>Support on Ko-fi</span></a>',12))])):T("",!0)])])])]),e("main",$c,[be(Yu)]),e("footer",Cc,[e("p",null,"Broadlink Manager v"+u(Ce(m))+" | Built with Vue "+u(ut),1)]),be(nc,{ref_key:"toastRef",ref:c},null,512)]))}},_c=ke(Sc,[["__scopeId","data-v-4bc2c39f"]]),nt=ct(_c),Dc=mt();nt.use(Dc);nt.mount("#app");
