import{g as et,r as y,o as Ae,a as Xe,b as dt,d as ut,c as G,e as a,f as n,h as e,i as M,n as K,u as $e,t as p,j as R,F as ce,k as ke,w as ae,l as W,v as Me,m as ue,p as ge,q as qe,s as Ye,T as tt,x as Ie,y as Te,z as je,A as ve,B as ot,C as Ne,D as Pe,E as lt,G as Je,H as ct,I as mt,J as vt,K as ze,L as pt,M as ft}from"./vendor-DGiFqQ_g.js";(function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const w of document.querySelectorAll('link[rel="modulepreload"]'))_(w);new MutationObserver(w=>{for(const r of w)if(r.type==="childList")for(const m of r.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&_(m)}).observe(document,{childList:!0,subtree:!0});function i(w){const r={};return w.integrity&&(r.integrity=w.integrity),w.referrerPolicy&&(r.referrerPolicy=w.referrerPolicy),w.crossOrigin==="use-credentials"?r.credentials="include":w.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function _(w){if(w.ep)return;w.ep=!0;const r=i(w);fetch(w.href,r)}})();let Qe=!1;function He(){const t=et(),u=t==null?void 0:t.appContext.config.globalProperties.$toast;return u||(Qe||(console.warn("Toast notification system not yet initialized - using console fallback"),Qe=!0),{success:i=>console.log("✓",i),error:i=>console.error("✗",i),warning:i=>console.warn("⚠",i),info:i=>console.info("ℹ",i)})}function Ze(){const t=y(!1),u=y(!1),i=y(!1),_=y(0),w=767,r=768,m=1023,g=1024,T=()=>{const I=window.innerWidth;_.value=I,t.value=I<=w,u.value=I>=r&&I<=m,i.value=I>=g};return Ae(()=>{T(),window.addEventListener("resize",T)}),Xe(()=>{window.removeEventListener("resize",T)}),{isMobile:t,isTablet:u,isDesktop:i,screenWidth:_,isMobileOrTablet:()=>t.value||u.value,isTabletOrDesktop:()=>u.value||i.value}}const Ge="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAHBUlEQVR4nOxZC1BTVxo+9+aNZI2LNsgjWR4hgoIiRVDBslKnIKPbx1jqTrtYoakat1a6dNsdd7t1X8XHyAbEhdUu1u2mXdbasqJbtsaMIqBBECiPBmqEICEBEx4xJLlJ7s6lw6rJDeQ2FzLM+M1kBs7/3+/83zn/Oee/51JRFAXzGbCvA/AWjwX4GvNeANWXnXffHQ4+K6/dYbHeD+IFhjRkb1wn9WPQbEQ4IF/tQlXX2p5+/8OyczY74j/VxuMG3Sh/Oz9jaQDb4CmPT1LIbLXBfzrz0cmHg8fQpx1Yc1Ra+TsiXD4R0PqtRmAyj/LxbJeaujKIcPlEAINOM7vLXBaTZibCRWgRq3WGJZWX63aoNDpB8BJOX/bGlIqwpUv6iXBgWBHG7eUF8urUWvU6Z9sLGxI/IsLl8SJu6u4XigqPXkVspiVTbTQqU1/6Vn7ammh+G5FOMZyqludIKqUVU/9jcaSuTCo/unfHbiad4iBdwMu/P1bV1tO1xbk9NDC0/vwHB1xGcjqYLAh16zsHW3R6XXTu1mfFdAqMrIoSKNbGhLcQ4QGeppDJ7ACtPcqNEI6tT9O3Vqm+tygqNMDjrU9Sef6tIYM2JjUuuXzfC5knCEXsBI8WMZUCAxiCrfhWyMZkMNzYXNHVpwmXXqp5j0Hz0/1m57a3PQ8VHx4JoNMASIl9shLPFsB5ooO7iDXhCY/dAcCvT/79LwC1s/K2bDnAXcQeJRqwMzzeRt/bua0gLChcDsCDNQNBkEU/qot7o6j0kzETQpuJ40ZnT6xSrUoNWhyseHVz2ikv4n4QA5FSArE5IFlTZ0r3XU1MWODib6NCl3a9dkhSYxgbjo4XLq8sL9j7Ip36YEwMRjMNQazMhf7+RgYNnuyo7bY6ArFaWKuXRX495wLwoLk39sO9RaVnM5OTP8zLSjtjsljpp6ovi6pqr706eE8XBwGUSqEy9Guihf/92TMZhetjI5rJCHwKpBRzZqsNYtKp6KD+Pvv1w5ILdzR3UvD8HA4YefOl7N25JKUPIKuUwIJH7A5of/GJf7oLfrIz2EH786fSss+uKFzOk+8L0mqh6rpbmR0q5YyFGAQBSuHHlcUWxEaZyXfMhFD0Rgt9Oh/SBMiam58HAO+oc4XZMsK/1taT6M6uHjJw8w6VSNfvemM8TbzPlFlwsP5KyzfJeL6kCejXDgo894aASqOZ9O/uHwzq6B3ijhitkzOC7XS7j0g+V3S0vQTDDhYEoZSBobvJ+yXFNZ29gy4lOGmvlDBMIfQqSKV8539EWvXHhvbGHBSFrAwGW+vvxzLoR7RxzrNpsyPs0xcv7/lg1/ZfPtKvuw7MVhulUakWdvRq+XY3tWFT90Bk+52BCOzvyOBgjytSFKAgms+b9F/2o+BbKwUrvgjhhjSjKLAPG4YE7lJxfEIf5dyGOwMXrren/eF0RYXRNMrHDt4QbmjDEbHop9F8rqpddZd3sV6R/aWiabtWr41PW534V8m+PFHW+qSPL9TX7oM8WAaBi4IbE4S8yYNs/7asIgBA0ZStRqFM/MXxIzcgHBEBP+C6DJKLgJvK3uXvniitBsDmNzkSEAD9uv5k0aFjXy1gMQ0DQ5p4CAIwNuXLwyL/ExcpqMWeS42NUmxKXFf8VWPdz6cLnkqhGd/Pe+U1Cow/+ekJUYr4qJgvbik7f/Jw+0J/tjpvS3qxs7/LQZZfcrrkUmOdGI/cgUKIkB8pz0xK+CQjKf6z4MWckYftZqsderfsTInsZt0evDRgMRYMHhaLnk+NW1Y/nchxk5lZ+I/Pf/vl9RvbLYiVlSBcJv/VK9sKBCHc3hkF7D12/NzVltZn8YhzNj/3ev6LGeXTdQ6+uzLZ+C+5XNza05Nsd1gXcNgBvekJK/+du3lTUSiXMzzT80TgkkK8wJAGgCMAE5ooFFz3hHTr+lgZ9iMryOngkoi5WZuOc9hPtDu3r4198nTqygjCr3wYmrvVkSerZXljJoT0m0DcYm5g2Mg5WV39zrVWZZofkzaRnhB/bufm9FI/JpXQXj8F8bHyitqWxhzJmwUJT60SNJER+P+BCZjt34lzNbvickRoWVWNmGzuObnYWhER3oAdX41dPbj1jDeYEwGrInltKKCNtatub6hRfJOEnfJkcc+JgE9ltS/DkINuNI3xCo4fbXgm/0CnouvOcjK4Z/16/ZKia+3+kqIrEIQ+sgNx2Jzb5wsPxrD9GBZv+Gd9BqSXr4icg8cwMj4SLmv6+mlv+WddgGlilOPOZkEmFnrLP+sCVgtXyPHaHShkiw0XXPWWf9YF5Gb9uGzp4sCbj7ai4LkNTx2O5nPV3vLPyTeye6P32X+7KNujVKtSYJg+viEu/mx2etJZCgnD57OPfGRh3n8nfizA15j3Av4XAAD//5k1S2w3zfwVAAAAAElFTkSuQmCC",Q=dt.create({baseURL:"./",timeout:3e4,headers:{"Content-Type":"application/json","Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"}});Q.interceptors.request.use(t=>t,t=>Promise.reject(t));Q.interceptors.response.use(t=>t,t=>(console.error("API Error:",t),t.response?console.error("Response error:",t.response.data):t.request?console.error("No response received"):console.error("Request setup error:",t.message),Promise.reject(t)));const gt=ut("devices",{state:()=>({devices:[],loading:!1,error:null,selectedDevice:null}),getters:{deviceById:t=>u=>t.devices.find(i=>i.id===u),devicesByType:t=>u=>t.devices.filter(i=>i.entity_type===u),deviceCount:t=>t.devices.length,hasDevices:t=>t.devices.length>0},actions:{async loadDevices(t=!1){this.loading=!0,this.error=null;try{const u=t?`/api/devices/managed?_t=${Date.now()}`:"/api/devices/managed",i=await Q.get(u);this.devices=i.data.devices||[],console.log("📥 Loaded devices:",this.devices),this.devices.forEach(_=>{console.log(`📥 Device "${_.name}":`,{id:_.id,device:_.device,commands:_.commands,commandCount:_.commands?Object.keys(_.commands).length:0})})}catch(u){this.error=u.message,console.error("Error loading devices:",u)}finally{this.loading=!1}},async createDevice(t){this.loading=!0,this.error=null;try{console.log("🏪 Store: Creating device with data:",t),console.log("🏪 Store: Device commands being sent:",t.commands);const u={device_name:t.name,device:t.device,area_id:t.area||"",area_name:t.area||"",entity_type:t.entity_type,icon:t.icon,broadlink_entity:t.broadlink_entity,device_type:t.device_type||"broadlink",commands:t.commands||{}};t.device_type==="smartir"&&t.smartir_config&&(u.smartir_config=t.smartir_config),console.log("🏪 Store: Transformed data for backend:",u);const i=await Q.post("/api/devices/managed",u);return console.log("🏪 Store: Create response:",i.data),await this.loadDevices(),i.data}catch(u){throw console.error("Error creating device:",u),u}finally{this.loading=!1}},async updateDevice(t,u){this.loading=!0,this.error=null;try{const i=await Q.put(`/api/devices/managed/${t}`,u);return await this.loadDevices(),i.data}catch(i){throw console.error("Error updating device:",i),i}finally{this.loading=!1}},async deleteDevice(t,u=!1){this.loading=!0,this.error=null;try{await Q.delete(`/api/devices/managed/${t}`,{data:{delete_commands:u}}),this.devices=this.devices.filter(i=>i.id!==t)}catch(i){throw this.error=i.message,console.error("Error deleting device:",i),i}finally{this.loading=!1}},selectDevice(t){this.selectedDevice=t},clearSelection(){this.selectedDevice=null},clearError(){this.error=null},updateDeviceCommands(t,u){const i=this.devices.findIndex(_=>_.id===t);if(i!==-1){const _={...this.devices[i],commands:u};this.devices.splice(i,1,_),console.log(`✅ Store: Updated commands for ${t}, count: ${Object.keys(u).length}`)}else console.warn(`⚠️ Store: Device ${t} not found for command update`)},async syncAllAreas(){if(!this.devices||this.devices.length===0){console.log("⚠️ No devices to sync");return}console.log(`🔄 Syncing areas from Home Assistant for ${this.devices.length} devices...`);try{const t=await Promise.all(this.devices.map(_=>(console.log(`🔄 Syncing device: ${_.id} (${_.name})`),Q.post(`/api/devices/${_.id}/sync-area`).then(w=>w.data.success&&w.data.area?(console.log(`✅ Synced area for ${_.name}: ${w.data.area}`),{status:"synced",device:_.name}):{status:"no_area"}).catch(w=>{var r;return((r=w.response)==null?void 0:r.status)===404?(console.log(`❌ Device not found in HA: ${_.id}`),{status:"not_found"}):(console.warn(`⚠️ Failed to sync area for ${_.id}:`,w.message),{status:"error",error:w.message})})))),u=t.filter(_=>_.status==="synced").length,i=t.filter(_=>_.status==="not_found").length;await this.loadDevices(!0),u>0?console.log(`✅ Area sync complete: ${u} synced, ${i} not found in HA`):i>0&&console.log(`ℹ️ No areas synced - ${i} entities not found in HA registry (generate entities first)`)}catch(t){console.debug("Area sync error:",t)}}}});function nt(t){const u=G(()=>t.value||t),i=G(()=>{switch(u.value){case"climate":return"mdi:air-conditioner";case"fan":return"mdi:fan";case"light":return"mdi:lightbulb";case"media_player":return"mdi:television";case"switch":return"mdi:light-switch";default:return"mdi:devices"}}),_=G(()=>`device-type-${u.value}-color`),w=G(()=>`tag-${u.value}-bg`);return{icon:i,colorClass:_,tagBgClass:w}}const st=""+new URL("broadlink-logo-BDjImjRY.png",import.meta.url).href,we=(t,u)=>{const i=t.__vccOpts||t;for(const[_,w]of u)i[_]=w;return i},yt={class:"device-header"},bt={class:"device-info"},ht=["title"],kt={class:"device-labels"},wt={class:"device-type"},$t=["src","alt","title"],Ct={class:"device-body"},_t={class:"device-stats"},St={class:"stat",title:"Learned command count"},It={class:"stat",title:"HA Assigned Area"},Dt={class:"device-meta"},Tt={class:"device-id",title:"Device ID"},xt={key:0,class:"storage-name"},Rt={key:1,class:"broadlink-entity",title:"Controller Device"},Mt={key:2,class:"controller-device"},At={class:"device-actions"},Ot=["disabled"],Et=["disabled"],Lt=["disabled"],Vt={key:0,class:"disabled-overlay"},Pt={__name:"DeviceCard",props:{device:{type:Object,required:!0},broadlinkDevices:{type:Array,default:()=>[]}},emits:["edit","delete","learn"],setup(t){const u=t,i=G(()=>localStorage.getItem("smartir_simulate_not_installed")==="true"),_=G(()=>u.device.device_type==="smartir"&&i.value),w=y(null),r=nt(G(()=>u.device.entity_type)),m=G(()=>u.device.icon?u.device.icon:r.icon.value),g=s=>s&&s.startsWith("mdi:")?`mdi ${s.replace(":"," mdi-")}`:`mdi mdi-${s}`,T=G(()=>({light:"Light",fan:"Fan",switch:"Switch",media_player:"Media Player",cover:"Cover"})[u.device.entity_type]||u.device.entity_type),I=G(()=>(u.device.device_type||"broadlink")==="smartir"?"SmartIR":"Broadlink"),U=G(()=>(u.device.device_type||"broadlink")==="smartir"?Ge:st),C=G(()=>(u.device.device_type||"broadlink")==="smartir"?w.value!==null?w.value:0:Object.keys(u.device.commands||{}).length),o=s=>{if(!s)return"";const h=u.broadlinkDevices.find(f=>f.entity_id===s);return h&&h.name||s},V=G(()=>{if(!u.device.device)return!1;const s=u.device.id.includes(".")?u.device.id.split(".")[1]:u.device.id;return u.device.device!==s}),q=G(()=>{if(!u.device.broadlink_entity)return"";const s=u.broadlinkDevices.find(h=>h.entity_id===u.device.broadlink_entity);return s&&s.name||u.device.broadlink_entity}),P=s=>{if(!s||typeof s!="object")return 0;let h=0;for(const f of Object.values(s))typeof f=="string"?h++:typeof f=="object"&&(h+=P(f));return h},S=async()=>{if(!(!u.device.device_code||!u.device.entity_type))try{const s=await Q.get("/api/smartir/codes/code",{params:{entity_type:u.device.entity_type,code_id:u.device.device_code}});if(s.data.success&&s.data.code){const h=s.data.code;h.commands&&(w.value=P(h.commands))}}catch(s){console.error("Error fetching SmartIR command count:",s)}};return Ae(async()=>{(u.device.device_type||"broadlink")==="smartir"&&await S()}),(s,h)=>(n(),a("div",{class:K(["device-card",{disabled:_.value}])},[e("div",yt,[e("div",{class:K(["device-icon",$e(r).colorClass.value])},[e("i",{class:K(g(m.value))},null,2)],2),e("div",bt,[e("h3",{title:t.device.name},p(t.device.name),9,ht),e("div",kt,[e("span",wt,p(T.value),1)])]),e("img",{src:U.value,alt:I.value,title:I.value,class:"device-source-logo"},null,8,$t)]),e("div",Ct,[e("div",_t,[e("div",St,[h[3]||(h[3]=e("i",{class:"mdi mdi-remote"},null,-1)),e("span",null,p(C.value)+" command"+p(C.value!==1?"s":""),1)]),e("div",It,[h[4]||(h[4]=e("i",{class:"mdi mdi-map-marker"},null,-1)),e("span",null,p(t.device.area||"No area"),1)])]),e("div",Dt,[e("span",Tt,[h[5]||(h[5]=e("i",{class:"mdi mdi-identifier"},null,-1)),R(" "+p(t.device.id),1)]),V.value?(n(),a("span",xt,[h[6]||(h[6]=e("i",{class:"mdi mdi-code-tags"},null,-1)),R(" "+p(t.device.device),1)])):M("",!0),t.device.broadlink_entity?(n(),a("span",Rt,[h[7]||(h[7]=e("i",{class:"mdi mdi-access-point"},null,-1)),R(" "+p(q.value),1)])):M("",!0),t.device.controller_device?(n(),a("span",Mt,[h[8]||(h[8]=e("i",{class:"mdi mdi-access-point"},null,-1)),R(" "+p(o(t.device.controller_device)),1)])):M("",!0)])]),e("div",At,[e("button",{onClick:h[0]||(h[0]=f=>!_.value&&s.$emit("learn",t.device)),class:"icon-btn",title:"Manage Commands",disabled:_.value},[...h[9]||(h[9]=[e("i",{class:"mdi mdi-remote-tv"},null,-1)])],8,Ot),e("button",{onClick:h[1]||(h[1]=f=>!_.value&&s.$emit("edit",t.device)),class:"icon-btn",title:"Edit",disabled:_.value},[...h[10]||(h[10]=[e("i",{class:"mdi mdi-pencil"},null,-1)])],8,Et),e("button",{onClick:h[2]||(h[2]=f=>!_.value&&s.$emit("delete",t.device)),class:"icon-btn danger",title:"Delete",disabled:_.value},[...h[11]||(h[11]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,Lt)]),_.value?(n(),a("div",Vt,[...h[12]||(h[12]=[e("div",{class:"disabled-message"},[e("i",{class:"mdi mdi-eye-off"}),e("span",null,"SmartIR Not Installed")],-1)])])):M("",!0)],2))}},Ut=we(Pt,[["__scopeId","data-v-7a7f5c18"]]),Ft={name:"DeviceListView",props:{devices:{type:Array,required:!0}},methods:{getDeviceSourceLogo(t){return(t.device_type||"broadlink")==="smartir"?Ge:st},getDeviceCommands(t){return t.commands&&typeof t.commands=="object"?Object.keys(t.commands):[]},getCommandType(t,u){return t.commands&&t.commands[u]&&t.commands[u].type||"ir"},getCommandTypeClass(t,u){return this.getCommandType(t,u)==="rf"?"command-rf":"command-ir"},getCommandTypeLabel(t,u){return this.getCommandType(t,u)==="rf"?"RF Command":"IR Command"},sendCommand(t,u){this.$emit("send-command",{device:t,command:u})},openCommands(t){this.$emit("open-commands",t)},editDevice(t){this.$emit("edit-device",t)},deleteDevice(t){this.$emit("delete-device",t)}}},jt={class:"device-list-view"},Nt={class:"device-table"},Bt={class:"device-info"},Ht={class:"device-name"},qt={class:"device-entity"},zt={class:"device-area"},Jt={class:"device-type"},Wt=["src","alt","title"],Gt={class:"device-commands"},Kt={key:0,class:"command-list"},Xt=["onClick","title"],Yt={key:0,class:"no-commands"},Zt={key:1,class:"smartir-info"},Qt={class:"profile-code"},eo={class:"device-actions"},to=["onClick"],oo=["onClick"],lo=["onClick"];function no(t,u,i,_,w,r){return n(),a("div",jt,[e("table",Nt,[u[3]||(u[3]=e("thead",null,[e("tr",null,[e("th",null,"Device"),e("th",null,"Room/Area"),e("th",null,"Type"),e("th",null,[e("div",{class:"commands-header"},[e("span",null,"Commands"),e("div",{class:"command-legend"},[e("span",{class:"legend-badge command-rf"},"RF"),e("span",{class:"legend-badge command-ir"},"IR")])])]),e("th",null,"Actions")])],-1)),e("tbody",null,[(n(!0),a(ce,null,ke(i.devices,m=>(n(),a("tr",{key:m.entity_id,class:"device-row"},[e("td",Bt,[e("div",Ht,p(m.friendly_name||m.name),1),e("div",qt,p(m.entity_id),1)]),e("td",zt,p(m.area||"No Area"),1),e("td",Jt,[e("img",{src:r.getDeviceSourceLogo(m),alt:m.device_type==="smartir"?"SmartIR":"Broadlink",title:m.device_type==="smartir"?"SmartIR":"Broadlink",class:"device-source-logo"},null,8,Wt)]),e("td",Gt,[(m.device_type||"broadlink")==="broadlink"?(n(),a("div",Kt,[(n(!0),a(ce,null,ke(r.getDeviceCommands(m),g=>(n(),a("button",{key:g,class:K(["command-btn",r.getCommandTypeClass(m,g)]),onClick:T=>r.sendCommand(m,g),title:r.getCommandTypeLabel(m,g)},p(g),11,Xt))),128)),r.getDeviceCommands(m).length===0?(n(),a("span",Yt," No commands ")):M("",!0)])):m.device_type==="smartir"?(n(),a("div",Zt,[e("span",Qt,"Profile: "+p(m.device_code),1)])):M("",!0)]),e("td",eo,[e("button",{class:"action-btn commands",onClick:g=>r.openCommands(m),title:"Manage Commands"},[...u[0]||(u[0]=[e("i",{class:"mdi mdi-remote-tv"},null,-1)])],8,to),e("button",{class:"action-btn edit",onClick:g=>r.editDevice(m),title:"Edit"},[...u[1]||(u[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})],-1)])],8,oo),e("button",{class:"action-btn delete",onClick:g=>r.deleteDevice(m),title:"Delete"},[...u[2]||(u[2]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"3 6 5 6 21 6"}),e("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})],-1)])],8,lo)])]))),128))])])])}const so=we(Ft,[["render",no],["__scopeId","data-v-2895a204"]]),ao={class:"icon-picker"},io={class:"icon-input-wrapper"},ro=["id","placeholder"],uo={key:0,class:"icon-preview"},co={key:0,class:"icon-dropdown"},mo={class:"icon-grid"},vo=["onMousedown","title"],po={__name:"IconPicker",props:{modelValue:{type:String,default:""},inputId:{type:String,default:"icon-input"},placeholder:{type:String,default:"e.g., mdi:television"}},emits:["update:modelValue"],setup(t,{emit:u}){const i=t,_=u,w=y(i.modelValue),r=y(!1),m=["television","speaker","radio","music","video","movie","play","pause","stop","skip-next","skip-previous","volume-high","volume-medium","volume-low","volume-off","remote","remote-tv","cast","chromecast","spotify","netflix","youtube","lightbulb","lightbulb-on","lightbulb-off","lamp","floor-lamp","ceiling-light","light-switch","led-strip","led-strip-variant","wall-sconce","chandelier","spotlight","track-light","vanity-light","desk-lamp","fan","ceiling-fan","air-conditioner","thermometer","thermostat","heat-wave","snowflake","fire","radiator","water-boiler","hvac","blinds","blinds-open","window-shutter","window-shutter-open","curtains","curtains-closed","roller-shade","roller-shade-closed","garage","garage-open","gate","door","door-open","window-open","window-closed","washing-machine","tumble-dryer","dishwasher","refrigerator","stove","microwave","oven","toaster","kettle","coffee","coffee-maker","blender","robot-vacuum","robot-vacuum-variant","vacuum","broom","spray-bottle","lock","lock-open","lock-smart","key","shield","shield-check","alarm-light","bell","doorbell","camera","cctv","motion-sensor","smoke-detector","fire-extinguisher","water-alert","gas-cylinder","sofa","bed","bed-double","desk","chair","table","bookshelf","home","home-outline","home-assistant","floor-plan","room","weather-sunny","weather-night","weather-cloudy","weather-rainy","weather-snowy","weather-lightning","weather-windy","weather-fog","weather-partly-cloudy","umbrella","water","water-percent","phone","cellphone","tablet","laptop","desktop-tower","monitor","keyboard","mouse","printer","router","router-wireless","access-point","wifi","bluetooth","usb","hdmi-port","ethernet","power","power-plug","power-socket","battery","battery-charging","lightning-bolt","flash","solar-panel","solar-power","leaf","tree","flower","sprout","grass","watering-can","shovel","fence","pool","hot-tub","silverware","silverware-fork-knife","food","food-apple","glass-wine","glass-cocktail","bottle-wine","pot","pot-steam","shower","shower-head","bathtub","toilet","sink","faucet","hand-wash","car","car-side","garage-variant","tools","hammer","wrench","screwdriver","toolbox","ladder","heart","heart-pulse","run","walk","bike","dumbbell","yoga","scale-bathroom","thermometer-lines","clock","clock-outline","timer","alarm","calendar","calendar-today","calendar-clock","history","bell-ring","bell-alert","alert","alert-circle","information","help-circle","check","check-circle","close-circle","minus-circle","plus-circle","arrow-up","arrow-down","arrow-left","arrow-right","chevron-up","chevron-down","menu","dots-vertical","dots-horizontal","cog","tune","circle","square","triangle","hexagon","star","star-outline","heart-outline","plus","minus","close","check-bold","eye","eye-off","account","account-group","baby","dog","cat","paw","gift","balloon","party-popper","candle","book","book-open","newspaper","email","message","phone-classic"];ae(()=>i.modelValue,C=>{w.value=C});const g=G(()=>{if(!w.value)return m.slice(0,50);const C=w.value.toLowerCase().replace("mdi:","");return m.filter(o=>o.toLowerCase().includes(C)).slice(0,50)}),T=()=>{r.value=!0,_("update:modelValue",w.value)},I=()=>{setTimeout(()=>{r.value=!1},200)},U=C=>{w.value=`mdi:${C}`,_("update:modelValue",w.value),r.value=!1};return(C,o)=>(n(),a("div",ao,[e("div",io,[W(e("input",{id:t.inputId,"onUpdate:modelValue":o[0]||(o[0]=V=>w.value=V),type:"text",placeholder:t.placeholder,onInput:T,onFocus:o[1]||(o[1]=V=>r.value=!0),onBlur:I},null,40,ro),[[Me,w.value]]),w.value?(n(),a("div",uo,[e("i",{class:K(`mdi mdi-${w.value.replace("mdi:","")}`)},null,2)])):M("",!0)]),r.value&&g.value.length>0?(n(),a("div",co,[e("div",mo,[(n(!0),a(ce,null,ke(g.value,V=>(n(),a("div",{key:V,class:"icon-option",onMousedown:ue(q=>U(V),["prevent"]),title:V},[e("i",{class:K(`mdi mdi-${V}`)},null,2),e("span",null,p(V),1)],40,vo))),128))])])):M("",!0)]))}},fo=we(po,[["__scopeId","data-v-a64f5011"]]),go={key:0,class:"dropdown-label"},yo={key:0,class:"required"},bo=["placeholder","disabled","onKeydown"],ho={class:"dropdown-icons"},ko={key:0,class:"mdi mdi-loading mdi-spin"},wo={key:2,class:"mdi mdi-chevron-down"},$o={key:1,class:"error-message"},Co={key:2,class:"hint-message"},_o={key:0,class:"dropdown-menu"},So=["onMousedown","onMouseenter"],Io={class:"option-content"},Do={class:"option-label"},To={key:0,class:"option-description"},xo={key:0,class:"mdi mdi-check selected-icon"},Ro={key:3,class:"dropdown-menu"},Mo={__name:"SearchableDropdown",props:{modelValue:{type:[String,Number,Object],default:null},options:{type:Array,required:!0,default:()=>[]},label:{type:String,default:""},placeholder:{type:String,default:"Search..."},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},error:{type:String,default:""},hint:{type:String,default:""},optionLabel:{type:String,default:"label"},optionValue:{type:String,default:"value"},optionDescription:{type:String,default:"description"},filterMethod:{type:Function,default:null}},emits:["update:modelValue","change","search"],setup(t,{emit:u}){const i=t,_=u,w=y(null),r=y(null),m=y(""),g=y(!1),T=y(0),I=y(!1),U=E=>typeof E=="string"||typeof E=="number"?E:E[i.optionLabel]||E.label||E.name||String(E),C=E=>typeof E=="string"||typeof E=="number"?E:E[i.optionValue]||E.value||E.id||E,o=E=>typeof E=="string"||typeof E=="number"?"":E[i.optionDescription]||E.description||"",V=E=>{const j=C(E);return typeof i.modelValue=="object"?C(i.modelValue)===j:i.modelValue===j},q=G(()=>{if(!m.value)return i.options;if(i.filterMethod)return i.options.filter(j=>i.filterMethod(j,m.value));const E=m.value.toLowerCase();return i.options.filter(j=>{const te=U(j).toLowerCase(),ie=o(j).toLowerCase();return te.includes(E)||ie.includes(E)})}),P=G(()=>{if(!i.modelValue)return"";const E=i.options.find(j=>{const te=C(j);return typeof i.modelValue=="object"?te===C(i.modelValue):te===i.modelValue});return E?U(E):""});ae(()=>i.modelValue,E=>{I.value||(m.value=P.value)}),ae(()=>i.options,()=>{!I.value&&i.modelValue&&(m.value=P.value)},{deep:!0}),ae(m,E=>{_("search",E),T.value=0}),Ae(()=>{m.value=P.value});const S=()=>{var E;I.value=!0,g.value=!0,(E=r.value)==null||E.select()},s=()=>{I.value=!1,setTimeout(()=>{g.value=!1,i.modelValue?m.value=P.value:m.value=""},200)},h=()=>{var E;g.value=!1,(E=r.value)==null||E.blur()},f=E=>{const j=C(E);_("update:modelValue",j),_("change",j,E),m.value=U(E),h()},L=()=>{var E;_("update:modelValue",null),_("change",null,null),m.value="",(E=r.value)==null||E.focus()},J=()=>{if(!g.value){g.value=!0;return}T.value<q.value.length-1&&T.value++},X=()=>{T.value>0&&T.value--},H=()=>{q.value.length>0&&T.value>=0&&f(q.value[T.value])},oe=E=>{w.value&&!w.value.contains(E.target)&&(g.value=!1,i.modelValue?m.value=P.value:m.value="")};return Ae(()=>{document.addEventListener("click",oe)}),Xe(()=>{document.removeEventListener("click",oe)}),(E,j)=>(n(),a("div",{class:"searchable-dropdown",ref_key:"dropdownRef",ref:w},[t.label?(n(),a("label",go,[R(p(t.label)+" ",1),t.required?(n(),a("span",yo,"*")):M("",!0)])):M("",!0),e("div",{class:K(["dropdown-input-wrapper",{"has-error":t.error,disabled:t.disabled}])},[W(e("input",{ref_key:"inputRef",ref:r,type:"text","onUpdate:modelValue":j[0]||(j[0]=te=>m.value=te),placeholder:t.placeholder,disabled:t.disabled||t.loading,onFocus:S,onBlur:s,onKeydown:[qe(ue(J,["prevent"]),["down"]),qe(ue(X,["prevent"]),["up"]),qe(ue(H,["prevent"]),["enter"]),qe(h,["escape"])],class:"dropdown-input"},null,40,bo),[[Me,m.value]]),e("div",ho,[t.loading?(n(),a("i",ko)):t.modelValue&&!t.disabled?(n(),a("i",{key:1,class:"mdi mdi-close-circle clear-icon",onClick:L})):(n(),a("i",wo))])],2),t.error?(n(),a("div",$o,p(t.error),1)):M("",!0),t.hint&&!t.error?(n(),a("div",Co,p(t.hint),1)):M("",!0),ge(tt,{name:"dropdown"},{default:Ye(()=>[g.value&&q.value.length>0?(n(),a("div",_o,[(n(!0),a(ce,null,ke(q.value,(te,ie)=>(n(),a("div",{key:C(te),class:K(["dropdown-item",{highlighted:ie===T.value,selected:V(te)}]),onMousedown:ue(ye=>f(te),["prevent"]),onMouseenter:ye=>T.value=ie},[e("div",Io,[e("div",Do,p(U(te)),1),o(te)?(n(),a("div",To,p(o(te)),1)):M("",!0)]),V(te)?(n(),a("i",xo)):M("",!0)],42,So))),128))])):M("",!0)]),_:1}),g.value&&q.value.length===0&&!t.loading?(n(),a("div",Ro,[...j[1]||(j[1]=[e("div",{class:"dropdown-item no-results"},[e("i",{class:"mdi mdi-magnify"}),R(" No results found ")],-1)])])):M("",!0)],512))}},We=we(Mo,[["__scopeId","data-v-679ce35f"]]),Ao={class:"smartir-selector"},Oo={class:"form-group"},Eo={class:"form-group"},Lo={class:"form-group"},Vo=["value"],Po={key:0,class:"error-message"},Uo={class:"form-group"},Fo={class:"form-group"},jo={key:1,class:"code-info"},No={class:"info-content"},Bo={class:"info-row"},Ho={class:"info-value"},qo={class:"info-row"},zo={class:"info-value"},Jo={key:0,class:"info-row"},Wo={class:"info-value"},Go={class:"info-row"},Ko={class:"info-value"},Xo={__name:"SmartIRDeviceSelector",props:{entityType:{type:String,required:!0},modelValue:{type:Object,default:()=>({})},broadlinkDevices:{type:Array,default:()=>[]}},emits:["update:modelValue","change"],setup(t,{expose:u,emit:i}){const _=t,w=i,r=y([]),m=y([]),g=y(""),T=y(""),I=y(""),U=y(""),C=y(""),o=y(null),V=y(!1),q=y(!1),P=y({manufacturer:"",model:"",controller:""});Ae(async()=>{if(await S(),_.modelValue&&(g.value=_.modelValue.manufacturer||"",T.value=_.modelValue.device_code||"",I.value=_.modelValue.controller_device||"",U.value=_.modelValue.temperature_sensor||"",C.value=_.modelValue.humidity_sensor||"",g.value&&(await s(g.value),T.value&&m.value.length>0))){const E=m.value.find(j=>j.code===T.value);E&&(o.value={code:E.code,manufacturer:g.value,models:E.models,controller:E.controller})}}),ae(()=>_.entityType,async E=>{E&&(g.value="",T.value="",m.value=[],o.value=null,await S())});const S=async()=>{if(_.entityType){V.value=!0,P.value.manufacturer="";try{const E=await Q.get("/api/smartir/codes/manufacturers",{params:{entity_type:_.entityType}});if(E.data.success)r.value=E.data.manufacturers||[];else throw new Error(E.data.error||"Failed to load manufacturers")}catch(E){console.error("Error loading manufacturers:",E),P.value.manufacturer="Failed to load manufacturers. Please try again.",r.value=[]}finally{V.value=!1}}},s=async E=>{if(!(!E||!_.entityType)){q.value=!0,P.value.model="";try{const j=await Q.get("/api/smartir/codes/models",{params:{entity_type:_.entityType,manufacturer:E}});if(j.data.success){const te=j.data.models||[];m.value=te.map(ie=>{const ye=ie.models&&ie.models.length>0?ie.models.join(", "):`Code ${ie.code}`;return{code:ie.code,label:ye,description:`Code: ${ie.code}`,models:ie.models,controller:ie.controller}})}else throw new Error(j.data.error||"Failed to load models")}catch(j){console.error("Error loading models:",j),P.value.model="Failed to load models. Please try again.",m.value=[]}finally{q.value=!1}}},h=async E=>{g.value=E,T.value="",o.value=null,m.value=[],E&&await s(E),H()},f=()=>{const E=m.value.find(j=>j.code===T.value);E&&(o.value={code:E.code,manufacturer:g.value,models:E.models,controller:E.controller}),H()},L=()=>{H()},J=()=>{H()},X=()=>{H()},H=()=>{var j,te;const E={manufacturer:g.value,model:((te=(j=o.value)==null?void 0:j.models)==null?void 0:te[0])||"",device_code:T.value,controller_device:I.value};_.entityType==="climate"&&(U.value&&(E.temperature_sensor=U.value),C.value&&(E.humidity_sensor=C.value)),w("update:modelValue",E),w("change",E)};return u({validate:()=>{let E=!0;return P.value={manufacturer:"",model:"",controller:""},g.value||(P.value.manufacturer="Manufacturer is required",E=!1),T.value||(P.value.model="Model is required",E=!1),I.value||(P.value.controller="Broadlink controller is required",E=!1),E}}),(E,j)=>(n(),a("div",Ao,[e("div",Oo,[ge(We,{modelValue:g.value,"onUpdate:modelValue":j[0]||(j[0]=te=>g.value=te),options:r.value,label:"Manufacturer",placeholder:"Search manufacturers...",required:"",loading:V.value,error:P.value.manufacturer,hint:"Select the device manufacturer",onChange:h},null,8,["modelValue","options","loading","error"])]),e("div",Eo,[ge(We,{modelValue:T.value,"onUpdate:modelValue":j[1]||(j[1]=te=>T.value=te),options:m.value,"option-label":"label","option-value":"code","option-description":"description",label:"Model",placeholder:"Search models...",required:"",disabled:!g.value,loading:q.value,error:P.value.model,hint:"Select the device model",onChange:f},null,8,["modelValue","options","disabled","loading","error"])]),e("div",Lo,[j[6]||(j[6]=e("label",{for:"controller-device"},[e("i",{class:"mdi mdi-remote"}),R(" Controller Device * ")],-1)),W(e("select",{id:"controller-device","onUpdate:modelValue":j[2]||(j[2]=te=>I.value=te),required:"",onChange:L},[j[5]||(j[5]=e("option",{value:""},"-- Select Controller Device --",-1)),(n(!0),a(ce,null,ke(t.broadlinkDevices,te=>(n(),a("option",{key:te.entity_id,value:te.entity_id},[R(p(te.name||te.entity_id)+" ",1),te.area_name?(n(),a(ce,{key:0},[R(" - "+p(te.area_name),1)],64)):M("",!0)],8,Vo))),128))],544),[[Ie,I.value]]),j[7]||(j[7]=e("small",null,"Which remote device will send the IR/RF commands",-1)),P.value.controller?(n(),a("div",Po,p(P.value.controller),1)):M("",!0)]),t.entityType==="climate"?(n(),a(ce,{key:0},[e("div",Uo,[j[8]||(j[8]=e("label",{for:"temperature-sensor"},"Temperature Sensor",-1)),W(e("input",{id:"temperature-sensor","onUpdate:modelValue":j[3]||(j[3]=te=>U.value=te),type:"text",placeholder:"e.g., sensor.living_room_temperature",onInput:J},null,544),[[Me,U.value]]),j[9]||(j[9]=e("small",null,"Optional: Temperature sensor entity for current temperature",-1))]),e("div",Fo,[j[10]||(j[10]=e("label",{for:"humidity-sensor"},"Humidity Sensor",-1)),W(e("input",{id:"humidity-sensor","onUpdate:modelValue":j[4]||(j[4]=te=>C.value=te),type:"text",placeholder:"e.g., sensor.living_room_humidity",onInput:X},null,544),[[Me,C.value]]),j[11]||(j[11]=e("small",null,"Optional: Humidity sensor entity for current humidity",-1))])],64)):M("",!0),o.value?(n(),a("div",jo,[j[16]||(j[16]=e("div",{class:"info-header"},[e("i",{class:"mdi mdi-information"}),e("span",null,"Selected Device Code")],-1)),e("div",No,[e("div",Bo,[j[12]||(j[12]=e("span",{class:"info-label"},"Code ID:",-1)),e("span",Ho,p(o.value.code_id),1)]),e("div",qo,[j[13]||(j[13]=e("span",{class:"info-label"},"Manufacturer:",-1)),e("span",zo,p(o.value.manufacturer),1)]),o.value.models&&o.value.models.length>0?(n(),a("div",Jo,[j[14]||(j[14]=e("span",{class:"info-label"},"Supported Models:",-1)),e("span",Wo,p(o.value.models.join(", ")),1)])):M("",!0),e("div",Go,[j[15]||(j[15]=e("span",{class:"info-label"},"Controller:",-1)),e("span",Ko,p(o.value.controller||"Broadlink"),1)])])])):M("",!0)]))}},Yo=we(Xo,[["__scopeId","data-v-1911c8f6"]]),Zo={class:"modal-content"},Qo={class:"modal-header"},el={class:"input-wrapper"},tl={key:0,class:"validation-tooltip"},ol={class:"input-wrapper"},ll=["disabled"],nl={key:0,class:"validation-tooltip"},sl={key:0,class:"smartir-notice"},al={key:0,class:"notice-success"},il={key:1,class:"notice-warning"},rl={key:1,class:"smartir-notice"},dl={key:2},ul={class:"form-group"},cl=["disabled"],ml=["disabled"],vl={key:0},pl={key:1},fl={key:2},gl={key:3},yl={key:0,class:"form-group"},bl={class:"area-display-readonly"},hl=["value"],kl=["disabled"],wl=["href"],$l={key:1,class:"form-group"},Cl={class:"form-group"},_l={class:"input-wrapper"},Sl=["value"],Il=["value"],Dl={key:2,class:"validation-tooltip"},Tl={key:0},xl={key:1},Rl={key:3,class:"smartir-section"},Ml={class:"modal-footer"},Al={type:"submit",form:"device-form",class:"btn btn-primary"},Ol={__name:"DeviceForm",props:{device:{type:Object,default:null}},emits:["save","cancel"],setup(t,{emit:u}){const i=t,_=u,w=Te("smartirStatus"),r=Te("smartirEnabled"),m=G(()=>{var v;return localStorage.getItem("smartir_simulate_not_installed")==="true"?!1:((v=w==null?void 0:w.value)==null?void 0:v.installed)||!1}),g=G(()=>!!i.device),T=G(()=>["climate","media_player","fan","light"].includes(o.value.entity_type)),I=G(()=>m.value?!T.value&&o.value.entity_type?"(Not supported for this type)":"(Pre-configured Codes)":"(Requires SmartIR)"),U=G(()=>{var v;const x=((v=i.device)==null?void 0:v.commands)||{};return Object.keys(x).length>0}),C=G(()=>{if(!o.value.broadlink_entity)return"";const x=s.value.find(v=>v.entity_id===o.value.broadlink_entity);return x&&x.name||o.value.broadlink_entity}),o=y({name:"",entity_type:"",device_type:"broadlink",device:"",area:"",icon:"",broadlink_entity:"",enabled:!0,commands:{}}),V=y({name:"",entity_type:"",broadlink_entity:""}),q=y({}),P=y(null),S=y([]),s=y([]),h=y(null),f=y(null),L=y(null),J=y(!1);Ae(async()=>{i.device&&(o.value={...i.device,device_type:i.device.device_type||"broadlink"},o.value.device_type==="smartir"&&(q.value={manufacturer:i.device.manufacturer,model:i.device.model,device_code:i.device.device_code,controller_device:i.device.controller_device,temperature_sensor:i.device.temperature_sensor,humidity_sensor:i.device.humidity_sensor})),await Promise.all([X(),H()])});const X=async()=>{try{const x=await Q.get("/api/areas");S.value=x.data.areas||[]}catch(x){console.error("Error loading areas:",x),S.value=[]}},H=async()=>{try{const v=(await Q.get("/api/remote/devices")).data.devices||[];s.value=v,console.log("Loaded remote devices:",v)}catch(x){console.error("Error loading remote devices:",x),s.value=[]}},oe=x=>{if(!x)return"";const v=x.toLowerCase();for(const F of S.value){const pe=F.toLowerCase();if(v.includes(pe))return F}return""},E=(x,v="")=>{const F=v.toLowerCase();return F.includes("tv")?"mdi:television":F.includes("lamp")?"mdi:lamp":F.includes("ceiling")?"mdi:ceiling-light":F.includes("floor")?"mdi:floor-lamp":F.includes("desk")?"mdi:desk-lamp":F.includes("fan")?"mdi:fan":F.includes("ac")||F.includes("air con")?"mdi:air-conditioner":F.includes("heater")?"mdi:radiator":F.includes("blind")?"mdi:blinds":F.includes("curtain")?"mdi:curtains":F.includes("garage")?"mdi:garage":F.includes("speaker")||F.includes("stereo")?"mdi:speaker":F.includes("receiver")?"mdi:audio-video":{light:"mdi:lightbulb",fan:"mdi:fan",switch:"mdi:light-switch",media_player:"mdi:television",cover:"mdi:window-shutter",climate:"mdi:thermostat"}[x]||"mdi:devices"};ae(()=>o.value.name,x=>{if(!g.value&&x&&!o.value.area){const v=oe(x);v&&(o.value.area=v)}!g.value&&x&&o.value.entity_type&&(J.value||!o.value.icon)&&(o.value.icon=E(o.value.entity_type,x),J.value=!0)}),ae(()=>o.value.entity_type,x=>{!g.value&&x&&(J.value||!o.value.icon)&&(o.value.icon=E(x,o.value.name),J.value=!0)}),ae(()=>o.value.icon,(x,v)=>{v!==void 0&&x!==v&&!J.value&&(J.value=!1),x||(J.value=!1)});const j=y(!1),te=async()=>{var x;if((x=i.device)!=null&&x.id){j.value=!0;try{const v=await Q.post(`/api/devices/${i.device.id}/sync-area`);v.data.success?(o.value.area=v.data.area||"",v.data.area?console.log(`Area synced: ${v.data.area}`):console.log("No area assigned in Home Assistant")):console.warn(v.data.message||"Entity not found in HA")}catch(v){console.error("Failed to sync area:",v)}finally{j.value=!1}}},ie=()=>{var F;return!((F=i.device)!=null&&F.id)||!o.value.entity_type?"#":`/config/entities/entity/${`${o.value.entity_type}.${i.device.id}`}`},ye=()=>{V.value={name:"",entity_type:"",broadlink_entity:""};let x=!0;return(!o.value.name||o.value.name.trim()==="")&&(V.value.name="Device name is required",x=!1),o.value.entity_type||(V.value.entity_type="Entity type is required",x=!1),o.value.device_type==="broadlink"&&!o.value.broadlink_entity&&(V.value.broadlink_entity="Broadlink device is required",x=!1),x},_e=x=>{V.value[x]=""},xe=async()=>{if(o.value.device_type==="smartir"){if(P.value&&!P.value.validate())return;const x={...o.value,smartir_config:{manufacturer:q.value.manufacturer,model:q.value.model,code_id:q.value.device_code,controller_device:q.value.controller_device}};_("save",x)}else{if(!ye())return;_("save",{...o.value})}},De=x=>{q.value=x};return(x,v)=>(n(),a("div",{class:"modal-overlay",onClick:v[11]||(v[11]=ue(F=>x.$emit("cancel"),["self"]))},[e("div",Zo,[e("div",Qo,[e("h2",null,p(g.value?"Edit Device":"Add New Device"),1),e("button",{onClick:v[0]||(v[0]=F=>x.$emit("cancel")),class:"close-btn"},[...v[12]||(v[12]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("form",{id:"device-form",onSubmit:ue(xe,["prevent"]),class:"modal-body"},[e("div",{class:K(["form-group",{"has-error":V.value.name}])},[v[14]||(v[14]=e("label",{for:"device-name"},"Device Name *",-1)),e("div",el,[W(e("input",{id:"device-name",ref_key:"nameInput",ref:h,"onUpdate:modelValue":v[1]||(v[1]=F=>o.value.name=F),type:"text",placeholder:"e.g., Living Room TV",onInput:v[2]||(v[2]=F=>_e("name"))},null,544),[[Me,o.value.name]]),V.value.name?(n(),a("div",tl,[v[13]||(v[13]=e("i",{class:"mdi mdi-alert"},null,-1)),R(" "+p(V.value.name),1)])):M("",!0)]),v[15]||(v[15]=e("small",null,"Friendly name for this device",-1))],2),e("div",{class:K(["form-group",{"has-error":V.value.entity_type}])},[v[23]||(v[23]=e("label",{for:"entity-type"},"Entity Type *",-1)),e("div",ol,[W(e("select",{id:"entity-type",ref_key:"typeSelect",ref:f,"onUpdate:modelValue":v[3]||(v[3]=F=>o.value.entity_type=F),onChange:v[4]||(v[4]=F=>_e("entity_type"))},[v[16]||(v[16]=je('<option value="" data-v-94bc1fe5>-- Select Type --</option><option value="light" data-v-94bc1fe5>💡 Light</option><option value="fan" data-v-94bc1fe5>🌀 Fan</option><option value="switch" data-v-94bc1fe5>🔌 Switch</option><option value="media_player" data-v-94bc1fe5>📺 Media Player</option><option value="cover" data-v-94bc1fe5>🪟 Cover (Blinds/Curtains)</option>',6)),e("option",{value:"climate",disabled:!m.value}," 🌡️ Climate "+p(m.value?"":"(Requires SmartIR)"),9,ll)],544),[[Ie,o.value.entity_type]]),V.value.entity_type?(n(),a("div",nl,[v[17]||(v[17]=e("i",{class:"mdi mdi-alert"},null,-1)),R(" "+p(V.value.entity_type),1)])):M("",!0)]),o.value.entity_type==="climate"?(n(),a("div",sl,[m.value?(n(),a("div",al,[...v[18]||(v[18]=[e("i",{class:"mdi mdi-check-circle"},null,-1),e("span",null,"SmartIR detected! Climate entities will be created via SmartIR profiles.",-1)])])):(n(),a("div",il,[...v[19]||(v[19]=[e("i",{class:"mdi mdi-alert"},null,-1),e("div",null,[e("strong",null,"SmartIR Required"),e("p",null,"Climate entities (AC, heaters) require SmartIR integration."),e("a",{href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"smartir-link"}," Install SmartIR → ")],-1)])]))])):m.value&&["media_player","fan","light"].includes(o.value.entity_type)?(n(),a("div",rl,[...v[20]||(v[20]=[e("div",{class:"notice-info"},[e("i",{class:"mdi mdi-information"}),e("span",null,"💡 SmartIR available! You can use pre-configured codes or learn your own.")],-1)])])):!m.value&&o.value.entity_type?(n(),a("small",dl,[v[21]||(v[21]=R(" 💡 Tip: Install ",-1)),v[22]||(v[22]=e("a",{href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"inline-link"},"SmartIR",-1)),R(" for pre-configured "+p(o.value.entity_type==="climate"?"climate":o.value.entity_type)+" device codes ",1)])):M("",!0)],2),e("div",ul,[v[26]||(v[26]=e("label",{for:"device-type"},"Device Type *",-1)),W(e("select",{id:"device-type","onUpdate:modelValue":v[5]||(v[5]=F=>o.value.device_type=F),required:"",disabled:g.value},[v[24]||(v[24]=e("option",{value:""},"-- Select Device Type --",-1)),v[25]||(v[25]=e("option",{value:"broadlink"},"📡 Broadlink Device (Learn IR Codes)",-1)),$e(r)?(n(),a("option",{key:0,value:"smartir",disabled:!m.value||!T.value}," 🌐 SmartIR Device "+p(I.value),9,ml)):M("",!0)],8,cl),[[Ie,o.value.device_type]]),g.value?(n(),a("small",vl,"Cannot change device type after creation")):o.value.device_type==="smartir"?(n(),a("small",pl,"Using pre-configured codes from SmartIR repository")):o.value.device_type==="broadlink"?(n(),a("small",fl,"Learn and store your own IR codes")):(n(),a("small",gl,"Choose how to configure this device"))]),g.value?(n(),a("div",yl,[v[29]||(v[29]=e("label",{for:"device-area"},"Area",-1)),e("div",bl,[e("input",{id:"device-area",value:o.value.area||"Not assigned",type:"text",readonly:"",class:"readonly-input"},null,8,hl),e("button",{type:"button",onClick:te,disabled:j.value,class:"sync-area-btn",title:"Sync area from Home Assistant"},[e("i",{class:K(j.value?"mdi mdi-loading mdi-spin":"mdi mdi-refresh")},null,2)],8,kl)]),e("small",null,[v[27]||(v[27]=e("i",{class:"mdi mdi-information-outline"},null,-1)),v[28]||(v[28]=R(" Set area in Home Assistant, then click sync. ",-1)),e("a",{href:ie(),target:"_blank",class:"inline-link"},"Open in HA →",8,wl)])])):(n(),a("div",$l,[...v[30]||(v[30]=[e("div",{class:"info-notice"},[e("i",{class:"mdi mdi-information-outline"}),e("span",null,[e("strong",null,"Area Assignment:"),R(" After generating entities and restarting Home Assistant, you can assign areas in HA and sync them here.")])],-1)])])),e("div",Cl,[v[31]||(v[31]=e("label",{for:"device-icon"},"Icon",-1)),ge(fo,{modelValue:o.value.icon,"onUpdate:modelValue":v[6]||(v[6]=F=>o.value.icon=F),inputId:"device-icon",placeholder:"e.g., mdi:television"},null,8,["modelValue"]),v[32]||(v[32]=e("small",null,"Optional: Material Design Icon name",-1))]),o.value.device_type==="broadlink"?(n(),a("div",{key:2,class:K(["form-group",{"has-error":V.value.broadlink_entity}])},[v[35]||(v[35]=e("label",{for:"broadlink-entity"},"Remote Device *",-1)),e("div",_l,[!g.value||!U.value?W((n(),a("select",{key:0,id:"broadlink-entity",ref_key:"broadlinkSelect",ref:L,"onUpdate:modelValue":v[7]||(v[7]=F=>o.value.broadlink_entity=F),onChange:v[8]||(v[8]=F=>_e("broadlink_entity"))},[v[33]||(v[33]=e("option",{value:""},"-- Select Remote Device --",-1)),(n(!0),a(ce,null,ke(s.value,F=>(n(),a("option",{key:F.entity_id,value:F.entity_id},[R(p(F.name||F.entity_id)+" ",1),F.area_name?(n(),a(ce,{key:0},[R(" - "+p(F.area_name),1)],64)):M("",!0)],8,Sl))),128))],544)),[[Ie,o.value.broadlink_entity]]):(n(),a("input",{key:1,id:"broadlink-entity",value:C.value,type:"text",readonly:"",disabled:""},null,8,Il)),V.value.broadlink_entity?(n(),a("div",Dl,[v[34]||(v[34]=e("i",{class:"mdi mdi-alert"},null,-1)),R(" "+p(V.value.broadlink_entity),1)])):M("",!0)]),!g.value||!U.value?(n(),a("small",Tl,"Required: Select which remote device to use for sending commands")):(n(),a("small",xl,"Cannot change remote device after commands are learned"))],2)):M("",!0),o.value.device_type==="smartir"?(n(),a("div",Rl,[v[36]||(v[36]=e("div",{class:"section-header"},[e("i",{class:"mdi mdi-cloud-download"}),e("span",null,"SmartIR Device Configuration")],-1)),ge(Yo,{ref_key:"smartirSelector",ref:P,"entity-type":o.value.entity_type,modelValue:q.value,"onUpdate:modelValue":v[9]||(v[9]=F=>q.value=F),"broadlink-devices":s.value,onChange:De},null,8,["entity-type","modelValue","broadlink-devices"])])):M("",!0)],32),e("div",Ml,[e("button",{type:"button",onClick:v[10]||(v[10]=F=>x.$emit("cancel")),class:"btn btn-secondary"}," Cancel "),e("button",Al,[v[37]||(v[37]=e("i",{class:"mdi mdi-check"},null,-1)),R(" "+p(g.value?"Update":"Create"),1)])])])]))}},El=we(Ol,[["__scopeId","data-v-94bc1fe5"]]),Ll={class:"modal-header"},Vl={class:"modal-body"},Pl={class:"message-text"},Ul={key:0,class:"checkbox-option"},Fl={class:"modal-footer"},jl=["disabled"],Nl={__name:"ConfirmDialog",props:{isOpen:{type:Boolean,default:!1},title:{type:String,default:"Confirm"},message:{type:String,required:!0},confirmText:{type:String,default:"OK"},cancelText:{type:String,default:"Cancel"},showCancel:{type:Boolean,default:!0},dangerMode:{type:Boolean,default:!1},confirmDisabled:{type:Boolean,default:!1},checkboxLabel:{type:String,default:""}},emits:["confirm","cancel"],setup(t,{emit:u}){const i=t,_=u,w=y(!1);ae(()=>i.isOpen,g=>{g&&(w.value=!1)});const r=()=>{_("confirm",w.value)},m=()=>{_("cancel")};return(g,T)=>t.isOpen?(n(),a("div",{key:0,class:"modal-overlay",onClick:ue(m,["self","stop"])},[e("div",{class:"modal-dialog confirm-dialog",onClick:T[1]||(T[1]=ue(()=>{},["stop"]))},[e("div",Ll,[e("h2",null,p(t.title),1)]),e("div",Vl,[e("p",Pl,p(t.message),1),t.checkboxLabel?(n(),a("div",Ul,[e("label",null,[W(e("input",{type:"checkbox","onUpdate:modelValue":T[0]||(T[0]=I=>w.value=I)},null,512),[[ve,w.value]]),e("span",null,p(t.checkboxLabel),1)])])):M("",!0)]),e("div",Fl,[t.showCancel?(n(),a("button",{key:0,onClick:ue(m,["stop"]),class:"btn btn-secondary"},p(t.cancelText),1)):M("",!0),t.confirmText?(n(),a("button",{key:1,onClick:ue(r,["stop"]),class:K(["btn",t.dangerMode?"btn-danger":"btn-primary"]),disabled:t.confirmDisabled},p(t.confirmText),11,jl)):M("",!0)])])])):M("",!0)}},Fe=we(Nl,[["__scopeId","data-v-9cea6cb3"]]),Bl={class:"modal-content"},Hl={class:"modal-header"},ql={class:"modal-body"},zl={key:0,class:"smartir-info"},Jl={key:0,class:"climate-note"},Wl={class:"form-group"},Gl=["value"],Kl={class:"form-group"},Xl=["disabled"],Yl={label:"Suggested Commands"},Zl=["value"],Ql=["disabled"],en={class:"form-group"},tn={class:"radio-group"},on={class:"radio-label"},ln=["disabled"],nn={class:"radio-label"},sn=["disabled"],an={class:"form-group"},rn={class:"radio-group"},dn={class:"radio-label"},un=["disabled"],cn={class:"radio-label"},mn=["disabled"],vn={class:"radio-label"},pn=["disabled"],fn={key:0,class:"help-box"},gn={class:"learn-action"},yn=["disabled"],bn={key:0,class:"mdi mdi-loading mdi-spin"},hn={key:1,class:"mdi mdi-remote-tv"},kn={key:0,class:"learning-status"},wn={key:0},$n={key:1},Cn={key:2,class:"rf-instructions"},_n={key:0},Sn={key:1,class:"rf-action"},In={key:2,class:"rf-status"},Dn={key:3,class:"rf-success"},Tn={key:1,class:"result-message success"},xn={key:2,class:"section-divider"},Rn={key:3,class:"loading-commands"},Mn={key:4,class:"learned-commands"},An={class:"command-list"},On={class:"command-info"},En={class:"command-name"},Ln={class:"command-right"},Vn=["title"],Pn={class:"command-actions"},Un=["onClick","disabled"],Fn=["onClick"],jn={key:5,class:"untracked-commands"},Nn={class:"command-list"},Bn={class:"command-name"},Hn=["onClick"],qn={class:"modal-footer"},zn=["disabled"],Jn={__name:"CommandLearner",props:{device:{type:Object,required:!0}},emits:["cancel","learned"],setup(t,{emit:u}){const i=t,_=u,w=y([]),r=y(""),m=y(""),g=y(""),T=y("ir"),I=y("manager_only"),U=y(!1),C=y(!1),o=y(""),V=y(""),q=y(""),P=y("success"),S=y([]),s=y([]),h=y(!1),f=y(!1),L=y(""),J=y(!1),X=y(null),H=y(null),oe=y(""),E=y(""),j=G(()=>i.device.device_type==="smartir");G(()=>{if(j.value)return!1;const d=m.value==="__custom__"?g.value:m.value;return r.value&&d.trim()});const te=()=>{X.value&&X.value.setCustomValidity("")},ie=()=>{H.value&&H.value.setCustomValidity("")},ye=G(()=>{const d=w.value.find(c=>c.entity_id===r.value);return d?d.name||d.entity_id:r.value}),_e={light:["turn_on","turn_off","toggle","brightness_up","brightness_down","dim","bright"],fan:["turn_on","turn_off","toggle","speed_low","speed_medium","speed_high","speed_1","speed_2","speed_3","speed_4","speed_5","oscillate_on","oscillate_off","direction_forward","direction_reverse"],switch:["turn_on","turn_off","toggle"],media_player:["turn_on","turn_off","toggle","volume_up","volume_down","volume_mute","play","pause","stop","play_pause","next_track","previous_track","channel_up","channel_down","source_hdmi1","source_hdmi2","source_hdmi3","source_tv","source_aux","source_bluetooth","menu","home","back","select","arrow_up","arrow_down","arrow_left","arrow_right"],cover:["open","close","stop","open_tilt","close_tilt","position_0","position_25","position_50","position_75","position_100"]},xe=G(()=>{const d=i.device.entity_type||"switch";return _e[d]||_e.switch});ae(()=>i.device,async(d,c)=>{if(d&&c&&d.id===c.id){const A=Object.keys(d.commands||{}).length,k=Object.keys(c.commands||{}).length;A!==k&&(console.log(`🔄 Device commands changed (${k} -> ${A}), reloading...`),await x(!0))}},{deep:!0}),Ae(async()=>{await De(),await x(),await Se(),X.value&&(X.value.setCustomValidity(""),X.value.oninvalid=()=>{X.value.setCustomValidity("Command name is required")}),i.device.broadlink_entity&&(r.value=i.device.broadlink_entity)}),ae(m,async d=>{d==="__custom__"&&(await ot(),H.value&&(H.value.setCustomValidity(""),H.value.oninvalid=()=>{H.value.setCustomValidity("Custom command name is required")}))});const De=async()=>{try{const d=await Q.get("/api/broadlink/devices");w.value=d.data.devices||[]}catch(d){console.error("Error loading Broadlink devices:",d)}},x=async(d=!1)=>{var c,A;h.value=!0;try{if(j.value){const k=await Q.get("/api/smartir/codes/code",{params:{entity_type:i.device.entity_type,code_id:i.device.device_code}});if(k.data.success&&k.data.code){const l=k.data.code.commands||{},O=k.data.code.commandType||"ir";if(i.device.entity_type==="climate"){const B=[];for(const[ne,se]of Object.entries(l))typeof se=="string"?B.push({name:ne,type:O}):typeof se=="object"&&se!==null&&Object.keys(se).sort((Y,de)=>parseInt(Y)-parseInt(de)).forEach(Y=>{B.push({name:`${ne}_${Y}`,type:O,label:`${ne.charAt(0).toUpperCase()+ne.slice(1)} ${Y}°C`})});S.value=B}else S.value=Object.keys(l).map(B=>({name:B,type:O}))}}else{if(console.log("📋 Loading commands for device:",i.device),console.log("📋 Device ID:",i.device.id),console.log("📋 Force reload:",d),d&&i.device.id){console.log("🔄 Force reloading commands from API after sync");try{const l=(await Q.get(`/api/commands/${i.device.id}`)).data.commands||{};console.log("📦 Raw commands from API:",l),S.value=Object.entries(l).map(([O,B])=>{console.log(`  Command '${O}':`,B,`(type: ${typeof B})`);const ne=typeof B=="object"&&B!==null&&(B.command_type||B.type)||"ir";return{name:O,type:ne}}),console.log("📋 Reloaded commands:",S.value)}catch(k){if(console.error("❌ Error loading commands:",k),((c=k.response)==null?void 0:c.status)===404)console.log("ℹ️ No commands found for device"),S.value=[];else throw k}}else if(i.device.commands&&Object.keys(i.device.commands).length>0)console.log("✅ Using commands from device object"),S.value=Object.entries(i.device.commands).map(([k,l])=>({name:k,type:l.command_type||l.type||"ir"}));else if(i.device.commands!==void 0)console.log("ℹ️ Device has empty commands object - skipping API call"),S.value=[];else if(i.device.id){console.log("🌐 Fetching commands from API for device ID:",i.device.id);try{const l=(await Q.get(`/api/commands/${i.device.id}`)).data.commands||{};S.value=Object.entries(l).map(([O,B])=>({name:O,type:B.command_type||B.type||"ir"}))}catch(k){if(((A=k.response)==null?void 0:A.status)===404)console.log("ℹ️ No commands found for device (this is normal for new devices)"),S.value=[];else throw k}}else console.log("⚠️ No commands found and no device ID");console.log("📋 Final learned commands:",S.value)}}catch(k){console.error("Error loading commands:",k)}finally{h.value=!1}},v=async()=>{q.value="",P.value="",V.value="",C.value=!0,o.value="preparing";try{const d=m.value==="__custom__"?g.value:m.value;o.value="learning";const c=await Q.post("/api/commands/learn",{device_id:i.device.id,entity_id:r.value||i.device.broadlink_entity,device:i.device.device||i.device.id,command:d.trim(),command_type:T.value,save_destination:I.value});if(c.data.success){if(o.value="complete",q.value=c.data.message||`Command "${d}" learned successfully!`,P.value="success",I.value==="manager_only"||I.value==="both"){S.value.find(l=>l.name===d)||S.value.push({name:d,type:T.value});const k=s.value.indexOf(d);k>-1&&s.value.splice(k,1)}if(I.value==="integration_only"){const A=i.device.device||i.device.id;await be(async()=>{var B;const O=((B=((await Q.get("/api/commands/untracked")).data.untracked||{})[A])==null?void 0:B.commands)||{};return d in O},{maxAttempts:15,intervalMs:500,description:`command "${d}" in storage`})}await Se(),m.value="",g.value="",_("learned",{deviceId:i.device.id,commandName:d,commandType:T.value}),C.value=!1,o.value=""}else throw new Error(c.data.error||"Failed to learn command")}catch(d){console.error("Learning error:",d),q.value=d.message||"Error learning command",P.value="error",C.value=!1,o.value=""}},F=async d=>{var c,A;try{E.value=d,oe.value="";let k=i.device.id.split(".")[1];i.device.device&&(k=i.device.device);const l=j.value?i.device.controller_device:r.value||i.device.broadlink_entity;if(!l){console.error("Missing entity_id for test command:",{isSmartIR:j.value,controller_device:i.device.controller_device,broadlink_entity:i.device.broadlink_entity,selectedBroadlink:r.value,device:i.device}),q.value="Missing Broadlink remote entity. Please select a Broadlink device.",P.value="error",E.value="";return}const O={device_id:i.device.id,entity_id:l,command:d,device:i.device.device||i.device.id};console.log("🧪 Testing command:",O),(await Q.post("/api/commands/test",O)).data.success&&(oe.value=d,setTimeout(()=>{oe.value===d&&(oe.value="")},2e3))}catch(k){console.error("❌ Test command error:",k);const l=((A=(c=k.response)==null?void 0:c.data)==null?void 0:A.error)||k.message||"Unknown error";q.value=`Failed to send command: ${l}`,P.value="error"}finally{E.value=""}},pe=d=>{L.value=d,f.value=!0},Oe=()=>{f.value=!1,L.value=""},fe=async d=>{const c=L.value;f.value=!1;try{if(console.log(`🗑️ Deleting command: ${c}, alsoDeleteFromIntegration: ${d}`),await Q.delete(`/api/commands/${i.device.id}/${c}`),d)try{const A=i.device.device||i.device.id;await Q.post("/api/commands/delete-from-storage",{device:A,command:c}),console.log("✅ Also deleted from Broadlink Integration storage"),await be(async()=>{var B;const O=((B=((await Q.get("/api/commands/untracked")).data.untracked||{})[A])==null?void 0:B.commands)||{};return!(c in O)},{maxAttempts:15,intervalMs:500,description:`command "${c}" removed from storage`})}catch(A){console.warn("⚠️ Failed to delete from Broadlink Integration storage:",A)}await x(!0),await Se(),q.value=`Command "${c}" deleted`,P.value="success",_("learned",{deviceId:i.device.id,commandName:c,action:"deleted"})}catch(A){console.error("❌ Delete error:",A),q.value=`Failed to delete command: ${A.message}`,P.value="error",await x(!0)}finally{L.value=""}},be=async(d,c={})=>{const{maxAttempts:A=10,intervalMs:k=500,description:l="storage change"}=c;console.log(`⏳ Polling for ${l} (max ${A} attempts, ${k}ms interval)`);for(let O=1;O<=A;O++){try{if(await d())return console.log(`✅ ${l} detected after ${O} attempt(s)`),!0}catch(B){console.warn(`⚠️ Poll attempt ${O} failed:`,B.message)}O<A&&await new Promise(B=>setTimeout(B,k))}return console.warn(`⏰ Timeout waiting for ${l} after ${A} attempts`),!1},Se=async()=>{try{let d=i.device.device;d||(d=i.device.id.includes(".")?i.device.id.split(".")[1]:i.device.id),console.log("🔍 Looking for untracked commands for device:",d);const A=(await Q.get("/api/commands/untracked")).data.untracked||{};console.log("📦 All untracked commands:",Object.keys(A)),console.log("📦 Untracked for this device:",A[d]),A[d]?s.value=Object.keys(A[d].commands):s.value=[]}catch(d){console.error("Error loading untracked commands:",d),s.value=[]}},Ee=()=>{s.value.length!==0&&(J.value=!0)},Z=async d=>{var c,A,k;console.log("🔵 [IMPORT SINGLE] Importing command:",d);try{const l=i.device.device||i.device.id||((c=i.device.id)!=null&&c.includes(".")?i.device.id.split(".")[1]:null);if(!l)throw new Error("Could not determine device name for import");console.log("🔵 [IMPORT SINGLE] Calling API to import command...");const O=await Q.post("/api/commands/import",{device_id:i.device.id,source_device:l,commands:[d]});console.log("🔵 [IMPORT SINGLE] API response:",O.data),O.data.success?(q.value=`Imported command '${d}' successfully!`,P.value="success",await x(!0),await Se(),_("learned",{deviceId:i.device.id,commandName:d,action:"imported"})):(q.value=O.data.error||"Failed to import command",P.value="error")}catch(l){console.error("🔴 [IMPORT SINGLE] Error:",l),q.value=((k=(A=l.response)==null?void 0:A.data)==null?void 0:k.error)||l.message||"Failed to import command",P.value="error"}},b=async()=>{var d;console.log("🔵 [IMPORT] Starting import process..."),console.log("🔵 [IMPORT] Current learned commands:",S.value.length),console.log("🔵 [IMPORT] Current untracked commands:",s.value.length),J.value=!1;try{const c=i.device.device||i.device.id||((d=i.device.id)!=null&&d.includes(".")?i.device.id.split(".")[1]:null);if(console.log("🔵 [IMPORT] Device object:",i.device),console.log("🔵 [IMPORT] Extracted device name:",c),!c)throw new Error("Could not determine device name for import");console.log("🔵 [IMPORT] Calling API to import commands...");const A=await Q.post("/api/commands/import",{device_id:i.device.id,source_device:c,commands:s.value});console.log("🔵 [IMPORT] API response:",A.data),A.data.success&&(q.value=`Imported ${A.data.imported_count} commands successfully!`,P.value="success",console.log("🔵 [IMPORT] Import successful, now reloading commands..."),console.log("🔵 [IMPORT] BEFORE reload - learned:",S.value.length,"untracked:",s.value.length),await x(!0),console.log("🔵 [IMPORT] AFTER loadLearnedCommands - learned:",S.value.length),await Se(),console.log("🔵 [IMPORT] AFTER loadUntrackedCommands - untracked:",s.value.length),console.log("🔵 [IMPORT] Final state - learned:",S.value,"untracked:",s.value),console.log("🔵 [IMPORT] Emitting learned event to parent..."),_("learned",{deviceId:i.device.id,action:"imported",count:A.data.imported_count}),console.log("🔵 [IMPORT] ✅ Import process complete!"))}catch(c){console.error("🔵 [IMPORT] ❌ Import failed:",c),q.value=`Failed to import commands: ${c.message}`,P.value="error"}};return(d,c)=>(n(),a("div",{class:"modal-overlay",onClick:c[11]||(c[11]=ue(A=>d.$emit("cancel"),["self"]))},[e("div",Bl,[e("div",Hl,[e("h2",null,p(j.value?"Commands for":"Learn Commands for")+" "+p(t.device.name),1),e("button",{onClick:c[0]||(c[0]=A=>d.$emit("cancel")),class:"close-btn"},[...c[12]||(c[12]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",ql,[j.value?(n(),a("div",zl,[c[17]||(c[17]=e("i",{class:"mdi mdi-information"},null,-1)),e("div",null,[c[16]||(c[16]=e("h3",null,"SmartIR Device",-1)),e("p",null,[c[13]||(c[13]=R("This device uses SmartIR code file ",-1)),e("strong",null,p(t.device.device_code),1),c[14]||(c[14]=R(". Commands are pre-configured and cannot be learned.",-1))]),t.device.entity_type==="climate"?(n(),a("p",Jl,[...c[15]||(c[15]=[e("i",{class:"mdi mdi-alert-circle-outline"},null,-1),e("strong",null,"Note:",-1),R(" Climate device commands are temperature-based. Testing individual modes may not work as expected. Use the Home Assistant climate card to control your device. ",-1)])])):M("",!0)])])):(n(),a("form",{key:1,onSubmit:ue(v,["prevent"])},[e("div",Wl,[c[18]||(c[18]=e("label",{for:"broadlink-entity"},"Broadlink Device",-1)),e("input",{id:"broadlink-entity",value:ye.value,type:"text",readonly:"",disabled:""},null,8,Gl),c[19]||(c[19]=e("small",null,"Commands will be learned using this device (set when device was created)",-1))]),e("div",Kl,[c[22]||(c[22]=e("label",{for:"command-name"},"Command Name *",-1)),W(e("select",{id:"command-name",ref_key:"commandSelect",ref:X,"onUpdate:modelValue":c[1]||(c[1]=A=>m.value=A),disabled:C.value,required:"",onChange:te},[c[20]||(c[20]=e("option",{value:""},"-- Select or type command --",-1)),e("optgroup",Yl,[(n(!0),a(ce,null,ke(xe.value,A=>(n(),a("option",{key:A,value:A},p(A),9,Zl))),128))]),c[21]||(c[21]=e("option",{value:"__custom__"},"Custom command...",-1))],40,Xl),[[Ie,m.value]]),m.value==="__custom__"?W((n(),a("input",{key:0,ref_key:"customCommandInput",ref:H,"onUpdate:modelValue":c[2]||(c[2]=A=>g.value=A),type:"text",placeholder:"Enter custom command name",disabled:C.value,required:"",class:"custom-command-input",onInput:ie},null,40,Ql)),[[Me,g.value]]):M("",!0),e("small",null,"Select a suggested command for "+p(t.device.entity_type||"this device")+", or enter a custom one.",1)]),e("div",en,[c[25]||(c[25]=e("label",null,"Command Type",-1)),e("div",tn,[e("label",on,[W(e("input",{type:"radio","onUpdate:modelValue":c[3]||(c[3]=A=>T.value=A),value:"ir",disabled:C.value},null,8,ln),[[Ne,T.value]]),c[23]||(c[23]=e("span",null,"IR (Infrared)",-1))]),e("label",nn,[W(e("input",{type:"radio","onUpdate:modelValue":c[4]||(c[4]=A=>T.value=A),value:"rf",disabled:C.value},null,8,sn),[[Ne,T.value]]),c[24]||(c[24]=e("span",null,"RF (Radio Frequency)",-1))])])]),e("div",an,[e("label",null,[c[27]||(c[27]=R(" Save Destination ",-1)),e("button",{type:"button",class:"help-btn",onClick:c[5]||(c[5]=A=>U.value=!U.value),title:"Learn more"},[...c[26]||(c[26]=[e("i",{class:"mdi mdi-help-circle-outline"},null,-1)])])]),e("div",rn,[e("label",dn,[W(e("input",{type:"radio","onUpdate:modelValue":c[6]||(c[6]=A=>I.value=A),value:"manager_only",disabled:C.value},null,8,un),[[Ne,I.value]]),c[28]||(c[28]=e("span",null,"Only Save to Broadlink Manager",-1))]),e("label",cn,[W(e("input",{type:"radio","onUpdate:modelValue":c[7]||(c[7]=A=>I.value=A),value:"integration_only",disabled:C.value},null,8,mn),[[Ne,I.value]]),c[29]||(c[29]=e("span",null,"Only Save to Broadlink Integration",-1))]),e("label",vn,[W(e("input",{type:"radio","onUpdate:modelValue":c[8]||(c[8]=A=>I.value=A),value:"both",disabled:C.value},null,8,pn),[[Ne,I.value]]),c[30]||(c[30]=e("span",null,"Save to Both",-1))])]),U.value?(n(),a("div",fn,[...c[31]||(c[31]=[e("h4",null,"Save Destination Options",-1),e("ul",null,[e("li",null,[e("strong",null,"Only Save to Broadlink Manager (Recommended):"),R(" Commands are saved only in this app's database (devices.json). This gives you full control and makes commands portable. The Broadlink Integration won't see these commands.")]),e("li",null,[e("strong",null,"Only Save to Broadlink Integration:"),R(" Commands are saved only in Home Assistant's Broadlink Integration storage. This app won't track these commands, but they'll be available to the Broadlink Integration's remote.send_command service.")]),e("li",null,[e("strong",null,"Save to Both:"),R(" Commands are saved in both places. Use this if you want commands available in both this app and the Broadlink Integration.")])],-1)])])):M("",!0)]),e("div",gn,[e("button",{type:"submit",class:"btn btn-primary btn-large",disabled:C.value},[C.value?(n(),a("i",bn)):(n(),a("i",hn)),R(" "+p(C.value?"Learning...":"Learn Command"),1)],8,yn)]),C.value?(n(),a("div",kn,[c[37]||(c[37]=e("i",{class:"mdi mdi-loading mdi-spin"},null,-1)),o.value==="preparing"?(n(),a("div",wn,[...c[32]||(c[32]=[e("p",null,[e("strong",null,"Preparing device...")],-1),e("small",null,"Connecting and authenticating with Broadlink device (this takes a few seconds)",-1)])])):T.value==="ir"?(n(),a("div",$n,[...c[33]||(c[33]=[e("p",null,[e("strong",null,"Ready!"),R(" Point your remote at the Broadlink device and press the button...")],-1),e("small",null,"This may take up to 30 seconds",-1)])])):T.value==="rf"?(n(),a("div",Cn,[V.value?M("",!0):(n(),a("p",_n,[...c[34]||(c[34]=[e("strong",null,"RF Learning - Single Action:",-1)])])),V.value?M("",!0):(n(),a("div",Sn,[...c[35]||(c[35]=[e("strong",null,"Press and HOLD the button for 2-3 seconds, then RELEASE",-1)])])),V.value?(n(),a("div",In,[e("strong",null,p(V.value),1)])):M("",!0),o.value==="captured"?(n(),a("div",Dn,[...c[36]||(c[36]=[e("i",{class:"mdi mdi-check-circle"},null,-1),e("span",null,"Signal captured! Saving...",-1)])])):M("",!0)])):M("",!0)])):M("",!0),q.value&&P.value==="success"&&!q.value.includes("sent successfully")?(n(),a("div",Tn,[c[38]||(c[38]=e("i",{class:"mdi mdi-check-circle"},null,-1)),e("p",null,p(q.value),1)])):M("",!0)],32)),S.value.length>0||s.value.length>0?(n(),a("div",xn)):M("",!0),h.value?(n(),a("div",Rn,[...c[39]||(c[39]=[e("div",{class:"loading-spinner"},[e("i",{class:"mdi mdi-loading mdi-spin"}),e("p",null,"Loading commands...")],-1)])])):S.value.length>0?(n(),a("div",Mn,[e("h3",null,"Tracked Commands ("+p(S.value.length)+")",1),e("div",An,[(n(!0),a(ce,null,ke(S.value,A=>(n(),a("div",{key:A.name,class:"command-item"},[e("div",On,[e("span",En,p(A.label||A.name),1)]),e("div",Ln,[e("i",{class:"mdi mdi-check-circle learned-icon",title:`Learned (${(A.type||"ir").toUpperCase()})`},null,8,Vn),e("span",{class:K(["command-type-badge",A.type||"ir"])},p((A.type||"ir").toUpperCase()),3),e("div",Pn,[e("button",{type:"button",onClick:k=>F(A.name),class:"icon-btn",title:"Test command",disabled:E.value===A.name},[e("i",{class:K(["mdi mdi-play",{"mdi-spin":E.value===A.name}])},null,2)],8,Un),e("button",{type:"button",onClick:k=>pe(A.name),class:"icon-btn danger",title:"Delete and re-learn"},[...c[40]||(c[40]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,Fn)])])]))),128))])])):M("",!0),s.value.length>0?(n(),a("div",jn,[e("h3",null,[c[41]||(c[41]=e("i",{class:"mdi mdi-alert"},null,-1)),R(" Untracked Commands ("+p(s.value.length)+") ",1)]),c[45]||(c[45]=e("p",{class:"untracked-info"}," These commands exist in Broadlink storage but are not tracked in this device. ",-1)),e("div",Nn,[(n(!0),a(ce,null,ke(s.value,A=>(n(),a("div",{key:A,class:"command-item untracked"},[e("span",Bn,p(A),1),c[43]||(c[43]=e("span",{class:"untracked-badge"},"Not tracked",-1)),e("button",{type:"button",onClick:k=>Z(A),class:"btn-icon",title:"Import this command"},[...c[42]||(c[42]=[e("i",{class:"mdi mdi-import"},null,-1)])],8,Hn)]))),128))]),e("button",{type:"button",onClick:Ee,class:"btn btn-secondary"},[...c[44]||(c[44]=[e("i",{class:"mdi mdi-import"},null,-1),R(" Import All Untracked Commands ",-1)])])])):M("",!0)]),e("div",qn,[e("button",{type:"button",onClick:c[9]||(c[9]=A=>d.$emit("cancel")),class:"btn btn-secondary",disabled:C.value}," Close ",8,zn)])]),ge(Fe,{isOpen:f.value,title:"Delete Command?",message:`Delete command '${L.value}' from Broadlink Manager?`,checkboxLabel:"Also delete from Broadlink Integration storage",confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,onConfirm:fe,onCancel:Oe},null,8,["isOpen","message"]),ge(Fe,{isOpen:J.value,title:"Import Commands?",message:`Import ${s.value.length} untracked command${s.value.length>1?"s":""} into this device?`,confirmText:"Import",cancelText:"Cancel",onConfirm:b,onCancel:c[10]||(c[10]=A=>J.value=!1)},null,8,["isOpen","message"])]))}},Wn=we(Jn,[["__scopeId","data-v-5d14f5a6"]]),Gn={class:"modal-container error-dialog"},Kn={class:"modal-header"},Xn={class:"modal-body"},Yn={class:"error-message"},Zn={key:0,class:"error-suggestion"},Qn=["open"],es={class:"debug-content"},ts={class:"debug-info"},os={key:0,class:"debug-section-title"},ls={key:1},ns={__name:"ErrorDialog",props:{isOpen:{type:Boolean,default:!1},title:{type:String,default:"Error"},message:{type:String,required:!0},suggestion:{type:String,default:""},details:{type:String,default:""},error:{type:Object,default:null},context:{type:Object,default:()=>({})}},emits:["close"],setup(t,{emit:u}){const i=t,_=u,w=Te("toast"),r=y(!1),m=()=>{_("close")},g=G(()=>{var V,q,P,S,s,h,f,L,J,X,H;const C=new Date().toISOString(),o=i.error||{};return{error:JSON.stringify({message:i.message,title:i.title,details:i.details,errorObject:o.message||o.toString(),timestamp:C},null,2),request:JSON.stringify({method:((q=(V=o.config)==null?void 0:V.method)==null?void 0:q.toUpperCase())||"N/A",url:((P=o.config)==null?void 0:P.url)||"N/A",baseURL:((S=o.config)==null?void 0:S.baseURL)||"N/A",headers:((s=o.config)==null?void 0:s.headers)||{},data:(h=o.config)!=null&&h.data?JSON.parse(o.config.data):"N/A",params:((f=o.config)==null?void 0:f.params)||{}},null,2),response:JSON.stringify({status:((L=o.response)==null?void 0:L.status)||"N/A",statusText:((J=o.response)==null?void 0:J.statusText)||"N/A",data:((X=o.response)==null?void 0:X.data)||"N/A",headers:((H=o.response)==null?void 0:H.headers)||{}},null,2),browser:JSON.stringify({userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language,cookieEnabled:navigator.cookieEnabled,onLine:navigator.onLine,viewport:`${window.innerWidth}x${window.innerHeight}`,screenResolution:`${window.screen.width}x${window.screen.height}`,colorDepth:window.screen.colorDepth,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,timestamp:C},null,2),appState:JSON.stringify({currentRoute:window.location.pathname,currentURL:window.location.href,referrer:document.referrer||"N/A",context:i.context||{},localStorage:{smartir_simulate:localStorage.getItem("smartir_simulate_not_installed"),theme:localStorage.getItem("theme")}},null,2),stackTrace:o.stack||null}}),T=async()=>{const C=U();try{await navigator.clipboard.writeText(C),w==null||w.success("Debug information copied to clipboard","✅ Copied")}catch(o){console.error("Failed to copy:",o),w==null||w.error("Failed to copy to clipboard","❌ Copy Failed")}},I=()=>{const C=U(),o=new Blob([C],{type:"text/plain"}),V=URL.createObjectURL(o),q=document.createElement("a");q.href=V;const P=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5);q.download=`broadlink-manager-error-${P}.txt`,document.body.appendChild(q),q.click(),document.body.removeChild(q),URL.revokeObjectURL(V),w==null||w.success("Debug report downloaded","✅ Downloaded")},U=()=>`Broadlink Manager - Error Report
${"=".repeat(60)}

Generated: ${new Date().toISOString()}
Title: ${i.title}
Message: ${i.message}
${i.suggestion?`Suggestion: ${i.suggestion}
`:""}
${"=".repeat(60)}

ERROR DETAILS
${"-".repeat(60)}
${g.value.error}

REQUEST INFORMATION
${"-".repeat(60)}
${g.value.request}

RESPONSE INFORMATION
${"-".repeat(60)}
${g.value.response}

BROWSER INFORMATION
${"-".repeat(60)}
${g.value.browser}

APPLICATION STATE
${"-".repeat(60)}
${g.value.appState}

${g.value.stackTrace?`STACK TRACE
${"-".repeat(60)}
${g.value.stackTrace}

`:""}
${"=".repeat(60)}
End of Report
`;return ae(()=>i.isOpen,C=>{if(C){const o=V=>{V.key==="Escape"&&m()};return document.addEventListener("keydown",o),()=>document.removeEventListener("keydown",o)}}),(C,o)=>(n(),Pe(lt,{to:"body"},[ge(tt,{name:"modal"},{default:Ye(()=>[t.isOpen?(n(),a("div",{key:0,class:"modal-overlay",onClick:ue(m,["self"])},[e("div",Gn,[e("div",Kn,[o[2]||(o[2]=e("div",{class:"header-icon error-icon"},[e("i",{class:"mdi mdi-alert-circle"})],-1)),e("h3",null,p(t.title),1),e("button",{onClick:m,class:"close-button"},[...o[1]||(o[1]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Xn,[e("p",Yn,p(t.message),1),t.suggestion?(n(),a("p",Zn,[o[3]||(o[3]=e("i",{class:"mdi mdi-lightbulb-on"},null,-1)),R(" "+p(t.suggestion),1)])):M("",!0),e("details",{class:"debug-section",open:r.value},[e("summary",{onClick:o[0]||(o[0]=V=>r.value=!r.value)},[e("i",{class:K(["mdi",r.value?"mdi-chevron-down":"mdi-chevron-right"])},null,2),o[4]||(o[4]=R(" Debug Information ",-1))]),e("div",es,[e("div",{class:"debug-actions"},[e("button",{onClick:T,class:"btn-debug btn-copy"},[...o[5]||(o[5]=[e("i",{class:"mdi mdi-content-copy"},null,-1),R(" Copy to Clipboard ",-1)])]),e("button",{onClick:I,class:"btn-debug btn-download"},[...o[6]||(o[6]=[e("i",{class:"mdi mdi-download"},null,-1),R(" Download Report ",-1)])])]),e("div",ts,[o[7]||(o[7]=e("div",{class:"debug-section-title"},"Error Details",-1)),e("pre",null,p(g.value.error),1),o[8]||(o[8]=e("div",{class:"debug-section-title"},"Request Information",-1)),e("pre",null,p(g.value.request),1),o[9]||(o[9]=e("div",{class:"debug-section-title"},"Response Information",-1)),e("pre",null,p(g.value.response),1),o[10]||(o[10]=e("div",{class:"debug-section-title"},"Browser Information",-1)),e("pre",null,p(g.value.browser),1),o[11]||(o[11]=e("div",{class:"debug-section-title"},"Application State",-1)),e("pre",null,p(g.value.appState),1),g.value.stackTrace?(n(),a("div",os,"Stack Trace")):M("",!0),g.value.stackTrace?(n(),a("pre",ls,p(g.value.stackTrace),1)):M("",!0)])])],8,Qn)]),e("div",{class:"modal-footer"},[e("button",{onClick:m,class:"btn btn-primary"}," OK ")])])])):M("",!0)]),_:1})]))}},ss=we(ns,[["__scopeId","data-v-23858149"]]),as={key:0,class:"discovery-banner"},is={class:"banner-content"},rs={class:"banner-text"},ds={class:"modal-dialog"},us={class:"modal-header"},cs={class:"modal-body"},ms={class:"device-list"},vs={class:"device-info"},ps={class:"device-details"},fs={class:"command-count"},gs={class:"device-actions"},ys=["onClick"],bs=["onClick"],hs={class:"modal-footer"},ks={class:"modal-dialog modal-dialog-small"},ws={class:"modal-header"},$s={class:"modal-body"},Cs={class:"warning-message"},_s={class:"modal-footer"},Ss=["disabled"],Is=["disabled"],Ds={__name:"DeviceDiscovery",emits:["adopt"],setup(t,{expose:u,emit:i}){const _=He(),w=i,r=y([]),m=y(!1),g=y(!1),T=y(null),I=y(!1),U=G(()=>r.value.length>0);Ae(async()=>{await C()});const C=async()=>{try{const P=await Q.get("/api/devices/discover");r.value=P.data.untracked_devices||[]}catch(P){console.error("Error loading untracked devices:",P),r.value=[]}},o=P=>{m.value=!1,w("adopt",P)},V=P=>{T.value=P,g.value=!0},q=async()=>{if(!T.value)return;const P=T.value.device_name;I.value=!0;try{const S=await Q.delete(`/api/devices/untracked/${encodeURIComponent(P)}`);if(S.data.success)r.value=r.value.filter(s=>s.device_name!==P),g.value=!1,T.value=null,r.value.length===0&&(m.value=!1),_.success(`Deleted all commands for '${P}'`);else throw new Error(S.data.error||"Failed to delete device")}catch(S){console.error("Error deleting device:",S),_.error(`Failed to delete device: ${S.message}`)}finally{I.value=!1}};return u({refresh:C}),(P,S)=>{var s,h,f;return U.value?(n(),a("div",as,[e("div",is,[S[9]||(S[9]=e("div",{class:"banner-icon"},[e("i",{class:"mdi mdi-radar"})],-1)),e("div",rs,[S[7]||(S[7]=e("h3",null,"Untracked Devices Found",-1)),e("p",null,p(r.value.length)+" device"+p(r.value.length>1?"s":"")+" with learned commands found in Broadlink storage",1)]),e("button",{onClick:S[0]||(S[0]=L=>m.value=!0),class:"btn btn-primary"},[...S[8]||(S[8]=[e("i",{class:"mdi mdi-eye"},null,-1),R(" View Devices ",-1)])])]),m.value?(n(),a("div",{key:0,class:"modal-overlay",onClick:S[3]||(S[3]=ue(L=>m.value=!1,["self"]))},[e("div",ds,[e("div",us,[S[11]||(S[11]=e("h2",null,"Discovered Devices",-1)),e("button",{onClick:S[1]||(S[1]=L=>m.value=!1),class:"close-btn"},[...S[10]||(S[10]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",cs,[S[16]||(S[16]=e("p",{class:"info-text"}," These devices have learned commands in Broadlink storage but are not being tracked. Adopt them to manage their commands and generate Home Assistant entities. ",-1)),e("div",ms,[(n(!0),a(ce,null,ke(r.value,L=>(n(),a("div",{key:L.device_name,class:"discovered-device"},[e("div",vs,[S[13]||(S[13]=e("div",{class:"device-icon"},[e("i",{class:"mdi mdi-devices"})],-1)),e("div",ps,[e("h4",null,p(L.device_name),1),e("span",fs,[S[12]||(S[12]=e("i",{class:"mdi mdi-remote"},null,-1)),R(" "+p(L.command_count)+" command"+p(L.command_count>1?"s":""),1)])])]),e("div",gs,[e("button",{onClick:J=>o(L),class:"btn btn-primary"},[...S[14]||(S[14]=[e("i",{class:"mdi mdi-plus"},null,-1),R(" Adopt ",-1)])],8,ys),e("button",{onClick:J=>V(L),class:"btn btn-danger",title:"Delete all commands"},[...S[15]||(S[15]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,bs)])]))),128))])]),e("div",hs,[e("button",{onClick:S[2]||(S[2]=L=>m.value=!1),class:"btn btn-secondary"}," Close ")])])])):M("",!0),g.value?(n(),a("div",{key:1,class:"modal-overlay",onClick:S[6]||(S[6]=ue(L=>g.value=!1,["self"]))},[e("div",ks,[e("div",ws,[S[18]||(S[18]=e("h2",null,"Delete Untracked Device",-1)),e("button",{onClick:S[4]||(S[4]=L=>g.value=!1),class:"close-btn"},[...S[17]||(S[17]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",$s,[e("div",Cs,[S[20]||(S[20]=e("i",{class:"mdi mdi-alert"},null,-1)),e("div",null,[e("p",null,[e("strong",null,'Are you sure you want to delete "'+p((s=T.value)==null?void 0:s.device_name)+'"?',1)]),e("p",null,"This will permanently delete all "+p((h=T.value)==null?void 0:h.command_count)+" command"+p(((f=T.value)==null?void 0:f.command_count)>1?"s":"")+" from Broadlink storage.",1),S[19]||(S[19]=e("p",{class:"warning-text"},"This action cannot be undone.",-1))])])]),e("div",_s,[e("button",{onClick:S[5]||(S[5]=L=>g.value=!1),class:"btn btn-secondary",disabled:I.value}," Cancel ",8,Ss),e("button",{onClick:q,class:"btn btn-danger",disabled:I.value},[e("i",{class:K(["mdi",I.value?"mdi-loading mdi-spin":"mdi-delete"])},null,2),R(" "+p(I.value?"Deleting...":"Delete"),1)],8,Is)])])])):M("",!0)])):M("",!0)}}},Ts=we(Ds,[["__scopeId","data-v-783e943f"]]),xs={class:"device-list-card"},Rs={class:"card-header"},Ms={class:"header-badges"},As={class:"header-info"},Os={class:"header-right"},Es={key:0,class:"view-toggle-group header-view-toggle"},Ls={class:"settings-menu-container"},Vs=["disabled"],Ps=["disabled"],Us={class:"card-body"},Fs={key:0,class:"filter-bar"},js={class:"filter-search-row"},Ns=["title"],Bs={key:0,class:"filter-badge"},Hs={class:"search-input-wrapper"},qs={class:"filter-content"},zs={class:"filter-row filter-row-dropdowns"},Js={class:"filter-group"},Ws=["value"],Gs={class:"filter-group"},Ks=["value"],Xs={class:"filter-group"},Ys={key:0,class:"filter-group filter-toggle"},Zs={class:"toggle-label"},Qs={class:"filter-results"},ea={key:1,class:"loading-state"},ta={key:2,class:"error-state"},oa={key:3,class:"empty-state"},la={key:4,class:"device-grid"},na={key:6,class:"no-results"},sa={__name:"DeviceList",setup(t){const u=gt(),i=He(),{isMobile:_}=Ze(),w=y(!1),r=y(!1),m=y(null),g=y(!1),T=y(!1),I=y(null),U=y(null),C=y(!0),o=y(!1),V=y(!1),P=y(window.innerWidth<=767?"grid":localStorage.getItem("device_view_mode")||"grid");ae(_,D=>{D&&P.value==="list"&&(P.value="grid")}),ae(P,D=>{localStorage.setItem("device_view_mode",D)});const S=()=>{C.value=!C.value,C.value||(T.value=!1)},s=()=>{C.value||(C.value=!0),T.value=!T.value},h=y(!1),f=y({title:"Error",message:"",suggestion:"",details:"",error:null,context:{}}),L=y(!1),J=y({success:!1,title:"",message:""}),X=y(!1),H=y({search:"",broadlinkDevice:"",area:"",entityType:"",showSmartIROnly:!1}),oe=y([]),E=Te("smartirStatus"),j=Te("smartirEnabled"),te=G(()=>{var $;return localStorage.getItem("smartir_simulate_not_installed")==="true"?!1:(($=E==null?void 0:E.value)==null?void 0:$.installed)||!1}),ie=G(()=>{const D=new Map;return u.devices.forEach($=>{if($.broadlink_entity){const N=oe.value.find(ee=>ee.entity_id===$.broadlink_entity),z=N&&N.name||$.broadlink_entity;D.set($.broadlink_entity,{entity_id:$.broadlink_entity,friendly_name:z})}}),Array.from(D.values()).sort(($,N)=>$.friendly_name.localeCompare(N.friendly_name))}),ye=G(()=>{const D=new Set;return u.devices.forEach($=>{$.area&&D.add($.area)}),Array.from(D).sort()}),_e=G(()=>{let D=u.devices;if(H.value.search){const N=H.value.search.toLowerCase();D=D.filter(z=>{var me,re,Ce,Le,Ue;if((me=z.name)!=null&&me.toLowerCase().includes(N)||(re=z.entity_type)!=null&&re.toLowerCase().includes(N)||(Ce=z.area)!=null&&Ce.toLowerCase().includes(N)||(Le=z.id)!=null&&Le.toLowerCase().includes(N)||Object.keys(z.commands||{}).some(Ve=>Ve.toLowerCase().includes(N)))return!0;const he=oe.value.find(Ve=>Ve.entity_id===z.broadlink_entity);return!!((Ue=he==null?void 0:he.name)!=null&&Ue.toLowerCase().includes(N))})}H.value.broadlinkDevice&&(D=D.filter(N=>N.broadlink_entity===H.value.broadlinkDevice||N.controller_device===H.value.broadlinkDevice)),H.value.area&&(D=D.filter(N=>N.area===H.value.area)),H.value.entityType&&(D=D.filter(N=>N.entity_type===H.value.entityType)),H.value.showSmartIROnly&&(D=D.filter(N=>N.device_type==="smartir"));const $=localStorage.getItem("smartir_simulate_not_installed")==="true";return(!(j!=null&&j.value)||$)&&(D=D.filter(N=>N.device_type!=="smartir")),D}),xe=G(()=>H.value.search||H.value.broadlinkDevice||H.value.area||H.value.entityType||H.value.showSmartIROnly),De=G(()=>{let D=0;return H.value.search&&D++,H.value.broadlinkDevice&&D++,H.value.area&&D++,H.value.entityType&&D++,H.value.showSmartIROnly&&D++,D}),x=()=>{H.value.search="",H.value.broadlinkDevice="",H.value.area="",H.value.entityType="",H.value.showSmartIROnly=!1},v=async()=>{try{const D=await Q.get("/api/remote/devices");oe.value=D.data.devices||[]}catch(D){console.error("Error loading remote devices:",D)}};ae(P,D=>{localStorage.setItem("device_view_mode",D)}),Ae(async()=>{await Promise.all([u.loadDevices(),v()])});const F=D=>{m.value=D,w.value=!0},pe=G(()=>{if(!I.value)return"";const D=Object.keys(I.value.commands||{}).length;return D===0?"This device has no commands. The device will be removed from tracking.":`This device has ${D} learned command${D>1?"s":""}. What would you like to do?`}),Oe=G(()=>{if(!I.value)return"";const D=Object.keys(I.value.commands||{}).length;return D===0?"":`Also delete all ${D} command${D>1?"s":""} from Broadlink storage`}),fe=D=>{I.value=D,g.value=!0},be=()=>{g.value=!1,I.value=null},Se=async D=>{var N,z;const $=I.value;g.value=!1;try{await u.deleteDevice($.id,D),U.value&&await U.value.refresh()}catch(ee){const he=((z=(N=ee.response)==null?void 0:N.data)==null?void 0:z.error)||ee.message||"Unknown error";c("Failed to Delete Device",he)}finally{I.value=null}},Ee=async D=>{var $,N,z,ee,he;try{console.log("💾 Saving device data:",D),console.log("💾 Device commands:",D.commands),console.log("💾 Selected device:",m.value),($=m.value)!=null&&$.id&&m.value.id!==null?await u.updateDevice(m.value.id,D):await u.createDevice(D),Z(),U.value&&await U.value.refresh()}catch(me){let re="Failed to save device",Ce="",Le="";(z=(N=me.response)==null?void 0:N.data)!=null&&z.error?(re=me.response.data.error,Ce=me.response.data.suggestion||""):me.message&&(re=me.message),me.response&&(Le=`Status: ${me.response.status}
URL: ${((ee=me.config)==null?void 0:ee.url)||"N/A"}`),c("Failed to Save Device",re,Ce,Le,me,{action:"save_device",deviceData:D,isEdit:!!((he=m.value)!=null&&he.id)})}},Z=()=>{w.value=!1,m.value=null},b=D=>{m.value=D,r.value=!0},d=()=>{r.value=!1,m.value=null},c=(D,$,N="",z="",ee=null,he={})=>{f.value={title:D,message:$,suggestion:N,details:z,error:ee,context:he},h.value=!0},A=()=>{h.value=!1},k=()=>{L.value=!1},l=async D=>{var $;if(console.log("🟢 [PARENT] Received learned event:",D),!D||!D.deviceId){console.warn("⚠️ [PARENT] Missing required data in learned event");return}if(console.log("🟢 [PARENT] Current selectedDevice commands:",Object.keys((($=m.value)==null?void 0:$.commands)||{}).length),console.log("🟢 [PARENT] Current store device count:",u.devices.length),console.log("🟢 [PARENT] Force reloading all devices from API with cache bust..."),await u.loadDevices(!0),console.log("🟢 [PARENT] After reload - store device count:",u.devices.length),m.value){console.log("🟢 [PARENT] Looking for device:",D.deviceId);const N=u.devices.find(z=>z.id===D.deviceId);N?(console.log("🟢 [PARENT] Found fresh device with",Object.keys(N.commands||{}).length,"commands"),m.value={...N},console.log("🟢 [PARENT] ✅ Updated selectedDevice - now has",Object.keys(m.value.commands||{}).length,"commands")):console.error("🟢 [PARENT] ❌ Device not found in store after reload!")}U.value&&(console.log("🟢 [PARENT] Refreshing discovery..."),U.value.refresh()),console.log("🟢 [PARENT] ✅ handleCommandLearned complete!")},O=D=>{const $=D.split("_"),N=[];for(let z=0;z<$.length;z++){const ee=$[z],he=$[z+1];ee&&he==="s"&&$[z+2]?(N.push(ee.charAt(0).toUpperCase()+ee.slice(1)+"'s"),z++):ee!=="s"&&N.push(ee.charAt(0).toUpperCase()+ee.slice(1))}return N.join(" ")},B=(D,$)=>{const N=D.toLowerCase(),z=$.map(re=>re.toLowerCase());return N.includes("lamp")||N.includes("light")?"light":N.includes("fan")?"fan":N.includes("tv")||N.includes("stereo")||N.includes("speaker")||N.includes("receiver")?"media_player":N.includes("blind")||N.includes("curtain")||N.includes("shade")||N.includes("garage")?"cover":z.some(re=>re.includes("volume")||re.includes("channel")||re.includes("play")||re.includes("pause")||re.includes("mute"))?"media_player":z.some(re=>re.includes("fan_speed")||re.includes("fan_low")||re.includes("fan_high"))?"fan":z.some(re=>re.includes("open")||re.includes("close")||re.includes("stop"))?"cover":"switch"},ne=(D,$)=>{const N=D.toLowerCase();return N.includes("tv")?"mdi:television":N.includes("stereo")||N.includes("receiver")||N.includes("speaker")?"mdi:speaker":N.includes("lamp")?"mdi:lamp":N.includes("light")?"mdi:lightbulb":N.includes("fan")?"mdi:fan":N.includes("blind")?"mdi:blinds":N.includes("curtain")?"mdi:curtains":N.includes("garage")?"mdi:garage":{light:"mdi:lightbulb",fan:"mdi:fan",switch:"mdi:light-switch",media_player:"mdi:speaker",cover:"mdi:window-shutter"}[$]||"mdi:devices"},se=D=>{const $=D.toLowerCase().split("_");for(let ee=0;ee<$.length-2;ee++)if($[ee+1]==="s"){const he=$.slice(ee,ee+3),me=O(he.join("_"));return console.log("Detected possessive area:",me,"from",D),me}const N=[["living","room"],["dining","room"],["master","bedroom"],["guest","bedroom"],["family","room"],["laundry","room"],["home","office"]];for(let ee=0;ee<$.length-1;ee++){const he=[$[ee],$[ee+1]],me=N.find(re=>re[0]===he[0]&&re[1]===he[1]);if(me)return O(me.join("_"))}const z=["kitchen","bedroom","bathroom","garage","office","basement","attic","hallway","entryway","patio","deck","yard","garden"];for(const ee of $)if(z.includes(ee))return ee.charAt(0).toUpperCase()+ee.slice(1);return""},le=async D=>{var $,N;try{const z=O(D.device_name),ee=se(D.device_name),he=B(D.device_name,D.commands),me=ne(D.device_name,he);let re="";try{console.log("Finding Broadlink owner for:",D.device_name);const Ve=await Q.post("/api/devices/find-broadlink-owner",{device_name:D.device_name});console.log("Broadlink owner response:",Ve.data),re=Ve.data.broadlink_entity||"",console.log("Detected Broadlink entity:",re)}catch(Ve){console.error("Error finding Broadlink owner:",Ve)}console.log("Fetching command data from Broadlink storage...");const Le=(await Q.get(`/api/commands/broadlink/${D.device_name}`)).data.commands||{};console.log("Fetched command data:",Le);const Ue={};for(const[Ve,Ke]of Object.entries(Le)){const rt=typeof Ke=="string"&&Ke.length>200;Ue[Ve]={data:Ke,type:rt?"rf":"ir",name:Ve,learned_at:new Date().toISOString()}}console.log("Transformed commands:",Ue),m.value={id:null,device:D.device_name,name:z,entity_type:he,commands:Ue,area:ee,icon:me,broadlink_entity:re,enabled:!0},w.value=!0,i.success(`Imported ${Object.keys(Ue).length} commands from Broadlink storage`)}catch(z){console.error("Error adopting device:",z),i.error("Failed to adopt device: "+(((N=($=z.response)==null?void 0:$.data)==null?void 0:N.error)||z.message))}},Y=async()=>{V.value=!0;try{await u.syncAllAreas(),i.success("Areas synced from Home Assistant")}catch(D){console.error("Error syncing areas:",D),i.error("Failed to sync areas")}finally{V.value=!1}},de=async()=>{var D,$;o.value=!0;try{const N=await Q.post("/api/entities/generate",{});if(N.data.success){const z=N.data.broadlink_count||0,ee=N.data.smartir_count||0,he=N.data.total_count||0,me=N.data.errors||[];let re="✅ Entity Generation Successful",Ce=[];const Le=[];z>0&&Le.push(`${z} Broadlink native`),ee>0&&Le.push(`${ee} SmartIR`),Le.length>0&&Ce.push(`Generated ${Le.join(" and ")} entity configuration${he!==1?"s":""}.`),z>0&&(Ce.push(`
📁 Broadlink entities created in:`),Ce.push("  • broadlink_manager/entities.yaml"),Ce.push("  • broadlink_manager/helpers.yaml")),ee>0&&(Ce.push(`
📁 SmartIR entities created in:`),Ce.push("  • smartir/climate.yaml"),Ce.push("  • smartir/media_player.yaml"),Ce.push("  • smartir/fan.yaml")),Ce.push(`
📝 Next steps:`),Ce.push("1. Check your configuration.yaml includes the generated files"),Ce.push("2. Restart Home Assistant to load the new entities"),me.length>0&&(re="⚠️ Entity Generation Completed with Errors",Ce.push(`
⚠️ ${me.length} error${me.length!==1?"s":""} occurred:`),me.forEach(Ue=>{Ce.push(`  • ${Ue}`)})),J.value={success:!0,title:re,message:Ce.join(`
`)},L.value=!0}else J.value={success:!1,title:"❌ Entity Generation Failed",message:N.data.message||`Failed to generate entities.

Please check that you have at least one device configured.`},L.value=!0}catch(N){console.error("Error generating entities:",N);const z=(($=(D=N.response)==null?void 0:D.data)==null?void 0:$.error)||N.message||"Unknown error occurred";J.value={success:!1,title:"❌ Entity Generation Error",message:`Failed to generate entities:

${z}

Please check the logs for more details.`},L.value=!0}finally{o.value=!1}},Re=async({device:D,command:$})=>{var N,z;try{const ee={device_id:D.id,command:$,device:D.device||D.id,entity_id:D.broadlink_entity||D.controller_device};await Q.post("/api/commands/test",ee),i.success(`Sent ${$} to ${D.name}`)}catch(ee){console.error("Error sending command:",ee);const he=((z=(N=ee.response)==null?void 0:N.data)==null?void 0:z.error)||ee.message||"Unknown error";i.error(`Failed to send ${$}: ${he}`)}};return(D,$)=>{var N;return n(),a("div",xs,[e("div",Rs,[e("button",{class:"icon-button chevron-button",onClick:S},[e("i",{class:K(["mdi",C.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2)]),e("div",{class:"header-left",onClick:S},[$[14]||($[14]=e("div",{class:"header-icon"},[e("i",{class:"mdi mdi-devices"})],-1)),e("h3",null,p($e(_)?"Devices":"Managed Devices"),1),e("div",Ms,[e("span",As,p($e(u).deviceCount)+" devices",1)])]),e("div",Os,[$e(_)?M("",!0):(n(),a("div",Es,[e("button",{onClick:$[0]||($[0]=ue(z=>P.value="grid",["stop"])),class:K(["view-toggle-btn",{active:P.value==="grid"}]),title:"Grid View"},[...$[15]||($[15]=[e("i",{class:"mdi mdi-view-grid"},null,-1)])],2),e("button",{onClick:$[1]||($[1]=ue(z=>P.value="list",["stop"])),class:K(["view-toggle-btn",{active:P.value==="list"}]),title:"List View"},[...$[16]||($[16]=[e("i",{class:"mdi mdi-view-list"},null,-1)])],2)])),e("button",{onClick:$[2]||($[2]=ue(z=>w.value=!0,["stop"])),class:"btn btn-primary new-button"},[...$[17]||($[17]=[e("i",{class:"mdi mdi-plus"},null,-1),e("span",null,"New",-1)])]),e("div",Ls,[e("button",{onClick:ue(s,["stop"]),class:K(["icon-button settings-button",{active:T.value}]),title:"Settings"},[...$[18]||($[18]=[e("i",{class:"mdi mdi-cog"},null,-1)])],2),T.value?(n(),a("div",{key:0,class:"settings-dropdown",onClick:$[5]||($[5]=ue(()=>{},["stop"]))},[e("button",{onClick:$[3]||($[3]=z=>{Y(),T.value=!1}),class:"menu-item",disabled:V.value},[e("i",{class:K(["mdi",V.value?"mdi-loading mdi-spin":"mdi-refresh"])},null,2),e("span",null,p(V.value?"Syncing Areas...":"Sync Areas"),1)],8,Vs),e("button",{onClick:$[4]||($[4]=z=>{de(),T.value=!1}),class:"menu-item",disabled:o.value},[e("i",{class:K(["mdi",o.value?"mdi-loading mdi-spin":"mdi-file-code"])},null,2),e("span",null,p(o.value?"Generating...":"Generate Entities"),1)],8,Ps)])):M("",!0)])])]),W(e("div",Us,[ge(Ts,{ref_key:"discoveryRef",ref:U,onAdopt:le},null,512),$e(u).hasDevices?(n(),a("div",Fs,[e("div",js,[e("button",{class:K(["filter-toggle-button",{active:X.value||xe.value}]),onClick:$[6]||($[6]=z=>X.value=!X.value),title:X.value?"Hide filters":"Show filters"},[$[19]||($[19]=e("i",{class:"mdi mdi-filter-variant"},null,-1)),xe.value?(n(),a("span",Bs,p(De.value),1)):M("",!0)],10,Ns),e("div",Hs,[$[20]||($[20]=e("i",{class:"mdi mdi-magnify search-icon"},null,-1)),W(e("input",{"onUpdate:modelValue":$[7]||($[7]=z=>H.value.search=z),type:"text",placeholder:"Search devices, commands...",class:"search-input"},null,512),[[Me,H.value.search]])])]),W(e("div",qs,[e("div",zs,[e("div",Js,[e("label",null,[$[22]||($[22]=e("i",{class:"mdi mdi-access-point"},null,-1)),W(e("select",{"onUpdate:modelValue":$[8]||($[8]=z=>H.value.broadlinkDevice=z)},[$[21]||($[21]=e("option",{value:""},"All Controller Devices",-1)),(n(!0),a(ce,null,ke(ie.value,z=>(n(),a("option",{key:z.entity_id,value:z.entity_id},p(z.friendly_name),9,Ws))),128))],512),[[Ie,H.value.broadlinkDevice]])])]),e("div",Gs,[e("label",null,[$[24]||($[24]=e("i",{class:"mdi mdi-home-map-marker"},null,-1)),W(e("select",{"onUpdate:modelValue":$[9]||($[9]=z=>H.value.area=z)},[$[23]||($[23]=e("option",{value:""},"All Areas",-1)),(n(!0),a(ce,null,ke(ye.value,z=>(n(),a("option",{key:z,value:z},p(z),9,Ks))),128))],512),[[Ie,H.value.area]])])]),e("div",Xs,[e("label",null,[$[26]||($[26]=e("i",{class:"mdi mdi-shape"},null,-1)),W(e("select",{"onUpdate:modelValue":$[10]||($[10]=z=>H.value.entityType=z)},[...$[25]||($[25]=[je('<option value="" data-v-bf03d560>All Types</option><option value="light" data-v-bf03d560>Light</option><option value="fan" data-v-bf03d560>Fan</option><option value="switch" data-v-bf03d560>Switch</option><option value="media_player" data-v-bf03d560>Media Player</option><option value="cover" data-v-bf03d560>Cover</option><option value="climate" data-v-bf03d560>Climate</option>',7)])],512),[[Ie,H.value.entityType]])])]),te.value?(n(),a("div",Ys,[e("label",Zs,[$[27]||($[27]=e("span",{class:"toggle-text"},[e("img",{src:Ge,alt:"SmartIR",class:"smartir-icon"}),R(" SmartIR Only ")],-1)),W(e("input",{type:"checkbox","onUpdate:modelValue":$[11]||($[11]=z=>H.value.showSmartIROnly=z),class:"toggle-checkbox"},null,512),[[ve,H.value.showSmartIROnly]]),$[28]||($[28]=e("span",{class:"toggle-slider"},null,-1))])])):M("",!0),xe.value?(n(),a("button",{key:1,onClick:x,class:"btn-clear-filters"},[...$[29]||($[29]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),R(" Clear ",-1)])])):M("",!0),e("div",Qs,p(_e.value.length)+" of "+p($e(u).deviceCount),1)])],512),[[Je,X.value]])])):M("",!0),$e(u).loading?(n(),a("div",ea,[...$[30]||($[30]=[e("i",{class:"mdi mdi-loading mdi-spin"},null,-1),e("p",null,"Loading devices...",-1)])])):$e(u).error?(n(),a("div",ta,[$[31]||($[31]=e("i",{class:"mdi mdi-alert-circle"},null,-1)),e("p",null,p($e(u).error),1),e("button",{onClick:$[12]||($[12]=z=>$e(u).loadDevices()),class:"btn btn-secondary"}," Retry ")])):$e(u).hasDevices?M("",!0):(n(),a("div",oa,[$[33]||($[33]=e("i",{class:"mdi mdi-devices"},null,-1)),$[34]||($[34]=e("h3",null,"No Devices Yet",-1)),$[35]||($[35]=e("p",null,"Get started by adding your first managed device",-1)),e("button",{onClick:$[13]||($[13]=z=>w.value=!0),class:"btn btn-primary"},[...$[32]||($[32]=[e("i",{class:"mdi mdi-plus"},null,-1),R(" Add Your First Device ",-1)])])])),P.value==="grid"?(n(),a("div",la,[(n(!0),a(ce,null,ke(_e.value,z=>(n(),Pe(Ut,{key:z.id,device:z,"broadlink-devices":oe.value,onEdit:F,onDelete:fe,onLearn:b},null,8,["device","broadlink-devices"]))),128))])):P.value==="list"&&_e.value.length>0?(n(),Pe(so,{key:5,devices:_e.value,onSendCommand:Re,onOpenCommands:b,onEditDevice:F,onDeleteDevice:fe},null,8,["devices"])):M("",!0),$e(u).hasDevices&&_e.value.length===0?(n(),a("div",na,[...$[36]||($[36]=[e("i",{class:"mdi mdi-filter-off"},null,-1),e("h3",null,"No devices match your filters",-1),e("p",null,"Try adjusting your search or filter criteria",-1)])])):M("",!0)],512),[[Je,C.value]]),w.value?(n(),Pe(El,{key:0,device:m.value,onSave:Ee,onCancel:Z},null,8,["device"])):M("",!0),r.value?(n(),Pe(Wn,{key:1,device:m.value,onLearned:l,onCancel:d},null,8,["device"])):M("",!0),ge(Fe,{isOpen:g.value,title:`Delete ${(N=I.value)==null?void 0:N.name}?`,message:pe.value,confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,checkboxLabel:Oe.value,onConfirm:Se,onCancel:be},null,8,["isOpen","title","message","checkboxLabel"]),ge(ss,{isOpen:h.value,title:f.value.title,message:f.value.message,suggestion:f.value.suggestion,details:f.value.details,error:f.value.error,context:f.value.context,onClose:A},null,8,["isOpen","title","message","suggestion","details","error","context"]),ge(Fe,{isOpen:L.value,title:J.value.title,message:J.value.message,confirmText:"OK",showCancel:!1,dangerMode:!J.value.success,onConfirm:k,onCancel:k},null,8,["isOpen","title","message","dangerMode"])])}}},aa=we(sa,[["__scopeId","data-v-bf03d560"]]),ia={class:"banner-content"},ra={class:"banner-icon"},da={class:"banner-message"},ua={class:"banner-actions"},ca={__name:"SmartIRBanner",setup(t){const u=Te("smartirStatus"),i=y(!1),_=G(()=>!(!u.value||i.value||localStorage.getItem("smartir_banner_dismissed")==="true")),w=G(()=>{var U;return(U=u.value)!=null&&U.installed?"banner-success":"banner-info"}),r=G(()=>{var U;return(U=u.value)!=null&&U.installed?"mdi mdi-check-circle":"mdi mdi-information"}),m=G(()=>{var U;return(U=u.value)!=null&&U.installed?`SmartIR Detected (v${u.value.version})`:"Want Climate Device Support?"}),g=G(()=>{var U;return(U=u.value)!=null&&U.installed?"You can now create climate device profiles with full temperature and HVAC mode control.":"Install SmartIR to unlock AC/heater control with temperature settings, HVAC modes, and 120+ pre-configured device profiles."});function T(){window.open("https://github.com/smartHomeHub/SmartIR","_blank")}function I(){var U;if(i.value=!0,(U=u.value)!=null&&U.installed)localStorage.setItem("smartir_banner_dismissed","true");else{const C=parseInt(localStorage.getItem("smartir_banner_dismiss_count")||"0");C>=2?localStorage.setItem("smartir_banner_dismissed","true"):localStorage.setItem("smartir_banner_dismiss_count",String(C+1))}}return Ae(()=>{var o;const U=localStorage.getItem("smartir_last_status"),C=(o=u.value)!=null&&o.installed?"installed":"not_installed";U!==C&&(localStorage.removeItem("smartir_banner_dismissed"),localStorage.removeItem("smartir_banner_dismiss_count"),localStorage.setItem("smartir_last_status",C))}),(U,C)=>{var o,V;return _.value?(n(),a("div",{key:0,class:K(["smartir-banner",w.value])},[e("div",ia,[e("div",ra,[e("i",{class:K(r.value)},null,2)]),e("div",da,[e("strong",null,p(m.value),1),e("p",null,p(g.value),1)]),e("div",ua,[(o=U.status)!=null&&o.installed?M("",!0):(n(),a("button",{key:0,onClick:T,class:"btn-primary"}," Learn More ")),e("button",{onClick:I,class:"btn-text"},p((V=U.status)!=null&&V.installed?"Got it":"Dismiss"),1)])])],2)):M("",!0)}}},ma=we(ca,[["__scopeId","data-v-7bbcbcd7"]]),Be="api/smartir",at={async getStatus(){try{const t=await fetch(`${Be}/status`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return await t.json()}catch(t){return console.error("Error fetching SmartIR status:",t),{installed:!1,version:null,error:t.message}}},async getInstallInstructions(){try{const t=await fetch(`${Be}/install-instructions`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return await t.json()}catch(t){throw console.error("Error fetching install instructions:",t),t}},async getPlatforms(){try{const t=await fetch(`${Be}/platforms`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return await t.json()}catch(t){throw console.error("Error fetching platforms:",t),t}},async getPlatformCodes(t){try{const u=await fetch(`${Be}/platforms/${t}/codes`);if(!u.ok)throw new Error(`HTTP error! status: ${u.status}`);return await u.json()}catch(u){throw console.error(`Error fetching codes for ${t}:`,u),u}},async getNextCode(t){try{const u=await fetch(`${Be}/platforms/${t}/next-code`);if(!u.ok)throw new Error(`HTTP error! status: ${u.status}`);return await u.json()}catch(u){throw console.error(`Error fetching next code for ${t}:`,u),u}},async validateCode(t,u){try{const i=await fetch(`${Be}/validate-code`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({platform:t,code:u})});if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);return await i.json()}catch(i){throw console.error("Error validating code:",i),i}}},va={class:"profile-card"},pa={class:"profile-card-header"},fa=["title"],ga={class:"profile-details"},ya=["title"],ba={class:"profile-meta"},ha=["title"],ka=["title"],wa=["title"],$a={class:"profile-card-footer"},Ca=["title"],_a={key:0,class:"learned-indicator"},Sa={class:"profile-actions"},Ia={__name:"SmartIRProfileCard",props:{profile:{type:Object,required:!0}},emits:["edit","download","delete","commands"],setup(t){const u=t,i=nt(G(()=>u.profile.platform)),_=m=>m.replace(/_/g," ").replace(/\b\w/g,g=>g.toUpperCase()),w=m=>m&&m.startsWith("mdi:")?`mdi ${m.replace(":"," mdi-")}`:`mdi mdi-${m}`,r=m=>{if(!m)return"";const g=m.toLowerCase();return g.includes("broadlink")?"broadlink-tag":g.includes("not set")?"not-set-tag":"default-controller-tag"};return(m,g)=>(n(),a("div",va,[e("div",pa,[e("div",{class:K(["profile-icon",$e(i).colorClass.value]),title:_(t.profile.platform)},[e("i",{class:K(w($e(i).icon.value))},null,2)],10,fa),e("div",ga,[e("h4",{title:`${t.profile.manufacturer} ${t.profile.model}`},p(t.profile.manufacturer)+" "+p(t.profile.model),9,ya),e("div",ba,[e("span",{class:"tag platform-tag",title:_(t.profile.platform)},p(_(t.profile.platform)),9,ha),t.profile.controllerBrand?(n(),a("span",{key:0,class:K(["tag controller-tag",r(t.profile.controllerBrand)]),title:"Controller: "+t.profile.controllerBrand},[g[4]||(g[4]=e("i",{class:"mdi mdi-remote-tv"},null,-1)),R(" "+p(t.profile.controllerBrand),1)],10,ka)):M("",!0)])]),e("div",{class:"code-badge",title:"Device Code: "+t.profile.code},p(t.profile.code),9,wa)]),e("div",$a,[e("div",{class:"profile-stats",title:t.profile.commandCount+" total commands"+(t.profile.learnedCount>0?", "+t.profile.learnedCount+" learned":"")},[g[5]||(g[5]=e("i",{class:"mdi mdi-remote"},null,-1)),e("span",null,p(t.profile.commandCount)+" command"+p(t.profile.commandCount!==1?"s":""),1),t.profile.learnedCount>0?(n(),a("span",_a,"( "+p(t.profile.learnedCount)+" learned )",1)):M("",!0)],8,Ca),e("div",Sa,[e("button",{onClick:g[0]||(g[0]=T=>m.$emit("commands")),class:"action-btn",title:"Commands"},[...g[6]||(g[6]=[e("i",{class:"mdi mdi-remote"},null,-1)])]),e("button",{onClick:g[1]||(g[1]=T=>m.$emit("edit")),class:"action-btn",title:"Edit Profile"},[...g[7]||(g[7]=[e("i",{class:"mdi mdi-pencil"},null,-1)])]),e("button",{onClick:g[2]||(g[2]=T=>m.$emit("download")),class:"action-btn",title:"Download JSON"},[...g[8]||(g[8]=[e("i",{class:"mdi mdi-download"},null,-1)])]),e("button",{onClick:g[3]||(g[3]=T=>m.$emit("delete")),class:"action-btn delete",title:"Delete Profile"},[...g[9]||(g[9]=[e("i",{class:"mdi mdi-delete"},null,-1)])])])])]))}},Da=we(Ia,[["__scopeId","data-v-aad9720f"]]),Ta={name:"SmartIRProfileListView",props:{profiles:{type:Array,required:!0}},methods:{getPlatformIcon(t){return{climate:"mdi-thermostat",media_player:"mdi-television",fan:"mdi-fan",light:"mdi-lightbulb"}[t]||"mdi-devices"},formatPlatform(t){return{climate:"Climate",media_player:"Media Player",fan:"Fan",light:"Light"}[t]||t},editProfile(t){this.$emit("edit",t)},viewCommands(t){this.$emit("commands",t)},downloadProfile(t){this.$emit("download",t)},deleteProfile(t){this.$emit("delete",t)}}},xa={class:"profile-list-view"},Ra={class:"profile-table"},Ma={class:"profile-code"},Aa={class:"code-badge"},Oa={class:"profile-manufacturer"},Ea={class:"profile-model"},La={class:"model-info"},Va={class:"model-name"},Pa={key:0,class:"model-count"},Ua={class:"profile-platform"},Fa={class:"profile-controller"},ja={class:"profile-commands"},Na={class:"command-stats"},Ba={class:"stat-item"},Ha={key:0,class:"stat-item learned"},qa={class:"profile-actions"},za=["onClick"],Ja=["onClick"],Wa=["onClick"],Ga=["onClick"];function Ka(t,u,i,_,w,r){return n(),a("div",xa,[e("table",Ra,[u[6]||(u[6]=e("thead",null,[e("tr",null,[e("th",null,"Code"),e("th",null,"Manufacturer"),e("th",null,"Model"),e("th",null,"Platform"),e("th",null,"Controller"),e("th",null,"Commands"),e("th",null,"Actions")])],-1)),e("tbody",null,[(n(!0),a(ce,null,ke(i.profiles,m=>(n(),a("tr",{key:`${m.platform}-${m.code}`,class:"profile-row"},[e("td",Ma,[e("span",Aa,p(m.code),1)]),e("td",Oa,p(m.manufacturer||"Unknown"),1),e("td",Ea,[e("div",La,[e("div",Va,p(m.model||"Unknown"),1),m.models&&m.models.length>1?(n(),a("div",Pa," +"+p(m.models.length-1)+" more ",1)):M("",!0)])]),e("td",Ua,[e("span",{class:K(["platform-badge",m.platform])},[e("i",{class:K(["mdi",r.getPlatformIcon(m.platform)])},null,2),R(" "+p(r.formatPlatform(m.platform)),1)],2)]),e("td",Fa,p(m.controller_brand||"N/A"),1),e("td",ja,[e("div",Na,[e("span",Ba,[u[0]||(u[0]=e("i",{class:"mdi mdi-remote"},null,-1)),R(" "+p(m.command_count||0),1)]),m.learned_count>0?(n(),a("span",Ha,[u[1]||(u[1]=e("i",{class:"mdi mdi-school"},null,-1)),R(" "+p(m.learned_count),1)])):M("",!0)])]),e("td",qa,[e("button",{class:"action-btn edit",onClick:g=>r.editProfile(m),title:"Edit Profile"},[...u[2]||(u[2]=[e("i",{class:"mdi mdi-pencil"},null,-1)])],8,za),e("button",{class:"action-btn commands",onClick:g=>r.viewCommands(m),title:"View Commands"},[...u[3]||(u[3]=[e("i",{class:"mdi mdi-remote"},null,-1)])],8,Ja),e("button",{class:"action-btn download",onClick:g=>r.downloadProfile(m),title:"Download"},[...u[4]||(u[4]=[e("i",{class:"mdi mdi-download"},null,-1)])],8,Wa),e("button",{class:"action-btn delete",onClick:g=>r.deleteProfile(m),title:"Delete"},[...u[5]||(u[5]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,Ga)])]))),128))])])])}const Xa=we(Ta,[["render",Ka],["__scopeId","data-v-d3773038"]]),Ya={class:"modal-container"},Za={class:"modal-body"},Qa={key:0,class:"selection-section"},ei={class:"form-group"},ti={class:"form-group"},oi={class:"form-group"},li={key:0,class:"code-info"},ni={class:"form-actions"},si=["disabled"],ai={key:1,class:"testing-section"},ii={class:"code-header"},ri={class:"code-details"},di={class:"code-badge"},ui={class:"device-selector"},ci=["value"],mi={key:0,class:"helper-text"},vi={class:"commands-section"},pi={class:"commands-header"},fi={key:0,class:"tested-count"},gi={key:0,class:"filters-section"},yi={class:"filter-row"},bi={class:"filter-row"},hi={key:1,class:"empty-state"},ki={key:2,class:"empty-state"},wi={key:3,class:"commands-list"},$i={class:"command-name"},Ci={class:"command-actions"},_i={key:0,class:"status-badge success"},Si=["onClick","disabled","title"],Ii={__name:"SmartIRCodeTester",props:{isOpen:{type:Boolean,default:!1}},emits:["close","clone"],setup(t,{emit:u}){const i=t,_=u,w=Te("toast"),r=y("climate"),m=y(""),g=y([]),T=y(!1),I=y(null),U=y(""),C=y([]),o=y(!1),V=G(()=>C.value.map(Z=>({code:Z.code,label:`${Z.models.join(", ")} (Code: ${Z.code})`,value:Z.code}))),q=y(null),P=y(null),S=y(!1),s=y([]),h=y(""),f=y([]),L=y(new Set),J=y(null),X=y(""),H=y(""),oe=y(""),E=y(""),j=G(()=>{let Z=f.value;if(X.value){const b=X.value.toLowerCase();Z=Z.filter(d=>(d.label||d.name).toLowerCase().includes(b))}return H.value&&(Z=Z.filter(b=>b.mode===H.value)),oe.value&&(Z=Z.filter(b=>b.fanSpeed===oe.value)),E.value&&(Z=Z.filter(b=>b.swingMode===E.value)),Z}),te=G(()=>X.value||H.value||oe.value||E.value);ae(()=>i.isOpen,Z=>{Z&&(ie(),_e())}),ae(r,()=>{i.isOpen&&(m.value="",I.value=null,C.value=[],ie())});async function ie(){var Z;T.value=!0;try{const b=await Q.get("/api/smartir/codes/manufacturers",{params:{entity_type:r.value}});g.value=b.data.manufacturers||[]}catch(b){console.error("Error loading manufacturers:",b),(Z=w.value)==null||Z.error("Failed to load manufacturers","❌ Error")}finally{T.value=!1}}async function ye(){var Z;if(m.value){o.value=!0;try{const b=await Q.get("/api/smartir/codes/models",{params:{entity_type:r.value,manufacturer:m.value}});C.value=b.data.models||[]}catch(b){console.error("Error loading models:",b),(Z=w.value)==null||Z.error("Failed to load models","❌ Error")}finally{o.value=!1}}}async function _e(){try{const Z=await Q.get("/api/remote/devices");s.value=Z.data.devices||[]}catch(Z){console.error("Error loading Broadlink devices:",Z)}}async function xe(){var Z,b;if(I.value){S.value=!0;try{const d=await Q.get("/api/smartir/codes/code",{params:{entity_type:r.value,code_id:I.value.code}});P.value=d.data.code,q.value=I.value.code,De(d.data.code),(Z=w.value)==null||Z.success(`Loaded ${f.value.length} commands`,"✅ Code Loaded")}catch(d){console.error("Error loading code:",d),(b=w.value)==null||b.error(d.message||"Failed to load code","❌ Error")}finally{S.value=!1}}}function De(Z){const b=[];if(!Z.commands){f.value=b;return}if(r.value==="climate"){const c=Z.commands;for(const[A,k]of Object.entries(c)){if(A==="off"){typeof k=="string"&&b.push({name:"off",label:"OFF",data:k,mode:"off"});continue}if(typeof k=="object"){for(const[l,O]of Object.entries(k))if(typeof O=="object")for(const[B,ne]of Object.entries(O)){if(typeof ne!="object")continue;const se=Object.keys(ne),le=se.includes("24")?"24":se[0];if(le&&typeof ne[le]=="string"){const Y=`${A}_${le}_${l}_${B}`,de=`${A.toUpperCase()} ${le}°C ${l} ${B}`;b.push({name:Y,label:de,data:ne[le],mode:A,temperature:le,fanSpeed:l,swingMode:B})}}}}}else for(const[c,A]of Object.entries(Z.commands))typeof A=="string"&&b.push({name:c,label:c.toUpperCase().replace(/_/g," "),data:A});f.value=b}async function x(Z){var b,d,c;if(!h.value){(b=w.value)==null||b.warning("Please select a Broadlink device first","⚠️ No Device");return}J.value=Z;try{const A=f.value.find(k=>k.name===Z);if(!A||!A.data)throw new Error(`Command "${Z}" not found`);await Q.post("/api/commands/send-raw",{entity_id:h.value,command:A.data,command_type:"ir"}),L.value.add(Z),(d=w.value)==null||d.success(`Command sent: ${A.label||Z}`,"✅ Tested")}catch(A){console.error("Error testing command:",A),(c=w.value)==null||c.error("Failed to test command","❌ Error")}finally{J.value=null}}function v(){var Z,b,d,c;if(!P.value){(Z=w.value)==null||Z.error("No profile data to download","❌ Error");return}try{const A=P.value.manufacturer||"unknown",k=((b=P.value.supportedModels)==null?void 0:b[0])||q.value,l=`${A.toLowerCase().replace(/\s+/g,"_")}_${k.toLowerCase().replace(/\s+/g,"_")}.json`,O=JSON.stringify(P.value,null,2),B=new Blob([O],{type:"application/json"}),ne=URL.createObjectURL(B),se=document.createElement("a");se.href=ne,se.download=l,document.body.appendChild(se),se.click(),document.body.removeChild(se),URL.revokeObjectURL(ne),(d=w.value)==null||d.success(`Downloaded ${l}`,"✅ Download Complete")}catch(A){console.error("Error downloading JSON:",A),(c=w.value)==null||c.error(A.message||"Failed to download JSON","❌ Download Error")}}function F(){m.value="",I.value=null,U.value="",C.value=[]}function pe(){I.value=null,U.value="",ye()}function Oe(){U.value?I.value=C.value.find(Z=>Z.code===U.value):I.value=null}function fe(){X.value="",H.value="",oe.value="",E.value=""}function be(){q.value=null,P.value=null,f.value=[],L.value.clear(),J.value=null,fe()}function Se(Z){const b=Z.toLowerCase();return b.includes("power")||b.includes("off")||b==="off"?"mdi-power":b.includes("cool")?"mdi-snowflake":b.includes("heat")?"mdi-fire":b.includes("fan")?"mdi-fan":b.includes("auto")?"mdi-auto-fix":b.includes("dry")?"mdi-water-percent":b.includes("temp")?"mdi-thermometer":b.includes("swing")?"mdi-swap-vertical":"mdi-remote"}function Ee(){be(),m.value="",I.value=null,_("close")}return(Z,b)=>{var d;return t.isOpen?(n(),a("div",{key:0,class:"modal-overlay",onClick:ue(Ee,["self"])},[e("div",Ya,[e("div",{class:"modal-header"},[b[9]||(b[9]=e("h3",null,[e("i",{class:"mdi mdi-test-tube"}),R(" Test SmartIR Code ")],-1)),e("button",{onClick:Ee,class:"close-btn"},[...b[8]||(b[8]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Za,[q.value?(n(),a("div",ai,[e("div",ii,[e("div",ri,[e("h4",null,p(P.value.manufacturer)+" - "+p(((d=P.value.supportedModels)==null?void 0:d[0])||"Unknown"),1),e("span",di,"Code: "+p(q.value),1)]),e("button",{onClick:be,class:"btn-secondary-small"},[...b[14]||(b[14]=[e("i",{class:"mdi mdi-arrow-left"},null,-1),R(" Change Code ",-1)])])]),e("div",ui,[b[17]||(b[17]=e("label",null,[e("i",{class:"mdi mdi-remote"}),R(" Broadlink Device ")],-1)),W(e("select",{"onUpdate:modelValue":b[3]||(b[3]=c=>h.value=c),class:"form-select"},[b[15]||(b[15]=e("option",{value:""},"Select device to test with...",-1)),(n(!0),a(ce,null,ke(s.value,c=>(n(),a("option",{key:c.entity_id,value:c.entity_id},p(c.friendly_name||c.entity_id),9,ci))),128))],512),[[Ie,h.value]]),h.value?M("",!0):(n(),a("p",mi,[...b[16]||(b[16]=[e("i",{class:"mdi mdi-information-outline"},null,-1),R(" Select a Broadlink device to enable command testing ",-1)])]))]),e("div",vi,[e("div",pi,[e("h5",null,"Sample Commands ("+p(j.value.length)+" / "+p(f.value.length)+")",1),L.value.size>0?(n(),a("span",fi,p(L.value.size)+" tested ",1)):M("",!0)]),r.value==="climate"&&f.value.length>0?(n(),a("div",gi,[e("div",yi,[W(e("input",{"onUpdate:modelValue":b[4]||(b[4]=c=>X.value=c),type:"text",placeholder:"Search commands...",class:"search-input"},null,512),[[Me,X.value]])]),e("div",bi,[W(e("select",{"onUpdate:modelValue":b[5]||(b[5]=c=>H.value=c),class:"filter-select"},[...b[18]||(b[18]=[e("option",{value:""},"All Modes",-1),e("option",{value:"cool"},"Cool",-1),e("option",{value:"heat"},"Heat",-1),e("option",{value:"off"},"Off",-1)])],512),[[Ie,H.value]]),W(e("select",{"onUpdate:modelValue":b[6]||(b[6]=c=>oe.value=c),class:"filter-select"},[...b[19]||(b[19]=[je('<option value="" data-v-66569200>All Fan Speeds</option><option value="low" data-v-66569200>Low</option><option value="mid" data-v-66569200>Mid</option><option value="high" data-v-66569200>High</option><option value="auto" data-v-66569200>Auto</option>',5)])],512),[[Ie,oe.value]]),W(e("select",{"onUpdate:modelValue":b[7]||(b[7]=c=>E.value=c),class:"filter-select"},[...b[20]||(b[20]=[e("option",{value:""},"All Swing",-1),e("option",{value:"stop"},"Stop",-1),e("option",{value:"swing"},"Swing",-1)])],512),[[Ie,E.value]]),te.value?(n(),a("button",{key:0,onClick:fe,class:"btn-clear-filters"},[...b[21]||(b[21]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),R(" Clear ",-1)])])):M("",!0)])])):M("",!0),f.value.length===0?(n(),a("div",hi,[...b[22]||(b[22]=[e("i",{class:"mdi mdi-alert-circle"},null,-1),e("p",null,"No commands found in this code",-1)])])):j.value.length===0?(n(),a("div",ki,[b[23]||(b[23]=e("i",{class:"mdi mdi-filter-off"},null,-1)),b[24]||(b[24]=e("p",null,"No commands match your filters",-1)),e("button",{onClick:fe,class:"btn-secondary-small"}," Clear Filters ")])):(n(),a("div",wi,[(n(!0),a(ce,null,ke(j.value,c=>(n(),a("div",{key:c.name,class:K(["command-item",{tested:L.value.has(c.name),testing:J.value===c.name}])},[e("div",$i,[e("i",{class:K(["mdi",Se(c.mode||c.name)])},null,2),e("span",null,p(c.label||c.name),1)]),e("div",Ci,[L.value.has(c.name)?(n(),a("span",_i,[...b[25]||(b[25]=[e("i",{class:"mdi mdi-check"},null,-1),R(" Tested ",-1)])])):M("",!0),e("button",{onClick:A=>x(c.name),disabled:!h.value||J.value===c.name,title:h.value?"Test this command":"Select a Broadlink device first",class:"btn-test"},[e("i",{class:K(["mdi",J.value===c.name?"mdi-loading mdi-spin":"mdi-play"])},null,2),b[26]||(b[26]=R(" Test ",-1))],8,Si)])],2))),128))]))]),e("div",{class:"modal-actions"},[e("button",{onClick:v,class:"btn-primary"},[...b[27]||(b[27]=[e("i",{class:"mdi mdi-download"},null,-1),R(" Download JSON ",-1)])]),e("button",{onClick:Ee,class:"btn-secondary"}," Close ")])])):(n(),a("div",Qa,[b[13]||(b[13]=e("div",{class:"info-banner"},[e("i",{class:"mdi mdi-information"}),e("p",null,"Select a SmartIR code from the index to test commands with your Broadlink device.")],-1)),e("div",ei,[b[11]||(b[11]=e("label",null,[e("i",{class:"mdi mdi-shape"}),R(" Platform ")],-1)),W(e("select",{"onUpdate:modelValue":b[0]||(b[0]=c=>r.value=c),onChange:F,class:"form-select"},[...b[10]||(b[10]=[e("option",{value:"climate"},"Climate (AC/Heater)",-1),e("option",{value:"media_player"},"Media Player (TV/Audio)",-1),e("option",{value:"fan"},"Fan",-1),e("option",{value:"light"},"Light",-1)])],544),[[Ie,r.value]])]),e("div",ti,[ge(We,{modelValue:m.value,"onUpdate:modelValue":b[1]||(b[1]=c=>m.value=c),options:g.value,label:"Manufacturer",placeholder:"Search manufacturers...",loading:T.value,disabled:T.value,onChange:pe},null,8,["modelValue","options","loading","disabled"])]),e("div",oi,[ge(We,{modelValue:U.value,"onUpdate:modelValue":b[2]||(b[2]=c=>U.value=c),options:V.value,"option-label":"label","option-value":"code",label:"Model",placeholder:"Search models...",loading:o.value,disabled:!m.value||o.value,onChange:Oe},null,8,["modelValue","options","loading","disabled"])]),I.value?(n(),a("div",li,[b[12]||(b[12]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[e("strong",null,p(m.value)+" - "+p(I.value.models[0]),1),e("p",null,"Code: "+p(I.value.code),1)])])):M("",!0),e("div",ni,[e("button",{onClick:xe,disabled:!I.value||S.value,class:"btn-primary"},[e("i",{class:K(["mdi",S.value?"mdi-loading mdi-spin":"mdi-download"])},null,2),R(" "+p(S.value?"Loading...":"Load Commands"),1)],8,si)])]))])])])):M("",!0)}}},Di=we(Ii,[["__scopeId","data-v-66569200"]]),Ti={class:"smartir-status-card"},xi={class:"card-header"},Ri=["src"],Mi={class:"header-badges"},Ai=["title"],Oi={class:"header-info"},Ei={class:"header-info"},Li={class:"header-info"},Vi={class:"header-right"},Pi={key:0,class:"view-toggle-group header-view-toggle"},Ui={key:2,class:"settings-menu-container"},Fi={key:0,class:"card-body loading-state"},ji={key:1,class:"card-body error-state"},Ni={key:2,class:"card-body installed-state"},Bi={key:0,class:"help-panel"},Hi={key:0,class:"recommendation"},qi={key:0,class:"next-steps"},zi={class:"help-actions"},Ji={key:1,class:"filter-bar"},Wi={class:"filter-search-row"},Gi=["title"],Ki={key:0,class:"filter-badge"},Xi={class:"search-input-wrapper"},Yi={class:"filter-content"},Zi={class:"filter-row"},Qi={class:"filter-group"},er={class:"filter-results"},tr={key:2,class:"loading-state"},or={key:3,class:"empty-state"},lr={key:4,class:"profiles-grid"},nr={key:6,class:"no-results"},sr={key:3,class:"card-body not-installed-state"},ar={class:"benefits-section"},ir={class:"benefits-list"},rr={class:"recommendation"},dr={__name:"SmartIRStatusCard",emits:["create-profile","edit-profile"],setup(t,{expose:u,emit:i}){const _=i,w=Te("smartirStatus");Te("smartirEnabled");const r=Te("refreshSmartIR"),{isMobile:m}=Ze(),g=y(!1),T=y(null),I=y((w==null?void 0:w.value)||null),U=y(localStorage.getItem("smartir_simulate_not_installed")==="true"),C=y(!1),o=y(!1),V=y(!0),q=y([]),P=y(!1),S=y(!1),s=y({search:"",platform:""}),h=y({show:!1,title:"",message:"",platform:null,profile:null}),f=y(!1),J=y(window.innerWidth<=767?"grid":localStorage.getItem("profile_view_mode")||"grid");ae(m,b=>{b&&J.value==="list"&&(J.value="grid")}),ae(J,b=>{localStorage.setItem("profile_view_mode",b)}),ae(V,b=>{b||(o.value=!1)});const X=["Full climate entity support (AC, heaters)","120+ pre-configured device profiles","Temperature and humidity sensor integration","HVAC mode control (heat, cool, auto, dry, fan)"],H=["climate","media_player","fan","light"],oe=G(()=>U.value?{installed:!1,recommendation:{message:"Install SmartIR to unlock climate device support!",benefits:["Full climate entity support (AC, heaters)","120+ pre-configured device profiles","Temperature and humidity sensor integration","HVAC mode control (heat, cool, auto, dry, fan)"]}}:I.value),E=G(()=>{var b,d;return((d=(b=oe.value)==null?void 0:b.platforms)==null?void 0:d.length)||0}),j=G(()=>{var b;return(b=oe.value)!=null&&b.device_counts?Object.values(oe.value.device_counts).reduce((d,c)=>d+c,0):0});function te(){var b;U.value=!U.value,localStorage.setItem("smartir_simulate_not_installed",U.value.toString()),!U.value&&((b=I.value)!=null&&b.installed)&&fe()}const ie=G(()=>{let b=q.value;if(s.value.search){const d=s.value.search.toLowerCase();b=b.filter(c=>{var A,k,l,O;return((A=c.manufacturer)==null?void 0:A.toLowerCase().includes(d))||((k=c.model)==null?void 0:k.toLowerCase().includes(d))||((l=c.code)==null?void 0:l.toString().includes(d))||((O=c.platform)==null?void 0:O.toLowerCase().includes(d))})}return s.value.platform&&(b=b.filter(d=>d.platform===s.value.platform)),b}),ye=G(()=>s.value.search||s.value.platform),_e=G(()=>{let b=0;return s.value.search&&b++,s.value.platform&&b++,b});function xe(){s.value.search="",s.value.platform=""}async function De(){g.value=!0,T.value=null;try{if(r)await r();else{const b=await at.getStatus();I.value=b}}catch(b){T.value=b.message||"Failed to refresh SmartIR status",console.error("Error refreshing SmartIR status:",b)}finally{g.value=!1}}function x(){_("create-profile")}function v(){C.value=!C.value,o.value=!1}function F(){V.value||(V.value=!0),o.value=!o.value}function pe(){f.value=!0,o.value=!1}function Oe(){window.open("https://github.com/smartHomeHub/SmartIR","_blank")}async function fe(){P.value=!0;const b=[];try{for(const d of H)try{const A=((await Q.get(`/api/smartir/platforms/${d}/profiles`)).data.profiles||[]).map(k=>({...k,platform:d}));b.push(...A)}catch(c){console.warn(`Network error loading ${d} profiles (using bundled index):`,c.message)}q.value=b}catch(d){console.error("Unexpected error loading profiles:",d)}finally{P.value=!1}}function be(b,d,c){_("edit-profile",{platform:b,profile:d,startStep:c})}async function Se(b,d){var c,A;try{const l=(await Q.get(`/api/smartir/platforms/${b}/profiles/${d.code}`)).data,O=JSON.stringify(l.profile,null,2),B=new Blob([O],{type:"application/json"}),ne=URL.createObjectURL(B),se=document.createElement("a");se.href=ne,se.download=`smartir_${b}_${d.manufacturer}_${d.model}_${d.code}.json`,document.body.appendChild(se),se.click(),document.body.removeChild(se),URL.revokeObjectURL(ne),(c=Te("toast").value)==null||c.success(`Downloaded ${d.manufacturer} ${d.model}`,"✅ Profile Downloaded")}catch(k){console.error("Error downloading profile:",k),(A=Te("toast").value)==null||A.error("Failed to download profile","❌ Download Error")}}async function Ee(b,d){Te("toast");try{const A=(await Q.post(`/api/smartir/profiles/${d.code}/check-usage`,{platform:b})).data;if(A&&A.in_use){h.value={show:!0,title:`Cannot Delete ${d.manufacturer} ${d.model}`,message:`This profile is currently in use by ${A.device_count} device(s):

${A.devices.join(`
`)}

Please remove or reassign these devices before deleting the profile.`,platform:b,profile:d,canDelete:!1,devices:A.devices};return}}catch(c){console.error("Error checking profile usage:",c)}h.value={show:!0,title:`Delete ${d.manufacturer} ${d.model}?`,message:`Device Code: ${d.code}

This will remove the profile and update your configuration.`,platform:b,profile:d,canDelete:!0}}async function Z(){var A,k;const b=Te("toast"),{platform:d,profile:c}=h.value;h.value.show=!1;try{await Q.delete(`/api/smartir/profiles/${c.code}`,{data:{platform:d}}),await fe(),await ot(),await De(),(A=b.value)==null||A.success(`${c.manufacturer} ${c.model} has been removed`,"✅ Profile Deleted")}catch(l){console.error("Error deleting profile:",l),(k=b.value)==null||k.error("Failed to delete profile","❌ Delete Error")}}return ae(w,b=>{b&&(I.value=b)},{immediate:!0}),ae(J,b=>{localStorage.setItem("profile_view_mode",b)}),Ae(async()=>{var b;w!=null&&w.value&&(I.value=w.value),I.value||await De(),(b=I.value)!=null&&b.installed&&await fe()}),u({loadAllProfiles:fe,refreshStatus:De}),(b,d)=>{var c,A,k,l,O,B,ne,se,le;return n(),a("div",Ti,[e("div",xi,[e("button",{class:"icon-button chevron-button",onClick:d[0]||(d[0]=Y=>V.value=!V.value)},[e("i",{class:K(["mdi",V.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2)]),e("div",{class:"header-left",onClick:d[1]||(d[1]=Y=>V.value=!V.value)},[e("img",{src:$e(Ge),alt:"SmartIR",class:"smartir-logo"},null,8,Ri),e("h3",null,p($e(m)?"SmartIR":"SmartIR Integration"),1),e("div",Mi,[e("div",{class:K(["simulation-toggle-pill",{active:U.value}]),onClick:ue(te,["stop"]),title:U.value?"Click to show as installed":"Click to simulate not-installed"},[e("i",{class:K(["mdi",U.value?"mdi-eye-off":"mdi-eye"])},null,2),e("span",null,p(U.value?"Simulating: Not Installed":"Simulation Mode"),1)],10,Ai),(c=oe.value)!=null&&c.installed?(n(),a(ce,{key:0},[d[16]||(d[16]=e("div",{class:"status-badge-mini success"},[e("i",{class:"mdi mdi-check-circle"}),e("span",null,"Installed")],-1)),e("span",Oi,"v"+p(oe.value.version||"Unknown"),1),e("span",Ei,p(E.value)+" platform"+p(E.value!==1?"s":""),1),e("span",Li,p(j.value)+" device"+p(j.value!==1?"s":""),1)],64)):M("",!0)])]),e("div",Vi,[!$e(m)&&((A=oe.value)!=null&&A.installed)?(n(),a("div",Pi,[e("button",{onClick:d[2]||(d[2]=ue(Y=>J.value="grid",["stop"])),class:K(["view-toggle-btn",{active:J.value==="grid"}]),title:"Grid View"},[...d[17]||(d[17]=[e("i",{class:"mdi mdi-view-grid"},null,-1)])],2),e("button",{onClick:d[3]||(d[3]=ue(Y=>J.value="list",["stop"])),class:K(["view-toggle-btn",{active:J.value==="list"}]),title:"List View"},[...d[18]||(d[18]=[e("i",{class:"mdi mdi-view-list"},null,-1)])],2)])):M("",!0),(k=oe.value)!=null&&k.installed?(n(),a("button",{key:1,onClick:ue(x,["stop"]),class:"btn btn-primary new-button"},[...d[19]||(d[19]=[e("i",{class:"mdi mdi-plus"},null,-1),e("span",null,"New",-1)])])):M("",!0),(l=oe.value)!=null&&l.installed?(n(),a("div",Ui,[e("button",{onClick:ue(F,["stop"]),class:K(["icon-button settings-button",{active:o.value}]),title:"Settings"},[...d[20]||(d[20]=[e("i",{class:"mdi mdi-cog"},null,-1)])],2),o.value?(n(),a("div",{key:0,class:"settings-dropdown",onClick:d[5]||(d[5]=ue(()=>{},["stop"]))},[e("button",{onClick:v,class:"menu-item"},[d[21]||(d[21]=e("i",{class:"mdi mdi-help-circle"},null,-1)),e("span",null,p(C.value?"Hide Help":"Show Help"),1)]),e("button",{onClick:d[4]||(d[4]=Y=>{o.value=!1,De()}),class:"menu-item"},[...d[22]||(d[22]=[e("i",{class:"mdi mdi-refresh"},null,-1),e("span",null,"Refresh Status",-1)])]),e("button",{onClick:pe,class:"menu-item"},[...d[23]||(d[23]=[e("i",{class:"mdi mdi-test-tube"},null,-1),e("span",null,"Test Codes",-1)])])])):M("",!0)])):M("",!0)])]),W(e("div",null,[g.value?(n(),a("div",Fi,[...d[24]||(d[24]=[e("div",{class:"spinner"},null,-1),e("p",null,"Checking SmartIR installation...",-1)])])):T.value?(n(),a("div",ji,[d[25]||(d[25]=e("i",{class:"mdi mdi-alert-circle"},null,-1)),e("p",null,p(T.value),1),e("button",{onClick:De,class:"btn-secondary"}," Try Again ")])):(O=oe.value)!=null&&O.installed?(n(),a("div",Ni,[C.value?(n(),a("div",Bi,[I.value.recommendation?(n(),a("div",Hi,[e("p",null,p(I.value.recommendation.message),1),I.value.recommendation.next_steps?(n(),a("div",qi,[d[26]||(d[26]=e("strong",null,"Next Steps:",-1)),e("ul",null,[(n(!0),a(ce,null,ke(I.value.recommendation.next_steps,(Y,de)=>(n(),a("li",{key:de},p(Y),1))),128))])])):M("",!0)])):M("",!0),e("div",zi,[e("button",{onClick:d[6]||(d[6]=(...Y)=>b.viewDocumentation&&b.viewDocumentation(...Y)),class:"btn-secondary"},[...d[27]||(d[27]=[e("i",{class:"mdi mdi-book-open-variant"},null,-1),R(" View Documentation ",-1)])])])])):M("",!0),q.value.length>0&&!U.value?(n(),a("div",Ji,[e("div",Wi,[e("button",{class:K(["filter-toggle-button",{active:S.value||ye.value}]),onClick:d[7]||(d[7]=Y=>S.value=!S.value),title:S.value?"Hide filters":"Show filters"},[d[28]||(d[28]=e("i",{class:"mdi mdi-filter-variant"},null,-1)),ye.value?(n(),a("span",Ki,p(_e.value),1)):M("",!0)],10,Gi),e("div",Xi,[d[29]||(d[29]=e("i",{class:"mdi mdi-magnify search-icon"},null,-1)),W(e("input",{"onUpdate:modelValue":d[8]||(d[8]=Y=>s.value.search=Y),type:"text",placeholder:"Search profiles...",class:"search-input"},null,512),[[Me,s.value.search]])])]),W(e("div",Yi,[e("div",Zi,[e("div",Qi,[e("label",null,[d[31]||(d[31]=e("i",{class:"mdi mdi-shape"},null,-1)),W(e("select",{"onUpdate:modelValue":d[9]||(d[9]=Y=>s.value.platform=Y)},[...d[30]||(d[30]=[je('<option value="" data-v-4ef33ace>All Platforms</option><option value="climate" data-v-4ef33ace>Climate</option><option value="media_player" data-v-4ef33ace>Media Player</option><option value="fan" data-v-4ef33ace>Fan</option><option value="light" data-v-4ef33ace>Light</option>',5)])],512),[[Ie,s.value.platform]])])]),ye.value?(n(),a("button",{key:0,onClick:xe,class:"btn-clear-filters"},[...d[32]||(d[32]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),R(" Clear ",-1)])])):M("",!0),e("div",er,p(ie.value.length)+" of "+p(q.value.length),1)])],512),[[Je,S.value]])])):M("",!0),P.value?(n(),a("div",tr,[...d[33]||(d[33]=[e("i",{class:"mdi mdi-loading mdi-spin"},null,-1),e("p",null,"Loading profiles...",-1)])])):q.value.length===0?(n(),a("div",or,[...d[34]||(d[34]=[e("i",{class:"mdi mdi-file-document-outline"},null,-1),e("h3",null,"No Profiles Yet",-1),e("p",null,"Create your first SmartIR profile to get started",-1)])])):M("",!0),J.value==="grid"&&!U.value?(n(),a("div",lr,[(n(!0),a(ce,null,ke(ie.value,Y=>(n(),Pe(Da,{key:`${Y.platform}-${Y.code}`,profile:Y,onEdit:de=>be(Y.platform,Y),onCommands:de=>be(Y.platform,Y,2),onDownload:de=>Se(Y.platform,Y),onDelete:de=>Ee(Y.platform,Y)},null,8,["profile","onEdit","onCommands","onDownload","onDelete"]))),128))])):J.value==="list"&&!U.value&&ie.value.length>0?(n(),Pe(Xa,{key:5,profiles:ie.value,onEdit:d[10]||(d[10]=Y=>be(Y.platform,Y)),onCommands:d[11]||(d[11]=Y=>be(Y.platform,Y,2)),onDownload:d[12]||(d[12]=Y=>Se(Y.platform,Y)),onDelete:d[13]||(d[13]=Y=>Ee(Y.platform,Y))},null,8,["profiles"])):M("",!0),q.value.length>0&&ie.value.length===0&&!U.value?(n(),a("div",nr,[...d[35]||(d[35]=[e("i",{class:"mdi mdi-filter-off"},null,-1),e("h3",null,"No profiles match your filters",-1),e("p",null,"Try adjusting your search or filter criteria",-1)])])):M("",!0)])):(n(),a("div",sr,[d[39]||(d[39]=e("div",{class:"status-badge warning"},[e("i",{class:"mdi mdi-information"}),e("span",null,"Not Installed")],-1)),e("div",ar,[d[37]||(d[37]=e("h4",null,"Why Install SmartIR?",-1)),e("ul",ir,[(n(!0),a(ce,null,ke(((ne=(B=I.value)==null?void 0:B.recommendation)==null?void 0:ne.benefits)||X,(Y,de)=>(n(),a("li",{key:de},[d[36]||(d[36]=e("i",{class:"mdi mdi-check"},null,-1)),e("span",null,p(Y),1)]))),128))])]),e("div",rr,[e("p",null,p(((le=(se=I.value)==null?void 0:se.recommendation)==null?void 0:le.message)||"Install SmartIR to unlock climate device support!"),1)]),e("div",{class:"card-actions"},[e("button",{onClick:Oe,class:"btn-primary"},[...d[38]||(d[38]=[e("i",{class:"mdi mdi-github"},null,-1),R(" Install SmartIR ",-1)])])])]))],512),[[Je,V.value]]),ge(Fe,{isOpen:h.value.show,title:h.value.title,message:h.value.message,confirmText:h.value.canDelete===!1?null:"Delete",cancelText:"Close",dangerMode:!0,confirmDisabled:h.value.canDelete===!1,onConfirm:Z,onCancel:d[14]||(d[14]=Y=>h.value.show=!1)},null,8,["isOpen","title","message","confirmText","confirmDisabled"]),ge(Di,{isOpen:f.value,onClose:d[15]||(d[15]=Y=>f.value=!1)},null,8,["isOpen"])])}}},ur=we(dr,[["__scopeId","data-v-4ef33ace"]]),cr={class:"climate-form"},mr={class:"learning-mode-section"},vr={class:"mode-toggle"},pr={class:"mode-content"},fr={class:"mode-stats"},gr={class:"stat-badge"},yr={class:"stat-badge time"},br={class:"mode-content"},hr={class:"mode-stats"},kr={class:"stat-badge"},wr={class:"stat-badge time warning"},$r={key:0,class:"command-breakdown"},Cr={class:"warning-text"},_r={class:"form-section"},Sr={key:0,class:"help-text"},Ir={key:1,class:"help-text"},Dr={class:"form-row"},Tr={class:"form-group"},xr={class:"form-group"},Rr={class:"form-group"},Mr={key:2,class:"representative-temp-section"},Ar={class:"form-group"},Or=["value"],Er={class:"form-section"},Lr={class:"checkbox-grid"},Vr={class:"checkbox-item"},Pr={class:"checkbox-item"},Ur={class:"checkbox-item"},Fr={class:"checkbox-item"},jr={class:"checkbox-item"},Nr={class:"checkbox-item"},Br={class:"form-section"},Hr={class:"checkbox-grid"},qr={class:"checkbox-item"},zr={class:"checkbox-item"},Jr={class:"checkbox-item"},Wr={class:"checkbox-item"},Gr={class:"form-section"},Kr={class:"checkbox-grid"},Xr={class:"checkbox-item"},Yr={class:"checkbox-item"},Zr={class:"checkbox-item"},Qr={class:"checkbox-item"},ed={class:"form-section"},td={class:"form-group"},od={class:"form-group"},ld={class:"form-group"},nd={key:0,class:"validation-summary"},sd={__name:"ClimateProfileForm",props:{modelValue:{type:Object,default:()=>({})}},emits:["update:modelValue"],setup(t,{emit:u}){const i=t,_=u,w=y("quick"),r=y({minTemp:16,maxTemp:30,precision:1,representativeTemp:24,modes:["off","auto","cool","heat"],fanModes:["auto","low","medium","high"],swingModes:[],tempSensor:"",humiditySensor:"",powerSensor:"",learningMode:"quick",...i.modelValue}),m=G(()=>{const S=[],s=r.value.minTemp||16,h=r.value.maxTemp||30,f=r.value.precision||1;for(let L=s;L<=h;L+=f)S.push(L);return S}),g=G(()=>r.value.modes.filter(S=>S!=="off").length),T=G(()=>r.value.fanModes.length||1),I=G(()=>r.value.swingModes.length||1),U=G(()=>{const S=r.value.minTemp||16,s=r.value.maxTemp||30,h=r.value.precision||1;return Math.floor((s-S)/h)+1}),C=G(()=>{const S=r.value.modes.includes("off")?1:0;return g.value*T.value*I.value+S}),o=G(()=>Math.ceil(C.value*30/60)),V=G(()=>{const S=r.value.modes.includes("off")?1:0;return g.value*U.value*T.value*I.value+S}),q=G(()=>Math.ceil(V.value*30/60)),P=G(()=>{const S=[];return(!r.value.minTemp||r.value.minTemp<10||r.value.minTemp>35)&&S.push("Minimum temperature must be between 10°C and 35°C"),(!r.value.maxTemp||r.value.maxTemp<10||r.value.maxTemp>35)&&S.push("Maximum temperature must be between 10°C and 35°C"),r.value.minTemp>=r.value.maxTemp&&S.push("Minimum temperature must be less than maximum temperature"),(!r.value.modes||r.value.modes.length===0)&&S.push("At least one HVAC mode must be selected"),S});return ae(w,S=>{r.value.learningMode=S}),ae(r,S=>{_("update:modelValue",S)},{deep:!0,immediate:!0}),(S,s)=>(n(),a("div",cr,[s[63]||(s[63]=e("h3",null,"Climate Device Configuration",-1)),e("div",mr,[e("div",vr,[e("label",{class:K(["mode-option",{active:w.value==="quick"}])},[W(e("input",{type:"radio",value:"quick","onUpdate:modelValue":s[0]||(s[0]=h=>w.value=h)},null,512),[[Ne,w.value]]),e("div",pr,[s[23]||(s[23]=e("div",{class:"mode-header"},[e("i",{class:"mdi mdi-flash"}),e("strong",null,"Quick Mode (Recommended)")],-1)),s[24]||(s[24]=e("p",null,"Learn one temperature per mode combination",-1)),e("div",fr,[e("span",gr,p(C.value)+" commands",1),e("span",yr,"~"+p(o.value)+" min",1)])])],2),e("label",{class:K(["mode-option",{active:w.value==="complete"}])},[W(e("input",{type:"radio",value:"complete","onUpdate:modelValue":s[1]||(s[1]=h=>w.value=h)},null,512),[[Ne,w.value]]),e("div",br,[s[25]||(s[25]=e("div",{class:"mode-header"},[e("i",{class:"mdi mdi-check-all"}),e("strong",null,"Complete Mode")],-1)),s[26]||(s[26]=e("p",null,"Learn all temperature combinations",-1)),e("div",hr,[e("span",kr,p(V.value)+" commands",1),e("span",wr,"~"+p(q.value)+" min",1)])])],2)]),w.value==="complete"?(n(),a("div",$r,[s[27]||(s[27]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[e("strong",null,"Complete mode will require learning "+p(V.value)+" commands",1),e("p",null,"This includes all combinations of modes ("+p(g.value)+"), temperatures ("+p(U.value)+"), fan speeds ("+p(T.value)+"), and swing modes ("+p(I.value)+").",1),e("p",Cr,"⏱️ Estimated time: "+p(q.value)+" minutes at ~30 seconds per command",1)])])):M("",!0)]),e("div",_r,[s[33]||(s[33]=e("h4",null,"Temperature Range",-1)),w.value==="quick"?(n(),a("p",Sr," Define the full temperature range your device supports. You'll select one temperature to learn below. ")):(n(),a("p",Ir," Define the temperature range. All temperatures in this range will be learned. ")),e("div",Dr,[e("div",Tr,[s[28]||(s[28]=e("label",null,"Minimum Temperature (°C) *",-1)),W(e("input",{"onUpdate:modelValue":s[2]||(s[2]=h=>r.value.minTemp=h),type:"number",min:"10",max:"35",placeholder:"16"},null,512),[[Me,r.value.minTemp,void 0,{number:!0}]])]),e("div",xr,[s[29]||(s[29]=e("label",null,"Maximum Temperature (°C) *",-1)),W(e("input",{"onUpdate:modelValue":s[3]||(s[3]=h=>r.value.maxTemp=h),type:"number",min:"10",max:"35",placeholder:"30"},null,512),[[Me,r.value.maxTemp,void 0,{number:!0}]])]),e("div",Rr,[s[31]||(s[31]=e("label",null,"Precision",-1)),W(e("select",{"onUpdate:modelValue":s[4]||(s[4]=h=>r.value.precision=h)},[...s[30]||(s[30]=[e("option",{value:1},"1°C (Whole degrees)",-1),e("option",{value:.5},"0.5°C (Half degrees)",-1)])],512),[[Ie,r.value.precision,void 0,{number:!0}]])])]),w.value==="quick"?(n(),a("div",Mr,[e("div",Ar,[s[32]||(s[32]=e("label",null,"Representative Temperature to Learn *",-1)),W(e("select",{"onUpdate:modelValue":s[5]||(s[5]=h=>r.value.representativeTemp=h)},[(n(!0),a(ce,null,ke(m.value,h=>(n(),a("option",{key:h,value:h},p(h)+"°C ",9,Or))),128))],512),[[Ie,r.value.representativeTemp,void 0,{number:!0}]]),e("small",null,"This temperature will be learned for all mode combinations. The device profile will still show the full range ("+p(r.value.minTemp)+"°C - "+p(r.value.maxTemp)+"°C).",1)])])):M("",!0)]),e("div",Er,[s[40]||(s[40]=e("h4",null,"Supported HVAC Modes *",-1)),s[41]||(s[41]=e("p",{class:"help-text"},"Select all modes your device supports",-1)),e("div",Lr,[e("label",Vr,[W(e("input",{type:"checkbox",value:"off","onUpdate:modelValue":s[6]||(s[6]=h=>r.value.modes=h)},null,512),[[ve,r.value.modes]]),s[34]||(s[34]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),R(" Off ")],-1))]),e("label",Pr,[W(e("input",{type:"checkbox",value:"auto","onUpdate:modelValue":s[7]||(s[7]=h=>r.value.modes=h)},null,512),[[ve,r.value.modes]]),s[35]||(s[35]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-autorenew"}),R(" Auto ")],-1))]),e("label",Ur,[W(e("input",{type:"checkbox",value:"cool","onUpdate:modelValue":s[8]||(s[8]=h=>r.value.modes=h)},null,512),[[ve,r.value.modes]]),s[36]||(s[36]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-snowflake"}),R(" Cool ")],-1))]),e("label",Fr,[W(e("input",{type:"checkbox",value:"heat","onUpdate:modelValue":s[9]||(s[9]=h=>r.value.modes=h)},null,512),[[ve,r.value.modes]]),s[37]||(s[37]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fire"}),R(" Heat ")],-1))]),e("label",jr,[W(e("input",{type:"checkbox",value:"dry","onUpdate:modelValue":s[10]||(s[10]=h=>r.value.modes=h)},null,512),[[ve,r.value.modes]]),s[38]||(s[38]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-water-percent"}),R(" Dry ")],-1))]),e("label",Nr,[W(e("input",{type:"checkbox",value:"fan_only","onUpdate:modelValue":s[11]||(s[11]=h=>r.value.modes=h)},null,512),[[ve,r.value.modes]]),s[39]||(s[39]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan"}),R(" Fan Only ")],-1))])])]),e("div",Br,[s[46]||(s[46]=e("h4",null,"Fan Modes",-1)),s[47]||(s[47]=e("p",{class:"help-text"},"Select all fan speeds your device supports",-1)),e("div",Hr,[e("label",qr,[W(e("input",{type:"checkbox",value:"auto","onUpdate:modelValue":s[12]||(s[12]=h=>r.value.fanModes=h)},null,512),[[ve,r.value.fanModes]]),s[42]||(s[42]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-autorenew"}),R(" Auto ")],-1))]),e("label",zr,[W(e("input",{type:"checkbox",value:"low","onUpdate:modelValue":s[13]||(s[13]=h=>r.value.fanModes=h)},null,512),[[ve,r.value.fanModes]]),s[43]||(s[43]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-1"}),R(" Low ")],-1))]),e("label",Jr,[W(e("input",{type:"checkbox",value:"medium","onUpdate:modelValue":s[14]||(s[14]=h=>r.value.fanModes=h)},null,512),[[ve,r.value.fanModes]]),s[44]||(s[44]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-2"}),R(" Medium ")],-1))]),e("label",Wr,[W(e("input",{type:"checkbox",value:"high","onUpdate:modelValue":s[15]||(s[15]=h=>r.value.fanModes=h)},null,512),[[ve,r.value.fanModes]]),s[45]||(s[45]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-3"}),R(" High ")],-1))])])]),e("div",Gr,[s[52]||(s[52]=e("h4",null,"Swing Modes (Optional)",-1)),s[53]||(s[53]=e("p",{class:"help-text"},"Select if your device has swing/oscillation",-1)),e("div",Kr,[e("label",Xr,[W(e("input",{type:"checkbox",value:"off","onUpdate:modelValue":s[16]||(s[16]=h=>r.value.swingModes=h)},null,512),[[ve,r.value.swingModes]]),s[48]||(s[48]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-horizontal"}),R(" Off ")],-1))]),e("label",Yr,[W(e("input",{type:"checkbox",value:"vertical","onUpdate:modelValue":s[17]||(s[17]=h=>r.value.swingModes=h)},null,512),[[ve,r.value.swingModes]]),s[49]||(s[49]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-vertical"}),R(" Vertical ")],-1))]),e("label",Zr,[W(e("input",{type:"checkbox",value:"horizontal","onUpdate:modelValue":s[18]||(s[18]=h=>r.value.swingModes=h)},null,512),[[ve,r.value.swingModes]]),s[50]||(s[50]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-horizontal"}),R(" Horizontal ")],-1))]),e("label",Qr,[W(e("input",{type:"checkbox",value:"both","onUpdate:modelValue":s[19]||(s[19]=h=>r.value.swingModes=h)},null,512),[[ve,r.value.swingModes]]),s[51]||(s[51]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-arrow-all"}),R(" Both ")],-1))])])]),e("div",ed,[s[60]||(s[60]=e("h4",null,"Sensors (Optional)",-1)),s[61]||(s[61]=e("p",{class:"help-text"},"Link external sensors for better climate control",-1)),e("div",td,[s[54]||(s[54]=e("label",null,"Temperature Sensor",-1)),W(e("input",{"onUpdate:modelValue":s[20]||(s[20]=h=>r.value.tempSensor=h),type:"text",placeholder:"sensor.living_room_temperature"},null,512),[[Me,r.value.tempSensor]]),s[55]||(s[55]=e("small",null,"Entity ID of temperature sensor",-1))]),e("div",od,[s[56]||(s[56]=e("label",null,"Humidity Sensor",-1)),W(e("input",{"onUpdate:modelValue":s[21]||(s[21]=h=>r.value.humiditySensor=h),type:"text",placeholder:"sensor.living_room_humidity"},null,512),[[Me,r.value.humiditySensor]]),s[57]||(s[57]=e("small",null,"Entity ID of humidity sensor",-1))]),e("div",ld,[s[58]||(s[58]=e("label",null,"Power Sensor",-1)),W(e("input",{"onUpdate:modelValue":s[22]||(s[22]=h=>r.value.powerSensor=h),type:"text",placeholder:"binary_sensor.ac_power"},null,512),[[Me,r.value.powerSensor]]),s[59]||(s[59]=e("small",null,"Entity ID of power sensor (to detect on/off state)",-1))])]),P.value.length>0?(n(),a("div",nd,[s[62]||(s[62]=e("h4",null,[e("i",{class:"mdi mdi-alert-circle"}),R(" Please fix the following: ")],-1)),e("ul",null,[(n(!0),a(ce,null,ke(P.value,(h,f)=>(n(),a("li",{key:f},p(h),1))),128))])])):M("",!0)]))}},ad=we(sd,[["__scopeId","data-v-c44d7198"]]),id={class:"command-wizard"},rd={class:"device-selection-section"},dd={class:"input-wrapper"},ud=["value"],cd={key:0,class:"validation-tooltip"},md={class:"form-group"},vd=["disabled"],pd={key:0},fd={key:1},gd={key:0,class:"edit-mode-banner"},yd={class:"wizard-info"},bd={key:0},hd={key:1},kd={class:"progress-info"},wd={class:"progress-bar"},$d={class:"progress-text"},Cd={class:"commands-grid"},_d={class:"command-header"},Sd={class:"command-icon"},Id={class:"command-info"},Dd={key:0,class:"learning-indicator"},Td={key:0,class:"ir-learning-steps"},xd={key:1,class:"rf-learning-steps"},Rd={class:"command-actions"},Md=["onClick","disabled"],Ad={key:1,class:"learned-status"},Od=["onClick","disabled"],Ed=["onClick"],Ld={class:"quick-actions"},Vd=["disabled"],Pd=["disabled"],Ud={__name:"CommandLearningWizard",props:{modelValue:{type:Object,default:()=>({})},platform:{type:String,required:!0},config:{type:Object,required:!0},broadlinkDevice:{type:String,default:""},manufacturer:{type:String,required:!0},model:{type:String,required:!0},commandType:{type:String,default:"ir"}},emits:["update:modelValue","update:broadlinkDevice","update:commandType"],setup(t,{emit:u}){const i=He(),_=t,w=u,r=y({..._.modelValue}),m=y(null),g=y(null),T=y([]),I=y(_.broadlinkDevice),U=y(_.commandType),C=y(!1),o=y([]),V=y(!1),q=y(!1),P=y({show:!1,commandKey:null,commandLabel:""}),S=y(!1),s=G(()=>{const x=[];if(_.platform==="climate"){const v=_.config.modes||[],F=_.config.fanModes||[],pe=_.config.minTemp||16,Oe=_.config.maxTemp||30;v.forEach(fe=>{if(fe==="off")x.push({key:"off",label:"Power Off",description:"Turn device off",icon:"mdi mdi-power",mode:"off"});else for(let be=pe;be<=Oe;be++)F.forEach(Se=>{const Ee=`${fe}_${be}_${Se}`;x.push({key:Ee,label:`${fe.toUpperCase()} ${be}°C ${Se}`,description:`Mode: ${fe}, Temp: ${be}°C, Fan: ${Se}`,icon:J(fe),mode:fe,temp:be,fanMode:Se})})})}else if(_.platform==="media_player"){const v=_.config.features||[];v.includes("turn_on")&&(x.push({key:"turn_on",label:"Power On",description:"Turn on the device",icon:"mdi mdi-power"}),x.push({key:"turn_off",label:"Power Off",description:"Turn off the device",icon:"mdi mdi-power-off"})),v.includes("volume")&&(x.push({key:"volume_up",label:"Volume Up",description:"Increase volume",icon:"mdi mdi-volume-plus"}),x.push({key:"volume_down",label:"Volume Down",description:"Decrease volume",icon:"mdi mdi-volume-minus"})),v.includes("mute")&&x.push({key:"mute",label:"Mute",description:"Toggle mute",icon:"mdi mdi-volume-mute"}),v.includes("source")&&(x.push({key:"source_hdmi1",label:"Source: HDMI 1",description:"Switch to HDMI 1",icon:"mdi mdi-import"}),x.push({key:"source_hdmi2",label:"Source: HDMI 2",description:"Switch to HDMI 2",icon:"mdi mdi-import"}),x.push({key:"source_hdmi3",label:"Source: HDMI 3",description:"Switch to HDMI 3",icon:"mdi mdi-import"})),v.includes("channel")&&(x.push({key:"channel_up",label:"Channel Up",description:"Next channel",icon:"mdi mdi-chevron-up"}),x.push({key:"channel_down",label:"Channel Down",description:"Previous channel",icon:"mdi mdi-chevron-down"}))}else if(_.platform==="fan"){const v=_.config.speedLevels||3,F=_.config.features||[];x.push({key:"turn_on",label:"Power On",description:"Turn on the fan",icon:"mdi mdi-power"}),x.push({key:"turn_off",label:"Power Off",description:"Turn off the fan",icon:"mdi mdi-power-off"});for(let pe=1;pe<=v;pe++){const Oe=pe===1?"Low":pe===v?"High":pe===2&&v===3?"Medium":`Speed ${pe}`;x.push({key:`speed_${pe}`,label:`${Oe}`,description:`Set fan to speed level ${pe}`,icon:"mdi mdi-fan"})}F.includes("oscillate")&&(x.push({key:"oscillate_on",label:"Oscillate On",description:"Enable oscillation",icon:"mdi mdi-sync"}),x.push({key:"oscillate_off",label:"Oscillate Off",description:"Disable oscillation",icon:"mdi mdi-sync-off"})),F.includes("direction")&&(x.push({key:"direction_forward",label:"Direction: Forward",description:"Set direction to forward",icon:"mdi mdi-rotate-right"}),x.push({key:"direction_reverse",label:"Direction: Reverse",description:"Set direction to reverse",icon:"mdi mdi-rotate-left"}))}else if(_.platform==="light"){const v=_.config.features||[];v.includes("turn_on")&&(x.push({key:"turn_on",label:"Power On",description:"Turn on the light",icon:"mdi mdi-lightbulb-on"}),x.push({key:"turn_off",label:"Power Off",description:"Turn off the light",icon:"mdi mdi-lightbulb-off"})),v.includes("brightness")&&(x.push({key:"brightness_up",label:"Brightness Up",description:"Increase brightness",icon:"mdi mdi-brightness-7"}),x.push({key:"brightness_down",label:"Brightness Down",description:"Decrease brightness",icon:"mdi mdi-brightness-5"})),v.includes("color_temp")&&(x.push({key:"color_temp_warm",label:"Warm White",description:"Set to warm white",icon:"mdi mdi-weather-sunset"}),x.push({key:"color_temp_cool",label:"Cool White",description:"Set to cool white",icon:"mdi mdi-weather-sunny"})),v.includes("rgb")&&(x.push({key:"color_red",label:"Color: Red",description:"Set color to red",icon:"mdi mdi-palette"}),x.push({key:"color_green",label:"Color: Green",description:"Set color to green",icon:"mdi mdi-palette"}),x.push({key:"color_blue",label:"Color: Blue",description:"Set color to blue",icon:"mdi mdi-palette"}))}return x}),h=G(()=>s.value.length),f=G(()=>Object.keys(r.value).length),L=G(()=>h.value===0?0:Math.round(f.value/h.value*100));function J(x){return{off:"mdi mdi-power",auto:"mdi mdi-autorenew",cool:"mdi mdi-snowflake",heat:"mdi mdi-fire",dry:"mdi mdi-water-percent",fan_only:"mdi mdi-fan"}[x]||"mdi mdi-remote"}async function X(x){if(!m.value){if(!I.value){q.value=!0,window.scrollTo({top:0,behavior:"smooth"});return}q.value=!1,m.value=x.key;try{const v=_.manufacturer.toLowerCase().replace(/[^a-z0-9]+/g,"_"),F=_.model.toLowerCase().replace(/[^a-z0-9]+/g,"_"),pe=`${v}_${F}`,fe=(await Q.post("/api/commands/learn",{entity_id:I.value,device:pe,command:x.key,command_type:U.value})).data;if(fe.success&&fe.code)r.value[x.key]=fe.code,w("update:modelValue",r.value),V.value=!0,fe.code==="pending"&&console.log(`⏳ Command '${x.key}' learned, code will be fetched from storage when saving`),C.value&&o.value.length>0&&setTimeout(()=>{const be=o.value.shift();be?X(be):C.value=!1},1e3);else throw new Error(fe.error||"Failed to learn command")}catch(v){console.error("Error learning command:",v),i.error(`Error learning command: ${v.message}`),C.value=!1,o.value=[]}finally{C.value||(m.value=null)}}}async function H(x){var v;if(!I.value){q.value=!0,window.scrollTo({top:0,behavior:"smooth"});return}if(!r.value[x]){(v=i.value)==null||v.error("Command not learned yet");return}g.value=x;try{const F=r.value[x];await Q.post("/api/commands/send-raw",{entity_id:I.value,command:F,command_type:U.value}),i.success("Command sent successfully")}catch(F){console.error("Error testing command:",F),i.error(`Error testing command: ${F.message}`)}finally{g.value=null}}function oe(x){const v=s.value.find(F=>F.key===x);P.value={show:!0,commandKey:x,commandLabel:v?v.label:x}}function E(){const x=P.value.commandKey;delete r.value[x],w("update:modelValue",r.value),P.value.show=!1}function j(){const x=s.value.filter(F=>!r.value[F.key]);if(x.length===0)return;C.value=!0,o.value=[...x];const v=o.value.shift();v&&X(v)}function te(){S.value=!0}function ie(){r.value={},w("update:modelValue",r.value),S.value=!1}ae(()=>_.modelValue,x=>{r.value={...x}},{deep:!0}),Ae(async()=>{await ye()});async function ye(){try{console.log("SmartIR device - commands will be loaded from SmartIR JSON file, not Broadlink storage")}catch(x){console.error("Error in loadExistingCommands:",x)}}function _e(){w("update:broadlinkDevice",I.value)}function xe(){w("update:commandType",U.value)}async function De(){try{console.log("🔍 Loading Broadlink devices from /api/remote/devices");const x=await Q.get("/api/remote/devices");console.log("📦 Response data:",x.data);const v=x.data.devices||[];console.log(`✅ Found ${v.length} devices:`,v),T.value=v}catch(x){console.error("❌ Error loading remote devices:",x),T.value=[]}}return ae(()=>_.broadlinkDevice,x=>{I.value=x}),ae(I,x=>{x&&(q.value=!1)}),ae(()=>_.commandType,x=>{U.value=x}),Ae(async()=>{await De(),await ye()}),(x,v)=>(n(),a("div",id,[v[22]||(v[22]=e("h3",null,"Learn IR Commands",-1)),e("div",rd,[e("div",{class:K(["form-group",{"has-error":q.value}])},[v[6]||(v[6]=e("label",null,"Broadlink Device *",-1)),e("div",dd,[W(e("select",{"onUpdate:modelValue":v[0]||(v[0]=F=>I.value=F),onChange:_e},[v[4]||(v[4]=e("option",{value:""},"Select Broadlink device...",-1)),(n(!0),a(ce,null,ke(T.value,F=>(n(),a("option",{key:F.entity_id,value:F.entity_id},p(F.name||F.entity_id),9,ud))),128))],544),[[Ie,I.value]]),q.value?(n(),a("div",cd,[...v[5]||(v[5]=[e("i",{class:"mdi mdi-alert"},null,-1),R(" Device is required ",-1)])])):M("",!0)]),e("small",null,"This device will be used to learn commands ("+p(T.value.length)+" devices found)",1)],2),e("div",md,[v[8]||(v[8]=e("label",null,"Command Type *",-1)),W(e("select",{"onUpdate:modelValue":v[1]||(v[1]=F=>U.value=F),onChange:xe,disabled:f.value>0},[...v[7]||(v[7]=[e("option",{value:"ir"},"📡 Infrared (IR) - Most common for AC, TV, etc.",-1),e("option",{value:"rf"},"📻 Radio Frequency (RF) - For RF remotes",-1)])],40,vd),[[Ie,U.value]]),f.value>0?(n(),a("small",pd,"Command type cannot be changed after learning commands")):(n(),a("small",fd,"Select the type of commands your device uses"))])]),f.value>0&&!V.value?(n(),a("div",gd,[v[10]||(v[10]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[v[9]||(v[9]=e("strong",null,"Editing Existing Profile",-1)),e("p",null,p(f.value)+" command"+p(f.value!==1?"s":"")+' already learned. You can re-learn any command by clicking the delete icon and then "Learn Command".',1)])])):M("",!0),e("div",yd,[v[14]||(v[14]=e("i",{class:"mdi mdi-information"},null,-1)),e("div",null,[v[13]||(v[13]=e("p",null,[e("strong",null,"How it works:")],-1)),t.commandType==="ir"?(n(),a("ol",bd,[...v[11]||(v[11]=[e("li",null,'Click "Learn Command" for each combination',-1),e("li",null,[e("strong",null,"Point your IR remote directly at the Broadlink device")],-1),e("li",null,"Press the button on your remote",-1),e("li",null,"Wait for confirmation (up to 30 seconds)",-1)])])):(n(),a("ol",hd,[...v[12]||(v[12]=[e("li",null,'Click "Learn Command" for each combination',-1),e("li",null,[e("strong",null,"Step 1:"),R(" Hold button on remote - Broadlink scans for RF frequency")],-1),e("li",null,[e("strong",null,"Step 2:"),R(" Watch for Home Assistant notification, then press and release button")],-1),e("li",null,"Keep remote within 5cm of Broadlink (RF doesn't need line-of-sight)",-1),e("li",null,"Wait for confirmation (may take up to 30 seconds)",-1)])]))])]),e("div",kd,[e("div",wd,[e("div",{class:"progress-fill",style:ct({width:L.value+"%"})},null,4)]),e("span",$d,p(f.value)+" / "+p(h.value)+" commands learned ("+p(L.value)+"%) ",1)]),e("div",Cd,[(n(!0),a(ce,null,ke(s.value,F=>(n(),a("div",{key:F.key,class:K(["command-card",{learned:r.value[F.key],learning:m.value===F.key}])},[e("div",_d,[e("div",Sd,[e("i",{class:K(F.icon)},null,2)]),e("div",Id,[e("h4",null,p(F.label),1),e("p",null,p(F.description),1)])]),m.value===F.key?(n(),a("div",Dd,[t.commandType==="ir"?(n(),a("div",Td,[...v[15]||(v[15]=[e("p",null,[e("strong",null,"Point your remote directly at the Broadlink device and press the button.")],-1),e("small",null,"Listening for up to 30 seconds...",-1)])])):(n(),a("div",xd,[...v[16]||(v[16]=[e("p",{class:"rf-title"},[e("strong",null,"Learning request sent to device.")],-1),e("p",{class:"rf-subtitle"},[R("RF learning is a "),e("strong",null,"two-step process"),R(":")],-1),e("ol",null,[e("li",null,[e("strong",null,"Step 1 - Frequency Sweep (~10-15 seconds):"),R(" Press and hold the button on your remote until the notification updates. ")]),e("li",null,[e("strong",null,"Step 2 - Learn Signal:"),R(" Press and release the button once. ")])],-1),e("p",{class:"rf-note"},"Follow the Home Assistant notifications (🔔) for real-time instructions.",-1)])]))])):M("",!0),e("div",Rd,[r.value[F.key]?(n(),a("div",Ad,[v[18]||(v[18]=e("i",{class:"mdi mdi-check-circle"},null,-1)),v[19]||(v[19]=e("span",null,"Learned",-1)),e("span",{class:K(["command-type-badge",U.value])},p(U.value.toUpperCase()),3),e("button",{onClick:pe=>H(F.key),class:"icon-btn",title:"Test command",disabled:g.value===F.key,style:{"margin-left":"auto"}},[e("i",{class:K(["mdi mdi-play",{"mdi-spin":g.value===F.key}])},null,2)],8,Od),e("button",{onClick:pe=>oe(F.key),class:"icon-btn danger",title:"Delete and re-learn"},[...v[17]||(v[17]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,Ed)])):(n(),a("button",{key:0,onClick:pe=>X(F),class:K(["btn-learn",{learning:m.value===F.key}]),disabled:m.value!==null},[e("i",{class:K(["mdi mdi-radio-tower",{"mdi-spin":m.value===F.key}])},null,2),R(" "+p(m.value===F.key?"Listening...":"Learn Command"),1)],10,Md))])],2))),128))]),e("div",Ld,[e("button",{onClick:j,class:"btn-secondary",disabled:m.value!==null||f.value===h.value},[...v[20]||(v[20]=[e("i",{class:"mdi mdi-play-circle"},null,-1),R(" Learn All Remaining ",-1)])],8,Vd),e("button",{onClick:te,class:"btn-text",disabled:f.value===0},[...v[21]||(v[21]=[e("i",{class:"mdi mdi-delete-sweep"},null,-1),R(" Clear All ",-1)])],8,Pd)]),ge(Fe,{isOpen:P.value.show,title:"Delete Learned Command?",message:`Are you sure you want to delete the '${P.value.commandLabel}' command?

You will need to re-learn this command.`,confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,onConfirm:E,onCancel:v[2]||(v[2]=F=>P.value.show=!1)},null,8,["isOpen","message"]),ge(Fe,{isOpen:S.value,title:"Delete All Learned Commands?",message:"Are you sure you want to delete all learned commands? This cannot be undone.\\n\\nYou will need to re-learn all commands.",confirmText:"Delete All",cancelText:"Cancel",dangerMode:!0,onConfirm:ie,onCancel:v[3]||(v[3]=F=>S.value=!1)},null,8,["isOpen"])]))}},Fd=we(Ud,[["__scopeId","data-v-9a9e9e51"]]),jd={class:"profile-preview"},Nd={class:"preview-summary"},Bd={class:"summary-card"},Hd={class:"stats-grid"},qd={class:"stat-item"},zd={class:"stat-value"},Jd={class:"stat-item"},Wd={class:"stat-value"},Gd={class:"stat-item"},Kd={class:"stat-value"},Xd={class:"preview-tabs"},Yd={class:"preview-content"},Zd={key:0,class:"tab-content"},Qd={class:"code-header"},eu={class:"code-block"},tu={key:1,class:"tab-content"},ou={class:"code-header"},lu={class:"code-block"},nu={key:2,class:"tab-content"},su={class:"instructions"},au={class:"step-item"},iu={class:"step-content"},ru={class:"code-path"},du={__name:"ProfilePreview",props:{profile:{type:Object,required:!0},jsonData:{type:Object,required:!0},yamlConfig:{type:String,required:!0}},setup(t){const u=He(),i=t,_=y("json"),w=y(!1),r=y(!1),m=G(()=>Object.keys(i.profile.commands||{}).length),g=G(()=>JSON.stringify(i.jsonData,null,2));async function T(){try{await navigator.clipboard.writeText(g.value),w.value=!0,setTimeout(()=>{w.value=!1},2e3)}catch(U){console.error("Failed to copy JSON:",U),u.error("Failed to copy to clipboard")}}async function I(){try{await navigator.clipboard.writeText(i.yamlConfig),r.value=!0,setTimeout(()=>{r.value=!1},2e3)}catch(U){console.error("Failed to copy YAML:",U),u.error("Failed to copy to clipboard")}}return(U,C)=>{var o;return n(),a("div",jd,[C[22]||(C[22]=e("h3",null,"Preview & Save",-1)),e("div",Nd,[e("div",Bd,[C[4]||(C[4]=e("i",{class:"mdi mdi-check-circle"},null,-1)),e("div",null,[C[3]||(C[3]=e("h4",null,"Profile Ready!",-1)),e("p",null,p(t.profile.manufacturer)+" "+p(t.profile.model),1)])]),e("div",Hd,[e("div",qd,[e("span",zd,p(m.value),1),C[5]||(C[5]=e("span",{class:"stat-label"},"Commands Learned",-1))]),e("div",Jd,[e("span",Wd,p(t.profile.platform),1),C[6]||(C[6]=e("span",{class:"stat-label"},"Platform",-1))]),e("div",Gd,[e("span",Kd,p(((o=t.profile.config.modes)==null?void 0:o.length)||0),1),C[7]||(C[7]=e("span",{class:"stat-label"},"HVAC Modes",-1))])])]),e("div",Xd,[e("button",{onClick:C[0]||(C[0]=V=>_.value="json"),class:K(["tab-button",{active:_.value==="json"}])},[...C[8]||(C[8]=[e("i",{class:"mdi mdi-code-json"},null,-1),R(" SmartIR JSON ",-1)])],2),e("button",{onClick:C[1]||(C[1]=V=>_.value="yaml"),class:K(["tab-button",{active:_.value==="yaml"}])},[...C[9]||(C[9]=[e("i",{class:"mdi mdi-file-code"},null,-1),R(" YAML Config ",-1)])],2),e("button",{onClick:C[2]||(C[2]=V=>_.value="instructions"),class:K(["tab-button",{active:_.value==="instructions"}])},[...C[10]||(C[10]=[e("i",{class:"mdi mdi-information"},null,-1),R(" Instructions ",-1)])],2)]),e("div",Yd,[_.value==="json"?(n(),a("div",Zd,[e("div",Qd,[C[12]||(C[12]=e("h4",null,"SmartIR Device Code JSON",-1)),e("button",{onClick:T,class:"btn-copy"},[C[11]||(C[11]=e("i",{class:"mdi mdi-content-copy"},null,-1)),R(" "+p(w.value?"Copied!":"Copy"),1)])]),e("pre",eu,[e("code",null,p(g.value),1)]),C[13]||(C[13]=e("p",{class:"code-note"},[e("i",{class:"mdi mdi-information"}),R(" Save this as "),e("code",null,"10000.json"),R(" in your SmartIR codes directory ")],-1))])):M("",!0),_.value==="yaml"?(n(),a("div",tu,[e("div",ou,[C[15]||(C[15]=e("h4",null,"Home Assistant Configuration",-1)),e("button",{onClick:I,class:"btn-copy"},[C[14]||(C[14]=e("i",{class:"mdi mdi-content-copy"},null,-1)),R(" "+p(r.value?"Copied!":"Copy"),1)])]),e("pre",lu,[e("code",null,p(t.yamlConfig),1)]),C[16]||(C[16]=e("p",{class:"code-note"},[e("i",{class:"mdi mdi-information"}),R(" Add this to your "),e("code",null,"configuration.yaml"),R(" file ")],-1))])):M("",!0),_.value==="instructions"?(n(),a("div",nu,[e("div",su,[C[20]||(C[20]=e("h4",null,"Installation Steps",-1)),e("div",au,[C[19]||(C[19]=e("div",{class:"step-number"},"1",-1)),e("div",iu,[C[17]||(C[17]=e("h5",null,"Get Next Code Number",-1)),C[18]||(C[18]=e("p",null,"Custom device codes start at 10000. Check your SmartIR codes directory to find the next available number.",-1)),e("div",ru,[e("code",null,"/config/custom_components/smartir/codes/"+p(t.profile.platform)+"/",1)])])]),C[21]||(C[21]=je('<div class="step-item" data-v-e7b997c8><div class="step-number" data-v-e7b997c8>2</div><div class="step-content" data-v-e7b997c8><h5 data-v-e7b997c8>Save JSON File</h5><p data-v-e7b997c8>Copy the JSON from the &quot;SmartIR JSON&quot; tab and save it as <code data-v-e7b997c8>10000.json</code> (or your next available number) in the codes directory.</p></div></div><div class="step-item" data-v-e7b997c8><div class="step-number" data-v-e7b997c8>3</div><div class="step-content" data-v-e7b997c8><h5 data-v-e7b997c8>Update Configuration</h5><p data-v-e7b997c8>Copy the YAML from the &quot;YAML Config&quot; tab and add it to your <code data-v-e7b997c8>configuration.yaml</code> file. Update the <code data-v-e7b997c8>device_code</code> to match your JSON filename.</p></div></div><div class="step-item" data-v-e7b997c8><div class="step-number" data-v-e7b997c8>4</div><div class="step-content" data-v-e7b997c8><h5 data-v-e7b997c8>Restart Home Assistant</h5><p data-v-e7b997c8>Restart Home Assistant to load the new configuration. Your climate entity will appear in the UI.</p></div></div><div class="step-item" data-v-e7b997c8><div class="step-number" data-v-e7b997c8>5</div><div class="step-content" data-v-e7b997c8><h5 data-v-e7b997c8>Test Your Device</h5><p data-v-e7b997c8>Go to your climate entity and test different modes, temperatures, and fan speeds to ensure everything works correctly.</p></div></div><div class="tips-section" data-v-e7b997c8><h4 data-v-e7b997c8><i class="mdi mdi-lightbulb" data-v-e7b997c8></i> Tips </h4><ul data-v-e7b997c8><li data-v-e7b997c8>Keep a backup of your JSON file in case you need to modify it</li><li data-v-e7b997c8>Test all commands to ensure they work as expected</li><li data-v-e7b997c8>You can share your profile with the SmartIR community on GitHub</li><li data-v-e7b997c8>If a command doesn&#39;t work, you can re-learn it and update the JSON</li></ul></div>',5))])])):M("",!0)])])}}},uu=we(du,[["__scopeId","data-v-e7b997c8"]]),cu={class:"wizard-body"},mu={key:0,class:"warning-section"},vu={class:"warning-box"},pu={class:"instructions"},fu={class:"code-block"},gu={class:"steps"},yu={key:0},bu={class:"help-section"},hu={key:0,class:"help-content"},ku={class:"help-step"},wu={key:0,class:"help-step"},$u={class:"help-step"},Cu={class:"help-step"},_u={class:"checklist"},Su={class:"checkbox-label"},Iu={key:0,class:"checkbox-label"},Du={class:"wizard-footer"},Tu=["disabled"],xu={__name:"SmartIRSetupWizard",props:{show:{type:Boolean,default:!1},platform:{type:String,required:!0},warnings:{type:Array,default:()=>[]},configPath:{type:String,default:"/config"}},emits:["close","complete"],setup(t,{emit:u}){const i=t,_=u,w=Te("toast"),r=y(!1),m=y(!1),g=y(!1),T=G(()=>i.warnings.length>0?r.value&&m.value:r.value);function I(){const C=`${i.platform}: !include smartir/${i.platform}.yaml`;navigator.clipboard.writeText(C).then(()=>{var o;(o=w.value)==null||o.success("Include line copied to clipboard!","✅ Copied")}).catch(o=>{var V;console.error("Failed to copy:",o),(V=w.value)==null||V.error("Failed to copy to clipboard","❌ Copy Failed")})}function U(){_("complete")}return(C,o)=>t.show?(n(),a("div",{key:0,class:"modal-overlay",onClick:o[5]||(o[5]=ue(()=>{},["stop"]))},[e("div",{class:"setup-wizard",onClick:o[4]||(o[4]=ue(()=>{},["stop"]))},[o[31]||(o[31]=e("div",{class:"wizard-header"},[e("h2",null,[e("i",{class:"mdi mdi-cog"}),R(" SmartIR Configuration Setup ")])],-1)),e("div",cu,[t.warnings.length>0?(n(),a("div",mu,[e("div",vu,[o[11]||(o[11]=e("i",{class:"mdi mdi-alert"},null,-1)),e("div",null,[o[9]||(o[9]=e("h3",null,"⚠️ Configuration Migration Needed",-1)),o[10]||(o[10]=e("p",null,"We detected existing platform entries in your configuration.yaml:",-1)),e("ul",null,[(n(!0),a(ce,null,ke(t.warnings,V=>(n(),a("li",{key:V.platform},[e("strong",null,p(V.platform)+":",1),R(" "+p(V.message),1)]))),128))]),e("p",null,[o[6]||(o[6]=e("strong",null,"Action Required:",-1)),o[7]||(o[7]=R(" Move these entries to ",-1)),e("code",null,"smartir/"+p(t.platform)+".yaml",1),o[8]||(o[8]=R(" before continuing.",-1))])])])])):M("",!0),e("div",pu,[o[27]||(o[27]=e("h3",null,"📝 One-Time Setup",-1)),o[28]||(o[28]=e("p",null,[R("To enable SmartIR device management, add this line to your "),e("code",null,"configuration.yaml"),R(":")],-1)),e("div",fu,[e("code",null,p(t.platform)+": !include smartir/"+p(t.platform)+".yaml",1),e("button",{onClick:I,class:"copy-btn",title:"Copy to clipboard"},[...o[12]||(o[12]=[e("i",{class:"mdi mdi-content-copy"},null,-1)])])]),e("div",gu,[o[19]||(o[19]=e("h4",null,"Steps:",-1)),e("ol",null,[t.warnings.length>0?(n(),a("li",yu,[o[13]||(o[13]=e("strong",null,"Move existing entries:",-1)),o[14]||(o[14]=R(" Copy any existing ",-1)),e("code",null,p(t.platform)+":",1),o[15]||(o[15]=R(" entries from configuration.yaml to ",-1)),e("code",null,"smartir/"+p(t.platform)+".yaml",1)])):M("",!0),o[16]||(o[16]=e("li",null,[e("strong",null,"Add include line:"),R(" Add the line above to your configuration.yaml ")],-1)),o[17]||(o[17]=e("li",null,[e("strong",null,"Save changes:"),R(" Save configuration.yaml ")],-1)),o[18]||(o[18]=e("li",null,[e("strong",null,"Continue here:"),R(` Click "I've Completed Setup" below `)],-1))])]),e("div",bu,[e("button",{onClick:o[0]||(o[0]=V=>g.value=!g.value),class:"help-toggle"},[e("i",{class:K(["mdi",g.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2),R(" "+p(g.value?"Hide":"Show")+" Detailed Instructions ",1)]),g.value?(n(),a("div",hu,[o[26]||(o[26]=e("h4",null,"Detailed Setup Guide:",-1)),e("div",ku,[o[21]||(o[21]=e("h5",null,"1. Open configuration.yaml",-1)),e("p",null,[o[20]||(o[20]=R("Location: ",-1)),e("code",null,p(t.configPath)+"/configuration.yaml",1)])]),t.warnings.length>0?(n(),a("div",wu,[o[22]||(o[22]=e("h5",null,"2. Migrate Existing Entries (If Any)",-1)),e("p",null,"If you have existing "+p(t.platform)+" entries, cut them from configuration.yaml and paste into:",1),e("p",null,[e("code",null,p(t.configPath)+"/smartir/"+p(t.platform)+".yaml",1)]),o[23]||(o[23]=e("p",{class:"note"},"Broadlink Manager will create this file automatically.",-1))])):M("",!0),e("div",$u,[e("h5",null,p(t.warnings.length>0?"3":"2")+". Add Include Line",1),o[24]||(o[24]=e("p",null,"Add this to configuration.yaml:",-1)),e("pre",null,p(t.platform)+": !include smartir/"+p(t.platform)+".yaml",1)]),e("div",Cu,[e("h5",null,p(t.warnings.length>0?"4":"3")+". Restart Home Assistant",1),o[25]||(o[25]=e("p",null,"After saving, you'll need to restart HA for changes to take effect.",-1))])])):M("",!0)])]),e("div",_u,[e("label",Su,[W(e("input",{type:"checkbox","onUpdate:modelValue":o[1]||(o[1]=V=>r.value=V)},null,512),[[ve,r.value]]),o[29]||(o[29]=e("span",null,"I've added the include line to configuration.yaml",-1))]),t.warnings.length>0?(n(),a("label",Iu,[W(e("input",{type:"checkbox","onUpdate:modelValue":o[2]||(o[2]=V=>m.value=V)},null,512),[[ve,m.value]]),e("span",null,"I've migrated existing "+p(t.platform)+" entries (if any)",1)])):M("",!0)])]),e("div",Du,[e("button",{onClick:o[3]||(o[3]=V=>C.$emit("close")),class:"btn-secondary"}," Cancel "),e("button",{onClick:U,class:"btn-primary",disabled:!T.value},[...o[30]||(o[30]=[e("i",{class:"mdi mdi-check"},null,-1),R(" I've Completed Setup ",-1)])],8,Tu)])])])):M("",!0)}},Ru=we(xu,[["__scopeId","data-v-f6fe4c03"]]),Mu={class:"modal-header"},Au={class:"progress-steps"},Ou={class:"step-number"},Eu={key:0,class:"mdi mdi-check"},Lu={key:1},Vu={class:"step-label"},Pu={class:"modal-body"},Uu={key:0,class:"step-content"},Fu={class:"form-group"},ju={class:"form-group"},Nu={class:"form-group"},Bu={key:1,class:"step-content"},Hu={key:1,class:"platform-form"},qu={class:"form-section"},zu={class:"checkbox-grid"},Ju={class:"checkbox-item"},Wu={class:"checkbox-item"},Gu={class:"checkbox-item"},Ku={class:"checkbox-item"},Xu={class:"checkbox-item"},Yu={key:2,class:"platform-form"},Zu={class:"form-section"},Qu={class:"form-group"},ec={class:"form-section"},tc={class:"checkbox-grid"},oc={class:"checkbox-item"},lc={class:"checkbox-item"},nc={key:3,class:"platform-form"},sc={class:"form-section"},ac={class:"checkbox-grid"},ic={class:"checkbox-item"},rc={class:"checkbox-item"},dc={class:"checkbox-item"},uc={class:"checkbox-item"},cc={key:2,class:"step-content"},mc={key:3,class:"step-content"},vc={class:"modal-footer"},pc=["disabled"],fc={key:2,class:"save-buttons"},gc=["disabled"],yc=["disabled"],bc={__name:"SmartIRProfileBuilder",props:{show:{type:Boolean,default:!1},editMode:{type:Boolean,default:!1},editData:{type:Object,default:null},startStep:{type:Number,default:0}},emits:["close","save"],setup(t,{emit:u}){const i=t,_=u,w=Te("toast"),r=y(0),m=y(!1),g=y([]),T=y(!1),I=y([]),U=y("/config"),C=y(!1),o=y(null),V=y(!1),q=y(!1),P=y(""),S=y("ir"),s=y(!1),h=[{label:"Device Info",key:"info"},{label:"Configuration",key:"config"},{label:"Learn Commands",key:"commands"},{label:"Preview & Save",key:"preview"}],f=y({platform:"",manufacturer:"",model:"",broadlinkDevice:"",commandType:"ir",config:{},commands:{}}),L=y(["turn_on"]),J=y(3),X=y([]),H=y(["turn_on"]);ae(()=>f.value.platform,k=>{k==="media_player"?f.value.config={features:L.value}:k==="fan"?f.value.config={speedLevels:J.value,features:X.value}:k==="light"&&(f.value.config={features:H.value})}),ae(L,k=>{f.value.platform==="media_player"&&(f.value.config={features:k})},{deep:!0}),ae(J,k=>{f.value.platform==="fan"&&(f.value.config={speedLevels:k,features:X.value})}),ae(X,k=>{f.value.platform==="fan"&&(f.value.config={speedLevels:J.value,features:k})},{deep:!0}),ae(H,k=>{f.value.platform==="light"&&(f.value.config={features:k})},{deep:!0});function oe(k){const l=new Set,O=Object.keys(k);return O.some(B=>B==="off"||B.includes("_off"))&&l.add("off"),O.some(B=>B.includes("auto"))&&l.add("auto"),O.some(B=>B.includes("cool"))&&l.add("cool"),O.some(B=>B.includes("heat"))&&l.add("heat"),O.some(B=>B.includes("dry"))&&l.add("dry"),O.some(B=>B.includes("fan_only"))&&l.add("fan_only"),Array.from(l)}function E(k){const l=new Set,O=Object.keys(k);return O.some(B=>B.includes("auto"))&&l.add("auto"),O.some(B=>B.includes("low"))&&l.add("low"),O.some(B=>B.includes("medium")||B.includes("mid"))&&l.add("medium"),O.some(B=>B.includes("high"))&&l.add("high"),Array.from(l)}function j(k){const l=new Set,O=Object.keys(k);return O.some(B=>B.includes("swing_off")||B.includes("_off"))&&l.add("off"),O.some(B=>B.includes("vertical"))&&l.add("vertical"),O.some(B=>B.includes("horizontal"))&&l.add("horizontal"),O.some(B=>B.includes("both"))&&l.add("both"),Array.from(l)}function te(k){for(const l of Object.values(k))if(typeof l=="string"&&l.startsWith("sc")||Array.isArray(l)&&l.length>0&&typeof l[0]=="string"&&l[0].startsWith("sc"))return"rf";return"ir"}ae(()=>f.value.commandType,(k,l)=>{!l||V.value||s.value||(Object.keys(f.value.commands).length>0&&k!==l?(P.value=k,f.value.commandType=l,V.value=!0):k!==l&&(S.value=k))}),ae(()=>i.editData,async k=>{var l,O,B;if(k&&i.editMode){console.log("🔧 Edit mode activated, loading profile data:",k),s.value=!0,g.value.length===0&&(console.log("📡 Loading Broadlink devices..."),await A(),console.log("📡 Devices loaded:",g.value.length));const ne=k.profile,se=ne.controller_data;console.log("🎮 Controller data from profile:",se),console.log("🎮 Available devices:",g.value.map(D=>D.entity_id));const le=ne.commands||{},Y=ne.commandType||te(le);console.log("🔍 Command type (stored):",ne.commandType),console.log("🔍 Command type (final):",Y);let de={};if(k.platform==="climate"){const D=ne.operationModes||oe(le),$=ne.fanModes||E(le),N=ne.swingModes||j(le);console.log("🔍 Inferred modes:",D),console.log("🔍 Inferred fan modes:",$),console.log("🔍 Inferred swing modes:",N),de={minTemp:ne.minTemperature,maxTemp:ne.maxTemperature,precision:ne.precision,modes:D,fanModes:$,swingModes:N}}else if(k.platform==="media_player"){const D=[];(le.on||le.off)&&D.push("turn_on"),(le.volumeUp||le.volumeDown)&&D.push("volume"),le.mute&&D.push("mute"),le.sources&&D.push("source"),(le.channelUp||le.channelDown)&&D.push("channel"),de={features:D},L.value=D,console.log("🔍 Inferred media player features:",D)}else if(k.platform==="fan"){const D=((l=ne.speed)==null?void 0:l.length)||Object.keys(le.default||{}).length||3,$=[];(le.oscillate_on||le.oscillate_off)&&$.push("oscillate"),(le.direction_forward||le.direction_reverse)&&$.push("direction"),de={speedLevels:D,features:$},J.value=D,X.value=$,console.log("🔍 Inferred fan config:",de)}else if(k.platform==="light"){const D=[];de={features:D},H.value=D,console.log("🔍 Inferred light features:",D)}const Re=await b(ne.manufacturer,(O=ne.supportedModels)==null?void 0:O[0],le);f.value={platform:k.platform,manufacturer:ne.manufacturer||"",model:((B=ne.supportedModels)==null?void 0:B[0])||"",broadlinkDevice:se||"",commandType:Y,config:de,commands:Re},console.log("✅ Profile populated:",f.value),console.log("✅ Selected device:",f.value.broadlinkDevice),console.log("✅ Command type:",f.value.commandType),console.log("✅ Commands (with learned codes):",Re),S.value=Y,setTimeout(()=>{s.value=!1},100)}},{immediate:!0});const ie=G(()=>{var k;switch(r.value){case 0:return f.value.platform&&f.value.manufacturer&&f.value.model;case 1:return f.value.platform==="climate"?f.value.config.minTemp&&f.value.config.maxTemp&&((k=f.value.config.modes)==null?void 0:k.length)>0:!0;case 2:return f.value.broadlinkDevice&&f.value.commandType&&Object.keys(f.value.commands).length>0;case 3:return!0;default:return!1}}),ye=y(null);async function _e(){if(r.value!==3){ye.value=null;return}if(console.log("🔍 Generating JSON with commands:",f.value.commands),Object.values(f.value.commands).some(l=>typeof l=="string"?l==="pending":typeof l=="object"?Object.values(l).some(O=>typeof O=="string"?O==="pending":typeof O=="object"?Object.values(O).some(B=>B==="pending"):!1):!1)){console.warn('⚠️ Commands still contain "pending" placeholders!'),console.log("📦 Attempting to fetch from Broadlink storage...");const l=await b(f.value.manufacturer,f.value.model,f.value.commands);f.value.commands=l,console.log("✅ Updated commands:",l)}ye.value=d(f.value),console.log("📄 Generated JSON:",ye.value)}const xe=G(()=>r.value!==3?null:c(f.value));function De(){f.value.config={},f.value.commands={}}function x(){V.value=!1,f.value.commandType=P.value,S.value=P.value,f.value.commands={},P.value=""}function v(){V.value=!1,P.value=""}async function F(){r.value<h.length-1&&(r.value++,r.value===3&&await _e())}function pe(){r.value>0&&r.value--}function Oe(){V.value||(q.value=!0)}function fe(){q.value=!1,be()}function be(){_("close"),setTimeout(()=>{r.value=0,f.value={platform:"",manufacturer:"",model:"",broadlinkDevice:"",commandType:"ir",config:{},commands:{}},S.value="ir"},300)}async function Se(){var k,l,O,B,ne,se;m.value=!0;try{if(!C.value){const $=(await Q.get("/api/smartir/config/check")).data;if($&&!((k=$.platforms[f.value.platform])==null?void 0:k.file_exists)){I.value=$.configuration_warnings||[],U.value=$.config_path||"/config",o.value={platform:f.value.platform,json:ye.value},T.value=!0,m.value=!1;return}}let le;i.editMode&&((l=i.editData)!=null&&l.code)?(le=parseInt(i.editData.code),console.log("📝 Edit mode: Using existing code",le)):(le=(await Q.get(`/api/smartir/platforms/${f.value.platform}/next-code`)).data.next_code,console.log("✨ New profile: Using next code",le));const de=(await Q.post("/api/smartir/profiles",{platform:f.value.platform,json:ye.value,code_number:le})).data,Re={platform:"smartir",name:`${f.value.manufacturer} ${f.value.model}`,unique_id:`${f.value.manufacturer.toLowerCase().replace(/[^a-z0-9]+/g,"_")}_${f.value.model.toLowerCase().replace(/[^a-z0-9]+/g,"_")}`,device_code:le,controller_data:f.value.broadlinkDevice};try{await Q.post("/api/smartir/config/add-device",{platform:f.value.platform,device_config:{platform:"smartir",name:Re.name,unique_id:Re.unique_id,device_code:Re.device_code,controller_data:Re.controller_data}})}catch(D){console.error("Failed to add device to config:",D);const $=((O=D.response)==null?void 0:O.data)||{};let N=$.error||"Unknown error";$.validation_errors&&$.validation_errors.length>0&&(N=`Device configuration validation failed:
`+$.validation_errors.map(z=>`  • ${z}`).join(`
`)),(B=w.value)==null||B.warning(`Profile saved but failed to add to config file:
${N}`,"⚠️ Partial Success")}_("save",{json:ye.value,yaml:xe.value,profile:f.value,saved_to:de.path}),(ne=w.value)==null||ne.success(`File: ${de.filename}
Device Code: ${le}
Added to: smartir/${f.value.platform}.yaml

⚠️ Restart Home Assistant to activate`,"✅ Profile Saved Successfully!"),be()}catch(le){console.error("Error saving profile:",le),(se=w.value)==null||se.error(le.message,"❌ Error Saving Profile")}finally{m.value=!1}}async function Ee(){C.value=!0,T.value=!1,o.value&&(await Se(),o.value=null)}function Z(){var k,l;try{const O=JSON.stringify(ye.value,null,2),B=new Blob([O],{type:"application/json"}),ne=URL.createObjectURL(B),se=document.createElement("a");se.href=ne;const le=f.value.manufacturer.toLowerCase().replace(/\s+/g,"_"),Y=f.value.model.toLowerCase().replace(/\s+/g,"_");se.download=`smartir_${f.value.platform}_${le}_${Y}.json`,document.body.appendChild(se),se.click(),document.body.removeChild(se),URL.revokeObjectURL(ne),(k=w.value)==null||k.success("You can manually upload this file to your SmartIR codes directory.","✅ Profile Downloaded")}catch(O){console.error("Error downloading profile:",O),(l=w.value)==null||l.error(O.message,"❌ Error Downloading Profile")}}async function b(k,l,O){const B=k.toLowerCase().replace(/[^a-z0-9]+/g,"_"),ne=l.toLowerCase().replace(/[^a-z0-9]+/g,"_"),se=`${B}_${ne}`;try{const de=(await Q.get("/api/commands/all")).data[se]||{};console.log(`🔍 Fetching learned commands for device: ${se}`),console.log("📦 Device commands from storage:",de);const Re={...O};for(const[D,$]of Object.entries(Re))if($==="pending"&&de[D])Re[D]=de[D];else if(typeof $=="object"){for(const[N,z]of Object.entries($))if(typeof z=="object")for(const[ee,he]of Object.entries(z)){const me=`${D}_${N}_${ee}`;he==="pending"&&de[me]&&(Re[D][N][ee]=de[me])}else if(z==="pending"){const ee=`${D}_${N}`;de[ee]&&(Re[D][N]=de[ee])}}return console.log("✅ Merged commands:",Re),Re}catch(le){return console.error("Error fetching learned commands:",le),O}}function d(k){const l={manufacturer:k.manufacturer,supportedModels:[k.model],supportedController:"Broadlink",commandsEncoding:"Base64",commandType:k.commandType||"ir",commands:{}};return k.platform==="climate"&&(l.minTemperature=k.config.minTemp,l.maxTemperature=k.config.maxTemp,l.precision=k.config.precision||1,l.operationModes=k.config.modes||[],l.fanModes=k.config.fanModes&&k.config.fanModes.length>0?k.config.fanModes:["auto"],k.config.swingModes&&k.config.swingModes.length>0&&(l.swingModes=k.config.swingModes),l.commands=k.commands),l}function c(k){let l=`# SmartIR ${k.platform} configuration
`;return l+=`# Generated by Broadlink Manager v2

`,k.platform==="climate"&&(l+=`climate:
`,l+=`  - platform: smartir
`,l+=`    name: ${k.manufacturer} ${k.model}
`,l+=`    unique_id: ${k.manufacturer.toLowerCase()}_${k.model.toLowerCase().replace(/\s+/g,"_")}
`,l+=`    device_code: 10000  # Change this to your custom code number
`,l+=`    controller_data: ${k.broadlinkDevice}
`,k.config.tempSensor&&(l+=`    temperature_sensor: ${k.config.tempSensor}
`),k.config.humiditySensor&&(l+=`    humidity_sensor: ${k.config.humiditySensor}
`),k.config.powerSensor&&(l+=`    power_sensor: ${k.config.powerSensor}
`)),l}async function A(){try{console.log("Fetching remote devices from /api/remote/devices...");const k=await Q.get("/api/remote/devices");console.log("Loaded remote devices response:",k.data);const l=k.data.devices||[];console.log("Extracted devices array:",l),console.log("Device count:",l.length),g.value=l,console.log("broadlinkDevices.value set to:",g.value),console.log("Final device count:",g.value.length)}catch(k){console.error("Error loading remote devices:",k),g.value=[]}}return ae(()=>i.show,k=>{if(k){const l=Number.isInteger(i.startStep)?i.startStep:0;r.value=Math.min(Math.max(l,0),h.length-1)}}),ae(()=>i.startStep,k=>{if(i.show){const l=Number.isInteger(k)?k:0;r.value=Math.min(Math.max(l,0),h.length-1)}}),Ae(()=>{i.show&&A()}),(k,l)=>t.show?(n(),a("div",{key:0,class:"modal-overlay",onClick:Oe},[e("div",{class:"modal-container",onClick:l[19]||(l[19]=ue(()=>{},["stop"]))},[e("div",Mu,[e("h2",null,[l[22]||(l[22]=e("i",{class:"mdi mdi-file-document-edit"},null,-1)),R(" "+p(t.editMode?"Edit SmartIR Profile":"Create SmartIR Profile"),1)]),e("button",{onClick:be,class:"close-button"},[...l[23]||(l[23]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Au,[(n(),a(ce,null,ke(h,(O,B)=>e("div",{key:B,class:K(["step",{active:r.value===B,completed:r.value>B}])},[e("div",Ou,[r.value>B?(n(),a("i",Eu)):(n(),a("span",Lu,p(B+1),1))]),e("span",Vu,p(O.label),1)],2)),64))]),e("div",Pu,[r.value===0?(n(),a("div",Uu,[l[29]||(l[29]=e("h3",null,"Device Information",-1)),e("div",Fu,[l[25]||(l[25]=e("label",null,"Platform Type *",-1)),W(e("select",{"onUpdate:modelValue":l[0]||(l[0]=O=>f.value.platform=O),onChange:De},[...l[24]||(l[24]=[je('<option value="" data-v-2e218e9d>Select platform...</option><option value="climate" data-v-2e218e9d>🌡️ Climate (AC, Heater, Heat Pump)</option><option value="media_player" data-v-2e218e9d>📺 Media Player (TV, Receiver)</option><option value="fan" data-v-2e218e9d>🌀 Fan</option><option value="light" data-v-2e218e9d>💡 Light (LED Strip, IR Light)</option>',5)])],544),[[Ie,f.value.platform]])]),e("div",ju,[l[26]||(l[26]=e("label",null,"Manufacturer *",-1)),W(e("input",{"onUpdate:modelValue":l[1]||(l[1]=O=>f.value.manufacturer=O),type:"text",placeholder:"e.g., Daikin, LG, Samsung"},null,512),[[Me,f.value.manufacturer]])]),e("div",Nu,[l[27]||(l[27]=e("label",null,"Model(s) *",-1)),W(e("input",{"onUpdate:modelValue":l[2]||(l[2]=O=>f.value.model=O),type:"text",placeholder:"e.g., FTXS35K, Multiple models"},null,512),[[Me,f.value.model]]),l[28]||(l[28]=e("small",null,'Enter model number or "Multiple" if it works with many models',-1))])])):M("",!0),r.value===1?(n(),a("div",Bu,[f.value.platform==="climate"?(n(),Pe(ad,{key:0,modelValue:f.value.config,"onUpdate:modelValue":l[3]||(l[3]=O=>f.value.config=O)},null,8,["modelValue"])):f.value.platform==="media_player"?(n(),a("div",Hu,[l[36]||(l[36]=e("h3",null,"Media Player Configuration",-1)),l[37]||(l[37]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),R(" Configure the features your media player supports. You'll learn the IR commands in the next step. ")],-1)),e("div",qu,[l[35]||(l[35]=e("h4",null,"Supported Features",-1)),e("div",zu,[e("label",Ju,[W(e("input",{type:"checkbox",value:"turn_on","onUpdate:modelValue":l[4]||(l[4]=O=>L.value=O)},null,512),[[ve,L.value]]),l[30]||(l[30]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),R(" Power On/Off ")],-1))]),e("label",Wu,[W(e("input",{type:"checkbox",value:"volume","onUpdate:modelValue":l[5]||(l[5]=O=>L.value=O)},null,512),[[ve,L.value]]),l[31]||(l[31]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-volume-high"}),R(" Volume Control ")],-1))]),e("label",Gu,[W(e("input",{type:"checkbox",value:"mute","onUpdate:modelValue":l[6]||(l[6]=O=>L.value=O)},null,512),[[ve,L.value]]),l[32]||(l[32]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-volume-mute"}),R(" Mute ")],-1))]),e("label",Ku,[W(e("input",{type:"checkbox",value:"source","onUpdate:modelValue":l[7]||(l[7]=O=>L.value=O)},null,512),[[ve,L.value]]),l[33]||(l[33]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-import"}),R(" Source Selection ")],-1))]),e("label",Xu,[W(e("input",{type:"checkbox",value:"channel","onUpdate:modelValue":l[8]||(l[8]=O=>L.value=O)},null,512),[[ve,L.value]]),l[34]||(l[34]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-numeric"}),R(" Channel Control ")],-1))])])])])):f.value.platform==="fan"?(n(),a("div",Yu,[l[44]||(l[44]=e("h3",null,"Fan Configuration",-1)),l[45]||(l[45]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),R(" Configure the features your fan supports. You'll learn the IR commands in the next step. ")],-1)),e("div",Zu,[l[40]||(l[40]=e("h4",null,"Fan Speed Levels",-1)),e("div",Qu,[l[39]||(l[39]=e("label",null,"Number of Speed Levels *",-1)),W(e("select",{"onUpdate:modelValue":l[9]||(l[9]=O=>J.value=O)},[...l[38]||(l[38]=[e("option",{value:1},"1 Speed",-1),e("option",{value:2},"2 Speeds",-1),e("option",{value:3},"3 Speeds (Low/Med/High)",-1),e("option",{value:4},"4 Speeds",-1),e("option",{value:5},"5 Speeds",-1),e("option",{value:6},"6 Speeds",-1)])],512),[[Ie,J.value,void 0,{number:!0}]])])]),e("div",ec,[l[43]||(l[43]=e("h4",null,"Additional Features",-1)),e("div",tc,[e("label",oc,[W(e("input",{type:"checkbox",value:"oscillate","onUpdate:modelValue":l[10]||(l[10]=O=>X.value=O)},null,512),[[ve,X.value]]),l[41]||(l[41]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-sync"}),R(" Oscillation ")],-1))]),e("label",lc,[W(e("input",{type:"checkbox",value:"direction","onUpdate:modelValue":l[11]||(l[11]=O=>X.value=O)},null,512),[[ve,X.value]]),l[42]||(l[42]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-rotate-3d-variant"}),R(" Direction (Forward/Reverse) ")],-1))])])])])):f.value.platform==="light"?(n(),a("div",nc,[l[51]||(l[51]=e("h3",null,"Light Configuration",-1)),l[52]||(l[52]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),R(" Configure the features your light supports. You'll learn the IR commands in the next step. ")],-1)),e("div",sc,[l[50]||(l[50]=e("h4",null,"Supported Features",-1)),e("div",ac,[e("label",ic,[W(e("input",{type:"checkbox",value:"turn_on","onUpdate:modelValue":l[12]||(l[12]=O=>H.value=O)},null,512),[[ve,H.value]]),l[46]||(l[46]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),R(" Power On/Off ")],-1))]),e("label",rc,[W(e("input",{type:"checkbox",value:"brightness","onUpdate:modelValue":l[13]||(l[13]=O=>H.value=O)},null,512),[[ve,H.value]]),l[47]||(l[47]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-brightness-6"}),R(" Brightness Control ")],-1))]),e("label",dc,[W(e("input",{type:"checkbox",value:"color_temp","onUpdate:modelValue":l[14]||(l[14]=O=>H.value=O)},null,512),[[ve,H.value]]),l[48]||(l[48]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-thermometer"}),R(" Color Temperature ")],-1))]),e("label",uc,[W(e("input",{type:"checkbox",value:"rgb","onUpdate:modelValue":l[15]||(l[15]=O=>H.value=O)},null,512),[[ve,H.value]]),l[49]||(l[49]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-palette"}),R(" RGB Color ")],-1))])])])])):M("",!0)])):M("",!0),r.value===2?(n(),a("div",cc,[ge(Fd,{modelValue:f.value.commands,"onUpdate:modelValue":l[16]||(l[16]=O=>f.value.commands=O),platform:f.value.platform,config:f.value.config,broadlinkDevice:f.value.broadlinkDevice,"onUpdate:broadlinkDevice":l[17]||(l[17]=O=>f.value.broadlinkDevice=O),manufacturer:f.value.manufacturer,model:f.value.model,commandType:f.value.commandType,"onUpdate:commandType":l[18]||(l[18]=O=>f.value.commandType=O)},null,8,["modelValue","platform","config","broadlinkDevice","manufacturer","model","commandType"])])):M("",!0),r.value===3?(n(),a("div",mc,[ge(uu,{profile:f.value,"json-data":ye.value,"yaml-config":xe.value},null,8,["profile","json-data","yaml-config"])])):M("",!0)]),e("div",vc,[r.value>0?(n(),a("button",{key:0,onClick:pe,class:"btn-secondary"},[...l[53]||(l[53]=[e("i",{class:"mdi mdi-arrow-left"},null,-1),R(" Back ",-1)])])):M("",!0),l[57]||(l[57]=e("div",{class:"spacer"},null,-1)),e("button",{onClick:be,class:"btn-text"}," Cancel "),r.value<h.length-1?(n(),a("button",{key:1,onClick:F,class:"btn-primary",disabled:!ie.value},[...l[54]||(l[54]=[R(" Next ",-1),e("i",{class:"mdi mdi-arrow-right"},null,-1)])],8,pc)):(n(),a("div",fc,[e("button",{onClick:Se,class:"btn-primary",disabled:m.value},[l[55]||(l[55]=e("i",{class:"mdi mdi-cloud-upload"},null,-1)),R(" "+p(m.value?"Saving...":"Save to SmartIR"),1)],8,gc),e("button",{onClick:Z,class:"btn-secondary",disabled:m.value},[...l[56]||(l[56]=[e("i",{class:"mdi mdi-download"},null,-1),R(" Download JSON ",-1)])],8,yc)]))])]),ge(Ru,{show:T.value,platform:f.value.platform,warnings:I.value,"config-path":U.value,onClose:l[20]||(l[20]=O=>T.value=!1),onComplete:Ee},null,8,["show","platform","warnings","config-path"]),ge(Fe,{isOpen:V.value,title:"Change Command Type?",message:"Changing the command type will clear all learned commands. Continue?",confirmText:"Continue",cancelText:"Cancel",dangerMode:!0,onConfirm:x,onCancel:v},null,8,["isOpen"]),ge(Fe,{isOpen:q.value,title:"Close Profile Builder?",message:"Are you sure you want to close? Your progress will be lost.",confirmText:"Close",cancelText:"Keep Editing",dangerMode:!0,onConfirm:fe,onCancel:l[21]||(l[21]=O=>q.value=!1)},null,8,["isOpen"])])):M("",!0)}},hc=we(bc,[["__scopeId","data-v-2e218e9d"]]),kc={class:"dashboard"},wc={key:1,class:"welcome-banner"},$c={__name:"Dashboard",setup(t){const u=He(),i=Te("smartirEnabled"),{isMobile:_}=Ze(),w=y(!1),r=y(!1),m=y(null),g=y(0),T=y(null),I=y(localStorage.getItem("welcome_banner_dismissed")==="true");function U(){I.value=!0,localStorage.setItem("welcome_banner_dismissed","true")}function C(){r.value=!1,m.value=null,g.value=0,w.value=!0}async function o({platform:P,profile:S,startStep:s}){g.value=Number.isInteger(s)?s:0;try{const h=await fetch(`api/smartir/platforms/${P}/profiles/${S.code}`);if(!h.ok)throw new Error("Failed to load profile");const f=await h.json();let L="";try{const J=await fetch(`api/smartir/config/get-device?platform=${P}&code=${S.code}`);J.ok?(L=(await J.json()).controller_data||"",console.log("✅ Found controller_data from YAML:",L)):console.warn("⚠️ No YAML entry found for this profile (this is OK for profiles not yet added to config)")}catch(J){console.warn("⚠️ Could not fetch controller_data from config:",J)}r.value=!0,m.value={platform:P,code:S.code,profile:{...f.profile,controller_data:L}},w.value=!0}catch(h){console.error("Error loading profile for edit:",h),u.error("Failed to load profile for editing")}}function V(){w.value=!1,r.value=!1,m.value=null}async function q(P){console.log("Profile saved:",P),V(),T.value&&T.value.loadAllProfiles&&(await T.value.loadAllProfiles(),console.log("✅ Profiles list refreshed"))}return(P,S)=>(n(),a("div",kc,[$e(i)?(n(),Pe(ma,{key:0})):M("",!0),!$e(_)&&!I.value?(n(),a("div",wc,[e("button",{class:"dismiss-button",onClick:U,title:"Dismiss"},[...S[0]||(S[0]=[e("i",{class:"mdi mdi-close"},null,-1)])]),S[1]||(S[1]=je('<div class="banner-content" data-v-12185d74><div class="banner-icon" data-v-12185d74><i class="mdi mdi-rocket-launch" data-v-12185d74></i></div><div class="banner-text" data-v-12185d74><h2 data-v-12185d74>Welcome to Broadlink Manager v2!</h2><p data-v-12185d74>Manage your IR/RF devices with a modern Vue 3 interface</p></div></div><div class="status-badges" data-v-12185d74><span class="badge success" data-v-12185d74><i class="mdi mdi-check-circle" data-v-12185d74></i> Vue 3 Ready </span><span class="badge warning" data-v-12185d74><i class="mdi mdi-beta" data-v-12185d74></i> Beta </span></div>',2))])):M("",!0),ge(aa),$e(i)?(n(),Pe(ur,{key:2,ref_key:"smartirStatusCard",ref:T,onCreateProfile:C,onEditProfile:o},null,512)):M("",!0),ge(hc,{show:w.value,editMode:r.value,editData:m.value,startStep:g.value,onClose:V,onSave:q},null,8,["show","editMode","editData","startStep"])]))}},Cc=we($c,[["__scopeId","data-v-12185d74"]]),_c={class:"toast-container"},Sc={class:"toast-content"},Ic={key:0,class:"toast-title"},Dc={class:"toast-message"},Tc={key:1,class:"toast-description"},xc=["onClick","title"],Rc={__name:"Toast",setup(t,{expose:u}){const i=y([]);let _=0;function w(g){const T={success:"mdi-check-circle",error:"mdi-alert-circle",warning:"mdi-alert",info:"mdi-information"};return T[g]||T.info}function r({message:g,title:T,description:I,type:U="info",duration:C=5e3}){const o=_++,V={id:o,message:g,title:T,description:I,type:U};return i.value.push(V),C>0&&setTimeout(()=>{m(o)},C),o}function m(g){const T=i.value.findIndex(I=>I.id===g);T>-1&&i.value.splice(T,1)}return u({addToast:r,removeToast:m,show:r,success:(g,T)=>r({message:g,title:T,type:"success"}),error:(g,T)=>r({message:g,title:T,type:"error",duration:0}),warning:(g,T)=>r({message:g,title:T,type:"warning",duration:0}),info:(g,T)=>r({message:g,title:T,type:"info"})}),(g,T)=>(n(),Pe(lt,{to:"body"},[e("div",_c,[ge(mt,{name:"toast"},{default:Ye(()=>[(n(!0),a(ce,null,ke(i.value,I=>(n(),a("div",{key:I.id,class:K(["toast",[`toast-${I.type}`,{"toast-persistent":I.type==="error"||I.type==="warning"}]])},[e("i",{class:K(["mdi",w(I.type)])},null,2),e("div",Sc,[I.title?(n(),a("div",Ic,p(I.title),1)):M("",!0),e("div",Dc,p(I.message),1),I.description?(n(),a("div",Tc,p(I.description),1)):M("",!0)]),e("button",{onClick:U=>m(I.id),class:K(["toast-close",{"toast-close-prominent":I.type==="error"||I.type==="warning"}]),title:I.type==="error"||I.type==="warning"?"Click to dismiss":"Close"},[...T[0]||(T[0]=[e("i",{class:"mdi mdi-close"},null,-1)])],10,xc)],2))),128))]),_:1})])]))}},Mc=we(Rc,[["__scopeId","data-v-3948c088"]]),Ac="0.3.0-alpha.2",Oc={version:Ac},Ec={id:"app",class:"app-container"},Lc={class:"app-header"},Vc={class:"header-content"},Pc={class:"header-right"},Uc=["title"],Fc={class:"settings-menu-container"},jc={key:0,class:"settings-menu"},Nc=["title"],Bc={class:"toggle-content"},Hc={key:0,class:"not-installed-label"},qc={key:0,href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"menu-item menu-link menu-subitem"},zc=["disabled"],Jc=["disabled"],Wc=["disabled"],Gc={class:"app-main"},Kc={class:"app-footer"},Xc={__name:"App",setup(t){const u=y(null),i=Oc.version,_=y("light"),w=y(null),r=y(!1),m=y(!1),g=y(!1),T=y(localStorage.getItem("smartir_enabled")!=="false"),I=G(()=>{var f;return((f=w.value)==null?void 0:f.installed)||!1}),U=G(()=>({light:"mdi mdi-weather-sunny",medium:"mdi mdi-weather-partly-cloudy",dark:"mdi mdi-weather-night"})[_.value]),C=G(()=>({light:"Switch to Medium Theme",medium:"Switch to Dark Theme",dark:"Switch to Light Theme"})[_.value]),o=()=>{const f=["light","medium","dark"],J=(f.indexOf(_.value)+1)%f.length;_.value=f[J],document.body.classList.remove("medium-mode","dark-mode"),_.value==="medium"?document.body.classList.add("medium-mode"):_.value==="dark"&&document.body.classList.add("dark-mode"),localStorage.setItem("theme",_.value)},V=async()=>{try{const f=await at.getStatus();w.value=f,f.installed?console.log("✅ SmartIR detected:",f.version):console.log("ℹ️ SmartIR not detected")}catch(f){console.error("Error checking SmartIR:",f),w.value={installed:!1,error:f.message}}},q=async()=>{var f,L,J;m.value=!0;try{const H=(await Q.get("/api/diagnostics/markdown")).data.markdown;if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(H),(f=u.value)==null||f.success("Diagnostic summary copied to clipboard!");else{const oe=document.createElement("textarea");oe.value=H,oe.style.position="fixed",oe.style.left="-999999px",oe.style.top="-999999px",document.body.appendChild(oe),oe.focus(),oe.select();try{if(document.execCommand("copy"))(L=u.value)==null||L.success("Diagnostic summary copied to clipboard!");else throw new Error("execCommand failed")}finally{document.body.removeChild(oe)}}r.value=!1}catch(X){console.error("Error copying diagnostics:",X),(J=u.value)==null||J.error("Failed to copy diagnostics: "+X.message)}finally{m.value=!1}},P=async()=>{var f,L;m.value=!0;try{const J=await Q.get("/api/diagnostics/download",{responseType:"blob"}),X=window.URL.createObjectURL(new Blob([J.data])),H=document.createElement("a");H.href=X;const oe=J.headers["content-disposition"];let E="broadlink_manager_diagnostics.zip";if(oe){const j=oe.match(/filename="?(.+)"?/);j&&(E=j[1])}H.setAttribute("download",E),document.body.appendChild(H),H.click(),H.remove(),window.URL.revokeObjectURL(X),(f=u.value)==null||f.success("Diagnostic bundle downloaded!"),r.value=!1}catch(J){console.error("Error downloading diagnostics:",J),(L=u.value)==null||L.error("Failed to download diagnostics")}finally{m.value=!1}},S=()=>{I.value&&(T.value=!T.value,localStorage.setItem("smartir_enabled",T.value.toString()),window.location.reload())},s=async()=>{var f,L,J;g.value=!0;try{const X=await Q.post("/api/smartir/refresh-index");X.data.success?(f=u.value)==null||f.success(`Updated to v${X.data.version} (${X.data.total_devices} devices)`,"✅ Index Updated"):(L=u.value)==null||L.error(X.data.error||"Unknown error","❌ Update Failed")}catch(X){console.error("Error updating SmartIR index:",X),(J=u.value)==null||J.error("Failed to update device index","❌ Update Error")}finally{g.value=!1,r.value=!1}},h=f=>{f.target.closest(".settings-menu-container")||(r.value=!1)};return Ae(async()=>{const f=localStorage.getItem("theme");f&&["light","medium","dark"].includes(f)?(_.value=f,f==="medium"?document.body.classList.add("medium-mode"):f==="dark"&&document.body.classList.add("dark-mode")):localStorage.getItem("darkMode")==="true"&&(_.value="dark",document.body.classList.add("dark-mode"),localStorage.setItem("theme","dark")),await V();const L=et();L&&u.value&&(L.appContext.config.globalProperties.$toast=u.value),document.addEventListener("click",h)}),Xe(()=>{document.removeEventListener("click",h)}),ze("smartirStatus",w),ze("smartirEnabled",T),ze("refreshSmartIR",V),ze("toast",u),(f,L)=>(n(),a("div",Ec,[e("header",Lc,[e("div",Vc,[L[13]||(L[13]=e("div",{class:"header-left"},[e("i",{class:"mdi mdi-remote"}),e("h1",null,"Broadlink Manager v2"),e("span",{class:"beta-badge"},"BETA")],-1)),e("div",Pc,[e("button",{onClick:o,class:"icon-button",title:C.value},[e("i",{class:K(U.value)},null,2)],8,Uc),e("div",Fc,[e("button",{onClick:L[0]||(L[0]=J=>r.value=!r.value),class:"icon-button",title:"Settings"},[...L[2]||(L[2]=[e("i",{class:"mdi mdi-cog"},null,-1)])]),r.value?(n(),a("div",jc,[L[9]||(L[9]=e("div",{class:"menu-section-title"},"Integration Settings",-1)),e("div",{class:K(["menu-item toggle-item",{disabled:!I.value}]),onClick:L[1]||(L[1]=J=>I.value?S():null),title:I.value?"":"SmartIR is not installed"},[e("div",Bc,[L[3]||(L[3]=e("i",{class:"mdi mdi-air-conditioner"},null,-1)),L[4]||(L[4]=e("span",null,"SmartIR Integration",-1)),I.value?M("",!0):(n(),a("span",Hc,"(Not Installed)"))]),e("div",{class:K(["toggle-switch",{active:T.value&&I.value,disabled:!I.value}])},[...L[5]||(L[5]=[e("div",{class:"toggle-slider"},null,-1)])],2)],10,Nc),T.value?(n(),a("a",qc,[...L[6]||(L[6]=[e("i",{class:"mdi mdi-github"},null,-1),e("span",null,"SmartIR on GitHub",-1)])])):M("",!0),T.value?(n(),a("button",{key:1,onClick:s,class:"menu-item menu-subitem",disabled:g.value},[e("i",{class:K(["mdi",g.value?"mdi-loading mdi-spin":"mdi-refresh"])},null,2),e("span",null,p(g.value?"Updating...":"Update Device Index"),1)],8,zc)):M("",!0),L[10]||(L[10]=e("div",{class:"menu-divider"},null,-1)),L[11]||(L[11]=e("div",{class:"menu-section-title"},"Diagnostics",-1)),e("button",{onClick:q,class:"menu-item",disabled:m.value},[...L[7]||(L[7]=[e("i",{class:"mdi mdi-content-copy"},null,-1),e("span",null,"Copy Diagnostics",-1)])],8,Jc),e("button",{onClick:P,class:"menu-item",disabled:m.value},[...L[8]||(L[8]=[e("i",{class:"mdi mdi-download"},null,-1),e("span",null,"Download Diagnostics",-1)])],8,Wc),L[12]||(L[12]=je('<div class="menu-divider" data-v-4bc2c39f></div><div class="menu-section-title" data-v-4bc2c39f>Help &amp; Support</div><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2#readme" target="_blank" class="menu-item menu-link" data-v-4bc2c39f><i class="mdi mdi-book-open-variant" data-v-4bc2c39f></i><span data-v-4bc2c39f>Documentation</span></a><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2/issues" target="_blank" class="menu-item menu-link" data-v-4bc2c39f><i class="mdi mdi-bug" data-v-4bc2c39f></i><span data-v-4bc2c39f>Report Issue</span></a><div class="menu-divider" data-v-4bc2c39f></div><div class="menu-section-title" data-v-4bc2c39f>Community</div><a href="https://community.home-assistant.io/t/broadlink-manager-modern-web-interface-for-broadlink-devices/938473" target="_blank" class="menu-item menu-link" data-v-4bc2c39f><i class="mdi mdi-forum" data-v-4bc2c39f></i><span data-v-4bc2c39f>HA Forum Discussion</span></a><a href="https://www.reddit.com/r/homeassistant/comments/1o1q3kf/release_broadlink_manager_addon_a_modern_web_ui/" target="_blank" class="menu-item menu-link" data-v-4bc2c39f><i class="mdi mdi-reddit" data-v-4bc2c39f></i><span data-v-4bc2c39f>Reddit Discussion</span></a><div class="menu-divider" data-v-4bc2c39f></div><div class="menu-section-title" data-v-4bc2c39f>Project</div><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2" target="_blank" class="menu-item menu-link" data-v-4bc2c39f><i class="mdi mdi-github" data-v-4bc2c39f></i><span data-v-4bc2c39f>GitHub Repository</span></a><a href="https://ko-fi.com/tonyperkins" target="_blank" class="menu-item menu-link menu-item-sponsor" data-v-4bc2c39f><i class="mdi mdi-coffee" data-v-4bc2c39f></i><span data-v-4bc2c39f>Support on Ko-fi</span></a>',12))])):M("",!0)])])])]),e("main",Gc,[ge(Cc)]),e("footer",Kc,[e("p",null,"Broadlink Manager v"+p($e(i))+" | Built with Vue "+p(vt),1)]),ge(Mc,{ref_key:"toastRef",ref:u},null,512)]))}},Yc=we(Xc,[["__scopeId","data-v-4bc2c39f"]]),it=pt(Yc),Zc=ft();it.use(Zc);it.mount("#app");
