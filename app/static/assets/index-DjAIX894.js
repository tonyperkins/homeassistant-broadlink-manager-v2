import{g as Ze,r as g,o as Re,a as We,b as st,d as at,c as J,e as s,f as l,h as e,i as x,n as Y,u as $e,t as m,j as _,F as pe,k as ke,w as ue,l as W,v as Me,m as he,p as be,q as Ne,s as Ge,T as Qe,x as Se,y as Te,z as Ue,A as ge,B as et,C as He,D as Ee,E as tt,G as qe,H as it,I as rt,J as dt,K as Be,L as ut,M as ct}from"./vendor-DGiFqQ_g.js";(function(){const v=document.createElement("link").relList;if(v&&v.supports&&v.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))k(h);new MutationObserver(h=>{for(const i of h)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&k(c)}).observe(document,{childList:!0,subtree:!0});function d(h){const i={};return h.integrity&&(i.integrity=h.integrity),h.referrerPolicy&&(i.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?i.credentials="include":h.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function k(h){if(h.ep)return;h.ep=!0;const i=d(h);fetch(h.href,i)}})();let Ye=!1;function Fe(){const o=Ze(),v=o==null?void 0:o.appContext.config.globalProperties.$toast;return v||(Ye||(console.warn("Toast notification system not yet initialized - using console fallback"),Ye=!0),{success:d=>console.log("âœ“",d),error:d=>console.error("âœ—",d),warning:d=>console.warn("âš ",d),info:d=>console.info("â„¹",d)})}function Ke(){const o=g(!1),v=g(!1),d=g(!1),k=g(0),h=767,i=768,c=1023,f=1024,C=()=>{const $=window.innerWidth;k.value=$,o.value=$<=h,v.value=$>=i&&$<=c,d.value=$>=f};return Re(()=>{C(),window.addEventListener("resize",C)}),We(()=>{window.removeEventListener("resize",C)}),{isMobile:o,isTablet:v,isDesktop:d,screenWidth:k,isMobileOrTablet:()=>o.value||v.value,isTabletOrDesktop:()=>v.value||d.value}}const Xe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAHBUlEQVR4nOxZC1BTVxo+9+aNZI2LNsgjWR4hgoIiRVDBslKnIKPbx1jqTrtYoakat1a6dNsdd7t1X8XHyAbEhdUu1u2mXdbasqJbtsaMIqBBECiPBmqEICEBEx4xJLlJ7s6lw6rJDeQ2FzLM+M1kBs7/3+/83zn/Oee/51JRFAXzGbCvA/AWjwX4GvNeANWXnXffHQ4+K6/dYbHeD+IFhjRkb1wn9WPQbEQ4IF/tQlXX2p5+/8OyczY74j/VxuMG3Sh/Oz9jaQDb4CmPT1LIbLXBfzrz0cmHg8fQpx1Yc1Ra+TsiXD4R0PqtRmAyj/LxbJeaujKIcPlEAINOM7vLXBaTZibCRWgRq3WGJZWX63aoNDpB8BJOX/bGlIqwpUv6iXBgWBHG7eUF8urUWvU6Z9sLGxI/IsLl8SJu6u4XigqPXkVspiVTbTQqU1/6Vn7ammh+G5FOMZyqludIKqUVU/9jcaSuTCo/unfHbiad4iBdwMu/P1bV1tO1xbk9NDC0/vwHB1xGcjqYLAh16zsHW3R6XXTu1mfFdAqMrIoSKNbGhLcQ4QGeppDJ7ACtPcqNEI6tT9O3Vqm+tygqNMDjrU9Sef6tIYM2JjUuuXzfC5knCEXsBI8WMZUCAxiCrfhWyMZkMNzYXNHVpwmXXqp5j0Hz0/1m57a3PQ8VHx4JoNMASIl9shLPFsB5ooO7iDXhCY/dAcCvT/79LwC1s/K2bDnAXcQeJRqwMzzeRt/bua0gLChcDsCDNQNBkEU/qot7o6j0kzETQpuJ40ZnT6xSrUoNWhyseHVz2ikv4n4QA5FSArE5IFlTZ0r3XU1MWODib6NCl3a9dkhSYxgbjo4XLq8sL9j7Ip36YEwMRjMNQazMhf7+RgYNnuyo7bY6ArFaWKuXRX495wLwoLk39sO9RaVnM5OTP8zLSjtjsljpp6ovi6pqr706eE8XBwGUSqEy9Guihf/92TMZhetjI5rJCHwKpBRzZqsNYtKp6KD+Pvv1w5ILdzR3UvD8HA4YefOl7N25JKUPIKuUwIJH7A5of/GJf7oLfrIz2EH786fSss+uKFzOk+8L0mqh6rpbmR0q5YyFGAQBSuHHlcUWxEaZyXfMhFD0Rgt9Oh/SBMiam58HAO+oc4XZMsK/1taT6M6uHjJw8w6VSNfvemM8TbzPlFlwsP5KyzfJeL6kCejXDgo894aASqOZ9O/uHwzq6B3ijhitkzOC7XS7j0g+V3S0vQTDDhYEoZSBobvJ+yXFNZ29gy4lOGmvlDBMIfQqSKV8539EWvXHhvbGHBSFrAwGW+vvxzLoR7RxzrNpsyPs0xcv7/lg1/ZfPtKvuw7MVhulUakWdvRq+XY3tWFT90Bk+52BCOzvyOBgjytSFKAgms+b9F/2o+BbKwUrvgjhhjSjKLAPG4YE7lJxfEIf5dyGOwMXrren/eF0RYXRNMrHDt4QbmjDEbHop9F8rqpddZd3sV6R/aWiabtWr41PW534V8m+PFHW+qSPL9TX7oM8WAaBi4IbE4S8yYNs/7asIgBA0ZStRqFM/MXxIzcgHBEBP+C6DJKLgJvK3uXvniitBsDmNzkSEAD9uv5k0aFjXy1gMQ0DQ5p4CAIwNuXLwyL/ExcpqMWeS42NUmxKXFf8VWPdz6cLnkqhGd/Pe+U1Cow/+ekJUYr4qJgvbik7f/Jw+0J/tjpvS3qxs7/LQZZfcrrkUmOdGI/cgUKIkB8pz0xK+CQjKf6z4MWckYftZqsderfsTInsZt0evDRgMRYMHhaLnk+NW1Y/nchxk5lZ+I/Pf/vl9RvbLYiVlSBcJv/VK9sKBCHc3hkF7D12/NzVltZn8YhzNj/3ev6LGeXTdQ6+uzLZ+C+5XNza05Nsd1gXcNgBvekJK/+du3lTUSiXMzzT80TgkkK8wJAGgCMAE5ooFFz3hHTr+lgZ9iMryOngkoi5WZuOc9hPtDu3r4198nTqygjCr3wYmrvVkSerZXljJoT0m0DcYm5g2Mg5WV39zrVWZZofkzaRnhB/bufm9FI/JpXQXj8F8bHyitqWxhzJmwUJT60SNJER+P+BCZjt34lzNbvickRoWVWNmGzuObnYWhER3oAdX41dPbj1jDeYEwGrInltKKCNtatub6hRfJOEnfJkcc+JgE9ltS/DkINuNI3xCo4fbXgm/0CnouvOcjK4Z/16/ZKia+3+kqIrEIQ+sgNx2Jzb5wsPxrD9GBZv+Gd9BqSXr4icg8cwMj4SLmv6+mlv+WddgGlilOPOZkEmFnrLP+sCVgtXyPHaHShkiw0XXPWWf9YF5Gb9uGzp4sCbj7ai4LkNTx2O5nPV3vLPyTeye6P32X+7KNujVKtSYJg+viEu/mx2etJZCgnD57OPfGRh3n8nfizA15j3Av4XAAD//5k1S2w3zfwVAAAAAElFTkSuQmCC",ne=st.create({baseURL:"./",timeout:3e4,headers:{"Content-Type":"application/json"}});ne.interceptors.request.use(o=>o,o=>Promise.reject(o));ne.interceptors.response.use(o=>o,o=>(console.error("API Error:",o),o.response?console.error("Response error:",o.response.data):o.request?console.error("No response received"):console.error("Request setup error:",o.message),Promise.reject(o)));const mt=at("devices",{state:()=>({devices:[],loading:!1,error:null,selectedDevice:null}),getters:{deviceById:o=>v=>o.devices.find(d=>d.id===v),devicesByType:o=>v=>o.devices.filter(d=>d.entity_type===v),deviceCount:o=>o.devices.length,hasDevices:o=>o.devices.length>0},actions:{async loadDevices(o=!1){this.loading=!0,this.error=null;try{const v=o?`/api/devices/managed?_t=${Date.now()}`:"/api/devices/managed",d=await ne.get(v);this.devices=d.data.devices||[],console.log("ğŸ“¥ Loaded devices:",this.devices),this.devices.forEach(k=>{console.log(`ğŸ“¥ Device "${k.name}":`,{id:k.id,device:k.device,commands:k.commands,commandCount:k.commands?Object.keys(k.commands).length:0})})}catch(v){this.error=v.message,console.error("Error loading devices:",v)}finally{this.loading=!1}},async createDevice(o){this.loading=!0,this.error=null;try{console.log("ğŸª Store: Creating device with data:",o),console.log("ğŸª Store: Device commands being sent:",o.commands);const v={device_name:o.name,device:o.device,area_id:o.area||"",area_name:o.area||"",entity_type:o.entity_type,icon:o.icon,broadlink_entity:o.broadlink_entity,device_type:o.device_type||"broadlink",commands:o.commands||{}};o.device_type==="smartir"&&o.smartir_config&&(v.smartir_config=o.smartir_config),console.log("ğŸª Store: Transformed data for backend:",v);const d=await ne.post("/api/devices/managed",v);return console.log("ğŸª Store: Create response:",d.data),await this.loadDevices(),d.data}catch(v){throw console.error("Error creating device:",v),v}finally{this.loading=!1}},async updateDevice(o,v){this.loading=!0,this.error=null;try{const d=await ne.put(`/api/devices/managed/${o}`,v);return await this.loadDevices(),d.data}catch(d){throw console.error("Error updating device:",d),d}finally{this.loading=!1}},async deleteDevice(o,v=!1){this.loading=!0,this.error=null;try{await ne.delete(`/api/devices/managed/${o}`,{data:{delete_commands:v}}),this.devices=this.devices.filter(d=>d.id!==o)}catch(d){throw this.error=d.message,console.error("Error deleting device:",d),d}finally{this.loading=!1}},selectDevice(o){this.selectedDevice=o},clearSelection(){this.selectedDevice=null},clearError(){this.error=null},async syncAllAreas(){if(!this.devices||this.devices.length===0){console.log("âš ï¸ No devices to sync");return}console.log(`ğŸ”„ Syncing areas from Home Assistant for ${this.devices.length} devices...`);try{const o=await Promise.all(this.devices.map(k=>(console.log(`ğŸ”„ Syncing device: ${k.id} (${k.name})`),ne.post(`/api/devices/${k.id}/sync-area`).then(h=>h.data.success&&h.data.area?(console.log(`âœ… Synced area for ${k.name}: ${h.data.area}`),{status:"synced",device:k.name}):{status:"no_area"}).catch(h=>{var i;return((i=h.response)==null?void 0:i.status)===404?(console.log(`âŒ Device not found in HA: ${k.id}`),{status:"not_found"}):(console.warn(`âš ï¸ Failed to sync area for ${k.id}:`,h.message),{status:"error",error:h.message})})))),v=o.filter(k=>k.status==="synced").length,d=o.filter(k=>k.status==="not_found").length;await this.loadDevices(!0),v>0?console.log(`âœ… Area sync complete: ${v} synced, ${d} not found in HA`):d>0&&console.log(`â„¹ï¸ No areas synced - ${d} entities not found in HA registry (generate entities first)`)}catch(o){console.debug("Area sync error:",o)}}}});function ot(o){const v=J(()=>o.value||o),d=J(()=>{switch(v.value){case"climate":return"mdi:air-conditioner";case"fan":return"mdi:fan";case"light":return"mdi:lightbulb";case"media_player":return"mdi:television";case"switch":return"mdi:light-switch";default:return"mdi:devices"}}),k=J(()=>`device-type-${v.value}-color`),h=J(()=>`tag-${v.value}-bg`);return{icon:d,colorClass:k,tagBgClass:h}}const vt=""+new URL("broadlink-logo-BDjImjRY.png",import.meta.url).href,we=(o,v)=>{const d=o.__vccOpts||o;for(const[k,h]of v)d[k]=h;return d},pt={class:"device-header"},ft={class:"device-info"},gt=["title"],yt={class:"device-labels"},bt={class:"device-type"},ht=["src","alt","title"],kt={class:"device-body"},wt={class:"device-stats"},$t={class:"stat",title:"Learned command count"},Ct={class:"stat",title:"HA Assigned Area"},_t={class:"device-meta"},St={class:"device-id",title:"Device ID"},It={key:0,class:"storage-name"},Dt={key:1,class:"broadlink-entity",title:"Controller Device"},xt={key:2,class:"controller-device"},Tt={class:"device-actions"},Mt=["disabled"],Rt=["disabled"],Lt=["disabled"],At={key:0,class:"disabled-overlay"},Et={__name:"DeviceCard",props:{device:{type:Object,required:!0},broadlinkDevices:{type:Array,default:()=>[]}},emits:["edit","delete","learn"],setup(o){const v=o,d=J(()=>localStorage.getItem("smartir_simulate_not_installed")==="true"),k=J(()=>v.device.device_type==="smartir"&&d.value),h=g(null),i=ot(J(()=>v.device.entity_type)),c=J(()=>v.device.icon?v.device.icon:i.icon.value),f=a=>a&&a.startsWith("mdi:")?`mdi ${a.replace(":"," mdi-")}`:`mdi mdi-${a}`,C=J(()=>({light:"Light",fan:"Fan",switch:"Switch",media_player:"Media Player",cover:"Cover"})[v.device.entity_type]||v.device.entity_type),$=J(()=>(v.device.device_type||"broadlink")==="smartir"?"SmartIR":"Broadlink"),T=J(()=>(v.device.device_type||"broadlink")==="smartir"?Xe:vt),w=J(()=>(v.device.device_type||"broadlink")==="smartir"?h.value!==null?h.value:0:Object.keys(v.device.commands||{}).length),t=a=>{if(!a)return"";const b=v.broadlinkDevices.find(p=>p.entity_id===a);return b&&b.name||a},M=J(()=>{if(!v.device.device)return!1;const a=v.device.id.includes(".")?v.device.id.split(".")[1]:v.device.id;return v.device.device!==a}),G=J(()=>{if(!v.device.broadlink_entity)return"";const a=v.broadlinkDevices.find(b=>b.entity_id===v.device.broadlink_entity);return a&&a.name||v.device.broadlink_entity}),P=a=>{if(!a||typeof a!="object")return 0;let b=0;for(const p of Object.values(a))typeof p=="string"?b++:typeof p=="object"&&(b+=P(p));return b},D=async()=>{if(!(!v.device.device_code||!v.device.entity_type))try{const a=await ne.get("/api/smartir/codes/code",{params:{entity_type:v.device.entity_type,code_id:v.device.device_code}});if(a.data.success&&a.data.code){const b=a.data.code;b.commands&&(h.value=P(b.commands))}}catch(a){console.error("Error fetching SmartIR command count:",a)}};return Re(async()=>{(v.device.device_type||"broadlink")==="smartir"&&await D()}),(a,b)=>(l(),s("div",{class:Y(["device-card",{disabled:k.value}])},[e("div",pt,[e("div",{class:Y(["device-icon",$e(i).colorClass.value])},[e("i",{class:Y(f(c.value))},null,2)],2),e("div",ft,[e("h3",{title:o.device.name},m(o.device.name),9,gt),e("div",yt,[e("span",bt,m(C.value),1)])]),e("img",{src:T.value,alt:$.value,title:$.value,class:"device-source-logo"},null,8,ht)]),e("div",kt,[e("div",wt,[e("div",$t,[b[3]||(b[3]=e("i",{class:"mdi mdi-remote"},null,-1)),e("span",null,m(w.value)+" command"+m(w.value!==1?"s":""),1)]),e("div",Ct,[b[4]||(b[4]=e("i",{class:"mdi mdi-map-marker"},null,-1)),e("span",null,m(o.device.area||"No area"),1)])]),e("div",_t,[e("span",St,[b[5]||(b[5]=e("i",{class:"mdi mdi-identifier"},null,-1)),_(" "+m(o.device.id),1)]),M.value?(l(),s("span",It,[b[6]||(b[6]=e("i",{class:"mdi mdi-code-tags"},null,-1)),_(" "+m(o.device.device),1)])):x("",!0),o.device.broadlink_entity?(l(),s("span",Dt,[b[7]||(b[7]=e("i",{class:"mdi mdi-access-point"},null,-1)),_(" "+m(G.value),1)])):x("",!0),o.device.controller_device?(l(),s("span",xt,[b[8]||(b[8]=e("i",{class:"mdi mdi-access-point"},null,-1)),_(" "+m(t(o.device.controller_device)),1)])):x("",!0)])]),e("div",Tt,[e("button",{onClick:b[0]||(b[0]=p=>!k.value&&a.$emit("learn",o.device)),class:"icon-btn",title:"Manage Commands",disabled:k.value},[...b[9]||(b[9]=[e("i",{class:"mdi mdi-remote-tv"},null,-1)])],8,Mt),e("button",{onClick:b[1]||(b[1]=p=>!k.value&&a.$emit("edit",o.device)),class:"icon-btn",title:"Edit",disabled:k.value},[...b[10]||(b[10]=[e("i",{class:"mdi mdi-pencil"},null,-1)])],8,Rt),e("button",{onClick:b[2]||(b[2]=p=>!k.value&&a.$emit("delete",o.device)),class:"icon-btn danger",title:"Delete",disabled:k.value},[...b[11]||(b[11]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,Lt)]),k.value?(l(),s("div",At,[...b[12]||(b[12]=[e("div",{class:"disabled-message"},[e("i",{class:"mdi mdi-eye-off"}),e("span",null,"SmartIR Not Installed")],-1)])])):x("",!0)],2))}},Ot=we(Et,[["__scopeId","data-v-7a7f5c18"]]),Vt={name:"DeviceListView",props:{devices:{type:Array,required:!0}},methods:{getDeviceCommands(o){return o.commands&&typeof o.commands=="object"?Object.keys(o.commands):[]},sendCommand(o,v){this.$emit("send-command",{device:o,command:v})},editDevice(o){this.$emit("edit-device",o)},deleteDevice(o){this.$emit("delete-device",o)}}},Ut={class:"device-list-view"},Pt={class:"device-table"},Ft={class:"device-info"},jt={class:"device-name"},Nt={class:"device-entity"},Bt={class:"device-area"},Ht={class:"device-type"},qt={class:"device-commands"},zt={key:0,class:"command-list"},Jt=["onClick"],Wt={key:0,class:"no-commands"},Gt={key:1,class:"smartir-info"},Kt={class:"profile-code"},Xt={class:"device-actions"},Yt=["onClick"],Zt=["onClick"];function Qt(o,v,d,k,h,i){return l(),s("div",Ut,[e("table",Pt,[v[2]||(v[2]=e("thead",null,[e("tr",null,[e("th",null,"Device"),e("th",null,"Room/Area"),e("th",null,"Type"),e("th",null,"Commands"),e("th",null,"Actions")])],-1)),e("tbody",null,[(l(!0),s(pe,null,ke(d.devices,c=>(l(),s("tr",{key:c.entity_id,class:"device-row"},[e("td",Ft,[e("div",jt,m(c.friendly_name||c.name),1),e("div",Nt,m(c.entity_id),1)]),e("td",Bt,m(c.area||"No Area"),1),e("td",Ht,[e("span",{class:Y(["type-badge",c.device_type])},m(c.device_type==="smartir"?"SmartIR":"Broadlink"),3)]),e("td",qt,[c.device_type==="broadlink"?(l(),s("div",zt,[(l(!0),s(pe,null,ke(i.getDeviceCommands(c),f=>(l(),s("button",{key:f,class:"command-btn",onClick:C=>i.sendCommand(c,f)},m(f),9,Jt))),128)),i.getDeviceCommands(c).length===0?(l(),s("span",Wt," No commands ")):x("",!0)])):c.device_type==="smartir"?(l(),s("div",Gt,[e("span",Kt,"Profile: "+m(c.device_code),1)])):x("",!0)]),e("td",Xt,[e("button",{class:"action-btn edit",onClick:f=>i.editDevice(c),title:"Edit"},[...v[0]||(v[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})],-1)])],8,Yt),e("button",{class:"action-btn delete",onClick:f=>i.deleteDevice(c),title:"Delete"},[...v[1]||(v[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"3 6 5 6 21 6"}),e("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})],-1)])],8,Zt)])]))),128))])])])}const eo=we(Vt,[["render",Qt],["__scopeId","data-v-952596a6"]]),to={class:"icon-picker"},oo={class:"icon-input-wrapper"},lo=["id","placeholder"],no={key:0,class:"icon-preview"},so={key:0,class:"icon-dropdown"},ao={class:"icon-grid"},io=["onMousedown","title"],ro={__name:"IconPicker",props:{modelValue:{type:String,default:""},inputId:{type:String,default:"icon-input"},placeholder:{type:String,default:"e.g., mdi:television"}},emits:["update:modelValue"],setup(o,{emit:v}){const d=o,k=v,h=g(d.modelValue),i=g(!1),c=["television","speaker","radio","music","video","movie","play","pause","stop","skip-next","skip-previous","volume-high","volume-medium","volume-low","volume-off","remote","remote-tv","cast","chromecast","spotify","netflix","youtube","lightbulb","lightbulb-on","lightbulb-off","lamp","floor-lamp","ceiling-light","light-switch","led-strip","led-strip-variant","wall-sconce","chandelier","spotlight","track-light","vanity-light","desk-lamp","fan","ceiling-fan","air-conditioner","thermometer","thermostat","heat-wave","snowflake","fire","radiator","water-boiler","hvac","blinds","blinds-open","window-shutter","window-shutter-open","curtains","curtains-closed","roller-shade","roller-shade-closed","garage","garage-open","gate","door","door-open","window-open","window-closed","washing-machine","tumble-dryer","dishwasher","refrigerator","stove","microwave","oven","toaster","kettle","coffee","coffee-maker","blender","robot-vacuum","robot-vacuum-variant","vacuum","broom","spray-bottle","lock","lock-open","lock-smart","key","shield","shield-check","alarm-light","bell","doorbell","camera","cctv","motion-sensor","smoke-detector","fire-extinguisher","water-alert","gas-cylinder","sofa","bed","bed-double","desk","chair","table","bookshelf","home","home-outline","home-assistant","floor-plan","room","weather-sunny","weather-night","weather-cloudy","weather-rainy","weather-snowy","weather-lightning","weather-windy","weather-fog","weather-partly-cloudy","umbrella","water","water-percent","phone","cellphone","tablet","laptop","desktop-tower","monitor","keyboard","mouse","printer","router","router-wireless","access-point","wifi","bluetooth","usb","hdmi-port","ethernet","power","power-plug","power-socket","battery","battery-charging","lightning-bolt","flash","solar-panel","solar-power","leaf","tree","flower","sprout","grass","watering-can","shovel","fence","pool","hot-tub","silverware","silverware-fork-knife","food","food-apple","glass-wine","glass-cocktail","bottle-wine","pot","pot-steam","shower","shower-head","bathtub","toilet","sink","faucet","hand-wash","car","car-side","garage-variant","tools","hammer","wrench","screwdriver","toolbox","ladder","heart","heart-pulse","run","walk","bike","dumbbell","yoga","scale-bathroom","thermometer-lines","clock","clock-outline","timer","alarm","calendar","calendar-today","calendar-clock","history","bell-ring","bell-alert","alert","alert-circle","information","help-circle","check","check-circle","close-circle","minus-circle","plus-circle","arrow-up","arrow-down","arrow-left","arrow-right","chevron-up","chevron-down","menu","dots-vertical","dots-horizontal","cog","tune","circle","square","triangle","hexagon","star","star-outline","heart-outline","plus","minus","close","check-bold","eye","eye-off","account","account-group","baby","dog","cat","paw","gift","balloon","party-popper","candle","book","book-open","newspaper","email","message","phone-classic"];ue(()=>d.modelValue,w=>{h.value=w});const f=J(()=>{if(!h.value)return c.slice(0,50);const w=h.value.toLowerCase().replace("mdi:","");return c.filter(t=>t.toLowerCase().includes(w)).slice(0,50)}),C=()=>{i.value=!0,k("update:modelValue",h.value)},$=()=>{setTimeout(()=>{i.value=!1},200)},T=w=>{h.value=`mdi:${w}`,k("update:modelValue",h.value),i.value=!1};return(w,t)=>(l(),s("div",to,[e("div",oo,[W(e("input",{id:o.inputId,"onUpdate:modelValue":t[0]||(t[0]=M=>h.value=M),type:"text",placeholder:o.placeholder,onInput:C,onFocus:t[1]||(t[1]=M=>i.value=!0),onBlur:$},null,40,lo),[[Me,h.value]]),h.value?(l(),s("div",no,[e("i",{class:Y(`mdi mdi-${h.value.replace("mdi:","")}`)},null,2)])):x("",!0)]),i.value&&f.value.length>0?(l(),s("div",so,[e("div",ao,[(l(!0),s(pe,null,ke(f.value,M=>(l(),s("div",{key:M,class:"icon-option",onMousedown:he(G=>T(M),["prevent"]),title:M},[e("i",{class:Y(`mdi mdi-${M}`)},null,2),e("span",null,m(M),1)],40,io))),128))])])):x("",!0)]))}},uo=we(ro,[["__scopeId","data-v-a64f5011"]]),co={key:0,class:"dropdown-label"},mo={key:0,class:"required"},vo=["placeholder","disabled","onKeydown"],po={class:"dropdown-icons"},fo={key:0,class:"mdi mdi-loading mdi-spin"},go={key:2,class:"mdi mdi-chevron-down"},yo={key:1,class:"error-message"},bo={key:2,class:"hint-message"},ho={key:0,class:"dropdown-menu"},ko=["onMousedown","onMouseenter"],wo={class:"option-content"},$o={class:"option-label"},Co={key:0,class:"option-description"},_o={key:0,class:"mdi mdi-check selected-icon"},So={key:3,class:"dropdown-menu"},Io={__name:"SearchableDropdown",props:{modelValue:{type:[String,Number,Object],default:null},options:{type:Array,required:!0,default:()=>[]},label:{type:String,default:""},placeholder:{type:String,default:"Search..."},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},error:{type:String,default:""},hint:{type:String,default:""},optionLabel:{type:String,default:"label"},optionValue:{type:String,default:"value"},optionDescription:{type:String,default:"description"},filterMethod:{type:Function,default:null}},emits:["update:modelValue","change","search"],setup(o,{emit:v}){const d=o,k=v,h=g(null),i=g(null),c=g(""),f=g(!1),C=g(0),$=g(!1),T=A=>typeof A=="string"||typeof A=="number"?A:A[d.optionLabel]||A.label||A.name||String(A),w=A=>typeof A=="string"||typeof A=="number"?A:A[d.optionValue]||A.value||A.id||A,t=A=>typeof A=="string"||typeof A=="number"?"":A[d.optionDescription]||A.description||"",M=A=>{const N=w(A);return typeof d.modelValue=="object"?w(d.modelValue)===N:d.modelValue===N},G=J(()=>{if(!c.value)return d.options;if(d.filterMethod)return d.options.filter(N=>d.filterMethod(N,c.value));const A=c.value.toLowerCase();return d.options.filter(N=>{const le=T(N).toLowerCase(),me=t(N).toLowerCase();return le.includes(A)||me.includes(A)})}),P=J(()=>{if(!d.modelValue)return"";const A=d.options.find(N=>{const le=w(N);return typeof d.modelValue=="object"?le===w(d.modelValue):le===d.modelValue});return A?T(A):""});ue(()=>d.modelValue,A=>{$.value||(c.value=P.value)}),ue(()=>d.options,()=>{!$.value&&d.modelValue&&(c.value=P.value)},{deep:!0}),ue(c,A=>{k("search",A),C.value=0}),Re(()=>{c.value=P.value});const D=()=>{var A;$.value=!0,f.value=!0,(A=i.value)==null||A.select()},a=()=>{$.value=!1,setTimeout(()=>{f.value=!1,d.modelValue?c.value=P.value:c.value=""},200)},b=()=>{var A;f.value=!1,(A=i.value)==null||A.blur()},p=A=>{const N=w(A);k("update:modelValue",N),k("change",N,A),c.value=T(A),b()},E=()=>{var A;k("update:modelValue",null),k("change",null,null),c.value="",(A=i.value)==null||A.focus()},z=()=>{if(!f.value){f.value=!0;return}C.value<G.value.length-1&&C.value++},j=()=>{C.value>0&&C.value--},ee=()=>{G.value.length>0&&C.value>=0&&p(G.value[C.value])},ie=A=>{h.value&&!h.value.contains(A.target)&&(f.value=!1,d.modelValue?c.value=P.value:c.value="")};return Re(()=>{document.addEventListener("click",ie)}),We(()=>{document.removeEventListener("click",ie)}),(A,N)=>(l(),s("div",{class:"searchable-dropdown",ref_key:"dropdownRef",ref:h},[o.label?(l(),s("label",co,[_(m(o.label)+" ",1),o.required?(l(),s("span",mo,"*")):x("",!0)])):x("",!0),e("div",{class:Y(["dropdown-input-wrapper",{"has-error":o.error,disabled:o.disabled}])},[W(e("input",{ref_key:"inputRef",ref:i,type:"text","onUpdate:modelValue":N[0]||(N[0]=le=>c.value=le),placeholder:o.placeholder,disabled:o.disabled||o.loading,onFocus:D,onBlur:a,onKeydown:[Ne(he(z,["prevent"]),["down"]),Ne(he(j,["prevent"]),["up"]),Ne(he(ee,["prevent"]),["enter"]),Ne(b,["escape"])],class:"dropdown-input"},null,40,vo),[[Me,c.value]]),e("div",po,[o.loading?(l(),s("i",fo)):o.modelValue&&!o.disabled?(l(),s("i",{key:1,class:"mdi mdi-close-circle clear-icon",onClick:E})):(l(),s("i",go))])],2),o.error?(l(),s("div",yo,m(o.error),1)):x("",!0),o.hint&&!o.error?(l(),s("div",bo,m(o.hint),1)):x("",!0),be(Qe,{name:"dropdown"},{default:Ge(()=>[f.value&&G.value.length>0?(l(),s("div",ho,[(l(!0),s(pe,null,ke(G.value,(le,me)=>(l(),s("div",{key:w(le),class:Y(["dropdown-item",{highlighted:me===C.value,selected:M(le)}]),onMousedown:he(ce=>p(le),["prevent"]),onMouseenter:ce=>C.value=me},[e("div",wo,[e("div",$o,m(T(le)),1),t(le)?(l(),s("div",Co,m(t(le)),1)):x("",!0)]),M(le)?(l(),s("i",_o)):x("",!0)],42,ko))),128))])):x("",!0)]),_:1}),f.value&&G.value.length===0&&!o.loading?(l(),s("div",So,[...N[1]||(N[1]=[e("div",{class:"dropdown-item no-results"},[e("i",{class:"mdi mdi-magnify"}),_(" No results found ")],-1)])])):x("",!0)],512))}},ze=we(Io,[["__scopeId","data-v-679ce35f"]]),Do={class:"smartir-selector"},xo={class:"form-group"},To={class:"form-group"},Mo={class:"form-group"},Ro=["value"],Lo={key:0,class:"error-message"},Ao={class:"form-group"},Eo={class:"form-group"},Oo={key:1,class:"code-info"},Vo={class:"info-content"},Uo={class:"info-row"},Po={class:"info-value"},Fo={class:"info-row"},jo={class:"info-value"},No={key:0,class:"info-row"},Bo={class:"info-value"},Ho={class:"info-row"},qo={class:"info-value"},zo={__name:"SmartIRDeviceSelector",props:{entityType:{type:String,required:!0},modelValue:{type:Object,default:()=>({})},broadlinkDevices:{type:Array,default:()=>[]}},emits:["update:modelValue","change"],setup(o,{expose:v,emit:d}){const k=o,h=d,i=g([]),c=g([]),f=g(""),C=g(""),$=g(""),T=g(""),w=g(""),t=g(null),M=g(!1),G=g(!1),P=g({manufacturer:"",model:"",controller:""});Re(async()=>{if(await D(),k.modelValue&&(f.value=k.modelValue.manufacturer||"",C.value=k.modelValue.device_code||"",$.value=k.modelValue.controller_device||"",T.value=k.modelValue.temperature_sensor||"",w.value=k.modelValue.humidity_sensor||"",f.value&&(await a(f.value),C.value&&c.value.length>0))){const A=c.value.find(N=>N.code===C.value);A&&(t.value={code:A.code,manufacturer:f.value,models:A.models,controller:A.controller})}}),ue(()=>k.entityType,async A=>{A&&(f.value="",C.value="",c.value=[],t.value=null,await D())});const D=async()=>{if(k.entityType){M.value=!0,P.value.manufacturer="";try{const A=await ne.get("/api/smartir/codes/manufacturers",{params:{entity_type:k.entityType}});if(A.data.success)i.value=A.data.manufacturers||[];else throw new Error(A.data.error||"Failed to load manufacturers")}catch(A){console.error("Error loading manufacturers:",A),P.value.manufacturer="Failed to load manufacturers. Please try again.",i.value=[]}finally{M.value=!1}}},a=async A=>{if(!(!A||!k.entityType)){G.value=!0,P.value.model="";try{const N=await ne.get("/api/smartir/codes/models",{params:{entity_type:k.entityType,manufacturer:A}});if(N.data.success){const le=N.data.models||[];c.value=le.map(me=>{const ce=me.models&&me.models.length>0?me.models.join(", "):`Code ${me.code}`;return{code:me.code,label:ce,description:`Code: ${me.code}`,models:me.models,controller:me.controller}})}else throw new Error(N.data.error||"Failed to load models")}catch(N){console.error("Error loading models:",N),P.value.model="Failed to load models. Please try again.",c.value=[]}finally{G.value=!1}}},b=async A=>{f.value=A,C.value="",t.value=null,c.value=[],A&&await a(A),ee()},p=()=>{const A=c.value.find(N=>N.code===C.value);A&&(t.value={code:A.code,manufacturer:f.value,models:A.models,controller:A.controller}),ee()},E=()=>{ee()},z=()=>{ee()},j=()=>{ee()},ee=()=>{var N,le;const A={manufacturer:f.value,model:((le=(N=t.value)==null?void 0:N.models)==null?void 0:le[0])||"",device_code:C.value,controller_device:$.value};k.entityType==="climate"&&(T.value&&(A.temperature_sensor=T.value),w.value&&(A.humidity_sensor=w.value)),h("update:modelValue",A),h("change",A)};return v({validate:()=>{let A=!0;return P.value={manufacturer:"",model:"",controller:""},f.value||(P.value.manufacturer="Manufacturer is required",A=!1),C.value||(P.value.model="Model is required",A=!1),$.value||(P.value.controller="Broadlink controller is required",A=!1),A}}),(A,N)=>(l(),s("div",Do,[e("div",xo,[be(ze,{modelValue:f.value,"onUpdate:modelValue":N[0]||(N[0]=le=>f.value=le),options:i.value,label:"Manufacturer",placeholder:"Search manufacturers...",required:"",loading:M.value,error:P.value.manufacturer,hint:"Select the device manufacturer",onChange:b},null,8,["modelValue","options","loading","error"])]),e("div",To,[be(ze,{modelValue:C.value,"onUpdate:modelValue":N[1]||(N[1]=le=>C.value=le),options:c.value,"option-label":"label","option-value":"code","option-description":"description",label:"Model",placeholder:"Search models...",required:"",disabled:!f.value,loading:G.value,error:P.value.model,hint:"Select the device model",onChange:p},null,8,["modelValue","options","disabled","loading","error"])]),e("div",Mo,[N[6]||(N[6]=e("label",{for:"controller-device"},[e("i",{class:"mdi mdi-remote"}),_(" Controller Device * ")],-1)),W(e("select",{id:"controller-device","onUpdate:modelValue":N[2]||(N[2]=le=>$.value=le),required:"",onChange:E},[N[5]||(N[5]=e("option",{value:""},"-- Select Controller Device --",-1)),(l(!0),s(pe,null,ke(o.broadlinkDevices,le=>(l(),s("option",{key:le.entity_id,value:le.entity_id},[_(m(le.name||le.entity_id)+" ",1),le.area_name?(l(),s(pe,{key:0},[_(" - "+m(le.area_name),1)],64)):x("",!0)],8,Ro))),128))],544),[[Se,$.value]]),N[7]||(N[7]=e("small",null,"Which remote device will send the IR/RF commands",-1)),P.value.controller?(l(),s("div",Lo,m(P.value.controller),1)):x("",!0)]),o.entityType==="climate"?(l(),s(pe,{key:0},[e("div",Ao,[N[8]||(N[8]=e("label",{for:"temperature-sensor"},"Temperature Sensor",-1)),W(e("input",{id:"temperature-sensor","onUpdate:modelValue":N[3]||(N[3]=le=>T.value=le),type:"text",placeholder:"e.g., sensor.living_room_temperature",onInput:z},null,544),[[Me,T.value]]),N[9]||(N[9]=e("small",null,"Optional: Temperature sensor entity for current temperature",-1))]),e("div",Eo,[N[10]||(N[10]=e("label",{for:"humidity-sensor"},"Humidity Sensor",-1)),W(e("input",{id:"humidity-sensor","onUpdate:modelValue":N[4]||(N[4]=le=>w.value=le),type:"text",placeholder:"e.g., sensor.living_room_humidity",onInput:j},null,544),[[Me,w.value]]),N[11]||(N[11]=e("small",null,"Optional: Humidity sensor entity for current humidity",-1))])],64)):x("",!0),t.value?(l(),s("div",Oo,[N[16]||(N[16]=e("div",{class:"info-header"},[e("i",{class:"mdi mdi-information"}),e("span",null,"Selected Device Code")],-1)),e("div",Vo,[e("div",Uo,[N[12]||(N[12]=e("span",{class:"info-label"},"Code ID:",-1)),e("span",Po,m(t.value.code_id),1)]),e("div",Fo,[N[13]||(N[13]=e("span",{class:"info-label"},"Manufacturer:",-1)),e("span",jo,m(t.value.manufacturer),1)]),t.value.models&&t.value.models.length>0?(l(),s("div",No,[N[14]||(N[14]=e("span",{class:"info-label"},"Supported Models:",-1)),e("span",Bo,m(t.value.models.join(", ")),1)])):x("",!0),e("div",Ho,[N[15]||(N[15]=e("span",{class:"info-label"},"Controller:",-1)),e("span",qo,m(t.value.controller||"Broadlink"),1)])])])):x("",!0)]))}},Jo=we(zo,[["__scopeId","data-v-1911c8f6"]]),Wo={class:"modal-content"},Go={class:"modal-header"},Ko={class:"input-wrapper"},Xo={key:0,class:"validation-tooltip"},Yo={class:"input-wrapper"},Zo=["disabled"],Qo={key:0,class:"validation-tooltip"},el={key:0,class:"smartir-notice"},tl={key:0,class:"notice-success"},ol={key:1,class:"notice-warning"},ll={key:1,class:"smartir-notice"},nl={key:2},sl={class:"form-group"},al=["disabled"],il=["disabled"],rl={key:0},dl={key:1},ul={key:2},cl={key:3},ml={key:0,class:"form-group"},vl={class:"area-display-readonly"},pl=["value"],fl=["disabled"],gl=["href"],yl={key:1,class:"form-group"},bl={class:"form-group"},hl={class:"input-wrapper"},kl=["value"],wl=["value"],$l={key:2,class:"validation-tooltip"},Cl={key:0},_l={key:1},Sl={key:3,class:"smartir-section"},Il={class:"modal-footer"},Dl={type:"submit",form:"device-form",class:"btn btn-primary"},xl={__name:"DeviceForm",props:{device:{type:Object,default:null}},emits:["save","cancel"],setup(o,{emit:v}){const d=o,k=v,h=Te("smartirStatus"),i=Te("smartirEnabled"),c=J(()=>{var u;return localStorage.getItem("smartir_simulate_not_installed")==="true"?!1:((u=h==null?void 0:h.value)==null?void 0:u.installed)||!1}),f=J(()=>!!d.device),C=J(()=>["climate","media_player","fan","light"].includes(t.value.entity_type)),$=J(()=>c.value?!C.value&&t.value.entity_type?"(Not supported for this type)":"(Pre-configured Codes)":"(Requires SmartIR)"),T=J(()=>{var u;const S=((u=d.device)==null?void 0:u.commands)||{};return Object.keys(S).length>0}),w=J(()=>{if(!t.value.broadlink_entity)return"";const S=a.value.find(u=>u.entity_id===t.value.broadlink_entity);return S&&S.name||t.value.broadlink_entity}),t=g({name:"",entity_type:"",device_type:"broadlink",device:"",area:"",icon:"",broadlink_entity:"",enabled:!0,commands:{}}),M=g({name:"",entity_type:"",broadlink_entity:""}),G=g({}),P=g(null),D=g([]),a=g([]),b=g(null),p=g(null),E=g(null),z=g(!1);Re(async()=>{d.device&&(t.value={...d.device,device_type:d.device.device_type||"broadlink"},t.value.device_type==="smartir"&&(G.value={manufacturer:d.device.manufacturer,model:d.device.model,device_code:d.device.device_code,controller_device:d.device.controller_device,temperature_sensor:d.device.temperature_sensor,humidity_sensor:d.device.humidity_sensor})),await Promise.all([j(),ee()])});const j=async()=>{try{const S=await ne.get("/api/areas");D.value=S.data.areas||[]}catch(S){console.error("Error loading areas:",S),D.value=[]}},ee=async()=>{try{const u=(await ne.get("/api/remote/devices")).data.devices||[];a.value=u,console.log("Loaded remote devices:",u)}catch(S){console.error("Error loading remote devices:",S),a.value=[]}},ie=S=>{if(!S)return"";const u=S.toLowerCase();for(const V of D.value){const ye=V.toLowerCase();if(u.includes(ye))return V}return""},A=(S,u="")=>{const V=u.toLowerCase();return V.includes("tv")?"mdi:television":V.includes("lamp")?"mdi:lamp":V.includes("ceiling")?"mdi:ceiling-light":V.includes("floor")?"mdi:floor-lamp":V.includes("desk")?"mdi:desk-lamp":V.includes("fan")?"mdi:fan":V.includes("ac")||V.includes("air con")?"mdi:air-conditioner":V.includes("heater")?"mdi:radiator":V.includes("blind")?"mdi:blinds":V.includes("curtain")?"mdi:curtains":V.includes("garage")?"mdi:garage":V.includes("speaker")||V.includes("stereo")?"mdi:speaker":V.includes("receiver")?"mdi:audio-video":{light:"mdi:lightbulb",fan:"mdi:fan",switch:"mdi:light-switch",media_player:"mdi:television",cover:"mdi:window-shutter",climate:"mdi:thermostat"}[S]||"mdi:devices"};ue(()=>t.value.name,S=>{if(!f.value&&S&&!t.value.area){const u=ie(S);u&&(t.value.area=u)}!f.value&&S&&t.value.entity_type&&(z.value||!t.value.icon)&&(t.value.icon=A(t.value.entity_type,S),z.value=!0)}),ue(()=>t.value.entity_type,S=>{!f.value&&S&&(z.value||!t.value.icon)&&(t.value.icon=A(S,t.value.name),z.value=!0)}),ue(()=>t.value.icon,(S,u)=>{u!==void 0&&S!==u&&!z.value&&(z.value=!1),S||(z.value=!1)});const N=g(!1),le=async()=>{var S;if((S=d.device)!=null&&S.id){N.value=!0;try{const u=await ne.post(`/api/devices/${d.device.id}/sync-area`);u.data.success?(t.value.area=u.data.area||"",u.data.area?console.log(`Area synced: ${u.data.area}`):console.log("No area assigned in Home Assistant")):console.warn(u.data.message||"Entity not found in HA")}catch(u){console.error("Failed to sync area:",u)}finally{N.value=!1}}},me=()=>{var V;return!((V=d.device)!=null&&V.id)||!t.value.entity_type?"#":`/config/entities/entity/${`${t.value.entity_type}.${d.device.id}`}`},ce=()=>{M.value={name:"",entity_type:"",broadlink_entity:""};let S=!0;return(!t.value.name||t.value.name.trim()==="")&&(M.value.name="Device name is required",S=!1),t.value.entity_type||(M.value.entity_type="Entity type is required",S=!1),t.value.device_type==="broadlink"&&!t.value.broadlink_entity&&(M.value.broadlink_entity="Broadlink device is required",S=!1),S},De=S=>{M.value[S]=""},Le=async()=>{if(t.value.device_type==="smartir"){if(P.value&&!P.value.validate())return;const S={...t.value,smartir_config:{manufacturer:G.value.manufacturer,model:G.value.model,code_id:G.value.device_code,controller_device:G.value.controller_device}};k("save",S)}else{if(!ce())return;k("save",{...t.value})}},xe=S=>{G.value=S};return(S,u)=>(l(),s("div",{class:"modal-overlay",onClick:u[11]||(u[11]=he(V=>S.$emit("cancel"),["self"]))},[e("div",Wo,[e("div",Go,[e("h2",null,m(f.value?"Edit Device":"Add New Device"),1),e("button",{onClick:u[0]||(u[0]=V=>S.$emit("cancel")),class:"close-btn"},[...u[12]||(u[12]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("form",{id:"device-form",onSubmit:he(Le,["prevent"]),class:"modal-body"},[e("div",{class:Y(["form-group",{"has-error":M.value.name}])},[u[14]||(u[14]=e("label",{for:"device-name"},"Device Name *",-1)),e("div",Ko,[W(e("input",{id:"device-name",ref_key:"nameInput",ref:b,"onUpdate:modelValue":u[1]||(u[1]=V=>t.value.name=V),type:"text",placeholder:"e.g., Living Room TV",onInput:u[2]||(u[2]=V=>De("name"))},null,544),[[Me,t.value.name]]),M.value.name?(l(),s("div",Xo,[u[13]||(u[13]=e("i",{class:"mdi mdi-alert"},null,-1)),_(" "+m(M.value.name),1)])):x("",!0)]),u[15]||(u[15]=e("small",null,"Friendly name for this device",-1))],2),e("div",{class:Y(["form-group",{"has-error":M.value.entity_type}])},[u[23]||(u[23]=e("label",{for:"entity-type"},"Entity Type *",-1)),e("div",Yo,[W(e("select",{id:"entity-type",ref_key:"typeSelect",ref:p,"onUpdate:modelValue":u[3]||(u[3]=V=>t.value.entity_type=V),onChange:u[4]||(u[4]=V=>De("entity_type"))},[u[16]||(u[16]=Ue('<option value="" data-v-94bc1fe5>-- Select Type --</option><option value="light" data-v-94bc1fe5>ğŸ’¡ Light</option><option value="fan" data-v-94bc1fe5>ğŸŒ€ Fan</option><option value="switch" data-v-94bc1fe5>ğŸ”Œ Switch</option><option value="media_player" data-v-94bc1fe5>ğŸ“º Media Player</option><option value="cover" data-v-94bc1fe5>ğŸªŸ Cover (Blinds/Curtains)</option>',6)),e("option",{value:"climate",disabled:!c.value}," ğŸŒ¡ï¸ Climate "+m(c.value?"":"(Requires SmartIR)"),9,Zo)],544),[[Se,t.value.entity_type]]),M.value.entity_type?(l(),s("div",Qo,[u[17]||(u[17]=e("i",{class:"mdi mdi-alert"},null,-1)),_(" "+m(M.value.entity_type),1)])):x("",!0)]),t.value.entity_type==="climate"?(l(),s("div",el,[c.value?(l(),s("div",tl,[...u[18]||(u[18]=[e("i",{class:"mdi mdi-check-circle"},null,-1),e("span",null,"SmartIR detected! Climate entities will be created via SmartIR profiles.",-1)])])):(l(),s("div",ol,[...u[19]||(u[19]=[e("i",{class:"mdi mdi-alert"},null,-1),e("div",null,[e("strong",null,"SmartIR Required"),e("p",null,"Climate entities (AC, heaters) require SmartIR integration."),e("a",{href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"smartir-link"}," Install SmartIR â†’ ")],-1)])]))])):c.value&&["media_player","fan","light"].includes(t.value.entity_type)?(l(),s("div",ll,[...u[20]||(u[20]=[e("div",{class:"notice-info"},[e("i",{class:"mdi mdi-information"}),e("span",null,"ğŸ’¡ SmartIR available! You can use pre-configured codes or learn your own.")],-1)])])):!c.value&&t.value.entity_type?(l(),s("small",nl,[u[21]||(u[21]=_(" ğŸ’¡ Tip: Install ",-1)),u[22]||(u[22]=e("a",{href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"inline-link"},"SmartIR",-1)),_(" for pre-configured "+m(t.value.entity_type==="climate"?"climate":t.value.entity_type)+" device codes ",1)])):x("",!0)],2),e("div",sl,[u[26]||(u[26]=e("label",{for:"device-type"},"Device Type *",-1)),W(e("select",{id:"device-type","onUpdate:modelValue":u[5]||(u[5]=V=>t.value.device_type=V),required:"",disabled:f.value},[u[24]||(u[24]=e("option",{value:""},"-- Select Device Type --",-1)),u[25]||(u[25]=e("option",{value:"broadlink"},"ğŸ“¡ Broadlink Device (Learn IR Codes)",-1)),$e(i)?(l(),s("option",{key:0,value:"smartir",disabled:!c.value||!C.value}," ğŸŒ SmartIR Device "+m($.value),9,il)):x("",!0)],8,al),[[Se,t.value.device_type]]),f.value?(l(),s("small",rl,"Cannot change device type after creation")):t.value.device_type==="smartir"?(l(),s("small",dl,"Using pre-configured codes from SmartIR repository")):t.value.device_type==="broadlink"?(l(),s("small",ul,"Learn and store your own IR codes")):(l(),s("small",cl,"Choose how to configure this device"))]),f.value?(l(),s("div",ml,[u[29]||(u[29]=e("label",{for:"device-area"},"Area",-1)),e("div",vl,[e("input",{id:"device-area",value:t.value.area||"Not assigned",type:"text",readonly:"",class:"readonly-input"},null,8,pl),e("button",{type:"button",onClick:le,disabled:N.value,class:"sync-area-btn",title:"Sync area from Home Assistant"},[e("i",{class:Y(N.value?"mdi mdi-loading mdi-spin":"mdi mdi-refresh")},null,2)],8,fl)]),e("small",null,[u[27]||(u[27]=e("i",{class:"mdi mdi-information-outline"},null,-1)),u[28]||(u[28]=_(" Set area in Home Assistant, then click sync. ",-1)),e("a",{href:me(),target:"_blank",class:"inline-link"},"Open in HA â†’",8,gl)])])):(l(),s("div",yl,[...u[30]||(u[30]=[e("div",{class:"info-notice"},[e("i",{class:"mdi mdi-information-outline"}),e("span",null,[e("strong",null,"Area Assignment:"),_(" After generating entities and restarting Home Assistant, you can assign areas in HA and sync them here.")])],-1)])])),e("div",bl,[u[31]||(u[31]=e("label",{for:"device-icon"},"Icon",-1)),be(uo,{modelValue:t.value.icon,"onUpdate:modelValue":u[6]||(u[6]=V=>t.value.icon=V),inputId:"device-icon",placeholder:"e.g., mdi:television"},null,8,["modelValue"]),u[32]||(u[32]=e("small",null,"Optional: Material Design Icon name",-1))]),t.value.device_type==="broadlink"?(l(),s("div",{key:2,class:Y(["form-group",{"has-error":M.value.broadlink_entity}])},[u[35]||(u[35]=e("label",{for:"broadlink-entity"},"Remote Device *",-1)),e("div",hl,[!f.value||!T.value?W((l(),s("select",{key:0,id:"broadlink-entity",ref_key:"broadlinkSelect",ref:E,"onUpdate:modelValue":u[7]||(u[7]=V=>t.value.broadlink_entity=V),onChange:u[8]||(u[8]=V=>De("broadlink_entity"))},[u[33]||(u[33]=e("option",{value:""},"-- Select Remote Device --",-1)),(l(!0),s(pe,null,ke(a.value,V=>(l(),s("option",{key:V.entity_id,value:V.entity_id},[_(m(V.name||V.entity_id)+" ",1),V.area_name?(l(),s(pe,{key:0},[_(" - "+m(V.area_name),1)],64)):x("",!0)],8,kl))),128))],544)),[[Se,t.value.broadlink_entity]]):(l(),s("input",{key:1,id:"broadlink-entity",value:w.value,type:"text",readonly:"",disabled:""},null,8,wl)),M.value.broadlink_entity?(l(),s("div",$l,[u[34]||(u[34]=e("i",{class:"mdi mdi-alert"},null,-1)),_(" "+m(M.value.broadlink_entity),1)])):x("",!0)]),!f.value||!T.value?(l(),s("small",Cl,"Required: Select which remote device to use for sending commands")):(l(),s("small",_l,"Cannot change remote device after commands are learned"))],2)):x("",!0),t.value.device_type==="smartir"?(l(),s("div",Sl,[u[36]||(u[36]=e("div",{class:"section-header"},[e("i",{class:"mdi mdi-cloud-download"}),e("span",null,"SmartIR Device Configuration")],-1)),be(Jo,{ref_key:"smartirSelector",ref:P,"entity-type":t.value.entity_type,modelValue:G.value,"onUpdate:modelValue":u[9]||(u[9]=V=>G.value=V),"broadlink-devices":a.value,onChange:xe},null,8,["entity-type","modelValue","broadlink-devices"])])):x("",!0)],32),e("div",Il,[e("button",{type:"button",onClick:u[10]||(u[10]=V=>S.$emit("cancel")),class:"btn btn-secondary"}," Cancel "),e("button",Dl,[u[37]||(u[37]=e("i",{class:"mdi mdi-check"},null,-1)),_(" "+m(f.value?"Update":"Create"),1)])])])]))}},Tl=we(xl,[["__scopeId","data-v-94bc1fe5"]]),Ml={class:"modal-header"},Rl={class:"modal-body"},Ll={class:"message-text"},Al={key:0,class:"checkbox-option"},El={class:"modal-footer"},Ol=["disabled"],Vl={__name:"ConfirmDialog",props:{isOpen:{type:Boolean,default:!1},title:{type:String,default:"Confirm"},message:{type:String,required:!0},confirmText:{type:String,default:"OK"},cancelText:{type:String,default:"Cancel"},showCancel:{type:Boolean,default:!0},dangerMode:{type:Boolean,default:!1},confirmDisabled:{type:Boolean,default:!1},checkboxLabel:{type:String,default:""}},emits:["confirm","cancel"],setup(o,{emit:v}){const d=o,k=v,h=g(!1);ue(()=>d.isOpen,f=>{f&&(h.value=!1)});const i=()=>{k("confirm",h.value)},c=()=>{k("cancel")};return(f,C)=>o.isOpen?(l(),s("div",{key:0,class:"modal-overlay",onClick:he(c,["self","stop"])},[e("div",{class:"modal-dialog confirm-dialog",onClick:C[1]||(C[1]=he(()=>{},["stop"]))},[e("div",Ml,[e("h2",null,m(o.title),1)]),e("div",Rl,[e("p",Ll,m(o.message),1),o.checkboxLabel?(l(),s("div",Al,[e("label",null,[W(e("input",{type:"checkbox","onUpdate:modelValue":C[0]||(C[0]=$=>h.value=$)},null,512),[[ge,h.value]]),e("span",null,m(o.checkboxLabel),1)])])):x("",!0)]),e("div",El,[o.showCancel?(l(),s("button",{key:0,onClick:he(c,["stop"]),class:"btn btn-secondary"},m(o.cancelText),1)):x("",!0),o.confirmText?(l(),s("button",{key:1,onClick:he(i,["stop"]),class:Y(["btn",o.dangerMode?"btn-danger":"btn-primary"]),disabled:o.confirmDisabled},m(o.confirmText),11,Ol)):x("",!0)])])])):x("",!0)}},Ve=we(Vl,[["__scopeId","data-v-9cea6cb3"]]),Ul={class:"modal-content"},Pl={class:"modal-header"},Fl={class:"modal-body"},jl={key:0,class:"smartir-info"},Nl={key:0,class:"climate-note"},Bl={class:"form-group"},Hl=["value"],ql={class:"form-group"},zl=["disabled"],Jl={label:"Suggested Commands"},Wl=["value"],Gl=["disabled"],Kl={class:"form-group"},Xl={class:"radio-group"},Yl={class:"radio-label"},Zl=["disabled"],Ql={class:"radio-label"},en=["disabled"],tn={class:"learn-action"},on=["disabled"],ln={key:0,class:"mdi mdi-loading mdi-spin"},nn={key:1,class:"mdi mdi-remote-tv"},sn={key:0,class:"learning-status"},an={key:0},rn={key:1,class:"rf-instructions"},dn={key:1,class:"result-message success"},un={key:2,class:"section-divider"},cn={key:3,class:"loading-commands"},mn={key:4,class:"learned-commands"},vn={class:"command-list"},pn={class:"command-info"},fn={class:"command-name"},gn={class:"command-right"},yn=["title"],bn={class:"command-actions"},hn=["onClick","disabled"],kn=["onClick"],wn={key:5,class:"untracked-commands"},$n={class:"command-list"},Cn={class:"command-name"},_n={class:"modal-footer"},Sn=["disabled"],In={__name:"CommandLearner",props:{device:{type:Object,required:!0}},emits:["cancel","learned"],setup(o,{emit:v}){const d=o,k=v,h=g([]),i=g(""),c=g(""),f=g(""),C=g("ir"),$=g(!1),T=g(""),w=g("success"),t=g([]),M=g([]),G=g(!1),P=g(!1),D=g(""),a=g(!1),b=g(null),p=g(null),E=g(""),z=g(""),j=J(()=>d.device.device_type==="smartir");J(()=>{if(j.value)return!1;const H=c.value==="__custom__"?f.value:c.value;return i.value&&H.trim()});const ee=()=>{b.value&&b.value.setCustomValidity("")},ie=()=>{p.value&&p.value.setCustomValidity("")},A=J(()=>{const H=h.value.find(R=>R.entity_id===i.value);return H?H.name||H.entity_id:i.value}),N={light:["turn_on","turn_off","toggle","brightness_up","brightness_down","dim","bright"],fan:["turn_on","turn_off","toggle","speed_low","speed_medium","speed_high","speed_1","speed_2","speed_3","speed_4","speed_5","oscillate_on","oscillate_off","direction_forward","direction_reverse"],switch:["turn_on","turn_off","toggle"],media_player:["turn_on","turn_off","toggle","volume_up","volume_down","volume_mute","play","pause","stop","play_pause","next_track","previous_track","channel_up","channel_down","source_hdmi1","source_hdmi2","source_hdmi3","source_tv","source_aux","source_bluetooth","menu","home","back","select","arrow_up","arrow_down","arrow_left","arrow_right"],cover:["open","close","stop","open_tilt","close_tilt","position_0","position_25","position_50","position_75","position_100"]},le=J(()=>{const H=d.device.entity_type||"switch";return N[H]||N.switch});Re(async()=>{await me();try{console.log("ğŸ”„ Syncing command types...");const R=await ne.post("/api/commands/sync");console.log("âœ… Command types synced:",R.data)}catch(R){console.error("âš ï¸ Failed to sync command types:",R)}const H=!j.value;console.log(`ğŸ“‹ Will ${H?"FORCE RELOAD":"use cached"} commands`),await ce(H),b.value&&(b.value.setCustomValidity(""),b.value.oninvalid=()=>{b.value.setCustomValidity("Command name is required")}),d.device.broadlink_entity&&(i.value=d.device.broadlink_entity)}),ue(c,async H=>{H==="__custom__"&&(await et(),p.value&&(p.value.setCustomValidity(""),p.value.oninvalid=()=>{p.value.setCustomValidity("Custom command name is required")}))});const me=async()=>{try{const H=await ne.get("/api/broadlink/devices");h.value=H.data.devices||[]}catch(H){console.error("Error loading Broadlink devices:",H)}},ce=async(H=!1)=>{var R,Q;G.value=!0;try{if(j.value){const se=await ne.get("/api/smartir/codes/code",{params:{entity_type:d.device.entity_type,code_id:d.device.device_code}});if(se.data.success&&se.data.code){const I=se.data.code.commands||{},n=se.data.code.commandType||"ir";if(d.device.entity_type==="climate"){const X=[];for(const[q,ae]of Object.entries(I))typeof ae=="string"?X.push({name:q,type:n}):typeof ae=="object"&&ae!==null&&Object.keys(ae).sort((r,F)=>parseInt(r)-parseInt(F)).forEach(r=>{X.push({name:`${q}_${r}`,type:n,label:`${q.charAt(0).toUpperCase()+q.slice(1)} ${r}Â°C`})});t.value=X}else t.value=Object.keys(I).map(X=>({name:X,type:n}))}}else{if(console.log("ğŸ“‹ Loading commands for device:",d.device),console.log("ğŸ“‹ Device ID:",d.device.id),console.log("ğŸ“‹ Force reload:",H),H&&d.device.id){console.log("ğŸ”„ Force reloading commands from API after sync");try{const I=(await ne.get(`/api/commands/${d.device.id}`)).data.commands||{};console.log("ğŸ“¦ Raw commands from API:",I),t.value=Object.entries(I).map(([n,X])=>{console.log(`  Command '${n}':`,X,`(type: ${typeof X})`);const q=typeof X=="object"&&X!==null&&(X.command_type||X.type)||"ir";return{name:n,type:q}}),console.log("ğŸ“‹ Reloaded commands:",t.value)}catch(se){if(console.error("âŒ Error loading commands:",se),((R=se.response)==null?void 0:R.status)===404)console.log("â„¹ï¸ No commands found for device"),t.value=[];else throw se}}else if(d.device.commands&&Object.keys(d.device.commands).length>0)console.log("âœ… Using commands from device object"),t.value=Object.entries(d.device.commands).map(([se,I])=>({name:se,type:I.command_type||I.type||"ir"}));else if(d.device.commands!==void 0)console.log("â„¹ï¸ Device has empty commands object - skipping API call"),t.value=[];else if(d.device.id){console.log("ğŸŒ Fetching commands from API for device ID:",d.device.id);try{const I=(await ne.get(`/api/commands/${d.device.id}`)).data.commands||{};t.value=Object.entries(I).map(([n,X])=>({name:n,type:X.command_type||X.type||"ir"}))}catch(se){if(((Q=se.response)==null?void 0:Q.status)===404)console.log("â„¹ï¸ No commands found for device (this is normal for new devices)"),t.value=[];else throw se}}else console.log("âš ï¸ No commands found and no device ID");console.log("ğŸ“‹ Final learned commands:",t.value)}}catch(se){console.error("Error loading commands:",se)}finally{G.value=!1}},De=async()=>{var H,R;T.value="",w.value="",$.value=!0;try{let Q=d.device.id.split(".")[1];d.device.device&&(Q=d.device.device);const se=c.value==="__custom__"?f.value:c.value,I=await ne.post("/api/commands/learn",{entity_id:i.value,device:Q,device_id:d.device.id,command:se.trim(),command_type:C.value});if(I.data.success){T.value=`Command "${se}" learned successfully!`,w.value="success",t.value.find(ae=>ae.name===se)||t.value.push({name:se,type:C.value});const X=M.value.indexOf(se);X>-1&&M.value.splice(X,1);const q={...d.device.commands};q[se]={command_type:C.value,type:C.value},await V(),c.value="",f.value="",k("learned",{commands:q,commandName:se})}else T.value=I.data.error||"Failed to learn command",w.value="error"}catch(Q){T.value=((R=(H=Q.response)==null?void 0:H.data)==null?void 0:R.error)||"Error learning command",w.value="error"}finally{$.value=!1}},Le=async H=>{var R,Q;try{z.value=H,E.value="";let se=d.device.id.split(".")[1];d.device.device&&(se=d.device.device);const I=j.value?d.device.controller_device:i.value||d.device.broadlink_entity;if(!I){console.error("Missing entity_id for test command:",{isSmartIR:j.value,controller_device:d.device.controller_device,broadlink_entity:d.device.broadlink_entity,selectedBroadlink:i.value,device:d.device}),T.value="Missing Broadlink remote entity. Please select a Broadlink device.",w.value="error",z.value="";return}const n={entity_id:I,device:se,command:H,device_id:d.device.id};console.log("ğŸ§ª Testing command:",n),(await ne.post("/api/commands/test",n)).data.success&&(E.value=H,setTimeout(()=>{E.value===H&&(E.value="")},2e3))}catch(se){console.error("âŒ Test command error:",se);const I=((Q=(R=se.response)==null?void 0:R.data)==null?void 0:Q.error)||se.message||"Unknown error";T.value=`Failed to send command: ${I}`,w.value="error"}finally{z.value=""}},xe=H=>{D.value=H,P.value=!0},S=()=>{P.value=!1,D.value=""},u=async()=>{const H=D.value;P.value=!1;try{console.log(`ğŸ—‘ï¸ Deleting command: ${H}`),await ne.delete(`/api/commands/${d.device.id}/${H}`),t.value=t.value.filter(R=>R.name!==H),await ce(),await V(),T.value=`Command "${H}" deleted`,w.value="success",k("learned")}catch(R){console.error("âŒ Delete error:",R),T.value=`Failed to delete command: ${R.message}`,w.value="error"}finally{D.value=""}},V=async()=>{try{let H=d.device.device;H||(H=d.device.id.includes(".")?d.device.id.split(".")[1]:d.device.id),console.log("ğŸ” Looking for untracked commands for device:",H);const Q=(await ne.get("/api/commands/untracked")).data.untracked||{};console.log("ğŸ“¦ All untracked commands:",Object.keys(Q)),console.log("ğŸ“¦ Untracked for this device:",Q[H]),Q[H]?M.value=Object.keys(Q[H].commands):M.value=[]}catch(H){console.error("Error loading untracked commands:",H),M.value=[]}},ye=()=>{M.value.length!==0&&(a.value=!0)},Ie=async()=>{a.value=!1;try{const H=d.device.device||d.device.id.split(".")[1],R=await ne.post("/api/commands/import",{device_id:d.device.id,source_device:H,commands:M.value});R.data.success&&(T.value=`Imported ${R.data.imported_count} commands successfully!`,w.value="success",await ce(),await V(),k("learned"))}catch(H){T.value=`Failed to import commands: ${H.message}`,w.value="error"}};return(H,R)=>(l(),s("div",{class:"modal-overlay",onClick:R[7]||(R[7]=he(Q=>H.$emit("cancel"),["self"]))},[e("div",Ul,[e("div",Pl,[e("h2",null,m(j.value?"Commands for":"Learn Commands for")+" "+m(o.device.name),1),e("button",{onClick:R[0]||(R[0]=Q=>H.$emit("cancel")),class:"close-btn"},[...R[8]||(R[8]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Fl,[j.value?(l(),s("div",jl,[R[13]||(R[13]=e("i",{class:"mdi mdi-information"},null,-1)),e("div",null,[R[12]||(R[12]=e("h3",null,"SmartIR Device",-1)),e("p",null,[R[9]||(R[9]=_("This device uses SmartIR code file ",-1)),e("strong",null,m(o.device.device_code),1),R[10]||(R[10]=_(". Commands are pre-configured and cannot be learned.",-1))]),o.device.entity_type==="climate"?(l(),s("p",Nl,[...R[11]||(R[11]=[e("i",{class:"mdi mdi-alert-circle-outline"},null,-1),e("strong",null,"Note:",-1),_(" Climate device commands are temperature-based. Testing individual modes may not work as expected. Use the Home Assistant climate card to control your device. ",-1)])])):x("",!0)])])):(l(),s("form",{key:1,onSubmit:he(De,["prevent"])},[e("div",Bl,[R[14]||(R[14]=e("label",{for:"broadlink-entity"},"Broadlink Device",-1)),e("input",{id:"broadlink-entity",value:A.value,type:"text",readonly:"",disabled:""},null,8,Hl),R[15]||(R[15]=e("small",null,"Commands will be learned using this device (set when device was created)",-1))]),e("div",ql,[R[18]||(R[18]=e("label",{for:"command-name"},"Command Name *",-1)),W(e("select",{id:"command-name",ref_key:"commandSelect",ref:b,"onUpdate:modelValue":R[1]||(R[1]=Q=>c.value=Q),disabled:$.value,required:"",onChange:ee},[R[16]||(R[16]=e("option",{value:""},"-- Select or type command --",-1)),e("optgroup",Jl,[(l(!0),s(pe,null,ke(le.value,Q=>(l(),s("option",{key:Q,value:Q},m(Q),9,Wl))),128))]),R[17]||(R[17]=e("option",{value:"__custom__"},"Custom command...",-1))],40,zl),[[Se,c.value]]),c.value==="__custom__"?W((l(),s("input",{key:0,ref_key:"customCommandInput",ref:p,"onUpdate:modelValue":R[2]||(R[2]=Q=>f.value=Q),type:"text",placeholder:"Enter custom command name",disabled:$.value,required:"",class:"custom-command-input",onInput:ie},null,40,Gl)),[[Me,f.value]]):x("",!0),e("small",null,"Select a suggested command for "+m(o.device.entity_type||"this device")+", or enter a custom one.",1)]),e("div",Kl,[R[21]||(R[21]=e("label",null,"Command Type",-1)),e("div",Xl,[e("label",Yl,[W(e("input",{type:"radio","onUpdate:modelValue":R[3]||(R[3]=Q=>C.value=Q),value:"ir",disabled:$.value},null,8,Zl),[[He,C.value]]),R[19]||(R[19]=e("span",null,"IR (Infrared)",-1))]),e("label",Ql,[W(e("input",{type:"radio","onUpdate:modelValue":R[4]||(R[4]=Q=>C.value=Q),value:"rf",disabled:$.value},null,8,en),[[He,C.value]]),R[20]||(R[20]=e("span",null,"RF (Radio Frequency)",-1))])])]),e("div",tn,[e("button",{type:"submit",class:"btn btn-primary btn-large",disabled:$.value},[$.value?(l(),s("i",ln)):(l(),s("i",nn)),_(" "+m($.value?"Learning...":"Learn Command"),1)],8,on)]),$.value?(l(),s("div",sn,[R[24]||(R[24]=e("i",{class:"mdi mdi-loading mdi-spin"},null,-1)),C.value==="ir"?(l(),s("div",an,[...R[22]||(R[22]=[e("p",null,"Point your remote at the Broadlink device and press the button...",-1),e("small",null,"This may take up to 30 seconds",-1)])])):C.value==="rf"?(l(),s("div",rn,[...R[23]||(R[23]=[e("p",null,[e("strong",null,"Learning request sent to device.")],-1),e("p",null,"RF learning is a two-step process:",-1),e("ol",null,[e("li",null,[e("strong",null,"Step 1 - Frequency Sweep (~10-15 seconds):"),_(" Press and hold the button on your remote until the notification updates.")]),e("li",null,[e("strong",null,"Step 2 - Learn Signal:"),_(" Press and release the button once.")])],-1),e("p",{class:"ha-note"},[_(" Follow the Home Assistant notifications ("),e("i",{class:"mdi mdi-bell"}),_(") for real-time instructions. ")],-1)])])):x("",!0)])):x("",!0),T.value&&w.value==="success"&&!T.value.includes("sent successfully")?(l(),s("div",dn,[R[25]||(R[25]=e("i",{class:"mdi mdi-check-circle"},null,-1)),e("p",null,m(T.value),1)])):x("",!0)],32)),t.value.length>0||M.value.length>0?(l(),s("div",un)):x("",!0),G.value?(l(),s("div",cn,[...R[26]||(R[26]=[e("div",{class:"loading-spinner"},[e("i",{class:"mdi mdi-loading mdi-spin"}),e("p",null,"Loading commands...")],-1)])])):t.value.length>0?(l(),s("div",mn,[e("h3",null,"Tracked Commands ("+m(t.value.length)+")",1),e("div",vn,[(l(!0),s(pe,null,ke(t.value,Q=>(l(),s("div",{key:Q.name,class:"command-item"},[e("div",pn,[e("span",fn,m(Q.label||Q.name),1)]),e("div",gn,[e("i",{class:"mdi mdi-check-circle learned-icon",title:`Learned (${(Q.type||"ir").toUpperCase()})`},null,8,yn),e("span",{class:Y(["command-type-badge",Q.type||"ir"])},m((Q.type||"ir").toUpperCase()),3),e("div",bn,[e("button",{type:"button",onClick:se=>Le(Q.name),class:"icon-btn",title:"Test command",disabled:z.value===Q.name},[e("i",{class:Y(["mdi mdi-play",{"mdi-spin":z.value===Q.name}])},null,2)],8,hn),e("button",{type:"button",onClick:se=>xe(Q.name),class:"icon-btn danger",title:"Delete and re-learn"},[...R[27]||(R[27]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,kn)])])]))),128))])])):x("",!0),M.value.length>0?(l(),s("div",wn,[e("h3",null,[R[28]||(R[28]=e("i",{class:"mdi mdi-alert"},null,-1)),_(" Untracked Commands ("+m(M.value.length)+") ",1)]),R[31]||(R[31]=e("p",{class:"untracked-info"}," These commands exist in Broadlink storage but are not tracked in this device. ",-1)),e("div",$n,[(l(!0),s(pe,null,ke(M.value,Q=>(l(),s("div",{key:Q,class:"command-item untracked"},[e("span",Cn,m(Q),1),R[29]||(R[29]=e("span",{class:"untracked-badge"},"Not tracked",-1))]))),128))]),e("button",{type:"button",onClick:ye,class:"btn btn-secondary"},[...R[30]||(R[30]=[e("i",{class:"mdi mdi-import"},null,-1),_(" Import All Untracked Commands ",-1)])])])):x("",!0)]),e("div",_n,[e("button",{type:"button",onClick:R[5]||(R[5]=Q=>H.$emit("cancel")),class:"btn btn-secondary",disabled:$.value}," Close ",8,Sn)])]),be(Ve,{isOpen:P.value,title:"Delete Command?",message:`Delete command '${D.value}'? This will remove it from Broadlink storage.`,confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,onConfirm:u,onCancel:S},null,8,["isOpen","message"]),be(Ve,{isOpen:a.value,title:"Import Commands?",message:`Import ${M.value.length} untracked command${M.value.length>1?"s":""} into this device?`,confirmText:"Import",cancelText:"Cancel",onConfirm:Ie,onCancel:R[6]||(R[6]=Q=>a.value=!1)},null,8,["isOpen","message"])]))}},Dn=we(In,[["__scopeId","data-v-027f5b6b"]]),xn={class:"modal-container error-dialog"},Tn={class:"modal-header"},Mn={class:"modal-body"},Rn={class:"error-message"},Ln={key:0,class:"error-suggestion"},An=["open"],En={class:"debug-content"},On={class:"debug-info"},Vn={key:0,class:"debug-section-title"},Un={key:1},Pn={__name:"ErrorDialog",props:{isOpen:{type:Boolean,default:!1},title:{type:String,default:"Error"},message:{type:String,required:!0},suggestion:{type:String,default:""},details:{type:String,default:""},error:{type:Object,default:null},context:{type:Object,default:()=>({})}},emits:["close"],setup(o,{emit:v}){const d=o,k=v,h=Te("toast"),i=g(!1),c=()=>{k("close")},f=J(()=>{var M,G,P,D,a,b,p,E,z,j,ee;const w=new Date().toISOString(),t=d.error||{};return{error:JSON.stringify({message:d.message,title:d.title,details:d.details,errorObject:t.message||t.toString(),timestamp:w},null,2),request:JSON.stringify({method:((G=(M=t.config)==null?void 0:M.method)==null?void 0:G.toUpperCase())||"N/A",url:((P=t.config)==null?void 0:P.url)||"N/A",baseURL:((D=t.config)==null?void 0:D.baseURL)||"N/A",headers:((a=t.config)==null?void 0:a.headers)||{},data:(b=t.config)!=null&&b.data?JSON.parse(t.config.data):"N/A",params:((p=t.config)==null?void 0:p.params)||{}},null,2),response:JSON.stringify({status:((E=t.response)==null?void 0:E.status)||"N/A",statusText:((z=t.response)==null?void 0:z.statusText)||"N/A",data:((j=t.response)==null?void 0:j.data)||"N/A",headers:((ee=t.response)==null?void 0:ee.headers)||{}},null,2),browser:JSON.stringify({userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language,cookieEnabled:navigator.cookieEnabled,onLine:navigator.onLine,viewport:`${window.innerWidth}x${window.innerHeight}`,screenResolution:`${window.screen.width}x${window.screen.height}`,colorDepth:window.screen.colorDepth,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,timestamp:w},null,2),appState:JSON.stringify({currentRoute:window.location.pathname,currentURL:window.location.href,referrer:document.referrer||"N/A",context:d.context||{},localStorage:{smartir_simulate:localStorage.getItem("smartir_simulate_not_installed"),theme:localStorage.getItem("theme")}},null,2),stackTrace:t.stack||null}}),C=async()=>{const w=T();try{await navigator.clipboard.writeText(w),h==null||h.success("Debug information copied to clipboard","âœ… Copied")}catch(t){console.error("Failed to copy:",t),h==null||h.error("Failed to copy to clipboard","âŒ Copy Failed")}},$=()=>{const w=T(),t=new Blob([w],{type:"text/plain"}),M=URL.createObjectURL(t),G=document.createElement("a");G.href=M;const P=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5);G.download=`broadlink-manager-error-${P}.txt`,document.body.appendChild(G),G.click(),document.body.removeChild(G),URL.revokeObjectURL(M),h==null||h.success("Debug report downloaded","âœ… Downloaded")},T=()=>`Broadlink Manager - Error Report
${"=".repeat(60)}

Generated: ${new Date().toISOString()}
Title: ${d.title}
Message: ${d.message}
${d.suggestion?`Suggestion: ${d.suggestion}
`:""}
${"=".repeat(60)}

ERROR DETAILS
${"-".repeat(60)}
${f.value.error}

REQUEST INFORMATION
${"-".repeat(60)}
${f.value.request}

RESPONSE INFORMATION
${"-".repeat(60)}
${f.value.response}

BROWSER INFORMATION
${"-".repeat(60)}
${f.value.browser}

APPLICATION STATE
${"-".repeat(60)}
${f.value.appState}

${f.value.stackTrace?`STACK TRACE
${"-".repeat(60)}
${f.value.stackTrace}

`:""}
${"=".repeat(60)}
End of Report
`;return ue(()=>d.isOpen,w=>{if(w){const t=M=>{M.key==="Escape"&&c()};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)}}),(w,t)=>(l(),Ee(tt,{to:"body"},[be(Qe,{name:"modal"},{default:Ge(()=>[o.isOpen?(l(),s("div",{key:0,class:"modal-overlay",onClick:he(c,["self"])},[e("div",xn,[e("div",Tn,[t[2]||(t[2]=e("div",{class:"header-icon error-icon"},[e("i",{class:"mdi mdi-alert-circle"})],-1)),e("h3",null,m(o.title),1),e("button",{onClick:c,class:"close-button"},[...t[1]||(t[1]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Mn,[e("p",Rn,m(o.message),1),o.suggestion?(l(),s("p",Ln,[t[3]||(t[3]=e("i",{class:"mdi mdi-lightbulb-on"},null,-1)),_(" "+m(o.suggestion),1)])):x("",!0),e("details",{class:"debug-section",open:i.value},[e("summary",{onClick:t[0]||(t[0]=M=>i.value=!i.value)},[e("i",{class:Y(["mdi",i.value?"mdi-chevron-down":"mdi-chevron-right"])},null,2),t[4]||(t[4]=_(" Debug Information ",-1))]),e("div",En,[e("div",{class:"debug-actions"},[e("button",{onClick:C,class:"btn-debug btn-copy"},[...t[5]||(t[5]=[e("i",{class:"mdi mdi-content-copy"},null,-1),_(" Copy to Clipboard ",-1)])]),e("button",{onClick:$,class:"btn-debug btn-download"},[...t[6]||(t[6]=[e("i",{class:"mdi mdi-download"},null,-1),_(" Download Report ",-1)])])]),e("div",On,[t[7]||(t[7]=e("div",{class:"debug-section-title"},"Error Details",-1)),e("pre",null,m(f.value.error),1),t[8]||(t[8]=e("div",{class:"debug-section-title"},"Request Information",-1)),e("pre",null,m(f.value.request),1),t[9]||(t[9]=e("div",{class:"debug-section-title"},"Response Information",-1)),e("pre",null,m(f.value.response),1),t[10]||(t[10]=e("div",{class:"debug-section-title"},"Browser Information",-1)),e("pre",null,m(f.value.browser),1),t[11]||(t[11]=e("div",{class:"debug-section-title"},"Application State",-1)),e("pre",null,m(f.value.appState),1),f.value.stackTrace?(l(),s("div",Vn,"Stack Trace")):x("",!0),f.value.stackTrace?(l(),s("pre",Un,m(f.value.stackTrace),1)):x("",!0)])])],8,An)]),e("div",{class:"modal-footer"},[e("button",{onClick:c,class:"btn btn-primary"}," OK ")])])])):x("",!0)]),_:1})]))}},Fn=we(Pn,[["__scopeId","data-v-23858149"]]),jn={key:0,class:"discovery-banner"},Nn={class:"banner-content"},Bn={class:"banner-text"},Hn={class:"modal-dialog"},qn={class:"modal-header"},zn={class:"modal-body"},Jn={class:"device-list"},Wn={class:"device-info"},Gn={class:"device-details"},Kn={class:"command-count"},Xn={class:"device-actions"},Yn=["onClick"],Zn=["onClick"],Qn={class:"modal-footer"},es={class:"modal-dialog modal-dialog-small"},ts={class:"modal-header"},os={class:"modal-body"},ls={class:"warning-message"},ns={class:"modal-footer"},ss=["disabled"],as=["disabled"],is={__name:"DeviceDiscovery",emits:["adopt"],setup(o,{expose:v,emit:d}){const k=Fe(),h=d,i=g([]),c=g(!1),f=g(!1),C=g(null),$=g(!1),T=J(()=>i.value.length>0);Re(async()=>{await w()});const w=async()=>{try{const P=await ne.get("/api/devices/discover");i.value=P.data.untracked_devices||[]}catch(P){console.error("Error loading untracked devices:",P),i.value=[]}},t=P=>{c.value=!1,h("adopt",P)},M=P=>{C.value=P,f.value=!0},G=async()=>{if(C.value){$.value=!0;try{const P=await ne.delete(`/api/devices/untracked/${encodeURIComponent(C.value.device_name)}`);if(P.data.success)i.value=i.value.filter(D=>D.device_name!==C.value.device_name),f.value=!1,C.value=null,console.log("Device deleted successfully");else throw new Error(P.data.error||"Failed to delete device")}catch(P){console.error("Error deleting device:",P),k.error(`Failed to delete device: ${P.message}`)}finally{$.value=!1}}};return v({refresh:w}),(P,D)=>{var a,b,p;return T.value?(l(),s("div",jn,[e("div",Nn,[D[9]||(D[9]=e("div",{class:"banner-icon"},[e("i",{class:"mdi mdi-radar"})],-1)),e("div",Bn,[D[7]||(D[7]=e("h3",null,"Untracked Devices Found",-1)),e("p",null,m(i.value.length)+" device"+m(i.value.length>1?"s":"")+" with learned commands found in Broadlink storage",1)]),e("button",{onClick:D[0]||(D[0]=E=>c.value=!0),class:"btn btn-primary"},[...D[8]||(D[8]=[e("i",{class:"mdi mdi-eye"},null,-1),_(" View Devices ",-1)])])]),c.value?(l(),s("div",{key:0,class:"modal-overlay",onClick:D[3]||(D[3]=he(E=>c.value=!1,["self"]))},[e("div",Hn,[e("div",qn,[D[11]||(D[11]=e("h2",null,"Discovered Devices",-1)),e("button",{onClick:D[1]||(D[1]=E=>c.value=!1),class:"close-btn"},[...D[10]||(D[10]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",zn,[D[16]||(D[16]=e("p",{class:"info-text"}," These devices have learned commands in Broadlink storage but are not being tracked. Adopt them to manage their commands and generate Home Assistant entities. ",-1)),e("div",Jn,[(l(!0),s(pe,null,ke(i.value,E=>(l(),s("div",{key:E.device_name,class:"discovered-device"},[e("div",Wn,[D[13]||(D[13]=e("div",{class:"device-icon"},[e("i",{class:"mdi mdi-devices"})],-1)),e("div",Gn,[e("h4",null,m(E.device_name),1),e("span",Kn,[D[12]||(D[12]=e("i",{class:"mdi mdi-remote"},null,-1)),_(" "+m(E.command_count)+" command"+m(E.command_count>1?"s":""),1)])])]),e("div",Xn,[e("button",{onClick:z=>t(E),class:"btn btn-primary"},[...D[14]||(D[14]=[e("i",{class:"mdi mdi-plus"},null,-1),_(" Adopt ",-1)])],8,Yn),e("button",{onClick:z=>M(E),class:"btn btn-danger",title:"Delete all commands"},[...D[15]||(D[15]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,Zn)])]))),128))])]),e("div",Qn,[e("button",{onClick:D[2]||(D[2]=E=>c.value=!1),class:"btn btn-secondary"}," Close ")])])])):x("",!0),f.value?(l(),s("div",{key:1,class:"modal-overlay",onClick:D[6]||(D[6]=he(E=>f.value=!1,["self"]))},[e("div",es,[e("div",ts,[D[18]||(D[18]=e("h2",null,"Delete Untracked Device",-1)),e("button",{onClick:D[4]||(D[4]=E=>f.value=!1),class:"close-btn"},[...D[17]||(D[17]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",os,[e("div",ls,[D[20]||(D[20]=e("i",{class:"mdi mdi-alert"},null,-1)),e("div",null,[e("p",null,[e("strong",null,'Are you sure you want to delete "'+m((a=C.value)==null?void 0:a.device_name)+'"?',1)]),e("p",null,"This will permanently delete all "+m((b=C.value)==null?void 0:b.command_count)+" command"+m(((p=C.value)==null?void 0:p.command_count)>1?"s":"")+" from Broadlink storage.",1),D[19]||(D[19]=e("p",{class:"warning-text"},"This action cannot be undone.",-1))])])]),e("div",ns,[e("button",{onClick:D[5]||(D[5]=E=>f.value=!1),class:"btn btn-secondary",disabled:$.value}," Cancel ",8,ss),e("button",{onClick:G,class:"btn btn-danger",disabled:$.value},[e("i",{class:Y(["mdi",$.value?"mdi-loading mdi-spin":"mdi-delete"])},null,2),_(" "+m($.value?"Deleting...":"Delete"),1)],8,as)])])])):x("",!0)])):x("",!0)}}},rs=we(is,[["__scopeId","data-v-fa89dc7c"]]),ds={class:"device-list-card"},us={class:"card-header"},cs={class:"header-badges"},ms={class:"header-info"},vs={class:"header-right"},ps={class:"settings-menu-container"},fs=["disabled"],gs=["disabled"],ys={class:"card-body"},bs={key:0,class:"filter-bar"},hs={class:"filter-search-row"},ks=["title"],ws={key:0,class:"filter-badge"},$s={class:"search-input-wrapper"},Cs={class:"filter-content"},_s={class:"filter-row filter-row-dropdowns"},Ss={class:"filter-group"},Is=["value"],Ds={class:"filter-group"},xs=["value"],Ts={class:"filter-group"},Ms={key:0,class:"filter-group filter-toggle"},Rs={class:"toggle-label"},Ls={key:2,class:"view-toggle-group"},As={class:"filter-results"},Es={key:1,class:"loading-state"},Os={key:2,class:"error-state"},Vs={key:3,class:"empty-state"},Us={key:4,class:"device-grid"},Ps={key:6,class:"no-results"},Fs={__name:"DeviceList",setup(o){const v=mt(),d=Fe(),{isMobile:k}=Ke(),h=g(!1),i=g(!1),c=g(null),f=g(!1),C=g(!1),$=g(null),T=g(null),w=g(!0),t=g(!1),M=g(!1),P=g(window.innerWidth<=767?"grid":localStorage.getItem("device_view_mode")||"grid");ue(k,L=>{L&&P.value==="list"&&(P.value="grid")}),ue(P,L=>{localStorage.setItem("device_view_mode",L)});const D=()=>{w.value=!w.value},a=g(!1),b=g({title:"Error",message:"",suggestion:"",details:"",error:null,context:{}}),p=g(!1),E=g({success:!1,title:"",message:""}),z=g(!1),j=g({search:"",broadlinkDevice:"",area:"",entityType:"",showSmartIROnly:!1}),ee=g([]),ie=Te("smartirStatus"),A=Te("smartirEnabled"),N=J(()=>{var y;return localStorage.getItem("smartir_simulate_not_installed")==="true"?!1:((y=ie==null?void 0:ie.value)==null?void 0:y.installed)||!1}),le=J(()=>{const L=new Map;return v.devices.forEach(y=>{if(y.broadlink_entity){const U=ee.value.find(oe=>oe.entity_id===y.broadlink_entity),B=U&&U.name||y.broadlink_entity;L.set(y.broadlink_entity,{entity_id:y.broadlink_entity,friendly_name:B})}}),Array.from(L.values()).sort((y,U)=>y.friendly_name.localeCompare(U.friendly_name))}),me=J(()=>{const L=new Set;return v.devices.forEach(y=>{y.area&&L.add(y.area)}),Array.from(L).sort()}),ce=J(()=>{let L=v.devices;if(j.value.search){const U=j.value.search.toLowerCase();L=L.filter(B=>{var fe,de,_e,Oe,je;if((fe=B.name)!=null&&fe.toLowerCase().includes(U)||(de=B.entity_type)!=null&&de.toLowerCase().includes(U)||(_e=B.area)!=null&&_e.toLowerCase().includes(U)||(Oe=B.id)!=null&&Oe.toLowerCase().includes(U)||Object.keys(B.commands||{}).some(Je=>Je.toLowerCase().includes(U)))return!0;const ve=ee.value.find(Je=>Je.entity_id===B.broadlink_entity);return!!((je=ve==null?void 0:ve.name)!=null&&je.toLowerCase().includes(U))})}j.value.broadlinkDevice&&(L=L.filter(U=>U.broadlink_entity===j.value.broadlinkDevice||U.controller_device===j.value.broadlinkDevice)),j.value.area&&(L=L.filter(U=>U.area===j.value.area)),j.value.entityType&&(L=L.filter(U=>U.entity_type===j.value.entityType)),j.value.showSmartIROnly&&(L=L.filter(U=>U.device_type==="smartir"));const y=localStorage.getItem("smartir_simulate_not_installed")==="true";return(!(A!=null&&A.value)||y)&&(L=L.filter(U=>U.device_type!=="smartir")),L}),De=J(()=>j.value.search||j.value.broadlinkDevice||j.value.area||j.value.entityType||j.value.showSmartIROnly),Le=J(()=>{let L=0;return j.value.search&&L++,j.value.broadlinkDevice&&L++,j.value.area&&L++,j.value.entityType&&L++,j.value.showSmartIROnly&&L++,L}),xe=()=>{j.value.search="",j.value.broadlinkDevice="",j.value.area="",j.value.entityType="",j.value.showSmartIROnly=!1},S=async()=>{try{const L=await ne.get("/api/remote/devices");ee.value=L.data.devices||[]}catch(L){console.error("Error loading remote devices:",L)}};ue(P,L=>{localStorage.setItem("device_view_mode",L)}),Re(async()=>{await Promise.all([v.loadDevices(),S()])});const u=L=>{c.value=L,h.value=!0},V=J(()=>{if(!$.value)return"";const L=Object.keys($.value.commands||{}).length;return L===0?"This device has no commands. The device will be removed from tracking.":`This device has ${L} learned command${L>1?"s":""}. What would you like to do?`}),ye=J(()=>{if(!$.value)return"";const L=Object.keys($.value.commands||{}).length;return L===0?"":`Also delete all ${L} command${L>1?"s":""} from Broadlink storage`}),Ie=L=>{$.value=L,f.value=!0},H=()=>{f.value=!1,$.value=null},R=async L=>{var U,B;const y=$.value;f.value=!1;try{await v.deleteDevice(y.id,L),T.value&&await T.value.refresh()}catch(oe){const ve=((B=(U=oe.response)==null?void 0:U.data)==null?void 0:B.error)||oe.message||"Unknown error";X("Failed to Delete Device",ve)}finally{$.value=null}},Q=async L=>{var y,U,B,oe,ve;try{console.log("ğŸ’¾ Saving device data:",L),console.log("ğŸ’¾ Device commands:",L.commands),console.log("ğŸ’¾ Selected device:",c.value),(y=c.value)!=null&&y.id&&c.value.id!==null?await v.updateDevice(c.value.id,L):await v.createDevice(L),se(),T.value&&await T.value.refresh()}catch(fe){let de="Failed to save device",_e="",Oe="";(B=(U=fe.response)==null?void 0:U.data)!=null&&B.error?(de=fe.response.data.error,_e=fe.response.data.suggestion||""):fe.message&&(de=fe.message),fe.response&&(Oe=`Status: ${fe.response.status}
URL: ${((oe=fe.config)==null?void 0:oe.url)||"N/A"}`),X("Failed to Save Device",de,_e,Oe,fe,{action:"save_device",deviceData:L,isEdit:!!((ve=c.value)!=null&&ve.id)})}},se=()=>{h.value=!1,c.value=null},I=L=>{c.value=L,i.value=!0},n=()=>{i.value=!1,c.value=null},X=(L,y,U="",B="",oe=null,ve={})=>{b.value={title:L,message:y,suggestion:U,details:B,error:oe,context:ve},a.value=!0},q=()=>{a.value=!1},ae=()=>{p.value=!1},O=async L=>{if(L&&L.commands&&c.value){const y=v.devices.findIndex(U=>U.id===c.value.id);y!==-1&&(v.devices[y].commands=L.commands,console.log(`Optimistically updated device ${c.value.id} with new command: ${L.commandName}`))}v.loadDevices(),T.value&&T.value.refresh()},r=L=>{const y=L.split("_"),U=[];for(let B=0;B<y.length;B++){const oe=y[B],ve=y[B+1];oe&&ve==="s"&&y[B+2]?(U.push(oe.charAt(0).toUpperCase()+oe.slice(1)+"'s"),B++):oe!=="s"&&U.push(oe.charAt(0).toUpperCase()+oe.slice(1))}return U.join(" ")},F=(L,y)=>{const U=L.toLowerCase(),B=y.map(de=>de.toLowerCase());return U.includes("lamp")||U.includes("light")?"light":U.includes("fan")?"fan":U.includes("tv")||U.includes("stereo")||U.includes("speaker")||U.includes("receiver")?"media_player":U.includes("blind")||U.includes("curtain")||U.includes("shade")||U.includes("garage")?"cover":B.some(de=>de.includes("volume")||de.includes("channel")||de.includes("play")||de.includes("pause")||de.includes("mute"))?"media_player":B.some(de=>de.includes("fan_speed")||de.includes("fan_low")||de.includes("fan_high"))?"fan":B.some(de=>de.includes("open")||de.includes("close")||de.includes("stop"))?"cover":"switch"},Z=(L,y)=>{const U=L.toLowerCase();return U.includes("tv")?"mdi:television":U.includes("stereo")||U.includes("receiver")||U.includes("speaker")?"mdi:speaker":U.includes("lamp")?"mdi:lamp":U.includes("light")?"mdi:lightbulb":U.includes("fan")?"mdi:fan":U.includes("blind")?"mdi:blinds":U.includes("curtain")?"mdi:curtains":U.includes("garage")?"mdi:garage":{light:"mdi:lightbulb",fan:"mdi:fan",switch:"mdi:light-switch",media_player:"mdi:speaker",cover:"mdi:window-shutter"}[y]||"mdi:devices"},re=L=>{const y=L.toLowerCase().split("_");for(let oe=0;oe<y.length-2;oe++)if(y[oe+1]==="s"){const ve=y.slice(oe,oe+3),fe=r(ve.join("_"));return console.log("Detected possessive area:",fe,"from",L),fe}const U=[["living","room"],["dining","room"],["master","bedroom"],["guest","bedroom"],["family","room"],["laundry","room"],["home","office"]];for(let oe=0;oe<y.length-1;oe++){const ve=[y[oe],y[oe+1]],fe=U.find(de=>de[0]===ve[0]&&de[1]===ve[1]);if(fe)return r(fe.join("_"))}const B=["kitchen","bedroom","bathroom","garage","office","basement","attic","hallway","entryway","patio","deck","yard","garden"];for(const oe of y)if(B.includes(oe))return oe.charAt(0).toUpperCase()+oe.slice(1);return""},K=async L=>{const y=r(L.device_name),U=re(L.device_name),B=F(L.device_name,L.commands),oe=Z(L.device_name,B);let ve="";try{console.log("Finding Broadlink owner for:",L.device_name);const de=await ne.post("/api/devices/find-broadlink-owner",{device_name:L.device_name});console.log("Broadlink owner response:",de.data),ve=de.data.broadlink_entity||"",console.log("Detected Broadlink entity:",ve)}catch(de){console.error("Error finding Broadlink owner:",de)}c.value={id:null,device:L.device_name,name:y,entity_type:B,commands:{},area:U,icon:oe,broadlink_entity:ve,enabled:!0};const fe={};L.commands.forEach(de=>{fe[de]=de}),c.value.commands=fe,h.value=!0},te=async()=>{M.value=!0;try{await v.syncAllAreas(),d.success("Areas synced from Home Assistant")}catch(L){console.error("Error syncing areas:",L),d.error("Failed to sync areas")}finally{M.value=!1}},Ae=async()=>{var L,y;t.value=!0;try{const U=await ne.post("/api/entities/generate",{});if(U.data.success){const B=U.data.broadlink_count||0,oe=U.data.smartir_count||0,ve=U.data.total_count||0,fe=U.data.errors||[];let de="âœ… Entity Generation Successful",_e=[];const Oe=[];B>0&&Oe.push(`${B} Broadlink native`),oe>0&&Oe.push(`${oe} SmartIR`),Oe.length>0&&_e.push(`Generated ${Oe.join(" and ")} entity configuration${ve!==1?"s":""}.`),B>0&&(_e.push(`
ğŸ“ Broadlink entities created in:`),_e.push("  â€¢ broadlink_manager/entities.yaml"),_e.push("  â€¢ broadlink_manager/helpers.yaml")),oe>0&&(_e.push(`
ğŸ“ SmartIR entities created in:`),_e.push("  â€¢ smartir/climate.yaml"),_e.push("  â€¢ smartir/media_player.yaml"),_e.push("  â€¢ smartir/fan.yaml")),_e.push(`
ğŸ“ Next steps:`),_e.push("1. Check your configuration.yaml includes the generated files"),_e.push("2. Restart Home Assistant to load the new entities"),fe.length>0&&(de="âš ï¸ Entity Generation Completed with Errors",_e.push(`
âš ï¸ ${fe.length} error${fe.length!==1?"s":""} occurred:`),fe.forEach(je=>{_e.push(`  â€¢ ${je}`)})),E.value={success:!0,title:de,message:_e.join(`
`)},p.value=!0}else E.value={success:!1,title:"âŒ Entity Generation Failed",message:U.data.message||`Failed to generate entities.

Please check that you have at least one device configured.`},p.value=!0}catch(U){console.error("Error generating entities:",U);const B=((y=(L=U.response)==null?void 0:L.data)==null?void 0:y.error)||U.message||"Unknown error occurred";E.value={success:!1,title:"âŒ Entity Generation Error",message:`Failed to generate entities:

${B}

Please check the logs for more details.`},p.value=!0}finally{t.value=!1}},Ce=async({device:L,command:y})=>{var U,B;try{const oe={device_id:L.id,command:y,entity_id:L.broadlink_entity,device:L.device};await ne.post("/api/commands/test",oe),d.success(`Sent ${y} to ${L.name}`)}catch(oe){console.error("Error sending command:",oe);const ve=((B=(U=oe.response)==null?void 0:U.data)==null?void 0:B.error)||oe.message||"Unknown error";d.error(`Failed to send ${y}: ${ve}`)}};return(L,y)=>{var U;return l(),s("div",ds,[e("div",us,[e("button",{class:"icon-button chevron-button",onClick:D},[e("i",{class:Y(["mdi",w.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2)]),e("div",{class:"header-left",onClick:D},[y[15]||(y[15]=e("div",{class:"header-icon"},[e("i",{class:"mdi mdi-devices"})],-1)),e("h3",null,m($e(k)?"Devices":"Managed Devices"),1),e("div",cs,[e("span",ms,m($e(v).deviceCount)+" devices",1)])]),e("div",vs,[e("button",{onClick:y[0]||(y[0]=he(B=>h.value=!0,["stop"])),class:"btn btn-primary new-button"},[...y[16]||(y[16]=[e("i",{class:"mdi mdi-plus"},null,-1),e("span",null,"New",-1)])]),e("div",ps,[e("button",{onClick:y[1]||(y[1]=he(B=>C.value=!C.value,["stop"])),class:Y(["icon-button settings-button",{active:C.value}]),title:"Settings"},[...y[17]||(y[17]=[e("i",{class:"mdi mdi-cog"},null,-1)])],2),C.value?(l(),s("div",{key:0,class:"settings-dropdown",onClick:y[4]||(y[4]=he(()=>{},["stop"]))},[e("button",{onClick:y[2]||(y[2]=B=>{te(),C.value=!1}),class:"menu-item",disabled:M.value},[e("i",{class:Y(["mdi",M.value?"mdi-loading mdi-spin":"mdi-refresh"])},null,2),e("span",null,m(M.value?"Syncing Areas...":"Sync Areas"),1)],8,fs),e("button",{onClick:y[3]||(y[3]=B=>{Ae(),C.value=!1}),class:"menu-item",disabled:t.value},[e("i",{class:Y(["mdi",t.value?"mdi-loading mdi-spin":"mdi-file-code"])},null,2),e("span",null,m(t.value?"Generating...":"Generate Entities"),1)],8,gs)])):x("",!0)])])]),W(e("div",ys,[be(rs,{ref_key:"discoveryRef",ref:T,onAdopt:K},null,512),$e(v).hasDevices?(l(),s("div",bs,[e("div",hs,[e("button",{class:Y(["filter-toggle-button",{active:z.value||De.value}]),onClick:y[5]||(y[5]=B=>z.value=!z.value),title:z.value?"Hide filters":"Show filters"},[y[18]||(y[18]=e("i",{class:"mdi mdi-filter-variant"},null,-1)),De.value?(l(),s("span",ws,m(Le.value),1)):x("",!0)],10,ks),e("div",$s,[y[19]||(y[19]=e("i",{class:"mdi mdi-magnify search-icon"},null,-1)),W(e("input",{"onUpdate:modelValue":y[6]||(y[6]=B=>j.value.search=B),type:"text",placeholder:"Search devices, commands...",class:"search-input"},null,512),[[Me,j.value.search]])])]),W(e("div",Cs,[e("div",_s,[e("div",Ss,[e("label",null,[y[21]||(y[21]=e("i",{class:"mdi mdi-access-point"},null,-1)),W(e("select",{"onUpdate:modelValue":y[7]||(y[7]=B=>j.value.broadlinkDevice=B)},[y[20]||(y[20]=e("option",{value:""},"All Controller Devices",-1)),(l(!0),s(pe,null,ke(le.value,B=>(l(),s("option",{key:B.entity_id,value:B.entity_id},m(B.friendly_name),9,Is))),128))],512),[[Se,j.value.broadlinkDevice]])])]),e("div",Ds,[e("label",null,[y[23]||(y[23]=e("i",{class:"mdi mdi-home-map-marker"},null,-1)),W(e("select",{"onUpdate:modelValue":y[8]||(y[8]=B=>j.value.area=B)},[y[22]||(y[22]=e("option",{value:""},"All Areas",-1)),(l(!0),s(pe,null,ke(me.value,B=>(l(),s("option",{key:B,value:B},m(B),9,xs))),128))],512),[[Se,j.value.area]])])]),e("div",Ts,[e("label",null,[y[25]||(y[25]=e("i",{class:"mdi mdi-shape"},null,-1)),W(e("select",{"onUpdate:modelValue":y[9]||(y[9]=B=>j.value.entityType=B)},[...y[24]||(y[24]=[Ue('<option value="" data-v-0bb28540>All Types</option><option value="light" data-v-0bb28540>Light</option><option value="fan" data-v-0bb28540>Fan</option><option value="switch" data-v-0bb28540>Switch</option><option value="media_player" data-v-0bb28540>Media Player</option><option value="cover" data-v-0bb28540>Cover</option><option value="climate" data-v-0bb28540>Climate</option>',7)])],512),[[Se,j.value.entityType]])])]),N.value?(l(),s("div",Ms,[e("label",Rs,[y[26]||(y[26]=e("span",{class:"toggle-text"},[e("img",{src:Xe,alt:"SmartIR",class:"smartir-icon"}),_(" SmartIR Only ")],-1)),W(e("input",{type:"checkbox","onUpdate:modelValue":y[10]||(y[10]=B=>j.value.showSmartIROnly=B),class:"toggle-checkbox"},null,512),[[ge,j.value.showSmartIROnly]]),y[27]||(y[27]=e("span",{class:"toggle-slider"},null,-1))])])):x("",!0),De.value?(l(),s("button",{key:1,onClick:xe,class:"btn-clear-filters"},[...y[28]||(y[28]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),_(" Clear ",-1)])])):x("",!0),$e(k)?x("",!0):(l(),s("div",Ls,[e("button",{onClick:y[11]||(y[11]=B=>P.value="grid"),class:Y(["view-toggle-btn",{active:P.value==="grid"}]),title:"Grid View"},[...y[29]||(y[29]=[e("i",{class:"mdi mdi-view-grid"},null,-1),_(" Grid ",-1)])],2),e("button",{onClick:y[12]||(y[12]=B=>P.value="list"),class:Y(["view-toggle-btn",{active:P.value==="list"}]),title:"List View"},[...y[30]||(y[30]=[e("i",{class:"mdi mdi-view-list"},null,-1),_(" List ",-1)])],2)])),e("div",As,m(ce.value.length)+" of "+m($e(v).deviceCount),1)])],512),[[qe,z.value]])])):x("",!0),$e(v).loading?(l(),s("div",Es,[...y[31]||(y[31]=[e("i",{class:"mdi mdi-loading mdi-spin"},null,-1),e("p",null,"Loading devices...",-1)])])):$e(v).error?(l(),s("div",Os,[y[32]||(y[32]=e("i",{class:"mdi mdi-alert-circle"},null,-1)),e("p",null,m($e(v).error),1),e("button",{onClick:y[13]||(y[13]=B=>$e(v).loadDevices()),class:"btn btn-secondary"}," Retry ")])):$e(v).hasDevices?x("",!0):(l(),s("div",Vs,[y[34]||(y[34]=e("i",{class:"mdi mdi-devices"},null,-1)),y[35]||(y[35]=e("h3",null,"No Devices Yet",-1)),y[36]||(y[36]=e("p",null,"Get started by adding your first managed device",-1)),e("button",{onClick:y[14]||(y[14]=B=>h.value=!0),class:"btn btn-primary"},[...y[33]||(y[33]=[e("i",{class:"mdi mdi-plus"},null,-1),_(" Add Your First Device ",-1)])])])),P.value==="grid"?(l(),s("div",Us,[(l(!0),s(pe,null,ke(ce.value,B=>(l(),Ee(Ot,{key:B.id,device:B,"broadlink-devices":ee.value,onEdit:u,onDelete:Ie,onLearn:I},null,8,["device","broadlink-devices"]))),128))])):P.value==="list"&&ce.value.length>0?(l(),Ee(eo,{key:5,devices:ce.value,onSendCommand:Ce,onEditDevice:u,onDeleteDevice:Ie},null,8,["devices"])):x("",!0),$e(v).hasDevices&&ce.value.length===0?(l(),s("div",Ps,[...y[37]||(y[37]=[e("i",{class:"mdi mdi-filter-off"},null,-1),e("h3",null,"No devices match your filters",-1),e("p",null,"Try adjusting your search or filter criteria",-1)])])):x("",!0)],512),[[qe,w.value]]),h.value?(l(),Ee(Tl,{key:0,device:c.value,onSave:Q,onCancel:se},null,8,["device"])):x("",!0),i.value?(l(),Ee(Dn,{key:1,device:c.value,onLearned:O,onCancel:n},null,8,["device"])):x("",!0),be(Ve,{isOpen:f.value,title:`Delete ${(U=$.value)==null?void 0:U.name}?`,message:V.value,confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,checkboxLabel:ye.value,onConfirm:R,onCancel:H},null,8,["isOpen","title","message","checkboxLabel"]),be(Fn,{isOpen:a.value,title:b.value.title,message:b.value.message,suggestion:b.value.suggestion,details:b.value.details,error:b.value.error,context:b.value.context,onClose:q},null,8,["isOpen","title","message","suggestion","details","error","context"]),be(Ve,{isOpen:p.value,title:E.value.title,message:E.value.message,confirmText:"OK",showCancel:!1,dangerMode:!E.value.success,onConfirm:ae,onCancel:ae},null,8,["isOpen","title","message","dangerMode"])])}}},js=we(Fs,[["__scopeId","data-v-0bb28540"]]),Ns={class:"banner-content"},Bs={class:"banner-icon"},Hs={class:"banner-message"},qs={class:"banner-actions"},zs={__name:"SmartIRBanner",setup(o){const v=Te("smartirStatus"),d=g(!1),k=J(()=>!(!v.value||d.value||localStorage.getItem("smartir_banner_dismissed")==="true")),h=J(()=>{var T;return(T=v.value)!=null&&T.installed?"banner-success":"banner-info"}),i=J(()=>{var T;return(T=v.value)!=null&&T.installed?"mdi mdi-check-circle":"mdi mdi-information"}),c=J(()=>{var T;return(T=v.value)!=null&&T.installed?`SmartIR Detected (v${v.value.version})`:"Want Climate Device Support?"}),f=J(()=>{var T;return(T=v.value)!=null&&T.installed?"You can now create climate device profiles with full temperature and HVAC mode control.":"Install SmartIR to unlock AC/heater control with temperature settings, HVAC modes, and 120+ pre-configured device profiles."});function C(){window.open("https://github.com/smartHomeHub/SmartIR","_blank")}function $(){var T;if(d.value=!0,(T=v.value)!=null&&T.installed)localStorage.setItem("smartir_banner_dismissed","true");else{const w=parseInt(localStorage.getItem("smartir_banner_dismiss_count")||"0");w>=2?localStorage.setItem("smartir_banner_dismissed","true"):localStorage.setItem("smartir_banner_dismiss_count",String(w+1))}}return Re(()=>{var t;const T=localStorage.getItem("smartir_last_status"),w=(t=v.value)!=null&&t.installed?"installed":"not_installed";T!==w&&(localStorage.removeItem("smartir_banner_dismissed"),localStorage.removeItem("smartir_banner_dismiss_count"),localStorage.setItem("smartir_last_status",w))}),(T,w)=>{var t,M;return k.value?(l(),s("div",{key:0,class:Y(["smartir-banner",h.value])},[e("div",Ns,[e("div",Bs,[e("i",{class:Y(i.value)},null,2)]),e("div",Hs,[e("strong",null,m(c.value),1),e("p",null,m(f.value),1)]),e("div",qs,[(t=T.status)!=null&&t.installed?x("",!0):(l(),s("button",{key:0,onClick:C,class:"btn-primary"}," Learn More ")),e("button",{onClick:$,class:"btn-text"},m((M=T.status)!=null&&M.installed?"Got it":"Dismiss"),1)])])],2)):x("",!0)}}},Js=we(zs,[["__scopeId","data-v-7bbcbcd7"]]),Pe="api/smartir",lt={async getStatus(){try{const o=await fetch(`${Pe}/status`);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return await o.json()}catch(o){return console.error("Error fetching SmartIR status:",o),{installed:!1,version:null,error:o.message}}},async getInstallInstructions(){try{const o=await fetch(`${Pe}/install-instructions`);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return await o.json()}catch(o){throw console.error("Error fetching install instructions:",o),o}},async getPlatforms(){try{const o=await fetch(`${Pe}/platforms`);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return await o.json()}catch(o){throw console.error("Error fetching platforms:",o),o}},async getPlatformCodes(o){try{const v=await fetch(`${Pe}/platforms/${o}/codes`);if(!v.ok)throw new Error(`HTTP error! status: ${v.status}`);return await v.json()}catch(v){throw console.error(`Error fetching codes for ${o}:`,v),v}},async getNextCode(o){try{const v=await fetch(`${Pe}/platforms/${o}/next-code`);if(!v.ok)throw new Error(`HTTP error! status: ${v.status}`);return await v.json()}catch(v){throw console.error(`Error fetching next code for ${o}:`,v),v}},async validateCode(o,v){try{const d=await fetch(`${Pe}/validate-code`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({platform:o,code:v})});if(!d.ok)throw new Error(`HTTP error! status: ${d.status}`);return await d.json()}catch(d){throw console.error("Error validating code:",d),d}}},Ws={class:"profile-card"},Gs={class:"profile-card-header"},Ks=["title"],Xs={class:"profile-details"},Ys=["title"],Zs={class:"profile-meta"},Qs=["title"],ea=["title"],ta=["title"],oa={class:"profile-card-footer"},la=["title"],na={key:0,class:"learned-indicator"},sa={class:"profile-actions"},aa={__name:"SmartIRProfileCard",props:{profile:{type:Object,required:!0}},emits:["edit","download","delete","commands"],setup(o){const v=o,d=ot(J(()=>v.profile.platform)),k=c=>c.replace(/_/g," ").replace(/\b\w/g,f=>f.toUpperCase()),h=c=>c&&c.startsWith("mdi:")?`mdi ${c.replace(":"," mdi-")}`:`mdi mdi-${c}`,i=c=>{if(!c)return"";const f=c.toLowerCase();return f.includes("broadlink")?"broadlink-tag":f.includes("not set")?"not-set-tag":"default-controller-tag"};return(c,f)=>(l(),s("div",Ws,[e("div",Gs,[e("div",{class:Y(["profile-icon",$e(d).colorClass.value]),title:k(o.profile.platform)},[e("i",{class:Y(h($e(d).icon.value))},null,2)],10,Ks),e("div",Xs,[e("h4",{title:`${o.profile.manufacturer} ${o.profile.model}`},m(o.profile.manufacturer)+" "+m(o.profile.model),9,Ys),e("div",Zs,[e("span",{class:"tag platform-tag",title:k(o.profile.platform)},m(k(o.profile.platform)),9,Qs),o.profile.controllerBrand?(l(),s("span",{key:0,class:Y(["tag controller-tag",i(o.profile.controllerBrand)]),title:"Controller: "+o.profile.controllerBrand},[f[4]||(f[4]=e("i",{class:"mdi mdi-remote-tv"},null,-1)),_(" "+m(o.profile.controllerBrand),1)],10,ea)):x("",!0)])]),e("div",{class:"code-badge",title:"Device Code: "+o.profile.code},m(o.profile.code),9,ta)]),e("div",oa,[e("div",{class:"profile-stats",title:o.profile.commandCount+" total commands"+(o.profile.learnedCount>0?", "+o.profile.learnedCount+" learned":"")},[f[5]||(f[5]=e("i",{class:"mdi mdi-remote"},null,-1)),e("span",null,m(o.profile.commandCount)+" command"+m(o.profile.commandCount!==1?"s":""),1),o.profile.learnedCount>0?(l(),s("span",na,"( "+m(o.profile.learnedCount)+" learned )",1)):x("",!0)],8,la),e("div",sa,[e("button",{onClick:f[0]||(f[0]=C=>c.$emit("commands")),class:"action-btn",title:"Commands"},[...f[6]||(f[6]=[e("i",{class:"mdi mdi-remote"},null,-1)])]),e("button",{onClick:f[1]||(f[1]=C=>c.$emit("edit")),class:"action-btn",title:"Edit Profile"},[...f[7]||(f[7]=[e("i",{class:"mdi mdi-pencil"},null,-1)])]),e("button",{onClick:f[2]||(f[2]=C=>c.$emit("download")),class:"action-btn",title:"Download JSON"},[...f[8]||(f[8]=[e("i",{class:"mdi mdi-download"},null,-1)])]),e("button",{onClick:f[3]||(f[3]=C=>c.$emit("delete")),class:"action-btn delete",title:"Delete Profile"},[...f[9]||(f[9]=[e("i",{class:"mdi mdi-delete"},null,-1)])])])])]))}},ia=we(aa,[["__scopeId","data-v-aad9720f"]]),ra={name:"SmartIRProfileListView",props:{profiles:{type:Array,required:!0}},methods:{getPlatformIcon(o){return{climate:"mdi-thermostat",media_player:"mdi-television",fan:"mdi-fan",light:"mdi-lightbulb"}[o]||"mdi-devices"},formatPlatform(o){return{climate:"Climate",media_player:"Media Player",fan:"Fan",light:"Light"}[o]||o},editProfile(o){this.$emit("edit",o)},viewCommands(o){this.$emit("commands",o)},downloadProfile(o){this.$emit("download",o)},deleteProfile(o){this.$emit("delete",o)}}},da={class:"profile-list-view"},ua={class:"profile-table"},ca={class:"profile-code"},ma={class:"code-badge"},va={class:"profile-manufacturer"},pa={class:"profile-model"},fa={class:"model-info"},ga={class:"model-name"},ya={key:0,class:"model-count"},ba={class:"profile-platform"},ha={class:"profile-controller"},ka={class:"profile-commands"},wa={class:"command-stats"},$a={class:"stat-item"},Ca={key:0,class:"stat-item learned"},_a={class:"profile-actions"},Sa=["onClick"],Ia=["onClick"],Da=["onClick"],xa=["onClick"];function Ta(o,v,d,k,h,i){return l(),s("div",da,[e("table",ua,[v[6]||(v[6]=e("thead",null,[e("tr",null,[e("th",null,"Code"),e("th",null,"Manufacturer"),e("th",null,"Model"),e("th",null,"Platform"),e("th",null,"Controller"),e("th",null,"Commands"),e("th",null,"Actions")])],-1)),e("tbody",null,[(l(!0),s(pe,null,ke(d.profiles,c=>(l(),s("tr",{key:`${c.platform}-${c.code}`,class:"profile-row"},[e("td",ca,[e("span",ma,m(c.code),1)]),e("td",va,m(c.manufacturer||"Unknown"),1),e("td",pa,[e("div",fa,[e("div",ga,m(c.model||"Unknown"),1),c.models&&c.models.length>1?(l(),s("div",ya," +"+m(c.models.length-1)+" more ",1)):x("",!0)])]),e("td",ba,[e("span",{class:Y(["platform-badge",c.platform])},[e("i",{class:Y(["mdi",i.getPlatformIcon(c.platform)])},null,2),_(" "+m(i.formatPlatform(c.platform)),1)],2)]),e("td",ha,m(c.controller_brand||"N/A"),1),e("td",ka,[e("div",wa,[e("span",$a,[v[0]||(v[0]=e("i",{class:"mdi mdi-remote"},null,-1)),_(" "+m(c.command_count||0),1)]),c.learned_count>0?(l(),s("span",Ca,[v[1]||(v[1]=e("i",{class:"mdi mdi-school"},null,-1)),_(" "+m(c.learned_count),1)])):x("",!0)])]),e("td",_a,[e("button",{class:"action-btn edit",onClick:f=>i.editProfile(c),title:"Edit Profile"},[...v[2]||(v[2]=[e("i",{class:"mdi mdi-pencil"},null,-1)])],8,Sa),e("button",{class:"action-btn commands",onClick:f=>i.viewCommands(c),title:"View Commands"},[...v[3]||(v[3]=[e("i",{class:"mdi mdi-remote"},null,-1)])],8,Ia),e("button",{class:"action-btn download",onClick:f=>i.downloadProfile(c),title:"Download"},[...v[4]||(v[4]=[e("i",{class:"mdi mdi-download"},null,-1)])],8,Da),e("button",{class:"action-btn delete",onClick:f=>i.deleteProfile(c),title:"Delete"},[...v[5]||(v[5]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,xa)])]))),128))])])])}const Ma=we(ra,[["render",Ta],["__scopeId","data-v-d3773038"]]),Ra={class:"modal-container"},La={class:"modal-body"},Aa={key:0,class:"selection-section"},Ea={class:"form-group"},Oa={class:"form-group"},Va={class:"form-group"},Ua={key:0,class:"code-info"},Pa={class:"form-actions"},Fa=["disabled"],ja={key:1,class:"testing-section"},Na={class:"code-header"},Ba={class:"code-details"},Ha={class:"code-badge"},qa={class:"device-selector"},za=["value"],Ja={key:0,class:"helper-text"},Wa={class:"commands-section"},Ga={class:"commands-header"},Ka={key:0,class:"tested-count"},Xa={key:0,class:"filters-section"},Ya={class:"filter-row"},Za={class:"filter-row"},Qa={key:1,class:"empty-state"},ei={key:2,class:"empty-state"},ti={key:3,class:"commands-list"},oi={class:"command-name"},li={class:"command-actions"},ni={key:0,class:"status-badge success"},si=["onClick","disabled","title"],ai={__name:"SmartIRCodeTester",props:{isOpen:{type:Boolean,default:!1}},emits:["close","clone"],setup(o,{emit:v}){const d=o,k=v,h=Te("toast"),i=g("climate"),c=g(""),f=g([]),C=g(!1),$=g(null),T=g(""),w=g([]),t=g(!1),M=J(()=>w.value.map(I=>({code:I.code,label:`${I.models.join(", ")} (Code: ${I.code})`,value:I.code}))),G=g(null),P=g(null),D=g(!1),a=g([]),b=g(""),p=g([]),E=g(new Set),z=g(null),j=g(""),ee=g(""),ie=g(""),A=g(""),N=J(()=>{let I=p.value;if(j.value){const n=j.value.toLowerCase();I=I.filter(X=>(X.label||X.name).toLowerCase().includes(n))}return ee.value&&(I=I.filter(n=>n.mode===ee.value)),ie.value&&(I=I.filter(n=>n.fanSpeed===ie.value)),A.value&&(I=I.filter(n=>n.swingMode===A.value)),I}),le=J(()=>j.value||ee.value||ie.value||A.value);ue(()=>d.isOpen,I=>{I&&(me(),De())}),ue(i,()=>{d.isOpen&&(c.value="",$.value=null,w.value=[],me())});async function me(){var I;C.value=!0;try{const n=await ne.get("/api/smartir/codes/manufacturers",{params:{entity_type:i.value}});f.value=n.data.manufacturers||[]}catch(n){console.error("Error loading manufacturers:",n),(I=h.value)==null||I.error("Failed to load manufacturers","âŒ Error")}finally{C.value=!1}}async function ce(){var I;if(c.value){t.value=!0;try{const n=await ne.get("/api/smartir/codes/models",{params:{entity_type:i.value,manufacturer:c.value}});w.value=n.data.models||[]}catch(n){console.error("Error loading models:",n),(I=h.value)==null||I.error("Failed to load models","âŒ Error")}finally{t.value=!1}}}async function De(){try{const I=await ne.get("/api/remote/devices");a.value=I.data.devices||[]}catch(I){console.error("Error loading Broadlink devices:",I)}}async function Le(){var I,n;if($.value){D.value=!0;try{const X=await ne.get("/api/smartir/codes/code",{params:{entity_type:i.value,code_id:$.value.code}});P.value=X.data.code,G.value=$.value.code,xe(X.data.code),(I=h.value)==null||I.success(`Loaded ${p.value.length} commands`,"âœ… Code Loaded")}catch(X){console.error("Error loading code:",X),(n=h.value)==null||n.error(X.message||"Failed to load code","âŒ Error")}finally{D.value=!1}}}function xe(I){const n=[];if(!I.commands){p.value=n;return}if(i.value==="climate"){const q=I.commands;for(const[ae,O]of Object.entries(q)){if(ae==="off"){typeof O=="string"&&n.push({name:"off",label:"OFF",data:O,mode:"off"});continue}if(typeof O=="object"){for(const[r,F]of Object.entries(O))if(typeof F=="object")for(const[Z,re]of Object.entries(F)){if(typeof re!="object")continue;const K=Object.keys(re),te=K.includes("24")?"24":K[0];if(te&&typeof re[te]=="string"){const Ae=`${ae}_${te}_${r}_${Z}`,Ce=`${ae.toUpperCase()} ${te}Â°C ${r} ${Z}`;n.push({name:Ae,label:Ce,data:re[te],mode:ae,temperature:te,fanSpeed:r,swingMode:Z})}}}}}else for(const[q,ae]of Object.entries(I.commands))typeof ae=="string"&&n.push({name:q,label:q.toUpperCase().replace(/_/g," "),data:ae});p.value=n}async function S(I){var n,X,q;if(!b.value){(n=h.value)==null||n.warning("Please select a Broadlink device first","âš ï¸ No Device");return}z.value=I;try{const ae=p.value.find(O=>O.name===I);if(!ae||!ae.data)throw new Error(`Command "${I}" not found`);await ne.post("/api/commands/send-raw",{entity_id:b.value,command:ae.data,command_type:"ir"}),E.value.add(I),(X=h.value)==null||X.success(`Command sent: ${ae.label||I}`,"âœ… Tested")}catch(ae){console.error("Error testing command:",ae),(q=h.value)==null||q.error("Failed to test command","âŒ Error")}finally{z.value=null}}function u(){var I,n,X,q;if(!P.value){(I=h.value)==null||I.error("No profile data to download","âŒ Error");return}try{const ae=P.value.manufacturer||"unknown",O=((n=P.value.supportedModels)==null?void 0:n[0])||G.value,r=`${ae.toLowerCase().replace(/\s+/g,"_")}_${O.toLowerCase().replace(/\s+/g,"_")}.json`,F=JSON.stringify(P.value,null,2),Z=new Blob([F],{type:"application/json"}),re=URL.createObjectURL(Z),K=document.createElement("a");K.href=re,K.download=r,document.body.appendChild(K),K.click(),document.body.removeChild(K),URL.revokeObjectURL(re),(X=h.value)==null||X.success(`Downloaded ${r}`,"âœ… Download Complete")}catch(ae){console.error("Error downloading JSON:",ae),(q=h.value)==null||q.error(ae.message||"Failed to download JSON","âŒ Download Error")}}function V(){c.value="",$.value=null,T.value="",w.value=[]}function ye(){$.value=null,T.value="",ce()}function Ie(){T.value?$.value=w.value.find(I=>I.code===T.value):$.value=null}function H(){j.value="",ee.value="",ie.value="",A.value=""}function R(){G.value=null,P.value=null,p.value=[],E.value.clear(),z.value=null,H()}function Q(I){const n=I.toLowerCase();return n.includes("power")||n.includes("off")||n==="off"?"mdi-power":n.includes("cool")?"mdi-snowflake":n.includes("heat")?"mdi-fire":n.includes("fan")?"mdi-fan":n.includes("auto")?"mdi-auto-fix":n.includes("dry")?"mdi-water-percent":n.includes("temp")?"mdi-thermometer":n.includes("swing")?"mdi-swap-vertical":"mdi-remote"}function se(){R(),c.value="",$.value=null,k("close")}return(I,n)=>{var X;return o.isOpen?(l(),s("div",{key:0,class:"modal-overlay",onClick:he(se,["self"])},[e("div",Ra,[e("div",{class:"modal-header"},[n[9]||(n[9]=e("h3",null,[e("i",{class:"mdi mdi-test-tube"}),_(" Test SmartIR Code ")],-1)),e("button",{onClick:se,class:"close-btn"},[...n[8]||(n[8]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",La,[G.value?(l(),s("div",ja,[e("div",Na,[e("div",Ba,[e("h4",null,m(P.value.manufacturer)+" - "+m(((X=P.value.supportedModels)==null?void 0:X[0])||"Unknown"),1),e("span",Ha,"Code: "+m(G.value),1)]),e("button",{onClick:R,class:"btn-secondary-small"},[...n[14]||(n[14]=[e("i",{class:"mdi mdi-arrow-left"},null,-1),_(" Change Code ",-1)])])]),e("div",qa,[n[17]||(n[17]=e("label",null,[e("i",{class:"mdi mdi-remote"}),_(" Broadlink Device ")],-1)),W(e("select",{"onUpdate:modelValue":n[3]||(n[3]=q=>b.value=q),class:"form-select"},[n[15]||(n[15]=e("option",{value:""},"Select device to test with...",-1)),(l(!0),s(pe,null,ke(a.value,q=>(l(),s("option",{key:q.entity_id,value:q.entity_id},m(q.friendly_name||q.entity_id),9,za))),128))],512),[[Se,b.value]]),b.value?x("",!0):(l(),s("p",Ja,[...n[16]||(n[16]=[e("i",{class:"mdi mdi-information-outline"},null,-1),_(" Select a Broadlink device to enable command testing ",-1)])]))]),e("div",Wa,[e("div",Ga,[e("h5",null,"Sample Commands ("+m(N.value.length)+" / "+m(p.value.length)+")",1),E.value.size>0?(l(),s("span",Ka,m(E.value.size)+" tested ",1)):x("",!0)]),i.value==="climate"&&p.value.length>0?(l(),s("div",Xa,[e("div",Ya,[W(e("input",{"onUpdate:modelValue":n[4]||(n[4]=q=>j.value=q),type:"text",placeholder:"Search commands...",class:"search-input"},null,512),[[Me,j.value]])]),e("div",Za,[W(e("select",{"onUpdate:modelValue":n[5]||(n[5]=q=>ee.value=q),class:"filter-select"},[...n[18]||(n[18]=[e("option",{value:""},"All Modes",-1),e("option",{value:"cool"},"Cool",-1),e("option",{value:"heat"},"Heat",-1),e("option",{value:"off"},"Off",-1)])],512),[[Se,ee.value]]),W(e("select",{"onUpdate:modelValue":n[6]||(n[6]=q=>ie.value=q),class:"filter-select"},[...n[19]||(n[19]=[Ue('<option value="" data-v-66569200>All Fan Speeds</option><option value="low" data-v-66569200>Low</option><option value="mid" data-v-66569200>Mid</option><option value="high" data-v-66569200>High</option><option value="auto" data-v-66569200>Auto</option>',5)])],512),[[Se,ie.value]]),W(e("select",{"onUpdate:modelValue":n[7]||(n[7]=q=>A.value=q),class:"filter-select"},[...n[20]||(n[20]=[e("option",{value:""},"All Swing",-1),e("option",{value:"stop"},"Stop",-1),e("option",{value:"swing"},"Swing",-1)])],512),[[Se,A.value]]),le.value?(l(),s("button",{key:0,onClick:H,class:"btn-clear-filters"},[...n[21]||(n[21]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),_(" Clear ",-1)])])):x("",!0)])])):x("",!0),p.value.length===0?(l(),s("div",Qa,[...n[22]||(n[22]=[e("i",{class:"mdi mdi-alert-circle"},null,-1),e("p",null,"No commands found in this code",-1)])])):N.value.length===0?(l(),s("div",ei,[n[23]||(n[23]=e("i",{class:"mdi mdi-filter-off"},null,-1)),n[24]||(n[24]=e("p",null,"No commands match your filters",-1)),e("button",{onClick:H,class:"btn-secondary-small"}," Clear Filters ")])):(l(),s("div",ti,[(l(!0),s(pe,null,ke(N.value,q=>(l(),s("div",{key:q.name,class:Y(["command-item",{tested:E.value.has(q.name),testing:z.value===q.name}])},[e("div",oi,[e("i",{class:Y(["mdi",Q(q.mode||q.name)])},null,2),e("span",null,m(q.label||q.name),1)]),e("div",li,[E.value.has(q.name)?(l(),s("span",ni,[...n[25]||(n[25]=[e("i",{class:"mdi mdi-check"},null,-1),_(" Tested ",-1)])])):x("",!0),e("button",{onClick:ae=>S(q.name),disabled:!b.value||z.value===q.name,title:b.value?"Test this command":"Select a Broadlink device first",class:"btn-test"},[e("i",{class:Y(["mdi",z.value===q.name?"mdi-loading mdi-spin":"mdi-play"])},null,2),n[26]||(n[26]=_(" Test ",-1))],8,si)])],2))),128))]))]),e("div",{class:"modal-actions"},[e("button",{onClick:u,class:"btn-primary"},[...n[27]||(n[27]=[e("i",{class:"mdi mdi-download"},null,-1),_(" Download JSON ",-1)])]),e("button",{onClick:se,class:"btn-secondary"}," Close ")])])):(l(),s("div",Aa,[n[13]||(n[13]=e("div",{class:"info-banner"},[e("i",{class:"mdi mdi-information"}),e("p",null,"Select a SmartIR code from the index to test commands with your Broadlink device.")],-1)),e("div",Ea,[n[11]||(n[11]=e("label",null,[e("i",{class:"mdi mdi-shape"}),_(" Platform ")],-1)),W(e("select",{"onUpdate:modelValue":n[0]||(n[0]=q=>i.value=q),onChange:V,class:"form-select"},[...n[10]||(n[10]=[e("option",{value:"climate"},"Climate (AC/Heater)",-1),e("option",{value:"media_player"},"Media Player (TV/Audio)",-1),e("option",{value:"fan"},"Fan",-1),e("option",{value:"light"},"Light",-1)])],544),[[Se,i.value]])]),e("div",Oa,[be(ze,{modelValue:c.value,"onUpdate:modelValue":n[1]||(n[1]=q=>c.value=q),options:f.value,label:"Manufacturer",placeholder:"Search manufacturers...",loading:C.value,disabled:C.value,onChange:ye},null,8,["modelValue","options","loading","disabled"])]),e("div",Va,[be(ze,{modelValue:T.value,"onUpdate:modelValue":n[2]||(n[2]=q=>T.value=q),options:M.value,"option-label":"label","option-value":"code",label:"Model",placeholder:"Search models...",loading:t.value,disabled:!c.value||t.value,onChange:Ie},null,8,["modelValue","options","loading","disabled"])]),$.value?(l(),s("div",Ua,[n[12]||(n[12]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[e("strong",null,m(c.value)+" - "+m($.value.models[0]),1),e("p",null,"Code: "+m($.value.code),1)])])):x("",!0),e("div",Pa,[e("button",{onClick:Le,disabled:!$.value||D.value,class:"btn-primary"},[e("i",{class:Y(["mdi",D.value?"mdi-loading mdi-spin":"mdi-download"])},null,2),_(" "+m(D.value?"Loading...":"Load Commands"),1)],8,Fa)])]))])])])):x("",!0)}}},ii=we(ai,[["__scopeId","data-v-66569200"]]),ri={class:"smartir-status-card"},di={class:"card-header"},ui=["src"],ci={class:"header-badges"},mi=["title"],vi={class:"header-info"},pi={class:"header-info"},fi={class:"header-info"},gi={class:"header-right"},yi={key:1,class:"settings-menu-container"},bi={key:0,class:"card-body loading-state"},hi={key:1,class:"card-body error-state"},ki={key:2,class:"card-body installed-state"},wi={key:0,class:"help-panel"},$i={key:0,class:"recommendation"},Ci={key:0,class:"next-steps"},_i={class:"help-actions"},Si={key:1,class:"filter-bar"},Ii={class:"filter-search-row"},Di=["title"],xi={key:0,class:"filter-badge"},Ti={class:"search-input-wrapper"},Mi={class:"filter-content"},Ri={class:"filter-row"},Li={class:"filter-group"},Ai={key:1,class:"view-toggle-group"},Ei={class:"filter-results"},Oi={key:2,class:"loading-state"},Vi={key:3,class:"empty-state"},Ui={key:4,class:"profiles-grid"},Pi={key:6,class:"no-results"},Fi={key:3,class:"card-body not-installed-state"},ji={class:"benefits-section"},Ni={class:"benefits-list"},Bi={class:"recommendation"},Hi={__name:"SmartIRStatusCard",emits:["create-profile","edit-profile"],setup(o,{expose:v,emit:d}){const k=d,h=Te("smartirStatus");Te("smartirEnabled");const i=Te("refreshSmartIR"),{isMobile:c}=Ke(),f=g(!1),C=g(null),$=g((h==null?void 0:h.value)||null),T=g(localStorage.getItem("smartir_simulate_not_installed")==="true"),w=g(!1),t=g(!1),M=g(!0),G=g([]),P=g(!1),D=g(!1),a=g({search:"",platform:""}),b=g({show:!1,title:"",message:"",platform:null,profile:null}),p=g(!1),z=g(window.innerWidth<=767?"grid":localStorage.getItem("profile_view_mode")||"grid");ue(c,I=>{I&&z.value==="list"&&(z.value="grid")}),ue(z,I=>{localStorage.setItem("profile_view_mode",I)});const j=["Full climate entity support (AC, heaters)","120+ pre-configured device profiles","Temperature and humidity sensor integration","HVAC mode control (heat, cool, auto, dry, fan)"],ee=["climate","media_player","fan","light"],ie=J(()=>T.value?{installed:!1,recommendation:{message:"Install SmartIR to unlock climate device support!",benefits:["Full climate entity support (AC, heaters)","120+ pre-configured device profiles","Temperature and humidity sensor integration","HVAC mode control (heat, cool, auto, dry, fan)"]}}:$.value),A=J(()=>{var I,n;return((n=(I=ie.value)==null?void 0:I.platforms)==null?void 0:n.length)||0}),N=J(()=>{var I;return(I=ie.value)!=null&&I.device_counts?Object.values(ie.value.device_counts).reduce((n,X)=>n+X,0):0});function le(){var I;T.value=!T.value,localStorage.setItem("smartir_simulate_not_installed",T.value.toString()),!T.value&&((I=$.value)!=null&&I.installed)&&Ie()}const me=J(()=>{let I=G.value;if(a.value.search){const n=a.value.search.toLowerCase();I=I.filter(X=>{var q,ae,O,r;return((q=X.manufacturer)==null?void 0:q.toLowerCase().includes(n))||((ae=X.model)==null?void 0:ae.toLowerCase().includes(n))||((O=X.code)==null?void 0:O.toString().includes(n))||((r=X.platform)==null?void 0:r.toLowerCase().includes(n))})}return a.value.platform&&(I=I.filter(n=>n.platform===a.value.platform)),I}),ce=J(()=>a.value.search||a.value.platform),De=J(()=>{let I=0;return a.value.search&&I++,a.value.platform&&I++,I});function Le(){a.value.search="",a.value.platform=""}async function xe(){f.value=!0,C.value=null;try{if(i)await i();else{const I=await lt.getStatus();$.value=I}}catch(I){C.value=I.message||"Failed to refresh SmartIR status",console.error("Error refreshing SmartIR status:",I)}finally{f.value=!1}}function S(){k("create-profile")}function u(){w.value=!w.value,t.value=!1}function V(){p.value=!0,t.value=!1}function ye(){window.open("https://github.com/smartHomeHub/SmartIR","_blank")}async function Ie(){P.value=!0;const I=[];try{for(const n of ee)try{const q=((await ne.get(`/api/smartir/platforms/${n}/profiles`)).data.profiles||[]).map(ae=>({...ae,platform:n}));I.push(...q)}catch(X){console.warn(`Network error loading ${n} profiles (using bundled index):`,X.message)}G.value=I}catch(n){console.error("Unexpected error loading profiles:",n)}finally{P.value=!1}}function H(I,n,X){k("edit-profile",{platform:I,profile:n,startStep:X})}async function R(I,n){var X,q;try{const O=(await ne.get(`/api/smartir/platforms/${I}/profiles/${n.code}`)).data,r=JSON.stringify(O.profile,null,2),F=new Blob([r],{type:"application/json"}),Z=URL.createObjectURL(F),re=document.createElement("a");re.href=Z,re.download=`smartir_${I}_${n.manufacturer}_${n.model}_${n.code}.json`,document.body.appendChild(re),re.click(),document.body.removeChild(re),URL.revokeObjectURL(Z),(X=Te("toast").value)==null||X.success(`Downloaded ${n.manufacturer} ${n.model}`,"âœ… Profile Downloaded")}catch(ae){console.error("Error downloading profile:",ae),(q=Te("toast").value)==null||q.error("Failed to download profile","âŒ Download Error")}}async function Q(I,n){Te("toast");try{const q=(await ne.post(`/api/smartir/profiles/${n.code}/check-usage`,{platform:I})).data;if(q&&q.in_use){b.value={show:!0,title:`Cannot Delete ${n.manufacturer} ${n.model}`,message:`This profile is currently in use by ${q.device_count} device(s):

${q.devices.join(`
`)}

Please remove or reassign these devices before deleting the profile.`,platform:I,profile:n,canDelete:!1,devices:q.devices};return}}catch(X){console.error("Error checking profile usage:",X)}b.value={show:!0,title:`Delete ${n.manufacturer} ${n.model}?`,message:`Device Code: ${n.code}

This will remove the profile and update your configuration.`,platform:I,profile:n,canDelete:!0}}async function se(){var q,ae;const I=Te("toast"),{platform:n,profile:X}=b.value;b.value.show=!1;try{await ne.delete(`/api/smartir/profiles/${X.code}`,{data:{platform:n}}),await Ie(),await et(),await xe(),(q=I.value)==null||q.success(`${X.manufacturer} ${X.model} has been removed`,"âœ… Profile Deleted")}catch(O){console.error("Error deleting profile:",O),(ae=I.value)==null||ae.error("Failed to delete profile","âŒ Delete Error")}}return ue(h,I=>{I&&($.value=I)},{immediate:!0}),ue(z,I=>{localStorage.setItem("profile_view_mode",I)}),Re(async()=>{var I;h!=null&&h.value&&($.value=h.value),$.value||await xe(),(I=$.value)!=null&&I.installed&&await Ie()}),v({loadAllProfiles:Ie,refreshStatus:xe}),(I,n)=>{var X,q,ae,O,r,F,Z,re;return l(),s("div",ri,[e("div",di,[e("button",{class:"icon-button chevron-button",onClick:n[0]||(n[0]=K=>M.value=!M.value)},[e("i",{class:Y(["mdi",M.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2)]),e("div",{class:"header-left",onClick:n[1]||(n[1]=K=>M.value=!M.value)},[e("img",{src:$e(Xe),alt:"SmartIR",class:"smartir-logo"},null,8,ui),e("h3",null,m($e(c)?"SmartIR":"SmartIR Integration"),1),e("div",ci,[e("div",{class:Y(["simulation-toggle-pill",{active:T.value}]),onClick:he(le,["stop"]),title:T.value?"Click to show as installed":"Click to simulate not-installed"},[e("i",{class:Y(["mdi",T.value?"mdi-eye-off":"mdi-eye"])},null,2),e("span",null,m(T.value?"Simulating: Not Installed":"Simulation Mode"),1)],10,mi),(X=ie.value)!=null&&X.installed?(l(),s(pe,{key:0},[n[17]||(n[17]=e("div",{class:"status-badge-mini success"},[e("i",{class:"mdi mdi-check-circle"}),e("span",null,"Installed")],-1)),e("span",vi,"v"+m(ie.value.version||"Unknown"),1),e("span",pi,m(A.value)+" platform"+m(A.value!==1?"s":""),1),e("span",fi,m(N.value)+" device"+m(N.value!==1?"s":""),1)],64)):x("",!0)])]),e("div",gi,[(q=ie.value)!=null&&q.installed?(l(),s("button",{key:0,onClick:he(S,["stop"]),class:"btn btn-primary new-button"},[...n[18]||(n[18]=[e("i",{class:"mdi mdi-plus"},null,-1),e("span",null,"New",-1)])])):x("",!0),(ae=ie.value)!=null&&ae.installed?(l(),s("div",yi,[e("button",{onClick:n[2]||(n[2]=he(K=>t.value=!t.value,["stop"])),class:Y(["icon-button settings-button",{active:t.value}]),title:"Settings"},[...n[19]||(n[19]=[e("i",{class:"mdi mdi-cog"},null,-1)])],2),t.value?(l(),s("div",{key:0,class:"settings-dropdown",onClick:n[4]||(n[4]=he(()=>{},["stop"]))},[e("button",{onClick:u,class:"menu-item"},[n[20]||(n[20]=e("i",{class:"mdi mdi-help-circle"},null,-1)),e("span",null,m(w.value?"Hide Help":"Show Help"),1)]),e("button",{onClick:n[3]||(n[3]=K=>{t.value=!1,xe()}),class:"menu-item"},[...n[21]||(n[21]=[e("i",{class:"mdi mdi-refresh"},null,-1),e("span",null,"Refresh Status",-1)])]),e("button",{onClick:V,class:"menu-item"},[...n[22]||(n[22]=[e("i",{class:"mdi mdi-test-tube"},null,-1),e("span",null,"Test Codes",-1)])])])):x("",!0)])):x("",!0)])]),W(e("div",null,[f.value?(l(),s("div",bi,[...n[23]||(n[23]=[e("div",{class:"spinner"},null,-1),e("p",null,"Checking SmartIR installation...",-1)])])):C.value?(l(),s("div",hi,[n[24]||(n[24]=e("i",{class:"mdi mdi-alert-circle"},null,-1)),e("p",null,m(C.value),1),e("button",{onClick:xe,class:"btn-secondary"}," Try Again ")])):(O=ie.value)!=null&&O.installed?(l(),s("div",ki,[w.value?(l(),s("div",wi,[$.value.recommendation?(l(),s("div",$i,[e("p",null,m($.value.recommendation.message),1),$.value.recommendation.next_steps?(l(),s("div",Ci,[n[25]||(n[25]=e("strong",null,"Next Steps:",-1)),e("ul",null,[(l(!0),s(pe,null,ke($.value.recommendation.next_steps,(K,te)=>(l(),s("li",{key:te},m(K),1))),128))])])):x("",!0)])):x("",!0),e("div",_i,[e("button",{onClick:n[5]||(n[5]=(...K)=>I.viewDocumentation&&I.viewDocumentation(...K)),class:"btn-secondary"},[...n[26]||(n[26]=[e("i",{class:"mdi mdi-book-open-variant"},null,-1),_(" View Documentation ",-1)])])])])):x("",!0),G.value.length>0&&!T.value?(l(),s("div",Si,[e("div",Ii,[e("button",{class:Y(["filter-toggle-button",{active:D.value||ce.value}]),onClick:n[6]||(n[6]=K=>D.value=!D.value),title:D.value?"Hide filters":"Show filters"},[n[27]||(n[27]=e("i",{class:"mdi mdi-filter-variant"},null,-1)),ce.value?(l(),s("span",xi,m(De.value),1)):x("",!0)],10,Di),e("div",Ti,[n[28]||(n[28]=e("i",{class:"mdi mdi-magnify search-icon"},null,-1)),W(e("input",{"onUpdate:modelValue":n[7]||(n[7]=K=>a.value.search=K),type:"text",placeholder:"Search profiles...",class:"search-input"},null,512),[[Me,a.value.search]])])]),W(e("div",Mi,[e("div",Ri,[e("div",Li,[e("label",null,[n[30]||(n[30]=e("i",{class:"mdi mdi-shape"},null,-1)),W(e("select",{"onUpdate:modelValue":n[8]||(n[8]=K=>a.value.platform=K)},[...n[29]||(n[29]=[Ue('<option value="" data-v-3efa9d36>All Platforms</option><option value="climate" data-v-3efa9d36>Climate</option><option value="media_player" data-v-3efa9d36>Media Player</option><option value="fan" data-v-3efa9d36>Fan</option><option value="light" data-v-3efa9d36>Light</option>',5)])],512),[[Se,a.value.platform]])])]),ce.value?(l(),s("button",{key:0,onClick:Le,class:"btn-clear-filters"},[...n[31]||(n[31]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),_(" Clear ",-1)])])):x("",!0),$e(c)?x("",!0):(l(),s("div",Ai,[e("button",{onClick:n[9]||(n[9]=K=>z.value="grid"),class:Y(["view-toggle-btn",{active:z.value==="grid"}]),title:"Grid View"},[...n[32]||(n[32]=[e("i",{class:"mdi mdi-view-grid"},null,-1),_(" Grid ",-1)])],2),e("button",{onClick:n[10]||(n[10]=K=>z.value="list"),class:Y(["view-toggle-btn",{active:z.value==="list"}]),title:"List View"},[...n[33]||(n[33]=[e("i",{class:"mdi mdi-view-list"},null,-1),_(" List ",-1)])],2)])),e("div",Ei,m(me.value.length)+" of "+m(G.value.length),1)])],512),[[qe,D.value]])])):x("",!0),P.value?(l(),s("div",Oi,[...n[34]||(n[34]=[e("i",{class:"mdi mdi-loading mdi-spin"},null,-1),e("p",null,"Loading profiles...",-1)])])):G.value.length===0?(l(),s("div",Vi,[...n[35]||(n[35]=[e("i",{class:"mdi mdi-file-document-outline"},null,-1),e("h3",null,"No Profiles Yet",-1),e("p",null,"Create your first SmartIR profile to get started",-1)])])):x("",!0),z.value==="grid"&&!T.value?(l(),s("div",Ui,[(l(!0),s(pe,null,ke(me.value,K=>(l(),Ee(ia,{key:`${K.platform}-${K.code}`,profile:K,onEdit:te=>H(K.platform,K),onCommands:te=>H(K.platform,K,2),onDownload:te=>R(K.platform,K),onDelete:te=>Q(K.platform,K)},null,8,["profile","onEdit","onCommands","onDownload","onDelete"]))),128))])):z.value==="list"&&!T.value&&me.value.length>0?(l(),Ee(Ma,{key:5,profiles:me.value,onEdit:n[11]||(n[11]=K=>H(K.platform,K)),onCommands:n[12]||(n[12]=K=>H(K.platform,K,2)),onDownload:n[13]||(n[13]=K=>R(K.platform,K)),onDelete:n[14]||(n[14]=K=>Q(K.platform,K))},null,8,["profiles"])):x("",!0),G.value.length>0&&me.value.length===0&&!T.value?(l(),s("div",Pi,[...n[36]||(n[36]=[e("i",{class:"mdi mdi-filter-off"},null,-1),e("h3",null,"No profiles match your filters",-1),e("p",null,"Try adjusting your search or filter criteria",-1)])])):x("",!0)])):(l(),s("div",Fi,[n[40]||(n[40]=e("div",{class:"status-badge warning"},[e("i",{class:"mdi mdi-information"}),e("span",null,"Not Installed")],-1)),e("div",ji,[n[38]||(n[38]=e("h4",null,"Why Install SmartIR?",-1)),e("ul",Ni,[(l(!0),s(pe,null,ke(((F=(r=$.value)==null?void 0:r.recommendation)==null?void 0:F.benefits)||j,(K,te)=>(l(),s("li",{key:te},[n[37]||(n[37]=e("i",{class:"mdi mdi-check"},null,-1)),e("span",null,m(K),1)]))),128))])]),e("div",Bi,[e("p",null,m(((re=(Z=$.value)==null?void 0:Z.recommendation)==null?void 0:re.message)||"Install SmartIR to unlock climate device support!"),1)]),e("div",{class:"card-actions"},[e("button",{onClick:ye,class:"btn-primary"},[...n[39]||(n[39]=[e("i",{class:"mdi mdi-github"},null,-1),_(" Install SmartIR ",-1)])])])]))],512),[[qe,M.value]]),be(Ve,{isOpen:b.value.show,title:b.value.title,message:b.value.message,confirmText:b.value.canDelete===!1?null:"Delete",cancelText:"Close",dangerMode:!0,confirmDisabled:b.value.canDelete===!1,onConfirm:se,onCancel:n[15]||(n[15]=K=>b.value.show=!1)},null,8,["isOpen","title","message","confirmText","confirmDisabled"]),be(ii,{isOpen:p.value,onClose:n[16]||(n[16]=K=>p.value=!1)},null,8,["isOpen"])])}}},qi=we(Hi,[["__scopeId","data-v-3efa9d36"]]),zi={class:"climate-form"},Ji={class:"learning-mode-section"},Wi={class:"mode-toggle"},Gi={class:"mode-content"},Ki={class:"mode-stats"},Xi={class:"stat-badge"},Yi={class:"stat-badge time"},Zi={class:"mode-content"},Qi={class:"mode-stats"},er={class:"stat-badge"},tr={class:"stat-badge time warning"},or={key:0,class:"command-breakdown"},lr={class:"warning-text"},nr={class:"form-section"},sr={key:0,class:"help-text"},ar={key:1,class:"help-text"},ir={class:"form-row"},rr={class:"form-group"},dr={class:"form-group"},ur={class:"form-group"},cr={key:2,class:"representative-temp-section"},mr={class:"form-group"},vr=["value"],pr={class:"form-section"},fr={class:"checkbox-grid"},gr={class:"checkbox-item"},yr={class:"checkbox-item"},br={class:"checkbox-item"},hr={class:"checkbox-item"},kr={class:"checkbox-item"},wr={class:"checkbox-item"},$r={class:"form-section"},Cr={class:"checkbox-grid"},_r={class:"checkbox-item"},Sr={class:"checkbox-item"},Ir={class:"checkbox-item"},Dr={class:"checkbox-item"},xr={class:"form-section"},Tr={class:"checkbox-grid"},Mr={class:"checkbox-item"},Rr={class:"checkbox-item"},Lr={class:"checkbox-item"},Ar={class:"checkbox-item"},Er={class:"form-section"},Or={class:"form-group"},Vr={class:"form-group"},Ur={class:"form-group"},Pr={key:0,class:"validation-summary"},Fr={__name:"ClimateProfileForm",props:{modelValue:{type:Object,default:()=>({})}},emits:["update:modelValue"],setup(o,{emit:v}){const d=o,k=v,h=g("quick"),i=g({minTemp:16,maxTemp:30,precision:1,representativeTemp:24,modes:["off","auto","cool","heat"],fanModes:["auto","low","medium","high"],swingModes:[],tempSensor:"",humiditySensor:"",powerSensor:"",learningMode:"quick",...d.modelValue}),c=J(()=>{const D=[],a=i.value.minTemp||16,b=i.value.maxTemp||30,p=i.value.precision||1;for(let E=a;E<=b;E+=p)D.push(E);return D}),f=J(()=>i.value.modes.filter(D=>D!=="off").length),C=J(()=>i.value.fanModes.length||1),$=J(()=>i.value.swingModes.length||1),T=J(()=>{const D=i.value.minTemp||16,a=i.value.maxTemp||30,b=i.value.precision||1;return Math.floor((a-D)/b)+1}),w=J(()=>{const D=i.value.modes.includes("off")?1:0;return f.value*C.value*$.value+D}),t=J(()=>Math.ceil(w.value*30/60)),M=J(()=>{const D=i.value.modes.includes("off")?1:0;return f.value*T.value*C.value*$.value+D}),G=J(()=>Math.ceil(M.value*30/60)),P=J(()=>{const D=[];return(!i.value.minTemp||i.value.minTemp<10||i.value.minTemp>35)&&D.push("Minimum temperature must be between 10Â°C and 35Â°C"),(!i.value.maxTemp||i.value.maxTemp<10||i.value.maxTemp>35)&&D.push("Maximum temperature must be between 10Â°C and 35Â°C"),i.value.minTemp>=i.value.maxTemp&&D.push("Minimum temperature must be less than maximum temperature"),(!i.value.modes||i.value.modes.length===0)&&D.push("At least one HVAC mode must be selected"),D});return ue(h,D=>{i.value.learningMode=D}),ue(i,D=>{k("update:modelValue",D)},{deep:!0,immediate:!0}),(D,a)=>(l(),s("div",zi,[a[63]||(a[63]=e("h3",null,"Climate Device Configuration",-1)),e("div",Ji,[e("div",Wi,[e("label",{class:Y(["mode-option",{active:h.value==="quick"}])},[W(e("input",{type:"radio",value:"quick","onUpdate:modelValue":a[0]||(a[0]=b=>h.value=b)},null,512),[[He,h.value]]),e("div",Gi,[a[23]||(a[23]=e("div",{class:"mode-header"},[e("i",{class:"mdi mdi-flash"}),e("strong",null,"Quick Mode (Recommended)")],-1)),a[24]||(a[24]=e("p",null,"Learn one temperature per mode combination",-1)),e("div",Ki,[e("span",Xi,m(w.value)+" commands",1),e("span",Yi,"~"+m(t.value)+" min",1)])])],2),e("label",{class:Y(["mode-option",{active:h.value==="complete"}])},[W(e("input",{type:"radio",value:"complete","onUpdate:modelValue":a[1]||(a[1]=b=>h.value=b)},null,512),[[He,h.value]]),e("div",Zi,[a[25]||(a[25]=e("div",{class:"mode-header"},[e("i",{class:"mdi mdi-check-all"}),e("strong",null,"Complete Mode")],-1)),a[26]||(a[26]=e("p",null,"Learn all temperature combinations",-1)),e("div",Qi,[e("span",er,m(M.value)+" commands",1),e("span",tr,"~"+m(G.value)+" min",1)])])],2)]),h.value==="complete"?(l(),s("div",or,[a[27]||(a[27]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[e("strong",null,"Complete mode will require learning "+m(M.value)+" commands",1),e("p",null,"This includes all combinations of modes ("+m(f.value)+"), temperatures ("+m(T.value)+"), fan speeds ("+m(C.value)+"), and swing modes ("+m($.value)+").",1),e("p",lr,"â±ï¸ Estimated time: "+m(G.value)+" minutes at ~30 seconds per command",1)])])):x("",!0)]),e("div",nr,[a[33]||(a[33]=e("h4",null,"Temperature Range",-1)),h.value==="quick"?(l(),s("p",sr," Define the full temperature range your device supports. You'll select one temperature to learn below. ")):(l(),s("p",ar," Define the temperature range. All temperatures in this range will be learned. ")),e("div",ir,[e("div",rr,[a[28]||(a[28]=e("label",null,"Minimum Temperature (Â°C) *",-1)),W(e("input",{"onUpdate:modelValue":a[2]||(a[2]=b=>i.value.minTemp=b),type:"number",min:"10",max:"35",placeholder:"16"},null,512),[[Me,i.value.minTemp,void 0,{number:!0}]])]),e("div",dr,[a[29]||(a[29]=e("label",null,"Maximum Temperature (Â°C) *",-1)),W(e("input",{"onUpdate:modelValue":a[3]||(a[3]=b=>i.value.maxTemp=b),type:"number",min:"10",max:"35",placeholder:"30"},null,512),[[Me,i.value.maxTemp,void 0,{number:!0}]])]),e("div",ur,[a[31]||(a[31]=e("label",null,"Precision",-1)),W(e("select",{"onUpdate:modelValue":a[4]||(a[4]=b=>i.value.precision=b)},[...a[30]||(a[30]=[e("option",{value:1},"1Â°C (Whole degrees)",-1),e("option",{value:.5},"0.5Â°C (Half degrees)",-1)])],512),[[Se,i.value.precision,void 0,{number:!0}]])])]),h.value==="quick"?(l(),s("div",cr,[e("div",mr,[a[32]||(a[32]=e("label",null,"Representative Temperature to Learn *",-1)),W(e("select",{"onUpdate:modelValue":a[5]||(a[5]=b=>i.value.representativeTemp=b)},[(l(!0),s(pe,null,ke(c.value,b=>(l(),s("option",{key:b,value:b},m(b)+"Â°C ",9,vr))),128))],512),[[Se,i.value.representativeTemp,void 0,{number:!0}]]),e("small",null,"This temperature will be learned for all mode combinations. The device profile will still show the full range ("+m(i.value.minTemp)+"Â°C - "+m(i.value.maxTemp)+"Â°C).",1)])])):x("",!0)]),e("div",pr,[a[40]||(a[40]=e("h4",null,"Supported HVAC Modes *",-1)),a[41]||(a[41]=e("p",{class:"help-text"},"Select all modes your device supports",-1)),e("div",fr,[e("label",gr,[W(e("input",{type:"checkbox",value:"off","onUpdate:modelValue":a[6]||(a[6]=b=>i.value.modes=b)},null,512),[[ge,i.value.modes]]),a[34]||(a[34]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),_(" Off ")],-1))]),e("label",yr,[W(e("input",{type:"checkbox",value:"auto","onUpdate:modelValue":a[7]||(a[7]=b=>i.value.modes=b)},null,512),[[ge,i.value.modes]]),a[35]||(a[35]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-autorenew"}),_(" Auto ")],-1))]),e("label",br,[W(e("input",{type:"checkbox",value:"cool","onUpdate:modelValue":a[8]||(a[8]=b=>i.value.modes=b)},null,512),[[ge,i.value.modes]]),a[36]||(a[36]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-snowflake"}),_(" Cool ")],-1))]),e("label",hr,[W(e("input",{type:"checkbox",value:"heat","onUpdate:modelValue":a[9]||(a[9]=b=>i.value.modes=b)},null,512),[[ge,i.value.modes]]),a[37]||(a[37]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fire"}),_(" Heat ")],-1))]),e("label",kr,[W(e("input",{type:"checkbox",value:"dry","onUpdate:modelValue":a[10]||(a[10]=b=>i.value.modes=b)},null,512),[[ge,i.value.modes]]),a[38]||(a[38]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-water-percent"}),_(" Dry ")],-1))]),e("label",wr,[W(e("input",{type:"checkbox",value:"fan_only","onUpdate:modelValue":a[11]||(a[11]=b=>i.value.modes=b)},null,512),[[ge,i.value.modes]]),a[39]||(a[39]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan"}),_(" Fan Only ")],-1))])])]),e("div",$r,[a[46]||(a[46]=e("h4",null,"Fan Modes",-1)),a[47]||(a[47]=e("p",{class:"help-text"},"Select all fan speeds your device supports",-1)),e("div",Cr,[e("label",_r,[W(e("input",{type:"checkbox",value:"auto","onUpdate:modelValue":a[12]||(a[12]=b=>i.value.fanModes=b)},null,512),[[ge,i.value.fanModes]]),a[42]||(a[42]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-autorenew"}),_(" Auto ")],-1))]),e("label",Sr,[W(e("input",{type:"checkbox",value:"low","onUpdate:modelValue":a[13]||(a[13]=b=>i.value.fanModes=b)},null,512),[[ge,i.value.fanModes]]),a[43]||(a[43]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-1"}),_(" Low ")],-1))]),e("label",Ir,[W(e("input",{type:"checkbox",value:"medium","onUpdate:modelValue":a[14]||(a[14]=b=>i.value.fanModes=b)},null,512),[[ge,i.value.fanModes]]),a[44]||(a[44]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-2"}),_(" Medium ")],-1))]),e("label",Dr,[W(e("input",{type:"checkbox",value:"high","onUpdate:modelValue":a[15]||(a[15]=b=>i.value.fanModes=b)},null,512),[[ge,i.value.fanModes]]),a[45]||(a[45]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-3"}),_(" High ")],-1))])])]),e("div",xr,[a[52]||(a[52]=e("h4",null,"Swing Modes (Optional)",-1)),a[53]||(a[53]=e("p",{class:"help-text"},"Select if your device has swing/oscillation",-1)),e("div",Tr,[e("label",Mr,[W(e("input",{type:"checkbox",value:"off","onUpdate:modelValue":a[16]||(a[16]=b=>i.value.swingModes=b)},null,512),[[ge,i.value.swingModes]]),a[48]||(a[48]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-horizontal"}),_(" Off ")],-1))]),e("label",Rr,[W(e("input",{type:"checkbox",value:"vertical","onUpdate:modelValue":a[17]||(a[17]=b=>i.value.swingModes=b)},null,512),[[ge,i.value.swingModes]]),a[49]||(a[49]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-vertical"}),_(" Vertical ")],-1))]),e("label",Lr,[W(e("input",{type:"checkbox",value:"horizontal","onUpdate:modelValue":a[18]||(a[18]=b=>i.value.swingModes=b)},null,512),[[ge,i.value.swingModes]]),a[50]||(a[50]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-horizontal"}),_(" Horizontal ")],-1))]),e("label",Ar,[W(e("input",{type:"checkbox",value:"both","onUpdate:modelValue":a[19]||(a[19]=b=>i.value.swingModes=b)},null,512),[[ge,i.value.swingModes]]),a[51]||(a[51]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-arrow-all"}),_(" Both ")],-1))])])]),e("div",Er,[a[60]||(a[60]=e("h4",null,"Sensors (Optional)",-1)),a[61]||(a[61]=e("p",{class:"help-text"},"Link external sensors for better climate control",-1)),e("div",Or,[a[54]||(a[54]=e("label",null,"Temperature Sensor",-1)),W(e("input",{"onUpdate:modelValue":a[20]||(a[20]=b=>i.value.tempSensor=b),type:"text",placeholder:"sensor.living_room_temperature"},null,512),[[Me,i.value.tempSensor]]),a[55]||(a[55]=e("small",null,"Entity ID of temperature sensor",-1))]),e("div",Vr,[a[56]||(a[56]=e("label",null,"Humidity Sensor",-1)),W(e("input",{"onUpdate:modelValue":a[21]||(a[21]=b=>i.value.humiditySensor=b),type:"text",placeholder:"sensor.living_room_humidity"},null,512),[[Me,i.value.humiditySensor]]),a[57]||(a[57]=e("small",null,"Entity ID of humidity sensor",-1))]),e("div",Ur,[a[58]||(a[58]=e("label",null,"Power Sensor",-1)),W(e("input",{"onUpdate:modelValue":a[22]||(a[22]=b=>i.value.powerSensor=b),type:"text",placeholder:"binary_sensor.ac_power"},null,512),[[Me,i.value.powerSensor]]),a[59]||(a[59]=e("small",null,"Entity ID of power sensor (to detect on/off state)",-1))])]),P.value.length>0?(l(),s("div",Pr,[a[62]||(a[62]=e("h4",null,[e("i",{class:"mdi mdi-alert-circle"}),_(" Please fix the following: ")],-1)),e("ul",null,[(l(!0),s(pe,null,ke(P.value,(b,p)=>(l(),s("li",{key:p},m(b),1))),128))])])):x("",!0)]))}},jr=we(Fr,[["__scopeId","data-v-c44d7198"]]),Nr={class:"command-wizard"},Br={class:"device-selection-section"},Hr={class:"input-wrapper"},qr=["value"],zr={key:0,class:"validation-tooltip"},Jr={class:"form-group"},Wr=["disabled"],Gr={key:0},Kr={key:1},Xr={key:0,class:"edit-mode-banner"},Yr={class:"wizard-info"},Zr={key:0},Qr={key:1},ed={class:"progress-info"},td={class:"progress-bar"},od={class:"progress-text"},ld={class:"commands-grid"},nd={class:"command-header"},sd={class:"command-icon"},ad={class:"command-info"},id={key:0,class:"learning-indicator"},rd={key:0,class:"ir-learning-steps"},dd={key:1,class:"rf-learning-steps"},ud={class:"command-actions"},cd=["onClick","disabled"],md={key:1,class:"learned-status"},vd=["onClick","disabled"],pd=["onClick"],fd={class:"quick-actions"},gd=["disabled"],yd=["disabled"],bd={__name:"CommandLearningWizard",props:{modelValue:{type:Object,default:()=>({})},platform:{type:String,required:!0},config:{type:Object,required:!0},broadlinkDevice:{type:String,default:""},manufacturer:{type:String,required:!0},model:{type:String,required:!0},commandType:{type:String,default:"ir"}},emits:["update:modelValue","update:broadlinkDevice","update:commandType"],setup(o,{emit:v}){const d=Fe(),k=o,h=v,i=g({...k.modelValue}),c=g(null),f=g(null),C=g([]),$=g(k.broadlinkDevice),T=g(k.commandType),w=g(!1),t=g([]),M=g(!1),G=g(!1),P=g({show:!1,commandKey:null,commandLabel:""}),D=g(!1),a=J(()=>{const S=[];if(k.platform==="climate"){const u=k.config.modes||[],V=k.config.fanModes||[],ye=k.config.minTemp||16,Ie=k.config.maxTemp||30;u.forEach(H=>{if(H==="off")S.push({key:"off",label:"Power Off",description:"Turn device off",icon:"mdi mdi-power",mode:"off"});else for(let R=ye;R<=Ie;R++)V.forEach(Q=>{const se=`${H}_${R}_${Q}`;S.push({key:se,label:`${H.toUpperCase()} ${R}Â°C ${Q}`,description:`Mode: ${H}, Temp: ${R}Â°C, Fan: ${Q}`,icon:z(H),mode:H,temp:R,fanMode:Q})})})}else if(k.platform==="media_player"){const u=k.config.features||[];u.includes("turn_on")&&(S.push({key:"turn_on",label:"Power On",description:"Turn on the device",icon:"mdi mdi-power"}),S.push({key:"turn_off",label:"Power Off",description:"Turn off the device",icon:"mdi mdi-power-off"})),u.includes("volume")&&(S.push({key:"volume_up",label:"Volume Up",description:"Increase volume",icon:"mdi mdi-volume-plus"}),S.push({key:"volume_down",label:"Volume Down",description:"Decrease volume",icon:"mdi mdi-volume-minus"})),u.includes("mute")&&S.push({key:"mute",label:"Mute",description:"Toggle mute",icon:"mdi mdi-volume-mute"}),u.includes("source")&&(S.push({key:"source_hdmi1",label:"Source: HDMI 1",description:"Switch to HDMI 1",icon:"mdi mdi-import"}),S.push({key:"source_hdmi2",label:"Source: HDMI 2",description:"Switch to HDMI 2",icon:"mdi mdi-import"}),S.push({key:"source_hdmi3",label:"Source: HDMI 3",description:"Switch to HDMI 3",icon:"mdi mdi-import"})),u.includes("channel")&&(S.push({key:"channel_up",label:"Channel Up",description:"Next channel",icon:"mdi mdi-chevron-up"}),S.push({key:"channel_down",label:"Channel Down",description:"Previous channel",icon:"mdi mdi-chevron-down"}))}else if(k.platform==="fan"){const u=k.config.speedLevels||3,V=k.config.features||[];S.push({key:"turn_on",label:"Power On",description:"Turn on the fan",icon:"mdi mdi-power"}),S.push({key:"turn_off",label:"Power Off",description:"Turn off the fan",icon:"mdi mdi-power-off"});for(let ye=1;ye<=u;ye++){const Ie=ye===1?"Low":ye===u?"High":ye===2&&u===3?"Medium":`Speed ${ye}`;S.push({key:`speed_${ye}`,label:`${Ie}`,description:`Set fan to speed level ${ye}`,icon:"mdi mdi-fan"})}V.includes("oscillate")&&(S.push({key:"oscillate_on",label:"Oscillate On",description:"Enable oscillation",icon:"mdi mdi-sync"}),S.push({key:"oscillate_off",label:"Oscillate Off",description:"Disable oscillation",icon:"mdi mdi-sync-off"})),V.includes("direction")&&(S.push({key:"direction_forward",label:"Direction: Forward",description:"Set direction to forward",icon:"mdi mdi-rotate-right"}),S.push({key:"direction_reverse",label:"Direction: Reverse",description:"Set direction to reverse",icon:"mdi mdi-rotate-left"}))}else if(k.platform==="light"){const u=k.config.features||[];u.includes("turn_on")&&(S.push({key:"turn_on",label:"Power On",description:"Turn on the light",icon:"mdi mdi-lightbulb-on"}),S.push({key:"turn_off",label:"Power Off",description:"Turn off the light",icon:"mdi mdi-lightbulb-off"})),u.includes("brightness")&&(S.push({key:"brightness_up",label:"Brightness Up",description:"Increase brightness",icon:"mdi mdi-brightness-7"}),S.push({key:"brightness_down",label:"Brightness Down",description:"Decrease brightness",icon:"mdi mdi-brightness-5"})),u.includes("color_temp")&&(S.push({key:"color_temp_warm",label:"Warm White",description:"Set to warm white",icon:"mdi mdi-weather-sunset"}),S.push({key:"color_temp_cool",label:"Cool White",description:"Set to cool white",icon:"mdi mdi-weather-sunny"})),u.includes("rgb")&&(S.push({key:"color_red",label:"Color: Red",description:"Set color to red",icon:"mdi mdi-palette"}),S.push({key:"color_green",label:"Color: Green",description:"Set color to green",icon:"mdi mdi-palette"}),S.push({key:"color_blue",label:"Color: Blue",description:"Set color to blue",icon:"mdi mdi-palette"}))}return S}),b=J(()=>a.value.length),p=J(()=>Object.keys(i.value).length),E=J(()=>b.value===0?0:Math.round(p.value/b.value*100));function z(S){return{off:"mdi mdi-power",auto:"mdi mdi-autorenew",cool:"mdi mdi-snowflake",heat:"mdi mdi-fire",dry:"mdi mdi-water-percent",fan_only:"mdi mdi-fan"}[S]||"mdi mdi-remote"}async function j(S){if(!c.value){if(!$.value){G.value=!0,window.scrollTo({top:0,behavior:"smooth"});return}G.value=!1,c.value=S.key;try{const u=k.manufacturer.toLowerCase().replace(/[^a-z0-9]+/g,"_"),V=k.model.toLowerCase().replace(/[^a-z0-9]+/g,"_"),ye=`${u}_${V}`,H=(await ne.post("/api/commands/learn",{entity_id:$.value,device:ye,command:S.key,command_type:T.value})).data;if(H.success&&H.code)i.value[S.key]=H.code,h("update:modelValue",i.value),M.value=!0,H.code==="pending"&&console.log(`â³ Command '${S.key}' learned, code will be fetched from storage when saving`),w.value&&t.value.length>0&&setTimeout(()=>{const R=t.value.shift();R?j(R):w.value=!1},1e3);else throw new Error(H.error||"Failed to learn command")}catch(u){console.error("Error learning command:",u),d.error(`Error learning command: ${u.message}`),w.value=!1,t.value=[]}finally{w.value||(c.value=null)}}}async function ee(S){var u;if(!$.value){G.value=!0,window.scrollTo({top:0,behavior:"smooth"});return}if(!i.value[S]){(u=d.value)==null||u.error("Command not learned yet");return}f.value=S;try{const V=i.value[S];await ne.post("/api/commands/send-raw",{entity_id:$.value,command:V,command_type:T.value}),d.success("Command sent successfully")}catch(V){console.error("Error testing command:",V),d.error(`Error testing command: ${V.message}`)}finally{f.value=null}}function ie(S){const u=a.value.find(V=>V.key===S);P.value={show:!0,commandKey:S,commandLabel:u?u.label:S}}function A(){const S=P.value.commandKey;delete i.value[S],h("update:modelValue",i.value),P.value.show=!1}function N(){const S=a.value.filter(V=>!i.value[V.key]);if(S.length===0)return;w.value=!0,t.value=[...S];const u=t.value.shift();u&&j(u)}function le(){D.value=!0}function me(){i.value={},h("update:modelValue",i.value),D.value=!1}ue(()=>k.modelValue,S=>{i.value={...S}},{deep:!0}),Re(async()=>{await ce()});async function ce(){try{console.log("SmartIR device - commands will be loaded from SmartIR JSON file, not Broadlink storage")}catch(S){console.error("Error in loadExistingCommands:",S)}}function De(){h("update:broadlinkDevice",$.value)}function Le(){h("update:commandType",T.value)}async function xe(){try{console.log("ğŸ” Loading Broadlink devices from /api/remote/devices");const S=await ne.get("/api/remote/devices");console.log("ğŸ“¦ Response data:",S.data);const u=S.data.devices||[];console.log(`âœ… Found ${u.length} devices:`,u),C.value=u}catch(S){console.error("âŒ Error loading remote devices:",S),C.value=[]}}return ue(()=>k.broadlinkDevice,S=>{$.value=S}),ue($,S=>{S&&(G.value=!1)}),ue(()=>k.commandType,S=>{T.value=S}),Re(async()=>{await xe(),await ce()}),(S,u)=>(l(),s("div",Nr,[u[22]||(u[22]=e("h3",null,"Learn IR Commands",-1)),e("div",Br,[e("div",{class:Y(["form-group",{"has-error":G.value}])},[u[6]||(u[6]=e("label",null,"Broadlink Device *",-1)),e("div",Hr,[W(e("select",{"onUpdate:modelValue":u[0]||(u[0]=V=>$.value=V),onChange:De},[u[4]||(u[4]=e("option",{value:""},"Select Broadlink device...",-1)),(l(!0),s(pe,null,ke(C.value,V=>(l(),s("option",{key:V.entity_id,value:V.entity_id},m(V.name||V.entity_id),9,qr))),128))],544),[[Se,$.value]]),G.value?(l(),s("div",zr,[...u[5]||(u[5]=[e("i",{class:"mdi mdi-alert"},null,-1),_(" Device is required ",-1)])])):x("",!0)]),e("small",null,"This device will be used to learn commands ("+m(C.value.length)+" devices found)",1)],2),e("div",Jr,[u[8]||(u[8]=e("label",null,"Command Type *",-1)),W(e("select",{"onUpdate:modelValue":u[1]||(u[1]=V=>T.value=V),onChange:Le,disabled:p.value>0},[...u[7]||(u[7]=[e("option",{value:"ir"},"ğŸ“¡ Infrared (IR) - Most common for AC, TV, etc.",-1),e("option",{value:"rf"},"ğŸ“» Radio Frequency (RF) - For RF remotes",-1)])],40,Wr),[[Se,T.value]]),p.value>0?(l(),s("small",Gr,"Command type cannot be changed after learning commands")):(l(),s("small",Kr,"Select the type of commands your device uses"))])]),p.value>0&&!M.value?(l(),s("div",Xr,[u[10]||(u[10]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[u[9]||(u[9]=e("strong",null,"Editing Existing Profile",-1)),e("p",null,m(p.value)+" command"+m(p.value!==1?"s":"")+' already learned. You can re-learn any command by clicking the delete icon and then "Learn Command".',1)])])):x("",!0),e("div",Yr,[u[14]||(u[14]=e("i",{class:"mdi mdi-information"},null,-1)),e("div",null,[u[13]||(u[13]=e("p",null,[e("strong",null,"How it works:")],-1)),o.commandType==="ir"?(l(),s("ol",Zr,[...u[11]||(u[11]=[e("li",null,'Click "Learn Command" for each combination',-1),e("li",null,[e("strong",null,"Point your IR remote directly at the Broadlink device")],-1),e("li",null,"Press the button on your remote",-1),e("li",null,"Wait for confirmation (up to 30 seconds)",-1)])])):(l(),s("ol",Qr,[...u[12]||(u[12]=[e("li",null,'Click "Learn Command" for each combination',-1),e("li",null,[e("strong",null,"Step 1:"),_(" Hold button on remote - Broadlink scans for RF frequency")],-1),e("li",null,[e("strong",null,"Step 2:"),_(" Watch for Home Assistant notification, then press and release button")],-1),e("li",null,"Keep remote within 5cm of Broadlink (RF doesn't need line-of-sight)",-1),e("li",null,"Wait for confirmation (may take up to 30 seconds)",-1)])]))])]),e("div",ed,[e("div",td,[e("div",{class:"progress-fill",style:it({width:E.value+"%"})},null,4)]),e("span",od,m(p.value)+" / "+m(b.value)+" commands learned ("+m(E.value)+"%) ",1)]),e("div",ld,[(l(!0),s(pe,null,ke(a.value,V=>(l(),s("div",{key:V.key,class:Y(["command-card",{learned:i.value[V.key],learning:c.value===V.key}])},[e("div",nd,[e("div",sd,[e("i",{class:Y(V.icon)},null,2)]),e("div",ad,[e("h4",null,m(V.label),1),e("p",null,m(V.description),1)])]),c.value===V.key?(l(),s("div",id,[o.commandType==="ir"?(l(),s("div",rd,[...u[15]||(u[15]=[e("p",null,[e("strong",null,"Point your remote directly at the Broadlink device and press the button.")],-1),e("small",null,"Listening for up to 30 seconds...",-1)])])):(l(),s("div",dd,[...u[16]||(u[16]=[e("p",{class:"rf-title"},[e("strong",null,"Learning request sent to device.")],-1),e("p",{class:"rf-subtitle"},[_("RF learning is a "),e("strong",null,"two-step process"),_(":")],-1),e("ol",null,[e("li",null,[e("strong",null,"Step 1 - Frequency Sweep (~10-15 seconds):"),_(" Press and hold the button on your remote until the notification updates. ")]),e("li",null,[e("strong",null,"Step 2 - Learn Signal:"),_(" Press and release the button once. ")])],-1),e("p",{class:"rf-note"},"Follow the Home Assistant notifications (ğŸ””) for real-time instructions.",-1)])]))])):x("",!0),e("div",ud,[i.value[V.key]?(l(),s("div",md,[u[18]||(u[18]=e("i",{class:"mdi mdi-check-circle"},null,-1)),u[19]||(u[19]=e("span",null,"Learned",-1)),e("span",{class:Y(["command-type-badge",T.value])},m(T.value.toUpperCase()),3),e("button",{onClick:ye=>ee(V.key),class:"icon-btn",title:"Test command",disabled:f.value===V.key,style:{"margin-left":"auto"}},[e("i",{class:Y(["mdi mdi-play",{"mdi-spin":f.value===V.key}])},null,2)],8,vd),e("button",{onClick:ye=>ie(V.key),class:"icon-btn danger",title:"Delete and re-learn"},[...u[17]||(u[17]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,pd)])):(l(),s("button",{key:0,onClick:ye=>j(V),class:Y(["btn-learn",{learning:c.value===V.key}]),disabled:c.value!==null},[e("i",{class:Y(["mdi mdi-radio-tower",{"mdi-spin":c.value===V.key}])},null,2),_(" "+m(c.value===V.key?"Listening...":"Learn Command"),1)],10,cd))])],2))),128))]),e("div",fd,[e("button",{onClick:N,class:"btn-secondary",disabled:c.value!==null||p.value===b.value},[...u[20]||(u[20]=[e("i",{class:"mdi mdi-play-circle"},null,-1),_(" Learn All Remaining ",-1)])],8,gd),e("button",{onClick:le,class:"btn-text",disabled:p.value===0},[...u[21]||(u[21]=[e("i",{class:"mdi mdi-delete-sweep"},null,-1),_(" Clear All ",-1)])],8,yd)]),be(Ve,{isOpen:P.value.show,title:"Delete Learned Command?",message:`Are you sure you want to delete the '${P.value.commandLabel}' command?

You will need to re-learn this command.`,confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,onConfirm:A,onCancel:u[2]||(u[2]=V=>P.value.show=!1)},null,8,["isOpen","message"]),be(Ve,{isOpen:D.value,title:"Delete All Learned Commands?",message:"Are you sure you want to delete all learned commands? This cannot be undone.\\n\\nYou will need to re-learn all commands.",confirmText:"Delete All",cancelText:"Cancel",dangerMode:!0,onConfirm:me,onCancel:u[3]||(u[3]=V=>D.value=!1)},null,8,["isOpen"])]))}},hd=we(bd,[["__scopeId","data-v-9a9e9e51"]]),kd={class:"profile-preview"},wd={class:"preview-summary"},$d={class:"summary-card"},Cd={class:"stats-grid"},_d={class:"stat-item"},Sd={class:"stat-value"},Id={class:"stat-item"},Dd={class:"stat-value"},xd={class:"stat-item"},Td={class:"stat-value"},Md={class:"preview-tabs"},Rd={class:"preview-content"},Ld={key:0,class:"tab-content"},Ad={class:"code-header"},Ed={class:"code-block"},Od={key:1,class:"tab-content"},Vd={class:"code-header"},Ud={class:"code-block"},Pd={key:2,class:"tab-content"},Fd={class:"instructions"},jd={class:"step-item"},Nd={class:"step-content"},Bd={class:"code-path"},Hd={__name:"ProfilePreview",props:{profile:{type:Object,required:!0},jsonData:{type:Object,required:!0},yamlConfig:{type:String,required:!0}},setup(o){const v=Fe(),d=o,k=g("json"),h=g(!1),i=g(!1),c=J(()=>Object.keys(d.profile.commands||{}).length),f=J(()=>JSON.stringify(d.jsonData,null,2));async function C(){try{await navigator.clipboard.writeText(f.value),h.value=!0,setTimeout(()=>{h.value=!1},2e3)}catch(T){console.error("Failed to copy JSON:",T),v.error("Failed to copy to clipboard")}}async function $(){try{await navigator.clipboard.writeText(d.yamlConfig),i.value=!0,setTimeout(()=>{i.value=!1},2e3)}catch(T){console.error("Failed to copy YAML:",T),v.error("Failed to copy to clipboard")}}return(T,w)=>{var t;return l(),s("div",kd,[w[22]||(w[22]=e("h3",null,"Preview & Save",-1)),e("div",wd,[e("div",$d,[w[4]||(w[4]=e("i",{class:"mdi mdi-check-circle"},null,-1)),e("div",null,[w[3]||(w[3]=e("h4",null,"Profile Ready!",-1)),e("p",null,m(o.profile.manufacturer)+" "+m(o.profile.model),1)])]),e("div",Cd,[e("div",_d,[e("span",Sd,m(c.value),1),w[5]||(w[5]=e("span",{class:"stat-label"},"Commands Learned",-1))]),e("div",Id,[e("span",Dd,m(o.profile.platform),1),w[6]||(w[6]=e("span",{class:"stat-label"},"Platform",-1))]),e("div",xd,[e("span",Td,m(((t=o.profile.config.modes)==null?void 0:t.length)||0),1),w[7]||(w[7]=e("span",{class:"stat-label"},"HVAC Modes",-1))])])]),e("div",Md,[e("button",{onClick:w[0]||(w[0]=M=>k.value="json"),class:Y(["tab-button",{active:k.value==="json"}])},[...w[8]||(w[8]=[e("i",{class:"mdi mdi-code-json"},null,-1),_(" SmartIR JSON ",-1)])],2),e("button",{onClick:w[1]||(w[1]=M=>k.value="yaml"),class:Y(["tab-button",{active:k.value==="yaml"}])},[...w[9]||(w[9]=[e("i",{class:"mdi mdi-file-code"},null,-1),_(" YAML Config ",-1)])],2),e("button",{onClick:w[2]||(w[2]=M=>k.value="instructions"),class:Y(["tab-button",{active:k.value==="instructions"}])},[...w[10]||(w[10]=[e("i",{class:"mdi mdi-information"},null,-1),_(" Instructions ",-1)])],2)]),e("div",Rd,[k.value==="json"?(l(),s("div",Ld,[e("div",Ad,[w[12]||(w[12]=e("h4",null,"SmartIR Device Code JSON",-1)),e("button",{onClick:C,class:"btn-copy"},[w[11]||(w[11]=e("i",{class:"mdi mdi-content-copy"},null,-1)),_(" "+m(h.value?"Copied!":"Copy"),1)])]),e("pre",Ed,[e("code",null,m(f.value),1)]),w[13]||(w[13]=e("p",{class:"code-note"},[e("i",{class:"mdi mdi-information"}),_(" Save this as "),e("code",null,"10000.json"),_(" in your SmartIR codes directory ")],-1))])):x("",!0),k.value==="yaml"?(l(),s("div",Od,[e("div",Vd,[w[15]||(w[15]=e("h4",null,"Home Assistant Configuration",-1)),e("button",{onClick:$,class:"btn-copy"},[w[14]||(w[14]=e("i",{class:"mdi mdi-content-copy"},null,-1)),_(" "+m(i.value?"Copied!":"Copy"),1)])]),e("pre",Ud,[e("code",null,m(o.yamlConfig),1)]),w[16]||(w[16]=e("p",{class:"code-note"},[e("i",{class:"mdi mdi-information"}),_(" Add this to your "),e("code",null,"configuration.yaml"),_(" file ")],-1))])):x("",!0),k.value==="instructions"?(l(),s("div",Pd,[e("div",Fd,[w[20]||(w[20]=e("h4",null,"Installation Steps",-1)),e("div",jd,[w[19]||(w[19]=e("div",{class:"step-number"},"1",-1)),e("div",Nd,[w[17]||(w[17]=e("h5",null,"Get Next Code Number",-1)),w[18]||(w[18]=e("p",null,"Custom device codes start at 10000. Check your SmartIR codes directory to find the next available number.",-1)),e("div",Bd,[e("code",null,"/config/custom_components/smartir/codes/"+m(o.profile.platform)+"/",1)])])]),w[21]||(w[21]=Ue('<div class="step-item" data-v-0d49ac28><div class="step-number" data-v-0d49ac28>2</div><div class="step-content" data-v-0d49ac28><h5 data-v-0d49ac28>Save JSON File</h5><p data-v-0d49ac28>Copy the JSON from the &quot;SmartIR JSON&quot; tab and save it as <code data-v-0d49ac28>10000.json</code> (or your next available number) in the codes directory.</p></div></div><div class="step-item" data-v-0d49ac28><div class="step-number" data-v-0d49ac28>3</div><div class="step-content" data-v-0d49ac28><h5 data-v-0d49ac28>Update Configuration</h5><p data-v-0d49ac28>Copy the YAML from the &quot;YAML Config&quot; tab and add it to your <code data-v-0d49ac28>configuration.yaml</code> file. Update the <code data-v-0d49ac28>device_code</code> to match your JSON filename.</p></div></div><div class="step-item" data-v-0d49ac28><div class="step-number" data-v-0d49ac28>4</div><div class="step-content" data-v-0d49ac28><h5 data-v-0d49ac28>Restart Home Assistant</h5><p data-v-0d49ac28>Restart Home Assistant to load the new configuration. Your climate entity will appear in the UI.</p></div></div><div class="step-item" data-v-0d49ac28><div class="step-number" data-v-0d49ac28>5</div><div class="step-content" data-v-0d49ac28><h5 data-v-0d49ac28>Test Your Device</h5><p data-v-0d49ac28>Go to your climate entity and test different modes, temperatures, and fan speeds to ensure everything works correctly.</p></div></div><div class="tips-section" data-v-0d49ac28><h4 data-v-0d49ac28><i class="mdi mdi-lightbulb" data-v-0d49ac28></i> Tips </h4><ul data-v-0d49ac28><li data-v-0d49ac28>Keep a backup of your JSON file in case you need to modify it</li><li data-v-0d49ac28>Test all commands to ensure they work as expected</li><li data-v-0d49ac28>You can share your profile with the SmartIR community on GitHub</li><li data-v-0d49ac28>If a command doesn&#39;t work, you can re-learn it and update the JSON</li></ul></div>',5))])])):x("",!0)])])}}},qd=we(Hd,[["__scopeId","data-v-0d49ac28"]]),zd={class:"wizard-body"},Jd={key:0,class:"warning-section"},Wd={class:"warning-box"},Gd={class:"instructions"},Kd={class:"code-block"},Xd={class:"steps"},Yd={key:0},Zd={class:"help-section"},Qd={key:0,class:"help-content"},eu={class:"help-step"},tu={key:0,class:"help-step"},ou={class:"help-step"},lu={class:"help-step"},nu={class:"checklist"},su={class:"checkbox-label"},au={key:0,class:"checkbox-label"},iu={class:"wizard-footer"},ru=["disabled"],du={__name:"SmartIRSetupWizard",props:{show:{type:Boolean,default:!1},platform:{type:String,required:!0},warnings:{type:Array,default:()=>[]},configPath:{type:String,default:"/config"}},emits:["close","complete"],setup(o,{emit:v}){const d=o,k=v,h=Te("toast"),i=g(!1),c=g(!1),f=g(!1),C=J(()=>d.warnings.length>0?i.value&&c.value:i.value);function $(){const w=`${d.platform}: !include smartir/${d.platform}.yaml`;navigator.clipboard.writeText(w).then(()=>{var t;(t=h.value)==null||t.success("Include line copied to clipboard!","âœ… Copied")}).catch(t=>{var M;console.error("Failed to copy:",t),(M=h.value)==null||M.error("Failed to copy to clipboard","âŒ Copy Failed")})}function T(){k("complete")}return(w,t)=>o.show?(l(),s("div",{key:0,class:"modal-overlay",onClick:t[5]||(t[5]=he(()=>{},["stop"]))},[e("div",{class:"setup-wizard",onClick:t[4]||(t[4]=he(()=>{},["stop"]))},[t[31]||(t[31]=e("div",{class:"wizard-header"},[e("h2",null,[e("i",{class:"mdi mdi-cog"}),_(" SmartIR Configuration Setup ")])],-1)),e("div",zd,[o.warnings.length>0?(l(),s("div",Jd,[e("div",Wd,[t[11]||(t[11]=e("i",{class:"mdi mdi-alert"},null,-1)),e("div",null,[t[9]||(t[9]=e("h3",null,"âš ï¸ Configuration Migration Needed",-1)),t[10]||(t[10]=e("p",null,"We detected existing platform entries in your configuration.yaml:",-1)),e("ul",null,[(l(!0),s(pe,null,ke(o.warnings,M=>(l(),s("li",{key:M.platform},[e("strong",null,m(M.platform)+":",1),_(" "+m(M.message),1)]))),128))]),e("p",null,[t[6]||(t[6]=e("strong",null,"Action Required:",-1)),t[7]||(t[7]=_(" Move these entries to ",-1)),e("code",null,"smartir/"+m(o.platform)+".yaml",1),t[8]||(t[8]=_(" before continuing.",-1))])])])])):x("",!0),e("div",Gd,[t[27]||(t[27]=e("h3",null,"ğŸ“ One-Time Setup",-1)),t[28]||(t[28]=e("p",null,[_("To enable SmartIR device management, add this line to your "),e("code",null,"configuration.yaml"),_(":")],-1)),e("div",Kd,[e("code",null,m(o.platform)+": !include smartir/"+m(o.platform)+".yaml",1),e("button",{onClick:$,class:"copy-btn",title:"Copy to clipboard"},[...t[12]||(t[12]=[e("i",{class:"mdi mdi-content-copy"},null,-1)])])]),e("div",Xd,[t[19]||(t[19]=e("h4",null,"Steps:",-1)),e("ol",null,[o.warnings.length>0?(l(),s("li",Yd,[t[13]||(t[13]=e("strong",null,"Move existing entries:",-1)),t[14]||(t[14]=_(" Copy any existing ",-1)),e("code",null,m(o.platform)+":",1),t[15]||(t[15]=_(" entries from configuration.yaml to ",-1)),e("code",null,"smartir/"+m(o.platform)+".yaml",1)])):x("",!0),t[16]||(t[16]=e("li",null,[e("strong",null,"Add include line:"),_(" Add the line above to your configuration.yaml ")],-1)),t[17]||(t[17]=e("li",null,[e("strong",null,"Save changes:"),_(" Save configuration.yaml ")],-1)),t[18]||(t[18]=e("li",null,[e("strong",null,"Continue here:"),_(` Click "I've Completed Setup" below `)],-1))])]),e("div",Zd,[e("button",{onClick:t[0]||(t[0]=M=>f.value=!f.value),class:"help-toggle"},[e("i",{class:Y(["mdi",f.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2),_(" "+m(f.value?"Hide":"Show")+" Detailed Instructions ",1)]),f.value?(l(),s("div",Qd,[t[26]||(t[26]=e("h4",null,"Detailed Setup Guide:",-1)),e("div",eu,[t[21]||(t[21]=e("h5",null,"1. Open configuration.yaml",-1)),e("p",null,[t[20]||(t[20]=_("Location: ",-1)),e("code",null,m(o.configPath)+"/configuration.yaml",1)])]),o.warnings.length>0?(l(),s("div",tu,[t[22]||(t[22]=e("h5",null,"2. Migrate Existing Entries (If Any)",-1)),e("p",null,"If you have existing "+m(o.platform)+" entries, cut them from configuration.yaml and paste into:",1),e("p",null,[e("code",null,m(o.configPath)+"/smartir/"+m(o.platform)+".yaml",1)]),t[23]||(t[23]=e("p",{class:"note"},"Broadlink Manager will create this file automatically.",-1))])):x("",!0),e("div",ou,[e("h5",null,m(o.warnings.length>0?"3":"2")+". Add Include Line",1),t[24]||(t[24]=e("p",null,"Add this to configuration.yaml:",-1)),e("pre",null,m(o.platform)+": !include smartir/"+m(o.platform)+".yaml",1)]),e("div",lu,[e("h5",null,m(o.warnings.length>0?"4":"3")+". Restart Home Assistant",1),t[25]||(t[25]=e("p",null,"After saving, you'll need to restart HA for changes to take effect.",-1))])])):x("",!0)])]),e("div",nu,[e("label",su,[W(e("input",{type:"checkbox","onUpdate:modelValue":t[1]||(t[1]=M=>i.value=M)},null,512),[[ge,i.value]]),t[29]||(t[29]=e("span",null,"I've added the include line to configuration.yaml",-1))]),o.warnings.length>0?(l(),s("label",au,[W(e("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=M=>c.value=M)},null,512),[[ge,c.value]]),e("span",null,"I've migrated existing "+m(o.platform)+" entries (if any)",1)])):x("",!0)])]),e("div",iu,[e("button",{onClick:t[3]||(t[3]=M=>w.$emit("close")),class:"btn-secondary"}," Cancel "),e("button",{onClick:T,class:"btn-primary",disabled:!C.value},[...t[30]||(t[30]=[e("i",{class:"mdi mdi-check"},null,-1),_(" I've Completed Setup ",-1)])],8,ru)])])])):x("",!0)}},uu=we(du,[["__scopeId","data-v-f6fe4c03"]]),cu={class:"modal-header"},mu={class:"progress-steps"},vu={class:"step-number"},pu={key:0,class:"mdi mdi-check"},fu={key:1},gu={class:"step-label"},yu={class:"modal-body"},bu={key:0,class:"step-content"},hu={class:"form-group"},ku={class:"form-group"},wu={class:"form-group"},$u={key:1,class:"step-content"},Cu={key:1,class:"platform-form"},_u={class:"form-section"},Su={class:"checkbox-grid"},Iu={class:"checkbox-item"},Du={class:"checkbox-item"},xu={class:"checkbox-item"},Tu={class:"checkbox-item"},Mu={class:"checkbox-item"},Ru={key:2,class:"platform-form"},Lu={class:"form-section"},Au={class:"form-group"},Eu={class:"form-section"},Ou={class:"checkbox-grid"},Vu={class:"checkbox-item"},Uu={class:"checkbox-item"},Pu={key:3,class:"platform-form"},Fu={class:"form-section"},ju={class:"checkbox-grid"},Nu={class:"checkbox-item"},Bu={class:"checkbox-item"},Hu={class:"checkbox-item"},qu={class:"checkbox-item"},zu={key:2,class:"step-content"},Ju={key:3,class:"step-content"},Wu={class:"modal-footer"},Gu=["disabled"],Ku={key:2,class:"save-buttons"},Xu=["disabled"],Yu=["disabled"],Zu={__name:"SmartIRProfileBuilder",props:{show:{type:Boolean,default:!1},editMode:{type:Boolean,default:!1},editData:{type:Object,default:null},startStep:{type:Number,default:0}},emits:["close","save"],setup(o,{emit:v}){const d=o,k=v,h=Te("toast"),i=g(0),c=g(!1),f=g([]),C=g(!1),$=g([]),T=g("/config"),w=g(!1),t=g(null),M=g(!1),G=g(!1),P=g(""),D=g("ir"),a=g(!1),b=[{label:"Device Info",key:"info"},{label:"Configuration",key:"config"},{label:"Learn Commands",key:"commands"},{label:"Preview & Save",key:"preview"}],p=g({platform:"",manufacturer:"",model:"",broadlinkDevice:"",commandType:"ir",config:{},commands:{}}),E=g(["turn_on"]),z=g(3),j=g([]),ee=g(["turn_on"]);ue(()=>p.value.platform,O=>{O==="media_player"?p.value.config={features:E.value}:O==="fan"?p.value.config={speedLevels:z.value,features:j.value}:O==="light"&&(p.value.config={features:ee.value})}),ue(E,O=>{p.value.platform==="media_player"&&(p.value.config={features:O})},{deep:!0}),ue(z,O=>{p.value.platform==="fan"&&(p.value.config={speedLevels:O,features:j.value})}),ue(j,O=>{p.value.platform==="fan"&&(p.value.config={speedLevels:z.value,features:O})},{deep:!0}),ue(ee,O=>{p.value.platform==="light"&&(p.value.config={features:O})},{deep:!0});function ie(O){const r=new Set,F=Object.keys(O);return F.some(Z=>Z==="off"||Z.includes("_off"))&&r.add("off"),F.some(Z=>Z.includes("auto"))&&r.add("auto"),F.some(Z=>Z.includes("cool"))&&r.add("cool"),F.some(Z=>Z.includes("heat"))&&r.add("heat"),F.some(Z=>Z.includes("dry"))&&r.add("dry"),F.some(Z=>Z.includes("fan_only"))&&r.add("fan_only"),Array.from(r)}function A(O){const r=new Set,F=Object.keys(O);return F.some(Z=>Z.includes("auto"))&&r.add("auto"),F.some(Z=>Z.includes("low"))&&r.add("low"),F.some(Z=>Z.includes("medium")||Z.includes("mid"))&&r.add("medium"),F.some(Z=>Z.includes("high"))&&r.add("high"),Array.from(r)}function N(O){const r=new Set,F=Object.keys(O);return F.some(Z=>Z.includes("swing_off")||Z.includes("_off"))&&r.add("off"),F.some(Z=>Z.includes("vertical"))&&r.add("vertical"),F.some(Z=>Z.includes("horizontal"))&&r.add("horizontal"),F.some(Z=>Z.includes("both"))&&r.add("both"),Array.from(r)}function le(O){for(const r of Object.values(O))if(typeof r=="string"&&r.startsWith("sc")||Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0].startsWith("sc"))return"rf";return"ir"}ue(()=>p.value.commandType,(O,r)=>{!r||M.value||a.value||(Object.keys(p.value.commands).length>0&&O!==r?(P.value=O,p.value.commandType=r,M.value=!0):O!==r&&(D.value=O))}),ue(()=>d.editData,async O=>{var r,F,Z;if(O&&d.editMode){console.log("ğŸ”§ Edit mode activated, loading profile data:",O),a.value=!0,f.value.length===0&&(console.log("ğŸ“¡ Loading Broadlink devices..."),await ae(),console.log("ğŸ“¡ Devices loaded:",f.value.length));const re=O.profile,K=re.controller_data;console.log("ğŸ® Controller data from profile:",K),console.log("ğŸ® Available devices:",f.value.map(y=>y.entity_id));const te=re.commands||{},Ae=re.commandType||le(te);console.log("ğŸ” Command type (stored):",re.commandType),console.log("ğŸ” Command type (final):",Ae);let Ce={};if(O.platform==="climate"){const y=re.operationModes||ie(te),U=re.fanModes||A(te),B=re.swingModes||N(te);console.log("ğŸ” Inferred modes:",y),console.log("ğŸ” Inferred fan modes:",U),console.log("ğŸ” Inferred swing modes:",B),Ce={minTemp:re.minTemperature,maxTemp:re.maxTemperature,precision:re.precision,modes:y,fanModes:U,swingModes:B}}else if(O.platform==="media_player"){const y=[];(te.on||te.off)&&y.push("turn_on"),(te.volumeUp||te.volumeDown)&&y.push("volume"),te.mute&&y.push("mute"),te.sources&&y.push("source"),(te.channelUp||te.channelDown)&&y.push("channel"),Ce={features:y},E.value=y,console.log("ğŸ” Inferred media player features:",y)}else if(O.platform==="fan"){const y=((r=re.speed)==null?void 0:r.length)||Object.keys(te.default||{}).length||3,U=[];(te.oscillate_on||te.oscillate_off)&&U.push("oscillate"),(te.direction_forward||te.direction_reverse)&&U.push("direction"),Ce={speedLevels:y,features:U},z.value=y,j.value=U,console.log("ğŸ” Inferred fan config:",Ce)}else if(O.platform==="light"){const y=[];Ce={features:y},ee.value=y,console.log("ğŸ” Inferred light features:",y)}const L=await n(re.manufacturer,(F=re.supportedModels)==null?void 0:F[0],te);p.value={platform:O.platform,manufacturer:re.manufacturer||"",model:((Z=re.supportedModels)==null?void 0:Z[0])||"",broadlinkDevice:K||"",commandType:Ae,config:Ce,commands:L},console.log("âœ… Profile populated:",p.value),console.log("âœ… Selected device:",p.value.broadlinkDevice),console.log("âœ… Command type:",p.value.commandType),console.log("âœ… Commands (with learned codes):",L),D.value=Ae,setTimeout(()=>{a.value=!1},100)}},{immediate:!0});const me=J(()=>{var O;switch(i.value){case 0:return p.value.platform&&p.value.manufacturer&&p.value.model;case 1:return p.value.platform==="climate"?p.value.config.minTemp&&p.value.config.maxTemp&&((O=p.value.config.modes)==null?void 0:O.length)>0:!0;case 2:return p.value.broadlinkDevice&&p.value.commandType&&Object.keys(p.value.commands).length>0;case 3:return!0;default:return!1}}),ce=g(null);async function De(){if(i.value!==3){ce.value=null;return}if(console.log("ğŸ” Generating JSON with commands:",p.value.commands),Object.values(p.value.commands).some(r=>typeof r=="string"?r==="pending":typeof r=="object"?Object.values(r).some(F=>typeof F=="string"?F==="pending":typeof F=="object"?Object.values(F).some(Z=>Z==="pending"):!1):!1)){console.warn('âš ï¸ Commands still contain "pending" placeholders!'),console.log("ğŸ“¦ Attempting to fetch from Broadlink storage...");const r=await n(p.value.manufacturer,p.value.model,p.value.commands);p.value.commands=r,console.log("âœ… Updated commands:",r)}ce.value=X(p.value),console.log("ğŸ“„ Generated JSON:",ce.value)}const Le=J(()=>i.value!==3?null:q(p.value));function xe(){p.value.config={},p.value.commands={}}function S(){M.value=!1,p.value.commandType=P.value,D.value=P.value,p.value.commands={},P.value=""}function u(){M.value=!1,P.value=""}async function V(){i.value<b.length-1&&(i.value++,i.value===3&&await De())}function ye(){i.value>0&&i.value--}function Ie(){M.value||(G.value=!0)}function H(){G.value=!1,R()}function R(){k("close"),setTimeout(()=>{i.value=0,p.value={platform:"",manufacturer:"",model:"",broadlinkDevice:"",commandType:"ir",config:{},commands:{}},D.value="ir"},300)}async function Q(){var O,r,F,Z,re,K;c.value=!0;try{if(!w.value){const U=(await ne.get("/api/smartir/config/check")).data;if(U&&!((O=U.platforms[p.value.platform])==null?void 0:O.file_exists)){$.value=U.configuration_warnings||[],T.value=U.config_path||"/config",t.value={platform:p.value.platform,json:ce.value},C.value=!0,c.value=!1;return}}let te;d.editMode&&((r=d.editData)!=null&&r.code)?(te=parseInt(d.editData.code),console.log("ğŸ“ Edit mode: Using existing code",te)):(te=(await ne.get(`/api/smartir/platforms/${p.value.platform}/next-code`)).data.next_code,console.log("âœ¨ New profile: Using next code",te));const Ce=(await ne.post("/api/smartir/profiles",{platform:p.value.platform,json:ce.value,code_number:te})).data,L={platform:"smartir",name:`${p.value.manufacturer} ${p.value.model}`,unique_id:`${p.value.manufacturer.toLowerCase().replace(/[^a-z0-9]+/g,"_")}_${p.value.model.toLowerCase().replace(/[^a-z0-9]+/g,"_")}`,device_code:te,controller_data:p.value.broadlinkDevice};try{await ne.post("/api/smartir/config/add-device",{platform:p.value.platform,device_config:{platform:"smartir",name:L.name,unique_id:L.unique_id,device_code:L.device_code,controller_data:L.controller_data}})}catch(y){console.error("Failed to add device to config:",y);const U=((F=y.response)==null?void 0:F.data)||{};let B=U.error||"Unknown error";U.validation_errors&&U.validation_errors.length>0&&(B=`Device configuration validation failed:
`+U.validation_errors.map(oe=>`  â€¢ ${oe}`).join(`
`)),(Z=h.value)==null||Z.warning(`Profile saved but failed to add to config file:
${B}`,"âš ï¸ Partial Success")}k("save",{json:ce.value,yaml:Le.value,profile:p.value,saved_to:Ce.path}),(re=h.value)==null||re.success(`File: ${Ce.filename}
Device Code: ${te}
Added to: smartir/${p.value.platform}.yaml

âš ï¸ Restart Home Assistant to activate`,"âœ… Profile Saved Successfully!"),R()}catch(te){console.error("Error saving profile:",te),(K=h.value)==null||K.error(te.message,"âŒ Error Saving Profile")}finally{c.value=!1}}async function se(){w.value=!0,C.value=!1,t.value&&(await Q(),t.value=null)}function I(){var O,r;try{const F=JSON.stringify(ce.value,null,2),Z=new Blob([F],{type:"application/json"}),re=URL.createObjectURL(Z),K=document.createElement("a");K.href=re;const te=p.value.manufacturer.toLowerCase().replace(/\s+/g,"_"),Ae=p.value.model.toLowerCase().replace(/\s+/g,"_");K.download=`smartir_${p.value.platform}_${te}_${Ae}.json`,document.body.appendChild(K),K.click(),document.body.removeChild(K),URL.revokeObjectURL(re),(O=h.value)==null||O.success("You can manually upload this file to your SmartIR codes directory.","âœ… Profile Downloaded")}catch(F){console.error("Error downloading profile:",F),(r=h.value)==null||r.error(F.message,"âŒ Error Downloading Profile")}}async function n(O,r,F){const Z=O.toLowerCase().replace(/[^a-z0-9]+/g,"_"),re=r.toLowerCase().replace(/[^a-z0-9]+/g,"_"),K=`${Z}_${re}`;try{const Ce=(await ne.get("/api/commands/all")).data[K]||{};console.log(`ğŸ” Fetching learned commands for device: ${K}`),console.log("ğŸ“¦ Device commands from storage:",Ce);const L={...F};for(const[y,U]of Object.entries(L))if(U==="pending"&&Ce[y])L[y]=Ce[y];else if(typeof U=="object"){for(const[B,oe]of Object.entries(U))if(typeof oe=="object")for(const[ve,fe]of Object.entries(oe)){const de=`${y}_${B}_${ve}`;fe==="pending"&&Ce[de]&&(L[y][B][ve]=Ce[de])}else if(oe==="pending"){const ve=`${y}_${B}`;Ce[ve]&&(L[y][B]=Ce[ve])}}return console.log("âœ… Merged commands:",L),L}catch(te){return console.error("Error fetching learned commands:",te),F}}function X(O){const r={manufacturer:O.manufacturer,supportedModels:[O.model],supportedController:"Broadlink",commandsEncoding:"Base64",commandType:O.commandType||"ir",commands:{}};return O.platform==="climate"&&(r.minTemperature=O.config.minTemp,r.maxTemperature=O.config.maxTemp,r.precision=O.config.precision||1,r.operationModes=O.config.modes||[],r.fanModes=O.config.fanModes&&O.config.fanModes.length>0?O.config.fanModes:["auto"],O.config.swingModes&&O.config.swingModes.length>0&&(r.swingModes=O.config.swingModes),r.commands=O.commands),r}function q(O){let r=`# SmartIR ${O.platform} configuration
`;return r+=`# Generated by Broadlink Manager v2

`,O.platform==="climate"&&(r+=`climate:
`,r+=`  - platform: smartir
`,r+=`    name: ${O.manufacturer} ${O.model}
`,r+=`    unique_id: ${O.manufacturer.toLowerCase()}_${O.model.toLowerCase().replace(/\s+/g,"_")}
`,r+=`    device_code: 10000  # Change this to your custom code number
`,r+=`    controller_data: ${O.broadlinkDevice}
`,O.config.tempSensor&&(r+=`    temperature_sensor: ${O.config.tempSensor}
`),O.config.humiditySensor&&(r+=`    humidity_sensor: ${O.config.humiditySensor}
`),O.config.powerSensor&&(r+=`    power_sensor: ${O.config.powerSensor}
`)),r}async function ae(){try{console.log("Fetching remote devices from /api/remote/devices...");const O=await ne.get("/api/remote/devices");console.log("Loaded remote devices response:",O.data);const r=O.data.devices||[];console.log("Extracted devices array:",r),console.log("Device count:",r.length),f.value=r,console.log("broadlinkDevices.value set to:",f.value),console.log("Final device count:",f.value.length)}catch(O){console.error("Error loading remote devices:",O),f.value=[]}}return ue(()=>d.show,O=>{if(O){const r=Number.isInteger(d.startStep)?d.startStep:0;i.value=Math.min(Math.max(r,0),b.length-1)}}),ue(()=>d.startStep,O=>{if(d.show){const r=Number.isInteger(O)?O:0;i.value=Math.min(Math.max(r,0),b.length-1)}}),Re(()=>{d.show&&ae()}),(O,r)=>o.show?(l(),s("div",{key:0,class:"modal-overlay",onClick:Ie},[e("div",{class:"modal-container",onClick:r[19]||(r[19]=he(()=>{},["stop"]))},[e("div",cu,[e("h2",null,[r[22]||(r[22]=e("i",{class:"mdi mdi-file-document-edit"},null,-1)),_(" "+m(o.editMode?"Edit SmartIR Profile":"Create SmartIR Profile"),1)]),e("button",{onClick:R,class:"close-button"},[...r[23]||(r[23]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",mu,[(l(),s(pe,null,ke(b,(F,Z)=>e("div",{key:Z,class:Y(["step",{active:i.value===Z,completed:i.value>Z}])},[e("div",vu,[i.value>Z?(l(),s("i",pu)):(l(),s("span",fu,m(Z+1),1))]),e("span",gu,m(F.label),1)],2)),64))]),e("div",yu,[i.value===0?(l(),s("div",bu,[r[29]||(r[29]=e("h3",null,"Device Information",-1)),e("div",hu,[r[25]||(r[25]=e("label",null,"Platform Type *",-1)),W(e("select",{"onUpdate:modelValue":r[0]||(r[0]=F=>p.value.platform=F),onChange:xe},[...r[24]||(r[24]=[Ue('<option value="" data-v-2e218e9d>Select platform...</option><option value="climate" data-v-2e218e9d>ğŸŒ¡ï¸ Climate (AC, Heater, Heat Pump)</option><option value="media_player" data-v-2e218e9d>ğŸ“º Media Player (TV, Receiver)</option><option value="fan" data-v-2e218e9d>ğŸŒ€ Fan</option><option value="light" data-v-2e218e9d>ğŸ’¡ Light (LED Strip, IR Light)</option>',5)])],544),[[Se,p.value.platform]])]),e("div",ku,[r[26]||(r[26]=e("label",null,"Manufacturer *",-1)),W(e("input",{"onUpdate:modelValue":r[1]||(r[1]=F=>p.value.manufacturer=F),type:"text",placeholder:"e.g., Daikin, LG, Samsung"},null,512),[[Me,p.value.manufacturer]])]),e("div",wu,[r[27]||(r[27]=e("label",null,"Model(s) *",-1)),W(e("input",{"onUpdate:modelValue":r[2]||(r[2]=F=>p.value.model=F),type:"text",placeholder:"e.g., FTXS35K, Multiple models"},null,512),[[Me,p.value.model]]),r[28]||(r[28]=e("small",null,'Enter model number or "Multiple" if it works with many models',-1))])])):x("",!0),i.value===1?(l(),s("div",$u,[p.value.platform==="climate"?(l(),Ee(jr,{key:0,modelValue:p.value.config,"onUpdate:modelValue":r[3]||(r[3]=F=>p.value.config=F)},null,8,["modelValue"])):p.value.platform==="media_player"?(l(),s("div",Cu,[r[36]||(r[36]=e("h3",null,"Media Player Configuration",-1)),r[37]||(r[37]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),_(" Configure the features your media player supports. You'll learn the IR commands in the next step. ")],-1)),e("div",_u,[r[35]||(r[35]=e("h4",null,"Supported Features",-1)),e("div",Su,[e("label",Iu,[W(e("input",{type:"checkbox",value:"turn_on","onUpdate:modelValue":r[4]||(r[4]=F=>E.value=F)},null,512),[[ge,E.value]]),r[30]||(r[30]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),_(" Power On/Off ")],-1))]),e("label",Du,[W(e("input",{type:"checkbox",value:"volume","onUpdate:modelValue":r[5]||(r[5]=F=>E.value=F)},null,512),[[ge,E.value]]),r[31]||(r[31]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-volume-high"}),_(" Volume Control ")],-1))]),e("label",xu,[W(e("input",{type:"checkbox",value:"mute","onUpdate:modelValue":r[6]||(r[6]=F=>E.value=F)},null,512),[[ge,E.value]]),r[32]||(r[32]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-volume-mute"}),_(" Mute ")],-1))]),e("label",Tu,[W(e("input",{type:"checkbox",value:"source","onUpdate:modelValue":r[7]||(r[7]=F=>E.value=F)},null,512),[[ge,E.value]]),r[33]||(r[33]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-import"}),_(" Source Selection ")],-1))]),e("label",Mu,[W(e("input",{type:"checkbox",value:"channel","onUpdate:modelValue":r[8]||(r[8]=F=>E.value=F)},null,512),[[ge,E.value]]),r[34]||(r[34]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-numeric"}),_(" Channel Control ")],-1))])])])])):p.value.platform==="fan"?(l(),s("div",Ru,[r[44]||(r[44]=e("h3",null,"Fan Configuration",-1)),r[45]||(r[45]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),_(" Configure the features your fan supports. You'll learn the IR commands in the next step. ")],-1)),e("div",Lu,[r[40]||(r[40]=e("h4",null,"Fan Speed Levels",-1)),e("div",Au,[r[39]||(r[39]=e("label",null,"Number of Speed Levels *",-1)),W(e("select",{"onUpdate:modelValue":r[9]||(r[9]=F=>z.value=F)},[...r[38]||(r[38]=[e("option",{value:1},"1 Speed",-1),e("option",{value:2},"2 Speeds",-1),e("option",{value:3},"3 Speeds (Low/Med/High)",-1),e("option",{value:4},"4 Speeds",-1),e("option",{value:5},"5 Speeds",-1),e("option",{value:6},"6 Speeds",-1)])],512),[[Se,z.value,void 0,{number:!0}]])])]),e("div",Eu,[r[43]||(r[43]=e("h4",null,"Additional Features",-1)),e("div",Ou,[e("label",Vu,[W(e("input",{type:"checkbox",value:"oscillate","onUpdate:modelValue":r[10]||(r[10]=F=>j.value=F)},null,512),[[ge,j.value]]),r[41]||(r[41]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-sync"}),_(" Oscillation ")],-1))]),e("label",Uu,[W(e("input",{type:"checkbox",value:"direction","onUpdate:modelValue":r[11]||(r[11]=F=>j.value=F)},null,512),[[ge,j.value]]),r[42]||(r[42]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-rotate-3d-variant"}),_(" Direction (Forward/Reverse) ")],-1))])])])])):p.value.platform==="light"?(l(),s("div",Pu,[r[51]||(r[51]=e("h3",null,"Light Configuration",-1)),r[52]||(r[52]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),_(" Configure the features your light supports. You'll learn the IR commands in the next step. ")],-1)),e("div",Fu,[r[50]||(r[50]=e("h4",null,"Supported Features",-1)),e("div",ju,[e("label",Nu,[W(e("input",{type:"checkbox",value:"turn_on","onUpdate:modelValue":r[12]||(r[12]=F=>ee.value=F)},null,512),[[ge,ee.value]]),r[46]||(r[46]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),_(" Power On/Off ")],-1))]),e("label",Bu,[W(e("input",{type:"checkbox",value:"brightness","onUpdate:modelValue":r[13]||(r[13]=F=>ee.value=F)},null,512),[[ge,ee.value]]),r[47]||(r[47]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-brightness-6"}),_(" Brightness Control ")],-1))]),e("label",Hu,[W(e("input",{type:"checkbox",value:"color_temp","onUpdate:modelValue":r[14]||(r[14]=F=>ee.value=F)},null,512),[[ge,ee.value]]),r[48]||(r[48]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-thermometer"}),_(" Color Temperature ")],-1))]),e("label",qu,[W(e("input",{type:"checkbox",value:"rgb","onUpdate:modelValue":r[15]||(r[15]=F=>ee.value=F)},null,512),[[ge,ee.value]]),r[49]||(r[49]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-palette"}),_(" RGB Color ")],-1))])])])])):x("",!0)])):x("",!0),i.value===2?(l(),s("div",zu,[be(hd,{modelValue:p.value.commands,"onUpdate:modelValue":r[16]||(r[16]=F=>p.value.commands=F),platform:p.value.platform,config:p.value.config,broadlinkDevice:p.value.broadlinkDevice,"onUpdate:broadlinkDevice":r[17]||(r[17]=F=>p.value.broadlinkDevice=F),manufacturer:p.value.manufacturer,model:p.value.model,commandType:p.value.commandType,"onUpdate:commandType":r[18]||(r[18]=F=>p.value.commandType=F)},null,8,["modelValue","platform","config","broadlinkDevice","manufacturer","model","commandType"])])):x("",!0),i.value===3?(l(),s("div",Ju,[be(qd,{profile:p.value,"json-data":ce.value,"yaml-config":Le.value},null,8,["profile","json-data","yaml-config"])])):x("",!0)]),e("div",Wu,[i.value>0?(l(),s("button",{key:0,onClick:ye,class:"btn-secondary"},[...r[53]||(r[53]=[e("i",{class:"mdi mdi-arrow-left"},null,-1),_(" Back ",-1)])])):x("",!0),r[57]||(r[57]=e("div",{class:"spacer"},null,-1)),e("button",{onClick:R,class:"btn-text"}," Cancel "),i.value<b.length-1?(l(),s("button",{key:1,onClick:V,class:"btn-primary",disabled:!me.value},[...r[54]||(r[54]=[_(" Next ",-1),e("i",{class:"mdi mdi-arrow-right"},null,-1)])],8,Gu)):(l(),s("div",Ku,[e("button",{onClick:Q,class:"btn-primary",disabled:c.value},[r[55]||(r[55]=e("i",{class:"mdi mdi-cloud-upload"},null,-1)),_(" "+m(c.value?"Saving...":"Save to SmartIR"),1)],8,Xu),e("button",{onClick:I,class:"btn-secondary",disabled:c.value},[...r[56]||(r[56]=[e("i",{class:"mdi mdi-download"},null,-1),_(" Download JSON ",-1)])],8,Yu)]))])]),be(uu,{show:C.value,platform:p.value.platform,warnings:$.value,"config-path":T.value,onClose:r[20]||(r[20]=F=>C.value=!1),onComplete:se},null,8,["show","platform","warnings","config-path"]),be(Ve,{isOpen:M.value,title:"Change Command Type?",message:"Changing the command type will clear all learned commands. Continue?",confirmText:"Continue",cancelText:"Cancel",dangerMode:!0,onConfirm:S,onCancel:u},null,8,["isOpen"]),be(Ve,{isOpen:G.value,title:"Close Profile Builder?",message:"Are you sure you want to close? Your progress will be lost.",confirmText:"Close",cancelText:"Keep Editing",dangerMode:!0,onConfirm:H,onCancel:r[21]||(r[21]=F=>G.value=!1)},null,8,["isOpen"])])):x("",!0)}},Qu=we(Zu,[["__scopeId","data-v-2e218e9d"]]),ec={class:"dashboard"},tc={key:1,class:"welcome-banner"},oc={__name:"Dashboard",setup(o){const v=Fe(),d=Te("smartirEnabled"),{isMobile:k}=Ke(),h=g(!1),i=g(!1),c=g(null),f=g(0),C=g(null),$=g(localStorage.getItem("welcome_banner_dismissed")==="true");function T(){$.value=!0,localStorage.setItem("welcome_banner_dismissed","true")}function w(){i.value=!1,c.value=null,f.value=0,h.value=!0}async function t({platform:P,profile:D,startStep:a}){f.value=Number.isInteger(a)?a:0;try{const b=await fetch(`api/smartir/platforms/${P}/profiles/${D.code}`);if(!b.ok)throw new Error("Failed to load profile");const p=await b.json();let E="";try{const z=await fetch(`api/smartir/config/get-device?platform=${P}&code=${D.code}`);z.ok?(E=(await z.json()).controller_data||"",console.log("âœ… Found controller_data from YAML:",E)):console.warn("âš ï¸ No YAML entry found for this profile (this is OK for profiles not yet added to config)")}catch(z){console.warn("âš ï¸ Could not fetch controller_data from config:",z)}i.value=!0,c.value={platform:P,code:D.code,profile:{...p.profile,controller_data:E}},h.value=!0}catch(b){console.error("Error loading profile for edit:",b),v.error("Failed to load profile for editing")}}function M(){h.value=!1,i.value=!1,c.value=null}async function G(P){console.log("Profile saved:",P),M(),C.value&&C.value.loadAllProfiles&&(await C.value.loadAllProfiles(),console.log("âœ… Profiles list refreshed"))}return(P,D)=>(l(),s("div",ec,[$e(d)?(l(),Ee(Js,{key:0})):x("",!0),!$e(k)&&!$.value?(l(),s("div",tc,[e("button",{class:"dismiss-button",onClick:T,title:"Dismiss"},[...D[0]||(D[0]=[e("i",{class:"mdi mdi-close"},null,-1)])]),D[1]||(D[1]=Ue('<div class="banner-content" data-v-12185d74><div class="banner-icon" data-v-12185d74><i class="mdi mdi-rocket-launch" data-v-12185d74></i></div><div class="banner-text" data-v-12185d74><h2 data-v-12185d74>Welcome to Broadlink Manager v2!</h2><p data-v-12185d74>Manage your IR/RF devices with a modern Vue 3 interface</p></div></div><div class="status-badges" data-v-12185d74><span class="badge success" data-v-12185d74><i class="mdi mdi-check-circle" data-v-12185d74></i> Vue 3 Ready </span><span class="badge warning" data-v-12185d74><i class="mdi mdi-beta" data-v-12185d74></i> Beta </span></div>',2))])):x("",!0),be(js),$e(d)?(l(),Ee(qi,{key:2,ref_key:"smartirStatusCard",ref:C,onCreateProfile:w,onEditProfile:t},null,512)):x("",!0),be(Qu,{show:h.value,editMode:i.value,editData:c.value,startStep:f.value,onClose:M,onSave:G},null,8,["show","editMode","editData","startStep"])]))}},lc=we(oc,[["__scopeId","data-v-12185d74"]]),nc={class:"toast-container"},sc={class:"toast-content"},ac={key:0,class:"toast-title"},ic={class:"toast-message"},rc={key:1,class:"toast-description"},dc=["onClick","title"],uc={__name:"Toast",setup(o,{expose:v}){const d=g([]);let k=0;function h(f){const C={success:"mdi-check-circle",error:"mdi-alert-circle",warning:"mdi-alert",info:"mdi-information"};return C[f]||C.info}function i({message:f,title:C,description:$,type:T="info",duration:w=5e3}){const t=k++,M={id:t,message:f,title:C,description:$,type:T};return d.value.push(M),w>0&&setTimeout(()=>{c(t)},w),t}function c(f){const C=d.value.findIndex($=>$.id===f);C>-1&&d.value.splice(C,1)}return v({addToast:i,removeToast:c,show:i,success:(f,C)=>i({message:f,title:C,type:"success"}),error:(f,C)=>i({message:f,title:C,type:"error",duration:0}),warning:(f,C)=>i({message:f,title:C,type:"warning",duration:0}),info:(f,C)=>i({message:f,title:C,type:"info"})}),(f,C)=>(l(),Ee(tt,{to:"body"},[e("div",nc,[be(rt,{name:"toast"},{default:Ge(()=>[(l(!0),s(pe,null,ke(d.value,$=>(l(),s("div",{key:$.id,class:Y(["toast",[`toast-${$.type}`,{"toast-persistent":$.type==="error"||$.type==="warning"}]])},[e("i",{class:Y(["mdi",h($.type)])},null,2),e("div",sc,[$.title?(l(),s("div",ac,m($.title),1)):x("",!0),e("div",ic,m($.message),1),$.description?(l(),s("div",rc,m($.description),1)):x("",!0)]),e("button",{onClick:T=>c($.id),class:Y(["toast-close",{"toast-close-prominent":$.type==="error"||$.type==="warning"}]),title:$.type==="error"||$.type==="warning"?"Click to dismiss":"Close"},[...C[0]||(C[0]=[e("i",{class:"mdi mdi-close"},null,-1)])],10,dc)],2))),128))]),_:1})])]))}},cc=we(uc,[["__scopeId","data-v-3948c088"]]),mc="0.3.0-alpha.1",vc={version:mc},pc={id:"app",class:"app-container"},fc={class:"app-header"},gc={class:"header-content"},yc={class:"header-right"},bc=["title"],hc={class:"settings-menu-container"},kc={key:0,class:"settings-menu"},wc=["title"],$c={class:"toggle-content"},Cc={key:0,class:"not-installed-label"},_c={key:0,href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"menu-item menu-link menu-subitem"},Sc=["disabled"],Ic=["disabled"],Dc=["disabled"],xc={class:"app-main"},Tc={class:"app-footer"},Mc={__name:"App",setup(o){const v=g(null),d=vc.version,k=g("light"),h=g(null),i=g(!1),c=g(!1),f=g(!1),C=g(localStorage.getItem("smartir_enabled")!=="false"),$=J(()=>{var p;return((p=h.value)==null?void 0:p.installed)||!1}),T=J(()=>({light:"mdi mdi-weather-sunny",medium:"mdi mdi-weather-partly-cloudy",dark:"mdi mdi-weather-night"})[k.value]),w=J(()=>({light:"Switch to Medium Theme",medium:"Switch to Dark Theme",dark:"Switch to Light Theme"})[k.value]),t=()=>{const p=["light","medium","dark"],z=(p.indexOf(k.value)+1)%p.length;k.value=p[z],document.body.classList.remove("medium-mode","dark-mode"),k.value==="medium"?document.body.classList.add("medium-mode"):k.value==="dark"&&document.body.classList.add("dark-mode"),localStorage.setItem("theme",k.value)},M=async()=>{try{const p=await lt.getStatus();h.value=p,p.installed?console.log("âœ… SmartIR detected:",p.version):console.log("â„¹ï¸ SmartIR not detected")}catch(p){console.error("Error checking SmartIR:",p),h.value={installed:!1,error:p.message}}},G=async()=>{var p,E,z;c.value=!0;try{const ee=(await ne.get("/api/diagnostics/markdown")).data.markdown;if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(ee),(p=v.value)==null||p.success("Diagnostic summary copied to clipboard!");else{const ie=document.createElement("textarea");ie.value=ee,ie.style.position="fixed",ie.style.left="-999999px",ie.style.top="-999999px",document.body.appendChild(ie),ie.focus(),ie.select();try{if(document.execCommand("copy"))(E=v.value)==null||E.success("Diagnostic summary copied to clipboard!");else throw new Error("execCommand failed")}finally{document.body.removeChild(ie)}}i.value=!1}catch(j){console.error("Error copying diagnostics:",j),(z=v.value)==null||z.error("Failed to copy diagnostics: "+j.message)}finally{c.value=!1}},P=async()=>{var p,E;c.value=!0;try{const z=await ne.get("/api/diagnostics/download",{responseType:"blob"}),j=window.URL.createObjectURL(new Blob([z.data])),ee=document.createElement("a");ee.href=j;const ie=z.headers["content-disposition"];let A="broadlink_manager_diagnostics.zip";if(ie){const N=ie.match(/filename="?(.+)"?/);N&&(A=N[1])}ee.setAttribute("download",A),document.body.appendChild(ee),ee.click(),ee.remove(),window.URL.revokeObjectURL(j),(p=v.value)==null||p.success("Diagnostic bundle downloaded!"),i.value=!1}catch(z){console.error("Error downloading diagnostics:",z),(E=v.value)==null||E.error("Failed to download diagnostics")}finally{c.value=!1}},D=()=>{$.value&&(C.value=!C.value,localStorage.setItem("smartir_enabled",C.value.toString()),window.location.reload())},a=async()=>{var p,E,z;f.value=!0;try{const j=await ne.post("/api/smartir/refresh-index");j.data.success?(p=v.value)==null||p.success(`Updated to v${j.data.version} (${j.data.total_devices} devices)`,"âœ… Index Updated"):(E=v.value)==null||E.error(j.data.error||"Unknown error","âŒ Update Failed")}catch(j){console.error("Error updating SmartIR index:",j),(z=v.value)==null||z.error("Failed to update device index","âŒ Update Error")}finally{f.value=!1,i.value=!1}},b=p=>{p.target.closest(".settings-menu-container")||(i.value=!1)};return Re(async()=>{const p=localStorage.getItem("theme");p&&["light","medium","dark"].includes(p)?(k.value=p,p==="medium"?document.body.classList.add("medium-mode"):p==="dark"&&document.body.classList.add("dark-mode")):localStorage.getItem("darkMode")==="true"&&(k.value="dark",document.body.classList.add("dark-mode"),localStorage.setItem("theme","dark")),await M();const E=Ze();E&&v.value&&(E.appContext.config.globalProperties.$toast=v.value),document.addEventListener("click",b)}),We(()=>{document.removeEventListener("click",b)}),Be("smartirStatus",h),Be("smartirEnabled",C),Be("refreshSmartIR",M),Be("toast",v),(p,E)=>(l(),s("div",pc,[e("header",fc,[e("div",gc,[E[13]||(E[13]=e("div",{class:"header-left"},[e("i",{class:"mdi mdi-remote"}),e("h1",null,"Broadlink Manager v2"),e("span",{class:"beta-badge"},"BETA")],-1)),e("div",yc,[e("button",{onClick:t,class:"icon-button",title:w.value},[e("i",{class:Y(T.value)},null,2)],8,bc),e("div",hc,[e("button",{onClick:E[0]||(E[0]=z=>i.value=!i.value),class:"icon-button",title:"Settings"},[...E[2]||(E[2]=[e("i",{class:"mdi mdi-cog"},null,-1)])]),i.value?(l(),s("div",kc,[E[9]||(E[9]=e("div",{class:"menu-section-title"},"Integration Settings",-1)),e("div",{class:Y(["menu-item toggle-item",{disabled:!$.value}]),onClick:E[1]||(E[1]=z=>$.value?D():null),title:$.value?"":"SmartIR is not installed"},[e("div",$c,[E[3]||(E[3]=e("i",{class:"mdi mdi-air-conditioner"},null,-1)),E[4]||(E[4]=e("span",null,"SmartIR Integration",-1)),$.value?x("",!0):(l(),s("span",Cc,"(Not Installed)"))]),e("div",{class:Y(["toggle-switch",{active:C.value&&$.value,disabled:!$.value}])},[...E[5]||(E[5]=[e("div",{class:"toggle-slider"},null,-1)])],2)],10,wc),C.value?(l(),s("a",_c,[...E[6]||(E[6]=[e("i",{class:"mdi mdi-github"},null,-1),e("span",null,"SmartIR on GitHub",-1)])])):x("",!0),C.value?(l(),s("button",{key:1,onClick:a,class:"menu-item menu-subitem",disabled:f.value},[e("i",{class:Y(["mdi",f.value?"mdi-loading mdi-spin":"mdi-refresh"])},null,2),e("span",null,m(f.value?"Updating...":"Update Device Index"),1)],8,Sc)):x("",!0),E[10]||(E[10]=e("div",{class:"menu-divider"},null,-1)),E[11]||(E[11]=e("div",{class:"menu-section-title"},"Diagnostics",-1)),e("button",{onClick:G,class:"menu-item",disabled:c.value},[...E[7]||(E[7]=[e("i",{class:"mdi mdi-content-copy"},null,-1),e("span",null,"Copy Diagnostics",-1)])],8,Ic),e("button",{onClick:P,class:"menu-item",disabled:c.value},[...E[8]||(E[8]=[e("i",{class:"mdi mdi-download"},null,-1),e("span",null,"Download Diagnostics",-1)])],8,Dc),E[12]||(E[12]=Ue('<div class="menu-divider" data-v-4bc2c39f></div><div class="menu-section-title" data-v-4bc2c39f>Help &amp; Support</div><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2#readme" target="_blank" class="menu-item menu-link" data-v-4bc2c39f><i class="mdi mdi-book-open-variant" data-v-4bc2c39f></i><span data-v-4bc2c39f>Documentation</span></a><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2/issues" target="_blank" class="menu-item menu-link" data-v-4bc2c39f><i class="mdi mdi-bug" data-v-4bc2c39f></i><span data-v-4bc2c39f>Report Issue</span></a><div class="menu-divider" data-v-4bc2c39f></div><div class="menu-section-title" data-v-4bc2c39f>Community</div><a href="https://community.home-assistant.io/t/broadlink-manager-modern-web-interface-for-broadlink-devices/938473" target="_blank" class="menu-item menu-link" data-v-4bc2c39f><i class="mdi mdi-forum" data-v-4bc2c39f></i><span data-v-4bc2c39f>HA Forum Discussion</span></a><a href="https://www.reddit.com/r/homeassistant/comments/1o1q3kf/release_broadlink_manager_addon_a_modern_web_ui/" target="_blank" class="menu-item menu-link" data-v-4bc2c39f><i class="mdi mdi-reddit" data-v-4bc2c39f></i><span data-v-4bc2c39f>Reddit Discussion</span></a><div class="menu-divider" data-v-4bc2c39f></div><div class="menu-section-title" data-v-4bc2c39f>Project</div><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2" target="_blank" class="menu-item menu-link" data-v-4bc2c39f><i class="mdi mdi-github" data-v-4bc2c39f></i><span data-v-4bc2c39f>GitHub Repository</span></a><a href="https://ko-fi.com/tonyperkins" target="_blank" class="menu-item menu-link menu-item-sponsor" data-v-4bc2c39f><i class="mdi mdi-coffee" data-v-4bc2c39f></i><span data-v-4bc2c39f>Support on Ko-fi</span></a>',12))])):x("",!0)])])])]),e("main",xc,[be(lc)]),e("footer",Tc,[e("p",null,"Broadlink Manager v"+m($e(d))+" | Built with Vue "+m(dt),1)]),be(cc,{ref_key:"toastRef",ref:v},null,512)]))}},Rc=we(Mc,[["__scopeId","data-v-4bc2c39f"]]),nt=ut(Rc),Lc=ct();nt.use(Lc);nt.mount("#app");
