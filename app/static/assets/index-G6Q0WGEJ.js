import{g as nt,r as g,o as Oe,a as qe,b as vt,d as pt,c as X,e as r,f as a,h as e,i as A,n as G,u as xe,t as v,j as T,F as he,k as Ce,w as ue,l as W,v as je,m as be,p as ke,q as Ke,s as tt,T as st,x as Re,y as Pe,z as ze,A as me,B as at,C as Je,D as Ne,E as it,G as Ye,H as ft,I as gt,J as yt,K as Xe,L as bt,M as ht}from"./vendor-DGiFqQ_g.js";(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const $ of document.querySelectorAll('link[rel="modulepreload"]'))k($);new MutationObserver($=>{for(const s of $)if(s.type==="childList")for(const m of s.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&k(m)}).observe(document,{childList:!0,subtree:!0});function i($){const s={};return $.integrity&&(s.integrity=$.integrity),$.referrerPolicy&&(s.referrerPolicy=$.referrerPolicy),$.crossOrigin==="use-credentials"?s.credentials="include":$.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function k($){if($.ep)return;$.ep=!0;const s=i($);fetch($.href,s)}})();let lt=!1;function Ge(){const t=nt(),c=t==null?void 0:t.appContext.config.globalProperties.$toast;return c||(lt||(console.warn("Toast notification system not yet initialized - using console fallback"),lt=!0),{success:i=>console.log("âœ“",i),error:i=>console.error("âœ—",i),warning:i=>console.warn("âš ",i),info:i=>console.info("â„¹",i)})}function ot(){const t=g(!1),c=g(!1),i=g(!1),k=g(0),$=767,s=768,m=1023,f=1024,S=()=>{const _=window.innerWidth;k.value=_,t.value=_<=$,c.value=_>=s&&_<=m,i.value=_>=f};return Oe(()=>{S(),window.addEventListener("resize",S)}),qe(()=>{window.removeEventListener("resize",S)}),{isMobile:t,isTablet:c,isDesktop:i,screenWidth:k,isMobileOrTablet:()=>t.value||c.value,isTabletOrDesktop:()=>c.value||i.value}}const Qe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAHBUlEQVR4nOxZC1BTVxo+9+aNZI2LNsgjWR4hgoIiRVDBslKnIKPbx1jqTrtYoakat1a6dNsdd7t1X8XHyAbEhdUu1u2mXdbasqJbtsaMIqBBECiPBmqEICEBEx4xJLlJ7s6lw6rJDeQ2FzLM+M1kBs7/3+/83zn/Oee/51JRFAXzGbCvA/AWjwX4GvNeANWXnXffHQ4+K6/dYbHeD+IFhjRkb1wn9WPQbEQ4IF/tQlXX2p5+/8OyczY74j/VxuMG3Sh/Oz9jaQDb4CmPT1LIbLXBfzrz0cmHg8fQpx1Yc1Ra+TsiXD4R0PqtRmAyj/LxbJeaujKIcPlEAINOM7vLXBaTZibCRWgRq3WGJZWX63aoNDpB8BJOX/bGlIqwpUv6iXBgWBHG7eUF8urUWvU6Z9sLGxI/IsLl8SJu6u4XigqPXkVspiVTbTQqU1/6Vn7ammh+G5FOMZyqludIKqUVU/9jcaSuTCo/unfHbiad4iBdwMu/P1bV1tO1xbk9NDC0/vwHB1xGcjqYLAh16zsHW3R6XXTu1mfFdAqMrIoSKNbGhLcQ4QGeppDJ7ACtPcqNEI6tT9O3Vqm+tygqNMDjrU9Sef6tIYM2JjUuuXzfC5knCEXsBI8WMZUCAxiCrfhWyMZkMNzYXNHVpwmXXqp5j0Hz0/1m57a3PQ8VHx4JoNMASIl9shLPFsB5ooO7iDXhCY/dAcCvT/79LwC1s/K2bDnAXcQeJRqwMzzeRt/bua0gLChcDsCDNQNBkEU/qot7o6j0kzETQpuJ40ZnT6xSrUoNWhyseHVz2ikv4n4QA5FSArE5IFlTZ0r3XU1MWODib6NCl3a9dkhSYxgbjo4XLq8sL9j7Ip36YEwMRjMNQazMhf7+RgYNnuyo7bY6ArFaWKuXRX495wLwoLk39sO9RaVnM5OTP8zLSjtjsljpp6ovi6pqr706eE8XBwGUSqEy9Guihf/92TMZhetjI5rJCHwKpBRzZqsNYtKp6KD+Pvv1w5ILdzR3UvD8HA4YefOl7N25JKUPIKuUwIJH7A5of/GJf7oLfrIz2EH786fSss+uKFzOk+8L0mqh6rpbmR0q5YyFGAQBSuHHlcUWxEaZyXfMhFD0Rgt9Oh/SBMiam58HAO+oc4XZMsK/1taT6M6uHjJw8w6VSNfvemM8TbzPlFlwsP5KyzfJeL6kCejXDgo894aASqOZ9O/uHwzq6B3ijhitkzOC7XS7j0g+V3S0vQTDDhYEoZSBobvJ+yXFNZ29gy4lOGmvlDBMIfQqSKV8539EWvXHhvbGHBSFrAwGW+vvxzLoR7RxzrNpsyPs0xcv7/lg1/ZfPtKvuw7MVhulUakWdvRq+XY3tWFT90Bk+52BCOzvyOBgjytSFKAgms+b9F/2o+BbKwUrvgjhhjSjKLAPG4YE7lJxfEIf5dyGOwMXrren/eF0RYXRNMrHDt4QbmjDEbHop9F8rqpddZd3sV6R/aWiabtWr41PW534V8m+PFHW+qSPL9TX7oM8WAaBi4IbE4S8yYNs/7asIgBA0ZStRqFM/MXxIzcgHBEBP+C6DJKLgJvK3uXvniitBsDmNzkSEAD9uv5k0aFjXy1gMQ0DQ5p4CAIwNuXLwyL/ExcpqMWeS42NUmxKXFf8VWPdz6cLnkqhGd/Pe+U1Cow/+ekJUYr4qJgvbik7f/Jw+0J/tjpvS3qxs7/LQZZfcrrkUmOdGI/cgUKIkB8pz0xK+CQjKf6z4MWckYftZqsderfsTInsZt0evDRgMRYMHhaLnk+NW1Y/nchxk5lZ+I/Pf/vl9RvbLYiVlSBcJv/VK9sKBCHc3hkF7D12/NzVltZn8YhzNj/3ev6LGeXTdQ6+uzLZ+C+5XNza05Nsd1gXcNgBvekJK/+du3lTUSiXMzzT80TgkkK8wJAGgCMAE5ooFFz3hHTr+lgZ9iMryOngkoi5WZuOc9hPtDu3r4198nTqygjCr3wYmrvVkSerZXljJoT0m0DcYm5g2Mg5WV39zrVWZZofkzaRnhB/bufm9FI/JpXQXj8F8bHyitqWxhzJmwUJT60SNJER+P+BCZjt34lzNbvickRoWVWNmGzuObnYWhER3oAdX41dPbj1jDeYEwGrInltKKCNtatub6hRfJOEnfJkcc+JgE9ltS/DkINuNI3xCo4fbXgm/0CnouvOcjK4Z/16/ZKia+3+kqIrEIQ+sgNx2Jzb5wsPxrD9GBZv+Gd9BqSXr4icg8cwMj4SLmv6+mlv+WddgGlilOPOZkEmFnrLP+sCVgtXyPHaHShkiw0XXPWWf9YF5Gb9uGzp4sCbj7ai4LkNTx2O5nPV3vLPyTeye6P32X+7KNujVKtSYJg+viEu/mx2etJZCgnD57OPfGRh3n8nfizA15j3Av4XAAD//5k1S2w3zfwVAAAAAElFTkSuQmCC",oe=vt.create({baseURL:"./",timeout:3e4,headers:{"Content-Type":"application/json","Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"}});oe.interceptors.request.use(t=>t,t=>Promise.reject(t));oe.interceptors.response.use(t=>t,t=>(console.error("API Error:",t),t.response?console.error("Response error:",t.response.data):t.request?console.error("No response received"):console.error("Request setup error:",t.message),Promise.reject(t)));const kt=pt("devices",{state:()=>({devices:[],loading:!1,error:null,selectedDevice:null}),getters:{deviceById:t=>c=>t.devices.find(i=>i.id===c),devicesByType:t=>c=>t.devices.filter(i=>i.entity_type===c),deviceCount:t=>t.devices.length,hasDevices:t=>t.devices.length>0},actions:{async loadDevices(t=!1){this.loading=!0,this.error=null;try{const c=t?`/api/devices/managed?_t=${Date.now()}`:"/api/devices/managed",i=await oe.get(c);this.devices=i.data.devices||[],console.log("ğŸ“¥ Loaded devices:",this.devices),this.devices.forEach(k=>{console.log(`ğŸ“¥ Device "${k.name}":`,{id:k.id,device:k.device,commands:k.commands,commandCount:k.commands?Object.keys(k.commands).length:0})})}catch(c){this.error=c.message,console.error("Error loading devices:",c)}finally{this.loading=!1}},async createDevice(t){this.loading=!0,this.error=null;try{console.log("ğŸª Store: Creating device with data:",t),console.log("ğŸª Store: Device commands being sent:",t.commands);const c={device_name:t.name,device:t.device,area_id:t.area||"",area_name:t.area||"",entity_type:t.entity_type,icon:t.icon,broadlink_entity:t.broadlink_entity,device_type:t.device_type||"broadlink",commands:t.commands||{}};t.device_type==="smartir"&&t.smartir_config&&(c.smartir_config=t.smartir_config),console.log("ğŸª Store: Transformed data for backend:",c);const i=await oe.post("/api/devices/managed",c);return console.log("ğŸª Store: Create response:",i.data),await this.loadDevices(),i.data}catch(c){throw console.error("Error creating device:",c),c}finally{this.loading=!1}},async updateDevice(t,c){this.loading=!0,this.error=null;try{const i=await oe.put(`/api/devices/managed/${t}`,c);return await this.loadDevices(),i.data}catch(i){throw console.error("Error updating device:",i),i}finally{this.loading=!1}},async deleteDevice(t,c=!1){this.loading=!0,this.error=null;try{await oe.delete(`/api/devices/managed/${t}`,{data:{delete_commands:c}}),this.devices=this.devices.filter(i=>i.id!==t)}catch(i){throw this.error=i.message,console.error("Error deleting device:",i),i}finally{this.loading=!1}},selectDevice(t){this.selectedDevice=t},clearSelection(){this.selectedDevice=null},clearError(){this.error=null},updateDeviceCommands(t,c){const i=this.devices.findIndex(k=>k.id===t);if(i!==-1){const k={...this.devices[i],commands:c};this.devices.splice(i,1,k),console.log(`âœ… Store: Updated commands for ${t}, count: ${Object.keys(c).length}`)}else console.warn(`âš ï¸ Store: Device ${t} not found for command update`)},async syncAllAreas(){if(!this.devices||this.devices.length===0){console.log("âš ï¸ No devices to sync");return}console.log(`ğŸ”„ Syncing areas from Home Assistant for ${this.devices.length} devices...`);try{const t=await Promise.all(this.devices.map(k=>(console.log(`ğŸ”„ Syncing device: ${k.id} (${k.name})`),oe.post(`/api/devices/${k.id}/sync-area`).then($=>$.data.success&&$.data.area?(console.log(`âœ… Synced area for ${k.name}: ${$.data.area}`),{status:"synced",device:k.name}):{status:"no_area"}).catch($=>{var s;return((s=$.response)==null?void 0:s.status)===404?(console.log(`âŒ Device not found in HA: ${k.id}`),{status:"not_found"}):(console.warn(`âš ï¸ Failed to sync area for ${k.id}:`,$.message),{status:"error",error:$.message})})))),c=t.filter(k=>k.status==="synced").length,i=t.filter(k=>k.status==="not_found").length;await this.loadDevices(!0),c>0?console.log(`âœ… Area sync complete: ${c} synced, ${i} not found in HA`):i>0&&console.log(`â„¹ï¸ No areas synced - ${i} entities not found in HA registry (generate entities first)`)}catch(t){console.debug("Area sync error:",t)}}}});function rt(t){const c=X(()=>t.value||t),i=X(()=>{switch(c.value){case"climate":return"mdi:air-conditioner";case"fan":return"mdi:fan";case"light":return"mdi:lightbulb";case"media_player":return"mdi:television";case"switch":return"mdi:light-switch";default:return"mdi:devices"}}),k=X(()=>`device-type-${c.value}-color`),$=X(()=>`tag-${c.value}-bg`);return{icon:i,colorClass:k,tagBgClass:$}}const dt=""+new URL("broadlink-logo-BDjImjRY.png",import.meta.url).href,De=(t,c)=>{const i=t.__vccOpts||t;for(const[k,$]of c)i[k]=$;return i},wt={class:"device-header"},$t={class:"device-info"},Ct=["title"],_t={class:"device-labels"},St={class:"device-type"},It=["src","alt","title"],Dt={class:"device-body"},xt={class:"device-stats"},Tt={class:"stat",title:"Learned command count"},Mt={class:"stat",title:"HA Assigned Area"},Rt={class:"device-meta"},Et={class:"device-id",title:"Device ID"},Ot={key:0,class:"storage-name"},At={key:1,class:"broadlink-entity",title:"Controller Device"},Lt={key:2,class:"controller-device"},Pt={class:"device-actions"},Vt=["disabled"],jt=["disabled"],Ut=["disabled"],Ft={key:0,class:"disabled-overlay"},Nt={__name:"DeviceCard",props:{device:{type:Object,required:!0},broadlinkDevices:{type:Array,default:()=>[]}},emits:["edit","delete","learn"],setup(t){const c=t,i=X(()=>localStorage.getItem("smartir_simulate_not_installed")==="true"),k=X(()=>c.device.device_type==="smartir"&&i.value),$=g(null),s=rt(X(()=>c.device.entity_type)),m=X(()=>c.device.icon?c.device.icon:s.icon.value),f=x=>x&&x.startsWith("mdi:")?`mdi ${x.replace(":"," mdi-")}`:`mdi mdi-${x}`,S=X(()=>({light:"Light",fan:"Fan",switch:"Switch",media_player:"Media Player",cover:"Cover"})[c.device.entity_type]||c.device.entity_type),_=X(()=>(c.device.device_type||"broadlink")==="smartir"?"SmartIR":"Broadlink"),L=X(()=>(c.device.device_type||"broadlink")==="smartir"?Qe:dt),w=X(()=>(c.device.device_type||"broadlink")==="smartir"?$.value!==null?$.value:0:Object.keys(c.device.commands||{}).length),n=x=>{if(!x)return"";const o=c.broadlinkDevices.find(b=>b.entity_id===x);return o&&o.name||x},V=X(()=>{if(!c.device.device)return!1;const x=c.device.id.includes(".")?c.device.id.split(".")[1]:c.device.id;return c.device.device!==x}),z=X(()=>{if(!c.device.broadlink_entity)return"";const x=c.broadlinkDevices.find(o=>o.entity_id===c.device.broadlink_entity);return x&&x.name||c.device.broadlink_entity}),N=x=>{if(!x||typeof x!="object")return 0;let o=0;for(const b of Object.values(x))typeof b=="string"?o++:typeof b=="object"&&(o+=N(b));return o},E=async()=>{if(!(!c.device.device_code||!c.device.entity_type))try{const x=await oe.get("/api/smartir/codes/code",{params:{entity_type:c.device.entity_type,code_id:c.device.device_code}});if(x.data.success&&x.data.code){const o=x.data.code;o.commands&&($.value=N(o.commands))}}catch(x){console.error("Error fetching SmartIR command count:",x)}};return Oe(async()=>{(c.device.device_type||"broadlink")==="smartir"&&await E()}),(x,o)=>(a(),r("div",{class:G(["device-card",{disabled:k.value}])},[e("div",wt,[e("div",{class:G(["device-icon",xe(s).colorClass.value])},[e("i",{class:G(f(m.value))},null,2)],2),e("div",$t,[e("h3",{title:t.device.name},v(t.device.name),9,Ct),e("div",_t,[e("span",St,v(S.value),1)])]),e("img",{src:L.value,alt:_.value,title:_.value,class:"device-source-logo"},null,8,It)]),e("div",Dt,[e("div",xt,[e("div",Tt,[o[3]||(o[3]=e("i",{class:"mdi mdi-remote"},null,-1)),e("span",null,v(w.value)+" command"+v(w.value!==1?"s":""),1)]),e("div",Mt,[o[4]||(o[4]=e("i",{class:"mdi mdi-map-marker"},null,-1)),e("span",null,v(t.device.area||"No area"),1)])]),e("div",Rt,[e("span",Et,[o[5]||(o[5]=e("i",{class:"mdi mdi-identifier"},null,-1)),T(" "+v(t.device.id),1)]),V.value?(a(),r("span",Ot,[o[6]||(o[6]=e("i",{class:"mdi mdi-code-tags"},null,-1)),T(" "+v(t.device.device),1)])):A("",!0),t.device.broadlink_entity?(a(),r("span",At,[o[7]||(o[7]=e("i",{class:"mdi mdi-access-point"},null,-1)),T(" "+v(z.value),1)])):A("",!0),t.device.controller_device?(a(),r("span",Lt,[o[8]||(o[8]=e("i",{class:"mdi mdi-access-point"},null,-1)),T(" "+v(n(t.device.controller_device)),1)])):A("",!0)])]),e("div",Pt,[e("button",{onClick:o[0]||(o[0]=b=>!k.value&&x.$emit("learn",t.device)),class:"icon-btn",title:"Manage Commands",disabled:k.value},[...o[9]||(o[9]=[e("i",{class:"mdi mdi-remote-tv"},null,-1)])],8,Vt),e("button",{onClick:o[1]||(o[1]=b=>!k.value&&x.$emit("edit",t.device)),class:"icon-btn",title:"Edit",disabled:k.value},[...o[10]||(o[10]=[e("i",{class:"mdi mdi-pencil"},null,-1)])],8,jt),e("button",{onClick:o[2]||(o[2]=b=>!k.value&&x.$emit("delete",t.device)),class:"icon-btn danger",title:"Delete",disabled:k.value},[...o[11]||(o[11]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,Ut)]),k.value?(a(),r("div",Ft,[...o[12]||(o[12]=[e("div",{class:"disabled-message"},[e("i",{class:"mdi mdi-eye-off"}),e("span",null,"SmartIR Not Installed")],-1)])])):A("",!0)],2))}},Bt=De(Nt,[["__scopeId","data-v-7a7f5c18"]]),Ht={name:"DeviceListView",props:{devices:{type:Array,required:!0}},methods:{getDeviceSourceLogo(t){return(t.device_type||"broadlink")==="smartir"?Qe:dt},getDeviceCommands(t){return t.commands&&typeof t.commands=="object"?Object.keys(t.commands):[]},getCommandType(t,c){return t.commands&&t.commands[c]&&t.commands[c].type||"ir"},getCommandTypeClass(t,c){return this.getCommandType(t,c)==="rf"?"command-rf":"command-ir"},getCommandTypeLabel(t,c){return this.getCommandType(t,c)==="rf"?"RF Command":"IR Command"},sendCommand(t,c){this.$emit("send-command",{device:t,command:c})},openCommands(t){this.$emit("open-commands",t)},editDevice(t){this.$emit("edit-device",t)},deleteDevice(t){this.$emit("delete-device",t)}}},qt={class:"device-list-view"},zt={class:"device-table"},Jt={class:"device-info"},Wt={class:"device-name"},Gt={class:"device-entity"},Kt={class:"device-area"},Xt={class:"device-type"},Yt=["src","alt","title"],Zt={class:"device-commands"},Qt={key:0,class:"command-list"},eo=["onClick","title"],to={key:0,class:"no-commands"},oo={key:1,class:"smartir-info"},lo={class:"profile-code"},no={class:"device-actions"},so=["onClick"],ao=["onClick"],io=["onClick"];function ro(t,c,i,k,$,s){return a(),r("div",qt,[e("table",zt,[c[3]||(c[3]=e("thead",null,[e("tr",null,[e("th",null,"Device"),e("th",null,"Room/Area"),e("th",null,"Type"),e("th",null,[e("div",{class:"commands-header"},[e("span",null,"Commands"),e("div",{class:"command-legend"},[e("span",{class:"legend-badge command-rf"},"RF"),e("span",{class:"legend-badge command-ir"},"IR")])])]),e("th",null,"Actions")])],-1)),e("tbody",null,[(a(!0),r(he,null,Ce(i.devices,m=>(a(),r("tr",{key:m.entity_id,class:"device-row"},[e("td",Jt,[e("div",Wt,v(m.friendly_name||m.name),1),e("div",Gt,v(m.entity_id),1)]),e("td",Kt,v(m.area||"No Area"),1),e("td",Xt,[e("img",{src:s.getDeviceSourceLogo(m),alt:m.device_type==="smartir"?"SmartIR":"Broadlink",title:m.device_type==="smartir"?"SmartIR":"Broadlink",class:"device-source-logo"},null,8,Yt)]),e("td",Zt,[(m.device_type||"broadlink")==="broadlink"?(a(),r("div",Qt,[(a(!0),r(he,null,Ce(s.getDeviceCommands(m),f=>(a(),r("button",{key:f,class:G(["command-btn",s.getCommandTypeClass(m,f)]),onClick:S=>s.sendCommand(m,f),title:s.getCommandTypeLabel(m,f)},v(f),11,eo))),128)),s.getDeviceCommands(m).length===0?(a(),r("span",to," No commands ")):A("",!0)])):m.device_type==="smartir"?(a(),r("div",oo,[e("span",lo,"Profile: "+v(m.device_code),1)])):A("",!0)]),e("td",no,[e("button",{class:"action-btn commands",onClick:f=>s.openCommands(m),title:"Manage Commands"},[...c[0]||(c[0]=[e("i",{class:"mdi mdi-remote-tv"},null,-1)])],8,so),e("button",{class:"action-btn edit",onClick:f=>s.editDevice(m),title:"Edit"},[...c[1]||(c[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})],-1)])],8,ao),e("button",{class:"action-btn delete",onClick:f=>s.deleteDevice(m),title:"Delete"},[...c[2]||(c[2]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"3 6 5 6 21 6"}),e("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})],-1)])],8,io)])]))),128))])])])}const uo=De(Ht,[["render",ro],["__scopeId","data-v-2895a204"]]),co={class:"icon-picker"},mo={class:"icon-input-wrapper"},vo=["id","placeholder"],po={key:0,class:"icon-preview"},fo={key:0,class:"icon-dropdown"},go={class:"icon-grid"},yo=["onMousedown","title"],bo={__name:"IconPicker",props:{modelValue:{type:String,default:""},inputId:{type:String,default:"icon-input"},placeholder:{type:String,default:"e.g., mdi:television"}},emits:["update:modelValue"],setup(t,{emit:c}){const i=t,k=c,$=g(i.modelValue),s=g(!1),m=["television","speaker","radio","music","video","movie","play","pause","stop","skip-next","skip-previous","volume-high","volume-medium","volume-low","volume-off","remote","remote-tv","cast","chromecast","spotify","netflix","youtube","lightbulb","lightbulb-on","lightbulb-off","lamp","floor-lamp","ceiling-light","light-switch","led-strip","led-strip-variant","wall-sconce","chandelier","spotlight","track-light","vanity-light","desk-lamp","fan","ceiling-fan","air-conditioner","thermometer","thermostat","heat-wave","snowflake","fire","radiator","water-boiler","hvac","blinds","blinds-open","window-shutter","window-shutter-open","curtains","curtains-closed","roller-shade","roller-shade-closed","garage","garage-open","gate","door","door-open","window-open","window-closed","washing-machine","tumble-dryer","dishwasher","refrigerator","stove","microwave","oven","toaster","kettle","coffee","coffee-maker","blender","robot-vacuum","robot-vacuum-variant","vacuum","broom","spray-bottle","lock","lock-open","lock-smart","key","shield","shield-check","alarm-light","bell","doorbell","camera","cctv","motion-sensor","smoke-detector","fire-extinguisher","water-alert","gas-cylinder","sofa","bed","bed-double","desk","chair","table","bookshelf","home","home-outline","home-assistant","floor-plan","room","weather-sunny","weather-night","weather-cloudy","weather-rainy","weather-snowy","weather-lightning","weather-windy","weather-fog","weather-partly-cloudy","umbrella","water","water-percent","phone","cellphone","tablet","laptop","desktop-tower","monitor","keyboard","mouse","printer","router","router-wireless","access-point","wifi","bluetooth","usb","hdmi-port","ethernet","power","power-plug","power-socket","battery","battery-charging","lightning-bolt","flash","solar-panel","solar-power","leaf","tree","flower","sprout","grass","watering-can","shovel","fence","pool","hot-tub","silverware","silverware-fork-knife","food","food-apple","glass-wine","glass-cocktail","bottle-wine","pot","pot-steam","shower","shower-head","bathtub","toilet","sink","faucet","hand-wash","car","car-side","garage-variant","tools","hammer","wrench","screwdriver","toolbox","ladder","heart","heart-pulse","run","walk","bike","dumbbell","yoga","scale-bathroom","thermometer-lines","clock","clock-outline","timer","alarm","calendar","calendar-today","calendar-clock","history","bell-ring","bell-alert","alert","alert-circle","information","help-circle","check","check-circle","close-circle","minus-circle","plus-circle","arrow-up","arrow-down","arrow-left","arrow-right","chevron-up","chevron-down","menu","dots-vertical","dots-horizontal","cog","tune","circle","square","triangle","hexagon","star","star-outline","heart-outline","plus","minus","close","check-bold","eye","eye-off","account","account-group","baby","dog","cat","paw","gift","balloon","party-popper","candle","book","book-open","newspaper","email","message","phone-classic"];ue(()=>i.modelValue,w=>{$.value=w});const f=X(()=>{if(!$.value)return m.slice(0,50);const w=$.value.toLowerCase().replace("mdi:","");return m.filter(n=>n.toLowerCase().includes(w)).slice(0,50)}),S=()=>{s.value=!0,k("update:modelValue",$.value)},_=()=>{setTimeout(()=>{s.value=!1},200)},L=w=>{$.value=`mdi:${w}`,k("update:modelValue",$.value),s.value=!1};return(w,n)=>(a(),r("div",co,[e("div",mo,[W(e("input",{id:t.inputId,"onUpdate:modelValue":n[0]||(n[0]=V=>$.value=V),type:"text",placeholder:t.placeholder,onInput:S,onFocus:n[1]||(n[1]=V=>s.value=!0),onBlur:_},null,40,vo),[[je,$.value]]),$.value?(a(),r("div",po,[e("i",{class:G(`mdi mdi-${$.value.replace("mdi:","")}`)},null,2)])):A("",!0)]),s.value&&f.value.length>0?(a(),r("div",fo,[e("div",go,[(a(!0),r(he,null,Ce(f.value,V=>(a(),r("div",{key:V,class:"icon-option",onMousedown:be(z=>L(V),["prevent"]),title:V},[e("i",{class:G(`mdi mdi-${V}`)},null,2),e("span",null,v(V),1)],40,yo))),128))])])):A("",!0)]))}},ho=De(bo,[["__scopeId","data-v-a64f5011"]]),ko={key:0,class:"dropdown-label"},wo={key:0,class:"required"},$o=["placeholder","disabled","onKeydown"],Co={class:"dropdown-icons"},_o={key:0,class:"mdi mdi-loading mdi-spin"},So={key:2,class:"mdi mdi-chevron-down"},Io={key:1,class:"error-message"},Do={key:2,class:"hint-message"},xo={key:0,class:"dropdown-menu"},To=["onMousedown","onMouseenter"],Mo={class:"option-content"},Ro={class:"option-label"},Eo={key:0,class:"option-description"},Oo={key:0,class:"mdi mdi-check selected-icon"},Ao={key:3,class:"dropdown-menu"},Lo={__name:"SearchableDropdown",props:{modelValue:{type:[String,Number,Object],default:null},options:{type:Array,required:!0,default:()=>[]},label:{type:String,default:""},placeholder:{type:String,default:"Search..."},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},error:{type:String,default:""},hint:{type:String,default:""},optionLabel:{type:String,default:"label"},optionValue:{type:String,default:"value"},optionDescription:{type:String,default:"description"},filterMethod:{type:Function,default:null}},emits:["update:modelValue","change","search"],setup(t,{emit:c}){const i=t,k=c,$=g(null),s=g(null),m=g(""),f=g(!1),S=g(0),_=g(!1),L=M=>typeof M=="string"||typeof M=="number"?M:M[i.optionLabel]||M.label||M.name||String(M),w=M=>typeof M=="string"||typeof M=="number"?M:M[i.optionValue]||M.value||M.id||M,n=M=>typeof M=="string"||typeof M=="number"?"":M[i.optionDescription]||M.description||"",V=M=>{const B=w(M);return typeof i.modelValue=="object"?w(i.modelValue)===B:i.modelValue===B},z=X(()=>{if(!m.value)return i.options;if(i.filterMethod)return i.options.filter(B=>i.filterMethod(B,m.value));const M=m.value.toLowerCase();return i.options.filter(B=>{const se=L(B).toLowerCase(),fe=n(B).toLowerCase();return se.includes(M)||fe.includes(M)})}),N=X(()=>{if(!i.modelValue)return"";const M=i.options.find(B=>{const se=w(B);return typeof i.modelValue=="object"?se===w(i.modelValue):se===i.modelValue});return M?L(M):""});ue(()=>i.modelValue,M=>{_.value||(m.value=N.value)}),ue(()=>i.options,()=>{!_.value&&i.modelValue&&(m.value=N.value)},{deep:!0}),ue(m,M=>{k("search",M),S.value=0}),Oe(()=>{m.value=N.value});const E=()=>{var M;_.value=!0,f.value=!0,(M=s.value)==null||M.select()},x=()=>{_.value=!1,setTimeout(()=>{f.value=!1,i.modelValue?m.value=N.value:m.value=""},200)},o=()=>{var M;f.value=!1,(M=s.value)==null||M.blur()},b=M=>{const B=w(M);k("update:modelValue",B),k("change",B,M),m.value=L(M),o()},P=()=>{var M;k("update:modelValue",null),k("change",null,null),m.value="",(M=s.value)==null||M.focus()},p=()=>{if(!f.value){f.value=!0;return}S.value<z.value.length-1&&S.value++},Z=()=>{S.value>0&&S.value--},ne=()=>{z.value.length>0&&S.value>=0&&b(z.value[S.value])},J=M=>{$.value&&!$.value.contains(M.target)&&(f.value=!1,i.modelValue?m.value=N.value:m.value="")};return Oe(()=>{document.addEventListener("click",J)}),qe(()=>{document.removeEventListener("click",J)}),(M,B)=>(a(),r("div",{class:"searchable-dropdown",ref_key:"dropdownRef",ref:$},[t.label?(a(),r("label",ko,[T(v(t.label)+" ",1),t.required?(a(),r("span",wo,"*")):A("",!0)])):A("",!0),e("div",{class:G(["dropdown-input-wrapper",{"has-error":t.error,disabled:t.disabled}])},[W(e("input",{ref_key:"inputRef",ref:s,type:"text","onUpdate:modelValue":B[0]||(B[0]=se=>m.value=se),placeholder:t.placeholder,disabled:t.disabled||t.loading,onFocus:E,onBlur:x,onKeydown:[Ke(be(p,["prevent"]),["down"]),Ke(be(Z,["prevent"]),["up"]),Ke(be(ne,["prevent"]),["enter"]),Ke(o,["escape"])],class:"dropdown-input"},null,40,$o),[[je,m.value]]),e("div",Co,[t.loading?(a(),r("i",_o)):t.modelValue&&!t.disabled?(a(),r("i",{key:1,class:"mdi mdi-close-circle clear-icon",onClick:P})):(a(),r("i",So))])],2),t.error?(a(),r("div",Io,v(t.error),1)):A("",!0),t.hint&&!t.error?(a(),r("div",Do,v(t.hint),1)):A("",!0),ke(st,{name:"dropdown"},{default:tt(()=>[f.value&&z.value.length>0?(a(),r("div",xo,[(a(!0),r(he,null,Ce(z.value,(se,fe)=>(a(),r("div",{key:w(se),class:G(["dropdown-item",{highlighted:fe===S.value,selected:V(se)}]),onMousedown:be(Ee=>b(se),["prevent"]),onMouseenter:Ee=>S.value=fe},[e("div",Mo,[e("div",Ro,v(L(se)),1),n(se)?(a(),r("div",Eo,v(n(se)),1)):A("",!0)]),V(se)?(a(),r("i",Oo)):A("",!0)],42,To))),128))])):A("",!0)]),_:1}),f.value&&z.value.length===0&&!t.loading?(a(),r("div",Ao,[...B[1]||(B[1]=[e("div",{class:"dropdown-item no-results"},[e("i",{class:"mdi mdi-magnify"}),T(" No results found ")],-1)])])):A("",!0)],512))}},Ze=De(Lo,[["__scopeId","data-v-679ce35f"]]),Po={class:"smartir-selector"},Vo={class:"form-group"},jo={class:"form-group"},Uo={class:"form-group"},Fo=["value"],No={key:0,class:"error-message"},Bo={class:"form-group"},Ho={class:"form-group"},qo={key:1,class:"code-info"},zo={class:"info-content"},Jo={class:"info-row"},Wo={class:"info-value"},Go={class:"info-row"},Ko={class:"info-value"},Xo={key:0,class:"info-row"},Yo={class:"info-value"},Zo={class:"info-row"},Qo={class:"info-value"},el={__name:"SmartIRDeviceSelector",props:{entityType:{type:String,required:!0},modelValue:{type:Object,default:()=>({})},broadlinkDevices:{type:Array,default:()=>[]}},emits:["update:modelValue","change"],setup(t,{expose:c,emit:i}){const k=t,$=i,s=g([]),m=g([]),f=g(""),S=g(""),_=g(""),L=g(""),w=g(""),n=g(null),V=g(!1),z=g(!1),N=g({manufacturer:"",model:"",controller:""});Oe(async()=>{if(await E(),k.modelValue&&(f.value=k.modelValue.manufacturer||"",S.value=k.modelValue.device_code||"",_.value=k.modelValue.controller_device||"",L.value=k.modelValue.temperature_sensor||"",w.value=k.modelValue.humidity_sensor||"",f.value&&(await x(f.value),S.value&&m.value.length>0))){const M=m.value.find(B=>B.code===S.value);M&&(n.value={code:M.code,manufacturer:f.value,models:M.models,controller:M.controller})}}),ue(()=>k.entityType,async M=>{M&&(f.value="",S.value="",m.value=[],n.value=null,await E())});const E=async()=>{if(k.entityType){V.value=!0,N.value.manufacturer="";try{const M=await oe.get("/api/smartir/codes/manufacturers",{params:{entity_type:k.entityType}});if(M.data.success)s.value=M.data.manufacturers||[];else throw new Error(M.data.error||"Failed to load manufacturers")}catch(M){console.error("Error loading manufacturers:",M),N.value.manufacturer="Failed to load manufacturers. Please try again.",s.value=[]}finally{V.value=!1}}},x=async M=>{if(!(!M||!k.entityType)){z.value=!0,N.value.model="";try{const B=await oe.get("/api/smartir/codes/models",{params:{entity_type:k.entityType,manufacturer:M}});if(B.data.success){const se=B.data.models||[];m.value=se.map(fe=>{const Ee=fe.models&&fe.models.length>0?fe.models.join(", "):`Code ${fe.code}`;return{code:fe.code,label:Ee,description:`Code: ${fe.code}`,models:fe.models,controller:fe.controller}})}else throw new Error(B.data.error||"Failed to load models")}catch(B){console.error("Error loading models:",B),N.value.model="Failed to load models. Please try again.",m.value=[]}finally{z.value=!1}}},o=async M=>{f.value=M,S.value="",n.value=null,m.value=[],M&&await x(M),ne()},b=()=>{const M=m.value.find(B=>B.code===S.value);M&&(n.value={code:M.code,manufacturer:f.value,models:M.models,controller:M.controller}),ne()},P=()=>{ne()},p=()=>{ne()},Z=()=>{ne()},ne=()=>{var B,se;const M={manufacturer:f.value,model:((se=(B=n.value)==null?void 0:B.models)==null?void 0:se[0])||"",device_code:S.value,controller_device:_.value};k.entityType==="climate"&&(L.value&&(M.temperature_sensor=L.value),w.value&&(M.humidity_sensor=w.value)),$("update:modelValue",M),$("change",M)};return c({validate:()=>{let M=!0;return N.value={manufacturer:"",model:"",controller:""},f.value||(N.value.manufacturer="Manufacturer is required",M=!1),S.value||(N.value.model="Model is required",M=!1),_.value||(N.value.controller="Broadlink controller is required",M=!1),M}}),(M,B)=>(a(),r("div",Po,[e("div",Vo,[ke(Ze,{modelValue:f.value,"onUpdate:modelValue":B[0]||(B[0]=se=>f.value=se),options:s.value,label:"Manufacturer",placeholder:"Search manufacturers...",required:"",loading:V.value,error:N.value.manufacturer,hint:"Select the device manufacturer",onChange:o},null,8,["modelValue","options","loading","error"])]),e("div",jo,[ke(Ze,{modelValue:S.value,"onUpdate:modelValue":B[1]||(B[1]=se=>S.value=se),options:m.value,"option-label":"label","option-value":"code","option-description":"description",label:"Model",placeholder:"Search models...",required:"",disabled:!f.value,loading:z.value,error:N.value.model,hint:"Select the device model",onChange:b},null,8,["modelValue","options","disabled","loading","error"])]),e("div",Uo,[B[6]||(B[6]=e("label",{for:"controller-device"},[e("i",{class:"mdi mdi-remote"}),T(" Controller Device * ")],-1)),W(e("select",{id:"controller-device","onUpdate:modelValue":B[2]||(B[2]=se=>_.value=se),required:"",onChange:P},[B[5]||(B[5]=e("option",{value:""},"-- Select Controller Device --",-1)),(a(!0),r(he,null,Ce(t.broadlinkDevices,se=>(a(),r("option",{key:se.entity_id,value:se.entity_id},[T(v(se.name||se.entity_id)+" ",1),se.area_name?(a(),r(he,{key:0},[T(" - "+v(se.area_name),1)],64)):A("",!0)],8,Fo))),128))],544),[[Re,_.value]]),B[7]||(B[7]=e("small",null,"Which remote device will send the IR/RF commands",-1)),N.value.controller?(a(),r("div",No,v(N.value.controller),1)):A("",!0)]),t.entityType==="climate"?(a(),r(he,{key:0},[e("div",Bo,[B[8]||(B[8]=e("label",{for:"temperature-sensor"},"Temperature Sensor",-1)),W(e("input",{id:"temperature-sensor","onUpdate:modelValue":B[3]||(B[3]=se=>L.value=se),type:"text",placeholder:"e.g., sensor.living_room_temperature",onInput:p},null,544),[[je,L.value]]),B[9]||(B[9]=e("small",null,"Optional: Temperature sensor entity for current temperature",-1))]),e("div",Ho,[B[10]||(B[10]=e("label",{for:"humidity-sensor"},"Humidity Sensor",-1)),W(e("input",{id:"humidity-sensor","onUpdate:modelValue":B[4]||(B[4]=se=>w.value=se),type:"text",placeholder:"e.g., sensor.living_room_humidity",onInput:Z},null,544),[[je,w.value]]),B[11]||(B[11]=e("small",null,"Optional: Humidity sensor entity for current humidity",-1))])],64)):A("",!0),n.value?(a(),r("div",qo,[B[16]||(B[16]=e("div",{class:"info-header"},[e("i",{class:"mdi mdi-information"}),e("span",null,"Selected Device Code")],-1)),e("div",zo,[e("div",Jo,[B[12]||(B[12]=e("span",{class:"info-label"},"Code ID:",-1)),e("span",Wo,v(n.value.code_id),1)]),e("div",Go,[B[13]||(B[13]=e("span",{class:"info-label"},"Manufacturer:",-1)),e("span",Ko,v(n.value.manufacturer),1)]),n.value.models&&n.value.models.length>0?(a(),r("div",Xo,[B[14]||(B[14]=e("span",{class:"info-label"},"Supported Models:",-1)),e("span",Yo,v(n.value.models.join(", ")),1)])):A("",!0),e("div",Zo,[B[15]||(B[15]=e("span",{class:"info-label"},"Controller:",-1)),e("span",Qo,v(n.value.controller||"Broadlink"),1)])])])):A("",!0)]))}},tl=De(el,[["__scopeId","data-v-1911c8f6"]]),ol={class:"modal-content"},ll={class:"modal-header"},nl={class:"input-wrapper"},sl={key:0,class:"validation-tooltip"},al={class:"input-wrapper"},il=["disabled"],rl={key:0,class:"validation-tooltip"},dl={key:0,class:"smartir-notice"},ul={key:0,class:"notice-success"},cl={key:1,class:"notice-warning"},ml={key:1,class:"smartir-notice"},vl={key:2},pl={class:"form-group"},fl=["disabled"],gl=["disabled"],yl={key:0},bl={key:1},hl={key:2},kl={key:3},wl={key:0,class:"form-group"},$l={class:"area-display-readonly"},Cl=["value"],_l=["disabled"],Sl=["href"],Il={key:1,class:"form-group"},Dl={class:"form-group"},xl={class:"input-wrapper"},Tl=["value"],Ml=["value"],Rl={key:2,class:"validation-tooltip"},El={key:0},Ol={key:1},Al={key:3,class:"smartir-section"},Ll={class:"modal-footer"},Pl={type:"submit",form:"device-form",class:"btn btn-primary"},Vl={__name:"DeviceForm",props:{device:{type:Object,default:null}},emits:["save","cancel"],setup(t,{emit:c}){const i=t,k=c,$=Pe("smartirStatus"),s=Pe("smartirEnabled"),m=X(()=>{var R;return localStorage.getItem("smartir_simulate_not_installed")==="true"?!1:((R=$==null?void 0:$.value)==null?void 0:R.installed)||!1}),f=X(()=>!!i.device),S=X(()=>["climate","media_player","fan","light"].includes(n.value.entity_type)),_=X(()=>m.value?!S.value&&n.value.entity_type?"(Not supported for this type)":"(Pre-configured Codes)":"(Requires SmartIR)"),L=X(()=>{var R;const Y=((R=i.device)==null?void 0:R.commands)||{};return Object.keys(Y).length>0}),w=X(()=>{if(!n.value.broadlink_entity)return"";const Y=x.value.find(R=>R.entity_id===n.value.broadlink_entity);return Y&&Y.name||n.value.broadlink_entity}),n=g({name:"",entity_type:"",device_type:"broadlink",device:"",area:"",icon:"",broadlink_entity:"",enabled:!0,commands:{}}),V=g({name:"",entity_type:"",broadlink_entity:""}),z=g({}),N=g(null),E=g([]),x=g([]),o=g(null),b=g(null),P=g(null),p=g(!1);Oe(async()=>{i.device&&(n.value={...i.device,device_type:i.device.device_type||"broadlink"},n.value.device_type==="smartir"&&(z.value={manufacturer:i.device.manufacturer,model:i.device.model,device_code:i.device.device_code,controller_device:i.device.controller_device,temperature_sensor:i.device.temperature_sensor,humidity_sensor:i.device.humidity_sensor})),await Promise.all([Z(),ne()])});const Z=async()=>{try{const Y=await oe.get("/api/areas");E.value=Y.data.areas||[]}catch(Y){console.error("Error loading areas:",Y),E.value=[]}},ne=async()=>{try{const R=(await oe.get("/api/remote/devices")).data.devices||[];x.value=R,console.log("Loaded remote devices:",R)}catch(Y){console.error("Error loading remote devices:",Y),x.value=[]}},J=Y=>{if(!Y)return"";const R=Y.toLowerCase();for(const te of E.value){const q=te.toLowerCase();if(R.includes(q))return te}return""},M=(Y,R="")=>{const te=R.toLowerCase();return te.includes("tv")?"mdi:television":te.includes("lamp")?"mdi:lamp":te.includes("ceiling")?"mdi:ceiling-light":te.includes("floor")?"mdi:floor-lamp":te.includes("desk")?"mdi:desk-lamp":te.includes("fan")?"mdi:fan":te.includes("ac")||te.includes("air con")?"mdi:air-conditioner":te.includes("heater")?"mdi:radiator":te.includes("blind")?"mdi:blinds":te.includes("curtain")?"mdi:curtains":te.includes("garage")?"mdi:garage":te.includes("speaker")||te.includes("stereo")?"mdi:speaker":te.includes("receiver")?"mdi:audio-video":{light:"mdi:lightbulb",fan:"mdi:fan",switch:"mdi:light-switch",media_player:"mdi:television",cover:"mdi:window-shutter",climate:"mdi:thermostat"}[Y]||"mdi:devices"};ue(()=>n.value.name,Y=>{if(!f.value&&Y&&!n.value.area){const R=J(Y);R&&(n.value.area=R)}!f.value&&Y&&n.value.entity_type&&(p.value||!n.value.icon)&&(n.value.icon=M(n.value.entity_type,Y),p.value=!0)}),ue(()=>n.value.entity_type,Y=>{!f.value&&Y&&(p.value||!n.value.icon)&&(n.value.icon=M(Y,n.value.name),p.value=!0)}),ue(()=>n.value.icon,(Y,R)=>{R!==void 0&&Y!==R&&!p.value&&(p.value=!1),Y||(p.value=!1)});const B=g(!1),se=async()=>{var Y;if((Y=i.device)!=null&&Y.id){B.value=!0;try{const R=await oe.post(`/api/devices/${i.device.id}/sync-area`);R.data.success?(n.value.area=R.data.area||"",R.data.area?console.log(`Area synced: ${R.data.area}`):console.log("No area assigned in Home Assistant")):console.warn(R.data.message||"Entity not found in HA")}catch(R){console.error("Failed to sync area:",R)}finally{B.value=!1}}},fe=()=>{var te;return!((te=i.device)!=null&&te.id)||!n.value.entity_type?"#":`/config/entities/entity/${`${n.value.entity_type}.${i.device.id}`}`},Ee=()=>{V.value={name:"",entity_type:"",broadlink_entity:""};let Y=!0;return(!n.value.name||n.value.name.trim()==="")&&(V.value.name="Device name is required",Y=!1),n.value.entity_type||(V.value.entity_type="Entity type is required",Y=!1),n.value.device_type==="broadlink"&&!n.value.broadlink_entity&&(V.value.broadlink_entity="Broadlink device is required",Y=!1),Y},Ae=Y=>{V.value[Y]=""},Le=async()=>{if(n.value.device_type==="smartir"){if(N.value&&!N.value.validate())return;const Y={...n.value,smartir_config:{manufacturer:z.value.manufacturer,model:z.value.model,code_id:z.value.device_code,controller_device:z.value.controller_device}};k("save",Y)}else{if(!Ee())return;k("save",{...n.value})}},Te=Y=>{z.value=Y};return(Y,R)=>(a(),r("div",{class:"modal-overlay",onClick:R[11]||(R[11]=be(te=>Y.$emit("cancel"),["self"]))},[e("div",ol,[e("div",ll,[e("h2",null,v(f.value?"Edit Device":"Add New Device"),1),e("button",{onClick:R[0]||(R[0]=te=>Y.$emit("cancel")),class:"close-btn"},[...R[12]||(R[12]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("form",{id:"device-form",onSubmit:be(Le,["prevent"]),class:"modal-body"},[e("div",{class:G(["form-group",{"has-error":V.value.name}])},[R[14]||(R[14]=e("label",{for:"device-name"},"Device Name *",-1)),e("div",nl,[W(e("input",{id:"device-name",ref_key:"nameInput",ref:o,"onUpdate:modelValue":R[1]||(R[1]=te=>n.value.name=te),type:"text",placeholder:"e.g., Living Room TV",onInput:R[2]||(R[2]=te=>Ae("name"))},null,544),[[je,n.value.name]]),V.value.name?(a(),r("div",sl,[R[13]||(R[13]=e("i",{class:"mdi mdi-alert"},null,-1)),T(" "+v(V.value.name),1)])):A("",!0)]),R[15]||(R[15]=e("small",null,"Friendly name for this device",-1))],2),e("div",{class:G(["form-group",{"has-error":V.value.entity_type}])},[R[23]||(R[23]=e("label",{for:"entity-type"},"Entity Type *",-1)),e("div",al,[W(e("select",{id:"entity-type",ref_key:"typeSelect",ref:b,"onUpdate:modelValue":R[3]||(R[3]=te=>n.value.entity_type=te),onChange:R[4]||(R[4]=te=>Ae("entity_type"))},[R[16]||(R[16]=ze('<option value="" data-v-94bc1fe5>-- Select Type --</option><option value="light" data-v-94bc1fe5>ğŸ’¡ Light</option><option value="fan" data-v-94bc1fe5>ğŸŒ€ Fan</option><option value="switch" data-v-94bc1fe5>ğŸ”Œ Switch</option><option value="media_player" data-v-94bc1fe5>ğŸ“º Media Player</option><option value="cover" data-v-94bc1fe5>ğŸªŸ Cover (Blinds/Curtains)</option>',6)),e("option",{value:"climate",disabled:!m.value}," ğŸŒ¡ï¸ Climate "+v(m.value?"":"(Requires SmartIR)"),9,il)],544),[[Re,n.value.entity_type]]),V.value.entity_type?(a(),r("div",rl,[R[17]||(R[17]=e("i",{class:"mdi mdi-alert"},null,-1)),T(" "+v(V.value.entity_type),1)])):A("",!0)]),n.value.entity_type==="climate"?(a(),r("div",dl,[m.value?(a(),r("div",ul,[...R[18]||(R[18]=[e("i",{class:"mdi mdi-check-circle"},null,-1),e("span",null,"SmartIR detected! Climate entities will be created via SmartIR profiles.",-1)])])):(a(),r("div",cl,[...R[19]||(R[19]=[e("i",{class:"mdi mdi-alert"},null,-1),e("div",null,[e("strong",null,"SmartIR Required"),e("p",null,"Climate entities (AC, heaters) require SmartIR integration."),e("a",{href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"smartir-link"}," Install SmartIR â†’ ")],-1)])]))])):m.value&&["media_player","fan","light"].includes(n.value.entity_type)?(a(),r("div",ml,[...R[20]||(R[20]=[e("div",{class:"notice-info"},[e("i",{class:"mdi mdi-information"}),e("span",null,"ğŸ’¡ SmartIR available! You can use pre-configured codes or learn your own.")],-1)])])):!m.value&&n.value.entity_type?(a(),r("small",vl,[R[21]||(R[21]=T(" ğŸ’¡ Tip: Install ",-1)),R[22]||(R[22]=e("a",{href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"inline-link"},"SmartIR",-1)),T(" for pre-configured "+v(n.value.entity_type==="climate"?"climate":n.value.entity_type)+" device codes ",1)])):A("",!0)],2),e("div",pl,[R[26]||(R[26]=e("label",{for:"device-type"},"Device Type *",-1)),W(e("select",{id:"device-type","onUpdate:modelValue":R[5]||(R[5]=te=>n.value.device_type=te),required:"",disabled:f.value},[R[24]||(R[24]=e("option",{value:""},"-- Select Device Type --",-1)),R[25]||(R[25]=e("option",{value:"broadlink"},"ğŸ“¡ Broadlink Device (Learn IR Codes)",-1)),xe(s)?(a(),r("option",{key:0,value:"smartir",disabled:!m.value||!S.value}," ğŸŒ SmartIR Device "+v(_.value),9,gl)):A("",!0)],8,fl),[[Re,n.value.device_type]]),f.value?(a(),r("small",yl,"Cannot change device type after creation")):n.value.device_type==="smartir"?(a(),r("small",bl,"Using pre-configured codes from SmartIR repository")):n.value.device_type==="broadlink"?(a(),r("small",hl,"Learn and store your own IR codes")):(a(),r("small",kl,"Choose how to configure this device"))]),f.value?(a(),r("div",wl,[R[29]||(R[29]=e("label",{for:"device-area"},"Area",-1)),e("div",$l,[e("input",{id:"device-area",value:n.value.area||"Not assigned",type:"text",readonly:"",class:"readonly-input"},null,8,Cl),e("button",{type:"button",onClick:se,disabled:B.value,class:"sync-area-btn",title:"Sync area from Home Assistant"},[e("i",{class:G(B.value?"mdi mdi-loading mdi-spin":"mdi mdi-refresh")},null,2)],8,_l)]),e("small",null,[R[27]||(R[27]=e("i",{class:"mdi mdi-information-outline"},null,-1)),R[28]||(R[28]=T(" Set area in Home Assistant, then click sync. ",-1)),e("a",{href:fe(),target:"_blank",class:"inline-link"},"Open in HA â†’",8,Sl)])])):(a(),r("div",Il,[...R[30]||(R[30]=[e("div",{class:"info-notice"},[e("i",{class:"mdi mdi-information-outline"}),e("span",null,[e("strong",null,"Area Assignment:"),T(" After generating entities and restarting Home Assistant, you can assign areas in HA and sync them here.")])],-1)])])),e("div",Dl,[R[31]||(R[31]=e("label",{for:"device-icon"},"Icon",-1)),ke(ho,{modelValue:n.value.icon,"onUpdate:modelValue":R[6]||(R[6]=te=>n.value.icon=te),inputId:"device-icon",placeholder:"e.g., mdi:television"},null,8,["modelValue"]),R[32]||(R[32]=e("small",null,"Optional: Material Design Icon name",-1))]),n.value.device_type==="broadlink"?(a(),r("div",{key:2,class:G(["form-group",{"has-error":V.value.broadlink_entity}])},[R[35]||(R[35]=e("label",{for:"broadlink-entity"},"Remote Device *",-1)),e("div",xl,[!f.value||!L.value?W((a(),r("select",{key:0,id:"broadlink-entity",ref_key:"broadlinkSelect",ref:P,"onUpdate:modelValue":R[7]||(R[7]=te=>n.value.broadlink_entity=te),onChange:R[8]||(R[8]=te=>Ae("broadlink_entity"))},[R[33]||(R[33]=e("option",{value:""},"-- Select Remote Device --",-1)),(a(!0),r(he,null,Ce(x.value,te=>(a(),r("option",{key:te.entity_id,value:te.entity_id},[T(v(te.name||te.entity_id)+" ",1),te.area_name?(a(),r(he,{key:0},[T(" - "+v(te.area_name),1)],64)):A("",!0)],8,Tl))),128))],544)),[[Re,n.value.broadlink_entity]]):(a(),r("input",{key:1,id:"broadlink-entity",value:w.value,type:"text",readonly:"",disabled:""},null,8,Ml)),V.value.broadlink_entity?(a(),r("div",Rl,[R[34]||(R[34]=e("i",{class:"mdi mdi-alert"},null,-1)),T(" "+v(V.value.broadlink_entity),1)])):A("",!0)]),!f.value||!L.value?(a(),r("small",El,"Required: Select which remote device to use for sending commands")):(a(),r("small",Ol,"Cannot change remote device after commands are learned"))],2)):A("",!0),n.value.device_type==="smartir"?(a(),r("div",Al,[R[36]||(R[36]=e("div",{class:"section-header"},[e("i",{class:"mdi mdi-cloud-download"}),e("span",null,"SmartIR Device Configuration")],-1)),ke(tl,{ref_key:"smartirSelector",ref:N,"entity-type":n.value.entity_type,modelValue:z.value,"onUpdate:modelValue":R[9]||(R[9]=te=>z.value=te),"broadlink-devices":x.value,onChange:Te},null,8,["entity-type","modelValue","broadlink-devices"])])):A("",!0)],32),e("div",Ll,[e("button",{type:"button",onClick:R[10]||(R[10]=te=>Y.$emit("cancel")),class:"btn btn-secondary"}," Cancel "),e("button",Pl,[R[37]||(R[37]=e("i",{class:"mdi mdi-check"},null,-1)),T(" "+v(f.value?"Update":"Create"),1)])])])]))}},jl=De(Vl,[["__scopeId","data-v-94bc1fe5"]]),Ul={class:"modal-header"},Fl={class:"modal-body"},Nl={class:"message-text"},Bl={key:0,class:"checkbox-option"},Hl={class:"modal-footer"},ql=["disabled"],zl={__name:"ConfirmDialog",props:{isOpen:{type:Boolean,default:!1},title:{type:String,default:"Confirm"},message:{type:String,required:!0},confirmText:{type:String,default:"OK"},cancelText:{type:String,default:"Cancel"},showCancel:{type:Boolean,default:!0},dangerMode:{type:Boolean,default:!1},confirmDisabled:{type:Boolean,default:!1},checkboxLabel:{type:String,default:""}},emits:["confirm","cancel"],setup(t,{emit:c}){const i=t,k=c,$=g(!1);ue(()=>i.isOpen,f=>{f&&($.value=!1)});const s=()=>{k("confirm",$.value)},m=()=>{k("cancel")};return(f,S)=>t.isOpen?(a(),r("div",{key:0,class:"modal-overlay",onClick:be(m,["self","stop"])},[e("div",{class:"modal-dialog confirm-dialog",onClick:S[1]||(S[1]=be(()=>{},["stop"]))},[e("div",Ul,[e("h2",null,v(t.title),1)]),e("div",Fl,[e("p",Nl,v(t.message),1),t.checkboxLabel?(a(),r("div",Bl,[e("label",null,[W(e("input",{type:"checkbox","onUpdate:modelValue":S[0]||(S[0]=_=>$.value=_)},null,512),[[me,$.value]]),e("span",null,v(t.checkboxLabel),1)])])):A("",!0)]),e("div",Hl,[t.showCancel?(a(),r("button",{key:0,onClick:be(m,["stop"]),class:"btn btn-secondary"},v(t.cancelText),1)):A("",!0),t.confirmText?(a(),r("button",{key:1,onClick:be(s,["stop"]),class:G(["btn",t.dangerMode?"btn-danger":"btn-primary"]),disabled:t.confirmDisabled},v(t.confirmText),11,ql)):A("",!0)])])])):A("",!0)}},He=De(zl,[["__scopeId","data-v-9cea6cb3"]]),Jl={class:"modal-content"},Wl={class:"modal-header"},Gl={class:"modal-body"},Kl={key:0,class:"smartir-info"},Xl={key:0,class:"climate-note"},Yl={class:"form-group"},Zl=["value"],Ql={class:"form-group"},en=["disabled"],tn={label:"Suggested Commands"},on=["value"],ln=["disabled"],nn={class:"form-group"},sn={class:"radio-card-group"},an=["disabled"],rn=["disabled"],dn={class:"form-group"},un={class:"radio-card-group"},cn=["disabled"],mn=["disabled"],vn=["disabled"],pn={key:0,class:"help-box"},fn={class:"learn-action"},gn=["disabled"],yn={key:0,class:"mdi mdi-loading mdi-spin"},bn={key:1,class:"mdi mdi-remote-tv"},hn={key:0,class:"learning-status"},kn={key:0},wn={key:1},$n={key:2},Cn={key:1,class:"result-message success"},_n={key:2,class:"section-divider"},Sn={key:3,class:"loading-commands"},In={key:4,class:"learned-commands"},Dn={class:"commands-header"},xn=["disabled"],Tn={class:"command-list"},Mn={class:"command-info"},Rn={class:"command-name"},En={class:"command-right"},On={key:0,class:"mdi mdi-alert-circle error-icon",title:"Error: Command failed to learn. Delete and try again."},An={key:1,class:"mdi mdi-clock-outline pending-icon",title:"Pending: Waiting for code from storage..."},Ln=["title"],Pn={class:"command-actions"},Vn=["onClick","title","disabled"],jn=["onClick","title"],Un={key:5,class:"untracked-commands"},Fn={class:"command-list"},Nn={class:"command-name"},Bn=["onClick"],Hn={class:"modal-footer"},qn=["disabled"],zn={__name:"CommandLearner",props:{device:{type:Object,required:!0}},emits:["cancel","learned"],setup(t,{emit:c}){const i=t,k=c,$=g([]),s=g(""),m=g(""),f=g(""),S=g("ir"),_=g("manager_only"),L=g(!1),w=g(!1),n=g(""),V=g(""),z=g(""),N=g("success"),E=g([]),x=g([]),o=g(!1),b=g(!1),P=g(""),p=g(!1),Z=g(null),ne=g(null),J=g(""),M=g(""),B=X(()=>i.device.device_type==="smartir");X(()=>{if(B.value)return!1;const y=m.value==="__custom__"?f.value:m.value;return s.value&&y.trim()});const se=()=>{Z.value&&Z.value.setCustomValidity("")},fe=()=>{ne.value&&ne.value.setCustomValidity("")},Ee=X(()=>{const y=$.value.find(u=>u.entity_id===s.value);return y?y.name||y.entity_id:s.value}),Ae={light:["turn_on","turn_off","toggle","brightness_up","brightness_down","dim","bright"],fan:["turn_on","turn_off","toggle","speed_low","speed_medium","speed_high","speed_1","speed_2","speed_3","speed_4","speed_5","oscillate_on","oscillate_off","direction_forward","direction_reverse"],switch:["turn_on","turn_off","toggle"],media_player:["turn_on","turn_off","toggle","volume_up","volume_down","volume_mute","play","pause","stop","play_pause","next_track","previous_track","channel_up","channel_down","source_hdmi1","source_hdmi2","source_hdmi3","source_tv","source_aux","source_bluetooth","menu","home","back","select","arrow_up","arrow_down","arrow_left","arrow_right"],cover:["open","close","stop","open_tilt","close_tilt","position_0","position_25","position_50","position_75","position_100"]},Le=X(()=>{const y=i.device.entity_type||"switch";return Ae[y]||Ae.switch});ue(()=>i.device,async(y,u)=>{if(y&&u&&y.id===u.id){const l=Object.keys(y.commands||{}).length,H=Object.keys(u.commands||{}).length;l!==H&&(console.log(`ğŸ”„ Device commands changed (${H} -> ${l}), reloading...`),await Y(!0))}},{deep:!0}),Oe(async()=>{await Te(),await Y(),await ce(),Z.value&&(Z.value.setCustomValidity(""),Z.value.oninvalid=()=>{Z.value.setCustomValidity("Command name is required")}),i.device.broadlink_entity&&(s.value=i.device.broadlink_entity)}),ue(m,async y=>{y==="__custom__"&&(await at(),ne.value&&(ne.value.setCustomValidity(""),ne.value.oninvalid=()=>{ne.value.setCustomValidity("Custom command name is required")}))});const Te=async()=>{try{const y=await oe.get("/api/broadlink/devices");$.value=y.data.devices||[]}catch(y){console.error("Error loading Broadlink devices:",y)}},Y=async(y=!1)=>{var u,l;o.value=!0;try{if(y&&!B.value)try{await oe.post("/api/commands/check-pending"),console.log("ğŸ”„ Triggered backend polling check")}catch(H){console.warn("âš ï¸ Could not trigger polling check:",H)}if(B.value){const H=await oe.get("/api/smartir/codes/code",{params:{entity_type:i.device.entity_type,code_id:i.device.device_code}});if(H.data.success&&H.data.code){const Q=H.data.code.commands||{},re=H.data.code.commandType||"ir";if(i.device.entity_type==="climate"){const ie=[];for(const[_e,ge]of Object.entries(Q))typeof ge=="string"?ie.push({name:_e,type:re}):typeof ge=="object"&&ge!==null&&Object.keys(ge).sort((I,d)=>parseInt(I)-parseInt(d)).forEach(I=>{ie.push({name:`${_e}_${I}`,type:re,label:`${_e.charAt(0).toUpperCase()+_e.slice(1)} ${I}Â°C`})});E.value=ie}else E.value=Object.keys(Q).map(ie=>({name:ie,type:re}))}}else{if(console.log("ğŸ“‹ Loading commands for device:",i.device),console.log("ğŸ“‹ Device ID:",i.device.id),console.log("ğŸ“‹ Force reload:",y),y&&i.device.id){console.log("ğŸ”„ Force reloading commands from API after sync");try{const Q=(await oe.get(`/api/commands/${i.device.id}`)).data.commands||{};console.log("ğŸ“¦ Raw commands from API:",Q),E.value=Object.entries(Q).map(([re,ie])=>{console.log(`  Command '${re}':`,ie,`(type: ${typeof ie})`);const _e=typeof ie=="object"&&ie!==null&&(ie.command_type||ie.type)||"ir",ge=typeof ie=="object"&&ie!==null?ie.data:ie;return{name:re,type:_e,data:ge,hasError:ge==="error",isPending:ge==="pending"}}),console.log("ğŸ“‹ Reloaded commands:",E.value)}catch(H){if(console.error("âŒ Error loading commands:",H),((u=H.response)==null?void 0:u.status)===404)console.log("â„¹ï¸ No commands found for device"),E.value=[];else throw H}}else if(i.device.commands&&Object.keys(i.device.commands).length>0)console.log("âœ… Using commands from device object"),E.value=Object.entries(i.device.commands).map(([H,Q])=>{const re=Q.data||Q;return{name:H,type:Q.command_type||Q.type||"ir",data:re,hasError:re==="error",isPending:re==="pending"}});else if(i.device.commands!==void 0)console.log("â„¹ï¸ Device has empty commands object - skipping API call"),E.value=[];else if(i.device.id){console.log("ğŸŒ Fetching commands from API for device ID:",i.device.id);try{const Q=(await oe.get(`/api/commands/${i.device.id}`)).data.commands||{};E.value=Object.entries(Q).map(([re,ie])=>({name:re,type:ie.command_type||ie.type||"ir"}))}catch(H){if(((l=H.response)==null?void 0:l.status)===404)console.log("â„¹ï¸ No commands found for device (this is normal for new devices)"),E.value=[];else throw H}}else console.log("âš ï¸ No commands found and no device ID");console.log("ğŸ“‹ Final learned commands:",E.value)}}catch(H){console.error("Error loading commands:",H)}finally{o.value=!1}},R=async()=>{z.value="",N.value="",V.value="",w.value=!0,n.value="preparing";try{const y=m.value==="__custom__"?f.value:m.value;S.value==="rf"?(n.value="learning",z.value="âš ï¸ Learning request sent to device. Check Home Assistant notifications (ğŸ””) for instructions. Note: If the device is offline or times out, you will see a notification but this dialog will still show success.",N.value="warning",await new Promise(l=>setTimeout(l,50))):n.value="learning";const u=await oe.post("/api/commands/learn",{device_id:i.device.id,entity_id:s.value||i.device.broadlink_entity,device:i.device.device||i.device.id,command:y.trim(),command_type:S.value,save_destination:_.value});if(u.data.success){if(n.value="complete",z.value="",N.value="",_.value==="manager_only"||_.value==="both"){E.value.find(Q=>Q.name===y)||E.value.push({name:y,type:S.value});const H=x.value.indexOf(y);H>-1&&x.value.splice(H,1)}await ce(),m.value="",f.value="",k("learned",{deviceId:i.device.id,commandName:y,commandType:S.value}),w.value=!1,n.value=""}else throw new Error(u.data.error||"Failed to learn command")}catch(y){console.error("Learning error:",y),z.value=y.message||"Error learning command",N.value="error",w.value=!1,n.value=""}},te=async y=>{var u,l;try{M.value=y,J.value="";let H=i.device.id.split(".")[1];i.device.device&&(H=i.device.device);const Q=B.value?i.device.controller_device:s.value||i.device.broadlink_entity;if(!Q){console.error("Missing entity_id for test command:",{isSmartIR:B.value,controller_device:i.device.controller_device,broadlink_entity:i.device.broadlink_entity,selectedBroadlink:s.value,device:i.device}),z.value="Missing Broadlink remote entity. Please select a Broadlink device.",N.value="error",M.value="";return}const re={device_id:i.device.id,entity_id:Q,command:y,device:i.device.device||i.device.id};console.log("ğŸ§ª Testing command:",re),(await oe.post("/api/commands/test",re)).data.success&&(J.value=y,setTimeout(()=>{J.value===y&&(J.value="")},2e3))}catch(H){console.error("âŒ Test command error:",H);const Q=((l=(u=H.response)==null?void 0:u.data)==null?void 0:l.error)||H.message||"Unknown error";z.value=`Failed to send command: ${Q}`,N.value="error"}finally{M.value=""}},q=y=>{P.value=y,b.value=!0},F=()=>{b.value=!1,P.value=""},K=async y=>{const u=P.value;b.value=!1;try{if(console.log(`ğŸ—‘ï¸ Deleting command: ${u}, alsoDeleteFromIntegration: ${y}`),await oe.delete(`/api/commands/${i.device.id}/${u}`),y)try{const l=i.device.device||i.device.id;await oe.post("/api/commands/delete-from-storage",{device:l,command:u}),console.log("âœ… Also deleted from Broadlink Integration storage")}catch(l){console.warn("âš ï¸ Failed to delete from Broadlink Integration storage:",l)}await Y(!0),await ce(),z.value=`Command "${u}" deleted`,N.value="success",k("learned",{deviceId:i.device.id,commandName:u,action:"deleted"})}catch(l){console.error("âŒ Delete error:",l),z.value=`Failed to delete command: ${l.message}`,N.value="error",await Y(!0)}finally{P.value=""}},ce=async()=>{try{let y=i.device.device;y||(y=i.device.id.includes(".")?i.device.id.split(".")[1]:i.device.id),console.log("ğŸ” Looking for untracked commands for device:",y);const l=(await oe.get("/api/commands/untracked")).data.untracked||{};console.log("ğŸ“¦ All untracked commands:",Object.keys(l)),console.log("ğŸ“¦ Untracked for this device:",l[y]),l[y]?x.value=Object.keys(l[y].commands):x.value=[]}catch(y){console.error("Error loading untracked commands:",y),x.value=[]}},Ve=()=>{x.value.length!==0&&(p.value=!0)},Me=async y=>{var u,l,H;console.log("ğŸ”µ [IMPORT SINGLE] Importing command:",y);try{const Q=i.device.device||i.device.id||((u=i.device.id)!=null&&u.includes(".")?i.device.id.split(".")[1]:null);if(!Q)throw new Error("Could not determine device name for import");console.log("ğŸ”µ [IMPORT SINGLE] Calling API to import command...");const re=await oe.post("/api/commands/import",{device_id:i.device.id,source_device:Q,commands:[y]});console.log("ğŸ”µ [IMPORT SINGLE] API response:",re.data),re.data.success?(z.value=`Imported command '${y}' successfully!`,N.value="success",await Y(!0),await ce()):(z.value=re.data.error||"Failed to import command",N.value="error")}catch(Q){console.error("ğŸ”´ [IMPORT SINGLE] Error:",Q),z.value=((H=(l=Q.response)==null?void 0:l.data)==null?void 0:H.error)||Q.message||"Failed to import command",N.value="error"}},ee=async()=>{var y;console.log("ğŸ”µ [IMPORT] Starting import process..."),console.log("ğŸ”µ [IMPORT] Current learned commands:",E.value.length),console.log("ğŸ”µ [IMPORT] Current untracked commands:",x.value.length),p.value=!1;try{const u=i.device.device||i.device.id||((y=i.device.id)!=null&&y.includes(".")?i.device.id.split(".")[1]:null);if(console.log("ğŸ”µ [IMPORT] Device object:",i.device),console.log("ğŸ”µ [IMPORT] Extracted device name:",u),!u)throw new Error("Could not determine device name for import");console.log("ğŸ”µ [IMPORT] Calling API to import commands...");const l=await oe.post("/api/commands/import",{device_id:i.device.id,source_device:u,commands:x.value});console.log("ğŸ”µ [IMPORT] API response:",l.data),l.data.success&&(z.value=`Imported ${l.data.imported_count} commands successfully!`,N.value="success",console.log("ğŸ”µ [IMPORT] Import successful, now reloading commands..."),console.log("ğŸ”µ [IMPORT] BEFORE reload - learned:",E.value.length,"untracked:",x.value.length),await Y(!0),console.log("ğŸ”µ [IMPORT] AFTER loadLearnedCommands - learned:",E.value.length),await ce(),console.log("ğŸ”µ [IMPORT] AFTER loadUntrackedCommands - untracked:",x.value.length),console.log("ğŸ”µ [IMPORT] Final state - learned:",E.value,"untracked:",x.value),console.log("ğŸ”µ [IMPORT] Emitting learned event to parent..."),k("learned",{deviceId:i.device.id,action:"imported",count:l.data.imported_count}),console.log("ğŸ”µ [IMPORT] âœ… Import process complete!"))}catch(u){console.error("ğŸ”µ [IMPORT] âŒ Import failed:",u),z.value=`Failed to import commands: ${u.message}`,N.value="error"}};return(y,u)=>(a(),r("div",{class:"modal-overlay",onClick:u[12]||(u[12]=be(l=>y.$emit("cancel"),["self"]))},[e("div",Jl,[e("div",Wl,[e("h2",null,v(B.value?"Commands for":"Learn Commands for")+" "+v(t.device.name),1),e("button",{onClick:u[0]||(u[0]=l=>y.$emit("cancel")),class:"close-btn"},[...u[13]||(u[13]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Gl,[B.value?(a(),r("div",Kl,[u[18]||(u[18]=e("i",{class:"mdi mdi-information"},null,-1)),e("div",null,[u[17]||(u[17]=e("h3",null,"SmartIR Device",-1)),e("p",null,[u[14]||(u[14]=T("This device uses SmartIR code file ",-1)),e("strong",null,v(t.device.device_code),1),u[15]||(u[15]=T(". Commands are pre-configured and cannot be learned.",-1))]),t.device.entity_type==="climate"?(a(),r("p",Xl,[...u[16]||(u[16]=[e("i",{class:"mdi mdi-alert-circle-outline"},null,-1),e("strong",null,"Note:",-1),T(" Climate device commands are temperature-based. Testing individual modes may not work as expected. Use the Home Assistant climate card to control your device. ",-1)])])):A("",!0)])])):(a(),r("form",{key:1,onSubmit:be(R,["prevent"])},[e("div",Yl,[u[19]||(u[19]=e("label",{for:"broadlink-entity"},"Broadlink Device",-1)),e("input",{id:"broadlink-entity",value:Ee.value,type:"text",readonly:"",disabled:""},null,8,Zl),u[20]||(u[20]=e("small",null,"Commands will be learned using this device (set when device was created)",-1))]),e("div",Ql,[u[23]||(u[23]=e("label",{for:"command-name"},"Command Name *",-1)),W(e("select",{id:"command-name",ref_key:"commandSelect",ref:Z,"onUpdate:modelValue":u[1]||(u[1]=l=>m.value=l),disabled:w.value,required:"",onChange:se},[u[21]||(u[21]=e("option",{value:""},"-- Select or type command --",-1)),e("optgroup",tn,[(a(!0),r(he,null,Ce(Le.value,l=>(a(),r("option",{key:l,value:l},v(l),9,on))),128))]),u[22]||(u[22]=e("option",{value:"__custom__"},"Custom command...",-1))],40,en),[[Re,m.value]]),m.value==="__custom__"?W((a(),r("input",{key:0,ref_key:"customCommandInput",ref:ne,"onUpdate:modelValue":u[2]||(u[2]=l=>f.value=l),type:"text",placeholder:"Enter custom command name",disabled:w.value,required:"",class:"custom-command-input",onInput:fe},null,40,ln)),[[je,f.value]]):A("",!0),e("small",null,"Select a suggested command for "+v(t.device.entity_type||"this device")+", or enter a custom one.",1)]),e("div",nn,[u[28]||(u[28]=e("label",null,"Command Type",-1)),e("div",sn,[e("label",{class:G(["radio-card",{active:S.value==="ir",disabled:w.value}])},[W(e("input",{type:"radio","onUpdate:modelValue":u[3]||(u[3]=l=>S.value=l),value:"ir",disabled:w.value},null,8,an),[[Je,S.value]]),e("i",{class:G(["mdi radio-indicator",S.value==="ir"?"mdi-radiobox-marked":"mdi-radiobox-blank"])},null,2),u[24]||(u[24]=e("i",{class:"mdi mdi-remote card-icon"},null,-1)),u[25]||(u[25]=e("span",{class:"card-text"},"IR (Infrared)",-1))],2),e("label",{class:G(["radio-card",{active:S.value==="rf",disabled:w.value}])},[W(e("input",{type:"radio","onUpdate:modelValue":u[4]||(u[4]=l=>S.value=l),value:"rf",disabled:w.value},null,8,rn),[[Je,S.value]]),e("i",{class:G(["mdi radio-indicator",S.value==="rf"?"mdi-radiobox-marked":"mdi-radiobox-blank"])},null,2),u[26]||(u[26]=e("i",{class:"mdi mdi-radio-tower card-icon"},null,-1)),u[27]||(u[27]=e("span",{class:"card-text"},"RF (Radio Frequency)",-1))],2)])]),e("div",dn,[e("label",null,[u[30]||(u[30]=T(" Save Destination ",-1)),e("button",{type:"button",class:"help-btn",onClick:u[5]||(u[5]=l=>L.value=!L.value),title:"Learn more"},[...u[29]||(u[29]=[e("i",{class:"mdi mdi-help-circle-outline"},null,-1)])])]),e("div",un,[e("label",{class:G(["radio-card",{active:_.value==="manager_only",disabled:w.value}])},[W(e("input",{type:"radio","onUpdate:modelValue":u[6]||(u[6]=l=>_.value=l),value:"manager_only",disabled:w.value},null,8,cn),[[Je,_.value]]),e("i",{class:G(["mdi radio-indicator",_.value==="manager_only"?"mdi-radiobox-marked":"mdi-radiobox-blank"])},null,2),u[31]||(u[31]=e("i",{class:"mdi mdi-application card-icon"},null,-1)),u[32]||(u[32]=e("span",{class:"card-text"},"Broadlink Manager",-1))],2),e("label",{class:G(["radio-card",{active:_.value==="integration_only",disabled:w.value}])},[W(e("input",{type:"radio","onUpdate:modelValue":u[7]||(u[7]=l=>_.value=l),value:"integration_only",disabled:w.value},null,8,mn),[[Je,_.value]]),e("i",{class:G(["mdi radio-indicator",_.value==="integration_only"?"mdi-radiobox-marked":"mdi-radiobox-blank"])},null,2),u[33]||(u[33]=e("i",{class:"mdi mdi-home-assistant card-icon"},null,-1)),u[34]||(u[34]=e("span",{class:"card-text"},"HA Broadlink",-1))],2),e("label",{class:G(["radio-card",{active:_.value==="both",disabled:w.value}])},[W(e("input",{type:"radio","onUpdate:modelValue":u[8]||(u[8]=l=>_.value=l),value:"both",disabled:w.value},null,8,vn),[[Je,_.value]]),e("i",{class:G(["mdi radio-indicator",_.value==="both"?"mdi-radiobox-marked":"mdi-radiobox-blank"])},null,2),u[35]||(u[35]=e("i",{class:"mdi mdi-swap-horizontal card-icon"},null,-1)),u[36]||(u[36]=e("span",{class:"card-text"},"Both",-1))],2)]),L.value?(a(),r("div",pn,[...u[37]||(u[37]=[e("h4",null,"Save Destination Options",-1),e("ul",null,[e("li",null,[e("strong",null,"Broadlink Manager (Recommended):"),T(" Commands are saved only in this app's database (devices.json). This gives you full control and makes commands portable. The Broadlink Integration won't see these commands.")]),e("li",null,[e("strong",null,"HA Broadlink:"),T(" Commands are saved only in Home Assistant's Broadlink Integration storage. This app won't track these commands, but they'll be available to the Broadlink Integration's remote.send_command service.")]),e("li",null,[e("strong",null,"Both:"),T(" Commands are saved in both places. Use this if you want commands available in both this app and the Broadlink Integration.")])],-1)])])):A("",!0)]),e("div",fn,[e("button",{type:"submit",class:"btn btn-primary btn-large",disabled:w.value},[w.value?(a(),r("i",yn)):(a(),r("i",bn)),T(" "+v(w.value?"Learning...":"Learn Command"),1)],8,gn)]),w.value?(a(),r("div",hn,[u[41]||(u[41]=e("i",{class:"mdi mdi-loading mdi-spin"},null,-1)),n.value==="preparing"?(a(),r("div",kn,[...u[38]||(u[38]=[e("p",null,[e("strong",null,"Preparing device...")],-1),e("small",null,"Connecting and authenticating with Broadlink device (this takes a few seconds)",-1)])])):S.value==="ir"?(a(),r("div",wn,[...u[39]||(u[39]=[e("p",null,[e("strong",null,"Ready!"),T(" Point your remote at the Broadlink device and press the button...")],-1),e("small",null,"This may take up to 30 seconds",-1)])])):S.value==="rf"?(a(),r("div",$n,[...u[40]||(u[40]=[e("p",null,[e("strong",null,"Learning RF command...")],-1),e("small",null,"Check Home Assistant notifications (ğŸ””) for instructions",-1)])])):A("",!0)])):A("",!0),z.value&&N.value==="success"&&!z.value.includes("sent successfully")&&!w.value?(a(),r("div",Cn,[u[42]||(u[42]=e("i",{class:"mdi mdi-check-circle"},null,-1)),e("p",null,v(z.value),1)])):A("",!0)],32)),E.value.length>0||x.value.length>0?(a(),r("div",_n)):A("",!0),o.value?(a(),r("div",Sn,[...u[43]||(u[43]=[e("div",{class:"loading-spinner"},[e("i",{class:"mdi mdi-loading mdi-spin"}),e("p",null,"Loading commands...")],-1)])])):E.value.length>0?(a(),r("div",In,[e("div",Dn,[e("h3",null,"Tracked Commands ("+v(E.value.length)+")",1),e("button",{type:"button",onClick:u[9]||(u[9]=l=>Y(!0)),class:"icon-btn refresh-btn",title:"Refresh commands",disabled:o.value},[e("i",{class:G(["mdi mdi-refresh",{"mdi-spin":o.value}])},null,2)],8,xn)]),e("div",Tn,[(a(!0),r(he,null,Ce(E.value,l=>(a(),r("div",{key:l.name,class:G(["command-item",{"error-state":l.hasError,"pending-state":l.isPending}])},[e("div",Mn,[e("span",Rn,v(l.label||l.name),1)]),e("div",En,[l.hasError?(a(),r("i",On)):l.isPending?(a(),r("i",An)):(a(),r("i",{key:2,class:"mdi mdi-check-circle learned-icon",title:`Learned (${(l.type||"ir").toUpperCase()})`},null,8,Ln)),e("span",{class:G(["command-type-badge",l.type||"ir"])},v((l.type||"ir").toUpperCase()),3),e("div",Pn,[e("button",{type:"button",onClick:H=>te(l.name),class:"icon-btn",title:l.hasError?"Cannot test - command failed to learn":l.isPending?"Cannot test - waiting for code":"Test command",disabled:M.value===l.name||l.hasError||l.isPending},[e("i",{class:G(["mdi mdi-play",{"mdi-spin":M.value===l.name}])},null,2)],8,Vn),e("button",{type:"button",onClick:H=>q(l.name),class:"icon-btn danger",title:l.hasError?"Delete and re-learn":"Delete command"},[...u[44]||(u[44]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,jn)])])],2))),128))])])):A("",!0),x.value.length>0?(a(),r("div",Un,[e("h3",null,[u[45]||(u[45]=e("i",{class:"mdi mdi-alert"},null,-1)),T(" Untracked Commands ("+v(x.value.length)+") ",1)]),u[48]||(u[48]=e("p",{class:"untracked-info"}," These commands exist in Broadlink storage but are not tracked in this device. ",-1)),e("div",Fn,[(a(!0),r(he,null,Ce(x.value,l=>(a(),r("div",{key:l,class:"command-item untracked"},[e("span",Nn,v(l),1),e("button",{type:"button",onClick:H=>Me(l),class:"btn-icon",title:"Import this command"},[...u[46]||(u[46]=[e("i",{class:"mdi mdi-import"},null,-1)])],8,Bn)]))),128))]),u[49]||(u[49]=e("br",null,null,-1)),e("button",{type:"button",onClick:Ve,class:"btn btn-secondary"},[...u[47]||(u[47]=[e("i",{class:"mdi mdi-import"},null,-1),T(" Import All Untracked Commands ",-1)])])])):A("",!0)]),e("div",Hn,[e("button",{type:"button",onClick:u[10]||(u[10]=l=>y.$emit("cancel")),class:"btn btn-secondary",disabled:w.value}," Close ",8,qn)])]),ke(He,{isOpen:b.value,title:"Delete Command?",message:`Delete command '${P.value}' from Broadlink Manager?`,checkboxLabel:"Also delete from Broadlink Integration storage",confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,onConfirm:K,onCancel:F},null,8,["isOpen","message"]),ke(He,{isOpen:p.value,title:"Import Commands?",message:`Import ${x.value.length} untracked command${x.value.length>1?"s":""} into this device?`,confirmText:"Import",cancelText:"Cancel",onConfirm:ee,onCancel:u[11]||(u[11]=l=>p.value=!1)},null,8,["isOpen","message"])]))}},Jn=De(zn,[["__scopeId","data-v-511d0e01"]]),Wn={class:"modal-container error-dialog"},Gn={class:"modal-header"},Kn={class:"modal-body"},Xn={class:"error-message"},Yn={key:0,class:"error-suggestion"},Zn=["open"],Qn={class:"debug-content"},es={class:"debug-info"},ts={key:0,class:"debug-section-title"},os={key:1},ls={__name:"ErrorDialog",props:{isOpen:{type:Boolean,default:!1},title:{type:String,default:"Error"},message:{type:String,required:!0},suggestion:{type:String,default:""},details:{type:String,default:""},error:{type:Object,default:null},context:{type:Object,default:()=>({})}},emits:["close"],setup(t,{emit:c}){const i=t,k=c,$=Pe("toast"),s=g(!1),m=()=>{k("close")},f=X(()=>{var V,z,N,E,x,o,b,P,p,Z,ne;const w=new Date().toISOString(),n=i.error||{};return{error:JSON.stringify({message:i.message,title:i.title,details:i.details,errorObject:n.message||n.toString(),timestamp:w},null,2),request:JSON.stringify({method:((z=(V=n.config)==null?void 0:V.method)==null?void 0:z.toUpperCase())||"N/A",url:((N=n.config)==null?void 0:N.url)||"N/A",baseURL:((E=n.config)==null?void 0:E.baseURL)||"N/A",headers:((x=n.config)==null?void 0:x.headers)||{},data:(o=n.config)!=null&&o.data?JSON.parse(n.config.data):"N/A",params:((b=n.config)==null?void 0:b.params)||{}},null,2),response:JSON.stringify({status:((P=n.response)==null?void 0:P.status)||"N/A",statusText:((p=n.response)==null?void 0:p.statusText)||"N/A",data:((Z=n.response)==null?void 0:Z.data)||"N/A",headers:((ne=n.response)==null?void 0:ne.headers)||{}},null,2),browser:JSON.stringify({userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language,cookieEnabled:navigator.cookieEnabled,onLine:navigator.onLine,viewport:`${window.innerWidth}x${window.innerHeight}`,screenResolution:`${window.screen.width}x${window.screen.height}`,colorDepth:window.screen.colorDepth,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,timestamp:w},null,2),appState:JSON.stringify({currentRoute:window.location.pathname,currentURL:window.location.href,referrer:document.referrer||"N/A",context:i.context||{},localStorage:{smartir_simulate:localStorage.getItem("smartir_simulate_not_installed"),theme:localStorage.getItem("theme")}},null,2),stackTrace:n.stack||null}}),S=async()=>{const w=L();try{await navigator.clipboard.writeText(w),$==null||$.success("Debug information copied to clipboard","âœ… Copied")}catch(n){console.error("Failed to copy:",n),$==null||$.error("Failed to copy to clipboard","âŒ Copy Failed")}},_=()=>{const w=L(),n=new Blob([w],{type:"text/plain"}),V=URL.createObjectURL(n),z=document.createElement("a");z.href=V;const N=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5);z.download=`broadlink-manager-error-${N}.txt`,document.body.appendChild(z),z.click(),document.body.removeChild(z),URL.revokeObjectURL(V),$==null||$.success("Debug report downloaded","âœ… Downloaded")},L=()=>`Broadlink Manager - Error Report
${"=".repeat(60)}

Generated: ${new Date().toISOString()}
Title: ${i.title}
Message: ${i.message}
${i.suggestion?`Suggestion: ${i.suggestion}
`:""}
${"=".repeat(60)}

ERROR DETAILS
${"-".repeat(60)}
${f.value.error}

REQUEST INFORMATION
${"-".repeat(60)}
${f.value.request}

RESPONSE INFORMATION
${"-".repeat(60)}
${f.value.response}

BROWSER INFORMATION
${"-".repeat(60)}
${f.value.browser}

APPLICATION STATE
${"-".repeat(60)}
${f.value.appState}

${f.value.stackTrace?`STACK TRACE
${"-".repeat(60)}
${f.value.stackTrace}

`:""}
${"=".repeat(60)}
End of Report
`;return ue(()=>i.isOpen,w=>{if(w){const n=V=>{V.key==="Escape"&&m()};return document.addEventListener("keydown",n),()=>document.removeEventListener("keydown",n)}}),(w,n)=>(a(),Ne(it,{to:"body"},[ke(st,{name:"modal"},{default:tt(()=>[t.isOpen?(a(),r("div",{key:0,class:"modal-overlay",onClick:be(m,["self"])},[e("div",Wn,[e("div",Gn,[n[2]||(n[2]=e("div",{class:"header-icon error-icon"},[e("i",{class:"mdi mdi-alert-circle"})],-1)),e("h3",null,v(t.title),1),e("button",{onClick:m,class:"close-button"},[...n[1]||(n[1]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Kn,[e("p",Xn,v(t.message),1),t.suggestion?(a(),r("p",Yn,[n[3]||(n[3]=e("i",{class:"mdi mdi-lightbulb-on"},null,-1)),T(" "+v(t.suggestion),1)])):A("",!0),e("details",{class:"debug-section",open:s.value},[e("summary",{onClick:n[0]||(n[0]=V=>s.value=!s.value)},[e("i",{class:G(["mdi",s.value?"mdi-chevron-down":"mdi-chevron-right"])},null,2),n[4]||(n[4]=T(" Debug Information ",-1))]),e("div",Qn,[e("div",{class:"debug-actions"},[e("button",{onClick:S,class:"btn-debug btn-copy"},[...n[5]||(n[5]=[e("i",{class:"mdi mdi-content-copy"},null,-1),T(" Copy to Clipboard ",-1)])]),e("button",{onClick:_,class:"btn-debug btn-download"},[...n[6]||(n[6]=[e("i",{class:"mdi mdi-download"},null,-1),T(" Download Report ",-1)])])]),e("div",es,[n[7]||(n[7]=e("div",{class:"debug-section-title"},"Error Details",-1)),e("pre",null,v(f.value.error),1),n[8]||(n[8]=e("div",{class:"debug-section-title"},"Request Information",-1)),e("pre",null,v(f.value.request),1),n[9]||(n[9]=e("div",{class:"debug-section-title"},"Response Information",-1)),e("pre",null,v(f.value.response),1),n[10]||(n[10]=e("div",{class:"debug-section-title"},"Browser Information",-1)),e("pre",null,v(f.value.browser),1),n[11]||(n[11]=e("div",{class:"debug-section-title"},"Application State",-1)),e("pre",null,v(f.value.appState),1),f.value.stackTrace?(a(),r("div",ts,"Stack Trace")):A("",!0),f.value.stackTrace?(a(),r("pre",os,v(f.value.stackTrace),1)):A("",!0)])])],8,Zn)]),e("div",{class:"modal-footer"},[e("button",{onClick:m,class:"btn btn-primary"}," OK ")])])])):A("",!0)]),_:1})]))}},ns=De(ls,[["__scopeId","data-v-23858149"]]),ss={class:"modal-dialog"},as={class:"modal-header"},is={class:"modal-body"},rs={class:"device-list"},ds={class:"device-info"},us={class:"device-details"},cs={class:"command-count"},ms={class:"device-actions"},vs=["onClick"],ps=["onClick"],fs={class:"modal-footer"},gs={class:"modal-dialog modal-dialog-small"},ys={class:"modal-header"},bs={class:"modal-body"},hs={class:"warning-message"},ks={class:"modal-footer"},ws=["disabled"],$s=["disabled"],Cs={__name:"DeviceDiscovery",emits:["adopt"],setup(t,{expose:c,emit:i}){const k=Ge(),$=i,s=g([]),m=g(!1),f=g(!1),S=g(null),_=g(!1);g(!1),X(()=>s.value.length>0),Oe(async()=>{await L()});const L=async()=>{try{const N=await oe.get("/api/devices/discover");s.value=N.data.untracked_devices||[]}catch(N){console.error("Error loading untracked devices:",N),s.value=[]}},w=()=>{m.value=!0},n=N=>{m.value=!1,$("adopt",N)},V=N=>{S.value=N,f.value=!0},z=async()=>{if(!S.value)return;const N=S.value.device_name;_.value=!0;try{const E=await oe.delete(`/api/devices/untracked/${encodeURIComponent(N)}`);if(E.data.success)s.value=s.value.filter(x=>x.device_name!==N),f.value=!1,S.value=null,s.value.length===0&&(m.value=!1),k.success(`Deleted all commands for '${N}'`);else throw new Error(E.data.error||"Failed to delete device")}catch(E){console.error("Error deleting device:",E),k.error(`Failed to delete device: ${E.message}`)}finally{_.value=!1}};return c({refresh:L,openDiscovery:w}),(N,E)=>{var x,o,b;return a(),r("div",null,[A("",!0),m.value?(a(),r("div",{key:1,class:"modal-overlay",onClick:E[2]||(E[2]=be(P=>m.value=!1,["self"]))},[e("div",ss,[e("div",as,[E[9]||(E[9]=e("h2",null,"Discovered Devices",-1)),e("button",{onClick:E[0]||(E[0]=P=>m.value=!1),class:"close-btn"},[...E[8]||(E[8]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",is,[E[14]||(E[14]=e("p",{class:"info-text"}," These devices have learned commands in Broadlink storage but are not being tracked. Adopt them to manage their commands and generate Home Assistant entities. ",-1)),e("div",rs,[(a(!0),r(he,null,Ce(s.value,P=>(a(),r("div",{key:P.device_name,class:"discovered-device"},[e("div",ds,[E[11]||(E[11]=e("div",{class:"device-icon"},[e("i",{class:"mdi mdi-devices"})],-1)),e("div",us,[e("h4",null,v(P.device_name),1),e("span",cs,[E[10]||(E[10]=e("i",{class:"mdi mdi-remote"},null,-1)),T(" "+v(P.command_count)+" command"+v(P.command_count>1?"s":""),1)])])]),e("div",ms,[e("button",{onClick:p=>n(P),class:"btn btn-primary"},[...E[12]||(E[12]=[e("i",{class:"mdi mdi-plus"},null,-1),T(" Adopt ",-1)])],8,vs),e("button",{onClick:p=>V(P),class:"btn btn-danger",title:"Delete all commands"},[...E[13]||(E[13]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,ps)])]))),128))])]),e("div",fs,[A("",!0),e("button",{onClick:E[1]||(E[1]=P=>m.value=!1),class:"btn btn-secondary"}," Close ")])])])):A("",!0),f.value?(a(),r("div",{key:2,class:"modal-overlay",onClick:E[5]||(E[5]=be(P=>f.value=!1,["self"]))},[e("div",gs,[e("div",ys,[E[16]||(E[16]=e("h2",null,"Delete Untracked Device",-1)),e("button",{onClick:E[3]||(E[3]=P=>f.value=!1),class:"close-btn"},[...E[15]||(E[15]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",bs,[e("div",hs,[E[18]||(E[18]=e("i",{class:"mdi mdi-alert"},null,-1)),e("div",null,[e("p",null,[e("strong",null,'Are you sure you want to delete "'+v((x=S.value)==null?void 0:x.device_name)+'"?',1)]),e("p",null,"This will permanently delete all "+v((o=S.value)==null?void 0:o.command_count)+" command"+v(((b=S.value)==null?void 0:b.command_count)>1?"s":"")+" from Broadlink storage.",1),E[17]||(E[17]=e("p",{class:"warning-text"},"This action cannot be undone.",-1))])])]),e("div",ks,[e("button",{onClick:E[4]||(E[4]=P=>f.value=!1),class:"btn btn-secondary",disabled:_.value}," Cancel ",8,ws),e("button",{onClick:z,class:"btn btn-danger",disabled:_.value},[e("i",{class:G(["mdi",_.value?"mdi-loading mdi-spin":"mdi-delete"])},null,2),T(" "+v(_.value?"Deleting...":"Delete"),1)],8,$s)])])])):A("",!0)])}}},_s=De(Cs,[["__scopeId","data-v-78e5b712"]]),Ss={class:"device-list-card"},Is={class:"card-header"},Ds={class:"header-badges"},xs={class:"header-info"},Ts=["title"],Ms={class:"header-right"},Rs={key:0,class:"view-toggle-group header-view-toggle"},Es={class:"settings-menu-container"},Os=["disabled"],As=["disabled"],Ls={class:"card-body"},Ps={key:0,class:"filter-bar"},Vs={class:"filter-search-row"},js=["title"],Us={key:0,class:"filter-badge"},Fs={class:"search-input-wrapper"},Ns={class:"filter-content"},Bs={class:"filter-row filter-row-dropdowns"},Hs={class:"filter-group"},qs=["value"],zs={class:"filter-group"},Js=["value"],Ws={class:"filter-group"},Gs={key:0,class:"filter-group filter-toggle"},Ks={class:"toggle-label"},Xs={class:"filter-results"},Ys={key:1,class:"loading-state"},Zs={key:2,class:"error-state"},Qs={key:3,class:"empty-state"},ea={key:4,class:"device-grid"},ta={key:6,class:"no-results"},oa={__name:"DeviceList",setup(t){const c=kt(),i=Ge(),{isMobile:k}=ot(),$=g(!1),s=g(!1),m=g(null),f=g(!1),S=g(!1),_=g(null),L=g(null),w=g(!0),n=g(!1),V=g(!1),z=g(0),E=g(window.innerWidth<=767?"grid":localStorage.getItem("device_view_mode")||"grid");ue(k,D=>{D&&E.value==="list"&&(E.value="grid")}),ue(E,D=>{localStorage.setItem("device_view_mode",D)});const x=()=>{w.value=!w.value,w.value||(S.value=!1)},o=()=>{w.value||(w.value=!0),S.value=!S.value},b=g(!1),P=g({title:"Error",message:"",suggestion:"",details:"",error:null,context:{}}),p=g(!1),Z=g({success:!1,title:"",message:""}),ne=g(!1),J=g({search:"",broadlinkDevice:"",area:"",entityType:"",showSmartIROnly:!1}),M=g([]),B=Pe("smartirStatus"),se=Pe("smartirEnabled"),fe=X(()=>{var h;return localStorage.getItem("smartir_simulate_not_installed")==="true"||!(se!=null&&se.value)?!1:((h=B==null?void 0:B.value)==null?void 0:h.installed)||!1}),Ee=X(()=>{const D=new Map;return c.devices.forEach(h=>{if(h.broadlink_entity){const O=M.value.find(le=>le.entity_id===h.broadlink_entity),j=O&&O.name||h.broadlink_entity;D.set(h.broadlink_entity,{entity_id:h.broadlink_entity,friendly_name:j})}}),Array.from(D.values()).sort((h,O)=>h.friendly_name.localeCompare(O.friendly_name))}),Ae=X(()=>{const D=new Set;return c.devices.forEach(h=>{h.area&&D.add(h.area)}),Array.from(D).sort()}),Le=X(()=>{let D=c.devices;if(J.value.search){const O=J.value.search.toLowerCase();D=D.filter(j=>{var ye,pe,$e,Ue,Be;if((ye=j.name)!=null&&ye.toLowerCase().includes(O)||(pe=j.entity_type)!=null&&pe.toLowerCase().includes(O)||($e=j.area)!=null&&$e.toLowerCase().includes(O)||(Ue=j.id)!=null&&Ue.toLowerCase().includes(O)||Object.keys(j.commands||{}).some(Fe=>Fe.toLowerCase().includes(O)))return!0;const ve=M.value.find(Fe=>Fe.entity_id===j.broadlink_entity);return!!((Be=ve==null?void 0:ve.name)!=null&&Be.toLowerCase().includes(O))})}J.value.broadlinkDevice&&(D=D.filter(O=>O.broadlink_entity===J.value.broadlinkDevice||O.controller_device===J.value.broadlinkDevice)),J.value.area&&(D=D.filter(O=>O.area===J.value.area)),J.value.entityType&&(D=D.filter(O=>O.entity_type===J.value.entityType)),J.value.showSmartIROnly&&(D=D.filter(O=>O.device_type==="smartir"));const h=localStorage.getItem("smartir_simulate_not_installed")==="true";return(!(se!=null&&se.value)||h)&&(D=D.filter(O=>O.device_type!=="smartir")),D}),Te=X(()=>J.value.search||J.value.broadlinkDevice||J.value.area||J.value.entityType||J.value.showSmartIROnly),Y=X(()=>{let D=0;return J.value.search&&D++,J.value.broadlinkDevice&&D++,J.value.area&&D++,J.value.entityType&&D++,J.value.showSmartIROnly&&D++,D}),R=D=>{D.target.closest(".settings-container")||(S.value=!1)};Oe(()=>{document.addEventListener("click",R)}),qe(()=>{document.removeEventListener("click",R)});const te=()=>{J.value.search="",J.value.broadlinkDevice="",J.value.area="",J.value.entityType="",J.value.showSmartIROnly=!1},q=()=>{L.value&&L.value.openDiscovery()},F=async()=>{try{const D=await oe.get("/api/remote/devices");M.value=D.data.devices||[]}catch(D){console.error("Error loading remote devices:",D)}};ue(E,D=>{localStorage.setItem("device_view_mode",D)});const K=async()=>{var D;try{const h=await oe.get("/api/devices/discover");z.value=((D=h.data.untracked_devices)==null?void 0:D.length)||0}catch(h){console.error("Error loading untracked count:",h),z.value=0}};Oe(async()=>{await Promise.all([c.loadDevices(),F(),K()])});const ce=D=>{m.value=D,$.value=!0},Ve=X(()=>{if(!_.value)return"";const D=Object.keys(_.value.commands||{}).length;return D===0?"This device has no commands. The device will be removed from tracking.":`This device has ${D} learned command${D>1?"s":""}. What would you like to do?`}),Me=X(()=>{if(!_.value)return"";const D=Object.keys(_.value.commands||{}).length;return D===0?"":`Also delete all ${D} command${D>1?"s":""} from Broadlink storage`}),ee=D=>{_.value=D,f.value=!0},y=()=>{f.value=!1,_.value=null},u=async D=>{var O,j;const h=_.value;f.value=!1;try{await c.deleteDevice(h.id,D),L.value&&await L.value.refresh()}catch(le){const ve=((j=(O=le.response)==null?void 0:O.data)==null?void 0:j.error)||le.message||"Unknown error";ie("Failed to Delete Device",ve)}finally{_.value=null}},l=async D=>{var h,O,j,le,ve;try{console.log("ğŸ’¾ Saving device data:",D),console.log("ğŸ’¾ Device commands:",D.commands),console.log("ğŸ’¾ Selected device:",m.value),(h=m.value)!=null&&h.id&&m.value.id!==null?await c.updateDevice(m.value.id,D):await c.createDevice(D),H(),L.value&&await L.value.refresh()}catch(ye){let pe="Failed to save device",$e="",Ue="";(j=(O=ye.response)==null?void 0:O.data)!=null&&j.error?(pe=ye.response.data.error,$e=ye.response.data.suggestion||""):ye.message&&(pe=ye.message),ye.response&&(Ue=`Status: ${ye.response.status}
URL: ${((le=ye.config)==null?void 0:le.url)||"N/A"}`),ie("Failed to Save Device",pe,$e,Ue,ye,{action:"save_device",deviceData:D,isEdit:!!((ve=m.value)!=null&&ve.id)})}},H=()=>{$.value=!1,m.value=null},Q=D=>{m.value=D,s.value=!0},re=()=>{s.value=!1,m.value=null},ie=(D,h,O="",j="",le=null,ve={})=>{P.value={title:D,message:h,suggestion:O,details:j,error:le,context:ve},b.value=!0},_e=()=>{b.value=!1},ge=()=>{p.value=!1},Ie=async D=>{var h;if(console.log("ğŸŸ¢ [PARENT] Received learned event:",D),!D||!D.deviceId){console.warn("âš ï¸ [PARENT] Missing required data in learned event");return}if(console.log("ğŸŸ¢ [PARENT] Current selectedDevice commands:",Object.keys(((h=m.value)==null?void 0:h.commands)||{}).length),console.log("ğŸŸ¢ [PARENT] Current store device count:",c.devices.length),console.log("ğŸŸ¢ [PARENT] Force reloading all devices from API with cache bust..."),await c.loadDevices(!0),console.log("ğŸŸ¢ [PARENT] After reload - store device count:",c.devices.length),m.value){console.log("ğŸŸ¢ [PARENT] Looking for device:",D.deviceId);const O=c.devices.find(j=>j.id===D.deviceId);O?(console.log("ğŸŸ¢ [PARENT] Found fresh device with",Object.keys(O.commands||{}).length,"commands"),m.value={...O},console.log("ğŸŸ¢ [PARENT] âœ… Updated selectedDevice - now has",Object.keys(m.value.commands||{}).length,"commands")):console.error("ğŸŸ¢ [PARENT] âŒ Device not found in store after reload!")}L.value&&(console.log("ğŸŸ¢ [PARENT] Refreshing discovery..."),L.value.refresh()),console.log("ğŸŸ¢ [PARENT] âœ… handleCommandLearned complete!")},I=D=>{const h=D.split("_"),O=[];for(let j=0;j<h.length;j++){const le=h[j],ve=h[j+1];le&&ve==="s"&&h[j+2]?(O.push(le.charAt(0).toUpperCase()+le.slice(1)+"'s"),j++):le!=="s"&&O.push(le.charAt(0).toUpperCase()+le.slice(1))}return O.join(" ")},d=(D,h)=>{const O=D.toLowerCase(),j=h.map(pe=>pe.toLowerCase());return O.includes("lamp")||O.includes("light")?"light":O.includes("fan")?"fan":O.includes("tv")||O.includes("stereo")||O.includes("speaker")||O.includes("receiver")?"media_player":O.includes("blind")||O.includes("curtain")||O.includes("shade")||O.includes("garage")?"cover":j.some(pe=>pe.includes("volume")||pe.includes("channel")||pe.includes("play")||pe.includes("pause")||pe.includes("mute"))?"media_player":j.some(pe=>pe.includes("fan_speed")||pe.includes("fan_low")||pe.includes("fan_high"))?"fan":j.some(pe=>pe.includes("open")||pe.includes("close")||pe.includes("stop"))?"cover":"switch"},C=(D,h)=>{const O=D.toLowerCase();return O.includes("tv")?"mdi:television":O.includes("stereo")||O.includes("receiver")||O.includes("speaker")?"mdi:speaker":O.includes("lamp")?"mdi:lamp":O.includes("light")?"mdi:lightbulb":O.includes("fan")?"mdi:fan":O.includes("blind")?"mdi:blinds":O.includes("curtain")?"mdi:curtains":O.includes("garage")?"mdi:garage":{light:"mdi:lightbulb",fan:"mdi:fan",switch:"mdi:light-switch",media_player:"mdi:speaker",cover:"mdi:window-shutter"}[h]||"mdi:devices"},U=D=>{const h=D.toLowerCase().split("_");for(let le=0;le<h.length-2;le++)if(h[le+1]==="s"){const ve=h.slice(le,le+3),ye=I(ve.join("_"));return console.log("Detected possessive area:",ye,"from",D),ye}const O=[["living","room"],["dining","room"],["master","bedroom"],["guest","bedroom"],["family","room"],["laundry","room"],["home","office"]];for(let le=0;le<h.length-1;le++){const ve=[h[le],h[le+1]],ye=O.find(pe=>pe[0]===ve[0]&&pe[1]===ve[1]);if(ye)return I(ye.join("_"))}const j=["kitchen","bedroom","bathroom","garage","office","basement","attic","hallway","entryway","patio","deck","yard","garden"];for(const le of h)if(j.includes(le))return le.charAt(0).toUpperCase()+le.slice(1);return""},de=async D=>{var h,O;try{const j=I(D.device_name),le=U(D.device_name),ve=d(D.device_name,D.commands),ye=C(D.device_name,ve);let pe="";try{console.log("Finding Broadlink owner for:",D.device_name);const Fe=await oe.post("/api/devices/find-broadlink-owner",{device_name:D.device_name});console.log("Broadlink owner response:",Fe.data),pe=Fe.data.broadlink_entity||"",console.log("Detected Broadlink entity:",pe)}catch(Fe){console.error("Error finding Broadlink owner:",Fe)}console.log("Fetching command data from Broadlink storage...");const Ue=(await oe.get(`/api/commands/broadlink/${D.device_name}`)).data.commands||{};console.log("Fetched command data:",Ue);const Be={};for(const[Fe,et]of Object.entries(Ue)){const mt=typeof et=="string"&&et.length>200;Be[Fe]={data:et,type:mt?"rf":"ir",name:Fe,learned_at:new Date().toISOString()}}console.log("Transformed commands:",Be),m.value={id:null,device:D.device_name,name:j,entity_type:ve,commands:Be,area:le,icon:ye,broadlink_entity:pe,enabled:!0},$.value=!0,i.success(`Imported ${Object.keys(Be).length} commands from Broadlink storage`),await K()}catch(j){console.error("Error adopting device:",j),i.error("Failed to adopt device: "+(((O=(h=j.response)==null?void 0:h.data)==null?void 0:O.error)||j.message))}},we=async()=>{V.value=!0;try{await c.syncAllAreas(),i.success("Areas synced from Home Assistant")}catch(D){console.error("Error syncing areas:",D),i.error("Failed to sync areas")}finally{V.value=!1}},ae=async()=>{var D,h;n.value=!0;try{const O=await oe.post("/api/entities/generate",{});if(O.data.success){const j=O.data.broadlink_count||0,le=O.data.smartir_count||0,ve=O.data.total_count||0,ye=O.data.errors||[];let pe="âœ… Entity Generation Successful",$e=[];const Ue=[];j>0&&Ue.push(`${j} Broadlink native`),le>0&&Ue.push(`${le} SmartIR`),Ue.length>0&&$e.push(`Generated ${Ue.join(" and ")} entity configuration${ve!==1?"s":""}.`),j>0&&($e.push(`
ğŸ“ Broadlink entities created in:`),$e.push("  â€¢ broadlink_manager/package.yaml")),le>0&&($e.push(`
ğŸ“ SmartIR entities created in:`),$e.push("  â€¢ smartir/climate.yaml"),$e.push("  â€¢ smartir/media_player.yaml"),$e.push("  â€¢ smartir/fan.yaml")),$e.push(`
ğŸ“ Next steps:`),$e.push("1. Add to configuration.yaml:"),$e.push("   homeassistant:"),$e.push("     packages:"),$e.push("       broadlink_manager: !include broadlink_manager/package.yaml"),$e.push("2. Restart Home Assistant to load the new entities"),ye.length>0&&(pe="âš ï¸ Entity Generation Completed with Errors",$e.push(`
âš ï¸ ${ye.length} error${ye.length!==1?"s":""} occurred:`),ye.forEach(Be=>{$e.push(`  â€¢ ${Be}`)})),Z.value={success:!0,title:pe,message:$e.join(`
`)},p.value=!0}else Z.value={success:!1,title:"âŒ Entity Generation Failed",message:O.data.message||`Failed to generate entities.

Please check that you have at least one device configured.`},p.value=!0}catch(O){console.error("Error generating entities:",O);const j=((h=(D=O.response)==null?void 0:D.data)==null?void 0:h.error)||O.message||"Unknown error occurred";Z.value={success:!1,title:"âŒ Entity Generation Error",message:`Failed to generate entities:

${j}

Please check the logs for more details.`},p.value=!0}finally{n.value=!1}},Se=async({device:D,command:h})=>{var O,j;try{const le={device_id:D.id,command:h,device:D.device||D.id,entity_id:D.broadlink_entity||D.controller_device};await oe.post("/api/commands/test",le),i.success(`Sent ${h} to ${D.name}`)}catch(le){console.error("Error sending command:",le);const ve=((j=(O=le.response)==null?void 0:O.data)==null?void 0:j.error)||le.message||"Unknown error";i.error(`Failed to send ${h}: ${ve}`)}};return(D,h)=>{var O;return a(),r("div",Ss,[e("div",Is,[e("button",{class:"icon-button chevron-button",onClick:x},[e("i",{class:G(["mdi",w.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2)]),e("div",{class:"header-left",onClick:x},[h[15]||(h[15]=e("div",{class:"header-icon"},[e("i",{class:"mdi mdi-devices"})],-1)),e("h3",null,v(xe(k)?"Devices":"Managed Devices"),1),e("div",Ds,[e("span",xs,v(xe(c).deviceCount)+" devices",1),z.value>0?(a(),r("span",{key:0,class:"header-info untracked-badge",title:`${z.value} device${z.value>1?"s":""} with learned commands found in Broadlink storage. Use the settings menu (âš™ï¸) to view and adopt them.`},v(z.value)+" untracked ",9,Ts)):A("",!0)])]),e("div",Ms,[xe(k)?A("",!0):(a(),r("div",Rs,[e("button",{onClick:h[0]||(h[0]=be(j=>E.value="grid",["stop"])),class:G(["view-toggle-btn",{active:E.value==="grid"}]),title:"Grid View"},[...h[16]||(h[16]=[e("i",{class:"mdi mdi-view-grid"},null,-1)])],2),e("button",{onClick:h[1]||(h[1]=be(j=>E.value="list",["stop"])),class:G(["view-toggle-btn",{active:E.value==="list"}]),title:"List View"},[...h[17]||(h[17]=[e("i",{class:"mdi mdi-view-list"},null,-1)])],2)])),e("button",{onClick:h[2]||(h[2]=be(j=>$.value=!0,["stop"])),class:"btn btn-primary new-button"},[...h[18]||(h[18]=[e("i",{class:"mdi mdi-plus"},null,-1),e("span",null,"New",-1)])]),e("div",Es,[e("button",{onClick:be(o,["stop"]),class:G(["icon-button settings-button",{active:S.value}]),title:"Settings"},[...h[19]||(h[19]=[e("i",{class:"mdi mdi-cog"},null,-1)])],2),S.value?(a(),r("div",{key:0,class:"settings-dropdown",onClick:h[6]||(h[6]=be(()=>{},["stop"]))},[e("button",{onClick:h[3]||(h[3]=j=>{q(),S.value=!1}),class:"menu-item"},[...h[20]||(h[20]=[e("i",{class:"mdi mdi-radar"},null,-1),e("span",null,"Untracked Devices",-1)])]),e("button",{onClick:h[4]||(h[4]=j=>{we(),S.value=!1}),class:"menu-item",disabled:V.value},[e("i",{class:G(["mdi",V.value?"mdi-loading mdi-spin":"mdi-refresh"])},null,2),e("span",null,v(V.value?"Syncing Areas...":"Sync Areas"),1)],8,Os),e("button",{onClick:h[5]||(h[5]=j=>{ae(),S.value=!1}),class:"menu-item",disabled:n.value},[e("i",{class:G(["mdi",n.value?"mdi-loading mdi-spin":"mdi-file-code"])},null,2),e("span",null,v(n.value?"Generating...":"Generate Entities"),1)],8,As)])):A("",!0)])])]),W(e("div",Ls,[ke(_s,{ref_key:"discoveryRef",ref:L,onAdopt:de},null,512),xe(c).hasDevices?(a(),r("div",Ps,[e("div",Vs,[e("button",{class:G(["filter-toggle-button",{active:ne.value||Te.value}]),onClick:h[7]||(h[7]=j=>ne.value=!ne.value),title:ne.value?"Hide filters":"Show filters"},[h[21]||(h[21]=e("i",{class:"mdi mdi-filter-variant"},null,-1)),Te.value?(a(),r("span",Us,v(Y.value),1)):A("",!0)],10,js),e("div",Fs,[h[22]||(h[22]=e("i",{class:"mdi mdi-magnify search-icon"},null,-1)),W(e("input",{"onUpdate:modelValue":h[8]||(h[8]=j=>J.value.search=j),type:"text",placeholder:"Search devices, commands...",class:"search-input"},null,512),[[je,J.value.search]])])]),W(e("div",Ns,[e("div",Bs,[e("div",Hs,[e("label",null,[h[24]||(h[24]=e("i",{class:"mdi mdi-access-point"},null,-1)),W(e("select",{"onUpdate:modelValue":h[9]||(h[9]=j=>J.value.broadlinkDevice=j)},[h[23]||(h[23]=e("option",{value:""},"All Controller Devices",-1)),(a(!0),r(he,null,Ce(Ee.value,j=>(a(),r("option",{key:j.entity_id,value:j.entity_id},v(j.friendly_name),9,qs))),128))],512),[[Re,J.value.broadlinkDevice]])])]),e("div",zs,[e("label",null,[h[26]||(h[26]=e("i",{class:"mdi mdi-home-map-marker"},null,-1)),W(e("select",{"onUpdate:modelValue":h[10]||(h[10]=j=>J.value.area=j)},[h[25]||(h[25]=e("option",{value:""},"All Areas",-1)),(a(!0),r(he,null,Ce(Ae.value,j=>(a(),r("option",{key:j,value:j},v(j),9,Js))),128))],512),[[Re,J.value.area]])])]),e("div",Ws,[e("label",null,[h[28]||(h[28]=e("i",{class:"mdi mdi-shape"},null,-1)),W(e("select",{"onUpdate:modelValue":h[11]||(h[11]=j=>J.value.entityType=j)},[...h[27]||(h[27]=[ze('<option value="" data-v-12a1d608>All Types</option><option value="light" data-v-12a1d608>Light</option><option value="fan" data-v-12a1d608>Fan</option><option value="switch" data-v-12a1d608>Switch</option><option value="media_player" data-v-12a1d608>Media Player</option><option value="cover" data-v-12a1d608>Cover</option><option value="climate" data-v-12a1d608>Climate</option>',7)])],512),[[Re,J.value.entityType]])])]),fe.value?(a(),r("div",Gs,[e("label",Ks,[h[29]||(h[29]=e("span",{class:"toggle-text"},[e("img",{src:Qe,alt:"SmartIR",class:"smartir-icon"}),T(" SmartIR Only ")],-1)),W(e("input",{type:"checkbox","onUpdate:modelValue":h[12]||(h[12]=j=>J.value.showSmartIROnly=j),class:"toggle-checkbox"},null,512),[[me,J.value.showSmartIROnly]]),h[30]||(h[30]=e("span",{class:"toggle-slider"},null,-1))])])):A("",!0),Te.value?(a(),r("button",{key:1,onClick:te,class:"btn-clear-filters"},[...h[31]||(h[31]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),T(" Clear ",-1)])])):A("",!0),e("div",Xs,v(Le.value.length)+" of "+v(xe(c).deviceCount),1)])],512),[[Ye,ne.value]])])):A("",!0),xe(c).loading?(a(),r("div",Ys,[...h[32]||(h[32]=[e("i",{class:"mdi mdi-loading mdi-spin"},null,-1),e("p",null,"Loading devices...",-1)])])):xe(c).error?(a(),r("div",Zs,[h[33]||(h[33]=e("i",{class:"mdi mdi-alert-circle"},null,-1)),e("p",null,v(xe(c).error),1),e("button",{onClick:h[13]||(h[13]=j=>xe(c).loadDevices()),class:"btn btn-secondary"}," Retry ")])):xe(c).hasDevices?A("",!0):(a(),r("div",Qs,[h[35]||(h[35]=e("i",{class:"mdi mdi-devices"},null,-1)),h[36]||(h[36]=e("h3",null,"No Devices Yet",-1)),h[37]||(h[37]=e("p",null,"Get started by adding your first managed device",-1)),e("button",{onClick:h[14]||(h[14]=j=>$.value=!0),class:"btn btn-primary"},[...h[34]||(h[34]=[e("i",{class:"mdi mdi-plus"},null,-1),T(" Add Your First Device ",-1)])])])),E.value==="grid"?(a(),r("div",ea,[(a(!0),r(he,null,Ce(Le.value,j=>(a(),Ne(Bt,{key:j.id,device:j,"broadlink-devices":M.value,onEdit:ce,onDelete:ee,onLearn:Q},null,8,["device","broadlink-devices"]))),128))])):E.value==="list"&&Le.value.length>0?(a(),Ne(uo,{key:5,devices:Le.value,onSendCommand:Se,onOpenCommands:Q,onEditDevice:ce,onDeleteDevice:ee},null,8,["devices"])):A("",!0),xe(c).hasDevices&&Le.value.length===0?(a(),r("div",ta,[...h[38]||(h[38]=[e("i",{class:"mdi mdi-filter-off"},null,-1),e("h3",null,"No devices match your filters",-1),e("p",null,"Try adjusting your search or filter criteria",-1)])])):A("",!0)],512),[[Ye,w.value]]),$.value?(a(),Ne(jl,{key:0,device:m.value,onSave:l,onCancel:H},null,8,["device"])):A("",!0),s.value?(a(),Ne(Jn,{key:1,device:m.value,onLearned:Ie,onCancel:re},null,8,["device"])):A("",!0),ke(He,{isOpen:f.value,title:`Delete ${(O=_.value)==null?void 0:O.name}?`,message:Ve.value,confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,checkboxLabel:Me.value,onConfirm:u,onCancel:y},null,8,["isOpen","title","message","checkboxLabel"]),ke(ns,{isOpen:b.value,title:P.value.title,message:P.value.message,suggestion:P.value.suggestion,details:P.value.details,error:P.value.error,context:P.value.context,onClose:_e},null,8,["isOpen","title","message","suggestion","details","error","context"]),ke(He,{isOpen:p.value,title:Z.value.title,message:Z.value.message,confirmText:"OK",showCancel:!1,dangerMode:!Z.value.success,onConfirm:ge,onCancel:ge},null,8,["isOpen","title","message","dangerMode"])])}}},la=De(oa,[["__scopeId","data-v-12a1d608"]]),na={class:"banner-content"},sa={class:"banner-icon"},aa={class:"banner-message"},ia={class:"banner-actions"},ra={__name:"SmartIRBanner",setup(t){const c=Pe("smartirStatus"),i=g(!1),k=X(()=>!(!c.value||i.value||localStorage.getItem("smartir_banner_dismissed")==="true")),$=X(()=>{var L;return(L=c.value)!=null&&L.installed?"banner-success":"banner-info"}),s=X(()=>{var L;return(L=c.value)!=null&&L.installed?"mdi mdi-check-circle":"mdi mdi-information"}),m=X(()=>{var L;return(L=c.value)!=null&&L.installed?`SmartIR Detected (v${c.value.version})`:"Want Climate Device Support?"}),f=X(()=>{var L;return(L=c.value)!=null&&L.installed?"You can now create climate device profiles with full temperature and HVAC mode control.":"Install SmartIR to unlock AC/heater control with temperature settings, HVAC modes, and 120+ pre-configured device profiles."});function S(){window.open("https://github.com/smartHomeHub/SmartIR","_blank")}function _(){var L;if(i.value=!0,(L=c.value)!=null&&L.installed)localStorage.setItem("smartir_banner_dismissed","true");else{const w=parseInt(localStorage.getItem("smartir_banner_dismiss_count")||"0");w>=2?localStorage.setItem("smartir_banner_dismissed","true"):localStorage.setItem("smartir_banner_dismiss_count",String(w+1))}}return Oe(()=>{var n;const L=localStorage.getItem("smartir_last_status"),w=(n=c.value)!=null&&n.installed?"installed":"not_installed";L!==w&&(localStorage.removeItem("smartir_banner_dismissed"),localStorage.removeItem("smartir_banner_dismiss_count"),localStorage.setItem("smartir_last_status",w))}),(L,w)=>{var n,V;return k.value?(a(),r("div",{key:0,class:G(["smartir-banner",$.value])},[e("div",na,[e("div",sa,[e("i",{class:G(s.value)},null,2)]),e("div",aa,[e("strong",null,v(m.value),1),e("p",null,v(f.value),1)]),e("div",ia,[(n=L.status)!=null&&n.installed?A("",!0):(a(),r("button",{key:0,onClick:S,class:"btn-primary"}," Learn More ")),e("button",{onClick:_,class:"btn-text"},v((V=L.status)!=null&&V.installed?"Got it":"Dismiss"),1)])])],2)):A("",!0)}}},da=De(ra,[["__scopeId","data-v-7bbcbcd7"]]),We="api/smartir",ut={async getStatus(){try{const t=await fetch(`${We}/status`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return await t.json()}catch(t){return console.error("Error fetching SmartIR status:",t),{installed:!1,version:null,error:t.message}}},async getInstallInstructions(){try{const t=await fetch(`${We}/install-instructions`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return await t.json()}catch(t){throw console.error("Error fetching install instructions:",t),t}},async getPlatforms(){try{const t=await fetch(`${We}/platforms`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return await t.json()}catch(t){throw console.error("Error fetching platforms:",t),t}},async getPlatformCodes(t){try{const c=await fetch(`${We}/platforms/${t}/codes`);if(!c.ok)throw new Error(`HTTP error! status: ${c.status}`);return await c.json()}catch(c){throw console.error(`Error fetching codes for ${t}:`,c),c}},async getNextCode(t){try{const c=await fetch(`${We}/platforms/${t}/next-code`);if(!c.ok)throw new Error(`HTTP error! status: ${c.status}`);return await c.json()}catch(c){throw console.error(`Error fetching next code for ${t}:`,c),c}},async validateCode(t,c){try{const i=await fetch(`${We}/validate-code`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({platform:t,code:c})});if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);return await i.json()}catch(i){throw console.error("Error validating code:",i),i}}},ua={class:"profile-card"},ca={class:"profile-card-header"},ma=["title"],va={class:"profile-details"},pa=["title"],fa={class:"profile-meta"},ga=["title"],ya=["title"],ba=["title"],ha={class:"profile-card-footer"},ka=["title"],wa={key:0,class:"learned-indicator"},$a={class:"profile-actions"},Ca={__name:"SmartIRProfileCard",props:{profile:{type:Object,required:!0}},emits:["edit","download","delete","commands"],setup(t){const c=t,i=rt(X(()=>c.profile.platform)),k=m=>m.replace(/_/g," ").replace(/\b\w/g,f=>f.toUpperCase()),$=m=>m&&m.startsWith("mdi:")?`mdi ${m.replace(":"," mdi-")}`:`mdi mdi-${m}`,s=m=>{if(!m)return"";const f=m.toLowerCase();return f.includes("broadlink")?"broadlink-tag":f.includes("not set")?"not-set-tag":"default-controller-tag"};return(m,f)=>(a(),r("div",ua,[e("div",ca,[e("div",{class:G(["profile-icon",xe(i).colorClass.value]),title:k(t.profile.platform)},[e("i",{class:G($(xe(i).icon.value))},null,2)],10,ma),e("div",va,[e("h4",{title:`${t.profile.manufacturer} ${t.profile.model}`},v(t.profile.manufacturer)+" "+v(t.profile.model),9,pa),e("div",fa,[e("span",{class:"tag platform-tag",title:k(t.profile.platform)},v(k(t.profile.platform)),9,ga),t.profile.controllerBrand?(a(),r("span",{key:0,class:G(["tag controller-tag",s(t.profile.controllerBrand)]),title:"Controller: "+t.profile.controllerBrand},[f[4]||(f[4]=e("i",{class:"mdi mdi-remote-tv"},null,-1)),T(" "+v(t.profile.controllerBrand),1)],10,ya)):A("",!0)])]),e("div",{class:"code-badge",title:"Device Code: "+t.profile.code},v(t.profile.code),9,ba)]),e("div",ha,[e("div",{class:"profile-stats",title:t.profile.commandCount+" total commands"+(t.profile.learnedCount>0?", "+t.profile.learnedCount+" learned":"")},[f[5]||(f[5]=e("i",{class:"mdi mdi-remote"},null,-1)),e("span",null,v(t.profile.commandCount)+" command"+v(t.profile.commandCount!==1?"s":""),1),t.profile.learnedCount>0?(a(),r("span",wa,"( "+v(t.profile.learnedCount)+" learned )",1)):A("",!0)],8,ka),e("div",$a,[e("button",{onClick:f[0]||(f[0]=S=>m.$emit("commands")),class:"action-btn",title:"Commands"},[...f[6]||(f[6]=[e("i",{class:"mdi mdi-remote"},null,-1)])]),e("button",{onClick:f[1]||(f[1]=S=>m.$emit("edit")),class:"action-btn",title:"Edit Profile"},[...f[7]||(f[7]=[e("i",{class:"mdi mdi-pencil"},null,-1)])]),e("button",{onClick:f[2]||(f[2]=S=>m.$emit("download")),class:"action-btn",title:"Download JSON"},[...f[8]||(f[8]=[e("i",{class:"mdi mdi-download"},null,-1)])]),e("button",{onClick:f[3]||(f[3]=S=>m.$emit("delete")),class:"action-btn delete",title:"Delete Profile"},[...f[9]||(f[9]=[e("i",{class:"mdi mdi-delete"},null,-1)])])])])]))}},_a=De(Ca,[["__scopeId","data-v-aad9720f"]]),Sa={name:"SmartIRProfileListView",props:{profiles:{type:Array,required:!0}},methods:{getPlatformIcon(t){return{climate:"mdi-thermostat",media_player:"mdi-television",fan:"mdi-fan",light:"mdi-lightbulb"}[t]||"mdi-devices"},formatPlatform(t){return{climate:"Climate",media_player:"Media Player",fan:"Fan",light:"Light"}[t]||t},editProfile(t){this.$emit("edit",t)},viewCommands(t){this.$emit("commands",t)},downloadProfile(t){this.$emit("download",t)},deleteProfile(t){this.$emit("delete",t)}}},Ia={class:"profile-list-view"},Da={class:"profile-table"},xa={class:"profile-code"},Ta={class:"code-badge"},Ma={class:"profile-manufacturer"},Ra={class:"profile-model"},Ea={class:"model-info"},Oa={class:"model-name"},Aa={key:0,class:"model-count"},La={class:"profile-platform"},Pa={class:"profile-controller"},Va={class:"profile-commands"},ja={class:"command-stats"},Ua={class:"stat-item"},Fa={key:0,class:"stat-item learned"},Na={class:"profile-actions"},Ba=["onClick"],Ha=["onClick"],qa=["onClick"],za=["onClick"];function Ja(t,c,i,k,$,s){return a(),r("div",Ia,[e("table",Da,[c[6]||(c[6]=e("thead",null,[e("tr",null,[e("th",null,"Code"),e("th",null,"Manufacturer"),e("th",null,"Model"),e("th",null,"Platform"),e("th",null,"Controller"),e("th",null,"Commands"),e("th",null,"Actions")])],-1)),e("tbody",null,[(a(!0),r(he,null,Ce(i.profiles,m=>(a(),r("tr",{key:`${m.platform}-${m.code}`,class:"profile-row"},[e("td",xa,[e("span",Ta,v(m.code),1)]),e("td",Ma,v(m.manufacturer||"Unknown"),1),e("td",Ra,[e("div",Ea,[e("div",Oa,v(m.model||"Unknown"),1),m.models&&m.models.length>1?(a(),r("div",Aa," +"+v(m.models.length-1)+" more ",1)):A("",!0)])]),e("td",La,[e("span",{class:G(["platform-badge",m.platform])},[e("i",{class:G(["mdi",s.getPlatformIcon(m.platform)])},null,2),T(" "+v(s.formatPlatform(m.platform)),1)],2)]),e("td",Pa,v(m.controller_brand||"N/A"),1),e("td",Va,[e("div",ja,[e("span",Ua,[c[0]||(c[0]=e("i",{class:"mdi mdi-remote"},null,-1)),T(" "+v(m.command_count||0),1)]),m.learned_count>0?(a(),r("span",Fa,[c[1]||(c[1]=e("i",{class:"mdi mdi-school"},null,-1)),T(" "+v(m.learned_count),1)])):A("",!0)])]),e("td",Na,[e("button",{class:"action-btn edit",onClick:f=>s.editProfile(m),title:"Edit Profile"},[...c[2]||(c[2]=[e("i",{class:"mdi mdi-pencil"},null,-1)])],8,Ba),e("button",{class:"action-btn commands",onClick:f=>s.viewCommands(m),title:"View Commands"},[...c[3]||(c[3]=[e("i",{class:"mdi mdi-remote"},null,-1)])],8,Ha),e("button",{class:"action-btn download",onClick:f=>s.downloadProfile(m),title:"Download"},[...c[4]||(c[4]=[e("i",{class:"mdi mdi-download"},null,-1)])],8,qa),e("button",{class:"action-btn delete",onClick:f=>s.deleteProfile(m),title:"Delete"},[...c[5]||(c[5]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,za)])]))),128))])])])}const Wa=De(Sa,[["render",Ja],["__scopeId","data-v-d3773038"]]),Ga={class:"modal-container"},Ka={class:"modal-body"},Xa={key:0,class:"selection-section"},Ya={class:"form-group"},Za={class:"form-group"},Qa={class:"form-group"},ei={key:0,class:"code-info"},ti={class:"form-actions"},oi=["disabled"],li={key:1,class:"testing-section"},ni={class:"code-header"},si={class:"code-details"},ai={class:"code-badge"},ii={class:"device-selector"},ri=["value"],di={key:0,class:"helper-text"},ui={class:"commands-section"},ci={class:"commands-header"},mi={key:0,class:"tested-count"},vi={key:0,class:"filters-section"},pi={class:"filter-row"},fi={class:"filter-row"},gi={key:1,class:"empty-state"},yi={key:2,class:"empty-state"},bi={key:3,class:"commands-list"},hi={class:"command-name"},ki={class:"command-actions"},wi={key:0,class:"status-badge success"},$i=["onClick","disabled","title"],Ci={__name:"SmartIRCodeTester",props:{isOpen:{type:Boolean,default:!1}},emits:["close","clone"],setup(t,{emit:c}){const i=t,k=c,$=Pe("toast"),s=g("climate"),m=g(""),f=g([]),S=g(!1),_=g(null),L=g(""),w=g([]),n=g(!1),V=X(()=>w.value.map(ee=>({code:ee.code,label:`${ee.models.join(", ")} (Code: ${ee.code})`,value:ee.code}))),z=g(null),N=g(null),E=g(!1),x=g([]),o=g(""),b=g([]),P=g(new Set),p=g(null),Z=g(""),ne=g(""),J=g(""),M=g(""),B=X(()=>{let ee=b.value;if(Z.value){const y=Z.value.toLowerCase();ee=ee.filter(u=>(u.label||u.name).toLowerCase().includes(y))}return ne.value&&(ee=ee.filter(y=>y.mode===ne.value)),J.value&&(ee=ee.filter(y=>y.fanSpeed===J.value)),M.value&&(ee=ee.filter(y=>y.swingMode===M.value)),ee}),se=X(()=>Z.value||ne.value||J.value||M.value);ue(()=>i.isOpen,ee=>{ee&&(fe(),Ae())}),ue(s,()=>{i.isOpen&&(m.value="",_.value=null,w.value=[],fe())});async function fe(){var ee;S.value=!0;try{const y=await oe.get("/api/smartir/codes/manufacturers",{params:{entity_type:s.value}});f.value=y.data.manufacturers||[]}catch(y){console.error("Error loading manufacturers:",y),(ee=$.value)==null||ee.error("Failed to load manufacturers","âŒ Error")}finally{S.value=!1}}async function Ee(){var ee;if(m.value){n.value=!0;try{const y=await oe.get("/api/smartir/codes/models",{params:{entity_type:s.value,manufacturer:m.value}});w.value=y.data.models||[]}catch(y){console.error("Error loading models:",y),(ee=$.value)==null||ee.error("Failed to load models","âŒ Error")}finally{n.value=!1}}}async function Ae(){try{const ee=await oe.get("/api/remote/devices");x.value=ee.data.devices||[]}catch(ee){console.error("Error loading Broadlink devices:",ee)}}async function Le(){var ee,y;if(_.value){E.value=!0;try{const u=await oe.get("/api/smartir/codes/code",{params:{entity_type:s.value,code_id:_.value.code}});N.value=u.data.code,z.value=_.value.code,Te(u.data.code),(ee=$.value)==null||ee.success(`Loaded ${b.value.length} commands`,"âœ… Code Loaded")}catch(u){console.error("Error loading code:",u),(y=$.value)==null||y.error(u.message||"Failed to load code","âŒ Error")}finally{E.value=!1}}}function Te(ee){const y=[];if(!ee.commands){b.value=y;return}if(s.value==="climate"){const l=ee.commands;for(const[H,Q]of Object.entries(l)){if(H==="off"){typeof Q=="string"&&y.push({name:"off",label:"OFF",data:Q,mode:"off"});continue}if(typeof Q=="object"){for(const[re,ie]of Object.entries(Q))if(typeof ie=="object")for(const[_e,ge]of Object.entries(ie)){if(typeof ge!="object")continue;const Ie=Object.keys(ge),I=Ie.includes("24")?"24":Ie[0];if(I&&typeof ge[I]=="string"){const d=`${H}_${I}_${re}_${_e}`,C=`${H.toUpperCase()} ${I}Â°C ${re} ${_e}`;y.push({name:d,label:C,data:ge[I],mode:H,temperature:I,fanSpeed:re,swingMode:_e})}}}}}else for(const[l,H]of Object.entries(ee.commands))typeof H=="string"&&y.push({name:l,label:l.toUpperCase().replace(/_/g," "),data:H});b.value=y}async function Y(ee){var y,u,l;if(!o.value){(y=$.value)==null||y.warning("Please select a Broadlink device first","âš ï¸ No Device");return}p.value=ee;try{const H=b.value.find(Q=>Q.name===ee);if(!H||!H.data)throw new Error(`Command "${ee}" not found`);await oe.post("/api/commands/send-raw",{entity_id:o.value,command:H.data,command_type:"ir"}),P.value.add(ee),(u=$.value)==null||u.success(`Command sent: ${H.label||ee}`,"âœ… Tested")}catch(H){console.error("Error testing command:",H),(l=$.value)==null||l.error("Failed to test command","âŒ Error")}finally{p.value=null}}function R(){var ee,y,u,l;if(!N.value){(ee=$.value)==null||ee.error("No profile data to download","âŒ Error");return}try{const H=N.value.manufacturer||"unknown",Q=((y=N.value.supportedModels)==null?void 0:y[0])||z.value,re=`${H.toLowerCase().replace(/\s+/g,"_")}_${Q.toLowerCase().replace(/\s+/g,"_")}.json`,ie=JSON.stringify(N.value,null,2),_e=new Blob([ie],{type:"application/json"}),ge=URL.createObjectURL(_e),Ie=document.createElement("a");Ie.href=ge,Ie.download=re,document.body.appendChild(Ie),Ie.click(),document.body.removeChild(Ie),URL.revokeObjectURL(ge),(u=$.value)==null||u.success(`Downloaded ${re}`,"âœ… Download Complete")}catch(H){console.error("Error downloading JSON:",H),(l=$.value)==null||l.error(H.message||"Failed to download JSON","âŒ Download Error")}}function te(){m.value="",_.value=null,L.value="",w.value=[]}function q(){_.value=null,L.value="",Ee()}function F(){L.value?_.value=w.value.find(ee=>ee.code===L.value):_.value=null}function K(){Z.value="",ne.value="",J.value="",M.value=""}function ce(){z.value=null,N.value=null,b.value=[],P.value.clear(),p.value=null,K()}function Ve(ee){const y=ee.toLowerCase();return y.includes("power")||y.includes("off")||y==="off"?"mdi-power":y.includes("cool")?"mdi-snowflake":y.includes("heat")?"mdi-fire":y.includes("fan")?"mdi-fan":y.includes("auto")?"mdi-auto-fix":y.includes("dry")?"mdi-water-percent":y.includes("temp")?"mdi-thermometer":y.includes("swing")?"mdi-swap-vertical":"mdi-remote"}function Me(){ce(),m.value="",_.value=null,k("close")}return(ee,y)=>{var u;return t.isOpen?(a(),r("div",{key:0,class:"modal-overlay",onClick:be(Me,["self"])},[e("div",Ga,[e("div",{class:"modal-header"},[y[9]||(y[9]=e("h3",null,[e("i",{class:"mdi mdi-test-tube"}),T(" Test SmartIR Code ")],-1)),e("button",{onClick:Me,class:"close-btn"},[...y[8]||(y[8]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Ka,[z.value?(a(),r("div",li,[e("div",ni,[e("div",si,[e("h4",null,v(N.value.manufacturer)+" - "+v(((u=N.value.supportedModels)==null?void 0:u[0])||"Unknown"),1),e("span",ai,"Code: "+v(z.value),1)]),e("button",{onClick:ce,class:"btn-secondary-small"},[...y[14]||(y[14]=[e("i",{class:"mdi mdi-arrow-left"},null,-1),T(" Change Code ",-1)])])]),e("div",ii,[y[17]||(y[17]=e("label",null,[e("i",{class:"mdi mdi-remote"}),T(" Broadlink Device ")],-1)),W(e("select",{"onUpdate:modelValue":y[3]||(y[3]=l=>o.value=l),class:"form-select"},[y[15]||(y[15]=e("option",{value:""},"Select device to test with...",-1)),(a(!0),r(he,null,Ce(x.value,l=>(a(),r("option",{key:l.entity_id,value:l.entity_id},v(l.friendly_name||l.entity_id),9,ri))),128))],512),[[Re,o.value]]),o.value?A("",!0):(a(),r("p",di,[...y[16]||(y[16]=[e("i",{class:"mdi mdi-information-outline"},null,-1),T(" Select a Broadlink device to enable command testing ",-1)])]))]),e("div",ui,[e("div",ci,[e("h5",null,"Sample Commands ("+v(B.value.length)+" / "+v(b.value.length)+")",1),P.value.size>0?(a(),r("span",mi,v(P.value.size)+" tested ",1)):A("",!0)]),s.value==="climate"&&b.value.length>0?(a(),r("div",vi,[e("div",pi,[W(e("input",{"onUpdate:modelValue":y[4]||(y[4]=l=>Z.value=l),type:"text",placeholder:"Search commands...",class:"search-input"},null,512),[[je,Z.value]])]),e("div",fi,[W(e("select",{"onUpdate:modelValue":y[5]||(y[5]=l=>ne.value=l),class:"filter-select"},[...y[18]||(y[18]=[e("option",{value:""},"All Modes",-1),e("option",{value:"cool"},"Cool",-1),e("option",{value:"heat"},"Heat",-1),e("option",{value:"off"},"Off",-1)])],512),[[Re,ne.value]]),W(e("select",{"onUpdate:modelValue":y[6]||(y[6]=l=>J.value=l),class:"filter-select"},[...y[19]||(y[19]=[ze('<option value="" data-v-66569200>All Fan Speeds</option><option value="low" data-v-66569200>Low</option><option value="mid" data-v-66569200>Mid</option><option value="high" data-v-66569200>High</option><option value="auto" data-v-66569200>Auto</option>',5)])],512),[[Re,J.value]]),W(e("select",{"onUpdate:modelValue":y[7]||(y[7]=l=>M.value=l),class:"filter-select"},[...y[20]||(y[20]=[e("option",{value:""},"All Swing",-1),e("option",{value:"stop"},"Stop",-1),e("option",{value:"swing"},"Swing",-1)])],512),[[Re,M.value]]),se.value?(a(),r("button",{key:0,onClick:K,class:"btn-clear-filters"},[...y[21]||(y[21]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),T(" Clear ",-1)])])):A("",!0)])])):A("",!0),b.value.length===0?(a(),r("div",gi,[...y[22]||(y[22]=[e("i",{class:"mdi mdi-alert-circle"},null,-1),e("p",null,"No commands found in this code",-1)])])):B.value.length===0?(a(),r("div",yi,[y[23]||(y[23]=e("i",{class:"mdi mdi-filter-off"},null,-1)),y[24]||(y[24]=e("p",null,"No commands match your filters",-1)),e("button",{onClick:K,class:"btn-secondary-small"}," Clear Filters ")])):(a(),r("div",bi,[(a(!0),r(he,null,Ce(B.value,l=>(a(),r("div",{key:l.name,class:G(["command-item",{tested:P.value.has(l.name),testing:p.value===l.name}])},[e("div",hi,[e("i",{class:G(["mdi",Ve(l.mode||l.name)])},null,2),e("span",null,v(l.label||l.name),1)]),e("div",ki,[P.value.has(l.name)?(a(),r("span",wi,[...y[25]||(y[25]=[e("i",{class:"mdi mdi-check"},null,-1),T(" Tested ",-1)])])):A("",!0),e("button",{onClick:H=>Y(l.name),disabled:!o.value||p.value===l.name,title:o.value?"Test this command":"Select a Broadlink device first",class:"btn-test"},[e("i",{class:G(["mdi",p.value===l.name?"mdi-loading mdi-spin":"mdi-play"])},null,2),y[26]||(y[26]=T(" Test ",-1))],8,$i)])],2))),128))]))]),e("div",{class:"modal-actions"},[e("button",{onClick:R,class:"btn-primary"},[...y[27]||(y[27]=[e("i",{class:"mdi mdi-download"},null,-1),T(" Download JSON ",-1)])]),e("button",{onClick:Me,class:"btn-secondary"}," Close ")])])):(a(),r("div",Xa,[y[13]||(y[13]=e("div",{class:"info-banner"},[e("i",{class:"mdi mdi-information"}),e("p",null,"Select a SmartIR code from the index to test commands with your Broadlink device.")],-1)),e("div",Ya,[y[11]||(y[11]=e("label",null,[e("i",{class:"mdi mdi-shape"}),T(" Platform ")],-1)),W(e("select",{"onUpdate:modelValue":y[0]||(y[0]=l=>s.value=l),onChange:te,class:"form-select"},[...y[10]||(y[10]=[e("option",{value:"climate"},"Climate (AC/Heater)",-1),e("option",{value:"media_player"},"Media Player (TV/Audio)",-1),e("option",{value:"fan"},"Fan",-1),e("option",{value:"light"},"Light",-1)])],544),[[Re,s.value]])]),e("div",Za,[ke(Ze,{modelValue:m.value,"onUpdate:modelValue":y[1]||(y[1]=l=>m.value=l),options:f.value,label:"Manufacturer",placeholder:"Search manufacturers...",loading:S.value,disabled:S.value,onChange:q},null,8,["modelValue","options","loading","disabled"])]),e("div",Qa,[ke(Ze,{modelValue:L.value,"onUpdate:modelValue":y[2]||(y[2]=l=>L.value=l),options:V.value,"option-label":"label","option-value":"code",label:"Model",placeholder:"Search models...",loading:n.value,disabled:!m.value||n.value,onChange:F},null,8,["modelValue","options","loading","disabled"])]),_.value?(a(),r("div",ei,[y[12]||(y[12]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[e("strong",null,v(m.value)+" - "+v(_.value.models[0]),1),e("p",null,"Code: "+v(_.value.code),1)])])):A("",!0),e("div",ti,[e("button",{onClick:Le,disabled:!_.value||E.value,class:"btn-primary"},[e("i",{class:G(["mdi",E.value?"mdi-loading mdi-spin":"mdi-download"])},null,2),T(" "+v(E.value?"Loading...":"Load Commands"),1)],8,oi)])]))])])])):A("",!0)}}},_i=De(Ci,[["__scopeId","data-v-66569200"]]),Si={class:"smartir-status-card"},Ii={class:"card-header"},Di=["src"],xi={class:"header-badges"},Ti=["title"],Mi={class:"header-info"},Ri={class:"header-info"},Ei={class:"header-info"},Oi={class:"header-right"},Ai={key:0,class:"view-toggle-group header-view-toggle"},Li={key:2,class:"settings-menu-container"},Pi={key:0,class:"card-body loading-state"},Vi={key:1,class:"card-body error-state"},ji={key:2,class:"card-body installed-state"},Ui={key:0,class:"help-panel"},Fi={key:0,class:"recommendation"},Ni={key:0,class:"next-steps"},Bi={class:"help-actions"},Hi={key:1,class:"filter-bar"},qi={class:"filter-search-row"},zi=["title"],Ji={key:0,class:"filter-badge"},Wi={class:"search-input-wrapper"},Gi={class:"filter-content"},Ki={class:"filter-row"},Xi={class:"filter-group"},Yi={class:"filter-results"},Zi={key:2,class:"loading-state"},Qi={key:3,class:"empty-state"},er={key:4,class:"profiles-grid"},tr={key:6,class:"no-results"},or={key:3,class:"card-body not-installed-state"},lr={class:"benefits-section"},nr={class:"benefits-list"},sr={class:"recommendation"},ar={__name:"SmartIRStatusCard",emits:["create-profile","edit-profile"],setup(t,{expose:c,emit:i}){const k=i,$=Pe("smartirStatus");Pe("smartirEnabled");const s=Pe("refreshSmartIR"),{isMobile:m}=ot(),f=g(!1),S=g(null),_=g(($==null?void 0:$.value)||null),L=g(localStorage.getItem("smartir_simulate_not_installed")==="true"),w=g(!1),n=g(!1),V=g(!0),z=g([]),N=g(!1),E=g(!1),x=g({search:"",platform:""}),o=g({show:!1,title:"",message:"",platform:null,profile:null}),b=g(!1),p=g(window.innerWidth<=767?"grid":localStorage.getItem("profile_view_mode")||"grid");ue(m,u=>{u&&p.value==="list"&&(p.value="grid")}),ue(p,u=>{localStorage.setItem("profile_view_mode",u)}),ue(V,u=>{u||(n.value=!1)});const Z=["Full climate entity support (AC, heaters)","120+ pre-configured device profiles","Temperature and humidity sensor integration","HVAC mode control (heat, cool, auto, dry, fan)"],ne=["climate","media_player","fan","light"],J=X(()=>L.value?{installed:!1,recommendation:{message:"Install SmartIR to unlock climate device support!",benefits:["Full climate entity support (AC, heaters)","120+ pre-configured device profiles","Temperature and humidity sensor integration","HVAC mode control (heat, cool, auto, dry, fan)"]}}:_.value),M=X(()=>{var u,l;return((l=(u=J.value)==null?void 0:u.platforms)==null?void 0:l.length)||0}),B=X(()=>{var u;return(u=J.value)!=null&&u.device_counts?Object.values(J.value.device_counts).reduce((l,H)=>l+H,0):0});function se(){var u;L.value=!L.value,localStorage.setItem("smartir_simulate_not_installed",L.value.toString()),!L.value&&((u=_.value)!=null&&u.installed)&&K()}const fe=X(()=>{let u=z.value;if(x.value.search){const l=x.value.search.toLowerCase();u=u.filter(H=>{var Q,re,ie,_e;return((Q=H.manufacturer)==null?void 0:Q.toLowerCase().includes(l))||((re=H.model)==null?void 0:re.toLowerCase().includes(l))||((ie=H.code)==null?void 0:ie.toString().includes(l))||((_e=H.platform)==null?void 0:_e.toLowerCase().includes(l))})}return x.value.platform&&(u=u.filter(l=>l.platform===x.value.platform)),u}),Ee=X(()=>x.value.search||x.value.platform),Ae=X(()=>{let u=0;return x.value.search&&u++,x.value.platform&&u++,u});function Le(){x.value.search="",x.value.platform=""}async function Te(){f.value=!0,S.value=null;try{if(s)await s();else{const u=await ut.getStatus();_.value=u}}catch(u){S.value=u.message||"Failed to refresh SmartIR status",console.error("Error refreshing SmartIR status:",u)}finally{f.value=!1}}function Y(){k("create-profile")}function R(){w.value=!w.value,n.value=!1}function te(){V.value||(V.value=!0),n.value=!n.value}function q(){b.value=!0,n.value=!1}function F(){window.open("https://github.com/smartHomeHub/SmartIR","_blank")}async function K(){N.value=!0;const u=[];try{for(const l of ne)try{const Q=((await oe.get(`/api/smartir/platforms/${l}/profiles`)).data.profiles||[]).map(re=>({...re,platform:l}));u.push(...Q)}catch(H){console.warn(`Network error loading ${l} profiles (using bundled index):`,H.message)}z.value=u}catch(l){console.error("Unexpected error loading profiles:",l)}finally{N.value=!1}}function ce(u,l,H){k("edit-profile",{platform:u,profile:l,startStep:H})}async function Ve(u,l){var H,Q;try{const ie=(await oe.get(`/api/smartir/platforms/${u}/profiles/${l.code}`)).data,_e=JSON.stringify(ie.profile,null,2),ge=new Blob([_e],{type:"application/json"}),Ie=URL.createObjectURL(ge),I=document.createElement("a");I.href=Ie,I.download=`smartir_${u}_${l.manufacturer}_${l.model}_${l.code}.json`,document.body.appendChild(I),I.click(),document.body.removeChild(I),URL.revokeObjectURL(Ie),(H=Pe("toast").value)==null||H.success(`Downloaded ${l.manufacturer} ${l.model}`,"âœ… Profile Downloaded")}catch(re){console.error("Error downloading profile:",re),(Q=Pe("toast").value)==null||Q.error("Failed to download profile","âŒ Download Error")}}const Me=u=>{u.target.closest(".settings-container")||(n.value=!1)};Oe(()=>{document.addEventListener("click",Me)}),qe(()=>{document.removeEventListener("click",Me)});async function ee(u,l){Pe("toast");try{const Q=(await oe.post(`/api/smartir/profiles/${l.code}/check-usage`,{platform:u})).data;if(Q&&Q.in_use){o.value={show:!0,title:`Cannot Delete ${l.manufacturer} ${l.model}`,message:`This profile is currently in use by ${Q.device_count} device(s):

${Q.devices.join(`
`)}

Please remove or reassign these devices before deleting the profile.`,platform:u,profile:l,canDelete:!1,devices:Q.devices};return}}catch(H){console.error("Error checking profile usage:",H)}o.value={show:!0,title:`Delete ${l.manufacturer} ${l.model}?`,message:`Device Code: ${l.code}

This will remove the profile and update your configuration.`,platform:u,profile:l,canDelete:!0}}async function y(){var Q,re;const u=Pe("toast"),{platform:l,profile:H}=o.value;o.value.show=!1;try{await oe.delete(`/api/smartir/profiles/${H.code}`,{data:{platform:l}}),await K(),await at(),await Te(),(Q=u.value)==null||Q.success(`${H.manufacturer} ${H.model} has been removed`,"âœ… Profile Deleted")}catch(ie){console.error("Error deleting profile:",ie),(re=u.value)==null||re.error("Failed to delete profile","âŒ Delete Error")}}return ue($,u=>{u&&(_.value=u)},{immediate:!0}),ue(p,u=>{localStorage.setItem("profile_view_mode",u)}),Oe(async()=>{var u;$!=null&&$.value&&(_.value=$.value),_.value||await Te(),(u=_.value)!=null&&u.installed&&await K()}),c({loadAllProfiles:K,refreshStatus:Te}),(u,l)=>{var H,Q,re,ie,_e,ge,Ie,I,d;return a(),r("div",Si,[e("div",Ii,[e("button",{class:"icon-button chevron-button",onClick:l[0]||(l[0]=C=>V.value=!V.value)},[e("i",{class:G(["mdi",V.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2)]),e("div",{class:"header-left",onClick:l[1]||(l[1]=C=>V.value=!V.value)},[e("img",{src:xe(Qe),alt:"SmartIR",class:"smartir-logo"},null,8,Di),e("h3",null,v(xe(m)?"SmartIR":"SmartIR Integration"),1),e("div",xi,[e("div",{class:G(["simulation-toggle-pill",{active:L.value}]),onClick:be(se,["stop"]),title:L.value?"Click to show as installed":"Click to simulate not-installed"},[e("i",{class:G(["mdi",L.value?"mdi-eye-off":"mdi-eye"])},null,2),e("span",null,v(L.value?"Simulating: Not Installed":"Simulation Mode"),1)],10,Ti),(H=J.value)!=null&&H.installed?(a(),r(he,{key:0},[l[16]||(l[16]=e("div",{class:"status-badge-mini success"},[e("i",{class:"mdi mdi-check-circle"}),e("span",null,"Installed")],-1)),e("span",Mi,"v"+v(J.value.version||"Unknown"),1),e("span",Ri,v(M.value)+" platform"+v(M.value!==1?"s":""),1),e("span",Ei,v(B.value)+" device"+v(B.value!==1?"s":""),1)],64)):A("",!0)])]),e("div",Oi,[!xe(m)&&((Q=J.value)!=null&&Q.installed)?(a(),r("div",Ai,[e("button",{onClick:l[2]||(l[2]=be(C=>p.value="grid",["stop"])),class:G(["view-toggle-btn",{active:p.value==="grid"}]),title:"Grid View"},[...l[17]||(l[17]=[e("i",{class:"mdi mdi-view-grid"},null,-1)])],2),e("button",{onClick:l[3]||(l[3]=be(C=>p.value="list",["stop"])),class:G(["view-toggle-btn",{active:p.value==="list"}]),title:"List View"},[...l[18]||(l[18]=[e("i",{class:"mdi mdi-view-list"},null,-1)])],2)])):A("",!0),(re=J.value)!=null&&re.installed?(a(),r("button",{key:1,onClick:be(Y,["stop"]),class:"btn btn-primary new-button"},[...l[19]||(l[19]=[e("i",{class:"mdi mdi-plus"},null,-1),e("span",null,"New",-1)])])):A("",!0),(ie=J.value)!=null&&ie.installed?(a(),r("div",Li,[e("button",{onClick:be(te,["stop"]),class:G(["icon-button settings-button",{active:n.value}]),title:"Settings"},[...l[20]||(l[20]=[e("i",{class:"mdi mdi-cog"},null,-1)])],2),n.value?(a(),r("div",{key:0,class:"settings-dropdown",onClick:l[5]||(l[5]=be(()=>{},["stop"]))},[e("button",{onClick:R,class:"menu-item"},[l[21]||(l[21]=e("i",{class:"mdi mdi-help-circle"},null,-1)),e("span",null,v(w.value?"Hide Help":"Show Help"),1)]),e("button",{onClick:l[4]||(l[4]=C=>{n.value=!1,Te()}),class:"menu-item"},[...l[22]||(l[22]=[e("i",{class:"mdi mdi-refresh"},null,-1),e("span",null,"Refresh Status",-1)])]),e("button",{onClick:q,class:"menu-item"},[...l[23]||(l[23]=[e("i",{class:"mdi mdi-test-tube"},null,-1),e("span",null,"Test Codes",-1)])])])):A("",!0)])):A("",!0)])]),W(e("div",null,[f.value?(a(),r("div",Pi,[...l[24]||(l[24]=[e("div",{class:"spinner"},null,-1),e("p",null,"Checking SmartIR installation...",-1)])])):S.value?(a(),r("div",Vi,[l[25]||(l[25]=e("i",{class:"mdi mdi-alert-circle"},null,-1)),e("p",null,v(S.value),1),e("button",{onClick:Te,class:"btn-secondary"}," Try Again ")])):(_e=J.value)!=null&&_e.installed?(a(),r("div",ji,[w.value?(a(),r("div",Ui,[_.value.recommendation?(a(),r("div",Fi,[e("p",null,v(_.value.recommendation.message),1),_.value.recommendation.next_steps?(a(),r("div",Ni,[l[26]||(l[26]=e("strong",null,"Next Steps:",-1)),e("ul",null,[(a(!0),r(he,null,Ce(_.value.recommendation.next_steps,(C,U)=>(a(),r("li",{key:U},v(C),1))),128))])])):A("",!0)])):A("",!0),e("div",Bi,[e("button",{onClick:l[6]||(l[6]=(...C)=>u.viewDocumentation&&u.viewDocumentation(...C)),class:"btn-secondary"},[...l[27]||(l[27]=[e("i",{class:"mdi mdi-book-open-variant"},null,-1),T(" View Documentation ",-1)])])])])):A("",!0),z.value.length>0&&!L.value?(a(),r("div",Hi,[e("div",qi,[e("button",{class:G(["filter-toggle-button",{active:E.value||Ee.value}]),onClick:l[7]||(l[7]=C=>E.value=!E.value),title:E.value?"Hide filters":"Show filters"},[l[28]||(l[28]=e("i",{class:"mdi mdi-filter-variant"},null,-1)),Ee.value?(a(),r("span",Ji,v(Ae.value),1)):A("",!0)],10,zi),e("div",Wi,[l[29]||(l[29]=e("i",{class:"mdi mdi-magnify search-icon"},null,-1)),W(e("input",{"onUpdate:modelValue":l[8]||(l[8]=C=>x.value.search=C),type:"text",placeholder:"Search profiles...",class:"search-input"},null,512),[[je,x.value.search]])])]),W(e("div",Gi,[e("div",Ki,[e("div",Xi,[e("label",null,[l[31]||(l[31]=e("i",{class:"mdi mdi-shape"},null,-1)),W(e("select",{"onUpdate:modelValue":l[9]||(l[9]=C=>x.value.platform=C)},[...l[30]||(l[30]=[ze('<option value="" data-v-d3566817>All Platforms</option><option value="climate" data-v-d3566817>Climate</option><option value="media_player" data-v-d3566817>Media Player</option><option value="fan" data-v-d3566817>Fan</option><option value="light" data-v-d3566817>Light</option>',5)])],512),[[Re,x.value.platform]])])]),Ee.value?(a(),r("button",{key:0,onClick:Le,class:"btn-clear-filters"},[...l[32]||(l[32]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),T(" Clear ",-1)])])):A("",!0),e("div",Yi,v(fe.value.length)+" of "+v(z.value.length),1)])],512),[[Ye,E.value]])])):A("",!0),N.value?(a(),r("div",Zi,[...l[33]||(l[33]=[e("i",{class:"mdi mdi-loading mdi-spin"},null,-1),e("p",null,"Loading profiles...",-1)])])):z.value.length===0?(a(),r("div",Qi,[...l[34]||(l[34]=[e("i",{class:"mdi mdi-file-document-outline"},null,-1),e("h3",null,"No Profiles Yet",-1),e("p",null,"Create your first SmartIR profile to get started",-1)])])):A("",!0),p.value==="grid"&&!L.value?(a(),r("div",er,[(a(!0),r(he,null,Ce(fe.value,C=>(a(),Ne(_a,{key:`${C.platform}-${C.code}`,profile:C,onEdit:U=>ce(C.platform,C),onCommands:U=>ce(C.platform,C,1),onDownload:U=>Ve(C.platform,C),onDelete:U=>ee(C.platform,C)},null,8,["profile","onEdit","onCommands","onDownload","onDelete"]))),128))])):p.value==="list"&&!L.value&&fe.value.length>0?(a(),Ne(Wa,{key:5,profiles:fe.value,onEdit:l[10]||(l[10]=C=>ce(C.platform,C)),onCommands:l[11]||(l[11]=C=>ce(C.platform,C,1)),onDownload:l[12]||(l[12]=C=>Ve(C.platform,C)),onDelete:l[13]||(l[13]=C=>ee(C.platform,C))},null,8,["profiles"])):A("",!0),z.value.length>0&&fe.value.length===0&&!L.value?(a(),r("div",tr,[...l[35]||(l[35]=[e("i",{class:"mdi mdi-filter-off"},null,-1),e("h3",null,"No profiles match your filters",-1),e("p",null,"Try adjusting your search or filter criteria",-1)])])):A("",!0)])):(a(),r("div",or,[l[39]||(l[39]=e("div",{class:"status-badge warning"},[e("i",{class:"mdi mdi-information"}),e("span",null,"Not Installed")],-1)),e("div",lr,[l[37]||(l[37]=e("h4",null,"Why Install SmartIR?",-1)),e("ul",nr,[(a(!0),r(he,null,Ce(((Ie=(ge=_.value)==null?void 0:ge.recommendation)==null?void 0:Ie.benefits)||Z,(C,U)=>(a(),r("li",{key:U},[l[36]||(l[36]=e("i",{class:"mdi mdi-check"},null,-1)),e("span",null,v(C),1)]))),128))])]),e("div",sr,[e("p",null,v(((d=(I=_.value)==null?void 0:I.recommendation)==null?void 0:d.message)||"Install SmartIR to unlock climate device support!"),1)]),e("div",{class:"card-actions"},[e("button",{onClick:F,class:"btn-primary"},[...l[38]||(l[38]=[e("i",{class:"mdi mdi-github"},null,-1),T(" Install SmartIR ",-1)])])])]))],512),[[Ye,V.value]]),ke(He,{isOpen:o.value.show,title:o.value.title,message:o.value.message,confirmText:o.value.canDelete===!1?null:"Delete",cancelText:"Close",dangerMode:!0,confirmDisabled:o.value.canDelete===!1,onConfirm:y,onCancel:l[14]||(l[14]=C=>o.value.show=!1)},null,8,["isOpen","title","message","confirmText","confirmDisabled"]),ke(_i,{isOpen:b.value,onClose:l[15]||(l[15]=C=>b.value=!1)},null,8,["isOpen"])])}}},ir=De(ar,[["__scopeId","data-v-d3566817"]]),rr={class:"climate-form"},dr={class:"learning-mode-section"},ur={class:"mode-toggle"},cr={class:"mode-content"},mr={class:"mode-stats"},vr={class:"stat-badge"},pr={class:"stat-badge time"},fr={class:"mode-content"},gr={class:"mode-stats"},yr={class:"stat-badge"},br={class:"stat-badge time warning"},hr={key:0,class:"command-breakdown"},kr={class:"warning-text"},wr={class:"form-section"},$r={key:0,class:"help-text"},Cr={key:1,class:"help-text"},_r={class:"form-row"},Sr={class:"form-group"},Ir={class:"form-group"},Dr={class:"form-group"},xr={key:2,class:"representative-temp-section"},Tr={class:"form-group"},Mr=["value"],Rr={class:"form-section"},Er={class:"checkbox-grid"},Or={class:"checkbox-item"},Ar={class:"checkbox-item"},Lr={class:"checkbox-item"},Pr={class:"checkbox-item"},Vr={class:"checkbox-item"},jr={class:"checkbox-item"},Ur={class:"form-section"},Fr={class:"checkbox-grid"},Nr={class:"checkbox-item"},Br={class:"checkbox-item"},Hr={class:"checkbox-item"},qr={class:"checkbox-item"},zr={class:"form-section"},Jr={class:"checkbox-grid"},Wr={class:"checkbox-item"},Gr={class:"checkbox-item"},Kr={class:"checkbox-item"},Xr={class:"checkbox-item"},Yr={class:"form-section"},Zr={class:"checkbox-grid"},Qr={class:"checkbox-item"},ed={class:"checkbox-item"},td={class:"checkbox-item"},od={class:"checkbox-item"},ld={class:"checkbox-item"},nd={class:"checkbox-item"},sd={class:"form-section"},ad={class:"form-group"},id={class:"form-group"},rd={class:"form-group"},dd={key:0,class:"validation-summary"},ud={__name:"ClimateProfileForm",props:{modelValue:{type:Object,default:()=>({})}},emits:["update:modelValue"],setup(t,{emit:c}){const i=t,k=c,$=g("quick"),s=g({minTemp:16,maxTemp:30,precision:1,representativeTemp:24,modes:["off","auto","cool","heat"],fanModes:["auto","low","medium","high"],swingModes:[],presetModes:[],tempSensor:"",humiditySensor:"",powerSensor:"",learningMode:"quick",...i.modelValue}),m=X(()=>{const x=[],o=s.value.minTemp||16,b=s.value.maxTemp||30,P=s.value.precision||1;for(let p=o;p<=b;p+=P)x.push(p);return x}),f=X(()=>s.value.modes.filter(x=>x!=="off").length),S=X(()=>s.value.fanModes.length||1),_=X(()=>s.value.swingModes.length||1),L=X(()=>s.value.presetModes.length||1),w=X(()=>{const x=s.value.minTemp||16,o=s.value.maxTemp||30,b=s.value.precision||1;return Math.floor((o-x)/b)+1}),n=X(()=>{const x=s.value.modes.includes("off")?1:0;return f.value*S.value*_.value*L.value+x}),V=X(()=>Math.ceil(n.value*30/60)),z=X(()=>{const x=s.value.modes.includes("off")?1:0;return f.value*w.value*S.value*_.value*L.value+x}),N=X(()=>Math.ceil(z.value*30/60)),E=X(()=>{const x=[];return(!s.value.minTemp||s.value.minTemp<10||s.value.minTemp>35)&&x.push("Minimum temperature must be between 10Â°C and 35Â°C"),(!s.value.maxTemp||s.value.maxTemp<10||s.value.maxTemp>35)&&x.push("Maximum temperature must be between 10Â°C and 35Â°C"),s.value.minTemp>=s.value.maxTemp&&x.push("Minimum temperature must be less than maximum temperature"),(!s.value.modes||s.value.modes.length===0)&&x.push("At least one HVAC mode must be selected"),x});return ue($,x=>{s.value.learningMode=x}),ue(s,x=>{k("update:modelValue",x)},{deep:!0,immediate:!0}),(x,o)=>(a(),r("div",rr,[o[77]||(o[77]=e("h3",null,"Climate Device Configuration",-1)),e("div",dr,[e("div",ur,[e("label",{class:G(["mode-option",{active:$.value==="quick"}])},[W(e("input",{type:"radio",value:"quick","onUpdate:modelValue":o[0]||(o[0]=b=>$.value=b)},null,512),[[Je,$.value]]),e("div",cr,[o[29]||(o[29]=e("div",{class:"mode-header"},[e("i",{class:"mdi mdi-flash"}),e("strong",null,"Quick Mode (Recommended)")],-1)),o[30]||(o[30]=e("p",null,"Learn one temperature per mode combination",-1)),e("div",mr,[e("span",vr,v(n.value)+" commands",1),e("span",pr,"~"+v(V.value)+" min",1)])])],2),e("label",{class:G(["mode-option",{active:$.value==="complete"}])},[W(e("input",{type:"radio",value:"complete","onUpdate:modelValue":o[1]||(o[1]=b=>$.value=b)},null,512),[[Je,$.value]]),e("div",fr,[o[31]||(o[31]=e("div",{class:"mode-header"},[e("i",{class:"mdi mdi-check-all"}),e("strong",null,"Complete Mode")],-1)),o[32]||(o[32]=e("p",null,"Learn all temperature combinations",-1)),e("div",gr,[e("span",yr,v(z.value)+" commands",1),e("span",br,"~"+v(N.value)+" min",1)])])],2)]),$.value==="complete"?(a(),r("div",hr,[o[33]||(o[33]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[e("strong",null,"Complete mode will require learning "+v(z.value)+" commands",1),e("p",null,"This includes all combinations of modes ("+v(f.value)+"), temperatures ("+v(w.value)+"), fan speeds ("+v(S.value)+"), swing modes ("+v(_.value)+"), and preset modes ("+v(L.value)+").",1),e("p",kr,"â±ï¸ Estimated time: "+v(N.value)+" minutes at ~30 seconds per command",1)])])):A("",!0)]),e("div",wr,[o[39]||(o[39]=e("h4",null,"Temperature Range",-1)),$.value==="quick"?(a(),r("p",$r," Define the full temperature range your device supports. You'll select one temperature to learn below. ")):(a(),r("p",Cr," Define the temperature range. All temperatures in this range will be learned. ")),e("div",_r,[e("div",Sr,[o[34]||(o[34]=e("label",null,"Minimum Temperature (Â°C) *",-1)),W(e("input",{"onUpdate:modelValue":o[2]||(o[2]=b=>s.value.minTemp=b),type:"number",min:"10",max:"35",placeholder:"16"},null,512),[[je,s.value.minTemp,void 0,{number:!0}]])]),e("div",Ir,[o[35]||(o[35]=e("label",null,"Maximum Temperature (Â°C) *",-1)),W(e("input",{"onUpdate:modelValue":o[3]||(o[3]=b=>s.value.maxTemp=b),type:"number",min:"10",max:"35",placeholder:"30"},null,512),[[je,s.value.maxTemp,void 0,{number:!0}]])]),e("div",Dr,[o[37]||(o[37]=e("label",null,"Precision",-1)),W(e("select",{"onUpdate:modelValue":o[4]||(o[4]=b=>s.value.precision=b)},[...o[36]||(o[36]=[e("option",{value:1},"1Â°C (Whole degrees)",-1),e("option",{value:.5},"0.5Â°C (Half degrees)",-1)])],512),[[Re,s.value.precision,void 0,{number:!0}]])])]),$.value==="quick"?(a(),r("div",xr,[e("div",Tr,[o[38]||(o[38]=e("label",null,"Representative Temperature to Learn *",-1)),W(e("select",{"onUpdate:modelValue":o[5]||(o[5]=b=>s.value.representativeTemp=b)},[(a(!0),r(he,null,Ce(m.value,b=>(a(),r("option",{key:b,value:b},v(b)+"Â°C ",9,Mr))),128))],512),[[Re,s.value.representativeTemp,void 0,{number:!0}]]),e("small",null,"This temperature will be learned for all mode combinations. The device profile will still show the full range ("+v(s.value.minTemp)+"Â°C - "+v(s.value.maxTemp)+"Â°C).",1)])])):A("",!0)]),e("div",Rr,[o[46]||(o[46]=e("h4",null,"Supported HVAC Modes *",-1)),o[47]||(o[47]=e("p",{class:"help-text"},"Select all modes your device supports",-1)),e("div",Er,[e("label",Or,[W(e("input",{type:"checkbox",value:"off","onUpdate:modelValue":o[6]||(o[6]=b=>s.value.modes=b)},null,512),[[me,s.value.modes]]),o[40]||(o[40]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),T(" Off ")],-1))]),e("label",Ar,[W(e("input",{type:"checkbox",value:"auto","onUpdate:modelValue":o[7]||(o[7]=b=>s.value.modes=b)},null,512),[[me,s.value.modes]]),o[41]||(o[41]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-autorenew"}),T(" Auto ")],-1))]),e("label",Lr,[W(e("input",{type:"checkbox",value:"cool","onUpdate:modelValue":o[8]||(o[8]=b=>s.value.modes=b)},null,512),[[me,s.value.modes]]),o[42]||(o[42]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-snowflake"}),T(" Cool ")],-1))]),e("label",Pr,[W(e("input",{type:"checkbox",value:"heat","onUpdate:modelValue":o[9]||(o[9]=b=>s.value.modes=b)},null,512),[[me,s.value.modes]]),o[43]||(o[43]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fire"}),T(" Heat ")],-1))]),e("label",Vr,[W(e("input",{type:"checkbox",value:"dry","onUpdate:modelValue":o[10]||(o[10]=b=>s.value.modes=b)},null,512),[[me,s.value.modes]]),o[44]||(o[44]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-water-percent"}),T(" Dry ")],-1))]),e("label",jr,[W(e("input",{type:"checkbox",value:"fan_only","onUpdate:modelValue":o[11]||(o[11]=b=>s.value.modes=b)},null,512),[[me,s.value.modes]]),o[45]||(o[45]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan"}),T(" Fan Only ")],-1))])])]),e("div",Ur,[o[52]||(o[52]=e("h4",null,"Fan Modes",-1)),o[53]||(o[53]=e("p",{class:"help-text"},"Select all fan speeds your device supports",-1)),e("div",Fr,[e("label",Nr,[W(e("input",{type:"checkbox",value:"auto","onUpdate:modelValue":o[12]||(o[12]=b=>s.value.fanModes=b)},null,512),[[me,s.value.fanModes]]),o[48]||(o[48]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-autorenew"}),T(" Auto ")],-1))]),e("label",Br,[W(e("input",{type:"checkbox",value:"low","onUpdate:modelValue":o[13]||(o[13]=b=>s.value.fanModes=b)},null,512),[[me,s.value.fanModes]]),o[49]||(o[49]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-1"}),T(" Low ")],-1))]),e("label",Hr,[W(e("input",{type:"checkbox",value:"medium","onUpdate:modelValue":o[14]||(o[14]=b=>s.value.fanModes=b)},null,512),[[me,s.value.fanModes]]),o[50]||(o[50]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-2"}),T(" Medium ")],-1))]),e("label",qr,[W(e("input",{type:"checkbox",value:"high","onUpdate:modelValue":o[15]||(o[15]=b=>s.value.fanModes=b)},null,512),[[me,s.value.fanModes]]),o[51]||(o[51]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-3"}),T(" High ")],-1))])])]),e("div",zr,[o[58]||(o[58]=e("h4",null,"Swing Modes (Optional)",-1)),o[59]||(o[59]=e("p",{class:"help-text"},"Select if your device has swing/oscillation",-1)),e("div",Jr,[e("label",Wr,[W(e("input",{type:"checkbox",value:"off","onUpdate:modelValue":o[16]||(o[16]=b=>s.value.swingModes=b)},null,512),[[me,s.value.swingModes]]),o[54]||(o[54]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-horizontal"}),T(" Off ")],-1))]),e("label",Gr,[W(e("input",{type:"checkbox",value:"vertical","onUpdate:modelValue":o[17]||(o[17]=b=>s.value.swingModes=b)},null,512),[[me,s.value.swingModes]]),o[55]||(o[55]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-vertical"}),T(" Vertical ")],-1))]),e("label",Kr,[W(e("input",{type:"checkbox",value:"horizontal","onUpdate:modelValue":o[18]||(o[18]=b=>s.value.swingModes=b)},null,512),[[me,s.value.swingModes]]),o[56]||(o[56]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-horizontal"}),T(" Horizontal ")],-1))]),e("label",Xr,[W(e("input",{type:"checkbox",value:"both","onUpdate:modelValue":o[19]||(o[19]=b=>s.value.swingModes=b)},null,512),[[me,s.value.swingModes]]),o[57]||(o[57]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-arrow-all"}),T(" Both ")],-1))])])]),e("div",Yr,[o[66]||(o[66]=e("h4",null,"Preset Modes (Optional)",-1)),o[67]||(o[67]=e("p",{class:"help-text"},"Select special modes your device supports",-1)),e("div",Zr,[e("label",Qr,[W(e("input",{type:"checkbox",value:"none","onUpdate:modelValue":o[20]||(o[20]=b=>s.value.presetModes=b)},null,512),[[me,s.value.presetModes]]),o[60]||(o[60]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-circle-outline"}),T(" None ")],-1))]),e("label",ed,[W(e("input",{type:"checkbox",value:"eco","onUpdate:modelValue":o[21]||(o[21]=b=>s.value.presetModes=b)},null,512),[[me,s.value.presetModes]]),o[61]||(o[61]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-leaf"}),T(" Eco ")],-1))]),e("label",td,[W(e("input",{type:"checkbox",value:"boost","onUpdate:modelValue":o[22]||(o[22]=b=>s.value.presetModes=b)},null,512),[[me,s.value.presetModes]]),o[62]||(o[62]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-rocket-launch"}),T(" Boost ")],-1))]),e("label",od,[W(e("input",{type:"checkbox",value:"sleep","onUpdate:modelValue":o[23]||(o[23]=b=>s.value.presetModes=b)},null,512),[[me,s.value.presetModes]]),o[63]||(o[63]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power-sleep"}),T(" Sleep ")],-1))]),e("label",ld,[W(e("input",{type:"checkbox",value:"away","onUpdate:modelValue":o[24]||(o[24]=b=>s.value.presetModes=b)},null,512),[[me,s.value.presetModes]]),o[64]||(o[64]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-home-export-outline"}),T(" Away ")],-1))]),e("label",nd,[W(e("input",{type:"checkbox",value:"comfort","onUpdate:modelValue":o[25]||(o[25]=b=>s.value.presetModes=b)},null,512),[[me,s.value.presetModes]]),o[65]||(o[65]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-sofa"}),T(" Comfort ")],-1))])])]),e("div",sd,[o[74]||(o[74]=e("h4",null,"Sensors (Optional)",-1)),o[75]||(o[75]=e("p",{class:"help-text"},"Link external sensors for better climate control",-1)),e("div",ad,[o[68]||(o[68]=e("label",null,"Temperature Sensor",-1)),W(e("input",{"onUpdate:modelValue":o[26]||(o[26]=b=>s.value.tempSensor=b),type:"text",placeholder:"sensor.living_room_temperature"},null,512),[[je,s.value.tempSensor]]),o[69]||(o[69]=e("small",null,"Entity ID of temperature sensor",-1))]),e("div",id,[o[70]||(o[70]=e("label",null,"Humidity Sensor",-1)),W(e("input",{"onUpdate:modelValue":o[27]||(o[27]=b=>s.value.humiditySensor=b),type:"text",placeholder:"sensor.living_room_humidity"},null,512),[[je,s.value.humiditySensor]]),o[71]||(o[71]=e("small",null,"Entity ID of humidity sensor",-1))]),e("div",rd,[o[72]||(o[72]=e("label",null,"Power Sensor",-1)),W(e("input",{"onUpdate:modelValue":o[28]||(o[28]=b=>s.value.powerSensor=b),type:"text",placeholder:"binary_sensor.ac_power"},null,512),[[je,s.value.powerSensor]]),o[73]||(o[73]=e("small",null,"Entity ID of power sensor (to detect on/off state)",-1))])]),E.value.length>0?(a(),r("div",dd,[o[76]||(o[76]=e("h4",null,[e("i",{class:"mdi mdi-alert-circle"}),T(" Please fix the following: ")],-1)),e("ul",null,[(a(!0),r(he,null,Ce(E.value,(b,P)=>(a(),r("li",{key:P},v(b),1))),128))])])):A("",!0)]))}},cd=De(ud,[["__scopeId","data-v-e22a3983"]]),md={class:"command-wizard"},vd={class:"device-selection-section"},pd={class:"input-wrapper"},fd=["value"],gd={key:0,class:"validation-tooltip"},yd={class:"form-group"},bd=["disabled"],hd={key:0},kd={key:1},wd={key:0,class:"edit-mode-banner"},$d={class:"wizard-info"},Cd={key:0},_d={key:1},Sd={class:"progress-info"},Id={class:"progress-bar"},Dd={class:"progress-text"},xd={class:"commands-grid"},Td={class:"command-header"},Md={class:"command-icon"},Rd={class:"command-info"},Ed={key:0,class:"learning-indicator"},Od={key:0,class:"ir-learning-steps"},Ad={key:1,class:"rf-learning-steps"},Ld={class:"command-actions"},Pd=["onClick","disabled"],Vd=["onClick","disabled"],jd=["onClick"],Ud={class:"quick-actions"},Fd=["disabled"],Nd=["disabled"],Bd={__name:"CommandLearningWizard",props:{modelValue:{type:Object,default:()=>({})},platform:{type:String,required:!0},config:{type:Object,required:!0},broadlinkDevice:{type:String,default:""},manufacturer:{type:String,required:!0},model:{type:String,required:!0},commandType:{type:String,default:"ir"}},emits:["update:modelValue","update:broadlinkDevice","update:commandType"],setup(t,{emit:c}){const i=Ge(),k=t,$=c,s=g({...k.modelValue}),m=g(null),f=g(null),S=g([]),_=g(k.broadlinkDevice),L=g(k.commandType),w=g(!1),n=g([]),V=g(!1),z=g(!1),N=g({show:!1,commandKey:null,commandLabel:""}),E=g(!1),x=g(null),o=X(()=>{console.log("ğŸ® CommandList computed - platform:",k.platform,"config:",k.config);const q=[];if(k.platform==="climate"){const F=k.config.modes||[],K=k.config.fanModes||[],ce=k.config.swingModes||[],Ve=k.config.presetModes||[],Me=k.config.minTemp||16,ee=k.config.maxTemp||30,y=F.includes("off"),u=k.modelValue&&k.modelValue.off;!y&&u&&q.push({key:"off",label:"Power Off",description:"Turn device off (standalone command)",icon:"mdi mdi-power",mode:"off"}),F.forEach(l=>{if(l==="off")q.push({key:"off",label:"Power Off",description:"Turn device off",icon:"mdi mdi-power",mode:"off"});else for(let H=Me;H<=ee;H++)K.forEach(Q=>{(ce.length>0?ce:[null]).forEach(ie=>{(Ve.length>0?Ve:[null]).forEach(ge=>{let Ie=`${l}_${H}_${Q}`,I=`${l.toUpperCase()} ${H}Â°C ${Q}`,d=`Mode: ${l}, Temp: ${H}Â°C, Fan: ${Q}`;ie&&(Ie+=`_${ie}`,I+=` ${ie}`,d+=`, Swing: ${ie}`),ge&&(Ie+=`_${ge}`,I+=` [${ge}]`,d+=`, Preset: ${ge}`),q.push({key:Ie,label:I,description:d,icon:Z(l),mode:l,temp:H,fanMode:Q,swingMode:ie,presetMode:ge})})})})})}else if(k.platform==="media_player"){const F=k.config.features||[];console.log("ğŸ“º Media player - config.features:",k.config.features,"features array:",F,"features length:",F.length),F.includes("turn_on")&&(q.push({key:"turn_on",label:"Power On",description:"Turn on the device",icon:"mdi mdi-power"}),q.push({key:"turn_off",label:"Power Off",description:"Turn off the device",icon:"mdi mdi-power-off"})),F.includes("volume")&&(q.push({key:"volume_up",label:"Volume Up",description:"Increase volume",icon:"mdi mdi-volume-plus"}),q.push({key:"volume_down",label:"Volume Down",description:"Decrease volume",icon:"mdi mdi-volume-minus"})),F.includes("mute")&&q.push({key:"mute",label:"Mute",description:"Toggle mute",icon:"mdi mdi-volume-mute"}),F.includes("source")&&(q.push({key:"source_hdmi1",label:"Source: HDMI 1",description:"Switch to HDMI 1",icon:"mdi mdi-import"}),q.push({key:"source_hdmi2",label:"Source: HDMI 2",description:"Switch to HDMI 2",icon:"mdi mdi-import"}),q.push({key:"source_hdmi3",label:"Source: HDMI 3",description:"Switch to HDMI 3",icon:"mdi mdi-import"})),F.includes("channel")&&(q.push({key:"channel_up",label:"Channel Up",description:"Next channel",icon:"mdi mdi-chevron-up"}),q.push({key:"channel_down",label:"Channel Down",description:"Previous channel",icon:"mdi mdi-chevron-down"}))}else if(k.platform==="fan"){const F=k.config.speedLevels||3,K=k.config.features||[];q.push({key:"turn_on",label:"Power On",description:"Turn on the fan",icon:"mdi mdi-power"}),q.push({key:"turn_off",label:"Power Off",description:"Turn off the fan",icon:"mdi mdi-power-off"});for(let ce=1;ce<=F;ce++){const Ve=ce===1?"Low":ce===F?"High":ce===2&&F===3?"Medium":`Speed ${ce}`;q.push({key:`speed_${ce}`,label:`${Ve}`,description:`Set fan to speed level ${ce}`,icon:"mdi mdi-fan"})}K.includes("oscillate")&&(q.push({key:"oscillate_on",label:"Oscillate On",description:"Enable oscillation",icon:"mdi mdi-sync"}),q.push({key:"oscillate_off",label:"Oscillate Off",description:"Disable oscillation",icon:"mdi mdi-sync-off"})),K.includes("direction")&&(q.push({key:"direction_forward",label:"Direction: Forward",description:"Set direction to forward",icon:"mdi mdi-rotate-right"}),q.push({key:"direction_reverse",label:"Direction: Reverse",description:"Set direction to reverse",icon:"mdi mdi-rotate-left"}))}else if(k.platform==="light"){const F=k.config.features||[];F.includes("turn_on")&&(q.push({key:"turn_on",label:"Power On",description:"Turn on the light",icon:"mdi mdi-lightbulb-on"}),q.push({key:"turn_off",label:"Power Off",description:"Turn off the light",icon:"mdi mdi-lightbulb-off"})),F.includes("brightness")&&(q.push({key:"brightness_up",label:"Brightness Up",description:"Increase brightness",icon:"mdi mdi-brightness-7"}),q.push({key:"brightness_down",label:"Brightness Down",description:"Decrease brightness",icon:"mdi mdi-brightness-5"})),F.includes("color_temp")&&(q.push({key:"color_temp_warm",label:"Warm White",description:"Set to warm white",icon:"mdi mdi-weather-sunset"}),q.push({key:"color_temp_cool",label:"Cool White",description:"Set to cool white",icon:"mdi mdi-weather-sunny"})),F.includes("rgb")&&(q.push({key:"color_red",label:"Color: Red",description:"Set color to red",icon:"mdi mdi-palette"}),q.push({key:"color_green",label:"Color: Green",description:"Set color to green",icon:"mdi mdi-palette"}),q.push({key:"color_blue",label:"Color: Blue",description:"Set color to blue",icon:"mdi mdi-palette"}))}return q}),b=X(()=>o.value.length),P=X(()=>Object.keys(s.value).length),p=X(()=>b.value===0?0:Math.round(P.value/b.value*100));function Z(q){return{off:"mdi mdi-power",auto:"mdi mdi-autorenew",cool:"mdi mdi-snowflake",heat:"mdi mdi-fire",dry:"mdi mdi-water-percent",fan_only:"mdi mdi-fan"}[q]||"mdi mdi-remote"}async function ne(q){if(!m.value){if(!_.value){z.value=!0,window.scrollTo({top:0,behavior:"smooth"});return}z.value=!1,m.value=q.key;try{const F=k.manufacturer.toLowerCase().replace(/[^a-z0-9]+/g,"_"),K=k.model.toLowerCase().replace(/[^a-z0-9]+/g,"_"),ce=`${F}_${K}`,Me=(await oe.post("/api/commands/learn",{entity_id:_.value,device:ce,command:q.key,command_type:L.value})).data;if(Me.success&&Me.code)s.value[q.key]=Me.code,$("update:modelValue",s.value),V.value=!0,Me.code==="pending"&&(console.log(`â³ Command '${q.key}' learned, backend will fetch code from storage automatically`),x.value||(console.log("ğŸ”„ Starting polling because command is pending"),R())),w.value&&n.value.length>0&&setTimeout(()=>{const ee=n.value.shift();ee?ne(ee):w.value=!1},1e3);else throw new Error(Me.error||"Failed to learn command")}catch(F){console.error("Error learning command:",F),i.error(`Error learning command: ${F.message}`),w.value=!1,n.value=[]}finally{w.value||(m.value=null)}}}async function J(q){var F;if(!_.value){z.value=!0,window.scrollTo({top:0,behavior:"smooth"});return}if(!s.value[q]){(F=i.value)==null||F.error("Command not learned yet");return}f.value=q;try{const K=s.value[q];await oe.post("/api/commands/send-raw",{entity_id:_.value,command:K,command_type:L.value}),i.success("Command sent successfully")}catch(K){console.error("Error testing command:",K),i.error(`Error testing command: ${K.message}`)}finally{f.value=null}}function M(q){const F=o.value.find(K=>K.key===q);N.value={show:!0,commandKey:q,commandLabel:F?F.label:q}}function B(){const q=N.value.commandKey;delete s.value[q],$("update:modelValue",s.value),N.value.show=!1}function se(){const q=o.value.filter(K=>!s.value[K.key]);if(q.length===0)return;w.value=!0,n.value=[...q];const F=n.value.shift();F&&ne(F)}function fe(){E.value=!0}function Ee(){s.value={},$("update:modelValue",s.value),E.value=!1}ue(()=>k.modelValue,q=>{s.value={...q}},{deep:!0}),Oe(async()=>{await Ae()});async function Ae(){try{console.log("SmartIR device - commands will be loaded from SmartIR JSON file, not Broadlink storage")}catch(q){console.error("Error in loadExistingCommands:",q)}}function Le(){$("update:broadlinkDevice",_.value)}function Te(){$("update:commandType",L.value)}async function Y(){try{console.log("ğŸ” Loading Broadlink devices from /api/remote/devices");const q=await oe.get("/api/remote/devices");console.log("ğŸ“¦ Response data:",q.data);const F=q.data.devices||[];console.log(`âœ… Found ${F.length} devices:`,F),S.value=F}catch(q){console.error("âŒ Error loading remote devices:",q),S.value=[]}}ue(()=>k.broadlinkDevice,q=>{_.value=q}),ue(_,q=>{q&&(z.value=!1)}),ue(()=>k.commandType,q=>{L.value=q});function R(){x.value||(console.log("ğŸ”„ Starting polling for pending commands"),x.value=setInterval(async()=>{try{const q=Object.entries(s.value).filter(([K,ce])=>ce==="pending");if(q.length===0){te();return}console.log(`ğŸ”„ Polling for ${q.length} pending command(s)...`);let F=!1;for(const[K,ce]of q)k.modelValue[K]&&k.modelValue[K]!=="pending"&&(console.log(`âœ… Command '${K}' resolved: ${k.modelValue[K].substring(0,20)}...`),s.value[K]=k.modelValue[K],F=!0);F&&($("update:modelValue",s.value),i.success("Commands updated successfully!"))}catch(q){console.error("Error polling for pending commands:",q)}},3e3),setTimeout(()=>{x.value&&(console.log("â±ï¸ Pending commands polling timeout reached (60s)"),te(),Object.entries(s.value).forEach(([q,F])=>{F==="pending"&&console.warn(`âš ï¸ Command '${q}' still pending after timeout`)}))},6e4))}function te(){x.value&&(clearInterval(x.value),x.value=null,console.log("ğŸ›‘ Stopped polling for pending commands"))}return ue(()=>s.value,q=>{const F=Object.values(q).some(K=>K==="pending");F&&!x.value?console.log(`â³ ${Object.values(q).filter(K=>K==="pending").length} command(s) pending - waiting for backend to resolve`):!F&&x.value&&te()},{deep:!0}),Oe(async()=>{await Y(),await Ae()}),qe(()=>{te()}),(q,F)=>(a(),r("div",md,[F[20]||(F[20]=e("h3",null,"Learn IR Commands",-1)),e("div",vd,[e("div",{class:G(["form-group",{"has-error":z.value}])},[F[6]||(F[6]=e("label",null,"Broadlink Device *",-1)),e("div",pd,[W(e("select",{"onUpdate:modelValue":F[0]||(F[0]=K=>_.value=K),onChange:Le},[F[4]||(F[4]=e("option",{value:""},"Select Broadlink device...",-1)),(a(!0),r(he,null,Ce(S.value,K=>(a(),r("option",{key:K.entity_id,value:K.entity_id},v(K.name||K.entity_id),9,fd))),128))],544),[[Re,_.value]]),z.value?(a(),r("div",gd,[...F[5]||(F[5]=[e("i",{class:"mdi mdi-alert"},null,-1),T(" Device is required ",-1)])])):A("",!0)]),e("small",null,"This device will be used to learn commands ("+v(S.value.length)+" devices found)",1)],2),e("div",yd,[F[8]||(F[8]=e("label",null,"Command Type *",-1)),W(e("select",{"onUpdate:modelValue":F[1]||(F[1]=K=>L.value=K),onChange:Te,disabled:P.value>0},[...F[7]||(F[7]=[e("option",{value:"ir"},"ğŸ“¡ Infrared (IR) - Most common for AC, TV, etc.",-1),e("option",{value:"rf"},"ğŸ“» Radio Frequency (RF) - For RF remotes",-1)])],40,bd),[[Re,L.value]]),P.value>0?(a(),r("small",hd,"Command type cannot be changed after learning commands")):(a(),r("small",kd,"Select the type of commands your device uses"))])]),P.value>0&&!V.value?(a(),r("div",wd,[F[10]||(F[10]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[F[9]||(F[9]=e("strong",null,"Editing Existing Profile",-1)),e("p",null,v(P.value)+" command"+v(P.value!==1?"s":"")+' already learned. You can re-learn any command by clicking the delete icon and then "Learn Command".',1)])])):A("",!0),e("div",$d,[F[14]||(F[14]=e("i",{class:"mdi mdi-information"},null,-1)),e("div",null,[F[13]||(F[13]=e("p",null,[e("strong",null,"How it works:")],-1)),t.commandType==="ir"?(a(),r("ol",Cd,[...F[11]||(F[11]=[e("li",null,'Click "Learn Command" for each combination',-1),e("li",null,[e("strong",null,"Point your IR remote directly at the Broadlink device")],-1),e("li",null,"Press the button on your remote",-1),e("li",null,"Wait for confirmation (up to 30 seconds)",-1)])])):(a(),r("ol",_d,[...F[12]||(F[12]=[e("li",null,'Click "Learn Command" for each combination',-1),e("li",null,[e("strong",null,"Step 1:"),T(" Hold button on remote - Broadlink scans for RF frequency")],-1),e("li",null,[e("strong",null,"Step 2:"),T(" Watch for Home Assistant notification, then press and release button")],-1),e("li",null,"Keep remote within 5cm of Broadlink (RF doesn't need line-of-sight)",-1),e("li",null,"Wait for confirmation (may take up to 30 seconds)",-1)])]))])]),e("div",Sd,[e("div",Id,[e("div",{class:"progress-fill",style:ft({width:p.value+"%"})},null,4)]),e("span",Dd,v(P.value)+" / "+v(b.value)+" commands learned ("+v(p.value)+"%) ",1)]),e("div",xd,[(a(!0),r(he,null,Ce(o.value,K=>(a(),r("div",{key:K.key,class:G(["command-card",{learned:s.value[K.key],learning:m.value===K.key}])},[e("div",Td,[e("div",Md,[e("i",{class:G(K.icon)},null,2)]),e("div",Rd,[e("h4",null,v(K.label),1),e("p",null,v(K.description),1)])]),m.value===K.key?(a(),r("div",Ed,[t.commandType==="ir"?(a(),r("div",Od,[...F[15]||(F[15]=[e("p",null,[e("strong",null,"Point your remote directly at the Broadlink device and press the button.")],-1),e("small",null,"Listening for up to 30 seconds...",-1)])])):(a(),r("div",Ad,[...F[16]||(F[16]=[e("p",{class:"rf-title"},[e("strong",null,"Learning request sent to device.")],-1),e("p",{class:"rf-subtitle"},[T("RF learning is a "),e("strong",null,"two-step process"),T(":")],-1),e("ol",null,[e("li",null,[e("strong",null,"Step 1 - Frequency Sweep (~10-15 seconds):"),T(" Press and hold the button on your remote until the notification updates. ")]),e("li",null,[e("strong",null,"Step 2 - Learn Signal:"),T(" Press and release the button once. ")])],-1),e("p",{class:"rf-note"},"Follow the Home Assistant notifications (ğŸ””) for real-time instructions.",-1)])]))])):A("",!0),e("div",Ld,[s.value[K.key]?(a(),r("div",{key:1,class:G(["learned-status",{pending:s.value[K.key]==="pending"}])},[e("i",{class:G(["mdi",s.value[K.key]==="pending"?"mdi-clock-outline":"mdi-check-circle"])},null,2),e("span",null,v(s.value[K.key]==="pending"?"Pending":"Learned"),1),e("span",{class:G(["command-type-badge",L.value])},v(L.value.toUpperCase()),3),e("button",{onClick:ce=>J(K.key),class:"icon-btn",title:"Test command",disabled:f.value===K.key||s.value[K.key]==="pending",style:{"margin-left":"auto"}},[e("i",{class:G(["mdi mdi-play",{"mdi-spin":f.value===K.key}])},null,2)],8,Vd),e("button",{onClick:ce=>M(K.key),class:"icon-btn danger",title:"Delete and re-learn"},[...F[17]||(F[17]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,jd)],2)):(a(),r("button",{key:0,onClick:ce=>ne(K),class:G(["btn-learn",{learning:m.value===K.key}]),disabled:m.value!==null},[e("i",{class:G(["mdi mdi-radio-tower",{"mdi-spin":m.value===K.key}])},null,2),T(" "+v(m.value===K.key?"Listening...":"Learn Command"),1)],10,Pd))])],2))),128))]),e("div",Ud,[e("button",{onClick:se,class:"btn-secondary",disabled:m.value!==null||P.value===b.value},[...F[18]||(F[18]=[e("i",{class:"mdi mdi-play-circle"},null,-1),T(" Learn All Remaining ",-1)])],8,Fd),e("button",{onClick:fe,class:"btn-text",disabled:P.value===0},[...F[19]||(F[19]=[e("i",{class:"mdi mdi-delete-sweep"},null,-1),T(" Clear All ",-1)])],8,Nd)]),ke(He,{isOpen:N.value.show,title:"Delete Learned Command?",message:`Are you sure you want to delete the '${N.value.commandLabel}' command?

You will need to re-learn this command.`,confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,onConfirm:B,onCancel:F[2]||(F[2]=K=>N.value.show=!1)},null,8,["isOpen","message"]),ke(He,{isOpen:E.value,title:"Delete All Learned Commands?",message:"Are you sure you want to delete all learned commands? This cannot be undone.\\n\\nYou will need to re-learn all commands.",confirmText:"Delete All",cancelText:"Cancel",dangerMode:!0,onConfirm:Ee,onCancel:F[3]||(F[3]=K=>E.value=!1)},null,8,["isOpen"])]))}},Hd=De(Bd,[["__scopeId","data-v-4567eea7"]]),qd={class:"profile-preview"},zd={class:"preview-summary"},Jd={class:"summary-card"},Wd={class:"stats-grid"},Gd={class:"stat-item"},Kd={class:"stat-value"},Xd={class:"stat-item"},Yd={class:"stat-value"},Zd={class:"stat-item"},Qd={class:"stat-value"},eu={class:"preview-tabs"},tu={class:"preview-content"},ou={key:0,class:"tab-content"},lu={class:"code-header"},nu={class:"code-block"},su={key:1,class:"tab-content"},au={class:"code-header"},iu={class:"code-block"},ru={key:2,class:"tab-content"},du={class:"instructions"},uu={class:"step-item"},cu={class:"step-content"},mu={class:"code-path"},vu={__name:"ProfilePreview",props:{profile:{type:Object,required:!0},jsonData:{type:Object,required:!0},yamlConfig:{type:String,required:!0}},setup(t){const c=Ge(),i=t,k=g("json"),$=g(!1),s=g(!1),m=X(()=>Object.keys(i.profile.commands||{}).length),f=X(()=>JSON.stringify(i.jsonData,null,2));async function S(){try{await navigator.clipboard.writeText(f.value),$.value=!0,setTimeout(()=>{$.value=!1},2e3)}catch(L){console.error("Failed to copy JSON:",L),c.error("Failed to copy to clipboard")}}async function _(){try{await navigator.clipboard.writeText(i.yamlConfig),s.value=!0,setTimeout(()=>{s.value=!1},2e3)}catch(L){console.error("Failed to copy YAML:",L),c.error("Failed to copy to clipboard")}}return(L,w)=>{var n;return a(),r("div",qd,[w[22]||(w[22]=e("h3",null,"Preview & Save",-1)),e("div",zd,[e("div",Jd,[w[4]||(w[4]=e("i",{class:"mdi mdi-check-circle"},null,-1)),e("div",null,[w[3]||(w[3]=e("h4",null,"Profile Ready!",-1)),e("p",null,v(t.profile.manufacturer)+" "+v(t.profile.model),1)])]),e("div",Wd,[e("div",Gd,[e("span",Kd,v(m.value),1),w[5]||(w[5]=e("span",{class:"stat-label"},"Commands Learned",-1))]),e("div",Xd,[e("span",Yd,v(t.profile.platform),1),w[6]||(w[6]=e("span",{class:"stat-label"},"Platform",-1))]),e("div",Zd,[e("span",Qd,v(((n=t.profile.config.modes)==null?void 0:n.length)||0),1),w[7]||(w[7]=e("span",{class:"stat-label"},"HVAC Modes",-1))])])]),e("div",eu,[e("button",{onClick:w[0]||(w[0]=V=>k.value="json"),class:G(["tab-button",{active:k.value==="json"}])},[...w[8]||(w[8]=[e("i",{class:"mdi mdi-code-json"},null,-1),T(" SmartIR JSON ",-1)])],2),e("button",{onClick:w[1]||(w[1]=V=>k.value="yaml"),class:G(["tab-button",{active:k.value==="yaml"}])},[...w[9]||(w[9]=[e("i",{class:"mdi mdi-file-code"},null,-1),T(" YAML Config ",-1)])],2),e("button",{onClick:w[2]||(w[2]=V=>k.value="instructions"),class:G(["tab-button",{active:k.value==="instructions"}])},[...w[10]||(w[10]=[e("i",{class:"mdi mdi-information"},null,-1),T(" Instructions ",-1)])],2)]),e("div",tu,[k.value==="json"?(a(),r("div",ou,[e("div",lu,[w[12]||(w[12]=e("h4",null,"SmartIR Device Code JSON",-1)),e("button",{onClick:S,class:"btn-copy"},[w[11]||(w[11]=e("i",{class:"mdi mdi-content-copy"},null,-1)),T(" "+v($.value?"Copied!":"Copy"),1)])]),e("pre",nu,[e("code",null,v(f.value),1)]),w[13]||(w[13]=e("p",{class:"code-note"},[e("i",{class:"mdi mdi-information"}),T(" Save this as "),e("code",null,"10000.json"),T(" in your SmartIR codes directory ")],-1))])):A("",!0),k.value==="yaml"?(a(),r("div",su,[e("div",au,[w[15]||(w[15]=e("h4",null,"Home Assistant Configuration",-1)),e("button",{onClick:_,class:"btn-copy"},[w[14]||(w[14]=e("i",{class:"mdi mdi-content-copy"},null,-1)),T(" "+v(s.value?"Copied!":"Copy"),1)])]),e("pre",iu,[e("code",null,v(t.yamlConfig),1)]),w[16]||(w[16]=e("p",{class:"code-note"},[e("i",{class:"mdi mdi-information"}),T(" Add this to your "),e("code",null,"configuration.yaml"),T(" file ")],-1))])):A("",!0),k.value==="instructions"?(a(),r("div",ru,[e("div",du,[w[20]||(w[20]=e("h4",null,"Installation Steps",-1)),e("div",uu,[w[19]||(w[19]=e("div",{class:"step-number"},"1",-1)),e("div",cu,[w[17]||(w[17]=e("h5",null,"Get Next Code Number",-1)),w[18]||(w[18]=e("p",null,"Custom device codes start at 10000. Check your SmartIR codes directory to find the next available number.",-1)),e("div",mu,[e("code",null,"/config/custom_components/smartir/codes/"+v(t.profile.platform)+"/",1)])])]),w[21]||(w[21]=ze('<div class="step-item" data-v-e7b997c8><div class="step-number" data-v-e7b997c8>2</div><div class="step-content" data-v-e7b997c8><h5 data-v-e7b997c8>Save JSON File</h5><p data-v-e7b997c8>Copy the JSON from the &quot;SmartIR JSON&quot; tab and save it as <code data-v-e7b997c8>10000.json</code> (or your next available number) in the codes directory.</p></div></div><div class="step-item" data-v-e7b997c8><div class="step-number" data-v-e7b997c8>3</div><div class="step-content" data-v-e7b997c8><h5 data-v-e7b997c8>Update Configuration</h5><p data-v-e7b997c8>Copy the YAML from the &quot;YAML Config&quot; tab and add it to your <code data-v-e7b997c8>configuration.yaml</code> file. Update the <code data-v-e7b997c8>device_code</code> to match your JSON filename.</p></div></div><div class="step-item" data-v-e7b997c8><div class="step-number" data-v-e7b997c8>4</div><div class="step-content" data-v-e7b997c8><h5 data-v-e7b997c8>Restart Home Assistant</h5><p data-v-e7b997c8>Restart Home Assistant to load the new configuration. Your climate entity will appear in the UI.</p></div></div><div class="step-item" data-v-e7b997c8><div class="step-number" data-v-e7b997c8>5</div><div class="step-content" data-v-e7b997c8><h5 data-v-e7b997c8>Test Your Device</h5><p data-v-e7b997c8>Go to your climate entity and test different modes, temperatures, and fan speeds to ensure everything works correctly.</p></div></div><div class="tips-section" data-v-e7b997c8><h4 data-v-e7b997c8><i class="mdi mdi-lightbulb" data-v-e7b997c8></i> Tips </h4><ul data-v-e7b997c8><li data-v-e7b997c8>Keep a backup of your JSON file in case you need to modify it</li><li data-v-e7b997c8>Test all commands to ensure they work as expected</li><li data-v-e7b997c8>You can share your profile with the SmartIR community on GitHub</li><li data-v-e7b997c8>If a command doesn&#39;t work, you can re-learn it and update the JSON</li></ul></div>',5))])])):A("",!0)])])}}},pu=De(vu,[["__scopeId","data-v-e7b997c8"]]),fu={class:"wizard-body"},gu={key:0,class:"warning-section"},yu={class:"warning-box"},bu={class:"instructions"},hu={class:"code-block"},ku={class:"steps"},wu={key:0},$u={class:"help-section"},Cu={key:0,class:"help-content"},_u={class:"help-step"},Su={key:0,class:"help-step"},Iu={class:"help-step"},Du={class:"help-step"},xu={class:"checklist"},Tu={class:"checkbox-label"},Mu={key:0,class:"checkbox-label"},Ru={class:"wizard-footer"},Eu=["disabled"],Ou={__name:"SmartIRSetupWizard",props:{show:{type:Boolean,default:!1},platform:{type:String,required:!0},warnings:{type:Array,default:()=>[]},configPath:{type:String,default:"/config"}},emits:["close","complete"],setup(t,{emit:c}){const i=t,k=c,$=Pe("toast"),s=g(!1),m=g(!1),f=g(!1),S=X(()=>i.warnings.length>0?s.value&&m.value:s.value);function _(){const w=`${i.platform}: !include smartir/${i.platform}.yaml`;navigator.clipboard.writeText(w).then(()=>{var n;(n=$.value)==null||n.success("Include line copied to clipboard!","âœ… Copied")}).catch(n=>{var V;console.error("Failed to copy:",n),(V=$.value)==null||V.error("Failed to copy to clipboard","âŒ Copy Failed")})}function L(){k("complete")}return(w,n)=>t.show?(a(),r("div",{key:0,class:"modal-overlay",onClick:n[5]||(n[5]=be(()=>{},["stop"]))},[e("div",{class:"setup-wizard",onClick:n[4]||(n[4]=be(()=>{},["stop"]))},[n[31]||(n[31]=e("div",{class:"wizard-header"},[e("h2",null,[e("i",{class:"mdi mdi-cog"}),T(" SmartIR Configuration Setup ")])],-1)),e("div",fu,[t.warnings.length>0?(a(),r("div",gu,[e("div",yu,[n[11]||(n[11]=e("i",{class:"mdi mdi-alert"},null,-1)),e("div",null,[n[9]||(n[9]=e("h3",null,"âš ï¸ Configuration Migration Needed",-1)),n[10]||(n[10]=e("p",null,"We detected existing platform entries in your configuration.yaml:",-1)),e("ul",null,[(a(!0),r(he,null,Ce(t.warnings,V=>(a(),r("li",{key:V.platform},[e("strong",null,v(V.platform)+":",1),T(" "+v(V.message),1)]))),128))]),e("p",null,[n[6]||(n[6]=e("strong",null,"Action Required:",-1)),n[7]||(n[7]=T(" Move these entries to ",-1)),e("code",null,"smartir/"+v(t.platform)+".yaml",1),n[8]||(n[8]=T(" before continuing.",-1))])])])])):A("",!0),e("div",bu,[n[27]||(n[27]=e("h3",null,"ğŸ“ One-Time Setup",-1)),n[28]||(n[28]=e("p",null,[T("To enable SmartIR device management, add this line to your "),e("code",null,"configuration.yaml"),T(":")],-1)),e("div",hu,[e("code",null,v(t.platform)+": !include smartir/"+v(t.platform)+".yaml",1),e("button",{onClick:_,class:"copy-btn",title:"Copy to clipboard"},[...n[12]||(n[12]=[e("i",{class:"mdi mdi-content-copy"},null,-1)])])]),e("div",ku,[n[19]||(n[19]=e("h4",null,"Steps:",-1)),e("ol",null,[t.warnings.length>0?(a(),r("li",wu,[n[13]||(n[13]=e("strong",null,"Move existing entries:",-1)),n[14]||(n[14]=T(" Copy any existing ",-1)),e("code",null,v(t.platform)+":",1),n[15]||(n[15]=T(" entries from configuration.yaml to ",-1)),e("code",null,"smartir/"+v(t.platform)+".yaml",1)])):A("",!0),n[16]||(n[16]=e("li",null,[e("strong",null,"Add include line:"),T(" Add the line above to your configuration.yaml ")],-1)),n[17]||(n[17]=e("li",null,[e("strong",null,"Save changes:"),T(" Save configuration.yaml ")],-1)),n[18]||(n[18]=e("li",null,[e("strong",null,"Continue here:"),T(` Click "I've Completed Setup" below `)],-1))])]),e("div",$u,[e("button",{onClick:n[0]||(n[0]=V=>f.value=!f.value),class:"help-toggle"},[e("i",{class:G(["mdi",f.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2),T(" "+v(f.value?"Hide":"Show")+" Detailed Instructions ",1)]),f.value?(a(),r("div",Cu,[n[26]||(n[26]=e("h4",null,"Detailed Setup Guide:",-1)),e("div",_u,[n[21]||(n[21]=e("h5",null,"1. Open configuration.yaml",-1)),e("p",null,[n[20]||(n[20]=T("Location: ",-1)),e("code",null,v(t.configPath)+"/configuration.yaml",1)])]),t.warnings.length>0?(a(),r("div",Su,[n[22]||(n[22]=e("h5",null,"2. Migrate Existing Entries (If Any)",-1)),e("p",null,"If you have existing "+v(t.platform)+" entries, cut them from configuration.yaml and paste into:",1),e("p",null,[e("code",null,v(t.configPath)+"/smartir/"+v(t.platform)+".yaml",1)]),n[23]||(n[23]=e("p",{class:"note"},"Broadlink Manager will create this file automatically.",-1))])):A("",!0),e("div",Iu,[e("h5",null,v(t.warnings.length>0?"3":"2")+". Add Include Line",1),n[24]||(n[24]=e("p",null,"Add this to configuration.yaml:",-1)),e("pre",null,v(t.platform)+": !include smartir/"+v(t.platform)+".yaml",1)]),e("div",Du,[e("h5",null,v(t.warnings.length>0?"4":"3")+". Restart Home Assistant",1),n[25]||(n[25]=e("p",null,"After saving, you'll need to restart HA for changes to take effect.",-1))])])):A("",!0)])]),e("div",xu,[e("label",Tu,[W(e("input",{type:"checkbox","onUpdate:modelValue":n[1]||(n[1]=V=>s.value=V)},null,512),[[me,s.value]]),n[29]||(n[29]=e("span",null,"I've added the include line to configuration.yaml",-1))]),t.warnings.length>0?(a(),r("label",Mu,[W(e("input",{type:"checkbox","onUpdate:modelValue":n[2]||(n[2]=V=>m.value=V)},null,512),[[me,m.value]]),e("span",null,"I've migrated existing "+v(t.platform)+" entries (if any)",1)])):A("",!0)])]),e("div",Ru,[e("button",{onClick:n[3]||(n[3]=V=>w.$emit("close")),class:"btn-secondary"}," Cancel "),e("button",{onClick:L,class:"btn-primary",disabled:!S.value},[...n[30]||(n[30]=[e("i",{class:"mdi mdi-check"},null,-1),T(" I've Completed Setup ",-1)])],8,Eu)])])])):A("",!0)}},Au=De(Ou,[["__scopeId","data-v-f6fe4c03"]]),Lu={class:"modal-header"},Pu={class:"progress-steps"},Vu={class:"step-number"},ju={key:0,class:"mdi mdi-check"},Uu={key:1},Fu={class:"step-label"},Nu={class:"modal-body"},Bu={key:0,class:"step-content"},Hu={class:"form-group"},qu={class:"form-group"},zu={class:"form-group"},Ju={key:1,class:"step-content"},Wu={key:1,class:"platform-form"},Gu={class:"form-section"},Ku={class:"checkbox-grid"},Xu={class:"checkbox-item"},Yu={class:"checkbox-item"},Zu={class:"checkbox-item"},Qu={class:"checkbox-item"},ec={class:"checkbox-item"},tc={key:2,class:"platform-form"},oc={class:"form-section"},lc={class:"form-group"},nc={class:"form-section"},sc={class:"checkbox-grid"},ac={class:"checkbox-item"},ic={class:"checkbox-item"},rc={key:3,class:"platform-form"},dc={class:"form-section"},uc={class:"checkbox-grid"},cc={class:"checkbox-item"},mc={class:"checkbox-item"},vc={class:"checkbox-item"},pc={class:"checkbox-item"},fc={key:2,class:"step-content"},gc={key:3,class:"step-content"},yc={class:"modal-footer"},bc=["disabled"],hc={key:2,class:"save-buttons"},kc=["disabled"],wc=["disabled"],$c={__name:"SmartIRProfileBuilder",props:{show:{type:Boolean,default:!1},editMode:{type:Boolean,default:!1},editData:{type:Object,default:null},startStep:{type:Number,default:0}},emits:["close","save"],setup(t,{emit:c}){const i=t,k=c,$=Pe("toast"),s=g(0),m=g(!1),f=g([]),S=g(!1),_=g([]),L=g("/config"),w=g(!1),n=g(null),V=g(!1),z=g(!1),N=g(""),E=g("ir"),x=g(!1),o=g(null),b=g(null),P=[{label:"Device Info",key:"info"},{label:"Configuration",key:"config"},{label:"Learn Commands",key:"commands"},{label:"Preview & Save",key:"preview"}],p=g({platform:"",manufacturer:"",model:"",broadlinkDevice:"",commandType:"ir",config:{features:["turn_on"]},commands:{}}),Z=g(["turn_on"]),ne=g(3),J=g([]),M=g(["turn_on"]);ue(()=>p.value.platform,I=>{console.log("ğŸ¯ Platform changed to:",I,"mediaPlayerFeatures:",Z.value),I==="media_player"?(p.value.config={features:Z.value},console.log("ğŸ“º Set media_player config:",p.value.config,"features array:",p.value.config.features)):I==="fan"?(p.value.config={speedLevels:ne.value,features:J.value},console.log("ğŸŒ€ Set fan config:",p.value.config)):I==="light"?(p.value.config={features:M.value},console.log("ğŸ’¡ Set light config:",p.value.config)):I===""&&console.log("âš ï¸ Platform is empty string, skipping config initialization")},{immediate:!0}),ue(Z,I=>{p.value.platform==="media_player"&&(p.value.config={features:I})},{deep:!0}),ue(ne,I=>{p.value.platform==="fan"&&(p.value.config={speedLevels:I,features:J.value})}),ue(J,I=>{p.value.platform==="fan"&&(p.value.config={speedLevels:ne.value,features:I})},{deep:!0}),ue(M,I=>{p.value.platform==="light"&&(p.value.config={features:I})},{deep:!0});function B(I){const d=new Set,C=Object.keys(I);return C.some(U=>U==="off"||U.includes("_off"))&&d.add("off"),C.some(U=>U.includes("auto"))&&d.add("auto"),C.some(U=>U.includes("cool"))&&d.add("cool"),C.some(U=>U.includes("heat"))&&d.add("heat"),C.some(U=>U.includes("dry"))&&d.add("dry"),C.some(U=>U.includes("fan_only"))&&d.add("fan_only"),Array.from(d)}function se(I){const d=new Set,C=Object.keys(I);return C.some(U=>U.includes("auto"))&&d.add("auto"),C.some(U=>U.includes("low"))&&d.add("low"),C.some(U=>U.includes("medium")||U.includes("mid"))&&d.add("medium"),C.some(U=>U.includes("high"))&&d.add("high"),Array.from(d)}function fe(I){const d=new Set,C=Object.keys(I);return C.some(U=>U.includes("swing_off")||U.includes("_off"))&&d.add("off"),C.some(U=>U.includes("vertical"))&&d.add("vertical"),C.some(U=>U.includes("horizontal"))&&d.add("horizontal"),C.some(U=>U.includes("both"))&&d.add("both"),Array.from(d)}function Ee(I){const d=new Set,C=Object.keys(I);return C.some(U=>U.includes("none"))&&d.add("none"),C.some(U=>U.includes("eco"))&&d.add("eco"),C.some(U=>U.includes("boost"))&&d.add("boost"),C.some(U=>U.includes("sleep"))&&d.add("sleep"),C.some(U=>U.includes("away"))&&d.add("away"),C.some(U=>U.includes("comfort"))&&d.add("comfort"),Array.from(d)}function Ae(I){for(const d of Object.values(I))if(typeof d=="string"&&d.startsWith("sc")||Array.isArray(d)&&d.length>0&&typeof d[0]=="string"&&d[0].startsWith("sc"))return"rf";return"ir"}ue(()=>p.value.commandType,(I,d)=>{!d||V.value||x.value||(Object.keys(p.value.commands).length>0&&I!==d?(N.value=I,p.value.commandType=d,V.value=!0):I!==d&&(E.value=I))}),ue(()=>p.value.commands,I=>{if(!I||!i.editMode&&!b.value||i.editMode&&!i.editData)return;const d=Object.values(I).some(C=>typeof C=="string"?C==="pending":typeof C=="object"?Object.values(C).some(U=>typeof U=="string"?U==="pending":typeof U=="object"?Object.values(U).some(de=>de==="pending"):!1):!1);d?o.value?console.log("ğŸ”„ Polling already running, will pick up new pending commands"):(console.log("ğŸ”„ Starting polling to reload profile data from backend"),Le()):!d&&o.value&&(console.log("âœ… All commands resolved, stopping polling"),Te())},{deep:!0});function Le(){if(o.value)return;let I,d;if(i.editMode&&i.editData)I=i.editData.platform,d=i.editData.code;else if(!i.editMode&&b.value)I=p.value.platform,d=b.value;else{console.warn("Cannot start polling: missing platform or code");return}o.value=setInterval(async()=>{try{console.log(`ğŸ”„ Polling profile ${I}/${d} for updated commands...`);const de=(await oe.get(`/api/smartir/platforms/${I}/profiles/${d}`)).data.profile.commands||{};let we=!1;for(const[ae,Se]of Object.entries(p.value.commands))Se==="pending"&&(de[ae]&&de[ae]!=="pending"?(console.log(`âœ… Command '${ae}' resolved in profile: ${de[ae].substring(0,20)}...`),p.value.commands[ae]=de[ae],we=!0):console.log(`â³ Command '${ae}' still pending in backend`));we&&console.log("âœ… Updated commands from backend")}catch(C){console.error("Error polling for profile updates:",C)}},3e3),setTimeout(()=>{o.value&&(console.log("â±ï¸ Profile polling timeout reached (60s)"),Te())},6e4)}function Te(){o.value&&(clearInterval(o.value),o.value=null,console.log("ğŸ›‘ Stopped polling for profile updates"))}ue(()=>i.editData,async I=>{var d,C,U;if(I&&i.editMode){console.log("ğŸ”§ Edit mode activated, loading profile data:",I),x.value=!0,f.value.length===0&&(console.log("ğŸ“¡ Loading Broadlink devices..."),await Ie(),console.log("ğŸ“¡ Devices loaded:",f.value.length));const de=I.profile,we=de.controller_data;console.log("ğŸ® Controller data from profile:",we),console.log("ğŸ® Available devices:",f.value.map(O=>O.entity_id));const ae=de.commands||{},Se=de.commandType||Ae(ae);console.log("ğŸ” Command type (stored):",de.commandType),console.log("ğŸ” Command type (final):",Se);let D={};if(I.platform==="climate"){const O=de.operationModes||B(ae),j=de.fanModes||se(ae),le=de.swingModes||fe(ae),ve=de.presetModes||Ee(ae);console.log("ğŸ” Inferred modes:",O),console.log("ğŸ” Inferred fan modes:",j),console.log("ğŸ” Inferred swing modes:",le),console.log("ğŸ” Inferred preset modes:",ve),D={minTemp:de.minTemperature,maxTemp:de.maxTemperature,precision:de.precision,modes:O,fanModes:j,swingModes:le,presetModes:ve}}else if(I.platform==="media_player"){const O=[];(ae.on||ae.off)&&O.push("turn_on"),(ae.volumeUp||ae.volumeDown)&&O.push("volume"),ae.mute&&O.push("mute"),ae.sources&&O.push("source"),(ae.channelUp||ae.channelDown)&&O.push("channel"),D={features:O},Z.value=O,console.log("ğŸ” Inferred media player features:",O)}else if(I.platform==="fan"){const O=((d=de.speed)==null?void 0:d.length)||Object.keys(ae.default||{}).length||3,j=[];(ae.oscillate_on||ae.oscillate_off)&&j.push("oscillate"),(ae.direction_forward||ae.direction_reverse)&&j.push("direction"),D={speedLevels:O,features:j},ne.value=O,J.value=j,console.log("ğŸ” Inferred fan config:",D)}else if(I.platform==="light"){const O=[];D={features:O},M.value=O,console.log("ğŸ” Inferred light features:",O)}const h=await ie(de.manufacturer,(C=de.supportedModels)==null?void 0:C[0],ae);p.value={platform:I.platform,manufacturer:de.manufacturer||"",model:((U=de.supportedModels)==null?void 0:U[0])||"",broadlinkDevice:we||"",commandType:Se,config:D,commands:h},console.log("âœ… Profile populated:",p.value),console.log("âœ… Selected device:",p.value.broadlinkDevice),console.log("âœ… Command type:",p.value.commandType),console.log("âœ… Commands (with learned codes):",h),E.value=Se,setTimeout(()=>{x.value=!1},100)}},{immediate:!0});const Y=X(()=>{var I;switch(s.value){case 0:return p.value.platform&&p.value.manufacturer&&p.value.model;case 1:return p.value.platform==="climate"?p.value.config.minTemp&&p.value.config.maxTemp&&((I=p.value.config.modes)==null?void 0:I.length)>0:!0;case 2:const d=Object.keys(p.value.commands).length>0,C=Object.values(p.value.commands).some(U=>typeof U=="string"?U==="pending":typeof U=="object"?Object.values(U).some(de=>typeof de=="string"?de==="pending":typeof de=="object"?Object.values(de).some(we=>we==="pending"):!1):!1);return p.value.broadlinkDevice&&p.value.commandType&&d&&!C;case 3:return!0;default:return!1}}),R=g(null);async function te(){if(s.value!==3){R.value=null;return}if(console.log("ğŸ” Generating JSON with commands:",p.value.commands),Object.values(p.value.commands).some(d=>typeof d=="string"?d==="pending":typeof d=="object"?Object.values(d).some(C=>typeof C=="string"?C==="pending":typeof C=="object"?Object.values(C).some(U=>U==="pending"):!1):!1)){console.warn('âš ï¸ Commands still contain "pending" placeholders!'),console.log("ğŸ“¦ Attempting to fetch from Broadlink storage...");const d=await ie(p.value.manufacturer,p.value.model,p.value.commands);p.value.commands=d,console.log("âœ… Updated commands:",d)}R.value=_e(p.value),console.log("ğŸ“„ Generated JSON:",R.value)}const q=X(()=>s.value!==3?null:ge(p.value));function F(){p.value.config={},p.value.commands={}}function K(){V.value=!1,p.value.commandType=N.value,E.value=N.value,p.value.commands={},N.value=""}function ce(){V.value=!1,N.value=""}async function Ve(){s.value<P.length-1&&(s.value===0&&!i.editMode&&await Me(),s.value===1&&(console.log("ğŸ“‹ Moving to Learn Commands - ensuring config is set"),p.value.platform==="media_player"?(p.value.config={features:Z.value},console.log("ğŸ“º Set media_player config:",p.value.config)):p.value.platform==="fan"?(p.value.config={speedLevels:ne.value,features:J.value},console.log("ğŸŒ€ Set fan config:",p.value.config)):p.value.platform==="light"&&(p.value.config={features:M.value},console.log("ğŸ’¡ Set light config:",p.value.config))),s.value++,s.value===3&&await te())}async function Me(){var I,d;try{const U=(await oe.get(`/api/smartir/platforms/${p.value.platform}/next-code`)).data.next_code;console.log(`ğŸ†• Initializing profile file with code ${U}`);const de=await oe.post("/api/smartir/profiles/initialize",{platform:p.value.platform,manufacturer:p.value.manufacturer,model:p.value.model,code_number:U});de.data.success&&(b.value=U,console.log(`âœ… Profile file initialized: ${de.data.filename}`),(I=$.value)==null||I.success(`Profile file created: ${de.data.filename}`))}catch(C){console.error("Error initializing profile file:",C),(d=$.value)==null||d.error("Failed to initialize profile file")}}function ee(){s.value>0&&s.value--}function y(){V.value||(z.value=!0)}async function u(){z.value=!1,await l()}async function l(){if(b.value&&!i.editMode)try{console.log(`ğŸ—‘ï¸ Deleting initialized profile ${b.value} (user cancelled)`),await oe.delete(`/api/smartir/profiles/${b.value}`,{data:{platform:p.value.platform}}),console.log("âœ… Cleaned up initialized profile file")}catch(I){console.error("Error cleaning up profile file:",I)}k("close"),setTimeout(()=>{s.value=0,p.value={platform:"",manufacturer:"",model:"",broadlinkDevice:"",commandType:"ir",config:{},commands:{}},E.value="ir",b.value=null},300)}async function H(){var I,d,C,U,de,we;m.value=!0;try{if(!w.value){const j=(await oe.get("/api/smartir/config/check")).data;if(j&&!((I=j.platforms[p.value.platform])==null?void 0:I.file_exists)){_.value=j.configuration_warnings||[],L.value=j.config_path||"/config",n.value={platform:p.value.platform,json:R.value},S.value=!0,m.value=!1;return}}let ae;i.editMode&&((d=i.editData)!=null&&d.code)?(ae=parseInt(i.editData.code),console.log("ğŸ“ Edit mode: Using existing code",ae)):b.value?(ae=b.value,console.log("âœ¨ New profile: Using initialized code",ae)):(ae=(await oe.get(`/api/smartir/platforms/${p.value.platform}/next-code`)).data.next_code,console.log("âš ï¸ Fallback: Using next code",ae));const D=(await oe.post("/api/smartir/profiles",{platform:p.value.platform,json:R.value,code_number:ae})).data,h={platform:"smartir",name:`${p.value.manufacturer} ${p.value.model}`,unique_id:`${p.value.manufacturer.toLowerCase().replace(/[^a-z0-9]+/g,"_")}_${p.value.model.toLowerCase().replace(/[^a-z0-9]+/g,"_")}`,device_code:ae,controller_data:p.value.broadlinkDevice};try{await oe.post("/api/smartir/config/add-device",{platform:p.value.platform,device_config:{platform:"smartir",name:h.name,unique_id:h.unique_id,device_code:h.device_code,controller_data:h.controller_data}})}catch(O){console.error("Failed to add device to config:",O);const j=((C=O.response)==null?void 0:C.data)||{};let le=j.error||"Unknown error";j.validation_errors&&j.validation_errors.length>0&&(le=`Device configuration validation failed:
`+j.validation_errors.map(ve=>`  â€¢ ${ve}`).join(`
`)),(U=$.value)==null||U.warning(`Profile saved but failed to add to config file:
${le}`,"âš ï¸ Partial Success")}k("save",{json:R.value,yaml:q.value,profile:p.value,saved_to:D.path}),(de=$.value)==null||de.success(`âœ… Profile saved to custom_codes/${p.value.platform}/${D.filename}
âœ… Device added to smartir/${p.value.platform}.yaml
âœ… Profile visible in Broadlink Manager immediately

âš ï¸ Restart Home Assistant for SmartIR integration to use this profile`,"âœ… Profile Saved Successfully!"),b.value=null,l()}catch(ae){console.error("Error saving profile:",ae),(we=$.value)==null||we.error(ae.message,"âŒ Error Saving Profile")}finally{m.value=!1}}async function Q(){w.value=!0,S.value=!1,n.value&&(await H(),n.value=null)}function re(){var I,d;try{const C=JSON.stringify(R.value,null,2),U=new Blob([C],{type:"application/json"}),de=URL.createObjectURL(U),we=document.createElement("a");we.href=de;const ae=p.value.manufacturer.toLowerCase().replace(/\s+/g,"_"),Se=p.value.model.toLowerCase().replace(/\s+/g,"_");we.download=`smartir_${p.value.platform}_${ae}_${Se}.json`,document.body.appendChild(we),we.click(),document.body.removeChild(we),URL.revokeObjectURL(de),(I=$.value)==null||I.success("You can manually upload this file to your SmartIR codes directory.","âœ… Profile Downloaded")}catch(C){console.error("Error downloading profile:",C),(d=$.value)==null||d.error(C.message,"âŒ Error Downloading Profile")}}async function ie(I,d,C){const U=I.toLowerCase().replace(/[^a-z0-9]+/g,"_"),de=d.toLowerCase().replace(/[^a-z0-9]+/g,"_"),we=`${U}_${de}`;try{const D=(await oe.get("/api/commands/all")).data[we]||{};console.log(`ğŸ” Fetching learned commands for device: ${we}`),console.log("ğŸ“¦ Device commands from storage:",D);const h={...C};for(const[O,j]of Object.entries(h))if(j==="pending"&&D[O])h[O]=D[O];else if(typeof j=="object"){for(const[le,ve]of Object.entries(j))if(typeof ve=="object")for(const[ye,pe]of Object.entries(ve)){const $e=`${O}_${le}_${ye}`;pe==="pending"&&D[$e]&&(h[O][le][ye]=D[$e])}else if(ve==="pending"){const ye=`${O}_${le}`;D[ye]&&(h[O][le]=D[ye])}}return console.log("âœ… Merged commands:",h),h}catch(ae){return console.error("Error fetching learned commands:",ae),C}}function _e(I){const d={manufacturer:I.manufacturer,supportedModels:[I.model],supportedController:"Broadlink",commandsEncoding:"Base64",commandType:I.commandType||"ir",commands:{}};if(I.platform==="climate"){d.minTemperature=I.config.minTemp,d.maxTemperature=I.config.maxTemp,d.precision=I.config.precision||1,d.operationModes=I.config.modes||[],d.fanModes=I.config.fanModes&&I.config.fanModes.length>0?I.config.fanModes:["auto"],I.config.swingModes&&I.config.swingModes.length>0&&(d.swingModes=I.config.swingModes),I.config.presetModes&&I.config.presetModes.length>0&&(d.presetModes=I.config.presetModes);const C=I.commands||{},U={};for(const[de,we]of Object.entries(C)){if(de==="off"){U.off=we;continue}const ae=de.split("_");if(ae.length<3)continue;const Se=ae[0],D=ae[1],h=ae[2],O=ae[3]||null,j=ae[4]||null;U[Se]||(U[Se]={}),U[Se][D]||(U[Se][D]={}),O&&j?(U[Se][D][h]||(U[Se][D][h]={}),U[Se][D][h][O]||(U[Se][D][h][O]={}),U[Se][D][h][O][j]=we):O?(U[Se][D][h]||(U[Se][D][h]={}),U[Se][D][h][O]=we):U[Se][D][h]=we}d.commands=U}else d.commands=I.commands||{};return d}function ge(I){let d=`# SmartIR ${I.platform} configuration
`;return d+=`# Generated by Broadlink Manager v2

`,I.platform==="climate"&&(d+=`climate:
`,d+=`  - platform: smartir
`,d+=`    name: ${I.manufacturer} ${I.model}
`,d+=`    unique_id: ${I.manufacturer.toLowerCase()}_${I.model.toLowerCase().replace(/\s+/g,"_")}
`,d+=`    device_code: 10000  # Change this to your custom code number
`,d+=`    controller_data: ${I.broadlinkDevice}
`,I.config.tempSensor&&(d+=`    temperature_sensor: ${I.config.tempSensor}
`),I.config.humiditySensor&&(d+=`    humidity_sensor: ${I.config.humiditySensor}
`),I.config.powerSensor&&(d+=`    power_sensor: ${I.config.powerSensor}
`)),d}async function Ie(){try{console.log("Fetching remote devices from /api/remote/devices...");const I=await oe.get("/api/remote/devices");console.log("Loaded remote devices response:",I.data);const d=I.data.devices||[];console.log("Extracted devices array:",d),console.log("Device count:",d.length),f.value=d,console.log("broadlinkDevices.value set to:",f.value),console.log("Final device count:",f.value.length)}catch(I){console.error("Error loading remote devices:",I),f.value=[]}}return ue(()=>i.show,I=>{if(I){const d=Number.isInteger(i.startStep)?i.startStep:0;s.value=Math.min(Math.max(d,0),P.length-1)}}),ue(()=>i.startStep,I=>{if(i.show){const d=Number.isInteger(I)?I:0;s.value=Math.min(Math.max(d,0),P.length-1)}}),Oe(()=>{i.show&&Ie()}),qe(()=>{Te()}),(I,d)=>t.show?(a(),r("div",{key:0,class:"modal-overlay",onClick:y},[e("div",{class:"modal-container",onClick:d[19]||(d[19]=be(()=>{},["stop"]))},[e("div",Lu,[e("h2",null,[d[22]||(d[22]=e("i",{class:"mdi mdi-file-document-edit"},null,-1)),T(" "+v(t.editMode?"Edit SmartIR Profile":"Create SmartIR Profile"),1)]),e("button",{onClick:l,class:"close-button"},[...d[23]||(d[23]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Pu,[(a(),r(he,null,Ce(P,(C,U)=>e("div",{key:U,class:G(["step",{active:s.value===U,completed:s.value>U}])},[e("div",Vu,[s.value>U?(a(),r("i",ju)):(a(),r("span",Uu,v(U+1),1))]),e("span",Fu,v(C.label),1)],2)),64))]),e("div",Nu,[s.value===0?(a(),r("div",Bu,[d[29]||(d[29]=e("h3",null,"Device Information",-1)),e("div",Hu,[d[25]||(d[25]=e("label",null,"Platform Type *",-1)),W(e("select",{"onUpdate:modelValue":d[0]||(d[0]=C=>p.value.platform=C),onChange:F},[...d[24]||(d[24]=[ze('<option value="" data-v-ea3c8654>Select platform...</option><option value="climate" data-v-ea3c8654>ğŸŒ¡ï¸ Climate (AC, Heater, Heat Pump)</option><option value="media_player" data-v-ea3c8654>ğŸ“º Media Player (TV, Receiver)</option><option value="fan" data-v-ea3c8654>ğŸŒ€ Fan</option><option value="light" data-v-ea3c8654>ğŸ’¡ Light (LED Strip, IR Light)</option>',5)])],544),[[Re,p.value.platform]])]),e("div",qu,[d[26]||(d[26]=e("label",null,"Manufacturer *",-1)),W(e("input",{"onUpdate:modelValue":d[1]||(d[1]=C=>p.value.manufacturer=C),type:"text",placeholder:"e.g., Daikin, LG, Samsung"},null,512),[[je,p.value.manufacturer]])]),e("div",zu,[d[27]||(d[27]=e("label",null,"Model(s) *",-1)),W(e("input",{"onUpdate:modelValue":d[2]||(d[2]=C=>p.value.model=C),type:"text",placeholder:"e.g., FTXS35K, Multiple models"},null,512),[[je,p.value.model]]),d[28]||(d[28]=e("small",null,'Enter model number or "Multiple" if it works with many models',-1))])])):A("",!0),s.value===1?(a(),r("div",Ju,[p.value.platform==="climate"?(a(),Ne(cd,{key:0,modelValue:p.value.config,"onUpdate:modelValue":d[3]||(d[3]=C=>p.value.config=C)},null,8,["modelValue"])):p.value.platform==="media_player"?(a(),r("div",Wu,[d[36]||(d[36]=e("h3",null,"Media Player Configuration",-1)),d[37]||(d[37]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),T(" Configure the features your media player supports. You'll learn the IR commands in the next step. ")],-1)),e("div",Gu,[d[35]||(d[35]=e("h4",null,"Supported Features",-1)),e("div",Ku,[e("label",Xu,[W(e("input",{type:"checkbox",value:"turn_on","onUpdate:modelValue":d[4]||(d[4]=C=>Z.value=C)},null,512),[[me,Z.value]]),d[30]||(d[30]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),T(" Power On/Off ")],-1))]),e("label",Yu,[W(e("input",{type:"checkbox",value:"volume","onUpdate:modelValue":d[5]||(d[5]=C=>Z.value=C)},null,512),[[me,Z.value]]),d[31]||(d[31]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-volume-high"}),T(" Volume Control ")],-1))]),e("label",Zu,[W(e("input",{type:"checkbox",value:"mute","onUpdate:modelValue":d[6]||(d[6]=C=>Z.value=C)},null,512),[[me,Z.value]]),d[32]||(d[32]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-volume-mute"}),T(" Mute ")],-1))]),e("label",Qu,[W(e("input",{type:"checkbox",value:"source","onUpdate:modelValue":d[7]||(d[7]=C=>Z.value=C)},null,512),[[me,Z.value]]),d[33]||(d[33]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-import"}),T(" Source Selection ")],-1))]),e("label",ec,[W(e("input",{type:"checkbox",value:"channel","onUpdate:modelValue":d[8]||(d[8]=C=>Z.value=C)},null,512),[[me,Z.value]]),d[34]||(d[34]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-numeric"}),T(" Channel Control ")],-1))])])])])):p.value.platform==="fan"?(a(),r("div",tc,[d[44]||(d[44]=e("h3",null,"Fan Configuration",-1)),d[45]||(d[45]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),T(" Configure the features your fan supports. You'll learn the IR commands in the next step. ")],-1)),e("div",oc,[d[40]||(d[40]=e("h4",null,"Fan Speed Levels",-1)),e("div",lc,[d[39]||(d[39]=e("label",null,"Number of Speed Levels *",-1)),W(e("select",{"onUpdate:modelValue":d[9]||(d[9]=C=>ne.value=C)},[...d[38]||(d[38]=[e("option",{value:1},"1 Speed",-1),e("option",{value:2},"2 Speeds",-1),e("option",{value:3},"3 Speeds (Low/Med/High)",-1),e("option",{value:4},"4 Speeds",-1),e("option",{value:5},"5 Speeds",-1),e("option",{value:6},"6 Speeds",-1)])],512),[[Re,ne.value,void 0,{number:!0}]])])]),e("div",nc,[d[43]||(d[43]=e("h4",null,"Additional Features",-1)),e("div",sc,[e("label",ac,[W(e("input",{type:"checkbox",value:"oscillate","onUpdate:modelValue":d[10]||(d[10]=C=>J.value=C)},null,512),[[me,J.value]]),d[41]||(d[41]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-sync"}),T(" Oscillation ")],-1))]),e("label",ic,[W(e("input",{type:"checkbox",value:"direction","onUpdate:modelValue":d[11]||(d[11]=C=>J.value=C)},null,512),[[me,J.value]]),d[42]||(d[42]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-rotate-3d-variant"}),T(" Direction (Forward/Reverse) ")],-1))])])])])):p.value.platform==="light"?(a(),r("div",rc,[d[51]||(d[51]=e("h3",null,"Light Configuration",-1)),d[52]||(d[52]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),T(" Configure the features your light supports. You'll learn the IR commands in the next step. ")],-1)),e("div",dc,[d[50]||(d[50]=e("h4",null,"Supported Features",-1)),e("div",uc,[e("label",cc,[W(e("input",{type:"checkbox",value:"turn_on","onUpdate:modelValue":d[12]||(d[12]=C=>M.value=C)},null,512),[[me,M.value]]),d[46]||(d[46]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),T(" Power On/Off ")],-1))]),e("label",mc,[W(e("input",{type:"checkbox",value:"brightness","onUpdate:modelValue":d[13]||(d[13]=C=>M.value=C)},null,512),[[me,M.value]]),d[47]||(d[47]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-brightness-6"}),T(" Brightness Control ")],-1))]),e("label",vc,[W(e("input",{type:"checkbox",value:"color_temp","onUpdate:modelValue":d[14]||(d[14]=C=>M.value=C)},null,512),[[me,M.value]]),d[48]||(d[48]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-thermometer"}),T(" Color Temperature ")],-1))]),e("label",pc,[W(e("input",{type:"checkbox",value:"rgb","onUpdate:modelValue":d[15]||(d[15]=C=>M.value=C)},null,512),[[me,M.value]]),d[49]||(d[49]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-palette"}),T(" RGB Color ")],-1))])])])])):A("",!0)])):A("",!0),s.value===2?(a(),r("div",fc,[ke(Hd,{modelValue:p.value.commands,"onUpdate:modelValue":d[16]||(d[16]=C=>p.value.commands=C),platform:p.value.platform,config:p.value.config,broadlinkDevice:p.value.broadlinkDevice,"onUpdate:broadlinkDevice":d[17]||(d[17]=C=>p.value.broadlinkDevice=C),manufacturer:p.value.manufacturer,model:p.value.model,commandType:p.value.commandType,"onUpdate:commandType":d[18]||(d[18]=C=>p.value.commandType=C)},null,8,["modelValue","platform","config","broadlinkDevice","manufacturer","model","commandType"])])):A("",!0),s.value===3?(a(),r("div",gc,[ke(pu,{profile:p.value,"json-data":R.value,"yaml-config":q.value},null,8,["profile","json-data","yaml-config"])])):A("",!0)]),e("div",yc,[s.value>0?(a(),r("button",{key:0,onClick:ee,class:"btn-secondary"},[...d[53]||(d[53]=[e("i",{class:"mdi mdi-arrow-left"},null,-1),T(" Back ",-1)])])):A("",!0),d[57]||(d[57]=e("div",{class:"spacer"},null,-1)),e("button",{onClick:l,class:"btn-text"}," Cancel "),s.value<P.length-1?(a(),r("button",{key:1,onClick:Ve,class:"btn-primary",disabled:!Y.value},[...d[54]||(d[54]=[T(" Next ",-1),e("i",{class:"mdi mdi-arrow-right"},null,-1)])],8,bc)):(a(),r("div",hc,[e("button",{onClick:H,class:"btn-primary",disabled:m.value},[d[55]||(d[55]=e("i",{class:"mdi mdi-cloud-upload"},null,-1)),T(" "+v(m.value?"Saving...":"Save to SmartIR"),1)],8,kc),e("button",{onClick:re,class:"btn-secondary",disabled:m.value},[...d[56]||(d[56]=[e("i",{class:"mdi mdi-download"},null,-1),T(" Download JSON ",-1)])],8,wc)]))])]),ke(Au,{show:S.value,platform:p.value.platform,warnings:_.value,"config-path":L.value,onClose:d[20]||(d[20]=C=>S.value=!1),onComplete:Q},null,8,["show","platform","warnings","config-path"]),ke(He,{isOpen:V.value,title:"Change Command Type?",message:"Changing the command type will clear all learned commands. Continue?",confirmText:"Continue",cancelText:"Cancel",dangerMode:!0,onConfirm:K,onCancel:ce},null,8,["isOpen"]),ke(He,{isOpen:z.value,title:"Close Profile Builder?",message:"Are you sure you want to close? Your progress will be lost.",confirmText:"Close",cancelText:"Keep Editing",dangerMode:!0,onConfirm:u,onCancel:d[21]||(d[21]=C=>z.value=!1)},null,8,["isOpen"])])):A("",!0)}},Cc=De($c,[["__scopeId","data-v-ea3c8654"]]),_c={class:"dashboard"},Sc={key:1,class:"welcome-banner"},Ic={__name:"Dashboard",setup(t){const c=Ge(),i=Pe("smartirEnabled"),{isMobile:k}=ot(),$=g(!1),s=g(!1),m=g(null),f=g(0),S=g(null),_=g(localStorage.getItem("welcome_banner_dismissed")==="true");function L(){_.value=!0,localStorage.setItem("welcome_banner_dismissed","true")}function w(){s.value=!1,m.value=null,f.value=0,$.value=!0}async function n({platform:N,profile:E,startStep:x}){f.value=Number.isInteger(x)?x:0;try{const o=await fetch(`api/smartir/platforms/${N}/profiles/${E.code}`);if(!o.ok)throw new Error("Failed to load profile");const b=await o.json();let P="";try{const p=await fetch(`api/smartir/config/get-device?platform=${N}&code=${E.code}`);p.ok?(P=(await p.json()).controller_data||"",console.log("âœ… Found controller_data from YAML:",P)):console.warn("âš ï¸ No YAML entry found for this profile (this is OK for profiles not yet added to config)")}catch(p){console.warn("âš ï¸ Could not fetch controller_data from config:",p)}s.value=!0,m.value={platform:N,code:E.code,profile:{...b.profile,controller_data:P}},$.value=!0}catch(o){console.error("Error loading profile for edit:",o),c.error("Failed to load profile for editing")}}function V(){$.value=!1,s.value=!1,m.value=null}async function z(N){console.log("Profile saved:",N),V(),S.value&&S.value.loadAllProfiles&&(await S.value.loadAllProfiles(),console.log("âœ… Profiles list refreshed"))}return(N,E)=>(a(),r("div",_c,[xe(i)?(a(),Ne(da,{key:0})):A("",!0),!xe(k)&&!_.value?(a(),r("div",Sc,[e("button",{class:"dismiss-button",onClick:L,title:"Dismiss"},[...E[0]||(E[0]=[e("i",{class:"mdi mdi-close"},null,-1)])]),E[1]||(E[1]=ze('<div class="banner-content" data-v-12185d74><div class="banner-icon" data-v-12185d74><i class="mdi mdi-rocket-launch" data-v-12185d74></i></div><div class="banner-text" data-v-12185d74><h2 data-v-12185d74>Welcome to Broadlink Manager v2!</h2><p data-v-12185d74>Manage your IR/RF devices with a modern Vue 3 interface</p></div></div><div class="status-badges" data-v-12185d74><span class="badge success" data-v-12185d74><i class="mdi mdi-check-circle" data-v-12185d74></i> Vue 3 Ready </span><span class="badge warning" data-v-12185d74><i class="mdi mdi-beta" data-v-12185d74></i> Beta </span></div>',2))])):A("",!0),ke(la),xe(i)?(a(),Ne(ir,{key:2,ref_key:"smartirStatusCard",ref:S,onCreateProfile:w,onEditProfile:n},null,512)):A("",!0),ke(Cc,{show:$.value,editMode:s.value,editData:m.value,startStep:f.value,onClose:V,onSave:z},null,8,["show","editMode","editData","startStep"])]))}},Dc=De(Ic,[["__scopeId","data-v-12185d74"]]),xc={class:"toast-container"},Tc={class:"toast-content"},Mc={key:0,class:"toast-title"},Rc={class:"toast-message"},Ec={key:1,class:"toast-description"},Oc=["onClick","title"],Ac={__name:"Toast",setup(t,{expose:c}){const i=g([]);let k=0;function $(f){const S={success:"mdi-check-circle",error:"mdi-alert-circle",warning:"mdi-alert",info:"mdi-information"};return S[f]||S.info}function s({message:f,title:S,description:_,type:L="info",duration:w=5e3}){const n=k++,V={id:n,message:f,title:S,description:_,type:L};return i.value.push(V),w>0&&setTimeout(()=>{m(n)},w),n}function m(f){const S=i.value.findIndex(_=>_.id===f);S>-1&&i.value.splice(S,1)}return c({addToast:s,removeToast:m,show:s,success:(f,S)=>s({message:f,title:S,type:"success"}),error:(f,S)=>s({message:f,title:S,type:"error",duration:0}),warning:(f,S)=>s({message:f,title:S,type:"warning",duration:0}),info:(f,S)=>s({message:f,title:S,type:"info"})}),(f,S)=>(a(),Ne(it,{to:"body"},[e("div",xc,[ke(gt,{name:"toast"},{default:tt(()=>[(a(!0),r(he,null,Ce(i.value,_=>(a(),r("div",{key:_.id,class:G(["toast",[`toast-${_.type}`,{"toast-persistent":_.type==="error"||_.type==="warning"}]])},[e("i",{class:G(["mdi",$(_.type)])},null,2),e("div",Tc,[_.title?(a(),r("div",Mc,v(_.title),1)):A("",!0),e("div",Rc,v(_.message),1),_.description?(a(),r("div",Ec,v(_.description),1)):A("",!0)]),e("button",{onClick:L=>m(_.id),class:G(["toast-close",{"toast-close-prominent":_.type==="error"||_.type==="warning"}]),title:_.type==="error"||_.type==="warning"?"Click to dismiss":"Close"},[...S[0]||(S[0]=[e("i",{class:"mdi mdi-close"},null,-1)])],10,Oc)],2))),128))]),_:1})])]))}},Lc=De(Ac,[["__scopeId","data-v-3948c088"]]),Pc="0.3.0-beta.3",Vc={version:Pc},jc={id:"app",class:"app-container"},Uc={class:"app-header"},Fc={class:"header-content"},Nc={class:"header-right"},Bc=["title"],Hc={class:"settings-menu-container"},qc={key:0,class:"settings-menu"},zc=["title"],Jc={class:"toggle-content"},Wc={key:0,class:"not-installed-label"},Gc={key:0,href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"menu-item menu-link menu-subitem"},Kc=["disabled"],Xc=["disabled"],Yc=["disabled"],Zc={class:"app-main"},Qc={class:"app-footer"},em={__name:"App",setup(t){const c=g(null),i=Vc.version,k=g("light"),$=g(null),s=g(!1),m=g(!1),f=g(!1),S=g(localStorage.getItem("smartir_enabled")!=="false"),_=X(()=>{var b;return((b=$.value)==null?void 0:b.installed)||!1}),L=X(()=>({light:"mdi mdi-weather-sunny",medium:"mdi mdi-weather-partly-cloudy",dark:"mdi mdi-weather-night"})[k.value]),w=X(()=>({light:"Switch to Medium Theme",medium:"Switch to Dark Theme",dark:"Switch to Light Theme"})[k.value]),n=()=>{const b=["light","medium","dark"],p=(b.indexOf(k.value)+1)%b.length;k.value=b[p],document.body.classList.remove("medium-mode","dark-mode"),k.value==="medium"?document.body.classList.add("medium-mode"):k.value==="dark"&&document.body.classList.add("dark-mode"),localStorage.setItem("theme",k.value)},V=async()=>{try{const b=await ut.getStatus();$.value=b,b.installed?console.log("âœ… SmartIR detected:",b.version):console.log("â„¹ï¸ SmartIR not detected")}catch(b){console.error("Error checking SmartIR:",b),$.value={installed:!1,error:b.message}}},z=async()=>{var b,P,p;m.value=!0;try{const ne=(await oe.get("/api/diagnostics/markdown")).data.markdown;if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(ne),(b=c.value)==null||b.success("Diagnostic summary copied to clipboard!");else{const J=document.createElement("textarea");J.value=ne,J.style.position="fixed",J.style.left="-999999px",J.style.top="-999999px",document.body.appendChild(J),J.focus(),J.select();try{if(document.execCommand("copy"))(P=c.value)==null||P.success("Diagnostic summary copied to clipboard!");else throw new Error("execCommand failed")}finally{document.body.removeChild(J)}}s.value=!1}catch(Z){console.error("Error copying diagnostics:",Z),(p=c.value)==null||p.error("Failed to copy diagnostics: "+Z.message)}finally{m.value=!1}},N=async()=>{var b,P;m.value=!0;try{const p=await oe.get("/api/diagnostics/download",{responseType:"blob"}),Z=window.URL.createObjectURL(new Blob([p.data])),ne=document.createElement("a");ne.href=Z;const J=p.headers["content-disposition"];let M="broadlink_manager_diagnostics.zip";if(J){const B=J.match(/filename="?(.+)"?/);B&&(M=B[1])}ne.setAttribute("download",M),document.body.appendChild(ne),ne.click(),ne.remove(),window.URL.revokeObjectURL(Z),(b=c.value)==null||b.success("Diagnostic bundle downloaded!"),s.value=!1}catch(p){console.error("Error downloading diagnostics:",p),(P=c.value)==null||P.error("Failed to download diagnostics")}finally{m.value=!1}},E=b=>{b.target.closest(".settings-menu-container")||(s.value=!1)};Oe(()=>{document.addEventListener("click",E)}),qe(()=>{document.removeEventListener("click",E)});const x=()=>{_.value&&(S.value=!S.value,localStorage.setItem("smartir_enabled",S.value.toString()),window.location.reload())},o=async()=>{var b,P,p;f.value=!0;try{const Z=await oe.post("/api/smartir/refresh-index");Z.data.success?(b=c.value)==null||b.success(`Updated to v${Z.data.version} (${Z.data.total_devices} devices)`,"âœ… Index Updated"):(P=c.value)==null||P.error(Z.data.error||"Unknown error","âŒ Update Failed")}catch(Z){console.error("Error updating SmartIR index:",Z),(p=c.value)==null||p.error("Failed to update device index","âŒ Update Error")}finally{f.value=!1,s.value=!1}};return Oe(async()=>{const b=localStorage.getItem("theme");b&&["light","medium","dark"].includes(b)?(k.value=b,b==="medium"?document.body.classList.add("medium-mode"):b==="dark"&&document.body.classList.add("dark-mode")):localStorage.getItem("darkMode")==="true"&&(k.value="dark",document.body.classList.add("dark-mode"),localStorage.setItem("theme","dark")),await V();const P=nt();P&&c.value&&(P.appContext.config.globalProperties.$toast=c.value),document.addEventListener("click",E)}),qe(()=>{document.removeEventListener("click",E)}),Xe("smartirStatus",$),Xe("smartirEnabled",S),Xe("refreshSmartIR",V),Xe("toast",c),(b,P)=>(a(),r("div",jc,[e("header",Uc,[e("div",Fc,[P[13]||(P[13]=e("div",{class:"header-left"},[e("i",{class:"mdi mdi-remote"}),e("h1",null,"Broadlink Manager v2"),e("span",{class:"beta-badge"},"BETA")],-1)),e("div",Nc,[e("button",{onClick:n,class:"icon-button",title:w.value},[e("i",{class:G(L.value)},null,2)],8,Bc),e("div",Hc,[e("button",{onClick:P[0]||(P[0]=p=>s.value=!s.value),class:"icon-button",title:"Settings"},[...P[2]||(P[2]=[e("i",{class:"mdi mdi-cog"},null,-1)])]),s.value?(a(),r("div",qc,[P[9]||(P[9]=e("div",{class:"menu-section-title"},"Integration Settings",-1)),e("div",{class:G(["menu-item toggle-item",{disabled:!_.value}]),onClick:P[1]||(P[1]=p=>_.value?x():null),title:_.value?"":"SmartIR is not installed"},[e("div",Jc,[P[3]||(P[3]=e("i",{class:"mdi mdi-air-conditioner"},null,-1)),P[4]||(P[4]=e("span",null,"SmartIR Integration",-1)),_.value?A("",!0):(a(),r("span",Wc,"(Not Installed)"))]),e("div",{class:G(["toggle-switch",{active:S.value&&_.value,disabled:!_.value}])},[...P[5]||(P[5]=[e("div",{class:"toggle-slider"},null,-1)])],2)],10,zc),S.value?(a(),r("a",Gc,[...P[6]||(P[6]=[e("i",{class:"mdi mdi-github"},null,-1),e("span",null,"SmartIR on GitHub",-1)])])):A("",!0),S.value?(a(),r("button",{key:1,onClick:o,class:"menu-item menu-subitem",disabled:f.value},[e("i",{class:G(["mdi",f.value?"mdi-loading mdi-spin":"mdi-refresh"])},null,2),e("span",null,v(f.value?"Updating...":"Update Device Index"),1)],8,Kc)):A("",!0),P[10]||(P[10]=e("div",{class:"menu-divider"},null,-1)),P[11]||(P[11]=e("div",{class:"menu-section-title"},"Diagnostics",-1)),e("button",{onClick:z,class:"menu-item",disabled:m.value},[...P[7]||(P[7]=[e("i",{class:"mdi mdi-content-copy"},null,-1),e("span",null,"Copy Diagnostics",-1)])],8,Xc),e("button",{onClick:N,class:"menu-item",disabled:m.value},[...P[8]||(P[8]=[e("i",{class:"mdi mdi-download"},null,-1),e("span",null,"Download Diagnostics",-1)])],8,Yc),P[12]||(P[12]=ze('<div class="menu-divider" data-v-96564cf9></div><div class="menu-section-title" data-v-96564cf9>Help &amp; Support</div><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2#readme" target="_blank" class="menu-item menu-link" data-v-96564cf9><i class="mdi mdi-book-open-variant" data-v-96564cf9></i><span data-v-96564cf9>Documentation</span></a><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2/issues" target="_blank" class="menu-item menu-link" data-v-96564cf9><i class="mdi mdi-bug" data-v-96564cf9></i><span data-v-96564cf9>Report Issue</span></a><div class="menu-divider" data-v-96564cf9></div><div class="menu-section-title" data-v-96564cf9>Community</div><a href="https://community.home-assistant.io/t/broadlink-manager-modern-web-interface-for-broadlink-devices/938473" target="_blank" class="menu-item menu-link" data-v-96564cf9><i class="mdi mdi-forum" data-v-96564cf9></i><span data-v-96564cf9>HA Forum Discussion</span></a><a href="https://www.reddit.com/r/homeassistant/comments/1o1q3kf/release_broadlink_manager_addon_a_modern_web_ui/" target="_blank" class="menu-item menu-link" data-v-96564cf9><i class="mdi mdi-reddit" data-v-96564cf9></i><span data-v-96564cf9>Reddit Discussion</span></a><div class="menu-divider" data-v-96564cf9></div><div class="menu-section-title" data-v-96564cf9>Project</div><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2" target="_blank" class="menu-item menu-link" data-v-96564cf9><i class="mdi mdi-github" data-v-96564cf9></i><span data-v-96564cf9>GitHub Repository</span></a><a href="https://ko-fi.com/tonyperkins" target="_blank" class="menu-item menu-link menu-item-sponsor" data-v-96564cf9><i class="mdi mdi-coffee" data-v-96564cf9></i><span data-v-96564cf9>Support on Ko-fi</span></a>',12))])):A("",!0)])])])]),e("main",Zc,[ke(Dc)]),e("footer",Qc,[e("p",null,"Broadlink Manager v"+v(xe(i))+" | Built with Vue "+v(yt),1)]),ke(Lc,{ref_key:"toastRef",ref:c},null,512)]))}},tm=De(em,[["__scopeId","data-v-96564cf9"]]),ct=bt(tm),om=ht();ct.use(om);ct.mount("#app");
