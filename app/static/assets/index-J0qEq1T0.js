import{g as ot,r as y,o as Te,a as ze,b as ct,d as mt,c as W,e as i,f as n,h as e,i as x,n as K,u as _e,t as f,j as T,F as me,k as he,w as se,l as J,v as Le,m as ue,p as fe,q as We,s as Qe,T as lt,x as De,y as Ee,z as Be,A as ve,B as nt,C as He,D as Fe,E as st,G as Ke,H as vt,I as pt,J as ft,K as Ge,L as gt,M as yt}from"./vendor-DGiFqQ_g.js";(function(){const m=document.createElement("link").relList;if(m&&m.supports&&m.supports("modulepreload"))return;for(const k of document.querySelectorAll('link[rel="modulepreload"]'))w(k);new MutationObserver(k=>{for(const r of k)if(r.type==="childList")for(const v of r.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&w(v)}).observe(document,{childList:!0,subtree:!0});function d(k){const r={};return k.integrity&&(r.integrity=k.integrity),k.referrerPolicy&&(r.referrerPolicy=k.referrerPolicy),k.crossOrigin==="use-credentials"?r.credentials="include":k.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function w(k){if(k.ep)return;k.ep=!0;const r=d(k);fetch(k.href,r)}})();let tt=!1;function Je(){const t=ot(),m=t==null?void 0:t.appContext.config.globalProperties.$toast;return m||(tt||(console.warn("Toast notification system not yet initialized - using console fallback"),tt=!0),{success:d=>console.log("âœ“",d),error:d=>console.error("âœ—",d),warning:d=>console.warn("âš ",d),info:d=>console.info("â„¹",d)})}function et(){const t=y(!1),m=y(!1),d=y(!1),w=y(0),k=767,r=768,v=1023,g=1024,I=()=>{const S=window.innerWidth;w.value=S,t.value=S<=k,m.value=S>=r&&S<=v,d.value=S>=g};return Te(()=>{I(),window.addEventListener("resize",I)}),ze(()=>{window.removeEventListener("resize",I)}),{isMobile:t,isTablet:m,isDesktop:d,screenWidth:w,isMobileOrTablet:()=>t.value||m.value,isTabletOrDesktop:()=>m.value||d.value}}const Ye="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAHBUlEQVR4nOxZC1BTVxo+9+aNZI2LNsgjWR4hgoIiRVDBslKnIKPbx1jqTrtYoakat1a6dNsdd7t1X8XHyAbEhdUu1u2mXdbasqJbtsaMIqBBECiPBmqEICEBEx4xJLlJ7s6lw6rJDeQ2FzLM+M1kBs7/3+/83zn/Oee/51JRFAXzGbCvA/AWjwX4GvNeANWXnXffHQ4+K6/dYbHeD+IFhjRkb1wn9WPQbEQ4IF/tQlXX2p5+/8OyczY74j/VxuMG3Sh/Oz9jaQDb4CmPT1LIbLXBfzrz0cmHg8fQpx1Yc1Ra+TsiXD4R0PqtRmAyj/LxbJeaujKIcPlEAINOM7vLXBaTZibCRWgRq3WGJZWX63aoNDpB8BJOX/bGlIqwpUv6iXBgWBHG7eUF8urUWvU6Z9sLGxI/IsLl8SJu6u4XigqPXkVspiVTbTQqU1/6Vn7ammh+G5FOMZyqludIKqUVU/9jcaSuTCo/unfHbiad4iBdwMu/P1bV1tO1xbk9NDC0/vwHB1xGcjqYLAh16zsHW3R6XXTu1mfFdAqMrIoSKNbGhLcQ4QGeppDJ7ACtPcqNEI6tT9O3Vqm+tygqNMDjrU9Sef6tIYM2JjUuuXzfC5knCEXsBI8WMZUCAxiCrfhWyMZkMNzYXNHVpwmXXqp5j0Hz0/1m57a3PQ8VHx4JoNMASIl9shLPFsB5ooO7iDXhCY/dAcCvT/79LwC1s/K2bDnAXcQeJRqwMzzeRt/bua0gLChcDsCDNQNBkEU/qot7o6j0kzETQpuJ40ZnT6xSrUoNWhyseHVz2ikv4n4QA5FSArE5IFlTZ0r3XU1MWODib6NCl3a9dkhSYxgbjo4XLq8sL9j7Ip36YEwMRjMNQazMhf7+RgYNnuyo7bY6ArFaWKuXRX495wLwoLk39sO9RaVnM5OTP8zLSjtjsljpp6ovi6pqr706eE8XBwGUSqEy9Guihf/92TMZhetjI5rJCHwKpBRzZqsNYtKp6KD+Pvv1w5ILdzR3UvD8HA4YefOl7N25JKUPIKuUwIJH7A5of/GJf7oLfrIz2EH786fSss+uKFzOk+8L0mqh6rpbmR0q5YyFGAQBSuHHlcUWxEaZyXfMhFD0Rgt9Oh/SBMiam58HAO+oc4XZMsK/1taT6M6uHjJw8w6VSNfvemM8TbzPlFlwsP5KyzfJeL6kCejXDgo894aASqOZ9O/uHwzq6B3ijhitkzOC7XS7j0g+V3S0vQTDDhYEoZSBobvJ+yXFNZ29gy4lOGmvlDBMIfQqSKV8539EWvXHhvbGHBSFrAwGW+vvxzLoR7RxzrNpsyPs0xcv7/lg1/ZfPtKvuw7MVhulUakWdvRq+XY3tWFT90Bk+52BCOzvyOBgjytSFKAgms+b9F/2o+BbKwUrvgjhhjSjKLAPG4YE7lJxfEIf5dyGOwMXrren/eF0RYXRNMrHDt4QbmjDEbHop9F8rqpddZd3sV6R/aWiabtWr41PW534V8m+PFHW+qSPL9TX7oM8WAaBi4IbE4S8yYNs/7asIgBA0ZStRqFM/MXxIzcgHBEBP+C6DJKLgJvK3uXvniitBsDmNzkSEAD9uv5k0aFjXy1gMQ0DQ5p4CAIwNuXLwyL/ExcpqMWeS42NUmxKXFf8VWPdz6cLnkqhGd/Pe+U1Cow/+ekJUYr4qJgvbik7f/Jw+0J/tjpvS3qxs7/LQZZfcrrkUmOdGI/cgUKIkB8pz0xK+CQjKf6z4MWckYftZqsderfsTInsZt0evDRgMRYMHhaLnk+NW1Y/nchxk5lZ+I/Pf/vl9RvbLYiVlSBcJv/VK9sKBCHc3hkF7D12/NzVltZn8YhzNj/3ev6LGeXTdQ6+uzLZ+C+5XNza05Nsd1gXcNgBvekJK/+du3lTUSiXMzzT80TgkkK8wJAGgCMAE5ooFFz3hHTr+lgZ9iMryOngkoi5WZuOc9hPtDu3r4198nTqygjCr3wYmrvVkSerZXljJoT0m0DcYm5g2Mg5WV39zrVWZZofkzaRnhB/bufm9FI/JpXQXj8F8bHyitqWxhzJmwUJT60SNJER+P+BCZjt34lzNbvickRoWVWNmGzuObnYWhER3oAdX41dPbj1jDeYEwGrInltKKCNtatub6hRfJOEnfJkcc+JgE9ltS/DkINuNI3xCo4fbXgm/0CnouvOcjK4Z/16/ZKia+3+kqIrEIQ+sgNx2Jzb5wsPxrD9GBZv+Gd9BqSXr4icg8cwMj4SLmv6+mlv+WddgGlilOPOZkEmFnrLP+sCVgtXyPHaHShkiw0XXPWWf9YF5Gb9uGzp4sCbj7ai4LkNTx2O5nPV3vLPyTeye6P32X+7KNujVKtSYJg+viEu/mx2etJZCgnD57OPfGRh3n8nfizA15j3Av4XAAD//5k1S2w3zfwVAAAAAElFTkSuQmCC",ee=ct.create({baseURL:"./",timeout:3e4,headers:{"Content-Type":"application/json","Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"}});ee.interceptors.request.use(t=>t,t=>Promise.reject(t));ee.interceptors.response.use(t=>t,t=>(console.error("API Error:",t),t.response?console.error("Response error:",t.response.data):t.request?console.error("No response received"):console.error("Request setup error:",t.message),Promise.reject(t)));const bt=mt("devices",{state:()=>({devices:[],loading:!1,error:null,selectedDevice:null}),getters:{deviceById:t=>m=>t.devices.find(d=>d.id===m),devicesByType:t=>m=>t.devices.filter(d=>d.entity_type===m),deviceCount:t=>t.devices.length,hasDevices:t=>t.devices.length>0},actions:{async loadDevices(t=!1){this.loading=!0,this.error=null;try{const m=t?`/api/devices/managed?_t=${Date.now()}`:"/api/devices/managed",d=await ee.get(m);this.devices=d.data.devices||[],console.log("ðŸ“¥ Loaded devices:",this.devices),this.devices.forEach(w=>{console.log(`ðŸ“¥ Device "${w.name}":`,{id:w.id,device:w.device,commands:w.commands,commandCount:w.commands?Object.keys(w.commands).length:0})})}catch(m){this.error=m.message,console.error("Error loading devices:",m)}finally{this.loading=!1}},async createDevice(t){this.loading=!0,this.error=null;try{console.log("ðŸª Store: Creating device with data:",t),console.log("ðŸª Store: Device commands being sent:",t.commands);const m={device_name:t.name,device:t.device,area_id:t.area||"",area_name:t.area||"",entity_type:t.entity_type,icon:t.icon,broadlink_entity:t.broadlink_entity,device_type:t.device_type||"broadlink",commands:t.commands||{}};t.device_type==="smartir"&&t.smartir_config&&(m.smartir_config=t.smartir_config),console.log("ðŸª Store: Transformed data for backend:",m);const d=await ee.post("/api/devices/managed",m);return console.log("ðŸª Store: Create response:",d.data),await this.loadDevices(),d.data}catch(m){throw console.error("Error creating device:",m),m}finally{this.loading=!1}},async updateDevice(t,m){this.loading=!0,this.error=null;try{const d=await ee.put(`/api/devices/managed/${t}`,m);return await this.loadDevices(),d.data}catch(d){throw console.error("Error updating device:",d),d}finally{this.loading=!1}},async deleteDevice(t,m=!1){this.loading=!0,this.error=null;try{await ee.delete(`/api/devices/managed/${t}`,{data:{delete_commands:m}}),this.devices=this.devices.filter(d=>d.id!==t)}catch(d){throw this.error=d.message,console.error("Error deleting device:",d),d}finally{this.loading=!1}},selectDevice(t){this.selectedDevice=t},clearSelection(){this.selectedDevice=null},clearError(){this.error=null},updateDeviceCommands(t,m){const d=this.devices.findIndex(w=>w.id===t);if(d!==-1){const w={...this.devices[d],commands:m};this.devices.splice(d,1,w),console.log(`âœ… Store: Updated commands for ${t}, count: ${Object.keys(m).length}`)}else console.warn(`âš ï¸ Store: Device ${t} not found for command update`)},async syncAllAreas(){if(!this.devices||this.devices.length===0){console.log("âš ï¸ No devices to sync");return}console.log(`ðŸ”„ Syncing areas from Home Assistant for ${this.devices.length} devices...`);try{const t=await Promise.all(this.devices.map(w=>(console.log(`ðŸ”„ Syncing device: ${w.id} (${w.name})`),ee.post(`/api/devices/${w.id}/sync-area`).then(k=>k.data.success&&k.data.area?(console.log(`âœ… Synced area for ${w.name}: ${k.data.area}`),{status:"synced",device:w.name}):{status:"no_area"}).catch(k=>{var r;return((r=k.response)==null?void 0:r.status)===404?(console.log(`âŒ Device not found in HA: ${w.id}`),{status:"not_found"}):(console.warn(`âš ï¸ Failed to sync area for ${w.id}:`,k.message),{status:"error",error:k.message})})))),m=t.filter(w=>w.status==="synced").length,d=t.filter(w=>w.status==="not_found").length;await this.loadDevices(!0),m>0?console.log(`âœ… Area sync complete: ${m} synced, ${d} not found in HA`):d>0&&console.log(`â„¹ï¸ No areas synced - ${d} entities not found in HA registry (generate entities first)`)}catch(t){console.debug("Area sync error:",t)}}}});function at(t){const m=W(()=>t.value||t),d=W(()=>{switch(m.value){case"climate":return"mdi:air-conditioner";case"fan":return"mdi:fan";case"light":return"mdi:lightbulb";case"media_player":return"mdi:television";case"switch":return"mdi:light-switch";default:return"mdi:devices"}}),w=W(()=>`device-type-${m.value}-color`),k=W(()=>`tag-${m.value}-bg`);return{icon:d,colorClass:w,tagBgClass:k}}const it=""+new URL("broadlink-logo-BDjImjRY.png",import.meta.url).href,$e=(t,m)=>{const d=t.__vccOpts||t;for(const[w,k]of m)d[w]=k;return d},ht={class:"device-header"},kt={class:"device-info"},wt=["title"],$t={class:"device-labels"},Ct={class:"device-type"},_t=["src","alt","title"],St={class:"device-body"},It={class:"device-stats"},Dt={class:"stat",title:"Learned command count"},Tt={class:"stat",title:"HA Assigned Area"},xt={class:"device-meta"},Rt={class:"device-id",title:"Device ID"},Mt={key:0,class:"storage-name"},Et={key:1,class:"broadlink-entity",title:"Controller Device"},At={key:2,class:"controller-device"},Lt={class:"device-actions"},Ot=["disabled"],Pt=["disabled"],Vt=["disabled"],Ut={key:0,class:"disabled-overlay"},Ft={__name:"DeviceCard",props:{device:{type:Object,required:!0},broadlinkDevices:{type:Array,default:()=>[]}},emits:["edit","delete","learn"],setup(t){const m=t,d=W(()=>localStorage.getItem("smartir_simulate_not_installed")==="true"),w=W(()=>m.device.device_type==="smartir"&&d.value),k=y(null),r=at(W(()=>m.device.entity_type)),v=W(()=>m.device.icon?m.device.icon:r.icon.value),g=a=>a&&a.startsWith("mdi:")?`mdi ${a.replace(":"," mdi-")}`:`mdi mdi-${a}`,I=W(()=>({light:"Light",fan:"Fan",switch:"Switch",media_player:"Media Player",cover:"Cover"})[m.device.entity_type]||m.device.entity_type),S=W(()=>(m.device.device_type||"broadlink")==="smartir"?"SmartIR":"Broadlink"),A=W(()=>(m.device.device_type||"broadlink")==="smartir"?Ye:it),$=W(()=>(m.device.device_type||"broadlink")==="smartir"?k.value!==null?k.value:0:Object.keys(m.device.commands||{}).length),o=a=>{if(!a)return"";const b=m.broadlinkDevices.find(u=>u.entity_id===a);return b&&b.name||a},L=W(()=>{if(!m.device.device)return!1;const a=m.device.id.includes(".")?m.device.id.split(".")[1]:m.device.id;return m.device.device!==a}),H=W(()=>{if(!m.device.broadlink_entity)return"";const a=m.broadlinkDevices.find(b=>b.entity_id===m.device.broadlink_entity);return a&&a.name||m.device.broadlink_entity}),F=a=>{if(!a||typeof a!="object")return 0;let b=0;for(const u of Object.values(a))typeof u=="string"?b++:typeof u=="object"&&(b+=F(u));return b},U=async()=>{if(!(!m.device.device_code||!m.device.entity_type))try{const a=await ee.get("/api/smartir/codes/code",{params:{entity_type:m.device.entity_type,code_id:m.device.device_code}});if(a.data.success&&a.data.code){const b=a.data.code;b.commands&&(k.value=F(b.commands))}}catch(a){console.error("Error fetching SmartIR command count:",a)}};return Te(async()=>{(m.device.device_type||"broadlink")==="smartir"&&await U()}),(a,b)=>(n(),i("div",{class:K(["device-card",{disabled:w.value}])},[e("div",ht,[e("div",{class:K(["device-icon",_e(r).colorClass.value])},[e("i",{class:K(g(v.value))},null,2)],2),e("div",kt,[e("h3",{title:t.device.name},f(t.device.name),9,wt),e("div",$t,[e("span",Ct,f(I.value),1)])]),e("img",{src:A.value,alt:S.value,title:S.value,class:"device-source-logo"},null,8,_t)]),e("div",St,[e("div",It,[e("div",Dt,[b[3]||(b[3]=e("i",{class:"mdi mdi-remote"},null,-1)),e("span",null,f($.value)+" command"+f($.value!==1?"s":""),1)]),e("div",Tt,[b[4]||(b[4]=e("i",{class:"mdi mdi-map-marker"},null,-1)),e("span",null,f(t.device.area||"No area"),1)])]),e("div",xt,[e("span",Rt,[b[5]||(b[5]=e("i",{class:"mdi mdi-identifier"},null,-1)),T(" "+f(t.device.id),1)]),L.value?(n(),i("span",Mt,[b[6]||(b[6]=e("i",{class:"mdi mdi-code-tags"},null,-1)),T(" "+f(t.device.device),1)])):x("",!0),t.device.broadlink_entity?(n(),i("span",Et,[b[7]||(b[7]=e("i",{class:"mdi mdi-access-point"},null,-1)),T(" "+f(H.value),1)])):x("",!0),t.device.controller_device?(n(),i("span",At,[b[8]||(b[8]=e("i",{class:"mdi mdi-access-point"},null,-1)),T(" "+f(o(t.device.controller_device)),1)])):x("",!0)])]),e("div",Lt,[e("button",{onClick:b[0]||(b[0]=u=>!w.value&&a.$emit("learn",t.device)),class:"icon-btn",title:"Manage Commands",disabled:w.value},[...b[9]||(b[9]=[e("i",{class:"mdi mdi-remote-tv"},null,-1)])],8,Ot),e("button",{onClick:b[1]||(b[1]=u=>!w.value&&a.$emit("edit",t.device)),class:"icon-btn",title:"Edit",disabled:w.value},[...b[10]||(b[10]=[e("i",{class:"mdi mdi-pencil"},null,-1)])],8,Pt),e("button",{onClick:b[2]||(b[2]=u=>!w.value&&a.$emit("delete",t.device)),class:"icon-btn danger",title:"Delete",disabled:w.value},[...b[11]||(b[11]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,Vt)]),w.value?(n(),i("div",Ut,[...b[12]||(b[12]=[e("div",{class:"disabled-message"},[e("i",{class:"mdi mdi-eye-off"}),e("span",null,"SmartIR Not Installed")],-1)])])):x("",!0)],2))}},jt=$e(Ft,[["__scopeId","data-v-7a7f5c18"]]),Nt={name:"DeviceListView",props:{devices:{type:Array,required:!0}},methods:{getDeviceSourceLogo(t){return(t.device_type||"broadlink")==="smartir"?Ye:it},getDeviceCommands(t){return t.commands&&typeof t.commands=="object"?Object.keys(t.commands):[]},getCommandType(t,m){return t.commands&&t.commands[m]&&t.commands[m].type||"ir"},getCommandTypeClass(t,m){return this.getCommandType(t,m)==="rf"?"command-rf":"command-ir"},getCommandTypeLabel(t,m){return this.getCommandType(t,m)==="rf"?"RF Command":"IR Command"},sendCommand(t,m){this.$emit("send-command",{device:t,command:m})},openCommands(t){this.$emit("open-commands",t)},editDevice(t){this.$emit("edit-device",t)},deleteDevice(t){this.$emit("delete-device",t)}}},Bt={class:"device-list-view"},Ht={class:"device-table"},qt={class:"device-info"},zt={class:"device-name"},Jt={class:"device-entity"},Wt={class:"device-area"},Gt={class:"device-type"},Kt=["src","alt","title"],Xt={class:"device-commands"},Yt={key:0,class:"command-list"},Zt=["onClick","title"],Qt={key:0,class:"no-commands"},eo={key:1,class:"smartir-info"},to={class:"profile-code"},oo={class:"device-actions"},lo=["onClick"],no=["onClick"],so=["onClick"];function ao(t,m,d,w,k,r){return n(),i("div",Bt,[e("table",Ht,[m[3]||(m[3]=e("thead",null,[e("tr",null,[e("th",null,"Device"),e("th",null,"Room/Area"),e("th",null,"Type"),e("th",null,[e("div",{class:"commands-header"},[e("span",null,"Commands"),e("div",{class:"command-legend"},[e("span",{class:"legend-badge command-rf"},"RF"),e("span",{class:"legend-badge command-ir"},"IR")])])]),e("th",null,"Actions")])],-1)),e("tbody",null,[(n(!0),i(me,null,he(d.devices,v=>(n(),i("tr",{key:v.entity_id,class:"device-row"},[e("td",qt,[e("div",zt,f(v.friendly_name||v.name),1),e("div",Jt,f(v.entity_id),1)]),e("td",Wt,f(v.area||"No Area"),1),e("td",Gt,[e("img",{src:r.getDeviceSourceLogo(v),alt:v.device_type==="smartir"?"SmartIR":"Broadlink",title:v.device_type==="smartir"?"SmartIR":"Broadlink",class:"device-source-logo"},null,8,Kt)]),e("td",Xt,[(v.device_type||"broadlink")==="broadlink"?(n(),i("div",Yt,[(n(!0),i(me,null,he(r.getDeviceCommands(v),g=>(n(),i("button",{key:g,class:K(["command-btn",r.getCommandTypeClass(v,g)]),onClick:I=>r.sendCommand(v,g),title:r.getCommandTypeLabel(v,g)},f(g),11,Zt))),128)),r.getDeviceCommands(v).length===0?(n(),i("span",Qt," No commands ")):x("",!0)])):v.device_type==="smartir"?(n(),i("div",eo,[e("span",to,"Profile: "+f(v.device_code),1)])):x("",!0)]),e("td",oo,[e("button",{class:"action-btn commands",onClick:g=>r.openCommands(v),title:"Manage Commands"},[...m[0]||(m[0]=[e("i",{class:"mdi mdi-remote-tv"},null,-1)])],8,lo),e("button",{class:"action-btn edit",onClick:g=>r.editDevice(v),title:"Edit"},[...m[1]||(m[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})],-1)])],8,no),e("button",{class:"action-btn delete",onClick:g=>r.deleteDevice(v),title:"Delete"},[...m[2]||(m[2]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"3 6 5 6 21 6"}),e("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})],-1)])],8,so)])]))),128))])])])}const io=$e(Nt,[["render",ao],["__scopeId","data-v-2895a204"]]),ro={class:"icon-picker"},uo={class:"icon-input-wrapper"},co=["id","placeholder"],mo={key:0,class:"icon-preview"},vo={key:0,class:"icon-dropdown"},po={class:"icon-grid"},fo=["onMousedown","title"],go={__name:"IconPicker",props:{modelValue:{type:String,default:""},inputId:{type:String,default:"icon-input"},placeholder:{type:String,default:"e.g., mdi:television"}},emits:["update:modelValue"],setup(t,{emit:m}){const d=t,w=m,k=y(d.modelValue),r=y(!1),v=["television","speaker","radio","music","video","movie","play","pause","stop","skip-next","skip-previous","volume-high","volume-medium","volume-low","volume-off","remote","remote-tv","cast","chromecast","spotify","netflix","youtube","lightbulb","lightbulb-on","lightbulb-off","lamp","floor-lamp","ceiling-light","light-switch","led-strip","led-strip-variant","wall-sconce","chandelier","spotlight","track-light","vanity-light","desk-lamp","fan","ceiling-fan","air-conditioner","thermometer","thermostat","heat-wave","snowflake","fire","radiator","water-boiler","hvac","blinds","blinds-open","window-shutter","window-shutter-open","curtains","curtains-closed","roller-shade","roller-shade-closed","garage","garage-open","gate","door","door-open","window-open","window-closed","washing-machine","tumble-dryer","dishwasher","refrigerator","stove","microwave","oven","toaster","kettle","coffee","coffee-maker","blender","robot-vacuum","robot-vacuum-variant","vacuum","broom","spray-bottle","lock","lock-open","lock-smart","key","shield","shield-check","alarm-light","bell","doorbell","camera","cctv","motion-sensor","smoke-detector","fire-extinguisher","water-alert","gas-cylinder","sofa","bed","bed-double","desk","chair","table","bookshelf","home","home-outline","home-assistant","floor-plan","room","weather-sunny","weather-night","weather-cloudy","weather-rainy","weather-snowy","weather-lightning","weather-windy","weather-fog","weather-partly-cloudy","umbrella","water","water-percent","phone","cellphone","tablet","laptop","desktop-tower","monitor","keyboard","mouse","printer","router","router-wireless","access-point","wifi","bluetooth","usb","hdmi-port","ethernet","power","power-plug","power-socket","battery","battery-charging","lightning-bolt","flash","solar-panel","solar-power","leaf","tree","flower","sprout","grass","watering-can","shovel","fence","pool","hot-tub","silverware","silverware-fork-knife","food","food-apple","glass-wine","glass-cocktail","bottle-wine","pot","pot-steam","shower","shower-head","bathtub","toilet","sink","faucet","hand-wash","car","car-side","garage-variant","tools","hammer","wrench","screwdriver","toolbox","ladder","heart","heart-pulse","run","walk","bike","dumbbell","yoga","scale-bathroom","thermometer-lines","clock","clock-outline","timer","alarm","calendar","calendar-today","calendar-clock","history","bell-ring","bell-alert","alert","alert-circle","information","help-circle","check","check-circle","close-circle","minus-circle","plus-circle","arrow-up","arrow-down","arrow-left","arrow-right","chevron-up","chevron-down","menu","dots-vertical","dots-horizontal","cog","tune","circle","square","triangle","hexagon","star","star-outline","heart-outline","plus","minus","close","check-bold","eye","eye-off","account","account-group","baby","dog","cat","paw","gift","balloon","party-popper","candle","book","book-open","newspaper","email","message","phone-classic"];se(()=>d.modelValue,$=>{k.value=$});const g=W(()=>{if(!k.value)return v.slice(0,50);const $=k.value.toLowerCase().replace("mdi:","");return v.filter(o=>o.toLowerCase().includes($)).slice(0,50)}),I=()=>{r.value=!0,w("update:modelValue",k.value)},S=()=>{setTimeout(()=>{r.value=!1},200)},A=$=>{k.value=`mdi:${$}`,w("update:modelValue",k.value),r.value=!1};return($,o)=>(n(),i("div",ro,[e("div",uo,[J(e("input",{id:t.inputId,"onUpdate:modelValue":o[0]||(o[0]=L=>k.value=L),type:"text",placeholder:t.placeholder,onInput:I,onFocus:o[1]||(o[1]=L=>r.value=!0),onBlur:S},null,40,co),[[Le,k.value]]),k.value?(n(),i("div",mo,[e("i",{class:K(`mdi mdi-${k.value.replace("mdi:","")}`)},null,2)])):x("",!0)]),r.value&&g.value.length>0?(n(),i("div",vo,[e("div",po,[(n(!0),i(me,null,he(g.value,L=>(n(),i("div",{key:L,class:"icon-option",onMousedown:ue(H=>A(L),["prevent"]),title:L},[e("i",{class:K(`mdi mdi-${L}`)},null,2),e("span",null,f(L),1)],40,fo))),128))])])):x("",!0)]))}},yo=$e(go,[["__scopeId","data-v-a64f5011"]]),bo={key:0,class:"dropdown-label"},ho={key:0,class:"required"},ko=["placeholder","disabled","onKeydown"],wo={class:"dropdown-icons"},$o={key:0,class:"mdi mdi-loading mdi-spin"},Co={key:2,class:"mdi mdi-chevron-down"},_o={key:1,class:"error-message"},So={key:2,class:"hint-message"},Io={key:0,class:"dropdown-menu"},Do=["onMousedown","onMouseenter"],To={class:"option-content"},xo={class:"option-label"},Ro={key:0,class:"option-description"},Mo={key:0,class:"mdi mdi-check selected-icon"},Eo={key:3,class:"dropdown-menu"},Ao={__name:"SearchableDropdown",props:{modelValue:{type:[String,Number,Object],default:null},options:{type:Array,required:!0,default:()=>[]},label:{type:String,default:""},placeholder:{type:String,default:"Search..."},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},error:{type:String,default:""},hint:{type:String,default:""},optionLabel:{type:String,default:"label"},optionValue:{type:String,default:"value"},optionDescription:{type:String,default:"description"},filterMethod:{type:Function,default:null}},emits:["update:modelValue","change","search"],setup(t,{emit:m}){const d=t,w=m,k=y(null),r=y(null),v=y(""),g=y(!1),I=y(0),S=y(!1),A=M=>typeof M=="string"||typeof M=="number"?M:M[d.optionLabel]||M.label||M.name||String(M),$=M=>typeof M=="string"||typeof M=="number"?M:M[d.optionValue]||M.value||M.id||M,o=M=>typeof M=="string"||typeof M=="number"?"":M[d.optionDescription]||M.description||"",L=M=>{const j=$(M);return typeof d.modelValue=="object"?$(d.modelValue)===j:d.modelValue===j},H=W(()=>{if(!v.value)return d.options;if(d.filterMethod)return d.options.filter(j=>d.filterMethod(j,v.value));const M=v.value.toLowerCase();return d.options.filter(j=>{const oe=A(j).toLowerCase(),ie=o(j).toLowerCase();return oe.includes(M)||ie.includes(M)})}),F=W(()=>{if(!d.modelValue)return"";const M=d.options.find(j=>{const oe=$(j);return typeof d.modelValue=="object"?oe===$(d.modelValue):oe===d.modelValue});return M?A(M):""});se(()=>d.modelValue,M=>{S.value||(v.value=F.value)}),se(()=>d.options,()=>{!S.value&&d.modelValue&&(v.value=F.value)},{deep:!0}),se(v,M=>{w("search",M),I.value=0}),Te(()=>{v.value=F.value});const U=()=>{var M;S.value=!0,g.value=!0,(M=r.value)==null||M.select()},a=()=>{S.value=!1,setTimeout(()=>{g.value=!1,d.modelValue?v.value=F.value:v.value=""},200)},b=()=>{var M;g.value=!1,(M=r.value)==null||M.blur()},u=M=>{const j=$(M);w("update:modelValue",j),w("change",j,M),v.value=A(M),b()},O=()=>{var M;w("update:modelValue",null),w("change",null,null),v.value="",(M=r.value)==null||M.focus()},z=()=>{if(!g.value){g.value=!0;return}I.value<H.value.length-1&&I.value++},Y=()=>{I.value>0&&I.value--},P=()=>{H.value.length>0&&I.value>=0&&u(H.value[I.value])},te=M=>{k.value&&!k.value.contains(M.target)&&(g.value=!1,d.modelValue?v.value=F.value:v.value="")};return Te(()=>{document.addEventListener("click",te)}),ze(()=>{document.removeEventListener("click",te)}),(M,j)=>(n(),i("div",{class:"searchable-dropdown",ref_key:"dropdownRef",ref:k},[t.label?(n(),i("label",bo,[T(f(t.label)+" ",1),t.required?(n(),i("span",ho,"*")):x("",!0)])):x("",!0),e("div",{class:K(["dropdown-input-wrapper",{"has-error":t.error,disabled:t.disabled}])},[J(e("input",{ref_key:"inputRef",ref:r,type:"text","onUpdate:modelValue":j[0]||(j[0]=oe=>v.value=oe),placeholder:t.placeholder,disabled:t.disabled||t.loading,onFocus:U,onBlur:a,onKeydown:[We(ue(z,["prevent"]),["down"]),We(ue(Y,["prevent"]),["up"]),We(ue(P,["prevent"]),["enter"]),We(b,["escape"])],class:"dropdown-input"},null,40,ko),[[Le,v.value]]),e("div",wo,[t.loading?(n(),i("i",$o)):t.modelValue&&!t.disabled?(n(),i("i",{key:1,class:"mdi mdi-close-circle clear-icon",onClick:O})):(n(),i("i",Co))])],2),t.error?(n(),i("div",_o,f(t.error),1)):x("",!0),t.hint&&!t.error?(n(),i("div",So,f(t.hint),1)):x("",!0),fe(lt,{name:"dropdown"},{default:Qe(()=>[g.value&&H.value.length>0?(n(),i("div",Io,[(n(!0),i(me,null,he(H.value,(oe,ie)=>(n(),i("div",{key:$(oe),class:K(["dropdown-item",{highlighted:ie===I.value,selected:L(oe)}]),onMousedown:ue(ge=>u(oe),["prevent"]),onMouseenter:ge=>I.value=ie},[e("div",To,[e("div",xo,f(A(oe)),1),o(oe)?(n(),i("div",Ro,f(o(oe)),1)):x("",!0)]),L(oe)?(n(),i("i",Mo)):x("",!0)],42,Do))),128))])):x("",!0)]),_:1}),g.value&&H.value.length===0&&!t.loading?(n(),i("div",Eo,[...j[1]||(j[1]=[e("div",{class:"dropdown-item no-results"},[e("i",{class:"mdi mdi-magnify"}),T(" No results found ")],-1)])])):x("",!0)],512))}},Xe=$e(Ao,[["__scopeId","data-v-679ce35f"]]),Lo={class:"smartir-selector"},Oo={class:"form-group"},Po={class:"form-group"},Vo={class:"form-group"},Uo=["value"],Fo={key:0,class:"error-message"},jo={class:"form-group"},No={class:"form-group"},Bo={key:1,class:"code-info"},Ho={class:"info-content"},qo={class:"info-row"},zo={class:"info-value"},Jo={class:"info-row"},Wo={class:"info-value"},Go={key:0,class:"info-row"},Ko={class:"info-value"},Xo={class:"info-row"},Yo={class:"info-value"},Zo={__name:"SmartIRDeviceSelector",props:{entityType:{type:String,required:!0},modelValue:{type:Object,default:()=>({})},broadlinkDevices:{type:Array,default:()=>[]}},emits:["update:modelValue","change"],setup(t,{expose:m,emit:d}){const w=t,k=d,r=y([]),v=y([]),g=y(""),I=y(""),S=y(""),A=y(""),$=y(""),o=y(null),L=y(!1),H=y(!1),F=y({manufacturer:"",model:"",controller:""});Te(async()=>{if(await U(),w.modelValue&&(g.value=w.modelValue.manufacturer||"",I.value=w.modelValue.device_code||"",S.value=w.modelValue.controller_device||"",A.value=w.modelValue.temperature_sensor||"",$.value=w.modelValue.humidity_sensor||"",g.value&&(await a(g.value),I.value&&v.value.length>0))){const M=v.value.find(j=>j.code===I.value);M&&(o.value={code:M.code,manufacturer:g.value,models:M.models,controller:M.controller})}}),se(()=>w.entityType,async M=>{M&&(g.value="",I.value="",v.value=[],o.value=null,await U())});const U=async()=>{if(w.entityType){L.value=!0,F.value.manufacturer="";try{const M=await ee.get("/api/smartir/codes/manufacturers",{params:{entity_type:w.entityType}});if(M.data.success)r.value=M.data.manufacturers||[];else throw new Error(M.data.error||"Failed to load manufacturers")}catch(M){console.error("Error loading manufacturers:",M),F.value.manufacturer="Failed to load manufacturers. Please try again.",r.value=[]}finally{L.value=!1}}},a=async M=>{if(!(!M||!w.entityType)){H.value=!0,F.value.model="";try{const j=await ee.get("/api/smartir/codes/models",{params:{entity_type:w.entityType,manufacturer:M}});if(j.data.success){const oe=j.data.models||[];v.value=oe.map(ie=>{const ge=ie.models&&ie.models.length>0?ie.models.join(", "):`Code ${ie.code}`;return{code:ie.code,label:ge,description:`Code: ${ie.code}`,models:ie.models,controller:ie.controller}})}else throw new Error(j.data.error||"Failed to load models")}catch(j){console.error("Error loading models:",j),F.value.model="Failed to load models. Please try again.",v.value=[]}finally{H.value=!1}}},b=async M=>{g.value=M,I.value="",o.value=null,v.value=[],M&&await a(M),P()},u=()=>{const M=v.value.find(j=>j.code===I.value);M&&(o.value={code:M.code,manufacturer:g.value,models:M.models,controller:M.controller}),P()},O=()=>{P()},z=()=>{P()},Y=()=>{P()},P=()=>{var j,oe;const M={manufacturer:g.value,model:((oe=(j=o.value)==null?void 0:j.models)==null?void 0:oe[0])||"",device_code:I.value,controller_device:S.value};w.entityType==="climate"&&(A.value&&(M.temperature_sensor=A.value),$.value&&(M.humidity_sensor=$.value)),k("update:modelValue",M),k("change",M)};return m({validate:()=>{let M=!0;return F.value={manufacturer:"",model:"",controller:""},g.value||(F.value.manufacturer="Manufacturer is required",M=!1),I.value||(F.value.model="Model is required",M=!1),S.value||(F.value.controller="Broadlink controller is required",M=!1),M}}),(M,j)=>(n(),i("div",Lo,[e("div",Oo,[fe(Xe,{modelValue:g.value,"onUpdate:modelValue":j[0]||(j[0]=oe=>g.value=oe),options:r.value,label:"Manufacturer",placeholder:"Search manufacturers...",required:"",loading:L.value,error:F.value.manufacturer,hint:"Select the device manufacturer",onChange:b},null,8,["modelValue","options","loading","error"])]),e("div",Po,[fe(Xe,{modelValue:I.value,"onUpdate:modelValue":j[1]||(j[1]=oe=>I.value=oe),options:v.value,"option-label":"label","option-value":"code","option-description":"description",label:"Model",placeholder:"Search models...",required:"",disabled:!g.value,loading:H.value,error:F.value.model,hint:"Select the device model",onChange:u},null,8,["modelValue","options","disabled","loading","error"])]),e("div",Vo,[j[6]||(j[6]=e("label",{for:"controller-device"},[e("i",{class:"mdi mdi-remote"}),T(" Controller Device * ")],-1)),J(e("select",{id:"controller-device","onUpdate:modelValue":j[2]||(j[2]=oe=>S.value=oe),required:"",onChange:O},[j[5]||(j[5]=e("option",{value:""},"-- Select Controller Device --",-1)),(n(!0),i(me,null,he(t.broadlinkDevices,oe=>(n(),i("option",{key:oe.entity_id,value:oe.entity_id},[T(f(oe.name||oe.entity_id)+" ",1),oe.area_name?(n(),i(me,{key:0},[T(" - "+f(oe.area_name),1)],64)):x("",!0)],8,Uo))),128))],544),[[De,S.value]]),j[7]||(j[7]=e("small",null,"Which remote device will send the IR/RF commands",-1)),F.value.controller?(n(),i("div",Fo,f(F.value.controller),1)):x("",!0)]),t.entityType==="climate"?(n(),i(me,{key:0},[e("div",jo,[j[8]||(j[8]=e("label",{for:"temperature-sensor"},"Temperature Sensor",-1)),J(e("input",{id:"temperature-sensor","onUpdate:modelValue":j[3]||(j[3]=oe=>A.value=oe),type:"text",placeholder:"e.g., sensor.living_room_temperature",onInput:z},null,544),[[Le,A.value]]),j[9]||(j[9]=e("small",null,"Optional: Temperature sensor entity for current temperature",-1))]),e("div",No,[j[10]||(j[10]=e("label",{for:"humidity-sensor"},"Humidity Sensor",-1)),J(e("input",{id:"humidity-sensor","onUpdate:modelValue":j[4]||(j[4]=oe=>$.value=oe),type:"text",placeholder:"e.g., sensor.living_room_humidity",onInput:Y},null,544),[[Le,$.value]]),j[11]||(j[11]=e("small",null,"Optional: Humidity sensor entity for current humidity",-1))])],64)):x("",!0),o.value?(n(),i("div",Bo,[j[16]||(j[16]=e("div",{class:"info-header"},[e("i",{class:"mdi mdi-information"}),e("span",null,"Selected Device Code")],-1)),e("div",Ho,[e("div",qo,[j[12]||(j[12]=e("span",{class:"info-label"},"Code ID:",-1)),e("span",zo,f(o.value.code_id),1)]),e("div",Jo,[j[13]||(j[13]=e("span",{class:"info-label"},"Manufacturer:",-1)),e("span",Wo,f(o.value.manufacturer),1)]),o.value.models&&o.value.models.length>0?(n(),i("div",Go,[j[14]||(j[14]=e("span",{class:"info-label"},"Supported Models:",-1)),e("span",Ko,f(o.value.models.join(", ")),1)])):x("",!0),e("div",Xo,[j[15]||(j[15]=e("span",{class:"info-label"},"Controller:",-1)),e("span",Yo,f(o.value.controller||"Broadlink"),1)])])])):x("",!0)]))}},Qo=$e(Zo,[["__scopeId","data-v-1911c8f6"]]),el={class:"modal-content"},tl={class:"modal-header"},ol={class:"input-wrapper"},ll={key:0,class:"validation-tooltip"},nl={class:"input-wrapper"},sl=["disabled"],al={key:0,class:"validation-tooltip"},il={key:0,class:"smartir-notice"},rl={key:0,class:"notice-success"},dl={key:1,class:"notice-warning"},ul={key:1,class:"smartir-notice"},cl={key:2},ml={class:"form-group"},vl=["disabled"],pl=["disabled"],fl={key:0},gl={key:1},yl={key:2},bl={key:3},hl={key:0,class:"form-group"},kl={class:"area-display-readonly"},wl=["value"],$l=["disabled"],Cl=["href"],_l={key:1,class:"form-group"},Sl={class:"form-group"},Il={class:"input-wrapper"},Dl=["value"],Tl=["value"],xl={key:2,class:"validation-tooltip"},Rl={key:0},Ml={key:1},El={key:3,class:"smartir-section"},Al={class:"modal-footer"},Ll={type:"submit",form:"device-form",class:"btn btn-primary"},Ol={__name:"DeviceForm",props:{device:{type:Object,default:null}},emits:["save","cancel"],setup(t,{emit:m}){const d=t,w=m,k=Ee("smartirStatus"),r=Ee("smartirEnabled"),v=W(()=>{var p;return localStorage.getItem("smartir_simulate_not_installed")==="true"?!1:((p=k==null?void 0:k.value)==null?void 0:p.installed)||!1}),g=W(()=>!!d.device),I=W(()=>["climate","media_player","fan","light"].includes(o.value.entity_type)),S=W(()=>v.value?!I.value&&o.value.entity_type?"(Not supported for this type)":"(Pre-configured Codes)":"(Requires SmartIR)"),A=W(()=>{var p;const D=((p=d.device)==null?void 0:p.commands)||{};return Object.keys(D).length>0}),$=W(()=>{if(!o.value.broadlink_entity)return"";const D=a.value.find(p=>p.entity_id===o.value.broadlink_entity);return D&&D.name||o.value.broadlink_entity}),o=y({name:"",entity_type:"",device_type:"broadlink",device:"",area:"",icon:"",broadlink_entity:"",enabled:!0,commands:{}}),L=y({name:"",entity_type:"",broadlink_entity:""}),H=y({}),F=y(null),U=y([]),a=y([]),b=y(null),u=y(null),O=y(null),z=y(!1);Te(async()=>{d.device&&(o.value={...d.device,device_type:d.device.device_type||"broadlink"},o.value.device_type==="smartir"&&(H.value={manufacturer:d.device.manufacturer,model:d.device.model,device_code:d.device.device_code,controller_device:d.device.controller_device,temperature_sensor:d.device.temperature_sensor,humidity_sensor:d.device.humidity_sensor})),await Promise.all([Y(),P()])});const Y=async()=>{try{const D=await ee.get("/api/areas");U.value=D.data.areas||[]}catch(D){console.error("Error loading areas:",D),U.value=[]}},P=async()=>{try{const p=(await ee.get("/api/remote/devices")).data.devices||[];a.value=p,console.log("Loaded remote devices:",p)}catch(D){console.error("Error loading remote devices:",D),a.value=[]}},te=D=>{if(!D)return"";const p=D.toLowerCase();for(const V of U.value){const pe=V.toLowerCase();if(p.includes(pe))return V}return""},M=(D,p="")=>{const V=p.toLowerCase();return V.includes("tv")?"mdi:television":V.includes("lamp")?"mdi:lamp":V.includes("ceiling")?"mdi:ceiling-light":V.includes("floor")?"mdi:floor-lamp":V.includes("desk")?"mdi:desk-lamp":V.includes("fan")?"mdi:fan":V.includes("ac")||V.includes("air con")?"mdi:air-conditioner":V.includes("heater")?"mdi:radiator":V.includes("blind")?"mdi:blinds":V.includes("curtain")?"mdi:curtains":V.includes("garage")?"mdi:garage":V.includes("speaker")||V.includes("stereo")?"mdi:speaker":V.includes("receiver")?"mdi:audio-video":{light:"mdi:lightbulb",fan:"mdi:fan",switch:"mdi:light-switch",media_player:"mdi:television",cover:"mdi:window-shutter",climate:"mdi:thermostat"}[D]||"mdi:devices"};se(()=>o.value.name,D=>{if(!g.value&&D&&!o.value.area){const p=te(D);p&&(o.value.area=p)}!g.value&&D&&o.value.entity_type&&(z.value||!o.value.icon)&&(o.value.icon=M(o.value.entity_type,D),z.value=!0)}),se(()=>o.value.entity_type,D=>{!g.value&&D&&(z.value||!o.value.icon)&&(o.value.icon=M(D,o.value.name),z.value=!0)}),se(()=>o.value.icon,(D,p)=>{p!==void 0&&D!==p&&!z.value&&(z.value=!1),D||(z.value=!1)});const j=y(!1),oe=async()=>{var D;if((D=d.device)!=null&&D.id){j.value=!0;try{const p=await ee.post(`/api/devices/${d.device.id}/sync-area`);p.data.success?(o.value.area=p.data.area||"",p.data.area?console.log(`Area synced: ${p.data.area}`):console.log("No area assigned in Home Assistant")):console.warn(p.data.message||"Entity not found in HA")}catch(p){console.error("Failed to sync area:",p)}finally{j.value=!1}}},ie=()=>{var V;return!((V=d.device)!=null&&V.id)||!o.value.entity_type?"#":`/config/entities/entity/${`${o.value.entity_type}.${d.device.id}`}`},ge=()=>{L.value={name:"",entity_type:"",broadlink_entity:""};let D=!0;return(!o.value.name||o.value.name.trim()==="")&&(L.value.name="Device name is required",D=!1),o.value.entity_type||(L.value.entity_type="Entity type is required",D=!1),o.value.device_type==="broadlink"&&!o.value.broadlink_entity&&(L.value.broadlink_entity="Broadlink device is required",D=!1),D},Ie=D=>{L.value[D]=""},Ae=async()=>{if(o.value.device_type==="smartir"){if(F.value&&!F.value.validate())return;const D={...o.value,smartir_config:{manufacturer:H.value.manufacturer,model:H.value.model,code_id:H.value.device_code,controller_device:H.value.controller_device}};w("save",D)}else{if(!ge())return;w("save",{...o.value})}},xe=D=>{H.value=D};return(D,p)=>(n(),i("div",{class:"modal-overlay",onClick:p[11]||(p[11]=ue(V=>D.$emit("cancel"),["self"]))},[e("div",el,[e("div",tl,[e("h2",null,f(g.value?"Edit Device":"Add New Device"),1),e("button",{onClick:p[0]||(p[0]=V=>D.$emit("cancel")),class:"close-btn"},[...p[12]||(p[12]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("form",{id:"device-form",onSubmit:ue(Ae,["prevent"]),class:"modal-body"},[e("div",{class:K(["form-group",{"has-error":L.value.name}])},[p[14]||(p[14]=e("label",{for:"device-name"},"Device Name *",-1)),e("div",ol,[J(e("input",{id:"device-name",ref_key:"nameInput",ref:b,"onUpdate:modelValue":p[1]||(p[1]=V=>o.value.name=V),type:"text",placeholder:"e.g., Living Room TV",onInput:p[2]||(p[2]=V=>Ie("name"))},null,544),[[Le,o.value.name]]),L.value.name?(n(),i("div",ll,[p[13]||(p[13]=e("i",{class:"mdi mdi-alert"},null,-1)),T(" "+f(L.value.name),1)])):x("",!0)]),p[15]||(p[15]=e("small",null,"Friendly name for this device",-1))],2),e("div",{class:K(["form-group",{"has-error":L.value.entity_type}])},[p[23]||(p[23]=e("label",{for:"entity-type"},"Entity Type *",-1)),e("div",nl,[J(e("select",{id:"entity-type",ref_key:"typeSelect",ref:u,"onUpdate:modelValue":p[3]||(p[3]=V=>o.value.entity_type=V),onChange:p[4]||(p[4]=V=>Ie("entity_type"))},[p[16]||(p[16]=Be('<option value="" data-v-94bc1fe5>-- Select Type --</option><option value="light" data-v-94bc1fe5>ðŸ’¡ Light</option><option value="fan" data-v-94bc1fe5>ðŸŒ€ Fan</option><option value="switch" data-v-94bc1fe5>ðŸ”Œ Switch</option><option value="media_player" data-v-94bc1fe5>ðŸ“º Media Player</option><option value="cover" data-v-94bc1fe5>ðŸªŸ Cover (Blinds/Curtains)</option>',6)),e("option",{value:"climate",disabled:!v.value}," ðŸŒ¡ï¸ Climate "+f(v.value?"":"(Requires SmartIR)"),9,sl)],544),[[De,o.value.entity_type]]),L.value.entity_type?(n(),i("div",al,[p[17]||(p[17]=e("i",{class:"mdi mdi-alert"},null,-1)),T(" "+f(L.value.entity_type),1)])):x("",!0)]),o.value.entity_type==="climate"?(n(),i("div",il,[v.value?(n(),i("div",rl,[...p[18]||(p[18]=[e("i",{class:"mdi mdi-check-circle"},null,-1),e("span",null,"SmartIR detected! Climate entities will be created via SmartIR profiles.",-1)])])):(n(),i("div",dl,[...p[19]||(p[19]=[e("i",{class:"mdi mdi-alert"},null,-1),e("div",null,[e("strong",null,"SmartIR Required"),e("p",null,"Climate entities (AC, heaters) require SmartIR integration."),e("a",{href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"smartir-link"}," Install SmartIR â†’ ")],-1)])]))])):v.value&&["media_player","fan","light"].includes(o.value.entity_type)?(n(),i("div",ul,[...p[20]||(p[20]=[e("div",{class:"notice-info"},[e("i",{class:"mdi mdi-information"}),e("span",null,"ðŸ’¡ SmartIR available! You can use pre-configured codes or learn your own.")],-1)])])):!v.value&&o.value.entity_type?(n(),i("small",cl,[p[21]||(p[21]=T(" ðŸ’¡ Tip: Install ",-1)),p[22]||(p[22]=e("a",{href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"inline-link"},"SmartIR",-1)),T(" for pre-configured "+f(o.value.entity_type==="climate"?"climate":o.value.entity_type)+" device codes ",1)])):x("",!0)],2),e("div",ml,[p[26]||(p[26]=e("label",{for:"device-type"},"Device Type *",-1)),J(e("select",{id:"device-type","onUpdate:modelValue":p[5]||(p[5]=V=>o.value.device_type=V),required:"",disabled:g.value},[p[24]||(p[24]=e("option",{value:""},"-- Select Device Type --",-1)),p[25]||(p[25]=e("option",{value:"broadlink"},"ðŸ“¡ Broadlink Device (Learn IR Codes)",-1)),_e(r)?(n(),i("option",{key:0,value:"smartir",disabled:!v.value||!I.value}," ðŸŒ SmartIR Device "+f(S.value),9,pl)):x("",!0)],8,vl),[[De,o.value.device_type]]),g.value?(n(),i("small",fl,"Cannot change device type after creation")):o.value.device_type==="smartir"?(n(),i("small",gl,"Using pre-configured codes from SmartIR repository")):o.value.device_type==="broadlink"?(n(),i("small",yl,"Learn and store your own IR codes")):(n(),i("small",bl,"Choose how to configure this device"))]),g.value?(n(),i("div",hl,[p[29]||(p[29]=e("label",{for:"device-area"},"Area",-1)),e("div",kl,[e("input",{id:"device-area",value:o.value.area||"Not assigned",type:"text",readonly:"",class:"readonly-input"},null,8,wl),e("button",{type:"button",onClick:oe,disabled:j.value,class:"sync-area-btn",title:"Sync area from Home Assistant"},[e("i",{class:K(j.value?"mdi mdi-loading mdi-spin":"mdi mdi-refresh")},null,2)],8,$l)]),e("small",null,[p[27]||(p[27]=e("i",{class:"mdi mdi-information-outline"},null,-1)),p[28]||(p[28]=T(" Set area in Home Assistant, then click sync. ",-1)),e("a",{href:ie(),target:"_blank",class:"inline-link"},"Open in HA â†’",8,Cl)])])):(n(),i("div",_l,[...p[30]||(p[30]=[e("div",{class:"info-notice"},[e("i",{class:"mdi mdi-information-outline"}),e("span",null,[e("strong",null,"Area Assignment:"),T(" After generating entities and restarting Home Assistant, you can assign areas in HA and sync them here.")])],-1)])])),e("div",Sl,[p[31]||(p[31]=e("label",{for:"device-icon"},"Icon",-1)),fe(yo,{modelValue:o.value.icon,"onUpdate:modelValue":p[6]||(p[6]=V=>o.value.icon=V),inputId:"device-icon",placeholder:"e.g., mdi:television"},null,8,["modelValue"]),p[32]||(p[32]=e("small",null,"Optional: Material Design Icon name",-1))]),o.value.device_type==="broadlink"?(n(),i("div",{key:2,class:K(["form-group",{"has-error":L.value.broadlink_entity}])},[p[35]||(p[35]=e("label",{for:"broadlink-entity"},"Remote Device *",-1)),e("div",Il,[!g.value||!A.value?J((n(),i("select",{key:0,id:"broadlink-entity",ref_key:"broadlinkSelect",ref:O,"onUpdate:modelValue":p[7]||(p[7]=V=>o.value.broadlink_entity=V),onChange:p[8]||(p[8]=V=>Ie("broadlink_entity"))},[p[33]||(p[33]=e("option",{value:""},"-- Select Remote Device --",-1)),(n(!0),i(me,null,he(a.value,V=>(n(),i("option",{key:V.entity_id,value:V.entity_id},[T(f(V.name||V.entity_id)+" ",1),V.area_name?(n(),i(me,{key:0},[T(" - "+f(V.area_name),1)],64)):x("",!0)],8,Dl))),128))],544)),[[De,o.value.broadlink_entity]]):(n(),i("input",{key:1,id:"broadlink-entity",value:$.value,type:"text",readonly:"",disabled:""},null,8,Tl)),L.value.broadlink_entity?(n(),i("div",xl,[p[34]||(p[34]=e("i",{class:"mdi mdi-alert"},null,-1)),T(" "+f(L.value.broadlink_entity),1)])):x("",!0)]),!g.value||!A.value?(n(),i("small",Rl,"Required: Select which remote device to use for sending commands")):(n(),i("small",Ml,"Cannot change remote device after commands are learned"))],2)):x("",!0),o.value.device_type==="smartir"?(n(),i("div",El,[p[36]||(p[36]=e("div",{class:"section-header"},[e("i",{class:"mdi mdi-cloud-download"}),e("span",null,"SmartIR Device Configuration")],-1)),fe(Qo,{ref_key:"smartirSelector",ref:F,"entity-type":o.value.entity_type,modelValue:H.value,"onUpdate:modelValue":p[9]||(p[9]=V=>H.value=V),"broadlink-devices":a.value,onChange:xe},null,8,["entity-type","modelValue","broadlink-devices"])])):x("",!0)],32),e("div",Al,[e("button",{type:"button",onClick:p[10]||(p[10]=V=>D.$emit("cancel")),class:"btn btn-secondary"}," Cancel "),e("button",Ll,[p[37]||(p[37]=e("i",{class:"mdi mdi-check"},null,-1)),T(" "+f(g.value?"Update":"Create"),1)])])])]))}},Pl=$e(Ol,[["__scopeId","data-v-94bc1fe5"]]),Vl={class:"modal-header"},Ul={class:"modal-body"},Fl={class:"message-text"},jl={key:0,class:"checkbox-option"},Nl={class:"modal-footer"},Bl=["disabled"],Hl={__name:"ConfirmDialog",props:{isOpen:{type:Boolean,default:!1},title:{type:String,default:"Confirm"},message:{type:String,required:!0},confirmText:{type:String,default:"OK"},cancelText:{type:String,default:"Cancel"},showCancel:{type:Boolean,default:!0},dangerMode:{type:Boolean,default:!1},confirmDisabled:{type:Boolean,default:!1},checkboxLabel:{type:String,default:""}},emits:["confirm","cancel"],setup(t,{emit:m}){const d=t,w=m,k=y(!1);se(()=>d.isOpen,g=>{g&&(k.value=!1)});const r=()=>{w("confirm",k.value)},v=()=>{w("cancel")};return(g,I)=>t.isOpen?(n(),i("div",{key:0,class:"modal-overlay",onClick:ue(v,["self","stop"])},[e("div",{class:"modal-dialog confirm-dialog",onClick:I[1]||(I[1]=ue(()=>{},["stop"]))},[e("div",Vl,[e("h2",null,f(t.title),1)]),e("div",Ul,[e("p",Fl,f(t.message),1),t.checkboxLabel?(n(),i("div",jl,[e("label",null,[J(e("input",{type:"checkbox","onUpdate:modelValue":I[0]||(I[0]=S=>k.value=S)},null,512),[[ve,k.value]]),e("span",null,f(t.checkboxLabel),1)])])):x("",!0)]),e("div",Nl,[t.showCancel?(n(),i("button",{key:0,onClick:ue(v,["stop"]),class:"btn btn-secondary"},f(t.cancelText),1)):x("",!0),t.confirmText?(n(),i("button",{key:1,onClick:ue(r,["stop"]),class:K(["btn",t.dangerMode?"btn-danger":"btn-primary"]),disabled:t.confirmDisabled},f(t.confirmText),11,Bl)):x("",!0)])])])):x("",!0)}},Ne=$e(Hl,[["__scopeId","data-v-9cea6cb3"]]),ql={class:"modal-content"},zl={class:"modal-header"},Jl={class:"modal-body"},Wl={key:0,class:"smartir-info"},Gl={key:0,class:"climate-note"},Kl={class:"form-group"},Xl=["value"],Yl={class:"form-group"},Zl=["disabled"],Ql={label:"Suggested Commands"},en=["value"],tn=["disabled"],on={class:"form-group"},ln={class:"radio-group"},nn={class:"radio-label"},sn=["disabled"],an={class:"radio-label"},rn=["disabled"],dn={class:"form-group"},un={class:"radio-group"},cn={class:"radio-label"},mn=["disabled"],vn={class:"radio-label"},pn=["disabled"],fn={class:"radio-label"},gn=["disabled"],yn={key:0,class:"help-box"},bn={class:"learn-action"},hn=["disabled"],kn={key:0,class:"mdi mdi-loading mdi-spin"},wn={key:1,class:"mdi mdi-remote-tv"},$n={key:0,class:"learning-status"},Cn={key:0},_n={key:1},Sn={key:2},In={key:1,class:"result-message success"},Dn={key:2,class:"section-divider"},Tn={key:3,class:"loading-commands"},xn={key:4,class:"learned-commands"},Rn={class:"commands-header"},Mn=["disabled"],En={class:"command-list"},An={class:"command-info"},Ln={class:"command-name"},On={class:"command-right"},Pn={key:0,class:"mdi mdi-alert-circle error-icon",title:"Error: Command failed to learn. Delete and try again."},Vn={key:1,class:"mdi mdi-clock-outline pending-icon",title:"Pending: Waiting for code from storage..."},Un=["title"],Fn={class:"command-actions"},jn=["onClick","title","disabled"],Nn=["onClick","title"],Bn={key:5,class:"untracked-commands"},Hn={class:"command-list"},qn={class:"command-name"},zn=["onClick"],Jn={class:"modal-footer"},Wn=["disabled"],Gn={__name:"CommandLearner",props:{device:{type:Object,required:!0}},emits:["cancel","learned"],setup(t,{emit:m}){const d=t,w=m,k=y([]),r=y(""),v=y(""),g=y(""),I=y("ir"),S=y("manager_only"),A=y(!1),$=y(!1),o=y(""),L=y(""),H=y(""),F=y("success"),U=y([]),a=y([]),b=y(!1),u=y(!1),O=y(""),z=y(!1),Y=y(null),P=y(null),te=y(""),M=y(""),j=W(()=>d.device.device_type==="smartir");W(()=>{if(j.value)return!1;const h=v.value==="__custom__"?g.value:v.value;return r.value&&h.trim()});const oe=()=>{Y.value&&Y.value.setCustomValidity("")},ie=()=>{P.value&&P.value.setCustomValidity("")},ge=W(()=>{const h=k.value.find(c=>c.entity_id===r.value);return h?h.name||h.entity_id:r.value}),Ie={light:["turn_on","turn_off","toggle","brightness_up","brightness_down","dim","bright"],fan:["turn_on","turn_off","toggle","speed_low","speed_medium","speed_high","speed_1","speed_2","speed_3","speed_4","speed_5","oscillate_on","oscillate_off","direction_forward","direction_reverse"],switch:["turn_on","turn_off","toggle"],media_player:["turn_on","turn_off","toggle","volume_up","volume_down","volume_mute","play","pause","stop","play_pause","next_track","previous_track","channel_up","channel_down","source_hdmi1","source_hdmi2","source_hdmi3","source_tv","source_aux","source_bluetooth","menu","home","back","select","arrow_up","arrow_down","arrow_left","arrow_right"],cover:["open","close","stop","open_tilt","close_tilt","position_0","position_25","position_50","position_75","position_100"]},Ae=W(()=>{const h=d.device.entity_type||"switch";return Ie[h]||Ie.switch});se(()=>d.device,async(h,c)=>{if(h&&c&&h.id===c.id){const l=Object.keys(h.commands||{}).length,B=Object.keys(c.commands||{}).length;l!==B&&(console.log(`ðŸ”„ Device commands changed (${B} -> ${l}), reloading...`),await D(!0))}},{deep:!0}),Te(async()=>{await xe(),await D(),await ce(),Y.value&&(Y.value.setCustomValidity(""),Y.value.oninvalid=()=>{Y.value.setCustomValidity("Command name is required")}),d.device.broadlink_entity&&(r.value=d.device.broadlink_entity)}),se(v,async h=>{h==="__custom__"&&(await nt(),P.value&&(P.value.setCustomValidity(""),P.value.oninvalid=()=>{P.value.setCustomValidity("Custom command name is required")}))});const xe=async()=>{try{const h=await ee.get("/api/broadlink/devices");k.value=h.data.devices||[]}catch(h){console.error("Error loading Broadlink devices:",h)}},D=async(h=!1)=>{var c,l;b.value=!0;try{if(j.value){const B=await ee.get("/api/smartir/codes/code",{params:{entity_type:d.device.entity_type,code_id:d.device.device_code}});if(B.data.success&&B.data.code){const C=B.data.code.commands||{},s=B.data.code.commandType||"ir";if(d.device.entity_type==="climate"){const R=[];for(const[G,le]of Object.entries(C))typeof le=="string"?R.push({name:G,type:s}):typeof le=="object"&&le!==null&&Object.keys(le).sort((Z,Me)=>parseInt(Z)-parseInt(Me)).forEach(Z=>{R.push({name:`${G}_${Z}`,type:s,label:`${G.charAt(0).toUpperCase()+G.slice(1)} ${Z}Â°C`})});U.value=R}else U.value=Object.keys(C).map(R=>({name:R,type:s}))}}else{if(console.log("ðŸ“‹ Loading commands for device:",d.device),console.log("ðŸ“‹ Device ID:",d.device.id),console.log("ðŸ“‹ Force reload:",h),h&&d.device.id){console.log("ðŸ”„ Force reloading commands from API after sync");try{const C=(await ee.get(`/api/commands/${d.device.id}`)).data.commands||{};console.log("ðŸ“¦ Raw commands from API:",C),U.value=Object.entries(C).map(([s,R])=>{console.log(`  Command '${s}':`,R,`(type: ${typeof R})`);const G=typeof R=="object"&&R!==null&&(R.command_type||R.type)||"ir",le=typeof R=="object"&&R!==null?R.data:R;return{name:s,type:G,data:le,hasError:le==="error",isPending:le==="pending"}}),console.log("ðŸ“‹ Reloaded commands:",U.value)}catch(B){if(console.error("âŒ Error loading commands:",B),((c=B.response)==null?void 0:c.status)===404)console.log("â„¹ï¸ No commands found for device"),U.value=[];else throw B}}else if(d.device.commands&&Object.keys(d.device.commands).length>0)console.log("âœ… Using commands from device object"),U.value=Object.entries(d.device.commands).map(([B,C])=>{const s=C.data||C;return{name:B,type:C.command_type||C.type||"ir",data:s,hasError:s==="error",isPending:s==="pending"}});else if(d.device.commands!==void 0)console.log("â„¹ï¸ Device has empty commands object - skipping API call"),U.value=[];else if(d.device.id){console.log("ðŸŒ Fetching commands from API for device ID:",d.device.id);try{const C=(await ee.get(`/api/commands/${d.device.id}`)).data.commands||{};U.value=Object.entries(C).map(([s,R])=>({name:s,type:R.command_type||R.type||"ir"}))}catch(B){if(((l=B.response)==null?void 0:l.status)===404)console.log("â„¹ï¸ No commands found for device (this is normal for new devices)"),U.value=[];else throw B}}else console.log("âš ï¸ No commands found and no device ID");console.log("ðŸ“‹ Final learned commands:",U.value)}}catch(B){console.error("Error loading commands:",B)}finally{b.value=!1}},p=async()=>{H.value="",F.value="",L.value="",$.value=!0,o.value="preparing";try{const h=v.value==="__custom__"?g.value:v.value;I.value==="rf"?(o.value="learning",H.value="âš ï¸ Learning request sent to device. Check Home Assistant notifications (ðŸ””) for instructions. Note: If the device is offline or times out, you will see a notification but this dialog will still show success.",F.value="warning",await new Promise(l=>setTimeout(l,50))):o.value="learning";const c=await ee.post("/api/commands/learn",{device_id:d.device.id,entity_id:r.value||d.device.broadlink_entity,device:d.device.device||d.device.id,command:h.trim(),command_type:I.value,save_destination:S.value});if(c.data.success){if(o.value="complete",H.value="",F.value="",S.value==="manager_only"||S.value==="both"){U.value.find(C=>C.name===h)||U.value.push({name:h,type:I.value});const B=a.value.indexOf(h);B>-1&&a.value.splice(B,1)}await ce(),v.value="",g.value="",w("learned",{deviceId:d.device.id,commandName:h,commandType:I.value}),$.value=!1,o.value=""}else throw new Error(c.data.error||"Failed to learn command")}catch(h){console.error("Learning error:",h),H.value=h.message||"Error learning command",F.value="error",$.value=!1,o.value=""}},V=async h=>{var c,l;try{M.value=h,te.value="";let B=d.device.id.split(".")[1];d.device.device&&(B=d.device.device);const C=j.value?d.device.controller_device:r.value||d.device.broadlink_entity;if(!C){console.error("Missing entity_id for test command:",{isSmartIR:j.value,controller_device:d.device.controller_device,broadlink_entity:d.device.broadlink_entity,selectedBroadlink:r.value,device:d.device}),H.value="Missing Broadlink remote entity. Please select a Broadlink device.",F.value="error",M.value="";return}const s={device_id:d.device.id,entity_id:C,command:h,device:d.device.device||d.device.id};console.log("ðŸ§ª Testing command:",s),(await ee.post("/api/commands/test",s)).data.success&&(te.value=h,setTimeout(()=>{te.value===h&&(te.value="")},2e3))}catch(B){console.error("âŒ Test command error:",B);const C=((l=(c=B.response)==null?void 0:c.data)==null?void 0:l.error)||B.message||"Unknown error";H.value=`Failed to send command: ${C}`,F.value="error"}finally{M.value=""}},pe=h=>{O.value=h,u.value=!0},Oe=()=>{u.value=!1,O.value=""},ye=async h=>{const c=O.value;u.value=!1;try{if(console.log(`ðŸ—‘ï¸ Deleting command: ${c}, alsoDeleteFromIntegration: ${h}`),await ee.delete(`/api/commands/${d.device.id}/${c}`),h)try{const l=d.device.device||d.device.id;await ee.post("/api/commands/delete-from-storage",{device:l,command:c}),console.log("âœ… Also deleted from Broadlink Integration storage")}catch(l){console.warn("âš ï¸ Failed to delete from Broadlink Integration storage:",l)}await D(!0),await ce(),H.value=`Command "${c}" deleted`,F.value="success",w("learned",{deviceId:d.device.id,commandName:c,action:"deleted"})}catch(l){console.error("âŒ Delete error:",l),H.value=`Failed to delete command: ${l.message}`,F.value="error",await D(!0)}finally{O.value=""}},ce=async()=>{try{let h=d.device.device;h||(h=d.device.id.includes(".")?d.device.id.split(".")[1]:d.device.id),console.log("ðŸ” Looking for untracked commands for device:",h);const l=(await ee.get("/api/commands/untracked")).data.untracked||{};console.log("ðŸ“¦ All untracked commands:",Object.keys(l)),console.log("ðŸ“¦ Untracked for this device:",l[h]),l[h]?a.value=Object.keys(l[h].commands):a.value=[]}catch(h){console.error("Error loading untracked commands:",h),a.value=[]}},Re=()=>{a.value.length!==0&&(z.value=!0)},Pe=async h=>{var c,l,B;console.log("ðŸ”µ [IMPORT SINGLE] Importing command:",h);try{const C=d.device.device||d.device.id||((c=d.device.id)!=null&&c.includes(".")?d.device.id.split(".")[1]:null);if(!C)throw new Error("Could not determine device name for import");console.log("ðŸ”µ [IMPORT SINGLE] Calling API to import command...");const s=await ee.post("/api/commands/import",{device_id:d.device.id,source_device:C,commands:[h]});console.log("ðŸ”µ [IMPORT SINGLE] API response:",s.data),s.data.success?(H.value=`Imported command '${h}' successfully!`,F.value="success",await D(!0),await ce()):(H.value=s.data.error||"Failed to import command",F.value="error")}catch(C){console.error("ðŸ”´ [IMPORT SINGLE] Error:",C),H.value=((B=(l=C.response)==null?void 0:l.data)==null?void 0:B.error)||C.message||"Failed to import command",F.value="error"}},Q=async()=>{var h;console.log("ðŸ”µ [IMPORT] Starting import process..."),console.log("ðŸ”µ [IMPORT] Current learned commands:",U.value.length),console.log("ðŸ”µ [IMPORT] Current untracked commands:",a.value.length),z.value=!1;try{const c=d.device.device||d.device.id||((h=d.device.id)!=null&&h.includes(".")?d.device.id.split(".")[1]:null);if(console.log("ðŸ”µ [IMPORT] Device object:",d.device),console.log("ðŸ”µ [IMPORT] Extracted device name:",c),!c)throw new Error("Could not determine device name for import");console.log("ðŸ”µ [IMPORT] Calling API to import commands...");const l=await ee.post("/api/commands/import",{device_id:d.device.id,source_device:c,commands:a.value});console.log("ðŸ”µ [IMPORT] API response:",l.data),l.data.success&&(H.value=`Imported ${l.data.imported_count} commands successfully!`,F.value="success",console.log("ðŸ”µ [IMPORT] Import successful, now reloading commands..."),console.log("ðŸ”µ [IMPORT] BEFORE reload - learned:",U.value.length,"untracked:",a.value.length),await D(!0),console.log("ðŸ”µ [IMPORT] AFTER loadLearnedCommands - learned:",U.value.length),await ce(),console.log("ðŸ”µ [IMPORT] AFTER loadUntrackedCommands - untracked:",a.value.length),console.log("ðŸ”µ [IMPORT] Final state - learned:",U.value,"untracked:",a.value),console.log("ðŸ”µ [IMPORT] Emitting learned event to parent..."),w("learned",{deviceId:d.device.id,action:"imported",count:l.data.imported_count}),console.log("ðŸ”µ [IMPORT] âœ… Import process complete!"))}catch(c){console.error("ðŸ”µ [IMPORT] âŒ Import failed:",c),H.value=`Failed to import commands: ${c.message}`,F.value="error"}};return(h,c)=>(n(),i("div",{class:"modal-overlay",onClick:c[12]||(c[12]=ue(l=>h.$emit("cancel"),["self"]))},[e("div",ql,[e("div",zl,[e("h2",null,f(j.value?"Commands for":"Learn Commands for")+" "+f(t.device.name),1),e("button",{onClick:c[0]||(c[0]=l=>h.$emit("cancel")),class:"close-btn"},[...c[13]||(c[13]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Jl,[j.value?(n(),i("div",Wl,[c[18]||(c[18]=e("i",{class:"mdi mdi-information"},null,-1)),e("div",null,[c[17]||(c[17]=e("h3",null,"SmartIR Device",-1)),e("p",null,[c[14]||(c[14]=T("This device uses SmartIR code file ",-1)),e("strong",null,f(t.device.device_code),1),c[15]||(c[15]=T(". Commands are pre-configured and cannot be learned.",-1))]),t.device.entity_type==="climate"?(n(),i("p",Gl,[...c[16]||(c[16]=[e("i",{class:"mdi mdi-alert-circle-outline"},null,-1),e("strong",null,"Note:",-1),T(" Climate device commands are temperature-based. Testing individual modes may not work as expected. Use the Home Assistant climate card to control your device. ",-1)])])):x("",!0)])])):(n(),i("form",{key:1,onSubmit:ue(p,["prevent"])},[e("div",Kl,[c[19]||(c[19]=e("label",{for:"broadlink-entity"},"Broadlink Device",-1)),e("input",{id:"broadlink-entity",value:ge.value,type:"text",readonly:"",disabled:""},null,8,Xl),c[20]||(c[20]=e("small",null,"Commands will be learned using this device (set when device was created)",-1))]),e("div",Yl,[c[23]||(c[23]=e("label",{for:"command-name"},"Command Name *",-1)),J(e("select",{id:"command-name",ref_key:"commandSelect",ref:Y,"onUpdate:modelValue":c[1]||(c[1]=l=>v.value=l),disabled:$.value,required:"",onChange:oe},[c[21]||(c[21]=e("option",{value:""},"-- Select or type command --",-1)),e("optgroup",Ql,[(n(!0),i(me,null,he(Ae.value,l=>(n(),i("option",{key:l,value:l},f(l),9,en))),128))]),c[22]||(c[22]=e("option",{value:"__custom__"},"Custom command...",-1))],40,Zl),[[De,v.value]]),v.value==="__custom__"?J((n(),i("input",{key:0,ref_key:"customCommandInput",ref:P,"onUpdate:modelValue":c[2]||(c[2]=l=>g.value=l),type:"text",placeholder:"Enter custom command name",disabled:$.value,required:"",class:"custom-command-input",onInput:ie},null,40,tn)),[[Le,g.value]]):x("",!0),e("small",null,"Select a suggested command for "+f(t.device.entity_type||"this device")+", or enter a custom one.",1)]),e("div",on,[c[26]||(c[26]=e("label",null,"Command Type",-1)),e("div",ln,[e("label",nn,[J(e("input",{type:"radio","onUpdate:modelValue":c[3]||(c[3]=l=>I.value=l),value:"ir",disabled:$.value},null,8,sn),[[He,I.value]]),c[24]||(c[24]=e("span",null,"IR (Infrared)",-1))]),e("label",an,[J(e("input",{type:"radio","onUpdate:modelValue":c[4]||(c[4]=l=>I.value=l),value:"rf",disabled:$.value},null,8,rn),[[He,I.value]]),c[25]||(c[25]=e("span",null,"RF (Radio Frequency)",-1))])])]),e("div",dn,[e("label",null,[c[28]||(c[28]=T(" Save Destination ",-1)),e("button",{type:"button",class:"help-btn",onClick:c[5]||(c[5]=l=>A.value=!A.value),title:"Learn more"},[...c[27]||(c[27]=[e("i",{class:"mdi mdi-help-circle-outline"},null,-1)])])]),e("div",un,[e("label",cn,[J(e("input",{type:"radio","onUpdate:modelValue":c[6]||(c[6]=l=>S.value=l),value:"manager_only",disabled:$.value},null,8,mn),[[He,S.value]]),c[29]||(c[29]=e("span",null,"Only Save to Broadlink Manager",-1))]),e("label",vn,[J(e("input",{type:"radio","onUpdate:modelValue":c[7]||(c[7]=l=>S.value=l),value:"integration_only",disabled:$.value},null,8,pn),[[He,S.value]]),c[30]||(c[30]=e("span",null,"Only Save to Broadlink Integration",-1))]),e("label",fn,[J(e("input",{type:"radio","onUpdate:modelValue":c[8]||(c[8]=l=>S.value=l),value:"both",disabled:$.value},null,8,gn),[[He,S.value]]),c[31]||(c[31]=e("span",null,"Save to Both",-1))])]),A.value?(n(),i("div",yn,[...c[32]||(c[32]=[e("h4",null,"Save Destination Options",-1),e("ul",null,[e("li",null,[e("strong",null,"Only Save to Broadlink Manager (Recommended):"),T(" Commands are saved only in this app's database (devices.json). This gives you full control and makes commands portable. The Broadlink Integration won't see these commands.")]),e("li",null,[e("strong",null,"Only Save to Broadlink Integration:"),T(" Commands are saved only in Home Assistant's Broadlink Integration storage. This app won't track these commands, but they'll be available to the Broadlink Integration's remote.send_command service.")]),e("li",null,[e("strong",null,"Save to Both:"),T(" Commands are saved in both places. Use this if you want commands available in both this app and the Broadlink Integration.")])],-1)])])):x("",!0)]),e("div",bn,[e("button",{type:"submit",class:"btn btn-primary btn-large",disabled:$.value},[$.value?(n(),i("i",kn)):(n(),i("i",wn)),T(" "+f($.value?"Learning...":"Learn Command"),1)],8,hn)]),$.value?(n(),i("div",$n,[c[36]||(c[36]=e("i",{class:"mdi mdi-loading mdi-spin"},null,-1)),o.value==="preparing"?(n(),i("div",Cn,[...c[33]||(c[33]=[e("p",null,[e("strong",null,"Preparing device...")],-1),e("small",null,"Connecting and authenticating with Broadlink device (this takes a few seconds)",-1)])])):I.value==="ir"?(n(),i("div",_n,[...c[34]||(c[34]=[e("p",null,[e("strong",null,"Ready!"),T(" Point your remote at the Broadlink device and press the button...")],-1),e("small",null,"This may take up to 30 seconds",-1)])])):I.value==="rf"?(n(),i("div",Sn,[...c[35]||(c[35]=[e("p",null,[e("strong",null,"Learning RF command...")],-1),e("small",null,"Check Home Assistant notifications (ðŸ””) for instructions",-1)])])):x("",!0)])):x("",!0),H.value&&F.value==="success"&&!H.value.includes("sent successfully")&&!$.value?(n(),i("div",In,[c[37]||(c[37]=e("i",{class:"mdi mdi-check-circle"},null,-1)),e("p",null,f(H.value),1)])):x("",!0)],32)),U.value.length>0||a.value.length>0?(n(),i("div",Dn)):x("",!0),b.value?(n(),i("div",Tn,[...c[38]||(c[38]=[e("div",{class:"loading-spinner"},[e("i",{class:"mdi mdi-loading mdi-spin"}),e("p",null,"Loading commands...")],-1)])])):U.value.length>0?(n(),i("div",xn,[e("div",Rn,[e("h3",null,"Tracked Commands ("+f(U.value.length)+")",1),e("button",{type:"button",onClick:c[9]||(c[9]=l=>D(!0)),class:"icon-btn refresh-btn",title:"Refresh commands",disabled:b.value},[e("i",{class:K(["mdi mdi-refresh",{"mdi-spin":b.value}])},null,2)],8,Mn)]),e("div",En,[(n(!0),i(me,null,he(U.value,l=>(n(),i("div",{key:l.name,class:K(["command-item",{"error-state":l.hasError,"pending-state":l.isPending}])},[e("div",An,[e("span",Ln,f(l.label||l.name),1)]),e("div",On,[l.hasError?(n(),i("i",Pn)):l.isPending?(n(),i("i",Vn)):(n(),i("i",{key:2,class:"mdi mdi-check-circle learned-icon",title:`Learned (${(l.type||"ir").toUpperCase()})`},null,8,Un)),e("span",{class:K(["command-type-badge",l.type||"ir"])},f((l.type||"ir").toUpperCase()),3),e("div",Fn,[e("button",{type:"button",onClick:B=>V(l.name),class:"icon-btn",title:l.hasError?"Cannot test - command failed to learn":l.isPending?"Cannot test - waiting for code":"Test command",disabled:M.value===l.name||l.hasError||l.isPending},[e("i",{class:K(["mdi mdi-play",{"mdi-spin":M.value===l.name}])},null,2)],8,jn),e("button",{type:"button",onClick:B=>pe(l.name),class:"icon-btn danger",title:l.hasError?"Delete and re-learn":"Delete command"},[...c[39]||(c[39]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,Nn)])])],2))),128))])])):x("",!0),a.value.length>0?(n(),i("div",Bn,[e("h3",null,[c[40]||(c[40]=e("i",{class:"mdi mdi-alert"},null,-1)),T(" Untracked Commands ("+f(a.value.length)+") ",1)]),c[43]||(c[43]=e("p",{class:"untracked-info"}," These commands exist in Broadlink storage but are not tracked in this device. ",-1)),e("div",Hn,[(n(!0),i(me,null,he(a.value,l=>(n(),i("div",{key:l,class:"command-item untracked"},[e("span",qn,f(l),1),e("button",{type:"button",onClick:B=>Pe(l),class:"btn-icon",title:"Import this command"},[...c[41]||(c[41]=[e("i",{class:"mdi mdi-import"},null,-1)])],8,zn)]))),128))]),c[44]||(c[44]=e("br",null,null,-1)),e("button",{type:"button",onClick:Re,class:"btn btn-secondary"},[...c[42]||(c[42]=[e("i",{class:"mdi mdi-import"},null,-1),T(" Import All Untracked Commands ",-1)])])])):x("",!0)]),e("div",Jn,[e("button",{type:"button",onClick:c[10]||(c[10]=l=>h.$emit("cancel")),class:"btn btn-secondary",disabled:$.value}," Close ",8,Wn)])]),fe(Ne,{isOpen:u.value,title:"Delete Command?",message:`Delete command '${O.value}' from Broadlink Manager?`,checkboxLabel:"Also delete from Broadlink Integration storage",confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,onConfirm:ye,onCancel:Oe},null,8,["isOpen","message"]),fe(Ne,{isOpen:z.value,title:"Import Commands?",message:`Import ${a.value.length} untracked command${a.value.length>1?"s":""} into this device?`,confirmText:"Import",cancelText:"Cancel",onConfirm:Q,onCancel:c[11]||(c[11]=l=>z.value=!1)},null,8,["isOpen","message"])]))}},Kn=$e(Gn,[["__scopeId","data-v-0417d4ea"]]),Xn={class:"modal-container error-dialog"},Yn={class:"modal-header"},Zn={class:"modal-body"},Qn={class:"error-message"},es={key:0,class:"error-suggestion"},ts=["open"],os={class:"debug-content"},ls={class:"debug-info"},ns={key:0,class:"debug-section-title"},ss={key:1},as={__name:"ErrorDialog",props:{isOpen:{type:Boolean,default:!1},title:{type:String,default:"Error"},message:{type:String,required:!0},suggestion:{type:String,default:""},details:{type:String,default:""},error:{type:Object,default:null},context:{type:Object,default:()=>({})}},emits:["close"],setup(t,{emit:m}){const d=t,w=m,k=Ee("toast"),r=y(!1),v=()=>{w("close")},g=W(()=>{var L,H,F,U,a,b,u,O,z,Y,P;const $=new Date().toISOString(),o=d.error||{};return{error:JSON.stringify({message:d.message,title:d.title,details:d.details,errorObject:o.message||o.toString(),timestamp:$},null,2),request:JSON.stringify({method:((H=(L=o.config)==null?void 0:L.method)==null?void 0:H.toUpperCase())||"N/A",url:((F=o.config)==null?void 0:F.url)||"N/A",baseURL:((U=o.config)==null?void 0:U.baseURL)||"N/A",headers:((a=o.config)==null?void 0:a.headers)||{},data:(b=o.config)!=null&&b.data?JSON.parse(o.config.data):"N/A",params:((u=o.config)==null?void 0:u.params)||{}},null,2),response:JSON.stringify({status:((O=o.response)==null?void 0:O.status)||"N/A",statusText:((z=o.response)==null?void 0:z.statusText)||"N/A",data:((Y=o.response)==null?void 0:Y.data)||"N/A",headers:((P=o.response)==null?void 0:P.headers)||{}},null,2),browser:JSON.stringify({userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language,cookieEnabled:navigator.cookieEnabled,onLine:navigator.onLine,viewport:`${window.innerWidth}x${window.innerHeight}`,screenResolution:`${window.screen.width}x${window.screen.height}`,colorDepth:window.screen.colorDepth,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,timestamp:$},null,2),appState:JSON.stringify({currentRoute:window.location.pathname,currentURL:window.location.href,referrer:document.referrer||"N/A",context:d.context||{},localStorage:{smartir_simulate:localStorage.getItem("smartir_simulate_not_installed"),theme:localStorage.getItem("theme")}},null,2),stackTrace:o.stack||null}}),I=async()=>{const $=A();try{await navigator.clipboard.writeText($),k==null||k.success("Debug information copied to clipboard","âœ… Copied")}catch(o){console.error("Failed to copy:",o),k==null||k.error("Failed to copy to clipboard","âŒ Copy Failed")}},S=()=>{const $=A(),o=new Blob([$],{type:"text/plain"}),L=URL.createObjectURL(o),H=document.createElement("a");H.href=L;const F=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5);H.download=`broadlink-manager-error-${F}.txt`,document.body.appendChild(H),H.click(),document.body.removeChild(H),URL.revokeObjectURL(L),k==null||k.success("Debug report downloaded","âœ… Downloaded")},A=()=>`Broadlink Manager - Error Report
${"=".repeat(60)}

Generated: ${new Date().toISOString()}
Title: ${d.title}
Message: ${d.message}
${d.suggestion?`Suggestion: ${d.suggestion}
`:""}
${"=".repeat(60)}

ERROR DETAILS
${"-".repeat(60)}
${g.value.error}

REQUEST INFORMATION
${"-".repeat(60)}
${g.value.request}

RESPONSE INFORMATION
${"-".repeat(60)}
${g.value.response}

BROWSER INFORMATION
${"-".repeat(60)}
${g.value.browser}

APPLICATION STATE
${"-".repeat(60)}
${g.value.appState}

${g.value.stackTrace?`STACK TRACE
${"-".repeat(60)}
${g.value.stackTrace}

`:""}
${"=".repeat(60)}
End of Report
`;return se(()=>d.isOpen,$=>{if($){const o=L=>{L.key==="Escape"&&v()};return document.addEventListener("keydown",o),()=>document.removeEventListener("keydown",o)}}),($,o)=>(n(),Fe(st,{to:"body"},[fe(lt,{name:"modal"},{default:Qe(()=>[t.isOpen?(n(),i("div",{key:0,class:"modal-overlay",onClick:ue(v,["self"])},[e("div",Xn,[e("div",Yn,[o[2]||(o[2]=e("div",{class:"header-icon error-icon"},[e("i",{class:"mdi mdi-alert-circle"})],-1)),e("h3",null,f(t.title),1),e("button",{onClick:v,class:"close-button"},[...o[1]||(o[1]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Zn,[e("p",Qn,f(t.message),1),t.suggestion?(n(),i("p",es,[o[3]||(o[3]=e("i",{class:"mdi mdi-lightbulb-on"},null,-1)),T(" "+f(t.suggestion),1)])):x("",!0),e("details",{class:"debug-section",open:r.value},[e("summary",{onClick:o[0]||(o[0]=L=>r.value=!r.value)},[e("i",{class:K(["mdi",r.value?"mdi-chevron-down":"mdi-chevron-right"])},null,2),o[4]||(o[4]=T(" Debug Information ",-1))]),e("div",os,[e("div",{class:"debug-actions"},[e("button",{onClick:I,class:"btn-debug btn-copy"},[...o[5]||(o[5]=[e("i",{class:"mdi mdi-content-copy"},null,-1),T(" Copy to Clipboard ",-1)])]),e("button",{onClick:S,class:"btn-debug btn-download"},[...o[6]||(o[6]=[e("i",{class:"mdi mdi-download"},null,-1),T(" Download Report ",-1)])])]),e("div",ls,[o[7]||(o[7]=e("div",{class:"debug-section-title"},"Error Details",-1)),e("pre",null,f(g.value.error),1),o[8]||(o[8]=e("div",{class:"debug-section-title"},"Request Information",-1)),e("pre",null,f(g.value.request),1),o[9]||(o[9]=e("div",{class:"debug-section-title"},"Response Information",-1)),e("pre",null,f(g.value.response),1),o[10]||(o[10]=e("div",{class:"debug-section-title"},"Browser Information",-1)),e("pre",null,f(g.value.browser),1),o[11]||(o[11]=e("div",{class:"debug-section-title"},"Application State",-1)),e("pre",null,f(g.value.appState),1),g.value.stackTrace?(n(),i("div",ns,"Stack Trace")):x("",!0),g.value.stackTrace?(n(),i("pre",ss,f(g.value.stackTrace),1)):x("",!0)])])],8,ts)]),e("div",{class:"modal-footer"},[e("button",{onClick:v,class:"btn btn-primary"}," OK ")])])])):x("",!0)]),_:1})]))}},is=$e(as,[["__scopeId","data-v-23858149"]]),rs={key:0,class:"discovery-banner"},ds={class:"banner-content"},us={class:"banner-text"},cs={class:"modal-dialog"},ms={class:"modal-header"},vs={class:"modal-body"},ps={class:"device-list"},fs={class:"device-info"},gs={class:"device-details"},ys={class:"command-count"},bs={class:"device-actions"},hs=["onClick"],ks=["onClick"],ws={class:"modal-footer"},$s=["disabled"],Cs={class:"modal-dialog modal-dialog-small"},_s={class:"modal-header"},Ss={class:"modal-body"},Is={class:"warning-message"},Ds={class:"modal-footer"},Ts=["disabled"],xs=["disabled"],Rs={__name:"DeviceDiscovery",emits:["adopt"],setup(t,{expose:m,emit:d}){const w=Je(),k=d,r=y([]),v=y(!1),g=y(!1),I=y(null),S=y(!1),A=y(!1),$=W(()=>r.value.length>0);Te(async()=>{await o()});const o=async()=>{try{const b=await ee.get("/api/devices/discover");r.value=b.data.untracked_devices||[]}catch(b){console.error("Error loading untracked devices:",b),r.value=[]}},L=()=>{v.value=!0},H=b=>{v.value=!1,k("adopt",b)},F=async()=>{if(r.value.length===0)return;A.value=!0;const b=r.value.length;try{for(const u of r.value)await new Promise(O=>{k("adopt",u),setTimeout(O,100)});w.success(`Successfully adopted ${b} device${b>1?"s":""}!`),v.value=!1,await o()}catch(u){console.error("Error adopting all devices:",u),w.error("Failed to adopt all devices")}finally{A.value=!1}},U=b=>{I.value=b,g.value=!0},a=async()=>{if(!I.value)return;const b=I.value.device_name;S.value=!0;try{const u=await ee.delete(`/api/devices/untracked/${encodeURIComponent(b)}`);if(u.data.success)r.value=r.value.filter(O=>O.device_name!==b),g.value=!1,I.value=null,r.value.length===0&&(v.value=!1),w.success(`Deleted all commands for '${b}'`);else throw new Error(u.data.error||"Failed to delete device")}catch(u){console.error("Error deleting device:",u),w.error(`Failed to delete device: ${u.message}`)}finally{S.value=!1}};return m({refresh:o,openDiscovery:L}),(b,u)=>{var O,z,Y;return $.value?(n(),i("div",rs,[e("div",ds,[u[7]||(u[7]=e("div",{class:"banner-icon"},[e("i",{class:"mdi mdi-radar"})],-1)),e("div",us,[u[6]||(u[6]=e("h3",null,"Untracked Devices Found",-1)),e("p",null,f(r.value.length)+" device"+f(r.value.length>1?"s":"")+" with learned commands found in Broadlink storage. Use the settings menu (âš™ï¸) to view and adopt them.",1)])]),v.value?(n(),i("div",{key:0,class:"modal-overlay",onClick:u[2]||(u[2]=ue(P=>v.value=!1,["self"]))},[e("div",cs,[e("div",ms,[u[9]||(u[9]=e("h2",null,"Discovered Devices",-1)),e("button",{onClick:u[0]||(u[0]=P=>v.value=!1),class:"close-btn"},[...u[8]||(u[8]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",vs,[u[14]||(u[14]=e("p",{class:"info-text"}," These devices have learned commands in Broadlink storage but are not being tracked. Adopt them to manage their commands and generate Home Assistant entities. ",-1)),e("div",ps,[(n(!0),i(me,null,he(r.value,P=>(n(),i("div",{key:P.device_name,class:"discovered-device"},[e("div",fs,[u[11]||(u[11]=e("div",{class:"device-icon"},[e("i",{class:"mdi mdi-devices"})],-1)),e("div",gs,[e("h4",null,f(P.device_name),1),e("span",ys,[u[10]||(u[10]=e("i",{class:"mdi mdi-remote"},null,-1)),T(" "+f(P.command_count)+" command"+f(P.command_count>1?"s":""),1)])])]),e("div",bs,[e("button",{onClick:te=>H(P),class:"btn btn-primary"},[...u[12]||(u[12]=[e("i",{class:"mdi mdi-plus"},null,-1),T(" Adopt ",-1)])],8,hs),e("button",{onClick:te=>U(P),class:"btn btn-danger",title:"Delete all commands"},[...u[13]||(u[13]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,ks)])]))),128))])]),e("div",ws,[e("button",{onClick:F,class:"btn btn-primary",disabled:A.value||r.value.length===0},[e("i",{class:K(["mdi",A.value?"mdi-loading mdi-spin":"mdi-plus-circle"])},null,2),T(" "+f(A.value?"Adopting...":"Adopt All"),1)],8,$s),e("button",{onClick:u[1]||(u[1]=P=>v.value=!1),class:"btn btn-secondary"}," Close ")])])])):x("",!0),g.value?(n(),i("div",{key:1,class:"modal-overlay",onClick:u[5]||(u[5]=ue(P=>g.value=!1,["self"]))},[e("div",Cs,[e("div",_s,[u[16]||(u[16]=e("h2",null,"Delete Untracked Device",-1)),e("button",{onClick:u[3]||(u[3]=P=>g.value=!1),class:"close-btn"},[...u[15]||(u[15]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Ss,[e("div",Is,[u[18]||(u[18]=e("i",{class:"mdi mdi-alert"},null,-1)),e("div",null,[e("p",null,[e("strong",null,'Are you sure you want to delete "'+f((O=I.value)==null?void 0:O.device_name)+'"?',1)]),e("p",null,"This will permanently delete all "+f((z=I.value)==null?void 0:z.command_count)+" command"+f(((Y=I.value)==null?void 0:Y.command_count)>1?"s":"")+" from Broadlink storage.",1),u[17]||(u[17]=e("p",{class:"warning-text"},"This action cannot be undone.",-1))])])]),e("div",Ds,[e("button",{onClick:u[4]||(u[4]=P=>g.value=!1),class:"btn btn-secondary",disabled:S.value}," Cancel ",8,Ts),e("button",{onClick:a,class:"btn btn-danger",disabled:S.value},[e("i",{class:K(["mdi",S.value?"mdi-loading mdi-spin":"mdi-delete"])},null,2),T(" "+f(S.value?"Deleting...":"Delete"),1)],8,xs)])])])):x("",!0)])):x("",!0)}}},Ms=$e(Rs,[["__scopeId","data-v-cbdd8657"]]),Es={class:"device-list-card"},As={class:"card-header"},Ls={class:"header-badges"},Os={class:"header-info"},Ps={class:"header-right"},Vs={key:0,class:"view-toggle-group header-view-toggle"},Us={class:"settings-menu-container"},Fs=["disabled"],js=["disabled"],Ns={class:"card-body"},Bs={key:0,class:"filter-bar"},Hs={class:"filter-search-row"},qs=["title"],zs={key:0,class:"filter-badge"},Js={class:"search-input-wrapper"},Ws={class:"filter-content"},Gs={class:"filter-row filter-row-dropdowns"},Ks={class:"filter-group"},Xs=["value"],Ys={class:"filter-group"},Zs=["value"],Qs={class:"filter-group"},ea={key:0,class:"filter-group filter-toggle"},ta={class:"toggle-label"},oa={class:"filter-results"},la={key:1,class:"loading-state"},na={key:2,class:"error-state"},sa={key:3,class:"empty-state"},aa={key:4,class:"device-grid"},ia={key:6,class:"no-results"},ra={__name:"DeviceList",setup(t){const m=bt(),d=Je(),{isMobile:w}=et(),k=y(!1),r=y(!1),v=y(null),g=y(!1),I=y(!1),S=y(null),A=y(null),$=y(!0),o=y(!1),L=y(!1),F=y(window.innerWidth<=767?"grid":localStorage.getItem("device_view_mode")||"grid");se(w,E=>{E&&F.value==="list"&&(F.value="grid")}),se(F,E=>{localStorage.setItem("device_view_mode",E)});const U=()=>{$.value=!$.value,$.value||(I.value=!1)},a=()=>{$.value||($.value=!0),I.value=!I.value},b=y(!1),u=y({title:"Error",message:"",suggestion:"",details:"",error:null,context:{}}),O=y(!1),z=y({success:!1,title:"",message:""}),Y=y(!1),P=y({search:"",broadlinkDevice:"",area:"",entityType:"",showSmartIROnly:!1}),te=y([]),M=Ee("smartirStatus"),j=Ee("smartirEnabled"),oe=W(()=>{var _;return localStorage.getItem("smartir_simulate_not_installed")==="true"?!1:((_=M==null?void 0:M.value)==null?void 0:_.installed)||!1}),ie=W(()=>{const E=new Map;return m.devices.forEach(_=>{if(_.broadlink_entity){const N=te.value.find(ne=>ne.entity_id===_.broadlink_entity),q=N&&N.name||_.broadlink_entity;E.set(_.broadlink_entity,{entity_id:_.broadlink_entity,friendly_name:q})}}),Array.from(E.values()).sort((_,N)=>_.friendly_name.localeCompare(N.friendly_name))}),ge=W(()=>{const E=new Set;return m.devices.forEach(_=>{_.area&&E.add(_.area)}),Array.from(E).sort()}),Ie=W(()=>{let E=m.devices;if(P.value.search){const N=P.value.search.toLowerCase();E=E.filter(q=>{var be,de,Se,Ve,je;if((be=q.name)!=null&&be.toLowerCase().includes(N)||(de=q.entity_type)!=null&&de.toLowerCase().includes(N)||(Se=q.area)!=null&&Se.toLowerCase().includes(N)||(Ve=q.id)!=null&&Ve.toLowerCase().includes(N)||Object.keys(q.commands||{}).some(Ue=>Ue.toLowerCase().includes(N)))return!0;const ke=te.value.find(Ue=>Ue.entity_id===q.broadlink_entity);return!!((je=ke==null?void 0:ke.name)!=null&&je.toLowerCase().includes(N))})}P.value.broadlinkDevice&&(E=E.filter(N=>N.broadlink_entity===P.value.broadlinkDevice||N.controller_device===P.value.broadlinkDevice)),P.value.area&&(E=E.filter(N=>N.area===P.value.area)),P.value.entityType&&(E=E.filter(N=>N.entity_type===P.value.entityType)),P.value.showSmartIROnly&&(E=E.filter(N=>N.device_type==="smartir"));const _=localStorage.getItem("smartir_simulate_not_installed")==="true";return(!(j!=null&&j.value)||_)&&(E=E.filter(N=>N.device_type!=="smartir")),E}),Ae=W(()=>P.value.search||P.value.broadlinkDevice||P.value.area||P.value.entityType||P.value.showSmartIROnly),xe=W(()=>{let E=0;return P.value.search&&E++,P.value.broadlinkDevice&&E++,P.value.area&&E++,P.value.entityType&&E++,P.value.showSmartIROnly&&E++,E}),D=E=>{E.target.closest(".settings-container")||(I.value=!1)};Te(()=>{document.addEventListener("click",D)}),ze(()=>{document.removeEventListener("click",D)});const p=()=>{P.value.search="",P.value.broadlinkDevice="",P.value.area="",P.value.entityType="",P.value.showSmartIROnly=!1},V=()=>{A.value&&A.value.openDiscovery()},pe=async()=>{try{const E=await ee.get("/api/remote/devices");te.value=E.data.devices||[]}catch(E){console.error("Error loading remote devices:",E)}};se(F,E=>{localStorage.setItem("device_view_mode",E)}),Te(async()=>{await Promise.all([m.loadDevices(),pe()])});const Oe=E=>{v.value=E,k.value=!0},ye=W(()=>{if(!S.value)return"";const E=Object.keys(S.value.commands||{}).length;return E===0?"This device has no commands. The device will be removed from tracking.":`This device has ${E} learned command${E>1?"s":""}. What would you like to do?`}),ce=W(()=>{if(!S.value)return"";const E=Object.keys(S.value.commands||{}).length;return E===0?"":`Also delete all ${E} command${E>1?"s":""} from Broadlink storage`}),Re=E=>{S.value=E,g.value=!0},Pe=()=>{g.value=!1,S.value=null},Q=async E=>{var N,q;const _=S.value;g.value=!1;try{await m.deleteDevice(_.id,E),A.value&&await A.value.refresh()}catch(ne){const ke=((q=(N=ne.response)==null?void 0:N.data)==null?void 0:q.error)||ne.message||"Unknown error";C("Failed to Delete Device",ke)}finally{S.value=null}},h=async E=>{var _,N,q,ne,ke;try{console.log("ðŸ’¾ Saving device data:",E),console.log("ðŸ’¾ Device commands:",E.commands),console.log("ðŸ’¾ Selected device:",v.value),(_=v.value)!=null&&_.id&&v.value.id!==null?await m.updateDevice(v.value.id,E):await m.createDevice(E),c(),A.value&&await A.value.refresh()}catch(be){let de="Failed to save device",Se="",Ve="";(q=(N=be.response)==null?void 0:N.data)!=null&&q.error?(de=be.response.data.error,Se=be.response.data.suggestion||""):be.message&&(de=be.message),be.response&&(Ve=`Status: ${be.response.status}
URL: ${((ne=be.config)==null?void 0:ne.url)||"N/A"}`),C("Failed to Save Device",de,Se,Ve,be,{action:"save_device",deviceData:E,isEdit:!!((ke=v.value)!=null&&ke.id)})}},c=()=>{k.value=!1,v.value=null},l=E=>{v.value=E,r.value=!0},B=()=>{r.value=!1,v.value=null},C=(E,_,N="",q="",ne=null,ke={})=>{u.value={title:E,message:_,suggestion:N,details:q,error:ne,context:ke},b.value=!0},s=()=>{b.value=!1},R=()=>{O.value=!1},G=async E=>{var _;if(console.log("ðŸŸ¢ [PARENT] Received learned event:",E),!E||!E.deviceId){console.warn("âš ï¸ [PARENT] Missing required data in learned event");return}if(console.log("ðŸŸ¢ [PARENT] Current selectedDevice commands:",Object.keys(((_=v.value)==null?void 0:_.commands)||{}).length),console.log("ðŸŸ¢ [PARENT] Current store device count:",m.devices.length),console.log("ðŸŸ¢ [PARENT] Force reloading all devices from API with cache bust..."),await m.loadDevices(!0),console.log("ðŸŸ¢ [PARENT] After reload - store device count:",m.devices.length),v.value){console.log("ðŸŸ¢ [PARENT] Looking for device:",E.deviceId);const N=m.devices.find(q=>q.id===E.deviceId);N?(console.log("ðŸŸ¢ [PARENT] Found fresh device with",Object.keys(N.commands||{}).length,"commands"),v.value={...N},console.log("ðŸŸ¢ [PARENT] âœ… Updated selectedDevice - now has",Object.keys(v.value.commands||{}).length,"commands")):console.error("ðŸŸ¢ [PARENT] âŒ Device not found in store after reload!")}A.value&&(console.log("ðŸŸ¢ [PARENT] Refreshing discovery..."),A.value.refresh()),console.log("ðŸŸ¢ [PARENT] âœ… handleCommandLearned complete!")},le=E=>{const _=E.split("_"),N=[];for(let q=0;q<_.length;q++){const ne=_[q],ke=_[q+1];ne&&ke==="s"&&_[q+2]?(N.push(ne.charAt(0).toUpperCase()+ne.slice(1)+"'s"),q++):ne!=="s"&&N.push(ne.charAt(0).toUpperCase()+ne.slice(1))}return N.join(" ")},re=(E,_)=>{const N=E.toLowerCase(),q=_.map(de=>de.toLowerCase());return N.includes("lamp")||N.includes("light")?"light":N.includes("fan")?"fan":N.includes("tv")||N.includes("stereo")||N.includes("speaker")||N.includes("receiver")?"media_player":N.includes("blind")||N.includes("curtain")||N.includes("shade")||N.includes("garage")?"cover":q.some(de=>de.includes("volume")||de.includes("channel")||de.includes("play")||de.includes("pause")||de.includes("mute"))?"media_player":q.some(de=>de.includes("fan_speed")||de.includes("fan_low")||de.includes("fan_high"))?"fan":q.some(de=>de.includes("open")||de.includes("close")||de.includes("stop"))?"cover":"switch"},Z=(E,_)=>{const N=E.toLowerCase();return N.includes("tv")?"mdi:television":N.includes("stereo")||N.includes("receiver")||N.includes("speaker")?"mdi:speaker":N.includes("lamp")?"mdi:lamp":N.includes("light")?"mdi:lightbulb":N.includes("fan")?"mdi:fan":N.includes("blind")?"mdi:blinds":N.includes("curtain")?"mdi:curtains":N.includes("garage")?"mdi:garage":{light:"mdi:lightbulb",fan:"mdi:fan",switch:"mdi:light-switch",media_player:"mdi:speaker",cover:"mdi:window-shutter"}[_]||"mdi:devices"},Me=E=>{const _=E.toLowerCase().split("_");for(let ne=0;ne<_.length-2;ne++)if(_[ne+1]==="s"){const ke=_.slice(ne,ne+3),be=le(ke.join("_"));return console.log("Detected possessive area:",be,"from",E),be}const N=[["living","room"],["dining","room"],["master","bedroom"],["guest","bedroom"],["family","room"],["laundry","room"],["home","office"]];for(let ne=0;ne<_.length-1;ne++){const ke=[_[ne],_[ne+1]],be=N.find(de=>de[0]===ke[0]&&de[1]===ke[1]);if(be)return le(be.join("_"))}const q=["kitchen","bedroom","bathroom","garage","office","basement","attic","hallway","entryway","patio","deck","yard","garden"];for(const ne of _)if(q.includes(ne))return ne.charAt(0).toUpperCase()+ne.slice(1);return""},X=async E=>{var _,N;try{const q=le(E.device_name),ne=Me(E.device_name),ke=re(E.device_name,E.commands),be=Z(E.device_name,ke);let de="";try{console.log("Finding Broadlink owner for:",E.device_name);const Ue=await ee.post("/api/devices/find-broadlink-owner",{device_name:E.device_name});console.log("Broadlink owner response:",Ue.data),de=Ue.data.broadlink_entity||"",console.log("Detected Broadlink entity:",de)}catch(Ue){console.error("Error finding Broadlink owner:",Ue)}console.log("Fetching command data from Broadlink storage...");const Ve=(await ee.get(`/api/commands/broadlink/${E.device_name}`)).data.commands||{};console.log("Fetched command data:",Ve);const je={};for(const[Ue,Ze]of Object.entries(Ve)){const ut=typeof Ze=="string"&&Ze.length>200;je[Ue]={data:Ze,type:ut?"rf":"ir",name:Ue,learned_at:new Date().toISOString()}}console.log("Transformed commands:",je),v.value={id:null,device:E.device_name,name:q,entity_type:ke,commands:je,area:ne,icon:be,broadlink_entity:de,enabled:!0},k.value=!0,d.success(`Imported ${Object.keys(je).length} commands from Broadlink storage`)}catch(q){console.error("Error adopting device:",q),d.error("Failed to adopt device: "+(((N=(_=q.response)==null?void 0:_.data)==null?void 0:N.error)||q.message))}},we=async()=>{L.value=!0;try{await m.syncAllAreas(),d.success("Areas synced from Home Assistant")}catch(E){console.error("Error syncing areas:",E),d.error("Failed to sync areas")}finally{L.value=!1}},ae=async()=>{var E,_;o.value=!0;try{const N=await ee.post("/api/entities/generate",{});if(N.data.success){const q=N.data.broadlink_count||0,ne=N.data.smartir_count||0,ke=N.data.total_count||0,be=N.data.errors||[];let de="âœ… Entity Generation Successful",Se=[];const Ve=[];q>0&&Ve.push(`${q} Broadlink native`),ne>0&&Ve.push(`${ne} SmartIR`),Ve.length>0&&Se.push(`Generated ${Ve.join(" and ")} entity configuration${ke!==1?"s":""}.`),q>0&&(Se.push(`
ðŸ“ Broadlink entities created in:`),Se.push("  â€¢ broadlink_manager/entities.yaml"),Se.push("  â€¢ broadlink_manager/helpers.yaml")),ne>0&&(Se.push(`
ðŸ“ SmartIR entities created in:`),Se.push("  â€¢ smartir/climate.yaml"),Se.push("  â€¢ smartir/media_player.yaml"),Se.push("  â€¢ smartir/fan.yaml")),Se.push(`
ðŸ“ Next steps:`),Se.push("1. Check your configuration.yaml includes the generated files"),Se.push("2. Restart Home Assistant to load the new entities"),be.length>0&&(de="âš ï¸ Entity Generation Completed with Errors",Se.push(`
âš ï¸ ${be.length} error${be.length!==1?"s":""} occurred:`),be.forEach(je=>{Se.push(`  â€¢ ${je}`)})),z.value={success:!0,title:de,message:Se.join(`
`)},O.value=!0}else z.value={success:!1,title:"âŒ Entity Generation Failed",message:N.data.message||`Failed to generate entities.

Please check that you have at least one device configured.`},O.value=!0}catch(N){console.error("Error generating entities:",N);const q=((_=(E=N.response)==null?void 0:E.data)==null?void 0:_.error)||N.message||"Unknown error occurred";z.value={success:!1,title:"âŒ Entity Generation Error",message:`Failed to generate entities:

${q}

Please check the logs for more details.`},O.value=!0}finally{o.value=!1}},Ce=async({device:E,command:_})=>{var N,q;try{const ne={device_id:E.id,command:_,device:E.device||E.id,entity_id:E.broadlink_entity||E.controller_device};await ee.post("/api/commands/test",ne),d.success(`Sent ${_} to ${E.name}`)}catch(ne){console.error("Error sending command:",ne);const ke=((q=(N=ne.response)==null?void 0:N.data)==null?void 0:q.error)||ne.message||"Unknown error";d.error(`Failed to send ${_}: ${ke}`)}};return(E,_)=>{var N;return n(),i("div",Es,[e("div",As,[e("button",{class:"icon-button chevron-button",onClick:U},[e("i",{class:K(["mdi",$.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2)]),e("div",{class:"header-left",onClick:U},[_[15]||(_[15]=e("div",{class:"header-icon"},[e("i",{class:"mdi mdi-devices"})],-1)),e("h3",null,f(_e(w)?"Devices":"Managed Devices"),1),e("div",Ls,[e("span",Os,f(_e(m).deviceCount)+" devices",1)])]),e("div",Ps,[_e(w)?x("",!0):(n(),i("div",Vs,[e("button",{onClick:_[0]||(_[0]=ue(q=>F.value="grid",["stop"])),class:K(["view-toggle-btn",{active:F.value==="grid"}]),title:"Grid View"},[..._[16]||(_[16]=[e("i",{class:"mdi mdi-view-grid"},null,-1)])],2),e("button",{onClick:_[1]||(_[1]=ue(q=>F.value="list",["stop"])),class:K(["view-toggle-btn",{active:F.value==="list"}]),title:"List View"},[..._[17]||(_[17]=[e("i",{class:"mdi mdi-view-list"},null,-1)])],2)])),e("button",{onClick:_[2]||(_[2]=ue(q=>k.value=!0,["stop"])),class:"btn btn-primary new-button"},[..._[18]||(_[18]=[e("i",{class:"mdi mdi-plus"},null,-1),e("span",null,"New",-1)])]),e("div",Us,[e("button",{onClick:ue(a,["stop"]),class:K(["icon-button settings-button",{active:I.value}]),title:"Settings"},[..._[19]||(_[19]=[e("i",{class:"mdi mdi-cog"},null,-1)])],2),I.value?(n(),i("div",{key:0,class:"settings-dropdown",onClick:_[6]||(_[6]=ue(()=>{},["stop"]))},[e("button",{onClick:_[3]||(_[3]=q=>{V(),I.value=!1}),class:"menu-item"},[..._[20]||(_[20]=[e("i",{class:"mdi mdi-radar"},null,-1),e("span",null,"View Untracked Devices",-1)])]),e("button",{onClick:_[4]||(_[4]=q=>{we(),I.value=!1}),class:"menu-item",disabled:L.value},[e("i",{class:K(["mdi",L.value?"mdi-loading mdi-spin":"mdi-refresh"])},null,2),e("span",null,f(L.value?"Syncing Areas...":"Sync Areas"),1)],8,Fs),e("button",{onClick:_[5]||(_[5]=q=>{ae(),I.value=!1}),class:"menu-item",disabled:o.value},[e("i",{class:K(["mdi",o.value?"mdi-loading mdi-spin":"mdi-file-code"])},null,2),e("span",null,f(o.value?"Generating...":"Generate Entities"),1)],8,js)])):x("",!0)])])]),J(e("div",Ns,[fe(Ms,{ref_key:"discoveryRef",ref:A,onAdopt:X},null,512),_e(m).hasDevices?(n(),i("div",Bs,[e("div",Hs,[e("button",{class:K(["filter-toggle-button",{active:Y.value||Ae.value}]),onClick:_[7]||(_[7]=q=>Y.value=!Y.value),title:Y.value?"Hide filters":"Show filters"},[_[21]||(_[21]=e("i",{class:"mdi mdi-filter-variant"},null,-1)),Ae.value?(n(),i("span",zs,f(xe.value),1)):x("",!0)],10,qs),e("div",Js,[_[22]||(_[22]=e("i",{class:"mdi mdi-magnify search-icon"},null,-1)),J(e("input",{"onUpdate:modelValue":_[8]||(_[8]=q=>P.value.search=q),type:"text",placeholder:"Search devices, commands...",class:"search-input"},null,512),[[Le,P.value.search]])])]),J(e("div",Ws,[e("div",Gs,[e("div",Ks,[e("label",null,[_[24]||(_[24]=e("i",{class:"mdi mdi-access-point"},null,-1)),J(e("select",{"onUpdate:modelValue":_[9]||(_[9]=q=>P.value.broadlinkDevice=q)},[_[23]||(_[23]=e("option",{value:""},"All Controller Devices",-1)),(n(!0),i(me,null,he(ie.value,q=>(n(),i("option",{key:q.entity_id,value:q.entity_id},f(q.friendly_name),9,Xs))),128))],512),[[De,P.value.broadlinkDevice]])])]),e("div",Ys,[e("label",null,[_[26]||(_[26]=e("i",{class:"mdi mdi-home-map-marker"},null,-1)),J(e("select",{"onUpdate:modelValue":_[10]||(_[10]=q=>P.value.area=q)},[_[25]||(_[25]=e("option",{value:""},"All Areas",-1)),(n(!0),i(me,null,he(ge.value,q=>(n(),i("option",{key:q,value:q},f(q),9,Zs))),128))],512),[[De,P.value.area]])])]),e("div",Qs,[e("label",null,[_[28]||(_[28]=e("i",{class:"mdi mdi-shape"},null,-1)),J(e("select",{"onUpdate:modelValue":_[11]||(_[11]=q=>P.value.entityType=q)},[..._[27]||(_[27]=[Be('<option value="" data-v-2877c5d1>All Types</option><option value="light" data-v-2877c5d1>Light</option><option value="fan" data-v-2877c5d1>Fan</option><option value="switch" data-v-2877c5d1>Switch</option><option value="media_player" data-v-2877c5d1>Media Player</option><option value="cover" data-v-2877c5d1>Cover</option><option value="climate" data-v-2877c5d1>Climate</option>',7)])],512),[[De,P.value.entityType]])])]),oe.value?(n(),i("div",ea,[e("label",ta,[_[29]||(_[29]=e("span",{class:"toggle-text"},[e("img",{src:Ye,alt:"SmartIR",class:"smartir-icon"}),T(" SmartIR Only ")],-1)),J(e("input",{type:"checkbox","onUpdate:modelValue":_[12]||(_[12]=q=>P.value.showSmartIROnly=q),class:"toggle-checkbox"},null,512),[[ve,P.value.showSmartIROnly]]),_[30]||(_[30]=e("span",{class:"toggle-slider"},null,-1))])])):x("",!0),Ae.value?(n(),i("button",{key:1,onClick:p,class:"btn-clear-filters"},[..._[31]||(_[31]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),T(" Clear ",-1)])])):x("",!0),e("div",oa,f(Ie.value.length)+" of "+f(_e(m).deviceCount),1)])],512),[[Ke,Y.value]])])):x("",!0),_e(m).loading?(n(),i("div",la,[..._[32]||(_[32]=[e("i",{class:"mdi mdi-loading mdi-spin"},null,-1),e("p",null,"Loading devices...",-1)])])):_e(m).error?(n(),i("div",na,[_[33]||(_[33]=e("i",{class:"mdi mdi-alert-circle"},null,-1)),e("p",null,f(_e(m).error),1),e("button",{onClick:_[13]||(_[13]=q=>_e(m).loadDevices()),class:"btn btn-secondary"}," Retry ")])):_e(m).hasDevices?x("",!0):(n(),i("div",sa,[_[35]||(_[35]=e("i",{class:"mdi mdi-devices"},null,-1)),_[36]||(_[36]=e("h3",null,"No Devices Yet",-1)),_[37]||(_[37]=e("p",null,"Get started by adding your first managed device",-1)),e("button",{onClick:_[14]||(_[14]=q=>k.value=!0),class:"btn btn-primary"},[..._[34]||(_[34]=[e("i",{class:"mdi mdi-plus"},null,-1),T(" Add Your First Device ",-1)])])])),F.value==="grid"?(n(),i("div",aa,[(n(!0),i(me,null,he(Ie.value,q=>(n(),Fe(jt,{key:q.id,device:q,"broadlink-devices":te.value,onEdit:Oe,onDelete:Re,onLearn:l},null,8,["device","broadlink-devices"]))),128))])):F.value==="list"&&Ie.value.length>0?(n(),Fe(io,{key:5,devices:Ie.value,onSendCommand:Ce,onOpenCommands:l,onEditDevice:Oe,onDeleteDevice:Re},null,8,["devices"])):x("",!0),_e(m).hasDevices&&Ie.value.length===0?(n(),i("div",ia,[..._[38]||(_[38]=[e("i",{class:"mdi mdi-filter-off"},null,-1),e("h3",null,"No devices match your filters",-1),e("p",null,"Try adjusting your search or filter criteria",-1)])])):x("",!0)],512),[[Ke,$.value]]),k.value?(n(),Fe(Pl,{key:0,device:v.value,onSave:h,onCancel:c},null,8,["device"])):x("",!0),r.value?(n(),Fe(Kn,{key:1,device:v.value,onLearned:G,onCancel:B},null,8,["device"])):x("",!0),fe(Ne,{isOpen:g.value,title:`Delete ${(N=S.value)==null?void 0:N.name}?`,message:ye.value,confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,checkboxLabel:ce.value,onConfirm:Q,onCancel:Pe},null,8,["isOpen","title","message","checkboxLabel"]),fe(is,{isOpen:b.value,title:u.value.title,message:u.value.message,suggestion:u.value.suggestion,details:u.value.details,error:u.value.error,context:u.value.context,onClose:s},null,8,["isOpen","title","message","suggestion","details","error","context"]),fe(Ne,{isOpen:O.value,title:z.value.title,message:z.value.message,confirmText:"OK",showCancel:!1,dangerMode:!z.value.success,onConfirm:R,onCancel:R},null,8,["isOpen","title","message","dangerMode"])])}}},da=$e(ra,[["__scopeId","data-v-2877c5d1"]]),ua={class:"banner-content"},ca={class:"banner-icon"},ma={class:"banner-message"},va={class:"banner-actions"},pa={__name:"SmartIRBanner",setup(t){const m=Ee("smartirStatus"),d=y(!1),w=W(()=>!(!m.value||d.value||localStorage.getItem("smartir_banner_dismissed")==="true")),k=W(()=>{var A;return(A=m.value)!=null&&A.installed?"banner-success":"banner-info"}),r=W(()=>{var A;return(A=m.value)!=null&&A.installed?"mdi mdi-check-circle":"mdi mdi-information"}),v=W(()=>{var A;return(A=m.value)!=null&&A.installed?`SmartIR Detected (v${m.value.version})`:"Want Climate Device Support?"}),g=W(()=>{var A;return(A=m.value)!=null&&A.installed?"You can now create climate device profiles with full temperature and HVAC mode control.":"Install SmartIR to unlock AC/heater control with temperature settings, HVAC modes, and 120+ pre-configured device profiles."});function I(){window.open("https://github.com/smartHomeHub/SmartIR","_blank")}function S(){var A;if(d.value=!0,(A=m.value)!=null&&A.installed)localStorage.setItem("smartir_banner_dismissed","true");else{const $=parseInt(localStorage.getItem("smartir_banner_dismiss_count")||"0");$>=2?localStorage.setItem("smartir_banner_dismissed","true"):localStorage.setItem("smartir_banner_dismiss_count",String($+1))}}return Te(()=>{var o;const A=localStorage.getItem("smartir_last_status"),$=(o=m.value)!=null&&o.installed?"installed":"not_installed";A!==$&&(localStorage.removeItem("smartir_banner_dismissed"),localStorage.removeItem("smartir_banner_dismiss_count"),localStorage.setItem("smartir_last_status",$))}),(A,$)=>{var o,L;return w.value?(n(),i("div",{key:0,class:K(["smartir-banner",k.value])},[e("div",ua,[e("div",ca,[e("i",{class:K(r.value)},null,2)]),e("div",ma,[e("strong",null,f(v.value),1),e("p",null,f(g.value),1)]),e("div",va,[(o=A.status)!=null&&o.installed?x("",!0):(n(),i("button",{key:0,onClick:I,class:"btn-primary"}," Learn More ")),e("button",{onClick:S,class:"btn-text"},f((L=A.status)!=null&&L.installed?"Got it":"Dismiss"),1)])])],2)):x("",!0)}}},fa=$e(pa,[["__scopeId","data-v-7bbcbcd7"]]),qe="api/smartir",rt={async getStatus(){try{const t=await fetch(`${qe}/status`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return await t.json()}catch(t){return console.error("Error fetching SmartIR status:",t),{installed:!1,version:null,error:t.message}}},async getInstallInstructions(){try{const t=await fetch(`${qe}/install-instructions`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return await t.json()}catch(t){throw console.error("Error fetching install instructions:",t),t}},async getPlatforms(){try{const t=await fetch(`${qe}/platforms`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return await t.json()}catch(t){throw console.error("Error fetching platforms:",t),t}},async getPlatformCodes(t){try{const m=await fetch(`${qe}/platforms/${t}/codes`);if(!m.ok)throw new Error(`HTTP error! status: ${m.status}`);return await m.json()}catch(m){throw console.error(`Error fetching codes for ${t}:`,m),m}},async getNextCode(t){try{const m=await fetch(`${qe}/platforms/${t}/next-code`);if(!m.ok)throw new Error(`HTTP error! status: ${m.status}`);return await m.json()}catch(m){throw console.error(`Error fetching next code for ${t}:`,m),m}},async validateCode(t,m){try{const d=await fetch(`${qe}/validate-code`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({platform:t,code:m})});if(!d.ok)throw new Error(`HTTP error! status: ${d.status}`);return await d.json()}catch(d){throw console.error("Error validating code:",d),d}}},ga={class:"profile-card"},ya={class:"profile-card-header"},ba=["title"],ha={class:"profile-details"},ka=["title"],wa={class:"profile-meta"},$a=["title"],Ca=["title"],_a=["title"],Sa={class:"profile-card-footer"},Ia=["title"],Da={key:0,class:"learned-indicator"},Ta={class:"profile-actions"},xa={__name:"SmartIRProfileCard",props:{profile:{type:Object,required:!0}},emits:["edit","download","delete","commands"],setup(t){const m=t,d=at(W(()=>m.profile.platform)),w=v=>v.replace(/_/g," ").replace(/\b\w/g,g=>g.toUpperCase()),k=v=>v&&v.startsWith("mdi:")?`mdi ${v.replace(":"," mdi-")}`:`mdi mdi-${v}`,r=v=>{if(!v)return"";const g=v.toLowerCase();return g.includes("broadlink")?"broadlink-tag":g.includes("not set")?"not-set-tag":"default-controller-tag"};return(v,g)=>(n(),i("div",ga,[e("div",ya,[e("div",{class:K(["profile-icon",_e(d).colorClass.value]),title:w(t.profile.platform)},[e("i",{class:K(k(_e(d).icon.value))},null,2)],10,ba),e("div",ha,[e("h4",{title:`${t.profile.manufacturer} ${t.profile.model}`},f(t.profile.manufacturer)+" "+f(t.profile.model),9,ka),e("div",wa,[e("span",{class:"tag platform-tag",title:w(t.profile.platform)},f(w(t.profile.platform)),9,$a),t.profile.controllerBrand?(n(),i("span",{key:0,class:K(["tag controller-tag",r(t.profile.controllerBrand)]),title:"Controller: "+t.profile.controllerBrand},[g[4]||(g[4]=e("i",{class:"mdi mdi-remote-tv"},null,-1)),T(" "+f(t.profile.controllerBrand),1)],10,Ca)):x("",!0)])]),e("div",{class:"code-badge",title:"Device Code: "+t.profile.code},f(t.profile.code),9,_a)]),e("div",Sa,[e("div",{class:"profile-stats",title:t.profile.commandCount+" total commands"+(t.profile.learnedCount>0?", "+t.profile.learnedCount+" learned":"")},[g[5]||(g[5]=e("i",{class:"mdi mdi-remote"},null,-1)),e("span",null,f(t.profile.commandCount)+" command"+f(t.profile.commandCount!==1?"s":""),1),t.profile.learnedCount>0?(n(),i("span",Da,"( "+f(t.profile.learnedCount)+" learned )",1)):x("",!0)],8,Ia),e("div",Ta,[e("button",{onClick:g[0]||(g[0]=I=>v.$emit("commands")),class:"action-btn",title:"Commands"},[...g[6]||(g[6]=[e("i",{class:"mdi mdi-remote"},null,-1)])]),e("button",{onClick:g[1]||(g[1]=I=>v.$emit("edit")),class:"action-btn",title:"Edit Profile"},[...g[7]||(g[7]=[e("i",{class:"mdi mdi-pencil"},null,-1)])]),e("button",{onClick:g[2]||(g[2]=I=>v.$emit("download")),class:"action-btn",title:"Download JSON"},[...g[8]||(g[8]=[e("i",{class:"mdi mdi-download"},null,-1)])]),e("button",{onClick:g[3]||(g[3]=I=>v.$emit("delete")),class:"action-btn delete",title:"Delete Profile"},[...g[9]||(g[9]=[e("i",{class:"mdi mdi-delete"},null,-1)])])])])]))}},Ra=$e(xa,[["__scopeId","data-v-aad9720f"]]),Ma={name:"SmartIRProfileListView",props:{profiles:{type:Array,required:!0}},methods:{getPlatformIcon(t){return{climate:"mdi-thermostat",media_player:"mdi-television",fan:"mdi-fan",light:"mdi-lightbulb"}[t]||"mdi-devices"},formatPlatform(t){return{climate:"Climate",media_player:"Media Player",fan:"Fan",light:"Light"}[t]||t},editProfile(t){this.$emit("edit",t)},viewCommands(t){this.$emit("commands",t)},downloadProfile(t){this.$emit("download",t)},deleteProfile(t){this.$emit("delete",t)}}},Ea={class:"profile-list-view"},Aa={class:"profile-table"},La={class:"profile-code"},Oa={class:"code-badge"},Pa={class:"profile-manufacturer"},Va={class:"profile-model"},Ua={class:"model-info"},Fa={class:"model-name"},ja={key:0,class:"model-count"},Na={class:"profile-platform"},Ba={class:"profile-controller"},Ha={class:"profile-commands"},qa={class:"command-stats"},za={class:"stat-item"},Ja={key:0,class:"stat-item learned"},Wa={class:"profile-actions"},Ga=["onClick"],Ka=["onClick"],Xa=["onClick"],Ya=["onClick"];function Za(t,m,d,w,k,r){return n(),i("div",Ea,[e("table",Aa,[m[6]||(m[6]=e("thead",null,[e("tr",null,[e("th",null,"Code"),e("th",null,"Manufacturer"),e("th",null,"Model"),e("th",null,"Platform"),e("th",null,"Controller"),e("th",null,"Commands"),e("th",null,"Actions")])],-1)),e("tbody",null,[(n(!0),i(me,null,he(d.profiles,v=>(n(),i("tr",{key:`${v.platform}-${v.code}`,class:"profile-row"},[e("td",La,[e("span",Oa,f(v.code),1)]),e("td",Pa,f(v.manufacturer||"Unknown"),1),e("td",Va,[e("div",Ua,[e("div",Fa,f(v.model||"Unknown"),1),v.models&&v.models.length>1?(n(),i("div",ja," +"+f(v.models.length-1)+" more ",1)):x("",!0)])]),e("td",Na,[e("span",{class:K(["platform-badge",v.platform])},[e("i",{class:K(["mdi",r.getPlatformIcon(v.platform)])},null,2),T(" "+f(r.formatPlatform(v.platform)),1)],2)]),e("td",Ba,f(v.controller_brand||"N/A"),1),e("td",Ha,[e("div",qa,[e("span",za,[m[0]||(m[0]=e("i",{class:"mdi mdi-remote"},null,-1)),T(" "+f(v.command_count||0),1)]),v.learned_count>0?(n(),i("span",Ja,[m[1]||(m[1]=e("i",{class:"mdi mdi-school"},null,-1)),T(" "+f(v.learned_count),1)])):x("",!0)])]),e("td",Wa,[e("button",{class:"action-btn edit",onClick:g=>r.editProfile(v),title:"Edit Profile"},[...m[2]||(m[2]=[e("i",{class:"mdi mdi-pencil"},null,-1)])],8,Ga),e("button",{class:"action-btn commands",onClick:g=>r.viewCommands(v),title:"View Commands"},[...m[3]||(m[3]=[e("i",{class:"mdi mdi-remote"},null,-1)])],8,Ka),e("button",{class:"action-btn download",onClick:g=>r.downloadProfile(v),title:"Download"},[...m[4]||(m[4]=[e("i",{class:"mdi mdi-download"},null,-1)])],8,Xa),e("button",{class:"action-btn delete",onClick:g=>r.deleteProfile(v),title:"Delete"},[...m[5]||(m[5]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,Ya)])]))),128))])])])}const Qa=$e(Ma,[["render",Za],["__scopeId","data-v-d3773038"]]),ei={class:"modal-container"},ti={class:"modal-body"},oi={key:0,class:"selection-section"},li={class:"form-group"},ni={class:"form-group"},si={class:"form-group"},ai={key:0,class:"code-info"},ii={class:"form-actions"},ri=["disabled"],di={key:1,class:"testing-section"},ui={class:"code-header"},ci={class:"code-details"},mi={class:"code-badge"},vi={class:"device-selector"},pi=["value"],fi={key:0,class:"helper-text"},gi={class:"commands-section"},yi={class:"commands-header"},bi={key:0,class:"tested-count"},hi={key:0,class:"filters-section"},ki={class:"filter-row"},wi={class:"filter-row"},$i={key:1,class:"empty-state"},Ci={key:2,class:"empty-state"},_i={key:3,class:"commands-list"},Si={class:"command-name"},Ii={class:"command-actions"},Di={key:0,class:"status-badge success"},Ti=["onClick","disabled","title"],xi={__name:"SmartIRCodeTester",props:{isOpen:{type:Boolean,default:!1}},emits:["close","clone"],setup(t,{emit:m}){const d=t,w=m,k=Ee("toast"),r=y("climate"),v=y(""),g=y([]),I=y(!1),S=y(null),A=y(""),$=y([]),o=y(!1),L=W(()=>$.value.map(Q=>({code:Q.code,label:`${Q.models.join(", ")} (Code: ${Q.code})`,value:Q.code}))),H=y(null),F=y(null),U=y(!1),a=y([]),b=y(""),u=y([]),O=y(new Set),z=y(null),Y=y(""),P=y(""),te=y(""),M=y(""),j=W(()=>{let Q=u.value;if(Y.value){const h=Y.value.toLowerCase();Q=Q.filter(c=>(c.label||c.name).toLowerCase().includes(h))}return P.value&&(Q=Q.filter(h=>h.mode===P.value)),te.value&&(Q=Q.filter(h=>h.fanSpeed===te.value)),M.value&&(Q=Q.filter(h=>h.swingMode===M.value)),Q}),oe=W(()=>Y.value||P.value||te.value||M.value);se(()=>d.isOpen,Q=>{Q&&(ie(),Ie())}),se(r,()=>{d.isOpen&&(v.value="",S.value=null,$.value=[],ie())});async function ie(){var Q;I.value=!0;try{const h=await ee.get("/api/smartir/codes/manufacturers",{params:{entity_type:r.value}});g.value=h.data.manufacturers||[]}catch(h){console.error("Error loading manufacturers:",h),(Q=k.value)==null||Q.error("Failed to load manufacturers","âŒ Error")}finally{I.value=!1}}async function ge(){var Q;if(v.value){o.value=!0;try{const h=await ee.get("/api/smartir/codes/models",{params:{entity_type:r.value,manufacturer:v.value}});$.value=h.data.models||[]}catch(h){console.error("Error loading models:",h),(Q=k.value)==null||Q.error("Failed to load models","âŒ Error")}finally{o.value=!1}}}async function Ie(){try{const Q=await ee.get("/api/remote/devices");a.value=Q.data.devices||[]}catch(Q){console.error("Error loading Broadlink devices:",Q)}}async function Ae(){var Q,h;if(S.value){U.value=!0;try{const c=await ee.get("/api/smartir/codes/code",{params:{entity_type:r.value,code_id:S.value.code}});F.value=c.data.code,H.value=S.value.code,xe(c.data.code),(Q=k.value)==null||Q.success(`Loaded ${u.value.length} commands`,"âœ… Code Loaded")}catch(c){console.error("Error loading code:",c),(h=k.value)==null||h.error(c.message||"Failed to load code","âŒ Error")}finally{U.value=!1}}}function xe(Q){const h=[];if(!Q.commands){u.value=h;return}if(r.value==="climate"){const l=Q.commands;for(const[B,C]of Object.entries(l)){if(B==="off"){typeof C=="string"&&h.push({name:"off",label:"OFF",data:C,mode:"off"});continue}if(typeof C=="object"){for(const[s,R]of Object.entries(C))if(typeof R=="object")for(const[G,le]of Object.entries(R)){if(typeof le!="object")continue;const re=Object.keys(le),Z=re.includes("24")?"24":re[0];if(Z&&typeof le[Z]=="string"){const Me=`${B}_${Z}_${s}_${G}`,X=`${B.toUpperCase()} ${Z}Â°C ${s} ${G}`;h.push({name:Me,label:X,data:le[Z],mode:B,temperature:Z,fanSpeed:s,swingMode:G})}}}}}else for(const[l,B]of Object.entries(Q.commands))typeof B=="string"&&h.push({name:l,label:l.toUpperCase().replace(/_/g," "),data:B});u.value=h}async function D(Q){var h,c,l;if(!b.value){(h=k.value)==null||h.warning("Please select a Broadlink device first","âš ï¸ No Device");return}z.value=Q;try{const B=u.value.find(C=>C.name===Q);if(!B||!B.data)throw new Error(`Command "${Q}" not found`);await ee.post("/api/commands/send-raw",{entity_id:b.value,command:B.data,command_type:"ir"}),O.value.add(Q),(c=k.value)==null||c.success(`Command sent: ${B.label||Q}`,"âœ… Tested")}catch(B){console.error("Error testing command:",B),(l=k.value)==null||l.error("Failed to test command","âŒ Error")}finally{z.value=null}}function p(){var Q,h,c,l;if(!F.value){(Q=k.value)==null||Q.error("No profile data to download","âŒ Error");return}try{const B=F.value.manufacturer||"unknown",C=((h=F.value.supportedModels)==null?void 0:h[0])||H.value,s=`${B.toLowerCase().replace(/\s+/g,"_")}_${C.toLowerCase().replace(/\s+/g,"_")}.json`,R=JSON.stringify(F.value,null,2),G=new Blob([R],{type:"application/json"}),le=URL.createObjectURL(G),re=document.createElement("a");re.href=le,re.download=s,document.body.appendChild(re),re.click(),document.body.removeChild(re),URL.revokeObjectURL(le),(c=k.value)==null||c.success(`Downloaded ${s}`,"âœ… Download Complete")}catch(B){console.error("Error downloading JSON:",B),(l=k.value)==null||l.error(B.message||"Failed to download JSON","âŒ Download Error")}}function V(){v.value="",S.value=null,A.value="",$.value=[]}function pe(){S.value=null,A.value="",ge()}function Oe(){A.value?S.value=$.value.find(Q=>Q.code===A.value):S.value=null}function ye(){Y.value="",P.value="",te.value="",M.value=""}function ce(){H.value=null,F.value=null,u.value=[],O.value.clear(),z.value=null,ye()}function Re(Q){const h=Q.toLowerCase();return h.includes("power")||h.includes("off")||h==="off"?"mdi-power":h.includes("cool")?"mdi-snowflake":h.includes("heat")?"mdi-fire":h.includes("fan")?"mdi-fan":h.includes("auto")?"mdi-auto-fix":h.includes("dry")?"mdi-water-percent":h.includes("temp")?"mdi-thermometer":h.includes("swing")?"mdi-swap-vertical":"mdi-remote"}function Pe(){ce(),v.value="",S.value=null,w("close")}return(Q,h)=>{var c;return t.isOpen?(n(),i("div",{key:0,class:"modal-overlay",onClick:ue(Pe,["self"])},[e("div",ei,[e("div",{class:"modal-header"},[h[9]||(h[9]=e("h3",null,[e("i",{class:"mdi mdi-test-tube"}),T(" Test SmartIR Code ")],-1)),e("button",{onClick:Pe,class:"close-btn"},[...h[8]||(h[8]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",ti,[H.value?(n(),i("div",di,[e("div",ui,[e("div",ci,[e("h4",null,f(F.value.manufacturer)+" - "+f(((c=F.value.supportedModels)==null?void 0:c[0])||"Unknown"),1),e("span",mi,"Code: "+f(H.value),1)]),e("button",{onClick:ce,class:"btn-secondary-small"},[...h[14]||(h[14]=[e("i",{class:"mdi mdi-arrow-left"},null,-1),T(" Change Code ",-1)])])]),e("div",vi,[h[17]||(h[17]=e("label",null,[e("i",{class:"mdi mdi-remote"}),T(" Broadlink Device ")],-1)),J(e("select",{"onUpdate:modelValue":h[3]||(h[3]=l=>b.value=l),class:"form-select"},[h[15]||(h[15]=e("option",{value:""},"Select device to test with...",-1)),(n(!0),i(me,null,he(a.value,l=>(n(),i("option",{key:l.entity_id,value:l.entity_id},f(l.friendly_name||l.entity_id),9,pi))),128))],512),[[De,b.value]]),b.value?x("",!0):(n(),i("p",fi,[...h[16]||(h[16]=[e("i",{class:"mdi mdi-information-outline"},null,-1),T(" Select a Broadlink device to enable command testing ",-1)])]))]),e("div",gi,[e("div",yi,[e("h5",null,"Sample Commands ("+f(j.value.length)+" / "+f(u.value.length)+")",1),O.value.size>0?(n(),i("span",bi,f(O.value.size)+" tested ",1)):x("",!0)]),r.value==="climate"&&u.value.length>0?(n(),i("div",hi,[e("div",ki,[J(e("input",{"onUpdate:modelValue":h[4]||(h[4]=l=>Y.value=l),type:"text",placeholder:"Search commands...",class:"search-input"},null,512),[[Le,Y.value]])]),e("div",wi,[J(e("select",{"onUpdate:modelValue":h[5]||(h[5]=l=>P.value=l),class:"filter-select"},[...h[18]||(h[18]=[e("option",{value:""},"All Modes",-1),e("option",{value:"cool"},"Cool",-1),e("option",{value:"heat"},"Heat",-1),e("option",{value:"off"},"Off",-1)])],512),[[De,P.value]]),J(e("select",{"onUpdate:modelValue":h[6]||(h[6]=l=>te.value=l),class:"filter-select"},[...h[19]||(h[19]=[Be('<option value="" data-v-66569200>All Fan Speeds</option><option value="low" data-v-66569200>Low</option><option value="mid" data-v-66569200>Mid</option><option value="high" data-v-66569200>High</option><option value="auto" data-v-66569200>Auto</option>',5)])],512),[[De,te.value]]),J(e("select",{"onUpdate:modelValue":h[7]||(h[7]=l=>M.value=l),class:"filter-select"},[...h[20]||(h[20]=[e("option",{value:""},"All Swing",-1),e("option",{value:"stop"},"Stop",-1),e("option",{value:"swing"},"Swing",-1)])],512),[[De,M.value]]),oe.value?(n(),i("button",{key:0,onClick:ye,class:"btn-clear-filters"},[...h[21]||(h[21]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),T(" Clear ",-1)])])):x("",!0)])])):x("",!0),u.value.length===0?(n(),i("div",$i,[...h[22]||(h[22]=[e("i",{class:"mdi mdi-alert-circle"},null,-1),e("p",null,"No commands found in this code",-1)])])):j.value.length===0?(n(),i("div",Ci,[h[23]||(h[23]=e("i",{class:"mdi mdi-filter-off"},null,-1)),h[24]||(h[24]=e("p",null,"No commands match your filters",-1)),e("button",{onClick:ye,class:"btn-secondary-small"}," Clear Filters ")])):(n(),i("div",_i,[(n(!0),i(me,null,he(j.value,l=>(n(),i("div",{key:l.name,class:K(["command-item",{tested:O.value.has(l.name),testing:z.value===l.name}])},[e("div",Si,[e("i",{class:K(["mdi",Re(l.mode||l.name)])},null,2),e("span",null,f(l.label||l.name),1)]),e("div",Ii,[O.value.has(l.name)?(n(),i("span",Di,[...h[25]||(h[25]=[e("i",{class:"mdi mdi-check"},null,-1),T(" Tested ",-1)])])):x("",!0),e("button",{onClick:B=>D(l.name),disabled:!b.value||z.value===l.name,title:b.value?"Test this command":"Select a Broadlink device first",class:"btn-test"},[e("i",{class:K(["mdi",z.value===l.name?"mdi-loading mdi-spin":"mdi-play"])},null,2),h[26]||(h[26]=T(" Test ",-1))],8,Ti)])],2))),128))]))]),e("div",{class:"modal-actions"},[e("button",{onClick:p,class:"btn-primary"},[...h[27]||(h[27]=[e("i",{class:"mdi mdi-download"},null,-1),T(" Download JSON ",-1)])]),e("button",{onClick:Pe,class:"btn-secondary"}," Close ")])])):(n(),i("div",oi,[h[13]||(h[13]=e("div",{class:"info-banner"},[e("i",{class:"mdi mdi-information"}),e("p",null,"Select a SmartIR code from the index to test commands with your Broadlink device.")],-1)),e("div",li,[h[11]||(h[11]=e("label",null,[e("i",{class:"mdi mdi-shape"}),T(" Platform ")],-1)),J(e("select",{"onUpdate:modelValue":h[0]||(h[0]=l=>r.value=l),onChange:V,class:"form-select"},[...h[10]||(h[10]=[e("option",{value:"climate"},"Climate (AC/Heater)",-1),e("option",{value:"media_player"},"Media Player (TV/Audio)",-1),e("option",{value:"fan"},"Fan",-1),e("option",{value:"light"},"Light",-1)])],544),[[De,r.value]])]),e("div",ni,[fe(Xe,{modelValue:v.value,"onUpdate:modelValue":h[1]||(h[1]=l=>v.value=l),options:g.value,label:"Manufacturer",placeholder:"Search manufacturers...",loading:I.value,disabled:I.value,onChange:pe},null,8,["modelValue","options","loading","disabled"])]),e("div",si,[fe(Xe,{modelValue:A.value,"onUpdate:modelValue":h[2]||(h[2]=l=>A.value=l),options:L.value,"option-label":"label","option-value":"code",label:"Model",placeholder:"Search models...",loading:o.value,disabled:!v.value||o.value,onChange:Oe},null,8,["modelValue","options","loading","disabled"])]),S.value?(n(),i("div",ai,[h[12]||(h[12]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[e("strong",null,f(v.value)+" - "+f(S.value.models[0]),1),e("p",null,"Code: "+f(S.value.code),1)])])):x("",!0),e("div",ii,[e("button",{onClick:Ae,disabled:!S.value||U.value,class:"btn-primary"},[e("i",{class:K(["mdi",U.value?"mdi-loading mdi-spin":"mdi-download"])},null,2),T(" "+f(U.value?"Loading...":"Load Commands"),1)],8,ri)])]))])])])):x("",!0)}}},Ri=$e(xi,[["__scopeId","data-v-66569200"]]),Mi={class:"smartir-status-card"},Ei={class:"card-header"},Ai=["src"],Li={class:"header-badges"},Oi=["title"],Pi={class:"header-info"},Vi={class:"header-info"},Ui={class:"header-info"},Fi={class:"header-right"},ji={key:0,class:"view-toggle-group header-view-toggle"},Ni={key:2,class:"settings-menu-container"},Bi={key:0,class:"card-body loading-state"},Hi={key:1,class:"card-body error-state"},qi={key:2,class:"card-body installed-state"},zi={key:0,class:"help-panel"},Ji={key:0,class:"recommendation"},Wi={key:0,class:"next-steps"},Gi={class:"help-actions"},Ki={key:1,class:"filter-bar"},Xi={class:"filter-search-row"},Yi=["title"],Zi={key:0,class:"filter-badge"},Qi={class:"search-input-wrapper"},er={class:"filter-content"},tr={class:"filter-row"},or={class:"filter-group"},lr={class:"filter-results"},nr={key:2,class:"loading-state"},sr={key:3,class:"empty-state"},ar={key:4,class:"profiles-grid"},ir={key:6,class:"no-results"},rr={key:3,class:"card-body not-installed-state"},dr={class:"benefits-section"},ur={class:"benefits-list"},cr={class:"recommendation"},mr={__name:"SmartIRStatusCard",emits:["create-profile","edit-profile"],setup(t,{expose:m,emit:d}){const w=d,k=Ee("smartirStatus");Ee("smartirEnabled");const r=Ee("refreshSmartIR"),{isMobile:v}=et(),g=y(!1),I=y(null),S=y((k==null?void 0:k.value)||null),A=y(localStorage.getItem("smartir_simulate_not_installed")==="true"),$=y(!1),o=y(!1),L=y(!0),H=y([]),F=y(!1),U=y(!1),a=y({search:"",platform:""}),b=y({show:!1,title:"",message:"",platform:null,profile:null}),u=y(!1),z=y(window.innerWidth<=767?"grid":localStorage.getItem("profile_view_mode")||"grid");se(v,c=>{c&&z.value==="list"&&(z.value="grid")}),se(z,c=>{localStorage.setItem("profile_view_mode",c)}),se(L,c=>{c||(o.value=!1)});const Y=["Full climate entity support (AC, heaters)","120+ pre-configured device profiles","Temperature and humidity sensor integration","HVAC mode control (heat, cool, auto, dry, fan)"],P=["climate","media_player","fan","light"],te=W(()=>A.value?{installed:!1,recommendation:{message:"Install SmartIR to unlock climate device support!",benefits:["Full climate entity support (AC, heaters)","120+ pre-configured device profiles","Temperature and humidity sensor integration","HVAC mode control (heat, cool, auto, dry, fan)"]}}:S.value),M=W(()=>{var c,l;return((l=(c=te.value)==null?void 0:c.platforms)==null?void 0:l.length)||0}),j=W(()=>{var c;return(c=te.value)!=null&&c.device_counts?Object.values(te.value.device_counts).reduce((l,B)=>l+B,0):0});function oe(){var c;A.value=!A.value,localStorage.setItem("smartir_simulate_not_installed",A.value.toString()),!A.value&&((c=S.value)!=null&&c.installed)&&ye()}const ie=W(()=>{let c=H.value;if(a.value.search){const l=a.value.search.toLowerCase();c=c.filter(B=>{var C,s,R,G;return((C=B.manufacturer)==null?void 0:C.toLowerCase().includes(l))||((s=B.model)==null?void 0:s.toLowerCase().includes(l))||((R=B.code)==null?void 0:R.toString().includes(l))||((G=B.platform)==null?void 0:G.toLowerCase().includes(l))})}return a.value.platform&&(c=c.filter(l=>l.platform===a.value.platform)),c}),ge=W(()=>a.value.search||a.value.platform),Ie=W(()=>{let c=0;return a.value.search&&c++,a.value.platform&&c++,c});function Ae(){a.value.search="",a.value.platform=""}async function xe(){g.value=!0,I.value=null;try{if(r)await r();else{const c=await rt.getStatus();S.value=c}}catch(c){I.value=c.message||"Failed to refresh SmartIR status",console.error("Error refreshing SmartIR status:",c)}finally{g.value=!1}}function D(){w("create-profile")}function p(){$.value=!$.value,o.value=!1}function V(){L.value||(L.value=!0),o.value=!o.value}function pe(){u.value=!0,o.value=!1}function Oe(){window.open("https://github.com/smartHomeHub/SmartIR","_blank")}async function ye(){F.value=!0;const c=[];try{for(const l of P)try{const C=((await ee.get(`/api/smartir/platforms/${l}/profiles`)).data.profiles||[]).map(s=>({...s,platform:l}));c.push(...C)}catch(B){console.warn(`Network error loading ${l} profiles (using bundled index):`,B.message)}H.value=c}catch(l){console.error("Unexpected error loading profiles:",l)}finally{F.value=!1}}function ce(c,l,B){w("edit-profile",{platform:c,profile:l,startStep:B})}async function Re(c,l){var B,C;try{const R=(await ee.get(`/api/smartir/platforms/${c}/profiles/${l.code}`)).data,G=JSON.stringify(R.profile,null,2),le=new Blob([G],{type:"application/json"}),re=URL.createObjectURL(le),Z=document.createElement("a");Z.href=re,Z.download=`smartir_${c}_${l.manufacturer}_${l.model}_${l.code}.json`,document.body.appendChild(Z),Z.click(),document.body.removeChild(Z),URL.revokeObjectURL(re),(B=Ee("toast").value)==null||B.success(`Downloaded ${l.manufacturer} ${l.model}`,"âœ… Profile Downloaded")}catch(s){console.error("Error downloading profile:",s),(C=Ee("toast").value)==null||C.error("Failed to download profile","âŒ Download Error")}}const Pe=c=>{c.target.closest(".settings-container")||(o.value=!1)};Te(()=>{document.addEventListener("click",Pe)}),ze(()=>{document.removeEventListener("click",Pe)});async function Q(c,l){Ee("toast");try{const C=(await ee.post(`/api/smartir/profiles/${l.code}/check-usage`,{platform:c})).data;if(C&&C.in_use){b.value={show:!0,title:`Cannot Delete ${l.manufacturer} ${l.model}`,message:`This profile is currently in use by ${C.device_count} device(s):

${C.devices.join(`
`)}

Please remove or reassign these devices before deleting the profile.`,platform:c,profile:l,canDelete:!1,devices:C.devices};return}}catch(B){console.error("Error checking profile usage:",B)}b.value={show:!0,title:`Delete ${l.manufacturer} ${l.model}?`,message:`Device Code: ${l.code}

This will remove the profile and update your configuration.`,platform:c,profile:l,canDelete:!0}}async function h(){var C,s;const c=Ee("toast"),{platform:l,profile:B}=b.value;b.value.show=!1;try{await ee.delete(`/api/smartir/profiles/${B.code}`,{data:{platform:l}}),await ye(),await nt(),await xe(),(C=c.value)==null||C.success(`${B.manufacturer} ${B.model} has been removed`,"âœ… Profile Deleted")}catch(R){console.error("Error deleting profile:",R),(s=c.value)==null||s.error("Failed to delete profile","âŒ Delete Error")}}return se(k,c=>{c&&(S.value=c)},{immediate:!0}),se(z,c=>{localStorage.setItem("profile_view_mode",c)}),Te(async()=>{var c;k!=null&&k.value&&(S.value=k.value),S.value||await xe(),(c=S.value)!=null&&c.installed&&await ye()}),m({loadAllProfiles:ye,refreshStatus:xe}),(c,l)=>{var B,C,s,R,G,le,re,Z,Me;return n(),i("div",Mi,[e("div",Ei,[e("button",{class:"icon-button chevron-button",onClick:l[0]||(l[0]=X=>L.value=!L.value)},[e("i",{class:K(["mdi",L.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2)]),e("div",{class:"header-left",onClick:l[1]||(l[1]=X=>L.value=!L.value)},[e("img",{src:_e(Ye),alt:"SmartIR",class:"smartir-logo"},null,8,Ai),e("h3",null,f(_e(v)?"SmartIR":"SmartIR Integration"),1),e("div",Li,[e("div",{class:K(["simulation-toggle-pill",{active:A.value}]),onClick:ue(oe,["stop"]),title:A.value?"Click to show as installed":"Click to simulate not-installed"},[e("i",{class:K(["mdi",A.value?"mdi-eye-off":"mdi-eye"])},null,2),e("span",null,f(A.value?"Simulating: Not Installed":"Simulation Mode"),1)],10,Oi),(B=te.value)!=null&&B.installed?(n(),i(me,{key:0},[l[16]||(l[16]=e("div",{class:"status-badge-mini success"},[e("i",{class:"mdi mdi-check-circle"}),e("span",null,"Installed")],-1)),e("span",Pi,"v"+f(te.value.version||"Unknown"),1),e("span",Vi,f(M.value)+" platform"+f(M.value!==1?"s":""),1),e("span",Ui,f(j.value)+" device"+f(j.value!==1?"s":""),1)],64)):x("",!0)])]),e("div",Fi,[!_e(v)&&((C=te.value)!=null&&C.installed)?(n(),i("div",ji,[e("button",{onClick:l[2]||(l[2]=ue(X=>z.value="grid",["stop"])),class:K(["view-toggle-btn",{active:z.value==="grid"}]),title:"Grid View"},[...l[17]||(l[17]=[e("i",{class:"mdi mdi-view-grid"},null,-1)])],2),e("button",{onClick:l[3]||(l[3]=ue(X=>z.value="list",["stop"])),class:K(["view-toggle-btn",{active:z.value==="list"}]),title:"List View"},[...l[18]||(l[18]=[e("i",{class:"mdi mdi-view-list"},null,-1)])],2)])):x("",!0),(s=te.value)!=null&&s.installed?(n(),i("button",{key:1,onClick:ue(D,["stop"]),class:"btn btn-primary new-button"},[...l[19]||(l[19]=[e("i",{class:"mdi mdi-plus"},null,-1),e("span",null,"New",-1)])])):x("",!0),(R=te.value)!=null&&R.installed?(n(),i("div",Ni,[e("button",{onClick:ue(V,["stop"]),class:K(["icon-button settings-button",{active:o.value}]),title:"Settings"},[...l[20]||(l[20]=[e("i",{class:"mdi mdi-cog"},null,-1)])],2),o.value?(n(),i("div",{key:0,class:"settings-dropdown",onClick:l[5]||(l[5]=ue(()=>{},["stop"]))},[e("button",{onClick:p,class:"menu-item"},[l[21]||(l[21]=e("i",{class:"mdi mdi-help-circle"},null,-1)),e("span",null,f($.value?"Hide Help":"Show Help"),1)]),e("button",{onClick:l[4]||(l[4]=X=>{o.value=!1,xe()}),class:"menu-item"},[...l[22]||(l[22]=[e("i",{class:"mdi mdi-refresh"},null,-1),e("span",null,"Refresh Status",-1)])]),e("button",{onClick:pe,class:"menu-item"},[...l[23]||(l[23]=[e("i",{class:"mdi mdi-test-tube"},null,-1),e("span",null,"Test Codes",-1)])])])):x("",!0)])):x("",!0)])]),J(e("div",null,[g.value?(n(),i("div",Bi,[...l[24]||(l[24]=[e("div",{class:"spinner"},null,-1),e("p",null,"Checking SmartIR installation...",-1)])])):I.value?(n(),i("div",Hi,[l[25]||(l[25]=e("i",{class:"mdi mdi-alert-circle"},null,-1)),e("p",null,f(I.value),1),e("button",{onClick:xe,class:"btn-secondary"}," Try Again ")])):(G=te.value)!=null&&G.installed?(n(),i("div",qi,[$.value?(n(),i("div",zi,[S.value.recommendation?(n(),i("div",Ji,[e("p",null,f(S.value.recommendation.message),1),S.value.recommendation.next_steps?(n(),i("div",Wi,[l[26]||(l[26]=e("strong",null,"Next Steps:",-1)),e("ul",null,[(n(!0),i(me,null,he(S.value.recommendation.next_steps,(X,we)=>(n(),i("li",{key:we},f(X),1))),128))])])):x("",!0)])):x("",!0),e("div",Gi,[e("button",{onClick:l[6]||(l[6]=(...X)=>c.viewDocumentation&&c.viewDocumentation(...X)),class:"btn-secondary"},[...l[27]||(l[27]=[e("i",{class:"mdi mdi-book-open-variant"},null,-1),T(" View Documentation ",-1)])])])])):x("",!0),H.value.length>0&&!A.value?(n(),i("div",Ki,[e("div",Xi,[e("button",{class:K(["filter-toggle-button",{active:U.value||ge.value}]),onClick:l[7]||(l[7]=X=>U.value=!U.value),title:U.value?"Hide filters":"Show filters"},[l[28]||(l[28]=e("i",{class:"mdi mdi-filter-variant"},null,-1)),ge.value?(n(),i("span",Zi,f(Ie.value),1)):x("",!0)],10,Yi),e("div",Qi,[l[29]||(l[29]=e("i",{class:"mdi mdi-magnify search-icon"},null,-1)),J(e("input",{"onUpdate:modelValue":l[8]||(l[8]=X=>a.value.search=X),type:"text",placeholder:"Search profiles...",class:"search-input"},null,512),[[Le,a.value.search]])])]),J(e("div",er,[e("div",tr,[e("div",or,[e("label",null,[l[31]||(l[31]=e("i",{class:"mdi mdi-shape"},null,-1)),J(e("select",{"onUpdate:modelValue":l[9]||(l[9]=X=>a.value.platform=X)},[...l[30]||(l[30]=[Be('<option value="" data-v-b48342da>All Platforms</option><option value="climate" data-v-b48342da>Climate</option><option value="media_player" data-v-b48342da>Media Player</option><option value="fan" data-v-b48342da>Fan</option><option value="light" data-v-b48342da>Light</option>',5)])],512),[[De,a.value.platform]])])]),ge.value?(n(),i("button",{key:0,onClick:Ae,class:"btn-clear-filters"},[...l[32]||(l[32]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),T(" Clear ",-1)])])):x("",!0),e("div",lr,f(ie.value.length)+" of "+f(H.value.length),1)])],512),[[Ke,U.value]])])):x("",!0),F.value?(n(),i("div",nr,[...l[33]||(l[33]=[e("i",{class:"mdi mdi-loading mdi-spin"},null,-1),e("p",null,"Loading profiles...",-1)])])):H.value.length===0?(n(),i("div",sr,[...l[34]||(l[34]=[e("i",{class:"mdi mdi-file-document-outline"},null,-1),e("h3",null,"No Profiles Yet",-1),e("p",null,"Create your first SmartIR profile to get started",-1)])])):x("",!0),z.value==="grid"&&!A.value?(n(),i("div",ar,[(n(!0),i(me,null,he(ie.value,X=>(n(),Fe(Ra,{key:`${X.platform}-${X.code}`,profile:X,onEdit:we=>ce(X.platform,X),onCommands:we=>ce(X.platform,X,2),onDownload:we=>Re(X.platform,X),onDelete:we=>Q(X.platform,X)},null,8,["profile","onEdit","onCommands","onDownload","onDelete"]))),128))])):z.value==="list"&&!A.value&&ie.value.length>0?(n(),Fe(Qa,{key:5,profiles:ie.value,onEdit:l[10]||(l[10]=X=>ce(X.platform,X)),onCommands:l[11]||(l[11]=X=>ce(X.platform,X,2)),onDownload:l[12]||(l[12]=X=>Re(X.platform,X)),onDelete:l[13]||(l[13]=X=>Q(X.platform,X))},null,8,["profiles"])):x("",!0),H.value.length>0&&ie.value.length===0&&!A.value?(n(),i("div",ir,[...l[35]||(l[35]=[e("i",{class:"mdi mdi-filter-off"},null,-1),e("h3",null,"No profiles match your filters",-1),e("p",null,"Try adjusting your search or filter criteria",-1)])])):x("",!0)])):(n(),i("div",rr,[l[39]||(l[39]=e("div",{class:"status-badge warning"},[e("i",{class:"mdi mdi-information"}),e("span",null,"Not Installed")],-1)),e("div",dr,[l[37]||(l[37]=e("h4",null,"Why Install SmartIR?",-1)),e("ul",ur,[(n(!0),i(me,null,he(((re=(le=S.value)==null?void 0:le.recommendation)==null?void 0:re.benefits)||Y,(X,we)=>(n(),i("li",{key:we},[l[36]||(l[36]=e("i",{class:"mdi mdi-check"},null,-1)),e("span",null,f(X),1)]))),128))])]),e("div",cr,[e("p",null,f(((Me=(Z=S.value)==null?void 0:Z.recommendation)==null?void 0:Me.message)||"Install SmartIR to unlock climate device support!"),1)]),e("div",{class:"card-actions"},[e("button",{onClick:Oe,class:"btn-primary"},[...l[38]||(l[38]=[e("i",{class:"mdi mdi-github"},null,-1),T(" Install SmartIR ",-1)])])])]))],512),[[Ke,L.value]]),fe(Ne,{isOpen:b.value.show,title:b.value.title,message:b.value.message,confirmText:b.value.canDelete===!1?null:"Delete",cancelText:"Close",dangerMode:!0,confirmDisabled:b.value.canDelete===!1,onConfirm:h,onCancel:l[14]||(l[14]=X=>b.value.show=!1)},null,8,["isOpen","title","message","confirmText","confirmDisabled"]),fe(Ri,{isOpen:u.value,onClose:l[15]||(l[15]=X=>u.value=!1)},null,8,["isOpen"])])}}},vr=$e(mr,[["__scopeId","data-v-b48342da"]]),pr={class:"climate-form"},fr={class:"learning-mode-section"},gr={class:"mode-toggle"},yr={class:"mode-content"},br={class:"mode-stats"},hr={class:"stat-badge"},kr={class:"stat-badge time"},wr={class:"mode-content"},$r={class:"mode-stats"},Cr={class:"stat-badge"},_r={class:"stat-badge time warning"},Sr={key:0,class:"command-breakdown"},Ir={class:"warning-text"},Dr={class:"form-section"},Tr={key:0,class:"help-text"},xr={key:1,class:"help-text"},Rr={class:"form-row"},Mr={class:"form-group"},Er={class:"form-group"},Ar={class:"form-group"},Lr={key:2,class:"representative-temp-section"},Or={class:"form-group"},Pr=["value"],Vr={class:"form-section"},Ur={class:"checkbox-grid"},Fr={class:"checkbox-item"},jr={class:"checkbox-item"},Nr={class:"checkbox-item"},Br={class:"checkbox-item"},Hr={class:"checkbox-item"},qr={class:"checkbox-item"},zr={class:"form-section"},Jr={class:"checkbox-grid"},Wr={class:"checkbox-item"},Gr={class:"checkbox-item"},Kr={class:"checkbox-item"},Xr={class:"checkbox-item"},Yr={class:"form-section"},Zr={class:"checkbox-grid"},Qr={class:"checkbox-item"},ed={class:"checkbox-item"},td={class:"checkbox-item"},od={class:"checkbox-item"},ld={class:"form-section"},nd={class:"form-group"},sd={class:"form-group"},ad={class:"form-group"},id={key:0,class:"validation-summary"},rd={__name:"ClimateProfileForm",props:{modelValue:{type:Object,default:()=>({})}},emits:["update:modelValue"],setup(t,{emit:m}){const d=t,w=m,k=y("quick"),r=y({minTemp:16,maxTemp:30,precision:1,representativeTemp:24,modes:["off","auto","cool","heat"],fanModes:["auto","low","medium","high"],swingModes:[],tempSensor:"",humiditySensor:"",powerSensor:"",learningMode:"quick",...d.modelValue}),v=W(()=>{const U=[],a=r.value.minTemp||16,b=r.value.maxTemp||30,u=r.value.precision||1;for(let O=a;O<=b;O+=u)U.push(O);return U}),g=W(()=>r.value.modes.filter(U=>U!=="off").length),I=W(()=>r.value.fanModes.length||1),S=W(()=>r.value.swingModes.length||1),A=W(()=>{const U=r.value.minTemp||16,a=r.value.maxTemp||30,b=r.value.precision||1;return Math.floor((a-U)/b)+1}),$=W(()=>{const U=r.value.modes.includes("off")?1:0;return g.value*I.value*S.value+U}),o=W(()=>Math.ceil($.value*30/60)),L=W(()=>{const U=r.value.modes.includes("off")?1:0;return g.value*A.value*I.value*S.value+U}),H=W(()=>Math.ceil(L.value*30/60)),F=W(()=>{const U=[];return(!r.value.minTemp||r.value.minTemp<10||r.value.minTemp>35)&&U.push("Minimum temperature must be between 10Â°C and 35Â°C"),(!r.value.maxTemp||r.value.maxTemp<10||r.value.maxTemp>35)&&U.push("Maximum temperature must be between 10Â°C and 35Â°C"),r.value.minTemp>=r.value.maxTemp&&U.push("Minimum temperature must be less than maximum temperature"),(!r.value.modes||r.value.modes.length===0)&&U.push("At least one HVAC mode must be selected"),U});return se(k,U=>{r.value.learningMode=U}),se(r,U=>{w("update:modelValue",U)},{deep:!0,immediate:!0}),(U,a)=>(n(),i("div",pr,[a[63]||(a[63]=e("h3",null,"Climate Device Configuration",-1)),e("div",fr,[e("div",gr,[e("label",{class:K(["mode-option",{active:k.value==="quick"}])},[J(e("input",{type:"radio",value:"quick","onUpdate:modelValue":a[0]||(a[0]=b=>k.value=b)},null,512),[[He,k.value]]),e("div",yr,[a[23]||(a[23]=e("div",{class:"mode-header"},[e("i",{class:"mdi mdi-flash"}),e("strong",null,"Quick Mode (Recommended)")],-1)),a[24]||(a[24]=e("p",null,"Learn one temperature per mode combination",-1)),e("div",br,[e("span",hr,f($.value)+" commands",1),e("span",kr,"~"+f(o.value)+" min",1)])])],2),e("label",{class:K(["mode-option",{active:k.value==="complete"}])},[J(e("input",{type:"radio",value:"complete","onUpdate:modelValue":a[1]||(a[1]=b=>k.value=b)},null,512),[[He,k.value]]),e("div",wr,[a[25]||(a[25]=e("div",{class:"mode-header"},[e("i",{class:"mdi mdi-check-all"}),e("strong",null,"Complete Mode")],-1)),a[26]||(a[26]=e("p",null,"Learn all temperature combinations",-1)),e("div",$r,[e("span",Cr,f(L.value)+" commands",1),e("span",_r,"~"+f(H.value)+" min",1)])])],2)]),k.value==="complete"?(n(),i("div",Sr,[a[27]||(a[27]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[e("strong",null,"Complete mode will require learning "+f(L.value)+" commands",1),e("p",null,"This includes all combinations of modes ("+f(g.value)+"), temperatures ("+f(A.value)+"), fan speeds ("+f(I.value)+"), and swing modes ("+f(S.value)+").",1),e("p",Ir,"â±ï¸ Estimated time: "+f(H.value)+" minutes at ~30 seconds per command",1)])])):x("",!0)]),e("div",Dr,[a[33]||(a[33]=e("h4",null,"Temperature Range",-1)),k.value==="quick"?(n(),i("p",Tr," Define the full temperature range your device supports. You'll select one temperature to learn below. ")):(n(),i("p",xr," Define the temperature range. All temperatures in this range will be learned. ")),e("div",Rr,[e("div",Mr,[a[28]||(a[28]=e("label",null,"Minimum Temperature (Â°C) *",-1)),J(e("input",{"onUpdate:modelValue":a[2]||(a[2]=b=>r.value.minTemp=b),type:"number",min:"10",max:"35",placeholder:"16"},null,512),[[Le,r.value.minTemp,void 0,{number:!0}]])]),e("div",Er,[a[29]||(a[29]=e("label",null,"Maximum Temperature (Â°C) *",-1)),J(e("input",{"onUpdate:modelValue":a[3]||(a[3]=b=>r.value.maxTemp=b),type:"number",min:"10",max:"35",placeholder:"30"},null,512),[[Le,r.value.maxTemp,void 0,{number:!0}]])]),e("div",Ar,[a[31]||(a[31]=e("label",null,"Precision",-1)),J(e("select",{"onUpdate:modelValue":a[4]||(a[4]=b=>r.value.precision=b)},[...a[30]||(a[30]=[e("option",{value:1},"1Â°C (Whole degrees)",-1),e("option",{value:.5},"0.5Â°C (Half degrees)",-1)])],512),[[De,r.value.precision,void 0,{number:!0}]])])]),k.value==="quick"?(n(),i("div",Lr,[e("div",Or,[a[32]||(a[32]=e("label",null,"Representative Temperature to Learn *",-1)),J(e("select",{"onUpdate:modelValue":a[5]||(a[5]=b=>r.value.representativeTemp=b)},[(n(!0),i(me,null,he(v.value,b=>(n(),i("option",{key:b,value:b},f(b)+"Â°C ",9,Pr))),128))],512),[[De,r.value.representativeTemp,void 0,{number:!0}]]),e("small",null,"This temperature will be learned for all mode combinations. The device profile will still show the full range ("+f(r.value.minTemp)+"Â°C - "+f(r.value.maxTemp)+"Â°C).",1)])])):x("",!0)]),e("div",Vr,[a[40]||(a[40]=e("h4",null,"Supported HVAC Modes *",-1)),a[41]||(a[41]=e("p",{class:"help-text"},"Select all modes your device supports",-1)),e("div",Ur,[e("label",Fr,[J(e("input",{type:"checkbox",value:"off","onUpdate:modelValue":a[6]||(a[6]=b=>r.value.modes=b)},null,512),[[ve,r.value.modes]]),a[34]||(a[34]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),T(" Off ")],-1))]),e("label",jr,[J(e("input",{type:"checkbox",value:"auto","onUpdate:modelValue":a[7]||(a[7]=b=>r.value.modes=b)},null,512),[[ve,r.value.modes]]),a[35]||(a[35]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-autorenew"}),T(" Auto ")],-1))]),e("label",Nr,[J(e("input",{type:"checkbox",value:"cool","onUpdate:modelValue":a[8]||(a[8]=b=>r.value.modes=b)},null,512),[[ve,r.value.modes]]),a[36]||(a[36]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-snowflake"}),T(" Cool ")],-1))]),e("label",Br,[J(e("input",{type:"checkbox",value:"heat","onUpdate:modelValue":a[9]||(a[9]=b=>r.value.modes=b)},null,512),[[ve,r.value.modes]]),a[37]||(a[37]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fire"}),T(" Heat ")],-1))]),e("label",Hr,[J(e("input",{type:"checkbox",value:"dry","onUpdate:modelValue":a[10]||(a[10]=b=>r.value.modes=b)},null,512),[[ve,r.value.modes]]),a[38]||(a[38]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-water-percent"}),T(" Dry ")],-1))]),e("label",qr,[J(e("input",{type:"checkbox",value:"fan_only","onUpdate:modelValue":a[11]||(a[11]=b=>r.value.modes=b)},null,512),[[ve,r.value.modes]]),a[39]||(a[39]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan"}),T(" Fan Only ")],-1))])])]),e("div",zr,[a[46]||(a[46]=e("h4",null,"Fan Modes",-1)),a[47]||(a[47]=e("p",{class:"help-text"},"Select all fan speeds your device supports",-1)),e("div",Jr,[e("label",Wr,[J(e("input",{type:"checkbox",value:"auto","onUpdate:modelValue":a[12]||(a[12]=b=>r.value.fanModes=b)},null,512),[[ve,r.value.fanModes]]),a[42]||(a[42]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-autorenew"}),T(" Auto ")],-1))]),e("label",Gr,[J(e("input",{type:"checkbox",value:"low","onUpdate:modelValue":a[13]||(a[13]=b=>r.value.fanModes=b)},null,512),[[ve,r.value.fanModes]]),a[43]||(a[43]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-1"}),T(" Low ")],-1))]),e("label",Kr,[J(e("input",{type:"checkbox",value:"medium","onUpdate:modelValue":a[14]||(a[14]=b=>r.value.fanModes=b)},null,512),[[ve,r.value.fanModes]]),a[44]||(a[44]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-2"}),T(" Medium ")],-1))]),e("label",Xr,[J(e("input",{type:"checkbox",value:"high","onUpdate:modelValue":a[15]||(a[15]=b=>r.value.fanModes=b)},null,512),[[ve,r.value.fanModes]]),a[45]||(a[45]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-3"}),T(" High ")],-1))])])]),e("div",Yr,[a[52]||(a[52]=e("h4",null,"Swing Modes (Optional)",-1)),a[53]||(a[53]=e("p",{class:"help-text"},"Select if your device has swing/oscillation",-1)),e("div",Zr,[e("label",Qr,[J(e("input",{type:"checkbox",value:"off","onUpdate:modelValue":a[16]||(a[16]=b=>r.value.swingModes=b)},null,512),[[ve,r.value.swingModes]]),a[48]||(a[48]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-horizontal"}),T(" Off ")],-1))]),e("label",ed,[J(e("input",{type:"checkbox",value:"vertical","onUpdate:modelValue":a[17]||(a[17]=b=>r.value.swingModes=b)},null,512),[[ve,r.value.swingModes]]),a[49]||(a[49]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-vertical"}),T(" Vertical ")],-1))]),e("label",td,[J(e("input",{type:"checkbox",value:"horizontal","onUpdate:modelValue":a[18]||(a[18]=b=>r.value.swingModes=b)},null,512),[[ve,r.value.swingModes]]),a[50]||(a[50]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-horizontal"}),T(" Horizontal ")],-1))]),e("label",od,[J(e("input",{type:"checkbox",value:"both","onUpdate:modelValue":a[19]||(a[19]=b=>r.value.swingModes=b)},null,512),[[ve,r.value.swingModes]]),a[51]||(a[51]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-arrow-all"}),T(" Both ")],-1))])])]),e("div",ld,[a[60]||(a[60]=e("h4",null,"Sensors (Optional)",-1)),a[61]||(a[61]=e("p",{class:"help-text"},"Link external sensors for better climate control",-1)),e("div",nd,[a[54]||(a[54]=e("label",null,"Temperature Sensor",-1)),J(e("input",{"onUpdate:modelValue":a[20]||(a[20]=b=>r.value.tempSensor=b),type:"text",placeholder:"sensor.living_room_temperature"},null,512),[[Le,r.value.tempSensor]]),a[55]||(a[55]=e("small",null,"Entity ID of temperature sensor",-1))]),e("div",sd,[a[56]||(a[56]=e("label",null,"Humidity Sensor",-1)),J(e("input",{"onUpdate:modelValue":a[21]||(a[21]=b=>r.value.humiditySensor=b),type:"text",placeholder:"sensor.living_room_humidity"},null,512),[[Le,r.value.humiditySensor]]),a[57]||(a[57]=e("small",null,"Entity ID of humidity sensor",-1))]),e("div",ad,[a[58]||(a[58]=e("label",null,"Power Sensor",-1)),J(e("input",{"onUpdate:modelValue":a[22]||(a[22]=b=>r.value.powerSensor=b),type:"text",placeholder:"binary_sensor.ac_power"},null,512),[[Le,r.value.powerSensor]]),a[59]||(a[59]=e("small",null,"Entity ID of power sensor (to detect on/off state)",-1))])]),F.value.length>0?(n(),i("div",id,[a[62]||(a[62]=e("h4",null,[e("i",{class:"mdi mdi-alert-circle"}),T(" Please fix the following: ")],-1)),e("ul",null,[(n(!0),i(me,null,he(F.value,(b,u)=>(n(),i("li",{key:u},f(b),1))),128))])])):x("",!0)]))}},dd=$e(rd,[["__scopeId","data-v-c44d7198"]]),ud={class:"command-wizard"},cd={class:"device-selection-section"},md={class:"input-wrapper"},vd=["value"],pd={key:0,class:"validation-tooltip"},fd={class:"form-group"},gd=["disabled"],yd={key:0},bd={key:1},hd={key:0,class:"edit-mode-banner"},kd={class:"wizard-info"},wd={key:0},$d={key:1},Cd={class:"progress-info"},_d={class:"progress-bar"},Sd={class:"progress-text"},Id={class:"commands-grid"},Dd={class:"command-header"},Td={class:"command-icon"},xd={class:"command-info"},Rd={key:0,class:"learning-indicator"},Md={key:0,class:"ir-learning-steps"},Ed={key:1,class:"rf-learning-steps"},Ad={class:"command-actions"},Ld=["onClick","disabled"],Od={key:1,class:"learned-status"},Pd=["onClick","disabled"],Vd=["onClick"],Ud={class:"quick-actions"},Fd=["disabled"],jd=["disabled"],Nd={__name:"CommandLearningWizard",props:{modelValue:{type:Object,default:()=>({})},platform:{type:String,required:!0},config:{type:Object,required:!0},broadlinkDevice:{type:String,default:""},manufacturer:{type:String,required:!0},model:{type:String,required:!0},commandType:{type:String,default:"ir"}},emits:["update:modelValue","update:broadlinkDevice","update:commandType"],setup(t,{emit:m}){const d=Je(),w=t,k=m,r=y({...w.modelValue}),v=y(null),g=y(null),I=y([]),S=y(w.broadlinkDevice),A=y(w.commandType),$=y(!1),o=y([]),L=y(!1),H=y(!1),F=y({show:!1,commandKey:null,commandLabel:""}),U=y(!1),a=W(()=>{const D=[];if(w.platform==="climate"){const p=w.config.modes||[],V=w.config.fanModes||[],pe=w.config.minTemp||16,Oe=w.config.maxTemp||30;p.forEach(ye=>{if(ye==="off")D.push({key:"off",label:"Power Off",description:"Turn device off",icon:"mdi mdi-power",mode:"off"});else for(let ce=pe;ce<=Oe;ce++)V.forEach(Re=>{const Pe=`${ye}_${ce}_${Re}`;D.push({key:Pe,label:`${ye.toUpperCase()} ${ce}Â°C ${Re}`,description:`Mode: ${ye}, Temp: ${ce}Â°C, Fan: ${Re}`,icon:z(ye),mode:ye,temp:ce,fanMode:Re})})})}else if(w.platform==="media_player"){const p=w.config.features||[];p.includes("turn_on")&&(D.push({key:"turn_on",label:"Power On",description:"Turn on the device",icon:"mdi mdi-power"}),D.push({key:"turn_off",label:"Power Off",description:"Turn off the device",icon:"mdi mdi-power-off"})),p.includes("volume")&&(D.push({key:"volume_up",label:"Volume Up",description:"Increase volume",icon:"mdi mdi-volume-plus"}),D.push({key:"volume_down",label:"Volume Down",description:"Decrease volume",icon:"mdi mdi-volume-minus"})),p.includes("mute")&&D.push({key:"mute",label:"Mute",description:"Toggle mute",icon:"mdi mdi-volume-mute"}),p.includes("source")&&(D.push({key:"source_hdmi1",label:"Source: HDMI 1",description:"Switch to HDMI 1",icon:"mdi mdi-import"}),D.push({key:"source_hdmi2",label:"Source: HDMI 2",description:"Switch to HDMI 2",icon:"mdi mdi-import"}),D.push({key:"source_hdmi3",label:"Source: HDMI 3",description:"Switch to HDMI 3",icon:"mdi mdi-import"})),p.includes("channel")&&(D.push({key:"channel_up",label:"Channel Up",description:"Next channel",icon:"mdi mdi-chevron-up"}),D.push({key:"channel_down",label:"Channel Down",description:"Previous channel",icon:"mdi mdi-chevron-down"}))}else if(w.platform==="fan"){const p=w.config.speedLevels||3,V=w.config.features||[];D.push({key:"turn_on",label:"Power On",description:"Turn on the fan",icon:"mdi mdi-power"}),D.push({key:"turn_off",label:"Power Off",description:"Turn off the fan",icon:"mdi mdi-power-off"});for(let pe=1;pe<=p;pe++){const Oe=pe===1?"Low":pe===p?"High":pe===2&&p===3?"Medium":`Speed ${pe}`;D.push({key:`speed_${pe}`,label:`${Oe}`,description:`Set fan to speed level ${pe}`,icon:"mdi mdi-fan"})}V.includes("oscillate")&&(D.push({key:"oscillate_on",label:"Oscillate On",description:"Enable oscillation",icon:"mdi mdi-sync"}),D.push({key:"oscillate_off",label:"Oscillate Off",description:"Disable oscillation",icon:"mdi mdi-sync-off"})),V.includes("direction")&&(D.push({key:"direction_forward",label:"Direction: Forward",description:"Set direction to forward",icon:"mdi mdi-rotate-right"}),D.push({key:"direction_reverse",label:"Direction: Reverse",description:"Set direction to reverse",icon:"mdi mdi-rotate-left"}))}else if(w.platform==="light"){const p=w.config.features||[];p.includes("turn_on")&&(D.push({key:"turn_on",label:"Power On",description:"Turn on the light",icon:"mdi mdi-lightbulb-on"}),D.push({key:"turn_off",label:"Power Off",description:"Turn off the light",icon:"mdi mdi-lightbulb-off"})),p.includes("brightness")&&(D.push({key:"brightness_up",label:"Brightness Up",description:"Increase brightness",icon:"mdi mdi-brightness-7"}),D.push({key:"brightness_down",label:"Brightness Down",description:"Decrease brightness",icon:"mdi mdi-brightness-5"})),p.includes("color_temp")&&(D.push({key:"color_temp_warm",label:"Warm White",description:"Set to warm white",icon:"mdi mdi-weather-sunset"}),D.push({key:"color_temp_cool",label:"Cool White",description:"Set to cool white",icon:"mdi mdi-weather-sunny"})),p.includes("rgb")&&(D.push({key:"color_red",label:"Color: Red",description:"Set color to red",icon:"mdi mdi-palette"}),D.push({key:"color_green",label:"Color: Green",description:"Set color to green",icon:"mdi mdi-palette"}),D.push({key:"color_blue",label:"Color: Blue",description:"Set color to blue",icon:"mdi mdi-palette"}))}return D}),b=W(()=>a.value.length),u=W(()=>Object.keys(r.value).length),O=W(()=>b.value===0?0:Math.round(u.value/b.value*100));function z(D){return{off:"mdi mdi-power",auto:"mdi mdi-autorenew",cool:"mdi mdi-snowflake",heat:"mdi mdi-fire",dry:"mdi mdi-water-percent",fan_only:"mdi mdi-fan"}[D]||"mdi mdi-remote"}async function Y(D){if(!v.value){if(!S.value){H.value=!0,window.scrollTo({top:0,behavior:"smooth"});return}H.value=!1,v.value=D.key;try{const p=w.manufacturer.toLowerCase().replace(/[^a-z0-9]+/g,"_"),V=w.model.toLowerCase().replace(/[^a-z0-9]+/g,"_"),pe=`${p}_${V}`,ye=(await ee.post("/api/commands/learn",{entity_id:S.value,device:pe,command:D.key,command_type:A.value})).data;if(ye.success&&ye.code)r.value[D.key]=ye.code,k("update:modelValue",r.value),L.value=!0,ye.code==="pending"&&console.log(`â³ Command '${D.key}' learned, code will be fetched from storage when saving`),$.value&&o.value.length>0&&setTimeout(()=>{const ce=o.value.shift();ce?Y(ce):$.value=!1},1e3);else throw new Error(ye.error||"Failed to learn command")}catch(p){console.error("Error learning command:",p),d.error(`Error learning command: ${p.message}`),$.value=!1,o.value=[]}finally{$.value||(v.value=null)}}}async function P(D){var p;if(!S.value){H.value=!0,window.scrollTo({top:0,behavior:"smooth"});return}if(!r.value[D]){(p=d.value)==null||p.error("Command not learned yet");return}g.value=D;try{const V=r.value[D];await ee.post("/api/commands/send-raw",{entity_id:S.value,command:V,command_type:A.value}),d.success("Command sent successfully")}catch(V){console.error("Error testing command:",V),d.error(`Error testing command: ${V.message}`)}finally{g.value=null}}function te(D){const p=a.value.find(V=>V.key===D);F.value={show:!0,commandKey:D,commandLabel:p?p.label:D}}function M(){const D=F.value.commandKey;delete r.value[D],k("update:modelValue",r.value),F.value.show=!1}function j(){const D=a.value.filter(V=>!r.value[V.key]);if(D.length===0)return;$.value=!0,o.value=[...D];const p=o.value.shift();p&&Y(p)}function oe(){U.value=!0}function ie(){r.value={},k("update:modelValue",r.value),U.value=!1}se(()=>w.modelValue,D=>{r.value={...D}},{deep:!0}),Te(async()=>{await ge()});async function ge(){try{console.log("SmartIR device - commands will be loaded from SmartIR JSON file, not Broadlink storage")}catch(D){console.error("Error in loadExistingCommands:",D)}}function Ie(){k("update:broadlinkDevice",S.value)}function Ae(){k("update:commandType",A.value)}async function xe(){try{console.log("ðŸ” Loading Broadlink devices from /api/remote/devices");const D=await ee.get("/api/remote/devices");console.log("ðŸ“¦ Response data:",D.data);const p=D.data.devices||[];console.log(`âœ… Found ${p.length} devices:`,p),I.value=p}catch(D){console.error("âŒ Error loading remote devices:",D),I.value=[]}}return se(()=>w.broadlinkDevice,D=>{S.value=D}),se(S,D=>{D&&(H.value=!1)}),se(()=>w.commandType,D=>{A.value=D}),Te(async()=>{await xe(),await ge()}),(D,p)=>(n(),i("div",ud,[p[22]||(p[22]=e("h3",null,"Learn IR Commands",-1)),e("div",cd,[e("div",{class:K(["form-group",{"has-error":H.value}])},[p[6]||(p[6]=e("label",null,"Broadlink Device *",-1)),e("div",md,[J(e("select",{"onUpdate:modelValue":p[0]||(p[0]=V=>S.value=V),onChange:Ie},[p[4]||(p[4]=e("option",{value:""},"Select Broadlink device...",-1)),(n(!0),i(me,null,he(I.value,V=>(n(),i("option",{key:V.entity_id,value:V.entity_id},f(V.name||V.entity_id),9,vd))),128))],544),[[De,S.value]]),H.value?(n(),i("div",pd,[...p[5]||(p[5]=[e("i",{class:"mdi mdi-alert"},null,-1),T(" Device is required ",-1)])])):x("",!0)]),e("small",null,"This device will be used to learn commands ("+f(I.value.length)+" devices found)",1)],2),e("div",fd,[p[8]||(p[8]=e("label",null,"Command Type *",-1)),J(e("select",{"onUpdate:modelValue":p[1]||(p[1]=V=>A.value=V),onChange:Ae,disabled:u.value>0},[...p[7]||(p[7]=[e("option",{value:"ir"},"ðŸ“¡ Infrared (IR) - Most common for AC, TV, etc.",-1),e("option",{value:"rf"},"ðŸ“» Radio Frequency (RF) - For RF remotes",-1)])],40,gd),[[De,A.value]]),u.value>0?(n(),i("small",yd,"Command type cannot be changed after learning commands")):(n(),i("small",bd,"Select the type of commands your device uses"))])]),u.value>0&&!L.value?(n(),i("div",hd,[p[10]||(p[10]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[p[9]||(p[9]=e("strong",null,"Editing Existing Profile",-1)),e("p",null,f(u.value)+" command"+f(u.value!==1?"s":"")+' already learned. You can re-learn any command by clicking the delete icon and then "Learn Command".',1)])])):x("",!0),e("div",kd,[p[14]||(p[14]=e("i",{class:"mdi mdi-information"},null,-1)),e("div",null,[p[13]||(p[13]=e("p",null,[e("strong",null,"How it works:")],-1)),t.commandType==="ir"?(n(),i("ol",wd,[...p[11]||(p[11]=[e("li",null,'Click "Learn Command" for each combination',-1),e("li",null,[e("strong",null,"Point your IR remote directly at the Broadlink device")],-1),e("li",null,"Press the button on your remote",-1),e("li",null,"Wait for confirmation (up to 30 seconds)",-1)])])):(n(),i("ol",$d,[...p[12]||(p[12]=[e("li",null,'Click "Learn Command" for each combination',-1),e("li",null,[e("strong",null,"Step 1:"),T(" Hold button on remote - Broadlink scans for RF frequency")],-1),e("li",null,[e("strong",null,"Step 2:"),T(" Watch for Home Assistant notification, then press and release button")],-1),e("li",null,"Keep remote within 5cm of Broadlink (RF doesn't need line-of-sight)",-1),e("li",null,"Wait for confirmation (may take up to 30 seconds)",-1)])]))])]),e("div",Cd,[e("div",_d,[e("div",{class:"progress-fill",style:vt({width:O.value+"%"})},null,4)]),e("span",Sd,f(u.value)+" / "+f(b.value)+" commands learned ("+f(O.value)+"%) ",1)]),e("div",Id,[(n(!0),i(me,null,he(a.value,V=>(n(),i("div",{key:V.key,class:K(["command-card",{learned:r.value[V.key],learning:v.value===V.key}])},[e("div",Dd,[e("div",Td,[e("i",{class:K(V.icon)},null,2)]),e("div",xd,[e("h4",null,f(V.label),1),e("p",null,f(V.description),1)])]),v.value===V.key?(n(),i("div",Rd,[t.commandType==="ir"?(n(),i("div",Md,[...p[15]||(p[15]=[e("p",null,[e("strong",null,"Point your remote directly at the Broadlink device and press the button.")],-1),e("small",null,"Listening for up to 30 seconds...",-1)])])):(n(),i("div",Ed,[...p[16]||(p[16]=[e("p",{class:"rf-title"},[e("strong",null,"Learning request sent to device.")],-1),e("p",{class:"rf-subtitle"},[T("RF learning is a "),e("strong",null,"two-step process"),T(":")],-1),e("ol",null,[e("li",null,[e("strong",null,"Step 1 - Frequency Sweep (~10-15 seconds):"),T(" Press and hold the button on your remote until the notification updates. ")]),e("li",null,[e("strong",null,"Step 2 - Learn Signal:"),T(" Press and release the button once. ")])],-1),e("p",{class:"rf-note"},"Follow the Home Assistant notifications (ðŸ””) for real-time instructions.",-1)])]))])):x("",!0),e("div",Ad,[r.value[V.key]?(n(),i("div",Od,[p[18]||(p[18]=e("i",{class:"mdi mdi-check-circle"},null,-1)),p[19]||(p[19]=e("span",null,"Learned",-1)),e("span",{class:K(["command-type-badge",A.value])},f(A.value.toUpperCase()),3),e("button",{onClick:pe=>P(V.key),class:"icon-btn",title:"Test command",disabled:g.value===V.key,style:{"margin-left":"auto"}},[e("i",{class:K(["mdi mdi-play",{"mdi-spin":g.value===V.key}])},null,2)],8,Pd),e("button",{onClick:pe=>te(V.key),class:"icon-btn danger",title:"Delete and re-learn"},[...p[17]||(p[17]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,Vd)])):(n(),i("button",{key:0,onClick:pe=>Y(V),class:K(["btn-learn",{learning:v.value===V.key}]),disabled:v.value!==null},[e("i",{class:K(["mdi mdi-radio-tower",{"mdi-spin":v.value===V.key}])},null,2),T(" "+f(v.value===V.key?"Listening...":"Learn Command"),1)],10,Ld))])],2))),128))]),e("div",Ud,[e("button",{onClick:j,class:"btn-secondary",disabled:v.value!==null||u.value===b.value},[...p[20]||(p[20]=[e("i",{class:"mdi mdi-play-circle"},null,-1),T(" Learn All Remaining ",-1)])],8,Fd),e("button",{onClick:oe,class:"btn-text",disabled:u.value===0},[...p[21]||(p[21]=[e("i",{class:"mdi mdi-delete-sweep"},null,-1),T(" Clear All ",-1)])],8,jd)]),fe(Ne,{isOpen:F.value.show,title:"Delete Learned Command?",message:`Are you sure you want to delete the '${F.value.commandLabel}' command?

You will need to re-learn this command.`,confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,onConfirm:M,onCancel:p[2]||(p[2]=V=>F.value.show=!1)},null,8,["isOpen","message"]),fe(Ne,{isOpen:U.value,title:"Delete All Learned Commands?",message:"Are you sure you want to delete all learned commands? This cannot be undone.\\n\\nYou will need to re-learn all commands.",confirmText:"Delete All",cancelText:"Cancel",dangerMode:!0,onConfirm:ie,onCancel:p[3]||(p[3]=V=>U.value=!1)},null,8,["isOpen"])]))}},Bd=$e(Nd,[["__scopeId","data-v-9a9e9e51"]]),Hd={class:"profile-preview"},qd={class:"preview-summary"},zd={class:"summary-card"},Jd={class:"stats-grid"},Wd={class:"stat-item"},Gd={class:"stat-value"},Kd={class:"stat-item"},Xd={class:"stat-value"},Yd={class:"stat-item"},Zd={class:"stat-value"},Qd={class:"preview-tabs"},eu={class:"preview-content"},tu={key:0,class:"tab-content"},ou={class:"code-header"},lu={class:"code-block"},nu={key:1,class:"tab-content"},su={class:"code-header"},au={class:"code-block"},iu={key:2,class:"tab-content"},ru={class:"instructions"},du={class:"step-item"},uu={class:"step-content"},cu={class:"code-path"},mu={__name:"ProfilePreview",props:{profile:{type:Object,required:!0},jsonData:{type:Object,required:!0},yamlConfig:{type:String,required:!0}},setup(t){const m=Je(),d=t,w=y("json"),k=y(!1),r=y(!1),v=W(()=>Object.keys(d.profile.commands||{}).length),g=W(()=>JSON.stringify(d.jsonData,null,2));async function I(){try{await navigator.clipboard.writeText(g.value),k.value=!0,setTimeout(()=>{k.value=!1},2e3)}catch(A){console.error("Failed to copy JSON:",A),m.error("Failed to copy to clipboard")}}async function S(){try{await navigator.clipboard.writeText(d.yamlConfig),r.value=!0,setTimeout(()=>{r.value=!1},2e3)}catch(A){console.error("Failed to copy YAML:",A),m.error("Failed to copy to clipboard")}}return(A,$)=>{var o;return n(),i("div",Hd,[$[22]||($[22]=e("h3",null,"Preview & Save",-1)),e("div",qd,[e("div",zd,[$[4]||($[4]=e("i",{class:"mdi mdi-check-circle"},null,-1)),e("div",null,[$[3]||($[3]=e("h4",null,"Profile Ready!",-1)),e("p",null,f(t.profile.manufacturer)+" "+f(t.profile.model),1)])]),e("div",Jd,[e("div",Wd,[e("span",Gd,f(v.value),1),$[5]||($[5]=e("span",{class:"stat-label"},"Commands Learned",-1))]),e("div",Kd,[e("span",Xd,f(t.profile.platform),1),$[6]||($[6]=e("span",{class:"stat-label"},"Platform",-1))]),e("div",Yd,[e("span",Zd,f(((o=t.profile.config.modes)==null?void 0:o.length)||0),1),$[7]||($[7]=e("span",{class:"stat-label"},"HVAC Modes",-1))])])]),e("div",Qd,[e("button",{onClick:$[0]||($[0]=L=>w.value="json"),class:K(["tab-button",{active:w.value==="json"}])},[...$[8]||($[8]=[e("i",{class:"mdi mdi-code-json"},null,-1),T(" SmartIR JSON ",-1)])],2),e("button",{onClick:$[1]||($[1]=L=>w.value="yaml"),class:K(["tab-button",{active:w.value==="yaml"}])},[...$[9]||($[9]=[e("i",{class:"mdi mdi-file-code"},null,-1),T(" YAML Config ",-1)])],2),e("button",{onClick:$[2]||($[2]=L=>w.value="instructions"),class:K(["tab-button",{active:w.value==="instructions"}])},[...$[10]||($[10]=[e("i",{class:"mdi mdi-information"},null,-1),T(" Instructions ",-1)])],2)]),e("div",eu,[w.value==="json"?(n(),i("div",tu,[e("div",ou,[$[12]||($[12]=e("h4",null,"SmartIR Device Code JSON",-1)),e("button",{onClick:I,class:"btn-copy"},[$[11]||($[11]=e("i",{class:"mdi mdi-content-copy"},null,-1)),T(" "+f(k.value?"Copied!":"Copy"),1)])]),e("pre",lu,[e("code",null,f(g.value),1)]),$[13]||($[13]=e("p",{class:"code-note"},[e("i",{class:"mdi mdi-information"}),T(" Save this as "),e("code",null,"10000.json"),T(" in your SmartIR codes directory ")],-1))])):x("",!0),w.value==="yaml"?(n(),i("div",nu,[e("div",su,[$[15]||($[15]=e("h4",null,"Home Assistant Configuration",-1)),e("button",{onClick:S,class:"btn-copy"},[$[14]||($[14]=e("i",{class:"mdi mdi-content-copy"},null,-1)),T(" "+f(r.value?"Copied!":"Copy"),1)])]),e("pre",au,[e("code",null,f(t.yamlConfig),1)]),$[16]||($[16]=e("p",{class:"code-note"},[e("i",{class:"mdi mdi-information"}),T(" Add this to your "),e("code",null,"configuration.yaml"),T(" file ")],-1))])):x("",!0),w.value==="instructions"?(n(),i("div",iu,[e("div",ru,[$[20]||($[20]=e("h4",null,"Installation Steps",-1)),e("div",du,[$[19]||($[19]=e("div",{class:"step-number"},"1",-1)),e("div",uu,[$[17]||($[17]=e("h5",null,"Get Next Code Number",-1)),$[18]||($[18]=e("p",null,"Custom device codes start at 10000. Check your SmartIR codes directory to find the next available number.",-1)),e("div",cu,[e("code",null,"/config/custom_components/smartir/codes/"+f(t.profile.platform)+"/",1)])])]),$[21]||($[21]=Be('<div class="step-item" data-v-e7b997c8><div class="step-number" data-v-e7b997c8>2</div><div class="step-content" data-v-e7b997c8><h5 data-v-e7b997c8>Save JSON File</h5><p data-v-e7b997c8>Copy the JSON from the &quot;SmartIR JSON&quot; tab and save it as <code data-v-e7b997c8>10000.json</code> (or your next available number) in the codes directory.</p></div></div><div class="step-item" data-v-e7b997c8><div class="step-number" data-v-e7b997c8>3</div><div class="step-content" data-v-e7b997c8><h5 data-v-e7b997c8>Update Configuration</h5><p data-v-e7b997c8>Copy the YAML from the &quot;YAML Config&quot; tab and add it to your <code data-v-e7b997c8>configuration.yaml</code> file. Update the <code data-v-e7b997c8>device_code</code> to match your JSON filename.</p></div></div><div class="step-item" data-v-e7b997c8><div class="step-number" data-v-e7b997c8>4</div><div class="step-content" data-v-e7b997c8><h5 data-v-e7b997c8>Restart Home Assistant</h5><p data-v-e7b997c8>Restart Home Assistant to load the new configuration. Your climate entity will appear in the UI.</p></div></div><div class="step-item" data-v-e7b997c8><div class="step-number" data-v-e7b997c8>5</div><div class="step-content" data-v-e7b997c8><h5 data-v-e7b997c8>Test Your Device</h5><p data-v-e7b997c8>Go to your climate entity and test different modes, temperatures, and fan speeds to ensure everything works correctly.</p></div></div><div class="tips-section" data-v-e7b997c8><h4 data-v-e7b997c8><i class="mdi mdi-lightbulb" data-v-e7b997c8></i> Tips </h4><ul data-v-e7b997c8><li data-v-e7b997c8>Keep a backup of your JSON file in case you need to modify it</li><li data-v-e7b997c8>Test all commands to ensure they work as expected</li><li data-v-e7b997c8>You can share your profile with the SmartIR community on GitHub</li><li data-v-e7b997c8>If a command doesn&#39;t work, you can re-learn it and update the JSON</li></ul></div>',5))])])):x("",!0)])])}}},vu=$e(mu,[["__scopeId","data-v-e7b997c8"]]),pu={class:"wizard-body"},fu={key:0,class:"warning-section"},gu={class:"warning-box"},yu={class:"instructions"},bu={class:"code-block"},hu={class:"steps"},ku={key:0},wu={class:"help-section"},$u={key:0,class:"help-content"},Cu={class:"help-step"},_u={key:0,class:"help-step"},Su={class:"help-step"},Iu={class:"help-step"},Du={class:"checklist"},Tu={class:"checkbox-label"},xu={key:0,class:"checkbox-label"},Ru={class:"wizard-footer"},Mu=["disabled"],Eu={__name:"SmartIRSetupWizard",props:{show:{type:Boolean,default:!1},platform:{type:String,required:!0},warnings:{type:Array,default:()=>[]},configPath:{type:String,default:"/config"}},emits:["close","complete"],setup(t,{emit:m}){const d=t,w=m,k=Ee("toast"),r=y(!1),v=y(!1),g=y(!1),I=W(()=>d.warnings.length>0?r.value&&v.value:r.value);function S(){const $=`${d.platform}: !include smartir/${d.platform}.yaml`;navigator.clipboard.writeText($).then(()=>{var o;(o=k.value)==null||o.success("Include line copied to clipboard!","âœ… Copied")}).catch(o=>{var L;console.error("Failed to copy:",o),(L=k.value)==null||L.error("Failed to copy to clipboard","âŒ Copy Failed")})}function A(){w("complete")}return($,o)=>t.show?(n(),i("div",{key:0,class:"modal-overlay",onClick:o[5]||(o[5]=ue(()=>{},["stop"]))},[e("div",{class:"setup-wizard",onClick:o[4]||(o[4]=ue(()=>{},["stop"]))},[o[31]||(o[31]=e("div",{class:"wizard-header"},[e("h2",null,[e("i",{class:"mdi mdi-cog"}),T(" SmartIR Configuration Setup ")])],-1)),e("div",pu,[t.warnings.length>0?(n(),i("div",fu,[e("div",gu,[o[11]||(o[11]=e("i",{class:"mdi mdi-alert"},null,-1)),e("div",null,[o[9]||(o[9]=e("h3",null,"âš ï¸ Configuration Migration Needed",-1)),o[10]||(o[10]=e("p",null,"We detected existing platform entries in your configuration.yaml:",-1)),e("ul",null,[(n(!0),i(me,null,he(t.warnings,L=>(n(),i("li",{key:L.platform},[e("strong",null,f(L.platform)+":",1),T(" "+f(L.message),1)]))),128))]),e("p",null,[o[6]||(o[6]=e("strong",null,"Action Required:",-1)),o[7]||(o[7]=T(" Move these entries to ",-1)),e("code",null,"smartir/"+f(t.platform)+".yaml",1),o[8]||(o[8]=T(" before continuing.",-1))])])])])):x("",!0),e("div",yu,[o[27]||(o[27]=e("h3",null,"ðŸ“ One-Time Setup",-1)),o[28]||(o[28]=e("p",null,[T("To enable SmartIR device management, add this line to your "),e("code",null,"configuration.yaml"),T(":")],-1)),e("div",bu,[e("code",null,f(t.platform)+": !include smartir/"+f(t.platform)+".yaml",1),e("button",{onClick:S,class:"copy-btn",title:"Copy to clipboard"},[...o[12]||(o[12]=[e("i",{class:"mdi mdi-content-copy"},null,-1)])])]),e("div",hu,[o[19]||(o[19]=e("h4",null,"Steps:",-1)),e("ol",null,[t.warnings.length>0?(n(),i("li",ku,[o[13]||(o[13]=e("strong",null,"Move existing entries:",-1)),o[14]||(o[14]=T(" Copy any existing ",-1)),e("code",null,f(t.platform)+":",1),o[15]||(o[15]=T(" entries from configuration.yaml to ",-1)),e("code",null,"smartir/"+f(t.platform)+".yaml",1)])):x("",!0),o[16]||(o[16]=e("li",null,[e("strong",null,"Add include line:"),T(" Add the line above to your configuration.yaml ")],-1)),o[17]||(o[17]=e("li",null,[e("strong",null,"Save changes:"),T(" Save configuration.yaml ")],-1)),o[18]||(o[18]=e("li",null,[e("strong",null,"Continue here:"),T(` Click "I've Completed Setup" below `)],-1))])]),e("div",wu,[e("button",{onClick:o[0]||(o[0]=L=>g.value=!g.value),class:"help-toggle"},[e("i",{class:K(["mdi",g.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2),T(" "+f(g.value?"Hide":"Show")+" Detailed Instructions ",1)]),g.value?(n(),i("div",$u,[o[26]||(o[26]=e("h4",null,"Detailed Setup Guide:",-1)),e("div",Cu,[o[21]||(o[21]=e("h5",null,"1. Open configuration.yaml",-1)),e("p",null,[o[20]||(o[20]=T("Location: ",-1)),e("code",null,f(t.configPath)+"/configuration.yaml",1)])]),t.warnings.length>0?(n(),i("div",_u,[o[22]||(o[22]=e("h5",null,"2. Migrate Existing Entries (If Any)",-1)),e("p",null,"If you have existing "+f(t.platform)+" entries, cut them from configuration.yaml and paste into:",1),e("p",null,[e("code",null,f(t.configPath)+"/smartir/"+f(t.platform)+".yaml",1)]),o[23]||(o[23]=e("p",{class:"note"},"Broadlink Manager will create this file automatically.",-1))])):x("",!0),e("div",Su,[e("h5",null,f(t.warnings.length>0?"3":"2")+". Add Include Line",1),o[24]||(o[24]=e("p",null,"Add this to configuration.yaml:",-1)),e("pre",null,f(t.platform)+": !include smartir/"+f(t.platform)+".yaml",1)]),e("div",Iu,[e("h5",null,f(t.warnings.length>0?"4":"3")+". Restart Home Assistant",1),o[25]||(o[25]=e("p",null,"After saving, you'll need to restart HA for changes to take effect.",-1))])])):x("",!0)])]),e("div",Du,[e("label",Tu,[J(e("input",{type:"checkbox","onUpdate:modelValue":o[1]||(o[1]=L=>r.value=L)},null,512),[[ve,r.value]]),o[29]||(o[29]=e("span",null,"I've added the include line to configuration.yaml",-1))]),t.warnings.length>0?(n(),i("label",xu,[J(e("input",{type:"checkbox","onUpdate:modelValue":o[2]||(o[2]=L=>v.value=L)},null,512),[[ve,v.value]]),e("span",null,"I've migrated existing "+f(t.platform)+" entries (if any)",1)])):x("",!0)])]),e("div",Ru,[e("button",{onClick:o[3]||(o[3]=L=>$.$emit("close")),class:"btn-secondary"}," Cancel "),e("button",{onClick:A,class:"btn-primary",disabled:!I.value},[...o[30]||(o[30]=[e("i",{class:"mdi mdi-check"},null,-1),T(" I've Completed Setup ",-1)])],8,Mu)])])])):x("",!0)}},Au=$e(Eu,[["__scopeId","data-v-f6fe4c03"]]),Lu={class:"modal-header"},Ou={class:"progress-steps"},Pu={class:"step-number"},Vu={key:0,class:"mdi mdi-check"},Uu={key:1},Fu={class:"step-label"},ju={class:"modal-body"},Nu={key:0,class:"step-content"},Bu={class:"form-group"},Hu={class:"form-group"},qu={class:"form-group"},zu={key:1,class:"step-content"},Ju={key:1,class:"platform-form"},Wu={class:"form-section"},Gu={class:"checkbox-grid"},Ku={class:"checkbox-item"},Xu={class:"checkbox-item"},Yu={class:"checkbox-item"},Zu={class:"checkbox-item"},Qu={class:"checkbox-item"},ec={key:2,class:"platform-form"},tc={class:"form-section"},oc={class:"form-group"},lc={class:"form-section"},nc={class:"checkbox-grid"},sc={class:"checkbox-item"},ac={class:"checkbox-item"},ic={key:3,class:"platform-form"},rc={class:"form-section"},dc={class:"checkbox-grid"},uc={class:"checkbox-item"},cc={class:"checkbox-item"},mc={class:"checkbox-item"},vc={class:"checkbox-item"},pc={key:2,class:"step-content"},fc={key:3,class:"step-content"},gc={class:"modal-footer"},yc=["disabled"],bc={key:2,class:"save-buttons"},hc=["disabled"],kc=["disabled"],wc={__name:"SmartIRProfileBuilder",props:{show:{type:Boolean,default:!1},editMode:{type:Boolean,default:!1},editData:{type:Object,default:null},startStep:{type:Number,default:0}},emits:["close","save"],setup(t,{emit:m}){const d=t,w=m,k=Ee("toast"),r=y(0),v=y(!1),g=y([]),I=y(!1),S=y([]),A=y("/config"),$=y(!1),o=y(null),L=y(!1),H=y(!1),F=y(""),U=y("ir"),a=y(!1),b=[{label:"Device Info",key:"info"},{label:"Configuration",key:"config"},{label:"Learn Commands",key:"commands"},{label:"Preview & Save",key:"preview"}],u=y({platform:"",manufacturer:"",model:"",broadlinkDevice:"",commandType:"ir",config:{},commands:{}}),O=y(["turn_on"]),z=y(3),Y=y([]),P=y(["turn_on"]);se(()=>u.value.platform,C=>{C==="media_player"?u.value.config={features:O.value}:C==="fan"?u.value.config={speedLevels:z.value,features:Y.value}:C==="light"&&(u.value.config={features:P.value})}),se(O,C=>{u.value.platform==="media_player"&&(u.value.config={features:C})},{deep:!0}),se(z,C=>{u.value.platform==="fan"&&(u.value.config={speedLevels:C,features:Y.value})}),se(Y,C=>{u.value.platform==="fan"&&(u.value.config={speedLevels:z.value,features:C})},{deep:!0}),se(P,C=>{u.value.platform==="light"&&(u.value.config={features:C})},{deep:!0});function te(C){const s=new Set,R=Object.keys(C);return R.some(G=>G==="off"||G.includes("_off"))&&s.add("off"),R.some(G=>G.includes("auto"))&&s.add("auto"),R.some(G=>G.includes("cool"))&&s.add("cool"),R.some(G=>G.includes("heat"))&&s.add("heat"),R.some(G=>G.includes("dry"))&&s.add("dry"),R.some(G=>G.includes("fan_only"))&&s.add("fan_only"),Array.from(s)}function M(C){const s=new Set,R=Object.keys(C);return R.some(G=>G.includes("auto"))&&s.add("auto"),R.some(G=>G.includes("low"))&&s.add("low"),R.some(G=>G.includes("medium")||G.includes("mid"))&&s.add("medium"),R.some(G=>G.includes("high"))&&s.add("high"),Array.from(s)}function j(C){const s=new Set,R=Object.keys(C);return R.some(G=>G.includes("swing_off")||G.includes("_off"))&&s.add("off"),R.some(G=>G.includes("vertical"))&&s.add("vertical"),R.some(G=>G.includes("horizontal"))&&s.add("horizontal"),R.some(G=>G.includes("both"))&&s.add("both"),Array.from(s)}function oe(C){for(const s of Object.values(C))if(typeof s=="string"&&s.startsWith("sc")||Array.isArray(s)&&s.length>0&&typeof s[0]=="string"&&s[0].startsWith("sc"))return"rf";return"ir"}se(()=>u.value.commandType,(C,s)=>{!s||L.value||a.value||(Object.keys(u.value.commands).length>0&&C!==s?(F.value=C,u.value.commandType=s,L.value=!0):C!==s&&(U.value=C))}),se(()=>d.editData,async C=>{var s,R,G;if(C&&d.editMode){console.log("ðŸ”§ Edit mode activated, loading profile data:",C),a.value=!0,g.value.length===0&&(console.log("ðŸ“¡ Loading Broadlink devices..."),await B(),console.log("ðŸ“¡ Devices loaded:",g.value.length));const le=C.profile,re=le.controller_data;console.log("ðŸŽ® Controller data from profile:",re),console.log("ðŸŽ® Available devices:",g.value.map(ae=>ae.entity_id));const Z=le.commands||{},Me=le.commandType||oe(Z);console.log("ðŸ” Command type (stored):",le.commandType),console.log("ðŸ” Command type (final):",Me);let X={};if(C.platform==="climate"){const ae=le.operationModes||te(Z),Ce=le.fanModes||M(Z),E=le.swingModes||j(Z);console.log("ðŸ” Inferred modes:",ae),console.log("ðŸ” Inferred fan modes:",Ce),console.log("ðŸ” Inferred swing modes:",E),X={minTemp:le.minTemperature,maxTemp:le.maxTemperature,precision:le.precision,modes:ae,fanModes:Ce,swingModes:E}}else if(C.platform==="media_player"){const ae=[];(Z.on||Z.off)&&ae.push("turn_on"),(Z.volumeUp||Z.volumeDown)&&ae.push("volume"),Z.mute&&ae.push("mute"),Z.sources&&ae.push("source"),(Z.channelUp||Z.channelDown)&&ae.push("channel"),X={features:ae},O.value=ae,console.log("ðŸ” Inferred media player features:",ae)}else if(C.platform==="fan"){const ae=((s=le.speed)==null?void 0:s.length)||Object.keys(Z.default||{}).length||3,Ce=[];(Z.oscillate_on||Z.oscillate_off)&&Ce.push("oscillate"),(Z.direction_forward||Z.direction_reverse)&&Ce.push("direction"),X={speedLevels:ae,features:Ce},z.value=ae,Y.value=Ce,console.log("ðŸ” Inferred fan config:",X)}else if(C.platform==="light"){const ae=[];X={features:ae},P.value=ae,console.log("ðŸ” Inferred light features:",ae)}const we=await h(le.manufacturer,(R=le.supportedModels)==null?void 0:R[0],Z);u.value={platform:C.platform,manufacturer:le.manufacturer||"",model:((G=le.supportedModels)==null?void 0:G[0])||"",broadlinkDevice:re||"",commandType:Me,config:X,commands:we},console.log("âœ… Profile populated:",u.value),console.log("âœ… Selected device:",u.value.broadlinkDevice),console.log("âœ… Command type:",u.value.commandType),console.log("âœ… Commands (with learned codes):",we),U.value=Me,setTimeout(()=>{a.value=!1},100)}},{immediate:!0});const ie=W(()=>{var C;switch(r.value){case 0:return u.value.platform&&u.value.manufacturer&&u.value.model;case 1:return u.value.platform==="climate"?u.value.config.minTemp&&u.value.config.maxTemp&&((C=u.value.config.modes)==null?void 0:C.length)>0:!0;case 2:return u.value.broadlinkDevice&&u.value.commandType&&Object.keys(u.value.commands).length>0;case 3:return!0;default:return!1}}),ge=y(null);async function Ie(){if(r.value!==3){ge.value=null;return}if(console.log("ðŸ” Generating JSON with commands:",u.value.commands),Object.values(u.value.commands).some(s=>typeof s=="string"?s==="pending":typeof s=="object"?Object.values(s).some(R=>typeof R=="string"?R==="pending":typeof R=="object"?Object.values(R).some(G=>G==="pending"):!1):!1)){console.warn('âš ï¸ Commands still contain "pending" placeholders!'),console.log("ðŸ“¦ Attempting to fetch from Broadlink storage...");const s=await h(u.value.manufacturer,u.value.model,u.value.commands);u.value.commands=s,console.log("âœ… Updated commands:",s)}ge.value=c(u.value),console.log("ðŸ“„ Generated JSON:",ge.value)}const Ae=W(()=>r.value!==3?null:l(u.value));function xe(){u.value.config={},u.value.commands={}}function D(){L.value=!1,u.value.commandType=F.value,U.value=F.value,u.value.commands={},F.value=""}function p(){L.value=!1,F.value=""}async function V(){r.value<b.length-1&&(r.value++,r.value===3&&await Ie())}function pe(){r.value>0&&r.value--}function Oe(){L.value||(H.value=!0)}function ye(){H.value=!1,ce()}function ce(){w("close"),setTimeout(()=>{r.value=0,u.value={platform:"",manufacturer:"",model:"",broadlinkDevice:"",commandType:"ir",config:{},commands:{}},U.value="ir"},300)}async function Re(){var C,s,R,G,le,re;v.value=!0;try{if(!$.value){const Ce=(await ee.get("/api/smartir/config/check")).data;if(Ce&&!((C=Ce.platforms[u.value.platform])==null?void 0:C.file_exists)){S.value=Ce.configuration_warnings||[],A.value=Ce.config_path||"/config",o.value={platform:u.value.platform,json:ge.value},I.value=!0,v.value=!1;return}}let Z;d.editMode&&((s=d.editData)!=null&&s.code)?(Z=parseInt(d.editData.code),console.log("ðŸ“ Edit mode: Using existing code",Z)):(Z=(await ee.get(`/api/smartir/platforms/${u.value.platform}/next-code`)).data.next_code,console.log("âœ¨ New profile: Using next code",Z));const X=(await ee.post("/api/smartir/profiles",{platform:u.value.platform,json:ge.value,code_number:Z})).data,we={platform:"smartir",name:`${u.value.manufacturer} ${u.value.model}`,unique_id:`${u.value.manufacturer.toLowerCase().replace(/[^a-z0-9]+/g,"_")}_${u.value.model.toLowerCase().replace(/[^a-z0-9]+/g,"_")}`,device_code:Z,controller_data:u.value.broadlinkDevice};try{await ee.post("/api/smartir/config/add-device",{platform:u.value.platform,device_config:{platform:"smartir",name:we.name,unique_id:we.unique_id,device_code:we.device_code,controller_data:we.controller_data}})}catch(ae){console.error("Failed to add device to config:",ae);const Ce=((R=ae.response)==null?void 0:R.data)||{};let E=Ce.error||"Unknown error";Ce.validation_errors&&Ce.validation_errors.length>0&&(E=`Device configuration validation failed:
`+Ce.validation_errors.map(_=>`  â€¢ ${_}`).join(`
`)),(G=k.value)==null||G.warning(`Profile saved but failed to add to config file:
${E}`,"âš ï¸ Partial Success")}w("save",{json:ge.value,yaml:Ae.value,profile:u.value,saved_to:X.path}),(le=k.value)==null||le.success(`File: ${X.filename}
Device Code: ${Z}
Added to: smartir/${u.value.platform}.yaml

âš ï¸ Restart Home Assistant to activate`,"âœ… Profile Saved Successfully!"),ce()}catch(Z){console.error("Error saving profile:",Z),(re=k.value)==null||re.error(Z.message,"âŒ Error Saving Profile")}finally{v.value=!1}}async function Pe(){$.value=!0,I.value=!1,o.value&&(await Re(),o.value=null)}function Q(){var C,s;try{const R=JSON.stringify(ge.value,null,2),G=new Blob([R],{type:"application/json"}),le=URL.createObjectURL(G),re=document.createElement("a");re.href=le;const Z=u.value.manufacturer.toLowerCase().replace(/\s+/g,"_"),Me=u.value.model.toLowerCase().replace(/\s+/g,"_");re.download=`smartir_${u.value.platform}_${Z}_${Me}.json`,document.body.appendChild(re),re.click(),document.body.removeChild(re),URL.revokeObjectURL(le),(C=k.value)==null||C.success("You can manually upload this file to your SmartIR codes directory.","âœ… Profile Downloaded")}catch(R){console.error("Error downloading profile:",R),(s=k.value)==null||s.error(R.message,"âŒ Error Downloading Profile")}}async function h(C,s,R){const G=C.toLowerCase().replace(/[^a-z0-9]+/g,"_"),le=s.toLowerCase().replace(/[^a-z0-9]+/g,"_"),re=`${G}_${le}`;try{const X=(await ee.get("/api/commands/all")).data[re]||{};console.log(`ðŸ” Fetching learned commands for device: ${re}`),console.log("ðŸ“¦ Device commands from storage:",X);const we={...R};for(const[ae,Ce]of Object.entries(we))if(Ce==="pending"&&X[ae])we[ae]=X[ae];else if(typeof Ce=="object"){for(const[E,_]of Object.entries(Ce))if(typeof _=="object")for(const[N,q]of Object.entries(_)){const ne=`${ae}_${E}_${N}`;q==="pending"&&X[ne]&&(we[ae][E][N]=X[ne])}else if(_==="pending"){const N=`${ae}_${E}`;X[N]&&(we[ae][E]=X[N])}}return console.log("âœ… Merged commands:",we),we}catch(Z){return console.error("Error fetching learned commands:",Z),R}}function c(C){const s={manufacturer:C.manufacturer,supportedModels:[C.model],supportedController:"Broadlink",commandsEncoding:"Base64",commandType:C.commandType||"ir",commands:{}};return C.platform==="climate"&&(s.minTemperature=C.config.minTemp,s.maxTemperature=C.config.maxTemp,s.precision=C.config.precision||1,s.operationModes=C.config.modes||[],s.fanModes=C.config.fanModes&&C.config.fanModes.length>0?C.config.fanModes:["auto"],C.config.swingModes&&C.config.swingModes.length>0&&(s.swingModes=C.config.swingModes),s.commands=C.commands),s}function l(C){let s=`# SmartIR ${C.platform} configuration
`;return s+=`# Generated by Broadlink Manager v2

`,C.platform==="climate"&&(s+=`climate:
`,s+=`  - platform: smartir
`,s+=`    name: ${C.manufacturer} ${C.model}
`,s+=`    unique_id: ${C.manufacturer.toLowerCase()}_${C.model.toLowerCase().replace(/\s+/g,"_")}
`,s+=`    device_code: 10000  # Change this to your custom code number
`,s+=`    controller_data: ${C.broadlinkDevice}
`,C.config.tempSensor&&(s+=`    temperature_sensor: ${C.config.tempSensor}
`),C.config.humiditySensor&&(s+=`    humidity_sensor: ${C.config.humiditySensor}
`),C.config.powerSensor&&(s+=`    power_sensor: ${C.config.powerSensor}
`)),s}async function B(){try{console.log("Fetching remote devices from /api/remote/devices...");const C=await ee.get("/api/remote/devices");console.log("Loaded remote devices response:",C.data);const s=C.data.devices||[];console.log("Extracted devices array:",s),console.log("Device count:",s.length),g.value=s,console.log("broadlinkDevices.value set to:",g.value),console.log("Final device count:",g.value.length)}catch(C){console.error("Error loading remote devices:",C),g.value=[]}}return se(()=>d.show,C=>{if(C){const s=Number.isInteger(d.startStep)?d.startStep:0;r.value=Math.min(Math.max(s,0),b.length-1)}}),se(()=>d.startStep,C=>{if(d.show){const s=Number.isInteger(C)?C:0;r.value=Math.min(Math.max(s,0),b.length-1)}}),Te(()=>{d.show&&B()}),(C,s)=>t.show?(n(),i("div",{key:0,class:"modal-overlay",onClick:Oe},[e("div",{class:"modal-container",onClick:s[19]||(s[19]=ue(()=>{},["stop"]))},[e("div",Lu,[e("h2",null,[s[22]||(s[22]=e("i",{class:"mdi mdi-file-document-edit"},null,-1)),T(" "+f(t.editMode?"Edit SmartIR Profile":"Create SmartIR Profile"),1)]),e("button",{onClick:ce,class:"close-button"},[...s[23]||(s[23]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Ou,[(n(),i(me,null,he(b,(R,G)=>e("div",{key:G,class:K(["step",{active:r.value===G,completed:r.value>G}])},[e("div",Pu,[r.value>G?(n(),i("i",Vu)):(n(),i("span",Uu,f(G+1),1))]),e("span",Fu,f(R.label),1)],2)),64))]),e("div",ju,[r.value===0?(n(),i("div",Nu,[s[29]||(s[29]=e("h3",null,"Device Information",-1)),e("div",Bu,[s[25]||(s[25]=e("label",null,"Platform Type *",-1)),J(e("select",{"onUpdate:modelValue":s[0]||(s[0]=R=>u.value.platform=R),onChange:xe},[...s[24]||(s[24]=[Be('<option value="" data-v-2e218e9d>Select platform...</option><option value="climate" data-v-2e218e9d>ðŸŒ¡ï¸ Climate (AC, Heater, Heat Pump)</option><option value="media_player" data-v-2e218e9d>ðŸ“º Media Player (TV, Receiver)</option><option value="fan" data-v-2e218e9d>ðŸŒ€ Fan</option><option value="light" data-v-2e218e9d>ðŸ’¡ Light (LED Strip, IR Light)</option>',5)])],544),[[De,u.value.platform]])]),e("div",Hu,[s[26]||(s[26]=e("label",null,"Manufacturer *",-1)),J(e("input",{"onUpdate:modelValue":s[1]||(s[1]=R=>u.value.manufacturer=R),type:"text",placeholder:"e.g., Daikin, LG, Samsung"},null,512),[[Le,u.value.manufacturer]])]),e("div",qu,[s[27]||(s[27]=e("label",null,"Model(s) *",-1)),J(e("input",{"onUpdate:modelValue":s[2]||(s[2]=R=>u.value.model=R),type:"text",placeholder:"e.g., FTXS35K, Multiple models"},null,512),[[Le,u.value.model]]),s[28]||(s[28]=e("small",null,'Enter model number or "Multiple" if it works with many models',-1))])])):x("",!0),r.value===1?(n(),i("div",zu,[u.value.platform==="climate"?(n(),Fe(dd,{key:0,modelValue:u.value.config,"onUpdate:modelValue":s[3]||(s[3]=R=>u.value.config=R)},null,8,["modelValue"])):u.value.platform==="media_player"?(n(),i("div",Ju,[s[36]||(s[36]=e("h3",null,"Media Player Configuration",-1)),s[37]||(s[37]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),T(" Configure the features your media player supports. You'll learn the IR commands in the next step. ")],-1)),e("div",Wu,[s[35]||(s[35]=e("h4",null,"Supported Features",-1)),e("div",Gu,[e("label",Ku,[J(e("input",{type:"checkbox",value:"turn_on","onUpdate:modelValue":s[4]||(s[4]=R=>O.value=R)},null,512),[[ve,O.value]]),s[30]||(s[30]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),T(" Power On/Off ")],-1))]),e("label",Xu,[J(e("input",{type:"checkbox",value:"volume","onUpdate:modelValue":s[5]||(s[5]=R=>O.value=R)},null,512),[[ve,O.value]]),s[31]||(s[31]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-volume-high"}),T(" Volume Control ")],-1))]),e("label",Yu,[J(e("input",{type:"checkbox",value:"mute","onUpdate:modelValue":s[6]||(s[6]=R=>O.value=R)},null,512),[[ve,O.value]]),s[32]||(s[32]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-volume-mute"}),T(" Mute ")],-1))]),e("label",Zu,[J(e("input",{type:"checkbox",value:"source","onUpdate:modelValue":s[7]||(s[7]=R=>O.value=R)},null,512),[[ve,O.value]]),s[33]||(s[33]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-import"}),T(" Source Selection ")],-1))]),e("label",Qu,[J(e("input",{type:"checkbox",value:"channel","onUpdate:modelValue":s[8]||(s[8]=R=>O.value=R)},null,512),[[ve,O.value]]),s[34]||(s[34]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-numeric"}),T(" Channel Control ")],-1))])])])])):u.value.platform==="fan"?(n(),i("div",ec,[s[44]||(s[44]=e("h3",null,"Fan Configuration",-1)),s[45]||(s[45]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),T(" Configure the features your fan supports. You'll learn the IR commands in the next step. ")],-1)),e("div",tc,[s[40]||(s[40]=e("h4",null,"Fan Speed Levels",-1)),e("div",oc,[s[39]||(s[39]=e("label",null,"Number of Speed Levels *",-1)),J(e("select",{"onUpdate:modelValue":s[9]||(s[9]=R=>z.value=R)},[...s[38]||(s[38]=[e("option",{value:1},"1 Speed",-1),e("option",{value:2},"2 Speeds",-1),e("option",{value:3},"3 Speeds (Low/Med/High)",-1),e("option",{value:4},"4 Speeds",-1),e("option",{value:5},"5 Speeds",-1),e("option",{value:6},"6 Speeds",-1)])],512),[[De,z.value,void 0,{number:!0}]])])]),e("div",lc,[s[43]||(s[43]=e("h4",null,"Additional Features",-1)),e("div",nc,[e("label",sc,[J(e("input",{type:"checkbox",value:"oscillate","onUpdate:modelValue":s[10]||(s[10]=R=>Y.value=R)},null,512),[[ve,Y.value]]),s[41]||(s[41]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-sync"}),T(" Oscillation ")],-1))]),e("label",ac,[J(e("input",{type:"checkbox",value:"direction","onUpdate:modelValue":s[11]||(s[11]=R=>Y.value=R)},null,512),[[ve,Y.value]]),s[42]||(s[42]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-rotate-3d-variant"}),T(" Direction (Forward/Reverse) ")],-1))])])])])):u.value.platform==="light"?(n(),i("div",ic,[s[51]||(s[51]=e("h3",null,"Light Configuration",-1)),s[52]||(s[52]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),T(" Configure the features your light supports. You'll learn the IR commands in the next step. ")],-1)),e("div",rc,[s[50]||(s[50]=e("h4",null,"Supported Features",-1)),e("div",dc,[e("label",uc,[J(e("input",{type:"checkbox",value:"turn_on","onUpdate:modelValue":s[12]||(s[12]=R=>P.value=R)},null,512),[[ve,P.value]]),s[46]||(s[46]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),T(" Power On/Off ")],-1))]),e("label",cc,[J(e("input",{type:"checkbox",value:"brightness","onUpdate:modelValue":s[13]||(s[13]=R=>P.value=R)},null,512),[[ve,P.value]]),s[47]||(s[47]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-brightness-6"}),T(" Brightness Control ")],-1))]),e("label",mc,[J(e("input",{type:"checkbox",value:"color_temp","onUpdate:modelValue":s[14]||(s[14]=R=>P.value=R)},null,512),[[ve,P.value]]),s[48]||(s[48]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-thermometer"}),T(" Color Temperature ")],-1))]),e("label",vc,[J(e("input",{type:"checkbox",value:"rgb","onUpdate:modelValue":s[15]||(s[15]=R=>P.value=R)},null,512),[[ve,P.value]]),s[49]||(s[49]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-palette"}),T(" RGB Color ")],-1))])])])])):x("",!0)])):x("",!0),r.value===2?(n(),i("div",pc,[fe(Bd,{modelValue:u.value.commands,"onUpdate:modelValue":s[16]||(s[16]=R=>u.value.commands=R),platform:u.value.platform,config:u.value.config,broadlinkDevice:u.value.broadlinkDevice,"onUpdate:broadlinkDevice":s[17]||(s[17]=R=>u.value.broadlinkDevice=R),manufacturer:u.value.manufacturer,model:u.value.model,commandType:u.value.commandType,"onUpdate:commandType":s[18]||(s[18]=R=>u.value.commandType=R)},null,8,["modelValue","platform","config","broadlinkDevice","manufacturer","model","commandType"])])):x("",!0),r.value===3?(n(),i("div",fc,[fe(vu,{profile:u.value,"json-data":ge.value,"yaml-config":Ae.value},null,8,["profile","json-data","yaml-config"])])):x("",!0)]),e("div",gc,[r.value>0?(n(),i("button",{key:0,onClick:pe,class:"btn-secondary"},[...s[53]||(s[53]=[e("i",{class:"mdi mdi-arrow-left"},null,-1),T(" Back ",-1)])])):x("",!0),s[57]||(s[57]=e("div",{class:"spacer"},null,-1)),e("button",{onClick:ce,class:"btn-text"}," Cancel "),r.value<b.length-1?(n(),i("button",{key:1,onClick:V,class:"btn-primary",disabled:!ie.value},[...s[54]||(s[54]=[T(" Next ",-1),e("i",{class:"mdi mdi-arrow-right"},null,-1)])],8,yc)):(n(),i("div",bc,[e("button",{onClick:Re,class:"btn-primary",disabled:v.value},[s[55]||(s[55]=e("i",{class:"mdi mdi-cloud-upload"},null,-1)),T(" "+f(v.value?"Saving...":"Save to SmartIR"),1)],8,hc),e("button",{onClick:Q,class:"btn-secondary",disabled:v.value},[...s[56]||(s[56]=[e("i",{class:"mdi mdi-download"},null,-1),T(" Download JSON ",-1)])],8,kc)]))])]),fe(Au,{show:I.value,platform:u.value.platform,warnings:S.value,"config-path":A.value,onClose:s[20]||(s[20]=R=>I.value=!1),onComplete:Pe},null,8,["show","platform","warnings","config-path"]),fe(Ne,{isOpen:L.value,title:"Change Command Type?",message:"Changing the command type will clear all learned commands. Continue?",confirmText:"Continue",cancelText:"Cancel",dangerMode:!0,onConfirm:D,onCancel:p},null,8,["isOpen"]),fe(Ne,{isOpen:H.value,title:"Close Profile Builder?",message:"Are you sure you want to close? Your progress will be lost.",confirmText:"Close",cancelText:"Keep Editing",dangerMode:!0,onConfirm:ye,onCancel:s[21]||(s[21]=R=>H.value=!1)},null,8,["isOpen"])])):x("",!0)}},$c=$e(wc,[["__scopeId","data-v-2e218e9d"]]),Cc={class:"dashboard"},_c={key:1,class:"welcome-banner"},Sc={__name:"Dashboard",setup(t){const m=Je(),d=Ee("smartirEnabled"),{isMobile:w}=et(),k=y(!1),r=y(!1),v=y(null),g=y(0),I=y(null),S=y(localStorage.getItem("welcome_banner_dismissed")==="true");function A(){S.value=!0,localStorage.setItem("welcome_banner_dismissed","true")}function $(){r.value=!1,v.value=null,g.value=0,k.value=!0}async function o({platform:F,profile:U,startStep:a}){g.value=Number.isInteger(a)?a:0;try{const b=await fetch(`api/smartir/platforms/${F}/profiles/${U.code}`);if(!b.ok)throw new Error("Failed to load profile");const u=await b.json();let O="";try{const z=await fetch(`api/smartir/config/get-device?platform=${F}&code=${U.code}`);z.ok?(O=(await z.json()).controller_data||"",console.log("âœ… Found controller_data from YAML:",O)):console.warn("âš ï¸ No YAML entry found for this profile (this is OK for profiles not yet added to config)")}catch(z){console.warn("âš ï¸ Could not fetch controller_data from config:",z)}r.value=!0,v.value={platform:F,code:U.code,profile:{...u.profile,controller_data:O}},k.value=!0}catch(b){console.error("Error loading profile for edit:",b),m.error("Failed to load profile for editing")}}function L(){k.value=!1,r.value=!1,v.value=null}async function H(F){console.log("Profile saved:",F),L(),I.value&&I.value.loadAllProfiles&&(await I.value.loadAllProfiles(),console.log("âœ… Profiles list refreshed"))}return(F,U)=>(n(),i("div",Cc,[_e(d)?(n(),Fe(fa,{key:0})):x("",!0),!_e(w)&&!S.value?(n(),i("div",_c,[e("button",{class:"dismiss-button",onClick:A,title:"Dismiss"},[...U[0]||(U[0]=[e("i",{class:"mdi mdi-close"},null,-1)])]),U[1]||(U[1]=Be('<div class="banner-content" data-v-12185d74><div class="banner-icon" data-v-12185d74><i class="mdi mdi-rocket-launch" data-v-12185d74></i></div><div class="banner-text" data-v-12185d74><h2 data-v-12185d74>Welcome to Broadlink Manager v2!</h2><p data-v-12185d74>Manage your IR/RF devices with a modern Vue 3 interface</p></div></div><div class="status-badges" data-v-12185d74><span class="badge success" data-v-12185d74><i class="mdi mdi-check-circle" data-v-12185d74></i> Vue 3 Ready </span><span class="badge warning" data-v-12185d74><i class="mdi mdi-beta" data-v-12185d74></i> Beta </span></div>',2))])):x("",!0),fe(da),_e(d)?(n(),Fe(vr,{key:2,ref_key:"smartirStatusCard",ref:I,onCreateProfile:$,onEditProfile:o},null,512)):x("",!0),fe($c,{show:k.value,editMode:r.value,editData:v.value,startStep:g.value,onClose:L,onSave:H},null,8,["show","editMode","editData","startStep"])]))}},Ic=$e(Sc,[["__scopeId","data-v-12185d74"]]),Dc={class:"toast-container"},Tc={class:"toast-content"},xc={key:0,class:"toast-title"},Rc={class:"toast-message"},Mc={key:1,class:"toast-description"},Ec=["onClick","title"],Ac={__name:"Toast",setup(t,{expose:m}){const d=y([]);let w=0;function k(g){const I={success:"mdi-check-circle",error:"mdi-alert-circle",warning:"mdi-alert",info:"mdi-information"};return I[g]||I.info}function r({message:g,title:I,description:S,type:A="info",duration:$=5e3}){const o=w++,L={id:o,message:g,title:I,description:S,type:A};return d.value.push(L),$>0&&setTimeout(()=>{v(o)},$),o}function v(g){const I=d.value.findIndex(S=>S.id===g);I>-1&&d.value.splice(I,1)}return m({addToast:r,removeToast:v,show:r,success:(g,I)=>r({message:g,title:I,type:"success"}),error:(g,I)=>r({message:g,title:I,type:"error",duration:0}),warning:(g,I)=>r({message:g,title:I,type:"warning",duration:0}),info:(g,I)=>r({message:g,title:I,type:"info"})}),(g,I)=>(n(),Fe(st,{to:"body"},[e("div",Dc,[fe(pt,{name:"toast"},{default:Qe(()=>[(n(!0),i(me,null,he(d.value,S=>(n(),i("div",{key:S.id,class:K(["toast",[`toast-${S.type}`,{"toast-persistent":S.type==="error"||S.type==="warning"}]])},[e("i",{class:K(["mdi",k(S.type)])},null,2),e("div",Tc,[S.title?(n(),i("div",xc,f(S.title),1)):x("",!0),e("div",Rc,f(S.message),1),S.description?(n(),i("div",Mc,f(S.description),1)):x("",!0)]),e("button",{onClick:A=>v(S.id),class:K(["toast-close",{"toast-close-prominent":S.type==="error"||S.type==="warning"}]),title:S.type==="error"||S.type==="warning"?"Click to dismiss":"Close"},[...I[0]||(I[0]=[e("i",{class:"mdi mdi-close"},null,-1)])],10,Ec)],2))),128))]),_:1})])]))}},Lc=$e(Ac,[["__scopeId","data-v-3948c088"]]),Oc="0.3.0-alpha.2",Pc={version:Oc},Vc={id:"app",class:"app-container"},Uc={class:"app-header"},Fc={class:"header-content"},jc={class:"header-right"},Nc=["title"],Bc={class:"settings-menu-container"},Hc={key:0,class:"settings-menu"},qc=["title"],zc={class:"toggle-content"},Jc={key:0,class:"not-installed-label"},Wc={key:0,href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"menu-item menu-link menu-subitem"},Gc=["disabled"],Kc=["disabled"],Xc=["disabled"],Yc={class:"app-main"},Zc={class:"app-footer"},Qc={__name:"App",setup(t){const m=y(null),d=Pc.version,w=y("light"),k=y(null),r=y(!1),v=y(!1),g=y(!1),I=y(localStorage.getItem("smartir_enabled")!=="false"),S=W(()=>{var u;return((u=k.value)==null?void 0:u.installed)||!1}),A=W(()=>({light:"mdi mdi-weather-sunny",medium:"mdi mdi-weather-partly-cloudy",dark:"mdi mdi-weather-night"})[w.value]),$=W(()=>({light:"Switch to Medium Theme",medium:"Switch to Dark Theme",dark:"Switch to Light Theme"})[w.value]),o=()=>{const u=["light","medium","dark"],z=(u.indexOf(w.value)+1)%u.length;w.value=u[z],document.body.classList.remove("medium-mode","dark-mode"),w.value==="medium"?document.body.classList.add("medium-mode"):w.value==="dark"&&document.body.classList.add("dark-mode"),localStorage.setItem("theme",w.value)},L=async()=>{try{const u=await rt.getStatus();k.value=u,u.installed?console.log("âœ… SmartIR detected:",u.version):console.log("â„¹ï¸ SmartIR not detected")}catch(u){console.error("Error checking SmartIR:",u),k.value={installed:!1,error:u.message}}},H=async()=>{var u,O,z;v.value=!0;try{const P=(await ee.get("/api/diagnostics/markdown")).data.markdown;if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(P),(u=m.value)==null||u.success("Diagnostic summary copied to clipboard!");else{const te=document.createElement("textarea");te.value=P,te.style.position="fixed",te.style.left="-999999px",te.style.top="-999999px",document.body.appendChild(te),te.focus(),te.select();try{if(document.execCommand("copy"))(O=m.value)==null||O.success("Diagnostic summary copied to clipboard!");else throw new Error("execCommand failed")}finally{document.body.removeChild(te)}}r.value=!1}catch(Y){console.error("Error copying diagnostics:",Y),(z=m.value)==null||z.error("Failed to copy diagnostics: "+Y.message)}finally{v.value=!1}},F=async()=>{var u,O;v.value=!0;try{const z=await ee.get("/api/diagnostics/download",{responseType:"blob"}),Y=window.URL.createObjectURL(new Blob([z.data])),P=document.createElement("a");P.href=Y;const te=z.headers["content-disposition"];let M="broadlink_manager_diagnostics.zip";if(te){const j=te.match(/filename="?(.+)"?/);j&&(M=j[1])}P.setAttribute("download",M),document.body.appendChild(P),P.click(),P.remove(),window.URL.revokeObjectURL(Y),(u=m.value)==null||u.success("Diagnostic bundle downloaded!"),r.value=!1}catch(z){console.error("Error downloading diagnostics:",z),(O=m.value)==null||O.error("Failed to download diagnostics")}finally{v.value=!1}},U=u=>{u.target.closest(".settings-menu-container")||(r.value=!1)};Te(()=>{document.addEventListener("click",U)}),ze(()=>{document.removeEventListener("click",U)});const a=()=>{S.value&&(I.value=!I.value,localStorage.setItem("smartir_enabled",I.value.toString()),window.location.reload())},b=async()=>{var u,O,z;g.value=!0;try{const Y=await ee.post("/api/smartir/refresh-index");Y.data.success?(u=m.value)==null||u.success(`Updated to v${Y.data.version} (${Y.data.total_devices} devices)`,"âœ… Index Updated"):(O=m.value)==null||O.error(Y.data.error||"Unknown error","âŒ Update Failed")}catch(Y){console.error("Error updating SmartIR index:",Y),(z=m.value)==null||z.error("Failed to update device index","âŒ Update Error")}finally{g.value=!1,r.value=!1}};return Te(async()=>{const u=localStorage.getItem("theme");u&&["light","medium","dark"].includes(u)?(w.value=u,u==="medium"?document.body.classList.add("medium-mode"):u==="dark"&&document.body.classList.add("dark-mode")):localStorage.getItem("darkMode")==="true"&&(w.value="dark",document.body.classList.add("dark-mode"),localStorage.setItem("theme","dark")),await L();const O=ot();O&&m.value&&(O.appContext.config.globalProperties.$toast=m.value),document.addEventListener("click",U)}),ze(()=>{document.removeEventListener("click",U)}),Ge("smartirStatus",k),Ge("smartirEnabled",I),Ge("refreshSmartIR",L),Ge("toast",m),(u,O)=>(n(),i("div",Vc,[e("header",Uc,[e("div",Fc,[O[13]||(O[13]=e("div",{class:"header-left"},[e("i",{class:"mdi mdi-remote"}),e("h1",null,"Broadlink Manager v2"),e("span",{class:"beta-badge"},"BETA")],-1)),e("div",jc,[e("button",{onClick:o,class:"icon-button",title:$.value},[e("i",{class:K(A.value)},null,2)],8,Nc),e("div",Bc,[e("button",{onClick:O[0]||(O[0]=z=>r.value=!r.value),class:"icon-button",title:"Settings"},[...O[2]||(O[2]=[e("i",{class:"mdi mdi-cog"},null,-1)])]),r.value?(n(),i("div",Hc,[O[9]||(O[9]=e("div",{class:"menu-section-title"},"Integration Settings",-1)),e("div",{class:K(["menu-item toggle-item",{disabled:!S.value}]),onClick:O[1]||(O[1]=z=>S.value?a():null),title:S.value?"":"SmartIR is not installed"},[e("div",zc,[O[3]||(O[3]=e("i",{class:"mdi mdi-air-conditioner"},null,-1)),O[4]||(O[4]=e("span",null,"SmartIR Integration",-1)),S.value?x("",!0):(n(),i("span",Jc,"(Not Installed)"))]),e("div",{class:K(["toggle-switch",{active:I.value&&S.value,disabled:!S.value}])},[...O[5]||(O[5]=[e("div",{class:"toggle-slider"},null,-1)])],2)],10,qc),I.value?(n(),i("a",Wc,[...O[6]||(O[6]=[e("i",{class:"mdi mdi-github"},null,-1),e("span",null,"SmartIR on GitHub",-1)])])):x("",!0),I.value?(n(),i("button",{key:1,onClick:b,class:"menu-item menu-subitem",disabled:g.value},[e("i",{class:K(["mdi",g.value?"mdi-loading mdi-spin":"mdi-refresh"])},null,2),e("span",null,f(g.value?"Updating...":"Update Device Index"),1)],8,Gc)):x("",!0),O[10]||(O[10]=e("div",{class:"menu-divider"},null,-1)),O[11]||(O[11]=e("div",{class:"menu-section-title"},"Diagnostics",-1)),e("button",{onClick:H,class:"menu-item",disabled:v.value},[...O[7]||(O[7]=[e("i",{class:"mdi mdi-content-copy"},null,-1),e("span",null,"Copy Diagnostics",-1)])],8,Kc),e("button",{onClick:F,class:"menu-item",disabled:v.value},[...O[8]||(O[8]=[e("i",{class:"mdi mdi-download"},null,-1),e("span",null,"Download Diagnostics",-1)])],8,Xc),O[12]||(O[12]=Be('<div class="menu-divider" data-v-96564cf9></div><div class="menu-section-title" data-v-96564cf9>Help &amp; Support</div><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2#readme" target="_blank" class="menu-item menu-link" data-v-96564cf9><i class="mdi mdi-book-open-variant" data-v-96564cf9></i><span data-v-96564cf9>Documentation</span></a><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2/issues" target="_blank" class="menu-item menu-link" data-v-96564cf9><i class="mdi mdi-bug" data-v-96564cf9></i><span data-v-96564cf9>Report Issue</span></a><div class="menu-divider" data-v-96564cf9></div><div class="menu-section-title" data-v-96564cf9>Community</div><a href="https://community.home-assistant.io/t/broadlink-manager-modern-web-interface-for-broadlink-devices/938473" target="_blank" class="menu-item menu-link" data-v-96564cf9><i class="mdi mdi-forum" data-v-96564cf9></i><span data-v-96564cf9>HA Forum Discussion</span></a><a href="https://www.reddit.com/r/homeassistant/comments/1o1q3kf/release_broadlink_manager_addon_a_modern_web_ui/" target="_blank" class="menu-item menu-link" data-v-96564cf9><i class="mdi mdi-reddit" data-v-96564cf9></i><span data-v-96564cf9>Reddit Discussion</span></a><div class="menu-divider" data-v-96564cf9></div><div class="menu-section-title" data-v-96564cf9>Project</div><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2" target="_blank" class="menu-item menu-link" data-v-96564cf9><i class="mdi mdi-github" data-v-96564cf9></i><span data-v-96564cf9>GitHub Repository</span></a><a href="https://ko-fi.com/tonyperkins" target="_blank" class="menu-item menu-link menu-item-sponsor" data-v-96564cf9><i class="mdi mdi-coffee" data-v-96564cf9></i><span data-v-96564cf9>Support on Ko-fi</span></a>',12))])):x("",!0)])])])]),e("main",Yc,[fe(Ic)]),e("footer",Zc,[e("p",null,"Broadlink Manager v"+f(_e(d))+" | Built with Vue "+f(ft),1)]),fe(Lc,{ref_key:"toastRef",ref:m},null,512)]))}},em=$e(Qc,[["__scopeId","data-v-96564cf9"]]),dt=gt(em),tm=yt();dt.use(tm);dt.mount("#app");
