import{g as He,a as Qe,d as et,c as W,r as w,o as Se,b as i,e as a,f as e,h as E,n as Q,u as be,t as g,i as S,w as ue,j as q,v as we,F as me,k as ge,l as de,m as qe,p as ce,q as Ve,s as Pe,T as ze,x as Ce,y as ke,z as Le,A as se,B as Je,C as Ne,D as xe,E as We,G as Ge,H as tt,I as ot,J as je,K as lt,L as nt}from"./vendor-joC09iIB.js";(function(){const v=document.createElement("link").relList;if(v&&v.supports&&v.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))y(r);new MutationObserver(r=>{for(const f of r)if(f.type==="childList")for(const b of f.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&y(b)}).observe(document,{childList:!0,subtree:!0});function s(r){const f={};return r.integrity&&(f.integrity=r.integrity),r.referrerPolicy&&(f.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?f.credentials="include":r.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function y(r){if(r.ep)return;r.ep=!0;const f=s(r);fetch(r.href,f)}})();function Ee(){const l=He(),v=l==null?void 0:l.appContext.config.globalProperties.$toast;return v||(console.warn("Toast not available"),{success:s=>console.log("Success:",s),error:s=>console.error("Error:",s),warning:s=>console.warn("Warning:",s),info:s=>console.info("Info:",s)})}const Ue="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAHBUlEQVR4nOxZC1BTVxo+9+aNZI2LNsgjWR4hgoIiRVDBslKnIKPbx1jqTrtYoakat1a6dNsdd7t1X8XHyAbEhdUu1u2mXdbasqJbtsaMIqBBECiPBmqEICEBEx4xJLlJ7s6lw6rJDeQ2FzLM+M1kBs7/3+/83zn/Oee/51JRFAXzGbCvA/AWjwX4GvNeANWXnXffHQ4+K6/dYbHeD+IFhjRkb1wn9WPQbEQ4IF/tQlXX2p5+/8OyczY74j/VxuMG3Sh/Oz9jaQDb4CmPT1LIbLXBfzrz0cmHg8fQpx1Yc1Ra+TsiXD4R0PqtRmAyj/LxbJeaujKIcPlEAINOM7vLXBaTZibCRWgRq3WGJZWX63aoNDpB8BJOX/bGlIqwpUv6iXBgWBHG7eUF8urUWvU6Z9sLGxI/IsLl8SJu6u4XigqPXkVspiVTbTQqU1/6Vn7ammh+G5FOMZyqludIKqUVU/9jcaSuTCo/unfHbiad4iBdwMu/P1bV1tO1xbk9NDC0/vwHB1xGcjqYLAh16zsHW3R6XXTu1mfFdAqMrIoSKNbGhLcQ4QGeppDJ7ACtPcqNEI6tT9O3Vqm+tygqNMDjrU9Sef6tIYM2JjUuuXzfC5knCEXsBI8WMZUCAxiCrfhWyMZkMNzYXNHVpwmXXqp5j0Hz0/1m57a3PQ8VHx4JoNMASIl9shLPFsB5ooO7iDXhCY/dAcCvT/79LwC1s/K2bDnAXcQeJRqwMzzeRt/bua0gLChcDsCDNQNBkEU/qot7o6j0kzETQpuJ40ZnT6xSrUoNWhyseHVz2ikv4n4QA5FSArE5IFlTZ0r3XU1MWODib6NCl3a9dkhSYxgbjo4XLq8sL9j7Ip36YEwMRjMNQazMhf7+RgYNnuyo7bY6ArFaWKuXRX495wLwoLk39sO9RaVnM5OTP8zLSjtjsljpp6ovi6pqr706eE8XBwGUSqEy9Guihf/92TMZhetjI5rJCHwKpBRzZqsNYtKp6KD+Pvv1w5ILdzR3UvD8HA4YefOl7N25JKUPIKuUwIJH7A5of/GJf7oLfrIz2EH786fSss+uKFzOk+8L0mqh6rpbmR0q5YyFGAQBSuHHlcUWxEaZyXfMhFD0Rgt9Oh/SBMiam58HAO+oc4XZMsK/1taT6M6uHjJw8w6VSNfvemM8TbzPlFlwsP5KyzfJeL6kCejXDgo894aASqOZ9O/uHwzq6B3ijhitkzOC7XS7j0g+V3S0vQTDDhYEoZSBobvJ+yXFNZ29gy4lOGmvlDBMIfQqSKV8539EWvXHhvbGHBSFrAwGW+vvxzLoR7RxzrNpsyPs0xcv7/lg1/ZfPtKvuw7MVhulUakWdvRq+XY3tWFT90Bk+52BCOzvyOBgjytSFKAgms+b9F/2o+BbKwUrvgjhhjSjKLAPG4YE7lJxfEIf5dyGOwMXrren/eF0RYXRNMrHDt4QbmjDEbHop9F8rqpddZd3sV6R/aWiabtWr41PW534V8m+PFHW+qSPL9TX7oM8WAaBi4IbE4S8yYNs/7asIgBA0ZStRqFM/MXxIzcgHBEBP+C6DJKLgJvK3uXvniitBsDmNzkSEAD9uv5k0aFjXy1gMQ0DQ5p4CAIwNuXLwyL/ExcpqMWeS42NUmxKXFf8VWPdz6cLnkqhGd/Pe+U1Cow/+ekJUYr4qJgvbik7f/Jw+0J/tjpvS3qxs7/LQZZfcrrkUmOdGI/cgUKIkB8pz0xK+CQjKf6z4MWckYftZqsderfsTInsZt0evDRgMRYMHhaLnk+NW1Y/nchxk5lZ+I/Pf/vl9RvbLYiVlSBcJv/VK9sKBCHc3hkF7D12/NzVltZn8YhzNj/3ev6LGeXTdQ6+uzLZ+C+5XNza05Nsd1gXcNgBvekJK/+du3lTUSiXMzzT80TgkkK8wJAGgCMAE5ooFFz3hHTr+lgZ9iMryOngkoi5WZuOc9hPtDu3r4198nTqygjCr3wYmrvVkSerZXljJoT0m0DcYm5g2Mg5WV39zrVWZZofkzaRnhB/bufm9FI/JpXQXj8F8bHyitqWxhzJmwUJT60SNJER+P+BCZjt34lzNbvickRoWVWNmGzuObnYWhER3oAdX41dPbj1jDeYEwGrInltKKCNtatub6hRfJOEnfJkcc+JgE9ltS/DkINuNI3xCo4fbXgm/0CnouvOcjK4Z/16/ZKia+3+kqIrEIQ+sgNx2Jzb5wsPxrD9GBZv+Gd9BqSXr4icg8cwMj4SLmv6+mlv+WddgGlilOPOZkEmFnrLP+sCVgtXyPHaHShkiw0XXPWWf9YF5Gb9uGzp4sCbj7ai4LkNTx2O5nPV3vLPyTeye6P32X+7KNujVKtSYJg+viEu/mx2etJZCgnD57OPfGRh3n8nfizA15j3Av4XAAD//5k1S2w3zfwVAAAAAElFTkSuQmCC",ae=Qe.create({baseURL:"./",timeout:3e4,headers:{"Content-Type":"application/json"}});ae.interceptors.request.use(l=>l,l=>Promise.reject(l));ae.interceptors.response.use(l=>l,l=>(console.error("API Error:",l),l.response?console.error("Response error:",l.response.data):l.request?console.error("No response received"):console.error("Request setup error:",l.message),Promise.reject(l)));const st=et("devices",{state:()=>({devices:[],loading:!1,error:null,selectedDevice:null}),getters:{deviceById:l=>v=>l.devices.find(s=>s.id===v),devicesByType:l=>v=>l.devices.filter(s=>s.entity_type===v),deviceCount:l=>l.devices.length,hasDevices:l=>l.devices.length>0},actions:{async loadDevices(l=!1){this.loading=!0,this.error=null;try{const v=l?`/api/devices/managed?_t=${Date.now()}`:"/api/devices/managed",s=await ae.get(v);this.devices=s.data.devices||[],console.log("ğŸ“¥ Loaded devices:",this.devices),this.devices.forEach(y=>{console.log(`ğŸ“¥ Device "${y.name}":`,{id:y.id,device:y.device,commands:y.commands,commandCount:y.commands?Object.keys(y.commands).length:0})})}catch(v){this.error=v.message,console.error("Error loading devices:",v)}finally{this.loading=!1}},async createDevice(l){this.loading=!0,this.error=null;try{console.log("ğŸª Store: Creating device with data:",l),console.log("ğŸª Store: Device commands being sent:",l.commands);const v={device_name:l.name,device:l.device,area_id:l.area||"",area_name:l.area||"",entity_type:l.entity_type,icon:l.icon,broadlink_entity:l.broadlink_entity,device_type:l.device_type||"broadlink",commands:l.commands||{}};l.device_type==="smartir"&&l.smartir_config&&(v.smartir_config=l.smartir_config),console.log("ğŸª Store: Transformed data for backend:",v);const s=await ae.post("/api/devices/managed",v);return console.log("ğŸª Store: Create response:",s.data),await this.loadDevices(),s.data}catch(v){throw console.error("Error creating device:",v),v}finally{this.loading=!1}},async updateDevice(l,v){this.loading=!0,this.error=null;try{const s=await ae.put(`/api/devices/managed/${l}`,v);return await this.loadDevices(),s.data}catch(s){throw console.error("Error updating device:",s),s}finally{this.loading=!1}},async deleteDevice(l,v=!1){this.loading=!0,this.error=null;try{await ae.delete(`/api/devices/managed/${l}`,{data:{delete_commands:v}}),this.devices=this.devices.filter(s=>s.id!==l)}catch(s){throw this.error=s.message,console.error("Error deleting device:",s),s}finally{this.loading=!1}},selectDevice(l){this.selectedDevice=l},clearSelection(){this.selectedDevice=null},clearError(){this.error=null},async syncAllAreas(){if(!this.devices||this.devices.length===0){console.log("âš ï¸ No devices to sync");return}console.log(`ğŸ”„ Syncing areas from Home Assistant for ${this.devices.length} devices...`);try{const l=await Promise.all(this.devices.map(y=>(console.log(`ğŸ”„ Syncing device: ${y.id} (${y.name})`),ae.post(`/api/devices/${y.id}/sync-area`).then(r=>r.data.success&&r.data.area?(console.log(`âœ… Synced area for ${y.name}: ${r.data.area}`),{status:"synced",device:y.name}):{status:"no_area"}).catch(r=>{var f;return((f=r.response)==null?void 0:f.status)===404?(console.log(`âŒ Device not found in HA: ${y.id}`),{status:"not_found"}):(console.warn(`âš ï¸ Failed to sync area for ${y.id}:`,r.message),{status:"error",error:r.message})})))),v=l.filter(y=>y.status==="synced").length,s=l.filter(y=>y.status==="not_found").length;await this.loadDevices(!0),v>0?console.log(`âœ… Area sync complete: ${v} synced, ${s} not found in HA`):s>0&&console.log(`â„¹ï¸ No areas synced - ${s} entities not found in HA registry (generate entities first)`)}catch(l){console.debug("Area sync error:",l)}}}});function Ke(l){const v=W(()=>l.value||l),s=W(()=>{switch(v.value){case"climate":return"mdi:air-conditioner";case"fan":return"mdi:fan";case"light":return"mdi:lightbulb";case"media_player":return"mdi:television";case"switch":return"mdi:light-switch";default:return"mdi:devices"}}),y=W(()=>`device-type-${v.value}-color`),r=W(()=>`tag-${v.value}-bg`);return{icon:s,colorClass:y,tagBgClass:r}}const at=""+new URL("broadlink-logo-BDjImjRY.png",import.meta.url).href,pe=(l,v)=>{const s=l.__vccOpts||l;for(const[y,r]of v)s[y]=r;return s},it={class:"device-header"},rt={class:"device-info"},dt={class:"device-labels"},ut={class:"device-type"},ct=["src","alt","title"],mt={class:"device-body"},vt={class:"device-stats"},pt={class:"stat",title:"Command count"},ft={class:"stat"},gt={class:"device-meta"},yt={class:"device-id"},bt={key:0,class:"storage-name"},ht={key:1,class:"broadlink-entity"},kt={key:2,class:"controller-device"},wt={class:"device-actions"},$t=["disabled"],Ct=["disabled"],St=["disabled"],_t={key:0,class:"disabled-overlay"},It={__name:"DeviceCard",props:{device:{type:Object,required:!0},broadlinkDevices:{type:Array,default:()=>[]}},emits:["edit","delete","learn"],setup(l){const v=l,s=W(()=>localStorage.getItem("smartir_simulate_not_installed")==="true"),y=W(()=>v.device.device_type==="smartir"&&s.value),r=w(null),f=Ke(W(()=>v.device.entity_type)),b=W(()=>v.device.icon?v.device.icon:f.icon.value),t=_=>_&&_.startsWith("mdi:")?`mdi ${_.replace(":"," mdi-")}`:`mdi mdi-${_}`,c=W(()=>({light:"Light",fan:"Fan",switch:"Switch",media_player:"Media Player",cover:"Cover"})[v.device.entity_type]||v.device.entity_type),A=W(()=>(v.device.device_type||"broadlink")==="smartir"?"SmartIR":"Broadlink"),L=W(()=>(v.device.device_type||"broadlink")==="smartir"?Ue:at),h=W(()=>(v.device.device_type||"broadlink")==="smartir"?r.value!==null?r.value:0:Object.keys(v.device.commands||{}).length),o=_=>{if(!_)return"";const $=v.broadlinkDevices.find(u=>u.entity_id===_);return $&&$.name||_},T=W(()=>{if(!v.device.device)return!1;const _=v.device.id.includes(".")?v.device.id.split(".")[1]:v.device.id;return v.device.device!==_}),U=W(()=>{if(!v.device.broadlink_entity)return"";const _=v.broadlinkDevices.find($=>$.entity_id===v.device.broadlink_entity);return _&&_.name||v.device.broadlink_entity}),j=_=>{if(!_||typeof _!="object")return 0;let $=0;for(const u of Object.values(_))typeof u=="string"?$++:typeof u=="object"&&($+=j(u));return $},O=async()=>{if(!(!v.device.device_code||!v.device.entity_type))try{const _=await ae.get("/api/smartir/codes/code",{params:{entity_type:v.device.entity_type,code_id:v.device.device_code}});if(_.data.success&&_.data.code){const $=_.data.code;$.commands&&(r.value=j($.commands))}}catch(_){console.error("Error fetching SmartIR command count:",_)}};return Se(async()=>{(v.device.device_type||"broadlink")==="smartir"&&await O()}),(_,$)=>(a(),i("div",{class:Q(["device-card",{disabled:y.value}])},[e("div",it,[e("div",{class:Q(["device-icon",be(f).colorClass.value])},[e("i",{class:Q(t(b.value))},null,2)],2),e("div",rt,[e("h3",null,g(l.device.name),1),e("div",dt,[e("span",ut,g(c.value),1)])]),e("img",{src:L.value,alt:A.value,title:A.value,class:"device-source-logo"},null,8,ct)]),e("div",mt,[e("div",vt,[e("div",pt,[$[3]||($[3]=e("i",{class:"mdi mdi-remote"},null,-1)),e("span",null,g(h.value)+" command"+g(h.value!==1?"s":""),1)]),e("div",ft,[$[4]||($[4]=e("i",{class:"mdi mdi-map-marker"},null,-1)),e("span",null,g(l.device.area||"No area"),1)])]),e("div",gt,[e("span",yt,[$[5]||($[5]=e("i",{class:"mdi mdi-identifier"},null,-1)),S(" "+g(l.device.id),1)]),T.value?(a(),i("span",bt,[$[6]||($[6]=e("i",{class:"mdi mdi-code-tags"},null,-1)),S(" "+g(l.device.device),1)])):E("",!0),l.device.broadlink_entity?(a(),i("span",ht,[$[7]||($[7]=e("i",{class:"mdi mdi-access-point"},null,-1)),S(" "+g(U.value),1)])):E("",!0),l.device.controller_device?(a(),i("span",kt,[$[8]||($[8]=e("i",{class:"mdi mdi-access-point"},null,-1)),S(" Controller: "+g(o(l.device.controller_device)),1)])):E("",!0)])]),e("div",wt,[e("button",{onClick:$[0]||($[0]=u=>!y.value&&_.$emit("learn",l.device)),class:"icon-btn",title:"Manage Commands",disabled:y.value},[...$[9]||($[9]=[e("i",{class:"mdi mdi-remote-tv"},null,-1)])],8,$t),e("button",{onClick:$[1]||($[1]=u=>!y.value&&_.$emit("edit",l.device)),class:"icon-btn",title:"Edit",disabled:y.value},[...$[10]||($[10]=[e("i",{class:"mdi mdi-pencil"},null,-1)])],8,Ct),e("button",{onClick:$[2]||($[2]=u=>!y.value&&_.$emit("delete",l.device)),class:"icon-btn danger",title:"Delete",disabled:y.value},[...$[11]||($[11]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,St)]),y.value?(a(),i("div",_t,[...$[12]||($[12]=[e("div",{class:"disabled-message"},[e("i",{class:"mdi mdi-eye-off"}),e("span",null,"SmartIR Not Installed")],-1)])])):E("",!0)],2))}},Dt=pe(It,[["__scopeId","data-v-1aafda6b"]]),xt={class:"icon-picker"},Tt={class:"icon-input-wrapper"},Rt=["id","placeholder"],At={key:0,class:"icon-preview"},Lt={key:0,class:"icon-dropdown"},Ot={class:"icon-grid"},Mt=["onMousedown","title"],Et={__name:"IconPicker",props:{modelValue:{type:String,default:""},inputId:{type:String,default:"icon-input"},placeholder:{type:String,default:"e.g., mdi:television"}},emits:["update:modelValue"],setup(l,{emit:v}){const s=l,y=v,r=w(s.modelValue),f=w(!1),b=["television","speaker","radio","music","video","movie","play","pause","stop","skip-next","skip-previous","volume-high","volume-medium","volume-low","volume-off","remote","remote-tv","cast","chromecast","spotify","netflix","youtube","lightbulb","lightbulb-on","lightbulb-off","lamp","floor-lamp","ceiling-light","light-switch","led-strip","led-strip-variant","wall-sconce","chandelier","spotlight","track-light","vanity-light","desk-lamp","fan","ceiling-fan","air-conditioner","thermometer","thermostat","heat-wave","snowflake","fire","radiator","water-boiler","hvac","blinds","blinds-open","window-shutter","window-shutter-open","curtains","curtains-closed","roller-shade","roller-shade-closed","garage","garage-open","gate","door","door-open","window-open","window-closed","washing-machine","tumble-dryer","dishwasher","refrigerator","stove","microwave","oven","toaster","kettle","coffee","coffee-maker","blender","robot-vacuum","robot-vacuum-variant","vacuum","broom","spray-bottle","lock","lock-open","lock-smart","key","shield","shield-check","alarm-light","bell","doorbell","camera","cctv","motion-sensor","smoke-detector","fire-extinguisher","water-alert","gas-cylinder","sofa","bed","bed-double","desk","chair","table","bookshelf","home","home-outline","home-assistant","floor-plan","room","weather-sunny","weather-night","weather-cloudy","weather-rainy","weather-snowy","weather-lightning","weather-windy","weather-fog","weather-partly-cloudy","umbrella","water","water-percent","phone","cellphone","tablet","laptop","desktop-tower","monitor","keyboard","mouse","printer","router","router-wireless","access-point","wifi","bluetooth","usb","hdmi-port","ethernet","power","power-plug","power-socket","battery","battery-charging","lightning-bolt","flash","solar-panel","solar-power","leaf","tree","flower","sprout","grass","watering-can","shovel","fence","pool","hot-tub","silverware","silverware-fork-knife","food","food-apple","glass-wine","glass-cocktail","bottle-wine","pot","pot-steam","shower","shower-head","bathtub","toilet","sink","faucet","hand-wash","car","car-side","garage-variant","tools","hammer","wrench","screwdriver","toolbox","ladder","heart","heart-pulse","run","walk","bike","dumbbell","yoga","scale-bathroom","thermometer-lines","clock","clock-outline","timer","alarm","calendar","calendar-today","calendar-clock","history","bell-ring","bell-alert","alert","alert-circle","information","help-circle","check","check-circle","close-circle","minus-circle","plus-circle","arrow-up","arrow-down","arrow-left","arrow-right","chevron-up","chevron-down","menu","dots-vertical","dots-horizontal","cog","tune","circle","square","triangle","hexagon","star","star-outline","heart-outline","plus","minus","close","check-bold","eye","eye-off","account","account-group","baby","dog","cat","paw","gift","balloon","party-popper","candle","book","book-open","newspaper","email","message","phone-classic"];ue(()=>s.modelValue,h=>{r.value=h});const t=W(()=>{if(!r.value)return b.slice(0,50);const h=r.value.toLowerCase().replace("mdi:","");return b.filter(o=>o.toLowerCase().includes(h)).slice(0,50)}),c=()=>{f.value=!0,y("update:modelValue",r.value)},A=()=>{setTimeout(()=>{f.value=!1},200)},L=h=>{r.value=`mdi:${h}`,y("update:modelValue",r.value),f.value=!1};return(h,o)=>(a(),i("div",xt,[e("div",Tt,[q(e("input",{id:l.inputId,"onUpdate:modelValue":o[0]||(o[0]=T=>r.value=T),type:"text",placeholder:l.placeholder,onInput:c,onFocus:o[1]||(o[1]=T=>f.value=!0),onBlur:A},null,40,Rt),[[we,r.value]]),r.value?(a(),i("div",At,[e("i",{class:Q(`mdi mdi-${r.value.replace("mdi:","")}`)},null,2)])):E("",!0)]),f.value&&t.value.length>0?(a(),i("div",Lt,[e("div",Ot,[(a(!0),i(me,null,ge(t.value,T=>(a(),i("div",{key:T,class:"icon-option",onMousedown:de(U=>L(T),["prevent"]),title:T},[e("i",{class:Q(`mdi mdi-${T}`)},null,2),e("span",null,g(T),1)],40,Mt))),128))])])):E("",!0)]))}},Vt=pe(Et,[["__scopeId","data-v-a64f5011"]]),jt={key:0,class:"dropdown-label"},Pt={key:0,class:"required"},Ut=["placeholder","disabled","onKeydown"],Ft={class:"dropdown-icons"},Nt={key:0,class:"mdi mdi-loading mdi-spin"},Bt={key:2,class:"mdi mdi-chevron-down"},Ht={key:1,class:"error-message"},qt={key:2,class:"hint-message"},zt={key:0,class:"dropdown-menu"},Jt=["onMousedown","onMouseenter"],Wt={class:"option-content"},Gt={class:"option-label"},Kt={key:0,class:"option-description"},Xt={key:0,class:"mdi mdi-check selected-icon"},Yt={key:3,class:"dropdown-menu"},Zt={__name:"SearchableDropdown",props:{modelValue:{type:[String,Number,Object],default:null},options:{type:Array,required:!0,default:()=>[]},label:{type:String,default:""},placeholder:{type:String,default:"Search..."},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},error:{type:String,default:""},hint:{type:String,default:""},optionLabel:{type:String,default:"label"},optionValue:{type:String,default:"value"},optionDescription:{type:String,default:"description"},filterMethod:{type:Function,default:null}},emits:["update:modelValue","change","search"],setup(l,{emit:v}){const s=l,y=v,r=w(null),f=w(null),b=w(""),t=w(!1),c=w(0),A=w(!1),L=D=>typeof D=="string"||typeof D=="number"?D:D[s.optionLabel]||D.label||D.name||String(D),h=D=>typeof D=="string"||typeof D=="number"?D:D[s.optionValue]||D.value||D.id||D,o=D=>typeof D=="string"||typeof D=="number"?"":D[s.optionDescription]||D.description||"",T=D=>{const P=h(D);return typeof s.modelValue=="object"?h(s.modelValue)===P:s.modelValue===P},U=W(()=>{if(!b.value)return s.options;if(s.filterMethod)return s.options.filter(P=>s.filterMethod(P,b.value));const D=b.value.toLowerCase();return s.options.filter(P=>{const X=L(P).toLowerCase(),ne=o(P).toLowerCase();return X.includes(D)||ne.includes(D)})}),j=W(()=>{if(!s.modelValue)return"";const D=s.options.find(P=>{const X=h(P);return typeof s.modelValue=="object"?X===h(s.modelValue):X===s.modelValue});return D?L(D):""});ue(()=>s.modelValue,D=>{A.value||(b.value=j.value)}),ue(()=>s.options,()=>{!A.value&&s.modelValue&&(b.value=j.value)},{deep:!0}),ue(b,D=>{y("search",D),c.value=0}),Se(()=>{b.value=j.value});const O=()=>{var D;A.value=!0,t.value=!0,(D=f.value)==null||D.select()},_=()=>{A.value=!1,setTimeout(()=>{t.value=!1,s.modelValue?b.value=j.value:b.value=""},200)},$=()=>{var D;t.value=!1,(D=f.value)==null||D.blur()},u=D=>{const P=h(D);y("update:modelValue",P),y("change",P,D),b.value=L(D),$()},N=()=>{var D;y("update:modelValue",null),y("change",null,null),b.value="",(D=f.value)==null||D.focus()},Z=()=>{if(!t.value){t.value=!0;return}c.value<U.value.length-1&&c.value++},le=()=>{c.value>0&&c.value--},te=()=>{U.value.length>0&&c.value>=0&&u(U.value[c.value])},fe=D=>{r.value&&!r.value.contains(D.target)&&(t.value=!1,s.modelValue?b.value=j.value:b.value="")};return Se(()=>{document.addEventListener("click",fe)}),qe(()=>{document.removeEventListener("click",fe)}),(D,P)=>(a(),i("div",{class:"searchable-dropdown",ref_key:"dropdownRef",ref:r},[l.label?(a(),i("label",jt,[S(g(l.label)+" ",1),l.required?(a(),i("span",Pt,"*")):E("",!0)])):E("",!0),e("div",{class:Q(["dropdown-input-wrapper",{"has-error":l.error,disabled:l.disabled}])},[q(e("input",{ref_key:"inputRef",ref:f,type:"text","onUpdate:modelValue":P[0]||(P[0]=X=>b.value=X),placeholder:l.placeholder,disabled:l.disabled||l.loading,onFocus:O,onBlur:_,onKeydown:[Ve(de(Z,["prevent"]),["down"]),Ve(de(le,["prevent"]),["up"]),Ve(de(te,["prevent"]),["enter"]),Ve($,["escape"])],class:"dropdown-input"},null,40,Ut),[[we,b.value]]),e("div",Ft,[l.loading?(a(),i("i",Nt)):l.modelValue&&!l.disabled?(a(),i("i",{key:1,class:"mdi mdi-close-circle clear-icon",onClick:N})):(a(),i("i",Bt))])],2),l.error?(a(),i("div",Ht,g(l.error),1)):E("",!0),l.hint&&!l.error?(a(),i("div",qt,g(l.hint),1)):E("",!0),ce(ze,{name:"dropdown"},{default:Pe(()=>[t.value&&U.value.length>0?(a(),i("div",zt,[(a(!0),i(me,null,ge(U.value,(X,ne)=>(a(),i("div",{key:h(X),class:Q(["dropdown-item",{highlighted:ne===c.value,selected:T(X)}]),onMousedown:de(ve=>u(X),["prevent"]),onMouseenter:ve=>c.value=ne},[e("div",Wt,[e("div",Gt,g(L(X)),1),o(X)?(a(),i("div",Kt,g(o(X)),1)):E("",!0)]),T(X)?(a(),i("i",Xt)):E("",!0)],42,Jt))),128))])):E("",!0)]),_:1}),t.value&&U.value.length===0&&!l.loading?(a(),i("div",Yt,[...P[1]||(P[1]=[e("div",{class:"dropdown-item no-results"},[e("i",{class:"mdi mdi-magnify"}),S(" No results found ")],-1)])])):E("",!0)],512))}},Be=pe(Zt,[["__scopeId","data-v-679ce35f"]]),Qt={class:"smartir-selector"},eo={class:"form-group"},to={class:"form-group"},oo={class:"form-group"},lo=["value"],no={key:0,class:"error-message"},so={class:"form-group"},ao={class:"form-group"},io={key:1,class:"code-info"},ro={class:"info-content"},uo={class:"info-row"},co={class:"info-value"},mo={class:"info-row"},vo={class:"info-value"},po={key:0,class:"info-row"},fo={class:"info-value"},go={class:"info-row"},yo={class:"info-value"},bo={__name:"SmartIRDeviceSelector",props:{entityType:{type:String,required:!0},modelValue:{type:Object,default:()=>({})},broadlinkDevices:{type:Array,default:()=>[]}},emits:["update:modelValue","change"],setup(l,{expose:v,emit:s}){const y=l,r=s,f=w([]),b=w([]),t=w(""),c=w(""),A=w(""),L=w(""),h=w(""),o=w(null),T=w(!1),U=w(!1),j=w({manufacturer:"",model:"",controller:""});Se(async()=>{if(await O(),y.modelValue&&(t.value=y.modelValue.manufacturer||"",c.value=y.modelValue.device_code||"",A.value=y.modelValue.controller_device||"",L.value=y.modelValue.temperature_sensor||"",h.value=y.modelValue.humidity_sensor||"",t.value&&(await _(t.value),c.value&&b.value.length>0))){const D=b.value.find(P=>P.code===c.value);D&&(o.value={code:D.code,manufacturer:t.value,models:D.models,controller:D.controller})}}),ue(()=>y.entityType,async D=>{D&&(t.value="",c.value="",b.value=[],o.value=null,await O())});const O=async()=>{if(y.entityType){T.value=!0,j.value.manufacturer="";try{const D=await ae.get("/api/smartir/codes/manufacturers",{params:{entity_type:y.entityType}});if(D.data.success)f.value=D.data.manufacturers||[];else throw new Error(D.data.error||"Failed to load manufacturers")}catch(D){console.error("Error loading manufacturers:",D),j.value.manufacturer="Failed to load manufacturers. Please try again.",f.value=[]}finally{T.value=!1}}},_=async D=>{if(!(!D||!y.entityType)){U.value=!0,j.value.model="";try{const P=await ae.get("/api/smartir/codes/models",{params:{entity_type:y.entityType,manufacturer:D}});if(P.data.success){const X=P.data.models||[];b.value=X.map(ne=>{const ve=ne.models&&ne.models.length>0?ne.models.join(", "):`Code ${ne.code}`;return{code:ne.code,label:ve,description:`Code: ${ne.code}`,models:ne.models,controller:ne.controller}})}else throw new Error(P.data.error||"Failed to load models")}catch(P){console.error("Error loading models:",P),j.value.model="Failed to load models. Please try again.",b.value=[]}finally{U.value=!1}}},$=async D=>{t.value=D,c.value="",o.value=null,b.value=[],D&&await _(D),te()},u=()=>{const D=b.value.find(P=>P.code===c.value);D&&(o.value={code:D.code,manufacturer:t.value,models:D.models,controller:D.controller}),te()},N=()=>{te()},Z=()=>{te()},le=()=>{te()},te=()=>{var P,X;const D={manufacturer:t.value,model:((X=(P=o.value)==null?void 0:P.models)==null?void 0:X[0])||"",device_code:c.value,controller_device:A.value};y.entityType==="climate"&&(L.value&&(D.temperature_sensor=L.value),h.value&&(D.humidity_sensor=h.value)),r("update:modelValue",D),r("change",D)};return v({validate:()=>{let D=!0;return j.value={manufacturer:"",model:"",controller:""},t.value||(j.value.manufacturer="Manufacturer is required",D=!1),c.value||(j.value.model="Model is required",D=!1),A.value||(j.value.controller="Broadlink controller is required",D=!1),D}}),(D,P)=>(a(),i("div",Qt,[e("div",eo,[ce(Be,{modelValue:t.value,"onUpdate:modelValue":P[0]||(P[0]=X=>t.value=X),options:f.value,label:"Manufacturer",placeholder:"Search manufacturers...",required:"",loading:T.value,error:j.value.manufacturer,hint:"Select the device manufacturer",onChange:$},null,8,["modelValue","options","loading","error"])]),e("div",to,[ce(Be,{modelValue:c.value,"onUpdate:modelValue":P[1]||(P[1]=X=>c.value=X),options:b.value,"option-label":"label","option-value":"code","option-description":"description",label:"Model",placeholder:"Search models...",required:"",disabled:!t.value,loading:U.value,error:j.value.model,hint:"Select the device model",onChange:u},null,8,["modelValue","options","disabled","loading","error"])]),e("div",oo,[P[6]||(P[6]=e("label",{for:"controller-device"},[e("i",{class:"mdi mdi-remote"}),S(" Controller Device * ")],-1)),q(e("select",{id:"controller-device","onUpdate:modelValue":P[2]||(P[2]=X=>A.value=X),required:"",onChange:N},[P[5]||(P[5]=e("option",{value:""},"-- Select Controller Device --",-1)),(a(!0),i(me,null,ge(l.broadlinkDevices,X=>(a(),i("option",{key:X.entity_id,value:X.entity_id},[S(g(X.name||X.entity_id)+" ",1),X.area_name?(a(),i(me,{key:0},[S(" - "+g(X.area_name),1)],64)):E("",!0)],8,lo))),128))],544),[[Ce,A.value]]),P[7]||(P[7]=e("small",null,"Which remote device will send the IR/RF commands",-1)),j.value.controller?(a(),i("div",no,g(j.value.controller),1)):E("",!0)]),l.entityType==="climate"?(a(),i(me,{key:0},[e("div",so,[P[8]||(P[8]=e("label",{for:"temperature-sensor"},"Temperature Sensor",-1)),q(e("input",{id:"temperature-sensor","onUpdate:modelValue":P[3]||(P[3]=X=>L.value=X),type:"text",placeholder:"e.g., sensor.living_room_temperature",onInput:Z},null,544),[[we,L.value]]),P[9]||(P[9]=e("small",null,"Optional: Temperature sensor entity for current temperature",-1))]),e("div",ao,[P[10]||(P[10]=e("label",{for:"humidity-sensor"},"Humidity Sensor",-1)),q(e("input",{id:"humidity-sensor","onUpdate:modelValue":P[4]||(P[4]=X=>h.value=X),type:"text",placeholder:"e.g., sensor.living_room_humidity",onInput:le},null,544),[[we,h.value]]),P[11]||(P[11]=e("small",null,"Optional: Humidity sensor entity for current humidity",-1))])],64)):E("",!0),o.value?(a(),i("div",io,[P[16]||(P[16]=e("div",{class:"info-header"},[e("i",{class:"mdi mdi-information"}),e("span",null,"Selected Device Code")],-1)),e("div",ro,[e("div",uo,[P[12]||(P[12]=e("span",{class:"info-label"},"Code ID:",-1)),e("span",co,g(o.value.code_id),1)]),e("div",mo,[P[13]||(P[13]=e("span",{class:"info-label"},"Manufacturer:",-1)),e("span",vo,g(o.value.manufacturer),1)]),o.value.models&&o.value.models.length>0?(a(),i("div",po,[P[14]||(P[14]=e("span",{class:"info-label"},"Supported Models:",-1)),e("span",fo,g(o.value.models.join(", ")),1)])):E("",!0),e("div",go,[P[15]||(P[15]=e("span",{class:"info-label"},"Controller:",-1)),e("span",yo,g(o.value.controller||"Broadlink"),1)])])])):E("",!0)]))}},ho=pe(bo,[["__scopeId","data-v-1911c8f6"]]),ko={class:"modal-content"},wo={class:"modal-header"},$o={class:"form-group"},Co={class:"form-group"},So=["disabled"],_o={key:0,class:"smartir-notice"},Io={key:0,class:"notice-success"},Do={key:1,class:"notice-warning"},xo={key:1,class:"smartir-notice"},To={key:2},Ro={class:"form-group"},Ao=["disabled"],Lo=["disabled"],Oo={key:0},Mo={key:1},Eo={key:2},Vo={key:3},jo={key:0,class:"form-group"},Po={class:"area-display-readonly"},Uo=["value"],Fo=["disabled"],No=["href"],Bo={key:1,class:"form-group"},Ho={class:"form-group"},qo={key:2,class:"form-group"},zo=["value"],Jo=["value"],Wo={key:2},Go={key:3},Ko={key:3,class:"smartir-section"},Xo={class:"modal-footer"},Yo={type:"submit",form:"device-form",class:"btn btn-primary"},Zo={__name:"DeviceForm",props:{device:{type:Object,default:null}},emits:["save","cancel"],setup(l,{emit:v}){const s=l,y=v,r=ke("smartirStatus"),f=ke("smartirEnabled"),b=W(()=>{var d;return localStorage.getItem("smartir_simulate_not_installed")==="true"?!1:((d=r==null?void 0:r.value)==null?void 0:d.installed)||!1}),t=W(()=>!!s.device),c=W(()=>["climate","media_player","fan","light"].includes(o.value.entity_type)),A=W(()=>b.value?!c.value&&o.value.entity_type?"(Not supported for this type)":"(Pre-configured Codes)":"(Requires SmartIR)"),L=W(()=>{var d;const G=((d=s.device)==null?void 0:d.commands)||{};return Object.keys(G).length>0}),h=W(()=>{if(!o.value.broadlink_entity)return"";const G=O.value.find(d=>d.entity_id===o.value.broadlink_entity);return G&&G.name||o.value.broadlink_entity}),o=w({name:"",entity_type:"",device_type:"broadlink",device:"",area:"",icon:"",broadlink_entity:"",enabled:!0,commands:{}}),T=w({}),U=w(null),j=w([]),O=w([]),_=w(null),$=w(null),u=w(null),N=w(!1);Se(async()=>{s.device&&(o.value={...s.device,device_type:s.device.device_type||"broadlink"},o.value.device_type==="smartir"&&(T.value={manufacturer:s.device.manufacturer,model:s.device.model,device_code:s.device.device_code,controller_device:s.device.controller_device,temperature_sensor:s.device.temperature_sensor,humidity_sensor:s.device.humidity_sensor})),await Promise.all([Z(),le()]),_.value&&(_.value.setCustomValidity(""),_.value.oninvalid=()=>{_.value.setCustomValidity("Device name is required")}),$.value&&($.value.setCustomValidity(""),$.value.oninvalid=()=>{$.value.setCustomValidity("Entity type is required")}),u.value&&(u.value.setCustomValidity(""),u.value.oninvalid=()=>{u.value.setCustomValidity("Broadlink device is required")})});const Z=async()=>{try{const G=await ae.get("/api/areas");j.value=G.data.areas||[]}catch(G){console.error("Error loading areas:",G),j.value=[]}},le=async()=>{try{const d=(await ae.get("/api/remote/devices")).data.devices||[];O.value=d,console.log("Loaded remote devices:",d)}catch(G){console.error("Error loading remote devices:",G),O.value=[]}},te=G=>{const d=G==="nameInput"?_.value:G==="typeSelect"?$.value:G==="broadlinkSelect"?u.value:null;d&&d.setCustomValidity("")},fe=G=>{if(!G)return"";const d=G.toLowerCase();for(const k of j.value){const z=k.toLowerCase();if(d.includes(z))return k}return""},D=(G,d="")=>{const k=d.toLowerCase();return k.includes("tv")?"mdi:television":k.includes("lamp")?"mdi:lamp":k.includes("ceiling")?"mdi:ceiling-light":k.includes("floor")?"mdi:floor-lamp":k.includes("desk")?"mdi:desk-lamp":k.includes("fan")?"mdi:fan":k.includes("ac")||k.includes("air con")?"mdi:air-conditioner":k.includes("heater")?"mdi:radiator":k.includes("blind")?"mdi:blinds":k.includes("curtain")?"mdi:curtains":k.includes("garage")?"mdi:garage":k.includes("speaker")||k.includes("stereo")?"mdi:speaker":k.includes("receiver")?"mdi:audio-video":{light:"mdi:lightbulb",fan:"mdi:fan",switch:"mdi:light-switch",media_player:"mdi:television",cover:"mdi:window-shutter",climate:"mdi:thermostat"}[G]||"mdi:devices"};ue(()=>o.value.name,G=>{if(!t.value&&G&&!o.value.area){const d=fe(G);d&&(o.value.area=d)}!t.value&&G&&o.value.entity_type&&(N.value||!o.value.icon)&&(o.value.icon=D(o.value.entity_type,G),N.value=!0)}),ue(()=>o.value.entity_type,G=>{!t.value&&G&&(N.value||!o.value.icon)&&(o.value.icon=D(G,o.value.name),N.value=!0)}),ue(()=>o.value.icon,(G,d)=>{d!==void 0&&G!==d&&!N.value&&(N.value=!1),G||(N.value=!1)});const P=w(!1),X=async()=>{var G;if((G=s.device)!=null&&G.id){P.value=!0;try{const d=await ae.post(`/api/devices/${s.device.id}/sync-area`);d.data.success?(o.value.area=d.data.area||"",d.data.area?console.log(`Area synced: ${d.data.area}`):console.log("No area assigned in Home Assistant")):console.warn(d.data.message||"Entity not found in HA")}catch(d){console.error("Failed to sync area:",d)}finally{P.value=!1}}},ne=()=>{var k;return!((k=s.device)!=null&&k.id)||!o.value.entity_type?"#":`/config/entities/entity/${`${o.value.entity_type}.${s.device.id}`}`},ve=async()=>{if(o.value.device_type==="smartir"){if(U.value&&!U.value.validate())return;const G={...o.value,smartir_config:{manufacturer:T.value.manufacturer,model:T.value.model,code_id:T.value.device_code,controller_device:T.value.controller_device}};y("save",G)}else y("save",{...o.value})},$e=G=>{T.value=G};return(G,d)=>(a(),i("div",{class:"modal-overlay",onClick:d[11]||(d[11]=de(k=>G.$emit("cancel"),["self"]))},[e("div",ko,[e("div",wo,[e("h2",null,g(t.value?"Edit Device":"Add New Device"),1),e("button",{onClick:d[0]||(d[0]=k=>G.$emit("cancel")),class:"close-btn"},[...d[12]||(d[12]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("form",{id:"device-form",onSubmit:de(ve,["prevent"]),class:"modal-body"},[e("div",$o,[d[13]||(d[13]=e("label",{for:"device-name"},"Device Name *",-1)),q(e("input",{id:"device-name",ref_key:"nameInput",ref:_,"onUpdate:modelValue":d[1]||(d[1]=k=>o.value.name=k),type:"text",placeholder:"e.g., Living Room TV",required:"",onInput:d[2]||(d[2]=k=>te("nameInput"))},null,544),[[we,o.value.name]])]),e("div",Co,[d[20]||(d[20]=e("label",{for:"entity-type"},"Entity Type *",-1)),q(e("select",{id:"entity-type",ref_key:"typeSelect",ref:$,"onUpdate:modelValue":d[3]||(d[3]=k=>o.value.entity_type=k),required:"",onChange:d[4]||(d[4]=k=>te("typeSelect"))},[d[14]||(d[14]=Le('<option value="" data-v-fe453a7b>-- Select Type --</option><option value="light" data-v-fe453a7b>ğŸ’¡ Light</option><option value="fan" data-v-fe453a7b>ğŸŒ€ Fan</option><option value="switch" data-v-fe453a7b>ğŸ”Œ Switch</option><option value="media_player" data-v-fe453a7b>ğŸ“º Media Player</option><option value="cover" data-v-fe453a7b>ğŸªŸ Cover (Blinds/Curtains)</option>',6)),e("option",{value:"climate",disabled:!b.value}," ğŸŒ¡ï¸ Climate "+g(b.value?"":"(Requires SmartIR)"),9,So)],544),[[Ce,o.value.entity_type]]),o.value.entity_type==="climate"?(a(),i("div",_o,[b.value?(a(),i("div",Io,[...d[15]||(d[15]=[e("i",{class:"mdi mdi-check-circle"},null,-1),e("span",null,"SmartIR detected! Climate entities will be created via SmartIR profiles.",-1)])])):(a(),i("div",Do,[...d[16]||(d[16]=[e("i",{class:"mdi mdi-alert"},null,-1),e("div",null,[e("strong",null,"SmartIR Required"),e("p",null,"Climate entities (AC, heaters) require SmartIR integration."),e("a",{href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"smartir-link"}," Install SmartIR â†’ ")],-1)])]))])):b.value&&["media_player","fan","light"].includes(o.value.entity_type)?(a(),i("div",xo,[...d[17]||(d[17]=[e("div",{class:"notice-info"},[e("i",{class:"mdi mdi-information"}),e("span",null,"ğŸ’¡ SmartIR available! You can use pre-configured codes or learn your own.")],-1)])])):!b.value&&o.value.entity_type?(a(),i("small",To,[d[18]||(d[18]=S(" ğŸ’¡ Tip: Install ",-1)),d[19]||(d[19]=e("a",{href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"inline-link"},"SmartIR",-1)),S(" for pre-configured "+g(o.value.entity_type==="climate"?"climate":o.value.entity_type)+" device codes ",1)])):E("",!0)]),e("div",Ro,[d[23]||(d[23]=e("label",{for:"device-type"},"Device Type *",-1)),q(e("select",{id:"device-type","onUpdate:modelValue":d[5]||(d[5]=k=>o.value.device_type=k),required:"",disabled:t.value},[d[21]||(d[21]=e("option",{value:""},"-- Select Device Type --",-1)),d[22]||(d[22]=e("option",{value:"broadlink"},"ğŸ“¡ Broadlink Device (Learn IR Codes)",-1)),be(f)?(a(),i("option",{key:0,value:"smartir",disabled:!b.value||!c.value}," ğŸŒ SmartIR Device "+g(A.value),9,Lo)):E("",!0)],8,Ao),[[Ce,o.value.device_type]]),t.value?(a(),i("small",Oo,"Cannot change device type after creation")):o.value.device_type==="smartir"?(a(),i("small",Mo,"Using pre-configured codes from SmartIR repository")):o.value.device_type==="broadlink"?(a(),i("small",Eo,"Learn and store your own IR codes")):(a(),i("small",Vo,"Choose how to configure this device"))]),t.value?(a(),i("div",jo,[d[26]||(d[26]=e("label",{for:"device-area"},"Area",-1)),e("div",Po,[e("input",{id:"device-area",value:o.value.area||"Not assigned",type:"text",readonly:"",class:"readonly-input"},null,8,Uo),e("button",{type:"button",onClick:X,disabled:P.value,class:"sync-area-btn",title:"Sync area from Home Assistant"},[e("i",{class:Q(P.value?"mdi mdi-loading mdi-spin":"mdi mdi-refresh")},null,2)],8,Fo)]),e("small",null,[d[24]||(d[24]=e("i",{class:"mdi mdi-information-outline"},null,-1)),d[25]||(d[25]=S(" Set area in Home Assistant, then click sync. ",-1)),e("a",{href:ne(),target:"_blank",class:"inline-link"},"Open in HA â†’",8,No)])])):(a(),i("div",Bo,[...d[27]||(d[27]=[e("div",{class:"info-notice"},[e("i",{class:"mdi mdi-information-outline"}),e("span",null,[e("strong",null,"Area Assignment:"),S(" After generating entities and restarting Home Assistant, you can assign areas in HA and sync them here.")])],-1)])])),e("div",Ho,[d[28]||(d[28]=e("label",{for:"device-icon"},"Icon",-1)),ce(Vt,{modelValue:o.value.icon,"onUpdate:modelValue":d[6]||(d[6]=k=>o.value.icon=k),inputId:"device-icon",placeholder:"e.g., mdi:television"},null,8,["modelValue"]),d[29]||(d[29]=e("small",null,"Optional: Material Design Icon name",-1))]),o.value.device_type==="broadlink"?(a(),i("div",qo,[d[31]||(d[31]=e("label",{for:"broadlink-entity"},"Remote Device *",-1)),!t.value||!L.value?q((a(),i("select",{key:0,id:"broadlink-entity",ref_key:"broadlinkSelect",ref:u,"onUpdate:modelValue":d[7]||(d[7]=k=>o.value.broadlink_entity=k),required:"",onChange:d[8]||(d[8]=k=>te("broadlinkSelect"))},[d[30]||(d[30]=e("option",{value:""},"-- Select Remote Device --",-1)),(a(!0),i(me,null,ge(O.value,k=>(a(),i("option",{key:k.entity_id,value:k.entity_id},[S(g(k.name||k.entity_id)+" ",1),k.area_name?(a(),i(me,{key:0},[S(" - "+g(k.area_name),1)],64)):E("",!0)],8,zo))),128))],544)),[[Ce,o.value.broadlink_entity]]):(a(),i("input",{key:1,id:"broadlink-entity",value:h.value,type:"text",readonly:"",disabled:""},null,8,Jo)),!t.value||!L.value?(a(),i("small",Wo,"Required: Select which remote device to use for sending commands")):(a(),i("small",Go,"Cannot change remote device after commands are learned"))])):E("",!0),o.value.device_type==="smartir"?(a(),i("div",Ko,[d[32]||(d[32]=e("div",{class:"section-header"},[e("i",{class:"mdi mdi-cloud-download"}),e("span",null,"SmartIR Device Configuration")],-1)),ce(ho,{ref_key:"smartirSelector",ref:U,"entity-type":o.value.entity_type,modelValue:T.value,"onUpdate:modelValue":d[9]||(d[9]=k=>T.value=k),"broadlink-devices":O.value,onChange:$e},null,8,["entity-type","modelValue","broadlink-devices"])])):E("",!0)],32),e("div",Xo,[e("button",{type:"button",onClick:d[10]||(d[10]=k=>G.$emit("cancel")),class:"btn btn-secondary"}," Cancel "),e("button",Yo,[d[33]||(d[33]=e("i",{class:"mdi mdi-check"},null,-1)),S(" "+g(t.value?"Update":"Create"),1)])])])]))}},Qo=pe(Zo,[["__scopeId","data-v-fe453a7b"]]),el={class:"modal-header"},tl={class:"modal-body"},ol={class:"message-text"},ll={key:0,class:"checkbox-option"},nl={class:"modal-footer"},sl={__name:"ConfirmDialog",props:{isOpen:{type:Boolean,default:!1},title:{type:String,default:"Confirm"},message:{type:String,required:!0},confirmText:{type:String,default:"OK"},cancelText:{type:String,default:"Cancel"},showCancel:{type:Boolean,default:!0},dangerMode:{type:Boolean,default:!1},checkboxLabel:{type:String,default:""}},emits:["confirm","cancel"],setup(l,{emit:v}){const s=l,y=v,r=w(!1);ue(()=>s.isOpen,t=>{t&&(r.value=!1)});const f=()=>{y("confirm",r.value)},b=()=>{y("cancel")};return(t,c)=>l.isOpen?(a(),i("div",{key:0,class:"modal-overlay",onClick:de(b,["self","stop"])},[e("div",{class:"modal-dialog confirm-dialog",onClick:c[1]||(c[1]=de(()=>{},["stop"]))},[e("div",el,[e("h2",null,g(l.title),1)]),e("div",tl,[e("p",ol,g(l.message),1),l.checkboxLabel?(a(),i("div",ll,[e("label",null,[q(e("input",{type:"checkbox","onUpdate:modelValue":c[0]||(c[0]=A=>r.value=A)},null,512),[[se,r.value]]),e("span",null,g(l.checkboxLabel),1)])])):E("",!0)]),e("div",nl,[l.showCancel?(a(),i("button",{key:0,onClick:de(b,["stop"]),class:"btn btn-secondary"},g(l.cancelText),1)):E("",!0),e("button",{onClick:de(f,["stop"]),class:Q(["btn",l.dangerMode?"btn-danger":"btn-primary"])},g(l.confirmText),3)])])])):E("",!0)}},Te=pe(sl,[["__scopeId","data-v-6404e72a"]]),al={class:"modal-content"},il={class:"modal-header"},rl={class:"modal-body"},dl={key:0,class:"smartir-info"},ul={class:"form-group"},cl=["value"],ml={class:"form-group"},vl=["disabled"],pl={label:"Suggested Commands"},fl=["value"],gl=["disabled"],yl={class:"form-group"},bl={class:"radio-group"},hl={class:"radio-label"},kl=["disabled"],wl={class:"radio-label"},$l=["disabled"],Cl={class:"learn-action"},Sl=["disabled"],_l={key:0,class:"mdi mdi-loading mdi-spin"},Il={key:1,class:"mdi mdi-remote-tv"},Dl={key:0,class:"learning-status"},xl={key:1,class:"result-message success"},Tl={key:2,class:"section-divider"},Rl={key:3,class:"learned-commands"},Al={class:"command-list"},Ll={class:"command-info"},Ol={class:"command-name"},Ml={class:"learned-status"},El={class:"command-actions"},Vl=["onClick"],jl=["onClick","disabled"],Pl={key:4,class:"untracked-commands"},Ul={class:"command-list"},Fl={class:"command-name"},Nl={class:"modal-footer"},Bl=["disabled"],Hl={__name:"CommandLearner",props:{device:{type:Object,required:!0}},emits:["cancel","learned"],setup(l,{emit:v}){const s=l,y=v,r=w([]),f=w(""),b=w(""),t=w(""),c=w("ir"),A=w(!1),L=w(""),h=w("success"),o=w([]),T=w([]),U=w(!1),j=w(""),O=w(!1),_=w(null),$=w(null),u=w(""),N=w(""),Z=W(()=>s.device.device_type==="smartir");W(()=>{if(Z.value)return!1;const M=b.value==="__custom__"?t.value:b.value;return f.value&&M.trim()});const le=()=>{_.value&&_.value.setCustomValidity("")},te=()=>{$.value&&$.value.setCustomValidity("")},fe=W(()=>{const M=r.value.find(C=>C.entity_id===f.value);return M?M.name||M.entity_id:f.value}),D={light:["turn_on","turn_off","toggle","brightness_up","brightness_down","dim","bright"],fan:["turn_on","turn_off","toggle","speed_low","speed_medium","speed_high","speed_1","speed_2","speed_3","speed_4","speed_5","oscillate_on","oscillate_off","direction_forward","direction_reverse"],switch:["turn_on","turn_off","toggle"],media_player:["turn_on","turn_off","toggle","volume_up","volume_down","volume_mute","play","pause","stop","play_pause","next_track","previous_track","channel_up","channel_down","source_hdmi1","source_hdmi2","source_hdmi3","source_tv","source_aux","source_bluetooth","menu","home","back","select","arrow_up","arrow_down","arrow_left","arrow_right"],cover:["open","close","stop","open_tilt","close_tilt","position_0","position_25","position_50","position_75","position_100"]},P=W(()=>{const M=s.device.entity_type||"switch";return D[M]||D.switch});Se(async()=>{await X(),await ne(),await z(),_.value&&(_.value.setCustomValidity(""),_.value.oninvalid=()=>{_.value.setCustomValidity("Command name is required")}),s.device.broadlink_entity&&(f.value=s.device.broadlink_entity)}),ue(b,async M=>{M==="__custom__"&&(await Je(),$.value&&($.value.setCustomValidity(""),$.value.oninvalid=()=>{$.value.setCustomValidity("Custom command name is required")}))});const X=async()=>{try{const M=await ae.get("/api/broadlink/devices");r.value=M.data.devices||[]}catch(M){console.error("Error loading Broadlink devices:",M)}},ne=async()=>{try{if(Z.value){const M=await ae.get("/api/smartir/codes/code",{params:{entity_type:s.device.entity_type,code_id:s.device.device_code}});if(M.data.success&&M.data.code){const C=M.data.code.commands||{},F=M.data.code.commandType||"ir";o.value=Object.keys(C).map(ee=>({name:ee,type:F}))}}else{if(console.log("ğŸ“‹ Loading commands for device:",s.device),console.log("ğŸ“‹ Device commands:",s.device.commands),console.log("ğŸ“‹ Device ID:",s.device.id),s.device.commands&&Object.keys(s.device.commands).length>0)console.log("âœ… Using commands from device object"),o.value=Object.entries(s.device.commands).map(([M,C])=>({name:M,type:C.command_type||C.type||"ir"}));else if(s.device.id){console.log("ğŸŒ Fetching commands from API for device ID:",s.device.id);const C=(await ae.get(`/api/commands/${s.device.id}`)).data.commands||{};o.value=Object.entries(C).map(([F,ee])=>({name:F,type:ee.command_type||ee.type||"ir"}))}else console.log("âš ï¸ No commands found and no device ID");console.log("ğŸ“‹ Final learned commands:",o.value)}}catch(M){console.error("Error loading commands:",M)}},ve=async()=>{var M,C;L.value="",h.value="",A.value=!0;try{let F=s.device.id.split(".")[1];s.device.device&&(F=s.device.device);const ee=b.value==="__custom__"?t.value:b.value,ye=await ae.post("/api/commands/learn",{entity_id:f.value,device:F,device_id:s.device.id,command:ee.trim(),command_type:c.value});if(ye.data.success){L.value=`Command "${ee}" learned successfully!`,h.value="success",o.value.includes(ee)||o.value.push(ee);const he=T.value.indexOf(ee);he>-1&&T.value.splice(he,1);const _e={...s.device.commands};_e[ee]=!0,b.value="",t.value="",y("learned",{commands:_e,commandName:ee})}else L.value=ye.data.error||"Failed to learn command",h.value="error"}catch(F){L.value=((C=(M=F.response)==null?void 0:M.data)==null?void 0:C.error)||"Error learning command",h.value="error"}finally{A.value=!1}},$e=async M=>{try{N.value=M,u.value="";let C=s.device.id.split(".")[1];s.device.device&&(C=s.device.device);const F=Z.value?s.device.controller_device:f.value||s.device.broadlink_entity;(await ae.post("/api/commands/test",{entity_id:F,device:C,command:M,device_id:s.device.id})).data.success&&(u.value=M,setTimeout(()=>{u.value===M&&(u.value="")},2e3))}catch(C){L.value=`Failed to send command: ${C.message}`,h.value="error"}finally{N.value=""}},G=M=>{j.value=M,U.value=!0},d=()=>{U.value=!1,j.value=""},k=async()=>{const M=j.value;U.value=!1;try{await ae.delete(`/api/commands/${s.device.id}/${M}`),await ne(),await z(),L.value=`Command "${M}" deleted`,h.value="success",y("learned")}catch(C){L.value=`Failed to delete command: ${C.message}`,h.value="error"}finally{j.value=""}},z=async()=>{try{const M=s.device.device||s.device.id.split(".")[1],F=(await ae.get("/api/commands/untracked")).data.untracked||{};F[M]?T.value=Object.keys(F[M].commands):T.value=[]}catch(M){console.error("Error loading untracked commands:",M),T.value=[]}},H=()=>{T.value.length!==0&&(O.value=!0)},I=async()=>{O.value=!1;try{const M=s.device.device||s.device.id.split(".")[1],C=await ae.post("/api/commands/import",{device_id:s.device.id,source_device:M,commands:T.value});C.data.success&&(L.value=`Imported ${C.data.imported_count} commands successfully!`,h.value="success",await ne(),await z(),y("learned"))}catch(M){L.value=`Failed to import commands: ${M.message}`,h.value="error"}};return(M,C)=>(a(),i("div",{class:"modal-overlay",onClick:C[7]||(C[7]=de(F=>M.$emit("cancel"),["self"]))},[e("div",al,[e("div",il,[e("h2",null,g(Z.value?"Commands for":"Learn Commands for")+" "+g(l.device.name),1),e("button",{onClick:C[0]||(C[0]=F=>M.$emit("cancel")),class:"close-btn"},[...C[8]||(C[8]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",rl,[Z.value?(a(),i("div",dl,[C[12]||(C[12]=e("i",{class:"mdi mdi-information"},null,-1)),e("div",null,[C[11]||(C[11]=e("h3",null,"SmartIR Device",-1)),e("p",null,[C[9]||(C[9]=S("This device uses SmartIR code file ",-1)),e("strong",null,g(l.device.device_code),1),C[10]||(C[10]=S(". Commands are pre-configured and cannot be learned. View the commands below.",-1))])])])):(a(),i("form",{key:1,onSubmit:de(ve,["prevent"])},[e("div",ul,[C[13]||(C[13]=e("label",{for:"broadlink-entity"},"Broadlink Device",-1)),e("input",{id:"broadlink-entity",value:fe.value,type:"text",readonly:"",disabled:""},null,8,cl),C[14]||(C[14]=e("small",null,"Commands will be learned using this device (set when device was created)",-1))]),e("div",ml,[C[17]||(C[17]=e("label",{for:"command-name"},"Command Name *",-1)),q(e("select",{id:"command-name",ref_key:"commandSelect",ref:_,"onUpdate:modelValue":C[1]||(C[1]=F=>b.value=F),disabled:A.value,required:"",onChange:le},[C[15]||(C[15]=e("option",{value:""},"-- Select or type command --",-1)),e("optgroup",pl,[(a(!0),i(me,null,ge(P.value,F=>(a(),i("option",{key:F,value:F},g(F),9,fl))),128))]),C[16]||(C[16]=e("option",{value:"__custom__"},"Custom command...",-1))],40,vl),[[Ce,b.value]]),b.value==="__custom__"?q((a(),i("input",{key:0,ref_key:"customCommandInput",ref:$,"onUpdate:modelValue":C[2]||(C[2]=F=>t.value=F),type:"text",placeholder:"Enter custom command name",disabled:A.value,required:"",class:"custom-command-input",onInput:te},null,40,gl)),[[we,t.value]]):E("",!0),e("small",null,"Select a suggested command for "+g(l.device.entity_type||"this device")+", or enter a custom one.",1)]),e("div",yl,[C[20]||(C[20]=e("label",null,"Command Type",-1)),e("div",bl,[e("label",hl,[q(e("input",{type:"radio","onUpdate:modelValue":C[3]||(C[3]=F=>c.value=F),value:"ir",disabled:A.value},null,8,kl),[[Ne,c.value]]),C[18]||(C[18]=e("span",null,"IR (Infrared)",-1))]),e("label",wl,[q(e("input",{type:"radio","onUpdate:modelValue":C[4]||(C[4]=F=>c.value=F),value:"rf",disabled:A.value},null,8,$l),[[Ne,c.value]]),C[19]||(C[19]=e("span",null,"RF (Radio Frequency)",-1))])])]),e("div",Cl,[e("button",{type:"submit",class:"btn btn-primary btn-large",disabled:A.value},[A.value?(a(),i("i",_l)):(a(),i("i",Il)),S(" "+g(A.value?"Learning...":"Learn Command"),1)],8,Sl)]),A.value?(a(),i("div",Dl,[...C[21]||(C[21]=[e("i",{class:"mdi mdi-loading mdi-spin"},null,-1),e("p",null,"Point your remote at the Broadlink device and press the button...",-1),e("small",null,"This may take up to 30 seconds",-1)])])):E("",!0),L.value&&h.value==="success"&&!L.value.includes("sent successfully")?(a(),i("div",xl,[C[22]||(C[22]=e("i",{class:"mdi mdi-check-circle"},null,-1)),e("p",null,g(L.value),1)])):E("",!0)],32)),o.value.length>0||T.value.length>0?(a(),i("div",Tl)):E("",!0),o.value.length>0?(a(),i("div",Rl,[e("h3",null,"Tracked Commands ("+g(o.value.length)+")",1),e("div",Al,[(a(!0),i(me,null,ge(o.value,F=>(a(),i("div",{key:F.name,class:"command-item"},[e("div",Ll,[e("span",Ol,g(F.name),1)]),e("div",Ml,[C[23]||(C[23]=e("i",{class:"mdi mdi-check-circle"},null,-1)),C[24]||(C[24]=e("span",null,"Learned",-1)),e("span",{class:Q(["command-type-badge",F.type||"ir"])},g((F.type||"ir").toUpperCase()),3)]),e("div",El,[e("button",{type:"button",onClick:ee=>G(F.name),class:"icon-btn danger",title:"Delete and re-learn"},[...C[25]||(C[25]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,Vl),e("button",{type:"button",onClick:ee=>$e(F.name),class:"icon-btn",title:"Test command",disabled:N.value===F.name},[e("i",{class:Q(["mdi mdi-play",{"mdi-spin":N.value===F.name}])},null,2)],8,jl)])]))),128))])])):E("",!0),T.value.length>0?(a(),i("div",Pl,[e("h3",null,[C[26]||(C[26]=e("i",{class:"mdi mdi-alert"},null,-1)),S(" Untracked Commands ("+g(T.value.length)+") ",1)]),C[29]||(C[29]=e("p",{class:"untracked-info"}," These commands exist in Broadlink storage but are not tracked in this device. ",-1)),e("div",Ul,[(a(!0),i(me,null,ge(T.value,F=>(a(),i("div",{key:F,class:"command-item untracked"},[e("span",Fl,g(F),1),C[27]||(C[27]=e("span",{class:"untracked-badge"},"Not tracked",-1))]))),128))]),e("button",{type:"button",onClick:H,class:"btn btn-secondary"},[...C[28]||(C[28]=[e("i",{class:"mdi mdi-import"},null,-1),S(" Import All Untracked Commands ",-1)])])])):E("",!0)]),e("div",Nl,[e("button",{type:"button",onClick:C[5]||(C[5]=F=>M.$emit("cancel")),class:"btn btn-secondary",disabled:A.value}," Close ",8,Bl)])]),ce(Te,{isOpen:U.value,title:"Delete Command?",message:`Delete command '${j.value}'? This will remove it from Broadlink storage.`,confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,onConfirm:k,onCancel:d},null,8,["isOpen","message"]),ce(Te,{isOpen:O.value,title:"Import Commands?",message:`Import ${T.value.length} untracked command${T.value.length>1?"s":""} into this device?`,confirmText:"Import",cancelText:"Cancel",onConfirm:I,onCancel:C[6]||(C[6]=F=>O.value=!1)},null,8,["isOpen","message"])]))}},ql=pe(Hl,[["__scopeId","data-v-aeb4d51b"]]),zl={class:"modal-container error-dialog"},Jl={class:"modal-header"},Wl={class:"modal-body"},Gl={class:"error-message"},Kl={key:0,class:"error-suggestion"},Xl=["open"],Yl={class:"debug-content"},Zl={class:"debug-info"},Ql={key:0,class:"debug-section-title"},en={key:1},tn={__name:"ErrorDialog",props:{isOpen:{type:Boolean,default:!1},title:{type:String,default:"Error"},message:{type:String,required:!0},suggestion:{type:String,default:""},details:{type:String,default:""},error:{type:Object,default:null},context:{type:Object,default:()=>({})}},emits:["close"],setup(l,{emit:v}){const s=l,y=v,r=ke("toast"),f=w(!1),b=()=>{y("close")},t=W(()=>{var T,U,j,O,_,$,u,N,Z,le,te;const h=new Date().toISOString(),o=s.error||{};return{error:JSON.stringify({message:s.message,title:s.title,details:s.details,errorObject:o.message||o.toString(),timestamp:h},null,2),request:JSON.stringify({method:((U=(T=o.config)==null?void 0:T.method)==null?void 0:U.toUpperCase())||"N/A",url:((j=o.config)==null?void 0:j.url)||"N/A",baseURL:((O=o.config)==null?void 0:O.baseURL)||"N/A",headers:((_=o.config)==null?void 0:_.headers)||{},data:($=o.config)!=null&&$.data?JSON.parse(o.config.data):"N/A",params:((u=o.config)==null?void 0:u.params)||{}},null,2),response:JSON.stringify({status:((N=o.response)==null?void 0:N.status)||"N/A",statusText:((Z=o.response)==null?void 0:Z.statusText)||"N/A",data:((le=o.response)==null?void 0:le.data)||"N/A",headers:((te=o.response)==null?void 0:te.headers)||{}},null,2),browser:JSON.stringify({userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language,cookieEnabled:navigator.cookieEnabled,onLine:navigator.onLine,viewport:`${window.innerWidth}x${window.innerHeight}`,screenResolution:`${window.screen.width}x${window.screen.height}`,colorDepth:window.screen.colorDepth,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,timestamp:h},null,2),appState:JSON.stringify({currentRoute:window.location.pathname,currentURL:window.location.href,referrer:document.referrer||"N/A",context:s.context||{},localStorage:{smartir_simulate:localStorage.getItem("smartir_simulate_not_installed"),theme:localStorage.getItem("theme")}},null,2),stackTrace:o.stack||null}}),c=async()=>{const h=L();try{await navigator.clipboard.writeText(h),r==null||r.success("Debug information copied to clipboard","âœ… Copied")}catch(o){console.error("Failed to copy:",o),r==null||r.error("Failed to copy to clipboard","âŒ Copy Failed")}},A=()=>{const h=L(),o=new Blob([h],{type:"text/plain"}),T=URL.createObjectURL(o),U=document.createElement("a");U.href=T;const j=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5);U.download=`broadlink-manager-error-${j}.txt`,document.body.appendChild(U),U.click(),document.body.removeChild(U),URL.revokeObjectURL(T),r==null||r.success("Debug report downloaded","âœ… Downloaded")},L=()=>`Broadlink Manager - Error Report
${"=".repeat(60)}

Generated: ${new Date().toISOString()}
Title: ${s.title}
Message: ${s.message}
${s.suggestion?`Suggestion: ${s.suggestion}
`:""}
${"=".repeat(60)}

ERROR DETAILS
${"-".repeat(60)}
${t.value.error}

REQUEST INFORMATION
${"-".repeat(60)}
${t.value.request}

RESPONSE INFORMATION
${"-".repeat(60)}
${t.value.response}

BROWSER INFORMATION
${"-".repeat(60)}
${t.value.browser}

APPLICATION STATE
${"-".repeat(60)}
${t.value.appState}

${t.value.stackTrace?`STACK TRACE
${"-".repeat(60)}
${t.value.stackTrace}

`:""}
${"=".repeat(60)}
End of Report
`;return ue(()=>s.isOpen,h=>{if(h){const o=T=>{T.key==="Escape"&&b()};return document.addEventListener("keydown",o),()=>document.removeEventListener("keydown",o)}}),(h,o)=>(a(),xe(We,{to:"body"},[ce(ze,{name:"modal"},{default:Pe(()=>[l.isOpen?(a(),i("div",{key:0,class:"modal-overlay",onClick:de(b,["self"])},[e("div",zl,[e("div",Jl,[o[2]||(o[2]=e("div",{class:"header-icon error-icon"},[e("i",{class:"mdi mdi-alert-circle"})],-1)),e("h3",null,g(l.title),1),e("button",{onClick:b,class:"close-button"},[...o[1]||(o[1]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Wl,[e("p",Gl,g(l.message),1),l.suggestion?(a(),i("p",Kl,[o[3]||(o[3]=e("i",{class:"mdi mdi-lightbulb-on"},null,-1)),S(" "+g(l.suggestion),1)])):E("",!0),e("details",{class:"debug-section",open:f.value},[e("summary",{onClick:o[0]||(o[0]=T=>f.value=!f.value)},[e("i",{class:Q(["mdi",f.value?"mdi-chevron-down":"mdi-chevron-right"])},null,2),o[4]||(o[4]=S(" Debug Information ",-1))]),e("div",Yl,[e("div",{class:"debug-actions"},[e("button",{onClick:c,class:"btn-debug btn-copy"},[...o[5]||(o[5]=[e("i",{class:"mdi mdi-content-copy"},null,-1),S(" Copy to Clipboard ",-1)])]),e("button",{onClick:A,class:"btn-debug btn-download"},[...o[6]||(o[6]=[e("i",{class:"mdi mdi-download"},null,-1),S(" Download Report ",-1)])])]),e("div",Zl,[o[7]||(o[7]=e("div",{class:"debug-section-title"},"Error Details",-1)),e("pre",null,g(t.value.error),1),o[8]||(o[8]=e("div",{class:"debug-section-title"},"Request Information",-1)),e("pre",null,g(t.value.request),1),o[9]||(o[9]=e("div",{class:"debug-section-title"},"Response Information",-1)),e("pre",null,g(t.value.response),1),o[10]||(o[10]=e("div",{class:"debug-section-title"},"Browser Information",-1)),e("pre",null,g(t.value.browser),1),o[11]||(o[11]=e("div",{class:"debug-section-title"},"Application State",-1)),e("pre",null,g(t.value.appState),1),t.value.stackTrace?(a(),i("div",Ql,"Stack Trace")):E("",!0),t.value.stackTrace?(a(),i("pre",en,g(t.value.stackTrace),1)):E("",!0)])])],8,Xl)]),e("div",{class:"modal-footer"},[e("button",{onClick:b,class:"btn btn-primary"}," OK ")])])])):E("",!0)]),_:1})]))}},on=pe(tn,[["__scopeId","data-v-23858149"]]),ln={key:0,class:"discovery-banner"},nn={class:"banner-content"},sn={class:"banner-text"},an={class:"modal-dialog"},rn={class:"modal-header"},dn={class:"modal-body"},un={class:"device-list"},cn={class:"device-info"},mn={class:"device-details"},vn={class:"command-count"},pn={class:"device-actions"},fn=["onClick"],gn=["onClick"],yn={class:"modal-footer"},bn={class:"modal-dialog modal-dialog-small"},hn={class:"modal-header"},kn={class:"modal-body"},wn={class:"warning-message"},$n={class:"modal-footer"},Cn=["disabled"],Sn=["disabled"],_n={__name:"DeviceDiscovery",emits:["adopt"],setup(l,{expose:v,emit:s}){const y=Ee(),r=s,f=w([]),b=w(!1),t=w(!1),c=w(null),A=w(!1),L=W(()=>f.value.length>0);Se(async()=>{await h()});const h=async()=>{try{const j=await ae.get("/api/devices/discover");f.value=j.data.untracked_devices||[]}catch(j){console.error("Error loading untracked devices:",j),f.value=[]}},o=j=>{b.value=!1,r("adopt",j)},T=j=>{c.value=j,t.value=!0},U=async()=>{if(c.value){A.value=!0;try{const j=await ae.delete(`/api/devices/untracked/${encodeURIComponent(c.value.device_name)}`);if(j.data.success)f.value=f.value.filter(O=>O.device_name!==c.value.device_name),t.value=!1,c.value=null,console.log("Device deleted successfully");else throw new Error(j.data.error||"Failed to delete device")}catch(j){console.error("Error deleting device:",j),y.error(`Failed to delete device: ${j.message}`)}finally{A.value=!1}}};return v({refresh:h}),(j,O)=>{var _,$,u;return L.value?(a(),i("div",ln,[e("div",nn,[O[9]||(O[9]=e("div",{class:"banner-icon"},[e("i",{class:"mdi mdi-radar"})],-1)),e("div",sn,[O[7]||(O[7]=e("h3",null,"Untracked Devices Found",-1)),e("p",null,g(f.value.length)+" device"+g(f.value.length>1?"s":"")+" with learned commands found in Broadlink storage",1)]),e("button",{onClick:O[0]||(O[0]=N=>b.value=!0),class:"btn btn-primary"},[...O[8]||(O[8]=[e("i",{class:"mdi mdi-eye"},null,-1),S(" View Devices ",-1)])])]),b.value?(a(),i("div",{key:0,class:"modal-overlay",onClick:O[3]||(O[3]=de(N=>b.value=!1,["self"]))},[e("div",an,[e("div",rn,[O[11]||(O[11]=e("h2",null,"Discovered Devices",-1)),e("button",{onClick:O[1]||(O[1]=N=>b.value=!1),class:"close-btn"},[...O[10]||(O[10]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",dn,[O[16]||(O[16]=e("p",{class:"info-text"}," These devices have learned commands in Broadlink storage but are not being tracked. Adopt them to manage their commands and generate Home Assistant entities. ",-1)),e("div",un,[(a(!0),i(me,null,ge(f.value,N=>(a(),i("div",{key:N.device_name,class:"discovered-device"},[e("div",cn,[O[13]||(O[13]=e("div",{class:"device-icon"},[e("i",{class:"mdi mdi-devices"})],-1)),e("div",mn,[e("h4",null,g(N.device_name),1),e("span",vn,[O[12]||(O[12]=e("i",{class:"mdi mdi-remote"},null,-1)),S(" "+g(N.command_count)+" command"+g(N.command_count>1?"s":""),1)])])]),e("div",pn,[e("button",{onClick:Z=>o(N),class:"btn btn-primary"},[...O[14]||(O[14]=[e("i",{class:"mdi mdi-plus"},null,-1),S(" Adopt ",-1)])],8,fn),e("button",{onClick:Z=>T(N),class:"btn btn-danger",title:"Delete all commands"},[...O[15]||(O[15]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,gn)])]))),128))])]),e("div",yn,[e("button",{onClick:O[2]||(O[2]=N=>b.value=!1),class:"btn btn-secondary"}," Close ")])])])):E("",!0),t.value?(a(),i("div",{key:1,class:"modal-overlay",onClick:O[6]||(O[6]=de(N=>t.value=!1,["self"]))},[e("div",bn,[e("div",hn,[O[18]||(O[18]=e("h2",null,"Delete Untracked Device",-1)),e("button",{onClick:O[4]||(O[4]=N=>t.value=!1),class:"close-btn"},[...O[17]||(O[17]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",kn,[e("div",wn,[O[20]||(O[20]=e("i",{class:"mdi mdi-alert"},null,-1)),e("div",null,[e("p",null,[e("strong",null,'Are you sure you want to delete "'+g((_=c.value)==null?void 0:_.device_name)+'"?',1)]),e("p",null,"This will permanently delete all "+g(($=c.value)==null?void 0:$.command_count)+" command"+g(((u=c.value)==null?void 0:u.command_count)>1?"s":"")+" from Broadlink storage.",1),O[19]||(O[19]=e("p",{class:"warning-text"},"This action cannot be undone.",-1))])])]),e("div",$n,[e("button",{onClick:O[5]||(O[5]=N=>t.value=!1),class:"btn btn-secondary",disabled:A.value}," Cancel ",8,Cn),e("button",{onClick:U,class:"btn btn-danger",disabled:A.value},[e("i",{class:Q(["mdi",A.value?"mdi-loading mdi-spin":"mdi-delete"])},null,2),S(" "+g(A.value?"Deleting...":"Delete"),1)],8,Sn)])])])):E("",!0)])):E("",!0)}}},In=pe(_n,[["__scopeId","data-v-24463050"]]),Dn={class:"device-list-card"},xn={class:"card-header"},Tn={class:"header-badges"},Rn={class:"header-info"},An={class:"header-right"},Ln=["disabled"],On=["disabled"],Mn={class:"card-body"},En={key:0,class:"filter-bar"},Vn={class:"filter-row filter-row-search"},jn={class:"filter-group filter-search"},Pn={class:"filter-row filter-row-dropdowns"},Un={class:"filter-group"},Fn=["value"],Nn={class:"filter-group"},Bn=["value"],Hn={class:"filter-group"},qn={key:0,class:"filter-group filter-toggle"},zn={class:"toggle-label"},Jn={class:"filter-results"},Wn={key:1,class:"loading-state"},Gn={key:2,class:"error-state"},Kn={key:3,class:"empty-state"},Xn={key:4,class:"device-grid"},Yn={key:5,class:"no-results"},Zn={__name:"DeviceList",setup(l){const v=st(),s=Ee(),y=w(!1),r=w(!1),f=w(null),b=w(!1),t=w(null),c=w(null),A=w(!0),L=w(!1),h=w(!1),o=()=>{A.value=!A.value},T=w(!1),U=w({title:"Error",message:"",suggestion:"",details:"",error:null,context:{}}),j=w(!1),O=w({success:!1,title:"",message:""}),_=w({search:"",broadlinkDevice:"",area:"",entityType:"",showSmartIROnly:!1}),$=w([]),u=ke("smartirStatus"),N=ke("smartirEnabled"),Z=W(()=>{var p;return localStorage.getItem("smartir_simulate_not_installed")==="true"?!1:((p=u==null?void 0:u.value)==null?void 0:p.installed)||!1}),le=W(()=>{const m=new Map;return v.devices.forEach(p=>{if(p.broadlink_entity){const R=$.value.find(B=>B.entity_id===p.broadlink_entity),V=R&&R.name||p.broadlink_entity;m.set(p.broadlink_entity,{entity_id:p.broadlink_entity,friendly_name:V})}}),Array.from(m.values()).sort((p,R)=>p.friendly_name.localeCompare(R.friendly_name))}),te=W(()=>{const m=new Set;return v.devices.forEach(p=>{p.area&&m.add(p.area)}),Array.from(m).sort()}),fe=W(()=>{let m=v.devices;if(_.value.search){const R=_.value.search.toLowerCase();m=m.filter(V=>{var Y,K,J,re,Ie;if((Y=V.name)!=null&&Y.toLowerCase().includes(R)||(K=V.entity_type)!=null&&K.toLowerCase().includes(R)||(J=V.area)!=null&&J.toLowerCase().includes(R)||(re=V.id)!=null&&re.toLowerCase().includes(R)||Object.keys(V.commands||{}).some(Ae=>Ae.toLowerCase().includes(R)))return!0;const oe=$.value.find(Ae=>Ae.entity_id===V.broadlink_entity);return!!((Ie=oe==null?void 0:oe.name)!=null&&Ie.toLowerCase().includes(R))})}_.value.broadlinkDevice&&(m=m.filter(R=>R.broadlink_entity===_.value.broadlinkDevice||R.controller_device===_.value.broadlinkDevice)),_.value.area&&(m=m.filter(R=>R.area===_.value.area)),_.value.entityType&&(m=m.filter(R=>R.entity_type===_.value.entityType)),_.value.showSmartIROnly&&(m=m.filter(R=>R.device_type==="smartir"));const p=localStorage.getItem("smartir_simulate_not_installed")==="true";return(!(N!=null&&N.value)||p)&&(m=m.filter(R=>R.device_type!=="smartir")),m}),D=W(()=>_.value.search||_.value.broadlinkDevice||_.value.area||_.value.entityType||_.value.showSmartIROnly),P=()=>{_.value.search="",_.value.broadlinkDevice="",_.value.area="",_.value.entityType="",_.value.showSmartIROnly=!1},X=async()=>{try{const m=await ae.get("/api/remote/devices");$.value=m.data.devices||[]}catch(m){console.error("Error loading remote devices:",m)}};Se(async()=>{await Promise.all([v.loadDevices(),X()])});const ne=m=>{f.value=m,y.value=!0},ve=W(()=>{if(!t.value)return"";const m=Object.keys(t.value.commands||{}).length;return m===0?"This device has no commands. The device will be removed from tracking.":`This device has ${m} learned command${m>1?"s":""}. What would you like to do?`}),$e=W(()=>{if(!t.value)return"";const m=Object.keys(t.value.commands||{}).length;return m===0?"":`Also delete all ${m} command${m>1?"s":""} from Broadlink storage`}),G=m=>{t.value=m,b.value=!0},d=()=>{b.value=!1,t.value=null},k=async m=>{var R,V;const p=t.value;b.value=!1;try{await v.deleteDevice(p.id,m),c.value&&await c.value.refresh()}catch(B){const oe=((V=(R=B.response)==null?void 0:R.data)==null?void 0:V.error)||B.message||"Unknown error";C("Failed to Delete Device",oe)}finally{t.value=null}},z=async m=>{var p,R,V,B,oe;try{console.log("ğŸ’¾ Saving device data:",m),console.log("ğŸ’¾ Device commands:",m.commands),console.log("ğŸ’¾ Selected device:",f.value),(p=f.value)!=null&&p.id&&f.value.id!==null?await v.updateDevice(f.value.id,m):await v.createDevice(m),H(),c.value&&await c.value.refresh()}catch(Y){let K="Failed to save device",J="",re="";(V=(R=Y.response)==null?void 0:R.data)!=null&&V.error?(K=Y.response.data.error,J=Y.response.data.suggestion||""):Y.message&&(K=Y.message),Y.response&&(re=`Status: ${Y.response.status}
URL: ${((B=Y.config)==null?void 0:B.url)||"N/A"}`),C("Failed to Save Device",K,J,re,Y,{action:"save_device",deviceData:m,isEdit:!!((oe=f.value)!=null&&oe.id)})}},H=()=>{y.value=!1,f.value=null},I=m=>{f.value=m,r.value=!0},M=()=>{r.value=!1,f.value=null},C=(m,p,R="",V="",B=null,oe={})=>{U.value={title:m,message:p,suggestion:R,details:V,error:B,context:oe},T.value=!0},F=()=>{T.value=!1},ee=()=>{j.value=!1},ye=async m=>{if(m&&m.commands&&f.value){const p=v.devices.findIndex(R=>R.id===f.value.id);p!==-1&&(v.devices[p].commands=m.commands,console.log(`Optimistically updated device ${f.value.id} with new command: ${m.commandName}`))}v.loadDevices(),c.value&&c.value.refresh()},he=m=>{const p=m.split("_"),R=[];for(let V=0;V<p.length;V++){const B=p[V],oe=p[V+1];B&&oe==="s"&&p[V+2]?(R.push(B.charAt(0).toUpperCase()+B.slice(1)+"'s"),V++):B!=="s"&&R.push(B.charAt(0).toUpperCase()+B.slice(1))}return R.join(" ")},_e=(m,p)=>{const R=m.toLowerCase(),V=p.map(K=>K.toLowerCase());return R.includes("lamp")||R.includes("light")?"light":R.includes("fan")?"fan":R.includes("tv")||R.includes("stereo")||R.includes("speaker")||R.includes("receiver")?"media_player":R.includes("blind")||R.includes("curtain")||R.includes("shade")||R.includes("garage")?"cover":V.some(K=>K.includes("volume")||K.includes("channel")||K.includes("play")||K.includes("pause")||K.includes("mute"))?"media_player":V.some(K=>K.includes("fan_speed")||K.includes("fan_low")||K.includes("fan_high"))?"fan":V.some(K=>K.includes("open")||K.includes("close")||K.includes("stop"))?"cover":"switch"},De=(m,p)=>{const R=m.toLowerCase();return R.includes("tv")?"mdi:television":R.includes("stereo")||R.includes("receiver")||R.includes("speaker")?"mdi:speaker":R.includes("lamp")?"mdi:lamp":R.includes("light")?"mdi:lightbulb":R.includes("fan")?"mdi:fan":R.includes("blind")?"mdi:blinds":R.includes("curtain")?"mdi:curtains":R.includes("garage")?"mdi:garage":{light:"mdi:lightbulb",fan:"mdi:fan",switch:"mdi:light-switch",media_player:"mdi:speaker",cover:"mdi:window-shutter"}[p]||"mdi:devices"},Re=m=>{const p=m.toLowerCase().split("_");for(let B=0;B<p.length-2;B++)if(p[B+1]==="s"){const oe=p.slice(B,B+3),Y=he(oe.join("_"));return console.log("Detected possessive area:",Y,"from",m),Y}const R=[["living","room"],["dining","room"],["master","bedroom"],["guest","bedroom"],["family","room"],["laundry","room"],["home","office"]];for(let B=0;B<p.length-1;B++){const oe=[p[B],p[B+1]],Y=R.find(K=>K[0]===oe[0]&&K[1]===oe[1]);if(Y)return he(Y.join("_"))}const V=["kitchen","bedroom","bathroom","garage","office","basement","attic","hallway","entryway","patio","deck","yard","garden"];for(const B of p)if(V.includes(B))return B.charAt(0).toUpperCase()+B.slice(1);return""},ie=async m=>{const p=he(m.device_name),R=Re(m.device_name),V=_e(m.device_name,m.commands),B=De(m.device_name,V);let oe="";try{console.log("Finding Broadlink owner for:",m.device_name);const K=await ae.post("/api/devices/find-broadlink-owner",{device_name:m.device_name});console.log("Broadlink owner response:",K.data),oe=K.data.broadlink_entity||"",console.log("Detected Broadlink entity:",oe)}catch(K){console.error("Error finding Broadlink owner:",K)}f.value={id:null,device:m.device_name,name:p,entity_type:V,commands:{},area:R,icon:B,broadlink_entity:oe,enabled:!0};const Y={};m.commands.forEach(K=>{Y[K]=K}),f.value.commands=Y,y.value=!0},x=async()=>{h.value=!0;try{await v.syncAllAreas(),s.success("Areas synced from Home Assistant")}catch(m){console.error("Error syncing areas:",m),s.error("Failed to sync areas")}finally{h.value=!1}},n=async()=>{var m,p;L.value=!0;try{const R=await ae.post("/api/entities/generate",{});if(R.data.success){const V=R.data.broadlink_count||0,B=R.data.smartir_count||0,oe=R.data.total_count||0,Y=R.data.errors||[];let K="âœ… Entity Generation Successful",J=[];const re=[];V>0&&re.push(`${V} Broadlink native`),B>0&&re.push(`${B} SmartIR`),re.length>0&&J.push(`Generated ${re.join(" and ")} entity configuration${oe!==1?"s":""}.`),V>0&&(J.push(`
ğŸ“ Broadlink entities created in:`),J.push("  â€¢ broadlink_manager/entities.yaml"),J.push("  â€¢ broadlink_manager/helpers.yaml")),B>0&&(J.push(`
ğŸ“ SmartIR entities created in:`),J.push("  â€¢ smartir/climate.yaml"),J.push("  â€¢ smartir/media_player.yaml"),J.push("  â€¢ smartir/fan.yaml")),J.push(`
ğŸ“ Next steps:`),J.push("1. Check your configuration.yaml includes the generated files"),J.push("2. Restart Home Assistant to load the new entities"),Y.length>0&&(K="âš ï¸ Entity Generation Completed with Errors",J.push(`
âš ï¸ ${Y.length} error${Y.length!==1?"s":""} occurred:`),Y.forEach(Ie=>{J.push(`  â€¢ ${Ie}`)})),O.value={success:!0,title:K,message:J.join(`
`)},j.value=!0}else O.value={success:!1,title:"âŒ Entity Generation Failed",message:R.data.message||`Failed to generate entities.

Please check that you have at least one device configured.`},j.value=!0}catch(R){console.error("Error generating entities:",R);const V=((p=(m=R.response)==null?void 0:m.data)==null?void 0:p.error)||R.message||"Unknown error occurred";O.value={success:!1,title:"âŒ Entity Generation Error",message:`Failed to generate entities:

${V}

Please check the logs for more details.`},j.value=!0}finally{L.value=!1}};return(m,p)=>{var R;return a(),i("div",Dn,[e("div",xn,[e("button",{class:"icon-button chevron-button",onClick:o},[e("i",{class:Q(["mdi",A.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2)]),e("div",{class:"header-left",onClick:o},[p[8]||(p[8]=e("div",{class:"header-icon"},[e("i",{class:"mdi mdi-devices"})],-1)),p[9]||(p[9]=e("h3",null,"Managed Devices",-1)),e("div",Tn,[e("span",Rn,g(be(v).deviceCount)+" devices",1)])]),e("div",An,[A.value?(a(),i("button",{key:0,onClick:de(x,["stop"]),class:"btn btn-secondary",disabled:h.value,title:"Sync all areas from Home Assistant"},[e("i",{class:Q(["mdi",h.value?"mdi-loading mdi-spin":"mdi-refresh"])},null,2),S(" "+g(h.value?"Syncing...":"Sync Areas"),1)],8,Ln)):E("",!0),A.value?(a(),i("button",{key:1,onClick:de(n,["stop"]),class:"btn btn-secondary",disabled:L.value},[e("i",{class:Q(["mdi",L.value?"mdi-loading mdi-spin":"mdi-file-code"])},null,2),S(" "+g(L.value?"Generating...":"Generate Entities"),1)],8,On)):E("",!0),A.value?(a(),i("button",{key:2,onClick:p[0]||(p[0]=de(V=>y.value=!0,["stop"])),class:"btn btn-primary"},[...p[10]||(p[10]=[e("i",{class:"mdi mdi-plus"},null,-1),S(" Add Device ",-1)])])):E("",!0)])]),q(e("div",Mn,[ce(In,{ref_key:"discoveryRef",ref:c,onAdopt:ie},null,512),be(v).hasDevices?(a(),i("div",En,[e("div",Vn,[e("div",jn,[e("label",null,[p[11]||(p[11]=e("i",{class:"mdi mdi-magnify"},null,-1)),q(e("input",{"onUpdate:modelValue":p[1]||(p[1]=V=>_.value.search=V),type:"text",placeholder:"Search devices, commands...",class:"search-input"},null,512),[[we,_.value.search]])])])]),e("div",Pn,[e("div",Un,[e("label",null,[p[13]||(p[13]=e("i",{class:"mdi mdi-access-point"},null,-1)),q(e("select",{"onUpdate:modelValue":p[2]||(p[2]=V=>_.value.broadlinkDevice=V)},[p[12]||(p[12]=e("option",{value:""},"All Controller Devices",-1)),(a(!0),i(me,null,ge(le.value,V=>(a(),i("option",{key:V.entity_id,value:V.entity_id},g(V.friendly_name),9,Fn))),128))],512),[[Ce,_.value.broadlinkDevice]])])]),e("div",Nn,[e("label",null,[p[15]||(p[15]=e("i",{class:"mdi mdi-home-map-marker"},null,-1)),q(e("select",{"onUpdate:modelValue":p[3]||(p[3]=V=>_.value.area=V)},[p[14]||(p[14]=e("option",{value:""},"All Areas",-1)),(a(!0),i(me,null,ge(te.value,V=>(a(),i("option",{key:V,value:V},g(V),9,Bn))),128))],512),[[Ce,_.value.area]])])]),e("div",Hn,[e("label",null,[p[17]||(p[17]=e("i",{class:"mdi mdi-shape"},null,-1)),q(e("select",{"onUpdate:modelValue":p[4]||(p[4]=V=>_.value.entityType=V)},[...p[16]||(p[16]=[Le('<option value="" data-v-9e2ead7d>All Types</option><option value="light" data-v-9e2ead7d>Light</option><option value="fan" data-v-9e2ead7d>Fan</option><option value="switch" data-v-9e2ead7d>Switch</option><option value="media_player" data-v-9e2ead7d>Media Player</option><option value="cover" data-v-9e2ead7d>Cover</option><option value="climate" data-v-9e2ead7d>Climate</option>',7)])],512),[[Ce,_.value.entityType]])])]),Z.value?(a(),i("div",qn,[e("label",zn,[p[18]||(p[18]=e("span",{class:"toggle-text"},[e("img",{src:Ue,alt:"SmartIR",class:"smartir-icon"}),S(" SmartIR Only ")],-1)),q(e("input",{type:"checkbox","onUpdate:modelValue":p[5]||(p[5]=V=>_.value.showSmartIROnly=V),class:"toggle-checkbox"},null,512),[[se,_.value.showSmartIROnly]]),p[19]||(p[19]=e("span",{class:"toggle-slider"},null,-1))])])):E("",!0),D.value?(a(),i("button",{key:1,onClick:P,class:"btn-clear-filters"},[...p[20]||(p[20]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),S(" Clear ",-1)])])):E("",!0),e("div",Jn,g(fe.value.length)+" of "+g(be(v).deviceCount),1)])])):E("",!0),be(v).loading?(a(),i("div",Wn,[...p[21]||(p[21]=[e("i",{class:"mdi mdi-loading mdi-spin"},null,-1),e("p",null,"Loading devices...",-1)])])):be(v).error?(a(),i("div",Gn,[p[22]||(p[22]=e("i",{class:"mdi mdi-alert-circle"},null,-1)),e("p",null,g(be(v).error),1),e("button",{onClick:p[6]||(p[6]=V=>be(v).loadDevices()),class:"btn btn-secondary"}," Retry ")])):be(v).hasDevices?(a(),i("div",Xn,[(a(!0),i(me,null,ge(fe.value,V=>(a(),xe(Dt,{key:V.id,device:V,"broadlink-devices":$.value,onEdit:ne,onDelete:G,onLearn:I},null,8,["device","broadlink-devices"]))),128))])):(a(),i("div",Kn,[p[24]||(p[24]=e("i",{class:"mdi mdi-devices"},null,-1)),p[25]||(p[25]=e("h3",null,"No Devices Yet",-1)),p[26]||(p[26]=e("p",null,"Get started by adding your first managed device",-1)),e("button",{onClick:p[7]||(p[7]=V=>y.value=!0),class:"btn btn-primary"},[...p[23]||(p[23]=[e("i",{class:"mdi mdi-plus"},null,-1),S(" Add Your First Device ",-1)])])])),be(v).hasDevices&&fe.value.length===0?(a(),i("div",Yn,[...p[27]||(p[27]=[e("i",{class:"mdi mdi-filter-off"},null,-1),e("h3",null,"No devices match your filters",-1),e("p",null,"Try adjusting your search or filter criteria",-1)])])):E("",!0)],512),[[Ge,A.value]]),y.value?(a(),xe(Qo,{key:0,device:f.value,onSave:z,onCancel:H},null,8,["device"])):E("",!0),r.value?(a(),xe(ql,{key:1,device:f.value,onLearned:ye,onCancel:M},null,8,["device"])):E("",!0),ce(Te,{isOpen:b.value,title:`Delete ${(R=t.value)==null?void 0:R.name}?`,message:ve.value,confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,checkboxLabel:$e.value,onConfirm:k,onCancel:d},null,8,["isOpen","title","message","checkboxLabel"]),ce(on,{isOpen:T.value,title:U.value.title,message:U.value.message,suggestion:U.value.suggestion,details:U.value.details,error:U.value.error,context:U.value.context,onClose:F},null,8,["isOpen","title","message","suggestion","details","error","context"]),ce(Te,{isOpen:j.value,title:O.value.title,message:O.value.message,confirmText:"OK",showCancel:!1,dangerMode:!O.value.success,onConfirm:ee,onCancel:ee},null,8,["isOpen","title","message","dangerMode"])])}}},Qn=pe(Zn,[["__scopeId","data-v-9e2ead7d"]]),es={class:"banner-content"},ts={class:"banner-icon"},os={class:"banner-message"},ls={class:"banner-actions"},ns={__name:"SmartIRBanner",setup(l){const v=ke("smartirStatus"),s=w(!1),y=W(()=>!(!v.value||s.value||localStorage.getItem("smartir_banner_dismissed")==="true")),r=W(()=>{var L;return(L=v.value)!=null&&L.installed?"banner-success":"banner-info"}),f=W(()=>{var L;return(L=v.value)!=null&&L.installed?"mdi mdi-check-circle":"mdi mdi-information"}),b=W(()=>{var L;return(L=v.value)!=null&&L.installed?`SmartIR Detected (v${v.value.version})`:"Want Climate Device Support?"}),t=W(()=>{var L;return(L=v.value)!=null&&L.installed?"You can now create climate device profiles with full temperature and HVAC mode control.":"Install SmartIR to unlock AC/heater control with temperature settings, HVAC modes, and 120+ pre-configured device profiles."});function c(){window.open("https://github.com/smartHomeHub/SmartIR","_blank")}function A(){var L;if(s.value=!0,(L=v.value)!=null&&L.installed)localStorage.setItem("smartir_banner_dismissed","true");else{const h=parseInt(localStorage.getItem("smartir_banner_dismiss_count")||"0");h>=2?localStorage.setItem("smartir_banner_dismissed","true"):localStorage.setItem("smartir_banner_dismiss_count",String(h+1))}}return Se(()=>{var o;const L=localStorage.getItem("smartir_last_status"),h=(o=v.value)!=null&&o.installed?"installed":"not_installed";L!==h&&(localStorage.removeItem("smartir_banner_dismissed"),localStorage.removeItem("smartir_banner_dismiss_count"),localStorage.setItem("smartir_last_status",h))}),(L,h)=>{var o,T;return y.value?(a(),i("div",{key:0,class:Q(["smartir-banner",r.value])},[e("div",es,[e("div",ts,[e("i",{class:Q(f.value)},null,2)]),e("div",os,[e("strong",null,g(b.value),1),e("p",null,g(t.value),1)]),e("div",ls,[(o=L.status)!=null&&o.installed?E("",!0):(a(),i("button",{key:0,onClick:c,class:"btn-primary"}," Learn More ")),e("button",{onClick:A,class:"btn-text"},g((T=L.status)!=null&&T.installed?"Got it":"Dismiss"),1)])])],2)):E("",!0)}}},ss=pe(ns,[["__scopeId","data-v-7bbcbcd7"]]),Oe="api/smartir",Xe={async getStatus(){try{const l=await fetch(`${Oe}/status`);if(!l.ok)throw new Error(`HTTP error! status: ${l.status}`);return await l.json()}catch(l){return console.error("Error fetching SmartIR status:",l),{installed:!1,version:null,error:l.message}}},async getInstallInstructions(){try{const l=await fetch(`${Oe}/install-instructions`);if(!l.ok)throw new Error(`HTTP error! status: ${l.status}`);return await l.json()}catch(l){throw console.error("Error fetching install instructions:",l),l}},async getPlatforms(){try{const l=await fetch(`${Oe}/platforms`);if(!l.ok)throw new Error(`HTTP error! status: ${l.status}`);return await l.json()}catch(l){throw console.error("Error fetching platforms:",l),l}},async getPlatformCodes(l){try{const v=await fetch(`${Oe}/platforms/${l}/codes`);if(!v.ok)throw new Error(`HTTP error! status: ${v.status}`);return await v.json()}catch(v){throw console.error(`Error fetching codes for ${l}:`,v),v}},async getNextCode(l){try{const v=await fetch(`${Oe}/platforms/${l}/next-code`);if(!v.ok)throw new Error(`HTTP error! status: ${v.status}`);return await v.json()}catch(v){throw console.error(`Error fetching next code for ${l}:`,v),v}},async validateCode(l,v){try{const s=await fetch(`${Oe}/validate-code`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({platform:l,code:v})});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);return await s.json()}catch(s){throw console.error("Error validating code:",s),s}}},as={class:"profile-card"},is={class:"profile-card-header"},rs=["title"],ds={class:"profile-details"},us=["title"],cs={class:"profile-meta"},ms=["title"],vs=["title"],ps=["title"],fs={class:"profile-card-footer"},gs=["title"],ys={key:0,class:"learned-indicator"},bs={class:"profile-actions"},hs={__name:"SmartIRProfileCard",props:{profile:{type:Object,required:!0}},emits:["edit","download","delete","commands"],setup(l){const v=l,s=Ke(W(()=>v.profile.platform)),y=b=>b.replace(/_/g," ").replace(/\b\w/g,t=>t.toUpperCase()),r=b=>b&&b.startsWith("mdi:")?`mdi ${b.replace(":"," mdi-")}`:`mdi mdi-${b}`,f=b=>{if(!b)return"";const t=b.toLowerCase();return t.includes("broadlink")?"broadlink-tag":t.includes("not set")?"not-set-tag":"default-controller-tag"};return(b,t)=>(a(),i("div",as,[e("div",is,[e("div",{class:Q(["profile-icon",be(s).colorClass.value]),title:y(l.profile.platform)},[e("i",{class:Q(r(be(s).icon.value))},null,2)],10,rs),e("div",ds,[e("h4",{title:`${l.profile.manufacturer} ${l.profile.model}`},g(l.profile.manufacturer)+" "+g(l.profile.model),9,us),e("div",cs,[e("span",{class:"tag platform-tag",title:y(l.profile.platform)},g(y(l.profile.platform)),9,ms),l.profile.controllerBrand?(a(),i("span",{key:0,class:Q(["tag controller-tag",f(l.profile.controllerBrand)]),title:"Controller: "+l.profile.controllerBrand},[t[4]||(t[4]=e("i",{class:"mdi mdi-remote-tv"},null,-1)),S(" "+g(l.profile.controllerBrand),1)],10,vs)):E("",!0)])]),e("div",{class:"code-badge",title:"Device Code: "+l.profile.code},g(l.profile.code),9,ps)]),e("div",fs,[e("div",{class:"command-info",title:l.profile.commandCount+" total commands"+(l.profile.learnedCount>0?", "+l.profile.learnedCount+" learned":"")},[t[5]||(t[5]=e("i",{class:"mdi mdi-remote"},null,-1)),e("span",null,g(l.profile.commandCount)+" command"+g(l.profile.commandCount!==1?"s":""),1),l.profile.learnedCount>0?(a(),i("span",ys,"( "+g(l.profile.learnedCount)+" learned )",1)):E("",!0)],8,gs),e("div",bs,[e("button",{onClick:t[0]||(t[0]=c=>b.$emit("commands")),class:"action-btn",title:"Commands"},[...t[6]||(t[6]=[e("i",{class:"mdi mdi-remote-tv"},null,-1)])]),e("button",{onClick:t[1]||(t[1]=c=>b.$emit("edit")),class:"action-btn",title:"Edit Profile"},[...t[7]||(t[7]=[e("i",{class:"mdi mdi-pencil"},null,-1)])]),e("button",{onClick:t[2]||(t[2]=c=>b.$emit("download")),class:"action-btn",title:"Download JSON"},[...t[8]||(t[8]=[e("i",{class:"mdi mdi-download"},null,-1)])]),e("button",{onClick:t[3]||(t[3]=c=>b.$emit("delete")),class:"action-btn delete",title:"Delete Profile"},[...t[9]||(t[9]=[e("i",{class:"mdi mdi-delete"},null,-1)])])])])]))}},ks=pe(hs,[["__scopeId","data-v-b5189587"]]),ws={class:"smartir-status-card"},$s={class:"card-header"},Cs=["src"],Ss={class:"header-badges"},_s=["title"],Is={class:"header-info"},Ds={class:"header-info"},xs={class:"header-info"},Ts={class:"header-right"},Rs={key:0,class:"card-body loading-state"},As={key:1,class:"card-body error-state"},Ls={key:2,class:"card-body installed-state"},Os={key:0,class:"help-panel"},Ms={key:0,class:"recommendation"},Es={key:0,class:"next-steps"},Vs={key:1,class:"filter-bar"},js={class:"filter-row"},Ps={class:"filter-group filter-search"},Us={class:"filter-group"},Fs={class:"filter-results"},Ns={key:2,class:"loading-state"},Bs={key:3,class:"empty-state"},Hs={key:4,class:"profiles-grid"},qs={key:5,class:"no-results"},zs={key:3,class:"card-body not-installed-state"},Js={class:"benefits-section"},Ws={class:"benefits-list"},Gs={class:"recommendation"},Ks={__name:"SmartIRStatusCard",emits:["create-profile","show-install-guide","edit-profile"],setup(l,{expose:v,emit:s}){const y=s,r=ke("smartirStatus");ke("smartirEnabled");const f=ke("refreshSmartIR"),b=w(!1),t=w(null),c=w((r==null?void 0:r.value)||null),A=w(localStorage.getItem("smartir_simulate_not_installed")==="true"),L=w(!1),h=w(!0),o=w([]),T=w(!1),U=w({search:"",platform:""}),j=w({show:!1,title:"",message:"",platform:null,profile:null}),O=["Full climate entity support (AC, heaters)","120+ pre-configured device profiles","Temperature and humidity sensor integration","HVAC mode control (heat, cool, auto, dry, fan)"],_=["climate","media_player","fan","light"],$=W(()=>A.value?{installed:!1,recommendation:{message:"Install SmartIR to unlock climate device support!",benefits:["Full climate entity support (AC, heaters)","120+ pre-configured device profiles","Temperature and humidity sensor integration","HVAC mode control (heat, cool, auto, dry, fan)"]}}:c.value),u=W(()=>{var H,I;return((I=(H=$.value)==null?void 0:H.platforms)==null?void 0:I.length)||0}),N=W(()=>{var H;return(H=$.value)!=null&&H.device_counts?Object.values($.value.device_counts).reduce((I,M)=>I+M,0):0});function Z(){var H;A.value=!A.value,localStorage.setItem("smartir_simulate_not_installed",A.value.toString()),!A.value&&((H=c.value)!=null&&H.installed)&&$e()}const le=W(()=>{let H=o.value;if(U.value.search){const I=U.value.search.toLowerCase();H=H.filter(M=>{var C,F,ee,ye;return((C=M.manufacturer)==null?void 0:C.toLowerCase().includes(I))||((F=M.model)==null?void 0:F.toLowerCase().includes(I))||((ee=M.code)==null?void 0:ee.toString().includes(I))||((ye=M.platform)==null?void 0:ye.toLowerCase().includes(I))})}return U.value.platform&&(H=H.filter(I=>I.platform===U.value.platform)),H}),te=W(()=>U.value.search||U.value.platform);function fe(){U.value.search="",U.value.platform=""}async function D(){b.value=!0,t.value=null;try{if(f)await f();else{const H=await Xe.getStatus();c.value=H}}catch(H){t.value=H.message||"Failed to refresh SmartIR status",console.error("Error refreshing SmartIR status:",H)}finally{b.value=!1}}function P(){y("create-profile")}function X(){y("show-install-guide")}function ne(){window.open("https://github.com/smartHomeHub/SmartIR","_blank")}function ve(){window.open("https://github.com/smartHomeHub/SmartIR","_blank")}async function $e(){T.value=!0;const H=[];try{for(const I of _)try{const M=await fetch(`api/smartir/platforms/${I}/profiles`);if(M.ok){const F=((await M.json()).profiles||[]).map(ee=>({...ee,platform:I}));H.push(...F)}}catch(M){console.error(`Error loading ${I} profiles:`,M)}o.value=H}finally{T.value=!1}}function G(H,I,M){y("edit-profile",{platform:H,profile:I,startStep:M})}async function d(H,I){var M,C;try{const F=await fetch(`api/smartir/platforms/${H}/profiles/${I.code}`);if(!F.ok)throw new Error("Failed to fetch profile");const ee=await F.json(),ye=JSON.stringify(ee.profile,null,2),he=new Blob([ye],{type:"application/json"}),_e=URL.createObjectURL(he),De=document.createElement("a");De.href=_e,De.download=`smartir_${H}_${I.manufacturer}_${I.model}_${I.code}.json`,document.body.appendChild(De),De.click(),document.body.removeChild(De),URL.revokeObjectURL(_e),(M=ke("toast").value)==null||M.success(`Downloaded ${I.manufacturer} ${I.model}`,"âœ… Profile Downloaded")}catch(F){console.error("Error downloading profile:",F),(C=ke("toast").value)==null||C.error("Failed to download profile","âŒ Download Error")}}function k(H,I){j.value={show:!0,title:`Delete ${I.manufacturer} ${I.model}?`,message:`Device Code: ${I.code}

This will remove the profile and update your configuration.`,platform:H,profile:I}}async function z(){var C,F,ee;const H=ke("toast"),{platform:I,profile:M}=j.value;j.value.show=!1;try{const ye=await fetch(`api/smartir/profiles/${M.code}`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({platform:I})});if(ye.ok)await $e(),await Je(),await D(),(C=H.value)==null||C.success(`${M.manufacturer} ${M.model} has been removed`,"âœ… Profile Deleted");else{const he=await ye.json();(F=H.value)==null||F.error(he.error||"Unknown error","âŒ Delete Failed")}}catch(ye){console.error("Error deleting profile:",ye),(ee=H.value)==null||ee.error("Failed to delete profile","âŒ Delete Error")}}return ue(r,H=>{H&&(c.value=H)},{immediate:!0}),Se(async()=>{var H;r!=null&&r.value&&(c.value=r.value),c.value||await D(),(H=c.value)!=null&&H.installed&&await $e()}),v({loadAllProfiles:$e,refreshStatus:D}),(H,I)=>{var M,C,F,ee,ye,he,_e,De,Re;return a(),i("div",ws,[e("div",$s,[e("button",{class:"icon-button chevron-button",onClick:I[0]||(I[0]=ie=>h.value=!h.value)},[e("i",{class:Q(["mdi",h.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2)]),e("div",{class:"header-left",onClick:I[1]||(I[1]=ie=>h.value=!h.value)},[e("img",{src:be(Ue),alt:"SmartIR",class:"smartir-logo"},null,8,Cs),I[7]||(I[7]=e("h3",null,"SmartIR Integration",-1)),e("div",Ss,[e("div",{class:Q(["simulation-toggle-pill",{active:A.value}]),onClick:de(Z,["stop"]),title:A.value?"Click to show as installed":"Click to simulate not-installed"},[e("i",{class:Q(["mdi",A.value?"mdi-eye-off":"mdi-eye"])},null,2),e("span",null,g(A.value?"Simulating: Not Installed":"Simulation Mode"),1)],10,_s),(M=$.value)!=null&&M.installed?(a(),i(me,{key:0},[I[6]||(I[6]=e("div",{class:"status-badge-mini success"},[e("i",{class:"mdi mdi-check-circle"}),e("span",null,"Installed")],-1)),e("span",Is,"v"+g($.value.version||"Unknown"),1),e("span",Ds,g(u.value)+" platform"+g(u.value!==1?"s":""),1),e("span",xs,g(N.value)+" device"+g(N.value!==1?"s":""),1)],64)):E("",!0)])]),e("div",Ts,[(C=c.value)!=null&&C.installed&&h.value?(a(),i("button",{key:0,onClick:I[2]||(I[2]=de(ie=>L.value=!L.value,["stop"])),class:Q(["icon-button",{active:L.value}]),title:"Show help"},[...I[8]||(I[8]=[e("i",{class:"mdi mdi-help-circle"},null,-1)])],2)):E("",!0),(F=c.value)!=null&&F.installed&&h.value?(a(),i("button",{key:1,onClick:de(D,["stop"]),class:"icon-button",title:"Refresh status"},[...I[9]||(I[9]=[e("i",{class:"mdi mdi-refresh"},null,-1)])])):E("",!0),(ee=c.value)!=null&&ee.installed&&h.value?(a(),i("button",{key:2,onClick:de(P,["stop"]),class:"btn btn-primary"},[...I[10]||(I[10]=[e("i",{class:"mdi mdi-plus"},null,-1),S(" Create SmartIR Profile ",-1)])])):E("",!0)])]),q(e("div",null,[b.value?(a(),i("div",Rs,[...I[11]||(I[11]=[e("div",{class:"spinner"},null,-1),e("p",null,"Checking SmartIR installation...",-1)])])):t.value?(a(),i("div",As,[I[12]||(I[12]=e("i",{class:"mdi mdi-alert-circle"},null,-1)),e("p",null,g(t.value),1),e("button",{onClick:D,class:"btn-secondary"}," Try Again ")])):(ye=$.value)!=null&&ye.installed?(a(),i("div",Ls,[L.value?(a(),i("div",Os,[c.value.recommendation?(a(),i("div",Ms,[e("p",null,g(c.value.recommendation.message),1),c.value.recommendation.next_steps?(a(),i("div",Es,[I[13]||(I[13]=e("strong",null,"Next Steps:",-1)),e("ul",null,[(a(!0),i(me,null,ge(c.value.recommendation.next_steps,(ie,x)=>(a(),i("li",{key:x},g(ie),1))),128))])])):E("",!0)])):E("",!0),e("div",{class:"help-actions"},[e("button",{onClick:ne,class:"btn-secondary"},[...I[14]||(I[14]=[e("i",{class:"mdi mdi-book-open-variant"},null,-1),S(" View Documentation ",-1)])])])])):E("",!0),o.value.length>0&&!A.value?(a(),i("div",Vs,[e("div",js,[e("div",Ps,[e("label",null,[I[15]||(I[15]=e("i",{class:"mdi mdi-magnify"},null,-1)),q(e("input",{"onUpdate:modelValue":I[3]||(I[3]=ie=>U.value.search=ie),type:"text",placeholder:"Search profiles...",class:"search-input"},null,512),[[we,U.value.search]])])]),e("div",Us,[e("label",null,[I[17]||(I[17]=e("i",{class:"mdi mdi-shape"},null,-1)),q(e("select",{"onUpdate:modelValue":I[4]||(I[4]=ie=>U.value.platform=ie)},[...I[16]||(I[16]=[Le('<option value="" data-v-a68b0341>All Platforms</option><option value="climate" data-v-a68b0341>Climate</option><option value="media_player" data-v-a68b0341>Media Player</option><option value="fan" data-v-a68b0341>Fan</option><option value="light" data-v-a68b0341>Light</option>',5)])],512),[[Ce,U.value.platform]])])]),te.value?(a(),i("button",{key:0,onClick:fe,class:"btn-clear-filters"},[...I[18]||(I[18]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),S(" Clear ",-1)])])):E("",!0),e("div",Fs,g(le.value.length)+" of "+g(o.value.length),1)])])):E("",!0),T.value?(a(),i("div",Ns,[...I[19]||(I[19]=[e("i",{class:"mdi mdi-loading mdi-spin"},null,-1),e("p",null,"Loading profiles...",-1)])])):o.value.length===0?(a(),i("div",Bs,[...I[20]||(I[20]=[e("i",{class:"mdi mdi-file-document-outline"},null,-1),e("h3",null,"No Profiles Yet",-1),e("p",null,"Create your first SmartIR profile to get started",-1)])])):A.value?E("",!0):(a(),i("div",Hs,[(a(!0),i(me,null,ge(le.value,ie=>(a(),xe(ks,{key:`${ie.platform}-${ie.code}`,profile:ie,onEdit:x=>G(ie.platform,ie),onCommands:x=>G(ie.platform,ie,2),onDownload:x=>d(ie.platform,ie),onDelete:x=>k(ie.platform,ie)},null,8,["profile","onEdit","onCommands","onDownload","onDelete"]))),128))])),o.value.length>0&&le.value.length===0&&!A.value?(a(),i("div",qs,[...I[21]||(I[21]=[e("i",{class:"mdi mdi-filter-off"},null,-1),e("h3",null,"No profiles match your filters",-1),e("p",null,"Try adjusting your search or filter criteria",-1)])])):E("",!0)])):(a(),i("div",zs,[I[27]||(I[27]=e("div",{class:"status-badge warning"},[e("i",{class:"mdi mdi-information"}),e("span",null,"Not Installed")],-1)),e("div",Js,[I[23]||(I[23]=e("h4",null,"Why Install SmartIR?",-1)),e("ul",Ws,[(a(!0),i(me,null,ge(((_e=(he=c.value)==null?void 0:he.recommendation)==null?void 0:_e.benefits)||O,(ie,x)=>(a(),i("li",{key:x},[I[22]||(I[22]=e("i",{class:"mdi mdi-check"},null,-1)),e("span",null,g(ie),1)]))),128))])]),e("div",Gs,[e("p",null,g(((Re=(De=c.value)==null?void 0:De.recommendation)==null?void 0:Re.message)||"Install SmartIR to unlock climate device support!"),1)]),e("div",{class:"card-actions"},[e("button",{onClick:X,class:"btn-primary"},[...I[24]||(I[24]=[e("i",{class:"mdi mdi-download"},null,-1),S(" Install SmartIR ",-1)])]),e("button",{onClick:ve,class:"btn-secondary"},[...I[25]||(I[25]=[e("i",{class:"mdi mdi-github"},null,-1),S(" View on GitHub ",-1)])]),e("button",{onClick:ne,class:"btn-secondary"},[...I[26]||(I[26]=[e("i",{class:"mdi mdi-help-circle"},null,-1),S(" Learn More ",-1)])])])]))],512),[[Ge,h.value]]),ce(Te,{isOpen:j.value.show,title:j.value.title,message:j.value.message,confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,onConfirm:z,onCancel:I[5]||(I[5]=ie=>j.value.show=!1)},null,8,["isOpen","title","message"])])}}},Xs=pe(Ks,[["__scopeId","data-v-a68b0341"]]),Ys={class:"climate-form"},Zs={class:"form-section"},Qs={class:"form-row"},ea={class:"form-group"},ta={class:"form-group"},oa={class:"form-group"},la={class:"form-section"},na={class:"checkbox-grid"},sa={class:"checkbox-item"},aa={class:"checkbox-item"},ia={class:"checkbox-item"},ra={class:"checkbox-item"},da={class:"checkbox-item"},ua={class:"checkbox-item"},ca={class:"form-section"},ma={class:"checkbox-grid"},va={class:"checkbox-item"},pa={class:"checkbox-item"},fa={class:"checkbox-item"},ga={class:"checkbox-item"},ya={class:"form-section"},ba={class:"checkbox-grid"},ha={class:"checkbox-item"},ka={class:"checkbox-item"},wa={class:"checkbox-item"},$a={class:"checkbox-item"},Ca={class:"form-section"},Sa={class:"form-group"},_a={class:"form-group"},Ia={class:"form-group"},Da={key:0,class:"validation-summary"},xa={__name:"ClimateProfileForm",props:{modelValue:{type:Object,default:()=>({})}},emits:["update:modelValue"],setup(l,{emit:v}){const s=l,y=v,r=w({minTemp:16,maxTemp:30,precision:1,modes:["off","auto","cool","heat"],fanModes:["auto","low","medium","high"],swingModes:[],tempSensor:"",humiditySensor:"",powerSensor:"",...s.modelValue}),f=W(()=>{const b=[];return(!r.value.minTemp||r.value.minTemp<10||r.value.minTemp>35)&&b.push("Minimum temperature must be between 10Â°C and 35Â°C"),(!r.value.maxTemp||r.value.maxTemp<10||r.value.maxTemp>35)&&b.push("Maximum temperature must be between 10Â°C and 35Â°C"),r.value.minTemp>=r.value.maxTemp&&b.push("Minimum temperature must be less than maximum temperature"),(!r.value.modes||r.value.modes.length===0)&&b.push("At least one HVAC mode must be selected"),b});return ue(r,b=>{y("update:modelValue",b)},{deep:!0}),(b,t)=>(a(),i("div",Ys,[t[54]||(t[54]=e("h3",null,"Climate Device Configuration",-1)),e("div",Zs,[t[24]||(t[24]=e("h4",null,"Temperature Range",-1)),e("div",Qs,[e("div",ea,[t[20]||(t[20]=e("label",null,"Minimum Temperature (Â°C) *",-1)),q(e("input",{"onUpdate:modelValue":t[0]||(t[0]=c=>r.value.minTemp=c),type:"number",min:"10",max:"35",placeholder:"16"},null,512),[[we,r.value.minTemp,void 0,{number:!0}]])]),e("div",ta,[t[21]||(t[21]=e("label",null,"Maximum Temperature (Â°C) *",-1)),q(e("input",{"onUpdate:modelValue":t[1]||(t[1]=c=>r.value.maxTemp=c),type:"number",min:"10",max:"35",placeholder:"30"},null,512),[[we,r.value.maxTemp,void 0,{number:!0}]])]),e("div",oa,[t[23]||(t[23]=e("label",null,"Precision",-1)),q(e("select",{"onUpdate:modelValue":t[2]||(t[2]=c=>r.value.precision=c)},[...t[22]||(t[22]=[e("option",{value:1},"1Â°C (Whole degrees)",-1),e("option",{value:.5},"0.5Â°C (Half degrees)",-1)])],512),[[Ce,r.value.precision,void 0,{number:!0}]])])])]),e("div",la,[t[31]||(t[31]=e("h4",null,"Supported HVAC Modes *",-1)),t[32]||(t[32]=e("p",{class:"help-text"},"Select all modes your device supports",-1)),e("div",na,[e("label",sa,[q(e("input",{type:"checkbox",value:"off","onUpdate:modelValue":t[3]||(t[3]=c=>r.value.modes=c)},null,512),[[se,r.value.modes]]),t[25]||(t[25]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),S(" Off ")],-1))]),e("label",aa,[q(e("input",{type:"checkbox",value:"auto","onUpdate:modelValue":t[4]||(t[4]=c=>r.value.modes=c)},null,512),[[se,r.value.modes]]),t[26]||(t[26]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-autorenew"}),S(" Auto ")],-1))]),e("label",ia,[q(e("input",{type:"checkbox",value:"cool","onUpdate:modelValue":t[5]||(t[5]=c=>r.value.modes=c)},null,512),[[se,r.value.modes]]),t[27]||(t[27]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-snowflake"}),S(" Cool ")],-1))]),e("label",ra,[q(e("input",{type:"checkbox",value:"heat","onUpdate:modelValue":t[6]||(t[6]=c=>r.value.modes=c)},null,512),[[se,r.value.modes]]),t[28]||(t[28]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fire"}),S(" Heat ")],-1))]),e("label",da,[q(e("input",{type:"checkbox",value:"dry","onUpdate:modelValue":t[7]||(t[7]=c=>r.value.modes=c)},null,512),[[se,r.value.modes]]),t[29]||(t[29]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-water-percent"}),S(" Dry ")],-1))]),e("label",ua,[q(e("input",{type:"checkbox",value:"fan_only","onUpdate:modelValue":t[8]||(t[8]=c=>r.value.modes=c)},null,512),[[se,r.value.modes]]),t[30]||(t[30]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan"}),S(" Fan Only ")],-1))])])]),e("div",ca,[t[37]||(t[37]=e("h4",null,"Fan Modes",-1)),t[38]||(t[38]=e("p",{class:"help-text"},"Select all fan speeds your device supports",-1)),e("div",ma,[e("label",va,[q(e("input",{type:"checkbox",value:"auto","onUpdate:modelValue":t[9]||(t[9]=c=>r.value.fanModes=c)},null,512),[[se,r.value.fanModes]]),t[33]||(t[33]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-autorenew"}),S(" Auto ")],-1))]),e("label",pa,[q(e("input",{type:"checkbox",value:"low","onUpdate:modelValue":t[10]||(t[10]=c=>r.value.fanModes=c)},null,512),[[se,r.value.fanModes]]),t[34]||(t[34]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-1"}),S(" Low ")],-1))]),e("label",fa,[q(e("input",{type:"checkbox",value:"medium","onUpdate:modelValue":t[11]||(t[11]=c=>r.value.fanModes=c)},null,512),[[se,r.value.fanModes]]),t[35]||(t[35]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-2"}),S(" Medium ")],-1))]),e("label",ga,[q(e("input",{type:"checkbox",value:"high","onUpdate:modelValue":t[12]||(t[12]=c=>r.value.fanModes=c)},null,512),[[se,r.value.fanModes]]),t[36]||(t[36]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-3"}),S(" High ")],-1))])])]),e("div",ya,[t[43]||(t[43]=e("h4",null,"Swing Modes (Optional)",-1)),t[44]||(t[44]=e("p",{class:"help-text"},"Select if your device has swing/oscillation",-1)),e("div",ba,[e("label",ha,[q(e("input",{type:"checkbox",value:"off","onUpdate:modelValue":t[13]||(t[13]=c=>r.value.swingModes=c)},null,512),[[se,r.value.swingModes]]),t[39]||(t[39]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-horizontal"}),S(" Off ")],-1))]),e("label",ka,[q(e("input",{type:"checkbox",value:"vertical","onUpdate:modelValue":t[14]||(t[14]=c=>r.value.swingModes=c)},null,512),[[se,r.value.swingModes]]),t[40]||(t[40]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-vertical"}),S(" Vertical ")],-1))]),e("label",wa,[q(e("input",{type:"checkbox",value:"horizontal","onUpdate:modelValue":t[15]||(t[15]=c=>r.value.swingModes=c)},null,512),[[se,r.value.swingModes]]),t[41]||(t[41]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-horizontal"}),S(" Horizontal ")],-1))]),e("label",$a,[q(e("input",{type:"checkbox",value:"both","onUpdate:modelValue":t[16]||(t[16]=c=>r.value.swingModes=c)},null,512),[[se,r.value.swingModes]]),t[42]||(t[42]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-arrow-all"}),S(" Both ")],-1))])])]),e("div",Ca,[t[51]||(t[51]=e("h4",null,"Sensors (Optional)",-1)),t[52]||(t[52]=e("p",{class:"help-text"},"Link external sensors for better climate control",-1)),e("div",Sa,[t[45]||(t[45]=e("label",null,"Temperature Sensor",-1)),q(e("input",{"onUpdate:modelValue":t[17]||(t[17]=c=>r.value.tempSensor=c),type:"text",placeholder:"sensor.living_room_temperature"},null,512),[[we,r.value.tempSensor]]),t[46]||(t[46]=e("small",null,"Entity ID of temperature sensor",-1))]),e("div",_a,[t[47]||(t[47]=e("label",null,"Humidity Sensor",-1)),q(e("input",{"onUpdate:modelValue":t[18]||(t[18]=c=>r.value.humiditySensor=c),type:"text",placeholder:"sensor.living_room_humidity"},null,512),[[we,r.value.humiditySensor]]),t[48]||(t[48]=e("small",null,"Entity ID of humidity sensor",-1))]),e("div",Ia,[t[49]||(t[49]=e("label",null,"Power Sensor",-1)),q(e("input",{"onUpdate:modelValue":t[19]||(t[19]=c=>r.value.powerSensor=c),type:"text",placeholder:"binary_sensor.ac_power"},null,512),[[we,r.value.powerSensor]]),t[50]||(t[50]=e("small",null,"Entity ID of power sensor (to detect on/off state)",-1))])]),f.value.length>0?(a(),i("div",Da,[t[53]||(t[53]=e("h4",null,[e("i",{class:"mdi mdi-alert-circle"}),S(" Please fix the following: ")],-1)),e("ul",null,[(a(!0),i(me,null,ge(f.value,(c,A)=>(a(),i("li",{key:A},g(c),1))),128))])])):E("",!0)]))}},Ta=pe(xa,[["__scopeId","data-v-691429a1"]]),Ra={class:"command-wizard"},Aa={class:"device-selection-section"},La={class:"form-group"},Oa=["value"],Ma={class:"form-group"},Ea={key:0,class:"edit-mode-banner"},Va={class:"wizard-info"},ja={key:0},Pa={key:1},Ua={class:"progress-info"},Fa={class:"progress-bar"},Na={class:"progress-text"},Ba={class:"commands-grid"},Ha={class:"command-header"},qa={class:"command-icon"},za={class:"command-info"},Ja={key:0,class:"learning-indicator"},Wa={key:0,class:"ir-learning-steps"},Ga={key:1,class:"rf-learning-steps"},Ka={class:"command-actions"},Xa=["onClick","disabled"],Ya={key:1,class:"learned-status"},Za=["onClick"],Qa=["onClick","disabled"],ei={class:"quick-actions"},ti=["disabled"],oi=["disabled"],li={__name:"CommandLearningWizard",props:{modelValue:{type:Object,default:()=>({})},platform:{type:String,required:!0},config:{type:Object,required:!0},broadlinkDevice:{type:String,default:""},manufacturer:{type:String,required:!0},model:{type:String,required:!0},commandType:{type:String,default:"ir"}},emits:["update:modelValue","update:broadlinkDevice","update:commandType"],setup(l,{emit:v}){const s=Ee(),y=l,r=v,f=w({...y.modelValue}),b=w(null),t=w(null),c=w([]),A=w(y.broadlinkDevice),L=w(y.commandType),h=w(!1),o=w([]),T=w(!1),U=w({show:!1,commandKey:null,commandLabel:""}),j=w(!1),O=W(()=>{const d=[];if(y.platform==="climate"){const k=y.config.modes||[],z=y.config.fanModes||[],H=y.config.minTemp||16,I=y.config.maxTemp||30;k.forEach(M=>{if(M==="off")d.push({key:"off",label:"Power Off",description:"Turn device off",icon:"mdi mdi-power",mode:"off"});else for(let C=H;C<=I;C++)z.forEach(F=>{const ee=`${M}_${C}_${F}`;d.push({key:ee,label:`${M.toUpperCase()} ${C}Â°C ${F}`,description:`Mode: ${M}, Temp: ${C}Â°C, Fan: ${F}`,icon:N(M),mode:M,temp:C,fanMode:F})})})}else if(y.platform==="media_player"){const k=y.config.features||[];k.includes("turn_on")&&(d.push({key:"turn_on",label:"Power On",description:"Turn on the device",icon:"mdi mdi-power"}),d.push({key:"turn_off",label:"Power Off",description:"Turn off the device",icon:"mdi mdi-power-off"})),k.includes("volume")&&(d.push({key:"volume_up",label:"Volume Up",description:"Increase volume",icon:"mdi mdi-volume-plus"}),d.push({key:"volume_down",label:"Volume Down",description:"Decrease volume",icon:"mdi mdi-volume-minus"})),k.includes("mute")&&d.push({key:"mute",label:"Mute",description:"Toggle mute",icon:"mdi mdi-volume-mute"}),k.includes("source")&&(d.push({key:"source_hdmi1",label:"Source: HDMI 1",description:"Switch to HDMI 1",icon:"mdi mdi-import"}),d.push({key:"source_hdmi2",label:"Source: HDMI 2",description:"Switch to HDMI 2",icon:"mdi mdi-import"}),d.push({key:"source_hdmi3",label:"Source: HDMI 3",description:"Switch to HDMI 3",icon:"mdi mdi-import"})),k.includes("channel")&&(d.push({key:"channel_up",label:"Channel Up",description:"Next channel",icon:"mdi mdi-chevron-up"}),d.push({key:"channel_down",label:"Channel Down",description:"Previous channel",icon:"mdi mdi-chevron-down"}))}else if(y.platform==="fan"){const k=y.config.speedLevels||3,z=y.config.features||[];d.push({key:"turn_on",label:"Power On",description:"Turn on the fan",icon:"mdi mdi-power"}),d.push({key:"turn_off",label:"Power Off",description:"Turn off the fan",icon:"mdi mdi-power-off"});for(let H=1;H<=k;H++){const I=H===1?"Low":H===k?"High":H===2&&k===3?"Medium":`Speed ${H}`;d.push({key:`speed_${H}`,label:`${I}`,description:`Set fan to speed level ${H}`,icon:"mdi mdi-fan"})}z.includes("oscillate")&&(d.push({key:"oscillate_on",label:"Oscillate On",description:"Enable oscillation",icon:"mdi mdi-sync"}),d.push({key:"oscillate_off",label:"Oscillate Off",description:"Disable oscillation",icon:"mdi mdi-sync-off"})),z.includes("direction")&&(d.push({key:"direction_forward",label:"Direction: Forward",description:"Set direction to forward",icon:"mdi mdi-rotate-right"}),d.push({key:"direction_reverse",label:"Direction: Reverse",description:"Set direction to reverse",icon:"mdi mdi-rotate-left"}))}else if(y.platform==="light"){const k=y.config.features||[];k.includes("turn_on")&&(d.push({key:"turn_on",label:"Power On",description:"Turn on the light",icon:"mdi mdi-lightbulb-on"}),d.push({key:"turn_off",label:"Power Off",description:"Turn off the light",icon:"mdi mdi-lightbulb-off"})),k.includes("brightness")&&(d.push({key:"brightness_up",label:"Brightness Up",description:"Increase brightness",icon:"mdi mdi-brightness-7"}),d.push({key:"brightness_down",label:"Brightness Down",description:"Decrease brightness",icon:"mdi mdi-brightness-5"})),k.includes("color_temp")&&(d.push({key:"color_temp_warm",label:"Warm White",description:"Set to warm white",icon:"mdi mdi-weather-sunset"}),d.push({key:"color_temp_cool",label:"Cool White",description:"Set to cool white",icon:"mdi mdi-weather-sunny"})),k.includes("rgb")&&(d.push({key:"color_red",label:"Color: Red",description:"Set color to red",icon:"mdi mdi-palette"}),d.push({key:"color_green",label:"Color: Green",description:"Set color to green",icon:"mdi mdi-palette"}),d.push({key:"color_blue",label:"Color: Blue",description:"Set color to blue",icon:"mdi mdi-palette"}))}return d}),_=W(()=>O.value.length),$=W(()=>Object.keys(f.value).length),u=W(()=>_.value===0?0:Math.round($.value/_.value*100));function N(d){return{off:"mdi mdi-power",auto:"mdi mdi-autorenew",cool:"mdi mdi-snowflake",heat:"mdi mdi-fire",dry:"mdi mdi-water-percent",fan_only:"mdi mdi-fan"}[d]||"mdi mdi-remote"}async function Z(d){if(!b.value){b.value=d.key;try{const k=y.manufacturer.toLowerCase().replace(/[^a-z0-9]+/g,"_"),z=y.model.toLowerCase().replace(/[^a-z0-9]+/g,"_"),H=`${k}_${z}`,I=await fetch("/api/commands/learn",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({entity_id:A.value,device:H,command:d.key,command_type:L.value})});if(!I.ok)throw new Error(`Failed to learn command: ${I.statusText}`);const M=await I.json();if(M.success&&M.code)f.value[d.key]=M.code,r("update:modelValue",f.value),T.value=!0,h.value&&o.value.length>0&&setTimeout(()=>{const C=o.value.shift();C?Z(C):h.value=!1},1e3);else throw new Error(M.error||"Failed to learn command")}catch(k){console.error("Error learning command:",k),s.error(`Error learning command: ${k.message}`),h.value=!1,o.value=[]}finally{h.value||(b.value=null)}}}async function le(d){if(!A.value){s.error("Please select a Broadlink device first");return}if(!f.value[d]){s.error("Command not learned yet");return}t.value=d;try{const k=f.value[d],z=await fetch("/api/commands/send-raw",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({entity_id:A.value,command:k,command_type:L.value})});if(!z.ok){const H=await z.json();throw new Error(H.error||"Failed to send command")}s.success("Command sent successfully")}catch(k){console.error("Error testing command:",k),s.error(`Error testing command: ${k.message}`)}finally{t.value=null}}function te(d){const k=O.value.find(z=>z.key===d);U.value={show:!0,commandKey:d,commandLabel:k?k.label:d}}function fe(){const d=U.value.commandKey;delete f.value[d],r("update:modelValue",f.value),U.value.show=!1}function D(){const d=O.value.filter(z=>!f.value[z.key]);if(d.length===0)return;h.value=!0,o.value=[...d];const k=o.value.shift();k&&Z(k)}function P(){j.value=!0}function X(){f.value={},r("update:modelValue",f.value),j.value=!1}ue(()=>y.modelValue,d=>{f.value={...d}},{deep:!0}),Se(async()=>{await ne()});async function ne(){try{const d=y.manufacturer.toLowerCase().replace(/[^a-z0-9]+/g,"_"),k=y.model.toLowerCase().replace(/[^a-z0-9]+/g,"_"),z=`${d}_${k}`,H=await fetch(`/api/commands/broadlink/${z}`);if(!H.ok)return;const I=await H.json();if(I.commands){const M=O.value.map(F=>F.key),C={};for(const[F,ee]of Object.entries(I.commands))M.includes(F)&&(C[F]=ee);Object.keys(C).length>0&&(f.value={...f.value,...C},r("update:modelValue",f.value),console.log(`Loaded ${Object.keys(C).length} existing commands for ${z}`))}}catch(d){console.error("Error loading existing commands:",d)}}function ve(){r("update:broadlinkDevice",A.value)}function $e(){r("update:commandType",L.value)}async function G(){try{const d=await fetch("/api/remote/devices");if(d.ok){const z=(await d.json()).devices||[];c.value=z}}catch(d){console.error("Error loading remote devices:",d),c.value=[]}}return ue(()=>y.broadlinkDevice,d=>{A.value=d}),ue(()=>y.commandType,d=>{L.value=d}),Se(async()=>{await G(),await ne()}),(d,k)=>(a(),i("div",Ra,[k[22]||(k[22]=e("h3",null,"Learn IR Commands",-1)),e("div",Aa,[e("div",La,[k[5]||(k[5]=e("label",null,"Broadlink Device *",-1)),q(e("select",{"onUpdate:modelValue":k[0]||(k[0]=z=>A.value=z),onChange:ve},[k[4]||(k[4]=e("option",{value:""},"Select Broadlink device...",-1)),(a(!0),i(me,null,ge(c.value,z=>(a(),i("option",{key:z.entity_id,value:z.entity_id},g(z.name)+g(z.area_name?" ("+z.area_name+")":""),9,Oa))),128))],544),[[Ce,A.value]]),e("small",null,"This device will be used to learn commands ("+g(c.value.length)+" devices found)",1)]),e("div",Ma,[k[7]||(k[7]=e("label",null,"Command Type *",-1)),q(e("select",{"onUpdate:modelValue":k[1]||(k[1]=z=>L.value=z),onChange:$e},[...k[6]||(k[6]=[e("option",{value:"ir"},"ğŸ“¡ Infrared (IR) - Most common for AC, TV, etc.",-1),e("option",{value:"rf"},"ğŸ“» Radio Frequency (RF) - For RF remotes",-1)])],544),[[Ce,L.value]]),k[8]||(k[8]=e("small",null,"Select the type of commands your device uses",-1))])]),$.value>0&&!T.value?(a(),i("div",Ea,[k[10]||(k[10]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[k[9]||(k[9]=e("strong",null,"Editing Existing Profile",-1)),e("p",null,g($.value)+" command"+g($.value!==1?"s":"")+' already learned. You can re-learn any command by clicking the delete icon and then "Learn Command".',1)])])):E("",!0),e("div",Va,[k[14]||(k[14]=e("i",{class:"mdi mdi-information"},null,-1)),e("div",null,[k[13]||(k[13]=e("p",null,[e("strong",null,"How it works:")],-1)),l.commandType==="ir"?(a(),i("ol",ja,[...k[11]||(k[11]=[e("li",null,'Click "Learn Command" for each combination',-1),e("li",null,[e("strong",null,"Point your IR remote directly at the Broadlink device")],-1),e("li",null,"Press the button on your remote",-1),e("li",null,"Wait for confirmation (up to 30 seconds)",-1)])])):(a(),i("ol",Pa,[...k[12]||(k[12]=[e("li",null,'Click "Learn Command" for each combination',-1),e("li",null,[e("strong",null,"Step 1:"),S(" Hold button on remote - Broadlink scans for RF frequency")],-1),e("li",null,[e("strong",null,"Step 2:"),S(" Watch for Home Assistant notification, then press and release button")],-1),e("li",null,"Keep remote within 5cm of Broadlink (RF doesn't need line-of-sight)",-1),e("li",null,"Wait for confirmation (may take up to 30 seconds)",-1)])]))])]),e("div",Ua,[e("div",Fa,[e("div",{class:"progress-fill",style:tt({width:u.value+"%"})},null,4)]),e("span",Na,g($.value)+" / "+g(_.value)+" commands learned ("+g(u.value)+"%) ",1)]),e("div",Ba,[(a(!0),i(me,null,ge(O.value,z=>(a(),i("div",{key:z.key,class:Q(["command-card",{learned:f.value[z.key],learning:b.value===z.key}])},[e("div",Ha,[e("div",qa,[e("i",{class:Q(z.icon)},null,2)]),e("div",za,[e("h4",null,g(z.label),1),e("p",null,g(z.description),1)])]),b.value===z.key?(a(),i("div",Ja,[l.commandType==="ir"?(a(),i("div",Wa,[...k[15]||(k[15]=[e("p",null,[e("strong",null,"Point your remote directly at the Broadlink device and press the button.")],-1),e("small",null,"Listening for up to 30 seconds...",-1)])])):(a(),i("div",Ga,[...k[16]||(k[16]=[e("p",{class:"rf-title"},[e("strong",null,"Learning request sent to device.")],-1),e("p",{class:"rf-subtitle"},[S("RF learning is a "),e("strong",null,"two-step process"),S(":")],-1),e("ol",null,[e("li",null,[e("strong",null,"Step 1 - Frequency Sweep (~10-15 seconds):"),S(" Press and hold the button on your remote until the notification updates. ")]),e("li",null,[e("strong",null,"Step 2 - Learn Signal:"),S(" Press and release the button once. ")])],-1),e("p",{class:"rf-note"},"Follow the Home Assistant notifications (ğŸ””) for real-time instructions.",-1)])]))])):E("",!0),e("div",Ka,[f.value[z.key]?(a(),i("div",Ya,[k[18]||(k[18]=e("i",{class:"mdi mdi-check-circle"},null,-1)),k[19]||(k[19]=e("span",null,"Learned",-1)),e("span",{class:Q(["command-type-badge",L.value])},g(L.value.toUpperCase()),3),e("button",{onClick:H=>te(z.key),class:"icon-btn danger",title:"Delete and re-learn",style:{"margin-left":"auto"}},[...k[17]||(k[17]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,Za),e("button",{onClick:H=>le(z.key),class:"icon-btn",title:"Test command",disabled:t.value===z.key},[e("i",{class:Q(["mdi mdi-play",{"mdi-spin":t.value===z.key}])},null,2)],8,Qa)])):(a(),i("button",{key:0,onClick:H=>Z(z),class:Q(["btn-learn",{learning:b.value===z.key}]),disabled:b.value!==null},[e("i",{class:Q(["mdi mdi-radio-tower",{"mdi-spin":b.value===z.key}])},null,2),S(" "+g(b.value===z.key?"Listening...":"Learn Command"),1)],10,Xa))])],2))),128))]),e("div",ei,[e("button",{onClick:D,class:"btn-secondary",disabled:b.value!==null||$.value===_.value},[...k[20]||(k[20]=[e("i",{class:"mdi mdi-play-circle"},null,-1),S(" Learn All Remaining ",-1)])],8,ti),e("button",{onClick:P,class:"btn-text",disabled:$.value===0},[...k[21]||(k[21]=[e("i",{class:"mdi mdi-delete-sweep"},null,-1),S(" Clear All ",-1)])],8,oi)]),ce(Te,{isOpen:U.value.show,title:"Delete Learned Command?",message:`Are you sure you want to delete the '${U.value.commandLabel}' command?

You will need to re-learn this command.`,confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,onConfirm:fe,onCancel:k[2]||(k[2]=z=>U.value.show=!1)},null,8,["isOpen","message"]),ce(Te,{isOpen:j.value,title:"Delete All Learned Commands?",message:"Are you sure you want to delete all learned commands? This cannot be undone.\\n\\nYou will need to re-learn all commands.",confirmText:"Delete All",cancelText:"Cancel",dangerMode:!0,onConfirm:X,onCancel:k[3]||(k[3]=z=>j.value=!1)},null,8,["isOpen"])]))}},ni=pe(li,[["__scopeId","data-v-c792dacc"]]),si={class:"profile-preview"},ai={class:"preview-summary"},ii={class:"summary-card"},ri={class:"stats-grid"},di={class:"stat-item"},ui={class:"stat-value"},ci={class:"stat-item"},mi={class:"stat-value"},vi={class:"stat-item"},pi={class:"stat-value"},fi={class:"preview-tabs"},gi={class:"preview-content"},yi={key:0,class:"tab-content"},bi={class:"code-header"},hi={class:"code-block"},ki={key:1,class:"tab-content"},wi={class:"code-header"},$i={class:"code-block"},Ci={key:2,class:"tab-content"},Si={class:"instructions"},_i={class:"step-item"},Ii={class:"step-content"},Di={class:"code-path"},xi={__name:"ProfilePreview",props:{profile:{type:Object,required:!0},jsonData:{type:Object,required:!0},yamlConfig:{type:String,required:!0}},setup(l){const v=Ee(),s=l,y=w("json"),r=w(!1),f=w(!1),b=W(()=>Object.keys(s.profile.commands||{}).length),t=W(()=>JSON.stringify(s.jsonData,null,2));async function c(){try{await navigator.clipboard.writeText(t.value),r.value=!0,setTimeout(()=>{r.value=!1},2e3)}catch(L){console.error("Failed to copy JSON:",L),v.error("Failed to copy to clipboard")}}async function A(){try{await navigator.clipboard.writeText(s.yamlConfig),f.value=!0,setTimeout(()=>{f.value=!1},2e3)}catch(L){console.error("Failed to copy YAML:",L),v.error("Failed to copy to clipboard")}}return(L,h)=>{var o;return a(),i("div",si,[h[22]||(h[22]=e("h3",null,"Preview & Save",-1)),e("div",ai,[e("div",ii,[h[4]||(h[4]=e("i",{class:"mdi mdi-check-circle"},null,-1)),e("div",null,[h[3]||(h[3]=e("h4",null,"Profile Ready!",-1)),e("p",null,g(l.profile.manufacturer)+" "+g(l.profile.model),1)])]),e("div",ri,[e("div",di,[e("span",ui,g(b.value),1),h[5]||(h[5]=e("span",{class:"stat-label"},"Commands Learned",-1))]),e("div",ci,[e("span",mi,g(l.profile.platform),1),h[6]||(h[6]=e("span",{class:"stat-label"},"Platform",-1))]),e("div",vi,[e("span",pi,g(((o=l.profile.config.modes)==null?void 0:o.length)||0),1),h[7]||(h[7]=e("span",{class:"stat-label"},"HVAC Modes",-1))])])]),e("div",fi,[e("button",{onClick:h[0]||(h[0]=T=>y.value="json"),class:Q(["tab-button",{active:y.value==="json"}])},[...h[8]||(h[8]=[e("i",{class:"mdi mdi-code-json"},null,-1),S(" SmartIR JSON ",-1)])],2),e("button",{onClick:h[1]||(h[1]=T=>y.value="yaml"),class:Q(["tab-button",{active:y.value==="yaml"}])},[...h[9]||(h[9]=[e("i",{class:"mdi mdi-file-code"},null,-1),S(" YAML Config ",-1)])],2),e("button",{onClick:h[2]||(h[2]=T=>y.value="instructions"),class:Q(["tab-button",{active:y.value==="instructions"}])},[...h[10]||(h[10]=[e("i",{class:"mdi mdi-information"},null,-1),S(" Instructions ",-1)])],2)]),e("div",gi,[y.value==="json"?(a(),i("div",yi,[e("div",bi,[h[12]||(h[12]=e("h4",null,"SmartIR Device Code JSON",-1)),e("button",{onClick:c,class:"btn-copy"},[h[11]||(h[11]=e("i",{class:"mdi mdi-content-copy"},null,-1)),S(" "+g(r.value?"Copied!":"Copy"),1)])]),e("pre",hi,[e("code",null,g(t.value),1)]),h[13]||(h[13]=e("p",{class:"code-note"},[e("i",{class:"mdi mdi-information"}),S(" Save this as "),e("code",null,"10000.json"),S(" in your SmartIR codes directory ")],-1))])):E("",!0),y.value==="yaml"?(a(),i("div",ki,[e("div",wi,[h[15]||(h[15]=e("h4",null,"Home Assistant Configuration",-1)),e("button",{onClick:A,class:"btn-copy"},[h[14]||(h[14]=e("i",{class:"mdi mdi-content-copy"},null,-1)),S(" "+g(f.value?"Copied!":"Copy"),1)])]),e("pre",$i,[e("code",null,g(l.yamlConfig),1)]),h[16]||(h[16]=e("p",{class:"code-note"},[e("i",{class:"mdi mdi-information"}),S(" Add this to your "),e("code",null,"configuration.yaml"),S(" file ")],-1))])):E("",!0),y.value==="instructions"?(a(),i("div",Ci,[e("div",Si,[h[20]||(h[20]=e("h4",null,"Installation Steps",-1)),e("div",_i,[h[19]||(h[19]=e("div",{class:"step-number"},"1",-1)),e("div",Ii,[h[17]||(h[17]=e("h5",null,"Get Next Code Number",-1)),h[18]||(h[18]=e("p",null,"Custom device codes start at 10000. Check your SmartIR codes directory to find the next available number.",-1)),e("div",Di,[e("code",null,"/config/custom_components/smartir/codes/"+g(l.profile.platform)+"/",1)])])]),h[21]||(h[21]=Le('<div class="step-item" data-v-cbf0874d><div class="step-number" data-v-cbf0874d>2</div><div class="step-content" data-v-cbf0874d><h5 data-v-cbf0874d>Save JSON File</h5><p data-v-cbf0874d>Copy the JSON from the &quot;SmartIR JSON&quot; tab and save it as <code data-v-cbf0874d>10000.json</code> (or your next available number) in the codes directory.</p></div></div><div class="step-item" data-v-cbf0874d><div class="step-number" data-v-cbf0874d>3</div><div class="step-content" data-v-cbf0874d><h5 data-v-cbf0874d>Update Configuration</h5><p data-v-cbf0874d>Copy the YAML from the &quot;YAML Config&quot; tab and add it to your <code data-v-cbf0874d>configuration.yaml</code> file. Update the <code data-v-cbf0874d>device_code</code> to match your JSON filename.</p></div></div><div class="step-item" data-v-cbf0874d><div class="step-number" data-v-cbf0874d>4</div><div class="step-content" data-v-cbf0874d><h5 data-v-cbf0874d>Restart Home Assistant</h5><p data-v-cbf0874d>Restart Home Assistant to load the new configuration. Your climate entity will appear in the UI.</p></div></div><div class="step-item" data-v-cbf0874d><div class="step-number" data-v-cbf0874d>5</div><div class="step-content" data-v-cbf0874d><h5 data-v-cbf0874d>Test Your Device</h5><p data-v-cbf0874d>Go to your climate entity and test different modes, temperatures, and fan speeds to ensure everything works correctly.</p></div></div><div class="tips-section" data-v-cbf0874d><h4 data-v-cbf0874d><i class="mdi mdi-lightbulb" data-v-cbf0874d></i> Tips </h4><ul data-v-cbf0874d><li data-v-cbf0874d>Keep a backup of your JSON file in case you need to modify it</li><li data-v-cbf0874d>Test all commands to ensure they work as expected</li><li data-v-cbf0874d>You can share your profile with the SmartIR community on GitHub</li><li data-v-cbf0874d>If a command doesn&#39;t work, you can re-learn it and update the JSON</li></ul></div>',5))])])):E("",!0)])])}}},Ti=pe(xi,[["__scopeId","data-v-cbf0874d"]]),Ri={class:"wizard-body"},Ai={key:0,class:"warning-section"},Li={class:"warning-box"},Oi={class:"instructions"},Mi={class:"code-block"},Ei={class:"steps"},Vi={key:0},ji={class:"help-section"},Pi={key:0,class:"help-content"},Ui={class:"help-step"},Fi={key:0,class:"help-step"},Ni={class:"help-step"},Bi={class:"help-step"},Hi={class:"checklist"},qi={class:"checkbox-label"},zi={key:0,class:"checkbox-label"},Ji={class:"wizard-footer"},Wi=["disabled"],Gi={__name:"SmartIRSetupWizard",props:{show:{type:Boolean,default:!1},platform:{type:String,required:!0},warnings:{type:Array,default:()=>[]},configPath:{type:String,default:"/config"}},emits:["close","complete"],setup(l,{emit:v}){const s=l,y=v,r=ke("toast"),f=w(!1),b=w(!1),t=w(!1),c=W(()=>s.warnings.length>0?f.value&&b.value:f.value);function A(){const h=`${s.platform}: !include smartir/${s.platform}.yaml`;navigator.clipboard.writeText(h).then(()=>{var o;(o=r.value)==null||o.success("Include line copied to clipboard!","âœ… Copied")}).catch(o=>{var T;console.error("Failed to copy:",o),(T=r.value)==null||T.error("Failed to copy to clipboard","âŒ Copy Failed")})}function L(){y("complete")}return(h,o)=>l.show?(a(),i("div",{key:0,class:"modal-overlay",onClick:o[5]||(o[5]=de(()=>{},["stop"]))},[e("div",{class:"setup-wizard",onClick:o[4]||(o[4]=de(()=>{},["stop"]))},[o[31]||(o[31]=e("div",{class:"wizard-header"},[e("h2",null,[e("i",{class:"mdi mdi-cog"}),S(" SmartIR Configuration Setup ")])],-1)),e("div",Ri,[l.warnings.length>0?(a(),i("div",Ai,[e("div",Li,[o[11]||(o[11]=e("i",{class:"mdi mdi-alert"},null,-1)),e("div",null,[o[9]||(o[9]=e("h3",null,"âš ï¸ Configuration Migration Needed",-1)),o[10]||(o[10]=e("p",null,"We detected existing platform entries in your configuration.yaml:",-1)),e("ul",null,[(a(!0),i(me,null,ge(l.warnings,T=>(a(),i("li",{key:T.platform},[e("strong",null,g(T.platform)+":",1),S(" "+g(T.message),1)]))),128))]),e("p",null,[o[6]||(o[6]=e("strong",null,"Action Required:",-1)),o[7]||(o[7]=S(" Move these entries to ",-1)),e("code",null,"smartir/"+g(l.platform)+".yaml",1),o[8]||(o[8]=S(" before continuing.",-1))])])])])):E("",!0),e("div",Oi,[o[27]||(o[27]=e("h3",null,"ğŸ“ One-Time Setup",-1)),o[28]||(o[28]=e("p",null,[S("To enable SmartIR device management, add this line to your "),e("code",null,"configuration.yaml"),S(":")],-1)),e("div",Mi,[e("code",null,g(l.platform)+": !include smartir/"+g(l.platform)+".yaml",1),e("button",{onClick:A,class:"copy-btn",title:"Copy to clipboard"},[...o[12]||(o[12]=[e("i",{class:"mdi mdi-content-copy"},null,-1)])])]),e("div",Ei,[o[19]||(o[19]=e("h4",null,"Steps:",-1)),e("ol",null,[l.warnings.length>0?(a(),i("li",Vi,[o[13]||(o[13]=e("strong",null,"Move existing entries:",-1)),o[14]||(o[14]=S(" Copy any existing ",-1)),e("code",null,g(l.platform)+":",1),o[15]||(o[15]=S(" entries from configuration.yaml to ",-1)),e("code",null,"smartir/"+g(l.platform)+".yaml",1)])):E("",!0),o[16]||(o[16]=e("li",null,[e("strong",null,"Add include line:"),S(" Add the line above to your configuration.yaml ")],-1)),o[17]||(o[17]=e("li",null,[e("strong",null,"Save changes:"),S(" Save configuration.yaml ")],-1)),o[18]||(o[18]=e("li",null,[e("strong",null,"Continue here:"),S(` Click "I've Completed Setup" below `)],-1))])]),e("div",ji,[e("button",{onClick:o[0]||(o[0]=T=>t.value=!t.value),class:"help-toggle"},[e("i",{class:Q(["mdi",t.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2),S(" "+g(t.value?"Hide":"Show")+" Detailed Instructions ",1)]),t.value?(a(),i("div",Pi,[o[26]||(o[26]=e("h4",null,"Detailed Setup Guide:",-1)),e("div",Ui,[o[21]||(o[21]=e("h5",null,"1. Open configuration.yaml",-1)),e("p",null,[o[20]||(o[20]=S("Location: ",-1)),e("code",null,g(l.configPath)+"/configuration.yaml",1)])]),l.warnings.length>0?(a(),i("div",Fi,[o[22]||(o[22]=e("h5",null,"2. Migrate Existing Entries (If Any)",-1)),e("p",null,"If you have existing "+g(l.platform)+" entries, cut them from configuration.yaml and paste into:",1),e("p",null,[e("code",null,g(l.configPath)+"/smartir/"+g(l.platform)+".yaml",1)]),o[23]||(o[23]=e("p",{class:"note"},"Broadlink Manager will create this file automatically.",-1))])):E("",!0),e("div",Ni,[e("h5",null,g(l.warnings.length>0?"3":"2")+". Add Include Line",1),o[24]||(o[24]=e("p",null,"Add this to configuration.yaml:",-1)),e("pre",null,g(l.platform)+": !include smartir/"+g(l.platform)+".yaml",1)]),e("div",Bi,[e("h5",null,g(l.warnings.length>0?"4":"3")+". Restart Home Assistant",1),o[25]||(o[25]=e("p",null,"After saving, you'll need to restart HA for changes to take effect.",-1))])])):E("",!0)])]),e("div",Hi,[e("label",qi,[q(e("input",{type:"checkbox","onUpdate:modelValue":o[1]||(o[1]=T=>f.value=T)},null,512),[[se,f.value]]),o[29]||(o[29]=e("span",null,"I've added the include line to configuration.yaml",-1))]),l.warnings.length>0?(a(),i("label",zi,[q(e("input",{type:"checkbox","onUpdate:modelValue":o[2]||(o[2]=T=>b.value=T)},null,512),[[se,b.value]]),e("span",null,"I've migrated existing "+g(l.platform)+" entries (if any)",1)])):E("",!0)])]),e("div",Ji,[e("button",{onClick:o[3]||(o[3]=T=>h.$emit("close")),class:"btn-secondary"}," Cancel "),e("button",{onClick:L,class:"btn-primary",disabled:!c.value},[...o[30]||(o[30]=[e("i",{class:"mdi mdi-check"},null,-1),S(" I've Completed Setup ",-1)])],8,Wi)])])])):E("",!0)}},Ki=pe(Gi,[["__scopeId","data-v-f6fe4c03"]]),Xi={class:"modal-header"},Yi={class:"progress-steps"},Zi={class:"step-number"},Qi={key:0,class:"mdi mdi-check"},er={key:1},tr={class:"step-label"},or={class:"modal-body"},lr={key:0,class:"step-content"},nr={class:"form-group"},sr={class:"form-group"},ar={class:"form-group"},ir={key:1,class:"step-content"},rr={key:1,class:"platform-form"},dr={class:"form-section"},ur={class:"checkbox-grid"},cr={class:"checkbox-item"},mr={class:"checkbox-item"},vr={class:"checkbox-item"},pr={class:"checkbox-item"},fr={class:"checkbox-item"},gr={key:2,class:"platform-form"},yr={class:"form-section"},br={class:"form-group"},hr={class:"form-section"},kr={class:"checkbox-grid"},wr={class:"checkbox-item"},$r={class:"checkbox-item"},Cr={key:3,class:"platform-form"},Sr={class:"form-section"},_r={class:"checkbox-grid"},Ir={class:"checkbox-item"},Dr={class:"checkbox-item"},xr={class:"checkbox-item"},Tr={class:"checkbox-item"},Rr={key:2,class:"step-content"},Ar={key:3,class:"step-content"},Lr={class:"modal-footer"},Or=["disabled"],Mr={key:2,class:"save-buttons"},Er=["disabled"],Vr=["disabled"],jr={__name:"SmartIRProfileBuilder",props:{show:{type:Boolean,default:!1},editMode:{type:Boolean,default:!1},editData:{type:Object,default:null},startStep:{type:Number,default:0}},emits:["close","save"],setup(l,{emit:v}){const s=l,y=v,r=ke("toast"),f=w(0),b=w(!1),t=w([]),c=w(!1),A=w([]),L=w("/config"),h=w(!1),o=w(null),T=w(!1),U=w(!1),j=w(""),O=w("ir"),_=w(!1),$=[{label:"Device Info",key:"info"},{label:"Configuration",key:"config"},{label:"Learn Commands",key:"commands"},{label:"Preview & Save",key:"preview"}],u=w({platform:"",manufacturer:"",model:"",broadlinkDevice:"",commandType:"ir",config:{},commands:{}}),N=w(["turn_on"]),Z=w(3),le=w([]),te=w(["turn_on"]);ue(()=>u.value.platform,x=>{x==="media_player"?u.value.config={features:N.value}:x==="fan"?u.value.config={speedLevels:Z.value,features:le.value}:x==="light"&&(u.value.config={features:te.value})}),ue(N,x=>{u.value.platform==="media_player"&&(u.value.config={features:x})},{deep:!0}),ue(Z,x=>{u.value.platform==="fan"&&(u.value.config={speedLevels:x,features:le.value})}),ue(le,x=>{u.value.platform==="fan"&&(u.value.config={speedLevels:Z.value,features:x})},{deep:!0}),ue(te,x=>{u.value.platform==="light"&&(u.value.config={features:x})},{deep:!0});function fe(x){const n=new Set,m=Object.keys(x);return m.some(p=>p==="off"||p.includes("_off"))&&n.add("off"),m.some(p=>p.includes("auto"))&&n.add("auto"),m.some(p=>p.includes("cool"))&&n.add("cool"),m.some(p=>p.includes("heat"))&&n.add("heat"),m.some(p=>p.includes("dry"))&&n.add("dry"),m.some(p=>p.includes("fan_only"))&&n.add("fan_only"),Array.from(n)}function D(x){const n=new Set,m=Object.keys(x);return m.some(p=>p.includes("auto"))&&n.add("auto"),m.some(p=>p.includes("low"))&&n.add("low"),m.some(p=>p.includes("medium")||p.includes("mid"))&&n.add("medium"),m.some(p=>p.includes("high"))&&n.add("high"),Array.from(n)}function P(x){const n=new Set,m=Object.keys(x);return m.some(p=>p.includes("swing_off")||p.includes("_off"))&&n.add("off"),m.some(p=>p.includes("vertical"))&&n.add("vertical"),m.some(p=>p.includes("horizontal"))&&n.add("horizontal"),m.some(p=>p.includes("both"))&&n.add("both"),Array.from(n)}function X(x){for(const n of Object.values(x))if(typeof n=="string"&&n.startsWith("sc")||Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0].startsWith("sc"))return"rf";return"ir"}ue(()=>u.value.commandType,(x,n)=>{!n||T.value||_.value||(Object.keys(u.value.commands).length>0&&x!==n?(j.value=x,u.value.commandType=n,T.value=!0):x!==n&&(O.value=x))}),ue(()=>s.editData,async x=>{var n,m,p;if(x&&s.editMode){console.log("ğŸ”§ Edit mode activated, loading profile data:",x),_.value=!0,t.value.length===0&&(console.log("ğŸ“¡ Loading Broadlink devices..."),await ie(),console.log("ğŸ“¡ Devices loaded:",t.value.length));const R=x.profile,V=R.controller_data;console.log("ğŸ® Controller data from profile:",V),console.log("ğŸ® Available devices:",t.value.map(J=>J.entity_id));const B=R.commands||{},oe=X(B);console.log("ğŸ” Inferred command type:",oe);let Y={};if(x.platform==="climate"){const J=R.operationModes||fe(B),re=R.fanModes||D(B),Ie=R.swingModes||P(B);console.log("ğŸ” Inferred modes:",J),console.log("ğŸ” Inferred fan modes:",re),console.log("ğŸ” Inferred swing modes:",Ie),Y={minTemp:R.minTemperature,maxTemp:R.maxTemperature,precision:R.precision,modes:J,fanModes:re,swingModes:Ie}}else if(x.platform==="media_player"){const J=[];(B.on||B.off)&&J.push("turn_on"),(B.volumeUp||B.volumeDown)&&J.push("volume"),B.mute&&J.push("mute"),B.sources&&J.push("source"),(B.channelUp||B.channelDown)&&J.push("channel"),Y={features:J},N.value=J,console.log("ğŸ” Inferred media player features:",J)}else if(x.platform==="fan"){const J=((n=R.speed)==null?void 0:n.length)||Object.keys(B.default||{}).length||3,re=[];(B.oscillate_on||B.oscillate_off)&&re.push("oscillate"),(B.direction_forward||B.direction_reverse)&&re.push("direction"),Y={speedLevels:J,features:re},Z.value=J,le.value=re,console.log("ğŸ” Inferred fan config:",Y)}else if(x.platform==="light"){const J=[];Y={features:J},te.value=J,console.log("ğŸ” Inferred light features:",J)}const K=await _e(R.manufacturer,(m=R.supportedModels)==null?void 0:m[0],B);u.value={platform:x.platform,manufacturer:R.manufacturer||"",model:((p=R.supportedModels)==null?void 0:p[0])||"",broadlinkDevice:V||"",commandType:oe,config:Y,commands:K},console.log("âœ… Profile populated:",u.value),console.log("âœ… Selected device:",u.value.broadlinkDevice),console.log("âœ… Command type:",u.value.commandType),console.log("âœ… Commands (with learned codes):",K),O.value=oe,setTimeout(()=>{_.value=!1},100)}},{immediate:!0});const ne=W(()=>{var x;switch(f.value){case 0:return u.value.platform&&u.value.manufacturer&&u.value.model;case 1:return u.value.platform==="climate"?u.value.config.minTemp&&u.value.config.maxTemp&&((x=u.value.config.modes)==null?void 0:x.length)>0:!0;case 2:return u.value.broadlinkDevice&&u.value.commandType&&Object.keys(u.value.commands).length>0;case 3:return!0;default:return!1}}),ve=w(null);async function $e(){if(f.value!==3){ve.value=null;return}if(console.log("ğŸ” Generating JSON with commands:",u.value.commands),Object.values(u.value.commands).some(n=>typeof n=="string"?n==="pending":typeof n=="object"?Object.values(n).some(m=>typeof m=="string"?m==="pending":typeof m=="object"?Object.values(m).some(p=>p==="pending"):!1):!1)){console.warn('âš ï¸ Commands still contain "pending" placeholders!'),console.log("ğŸ“¦ Attempting to fetch from Broadlink storage...");const n=await _e(u.value.manufacturer,u.value.model,u.value.commands);u.value.commands=n,console.log("âœ… Updated commands:",n)}ve.value=De(u.value),console.log("ğŸ“„ Generated JSON:",ve.value)}const G=W(()=>f.value!==3?null:Re(u.value));function d(){u.value.config={},u.value.commands={}}function k(){T.value=!1,u.value.commandType=j.value,O.value=j.value,u.value.commands={},j.value=""}function z(){T.value=!1,j.value=""}async function H(){f.value<$.length-1&&(f.value++,f.value===3&&await $e())}function I(){f.value>0&&f.value--}function M(){T.value||(U.value=!0)}function C(){U.value=!1,F()}function F(){y("close"),setTimeout(()=>{f.value=0,u.value={platform:"",manufacturer:"",model:"",broadlinkDevice:"",commandType:"ir",config:{},commands:{}},O.value="ir"},300)}async function ee(){var x,n,m,p,R;b.value=!0;try{if(!h.value){const J=await fetch("api/smartir/config/check");if(J.ok){const re=await J.json();if(!((x=re.platforms[u.value.platform])==null?void 0:x.file_exists)){A.value=re.configuration_warnings||[],L.value=re.config_path||"/config",o.value={platform:u.value.platform,json:ve.value},c.value=!0,b.value=!1;return}}}let V;if(s.editMode&&((n=s.editData)!=null&&n.code))V=parseInt(s.editData.code),console.log("ğŸ“ Edit mode: Using existing code",V);else{const J=await fetch(`api/smartir/platforms/${u.value.platform}/next-code`);if(!J.ok)throw new Error("Failed to get next code number");V=(await J.json()).next_code,console.log("âœ¨ New profile: Using next code",V)}const B=await fetch("api/smartir/profiles",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({platform:u.value.platform,json:ve.value,code_number:V})});if(!B.ok){const J=await B.json();throw new Error(J.error||"Failed to save profile")}const oe=await B.json(),Y={name:`${u.value.manufacturer} ${u.value.model}`,unique_id:`${u.value.manufacturer.toLowerCase().replace(/[^a-z0-9]+/g,"_")}_${u.value.model.toLowerCase().replace(/[^a-z0-9]+/g,"_")}`,device_code:V,controller_data:u.value.broadlinkDevice},K=await fetch("api/smartir/config/add-device",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({platform:u.value.platform,device_config:Y})});if(!K.ok){const J=await K.json();console.error("Failed to add device to config:",J),(m=r.value)==null||m.warning(`Profile saved but failed to add to config file: ${J.error}`,"âš ï¸ Partial Success")}y("save",{json:ve.value,yaml:G.value,profile:u.value,saved_to:oe.path}),(p=r.value)==null||p.success(`File: ${oe.filename}
Device Code: ${V}
Added to: smartir/${u.value.platform}.yaml

âš ï¸ Restart Home Assistant to activate`,"âœ… Profile Saved Successfully!"),F()}catch(V){console.error("Error saving profile:",V),(R=r.value)==null||R.error(V.message,"âŒ Error Saving Profile")}finally{b.value=!1}}async function ye(){h.value=!0,c.value=!1,o.value&&(await ee(),o.value=null)}function he(){var x,n;try{const m=JSON.stringify(ve.value,null,2),p=new Blob([m],{type:"application/json"}),R=URL.createObjectURL(p),V=document.createElement("a");V.href=R;const B=u.value.manufacturer.toLowerCase().replace(/\s+/g,"_"),oe=u.value.model.toLowerCase().replace(/\s+/g,"_");V.download=`smartir_${u.value.platform}_${B}_${oe}.json`,document.body.appendChild(V),V.click(),document.body.removeChild(V),URL.revokeObjectURL(R),(x=r.value)==null||x.success("You can manually upload this file to your SmartIR codes directory.","âœ… Profile Downloaded")}catch(m){console.error("Error downloading profile:",m),(n=r.value)==null||n.error(m.message,"âŒ Error Downloading Profile")}}async function _e(x,n,m){const p=x.toLowerCase().replace(/[^a-z0-9]+/g,"_"),R=n.toLowerCase().replace(/[^a-z0-9]+/g,"_"),V=`${p}_${R}`;try{const B=await fetch("/api/commands/all");if(!B.ok)return console.error("Failed to fetch commands from Broadlink storage"),m;const Y=(await B.json())[V]||{};console.log(`ğŸ” Fetching learned commands for device: ${V}`),console.log("ğŸ“¦ Device commands from storage:",Y);const K={...m};for(const[J,re]of Object.entries(K))if(re==="pending"&&Y[J])K[J]=Y[J];else if(typeof re=="object"){for(const[Ie,Ae]of Object.entries(re))if(typeof Ae=="object")for(const[Me,Ze]of Object.entries(Ae)){const Fe=`${J}_${Ie}_${Me}`;Ze==="pending"&&Y[Fe]&&(K[J][Ie][Me]=Y[Fe])}else if(Ae==="pending"){const Me=`${J}_${Ie}`;Y[Me]&&(K[J][Ie]=Y[Me])}}return console.log("âœ… Merged commands:",K),K}catch(B){return console.error("Error fetching learned commands:",B),m}}function De(x){const n={manufacturer:x.manufacturer,supportedModels:[x.model],supportedController:"Broadlink",commandsEncoding:"Base64",commandType:x.commandType||"ir",commands:{}};return x.platform==="climate"&&(n.minTemperature=x.config.minTemp,n.maxTemperature=x.config.maxTemp,n.precision=x.config.precision||1,n.operationModes=x.config.modes||[],n.fanModes=x.config.fanModes&&x.config.fanModes.length>0?x.config.fanModes:["auto"],x.config.swingModes&&x.config.swingModes.length>0&&(n.swingModes=x.config.swingModes),n.commands=x.commands),n}function Re(x){let n=`# SmartIR ${x.platform} configuration
`;return n+=`# Generated by Broadlink Manager v2

`,x.platform==="climate"&&(n+=`climate:
`,n+=`  - platform: smartir
`,n+=`    name: ${x.manufacturer} ${x.model}
`,n+=`    unique_id: ${x.manufacturer.toLowerCase()}_${x.model.toLowerCase().replace(/\s+/g,"_")}
`,n+=`    device_code: 10000  # Change this to your custom code number
`,n+=`    controller_data: ${x.broadlinkDevice}
`,x.config.tempSensor&&(n+=`    temperature_sensor: ${x.config.tempSensor}
`),x.config.humiditySensor&&(n+=`    humidity_sensor: ${x.config.humiditySensor}
`),x.config.powerSensor&&(n+=`    power_sensor: ${x.config.powerSensor}
`)),n}async function ie(){try{console.log("Fetching remote devices from api/remote/devices...");const x=await fetch("api/remote/devices");if(console.log("Response status:",x.status,x.ok),x.ok){const n=await x.json();console.log("Loaded remote devices response:",n);const m=n.devices||[];console.log("Extracted devices array:",m),console.log("Device count:",m.length),t.value=m,console.log("broadlinkDevices.value set to:",t.value),console.log("Final device count:",t.value.length)}else console.error("Response not OK:",x.status,x.statusText),t.value=[]}catch(x){console.error("Error loading remote devices:",x),t.value=[]}}return ue(()=>s.show,x=>{if(x){const n=Number.isInteger(s.startStep)?s.startStep:0;f.value=Math.min(Math.max(n,0),$.length-1)}}),ue(()=>s.startStep,x=>{if(s.show){const n=Number.isInteger(x)?x:0;f.value=Math.min(Math.max(n,0),$.length-1)}}),Se(()=>{s.show&&ie()}),(x,n)=>l.show?(a(),i("div",{key:0,class:"modal-overlay",onClick:M},[e("div",{class:"modal-container",onClick:n[19]||(n[19]=de(()=>{},["stop"]))},[e("div",Xi,[e("h2",null,[n[22]||(n[22]=e("i",{class:"mdi mdi-file-document-edit"},null,-1)),S(" "+g(l.editMode?"Edit SmartIR Profile":"Create SmartIR Profile"),1)]),e("button",{onClick:F,class:"close-button"},[...n[23]||(n[23]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Yi,[(a(),i(me,null,ge($,(m,p)=>e("div",{key:p,class:Q(["step",{active:f.value===p,completed:f.value>p}])},[e("div",Zi,[f.value>p?(a(),i("i",Qi)):(a(),i("span",er,g(p+1),1))]),e("span",tr,g(m.label),1)],2)),64))]),e("div",or,[f.value===0?(a(),i("div",lr,[n[29]||(n[29]=e("h3",null,"Device Information",-1)),e("div",nr,[n[25]||(n[25]=e("label",null,"Platform Type *",-1)),q(e("select",{"onUpdate:modelValue":n[0]||(n[0]=m=>u.value.platform=m),onChange:d},[...n[24]||(n[24]=[Le('<option value="" data-v-3be16ae4>Select platform...</option><option value="climate" data-v-3be16ae4>ğŸŒ¡ï¸ Climate (AC, Heater, Heat Pump)</option><option value="media_player" data-v-3be16ae4>ğŸ“º Media Player (TV, Receiver)</option><option value="fan" data-v-3be16ae4>ğŸŒ€ Fan</option><option value="light" data-v-3be16ae4>ğŸ’¡ Light (LED Strip, IR Light)</option>',5)])],544),[[Ce,u.value.platform]])]),e("div",sr,[n[26]||(n[26]=e("label",null,"Manufacturer *",-1)),q(e("input",{"onUpdate:modelValue":n[1]||(n[1]=m=>u.value.manufacturer=m),type:"text",placeholder:"e.g., Daikin, LG, Samsung"},null,512),[[we,u.value.manufacturer]])]),e("div",ar,[n[27]||(n[27]=e("label",null,"Model(s) *",-1)),q(e("input",{"onUpdate:modelValue":n[2]||(n[2]=m=>u.value.model=m),type:"text",placeholder:"e.g., FTXS35K, Multiple models"},null,512),[[we,u.value.model]]),n[28]||(n[28]=e("small",null,'Enter model number or "Multiple" if it works with many models',-1))])])):E("",!0),f.value===1?(a(),i("div",ir,[u.value.platform==="climate"?(a(),xe(Ta,{key:0,modelValue:u.value.config,"onUpdate:modelValue":n[3]||(n[3]=m=>u.value.config=m)},null,8,["modelValue"])):u.value.platform==="media_player"?(a(),i("div",rr,[n[36]||(n[36]=e("h3",null,"Media Player Configuration",-1)),n[37]||(n[37]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),S(" Configure the features your media player supports. You'll learn the IR commands in the next step. ")],-1)),e("div",dr,[n[35]||(n[35]=e("h4",null,"Supported Features",-1)),e("div",ur,[e("label",cr,[q(e("input",{type:"checkbox",value:"turn_on","onUpdate:modelValue":n[4]||(n[4]=m=>N.value=m)},null,512),[[se,N.value]]),n[30]||(n[30]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),S(" Power On/Off ")],-1))]),e("label",mr,[q(e("input",{type:"checkbox",value:"volume","onUpdate:modelValue":n[5]||(n[5]=m=>N.value=m)},null,512),[[se,N.value]]),n[31]||(n[31]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-volume-high"}),S(" Volume Control ")],-1))]),e("label",vr,[q(e("input",{type:"checkbox",value:"mute","onUpdate:modelValue":n[6]||(n[6]=m=>N.value=m)},null,512),[[se,N.value]]),n[32]||(n[32]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-volume-mute"}),S(" Mute ")],-1))]),e("label",pr,[q(e("input",{type:"checkbox",value:"source","onUpdate:modelValue":n[7]||(n[7]=m=>N.value=m)},null,512),[[se,N.value]]),n[33]||(n[33]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-import"}),S(" Source Selection ")],-1))]),e("label",fr,[q(e("input",{type:"checkbox",value:"channel","onUpdate:modelValue":n[8]||(n[8]=m=>N.value=m)},null,512),[[se,N.value]]),n[34]||(n[34]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-numeric"}),S(" Channel Control ")],-1))])])])])):u.value.platform==="fan"?(a(),i("div",gr,[n[44]||(n[44]=e("h3",null,"Fan Configuration",-1)),n[45]||(n[45]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),S(" Configure the features your fan supports. You'll learn the IR commands in the next step. ")],-1)),e("div",yr,[n[40]||(n[40]=e("h4",null,"Fan Speed Levels",-1)),e("div",br,[n[39]||(n[39]=e("label",null,"Number of Speed Levels *",-1)),q(e("select",{"onUpdate:modelValue":n[9]||(n[9]=m=>Z.value=m)},[...n[38]||(n[38]=[e("option",{value:1},"1 Speed",-1),e("option",{value:2},"2 Speeds",-1),e("option",{value:3},"3 Speeds (Low/Med/High)",-1),e("option",{value:4},"4 Speeds",-1),e("option",{value:5},"5 Speeds",-1),e("option",{value:6},"6 Speeds",-1)])],512),[[Ce,Z.value,void 0,{number:!0}]])])]),e("div",hr,[n[43]||(n[43]=e("h4",null,"Additional Features",-1)),e("div",kr,[e("label",wr,[q(e("input",{type:"checkbox",value:"oscillate","onUpdate:modelValue":n[10]||(n[10]=m=>le.value=m)},null,512),[[se,le.value]]),n[41]||(n[41]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-sync"}),S(" Oscillation ")],-1))]),e("label",$r,[q(e("input",{type:"checkbox",value:"direction","onUpdate:modelValue":n[11]||(n[11]=m=>le.value=m)},null,512),[[se,le.value]]),n[42]||(n[42]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-rotate-3d-variant"}),S(" Direction (Forward/Reverse) ")],-1))])])])])):u.value.platform==="light"?(a(),i("div",Cr,[n[51]||(n[51]=e("h3",null,"Light Configuration",-1)),n[52]||(n[52]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),S(" Configure the features your light supports. You'll learn the IR commands in the next step. ")],-1)),e("div",Sr,[n[50]||(n[50]=e("h4",null,"Supported Features",-1)),e("div",_r,[e("label",Ir,[q(e("input",{type:"checkbox",value:"turn_on","onUpdate:modelValue":n[12]||(n[12]=m=>te.value=m)},null,512),[[se,te.value]]),n[46]||(n[46]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),S(" Power On/Off ")],-1))]),e("label",Dr,[q(e("input",{type:"checkbox",value:"brightness","onUpdate:modelValue":n[13]||(n[13]=m=>te.value=m)},null,512),[[se,te.value]]),n[47]||(n[47]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-brightness-6"}),S(" Brightness Control ")],-1))]),e("label",xr,[q(e("input",{type:"checkbox",value:"color_temp","onUpdate:modelValue":n[14]||(n[14]=m=>te.value=m)},null,512),[[se,te.value]]),n[48]||(n[48]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-thermometer"}),S(" Color Temperature ")],-1))]),e("label",Tr,[q(e("input",{type:"checkbox",value:"rgb","onUpdate:modelValue":n[15]||(n[15]=m=>te.value=m)},null,512),[[se,te.value]]),n[49]||(n[49]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-palette"}),S(" RGB Color ")],-1))])])])])):E("",!0)])):E("",!0),f.value===2?(a(),i("div",Rr,[ce(ni,{modelValue:u.value.commands,"onUpdate:modelValue":n[16]||(n[16]=m=>u.value.commands=m),platform:u.value.platform,config:u.value.config,broadlinkDevice:u.value.broadlinkDevice,"onUpdate:broadlinkDevice":n[17]||(n[17]=m=>u.value.broadlinkDevice=m),manufacturer:u.value.manufacturer,model:u.value.model,commandType:u.value.commandType,"onUpdate:commandType":n[18]||(n[18]=m=>u.value.commandType=m)},null,8,["modelValue","platform","config","broadlinkDevice","manufacturer","model","commandType"])])):E("",!0),f.value===3?(a(),i("div",Ar,[ce(Ti,{profile:u.value,"json-data":ve.value,"yaml-config":G.value},null,8,["profile","json-data","yaml-config"])])):E("",!0)]),e("div",Lr,[f.value>0?(a(),i("button",{key:0,onClick:I,class:"btn-secondary"},[...n[53]||(n[53]=[e("i",{class:"mdi mdi-arrow-left"},null,-1),S(" Back ",-1)])])):E("",!0),n[57]||(n[57]=e("div",{class:"spacer"},null,-1)),e("button",{onClick:F,class:"btn-text"}," Cancel "),f.value<$.length-1?(a(),i("button",{key:1,onClick:H,class:"btn-primary",disabled:!ne.value},[...n[54]||(n[54]=[S(" Next ",-1),e("i",{class:"mdi mdi-arrow-right"},null,-1)])],8,Or)):(a(),i("div",Mr,[e("button",{onClick:ee,class:"btn-primary",disabled:b.value},[n[55]||(n[55]=e("i",{class:"mdi mdi-cloud-upload"},null,-1)),S(" "+g(b.value?"Saving...":"Save to SmartIR"),1)],8,Er),e("button",{onClick:he,class:"btn-secondary",disabled:b.value},[...n[56]||(n[56]=[e("i",{class:"mdi mdi-download"},null,-1),S(" Download JSON ",-1)])],8,Vr)]))])]),ce(Ki,{show:c.value,platform:u.value.platform,warnings:A.value,"config-path":L.value,onClose:n[20]||(n[20]=m=>c.value=!1),onComplete:ye},null,8,["show","platform","warnings","config-path"]),ce(Te,{isOpen:T.value,title:"Change Command Type?",message:"Changing the command type will clear all learned commands. Continue?",confirmText:"Continue",cancelText:"Cancel",dangerMode:!0,onConfirm:k,onCancel:z},null,8,["isOpen"]),ce(Te,{isOpen:U.value,title:"Close Profile Builder?",message:"Are you sure you want to close? Your progress will be lost.",confirmText:"Close",cancelText:"Keep Editing",dangerMode:!0,onConfirm:C,onCancel:n[21]||(n[21]=m=>U.value=!1)},null,8,["isOpen"])])):E("",!0)}},Pr=pe(jr,[["__scopeId","data-v-3be16ae4"]]),Ur={class:"dashboard"},Fr={__name:"Dashboard",setup(l){const v=Ee(),s=ke("smartirEnabled"),y=w(!1),r=w(!1),f=w(null),b=w(0),t=w(null);function c(){r.value=!1,f.value=null,b.value=0,y.value=!0}async function A({platform:T,profile:U,startStep:j}){b.value=Number.isInteger(j)?j:0;try{const O=await fetch(`api/smartir/platforms/${T}/profiles/${U.code}`);if(!O.ok)throw new Error("Failed to load profile");const _=await O.json();let $="";try{const u=await fetch(`api/smartir/config/get-device?platform=${T}&code=${U.code}`);u.ok?($=(await u.json()).controller_data||"",console.log("âœ… Found controller_data from YAML:",$)):console.warn("âš ï¸ No YAML entry found for this profile (this is OK for profiles not yet added to config)")}catch(u){console.warn("âš ï¸ Could not fetch controller_data from config:",u)}r.value=!0,f.value={platform:T,code:U.code,profile:{..._.profile,controller_data:$}},y.value=!0}catch(O){console.error("Error loading profile for edit:",O),v.error("Failed to load profile for editing")}}function L(){y.value=!1,r.value=!1,f.value=null}function h(){console.log("Show install guide clicked"),window.open("https://github.com/smartHomeHub/SmartIR","_blank")}async function o(T){console.log("Profile saved:",T),L(),t.value&&t.value.loadAllProfiles&&(await t.value.loadAllProfiles(),console.log("âœ… Profiles list refreshed"))}return(T,U)=>(a(),i("div",Ur,[be(s)?(a(),xe(ss,{key:0})):E("",!0),U[0]||(U[0]=Le('<div class="welcome-banner" data-v-fbe628f8><div class="banner-content" data-v-fbe628f8><div class="banner-icon" data-v-fbe628f8><i class="mdi mdi-rocket-launch" data-v-fbe628f8></i></div><div class="banner-text" data-v-fbe628f8><h2 data-v-fbe628f8>Welcome to Broadlink Manager v2!</h2><p data-v-fbe628f8>Manage your IR/RF devices with a modern Vue 3 interface</p></div></div><div class="status-badges" data-v-fbe628f8><span class="badge success" data-v-fbe628f8><i class="mdi mdi-check-circle" data-v-fbe628f8></i> Vue 3 Ready </span><span class="badge warning" data-v-fbe628f8><i class="mdi mdi-beta" data-v-fbe628f8></i> Beta </span></div></div>',1)),ce(Qn),be(s)?(a(),xe(Xs,{key:1,ref_key:"smartirStatusCard",ref:t,onCreateProfile:c,onEditProfile:A,onShowInstallGuide:h},null,512)):E("",!0),ce(Pr,{show:y.value,editMode:r.value,editData:f.value,startStep:b.value,onClose:L,onSave:o},null,8,["show","editMode","editData","startStep"])]))}},Nr=pe(Fr,[["__scopeId","data-v-fbe628f8"]]),Br={class:"toast-container"},Hr={class:"toast-content"},qr={key:0,class:"toast-title"},zr={class:"toast-message"},Jr={key:1,class:"toast-description"},Wr=["onClick"],Gr={__name:"Toast",setup(l,{expose:v}){const s=w([]);let y=0;function r(t){const c={success:"mdi-check-circle",error:"mdi-alert-circle",warning:"mdi-alert",info:"mdi-information"};return c[t]||c.info}function f({message:t,title:c,description:A,type:L="info",duration:h=5e3}){const o=y++,T={id:o,message:t,title:c,description:A,type:L};return s.value.push(T),h>0&&setTimeout(()=>{b(o)},h),o}function b(t){const c=s.value.findIndex(A=>A.id===t);c>-1&&s.value.splice(c,1)}return v({addToast:f,removeToast:b,show:f,success:(t,c)=>f({message:t,title:c,type:"success"}),error:(t,c)=>f({message:t,title:c,type:"error",duration:8e3}),warning:(t,c)=>f({message:t,title:c,type:"warning",duration:6e3}),info:(t,c)=>f({message:t,title:c,type:"info"})}),(t,c)=>(a(),xe(We,{to:"body"},[e("div",Br,[ce(ot,{name:"toast"},{default:Pe(()=>[(a(!0),i(me,null,ge(s.value,A=>(a(),i("div",{key:A.id,class:Q(["toast",[`toast-${A.type}`]])},[e("i",{class:Q(["mdi",r(A.type)])},null,2),e("div",Hr,[A.title?(a(),i("div",qr,g(A.title),1)):E("",!0),e("div",zr,g(A.message),1),A.description?(a(),i("div",Jr,g(A.description),1)):E("",!0)]),e("button",{onClick:L=>b(A.id),class:"toast-close"},[...c[0]||(c[0]=[e("i",{class:"mdi mdi-close"},null,-1)])],8,Wr)],2))),128))]),_:1})])]))}},Kr=pe(Gr,[["__scopeId","data-v-bf1fd466"]]),Xr={id:"app",class:"app-container"},Yr={class:"app-header"},Zr={class:"header-content"},Qr={class:"header-right"},ed=["title"],td={class:"settings-menu-container"},od={key:0,class:"settings-menu"},ld=["title"],nd={class:"toggle-content"},sd={key:0,class:"not-installed-label"},ad={key:0,href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"menu-item menu-link menu-subitem"},id=["disabled"],rd=["disabled"],dd=["disabled"],ud={class:"app-main"},cd={__name:"App",setup(l){const v=w(null),s=w("light"),y=w(null),r=w(!1),f=w(!1),b=w(!1),t=w(localStorage.getItem("smartir_enabled")!=="false"),c=W(()=>{var $;return(($=y.value)==null?void 0:$.installed)||!1}),A=W(()=>({light:"mdi mdi-weather-sunny",medium:"mdi mdi-weather-partly-cloudy",dark:"mdi mdi-weather-night"})[s.value]),L=W(()=>({light:"Switch to Medium Theme",medium:"Switch to Dark Theme",dark:"Switch to Light Theme"})[s.value]),h=()=>{const $=["light","medium","dark"],N=($.indexOf(s.value)+1)%$.length;s.value=$[N],document.body.classList.remove("medium-mode","dark-mode"),s.value==="medium"?document.body.classList.add("medium-mode"):s.value==="dark"&&document.body.classList.add("dark-mode"),localStorage.setItem("theme",s.value)},o=async()=>{try{const $=await Xe.getStatus();y.value=$,$.installed?console.log("âœ… SmartIR detected:",$.version):console.log("â„¹ï¸ SmartIR not detected")}catch($){console.error("Error checking SmartIR:",$),y.value={installed:!1,error:$.message}}},T=async()=>{var $,u;f.value=!0;try{const Z=(await ae.get("/api/diagnostics/markdown")).data.markdown;await navigator.clipboard.writeText(Z),($=v.value)==null||$.success("Diagnostic summary copied to clipboard!"),r.value=!1}catch(N){console.error("Error copying diagnostics:",N),(u=v.value)==null||u.error("Failed to copy diagnostics")}finally{f.value=!1}},U=async()=>{var $,u;f.value=!0;try{const N=await ae.get("/api/diagnostics/download",{responseType:"blob"}),Z=window.URL.createObjectURL(new Blob([N.data])),le=document.createElement("a");le.href=Z;const te=N.headers["content-disposition"];let fe="broadlink_manager_diagnostics.zip";if(te){const D=te.match(/filename="?(.+)"?/);D&&(fe=D[1])}le.setAttribute("download",fe),document.body.appendChild(le),le.click(),le.remove(),window.URL.revokeObjectURL(Z),($=v.value)==null||$.success("Diagnostic bundle downloaded!"),r.value=!1}catch(N){console.error("Error downloading diagnostics:",N),(u=v.value)==null||u.error("Failed to download diagnostics")}finally{f.value=!1}},j=()=>{c.value&&(t.value=!t.value,localStorage.setItem("smartir_enabled",t.value.toString()),window.location.reload())},O=async()=>{var $,u,N;b.value=!0;try{const Z=await ae.post("/api/smartir/refresh-index");Z.data.success?($=v.value)==null||$.success(`Updated to v${Z.data.version} (${Z.data.total_devices} devices)`,"âœ… Index Updated"):(u=v.value)==null||u.error(Z.data.error||"Unknown error","âŒ Update Failed")}catch(Z){console.error("Error updating SmartIR index:",Z),(N=v.value)==null||N.error("Failed to update device index","âŒ Update Error")}finally{b.value=!1,r.value=!1}},_=$=>{$.target.closest(".settings-menu-container")||(r.value=!1)};return Se(async()=>{const $=localStorage.getItem("theme");$&&["light","medium","dark"].includes($)?(s.value=$,$==="medium"?document.body.classList.add("medium-mode"):$==="dark"&&document.body.classList.add("dark-mode")):localStorage.getItem("darkMode")==="true"&&(s.value="dark",document.body.classList.add("dark-mode"),localStorage.setItem("theme","dark")),await o();const u=He();u&&v.value&&(u.appContext.config.globalProperties.$toast=v.value),document.addEventListener("click",_)}),qe(()=>{document.removeEventListener("click",_)}),je("smartirStatus",y),je("smartirEnabled",t),je("refreshSmartIR",o),je("toast",v),($,u)=>(a(),i("div",Xr,[e("header",Yr,[e("div",Zr,[u[13]||(u[13]=e("div",{class:"header-left"},[e("i",{class:"mdi mdi-remote"}),e("h1",null,"Broadlink Manager v2"),e("span",{class:"beta-badge"},"BETA")],-1)),e("div",Qr,[e("button",{onClick:h,class:"icon-button",title:L.value},[e("i",{class:Q(A.value)},null,2)],8,ed),e("div",td,[e("button",{onClick:u[0]||(u[0]=N=>r.value=!r.value),class:"icon-button",title:"Settings"},[...u[2]||(u[2]=[e("i",{class:"mdi mdi-cog"},null,-1)])]),r.value?(a(),i("div",od,[u[9]||(u[9]=e("div",{class:"menu-section-title"},"Integration Settings",-1)),e("div",{class:Q(["menu-item toggle-item",{disabled:!c.value}]),onClick:u[1]||(u[1]=N=>c.value?j():null),title:c.value?"":"SmartIR is not installed"},[e("div",nd,[u[3]||(u[3]=e("i",{class:"mdi mdi-air-conditioner"},null,-1)),u[4]||(u[4]=e("span",null,"SmartIR Integration",-1)),c.value?E("",!0):(a(),i("span",sd,"(Not Installed)"))]),e("div",{class:Q(["toggle-switch",{active:t.value&&c.value,disabled:!c.value}])},[...u[5]||(u[5]=[e("div",{class:"toggle-slider"},null,-1)])],2)],10,ld),t.value?(a(),i("a",ad,[...u[6]||(u[6]=[e("i",{class:"mdi mdi-github"},null,-1),e("span",null,"SmartIR on GitHub",-1)])])):E("",!0),t.value?(a(),i("button",{key:1,onClick:O,class:"menu-item menu-subitem",disabled:b.value},[e("i",{class:Q(["mdi",b.value?"mdi-loading mdi-spin":"mdi-refresh"])},null,2),e("span",null,g(b.value?"Updating...":"Update Device Index"),1)],8,id)):E("",!0),u[10]||(u[10]=e("div",{class:"menu-divider"},null,-1)),u[11]||(u[11]=e("div",{class:"menu-section-title"},"Diagnostics",-1)),e("button",{onClick:T,class:"menu-item",disabled:f.value},[...u[7]||(u[7]=[e("i",{class:"mdi mdi-content-copy"},null,-1),e("span",null,"Copy Diagnostics",-1)])],8,rd),e("button",{onClick:U,class:"menu-item",disabled:f.value},[...u[8]||(u[8]=[e("i",{class:"mdi mdi-download"},null,-1),e("span",null,"Download Diagnostics",-1)])],8,dd),u[12]||(u[12]=Le('<div class="menu-divider" data-v-b6ab76ba></div><div class="menu-section-title" data-v-b6ab76ba>Help &amp; Support</div><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2#readme" target="_blank" class="menu-item menu-link" data-v-b6ab76ba><i class="mdi mdi-book-open-variant" data-v-b6ab76ba></i><span data-v-b6ab76ba>Documentation</span></a><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2/issues" target="_blank" class="menu-item menu-link" data-v-b6ab76ba><i class="mdi mdi-bug" data-v-b6ab76ba></i><span data-v-b6ab76ba>Report Issue</span></a><div class="menu-divider" data-v-b6ab76ba></div><div class="menu-section-title" data-v-b6ab76ba>Community</div><a href="https://community.home-assistant.io/t/broadlink-manager-modern-web-interface-for-broadlink-devices/938473" target="_blank" class="menu-item menu-link" data-v-b6ab76ba><i class="mdi mdi-forum" data-v-b6ab76ba></i><span data-v-b6ab76ba>HA Forum Discussion</span></a><a href="https://www.reddit.com/r/homeassistant/comments/1o1q3kf/release_broadlink_manager_addon_a_modern_web_ui/" target="_blank" class="menu-item menu-link" data-v-b6ab76ba><i class="mdi mdi-reddit" data-v-b6ab76ba></i><span data-v-b6ab76ba>Reddit Discussion</span></a><div class="menu-divider" data-v-b6ab76ba></div><div class="menu-section-title" data-v-b6ab76ba>Project</div><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2" target="_blank" class="menu-item menu-link" data-v-b6ab76ba><i class="mdi mdi-github" data-v-b6ab76ba></i><span data-v-b6ab76ba>GitHub Repository</span></a><a href="https://ko-fi.com/tonyperkins" target="_blank" class="menu-item menu-link menu-item-sponsor" data-v-b6ab76ba><i class="mdi mdi-coffee" data-v-b6ab76ba></i><span data-v-b6ab76ba>Support on Ko-fi</span></a>',12))])):E("",!0)])])])]),e("main",ud,[ce(Nr)]),u[14]||(u[14]=e("footer",{class:"app-footer"},[e("p",null,"Broadlink Manager v2.0.0-beta.1 | Built with Vue 3")],-1)),ce(Kr,{ref_key:"toastRef",ref:v},null,512)]))}},md=pe(cd,[["__scopeId","data-v-b6ab76ba"]]),Ye=lt(md),vd=nt();Ye.use(vd);Ye.mount("#app");
