import{g as He,a as Qe,d as et,c as J,r as b,o as De,b as i,e as s,f as e,h as E,n as X,u as Se,t as p,i as _,w as ue,j as z,v as _e,F as ge,k as be,l as me,m as qe,p as ve,q as Ve,s as Pe,T as Je,x as ke,y as we,z as Me,A as de,B as ze,C as Ue,D as xe,E as We,G as Ge,H as tt,I as ot,J as je,K as lt,L as nt}from"./vendor-joC09iIB.js";(function(){const y=document.createElement("link").relList;if(y&&y.supports&&y.supports("modulepreload"))return;for(const k of document.querySelectorAll('link[rel="modulepreload"]'))$(k);new MutationObserver(k=>{for(const n of k)if(n.type==="childList")for(const w of n.addedNodes)w.tagName==="LINK"&&w.rel==="modulepreload"&&$(w)}).observe(document,{childList:!0,subtree:!0});function d(k){const n={};return k.integrity&&(n.integrity=k.integrity),k.referrerPolicy&&(n.referrerPolicy=k.referrerPolicy),k.crossOrigin==="use-credentials"?n.credentials="include":k.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function $(k){if(k.ep)return;k.ep=!0;const n=d(k);fetch(k.href,n)}})();function Ae(){const l=He(),y=l==null?void 0:l.appContext.config.globalProperties.$toast;return y||(console.warn("Toast not available"),{success:d=>console.log("Success:",d),error:d=>console.error("Error:",d),warning:d=>console.warn("Warning:",d),info:d=>console.info("Info:",d)})}const Ne="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAHBUlEQVR4nOxZC1BTVxo+9+aNZI2LNsgjWR4hgoIiRVDBslKnIKPbx1jqTrtYoakat1a6dNsdd7t1X8XHyAbEhdUu1u2mXdbasqJbtsaMIqBBECiPBmqEICEBEx4xJLlJ7s6lw6rJDeQ2FzLM+M1kBs7/3+/83zn/Oee/51JRFAXzGbCvA/AWjwX4GvNeANWXnXffHQ4+K6/dYbHeD+IFhjRkb1wn9WPQbEQ4IF/tQlXX2p5+/8OyczY74j/VxuMG3Sh/Oz9jaQDb4CmPT1LIbLXBfzrz0cmHg8fQpx1Yc1Ra+TsiXD4R0PqtRmAyj/LxbJeaujKIcPlEAINOM7vLXBaTZibCRWgRq3WGJZWX63aoNDpB8BJOX/bGlIqwpUv6iXBgWBHG7eUF8urUWvU6Z9sLGxI/IsLl8SJu6u4XigqPXkVspiVTbTQqU1/6Vn7ammh+G5FOMZyqludIKqUVU/9jcaSuTCo/unfHbiad4iBdwMu/P1bV1tO1xbk9NDC0/vwHB1xGcjqYLAh16zsHW3R6XXTu1mfFdAqMrIoSKNbGhLcQ4QGeppDJ7ACtPcqNEI6tT9O3Vqm+tygqNMDjrU9Sef6tIYM2JjUuuXzfC5knCEXsBI8WMZUCAxiCrfhWyMZkMNzYXNHVpwmXXqp5j0Hz0/1m57a3PQ8VHx4JoNMASIl9shLPFsB5ooO7iDXhCY/dAcCvT/79LwC1s/K2bDnAXcQeJRqwMzzeRt/bua0gLChcDsCDNQNBkEU/qot7o6j0kzETQpuJ40ZnT6xSrUoNWhyseHVz2ikv4n4QA5FSArE5IFlTZ0r3XU1MWODib6NCl3a9dkhSYxgbjo4XLq8sL9j7Ip36YEwMRjMNQazMhf7+RgYNnuyo7bY6ArFaWKuXRX495wLwoLk39sO9RaVnM5OTP8zLSjtjsljpp6ovi6pqr706eE8XBwGUSqEy9Guihf/92TMZhetjI5rJCHwKpBRzZqsNYtKp6KD+Pvv1w5ILdzR3UvD8HA4YefOl7N25JKUPIKuUwIJH7A5of/GJf7oLfrIz2EH786fSss+uKFzOk+8L0mqh6rpbmR0q5YyFGAQBSuHHlcUWxEaZyXfMhFD0Rgt9Oh/SBMiam58HAO+oc4XZMsK/1taT6M6uHjJw8w6VSNfvemM8TbzPlFlwsP5KyzfJeL6kCejXDgo894aASqOZ9O/uHwzq6B3ijhitkzOC7XS7j0g+V3S0vQTDDhYEoZSBobvJ+yXFNZ29gy4lOGmvlDBMIfQqSKV8539EWvXHhvbGHBSFrAwGW+vvxzLoR7RxzrNpsyPs0xcv7/lg1/ZfPtKvuw7MVhulUakWdvRq+XY3tWFT90Bk+52BCOzvyOBgjytSFKAgms+b9F/2o+BbKwUrvgjhhjSjKLAPG4YE7lJxfEIf5dyGOwMXrren/eF0RYXRNMrHDt4QbmjDEbHop9F8rqpddZd3sV6R/aWiabtWr41PW534V8m+PFHW+qSPL9TX7oM8WAaBi4IbE4S8yYNs/7asIgBA0ZStRqFM/MXxIzcgHBEBP+C6DJKLgJvK3uXvniitBsDmNzkSEAD9uv5k0aFjXy1gMQ0DQ5p4CAIwNuXLwyL/ExcpqMWeS42NUmxKXFf8VWPdz6cLnkqhGd/Pe+U1Cow/+ekJUYr4qJgvbik7f/Jw+0J/tjpvS3qxs7/LQZZfcrrkUmOdGI/cgUKIkB8pz0xK+CQjKf6z4MWckYftZqsderfsTInsZt0evDRgMRYMHhaLnk+NW1Y/nchxk5lZ+I/Pf/vl9RvbLYiVlSBcJv/VK9sKBCHc3hkF7D12/NzVltZn8YhzNj/3ev6LGeXTdQ6+uzLZ+C+5XNza05Nsd1gXcNgBvekJK/+du3lTUSiXMzzT80TgkkK8wJAGgCMAE5ooFFz3hHTr+lgZ9iMryOngkoi5WZuOc9hPtDu3r4198nTqygjCr3wYmrvVkSerZXljJoT0m0DcYm5g2Mg5WV39zrVWZZofkzaRnhB/bufm9FI/JpXQXj8F8bHyitqWxhzJmwUJT60SNJER+P+BCZjt34lzNbvickRoWVWNmGzuObnYWhER3oAdX41dPbj1jDeYEwGrInltKKCNtatub6hRfJOEnfJkcc+JgE9ltS/DkINuNI3xCo4fbXgm/0CnouvOcjK4Z/16/ZKia+3+kqIrEIQ+sgNx2Jzb5wsPxrD9GBZv+Gd9BqSXr4icg8cwMj4SLmv6+mlv+WddgGlilOPOZkEmFnrLP+sCVgtXyPHaHShkiw0XXPWWf9YF5Gb9uGzp4sCbj7ai4LkNTx2O5nPV3vLPyTeye6P32X+7KNujVKtSYJg+viEu/mx2etJZCgnD57OPfGRh3n8nfizA15j3Av4XAAD//5k1S2w3zfwVAAAAAElFTkSuQmCC",ce=Qe.create({baseURL:"./",timeout:3e4,headers:{"Content-Type":"application/json"}});ce.interceptors.request.use(l=>l,l=>Promise.reject(l));ce.interceptors.response.use(l=>l,l=>(console.error("API Error:",l),l.response?console.error("Response error:",l.response.data):l.request?console.error("No response received"):console.error("Request setup error:",l.message),Promise.reject(l)));const st=et("devices",{state:()=>({devices:[],loading:!1,error:null,selectedDevice:null}),getters:{deviceById:l=>y=>l.devices.find(d=>d.id===y),devicesByType:l=>y=>l.devices.filter(d=>d.entity_type===y),deviceCount:l=>l.devices.length,hasDevices:l=>l.devices.length>0},actions:{async loadDevices(l=!1){this.loading=!0,this.error=null;try{const y=l?`/api/devices/managed?_t=${Date.now()}`:"/api/devices/managed",d=await ce.get(y);this.devices=d.data.devices||[],console.log("ğŸ“¥ Loaded devices:",this.devices),this.devices.forEach($=>{console.log(`ğŸ“¥ Device "${$.name}":`,{id:$.id,device:$.device,commands:$.commands,commandCount:$.commands?Object.keys($.commands).length:0})})}catch(y){this.error=y.message,console.error("Error loading devices:",y)}finally{this.loading=!1}},async createDevice(l){this.loading=!0,this.error=null;try{console.log("ğŸª Store: Creating device with data:",l),console.log("ğŸª Store: Device commands being sent:",l.commands);const y={device_name:l.name,device:l.device,area_id:l.area||"",area_name:l.area||"",entity_type:l.entity_type,icon:l.icon,broadlink_entity:l.broadlink_entity,device_type:l.device_type||"broadlink",commands:l.commands||{}};l.device_type==="smartir"&&l.smartir_config&&(y.smartir_config=l.smartir_config),console.log("ğŸª Store: Transformed data for backend:",y);const d=await ce.post("/api/devices/managed",y);return console.log("ğŸª Store: Create response:",d.data),await this.loadDevices(),d.data}catch(y){throw console.error("Error creating device:",y),y}finally{this.loading=!1}},async updateDevice(l,y){this.loading=!0,this.error=null;try{const d=await ce.put(`/api/devices/managed/${l}`,y);return await this.loadDevices(),d.data}catch(d){throw console.error("Error updating device:",d),d}finally{this.loading=!1}},async deleteDevice(l,y=!1){this.loading=!0,this.error=null;try{await ce.delete(`/api/devices/managed/${l}`,{data:{delete_commands:y}}),this.devices=this.devices.filter(d=>d.id!==l)}catch(d){throw this.error=d.message,console.error("Error deleting device:",d),d}finally{this.loading=!1}},selectDevice(l){this.selectedDevice=l},clearSelection(){this.selectedDevice=null},clearError(){this.error=null},async syncAllAreas(){if(!this.devices||this.devices.length===0){console.log("âš ï¸ No devices to sync");return}console.log(`ğŸ”„ Syncing areas from Home Assistant for ${this.devices.length} devices...`);try{const l=await Promise.all(this.devices.map($=>(console.log(`ğŸ”„ Syncing device: ${$.id} (${$.name})`),ce.post(`/api/devices/${$.id}/sync-area`).then(k=>k.data.success&&k.data.area?(console.log(`âœ… Synced area for ${$.name}: ${k.data.area}`),{status:"synced",device:$.name}):{status:"no_area"}).catch(k=>{var n;return((n=k.response)==null?void 0:n.status)===404?(console.log(`âŒ Device not found in HA: ${$.id}`),{status:"not_found"}):(console.warn(`âš ï¸ Failed to sync area for ${$.id}:`,k.message),{status:"error",error:k.message})})))),y=l.filter($=>$.status==="synced").length,d=l.filter($=>$.status==="not_found").length;await this.loadDevices(!0),y>0?console.log(`âœ… Area sync complete: ${y} synced, ${d} not found in HA`):d>0&&console.log(`â„¹ï¸ No areas synced - ${d} entities not found in HA registry (generate entities first)`)}catch(l){console.debug("Area sync error:",l)}}}});function Ke(l){const y=J(()=>l.value||l),d=J(()=>{switch(y.value){case"climate":return"mdi:air-conditioner";case"fan":return"mdi:fan";case"light":return"mdi:lightbulb";case"media_player":return"mdi:television";case"switch":return"mdi:light-switch";default:return"mdi:devices"}}),$=J(()=>`device-type-${y.value}-color`),k=J(()=>`tag-${y.value}-bg`);return{icon:d,colorClass:$,tagBgClass:k}}const at=""+new URL("broadlink-logo-BDjImjRY.png",import.meta.url).href,he=(l,y)=>{const d=l.__vccOpts||l;for(const[$,k]of y)d[$]=k;return d},it={class:"device-header"},rt={class:"device-info"},dt=["title"],ut={class:"device-labels"},ct={class:"device-type"},mt=["src","alt","title"],vt={class:"device-body"},pt={class:"device-stats"},ft={class:"stat",title:"Learned command count"},gt={class:"stat",title:"HA Assigned Area"},yt={class:"device-meta"},bt={class:"device-id",title:"Device ID"},ht={key:0,class:"storage-name"},kt={key:1,class:"broadlink-entity",title:"Controller Device"},wt={key:2,class:"controller-device"},$t={class:"device-actions"},Ct=["disabled"],St=["disabled"],_t=["disabled"],It={key:0,class:"disabled-overlay"},Dt={__name:"DeviceCard",props:{device:{type:Object,required:!0},broadlinkDevices:{type:Array,default:()=>[]}},emits:["edit","delete","learn"],setup(l){const y=l,d=J(()=>localStorage.getItem("smartir_simulate_not_installed")==="true"),$=J(()=>y.device.device_type==="smartir"&&d.value),k=b(null),n=Ke(J(()=>y.device.entity_type)),w=J(()=>y.device.icon?y.device.icon:n.icon.value),f=o=>o&&o.startsWith("mdi:")?`mdi ${o.replace(":"," mdi-")}`:`mdi mdi-${o}`,C=J(()=>({light:"Light",fan:"Fan",switch:"Switch",media_player:"Media Player",cover:"Cover"})[y.device.entity_type]||y.device.entity_type),T=J(()=>(y.device.device_type||"broadlink")==="smartir"?"SmartIR":"Broadlink"),A=J(()=>(y.device.device_type||"broadlink")==="smartir"?Ne:at),h=J(()=>(y.device.device_type||"broadlink")==="smartir"?k.value!==null?k.value:0:Object.keys(y.device.commands||{}).length),t=o=>{if(!o)return"";const v=y.broadlinkDevices.find(c=>c.entity_id===o);return v&&v.name||o},x=J(()=>{if(!y.device.device)return!1;const o=y.device.id.includes(".")?y.device.id.split(".")[1]:y.device.id;return y.device.device!==o}),P=J(()=>{if(!y.device.broadlink_entity)return"";const o=y.broadlinkDevices.find(v=>v.entity_id===y.device.broadlink_entity);return o&&o.name||y.device.broadlink_entity}),j=o=>{if(!o||typeof o!="object")return 0;let v=0;for(const c of Object.values(o))typeof c=="string"?v++:typeof c=="object"&&(v+=j(c));return v},D=async()=>{if(!(!y.device.device_code||!y.device.entity_type))try{const o=await ce.get("/api/smartir/codes/code",{params:{entity_type:y.device.entity_type,code_id:y.device.device_code}});if(o.data.success&&o.data.code){const v=o.data.code;v.commands&&(k.value=j(v.commands))}}catch(o){console.error("Error fetching SmartIR command count:",o)}};return De(async()=>{(y.device.device_type||"broadlink")==="smartir"&&await D()}),(o,v)=>(s(),i("div",{class:X(["device-card",{disabled:$.value}])},[e("div",it,[e("div",{class:X(["device-icon",Se(n).colorClass.value])},[e("i",{class:X(f(w.value))},null,2)],2),e("div",rt,[e("h3",{title:l.device.name},p(l.device.name),9,dt),e("div",ut,[e("span",ct,p(C.value),1)])]),e("img",{src:A.value,alt:T.value,title:T.value,class:"device-source-logo"},null,8,mt)]),e("div",vt,[e("div",pt,[e("div",ft,[v[3]||(v[3]=e("i",{class:"mdi mdi-remote"},null,-1)),e("span",null,p(h.value)+" command"+p(h.value!==1?"s":""),1)]),e("div",gt,[v[4]||(v[4]=e("i",{class:"mdi mdi-map-marker"},null,-1)),e("span",null,p(l.device.area||"No area"),1)])]),e("div",yt,[e("span",bt,[v[5]||(v[5]=e("i",{class:"mdi mdi-identifier"},null,-1)),_(" "+p(l.device.id),1)]),x.value?(s(),i("span",ht,[v[6]||(v[6]=e("i",{class:"mdi mdi-code-tags"},null,-1)),_(" "+p(l.device.device),1)])):E("",!0),l.device.broadlink_entity?(s(),i("span",kt,[v[7]||(v[7]=e("i",{class:"mdi mdi-access-point"},null,-1)),_(" "+p(P.value),1)])):E("",!0),l.device.controller_device?(s(),i("span",wt,[v[8]||(v[8]=e("i",{class:"mdi mdi-access-point"},null,-1)),_(" "+p(t(l.device.controller_device)),1)])):E("",!0)])]),e("div",$t,[e("button",{onClick:v[0]||(v[0]=c=>!$.value&&o.$emit("learn",l.device)),class:"icon-btn",title:"Manage Commands",disabled:$.value},[...v[9]||(v[9]=[e("i",{class:"mdi mdi-remote-tv"},null,-1)])],8,Ct),e("button",{onClick:v[1]||(v[1]=c=>!$.value&&o.$emit("edit",l.device)),class:"icon-btn",title:"Edit",disabled:$.value},[...v[10]||(v[10]=[e("i",{class:"mdi mdi-pencil"},null,-1)])],8,St),e("button",{onClick:v[2]||(v[2]=c=>!$.value&&o.$emit("delete",l.device)),class:"icon-btn danger",title:"Delete",disabled:$.value},[...v[11]||(v[11]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,_t)]),$.value?(s(),i("div",It,[...v[12]||(v[12]=[e("div",{class:"disabled-message"},[e("i",{class:"mdi mdi-eye-off"}),e("span",null,"SmartIR Not Installed")],-1)])])):E("",!0)],2))}},Tt=he(Dt,[["__scopeId","data-v-7a7f5c18"]]),xt={class:"icon-picker"},Rt={class:"icon-input-wrapper"},Mt=["id","placeholder"],Ot={key:0,class:"icon-preview"},Lt={key:0,class:"icon-dropdown"},Et={class:"icon-grid"},At=["onMousedown","title"],Vt={__name:"IconPicker",props:{modelValue:{type:String,default:""},inputId:{type:String,default:"icon-input"},placeholder:{type:String,default:"e.g., mdi:television"}},emits:["update:modelValue"],setup(l,{emit:y}){const d=l,$=y,k=b(d.modelValue),n=b(!1),w=["television","speaker","radio","music","video","movie","play","pause","stop","skip-next","skip-previous","volume-high","volume-medium","volume-low","volume-off","remote","remote-tv","cast","chromecast","spotify","netflix","youtube","lightbulb","lightbulb-on","lightbulb-off","lamp","floor-lamp","ceiling-light","light-switch","led-strip","led-strip-variant","wall-sconce","chandelier","spotlight","track-light","vanity-light","desk-lamp","fan","ceiling-fan","air-conditioner","thermometer","thermostat","heat-wave","snowflake","fire","radiator","water-boiler","hvac","blinds","blinds-open","window-shutter","window-shutter-open","curtains","curtains-closed","roller-shade","roller-shade-closed","garage","garage-open","gate","door","door-open","window-open","window-closed","washing-machine","tumble-dryer","dishwasher","refrigerator","stove","microwave","oven","toaster","kettle","coffee","coffee-maker","blender","robot-vacuum","robot-vacuum-variant","vacuum","broom","spray-bottle","lock","lock-open","lock-smart","key","shield","shield-check","alarm-light","bell","doorbell","camera","cctv","motion-sensor","smoke-detector","fire-extinguisher","water-alert","gas-cylinder","sofa","bed","bed-double","desk","chair","table","bookshelf","home","home-outline","home-assistant","floor-plan","room","weather-sunny","weather-night","weather-cloudy","weather-rainy","weather-snowy","weather-lightning","weather-windy","weather-fog","weather-partly-cloudy","umbrella","water","water-percent","phone","cellphone","tablet","laptop","desktop-tower","monitor","keyboard","mouse","printer","router","router-wireless","access-point","wifi","bluetooth","usb","hdmi-port","ethernet","power","power-plug","power-socket","battery","battery-charging","lightning-bolt","flash","solar-panel","solar-power","leaf","tree","flower","sprout","grass","watering-can","shovel","fence","pool","hot-tub","silverware","silverware-fork-knife","food","food-apple","glass-wine","glass-cocktail","bottle-wine","pot","pot-steam","shower","shower-head","bathtub","toilet","sink","faucet","hand-wash","car","car-side","garage-variant","tools","hammer","wrench","screwdriver","toolbox","ladder","heart","heart-pulse","run","walk","bike","dumbbell","yoga","scale-bathroom","thermometer-lines","clock","clock-outline","timer","alarm","calendar","calendar-today","calendar-clock","history","bell-ring","bell-alert","alert","alert-circle","information","help-circle","check","check-circle","close-circle","minus-circle","plus-circle","arrow-up","arrow-down","arrow-left","arrow-right","chevron-up","chevron-down","menu","dots-vertical","dots-horizontal","cog","tune","circle","square","triangle","hexagon","star","star-outline","heart-outline","plus","minus","close","check-bold","eye","eye-off","account","account-group","baby","dog","cat","paw","gift","balloon","party-popper","candle","book","book-open","newspaper","email","message","phone-classic"];ue(()=>d.modelValue,h=>{k.value=h});const f=J(()=>{if(!k.value)return w.slice(0,50);const h=k.value.toLowerCase().replace("mdi:","");return w.filter(t=>t.toLowerCase().includes(h)).slice(0,50)}),C=()=>{n.value=!0,$("update:modelValue",k.value)},T=()=>{setTimeout(()=>{n.value=!1},200)},A=h=>{k.value=`mdi:${h}`,$("update:modelValue",k.value),n.value=!1};return(h,t)=>(s(),i("div",xt,[e("div",Rt,[z(e("input",{id:l.inputId,"onUpdate:modelValue":t[0]||(t[0]=x=>k.value=x),type:"text",placeholder:l.placeholder,onInput:C,onFocus:t[1]||(t[1]=x=>n.value=!0),onBlur:T},null,40,Mt),[[_e,k.value]]),k.value?(s(),i("div",Ot,[e("i",{class:X(`mdi mdi-${k.value.replace("mdi:","")}`)},null,2)])):E("",!0)]),n.value&&f.value.length>0?(s(),i("div",Lt,[e("div",Et,[(s(!0),i(ge,null,be(f.value,x=>(s(),i("div",{key:x,class:"icon-option",onMousedown:me(P=>A(x),["prevent"]),title:x},[e("i",{class:X(`mdi mdi-${x}`)},null,2),e("span",null,p(x),1)],40,At))),128))])])):E("",!0)]))}},jt=he(Vt,[["__scopeId","data-v-a64f5011"]]),Ut={key:0,class:"dropdown-label"},Ft={key:0,class:"required"},Pt=["placeholder","disabled","onKeydown"],Nt={class:"dropdown-icons"},Bt={key:0,class:"mdi mdi-loading mdi-spin"},Ht={key:2,class:"mdi mdi-chevron-down"},qt={key:1,class:"error-message"},Jt={key:2,class:"hint-message"},zt={key:0,class:"dropdown-menu"},Wt=["onMousedown","onMouseenter"],Gt={class:"option-content"},Kt={class:"option-label"},Xt={key:0,class:"option-description"},Yt={key:0,class:"mdi mdi-check selected-icon"},Zt={key:3,class:"dropdown-menu"},Qt={__name:"SearchableDropdown",props:{modelValue:{type:[String,Number,Object],default:null},options:{type:Array,required:!0,default:()=>[]},label:{type:String,default:""},placeholder:{type:String,default:"Search..."},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},error:{type:String,default:""},hint:{type:String,default:""},optionLabel:{type:String,default:"label"},optionValue:{type:String,default:"value"},optionDescription:{type:String,default:"description"},filterMethod:{type:Function,default:null}},emits:["update:modelValue","change","search"],setup(l,{emit:y}){const d=l,$=y,k=b(null),n=b(null),w=b(""),f=b(!1),C=b(0),T=b(!1),A=O=>typeof O=="string"||typeof O=="number"?O:O[d.optionLabel]||O.label||O.name||String(O),h=O=>typeof O=="string"||typeof O=="number"?O:O[d.optionValue]||O.value||O.id||O,t=O=>typeof O=="string"||typeof O=="number"?"":O[d.optionDescription]||O.description||"",x=O=>{const N=h(O);return typeof d.modelValue=="object"?h(d.modelValue)===N:d.modelValue===N},P=J(()=>{if(!w.value)return d.options;if(d.filterMethod)return d.options.filter(N=>d.filterMethod(N,w.value));const O=w.value.toLowerCase();return d.options.filter(N=>{const Y=A(N).toLowerCase(),re=t(N).toLowerCase();return Y.includes(O)||re.includes(O)})}),j=J(()=>{if(!d.modelValue)return"";const O=d.options.find(N=>{const Y=h(N);return typeof d.modelValue=="object"?Y===h(d.modelValue):Y===d.modelValue});return O?A(O):""});ue(()=>d.modelValue,O=>{T.value||(w.value=j.value)}),ue(()=>d.options,()=>{!T.value&&d.modelValue&&(w.value=j.value)},{deep:!0}),ue(w,O=>{$("search",O),C.value=0}),De(()=>{w.value=j.value});const D=()=>{var O;T.value=!0,f.value=!0,(O=n.value)==null||O.select()},o=()=>{T.value=!1,setTimeout(()=>{f.value=!1,d.modelValue?w.value=j.value:w.value=""},200)},v=()=>{var O;f.value=!1,(O=n.value)==null||O.blur()},c=O=>{const N=h(O);$("update:modelValue",N),$("change",N,O),w.value=A(O),v()},B=()=>{var O;$("update:modelValue",null),$("change",null,null),w.value="",(O=n.value)==null||O.focus()},K=()=>{if(!f.value){f.value=!0;return}C.value<P.value.length-1&&C.value++},oe=()=>{C.value>0&&C.value--},te=()=>{P.value.length>0&&C.value>=0&&c(P.value[C.value])},pe=O=>{k.value&&!k.value.contains(O.target)&&(f.value=!1,d.modelValue?w.value=j.value:w.value="")};return De(()=>{document.addEventListener("click",pe)}),qe(()=>{document.removeEventListener("click",pe)}),(O,N)=>(s(),i("div",{class:"searchable-dropdown",ref_key:"dropdownRef",ref:k},[l.label?(s(),i("label",Ut,[_(p(l.label)+" ",1),l.required?(s(),i("span",Ft,"*")):E("",!0)])):E("",!0),e("div",{class:X(["dropdown-input-wrapper",{"has-error":l.error,disabled:l.disabled}])},[z(e("input",{ref_key:"inputRef",ref:n,type:"text","onUpdate:modelValue":N[0]||(N[0]=Y=>w.value=Y),placeholder:l.placeholder,disabled:l.disabled||l.loading,onFocus:D,onBlur:o,onKeydown:[Ve(me(K,["prevent"]),["down"]),Ve(me(oe,["prevent"]),["up"]),Ve(me(te,["prevent"]),["enter"]),Ve(v,["escape"])],class:"dropdown-input"},null,40,Pt),[[_e,w.value]]),e("div",Nt,[l.loading?(s(),i("i",Bt)):l.modelValue&&!l.disabled?(s(),i("i",{key:1,class:"mdi mdi-close-circle clear-icon",onClick:B})):(s(),i("i",Ht))])],2),l.error?(s(),i("div",qt,p(l.error),1)):E("",!0),l.hint&&!l.error?(s(),i("div",Jt,p(l.hint),1)):E("",!0),ve(Je,{name:"dropdown"},{default:Pe(()=>[f.value&&P.value.length>0?(s(),i("div",zt,[(s(!0),i(ge,null,be(P.value,(Y,re)=>(s(),i("div",{key:h(Y),class:X(["dropdown-item",{highlighted:re===C.value,selected:x(Y)}]),onMousedown:me(ye=>c(Y),["prevent"]),onMouseenter:ye=>C.value=re},[e("div",Gt,[e("div",Kt,p(A(Y)),1),t(Y)?(s(),i("div",Xt,p(t(Y)),1)):E("",!0)]),x(Y)?(s(),i("i",Yt)):E("",!0)],42,Wt))),128))])):E("",!0)]),_:1}),f.value&&P.value.length===0&&!l.loading?(s(),i("div",Zt,[...N[1]||(N[1]=[e("div",{class:"dropdown-item no-results"},[e("i",{class:"mdi mdi-magnify"}),_(" No results found ")],-1)])])):E("",!0)],512))}},Fe=he(Qt,[["__scopeId","data-v-679ce35f"]]),eo={class:"smartir-selector"},to={class:"form-group"},oo={class:"form-group"},lo={class:"form-group"},no=["value"],so={key:0,class:"error-message"},ao={class:"form-group"},io={class:"form-group"},ro={key:1,class:"code-info"},uo={class:"info-content"},co={class:"info-row"},mo={class:"info-value"},vo={class:"info-row"},po={class:"info-value"},fo={key:0,class:"info-row"},go={class:"info-value"},yo={class:"info-row"},bo={class:"info-value"},ho={__name:"SmartIRDeviceSelector",props:{entityType:{type:String,required:!0},modelValue:{type:Object,default:()=>({})},broadlinkDevices:{type:Array,default:()=>[]}},emits:["update:modelValue","change"],setup(l,{expose:y,emit:d}){const $=l,k=d,n=b([]),w=b([]),f=b(""),C=b(""),T=b(""),A=b(""),h=b(""),t=b(null),x=b(!1),P=b(!1),j=b({manufacturer:"",model:"",controller:""});De(async()=>{if(await D(),$.modelValue&&(f.value=$.modelValue.manufacturer||"",C.value=$.modelValue.device_code||"",T.value=$.modelValue.controller_device||"",A.value=$.modelValue.temperature_sensor||"",h.value=$.modelValue.humidity_sensor||"",f.value&&(await o(f.value),C.value&&w.value.length>0))){const O=w.value.find(N=>N.code===C.value);O&&(t.value={code:O.code,manufacturer:f.value,models:O.models,controller:O.controller})}}),ue(()=>$.entityType,async O=>{O&&(f.value="",C.value="",w.value=[],t.value=null,await D())});const D=async()=>{if($.entityType){x.value=!0,j.value.manufacturer="";try{const O=await ce.get("/api/smartir/codes/manufacturers",{params:{entity_type:$.entityType}});if(O.data.success)n.value=O.data.manufacturers||[];else throw new Error(O.data.error||"Failed to load manufacturers")}catch(O){console.error("Error loading manufacturers:",O),j.value.manufacturer="Failed to load manufacturers. Please try again.",n.value=[]}finally{x.value=!1}}},o=async O=>{if(!(!O||!$.entityType)){P.value=!0,j.value.model="";try{const N=await ce.get("/api/smartir/codes/models",{params:{entity_type:$.entityType,manufacturer:O}});if(N.data.success){const Y=N.data.models||[];w.value=Y.map(re=>{const ye=re.models&&re.models.length>0?re.models.join(", "):`Code ${re.code}`;return{code:re.code,label:ye,description:`Code: ${re.code}`,models:re.models,controller:re.controller}})}else throw new Error(N.data.error||"Failed to load models")}catch(N){console.error("Error loading models:",N),j.value.model="Failed to load models. Please try again.",w.value=[]}finally{P.value=!1}}},v=async O=>{f.value=O,C.value="",t.value=null,w.value=[],O&&await o(O),te()},c=()=>{const O=w.value.find(N=>N.code===C.value);O&&(t.value={code:O.code,manufacturer:f.value,models:O.models,controller:O.controller}),te()},B=()=>{te()},K=()=>{te()},oe=()=>{te()},te=()=>{var N,Y;const O={manufacturer:f.value,model:((Y=(N=t.value)==null?void 0:N.models)==null?void 0:Y[0])||"",device_code:C.value,controller_device:T.value};$.entityType==="climate"&&(A.value&&(O.temperature_sensor=A.value),h.value&&(O.humidity_sensor=h.value)),k("update:modelValue",O),k("change",O)};return y({validate:()=>{let O=!0;return j.value={manufacturer:"",model:"",controller:""},f.value||(j.value.manufacturer="Manufacturer is required",O=!1),C.value||(j.value.model="Model is required",O=!1),T.value||(j.value.controller="Broadlink controller is required",O=!1),O}}),(O,N)=>(s(),i("div",eo,[e("div",to,[ve(Fe,{modelValue:f.value,"onUpdate:modelValue":N[0]||(N[0]=Y=>f.value=Y),options:n.value,label:"Manufacturer",placeholder:"Search manufacturers...",required:"",loading:x.value,error:j.value.manufacturer,hint:"Select the device manufacturer",onChange:v},null,8,["modelValue","options","loading","error"])]),e("div",oo,[ve(Fe,{modelValue:C.value,"onUpdate:modelValue":N[1]||(N[1]=Y=>C.value=Y),options:w.value,"option-label":"label","option-value":"code","option-description":"description",label:"Model",placeholder:"Search models...",required:"",disabled:!f.value,loading:P.value,error:j.value.model,hint:"Select the device model",onChange:c},null,8,["modelValue","options","disabled","loading","error"])]),e("div",lo,[N[6]||(N[6]=e("label",{for:"controller-device"},[e("i",{class:"mdi mdi-remote"}),_(" Controller Device * ")],-1)),z(e("select",{id:"controller-device","onUpdate:modelValue":N[2]||(N[2]=Y=>T.value=Y),required:"",onChange:B},[N[5]||(N[5]=e("option",{value:""},"-- Select Controller Device --",-1)),(s(!0),i(ge,null,be(l.broadlinkDevices,Y=>(s(),i("option",{key:Y.entity_id,value:Y.entity_id},[_(p(Y.name||Y.entity_id)+" ",1),Y.area_name?(s(),i(ge,{key:0},[_(" - "+p(Y.area_name),1)],64)):E("",!0)],8,no))),128))],544),[[ke,T.value]]),N[7]||(N[7]=e("small",null,"Which remote device will send the IR/RF commands",-1)),j.value.controller?(s(),i("div",so,p(j.value.controller),1)):E("",!0)]),l.entityType==="climate"?(s(),i(ge,{key:0},[e("div",ao,[N[8]||(N[8]=e("label",{for:"temperature-sensor"},"Temperature Sensor",-1)),z(e("input",{id:"temperature-sensor","onUpdate:modelValue":N[3]||(N[3]=Y=>A.value=Y),type:"text",placeholder:"e.g., sensor.living_room_temperature",onInput:K},null,544),[[_e,A.value]]),N[9]||(N[9]=e("small",null,"Optional: Temperature sensor entity for current temperature",-1))]),e("div",io,[N[10]||(N[10]=e("label",{for:"humidity-sensor"},"Humidity Sensor",-1)),z(e("input",{id:"humidity-sensor","onUpdate:modelValue":N[4]||(N[4]=Y=>h.value=Y),type:"text",placeholder:"e.g., sensor.living_room_humidity",onInput:oe},null,544),[[_e,h.value]]),N[11]||(N[11]=e("small",null,"Optional: Humidity sensor entity for current humidity",-1))])],64)):E("",!0),t.value?(s(),i("div",ro,[N[16]||(N[16]=e("div",{class:"info-header"},[e("i",{class:"mdi mdi-information"}),e("span",null,"Selected Device Code")],-1)),e("div",uo,[e("div",co,[N[12]||(N[12]=e("span",{class:"info-label"},"Code ID:",-1)),e("span",mo,p(t.value.code_id),1)]),e("div",vo,[N[13]||(N[13]=e("span",{class:"info-label"},"Manufacturer:",-1)),e("span",po,p(t.value.manufacturer),1)]),t.value.models&&t.value.models.length>0?(s(),i("div",fo,[N[14]||(N[14]=e("span",{class:"info-label"},"Supported Models:",-1)),e("span",go,p(t.value.models.join(", ")),1)])):E("",!0),e("div",yo,[N[15]||(N[15]=e("span",{class:"info-label"},"Controller:",-1)),e("span",bo,p(t.value.controller||"Broadlink"),1)])])])):E("",!0)]))}},ko=he(ho,[["__scopeId","data-v-1911c8f6"]]),wo={class:"modal-content"},$o={class:"modal-header"},Co={class:"input-wrapper"},So={key:0,class:"validation-tooltip"},_o={class:"input-wrapper"},Io=["disabled"],Do={key:0,class:"validation-tooltip"},To={key:0,class:"smartir-notice"},xo={key:0,class:"notice-success"},Ro={key:1,class:"notice-warning"},Mo={key:1,class:"smartir-notice"},Oo={key:2},Lo={class:"form-group"},Eo=["disabled"],Ao=["disabled"],Vo={key:0},jo={key:1},Uo={key:2},Fo={key:3},Po={key:0,class:"form-group"},No={class:"area-display-readonly"},Bo=["value"],Ho=["disabled"],qo=["href"],Jo={key:1,class:"form-group"},zo={class:"form-group"},Wo={class:"input-wrapper"},Go=["value"],Ko=["value"],Xo={key:2,class:"validation-tooltip"},Yo={key:0},Zo={key:1},Qo={key:3,class:"smartir-section"},el={class:"modal-footer"},tl={type:"submit",form:"device-form",class:"btn btn-primary"},ol={__name:"DeviceForm",props:{device:{type:Object,default:null}},emits:["save","cancel"],setup(l,{emit:y}){const d=l,$=y,k=we("smartirStatus"),n=we("smartirEnabled"),w=J(()=>{var u;return localStorage.getItem("smartir_simulate_not_installed")==="true"?!1:((u=k==null?void 0:k.value)==null?void 0:u.installed)||!1}),f=J(()=>!!d.device),C=J(()=>["climate","media_player","fan","light"].includes(t.value.entity_type)),T=J(()=>w.value?!C.value&&t.value.entity_type?"(Not supported for this type)":"(Pre-configured Codes)":"(Requires SmartIR)"),A=J(()=>{var u;const S=((u=d.device)==null?void 0:u.commands)||{};return Object.keys(S).length>0}),h=J(()=>{if(!t.value.broadlink_entity)return"";const S=o.value.find(u=>u.entity_id===t.value.broadlink_entity);return S&&S.name||t.value.broadlink_entity}),t=b({name:"",entity_type:"",device_type:"broadlink",device:"",area:"",icon:"",broadlink_entity:"",enabled:!0,commands:{}}),x=b({name:"",entity_type:"",broadlink_entity:""}),P=b({}),j=b(null),D=b([]),o=b([]),v=b(null),c=b(null),B=b(null),K=b(!1);De(async()=>{d.device&&(t.value={...d.device,device_type:d.device.device_type||"broadlink"},t.value.device_type==="smartir"&&(P.value={manufacturer:d.device.manufacturer,model:d.device.model,device_code:d.device.device_code,controller_device:d.device.controller_device,temperature_sensor:d.device.temperature_sensor,humidity_sensor:d.device.humidity_sensor})),await Promise.all([oe(),te()])});const oe=async()=>{try{const S=await ce.get("/api/areas");D.value=S.data.areas||[]}catch(S){console.error("Error loading areas:",S),D.value=[]}},te=async()=>{try{const u=(await ce.get("/api/remote/devices")).data.devices||[];o.value=u,console.log("Loaded remote devices:",u)}catch(S){console.error("Error loading remote devices:",S),o.value=[]}},pe=S=>{if(!S)return"";const u=S.toLowerCase();for(const V of D.value){const ie=V.toLowerCase();if(u.includes(ie))return V}return""},O=(S,u="")=>{const V=u.toLowerCase();return V.includes("tv")?"mdi:television":V.includes("lamp")?"mdi:lamp":V.includes("ceiling")?"mdi:ceiling-light":V.includes("floor")?"mdi:floor-lamp":V.includes("desk")?"mdi:desk-lamp":V.includes("fan")?"mdi:fan":V.includes("ac")||V.includes("air con")?"mdi:air-conditioner":V.includes("heater")?"mdi:radiator":V.includes("blind")?"mdi:blinds":V.includes("curtain")?"mdi:curtains":V.includes("garage")?"mdi:garage":V.includes("speaker")||V.includes("stereo")?"mdi:speaker":V.includes("receiver")?"mdi:audio-video":{light:"mdi:lightbulb",fan:"mdi:fan",switch:"mdi:light-switch",media_player:"mdi:television",cover:"mdi:window-shutter",climate:"mdi:thermostat"}[S]||"mdi:devices"};ue(()=>t.value.name,S=>{if(!f.value&&S&&!t.value.area){const u=pe(S);u&&(t.value.area=u)}!f.value&&S&&t.value.entity_type&&(K.value||!t.value.icon)&&(t.value.icon=O(t.value.entity_type,S),K.value=!0)}),ue(()=>t.value.entity_type,S=>{!f.value&&S&&(K.value||!t.value.icon)&&(t.value.icon=O(S,t.value.name),K.value=!0)}),ue(()=>t.value.icon,(S,u)=>{u!==void 0&&S!==u&&!K.value&&(K.value=!1),S||(K.value=!1)});const N=b(!1),Y=async()=>{var S;if((S=d.device)!=null&&S.id){N.value=!0;try{const u=await ce.post(`/api/devices/${d.device.id}/sync-area`);u.data.success?(t.value.area=u.data.area||"",u.data.area?console.log(`Area synced: ${u.data.area}`):console.log("No area assigned in Home Assistant")):console.warn(u.data.message||"Entity not found in HA")}catch(u){console.error("Failed to sync area:",u)}finally{N.value=!1}}},re=()=>{var V;return!((V=d.device)!=null&&V.id)||!t.value.entity_type?"#":`/config/entities/entity/${`${t.value.entity_type}.${d.device.id}`}`},ye=()=>{x.value={name:"",entity_type:"",broadlink_entity:""};let S=!0;return(!t.value.name||t.value.name.trim()==="")&&(x.value.name="Device name is required",S=!1),t.value.entity_type||(x.value.entity_type="Entity type is required",S=!1),t.value.device_type==="broadlink"&&!t.value.broadlink_entity&&(x.value.broadlink_entity="Broadlink device is required",S=!1),S},$e=S=>{x.value[S]=""},Ie=async()=>{if(t.value.device_type==="smartir"){if(j.value&&!j.value.validate())return;const S={...t.value,smartir_config:{manufacturer:P.value.manufacturer,model:P.value.model,code_id:P.value.device_code,controller_device:P.value.controller_device}};$("save",S)}else{if(!ye())return;$("save",{...t.value})}},Ce=S=>{P.value=S};return(S,u)=>(s(),i("div",{class:"modal-overlay",onClick:u[11]||(u[11]=me(V=>S.$emit("cancel"),["self"]))},[e("div",wo,[e("div",$o,[e("h2",null,p(f.value?"Edit Device":"Add New Device"),1),e("button",{onClick:u[0]||(u[0]=V=>S.$emit("cancel")),class:"close-btn"},[...u[12]||(u[12]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("form",{id:"device-form",onSubmit:me(Ie,["prevent"]),class:"modal-body"},[e("div",{class:X(["form-group",{"has-error":x.value.name}])},[u[14]||(u[14]=e("label",{for:"device-name"},"Device Name *",-1)),e("div",Co,[z(e("input",{id:"device-name",ref_key:"nameInput",ref:v,"onUpdate:modelValue":u[1]||(u[1]=V=>t.value.name=V),type:"text",placeholder:"e.g., Living Room TV",onInput:u[2]||(u[2]=V=>$e("name"))},null,544),[[_e,t.value.name]]),x.value.name?(s(),i("div",So,[u[13]||(u[13]=e("i",{class:"mdi mdi-alert"},null,-1)),_(" "+p(x.value.name),1)])):E("",!0)]),u[15]||(u[15]=e("small",null,"Friendly name for this device",-1))],2),e("div",{class:X(["form-group",{"has-error":x.value.entity_type}])},[u[23]||(u[23]=e("label",{for:"entity-type"},"Entity Type *",-1)),e("div",_o,[z(e("select",{id:"entity-type",ref_key:"typeSelect",ref:c,"onUpdate:modelValue":u[3]||(u[3]=V=>t.value.entity_type=V),onChange:u[4]||(u[4]=V=>$e("entity_type"))},[u[16]||(u[16]=Me('<option value="" data-v-94bc1fe5>-- Select Type --</option><option value="light" data-v-94bc1fe5>ğŸ’¡ Light</option><option value="fan" data-v-94bc1fe5>ğŸŒ€ Fan</option><option value="switch" data-v-94bc1fe5>ğŸ”Œ Switch</option><option value="media_player" data-v-94bc1fe5>ğŸ“º Media Player</option><option value="cover" data-v-94bc1fe5>ğŸªŸ Cover (Blinds/Curtains)</option>',6)),e("option",{value:"climate",disabled:!w.value}," ğŸŒ¡ï¸ Climate "+p(w.value?"":"(Requires SmartIR)"),9,Io)],544),[[ke,t.value.entity_type]]),x.value.entity_type?(s(),i("div",Do,[u[17]||(u[17]=e("i",{class:"mdi mdi-alert"},null,-1)),_(" "+p(x.value.entity_type),1)])):E("",!0)]),t.value.entity_type==="climate"?(s(),i("div",To,[w.value?(s(),i("div",xo,[...u[18]||(u[18]=[e("i",{class:"mdi mdi-check-circle"},null,-1),e("span",null,"SmartIR detected! Climate entities will be created via SmartIR profiles.",-1)])])):(s(),i("div",Ro,[...u[19]||(u[19]=[e("i",{class:"mdi mdi-alert"},null,-1),e("div",null,[e("strong",null,"SmartIR Required"),e("p",null,"Climate entities (AC, heaters) require SmartIR integration."),e("a",{href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"smartir-link"}," Install SmartIR â†’ ")],-1)])]))])):w.value&&["media_player","fan","light"].includes(t.value.entity_type)?(s(),i("div",Mo,[...u[20]||(u[20]=[e("div",{class:"notice-info"},[e("i",{class:"mdi mdi-information"}),e("span",null,"ğŸ’¡ SmartIR available! You can use pre-configured codes or learn your own.")],-1)])])):!w.value&&t.value.entity_type?(s(),i("small",Oo,[u[21]||(u[21]=_(" ğŸ’¡ Tip: Install ",-1)),u[22]||(u[22]=e("a",{href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"inline-link"},"SmartIR",-1)),_(" for pre-configured "+p(t.value.entity_type==="climate"?"climate":t.value.entity_type)+" device codes ",1)])):E("",!0)],2),e("div",Lo,[u[26]||(u[26]=e("label",{for:"device-type"},"Device Type *",-1)),z(e("select",{id:"device-type","onUpdate:modelValue":u[5]||(u[5]=V=>t.value.device_type=V),required:"",disabled:f.value},[u[24]||(u[24]=e("option",{value:""},"-- Select Device Type --",-1)),u[25]||(u[25]=e("option",{value:"broadlink"},"ğŸ“¡ Broadlink Device (Learn IR Codes)",-1)),Se(n)?(s(),i("option",{key:0,value:"smartir",disabled:!w.value||!C.value}," ğŸŒ SmartIR Device "+p(T.value),9,Ao)):E("",!0)],8,Eo),[[ke,t.value.device_type]]),f.value?(s(),i("small",Vo,"Cannot change device type after creation")):t.value.device_type==="smartir"?(s(),i("small",jo,"Using pre-configured codes from SmartIR repository")):t.value.device_type==="broadlink"?(s(),i("small",Uo,"Learn and store your own IR codes")):(s(),i("small",Fo,"Choose how to configure this device"))]),f.value?(s(),i("div",Po,[u[29]||(u[29]=e("label",{for:"device-area"},"Area",-1)),e("div",No,[e("input",{id:"device-area",value:t.value.area||"Not assigned",type:"text",readonly:"",class:"readonly-input"},null,8,Bo),e("button",{type:"button",onClick:Y,disabled:N.value,class:"sync-area-btn",title:"Sync area from Home Assistant"},[e("i",{class:X(N.value?"mdi mdi-loading mdi-spin":"mdi mdi-refresh")},null,2)],8,Ho)]),e("small",null,[u[27]||(u[27]=e("i",{class:"mdi mdi-information-outline"},null,-1)),u[28]||(u[28]=_(" Set area in Home Assistant, then click sync. ",-1)),e("a",{href:re(),target:"_blank",class:"inline-link"},"Open in HA â†’",8,qo)])])):(s(),i("div",Jo,[...u[30]||(u[30]=[e("div",{class:"info-notice"},[e("i",{class:"mdi mdi-information-outline"}),e("span",null,[e("strong",null,"Area Assignment:"),_(" After generating entities and restarting Home Assistant, you can assign areas in HA and sync them here.")])],-1)])])),e("div",zo,[u[31]||(u[31]=e("label",{for:"device-icon"},"Icon",-1)),ve(jt,{modelValue:t.value.icon,"onUpdate:modelValue":u[6]||(u[6]=V=>t.value.icon=V),inputId:"device-icon",placeholder:"e.g., mdi:television"},null,8,["modelValue"]),u[32]||(u[32]=e("small",null,"Optional: Material Design Icon name",-1))]),t.value.device_type==="broadlink"?(s(),i("div",{key:2,class:X(["form-group",{"has-error":x.value.broadlink_entity}])},[u[35]||(u[35]=e("label",{for:"broadlink-entity"},"Remote Device *",-1)),e("div",Wo,[!f.value||!A.value?z((s(),i("select",{key:0,id:"broadlink-entity",ref_key:"broadlinkSelect",ref:B,"onUpdate:modelValue":u[7]||(u[7]=V=>t.value.broadlink_entity=V),onChange:u[8]||(u[8]=V=>$e("broadlink_entity"))},[u[33]||(u[33]=e("option",{value:""},"-- Select Remote Device --",-1)),(s(!0),i(ge,null,be(o.value,V=>(s(),i("option",{key:V.entity_id,value:V.entity_id},[_(p(V.name||V.entity_id)+" ",1),V.area_name?(s(),i(ge,{key:0},[_(" - "+p(V.area_name),1)],64)):E("",!0)],8,Go))),128))],544)),[[ke,t.value.broadlink_entity]]):(s(),i("input",{key:1,id:"broadlink-entity",value:h.value,type:"text",readonly:"",disabled:""},null,8,Ko)),x.value.broadlink_entity?(s(),i("div",Xo,[u[34]||(u[34]=e("i",{class:"mdi mdi-alert"},null,-1)),_(" "+p(x.value.broadlink_entity),1)])):E("",!0)]),!f.value||!A.value?(s(),i("small",Yo,"Required: Select which remote device to use for sending commands")):(s(),i("small",Zo,"Cannot change remote device after commands are learned"))],2)):E("",!0),t.value.device_type==="smartir"?(s(),i("div",Qo,[u[36]||(u[36]=e("div",{class:"section-header"},[e("i",{class:"mdi mdi-cloud-download"}),e("span",null,"SmartIR Device Configuration")],-1)),ve(ko,{ref_key:"smartirSelector",ref:j,"entity-type":t.value.entity_type,modelValue:P.value,"onUpdate:modelValue":u[9]||(u[9]=V=>P.value=V),"broadlink-devices":o.value,onChange:Ce},null,8,["entity-type","modelValue","broadlink-devices"])])):E("",!0)],32),e("div",el,[e("button",{type:"button",onClick:u[10]||(u[10]=V=>S.$emit("cancel")),class:"btn btn-secondary"}," Cancel "),e("button",tl,[u[37]||(u[37]=e("i",{class:"mdi mdi-check"},null,-1)),_(" "+p(f.value?"Update":"Create"),1)])])])]))}},ll=he(ol,[["__scopeId","data-v-94bc1fe5"]]),nl={class:"modal-header"},sl={class:"modal-body"},al={class:"message-text"},il={key:0,class:"checkbox-option"},rl={class:"modal-footer"},dl=["disabled"],ul={__name:"ConfirmDialog",props:{isOpen:{type:Boolean,default:!1},title:{type:String,default:"Confirm"},message:{type:String,required:!0},confirmText:{type:String,default:"OK"},cancelText:{type:String,default:"Cancel"},showCancel:{type:Boolean,default:!0},dangerMode:{type:Boolean,default:!1},confirmDisabled:{type:Boolean,default:!1},checkboxLabel:{type:String,default:""}},emits:["confirm","cancel"],setup(l,{emit:y}){const d=l,$=y,k=b(!1);ue(()=>d.isOpen,f=>{f&&(k.value=!1)});const n=()=>{$("confirm",k.value)},w=()=>{$("cancel")};return(f,C)=>l.isOpen?(s(),i("div",{key:0,class:"modal-overlay",onClick:me(w,["self","stop"])},[e("div",{class:"modal-dialog confirm-dialog",onClick:C[1]||(C[1]=me(()=>{},["stop"]))},[e("div",nl,[e("h2",null,p(l.title),1)]),e("div",sl,[e("p",al,p(l.message),1),l.checkboxLabel?(s(),i("div",il,[e("label",null,[z(e("input",{type:"checkbox","onUpdate:modelValue":C[0]||(C[0]=T=>k.value=T)},null,512),[[de,k.value]]),e("span",null,p(l.checkboxLabel),1)])])):E("",!0)]),e("div",rl,[l.showCancel?(s(),i("button",{key:0,onClick:me(w,["stop"]),class:"btn btn-secondary"},p(l.cancelText),1)):E("",!0),l.confirmText?(s(),i("button",{key:1,onClick:me(n,["stop"]),class:X(["btn",l.dangerMode?"btn-danger":"btn-primary"]),disabled:l.confirmDisabled},p(l.confirmText),11,dl)):E("",!0)])])])):E("",!0)}},Re=he(ul,[["__scopeId","data-v-80a9de08"]]),cl={class:"modal-content"},ml={class:"modal-header"},vl={class:"modal-body"},pl={key:0,class:"smartir-info"},fl={key:0,class:"climate-note"},gl={class:"form-group"},yl=["value"],bl={class:"form-group"},hl=["disabled"],kl={label:"Suggested Commands"},wl=["value"],$l=["disabled"],Cl={class:"form-group"},Sl={class:"radio-group"},_l={class:"radio-label"},Il=["disabled"],Dl={class:"radio-label"},Tl=["disabled"],xl={class:"learn-action"},Rl=["disabled"],Ml={key:0,class:"mdi mdi-loading mdi-spin"},Ol={key:1,class:"mdi mdi-remote-tv"},Ll={key:0,class:"learning-status"},El={key:1,class:"result-message success"},Al={key:2,class:"section-divider"},Vl={key:3,class:"learned-commands"},jl={class:"command-list"},Ul={class:"command-info"},Fl={class:"command-name"},Pl={class:"learned-status"},Nl={class:"command-actions"},Bl=["onClick","disabled"],Hl=["onClick"],ql={key:4,class:"untracked-commands"},Jl={class:"command-list"},zl={class:"command-name"},Wl={class:"modal-footer"},Gl=["disabled"],Kl={__name:"CommandLearner",props:{device:{type:Object,required:!0}},emits:["cancel","learned"],setup(l,{emit:y}){const d=l,$=y,k=b([]),n=b(""),w=b(""),f=b(""),C=b("ir"),T=b(!1),A=b(""),h=b("success"),t=b([]),x=b([]),P=b(!1),j=b(""),D=b(!1),o=b(null),v=b(null),c=b(""),B=b(""),K=J(()=>d.device.device_type==="smartir");J(()=>{if(K.value)return!1;const M=w.value==="__custom__"?f.value:w.value;return n.value&&M.trim()});const oe=()=>{o.value&&o.value.setCustomValidity("")},te=()=>{v.value&&v.value.setCustomValidity("")},pe=J(()=>{const M=k.value.find(r=>r.entity_id===n.value);return M?M.name||M.entity_id:n.value}),O={light:["turn_on","turn_off","toggle","brightness_up","brightness_down","dim","bright"],fan:["turn_on","turn_off","toggle","speed_low","speed_medium","speed_high","speed_1","speed_2","speed_3","speed_4","speed_5","oscillate_on","oscillate_off","direction_forward","direction_reverse"],switch:["turn_on","turn_off","toggle"],media_player:["turn_on","turn_off","toggle","volume_up","volume_down","volume_mute","play","pause","stop","play_pause","next_track","previous_track","channel_up","channel_down","source_hdmi1","source_hdmi2","source_hdmi3","source_tv","source_aux","source_bluetooth","menu","home","back","select","arrow_up","arrow_down","arrow_left","arrow_right"],cover:["open","close","stop","open_tilt","close_tilt","position_0","position_25","position_50","position_75","position_100"]},N=J(()=>{const M=d.device.entity_type||"switch";return O[M]||O.switch});De(async()=>{await Y(),await re(),await u(),o.value&&(o.value.setCustomValidity(""),o.value.oninvalid=()=>{o.value.setCustomValidity("Command name is required")}),d.device.broadlink_entity&&(n.value=d.device.broadlink_entity)}),ue(w,async M=>{M==="__custom__"&&(await ze(),v.value&&(v.value.setCustomValidity(""),v.value.oninvalid=()=>{v.value.setCustomValidity("Custom command name is required")}))});const Y=async()=>{try{const M=await ce.get("/api/broadlink/devices");k.value=M.data.devices||[]}catch(M){console.error("Error loading Broadlink devices:",M)}},re=async()=>{try{if(K.value){const M=await ce.get("/api/smartir/codes/code",{params:{entity_type:d.device.entity_type,code_id:d.device.device_code}});if(M.data.success&&M.data.code){const r=M.data.code.commands||{},F=M.data.code.commandType||"ir";if(d.device.entity_type==="climate"){const Z=[];for(const[ae,H]of Object.entries(r))typeof H=="string"?Z.push({name:ae,type:F}):typeof H=="object"&&H!==null&&Object.keys(H).sort((le,G)=>parseInt(le)-parseInt(G)).forEach(le=>{Z.push({name:`${ae}_${le}`,type:F,label:`${ae.charAt(0).toUpperCase()+ae.slice(1)} ${le}Â°C`})});t.value=Z}else t.value=Object.keys(r).map(Z=>({name:Z,type:F}))}}else{if(console.log("ğŸ“‹ Loading commands for device:",d.device),console.log("ğŸ“‹ Device commands:",d.device.commands),console.log("ğŸ“‹ Device ID:",d.device.id),d.device.commands&&Object.keys(d.device.commands).length>0)console.log("âœ… Using commands from device object"),t.value=Object.entries(d.device.commands).map(([M,r])=>({name:M,type:r.command_type||r.type||"ir"}));else if(d.device.id){console.log("ğŸŒ Fetching commands from API for device ID:",d.device.id);const r=(await ce.get(`/api/commands/${d.device.id}`)).data.commands||{};t.value=Object.entries(r).map(([F,Z])=>({name:F,type:Z.command_type||Z.type||"ir"}))}else console.log("âš ï¸ No commands found and no device ID");console.log("ğŸ“‹ Final learned commands:",t.value)}}catch(M){console.error("Error loading commands:",M)}},ye=async()=>{var M,r;A.value="",h.value="",T.value=!0;try{let F=d.device.id.split(".")[1];d.device.device&&(F=d.device.device);const Z=w.value==="__custom__"?f.value:w.value,ae=await ce.post("/api/commands/learn",{entity_id:n.value,device:F,device_id:d.device.id,command:Z.trim(),command_type:C.value});if(ae.data.success){A.value=`Command "${Z}" learned successfully!`,h.value="success",t.value.includes(Z)||t.value.push(Z);const H=x.value.indexOf(Z);H>-1&&x.value.splice(H,1);const I={...d.device.commands};I[Z]=!0,w.value="",f.value="",$("learned",{commands:I,commandName:Z})}else A.value=ae.data.error||"Failed to learn command",h.value="error"}catch(F){A.value=((r=(M=F.response)==null?void 0:M.data)==null?void 0:r.error)||"Error learning command",h.value="error"}finally{T.value=!1}},$e=async M=>{try{B.value=M,c.value="";let r=d.device.id.split(".")[1];d.device.device&&(r=d.device.device);const F=K.value?d.device.controller_device:n.value||d.device.broadlink_entity;if(!F){console.error("Missing entity_id for test command:",{isSmartIR:K.value,controller_device:d.device.controller_device,broadlink_entity:d.device.broadlink_entity,selectedBroadlink:n.value,device:d.device}),A.value="Missing Broadlink remote entity. Please select a Broadlink device.",h.value="error",B.value="";return}(await ce.post("/api/commands/test",{entity_id:F,device:r,command:M,device_id:d.device.id})).data.success&&(c.value=M,setTimeout(()=>{c.value===M&&(c.value="")},2e3))}catch(r){A.value=`Failed to send command: ${r.message}`,h.value="error"}finally{B.value=""}},Ie=M=>{j.value=M,P.value=!0},Ce=()=>{P.value=!1,j.value=""},S=async()=>{const M=j.value;P.value=!1;try{await ce.delete(`/api/commands/${d.device.id}/${M}`),await re(),await u(),A.value=`Command "${M}" deleted`,h.value="success",$("learned")}catch(r){A.value=`Failed to delete command: ${r.message}`,h.value="error"}finally{j.value=""}},u=async()=>{try{const M=d.device.device||d.device.id.split(".")[1],F=(await ce.get("/api/commands/untracked")).data.untracked||{};F[M]?x.value=Object.keys(F[M].commands):x.value=[]}catch(M){console.error("Error loading untracked commands:",M),x.value=[]}},V=()=>{x.value.length!==0&&(D.value=!0)},ie=async()=>{D.value=!1;try{const M=d.device.device||d.device.id.split(".")[1],r=await ce.post("/api/commands/import",{device_id:d.device.id,source_device:M,commands:x.value});r.data.success&&(A.value=`Imported ${r.data.imported_count} commands successfully!`,h.value="success",await re(),await u(),$("learned"))}catch(M){A.value=`Failed to import commands: ${M.message}`,h.value="error"}};return(M,r)=>(s(),i("div",{class:"modal-overlay",onClick:r[7]||(r[7]=me(F=>M.$emit("cancel"),["self"]))},[e("div",cl,[e("div",ml,[e("h2",null,p(K.value?"Commands for":"Learn Commands for")+" "+p(l.device.name),1),e("button",{onClick:r[0]||(r[0]=F=>M.$emit("cancel")),class:"close-btn"},[...r[8]||(r[8]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",vl,[K.value?(s(),i("div",pl,[r[13]||(r[13]=e("i",{class:"mdi mdi-information"},null,-1)),e("div",null,[r[12]||(r[12]=e("h3",null,"SmartIR Device",-1)),e("p",null,[r[9]||(r[9]=_("This device uses SmartIR code file ",-1)),e("strong",null,p(l.device.device_code),1),r[10]||(r[10]=_(". Commands are pre-configured and cannot be learned.",-1))]),l.device.entity_type==="climate"?(s(),i("p",fl,[...r[11]||(r[11]=[e("i",{class:"mdi mdi-alert-circle-outline"},null,-1),e("strong",null,"Note:",-1),_(" Climate device commands are temperature-based. Testing individual modes may not work as expected. Use the Home Assistant climate card to control your device. ",-1)])])):E("",!0)])])):(s(),i("form",{key:1,onSubmit:me(ye,["prevent"])},[e("div",gl,[r[14]||(r[14]=e("label",{for:"broadlink-entity"},"Broadlink Device",-1)),e("input",{id:"broadlink-entity",value:pe.value,type:"text",readonly:"",disabled:""},null,8,yl),r[15]||(r[15]=e("small",null,"Commands will be learned using this device (set when device was created)",-1))]),e("div",bl,[r[18]||(r[18]=e("label",{for:"command-name"},"Command Name *",-1)),z(e("select",{id:"command-name",ref_key:"commandSelect",ref:o,"onUpdate:modelValue":r[1]||(r[1]=F=>w.value=F),disabled:T.value,required:"",onChange:oe},[r[16]||(r[16]=e("option",{value:""},"-- Select or type command --",-1)),e("optgroup",kl,[(s(!0),i(ge,null,be(N.value,F=>(s(),i("option",{key:F,value:F},p(F),9,wl))),128))]),r[17]||(r[17]=e("option",{value:"__custom__"},"Custom command...",-1))],40,hl),[[ke,w.value]]),w.value==="__custom__"?z((s(),i("input",{key:0,ref_key:"customCommandInput",ref:v,"onUpdate:modelValue":r[2]||(r[2]=F=>f.value=F),type:"text",placeholder:"Enter custom command name",disabled:T.value,required:"",class:"custom-command-input",onInput:te},null,40,$l)),[[_e,f.value]]):E("",!0),e("small",null,"Select a suggested command for "+p(l.device.entity_type||"this device")+", or enter a custom one.",1)]),e("div",Cl,[r[21]||(r[21]=e("label",null,"Command Type",-1)),e("div",Sl,[e("label",_l,[z(e("input",{type:"radio","onUpdate:modelValue":r[3]||(r[3]=F=>C.value=F),value:"ir",disabled:T.value},null,8,Il),[[Ue,C.value]]),r[19]||(r[19]=e("span",null,"IR (Infrared)",-1))]),e("label",Dl,[z(e("input",{type:"radio","onUpdate:modelValue":r[4]||(r[4]=F=>C.value=F),value:"rf",disabled:T.value},null,8,Tl),[[Ue,C.value]]),r[20]||(r[20]=e("span",null,"RF (Radio Frequency)",-1))])])]),e("div",xl,[e("button",{type:"submit",class:"btn btn-primary btn-large",disabled:T.value},[T.value?(s(),i("i",Ml)):(s(),i("i",Ol)),_(" "+p(T.value?"Learning...":"Learn Command"),1)],8,Rl)]),T.value?(s(),i("div",Ll,[...r[22]||(r[22]=[e("i",{class:"mdi mdi-loading mdi-spin"},null,-1),e("p",null,"Point your remote at the Broadlink device and press the button...",-1),e("small",null,"This may take up to 30 seconds",-1)])])):E("",!0),A.value&&h.value==="success"&&!A.value.includes("sent successfully")?(s(),i("div",El,[r[23]||(r[23]=e("i",{class:"mdi mdi-check-circle"},null,-1)),e("p",null,p(A.value),1)])):E("",!0)],32)),t.value.length>0||x.value.length>0?(s(),i("div",Al)):E("",!0),t.value.length>0?(s(),i("div",Vl,[e("h3",null,"Tracked Commands ("+p(t.value.length)+")",1),e("div",jl,[(s(!0),i(ge,null,be(t.value,F=>(s(),i("div",{key:F.name,class:"command-item"},[e("div",Ul,[e("span",Fl,p(F.label||F.name),1)]),e("div",Pl,[r[24]||(r[24]=e("i",{class:"mdi mdi-check-circle"},null,-1)),r[25]||(r[25]=e("span",null,"Learned",-1)),e("span",{class:X(["command-type-badge",F.type||"ir"])},p((F.type||"ir").toUpperCase()),3)]),e("div",Nl,[e("button",{type:"button",onClick:Z=>$e(F.name),class:"icon-btn",title:"Test command",disabled:B.value===F.name},[e("i",{class:X(["mdi mdi-play",{"mdi-spin":B.value===F.name}])},null,2)],8,Bl),e("button",{type:"button",onClick:Z=>Ie(F.name),class:"icon-btn danger",title:"Delete and re-learn"},[...r[26]||(r[26]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,Hl)])]))),128))])])):E("",!0),x.value.length>0?(s(),i("div",ql,[e("h3",null,[r[27]||(r[27]=e("i",{class:"mdi mdi-alert"},null,-1)),_(" Untracked Commands ("+p(x.value.length)+") ",1)]),r[30]||(r[30]=e("p",{class:"untracked-info"}," These commands exist in Broadlink storage but are not tracked in this device. ",-1)),e("div",Jl,[(s(!0),i(ge,null,be(x.value,F=>(s(),i("div",{key:F,class:"command-item untracked"},[e("span",zl,p(F),1),r[28]||(r[28]=e("span",{class:"untracked-badge"},"Not tracked",-1))]))),128))]),e("button",{type:"button",onClick:V,class:"btn btn-secondary"},[...r[29]||(r[29]=[e("i",{class:"mdi mdi-import"},null,-1),_(" Import All Untracked Commands ",-1)])])])):E("",!0)]),e("div",Wl,[e("button",{type:"button",onClick:r[5]||(r[5]=F=>M.$emit("cancel")),class:"btn btn-secondary",disabled:T.value}," Close ",8,Gl)])]),ve(Re,{isOpen:P.value,title:"Delete Command?",message:`Delete command '${j.value}'? This will remove it from Broadlink storage.`,confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,onConfirm:S,onCancel:Ce},null,8,["isOpen","message"]),ve(Re,{isOpen:D.value,title:"Import Commands?",message:`Import ${x.value.length} untracked command${x.value.length>1?"s":""} into this device?`,confirmText:"Import",cancelText:"Cancel",onConfirm:ie,onCancel:r[6]||(r[6]=F=>D.value=!1)},null,8,["isOpen","message"])]))}},Xl=he(Kl,[["__scopeId","data-v-6fd4627e"]]),Yl={class:"modal-container error-dialog"},Zl={class:"modal-header"},Ql={class:"modal-body"},en={class:"error-message"},tn={key:0,class:"error-suggestion"},on=["open"],ln={class:"debug-content"},nn={class:"debug-info"},sn={key:0,class:"debug-section-title"},an={key:1},rn={__name:"ErrorDialog",props:{isOpen:{type:Boolean,default:!1},title:{type:String,default:"Error"},message:{type:String,required:!0},suggestion:{type:String,default:""},details:{type:String,default:""},error:{type:Object,default:null},context:{type:Object,default:()=>({})}},emits:["close"],setup(l,{emit:y}){const d=l,$=y,k=we("toast"),n=b(!1),w=()=>{$("close")},f=J(()=>{var x,P,j,D,o,v,c,B,K,oe,te;const h=new Date().toISOString(),t=d.error||{};return{error:JSON.stringify({message:d.message,title:d.title,details:d.details,errorObject:t.message||t.toString(),timestamp:h},null,2),request:JSON.stringify({method:((P=(x=t.config)==null?void 0:x.method)==null?void 0:P.toUpperCase())||"N/A",url:((j=t.config)==null?void 0:j.url)||"N/A",baseURL:((D=t.config)==null?void 0:D.baseURL)||"N/A",headers:((o=t.config)==null?void 0:o.headers)||{},data:(v=t.config)!=null&&v.data?JSON.parse(t.config.data):"N/A",params:((c=t.config)==null?void 0:c.params)||{}},null,2),response:JSON.stringify({status:((B=t.response)==null?void 0:B.status)||"N/A",statusText:((K=t.response)==null?void 0:K.statusText)||"N/A",data:((oe=t.response)==null?void 0:oe.data)||"N/A",headers:((te=t.response)==null?void 0:te.headers)||{}},null,2),browser:JSON.stringify({userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language,cookieEnabled:navigator.cookieEnabled,onLine:navigator.onLine,viewport:`${window.innerWidth}x${window.innerHeight}`,screenResolution:`${window.screen.width}x${window.screen.height}`,colorDepth:window.screen.colorDepth,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,timestamp:h},null,2),appState:JSON.stringify({currentRoute:window.location.pathname,currentURL:window.location.href,referrer:document.referrer||"N/A",context:d.context||{},localStorage:{smartir_simulate:localStorage.getItem("smartir_simulate_not_installed"),theme:localStorage.getItem("theme")}},null,2),stackTrace:t.stack||null}}),C=async()=>{const h=A();try{await navigator.clipboard.writeText(h),k==null||k.success("Debug information copied to clipboard","âœ… Copied")}catch(t){console.error("Failed to copy:",t),k==null||k.error("Failed to copy to clipboard","âŒ Copy Failed")}},T=()=>{const h=A(),t=new Blob([h],{type:"text/plain"}),x=URL.createObjectURL(t),P=document.createElement("a");P.href=x;const j=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5);P.download=`broadlink-manager-error-${j}.txt`,document.body.appendChild(P),P.click(),document.body.removeChild(P),URL.revokeObjectURL(x),k==null||k.success("Debug report downloaded","âœ… Downloaded")},A=()=>`Broadlink Manager - Error Report
${"=".repeat(60)}

Generated: ${new Date().toISOString()}
Title: ${d.title}
Message: ${d.message}
${d.suggestion?`Suggestion: ${d.suggestion}
`:""}
${"=".repeat(60)}

ERROR DETAILS
${"-".repeat(60)}
${f.value.error}

REQUEST INFORMATION
${"-".repeat(60)}
${f.value.request}

RESPONSE INFORMATION
${"-".repeat(60)}
${f.value.response}

BROWSER INFORMATION
${"-".repeat(60)}
${f.value.browser}

APPLICATION STATE
${"-".repeat(60)}
${f.value.appState}

${f.value.stackTrace?`STACK TRACE
${"-".repeat(60)}
${f.value.stackTrace}

`:""}
${"=".repeat(60)}
End of Report
`;return ue(()=>d.isOpen,h=>{if(h){const t=x=>{x.key==="Escape"&&w()};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)}}),(h,t)=>(s(),xe(We,{to:"body"},[ve(Je,{name:"modal"},{default:Pe(()=>[l.isOpen?(s(),i("div",{key:0,class:"modal-overlay",onClick:me(w,["self"])},[e("div",Yl,[e("div",Zl,[t[2]||(t[2]=e("div",{class:"header-icon error-icon"},[e("i",{class:"mdi mdi-alert-circle"})],-1)),e("h3",null,p(l.title),1),e("button",{onClick:w,class:"close-button"},[...t[1]||(t[1]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Ql,[e("p",en,p(l.message),1),l.suggestion?(s(),i("p",tn,[t[3]||(t[3]=e("i",{class:"mdi mdi-lightbulb-on"},null,-1)),_(" "+p(l.suggestion),1)])):E("",!0),e("details",{class:"debug-section",open:n.value},[e("summary",{onClick:t[0]||(t[0]=x=>n.value=!n.value)},[e("i",{class:X(["mdi",n.value?"mdi-chevron-down":"mdi-chevron-right"])},null,2),t[4]||(t[4]=_(" Debug Information ",-1))]),e("div",ln,[e("div",{class:"debug-actions"},[e("button",{onClick:C,class:"btn-debug btn-copy"},[...t[5]||(t[5]=[e("i",{class:"mdi mdi-content-copy"},null,-1),_(" Copy to Clipboard ",-1)])]),e("button",{onClick:T,class:"btn-debug btn-download"},[...t[6]||(t[6]=[e("i",{class:"mdi mdi-download"},null,-1),_(" Download Report ",-1)])])]),e("div",nn,[t[7]||(t[7]=e("div",{class:"debug-section-title"},"Error Details",-1)),e("pre",null,p(f.value.error),1),t[8]||(t[8]=e("div",{class:"debug-section-title"},"Request Information",-1)),e("pre",null,p(f.value.request),1),t[9]||(t[9]=e("div",{class:"debug-section-title"},"Response Information",-1)),e("pre",null,p(f.value.response),1),t[10]||(t[10]=e("div",{class:"debug-section-title"},"Browser Information",-1)),e("pre",null,p(f.value.browser),1),t[11]||(t[11]=e("div",{class:"debug-section-title"},"Application State",-1)),e("pre",null,p(f.value.appState),1),f.value.stackTrace?(s(),i("div",sn,"Stack Trace")):E("",!0),f.value.stackTrace?(s(),i("pre",an,p(f.value.stackTrace),1)):E("",!0)])])],8,on)]),e("div",{class:"modal-footer"},[e("button",{onClick:w,class:"btn btn-primary"}," OK ")])])])):E("",!0)]),_:1})]))}},dn=he(rn,[["__scopeId","data-v-23858149"]]),un={key:0,class:"discovery-banner"},cn={class:"banner-content"},mn={class:"banner-text"},vn={class:"modal-dialog"},pn={class:"modal-header"},fn={class:"modal-body"},gn={class:"device-list"},yn={class:"device-info"},bn={class:"device-details"},hn={class:"command-count"},kn={class:"device-actions"},wn=["onClick"],$n=["onClick"],Cn={class:"modal-footer"},Sn={class:"modal-dialog modal-dialog-small"},_n={class:"modal-header"},In={class:"modal-body"},Dn={class:"warning-message"},Tn={class:"modal-footer"},xn=["disabled"],Rn=["disabled"],Mn={__name:"DeviceDiscovery",emits:["adopt"],setup(l,{expose:y,emit:d}){const $=Ae(),k=d,n=b([]),w=b(!1),f=b(!1),C=b(null),T=b(!1),A=J(()=>n.value.length>0);De(async()=>{await h()});const h=async()=>{try{const j=await ce.get("/api/devices/discover");n.value=j.data.untracked_devices||[]}catch(j){console.error("Error loading untracked devices:",j),n.value=[]}},t=j=>{w.value=!1,k("adopt",j)},x=j=>{C.value=j,f.value=!0},P=async()=>{if(C.value){T.value=!0;try{const j=await ce.delete(`/api/devices/untracked/${encodeURIComponent(C.value.device_name)}`);if(j.data.success)n.value=n.value.filter(D=>D.device_name!==C.value.device_name),f.value=!1,C.value=null,console.log("Device deleted successfully");else throw new Error(j.data.error||"Failed to delete device")}catch(j){console.error("Error deleting device:",j),$.error(`Failed to delete device: ${j.message}`)}finally{T.value=!1}}};return y({refresh:h}),(j,D)=>{var o,v,c;return A.value?(s(),i("div",un,[e("div",cn,[D[9]||(D[9]=e("div",{class:"banner-icon"},[e("i",{class:"mdi mdi-radar"})],-1)),e("div",mn,[D[7]||(D[7]=e("h3",null,"Untracked Devices Found",-1)),e("p",null,p(n.value.length)+" device"+p(n.value.length>1?"s":"")+" with learned commands found in Broadlink storage",1)]),e("button",{onClick:D[0]||(D[0]=B=>w.value=!0),class:"btn btn-primary"},[...D[8]||(D[8]=[e("i",{class:"mdi mdi-eye"},null,-1),_(" View Devices ",-1)])])]),w.value?(s(),i("div",{key:0,class:"modal-overlay",onClick:D[3]||(D[3]=me(B=>w.value=!1,["self"]))},[e("div",vn,[e("div",pn,[D[11]||(D[11]=e("h2",null,"Discovered Devices",-1)),e("button",{onClick:D[1]||(D[1]=B=>w.value=!1),class:"close-btn"},[...D[10]||(D[10]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",fn,[D[16]||(D[16]=e("p",{class:"info-text"}," These devices have learned commands in Broadlink storage but are not being tracked. Adopt them to manage their commands and generate Home Assistant entities. ",-1)),e("div",gn,[(s(!0),i(ge,null,be(n.value,B=>(s(),i("div",{key:B.device_name,class:"discovered-device"},[e("div",yn,[D[13]||(D[13]=e("div",{class:"device-icon"},[e("i",{class:"mdi mdi-devices"})],-1)),e("div",bn,[e("h4",null,p(B.device_name),1),e("span",hn,[D[12]||(D[12]=e("i",{class:"mdi mdi-remote"},null,-1)),_(" "+p(B.command_count)+" command"+p(B.command_count>1?"s":""),1)])])]),e("div",kn,[e("button",{onClick:K=>t(B),class:"btn btn-primary"},[...D[14]||(D[14]=[e("i",{class:"mdi mdi-plus"},null,-1),_(" Adopt ",-1)])],8,wn),e("button",{onClick:K=>x(B),class:"btn btn-danger",title:"Delete all commands"},[...D[15]||(D[15]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,$n)])]))),128))])]),e("div",Cn,[e("button",{onClick:D[2]||(D[2]=B=>w.value=!1),class:"btn btn-secondary"}," Close ")])])])):E("",!0),f.value?(s(),i("div",{key:1,class:"modal-overlay",onClick:D[6]||(D[6]=me(B=>f.value=!1,["self"]))},[e("div",Sn,[e("div",_n,[D[18]||(D[18]=e("h2",null,"Delete Untracked Device",-1)),e("button",{onClick:D[4]||(D[4]=B=>f.value=!1),class:"close-btn"},[...D[17]||(D[17]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",In,[e("div",Dn,[D[20]||(D[20]=e("i",{class:"mdi mdi-alert"},null,-1)),e("div",null,[e("p",null,[e("strong",null,'Are you sure you want to delete "'+p((o=C.value)==null?void 0:o.device_name)+'"?',1)]),e("p",null,"This will permanently delete all "+p((v=C.value)==null?void 0:v.command_count)+" command"+p(((c=C.value)==null?void 0:c.command_count)>1?"s":"")+" from Broadlink storage.",1),D[19]||(D[19]=e("p",{class:"warning-text"},"This action cannot be undone.",-1))])])]),e("div",Tn,[e("button",{onClick:D[5]||(D[5]=B=>f.value=!1),class:"btn btn-secondary",disabled:T.value}," Cancel ",8,xn),e("button",{onClick:P,class:"btn btn-danger",disabled:T.value},[e("i",{class:X(["mdi",T.value?"mdi-loading mdi-spin":"mdi-delete"])},null,2),_(" "+p(T.value?"Deleting...":"Delete"),1)],8,Rn)])])])):E("",!0)])):E("",!0)}}},On=he(Mn,[["__scopeId","data-v-24463050"]]),Ln={class:"device-list-card"},En={class:"card-header"},An={class:"header-badges"},Vn={class:"header-info"},jn={class:"header-right"},Un=["disabled"],Fn=["disabled"],Pn={class:"card-body"},Nn={key:0,class:"filter-bar"},Bn={class:"filter-row filter-row-search"},Hn={class:"filter-group filter-search"},qn={class:"filter-row filter-row-dropdowns"},Jn={class:"filter-group"},zn=["value"],Wn={class:"filter-group"},Gn=["value"],Kn={class:"filter-group"},Xn={key:0,class:"filter-group filter-toggle"},Yn={class:"toggle-label"},Zn={class:"filter-results"},Qn={key:1,class:"loading-state"},es={key:2,class:"error-state"},ts={key:3,class:"empty-state"},os={key:4,class:"device-grid"},ls={key:5,class:"no-results"},ns={__name:"DeviceList",setup(l){const y=st(),d=Ae(),$=b(!1),k=b(!1),n=b(null),w=b(!1),f=b(null),C=b(null),T=b(!0),A=b(!1),h=b(!1),t=()=>{T.value=!T.value},x=b(!1),P=b({title:"Error",message:"",suggestion:"",details:"",error:null,context:{}}),j=b(!1),D=b({success:!1,title:"",message:""}),o=b({search:"",broadlinkDevice:"",area:"",entityType:"",showSmartIROnly:!1}),v=b([]),c=we("smartirStatus"),B=we("smartirEnabled"),K=J(()=>{var g;return localStorage.getItem("smartir_simulate_not_installed")==="true"?!1:((g=c==null?void 0:c.value)==null?void 0:g.installed)||!1}),oe=J(()=>{const m=new Map;return y.devices.forEach(g=>{if(g.broadlink_entity){const R=v.value.find(q=>q.entity_id===g.broadlink_entity),U=R&&R.name||g.broadlink_entity;m.set(g.broadlink_entity,{entity_id:g.broadlink_entity,friendly_name:U})}}),Array.from(m.values()).sort((g,R)=>g.friendly_name.localeCompare(R.friendly_name))}),te=J(()=>{const m=new Set;return y.devices.forEach(g=>{g.area&&m.add(g.area)}),Array.from(m).sort()}),pe=J(()=>{let m=y.devices;if(o.value.search){const R=o.value.search.toLowerCase();m=m.filter(U=>{var ee,Q,W,fe,Te;if((ee=U.name)!=null&&ee.toLowerCase().includes(R)||(Q=U.entity_type)!=null&&Q.toLowerCase().includes(R)||(W=U.area)!=null&&W.toLowerCase().includes(R)||(fe=U.id)!=null&&fe.toLowerCase().includes(R)||Object.keys(U.commands||{}).some(Oe=>Oe.toLowerCase().includes(R)))return!0;const ne=v.value.find(Oe=>Oe.entity_id===U.broadlink_entity);return!!((Te=ne==null?void 0:ne.name)!=null&&Te.toLowerCase().includes(R))})}o.value.broadlinkDevice&&(m=m.filter(R=>R.broadlink_entity===o.value.broadlinkDevice||R.controller_device===o.value.broadlinkDevice)),o.value.area&&(m=m.filter(R=>R.area===o.value.area)),o.value.entityType&&(m=m.filter(R=>R.entity_type===o.value.entityType)),o.value.showSmartIROnly&&(m=m.filter(R=>R.device_type==="smartir"));const g=localStorage.getItem("smartir_simulate_not_installed")==="true";return(!(B!=null&&B.value)||g)&&(m=m.filter(R=>R.device_type!=="smartir")),m}),O=J(()=>o.value.search||o.value.broadlinkDevice||o.value.area||o.value.entityType||o.value.showSmartIROnly),N=()=>{o.value.search="",o.value.broadlinkDevice="",o.value.area="",o.value.entityType="",o.value.showSmartIROnly=!1},Y=async()=>{try{const m=await ce.get("/api/remote/devices");v.value=m.data.devices||[]}catch(m){console.error("Error loading remote devices:",m)}};De(async()=>{await Promise.all([y.loadDevices(),Y()])});const re=m=>{n.value=m,$.value=!0},ye=J(()=>{if(!f.value)return"";const m=Object.keys(f.value.commands||{}).length;return m===0?"This device has no commands. The device will be removed from tracking.":`This device has ${m} learned command${m>1?"s":""}. What would you like to do?`}),$e=J(()=>{if(!f.value)return"";const m=Object.keys(f.value.commands||{}).length;return m===0?"":`Also delete all ${m} command${m>1?"s":""} from Broadlink storage`}),Ie=m=>{f.value=m,w.value=!0},Ce=()=>{w.value=!1,f.value=null},S=async m=>{var R,U;const g=f.value;w.value=!1;try{await y.deleteDevice(g.id,m),C.value&&await C.value.refresh()}catch(q){const ne=((U=(R=q.response)==null?void 0:R.data)==null?void 0:U.error)||q.message||"Unknown error";r("Failed to Delete Device",ne)}finally{f.value=null}},u=async m=>{var g,R,U,q,ne;try{console.log("ğŸ’¾ Saving device data:",m),console.log("ğŸ’¾ Device commands:",m.commands),console.log("ğŸ’¾ Selected device:",n.value),(g=n.value)!=null&&g.id&&n.value.id!==null?await y.updateDevice(n.value.id,m):await y.createDevice(m),V(),C.value&&await C.value.refresh()}catch(ee){let Q="Failed to save device",W="",fe="";(U=(R=ee.response)==null?void 0:R.data)!=null&&U.error?(Q=ee.response.data.error,W=ee.response.data.suggestion||""):ee.message&&(Q=ee.message),ee.response&&(fe=`Status: ${ee.response.status}
URL: ${((q=ee.config)==null?void 0:q.url)||"N/A"}`),r("Failed to Save Device",Q,W,fe,ee,{action:"save_device",deviceData:m,isEdit:!!((ne=n.value)!=null&&ne.id)})}},V=()=>{$.value=!1,n.value=null},ie=m=>{n.value=m,k.value=!0},M=()=>{k.value=!1,n.value=null},r=(m,g,R="",U="",q=null,ne={})=>{P.value={title:m,message:g,suggestion:R,details:U,error:q,context:ne},x.value=!0},F=()=>{x.value=!1},Z=()=>{j.value=!1},ae=async m=>{if(m&&m.commands&&n.value){const g=y.devices.findIndex(R=>R.id===n.value.id);g!==-1&&(y.devices[g].commands=m.commands,console.log(`Optimistically updated device ${n.value.id} with new command: ${m.commandName}`))}y.loadDevices(),C.value&&C.value.refresh()},H=m=>{const g=m.split("_"),R=[];for(let U=0;U<g.length;U++){const q=g[U],ne=g[U+1];q&&ne==="s"&&g[U+2]?(R.push(q.charAt(0).toUpperCase()+q.slice(1)+"'s"),U++):q!=="s"&&R.push(q.charAt(0).toUpperCase()+q.slice(1))}return R.join(" ")},I=(m,g)=>{const R=m.toLowerCase(),U=g.map(Q=>Q.toLowerCase());return R.includes("lamp")||R.includes("light")?"light":R.includes("fan")?"fan":R.includes("tv")||R.includes("stereo")||R.includes("speaker")||R.includes("receiver")?"media_player":R.includes("blind")||R.includes("curtain")||R.includes("shade")||R.includes("garage")?"cover":U.some(Q=>Q.includes("volume")||Q.includes("channel")||Q.includes("play")||Q.includes("pause")||Q.includes("mute"))?"media_player":U.some(Q=>Q.includes("fan_speed")||Q.includes("fan_low")||Q.includes("fan_high"))?"fan":U.some(Q=>Q.includes("open")||Q.includes("close")||Q.includes("stop"))?"cover":"switch"},le=(m,g)=>{const R=m.toLowerCase();return R.includes("tv")?"mdi:television":R.includes("stereo")||R.includes("receiver")||R.includes("speaker")?"mdi:speaker":R.includes("lamp")?"mdi:lamp":R.includes("light")?"mdi:lightbulb":R.includes("fan")?"mdi:fan":R.includes("blind")?"mdi:blinds":R.includes("curtain")?"mdi:curtains":R.includes("garage")?"mdi:garage":{light:"mdi:lightbulb",fan:"mdi:fan",switch:"mdi:light-switch",media_player:"mdi:speaker",cover:"mdi:window-shutter"}[g]||"mdi:devices"},G=m=>{const g=m.toLowerCase().split("_");for(let q=0;q<g.length-2;q++)if(g[q+1]==="s"){const ne=g.slice(q,q+3),ee=H(ne.join("_"));return console.log("Detected possessive area:",ee,"from",m),ee}const R=[["living","room"],["dining","room"],["master","bedroom"],["guest","bedroom"],["family","room"],["laundry","room"],["home","office"]];for(let q=0;q<g.length-1;q++){const ne=[g[q],g[q+1]],ee=R.find(Q=>Q[0]===ne[0]&&Q[1]===ne[1]);if(ee)return H(ee.join("_"))}const U=["kitchen","bedroom","bathroom","garage","office","basement","attic","hallway","entryway","patio","deck","yard","garden"];for(const q of g)if(U.includes(q))return q.charAt(0).toUpperCase()+q.slice(1);return""},se=async m=>{const g=H(m.device_name),R=G(m.device_name),U=I(m.device_name,m.commands),q=le(m.device_name,U);let ne="";try{console.log("Finding Broadlink owner for:",m.device_name);const Q=await ce.post("/api/devices/find-broadlink-owner",{device_name:m.device_name});console.log("Broadlink owner response:",Q.data),ne=Q.data.broadlink_entity||"",console.log("Detected Broadlink entity:",ne)}catch(Q){console.error("Error finding Broadlink owner:",Q)}n.value={id:null,device:m.device_name,name:g,entity_type:U,commands:{},area:R,icon:q,broadlink_entity:ne,enabled:!0};const ee={};m.commands.forEach(Q=>{ee[Q]=Q}),n.value.commands=ee,$.value=!0},L=async()=>{h.value=!0;try{await y.syncAllAreas(),d.success("Areas synced from Home Assistant")}catch(m){console.error("Error syncing areas:",m),d.error("Failed to sync areas")}finally{h.value=!1}},a=async()=>{var m,g;A.value=!0;try{const R=await ce.post("/api/entities/generate",{});if(R.data.success){const U=R.data.broadlink_count||0,q=R.data.smartir_count||0,ne=R.data.total_count||0,ee=R.data.errors||[];let Q="âœ… Entity Generation Successful",W=[];const fe=[];U>0&&fe.push(`${U} Broadlink native`),q>0&&fe.push(`${q} SmartIR`),fe.length>0&&W.push(`Generated ${fe.join(" and ")} entity configuration${ne!==1?"s":""}.`),U>0&&(W.push(`
ğŸ“ Broadlink entities created in:`),W.push("  â€¢ broadlink_manager/entities.yaml"),W.push("  â€¢ broadlink_manager/helpers.yaml")),q>0&&(W.push(`
ğŸ“ SmartIR entities created in:`),W.push("  â€¢ smartir/climate.yaml"),W.push("  â€¢ smartir/media_player.yaml"),W.push("  â€¢ smartir/fan.yaml")),W.push(`
ğŸ“ Next steps:`),W.push("1. Check your configuration.yaml includes the generated files"),W.push("2. Restart Home Assistant to load the new entities"),ee.length>0&&(Q="âš ï¸ Entity Generation Completed with Errors",W.push(`
âš ï¸ ${ee.length} error${ee.length!==1?"s":""} occurred:`),ee.forEach(Te=>{W.push(`  â€¢ ${Te}`)})),D.value={success:!0,title:Q,message:W.join(`
`)},j.value=!0}else D.value={success:!1,title:"âŒ Entity Generation Failed",message:R.data.message||`Failed to generate entities.

Please check that you have at least one device configured.`},j.value=!0}catch(R){console.error("Error generating entities:",R);const U=((g=(m=R.response)==null?void 0:m.data)==null?void 0:g.error)||R.message||"Unknown error occurred";D.value={success:!1,title:"âŒ Entity Generation Error",message:`Failed to generate entities:

${U}

Please check the logs for more details.`},j.value=!0}finally{A.value=!1}};return(m,g)=>{var R;return s(),i("div",Ln,[e("div",En,[e("button",{class:"icon-button chevron-button",onClick:t},[e("i",{class:X(["mdi",T.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2)]),e("div",{class:"header-left",onClick:t},[g[8]||(g[8]=e("div",{class:"header-icon"},[e("i",{class:"mdi mdi-devices"})],-1)),g[9]||(g[9]=e("h3",null,"Managed Devices",-1)),e("div",An,[e("span",Vn,p(Se(y).deviceCount)+" devices",1)])]),e("div",jn,[T.value?(s(),i("button",{key:0,onClick:me(L,["stop"]),class:"btn btn-secondary",disabled:h.value,title:"Sync all areas from Home Assistant"},[e("i",{class:X(["mdi",h.value?"mdi-loading mdi-spin":"mdi-refresh"])},null,2),_(" "+p(h.value?"Syncing...":"Sync Areas"),1)],8,Un)):E("",!0),T.value?(s(),i("button",{key:1,onClick:me(a,["stop"]),class:"btn btn-secondary",disabled:A.value,title:"Generate entities for all devices"},[e("i",{class:X(["mdi",A.value?"mdi-loading mdi-spin":"mdi-file-code"])},null,2),_(" "+p(A.value?"Generating...":"Generate Entities"),1)],8,Fn)):E("",!0),T.value?(s(),i("button",{key:2,onClick:g[0]||(g[0]=me(U=>$.value=!0,["stop"])),class:"btn btn-primary"},[...g[10]||(g[10]=[e("i",{class:"mdi mdi-plus"},null,-1),_(" Add Device ",-1)])])):E("",!0)])]),z(e("div",Pn,[ve(On,{ref_key:"discoveryRef",ref:C,onAdopt:se},null,512),Se(y).hasDevices?(s(),i("div",Nn,[e("div",Bn,[e("div",Hn,[e("label",null,[g[11]||(g[11]=e("i",{class:"mdi mdi-magnify"},null,-1)),z(e("input",{"onUpdate:modelValue":g[1]||(g[1]=U=>o.value.search=U),type:"text",placeholder:"Search devices, commands...",class:"search-input"},null,512),[[_e,o.value.search]])])])]),e("div",qn,[e("div",Jn,[e("label",null,[g[13]||(g[13]=e("i",{class:"mdi mdi-access-point"},null,-1)),z(e("select",{"onUpdate:modelValue":g[2]||(g[2]=U=>o.value.broadlinkDevice=U)},[g[12]||(g[12]=e("option",{value:""},"All Controller Devices",-1)),(s(!0),i(ge,null,be(oe.value,U=>(s(),i("option",{key:U.entity_id,value:U.entity_id},p(U.friendly_name),9,zn))),128))],512),[[ke,o.value.broadlinkDevice]])])]),e("div",Wn,[e("label",null,[g[15]||(g[15]=e("i",{class:"mdi mdi-home-map-marker"},null,-1)),z(e("select",{"onUpdate:modelValue":g[3]||(g[3]=U=>o.value.area=U)},[g[14]||(g[14]=e("option",{value:""},"All Areas",-1)),(s(!0),i(ge,null,be(te.value,U=>(s(),i("option",{key:U,value:U},p(U),9,Gn))),128))],512),[[ke,o.value.area]])])]),e("div",Kn,[e("label",null,[g[17]||(g[17]=e("i",{class:"mdi mdi-shape"},null,-1)),z(e("select",{"onUpdate:modelValue":g[4]||(g[4]=U=>o.value.entityType=U)},[...g[16]||(g[16]=[Me('<option value="" data-v-d5ce8664>All Types</option><option value="light" data-v-d5ce8664>Light</option><option value="fan" data-v-d5ce8664>Fan</option><option value="switch" data-v-d5ce8664>Switch</option><option value="media_player" data-v-d5ce8664>Media Player</option><option value="cover" data-v-d5ce8664>Cover</option><option value="climate" data-v-d5ce8664>Climate</option>',7)])],512),[[ke,o.value.entityType]])])]),K.value?(s(),i("div",Xn,[e("label",Yn,[g[18]||(g[18]=e("span",{class:"toggle-text"},[e("img",{src:Ne,alt:"SmartIR",class:"smartir-icon"}),_(" SmartIR Only ")],-1)),z(e("input",{type:"checkbox","onUpdate:modelValue":g[5]||(g[5]=U=>o.value.showSmartIROnly=U),class:"toggle-checkbox"},null,512),[[de,o.value.showSmartIROnly]]),g[19]||(g[19]=e("span",{class:"toggle-slider"},null,-1))])])):E("",!0),O.value?(s(),i("button",{key:1,onClick:N,class:"btn-clear-filters"},[...g[20]||(g[20]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),_(" Clear ",-1)])])):E("",!0),e("div",Zn,p(pe.value.length)+" of "+p(Se(y).deviceCount),1)])])):E("",!0),Se(y).loading?(s(),i("div",Qn,[...g[21]||(g[21]=[e("i",{class:"mdi mdi-loading mdi-spin"},null,-1),e("p",null,"Loading devices...",-1)])])):Se(y).error?(s(),i("div",es,[g[22]||(g[22]=e("i",{class:"mdi mdi-alert-circle"},null,-1)),e("p",null,p(Se(y).error),1),e("button",{onClick:g[6]||(g[6]=U=>Se(y).loadDevices()),class:"btn btn-secondary"}," Retry ")])):Se(y).hasDevices?(s(),i("div",os,[(s(!0),i(ge,null,be(pe.value,U=>(s(),xe(Tt,{key:U.id,device:U,"broadlink-devices":v.value,onEdit:re,onDelete:Ie,onLearn:ie},null,8,["device","broadlink-devices"]))),128))])):(s(),i("div",ts,[g[24]||(g[24]=e("i",{class:"mdi mdi-devices"},null,-1)),g[25]||(g[25]=e("h3",null,"No Devices Yet",-1)),g[26]||(g[26]=e("p",null,"Get started by adding your first managed device",-1)),e("button",{onClick:g[7]||(g[7]=U=>$.value=!0),class:"btn btn-primary"},[...g[23]||(g[23]=[e("i",{class:"mdi mdi-plus"},null,-1),_(" Add Your First Device ",-1)])])])),Se(y).hasDevices&&pe.value.length===0?(s(),i("div",ls,[...g[27]||(g[27]=[e("i",{class:"mdi mdi-filter-off"},null,-1),e("h3",null,"No devices match your filters",-1),e("p",null,"Try adjusting your search or filter criteria",-1)])])):E("",!0)],512),[[Ge,T.value]]),$.value?(s(),xe(ll,{key:0,device:n.value,onSave:u,onCancel:V},null,8,["device"])):E("",!0),k.value?(s(),xe(Xl,{key:1,device:n.value,onLearned:ae,onCancel:M},null,8,["device"])):E("",!0),ve(Re,{isOpen:w.value,title:`Delete ${(R=f.value)==null?void 0:R.name}?`,message:ye.value,confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,checkboxLabel:$e.value,onConfirm:S,onCancel:Ce},null,8,["isOpen","title","message","checkboxLabel"]),ve(dn,{isOpen:x.value,title:P.value.title,message:P.value.message,suggestion:P.value.suggestion,details:P.value.details,error:P.value.error,context:P.value.context,onClose:F},null,8,["isOpen","title","message","suggestion","details","error","context"]),ve(Re,{isOpen:j.value,title:D.value.title,message:D.value.message,confirmText:"OK",showCancel:!1,dangerMode:!D.value.success,onConfirm:Z,onCancel:Z},null,8,["isOpen","title","message","dangerMode"])])}}},ss=he(ns,[["__scopeId","data-v-d5ce8664"]]),as={class:"banner-content"},is={class:"banner-icon"},rs={class:"banner-message"},ds={class:"banner-actions"},us={__name:"SmartIRBanner",setup(l){const y=we("smartirStatus"),d=b(!1),$=J(()=>!(!y.value||d.value||localStorage.getItem("smartir_banner_dismissed")==="true")),k=J(()=>{var A;return(A=y.value)!=null&&A.installed?"banner-success":"banner-info"}),n=J(()=>{var A;return(A=y.value)!=null&&A.installed?"mdi mdi-check-circle":"mdi mdi-information"}),w=J(()=>{var A;return(A=y.value)!=null&&A.installed?`SmartIR Detected (v${y.value.version})`:"Want Climate Device Support?"}),f=J(()=>{var A;return(A=y.value)!=null&&A.installed?"You can now create climate device profiles with full temperature and HVAC mode control.":"Install SmartIR to unlock AC/heater control with temperature settings, HVAC modes, and 120+ pre-configured device profiles."});function C(){window.open("https://github.com/smartHomeHub/SmartIR","_blank")}function T(){var A;if(d.value=!0,(A=y.value)!=null&&A.installed)localStorage.setItem("smartir_banner_dismissed","true");else{const h=parseInt(localStorage.getItem("smartir_banner_dismiss_count")||"0");h>=2?localStorage.setItem("smartir_banner_dismissed","true"):localStorage.setItem("smartir_banner_dismiss_count",String(h+1))}}return De(()=>{var t;const A=localStorage.getItem("smartir_last_status"),h=(t=y.value)!=null&&t.installed?"installed":"not_installed";A!==h&&(localStorage.removeItem("smartir_banner_dismissed"),localStorage.removeItem("smartir_banner_dismiss_count"),localStorage.setItem("smartir_last_status",h))}),(A,h)=>{var t,x;return $.value?(s(),i("div",{key:0,class:X(["smartir-banner",k.value])},[e("div",as,[e("div",is,[e("i",{class:X(n.value)},null,2)]),e("div",rs,[e("strong",null,p(w.value),1),e("p",null,p(f.value),1)]),e("div",ds,[(t=A.status)!=null&&t.installed?E("",!0):(s(),i("button",{key:0,onClick:C,class:"btn-primary"}," Learn More ")),e("button",{onClick:T,class:"btn-text"},p((x=A.status)!=null&&x.installed?"Got it":"Dismiss"),1)])])],2)):E("",!0)}}},cs=he(us,[["__scopeId","data-v-7bbcbcd7"]]),Le="api/smartir",Xe={async getStatus(){try{const l=await fetch(`${Le}/status`);if(!l.ok)throw new Error(`HTTP error! status: ${l.status}`);return await l.json()}catch(l){return console.error("Error fetching SmartIR status:",l),{installed:!1,version:null,error:l.message}}},async getInstallInstructions(){try{const l=await fetch(`${Le}/install-instructions`);if(!l.ok)throw new Error(`HTTP error! status: ${l.status}`);return await l.json()}catch(l){throw console.error("Error fetching install instructions:",l),l}},async getPlatforms(){try{const l=await fetch(`${Le}/platforms`);if(!l.ok)throw new Error(`HTTP error! status: ${l.status}`);return await l.json()}catch(l){throw console.error("Error fetching platforms:",l),l}},async getPlatformCodes(l){try{const y=await fetch(`${Le}/platforms/${l}/codes`);if(!y.ok)throw new Error(`HTTP error! status: ${y.status}`);return await y.json()}catch(y){throw console.error(`Error fetching codes for ${l}:`,y),y}},async getNextCode(l){try{const y=await fetch(`${Le}/platforms/${l}/next-code`);if(!y.ok)throw new Error(`HTTP error! status: ${y.status}`);return await y.json()}catch(y){throw console.error(`Error fetching next code for ${l}:`,y),y}},async validateCode(l,y){try{const d=await fetch(`${Le}/validate-code`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({platform:l,code:y})});if(!d.ok)throw new Error(`HTTP error! status: ${d.status}`);return await d.json()}catch(d){throw console.error("Error validating code:",d),d}}},ms={class:"profile-card"},vs={class:"profile-card-header"},ps=["title"],fs={class:"profile-details"},gs=["title"],ys={class:"profile-meta"},bs=["title"],hs=["title"],ks=["title"],ws={class:"profile-card-footer"},$s=["title"],Cs={key:0,class:"learned-indicator"},Ss={class:"profile-actions"},_s={__name:"SmartIRProfileCard",props:{profile:{type:Object,required:!0}},emits:["edit","download","delete","commands"],setup(l){const y=l,d=Ke(J(()=>y.profile.platform)),$=w=>w.replace(/_/g," ").replace(/\b\w/g,f=>f.toUpperCase()),k=w=>w&&w.startsWith("mdi:")?`mdi ${w.replace(":"," mdi-")}`:`mdi mdi-${w}`,n=w=>{if(!w)return"";const f=w.toLowerCase();return f.includes("broadlink")?"broadlink-tag":f.includes("not set")?"not-set-tag":"default-controller-tag"};return(w,f)=>(s(),i("div",ms,[e("div",vs,[e("div",{class:X(["profile-icon",Se(d).colorClass.value]),title:$(l.profile.platform)},[e("i",{class:X(k(Se(d).icon.value))},null,2)],10,ps),e("div",fs,[e("h4",{title:`${l.profile.manufacturer} ${l.profile.model}`},p(l.profile.manufacturer)+" "+p(l.profile.model),9,gs),e("div",ys,[e("span",{class:"tag platform-tag",title:$(l.profile.platform)},p($(l.profile.platform)),9,bs),l.profile.controllerBrand?(s(),i("span",{key:0,class:X(["tag controller-tag",n(l.profile.controllerBrand)]),title:"Controller: "+l.profile.controllerBrand},[f[4]||(f[4]=e("i",{class:"mdi mdi-remote-tv"},null,-1)),_(" "+p(l.profile.controllerBrand),1)],10,hs)):E("",!0)])]),e("div",{class:"code-badge",title:"Device Code: "+l.profile.code},p(l.profile.code),9,ks)]),e("div",ws,[e("div",{class:"profile-stats",title:l.profile.commandCount+" total commands"+(l.profile.learnedCount>0?", "+l.profile.learnedCount+" learned":"")},[f[5]||(f[5]=e("i",{class:"mdi mdi-remote"},null,-1)),e("span",null,p(l.profile.commandCount)+" command"+p(l.profile.commandCount!==1?"s":""),1),l.profile.learnedCount>0?(s(),i("span",Cs,"( "+p(l.profile.learnedCount)+" learned )",1)):E("",!0)],8,$s),e("div",Ss,[e("button",{onClick:f[0]||(f[0]=C=>w.$emit("commands")),class:"action-btn",title:"Commands"},[...f[6]||(f[6]=[e("i",{class:"mdi mdi-remote-tv"},null,-1)])]),e("button",{onClick:f[1]||(f[1]=C=>w.$emit("edit")),class:"action-btn",title:"Edit Profile"},[...f[7]||(f[7]=[e("i",{class:"mdi mdi-pencil"},null,-1)])]),e("button",{onClick:f[2]||(f[2]=C=>w.$emit("download")),class:"action-btn",title:"Download JSON"},[...f[8]||(f[8]=[e("i",{class:"mdi mdi-download"},null,-1)])]),e("button",{onClick:f[3]||(f[3]=C=>w.$emit("delete")),class:"action-btn delete",title:"Delete Profile"},[...f[9]||(f[9]=[e("i",{class:"mdi mdi-delete"},null,-1)])])])])]))}},Is=he(_s,[["__scopeId","data-v-05a90b96"]]),Ds={class:"modal-container"},Ts={class:"modal-body"},xs={key:0,class:"selection-section"},Rs={class:"form-group"},Ms={class:"form-group"},Os={class:"form-group"},Ls={key:0,class:"code-info"},Es={class:"form-actions"},As=["disabled"],Vs={key:1,class:"testing-section"},js={class:"code-header"},Us={class:"code-details"},Fs={class:"code-badge"},Ps={class:"device-selector"},Ns=["value"],Bs={class:"commands-section"},Hs={class:"commands-header"},qs={key:0,class:"tested-count"},Js={key:0,class:"filters-section"},zs={class:"filter-row"},Ws={class:"filter-row"},Gs={key:1,class:"empty-state"},Ks={key:2,class:"empty-state"},Xs={key:3,class:"commands-list"},Ys={class:"command-name"},Zs={class:"command-actions"},Qs={key:0,class:"status-badge success"},ea=["onClick","disabled"],ta={__name:"SmartIRCodeTester",props:{isOpen:{type:Boolean,default:!1}},emits:["close","clone"],setup(l,{emit:y}){const d=l,$=y,k=we("toast"),n=b("climate"),w=b(""),f=b([]),C=b(!1),T=b(null),A=b(""),h=b([]),t=b(!1),x=J(()=>h.value.map(H=>({code:H.code,label:`${H.models.join(", ")} (Code: ${H.code})`,value:H.code}))),P=b(null),j=b(null),D=b(!1),o=b([]),v=b(""),c=b([]),B=b(new Set),K=b(null),oe=b(""),te=b(""),pe=b(""),O=b(""),N=J(()=>{let H=c.value;if(oe.value){const I=oe.value.toLowerCase();H=H.filter(le=>(le.label||le.name).toLowerCase().includes(I))}return te.value&&(H=H.filter(I=>I.mode===te.value)),pe.value&&(H=H.filter(I=>I.fanSpeed===pe.value)),O.value&&(H=H.filter(I=>I.swingMode===O.value)),H}),Y=J(()=>oe.value||te.value||pe.value||O.value);ue(()=>d.isOpen,H=>{H&&(re(),$e())}),ue(n,()=>{d.isOpen&&(w.value="",T.value=null,h.value=[],re())});async function re(){var H;C.value=!0;try{const I=await fetch(`/api/smartir/codes/manufacturers?entity_type=${n.value}`);if(!I.ok)throw new Error("Failed to load manufacturers");const le=await I.json();f.value=le.manufacturers||[]}catch(I){console.error("Error loading manufacturers:",I),(H=k.value)==null||H.error("Failed to load manufacturers","âŒ Error")}finally{C.value=!1}}async function ye(){var H;if(w.value){t.value=!0;try{const I=await fetch(`/api/smartir/codes/models?entity_type=${n.value}&manufacturer=${encodeURIComponent(w.value)}`);if(!I.ok)throw new Error("Failed to load models");const le=await I.json();h.value=le.models||[]}catch(I){console.error("Error loading models:",I),(H=k.value)==null||H.error("Failed to load models","âŒ Error")}finally{t.value=!1}}}async function $e(){try{const H=await fetch("/api/remote/devices");if(!H.ok)throw new Error("Failed to load devices");const I=await H.json();o.value=I.devices||[]}catch(H){console.error("Error loading Broadlink devices:",H)}}async function Ie(){var H,I;if(T.value){D.value=!0;try{const le=await fetch(`/api/smartir/codes/code?entity_type=${n.value}&code_id=${T.value.code}`);if(!le.ok)throw new Error("Failed to load code");const G=await le.json();j.value=G.code,P.value=T.value.code,Ce(G.code),(H=k.value)==null||H.success(`Loaded ${c.value.length} commands`,"âœ… Code Loaded")}catch(le){console.error("Error loading code:",le),(I=k.value)==null||I.error(le.message||"Failed to load code","âŒ Error")}finally{D.value=!1}}}function Ce(H){const I=[];if(!H.commands){c.value=I;return}if(n.value==="climate"){const G=H.commands;for(const[se,L]of Object.entries(G)){if(se==="off"){typeof L=="string"&&I.push({name:"off",label:"OFF",data:L,mode:"off"});continue}if(typeof L=="object"){for(const[a,m]of Object.entries(L))if(typeof m=="object")for(const[g,R]of Object.entries(m)){if(typeof R!="object")continue;const U=Object.keys(R),q=U.includes("24")?"24":U[0];if(q&&typeof R[q]=="string"){const ne=`${se}_${q}_${a}_${g}`,ee=`${se.toUpperCase()} ${q}Â°C ${a} ${g}`;I.push({name:ne,label:ee,data:R[q],mode:se,temperature:q,fanSpeed:a,swingMode:g})}}}}}else for(const[G,se]of Object.entries(H.commands))typeof se=="string"&&I.push({name:G,label:G.toUpperCase().replace(/_/g," "),data:se});c.value=I}async function S(H){var I,le,G;if(!v.value){(I=k.value)==null||I.warning("Please select a Broadlink device first","âš ï¸ No Device");return}K.value=H;try{const se=c.value.find(a=>a.name===H);if(!se||!se.data)throw new Error(`Command "${H}" not found`);const L=await fetch("/api/commands/send-raw",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({entity_id:v.value,command:se.data,command_type:"ir"})});if(!L.ok){const a=await L.json();throw new Error(a.error||"Failed to send command")}B.value.add(H),(le=k.value)==null||le.success(`Command sent: ${se.label||H}`,"âœ… Tested")}catch(se){console.error("Error testing command:",se),(G=k.value)==null||G.error("Failed to test command","âŒ Error")}finally{K.value=null}}function u(){var H,I,le,G;if(!j.value){(H=k.value)==null||H.error("No profile data to download","âŒ Error");return}try{const se=j.value.manufacturer||"unknown",L=((I=j.value.supportedModels)==null?void 0:I[0])||P.value,a=`${se.toLowerCase().replace(/\s+/g,"_")}_${L.toLowerCase().replace(/\s+/g,"_")}.json`,m=JSON.stringify(j.value,null,2),g=new Blob([m],{type:"application/json"}),R=URL.createObjectURL(g),U=document.createElement("a");U.href=R,U.download=a,document.body.appendChild(U),U.click(),document.body.removeChild(U),URL.revokeObjectURL(R),(le=k.value)==null||le.success(`Downloaded ${a}`,"âœ… Download Complete")}catch(se){console.error("Error downloading JSON:",se),(G=k.value)==null||G.error(se.message||"Failed to download JSON","âŒ Download Error")}}function V(){w.value="",T.value=null,A.value="",h.value=[]}function ie(){T.value=null,A.value="",ye()}function M(){A.value?T.value=h.value.find(H=>H.code===A.value):T.value=null}function r(){oe.value="",te.value="",pe.value="",O.value=""}function F(){P.value=null,j.value=null,c.value=[],B.value.clear(),K.value=null,r()}function Z(H){const I=H.toLowerCase();return I.includes("power")||I.includes("off")||I==="off"?"mdi-power":I.includes("cool")?"mdi-snowflake":I.includes("heat")?"mdi-fire":I.includes("fan")?"mdi-fan":I.includes("auto")?"mdi-auto-fix":I.includes("dry")?"mdi-water-percent":I.includes("temp")?"mdi-thermometer":I.includes("swing")?"mdi-swap-vertical":"mdi-remote"}function ae(){F(),w.value="",T.value=null,$("close")}return(H,I)=>{var le;return l.isOpen?(s(),i("div",{key:0,class:"modal-overlay",onClick:me(ae,["self"])},[e("div",Ds,[e("div",{class:"modal-header"},[I[9]||(I[9]=e("h3",null,[e("i",{class:"mdi mdi-test-tube"}),_(" Test SmartIR Code ")],-1)),e("button",{onClick:ae,class:"close-btn"},[...I[8]||(I[8]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Ts,[P.value?(s(),i("div",Vs,[e("div",js,[e("div",Us,[e("h4",null,p(j.value.manufacturer)+" - "+p(((le=j.value.supportedModels)==null?void 0:le[0])||"Unknown"),1),e("span",Fs,"Code: "+p(P.value),1)]),e("button",{onClick:F,class:"btn-secondary-small"},[...I[14]||(I[14]=[e("i",{class:"mdi mdi-arrow-left"},null,-1),_(" Change Code ",-1)])])]),e("div",Ps,[I[16]||(I[16]=e("label",null,[e("i",{class:"mdi mdi-remote"}),_(" Broadlink Device ")],-1)),z(e("select",{"onUpdate:modelValue":I[3]||(I[3]=G=>v.value=G),class:"form-select"},[I[15]||(I[15]=e("option",{value:""},"Select device to test with...",-1)),(s(!0),i(ge,null,be(o.value,G=>(s(),i("option",{key:G.entity_id,value:G.entity_id},p(G.friendly_name||G.entity_id),9,Ns))),128))],512),[[ke,v.value]])]),e("div",Bs,[e("div",Hs,[e("h5",null,"Sample Commands ("+p(N.value.length)+" / "+p(c.value.length)+")",1),B.value.size>0?(s(),i("span",qs,p(B.value.size)+" tested ",1)):E("",!0)]),n.value==="climate"&&c.value.length>0?(s(),i("div",Js,[e("div",zs,[z(e("input",{"onUpdate:modelValue":I[4]||(I[4]=G=>oe.value=G),type:"text",placeholder:"Search commands...",class:"search-input"},null,512),[[_e,oe.value]])]),e("div",Ws,[z(e("select",{"onUpdate:modelValue":I[5]||(I[5]=G=>te.value=G),class:"filter-select"},[...I[17]||(I[17]=[e("option",{value:""},"All Modes",-1),e("option",{value:"cool"},"Cool",-1),e("option",{value:"heat"},"Heat",-1),e("option",{value:"off"},"Off",-1)])],512),[[ke,te.value]]),z(e("select",{"onUpdate:modelValue":I[6]||(I[6]=G=>pe.value=G),class:"filter-select"},[...I[18]||(I[18]=[Me('<option value="" data-v-64d207ed>All Fan Speeds</option><option value="low" data-v-64d207ed>Low</option><option value="mid" data-v-64d207ed>Mid</option><option value="high" data-v-64d207ed>High</option><option value="auto" data-v-64d207ed>Auto</option>',5)])],512),[[ke,pe.value]]),z(e("select",{"onUpdate:modelValue":I[7]||(I[7]=G=>O.value=G),class:"filter-select"},[...I[19]||(I[19]=[e("option",{value:""},"All Swing",-1),e("option",{value:"stop"},"Stop",-1),e("option",{value:"swing"},"Swing",-1)])],512),[[ke,O.value]]),Y.value?(s(),i("button",{key:0,onClick:r,class:"btn-clear-filters"},[...I[20]||(I[20]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),_(" Clear ",-1)])])):E("",!0)])])):E("",!0),c.value.length===0?(s(),i("div",Gs,[...I[21]||(I[21]=[e("i",{class:"mdi mdi-alert-circle"},null,-1),e("p",null,"No commands found in this code",-1)])])):N.value.length===0?(s(),i("div",Ks,[I[22]||(I[22]=e("i",{class:"mdi mdi-filter-off"},null,-1)),I[23]||(I[23]=e("p",null,"No commands match your filters",-1)),e("button",{onClick:r,class:"btn-secondary-small"}," Clear Filters ")])):(s(),i("div",Xs,[(s(!0),i(ge,null,be(N.value,G=>(s(),i("div",{key:G.name,class:X(["command-item",{tested:B.value.has(G.name),testing:K.value===G.name}])},[e("div",Ys,[e("i",{class:X(["mdi",Z(G.mode||G.name)])},null,2),e("span",null,p(G.label||G.name),1)]),e("div",Zs,[B.value.has(G.name)?(s(),i("span",Qs,[...I[24]||(I[24]=[e("i",{class:"mdi mdi-check"},null,-1),_(" Tested ",-1)])])):E("",!0),e("button",{onClick:se=>S(G.name),disabled:!v.value||K.value===G.name,class:"btn-test"},[e("i",{class:X(["mdi",K.value===G.name?"mdi-loading mdi-spin":"mdi-play"])},null,2),I[25]||(I[25]=_(" Test ",-1))],8,ea)])],2))),128))]))]),e("div",{class:"modal-actions"},[e("button",{onClick:u,class:"btn-primary"},[...I[26]||(I[26]=[e("i",{class:"mdi mdi-download"},null,-1),_(" Download JSON ",-1)])]),e("button",{onClick:ae,class:"btn-secondary"}," Close ")])])):(s(),i("div",xs,[I[13]||(I[13]=e("div",{class:"info-banner"},[e("i",{class:"mdi mdi-information"}),e("p",null,"Select a SmartIR code from the index to test commands with your Broadlink device.")],-1)),e("div",Rs,[I[11]||(I[11]=e("label",null,[e("i",{class:"mdi mdi-shape"}),_(" Platform ")],-1)),z(e("select",{"onUpdate:modelValue":I[0]||(I[0]=G=>n.value=G),onChange:V,class:"form-select"},[...I[10]||(I[10]=[e("option",{value:"climate"},"Climate (AC/Heater)",-1),e("option",{value:"media_player"},"Media Player (TV/Audio)",-1),e("option",{value:"fan"},"Fan",-1),e("option",{value:"light"},"Light",-1)])],544),[[ke,n.value]])]),e("div",Ms,[ve(Fe,{modelValue:w.value,"onUpdate:modelValue":I[1]||(I[1]=G=>w.value=G),options:f.value,label:"Manufacturer",placeholder:"Search manufacturers...",loading:C.value,disabled:C.value,onChange:ie},null,8,["modelValue","options","loading","disabled"])]),e("div",Os,[ve(Fe,{modelValue:A.value,"onUpdate:modelValue":I[2]||(I[2]=G=>A.value=G),options:x.value,"option-label":"label","option-value":"code",label:"Model",placeholder:"Search models...",loading:t.value,disabled:!w.value||t.value,onChange:M},null,8,["modelValue","options","loading","disabled"])]),T.value?(s(),i("div",Ls,[I[12]||(I[12]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[e("strong",null,p(w.value)+" - "+p(T.value.models[0]),1),e("p",null,"Code: "+p(T.value.code),1)])])):E("",!0),e("div",Es,[e("button",{onClick:Ie,disabled:!T.value||D.value,class:"btn-primary"},[e("i",{class:X(["mdi",D.value?"mdi-loading mdi-spin":"mdi-download"])},null,2),_(" "+p(D.value?"Loading...":"Load Commands"),1)],8,As)])]))])])])):E("",!0)}}},oa=he(ta,[["__scopeId","data-v-64d207ed"]]),la={class:"smartir-status-card"},na={class:"card-header"},sa=["src"],aa={class:"header-badges"},ia=["title"],ra={class:"header-info"},da={class:"header-info"},ua={class:"header-info"},ca={class:"header-right"},ma={key:0,class:"card-body loading-state"},va={key:1,class:"card-body error-state"},pa={key:2,class:"card-body installed-state"},fa={key:0,class:"help-panel"},ga={key:0,class:"recommendation"},ya={key:0,class:"next-steps"},ba={key:1,class:"filter-bar"},ha={class:"filter-row"},ka={class:"filter-group filter-search"},wa={class:"filter-group"},$a={class:"filter-results"},Ca={key:2,class:"loading-state"},Sa={key:3,class:"empty-state"},_a={key:4,class:"profiles-grid"},Ia={key:5,class:"no-results"},Da={key:3,class:"card-body not-installed-state"},Ta={class:"benefits-section"},xa={class:"benefits-list"},Ra={class:"recommendation"},Ma={__name:"SmartIRStatusCard",emits:["create-profile","show-install-guide","edit-profile"],setup(l,{expose:y,emit:d}){const $=d,k=we("smartirStatus");we("smartirEnabled");const n=we("refreshSmartIR"),w=b(!1),f=b(null),C=b((k==null?void 0:k.value)||null),T=b(localStorage.getItem("smartir_simulate_not_installed")==="true"),A=b(!1),h=b(!0),t=b([]),x=b(!1),P=b({search:"",platform:""}),j=b({show:!1,title:"",message:"",platform:null,profile:null}),D=b(!1),o=["Full climate entity support (AC, heaters)","120+ pre-configured device profiles","Temperature and humidity sensor integration","HVAC mode control (heat, cool, auto, dry, fan)"],v=["climate","media_player","fan","light"],c=J(()=>T.value?{installed:!1,recommendation:{message:"Install SmartIR to unlock climate device support!",benefits:["Full climate entity support (AC, heaters)","120+ pre-configured device profiles","Temperature and humidity sensor integration","HVAC mode control (heat, cool, auto, dry, fan)"]}}:C.value),B=J(()=>{var M,r;return((r=(M=c.value)==null?void 0:M.platforms)==null?void 0:r.length)||0}),K=J(()=>{var M;return(M=c.value)!=null&&M.device_counts?Object.values(c.value.device_counts).reduce((r,F)=>r+F,0):0});function oe(){var M;T.value=!T.value,localStorage.setItem("smartir_simulate_not_installed",T.value.toString()),!T.value&&((M=C.value)!=null&&M.installed)&&Ce()}const te=J(()=>{let M=t.value;if(P.value.search){const r=P.value.search.toLowerCase();M=M.filter(F=>{var Z,ae,H,I;return((Z=F.manufacturer)==null?void 0:Z.toLowerCase().includes(r))||((ae=F.model)==null?void 0:ae.toLowerCase().includes(r))||((H=F.code)==null?void 0:H.toString().includes(r))||((I=F.platform)==null?void 0:I.toLowerCase().includes(r))})}return P.value.platform&&(M=M.filter(r=>r.platform===P.value.platform)),M}),pe=J(()=>P.value.search||P.value.platform);function O(){P.value.search="",P.value.platform=""}async function N(){w.value=!0,f.value=null;try{if(n)await n();else{const M=await Xe.getStatus();C.value=M}}catch(M){f.value=M.message||"Failed to refresh SmartIR status",console.error("Error refreshing SmartIR status:",M)}finally{w.value=!1}}function Y(){$("create-profile")}function re(){D.value=!0}function ye(){$("show-install-guide")}function $e(){window.open("https://github.com/smartHomeHub/SmartIR","_blank")}function Ie(){window.open("https://github.com/smartHomeHub/SmartIR","_blank")}async function Ce(){x.value=!0;const M=[];try{for(const r of v)try{const F=await fetch(`api/smartir/platforms/${r}/profiles`);if(F.ok){const ae=((await F.json()).profiles||[]).map(H=>({...H,platform:r}));M.push(...ae)}}catch(F){console.error(`Error loading ${r} profiles:`,F)}t.value=M}finally{x.value=!1}}function S(M,r,F){$("edit-profile",{platform:M,profile:r,startStep:F})}async function u(M,r){var F,Z;try{const ae=await fetch(`api/smartir/platforms/${M}/profiles/${r.code}`);if(!ae.ok)throw new Error("Failed to fetch profile");const H=await ae.json(),I=JSON.stringify(H.profile,null,2),le=new Blob([I],{type:"application/json"}),G=URL.createObjectURL(le),se=document.createElement("a");se.href=G,se.download=`smartir_${M}_${r.manufacturer}_${r.model}_${r.code}.json`,document.body.appendChild(se),se.click(),document.body.removeChild(se),URL.revokeObjectURL(G),(F=we("toast").value)==null||F.success(`Downloaded ${r.manufacturer} ${r.model}`,"âœ… Profile Downloaded")}catch(ae){console.error("Error downloading profile:",ae),(Z=we("toast").value)==null||Z.error("Failed to download profile","âŒ Download Error")}}async function V(M,r){we("toast");try{const F=await fetch(`api/smartir/profiles/${r.code}/check-usage`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({platform:M})});if(F.ok){const Z=await F.json();if(Z.in_use){j.value={show:!0,title:`Cannot Delete ${r.manufacturer} ${r.model}`,message:`This profile is currently in use by ${Z.device_count} device(s):

${Z.devices.join(`
`)}

Please remove or reassign these devices before deleting the profile.`,platform:M,profile:r,canDelete:!1,devices:Z.devices};return}}}catch(F){console.error("Error checking profile usage:",F)}j.value={show:!0,title:`Delete ${r.manufacturer} ${r.model}?`,message:`Device Code: ${r.code}

This will remove the profile and update your configuration.`,platform:M,profile:r,canDelete:!0}}async function ie(){var Z,ae,H;const M=we("toast"),{platform:r,profile:F}=j.value;j.value.show=!1;try{const I=await fetch(`api/smartir/profiles/${F.code}`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({platform:r})});if(I.ok)await Ce(),await ze(),await N(),(Z=M.value)==null||Z.success(`${F.manufacturer} ${F.model} has been removed`,"âœ… Profile Deleted");else{const le=await I.json();(ae=M.value)==null||ae.error(le.error||"Unknown error","âŒ Delete Failed")}}catch(I){console.error("Error deleting profile:",I),(H=M.value)==null||H.error("Failed to delete profile","âŒ Delete Error")}}return ue(k,M=>{M&&(C.value=M)},{immediate:!0}),De(async()=>{var M;k!=null&&k.value&&(C.value=k.value),C.value||await N(),(M=C.value)!=null&&M.installed&&await Ce()}),y({loadAllProfiles:Ce,refreshStatus:N}),(M,r)=>{var F,Z,ae,H,I,le,G,se,L,a;return s(),i("div",la,[e("div",na,[e("button",{class:"icon-button chevron-button",onClick:r[0]||(r[0]=m=>h.value=!h.value)},[e("i",{class:X(["mdi",h.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2)]),e("div",{class:"header-left",onClick:r[1]||(r[1]=m=>h.value=!h.value)},[e("img",{src:Se(Ne),alt:"SmartIR",class:"smartir-logo"},null,8,sa),r[8]||(r[8]=e("h3",null,"SmartIR Integration",-1)),e("div",aa,[e("div",{class:X(["simulation-toggle-pill",{active:T.value}]),onClick:me(oe,["stop"]),title:T.value?"Click to show as installed":"Click to simulate not-installed"},[e("i",{class:X(["mdi",T.value?"mdi-eye-off":"mdi-eye"])},null,2),e("span",null,p(T.value?"Simulating: Not Installed":"Simulation Mode"),1)],10,ia),(F=c.value)!=null&&F.installed?(s(),i(ge,{key:0},[r[7]||(r[7]=e("div",{class:"status-badge-mini success"},[e("i",{class:"mdi mdi-check-circle"}),e("span",null,"Installed")],-1)),e("span",ra,"v"+p(c.value.version||"Unknown"),1),e("span",da,p(B.value)+" platform"+p(B.value!==1?"s":""),1),e("span",ua,p(K.value)+" device"+p(K.value!==1?"s":""),1)],64)):E("",!0)])]),e("div",ca,[(Z=C.value)!=null&&Z.installed&&h.value?(s(),i("button",{key:0,onClick:r[2]||(r[2]=me(m=>A.value=!A.value,["stop"])),class:X(["icon-button",{active:A.value}]),title:"Show help"},[...r[9]||(r[9]=[e("i",{class:"mdi mdi-help-circle"},null,-1)])],2)):E("",!0),(ae=C.value)!=null&&ae.installed&&h.value?(s(),i("button",{key:1,onClick:me(N,["stop"]),class:"icon-button",title:"Refresh status"},[...r[10]||(r[10]=[e("i",{class:"mdi mdi-refresh"},null,-1)])])):E("",!0),(H=C.value)!=null&&H.installed&&h.value?(s(),i("button",{key:2,onClick:me(re,["stop"]),class:"btn btn-secondary"},[...r[11]||(r[11]=[e("i",{class:"mdi mdi-test-tube"},null,-1),_(" Test Codes ",-1)])])):E("",!0),(I=C.value)!=null&&I.installed&&h.value?(s(),i("button",{key:3,onClick:me(Y,["stop"]),class:"btn btn-primary"},[...r[12]||(r[12]=[e("i",{class:"mdi mdi-plus"},null,-1),_(" Create SmartIR Profile ",-1)])])):E("",!0)])]),z(e("div",null,[w.value?(s(),i("div",ma,[...r[13]||(r[13]=[e("div",{class:"spinner"},null,-1),e("p",null,"Checking SmartIR installation...",-1)])])):f.value?(s(),i("div",va,[r[14]||(r[14]=e("i",{class:"mdi mdi-alert-circle"},null,-1)),e("p",null,p(f.value),1),e("button",{onClick:N,class:"btn-secondary"}," Try Again ")])):(le=c.value)!=null&&le.installed?(s(),i("div",pa,[A.value?(s(),i("div",fa,[C.value.recommendation?(s(),i("div",ga,[e("p",null,p(C.value.recommendation.message),1),C.value.recommendation.next_steps?(s(),i("div",ya,[r[15]||(r[15]=e("strong",null,"Next Steps:",-1)),e("ul",null,[(s(!0),i(ge,null,be(C.value.recommendation.next_steps,(m,g)=>(s(),i("li",{key:g},p(m),1))),128))])])):E("",!0)])):E("",!0),e("div",{class:"help-actions"},[e("button",{onClick:$e,class:"btn-secondary"},[...r[16]||(r[16]=[e("i",{class:"mdi mdi-book-open-variant"},null,-1),_(" View Documentation ",-1)])])])])):E("",!0),t.value.length>0&&!T.value?(s(),i("div",ba,[e("div",ha,[e("div",ka,[e("label",null,[r[17]||(r[17]=e("i",{class:"mdi mdi-magnify"},null,-1)),z(e("input",{"onUpdate:modelValue":r[3]||(r[3]=m=>P.value.search=m),type:"text",placeholder:"Search profiles...",class:"search-input"},null,512),[[_e,P.value.search]])])]),e("div",wa,[e("label",null,[r[19]||(r[19]=e("i",{class:"mdi mdi-shape"},null,-1)),z(e("select",{"onUpdate:modelValue":r[4]||(r[4]=m=>P.value.platform=m)},[...r[18]||(r[18]=[Me('<option value="" data-v-ba7b97e0>All Platforms</option><option value="climate" data-v-ba7b97e0>Climate</option><option value="media_player" data-v-ba7b97e0>Media Player</option><option value="fan" data-v-ba7b97e0>Fan</option><option value="light" data-v-ba7b97e0>Light</option>',5)])],512),[[ke,P.value.platform]])])]),pe.value?(s(),i("button",{key:0,onClick:O,class:"btn-clear-filters"},[...r[20]||(r[20]=[e("i",{class:"mdi mdi-filter-remove"},null,-1),_(" Clear ",-1)])])):E("",!0),e("div",$a,p(te.value.length)+" of "+p(t.value.length),1)])])):E("",!0),x.value?(s(),i("div",Ca,[...r[21]||(r[21]=[e("i",{class:"mdi mdi-loading mdi-spin"},null,-1),e("p",null,"Loading profiles...",-1)])])):t.value.length===0?(s(),i("div",Sa,[...r[22]||(r[22]=[e("i",{class:"mdi mdi-file-document-outline"},null,-1),e("h3",null,"No Profiles Yet",-1),e("p",null,"Create your first SmartIR profile to get started",-1)])])):T.value?E("",!0):(s(),i("div",_a,[(s(!0),i(ge,null,be(te.value,m=>(s(),xe(Is,{key:`${m.platform}-${m.code}`,profile:m,onEdit:g=>S(m.platform,m),onCommands:g=>S(m.platform,m,2),onDownload:g=>u(m.platform,m),onDelete:g=>V(m.platform,m)},null,8,["profile","onEdit","onCommands","onDownload","onDelete"]))),128))])),t.value.length>0&&te.value.length===0&&!T.value?(s(),i("div",Ia,[...r[23]||(r[23]=[e("i",{class:"mdi mdi-filter-off"},null,-1),e("h3",null,"No profiles match your filters",-1),e("p",null,"Try adjusting your search or filter criteria",-1)])])):E("",!0)])):(s(),i("div",Da,[r[29]||(r[29]=e("div",{class:"status-badge warning"},[e("i",{class:"mdi mdi-information"}),e("span",null,"Not Installed")],-1)),e("div",Ta,[r[25]||(r[25]=e("h4",null,"Why Install SmartIR?",-1)),e("ul",xa,[(s(!0),i(ge,null,be(((se=(G=C.value)==null?void 0:G.recommendation)==null?void 0:se.benefits)||o,(m,g)=>(s(),i("li",{key:g},[r[24]||(r[24]=e("i",{class:"mdi mdi-check"},null,-1)),e("span",null,p(m),1)]))),128))])]),e("div",Ra,[e("p",null,p(((a=(L=C.value)==null?void 0:L.recommendation)==null?void 0:a.message)||"Install SmartIR to unlock climate device support!"),1)]),e("div",{class:"card-actions"},[e("button",{onClick:ye,class:"btn-primary"},[...r[26]||(r[26]=[e("i",{class:"mdi mdi-download"},null,-1),_(" Install SmartIR ",-1)])]),e("button",{onClick:Ie,class:"btn-secondary"},[...r[27]||(r[27]=[e("i",{class:"mdi mdi-github"},null,-1),_(" View on GitHub ",-1)])]),e("button",{onClick:$e,class:"btn-secondary"},[...r[28]||(r[28]=[e("i",{class:"mdi mdi-help-circle"},null,-1),_(" Learn More ",-1)])])])]))],512),[[Ge,h.value]]),ve(Re,{isOpen:j.value.show,title:j.value.title,message:j.value.message,confirmText:j.value.canDelete===!1?null:"Delete",cancelText:"Close",dangerMode:!0,confirmDisabled:j.value.canDelete===!1,onConfirm:ie,onCancel:r[5]||(r[5]=m=>j.value.show=!1)},null,8,["isOpen","title","message","confirmText","confirmDisabled"]),ve(oa,{isOpen:D.value,onClose:r[6]||(r[6]=m=>D.value=!1)},null,8,["isOpen"])])}}},Oa=he(Ma,[["__scopeId","data-v-ba7b97e0"]]),La={class:"climate-form"},Ea={class:"learning-mode-section"},Aa={class:"mode-toggle"},Va={class:"mode-content"},ja={class:"mode-stats"},Ua={class:"stat-badge"},Fa={class:"stat-badge time"},Pa={class:"mode-content"},Na={class:"mode-stats"},Ba={class:"stat-badge"},Ha={class:"stat-badge time warning"},qa={key:0,class:"command-breakdown"},Ja={class:"warning-text"},za={class:"form-section"},Wa={key:0,class:"help-text"},Ga={key:1,class:"help-text"},Ka={class:"form-row"},Xa={class:"form-group"},Ya={class:"form-group"},Za={class:"form-group"},Qa={key:2,class:"representative-temp-section"},ei={class:"form-group"},ti=["value"],oi={class:"form-section"},li={class:"checkbox-grid"},ni={class:"checkbox-item"},si={class:"checkbox-item"},ai={class:"checkbox-item"},ii={class:"checkbox-item"},ri={class:"checkbox-item"},di={class:"checkbox-item"},ui={class:"form-section"},ci={class:"checkbox-grid"},mi={class:"checkbox-item"},vi={class:"checkbox-item"},pi={class:"checkbox-item"},fi={class:"checkbox-item"},gi={class:"form-section"},yi={class:"checkbox-grid"},bi={class:"checkbox-item"},hi={class:"checkbox-item"},ki={class:"checkbox-item"},wi={class:"checkbox-item"},$i={class:"form-section"},Ci={class:"form-group"},Si={class:"form-group"},_i={class:"form-group"},Ii={key:0,class:"validation-summary"},Di={__name:"ClimateProfileForm",props:{modelValue:{type:Object,default:()=>({})}},emits:["update:modelValue"],setup(l,{emit:y}){const d=l,$=y,k=b("quick"),n=b({minTemp:16,maxTemp:30,precision:1,representativeTemp:24,modes:["off","auto","cool","heat"],fanModes:["auto","low","medium","high"],swingModes:[],tempSensor:"",humiditySensor:"",powerSensor:"",learningMode:"quick",...d.modelValue}),w=J(()=>{const D=[],o=n.value.minTemp||16,v=n.value.maxTemp||30,c=n.value.precision||1;for(let B=o;B<=v;B+=c)D.push(B);return D}),f=J(()=>n.value.modes.filter(D=>D!=="off").length),C=J(()=>n.value.fanModes.length||1),T=J(()=>n.value.swingModes.length||1),A=J(()=>{const D=n.value.minTemp||16,o=n.value.maxTemp||30,v=n.value.precision||1;return Math.floor((o-D)/v)+1}),h=J(()=>{const D=n.value.modes.includes("off")?1:0;return f.value*C.value*T.value+D}),t=J(()=>Math.ceil(h.value*30/60)),x=J(()=>{const D=n.value.modes.includes("off")?1:0;return f.value*A.value*C.value*T.value+D}),P=J(()=>Math.ceil(x.value*30/60)),j=J(()=>{const D=[];return(!n.value.minTemp||n.value.minTemp<10||n.value.minTemp>35)&&D.push("Minimum temperature must be between 10Â°C and 35Â°C"),(!n.value.maxTemp||n.value.maxTemp<10||n.value.maxTemp>35)&&D.push("Maximum temperature must be between 10Â°C and 35Â°C"),n.value.minTemp>=n.value.maxTemp&&D.push("Minimum temperature must be less than maximum temperature"),(!n.value.modes||n.value.modes.length===0)&&D.push("At least one HVAC mode must be selected"),D});return ue(k,D=>{n.value.learningMode=D}),ue(n,D=>{$("update:modelValue",D)},{deep:!0,immediate:!0}),(D,o)=>(s(),i("div",La,[o[63]||(o[63]=e("h3",null,"Climate Device Configuration",-1)),e("div",Ea,[e("div",Aa,[e("label",{class:X(["mode-option",{active:k.value==="quick"}])},[z(e("input",{type:"radio",value:"quick","onUpdate:modelValue":o[0]||(o[0]=v=>k.value=v)},null,512),[[Ue,k.value]]),e("div",Va,[o[23]||(o[23]=e("div",{class:"mode-header"},[e("i",{class:"mdi mdi-flash"}),e("strong",null,"Quick Mode (Recommended)")],-1)),o[24]||(o[24]=e("p",null,"Learn one temperature per mode combination",-1)),e("div",ja,[e("span",Ua,p(h.value)+" commands",1),e("span",Fa,"~"+p(t.value)+" min",1)])])],2),e("label",{class:X(["mode-option",{active:k.value==="complete"}])},[z(e("input",{type:"radio",value:"complete","onUpdate:modelValue":o[1]||(o[1]=v=>k.value=v)},null,512),[[Ue,k.value]]),e("div",Pa,[o[25]||(o[25]=e("div",{class:"mode-header"},[e("i",{class:"mdi mdi-check-all"}),e("strong",null,"Complete Mode")],-1)),o[26]||(o[26]=e("p",null,"Learn all temperature combinations",-1)),e("div",Na,[e("span",Ba,p(x.value)+" commands",1),e("span",Ha,"~"+p(P.value)+" min",1)])])],2)]),k.value==="complete"?(s(),i("div",qa,[o[27]||(o[27]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[e("strong",null,"Complete mode will require learning "+p(x.value)+" commands",1),e("p",null,"This includes all combinations of modes ("+p(f.value)+"), temperatures ("+p(A.value)+"), fan speeds ("+p(C.value)+"), and swing modes ("+p(T.value)+").",1),e("p",Ja,"â±ï¸ Estimated time: "+p(P.value)+" minutes at ~30 seconds per command",1)])])):E("",!0)]),e("div",za,[o[33]||(o[33]=e("h4",null,"Temperature Range",-1)),k.value==="quick"?(s(),i("p",Wa," Define the full temperature range your device supports. You'll select one temperature to learn below. ")):(s(),i("p",Ga," Define the temperature range. All temperatures in this range will be learned. ")),e("div",Ka,[e("div",Xa,[o[28]||(o[28]=e("label",null,"Minimum Temperature (Â°C) *",-1)),z(e("input",{"onUpdate:modelValue":o[2]||(o[2]=v=>n.value.minTemp=v),type:"number",min:"10",max:"35",placeholder:"16"},null,512),[[_e,n.value.minTemp,void 0,{number:!0}]])]),e("div",Ya,[o[29]||(o[29]=e("label",null,"Maximum Temperature (Â°C) *",-1)),z(e("input",{"onUpdate:modelValue":o[3]||(o[3]=v=>n.value.maxTemp=v),type:"number",min:"10",max:"35",placeholder:"30"},null,512),[[_e,n.value.maxTemp,void 0,{number:!0}]])]),e("div",Za,[o[31]||(o[31]=e("label",null,"Precision",-1)),z(e("select",{"onUpdate:modelValue":o[4]||(o[4]=v=>n.value.precision=v)},[...o[30]||(o[30]=[e("option",{value:1},"1Â°C (Whole degrees)",-1),e("option",{value:.5},"0.5Â°C (Half degrees)",-1)])],512),[[ke,n.value.precision,void 0,{number:!0}]])])]),k.value==="quick"?(s(),i("div",Qa,[e("div",ei,[o[32]||(o[32]=e("label",null,"Representative Temperature to Learn *",-1)),z(e("select",{"onUpdate:modelValue":o[5]||(o[5]=v=>n.value.representativeTemp=v)},[(s(!0),i(ge,null,be(w.value,v=>(s(),i("option",{key:v,value:v},p(v)+"Â°C ",9,ti))),128))],512),[[ke,n.value.representativeTemp,void 0,{number:!0}]]),e("small",null,"This temperature will be learned for all mode combinations. The device profile will still show the full range ("+p(n.value.minTemp)+"Â°C - "+p(n.value.maxTemp)+"Â°C).",1)])])):E("",!0)]),e("div",oi,[o[40]||(o[40]=e("h4",null,"Supported HVAC Modes *",-1)),o[41]||(o[41]=e("p",{class:"help-text"},"Select all modes your device supports",-1)),e("div",li,[e("label",ni,[z(e("input",{type:"checkbox",value:"off","onUpdate:modelValue":o[6]||(o[6]=v=>n.value.modes=v)},null,512),[[de,n.value.modes]]),o[34]||(o[34]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),_(" Off ")],-1))]),e("label",si,[z(e("input",{type:"checkbox",value:"auto","onUpdate:modelValue":o[7]||(o[7]=v=>n.value.modes=v)},null,512),[[de,n.value.modes]]),o[35]||(o[35]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-autorenew"}),_(" Auto ")],-1))]),e("label",ai,[z(e("input",{type:"checkbox",value:"cool","onUpdate:modelValue":o[8]||(o[8]=v=>n.value.modes=v)},null,512),[[de,n.value.modes]]),o[36]||(o[36]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-snowflake"}),_(" Cool ")],-1))]),e("label",ii,[z(e("input",{type:"checkbox",value:"heat","onUpdate:modelValue":o[9]||(o[9]=v=>n.value.modes=v)},null,512),[[de,n.value.modes]]),o[37]||(o[37]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fire"}),_(" Heat ")],-1))]),e("label",ri,[z(e("input",{type:"checkbox",value:"dry","onUpdate:modelValue":o[10]||(o[10]=v=>n.value.modes=v)},null,512),[[de,n.value.modes]]),o[38]||(o[38]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-water-percent"}),_(" Dry ")],-1))]),e("label",di,[z(e("input",{type:"checkbox",value:"fan_only","onUpdate:modelValue":o[11]||(o[11]=v=>n.value.modes=v)},null,512),[[de,n.value.modes]]),o[39]||(o[39]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan"}),_(" Fan Only ")],-1))])])]),e("div",ui,[o[46]||(o[46]=e("h4",null,"Fan Modes",-1)),o[47]||(o[47]=e("p",{class:"help-text"},"Select all fan speeds your device supports",-1)),e("div",ci,[e("label",mi,[z(e("input",{type:"checkbox",value:"auto","onUpdate:modelValue":o[12]||(o[12]=v=>n.value.fanModes=v)},null,512),[[de,n.value.fanModes]]),o[42]||(o[42]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-autorenew"}),_(" Auto ")],-1))]),e("label",vi,[z(e("input",{type:"checkbox",value:"low","onUpdate:modelValue":o[13]||(o[13]=v=>n.value.fanModes=v)},null,512),[[de,n.value.fanModes]]),o[43]||(o[43]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-1"}),_(" Low ")],-1))]),e("label",pi,[z(e("input",{type:"checkbox",value:"medium","onUpdate:modelValue":o[14]||(o[14]=v=>n.value.fanModes=v)},null,512),[[de,n.value.fanModes]]),o[44]||(o[44]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-2"}),_(" Medium ")],-1))]),e("label",fi,[z(e("input",{type:"checkbox",value:"high","onUpdate:modelValue":o[15]||(o[15]=v=>n.value.fanModes=v)},null,512),[[de,n.value.fanModes]]),o[45]||(o[45]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-fan-speed-3"}),_(" High ")],-1))])])]),e("div",gi,[o[52]||(o[52]=e("h4",null,"Swing Modes (Optional)",-1)),o[53]||(o[53]=e("p",{class:"help-text"},"Select if your device has swing/oscillation",-1)),e("div",yi,[e("label",bi,[z(e("input",{type:"checkbox",value:"off","onUpdate:modelValue":o[16]||(o[16]=v=>n.value.swingModes=v)},null,512),[[de,n.value.swingModes]]),o[48]||(o[48]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-horizontal"}),_(" Off ")],-1))]),e("label",hi,[z(e("input",{type:"checkbox",value:"vertical","onUpdate:modelValue":o[17]||(o[17]=v=>n.value.swingModes=v)},null,512),[[de,n.value.swingModes]]),o[49]||(o[49]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-vertical"}),_(" Vertical ")],-1))]),e("label",ki,[z(e("input",{type:"checkbox",value:"horizontal","onUpdate:modelValue":o[18]||(o[18]=v=>n.value.swingModes=v)},null,512),[[de,n.value.swingModes]]),o[50]||(o[50]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-swap-horizontal"}),_(" Horizontal ")],-1))]),e("label",wi,[z(e("input",{type:"checkbox",value:"both","onUpdate:modelValue":o[19]||(o[19]=v=>n.value.swingModes=v)},null,512),[[de,n.value.swingModes]]),o[51]||(o[51]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-arrow-all"}),_(" Both ")],-1))])])]),e("div",$i,[o[60]||(o[60]=e("h4",null,"Sensors (Optional)",-1)),o[61]||(o[61]=e("p",{class:"help-text"},"Link external sensors for better climate control",-1)),e("div",Ci,[o[54]||(o[54]=e("label",null,"Temperature Sensor",-1)),z(e("input",{"onUpdate:modelValue":o[20]||(o[20]=v=>n.value.tempSensor=v),type:"text",placeholder:"sensor.living_room_temperature"},null,512),[[_e,n.value.tempSensor]]),o[55]||(o[55]=e("small",null,"Entity ID of temperature sensor",-1))]),e("div",Si,[o[56]||(o[56]=e("label",null,"Humidity Sensor",-1)),z(e("input",{"onUpdate:modelValue":o[21]||(o[21]=v=>n.value.humiditySensor=v),type:"text",placeholder:"sensor.living_room_humidity"},null,512),[[_e,n.value.humiditySensor]]),o[57]||(o[57]=e("small",null,"Entity ID of humidity sensor",-1))]),e("div",_i,[o[58]||(o[58]=e("label",null,"Power Sensor",-1)),z(e("input",{"onUpdate:modelValue":o[22]||(o[22]=v=>n.value.powerSensor=v),type:"text",placeholder:"binary_sensor.ac_power"},null,512),[[_e,n.value.powerSensor]]),o[59]||(o[59]=e("small",null,"Entity ID of power sensor (to detect on/off state)",-1))])]),j.value.length>0?(s(),i("div",Ii,[o[62]||(o[62]=e("h4",null,[e("i",{class:"mdi mdi-alert-circle"}),_(" Please fix the following: ")],-1)),e("ul",null,[(s(!0),i(ge,null,be(j.value,(v,c)=>(s(),i("li",{key:c},p(v),1))),128))])])):E("",!0)]))}},Ti=he(Di,[["__scopeId","data-v-5674f3f7"]]),xi={class:"command-wizard"},Ri={class:"device-selection-section"},Mi={class:"input-wrapper"},Oi=["value"],Li={key:0,class:"validation-tooltip"},Ei={class:"form-group"},Ai=["disabled"],Vi={key:0},ji={key:1},Ui={key:0,class:"edit-mode-banner"},Fi={class:"wizard-info"},Pi={key:0},Ni={key:1},Bi={class:"progress-info"},Hi={class:"progress-bar"},qi={class:"progress-text"},Ji={class:"commands-grid"},zi={class:"command-header"},Wi={class:"command-icon"},Gi={class:"command-info"},Ki={key:0,class:"learning-indicator"},Xi={key:0,class:"ir-learning-steps"},Yi={key:1,class:"rf-learning-steps"},Zi={class:"command-actions"},Qi=["onClick","disabled"],er={key:1,class:"learned-status"},tr=["onClick","disabled"],or=["onClick"],lr={class:"quick-actions"},nr=["disabled"],sr=["disabled"],ar={__name:"CommandLearningWizard",props:{modelValue:{type:Object,default:()=>({})},platform:{type:String,required:!0},config:{type:Object,required:!0},broadlinkDevice:{type:String,default:""},manufacturer:{type:String,required:!0},model:{type:String,required:!0},commandType:{type:String,default:"ir"}},emits:["update:modelValue","update:broadlinkDevice","update:commandType"],setup(l,{emit:y}){const d=Ae(),$=l,k=y,n=b({...$.modelValue}),w=b(null),f=b(null),C=b([]),T=b($.broadlinkDevice),A=b($.commandType),h=b(!1),t=b([]),x=b(!1),P=b(!1),j=b({show:!1,commandKey:null,commandLabel:""}),D=b(!1),o=J(()=>{const S=[];if($.platform==="climate"){const u=$.config.modes||[],V=$.config.fanModes||[],ie=$.config.minTemp||16,M=$.config.maxTemp||30;u.forEach(r=>{if(r==="off")S.push({key:"off",label:"Power Off",description:"Turn device off",icon:"mdi mdi-power",mode:"off"});else for(let F=ie;F<=M;F++)V.forEach(Z=>{const ae=`${r}_${F}_${Z}`;S.push({key:ae,label:`${r.toUpperCase()} ${F}Â°C ${Z}`,description:`Mode: ${r}, Temp: ${F}Â°C, Fan: ${Z}`,icon:K(r),mode:r,temp:F,fanMode:Z})})})}else if($.platform==="media_player"){const u=$.config.features||[];u.includes("turn_on")&&(S.push({key:"turn_on",label:"Power On",description:"Turn on the device",icon:"mdi mdi-power"}),S.push({key:"turn_off",label:"Power Off",description:"Turn off the device",icon:"mdi mdi-power-off"})),u.includes("volume")&&(S.push({key:"volume_up",label:"Volume Up",description:"Increase volume",icon:"mdi mdi-volume-plus"}),S.push({key:"volume_down",label:"Volume Down",description:"Decrease volume",icon:"mdi mdi-volume-minus"})),u.includes("mute")&&S.push({key:"mute",label:"Mute",description:"Toggle mute",icon:"mdi mdi-volume-mute"}),u.includes("source")&&(S.push({key:"source_hdmi1",label:"Source: HDMI 1",description:"Switch to HDMI 1",icon:"mdi mdi-import"}),S.push({key:"source_hdmi2",label:"Source: HDMI 2",description:"Switch to HDMI 2",icon:"mdi mdi-import"}),S.push({key:"source_hdmi3",label:"Source: HDMI 3",description:"Switch to HDMI 3",icon:"mdi mdi-import"})),u.includes("channel")&&(S.push({key:"channel_up",label:"Channel Up",description:"Next channel",icon:"mdi mdi-chevron-up"}),S.push({key:"channel_down",label:"Channel Down",description:"Previous channel",icon:"mdi mdi-chevron-down"}))}else if($.platform==="fan"){const u=$.config.speedLevels||3,V=$.config.features||[];S.push({key:"turn_on",label:"Power On",description:"Turn on the fan",icon:"mdi mdi-power"}),S.push({key:"turn_off",label:"Power Off",description:"Turn off the fan",icon:"mdi mdi-power-off"});for(let ie=1;ie<=u;ie++){const M=ie===1?"Low":ie===u?"High":ie===2&&u===3?"Medium":`Speed ${ie}`;S.push({key:`speed_${ie}`,label:`${M}`,description:`Set fan to speed level ${ie}`,icon:"mdi mdi-fan"})}V.includes("oscillate")&&(S.push({key:"oscillate_on",label:"Oscillate On",description:"Enable oscillation",icon:"mdi mdi-sync"}),S.push({key:"oscillate_off",label:"Oscillate Off",description:"Disable oscillation",icon:"mdi mdi-sync-off"})),V.includes("direction")&&(S.push({key:"direction_forward",label:"Direction: Forward",description:"Set direction to forward",icon:"mdi mdi-rotate-right"}),S.push({key:"direction_reverse",label:"Direction: Reverse",description:"Set direction to reverse",icon:"mdi mdi-rotate-left"}))}else if($.platform==="light"){const u=$.config.features||[];u.includes("turn_on")&&(S.push({key:"turn_on",label:"Power On",description:"Turn on the light",icon:"mdi mdi-lightbulb-on"}),S.push({key:"turn_off",label:"Power Off",description:"Turn off the light",icon:"mdi mdi-lightbulb-off"})),u.includes("brightness")&&(S.push({key:"brightness_up",label:"Brightness Up",description:"Increase brightness",icon:"mdi mdi-brightness-7"}),S.push({key:"brightness_down",label:"Brightness Down",description:"Decrease brightness",icon:"mdi mdi-brightness-5"})),u.includes("color_temp")&&(S.push({key:"color_temp_warm",label:"Warm White",description:"Set to warm white",icon:"mdi mdi-weather-sunset"}),S.push({key:"color_temp_cool",label:"Cool White",description:"Set to cool white",icon:"mdi mdi-weather-sunny"})),u.includes("rgb")&&(S.push({key:"color_red",label:"Color: Red",description:"Set color to red",icon:"mdi mdi-palette"}),S.push({key:"color_green",label:"Color: Green",description:"Set color to green",icon:"mdi mdi-palette"}),S.push({key:"color_blue",label:"Color: Blue",description:"Set color to blue",icon:"mdi mdi-palette"}))}return S}),v=J(()=>o.value.length),c=J(()=>Object.keys(n.value).length),B=J(()=>v.value===0?0:Math.round(c.value/v.value*100));function K(S){return{off:"mdi mdi-power",auto:"mdi mdi-autorenew",cool:"mdi mdi-snowflake",heat:"mdi mdi-fire",dry:"mdi mdi-water-percent",fan_only:"mdi mdi-fan"}[S]||"mdi mdi-remote"}async function oe(S){if(!w.value){if(!T.value){P.value=!0,window.scrollTo({top:0,behavior:"smooth"});return}P.value=!1,w.value=S.key;try{const u=$.manufacturer.toLowerCase().replace(/[^a-z0-9]+/g,"_"),V=$.model.toLowerCase().replace(/[^a-z0-9]+/g,"_"),ie=`${u}_${V}`,M=await fetch("/api/commands/learn",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({entity_id:T.value,device:ie,command:S.key,command_type:A.value})});if(!M.ok)throw new Error(`Failed to learn command: ${M.statusText}`);const r=await M.json();if(r.success&&r.code)n.value[S.key]=r.code,k("update:modelValue",n.value),x.value=!0,r.code==="pending"&&console.log(`â³ Command '${S.key}' learned, code will be fetched from storage when saving`),h.value&&t.value.length>0&&setTimeout(()=>{const F=t.value.shift();F?oe(F):h.value=!1},1e3);else throw new Error(r.error||"Failed to learn command")}catch(u){console.error("Error learning command:",u),d.error(`Error learning command: ${u.message}`),h.value=!1,t.value=[]}finally{h.value||(w.value=null)}}}async function te(S){var u;if(!T.value){P.value=!0,window.scrollTo({top:0,behavior:"smooth"});return}if(!n.value[S]){(u=d.value)==null||u.error("Command not learned yet");return}f.value=S;try{const V=n.value[S],ie=await fetch("/api/commands/send-raw",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({entity_id:T.value,command:V,command_type:A.value})});if(!ie.ok){const M=await ie.json();throw new Error(M.error||"Failed to send command")}d.success("Command sent successfully")}catch(V){console.error("Error testing command:",V),d.error(`Error testing command: ${V.message}`)}finally{f.value=null}}function pe(S){const u=o.value.find(V=>V.key===S);j.value={show:!0,commandKey:S,commandLabel:u?u.label:S}}function O(){const S=j.value.commandKey;delete n.value[S],k("update:modelValue",n.value),j.value.show=!1}function N(){const S=o.value.filter(V=>!n.value[V.key]);if(S.length===0)return;h.value=!0,t.value=[...S];const u=t.value.shift();u&&oe(u)}function Y(){D.value=!0}function re(){n.value={},k("update:modelValue",n.value),D.value=!1}ue(()=>$.modelValue,S=>{n.value={...S}},{deep:!0}),De(async()=>{await ye()});async function ye(){try{console.log("SmartIR device - commands will be loaded from SmartIR JSON file, not Broadlink storage")}catch(S){console.error("Error in loadExistingCommands:",S)}}function $e(){k("update:broadlinkDevice",T.value)}function Ie(){k("update:commandType",A.value)}async function Ce(){try{const S=await fetch("/api/remote/devices");if(S.ok){const V=(await S.json()).devices||[];C.value=V}}catch(S){console.error("Error loading remote devices:",S),C.value=[]}}return ue(()=>$.broadlinkDevice,S=>{T.value=S}),ue(T,S=>{S&&(P.value=!1)}),ue(()=>$.commandType,S=>{A.value=S}),De(async()=>{await Ce(),await ye()}),(S,u)=>(s(),i("div",xi,[u[22]||(u[22]=e("h3",null,"Learn IR Commands",-1)),e("div",Ri,[e("div",{class:X(["form-group",{"has-error":P.value}])},[u[6]||(u[6]=e("label",null,"Broadlink Device *",-1)),e("div",Mi,[z(e("select",{"onUpdate:modelValue":u[0]||(u[0]=V=>T.value=V),onChange:$e},[u[4]||(u[4]=e("option",{value:""},"Select Broadlink device...",-1)),(s(!0),i(ge,null,be(C.value,V=>(s(),i("option",{key:V.entity_id,value:V.entity_id},p(V.name)+p(V.area_name?" ("+V.area_name+")":""),9,Oi))),128))],544),[[ke,T.value]]),P.value?(s(),i("div",Li,[...u[5]||(u[5]=[e("i",{class:"mdi mdi-alert"},null,-1),_(" Device is required ",-1)])])):E("",!0)]),e("small",null,"This device will be used to learn commands ("+p(C.value.length)+" devices found)",1)],2),e("div",Ei,[u[8]||(u[8]=e("label",null,"Command Type *",-1)),z(e("select",{"onUpdate:modelValue":u[1]||(u[1]=V=>A.value=V),onChange:Ie,disabled:c.value>0},[...u[7]||(u[7]=[e("option",{value:"ir"},"ğŸ“¡ Infrared (IR) - Most common for AC, TV, etc.",-1),e("option",{value:"rf"},"ğŸ“» Radio Frequency (RF) - For RF remotes",-1)])],40,Ai),[[ke,A.value]]),c.value>0?(s(),i("small",Vi,"Command type cannot be changed after learning commands")):(s(),i("small",ji,"Select the type of commands your device uses"))])]),c.value>0&&!x.value?(s(),i("div",Ui,[u[10]||(u[10]=e("i",{class:"mdi mdi-information-outline"},null,-1)),e("div",null,[u[9]||(u[9]=e("strong",null,"Editing Existing Profile",-1)),e("p",null,p(c.value)+" command"+p(c.value!==1?"s":"")+' already learned. You can re-learn any command by clicking the delete icon and then "Learn Command".',1)])])):E("",!0),e("div",Fi,[u[14]||(u[14]=e("i",{class:"mdi mdi-information"},null,-1)),e("div",null,[u[13]||(u[13]=e("p",null,[e("strong",null,"How it works:")],-1)),l.commandType==="ir"?(s(),i("ol",Pi,[...u[11]||(u[11]=[e("li",null,'Click "Learn Command" for each combination',-1),e("li",null,[e("strong",null,"Point your IR remote directly at the Broadlink device")],-1),e("li",null,"Press the button on your remote",-1),e("li",null,"Wait for confirmation (up to 30 seconds)",-1)])])):(s(),i("ol",Ni,[...u[12]||(u[12]=[e("li",null,'Click "Learn Command" for each combination',-1),e("li",null,[e("strong",null,"Step 1:"),_(" Hold button on remote - Broadlink scans for RF frequency")],-1),e("li",null,[e("strong",null,"Step 2:"),_(" Watch for Home Assistant notification, then press and release button")],-1),e("li",null,"Keep remote within 5cm of Broadlink (RF doesn't need line-of-sight)",-1),e("li",null,"Wait for confirmation (may take up to 30 seconds)",-1)])]))])]),e("div",Bi,[e("div",Hi,[e("div",{class:"progress-fill",style:tt({width:B.value+"%"})},null,4)]),e("span",qi,p(c.value)+" / "+p(v.value)+" commands learned ("+p(B.value)+"%) ",1)]),e("div",Ji,[(s(!0),i(ge,null,be(o.value,V=>(s(),i("div",{key:V.key,class:X(["command-card",{learned:n.value[V.key],learning:w.value===V.key}])},[e("div",zi,[e("div",Wi,[e("i",{class:X(V.icon)},null,2)]),e("div",Gi,[e("h4",null,p(V.label),1),e("p",null,p(V.description),1)])]),w.value===V.key?(s(),i("div",Ki,[l.commandType==="ir"?(s(),i("div",Xi,[...u[15]||(u[15]=[e("p",null,[e("strong",null,"Point your remote directly at the Broadlink device and press the button.")],-1),e("small",null,"Listening for up to 30 seconds...",-1)])])):(s(),i("div",Yi,[...u[16]||(u[16]=[e("p",{class:"rf-title"},[e("strong",null,"Learning request sent to device.")],-1),e("p",{class:"rf-subtitle"},[_("RF learning is a "),e("strong",null,"two-step process"),_(":")],-1),e("ol",null,[e("li",null,[e("strong",null,"Step 1 - Frequency Sweep (~10-15 seconds):"),_(" Press and hold the button on your remote until the notification updates. ")]),e("li",null,[e("strong",null,"Step 2 - Learn Signal:"),_(" Press and release the button once. ")])],-1),e("p",{class:"rf-note"},"Follow the Home Assistant notifications (ğŸ””) for real-time instructions.",-1)])]))])):E("",!0),e("div",Zi,[n.value[V.key]?(s(),i("div",er,[u[18]||(u[18]=e("i",{class:"mdi mdi-check-circle"},null,-1)),u[19]||(u[19]=e("span",null,"Learned",-1)),e("span",{class:X(["command-type-badge",A.value])},p(A.value.toUpperCase()),3),e("button",{onClick:ie=>te(V.key),class:"icon-btn",title:"Test command",disabled:f.value===V.key,style:{"margin-left":"auto"}},[e("i",{class:X(["mdi mdi-play",{"mdi-spin":f.value===V.key}])},null,2)],8,tr),e("button",{onClick:ie=>pe(V.key),class:"icon-btn danger",title:"Delete and re-learn"},[...u[17]||(u[17]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,or)])):(s(),i("button",{key:0,onClick:ie=>oe(V),class:X(["btn-learn",{learning:w.value===V.key}]),disabled:w.value!==null},[e("i",{class:X(["mdi mdi-radio-tower",{"mdi-spin":w.value===V.key}])},null,2),_(" "+p(w.value===V.key?"Listening...":"Learn Command"),1)],10,Qi))])],2))),128))]),e("div",lr,[e("button",{onClick:N,class:"btn-secondary",disabled:w.value!==null||c.value===v.value},[...u[20]||(u[20]=[e("i",{class:"mdi mdi-play-circle"},null,-1),_(" Learn All Remaining ",-1)])],8,nr),e("button",{onClick:Y,class:"btn-text",disabled:c.value===0},[...u[21]||(u[21]=[e("i",{class:"mdi mdi-delete-sweep"},null,-1),_(" Clear All ",-1)])],8,sr)]),ve(Re,{isOpen:j.value.show,title:"Delete Learned Command?",message:`Are you sure you want to delete the '${j.value.commandLabel}' command?

You will need to re-learn this command.`,confirmText:"Delete",cancelText:"Cancel",dangerMode:!0,onConfirm:O,onCancel:u[2]||(u[2]=V=>j.value.show=!1)},null,8,["isOpen","message"]),ve(Re,{isOpen:D.value,title:"Delete All Learned Commands?",message:"Are you sure you want to delete all learned commands? This cannot be undone.\\n\\nYou will need to re-learn all commands.",confirmText:"Delete All",cancelText:"Cancel",dangerMode:!0,onConfirm:re,onCancel:u[3]||(u[3]=V=>D.value=!1)},null,8,["isOpen"])]))}},ir=he(ar,[["__scopeId","data-v-3ef02e18"]]),rr={class:"profile-preview"},dr={class:"preview-summary"},ur={class:"summary-card"},cr={class:"stats-grid"},mr={class:"stat-item"},vr={class:"stat-value"},pr={class:"stat-item"},fr={class:"stat-value"},gr={class:"stat-item"},yr={class:"stat-value"},br={class:"preview-tabs"},hr={class:"preview-content"},kr={key:0,class:"tab-content"},wr={class:"code-header"},$r={class:"code-block"},Cr={key:1,class:"tab-content"},Sr={class:"code-header"},_r={class:"code-block"},Ir={key:2,class:"tab-content"},Dr={class:"instructions"},Tr={class:"step-item"},xr={class:"step-content"},Rr={class:"code-path"},Mr={__name:"ProfilePreview",props:{profile:{type:Object,required:!0},jsonData:{type:Object,required:!0},yamlConfig:{type:String,required:!0}},setup(l){const y=Ae(),d=l,$=b("json"),k=b(!1),n=b(!1),w=J(()=>Object.keys(d.profile.commands||{}).length),f=J(()=>JSON.stringify(d.jsonData,null,2));async function C(){try{await navigator.clipboard.writeText(f.value),k.value=!0,setTimeout(()=>{k.value=!1},2e3)}catch(A){console.error("Failed to copy JSON:",A),y.error("Failed to copy to clipboard")}}async function T(){try{await navigator.clipboard.writeText(d.yamlConfig),n.value=!0,setTimeout(()=>{n.value=!1},2e3)}catch(A){console.error("Failed to copy YAML:",A),y.error("Failed to copy to clipboard")}}return(A,h)=>{var t;return s(),i("div",rr,[h[22]||(h[22]=e("h3",null,"Preview & Save",-1)),e("div",dr,[e("div",ur,[h[4]||(h[4]=e("i",{class:"mdi mdi-check-circle"},null,-1)),e("div",null,[h[3]||(h[3]=e("h4",null,"Profile Ready!",-1)),e("p",null,p(l.profile.manufacturer)+" "+p(l.profile.model),1)])]),e("div",cr,[e("div",mr,[e("span",vr,p(w.value),1),h[5]||(h[5]=e("span",{class:"stat-label"},"Commands Learned",-1))]),e("div",pr,[e("span",fr,p(l.profile.platform),1),h[6]||(h[6]=e("span",{class:"stat-label"},"Platform",-1))]),e("div",gr,[e("span",yr,p(((t=l.profile.config.modes)==null?void 0:t.length)||0),1),h[7]||(h[7]=e("span",{class:"stat-label"},"HVAC Modes",-1))])])]),e("div",br,[e("button",{onClick:h[0]||(h[0]=x=>$.value="json"),class:X(["tab-button",{active:$.value==="json"}])},[...h[8]||(h[8]=[e("i",{class:"mdi mdi-code-json"},null,-1),_(" SmartIR JSON ",-1)])],2),e("button",{onClick:h[1]||(h[1]=x=>$.value="yaml"),class:X(["tab-button",{active:$.value==="yaml"}])},[...h[9]||(h[9]=[e("i",{class:"mdi mdi-file-code"},null,-1),_(" YAML Config ",-1)])],2),e("button",{onClick:h[2]||(h[2]=x=>$.value="instructions"),class:X(["tab-button",{active:$.value==="instructions"}])},[...h[10]||(h[10]=[e("i",{class:"mdi mdi-information"},null,-1),_(" Instructions ",-1)])],2)]),e("div",hr,[$.value==="json"?(s(),i("div",kr,[e("div",wr,[h[12]||(h[12]=e("h4",null,"SmartIR Device Code JSON",-1)),e("button",{onClick:C,class:"btn-copy"},[h[11]||(h[11]=e("i",{class:"mdi mdi-content-copy"},null,-1)),_(" "+p(k.value?"Copied!":"Copy"),1)])]),e("pre",$r,[e("code",null,p(f.value),1)]),h[13]||(h[13]=e("p",{class:"code-note"},[e("i",{class:"mdi mdi-information"}),_(" Save this as "),e("code",null,"10000.json"),_(" in your SmartIR codes directory ")],-1))])):E("",!0),$.value==="yaml"?(s(),i("div",Cr,[e("div",Sr,[h[15]||(h[15]=e("h4",null,"Home Assistant Configuration",-1)),e("button",{onClick:T,class:"btn-copy"},[h[14]||(h[14]=e("i",{class:"mdi mdi-content-copy"},null,-1)),_(" "+p(n.value?"Copied!":"Copy"),1)])]),e("pre",_r,[e("code",null,p(l.yamlConfig),1)]),h[16]||(h[16]=e("p",{class:"code-note"},[e("i",{class:"mdi mdi-information"}),_(" Add this to your "),e("code",null,"configuration.yaml"),_(" file ")],-1))])):E("",!0),$.value==="instructions"?(s(),i("div",Ir,[e("div",Dr,[h[20]||(h[20]=e("h4",null,"Installation Steps",-1)),e("div",Tr,[h[19]||(h[19]=e("div",{class:"step-number"},"1",-1)),e("div",xr,[h[17]||(h[17]=e("h5",null,"Get Next Code Number",-1)),h[18]||(h[18]=e("p",null,"Custom device codes start at 10000. Check your SmartIR codes directory to find the next available number.",-1)),e("div",Rr,[e("code",null,"/config/custom_components/smartir/codes/"+p(l.profile.platform)+"/",1)])])]),h[21]||(h[21]=Me('<div class="step-item" data-v-cbf0874d><div class="step-number" data-v-cbf0874d>2</div><div class="step-content" data-v-cbf0874d><h5 data-v-cbf0874d>Save JSON File</h5><p data-v-cbf0874d>Copy the JSON from the &quot;SmartIR JSON&quot; tab and save it as <code data-v-cbf0874d>10000.json</code> (or your next available number) in the codes directory.</p></div></div><div class="step-item" data-v-cbf0874d><div class="step-number" data-v-cbf0874d>3</div><div class="step-content" data-v-cbf0874d><h5 data-v-cbf0874d>Update Configuration</h5><p data-v-cbf0874d>Copy the YAML from the &quot;YAML Config&quot; tab and add it to your <code data-v-cbf0874d>configuration.yaml</code> file. Update the <code data-v-cbf0874d>device_code</code> to match your JSON filename.</p></div></div><div class="step-item" data-v-cbf0874d><div class="step-number" data-v-cbf0874d>4</div><div class="step-content" data-v-cbf0874d><h5 data-v-cbf0874d>Restart Home Assistant</h5><p data-v-cbf0874d>Restart Home Assistant to load the new configuration. Your climate entity will appear in the UI.</p></div></div><div class="step-item" data-v-cbf0874d><div class="step-number" data-v-cbf0874d>5</div><div class="step-content" data-v-cbf0874d><h5 data-v-cbf0874d>Test Your Device</h5><p data-v-cbf0874d>Go to your climate entity and test different modes, temperatures, and fan speeds to ensure everything works correctly.</p></div></div><div class="tips-section" data-v-cbf0874d><h4 data-v-cbf0874d><i class="mdi mdi-lightbulb" data-v-cbf0874d></i> Tips </h4><ul data-v-cbf0874d><li data-v-cbf0874d>Keep a backup of your JSON file in case you need to modify it</li><li data-v-cbf0874d>Test all commands to ensure they work as expected</li><li data-v-cbf0874d>You can share your profile with the SmartIR community on GitHub</li><li data-v-cbf0874d>If a command doesn&#39;t work, you can re-learn it and update the JSON</li></ul></div>',5))])])):E("",!0)])])}}},Or=he(Mr,[["__scopeId","data-v-cbf0874d"]]),Lr={class:"wizard-body"},Er={key:0,class:"warning-section"},Ar={class:"warning-box"},Vr={class:"instructions"},jr={class:"code-block"},Ur={class:"steps"},Fr={key:0},Pr={class:"help-section"},Nr={key:0,class:"help-content"},Br={class:"help-step"},Hr={key:0,class:"help-step"},qr={class:"help-step"},Jr={class:"help-step"},zr={class:"checklist"},Wr={class:"checkbox-label"},Gr={key:0,class:"checkbox-label"},Kr={class:"wizard-footer"},Xr=["disabled"],Yr={__name:"SmartIRSetupWizard",props:{show:{type:Boolean,default:!1},platform:{type:String,required:!0},warnings:{type:Array,default:()=>[]},configPath:{type:String,default:"/config"}},emits:["close","complete"],setup(l,{emit:y}){const d=l,$=y,k=we("toast"),n=b(!1),w=b(!1),f=b(!1),C=J(()=>d.warnings.length>0?n.value&&w.value:n.value);function T(){const h=`${d.platform}: !include smartir/${d.platform}.yaml`;navigator.clipboard.writeText(h).then(()=>{var t;(t=k.value)==null||t.success("Include line copied to clipboard!","âœ… Copied")}).catch(t=>{var x;console.error("Failed to copy:",t),(x=k.value)==null||x.error("Failed to copy to clipboard","âŒ Copy Failed")})}function A(){$("complete")}return(h,t)=>l.show?(s(),i("div",{key:0,class:"modal-overlay",onClick:t[5]||(t[5]=me(()=>{},["stop"]))},[e("div",{class:"setup-wizard",onClick:t[4]||(t[4]=me(()=>{},["stop"]))},[t[31]||(t[31]=e("div",{class:"wizard-header"},[e("h2",null,[e("i",{class:"mdi mdi-cog"}),_(" SmartIR Configuration Setup ")])],-1)),e("div",Lr,[l.warnings.length>0?(s(),i("div",Er,[e("div",Ar,[t[11]||(t[11]=e("i",{class:"mdi mdi-alert"},null,-1)),e("div",null,[t[9]||(t[9]=e("h3",null,"âš ï¸ Configuration Migration Needed",-1)),t[10]||(t[10]=e("p",null,"We detected existing platform entries in your configuration.yaml:",-1)),e("ul",null,[(s(!0),i(ge,null,be(l.warnings,x=>(s(),i("li",{key:x.platform},[e("strong",null,p(x.platform)+":",1),_(" "+p(x.message),1)]))),128))]),e("p",null,[t[6]||(t[6]=e("strong",null,"Action Required:",-1)),t[7]||(t[7]=_(" Move these entries to ",-1)),e("code",null,"smartir/"+p(l.platform)+".yaml",1),t[8]||(t[8]=_(" before continuing.",-1))])])])])):E("",!0),e("div",Vr,[t[27]||(t[27]=e("h3",null,"ğŸ“ One-Time Setup",-1)),t[28]||(t[28]=e("p",null,[_("To enable SmartIR device management, add this line to your "),e("code",null,"configuration.yaml"),_(":")],-1)),e("div",jr,[e("code",null,p(l.platform)+": !include smartir/"+p(l.platform)+".yaml",1),e("button",{onClick:T,class:"copy-btn",title:"Copy to clipboard"},[...t[12]||(t[12]=[e("i",{class:"mdi mdi-content-copy"},null,-1)])])]),e("div",Ur,[t[19]||(t[19]=e("h4",null,"Steps:",-1)),e("ol",null,[l.warnings.length>0?(s(),i("li",Fr,[t[13]||(t[13]=e("strong",null,"Move existing entries:",-1)),t[14]||(t[14]=_(" Copy any existing ",-1)),e("code",null,p(l.platform)+":",1),t[15]||(t[15]=_(" entries from configuration.yaml to ",-1)),e("code",null,"smartir/"+p(l.platform)+".yaml",1)])):E("",!0),t[16]||(t[16]=e("li",null,[e("strong",null,"Add include line:"),_(" Add the line above to your configuration.yaml ")],-1)),t[17]||(t[17]=e("li",null,[e("strong",null,"Save changes:"),_(" Save configuration.yaml ")],-1)),t[18]||(t[18]=e("li",null,[e("strong",null,"Continue here:"),_(` Click "I've Completed Setup" below `)],-1))])]),e("div",Pr,[e("button",{onClick:t[0]||(t[0]=x=>f.value=!f.value),class:"help-toggle"},[e("i",{class:X(["mdi",f.value?"mdi-chevron-up":"mdi-chevron-down"])},null,2),_(" "+p(f.value?"Hide":"Show")+" Detailed Instructions ",1)]),f.value?(s(),i("div",Nr,[t[26]||(t[26]=e("h4",null,"Detailed Setup Guide:",-1)),e("div",Br,[t[21]||(t[21]=e("h5",null,"1. Open configuration.yaml",-1)),e("p",null,[t[20]||(t[20]=_("Location: ",-1)),e("code",null,p(l.configPath)+"/configuration.yaml",1)])]),l.warnings.length>0?(s(),i("div",Hr,[t[22]||(t[22]=e("h5",null,"2. Migrate Existing Entries (If Any)",-1)),e("p",null,"If you have existing "+p(l.platform)+" entries, cut them from configuration.yaml and paste into:",1),e("p",null,[e("code",null,p(l.configPath)+"/smartir/"+p(l.platform)+".yaml",1)]),t[23]||(t[23]=e("p",{class:"note"},"Broadlink Manager will create this file automatically.",-1))])):E("",!0),e("div",qr,[e("h5",null,p(l.warnings.length>0?"3":"2")+". Add Include Line",1),t[24]||(t[24]=e("p",null,"Add this to configuration.yaml:",-1)),e("pre",null,p(l.platform)+": !include smartir/"+p(l.platform)+".yaml",1)]),e("div",Jr,[e("h5",null,p(l.warnings.length>0?"4":"3")+". Restart Home Assistant",1),t[25]||(t[25]=e("p",null,"After saving, you'll need to restart HA for changes to take effect.",-1))])])):E("",!0)])]),e("div",zr,[e("label",Wr,[z(e("input",{type:"checkbox","onUpdate:modelValue":t[1]||(t[1]=x=>n.value=x)},null,512),[[de,n.value]]),t[29]||(t[29]=e("span",null,"I've added the include line to configuration.yaml",-1))]),l.warnings.length>0?(s(),i("label",Gr,[z(e("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=x=>w.value=x)},null,512),[[de,w.value]]),e("span",null,"I've migrated existing "+p(l.platform)+" entries (if any)",1)])):E("",!0)])]),e("div",Kr,[e("button",{onClick:t[3]||(t[3]=x=>h.$emit("close")),class:"btn-secondary"}," Cancel "),e("button",{onClick:A,class:"btn-primary",disabled:!C.value},[...t[30]||(t[30]=[e("i",{class:"mdi mdi-check"},null,-1),_(" I've Completed Setup ",-1)])],8,Xr)])])])):E("",!0)}},Zr=he(Yr,[["__scopeId","data-v-f6fe4c03"]]),Qr={class:"modal-header"},ed={class:"progress-steps"},td={class:"step-number"},od={key:0,class:"mdi mdi-check"},ld={key:1},nd={class:"step-label"},sd={class:"modal-body"},ad={key:0,class:"step-content"},id={class:"form-group"},rd={class:"form-group"},dd={class:"form-group"},ud={key:1,class:"step-content"},cd={key:1,class:"platform-form"},md={class:"form-section"},vd={class:"checkbox-grid"},pd={class:"checkbox-item"},fd={class:"checkbox-item"},gd={class:"checkbox-item"},yd={class:"checkbox-item"},bd={class:"checkbox-item"},hd={key:2,class:"platform-form"},kd={class:"form-section"},wd={class:"form-group"},$d={class:"form-section"},Cd={class:"checkbox-grid"},Sd={class:"checkbox-item"},_d={class:"checkbox-item"},Id={key:3,class:"platform-form"},Dd={class:"form-section"},Td={class:"checkbox-grid"},xd={class:"checkbox-item"},Rd={class:"checkbox-item"},Md={class:"checkbox-item"},Od={class:"checkbox-item"},Ld={key:2,class:"step-content"},Ed={key:3,class:"step-content"},Ad={class:"modal-footer"},Vd=["disabled"],jd={key:2,class:"save-buttons"},Ud=["disabled"],Fd=["disabled"],Pd={__name:"SmartIRProfileBuilder",props:{show:{type:Boolean,default:!1},editMode:{type:Boolean,default:!1},editData:{type:Object,default:null},startStep:{type:Number,default:0}},emits:["close","save"],setup(l,{emit:y}){const d=l,$=y,k=we("toast"),n=b(0),w=b(!1),f=b([]),C=b(!1),T=b([]),A=b("/config"),h=b(!1),t=b(null),x=b(!1),P=b(!1),j=b(""),D=b("ir"),o=b(!1),v=[{label:"Device Info",key:"info"},{label:"Configuration",key:"config"},{label:"Learn Commands",key:"commands"},{label:"Preview & Save",key:"preview"}],c=b({platform:"",manufacturer:"",model:"",broadlinkDevice:"",commandType:"ir",config:{},commands:{}}),B=b(["turn_on"]),K=b(3),oe=b([]),te=b(["turn_on"]);ue(()=>c.value.platform,L=>{L==="media_player"?c.value.config={features:B.value}:L==="fan"?c.value.config={speedLevels:K.value,features:oe.value}:L==="light"&&(c.value.config={features:te.value})}),ue(B,L=>{c.value.platform==="media_player"&&(c.value.config={features:L})},{deep:!0}),ue(K,L=>{c.value.platform==="fan"&&(c.value.config={speedLevels:L,features:oe.value})}),ue(oe,L=>{c.value.platform==="fan"&&(c.value.config={speedLevels:K.value,features:L})},{deep:!0}),ue(te,L=>{c.value.platform==="light"&&(c.value.config={features:L})},{deep:!0});function pe(L){const a=new Set,m=Object.keys(L);return m.some(g=>g==="off"||g.includes("_off"))&&a.add("off"),m.some(g=>g.includes("auto"))&&a.add("auto"),m.some(g=>g.includes("cool"))&&a.add("cool"),m.some(g=>g.includes("heat"))&&a.add("heat"),m.some(g=>g.includes("dry"))&&a.add("dry"),m.some(g=>g.includes("fan_only"))&&a.add("fan_only"),Array.from(a)}function O(L){const a=new Set,m=Object.keys(L);return m.some(g=>g.includes("auto"))&&a.add("auto"),m.some(g=>g.includes("low"))&&a.add("low"),m.some(g=>g.includes("medium")||g.includes("mid"))&&a.add("medium"),m.some(g=>g.includes("high"))&&a.add("high"),Array.from(a)}function N(L){const a=new Set,m=Object.keys(L);return m.some(g=>g.includes("swing_off")||g.includes("_off"))&&a.add("off"),m.some(g=>g.includes("vertical"))&&a.add("vertical"),m.some(g=>g.includes("horizontal"))&&a.add("horizontal"),m.some(g=>g.includes("both"))&&a.add("both"),Array.from(a)}function Y(L){for(const a of Object.values(L))if(typeof a=="string"&&a.startsWith("sc")||Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0].startsWith("sc"))return"rf";return"ir"}ue(()=>c.value.commandType,(L,a)=>{!a||x.value||o.value||(Object.keys(c.value.commands).length>0&&L!==a?(j.value=L,c.value.commandType=a,x.value=!0):L!==a&&(D.value=L))}),ue(()=>d.editData,async L=>{var a,m,g;if(L&&d.editMode){console.log("ğŸ”§ Edit mode activated, loading profile data:",L),o.value=!0,f.value.length===0&&(console.log("ğŸ“¡ Loading Broadlink devices..."),await se(),console.log("ğŸ“¡ Devices loaded:",f.value.length));const R=L.profile,U=R.controller_data;console.log("ğŸ® Controller data from profile:",U),console.log("ğŸ® Available devices:",f.value.map(W=>W.entity_id));const q=R.commands||{},ne=R.commandType||Y(q);console.log("ğŸ” Command type (stored):",R.commandType),console.log("ğŸ” Command type (final):",ne);let ee={};if(L.platform==="climate"){const W=R.operationModes||pe(q),fe=R.fanModes||O(q),Te=R.swingModes||N(q);console.log("ğŸ” Inferred modes:",W),console.log("ğŸ” Inferred fan modes:",fe),console.log("ğŸ” Inferred swing modes:",Te),ee={minTemp:R.minTemperature,maxTemp:R.maxTemperature,precision:R.precision,modes:W,fanModes:fe,swingModes:Te}}else if(L.platform==="media_player"){const W=[];(q.on||q.off)&&W.push("turn_on"),(q.volumeUp||q.volumeDown)&&W.push("volume"),q.mute&&W.push("mute"),q.sources&&W.push("source"),(q.channelUp||q.channelDown)&&W.push("channel"),ee={features:W},B.value=W,console.log("ğŸ” Inferred media player features:",W)}else if(L.platform==="fan"){const W=((a=R.speed)==null?void 0:a.length)||Object.keys(q.default||{}).length||3,fe=[];(q.oscillate_on||q.oscillate_off)&&fe.push("oscillate"),(q.direction_forward||q.direction_reverse)&&fe.push("direction"),ee={speedLevels:W,features:fe},K.value=W,oe.value=fe,console.log("ğŸ” Inferred fan config:",ee)}else if(L.platform==="light"){const W=[];ee={features:W},te.value=W,console.log("ğŸ” Inferred light features:",W)}const Q=await I(R.manufacturer,(m=R.supportedModels)==null?void 0:m[0],q);c.value={platform:L.platform,manufacturer:R.manufacturer||"",model:((g=R.supportedModels)==null?void 0:g[0])||"",broadlinkDevice:U||"",commandType:ne,config:ee,commands:Q},console.log("âœ… Profile populated:",c.value),console.log("âœ… Selected device:",c.value.broadlinkDevice),console.log("âœ… Command type:",c.value.commandType),console.log("âœ… Commands (with learned codes):",Q),D.value=ne,setTimeout(()=>{o.value=!1},100)}},{immediate:!0});const re=J(()=>{var L;switch(n.value){case 0:return c.value.platform&&c.value.manufacturer&&c.value.model;case 1:return c.value.platform==="climate"?c.value.config.minTemp&&c.value.config.maxTemp&&((L=c.value.config.modes)==null?void 0:L.length)>0:!0;case 2:return c.value.broadlinkDevice&&c.value.commandType&&Object.keys(c.value.commands).length>0;case 3:return!0;default:return!1}}),ye=b(null);async function $e(){if(n.value!==3){ye.value=null;return}if(console.log("ğŸ” Generating JSON with commands:",c.value.commands),Object.values(c.value.commands).some(a=>typeof a=="string"?a==="pending":typeof a=="object"?Object.values(a).some(m=>typeof m=="string"?m==="pending":typeof m=="object"?Object.values(m).some(g=>g==="pending"):!1):!1)){console.warn('âš ï¸ Commands still contain "pending" placeholders!'),console.log("ğŸ“¦ Attempting to fetch from Broadlink storage...");const a=await I(c.value.manufacturer,c.value.model,c.value.commands);c.value.commands=a,console.log("âœ… Updated commands:",a)}ye.value=le(c.value),console.log("ğŸ“„ Generated JSON:",ye.value)}const Ie=J(()=>n.value!==3?null:G(c.value));function Ce(){c.value.config={},c.value.commands={}}function S(){x.value=!1,c.value.commandType=j.value,D.value=j.value,c.value.commands={},j.value=""}function u(){x.value=!1,j.value=""}async function V(){n.value<v.length-1&&(n.value++,n.value===3&&await $e())}function ie(){n.value>0&&n.value--}function M(){x.value||(P.value=!0)}function r(){P.value=!1,F()}function F(){$("close"),setTimeout(()=>{n.value=0,c.value={platform:"",manufacturer:"",model:"",broadlinkDevice:"",commandType:"ir",config:{},commands:{}},D.value="ir"},300)}async function Z(){var L,a,m,g,R;w.value=!0;try{if(!h.value){const W=await fetch("api/smartir/config/check");if(W.ok){const fe=await W.json();if(!((L=fe.platforms[c.value.platform])==null?void 0:L.file_exists)){T.value=fe.configuration_warnings||[],A.value=fe.config_path||"/config",t.value={platform:c.value.platform,json:ye.value},C.value=!0,w.value=!1;return}}}let U;if(d.editMode&&((a=d.editData)!=null&&a.code))U=parseInt(d.editData.code),console.log("ğŸ“ Edit mode: Using existing code",U);else{const W=await fetch(`api/smartir/platforms/${c.value.platform}/next-code`);if(!W.ok)throw new Error("Failed to get next code number");U=(await W.json()).next_code,console.log("âœ¨ New profile: Using next code",U)}const q=await fetch("api/smartir/profiles",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({platform:c.value.platform,json:ye.value,code_number:U})});if(!q.ok){const W=await q.json();throw new Error(W.error||"Failed to save profile")}const ne=await q.json(),ee={name:`${c.value.manufacturer} ${c.value.model}`,unique_id:`${c.value.manufacturer.toLowerCase().replace(/[^a-z0-9]+/g,"_")}_${c.value.model.toLowerCase().replace(/[^a-z0-9]+/g,"_")}`,device_code:U,controller_data:c.value.broadlinkDevice},Q=await fetch("api/smartir/config/add-device",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({platform:c.value.platform,device_config:ee})});if(!Q.ok){const W=await Q.json();console.error("Failed to add device to config:",W),(m=k.value)==null||m.warning(`Profile saved but failed to add to config file: ${W.error}`,"âš ï¸ Partial Success")}$("save",{json:ye.value,yaml:Ie.value,profile:c.value,saved_to:ne.path}),(g=k.value)==null||g.success(`File: ${ne.filename}
Device Code: ${U}
Added to: smartir/${c.value.platform}.yaml

âš ï¸ Restart Home Assistant to activate`,"âœ… Profile Saved Successfully!"),F()}catch(U){console.error("Error saving profile:",U),(R=k.value)==null||R.error(U.message,"âŒ Error Saving Profile")}finally{w.value=!1}}async function ae(){h.value=!0,C.value=!1,t.value&&(await Z(),t.value=null)}function H(){var L,a;try{const m=JSON.stringify(ye.value,null,2),g=new Blob([m],{type:"application/json"}),R=URL.createObjectURL(g),U=document.createElement("a");U.href=R;const q=c.value.manufacturer.toLowerCase().replace(/\s+/g,"_"),ne=c.value.model.toLowerCase().replace(/\s+/g,"_");U.download=`smartir_${c.value.platform}_${q}_${ne}.json`,document.body.appendChild(U),U.click(),document.body.removeChild(U),URL.revokeObjectURL(R),(L=k.value)==null||L.success("You can manually upload this file to your SmartIR codes directory.","âœ… Profile Downloaded")}catch(m){console.error("Error downloading profile:",m),(a=k.value)==null||a.error(m.message,"âŒ Error Downloading Profile")}}async function I(L,a,m){const g=L.toLowerCase().replace(/[^a-z0-9]+/g,"_"),R=a.toLowerCase().replace(/[^a-z0-9]+/g,"_"),U=`${g}_${R}`;try{const q=await fetch("/api/commands/all");if(!q.ok)return console.error("Failed to fetch commands from Broadlink storage"),m;const ee=(await q.json())[U]||{};console.log(`ğŸ” Fetching learned commands for device: ${U}`),console.log("ğŸ“¦ Device commands from storage:",ee);const Q={...m};for(const[W,fe]of Object.entries(Q))if(fe==="pending"&&ee[W])Q[W]=ee[W];else if(typeof fe=="object"){for(const[Te,Oe]of Object.entries(fe))if(typeof Oe=="object")for(const[Ee,Ze]of Object.entries(Oe)){const Be=`${W}_${Te}_${Ee}`;Ze==="pending"&&ee[Be]&&(Q[W][Te][Ee]=ee[Be])}else if(Oe==="pending"){const Ee=`${W}_${Te}`;ee[Ee]&&(Q[W][Te]=ee[Ee])}}return console.log("âœ… Merged commands:",Q),Q}catch(q){return console.error("Error fetching learned commands:",q),m}}function le(L){const a={manufacturer:L.manufacturer,supportedModels:[L.model],supportedController:"Broadlink",commandsEncoding:"Base64",commandType:L.commandType||"ir",commands:{}};return L.platform==="climate"&&(a.minTemperature=L.config.minTemp,a.maxTemperature=L.config.maxTemp,a.precision=L.config.precision||1,a.operationModes=L.config.modes||[],a.fanModes=L.config.fanModes&&L.config.fanModes.length>0?L.config.fanModes:["auto"],L.config.swingModes&&L.config.swingModes.length>0&&(a.swingModes=L.config.swingModes),a.commands=L.commands),a}function G(L){let a=`# SmartIR ${L.platform} configuration
`;return a+=`# Generated by Broadlink Manager v2

`,L.platform==="climate"&&(a+=`climate:
`,a+=`  - platform: smartir
`,a+=`    name: ${L.manufacturer} ${L.model}
`,a+=`    unique_id: ${L.manufacturer.toLowerCase()}_${L.model.toLowerCase().replace(/\s+/g,"_")}
`,a+=`    device_code: 10000  # Change this to your custom code number
`,a+=`    controller_data: ${L.broadlinkDevice}
`,L.config.tempSensor&&(a+=`    temperature_sensor: ${L.config.tempSensor}
`),L.config.humiditySensor&&(a+=`    humidity_sensor: ${L.config.humiditySensor}
`),L.config.powerSensor&&(a+=`    power_sensor: ${L.config.powerSensor}
`)),a}async function se(){try{console.log("Fetching remote devices from api/remote/devices...");const L=await fetch("api/remote/devices");if(console.log("Response status:",L.status,L.ok),L.ok){const a=await L.json();console.log("Loaded remote devices response:",a);const m=a.devices||[];console.log("Extracted devices array:",m),console.log("Device count:",m.length),f.value=m,console.log("broadlinkDevices.value set to:",f.value),console.log("Final device count:",f.value.length)}else console.error("Response not OK:",L.status,L.statusText),f.value=[]}catch(L){console.error("Error loading remote devices:",L),f.value=[]}}return ue(()=>d.show,L=>{if(L){const a=Number.isInteger(d.startStep)?d.startStep:0;n.value=Math.min(Math.max(a,0),v.length-1)}}),ue(()=>d.startStep,L=>{if(d.show){const a=Number.isInteger(L)?L:0;n.value=Math.min(Math.max(a,0),v.length-1)}}),De(()=>{d.show&&se()}),(L,a)=>l.show?(s(),i("div",{key:0,class:"modal-overlay",onClick:M},[e("div",{class:"modal-container",onClick:a[19]||(a[19]=me(()=>{},["stop"]))},[e("div",Qr,[e("h2",null,[a[22]||(a[22]=e("i",{class:"mdi mdi-file-document-edit"},null,-1)),_(" "+p(l.editMode?"Edit SmartIR Profile":"Create SmartIR Profile"),1)]),e("button",{onClick:F,class:"close-button"},[...a[23]||(a[23]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",ed,[(s(),i(ge,null,be(v,(m,g)=>e("div",{key:g,class:X(["step",{active:n.value===g,completed:n.value>g}])},[e("div",td,[n.value>g?(s(),i("i",od)):(s(),i("span",ld,p(g+1),1))]),e("span",nd,p(m.label),1)],2)),64))]),e("div",sd,[n.value===0?(s(),i("div",ad,[a[29]||(a[29]=e("h3",null,"Device Information",-1)),e("div",id,[a[25]||(a[25]=e("label",null,"Platform Type *",-1)),z(e("select",{"onUpdate:modelValue":a[0]||(a[0]=m=>c.value.platform=m),onChange:Ce},[...a[24]||(a[24]=[Me('<option value="" data-v-fc2b754e>Select platform...</option><option value="climate" data-v-fc2b754e>ğŸŒ¡ï¸ Climate (AC, Heater, Heat Pump)</option><option value="media_player" data-v-fc2b754e>ğŸ“º Media Player (TV, Receiver)</option><option value="fan" data-v-fc2b754e>ğŸŒ€ Fan</option><option value="light" data-v-fc2b754e>ğŸ’¡ Light (LED Strip, IR Light)</option>',5)])],544),[[ke,c.value.platform]])]),e("div",rd,[a[26]||(a[26]=e("label",null,"Manufacturer *",-1)),z(e("input",{"onUpdate:modelValue":a[1]||(a[1]=m=>c.value.manufacturer=m),type:"text",placeholder:"e.g., Daikin, LG, Samsung"},null,512),[[_e,c.value.manufacturer]])]),e("div",dd,[a[27]||(a[27]=e("label",null,"Model(s) *",-1)),z(e("input",{"onUpdate:modelValue":a[2]||(a[2]=m=>c.value.model=m),type:"text",placeholder:"e.g., FTXS35K, Multiple models"},null,512),[[_e,c.value.model]]),a[28]||(a[28]=e("small",null,'Enter model number or "Multiple" if it works with many models',-1))])])):E("",!0),n.value===1?(s(),i("div",ud,[c.value.platform==="climate"?(s(),xe(Ti,{key:0,modelValue:c.value.config,"onUpdate:modelValue":a[3]||(a[3]=m=>c.value.config=m)},null,8,["modelValue"])):c.value.platform==="media_player"?(s(),i("div",cd,[a[36]||(a[36]=e("h3",null,"Media Player Configuration",-1)),a[37]||(a[37]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),_(" Configure the features your media player supports. You'll learn the IR commands in the next step. ")],-1)),e("div",md,[a[35]||(a[35]=e("h4",null,"Supported Features",-1)),e("div",vd,[e("label",pd,[z(e("input",{type:"checkbox",value:"turn_on","onUpdate:modelValue":a[4]||(a[4]=m=>B.value=m)},null,512),[[de,B.value]]),a[30]||(a[30]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),_(" Power On/Off ")],-1))]),e("label",fd,[z(e("input",{type:"checkbox",value:"volume","onUpdate:modelValue":a[5]||(a[5]=m=>B.value=m)},null,512),[[de,B.value]]),a[31]||(a[31]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-volume-high"}),_(" Volume Control ")],-1))]),e("label",gd,[z(e("input",{type:"checkbox",value:"mute","onUpdate:modelValue":a[6]||(a[6]=m=>B.value=m)},null,512),[[de,B.value]]),a[32]||(a[32]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-volume-mute"}),_(" Mute ")],-1))]),e("label",yd,[z(e("input",{type:"checkbox",value:"source","onUpdate:modelValue":a[7]||(a[7]=m=>B.value=m)},null,512),[[de,B.value]]),a[33]||(a[33]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-import"}),_(" Source Selection ")],-1))]),e("label",bd,[z(e("input",{type:"checkbox",value:"channel","onUpdate:modelValue":a[8]||(a[8]=m=>B.value=m)},null,512),[[de,B.value]]),a[34]||(a[34]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-numeric"}),_(" Channel Control ")],-1))])])])])):c.value.platform==="fan"?(s(),i("div",hd,[a[44]||(a[44]=e("h3",null,"Fan Configuration",-1)),a[45]||(a[45]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),_(" Configure the features your fan supports. You'll learn the IR commands in the next step. ")],-1)),e("div",kd,[a[40]||(a[40]=e("h4",null,"Fan Speed Levels",-1)),e("div",wd,[a[39]||(a[39]=e("label",null,"Number of Speed Levels *",-1)),z(e("select",{"onUpdate:modelValue":a[9]||(a[9]=m=>K.value=m)},[...a[38]||(a[38]=[e("option",{value:1},"1 Speed",-1),e("option",{value:2},"2 Speeds",-1),e("option",{value:3},"3 Speeds (Low/Med/High)",-1),e("option",{value:4},"4 Speeds",-1),e("option",{value:5},"5 Speeds",-1),e("option",{value:6},"6 Speeds",-1)])],512),[[ke,K.value,void 0,{number:!0}]])])]),e("div",$d,[a[43]||(a[43]=e("h4",null,"Additional Features",-1)),e("div",Cd,[e("label",Sd,[z(e("input",{type:"checkbox",value:"oscillate","onUpdate:modelValue":a[10]||(a[10]=m=>oe.value=m)},null,512),[[de,oe.value]]),a[41]||(a[41]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-sync"}),_(" Oscillation ")],-1))]),e("label",_d,[z(e("input",{type:"checkbox",value:"direction","onUpdate:modelValue":a[11]||(a[11]=m=>oe.value=m)},null,512),[[de,oe.value]]),a[42]||(a[42]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-rotate-3d-variant"}),_(" Direction (Forward/Reverse) ")],-1))])])])])):c.value.platform==="light"?(s(),i("div",Id,[a[51]||(a[51]=e("h3",null,"Light Configuration",-1)),a[52]||(a[52]=e("p",{class:"help-text"},[e("i",{class:"mdi mdi-information"}),_(" Configure the features your light supports. You'll learn the IR commands in the next step. ")],-1)),e("div",Dd,[a[50]||(a[50]=e("h4",null,"Supported Features",-1)),e("div",Td,[e("label",xd,[z(e("input",{type:"checkbox",value:"turn_on","onUpdate:modelValue":a[12]||(a[12]=m=>te.value=m)},null,512),[[de,te.value]]),a[46]||(a[46]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-power"}),_(" Power On/Off ")],-1))]),e("label",Rd,[z(e("input",{type:"checkbox",value:"brightness","onUpdate:modelValue":a[13]||(a[13]=m=>te.value=m)},null,512),[[de,te.value]]),a[47]||(a[47]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-brightness-6"}),_(" Brightness Control ")],-1))]),e("label",Md,[z(e("input",{type:"checkbox",value:"color_temp","onUpdate:modelValue":a[14]||(a[14]=m=>te.value=m)},null,512),[[de,te.value]]),a[48]||(a[48]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-thermometer"}),_(" Color Temperature ")],-1))]),e("label",Od,[z(e("input",{type:"checkbox",value:"rgb","onUpdate:modelValue":a[15]||(a[15]=m=>te.value=m)},null,512),[[de,te.value]]),a[49]||(a[49]=e("span",{class:"checkbox-label"},[e("i",{class:"mdi mdi-palette"}),_(" RGB Color ")],-1))])])])])):E("",!0)])):E("",!0),n.value===2?(s(),i("div",Ld,[ve(ir,{modelValue:c.value.commands,"onUpdate:modelValue":a[16]||(a[16]=m=>c.value.commands=m),platform:c.value.platform,config:c.value.config,broadlinkDevice:c.value.broadlinkDevice,"onUpdate:broadlinkDevice":a[17]||(a[17]=m=>c.value.broadlinkDevice=m),manufacturer:c.value.manufacturer,model:c.value.model,commandType:c.value.commandType,"onUpdate:commandType":a[18]||(a[18]=m=>c.value.commandType=m)},null,8,["modelValue","platform","config","broadlinkDevice","manufacturer","model","commandType"])])):E("",!0),n.value===3?(s(),i("div",Ed,[ve(Or,{profile:c.value,"json-data":ye.value,"yaml-config":Ie.value},null,8,["profile","json-data","yaml-config"])])):E("",!0)]),e("div",Ad,[n.value>0?(s(),i("button",{key:0,onClick:ie,class:"btn-secondary"},[...a[53]||(a[53]=[e("i",{class:"mdi mdi-arrow-left"},null,-1),_(" Back ",-1)])])):E("",!0),a[57]||(a[57]=e("div",{class:"spacer"},null,-1)),e("button",{onClick:F,class:"btn-text"}," Cancel "),n.value<v.length-1?(s(),i("button",{key:1,onClick:V,class:"btn-primary",disabled:!re.value},[...a[54]||(a[54]=[_(" Next ",-1),e("i",{class:"mdi mdi-arrow-right"},null,-1)])],8,Vd)):(s(),i("div",jd,[e("button",{onClick:Z,class:"btn-primary",disabled:w.value},[a[55]||(a[55]=e("i",{class:"mdi mdi-cloud-upload"},null,-1)),_(" "+p(w.value?"Saving...":"Save to SmartIR"),1)],8,Ud),e("button",{onClick:H,class:"btn-secondary",disabled:w.value},[...a[56]||(a[56]=[e("i",{class:"mdi mdi-download"},null,-1),_(" Download JSON ",-1)])],8,Fd)]))])]),ve(Zr,{show:C.value,platform:c.value.platform,warnings:T.value,"config-path":A.value,onClose:a[20]||(a[20]=m=>C.value=!1),onComplete:ae},null,8,["show","platform","warnings","config-path"]),ve(Re,{isOpen:x.value,title:"Change Command Type?",message:"Changing the command type will clear all learned commands. Continue?",confirmText:"Continue",cancelText:"Cancel",dangerMode:!0,onConfirm:S,onCancel:u},null,8,["isOpen"]),ve(Re,{isOpen:P.value,title:"Close Profile Builder?",message:"Are you sure you want to close? Your progress will be lost.",confirmText:"Close",cancelText:"Keep Editing",dangerMode:!0,onConfirm:r,onCancel:a[21]||(a[21]=m=>P.value=!1)},null,8,["isOpen"])])):E("",!0)}},Nd=he(Pd,[["__scopeId","data-v-fc2b754e"]]),Bd={class:"dashboard"},Hd={__name:"Dashboard",setup(l){const y=Ae(),d=we("smartirEnabled"),$=b(!1),k=b(!1),n=b(null),w=b(0),f=b(null);function C(){k.value=!1,n.value=null,w.value=0,$.value=!0}async function T({platform:x,profile:P,startStep:j}){w.value=Number.isInteger(j)?j:0;try{const D=await fetch(`api/smartir/platforms/${x}/profiles/${P.code}`);if(!D.ok)throw new Error("Failed to load profile");const o=await D.json();let v="";try{const c=await fetch(`api/smartir/config/get-device?platform=${x}&code=${P.code}`);c.ok?(v=(await c.json()).controller_data||"",console.log("âœ… Found controller_data from YAML:",v)):console.warn("âš ï¸ No YAML entry found for this profile (this is OK for profiles not yet added to config)")}catch(c){console.warn("âš ï¸ Could not fetch controller_data from config:",c)}k.value=!0,n.value={platform:x,code:P.code,profile:{...o.profile,controller_data:v}},$.value=!0}catch(D){console.error("Error loading profile for edit:",D),y.error("Failed to load profile for editing")}}function A(){$.value=!1,k.value=!1,n.value=null}function h(){console.log("Show install guide clicked"),window.open("https://github.com/smartHomeHub/SmartIR","_blank")}async function t(x){console.log("Profile saved:",x),A(),f.value&&f.value.loadAllProfiles&&(await f.value.loadAllProfiles(),console.log("âœ… Profiles list refreshed"))}return(x,P)=>(s(),i("div",Bd,[Se(d)?(s(),xe(cs,{key:0})):E("",!0),P[0]||(P[0]=Me('<div class="welcome-banner" data-v-fbe628f8><div class="banner-content" data-v-fbe628f8><div class="banner-icon" data-v-fbe628f8><i class="mdi mdi-rocket-launch" data-v-fbe628f8></i></div><div class="banner-text" data-v-fbe628f8><h2 data-v-fbe628f8>Welcome to Broadlink Manager v2!</h2><p data-v-fbe628f8>Manage your IR/RF devices with a modern Vue 3 interface</p></div></div><div class="status-badges" data-v-fbe628f8><span class="badge success" data-v-fbe628f8><i class="mdi mdi-check-circle" data-v-fbe628f8></i> Vue 3 Ready </span><span class="badge warning" data-v-fbe628f8><i class="mdi mdi-beta" data-v-fbe628f8></i> Beta </span></div></div>',1)),ve(ss),Se(d)?(s(),xe(Oa,{key:1,ref_key:"smartirStatusCard",ref:f,onCreateProfile:C,onEditProfile:T,onShowInstallGuide:h},null,512)):E("",!0),ve(Nd,{show:$.value,editMode:k.value,editData:n.value,startStep:w.value,onClose:A,onSave:t},null,8,["show","editMode","editData","startStep"])]))}},qd=he(Hd,[["__scopeId","data-v-fbe628f8"]]),Jd={class:"toast-container"},zd={class:"toast-content"},Wd={key:0,class:"toast-title"},Gd={class:"toast-message"},Kd={key:1,class:"toast-description"},Xd=["onClick"],Yd={__name:"Toast",setup(l,{expose:y}){const d=b([]);let $=0;function k(f){const C={success:"mdi-check-circle",error:"mdi-alert-circle",warning:"mdi-alert",info:"mdi-information"};return C[f]||C.info}function n({message:f,title:C,description:T,type:A="info",duration:h=5e3}){const t=$++,x={id:t,message:f,title:C,description:T,type:A};return d.value.push(x),h>0&&setTimeout(()=>{w(t)},h),t}function w(f){const C=d.value.findIndex(T=>T.id===f);C>-1&&d.value.splice(C,1)}return y({addToast:n,removeToast:w,show:n,success:(f,C)=>n({message:f,title:C,type:"success"}),error:(f,C)=>n({message:f,title:C,type:"error",duration:8e3}),warning:(f,C)=>n({message:f,title:C,type:"warning",duration:6e3}),info:(f,C)=>n({message:f,title:C,type:"info"})}),(f,C)=>(s(),xe(We,{to:"body"},[e("div",Jd,[ve(ot,{name:"toast"},{default:Pe(()=>[(s(!0),i(ge,null,be(d.value,T=>(s(),i("div",{key:T.id,class:X(["toast",[`toast-${T.type}`]])},[e("i",{class:X(["mdi",k(T.type)])},null,2),e("div",zd,[T.title?(s(),i("div",Wd,p(T.title),1)):E("",!0),e("div",Gd,p(T.message),1),T.description?(s(),i("div",Kd,p(T.description),1)):E("",!0)]),e("button",{onClick:A=>w(T.id),class:"toast-close"},[...C[0]||(C[0]=[e("i",{class:"mdi mdi-close"},null,-1)])],8,Xd)],2))),128))]),_:1})])]))}},Zd=he(Yd,[["__scopeId","data-v-bf1fd466"]]),Qd={id:"app",class:"app-container"},eu={class:"app-header"},tu={class:"header-content"},ou={class:"header-right"},lu=["title"],nu={class:"settings-menu-container"},su={key:0,class:"settings-menu"},au=["title"],iu={class:"toggle-content"},ru={key:0,class:"not-installed-label"},du={key:0,href:"https://github.com/smartHomeHub/SmartIR",target:"_blank",class:"menu-item menu-link menu-subitem"},uu=["disabled"],cu=["disabled"],mu=["disabled"],vu={class:"app-main"},pu={__name:"App",setup(l){const y=b(null),d=b("light"),$=b(null),k=b(!1),n=b(!1),w=b(!1),f=b(localStorage.getItem("smartir_enabled")!=="false"),C=J(()=>{var v;return((v=$.value)==null?void 0:v.installed)||!1}),T=J(()=>({light:"mdi mdi-weather-sunny",medium:"mdi mdi-weather-partly-cloudy",dark:"mdi mdi-weather-night"})[d.value]),A=J(()=>({light:"Switch to Medium Theme",medium:"Switch to Dark Theme",dark:"Switch to Light Theme"})[d.value]),h=()=>{const v=["light","medium","dark"],B=(v.indexOf(d.value)+1)%v.length;d.value=v[B],document.body.classList.remove("medium-mode","dark-mode"),d.value==="medium"?document.body.classList.add("medium-mode"):d.value==="dark"&&document.body.classList.add("dark-mode"),localStorage.setItem("theme",d.value)},t=async()=>{try{const v=await Xe.getStatus();$.value=v,v.installed?console.log("âœ… SmartIR detected:",v.version):console.log("â„¹ï¸ SmartIR not detected")}catch(v){console.error("Error checking SmartIR:",v),$.value={installed:!1,error:v.message}}},x=async()=>{var v,c;n.value=!0;try{const K=(await ce.get("/api/diagnostics/markdown")).data.markdown;await navigator.clipboard.writeText(K),(v=y.value)==null||v.success("Diagnostic summary copied to clipboard!"),k.value=!1}catch(B){console.error("Error copying diagnostics:",B),(c=y.value)==null||c.error("Failed to copy diagnostics")}finally{n.value=!1}},P=async()=>{var v,c;n.value=!0;try{const B=await ce.get("/api/diagnostics/download",{responseType:"blob"}),K=window.URL.createObjectURL(new Blob([B.data])),oe=document.createElement("a");oe.href=K;const te=B.headers["content-disposition"];let pe="broadlink_manager_diagnostics.zip";if(te){const O=te.match(/filename="?(.+)"?/);O&&(pe=O[1])}oe.setAttribute("download",pe),document.body.appendChild(oe),oe.click(),oe.remove(),window.URL.revokeObjectURL(K),(v=y.value)==null||v.success("Diagnostic bundle downloaded!"),k.value=!1}catch(B){console.error("Error downloading diagnostics:",B),(c=y.value)==null||c.error("Failed to download diagnostics")}finally{n.value=!1}},j=()=>{C.value&&(f.value=!f.value,localStorage.setItem("smartir_enabled",f.value.toString()),window.location.reload())},D=async()=>{var v,c,B;w.value=!0;try{const K=await ce.post("/api/smartir/refresh-index");K.data.success?(v=y.value)==null||v.success(`Updated to v${K.data.version} (${K.data.total_devices} devices)`,"âœ… Index Updated"):(c=y.value)==null||c.error(K.data.error||"Unknown error","âŒ Update Failed")}catch(K){console.error("Error updating SmartIR index:",K),(B=y.value)==null||B.error("Failed to update device index","âŒ Update Error")}finally{w.value=!1,k.value=!1}},o=v=>{v.target.closest(".settings-menu-container")||(k.value=!1)};return De(async()=>{const v=localStorage.getItem("theme");v&&["light","medium","dark"].includes(v)?(d.value=v,v==="medium"?document.body.classList.add("medium-mode"):v==="dark"&&document.body.classList.add("dark-mode")):localStorage.getItem("darkMode")==="true"&&(d.value="dark",document.body.classList.add("dark-mode"),localStorage.setItem("theme","dark")),await t();const c=He();c&&y.value&&(c.appContext.config.globalProperties.$toast=y.value),document.addEventListener("click",o)}),qe(()=>{document.removeEventListener("click",o)}),je("smartirStatus",$),je("smartirEnabled",f),je("refreshSmartIR",t),je("toast",y),(v,c)=>(s(),i("div",Qd,[e("header",eu,[e("div",tu,[c[13]||(c[13]=e("div",{class:"header-left"},[e("i",{class:"mdi mdi-remote"}),e("h1",null,"Broadlink Manager v2"),e("span",{class:"beta-badge"},"BETA")],-1)),e("div",ou,[e("button",{onClick:h,class:"icon-button",title:A.value},[e("i",{class:X(T.value)},null,2)],8,lu),e("div",nu,[e("button",{onClick:c[0]||(c[0]=B=>k.value=!k.value),class:"icon-button",title:"Settings"},[...c[2]||(c[2]=[e("i",{class:"mdi mdi-cog"},null,-1)])]),k.value?(s(),i("div",su,[c[9]||(c[9]=e("div",{class:"menu-section-title"},"Integration Settings",-1)),e("div",{class:X(["menu-item toggle-item",{disabled:!C.value}]),onClick:c[1]||(c[1]=B=>C.value?j():null),title:C.value?"":"SmartIR is not installed"},[e("div",iu,[c[3]||(c[3]=e("i",{class:"mdi mdi-air-conditioner"},null,-1)),c[4]||(c[4]=e("span",null,"SmartIR Integration",-1)),C.value?E("",!0):(s(),i("span",ru,"(Not Installed)"))]),e("div",{class:X(["toggle-switch",{active:f.value&&C.value,disabled:!C.value}])},[...c[5]||(c[5]=[e("div",{class:"toggle-slider"},null,-1)])],2)],10,au),f.value?(s(),i("a",du,[...c[6]||(c[6]=[e("i",{class:"mdi mdi-github"},null,-1),e("span",null,"SmartIR on GitHub",-1)])])):E("",!0),f.value?(s(),i("button",{key:1,onClick:D,class:"menu-item menu-subitem",disabled:w.value},[e("i",{class:X(["mdi",w.value?"mdi-loading mdi-spin":"mdi-refresh"])},null,2),e("span",null,p(w.value?"Updating...":"Update Device Index"),1)],8,uu)):E("",!0),c[10]||(c[10]=e("div",{class:"menu-divider"},null,-1)),c[11]||(c[11]=e("div",{class:"menu-section-title"},"Diagnostics",-1)),e("button",{onClick:x,class:"menu-item",disabled:n.value},[...c[7]||(c[7]=[e("i",{class:"mdi mdi-content-copy"},null,-1),e("span",null,"Copy Diagnostics",-1)])],8,cu),e("button",{onClick:P,class:"menu-item",disabled:n.value},[...c[8]||(c[8]=[e("i",{class:"mdi mdi-download"},null,-1),e("span",null,"Download Diagnostics",-1)])],8,mu),c[12]||(c[12]=Me('<div class="menu-divider" data-v-b6ab76ba></div><div class="menu-section-title" data-v-b6ab76ba>Help &amp; Support</div><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2#readme" target="_blank" class="menu-item menu-link" data-v-b6ab76ba><i class="mdi mdi-book-open-variant" data-v-b6ab76ba></i><span data-v-b6ab76ba>Documentation</span></a><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2/issues" target="_blank" class="menu-item menu-link" data-v-b6ab76ba><i class="mdi mdi-bug" data-v-b6ab76ba></i><span data-v-b6ab76ba>Report Issue</span></a><div class="menu-divider" data-v-b6ab76ba></div><div class="menu-section-title" data-v-b6ab76ba>Community</div><a href="https://community.home-assistant.io/t/broadlink-manager-modern-web-interface-for-broadlink-devices/938473" target="_blank" class="menu-item menu-link" data-v-b6ab76ba><i class="mdi mdi-forum" data-v-b6ab76ba></i><span data-v-b6ab76ba>HA Forum Discussion</span></a><a href="https://www.reddit.com/r/homeassistant/comments/1o1q3kf/release_broadlink_manager_addon_a_modern_web_ui/" target="_blank" class="menu-item menu-link" data-v-b6ab76ba><i class="mdi mdi-reddit" data-v-b6ab76ba></i><span data-v-b6ab76ba>Reddit Discussion</span></a><div class="menu-divider" data-v-b6ab76ba></div><div class="menu-section-title" data-v-b6ab76ba>Project</div><a href="https://github.com/tonyperkins/homeassistant-broadlink-manager-v2" target="_blank" class="menu-item menu-link" data-v-b6ab76ba><i class="mdi mdi-github" data-v-b6ab76ba></i><span data-v-b6ab76ba>GitHub Repository</span></a><a href="https://ko-fi.com/tonyperkins" target="_blank" class="menu-item menu-link menu-item-sponsor" data-v-b6ab76ba><i class="mdi mdi-coffee" data-v-b6ab76ba></i><span data-v-b6ab76ba>Support on Ko-fi</span></a>',12))])):E("",!0)])])])]),e("main",vu,[ve(qd)]),c[14]||(c[14]=e("footer",{class:"app-footer"},[e("p",null,"Broadlink Manager v2.0.0-beta.1 | Built with Vue 3")],-1)),ve(Zd,{ref_key:"toastRef",ref:y},null,512)]))}},fu=he(pu,[["__scopeId","data-v-b6ab76ba"]]),Ye=lt(fu),gu=nt();Ye.use(gu);Ye.mount("#app");
